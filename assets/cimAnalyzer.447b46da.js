import{ff as Pt,j6 as xt,hA as mt,fd as ut,nR as P,a8 as wt,r as E,gY as Lt,q2 as V,q3 as Z,eA as rt,nf as It,l as $t,j5 as At}from"./index.a8738f47.js";import{t as Xt,d as Rt,A as pt,x as zt,g as yt,Z as z,h as U,j as R,M as C,o as Jt,n as Ht,c as Nt,p as Yt,C as Et}from"./CIMSymbolHelper.f189aa12.js";import{r as it,e as tt,n as et,g as Ft}from"./enums.ba1e21c6.js";function Tt(t){var i;if(!t)return null;switch(t.type){case"CIMPointSymbol":{const e=t.symbolLayers;return e&&e.length===1?Tt(e[0]):null}case"CIMVectorMarker":{const e=t.markerGraphics;if(!e||e.length!==1)return null;const r=e[0];if(!r)return null;const o=r.geometry;if(!o)return null;const l=r.symbol;return!l||l.type!=="CIMPolygonSymbol"&&l.type!=="CIMLineSymbol"||((i=l.symbolLayers)==null?void 0:i.some(a=>!!a.effects))?null:{geom:o,asFill:l.type==="CIMPolygonSymbol"}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function Wt(t){return t?t.rings?t.rings:t.paths?t.paths:t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0?[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]:null:null}function jt(t){let i=1/0,e=-1/0,r=1/0,o=-1/0;for(const l of t)for(const a of l)a[0]<i&&(i=a[0]),a[0]>e&&(e=a[0]),a[1]<r&&(r=a[1]),a[1]>o&&(o=a[1]);return new Xt(i,r,e-i,o-r)}function ht(t){let i=1/0,e=-1/0,r=1/0,o=-1/0;for(const l of t)for(const a of l)a[0]<i&&(i=a[0]),a[0]>e&&(e=a[0]),a[1]<r&&(r=a[1]),a[1]>o&&(o=a[1]);return[i,r,e,o]}function bt(t){return t?t.rings?ht(t.rings):t.paths?ht(t.paths):Pt(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function Ct(t,i,e,r,o){const[l,a,n,s]=t;if(n<l||s<a)return[0,0,0];const c=n-l,f=s-a,p=128,m=1,u=Math.floor(.5*(.5*p-m)),h=(p-2*(u+m))/Math.max(c,f),y=Math.round(c*h)+2*u,d=Math.round(f*h)+2*u;let S=1;i&&(S=d/h/(i.ymax-i.ymin));let b=0,N=0;if(r)if(o){if(i&&e&&i.ymax-i.ymin>0){const v=(i.xmax-i.xmin)/(i.ymax-i.ymin);b=r.x/(e*v),N=r.y/e}}else b=r.x,N=r.y;return b=.5*(i.xmax+i.xmin)+b*(i.xmax-i.xmin),N=.5*(i.ymax+i.ymin)+N*(i.ymax-i.ymin),b-=l,N-=a,b*=h,N*=h,b+=u,N+=u,[S,b/y-.5,-(N/d-.5)]}function ke(t){const i=Wt(t.geom),e=jt(i),r=128,o=1,l=Math.floor(.5*(.5*r-o)),a=(r-2*(l+o))/Math.max(e.width,e.height),n=Math.round(e.width*a)+2*l,s=Math.round(e.height*a)+2*l,c=[];for(const p of i)if(p&&p.length>1){const m=[];for(const u of p){let[h,y]=u;h-=e.x,y-=e.y,h*=a,y*=a,h+=l-.5,y+=l-.5,t.asFill?m.push([h,y]):m.push([Math.round(h),Math.round(y)])}if(t.asFill){const u=m.length-1;m[0][0]===m[u][0]&&m[0][1]===m[u][1]||m.push(m[0])}c.push(m)}const f=Dt(c,n,s,l);return t.asFill&&Gt(c,n,s,l,f),[Ut(f,l),n,s]}function Dt(t,i,e,r){const o=i*e,l=new Array(o),a=r*r+1;for(let n=0;n<o;++n)l[n]=a;for(const n of t){const s=n.length;for(let c=1;c<s;++c){const f=n[c-1],p=n[c];let m,u,h,y;f[0]<p[0]?(m=f[0],u=p[0]):(m=p[0],u=f[0]),f[1]<p[1]?(h=f[1],y=p[1]):(h=p[1],y=f[1]);let d=Math.floor(m)-r,S=Math.floor(u)+r,b=Math.floor(h)-r,N=Math.floor(y)+r;d<0&&(d=0),S>i&&(S=i),b<0&&(b=0),N>e&&(N=e);const v=p[0]-f[0],k=p[1]-f[1],A=v*v+k*k;for(let x=d;x<S;x++)for(let I=b;I<N;I++){let w,O,M=(x-f[0])*v+(I-f[1])*k;M<0?(w=f[0],O=f[1]):M>A?(w=p[0],O=p[1]):(M/=A,w=f[0]+M*v,O=f[1]+M*k);const L=(x-w)*(x-w)+(I-O)*(I-O),J=(e-I-1)*i+x;L<l[J]&&(l[J]=L)}}}for(let n=0;n<o;++n)l[n]=Math.sqrt(l[n]);return l}function Gt(t,i,e,r,o){for(const l of t){const a=l.length;for(let n=1;n<a;++n){const s=l[n-1],c=l[n];let f,p,m,u;s[0]<c[0]?(f=s[0],p=c[0]):(f=c[0],p=s[0]),s[1]<c[1]?(m=s[1],u=c[1]):(m=c[1],u=s[1]);let h=Math.floor(f),y=Math.floor(p)+1,d=Math.floor(m),S=Math.floor(u)+1;h<r&&(h=r),y>i-r&&(y=i-r),d<r&&(d=r),S>e-r&&(S=e-r);for(let b=d;b<S;++b){if(s[1]>b==c[1]>b)continue;const N=(e-b-1)*i;for(let v=h;v<y;++v)v<(c[0]-s[0])*(b-s[1])/(c[1]-s[1])+s[0]&&(o[N+v]=-o[N+v]);for(let v=r;v<h;++v)o[N+v]=-o[N+v]}}}}function Ut(t,i){const e=2*i,r=t.length,o=new Uint8Array(4*r);for(let l=0;l<r;++l){const a=.5-t[l]/e;xt(a,o,4*l)}return o}const qt=96/72;class gt{static executeEffects(i,e,r){const o=Rt(e),l=qt;let a=new yt(o);for(const n of i){const s=pt(n);s&&(a=s.execute(a,n,l,r))}return a}static next(i){const e=i.next();return zt(e),e}static applyEffects(i,e,r){if(!i)return e;let o=new yt(e);for(const n of i){const s=pt(n);s&&(o=s.execute(o,n,1,r))}let l,a=null;for(;l=o.next();)a?mt(a)?mt(l)&&a.paths.push(...l.paths):ut(a)&&ut(l)&&a.rings.push(...l.rings):a=l;return a}}function Bt(t){const i=t.toLowerCase().split(" ").join("-");switch(i){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return i}}function Vt(t,i){let e;if(typeof t=="string")e=P(t+`-seed(${i})`);else{let r=12;e=t^i;do e=107*(e>>8^e)+r|0;while(--r!=0)}return(1+e/(1<<31))/2}function Zt(t){return Math.floor(Vt(t,Kt)*Qt)}const Kt=53290320,Qt=10,nt=wt.getLogger("esri.symbols.cim.cimAnalyzer");function lt(t){switch(t){case"Butt":return tt.BUTT;case"Square":return tt.SQUARE;default:return tt.ROUND}}function at(t){switch(t){case"Bevel":return et.BEVEL;case"Miter":return et.MITER;default:return et.ROUND}}function _t(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return nt.warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),"center"}}function te(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function ee(t){let i="",e="";if(t){const r=t.toLowerCase();r.includes("italic")?i="italic":r.includes("oblique")&&(i="oblique"),r.includes("bold")?e="bold":r.includes("light")&&(e="lighter")}return{style:i,weight:e}}function oe(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function dt(t,i,e,r){let o;t[i]?o=t[i]:(o={},t[i]=o),o[e]=r}function St(t){const i=t.markerPlacement;return i&&i.angleToLine?it.MAP:it.SCREEN}async function Me(t,i,e,r,o){const l=r!=null?r:[];if(!t)return l;let a,n;const s={};if(t.type!=="CIMSymbolReference")return nt.error("Expect cim type to be 'CIMSymbolReference'"),l;if(a=t.symbol,n=t.primitiveOverrides,n){const f=[];for(const p of n){const m=p.valueExpressionInfo;if(m&&i){const u=m.expression,h=It(u,i.spatialReference,i.fields).then(y=>{y&&dt(s,p.primitiveName,p.propertyName,y)});f.push(h)}else p.value!=null&&dt(s,p.primitiveName,p.propertyName,p.value)}f.length>0&&await Promise.all(f)}const c=[];switch(kt(a,e,c),c.length>0&&await Promise.all(c),a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":ie(a,n,s,i,l,e,o)}return l}function ie(t,i,e,r,o,l,a){if(!t)return;const n=t.symbolLayers;if(!n)return;const s=t.effects;let c;const f=z.getSize(t);t.type==="CIMPointSymbol"&&t.angleAlignment==="Map"&&(c=it.MAP);let p=n.length;for(;p--;){const m=n[p];if(!m||m.enable===!1)continue;let u;s&&s.length&&(u=[...s]);const h=m.effects;h&&h.length&&(s?u.push(...h):u=[...h]);const y=[];let d;U.findEffectOverrides(u,i,y),d=y.length>0?de(u,y,e,r):u;const S=[];switch(U.findApplicableOverrides(m,i,S),m.type){case"CIMSolidFill":re(m,d,e,S,r,o);break;case"CIMPictureFill":ne(m,d,e,S,r,l,o);break;case"CIMHatchFill":le(m,d,e,S,r,o);break;case"CIMGradientFill":ae(m,d,e,S,r,o);break;case"CIMSolidStroke":se(m,d,e,S,r,o,t.type==="CIMPolygonSymbol",f);break;case"CIMPictureStroke":ce(m,d,e,S,r,o,t.type==="CIMPolygonSymbol",f);break;case"CIMGradientStroke":fe(m,d,e,S,r,o,t.type==="CIMPolygonSymbol",f);break;case"CIMCharacterMarker":if(ot(m,d,e,S,r,o))break;break;case"CIMPictureMarker":if(ot(m,d,e,S,r,o))break;t.type==="CIMLineSymbol"&&(c=St(m)),me(m,d,e,S,r,l,o,c,f);break;case"CIMVectorMarker":if(ot(m,d,e,S,r,o))break;t.type==="CIMLineSymbol"&&(c=St(m)),ue(m,d,e,S,r,o,l,c,f,a);break;default:nt.error("Cannot analyze CIM layer",m.type)}}}function re(t,i,e,r,o,l){const a=t.primitiveName,n=R(t.color),[s,c]=Y(r,a,i,null,null),f=P(JSON.stringify(t)+c).toString();l.push({type:"fill",templateHash:f,materialHash:s?()=>f:f,cim:t,materialOverrides:null,colorLocked:t.colorLocked,color:g(a,e,"Color",o,n,H),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:i,applyRandomOffset:!1,sampleAlphaOnly:!0})}function ne(t,i,e,r,o,l,a){const n=t.primitiveName,s=t.tintColor?R(t.tintColor):{r:255,g:255,b:255,a:1},[c,f]=Y(r,n,i,null,null),p=P(JSON.stringify(t)+f).toString(),m=P(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();let u=C(t.scaleX);if("width"in t){const h=t.width;let y=1;const d=l.getResource(t.url);E(d)&&(y=d.width/d.height),u/=y*(t.height/h)}a.push({type:"fill",templateHash:p,materialHash:c?()=>m:m,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:i,color:g(n,e,"TintColor",o,s,H),height:g(n,e,"Height",o,t.height),scaleX:g(n,e,"ScaleX",o,u),angle:g(n,e,"Rotation",o,C(t.rotation)),offsetX:g(n,e,"OffsetX",o,C(t.offsetX)),offsetY:g(n,e,"OffsetY",o,C(t.offsetY)),url:t.url,applyRandomOffset:!1,sampleAlphaOnly:!1})}function le(t,i,e,r,o,l){var h;const a=["Rotation","OffsetX","OffsetY"],n=r.filter(y=>y.primitiveName!==t.primitiveName&&!a.includes(y.propertyName)),s=t.primitiveName,[c,f]=Y(r,s,i,null,null),p=P(JSON.stringify(t)+f).toString(),m=P(`${t.separation}${JSON.stringify(t.lineSymbol)}`).toString();let u={r:255,g:255,b:255,a:1};if(t.lineSymbol){const y=(h=t.lineSymbol)==null?void 0:h.symbolLayers.find(d=>d.type==="CIMSolidStroke");y&&(u=R(y.color))}l.push({type:"fill",templateHash:p,materialHash:c?K(m,e,n,o):m,cim:t,materialOverrides:n,colorLocked:t.colorLocked,effects:i,color:u,height:g(s,e,"Separation",o,t.separation),scaleX:1,angle:g(s,e,"Rotation",o,C(t.rotation)),offsetX:g(s,e,"OffsetX",o,C(t.offsetX)),offsetY:g(s,e,"OffsetY",o,C(t.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0})}function ae(t,i,e,r,o,l){const a=t.primitiveName,[n,s]=Y(r,a,i,null,null),c=P(JSON.stringify(t)+s).toString();l.push({type:"fill",templateHash:c,materialHash:n?K(c,e,r,o):c,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:i,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,applyRandomOffset:!1,sampleAlphaOnly:!1})}function se(t,i,e,r,o,l,a,n){const s=t.primitiveName,c=R(t.color),f=t.width!==void 0?t.width:4,p=lt(t.capStyle),m=at(t.joinStyle),u=t.miterLimit,[h,y]=Y(r,s,i,null,null),d=P(JSON.stringify(t)+y).toString();let S,b;if(i&&i instanceof Array&&i.length>0){const N=i[i.length-1];if(N.type==="CIMGeometricEffectDashes"&&N.lineDashEnding==="NoConstraint"&&N.offsetAlongLine===null){const v=(i=[...i]).pop();S=v.dashTemplate,b=v.scaleDash}}l.push({type:"line",templateHash:d,materialHash:h?()=>d:d,cim:t,materialOverrides:null,isOutline:a,colorLocked:t.colorLocked,effects:i,color:g(s,e,"Color",o,c,H),width:g(s,e,"Width",o,f),cap:g(s,e,"CapStyle",o,p),join:g(s,e,"JoinStyle",o,m),miterLimit:g(s,e,"MiterLimit",o,u),referenceWidth:n,zOrder:st(t.name),dashTemplate:S,scaleDash:b,sampleAlphaOnly:!0})}function ce(t,i,e,r,o,l,a,n){const s=P(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString(),c=t.primitiveName,f=R(t.tintColor),p=t.width!==void 0?t.width:4,m=lt(t.capStyle),u=at(t.joinStyle),h=t.miterLimit,[y,d]=Y(r,c,i,null,null),S=P(JSON.stringify(t)+d).toString();l.push({type:"line",templateHash:S,materialHash:y?()=>s:s,cim:t,materialOverrides:null,isOutline:a,colorLocked:t.colorLocked,effects:i,color:g(c,e,"TintColor",o,f,H),width:g(c,e,"Width",o,p),cap:g(c,e,"CapStyle",o,m),join:g(c,e,"JoinStyle",o,u),miterLimit:g(c,e,"MiterLimit",o,h),referenceWidth:n,zOrder:st(t.name),dashTemplate:null,scaleDash:!1,url:t.url,sampleAlphaOnly:!1})}function fe(t,i,e,r,o,l,a,n){const s=t.primitiveName,c=t.width!==void 0?t.width:4,f=lt(t.capStyle),p=at(t.joinStyle),m=t.miterLimit,[u,h]=Y(r,s,i,null,null),y=P(JSON.stringify(t)+h).toString();l.push({type:"line",templateHash:y,materialHash:u?K(y,e,r,o):y,cim:t,materialOverrides:null,isOutline:a,colorLocked:t.colorLocked,effects:i,color:{r:128,g:128,b:128,a:1},width:g(s,e,"Width",o,c),cap:g(s,e,"CapStyle",o,f),join:g(s,e,"JoinStyle",o,p),miterLimit:g(s,e,"MiterLimit",o,m),referenceWidth:n,zOrder:st(t.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1})}function ot(t,i,e,r,o,l){const a=t.markerPlacement;if(!a||a.type!=="CIMMarkerPlacementInsidePolygon")return!1;const n=a,s=Math.abs(n.stepX),c=Math.abs(n.stepY);if(s===0||c===0)return!0;const f=["Rotation","OffsetX","OffsetY"],p=r.filter(v=>v.primitiveName!==t.primitiveName&&!f.includes(v.propertyName)),m="url"in t?t.url:null,[u,h]=Y(r,n.primitiveName,i,null,null),y=P(JSON.stringify(t)+h).toString();let d,S,b=null;if(a.gridType==="Random"){const v=At(Ft),k=Math.max(Math.floor(v/s),1),A=Math.max(Math.floor(v/c),1);d=c*A,b=x=>x?x*A:0,S=k*s/d}else a.shiftOddRows?(d=2*c,b=v=>v?2*v:0,S=s/c*.5):(d=c,b=null,S=s/c);let N={r:255,g:255,b:255,a:1};return"tintColor"in t&&(N=R(t.tintColor)),l.push({type:"fill",templateHash:y,materialHash:u?K(y,e,p,o):y,cim:t,materialOverrides:p,colorLocked:t.colorLocked,effects:i,color:g(n.primitiveName,e,"TintColor",o,N,H),height:g(n.primitiveName,e,"StepY",o,d,b),scaleX:S,angle:g(n.primitiveName,e,"GridAngle",o,n.gridAngle),offsetX:g(n.primitiveName,e,"OffsetX",o,C(n.offsetX)),offsetY:g(n.primitiveName,e,"OffsetY",o,C(n.offsetY)),url:m,applyRandomOffset:a.gridType==="Random",sampleAlphaOnly:!m}),!0}function me(t,i,e,r,o,l,a,n,s){var w;const c=t.primitiveName,f=C(t.size);let p=C(t.scaleX);const m=C(t.rotation),u=C(t.offsetX),h=C(t.offsetY),y=t.tintColor?R(t.tintColor):{r:255,g:255,b:255,a:1},d=P(`${t.url}${JSON.stringify(t.colorSubstitutions)}${JSON.stringify(t.animatedSymbolProperties)}`).toString(),S=Ot(t.markerPlacement,r,e,o),b=Se(t.animatedSymbolProperties,r,e,o),[N,v]=Y(r,c,i,S,b),k=P(JSON.stringify(t)+v).toString(),A=(w=t.anchorPoint)!=null?w:{x:0,y:0};if("width"in t){const O=t.width;let M=1;const L=l.getResource(t.url);E(L)&&(M=L.width/L.height),p/=M*(f/O)}function x(O,M){return Nt(b,O,M)}const I=t.animatedSymbolProperties&&t.animatedSymbolProperties.randomizeStartTime===!0?(O,M,L,J)=>{const F=Zt(J),T=x(O,M);return d+`-MATERIALGROUP(${F})-ASP(${JSON.stringify(T)})`}:N?(O,M)=>{const L=x(O,M);return d+`-ASP(${JSON.stringify(L)})`}:d;a.push({type:"marker",templateHash:k,materialHash:I,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:i,scaleSymbolsProportionally:!1,alignment:n,size:g(c,e,"Size",o,f),scaleX:g(c,e,"ScaleX",o,p),rotation:g(c,e,"Rotation",o,m),offsetX:g(c,e,"OffsetX",o,u),offsetY:g(c,e,"OffsetY",o,h),color:g(c,e,"TintColor",o,y,H),anchorPoint:{x:A.x,y:-A.y},isAbsoluteAnchorPoint:t.anchorPointUnits!=="Relative",outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:t.rotateClockwise,referenceSize:s,sizeRatio:1,markerPlacement:S,url:t.url,animatedSymbolProperties:b})}function ue(t,i,e,r,o,l,a,n,s,c){const f=t.markerGraphics;if(!f)return;let p=0;if(t.scaleSymbolsProportionally){const u=t.frame;u&&(p=u.ymax-u.ymin)}const m=Ot(t.markerPlacement,r,e,o);for(const u of f)if(u){const h=u.symbol;if(!h)continue;switch(h.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":ye(t,i,m,null,u,r,e,o,l,a,n,s,p,c);break;case"CIMTextSymbol":pe(t,i,m,u,e,r,o,l,n,s,p)}}}function pe(t,i,e,r,o,l,a,n,s,c,f){const p=[];U.findApplicableOverrides(r,l,p);const m=r.geometry;if(!("x"in m)||!("y"in m))return;const u=r.symbol,h=oe(u),y=ee(u.fontStyleName),d=Bt(u.fontFamilyName);u.font={family:d,decoration:h,...y};const S=t.frame,b=m.x-.5*(S.xmin+S.xmax),N=m.y-.5*(S.ymin+S.ymax),v=t.size/f,k=t.primitiveName,A=C(u.height)*v,x=C(u.angle),I=C(t.offsetX)+(C(u.offsetX)+b)*v,w=C(t.offsetY)+(C(u.offsetY)+N)*v,O=R(z.getFillColor(u));let M=R(z.getStrokeColor(u)),L=z.getStrokeWidth(u);L||(M=R(z.getFillColor(u.haloSymbol)),L=u.haloSize*v);const[J,F]=Y(l,k,i,e,null),T=JSON.stringify(t.effects)+Number(t.colorLocked)+JSON.stringify(t.anchorPoint)+t.anchorPointUnits+JSON.stringify(t.markerPlacement),W=P(JSON.stringify(r)+T+F).toString();let $=g(r.primitiveName,o,"TextString",a,r.textString,Jt,u.textCase);if($==null)return;const{fontStyleName:q}=u,j=d+(q?"-"+q.toLowerCase():"-regular"),D=j;typeof $=="string"&&$.includes("[")&&u.fieldMap&&($=Ht(u.fieldMap,$,u.textCase)),n.push({type:"text",templateHash:W,materialHash:J||typeof $=="function"||$.match(/\[(.*?)\]/)?(X,Q,_)=>D+"-"+Nt($,X,Q,_):D+"-"+P($),cim:u,materialOverrides:null,colorLocked:t.colorLocked,effects:i,alignment:s,anchorPoint:{x:t.anchorPoint?t.anchorPoint.x:0,y:t.anchorPoint?t.anchorPoint.y:0},isAbsoluteAnchorPoint:t.anchorPointUnits!=="Relative",fontName:j,decoration:h,weight:g(k,o,"Weight",a,y.weight),style:g(k,o,"Size",a,y.style),size:g(k,o,"Size",a,A),angle:g(k,o,"Rotation",a,x),offsetX:g(k,o,"OffsetX",a,I),offsetY:g(k,o,"OffsetY",a,w),horizontalAlignment:_t(u.horizontalAlignment),verticalAlignment:te(u.verticalAlignment),text:$,color:O,outlineColor:M,outlineSize:L,referenceSize:c,sizeRatio:1,markerPlacement:e})}function ye(t,i,e,r,o,l,a,n,s,c,f,p,m,u){var b;const h=o.symbol,y=h.symbolLayers;if(!y)return;if(u)return void vt(t,i,e,r,o,a,l,n,s,c,f,p,m);let d=y.length;if(ve(y))return void he(t,i,e,r,o,y,l,a,n,s,f,p,m);const S=gt.applyEffects(h.effects,o.geometry,c.geometryEngine);if(S)for(;d--;){const N=y[d];if(N&&N.enable!==!1)switch(N.type){case"CIMSolidFill":case"CIMSolidStroke":{const v=gt.applyEffects(N.effects,S,c.geometryEngine),k=bt(v);if(!k)continue;const[A,x,I]=Ct(k,t.frame,t.size,t.anchorPoint,t.anchorPointUnits!=="Relative"),w=N.type==="CIMSolidFill",O={type:"sdf",geom:v,asFill:w},M=t.primitiveName,L=(b=C(t.size))!=null?b:10,J=C(t.rotation),F=C(t.offsetX),T=C(t.offsetY),W=N.path,$=N.primitiveName,q=R(w?z.getFillColor(N):z.getStrokeColor(N)),j=w?{r:0,g:0,b:0,a:0}:R(z.getStrokeColor(N)),D=z.getStrokeWidth(N);if(!w&&!D)break;let X=!1,Q="";for(const G of l)G.primitiveName!==$&&G.primitiveName!==M||(G.value!==void 0?Q+=`-${G.primitiveName}-${G.propertyName}-${JSON.stringify(G.value)}`:G.valueExpressionInfo&&(X=!0));E(i)&&typeof i=="function"&&(X=!0);const _=JSON.stringify({...t,markerGraphics:null}),ft=P(JSON.stringify(O)+W).toString(),Mt={type:"marker",templateHash:P(JSON.stringify(o)+JSON.stringify(N)+_+Q).toString(),materialHash:X?()=>ft:ft,cim:O,materialOverrides:null,colorLocked:t.colorLocked,effects:i,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:f,anchorPoint:{x,y:I},isAbsoluteAnchorPoint:!1,size:g(t.primitiveName,a,"Size",n,L),rotation:g(t.primitiveName,a,"Rotation",n,J),offsetX:g(t.primitiveName,a,"OffsetX",n,F),offsetY:g(t.primitiveName,a,"OffsetY",n,T),scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:p,sizeRatio:A,color:g($,a,"Color",n,q,H),outlineColor:g($,a,"Color",n,j,H),outlineWidth:g($,a,"Width",n,D),markerPlacement:e,animatedSymbolProperties:r,path:W};s.push(Mt);break}default:vt(t,i,e,r,o,a,l,n,s,c,f,p,m)}}}function he(t,i,e,r,o,l,a,n,s,c,f,p,m){const u=o.geometry,h=l[0],y=l[1],d=bt(u);if(!d)return;const[S,b,N]=Ct(d,t.frame,t.size,t.anchorPoint,t.anchorPointUnits!=="Relative"),v={type:"sdf",geom:u,asFill:!0},k=t.primitiveName,A=C(t.size),x=C(t.rotation),I=C(t.offsetX),w=C(t.offsetY),O=y.path,M=y.primitiveName,L=h.primitiveName,J=R(z.getFillColor(y)),F=R(z.getStrokeColor(h)),T=z.getStrokeWidth(h);let W=!1,$="";for(const X of a)X.primitiveName!==M&&X.primitiveName!==L&&X.primitiveName!==k||(X.value!==void 0?$+=`-${X.primitiveName}-${X.propertyName}-${JSON.stringify(X.value)}`:X.valueExpressionInfo&&(W=!0));const q=JSON.stringify({...t,markerGraphics:null}),j=P(JSON.stringify(v)+O).toString(),D={type:"marker",templateHash:P(JSON.stringify(o)+JSON.stringify(y)+JSON.stringify(h)+q+$).toString(),materialHash:W?()=>j:j,cim:v,materialOverrides:null,colorLocked:t.colorLocked,effects:i,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:f,anchorPoint:{x:b,y:N},isAbsoluteAnchorPoint:!1,size:g(t.primitiveName,n,"Size",s,A),rotation:g(t.primitiveName,n,"Rotation",s,x),offsetX:g(t.primitiveName,n,"OffsetX",s,I),offsetY:g(t.primitiveName,n,"OffsetY",s,w),scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:p,sizeRatio:S,color:g(M,n,"Color",s,J,H),outlineColor:g(L,n,"Color",s,F,H),outlineWidth:g(L,n,"Width",s,T),markerPlacement:e,path:O,animatedSymbolProperties:r};c.push(D)}function vt(t,i,e,r,o,l,a,n,s,c,f,p,m){const u=ge(t,o);let h=[];const y=["Rotation","OffsetX","OffsetY"];h=a.filter(O=>O.primitiveName!==t.primitiveName||!y.includes(O.propertyName));let d="";for(const O of a)O.value!==void 0&&(d+=`-${O.primitiveName}-${O.propertyName}-${JSON.stringify(O.value)}`);const[S,b,N]=z.getTextureAnchor(u,c),v=t.primitiveName,k=C(t.rotation),A=C(t.offsetX),x=C(t.offsetY),I=P(JSON.stringify(u)+d).toString(),w={type:"marker",templateHash:I,materialHash:h.length>0||E(i)&&typeof i=="function"?K(I,l,h,n):I,cim:u,materialOverrides:h,colorLocked:t.colorLocked,effects:i,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:f,anchorPoint:{x:S,y:b},isAbsoluteAnchorPoint:!1,size:t.size,rotation:g(v,l,"Rotation",n,k),offsetX:g(v,l,"OffsetX",n,A),offsetY:g(v,l,"OffsetY",n,x),color:{r:255,g:255,b:255,a:1},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:m,rotateClockwise:t.rotateClockwise,referenceSize:p,sizeRatio:N/Lt(t.size),markerPlacement:e,animatedSymbolProperties:r};s.push(w)}function ge(t,i){return{type:t.type,enable:!0,name:t.name,colorLocked:t.colorLocked,primitiveName:t.primitiveName,anchorPoint:t.anchorPoint,anchorPointUnits:t.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:t.rotateClockwise,rotation:0,size:t.size,billboardMode3D:t.billboardMode3D,depth3D:t.depth3D,frame:t.frame,markerGraphics:[i],scaleSymbolsProportionally:t.scaleSymbolsProportionally,respectFrame:t.respectFrame,clippingPath:t.clippingPath}}function st(t){if(t&&t.indexOf("Level_")===0){const i=parseInt(t.substr(6),10);if(!isNaN(i))return i}return 0}function H(t){if(!t||t.length===0)return null;const i=new $t(t).toRgba();return{r:i[0],g:i[1],b:i[2],a:i[3]}}function g(t,i,e,r,o,l,a){const n=i[t];if(n){const s=n[e];if(typeof s=="string"||typeof s=="number"||s instanceof Array)return l?l.call(null,s,a):s;if(s!=null&&s instanceof V)return(c,f,p)=>{let m=Z(s,c,{$view:p},r.geometryType,f);return m!==null&&l&&(m=l.call(null,m,a)),m!==null?m:o}}return o}function ct(t){return t&&t.charAt(0).toLowerCase()+t.substr(1)}function de(t,i,e,r){for(const o of i)if(o.valueExpressionInfo){const l=e[o.primitiveName]&&e[o.primitiveName][o.propertyName];l instanceof V&&(o.fn=(a,n,s)=>Z(l,a,{$view:s},r.geometryType,n))}return(o,l,a)=>{for(const s of i)s.fn&&(s.value=s.fn(o,l,a));const n=[];for(let s of t){const c=s==null?void 0:s.primitiveName;if(c){let f=!1;for(const p of i)if(p.primitiveName===c){const m=ct(p.propertyName);p.value!=null&&p.value!==s[m]&&(f||(s=rt(s),f=!0),s[m]=p.value)}}n.push(s)}return n}}function Ot(t,i,e,r){const o=[];if(U.findApplicableOverrides(t,i,o),o.length===0)return t;for(const l of o)if(l.valueExpressionInfo){const a=e[l.primitiveName]&&e[l.primitiveName][l.propertyName];a instanceof V&&(l.fn=(n,s,c)=>Z(a,n,{$view:c},r.geometryType,s))}return(l,a,n)=>{for(const f of o)f.fn&&(f.value=f.fn(l,a,n));const s=rt(t),c=t.primitiveName;for(const f of o)if(f.primitiveName===c){const p=ct(f.propertyName);f.value!=null&&f.value!==s[p]&&(s[p]=f.value)}return s}}function Se(t,i,e,r){const o=[];if(U.findApplicableOverrides(t,i,o),o.length===0)return t;for(const l of o)if(l.valueExpressionInfo){const a=e[l.primitiveName]&&e[l.primitiveName][l.propertyName];a instanceof V&&(l.fn=(n,s,c)=>Z(a,n,{$view:c},r.geometryType,s))}return(l,a,n)=>{for(const f of o)f.fn&&(f.value=f.fn(l,a,n));const s=rt(t),c=t.primitiveName;for(const f of o)if(f.primitiveName===c){const p=ct(f.propertyName);f.value!=null&&f.value!==s[p]&&(s[p]=f.value)}return s}}function K(t,i,e,r){for(const o of e)if(o.valueExpressionInfo){const l=i[o.primitiveName]&&i[o.primitiveName][o.propertyName];l instanceof V&&(o.fn=(a,n,s)=>Z(l,a,{$view:s},r.geometryType,n))}return(o,l,a)=>{for(const n of e)n.fn&&(n.value=n.fn(o,l,a));return P(t+U.buildOverrideKey(e)).toString()}}function Pe(t,i){if(!i||i.length===0)return t;const e=JSON.parse(JSON.stringify(t));return U.applyOverrides(e,i),e}function Y(t,i,e,r,o){let l=!1,a="";for(const n of t)n.primitiveName===i&&(n.value!==void 0?a+=`-${n.primitiveName}-${n.propertyName}-${JSON.stringify(n.value)}`:n.valueExpressionInfo&&(l=!0));return E(e)&&typeof e=="function"&&(l=!0),E(r)&&typeof r=="function"&&(l=!0),E(o)&&typeof o=="function"&&(l=!0),[l,a]}function kt(t,i,e){if(t&&i)switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return;for(const o of r)switch(Ne(o,i,e),o.type){case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMCharacterMarker":case"CIMPictureMarker":"url"in o&&o.url&&e.push(i.fetchResource(o.url,null));break;case"CIMVectorMarker":{const l=o.markerGraphics;if(!l)continue;for(const a of l)if(a){const n=a.symbol;n&&kt(n,i,e)}}}}}}const ve=t=>t&&t.length===2&&t[0].enable&&t[1].enable&&t[0].type==="CIMSolidStroke"&&t[1].type==="CIMSolidFill"&&!t[0].effects&&!t[1].effects;let B;function Ne(t,i,e){if(!(!t.effects||E(i.geometryEngine))){if(B)return void e.push(B);Yt(t.effects)&&(B=Et(),e.push(B),B.then(r=>i.geometryEngine=r))}}export{Me as Y,ke as a,gt as f,Tt as r,Pe as s};
