var wTe=Object.defineProperty;var xTe=(t,e,i)=>e in t?wTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var AF=(t,e,i)=>(xTe(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();function ty(){}function Foe(t){return t()}function CZ(){return Object.create(null)}function b3(t){t.forEach(Foe)}function XV(t){return typeof t=="function"}function zN(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function TTe(t){return Object.keys(t).length===0}function STe(t){return t&&XV(t.destroy)?t.destroy:ty}function Zo(t,e){t.appendChild(e)}function Mf(t,e,i){t.insertBefore(e,i||null)}function tp(t){t.parentNode&&t.parentNode.removeChild(t)}function CTe(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function Ya(t){return document.createElement(t)}function L2(t){return document.createTextNode(t)}function N1(){return L2(" ")}function koe(t,e,i,r){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i,r)}function pu(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function ETe(t){return Array.from(t.childNodes)}function YV(t,e){e=""+e,t.data!==e&&(t.data=e)}function EZ(t,e,i,r){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,r?"important":"")}let mP;function bA(t){mP=t}function ATe(){if(!mP)throw new Error("Function called outside component initialization");return mP}function Uoe(t){ATe().$$.on_mount.push(t)}const $x=[],s8=[];let D2=[];const AZ=[],PTe=Promise.resolve();let o8=!1;function OTe(){o8||(o8=!0,PTe.then(zoe))}function a8(t){D2.push(t)}const PF=new Set;let xw=0;function zoe(){if(xw!==0)return;const t=mP;do{try{for(;xw<$x.length;){const e=$x[xw];xw++,bA(e),RTe(e.$$)}}catch(e){throw $x.length=0,xw=0,e}for(bA(null),$x.length=0,xw=0;s8.length;)s8.pop()();for(let e=0;e<D2.length;e+=1){const i=D2[e];PF.has(i)||(PF.add(i),i())}D2.length=0}while($x.length);for(;AZ.length;)AZ.pop()();o8=!1,PF.clear(),bA(t)}function RTe(t){if(t.fragment!==null){t.update(),b3(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(a8)}}function MTe(t){const e=[],i=[];D2.forEach(r=>t.indexOf(r)===-1?e.push(r):i.push(r)),i.forEach(r=>r()),D2=e}const z$=new Set;let A1;function Boe(){A1={r:0,c:[],p:A1}}function Voe(){A1.r||b3(A1.c),A1=A1.p}function pg(t,e){t&&t.i&&(z$.delete(t),t.i(e))}function Q1(t,e,i,r){if(t&&t.o){if(z$.has(t))return;z$.add(t),A1.c.push(()=>{z$.delete(t),r&&(i&&t.d(1),r())}),t.o(e)}else r&&r()}function PZ(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function JV(t){t&&t.c()}function BN(t,e,i){const{fragment:r,after_update:n}=t.$$;r&&r.m(e,i),a8(()=>{const s=t.$$.on_mount.map(Foe).filter(XV);t.$$.on_destroy?t.$$.on_destroy.push(...s):b3(s),t.$$.on_mount=[]}),n.forEach(a8)}function VN(t,e){const i=t.$$;i.fragment!==null&&(MTe(i.after_update),b3(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function $Te(t,e){t.$$.dirty[0]===-1&&($x.push(t),OTe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function GN(t,e,i,r,n,s,o,a=[-1]){const l=mP;bA(t);const c=t.$$={fragment:null,ctx:[],props:s,update:ty,not_equal:n,bound:CZ(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:CZ(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(p,f,...y)=>{const v=y.length?y[0]:f;return c.ctx&&n(c.ctx[p],c.ctx[p]=v)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](v),u&&$Te(t,p)),f}):[],c.update(),u=!0,b3(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){const p=ETe(e.target);c.fragment&&c.fragment.l(p),p.forEach(tp)}else c.fragment&&c.fragment.c();e.intro&&pg(t.$$.fragment),BN(t,e.target,e.anchor),zoe()}bA(l)}class jN{constructor(){AF(this,"$$");AF(this,"$$set")}$destroy(){VN(this,1),this.$destroy=ty}$on(e,i){if(!XV(i))return ty;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(i),()=>{const n=r.indexOf(i);n!==-1&&r.splice(n,1)}}$set(e){this.$$set&&!TTe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ITe="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ITe);const LTe=t=>{for(let e=t.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[t[e],t[i]]=[t[i],t[e]]}};var Dm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function DTe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Goe={exports:{}};/*!
* sweetalert2 v11.7.12
* Released under the MIT License.
*/(function(t,e){(function(i,r){t.exports=r()})(Dm,function(){const r={},n=()=>{r.previousActiveElement instanceof HTMLElement?(r.previousActiveElement.focus(),r.previousActiveElement=null):document.body&&document.body.focus()},s=A=>new Promise(O=>{if(!A)return O();const F=window.scrollX,te=window.scrollY;r.restoreFocusTimeout=setTimeout(()=>{n(),O()},100),window.scrollTo(F,te)});var o={promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const a="swal2-",c=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"].reduce((A,O)=>(A[O]=a+O,A),{}),p=["success","warning","info","question","error"].reduce((A,O)=>(A[O]=a+O,A),{}),f="SweetAlert2:",y=A=>A.charAt(0).toUpperCase()+A.slice(1),v=A=>{console.warn(`${f} ${typeof A=="object"?A.join(" "):A}`)},b=A=>{console.error(`${f} ${A}`)},x=[],S=A=>{x.includes(A)||(x.push(A),v(A))},P=(A,O)=>{S(`"${A}" is deprecated and will be removed in the next major release. Please use "${O}" instead.`)},C=A=>typeof A=="function"?A():A,R=A=>A&&typeof A.toPromise=="function",N=A=>R(A)?A.toPromise():Promise.resolve(A),$=A=>A&&Promise.resolve(A)===A,k=()=>document.body.querySelector(`.${c.container}`),B=A=>{const O=k();return O?O.querySelector(A):null},W=A=>B(`.${A}`),Z=()=>W(c.popup),K=()=>W(c.icon),X=()=>W(c["icon-content"]),ae=()=>W(c.title),re=()=>W(c["html-container"]),ee=()=>W(c.image),oe=()=>W(c["progress-steps"]),U=()=>W(c["validation-message"]),V=()=>B(`.${c.actions} .${c.confirm}`),H=()=>B(`.${c.actions} .${c.cancel}`),Y=()=>B(`.${c.actions} .${c.deny}`),ie=()=>W(c["input-label"]),le=()=>B(`.${c.loader}`),ue=()=>W(c.actions),ve=()=>W(c.footer),Ie=()=>W(c["timer-progress-bar"]),Ve=()=>W(c.close),Mt=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,ot=()=>{const A=Z().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),O=Array.from(A).sort((Ae,Yt)=>{const $r=parseInt(Ae.getAttribute("tabindex")),ys=parseInt(Yt.getAttribute("tabindex"));return $r>ys?1:$r<ys?-1:0}),F=Z().querySelectorAll(Mt),te=Array.from(F).filter(Ae=>Ae.getAttribute("tabindex")!=="-1");return[...new Set(O.concat(te))].filter(Ae=>$t(Ae))},Pt=()=>ht(document.body,c.shown)&&!ht(document.body,c["toast-shown"])&&!ht(document.body,c["no-backdrop"]),qe=()=>Z()&&ht(Z(),c.toast),Ee=()=>Z().hasAttribute("data-loading"),at=(A,O)=>{if(A.textContent="",O){const te=new DOMParser().parseFromString(O,"text/html");Array.from(te.querySelector("head").childNodes).forEach(Ae=>{A.appendChild(Ae)}),Array.from(te.querySelector("body").childNodes).forEach(Ae=>{Ae instanceof HTMLVideoElement||Ae instanceof HTMLAudioElement?A.appendChild(Ae.cloneNode(!0)):A.appendChild(Ae)})}},ht=(A,O)=>{if(!O)return!1;const F=O.split(/\s+/);for(let te=0;te<F.length;te++)if(!A.classList.contains(F[te]))return!1;return!0},Ue=(A,O)=>{Array.from(A.classList).forEach(F=>{!Object.values(c).includes(F)&&!Object.values(p).includes(F)&&!Object.values(O.showClass).includes(F)&&A.classList.remove(F)})},He=(A,O,F)=>{if(Ue(A,O),O.customClass&&O.customClass[F]){if(typeof O.customClass[F]!="string"&&!O.customClass[F].forEach){v(`Invalid type of customClass.${F}! Expected string or iterable object, got "${typeof O.customClass[F]}"`);return}lt(A,O.customClass[F])}},rt=(A,O)=>{if(!O)return null;switch(O){case"select":case"textarea":case"file":return A.querySelector(`.${c.popup} > .${c[O]}`);case"checkbox":return A.querySelector(`.${c.popup} > .${c.checkbox} input`);case"radio":return A.querySelector(`.${c.popup} > .${c.radio} input:checked`)||A.querySelector(`.${c.popup} > .${c.radio} input:first-child`);case"range":return A.querySelector(`.${c.popup} > .${c.range} input`);default:return A.querySelector(`.${c.popup} > .${c.input}`)}},wt=A=>{if(A.focus(),A.type!=="file"){const O=A.value;A.value="",A.value=O}},_t=(A,O,F)=>{!A||!O||(typeof O=="string"&&(O=O.split(/\s+/).filter(Boolean)),O.forEach(te=>{Array.isArray(A)?A.forEach(Ae=>{F?Ae.classList.add(te):Ae.classList.remove(te)}):F?A.classList.add(te):A.classList.remove(te)}))},lt=(A,O)=>{_t(A,O,!0)},Xe=(A,O)=>{_t(A,O,!1)},ct=(A,O)=>{const F=Array.from(A.children);for(let te=0;te<F.length;te++){const Ae=F[te];if(Ae instanceof HTMLElement&&ht(Ae,O))return Ae}},ti=(A,O,F)=>{F===`${parseInt(F)}`&&(F=parseInt(F)),F||parseInt(F)===0?A.style[O]=typeof F=="number"?`${F}px`:F:A.style.removeProperty(O)},Ze=function(A){let O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"flex";A&&(A.style.display=O)},tt=A=>{A&&(A.style.display="none")},Ot=(A,O,F,te)=>{const Ae=A.querySelector(O);Ae&&(Ae.style[F]=te)},kt=function(A,O){let F=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"flex";O?Ze(A,F):tt(A)},$t=A=>!!(A&&(A.offsetWidth||A.offsetHeight||A.getClientRects().length)),cr=()=>!$t(V())&&!$t(Y())&&!$t(H()),ji=A=>A.scrollHeight>A.clientHeight,er=A=>{const O=window.getComputedStyle(A),F=parseFloat(O.getPropertyValue("animation-duration")||"0"),te=parseFloat(O.getPropertyValue("transition-duration")||"0");return F>0||te>0},Vt=function(A){let O=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const F=Ie();$t(F)&&(O&&(F.style.transition="none",F.style.width="100%"),setTimeout(()=>{F.style.transition=`width ${A/1e3}s linear`,F.style.width="0%"},10))},sr=()=>{const A=Ie(),O=parseInt(window.getComputedStyle(A).width);A.style.removeProperty("transition"),A.style.width="100%";const F=parseInt(window.getComputedStyle(A).width),te=O/F*100;A.style.width=`${te}%`},Mi=()=>typeof window>"u"||typeof document>"u",Hi=`
 <div aria-labelledby="${c.title}" aria-describedby="${c["html-container"]}" class="${c.popup}" tabindex="-1">
   <button type="button" class="${c.close}"></button>
   <ul class="${c["progress-steps"]}"></ul>
   <div class="${c.icon}"></div>
   <img class="${c.image}" />
   <h2 class="${c.title}" id="${c.title}"></h2>
   <div class="${c["html-container"]}" id="${c["html-container"]}"></div>
   <input class="${c.input}" />
   <input type="file" class="${c.file}" />
   <div class="${c.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${c.select}"></select>
   <div class="${c.radio}"></div>
   <label for="${c.checkbox}" class="${c.checkbox}">
     <input type="checkbox" />
     <span class="${c.label}"></span>
   </label>
   <textarea class="${c.textarea}"></textarea>
   <div class="${c["validation-message"]}" id="${c["validation-message"]}"></div>
   <div class="${c.actions}">
     <div class="${c.loader}"></div>
     <button type="button" class="${c.confirm}"></button>
     <button type="button" class="${c.deny}"></button>
     <button type="button" class="${c.cancel}"></button>
   </div>
   <div class="${c.footer}"></div>
   <div class="${c["timer-progress-bar-container"]}">
     <div class="${c["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),Ei=()=>{const A=k();return A?(A.remove(),Xe([document.documentElement,document.body],[c["no-backdrop"],c["toast-shown"],c["has-column"]]),!0):!1},ki=()=>{r.currentInstance.resetValidationMessage()},Ai=()=>{const A=Z(),O=ct(A,c.input),F=ct(A,c.file),te=A.querySelector(`.${c.range} input`),Ae=A.querySelector(`.${c.range} output`),Yt=ct(A,c.select),$r=A.querySelector(`.${c.checkbox} input`),ys=ct(A,c.textarea);O.oninput=ki,F.onchange=ki,Yt.onchange=ki,$r.onchange=ki,ys.oninput=ki,te.oninput=()=>{ki(),Ae.value=te.value},te.onchange=()=>{ki(),Ae.value=te.value}},or=A=>typeof A=="string"?document.querySelector(A):A,tr=A=>{const O=Z();O.setAttribute("role",A.toast?"alert":"dialog"),O.setAttribute("aria-live",A.toast?"polite":"assertive"),A.toast||O.setAttribute("aria-modal","true")},_i=A=>{window.getComputedStyle(A).direction==="rtl"&&lt(k(),c.rtl)},ir=A=>{const O=Ei();if(Mi()){b("SweetAlert2 requires document to initialize");return}const F=document.createElement("div");F.className=c.container,O&&lt(F,c["no-transition"]),at(F,Hi);const te=or(A.target);te.appendChild(F),tr(A),_i(te),Ai()},ur=(A,O)=>{A instanceof HTMLElement?O.appendChild(A):typeof A=="object"?as(A,O):A&&at(O,A)},as=(A,O)=>{A.jquery?ls(O,A):at(O,A.toString())},ls=(A,O)=>{if(A.textContent="",0 in O)for(let F=0;F in O;F++)A.appendChild(O[F].cloneNode(!0));else A.appendChild(O.cloneNode(!0))},yn=(()=>{if(Mi())return!1;const A=document.createElement("div"),O={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const F in O)if(Object.prototype.hasOwnProperty.call(O,F)&&typeof A.style[F]<"u")return O[F];return!1})(),cs=(A,O)=>{const F=ue(),te=le();!O.showConfirmButton&&!O.showDenyButton&&!O.showCancelButton?tt(F):Ze(F),He(F,O,"actions"),kr(F,te,O),at(te,O.loaderHtml),He(te,O,"loader")};function kr(A,O,F){const te=V(),Ae=Y(),Yt=H();$i(te,"confirm",F),$i(Ae,"deny",F),$i(Yt,"cancel",F),Rr(te,Ae,Yt,F),F.reverseButtons&&(F.toast?(A.insertBefore(Yt,te),A.insertBefore(Ae,te)):(A.insertBefore(Yt,O),A.insertBefore(Ae,O),A.insertBefore(te,O)))}function Rr(A,O,F,te){if(!te.buttonsStyling){Xe([A,O,F],c.styled);return}lt([A,O,F],c.styled),te.confirmButtonColor&&(A.style.backgroundColor=te.confirmButtonColor,lt(A,c["default-outline"])),te.denyButtonColor&&(O.style.backgroundColor=te.denyButtonColor,lt(O,c["default-outline"])),te.cancelButtonColor&&(F.style.backgroundColor=te.cancelButtonColor,lt(F,c["default-outline"]))}function $i(A,O,F){kt(A,F[`show${y(O)}Button`],"inline-block"),at(A,F[`${O}ButtonText`]),A.setAttribute("aria-label",F[`${O}ButtonAriaLabel`]),A.className=c[O],He(A,F,`${O}Button`),lt(A,F[`${O}ButtonClass`])}const es=(A,O)=>{const F=Ve();F&&(at(F,O.closeButtonHtml||""),He(F,O,"closeButton"),kt(F,O.showCloseButton),F.setAttribute("aria-label",O.closeButtonAriaLabel||""))},_s=(A,O)=>{const F=k();F&&(Zs(F,O.backdrop),de(F,O.position),Pi(F,O.grow),He(F,O,"container"))};function Zs(A,O){typeof O=="string"?A.style.background=O:O||lt([document.documentElement,document.body],c["no-backdrop"])}function de(A,O){O in c?lt(A,c[O]):(v('The "position" parameter is not valid, defaulting to "center"'),lt(A,c.center))}function Pi(A,O){if(O&&typeof O=="string"){const F=`grow-${O}`;F in c&&lt(A,c[F])}}const Tt=["input","file","range","select","radio","checkbox","textarea"],Un=(A,O)=>{const F=Z(),te=o.innerParams.get(A),Ae=!te||O.input!==te.input;Tt.forEach(Yt=>{const $r=ct(F,c[Yt]);_o(Yt,O.inputAttributes),$r.className=c[Yt],Ae&&tt($r)}),O.input&&(Ae&&Ra(O),Rn(O))},Ra=A=>{if(!ts[A.input]){b(`Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "${A.input}"`);return}const O=Ls(A.input),F=ts[A.input](O,A);Ze(O),A.inputAutoFocus&&setTimeout(()=>{wt(F)})},ut=A=>{for(let O=0;O<A.attributes.length;O++){const F=A.attributes[O].name;["type","value","style"].includes(F)||A.removeAttribute(F)}},_o=(A,O)=>{const F=rt(Z(),A);if(F){ut(F);for(const te in O)F.setAttribute(te,O[te])}},Rn=A=>{const O=Ls(A.input);typeof A.customClass=="object"&&lt(O,A.customClass.input)},kl=(A,O)=>{(!A.placeholder||O.inputPlaceholder)&&(A.placeholder=O.inputPlaceholder)},Xs=(A,O,F)=>{if(F.inputLabel){A.id=c.input;const te=document.createElement("label"),Ae=c["input-label"];te.setAttribute("for",A.id),te.className=Ae,typeof F.customClass=="object"&&lt(te,F.customClass.inputLabel),te.innerText=F.inputLabel,O.insertAdjacentElement("beforebegin",te)}},Ls=A=>ct(Z(),c[A]||c.input),Ma=(A,O)=>{["string","number"].includes(typeof O)?A.value=`${O}`:$(O)||v(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof O}"`)},ts={};ts.text=ts.email=ts.password=ts.number=ts.tel=ts.url=(A,O)=>(Ma(A,O.inputValue),Xs(A,A,O),kl(A,O),A.type=O.input,A),ts.file=(A,O)=>(Xs(A,A,O),kl(A,O),A),ts.range=(A,O)=>{const F=A.querySelector("input"),te=A.querySelector("output");return Ma(F,O.inputValue),F.type=O.input,Ma(te,O.inputValue),Xs(F,A,O),A},ts.select=(A,O)=>{if(A.textContent="",O.inputPlaceholder){const F=document.createElement("option");at(F,O.inputPlaceholder),F.value="",F.disabled=!0,F.selected=!0,A.appendChild(F)}return Xs(A,A,O),A},ts.radio=A=>(A.textContent="",A),ts.checkbox=(A,O)=>{const F=rt(Z(),"checkbox");F.value="1",F.id=c.checkbox,F.checked=!!O.inputValue;const te=A.querySelector("span");return at(te,O.inputPlaceholder),F},ts.textarea=(A,O)=>{Ma(A,O.inputValue),kl(A,O),Xs(A,A,O);const F=te=>parseInt(window.getComputedStyle(te).marginLeft)+parseInt(window.getComputedStyle(te).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const te=parseInt(window.getComputedStyle(Z()).width),Ae=()=>{const Yt=A.offsetWidth+F(A);Yt>te?Z().style.width=`${Yt}px`:Z().style.width=null};new MutationObserver(Ae).observe(A,{attributes:!0,attributeFilter:["style"]})}}),A};const ii=(A,O)=>{const F=re();F&&(He(F,O,"htmlContainer"),O.html?(ur(O.html,F),Ze(F,"block")):O.text?(F.textContent=O.text,Ze(F,"block")):tt(F),Un(A,O))},Mu=(A,O)=>{const F=ve();F&&(kt(F,O.footer),O.footer&&ur(O.footer,F),He(F,O,"footer"))},Ul=(A,O)=>{const F=o.innerParams.get(A),te=K();if(F&&O.icon===F.icon){zn(te,O),Oc(te,O);return}if(!O.icon&&!O.iconHtml){tt(te);return}if(O.icon&&Object.keys(p).indexOf(O.icon)===-1){b(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${O.icon}"`),tt(te);return}Ze(te),zn(te,O),Oc(te,O),lt(te,O.showClass.icon)},Oc=(A,O)=>{for(const F in p)O.icon!==F&&Xe(A,p[F]);lt(A,p[O.icon]),jr(A,O),us(),He(A,O,"icon")},us=()=>{const A=Z(),O=window.getComputedStyle(A).getPropertyValue("background-color"),F=A.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let te=0;te<F.length;te++)F[te].style.backgroundColor=O},Uo=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,zl=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,zn=(A,O)=>{let F=A.innerHTML,te;O.iconHtml?te=Rc(O.iconHtml):O.icon==="success"?(te=Uo,F=F.replace(/ style=".*?"/g,"")):O.icon==="error"?te=zl:te=Rc({question:"?",warning:"!",info:"i"}[O.icon]),F.trim()!==te.trim()&&at(A,te)},jr=(A,O)=>{if(O.iconColor){A.style.color=O.iconColor,A.style.borderColor=O.iconColor;for(const F of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Ot(A,F,"backgroundColor",O.iconColor);Ot(A,".swal2-success-ring","borderColor",O.iconColor)}},Rc=A=>`<div class="${c["icon-content"]}">${A}</div>`,Mc=(A,O)=>{const F=ee();if(F){if(!O.imageUrl){tt(F);return}Ze(F,""),F.setAttribute("src",O.imageUrl),F.setAttribute("alt",O.imageAlt||""),ti(F,"width",O.imageWidth),ti(F,"height",O.imageHeight),F.className=c.image,He(F,O,"image")}},ll=(A,O)=>{const F=k(),te=Z();if(!(!F||!te)){if(O.toast){ti(F,"width",O.width),te.style.width="100%";const Ae=le();Ae&&te.insertBefore(Ae,K())}else ti(te,"width",O.width);ti(te,"padding",O.padding),O.color&&(te.style.color=O.color),O.background&&(te.style.background=O.background),tt(U()),ed(te,O)}},ed=(A,O)=>{const F=O.showClass||{};A.className=`${c.popup} ${$t(A)?F.popup:""}`,O.toast?(lt([document.documentElement,document.body],c["toast-shown"]),lt(A,c.toast)):lt(A,c.modal),He(A,O,"popup"),typeof O.customClass=="string"&&lt(A,O.customClass),O.icon&&lt(A,c[`icon-${O.icon}`])},$u=(A,O)=>{const F=oe();if(!F)return;const{progressSteps:te,currentProgressStep:Ae}=O;if(!te||te.length===0||Ae===void 0){tt(F);return}Ze(F),F.textContent="",Ae>=te.length&&v("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),te.forEach((Yt,$r)=>{const ys=$a(Yt);if(F.appendChild(ys),$r===Ae&&lt(ys,c["active-progress-step"]),$r!==te.length-1){const Ys=Zi(O);F.appendChild(Ys)}})},$a=A=>{const O=document.createElement("li");return lt(O,c["progress-step"]),at(O,A),O},Zi=A=>{const O=document.createElement("li");return lt(O,c["progress-step-line"]),A.progressStepsDistance&&ti(O,"width",A.progressStepsDistance),O},Ui=(A,O)=>{const F=ae();F&&(kt(F,O.title||O.titleText,"block"),O.title&&ur(O.title,F),O.titleText&&(F.innerText=O.titleText),He(F,O,"title"))},$c=(A,O)=>{ll(A,O),_s(A,O),$u(A,O),Ul(A,O),Mc(A,O),Ui(A,O),es(A,O),ii(A,O),cs(A,O),Mu(A,O);const F=Z();typeof O.didRender=="function"&&F&&O.didRender(F)},Bl=()=>$t(Z()),Q=()=>V()&&V().click(),Se=()=>Y()&&Y().click(),be=()=>H()&&H().click(),yt=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Xr=A=>{A.keydownTarget&&A.keydownHandlerAdded&&(A.keydownTarget.removeEventListener("keydown",A.keydownHandler,{capture:A.keydownListenerCapture}),A.keydownHandlerAdded=!1)},Xi=(A,O,F,te)=>{Xr(O),F.toast||(O.keydownHandler=Ae=>Lu(A,Ae,te),O.keydownTarget=F.keydownListenerCapture?window:Z(),O.keydownListenerCapture=F.keydownListenerCapture,O.keydownTarget.addEventListener("keydown",O.keydownHandler,{capture:O.keydownListenerCapture}),O.keydownHandlerAdded=!0)},Mr=(A,O)=>{const F=ot();if(F.length){A=A+O,A===F.length?A=0:A===-1&&(A=F.length-1),F[A].focus();return}Z().focus()},Iu=["ArrowRight","ArrowDown"],um=["ArrowLeft","ArrowUp"],Lu=(A,O,F)=>{const te=o.innerParams.get(A);te&&(O.isComposing||O.keyCode===229||(te.stopKeydownPropagation&&O.stopPropagation(),O.key==="Enter"?Mn(A,O,te):O.key==="Tab"?hm(O):[...Iu,...um].includes(O.key)?Fy(O.key):O.key==="Escape"&&ky(O,te,F)))},Mn=(A,O,F)=>{if(C(F.allowEnterKey)&&O.target&&A.getInput()&&O.target instanceof HTMLElement&&O.target.outerHTML===A.getInput().outerHTML){if(["textarea","file"].includes(F.input))return;Q(),O.preventDefault()}},hm=A=>{const O=A.target,F=ot();let te=-1;for(let Ae=0;Ae<F.length;Ae++)if(O===F[Ae]){te=Ae;break}A.shiftKey?Mr(te,-1):Mr(te,1),A.stopPropagation(),A.preventDefault()},Fy=A=>{const O=V(),F=Y(),te=H(),Ae=[O,F,te];if(document.activeElement instanceof HTMLElement&&!Ae.includes(document.activeElement))return;const Yt=Iu.includes(A)?"nextElementSibling":"previousElementSibling";let $r=document.activeElement;for(let ys=0;ys<ue().children.length;ys++){if($r=$r[Yt],!$r)return;if($r instanceof HTMLButtonElement&&$t($r))break}$r instanceof HTMLButtonElement&&$r.focus()},ky=(A,O,F)=>{C(O.allowEscapeKey)&&(A.preventDefault(),F(yt.esc))};var dm={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Uy=()=>{Array.from(document.body.children).forEach(O=>{O===k()||O.contains(k())||(O.hasAttribute("aria-hidden")&&O.setAttribute("data-previous-aria-hidden",O.getAttribute("aria-hidden")||""),O.setAttribute("aria-hidden","true"))})},tw=()=>{Array.from(document.body.children).forEach(O=>{O.hasAttribute("data-previous-aria-hidden")?(O.setAttribute("aria-hidden",O.getAttribute("data-previous-aria-hidden")||""),O.removeAttribute("data-previous-aria-hidden")):O.removeAttribute("aria-hidden")})},MS=()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!ht(document.body,c.iosfix)){const O=document.body.scrollTop;document.body.style.top=`${O*-1}px`,lt(document.body,c.iosfix),$S(),iw()}},iw=()=>{const A=navigator.userAgent,O=!!A.match(/iPad/i)||!!A.match(/iPhone/i),F=!!A.match(/WebKit/i);O&&F&&!A.match(/CriOS/i)&&Z().scrollHeight>window.innerHeight-44&&(k().style.paddingBottom="44px")},$S=()=>{const A=k();let O;A.ontouchstart=F=>{O=IS(F)},A.ontouchmove=F=>{O&&(F.preventDefault(),F.stopPropagation())}},IS=A=>{const O=A.target,F=k();return rw(A)||xO(A)?!1:O===F||!ji(F)&&O instanceof HTMLElement&&O.tagName!=="INPUT"&&O.tagName!=="TEXTAREA"&&!(ji(re())&&re().contains(O))},rw=A=>A.touches&&A.touches.length&&A.touches[0].touchType==="stylus",xO=A=>A.touches&&A.touches.length>1,LS=()=>{if(ht(document.body,c.iosfix)){const A=parseInt(document.body.style.top,10);Xe(document.body,c.iosfix),document.body.style.top="",document.body.scrollTop=A*-1}},aF=()=>{const A=document.createElement("div");A.className=c["scrollbar-measure"],document.body.appendChild(A);const O=A.getBoundingClientRect().width-A.clientWidth;return document.body.removeChild(A),O};let ci=null;const Du=()=>{ci===null&&document.body.scrollHeight>window.innerHeight&&(ci=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${ci+aF()}px`)},cn=()=>{ci!==null&&(document.body.style.paddingRight=`${ci}px`,ci=null)};function DS(A,O,F,te){qe()?kS(A,te):(s(F).then(()=>kS(A,te)),Xr(r)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(O.setAttribute("style","display:none !important"),O.removeAttribute("class"),O.innerHTML=""):O.remove(),Pt()&&(cn(),LS(),tw()),NS()}function NS(){Xe([document.documentElement,document.body],[c.shown,c["height-auto"],c["no-backdrop"],c["toast-shown"]])}function Nu(A){A=zy(A);const O=dm.swalPromiseResolve.get(this),F=FS(this);this.isAwaitingPromise?A.isDismissed||(pm(this),O(A)):F&&O(A)}const FS=A=>{const O=Z();if(!O)return!1;const F=o.innerParams.get(A);if(!F||ht(O,F.hideClass.popup))return!1;Xe(O,F.showClass.popup),lt(O,F.hideClass.popup);const te=k();return Xe(te,F.showClass.backdrop),lt(te,F.hideClass.backdrop),yo(A,O,F),!0};function Tp(A){const O=dm.swalPromiseReject.get(this);pm(this),O&&O(A)}const pm=A=>{A.isAwaitingPromise&&(delete A.isAwaitingPromise,o.innerParams.get(A)||A._destroy())},zy=A=>typeof A>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},A),yo=(A,O,F)=>{const te=k(),Ae=yn&&er(O);typeof F.willClose=="function"&&F.willClose(O),Ae?fm(A,O,te,F.returnFocus,F.didClose):DS(A,te,F.returnFocus,F.didClose)},fm=(A,O,F,te,Ae)=>{r.swalCloseEventFinishedCallback=DS.bind(null,A,F,te,Ae),O.addEventListener(yn,function(Yt){Yt.target===O&&(r.swalCloseEventFinishedCallback(),delete r.swalCloseEventFinishedCallback)})},kS=(A,O)=>{setTimeout(()=>{typeof O=="function"&&O.bind(A.params)(),A._destroy&&A._destroy()})},mm=A=>{let O=Z();O||new bw,O=Z();const F=le();qe()?tt(K()):lF(O,A),Ze(F),O.setAttribute("data-loading","true"),O.setAttribute("aria-busy","true"),O.focus()},lF=(A,O)=>{const F=ue(),te=le();!O&&$t(V())&&(O=V()),Ze(F),O&&(tt(O),te.setAttribute("data-button-to-replace",O.className)),te.parentNode.insertBefore(te,O),lt([A,F],c.loading)},TO=(A,O)=>{O.input==="select"||O.input==="radio"?uF(A,O):["text","email","number","tel","textarea"].includes(O.input)&&(R(O.inputValue)||$(O.inputValue))&&(mm(V()),Ic(A,O))},US=(A,O)=>{const F=A.getInput();if(!F)return null;switch(O.input){case"checkbox":return cF(F);case"radio":return SO(F);case"file":return hr(F);default:return O.inputAutoTrim?F.value.trim():F.value}},cF=A=>A.checked?1:0,SO=A=>A.checked?A.value:null,hr=A=>A.files.length?A.getAttribute("multiple")!==null?A.files:A.files[0]:null,uF=(A,O)=>{const F=Z(),te=Ae=>{By[O.input](F,nw(Ae),O)};R(O.inputOptions)||$(O.inputOptions)?(mm(V()),N(O.inputOptions).then(Ae=>{A.hideLoading(),te(Ae)})):typeof O.inputOptions=="object"?te(O.inputOptions):b(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof O.inputOptions}`)},Ic=(A,O)=>{const F=A.getInput();tt(F),N(O.inputValue).then(te=>{F.value=O.input==="number"?`${parseFloat(te)||0}`:`${te}`,Ze(F),F.focus(),A.hideLoading()}).catch(te=>{b(`Error in inputValue promise: ${te}`),F.value="",Ze(F),F.focus(),A.hideLoading()})},By={select:(A,O,F)=>{const te=ct(A,c.select),Ae=(Yt,$r,ys)=>{const Ys=document.createElement("option");Ys.value=ys,at(Ys,$r),Ys.selected=CO(ys,F.inputValue),Yt.appendChild(Ys)};O.forEach(Yt=>{const $r=Yt[0],ys=Yt[1];if(Array.isArray(ys)){const Ys=document.createElement("optgroup");Ys.label=$r,Ys.disabled=!1,te.appendChild(Ys),ys.forEach(_m=>Ae(Ys,_m[1],_m[0]))}else Ae(te,ys,$r)}),te.focus()},radio:(A,O,F)=>{const te=ct(A,c.radio);O.forEach(Yt=>{const $r=Yt[0],ys=Yt[1],Ys=document.createElement("input"),_m=document.createElement("label");Ys.type="radio",Ys.name=c.radio,Ys.value=$r,CO($r,F.inputValue)&&(Ys.checked=!0);const KS=document.createElement("span");at(KS,ys),KS.className=c.label,_m.appendChild(Ys),_m.appendChild(KS),te.appendChild(_m)});const Ae=te.querySelectorAll("input");Ae.length&&Ae[0].focus()}},nw=A=>{const O=[];return typeof Map<"u"&&A instanceof Map?A.forEach((F,te)=>{let Ae=F;typeof Ae=="object"&&(Ae=nw(Ae)),O.push([te,Ae])}):Object.keys(A).forEach(F=>{let te=A[F];typeof te=="object"&&(te=nw(te)),O.push([F,te])}),O},CO=(A,O)=>O&&O.toString()===A.toString(),zS=A=>{const O=o.innerParams.get(A);A.disableButtons(),O.input?AO(A,"confirm"):BS(A,!0)},hF=A=>{const O=o.innerParams.get(A);A.disableButtons(),O.returnInputValueOnDeny?AO(A,"deny"):Vy(A,!1)},EO=(A,O)=>{A.disableButtons(),O(yt.cancel)},AO=(A,O)=>{const F=o.innerParams.get(A);if(!F.input){b(`The "input" parameter is needed to be set when using returnInputValueOn${y(O)}`);return}const te=US(A,F);F.inputValidator?dF(A,te,O):A.getInput().checkValidity()?O==="deny"?Vy(A,te):BS(A,te):(A.enableButtons(),A.showValidationMessage(F.validationMessage))},dF=(A,O,F)=>{const te=o.innerParams.get(A);A.disableInput(),Promise.resolve().then(()=>N(te.inputValidator(O,te.validationMessage))).then(Yt=>{A.enableButtons(),A.enableInput(),Yt?A.showValidationMessage(Yt):F==="deny"?Vy(A,O):BS(A,O)})},Vy=(A,O)=>{const F=o.innerParams.get(A||void 0);F.showLoaderOnDeny&&mm(Y()),F.preDeny?(A.isAwaitingPromise=!0,Promise.resolve().then(()=>N(F.preDeny(O,F.validationMessage))).then(Ae=>{Ae===!1?(A.hideLoading(),pm(A)):A.close({isDenied:!0,value:typeof Ae>"u"?O:Ae})}).catch(Ae=>Lc(A||void 0,Ae))):A.close({isDenied:!0,value:O})},PO=(A,O)=>{A.close({isConfirmed:!0,value:O})},Lc=(A,O)=>{A.rejectPromise(O)},BS=(A,O)=>{const F=o.innerParams.get(A||void 0);F.showLoaderOnConfirm&&mm(),F.preConfirm?(A.resetValidationMessage(),A.isAwaitingPromise=!0,Promise.resolve().then(()=>N(F.preConfirm(O,F.validationMessage))).then(Ae=>{$t(U())||Ae===!1?(A.hideLoading(),pm(A)):PO(A,typeof Ae>"u"?O:Ae)}).catch(Ae=>Lc(A||void 0,Ae))):PO(A,O)};function Gy(){const A=o.innerParams.get(this);if(!A)return;const O=o.domCache.get(this);tt(O.loader),qe()?A.icon&&Ze(K()):Sp(O),Xe([O.popup,O.actions],c.loading),O.popup.removeAttribute("aria-busy"),O.popup.removeAttribute("data-loading"),O.confirmButton.disabled=!1,O.denyButton.disabled=!1,O.cancelButton.disabled=!1}const Sp=A=>{const O=A.popup.getElementsByClassName(A.loader.getAttribute("data-button-to-replace"));O.length?Ze(O[0],"inline-block"):cr()&&tt(A.actions)};function VS(){const A=o.innerParams.get(this),O=o.domCache.get(this);return O?rt(O.popup,A.input):null}function GS(A,O,F){const te=o.domCache.get(A);O.forEach(Ae=>{te[Ae].disabled=F})}function sw(A,O){if(A)if(A.type==="radio"){const te=A.parentNode.parentNode.querySelectorAll("input");for(let Ae=0;Ae<te.length;Ae++)te[Ae].disabled=O}else A.disabled=O}function OO(){GS(this,["confirmButton","denyButton","cancelButton"],!1)}function jS(){GS(this,["confirmButton","denyButton","cancelButton"],!0)}function HS(){sw(this.getInput(),!1)}function RO(){sw(this.getInput(),!0)}function MO(A){const O=o.domCache.get(this),F=o.innerParams.get(this);at(O.validationMessage,A),O.validationMessage.className=c["validation-message"],F.customClass&&F.customClass.validationMessage&&lt(O.validationMessage,F.customClass.validationMessage),Ze(O.validationMessage);const te=this.getInput();te&&(te.setAttribute("aria-invalid",!0),te.setAttribute("aria-describedby",c["validation-message"]),wt(te),lt(te,c.inputerror))}function ow(){const A=o.domCache.get(this);A.validationMessage&&tt(A.validationMessage);const O=this.getInput();O&&(O.removeAttribute("aria-invalid"),O.removeAttribute("aria-describedby"),Xe(O,c.inputerror))}const t0={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},$O=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],IO={},aw=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Cp=A=>Object.prototype.hasOwnProperty.call(t0,A),LO=A=>$O.indexOf(A)!==-1,i0=A=>IO[A],Vl=A=>{Cp(A)||v(`Unknown parameter "${A}"`)},DO=A=>{aw.includes(A)&&v(`The parameter "${A}" is incompatible with toasts`)},NO=A=>{const O=i0(A);O&&P(A,O)},pF=A=>{A.backdrop===!1&&A.allowOutsideClick&&v('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const O in A)Vl(O),A.toast&&DO(O),NO(O)};function lw(A){const O=Z(),F=o.innerParams.get(this);if(!O||ht(O,F.hideClass.popup)){v("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}const te=WS(A),Ae=Object.assign({},F,te);$c(this,Ae),o.innerParams.set(this,Ae),Object.defineProperties(this,{params:{value:Object.assign({},this.params,A),writable:!1,enumerable:!0}})}const WS=A=>{const O={};return Object.keys(A).forEach(F=>{LO(F)?O[F]=A[F]:v(`Invalid parameter to update: ${F}`)}),O};function FO(){const A=o.domCache.get(this),O=o.innerParams.get(this);if(!O){qS(this);return}A.popup&&r.swalCloseEventFinishedCallback&&(r.swalCloseEventFinishedCallback(),delete r.swalCloseEventFinishedCallback),typeof O.didDestroy=="function"&&O.didDestroy(),fF(this)}const fF=A=>{qS(A),delete A.params,delete r.keydownHandler,delete r.keydownTarget,delete r.currentInstance},qS=A=>{A.isAwaitingPromise?(ZS(o,A),A.isAwaitingPromise=!0):(ZS(dm,A),ZS(o,A),delete A.isAwaitingPromise,delete A.disableButtons,delete A.enableButtons,delete A.getInput,delete A.disableInput,delete A.enableInput,delete A.hideLoading,delete A.disableLoading,delete A.showValidationMessage,delete A.resetValidationMessage,delete A.close,delete A.closePopup,delete A.closeModal,delete A.closeToast,delete A.rejectPromise,delete A.update,delete A._destroy)},ZS=(A,O)=>{for(const F in A)A[F].delete(O)};var Dc=Object.freeze({__proto__:null,_destroy:FO,close:Nu,closeModal:Nu,closePopup:Nu,closeToast:Nu,disableButtons:jS,disableInput:RO,disableLoading:Gy,enableButtons:OO,enableInput:HS,getInput:VS,handleAwaitingPromise:pm,hideLoading:Gy,rejectPromise:Tp,resetValidationMessage:ow,showValidationMessage:MO,update:lw});const r0=(A,O,F)=>{o.innerParams.get(A).toast?mF(A,O,F):(n0(O),gF(O),jy(A,O,F))},mF=(A,O,F)=>{O.popup.onclick=()=>{const te=o.innerParams.get(A);te&&(td(te)||te.timer||te.input)||F(yt.close)}},td=A=>A.showConfirmButton||A.showDenyButton||A.showCancelButton||A.showCloseButton;let cw=!1;const n0=A=>{A.popup.onmousedown=()=>{A.container.onmouseup=function(O){A.container.onmouseup=void 0,O.target===A.container&&(cw=!0)}}},gF=A=>{A.container.onmousedown=()=>{A.popup.onmouseup=function(O){A.popup.onmouseup=void 0,(O.target===A.popup||A.popup.contains(O.target))&&(cw=!0)}}},jy=(A,O,F)=>{O.container.onclick=te=>{const Ae=o.innerParams.get(A);if(cw){cw=!1;return}te.target===O.container&&C(Ae.allowOutsideClick)&&F(yt.backdrop)}},kO=A=>typeof A=="object"&&A.jquery,Hy=A=>A instanceof Element||kO(A),_F=A=>{const O={};return typeof A[0]=="object"&&!Hy(A[0])?Object.assign(O,A[0]):["title","html","icon"].forEach((F,te)=>{const Ae=A[te];typeof Ae=="string"||Hy(Ae)?O[F]=Ae:Ae!==void 0&&b(`Unexpected type of ${F}! Expected "string" or "Element", got ${typeof Ae}`)}),O};function Ep(){const A=this;for(var O=arguments.length,F=new Array(O),te=0;te<O;te++)F[te]=arguments[te];return new A(...F)}function uw(A){class O extends this{_main(te,Ae){return super._main(te,Object.assign({},A,Ae))}}return O}const yF=()=>r.timeout&&r.timeout.getTimerLeft(),hw=()=>{if(r.timeout)return sr(),r.timeout.stop()},UO=()=>{if(r.timeout){const A=r.timeout.start();return Vt(A),A}},id=()=>{const A=r.timeout;return A&&(A.running?hw():UO())},vF=A=>{if(r.timeout){const O=r.timeout.increase(A);return Vt(O,!0),O}},s0=()=>!!(r.timeout&&r.timeout.isRunning());let zO=!1;const Nc={};function dw(){let A=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"data-swal-template";Nc[A]=this,zO||(document.body.addEventListener("click",BO),zO=!0)}const BO=A=>{for(let O=A.target;O&&O!==document;O=O.parentNode)for(const F in Nc){const te=O.getAttribute(F);if(te){Nc[F].fire({template:te});return}}};var XS=Object.freeze({__proto__:null,argsToParams:_F,bindClickHandler:dw,clickCancel:be,clickConfirm:Q,clickDeny:Se,enableLoading:mm,fire:Ep,getActions:ue,getCancelButton:H,getCloseButton:Ve,getConfirmButton:V,getContainer:k,getDenyButton:Y,getFocusableElements:ot,getFooter:ve,getHtmlContainer:re,getIcon:K,getIconContent:X,getImage:ee,getInputLabel:ie,getLoader:le,getPopup:Z,getProgressSteps:oe,getTimerLeft:yF,getTimerProgressBar:Ie,getTitle:ae,getValidationMessage:U,increaseTimer:vF,isDeprecatedParameter:i0,isLoading:Ee,isTimerRunning:s0,isUpdatableParameter:LO,isValidParameter:Cp,isVisible:Bl,mixin:uw,resumeTimer:UO,showLoading:mm,stopTimer:hw,toggleTimer:id});class pw{constructor(O,F){this.callback=O,this.remaining=F,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(O){const F=this.running;return F&&this.stop(),this.remaining+=O,F&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const fw=["swal-title","swal-html","swal-footer"],mw=A=>{const O=typeof A.template=="string"?document.querySelector(A.template):A.template;if(!O)return{};const F=O.content;return GO(F),Object.assign(o0(F),gw(F),YS(F),VO(F),bF(F),_w(F),wF(F,fw))},o0=A=>{const O={};return Array.from(A.querySelectorAll("swal-param")).forEach(te=>{gm(te,["name","value"]);const Ae=te.getAttribute("name"),Yt=te.getAttribute("value");typeof t0[Ae]=="boolean"?O[Ae]=Yt!=="false":typeof t0[Ae]=="object"?O[Ae]=JSON.parse(Yt):O[Ae]=Yt}),O},gw=A=>{const O={};return Array.from(A.querySelectorAll("swal-function-param")).forEach(te=>{const Ae=te.getAttribute("name"),Yt=te.getAttribute("value");O[Ae]=new Function(`return ${Yt}`)()}),O},YS=A=>{const O={};return Array.from(A.querySelectorAll("swal-button")).forEach(te=>{gm(te,["type","color","aria-label"]);const Ae=te.getAttribute("type");O[`${Ae}ButtonText`]=te.innerHTML,O[`show${y(Ae)}Button`]=!0,te.hasAttribute("color")&&(O[`${Ae}ButtonColor`]=te.getAttribute("color")),te.hasAttribute("aria-label")&&(O[`${Ae}ButtonAriaLabel`]=te.getAttribute("aria-label"))}),O},VO=A=>{const O={},F=A.querySelector("swal-image");return F&&(gm(F,["src","width","height","alt"]),F.hasAttribute("src")&&(O.imageUrl=F.getAttribute("src")),F.hasAttribute("width")&&(O.imageWidth=F.getAttribute("width")),F.hasAttribute("height")&&(O.imageHeight=F.getAttribute("height")),F.hasAttribute("alt")&&(O.imageAlt=F.getAttribute("alt"))),O},bF=A=>{const O={},F=A.querySelector("swal-icon");return F&&(gm(F,["type","color"]),F.hasAttribute("type")&&(O.icon=F.getAttribute("type")),F.hasAttribute("color")&&(O.iconColor=F.getAttribute("color")),O.iconHtml=F.innerHTML),O},_w=A=>{const O={},F=A.querySelector("swal-input");F&&(gm(F,["type","label","placeholder","value"]),O.input=F.getAttribute("type")||"text",F.hasAttribute("label")&&(O.inputLabel=F.getAttribute("label")),F.hasAttribute("placeholder")&&(O.inputPlaceholder=F.getAttribute("placeholder")),F.hasAttribute("value")&&(O.inputValue=F.getAttribute("value")));const te=Array.from(A.querySelectorAll("swal-input-option"));return te.length&&(O.inputOptions={},te.forEach(Ae=>{gm(Ae,["value"]);const Yt=Ae.getAttribute("value"),$r=Ae.innerHTML;O.inputOptions[Yt]=$r})),O},wF=(A,O)=>{const F={};for(const te in O){const Ae=O[te],Yt=A.querySelector(Ae);Yt&&(gm(Yt,[]),F[Ae.replace(/^swal-/,"")]=Yt.innerHTML.trim())}return F},GO=A=>{const O=fw.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(A.children).forEach(F=>{const te=F.tagName.toLowerCase();O.includes(te)||v(`Unrecognized element <${te}>`)})},gm=(A,O)=>{Array.from(A.attributes).forEach(F=>{O.indexOf(F.name)===-1&&v([`Unrecognized attribute "${F.name}" on <${A.tagName.toLowerCase()}>.`,`${O.length?`Allowed attributes are: ${O.join(", ")}`:"To set the value, use HTML within the element."}`])})},JS=10,xF=A=>{const O=k(),F=Z();typeof A.willOpen=="function"&&A.willOpen(F);const Ae=window.getComputedStyle(document.body).overflowY;vw(O,F,A),setTimeout(()=>{yw(O,F)},JS),Pt()&&(TF(O,A.scrollbarPadding,Ae),Uy()),!qe()&&!r.previousActiveElement&&(r.previousActiveElement=document.activeElement),typeof A.didOpen=="function"&&setTimeout(()=>A.didOpen(F)),Xe(O,c["no-transition"])},Fc=A=>{const O=Z();if(A.target!==O)return;const F=k();O.removeEventListener(yn,Fc),F.style.overflowY="auto"},yw=(A,O)=>{yn&&er(O)?(A.style.overflowY="hidden",O.addEventListener(yn,Fc)):A.style.overflowY="auto"},TF=(A,O,F)=>{MS(),O&&F!=="hidden"&&Du(),setTimeout(()=>{A.scrollTop=0})},vw=(A,O,F)=>{lt(A,F.showClass.backdrop),O.style.setProperty("opacity","0","important"),Ze(O,"grid"),setTimeout(()=>{lt(O,F.showClass.popup),O.style.removeProperty("opacity")},JS),lt([document.documentElement,document.body],c.shown),F.heightAuto&&F.backdrop&&!F.toast&&lt([document.documentElement,document.body],c["height-auto"])};var jO={email:(A,O)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(A)?Promise.resolve():Promise.resolve(O||"Invalid email address"),url:(A,O)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(A)?Promise.resolve():Promise.resolve(O||"Invalid URL")};function HO(A){A.inputValidator||Object.keys(jO).forEach(O=>{A.input===O&&(A.inputValidator=jO[O])})}function SF(A){(!A.target||typeof A.target=="string"&&!document.querySelector(A.target)||typeof A.target!="string"&&!A.target.appendChild)&&(v('Target parameter is not valid, defaulting to "body"'),A.target="body")}function Wy(A){HO(A),A.showLoaderOnConfirm&&!A.preConfirm&&v(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),SF(A),typeof A.title=="string"&&(A.title=A.title.split(`
`).join("<br />")),ir(A)}let kc;class un{constructor(){if(typeof window>"u")return;kc=this;for(var O=arguments.length,F=new Array(O),te=0;te<O;te++)F[te]=arguments[te];const Ae=Object.freeze(this.constructor.argsToParams(F));this.params=Ae,this.isAwaitingPromise=!1;const Yt=kc._main(kc.params);o.promise.set(this,Yt)}_main(O){let F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};pF(Object.assign({},F,O)),r.currentInstance&&(r.currentInstance._destroy(),Pt()&&tw()),r.currentInstance=kc;const te=qO(O,F);Wy(te),Object.freeze(te),r.timeout&&(r.timeout.stop(),delete r.timeout),clearTimeout(r.restoreFocusTimeout);const Ae=CF(kc);return $c(kc,te),o.innerParams.set(kc,te),WO(kc,Ae,te)}then(O){return o.promise.get(this).then(O)}finally(O){return o.promise.get(this).finally(O)}}const WO=(A,O,F)=>new Promise((te,Ae)=>{const Yt=$r=>{A.close({isDismissed:!0,dismiss:$r})};dm.swalPromiseResolve.set(A,te),dm.swalPromiseReject.set(A,Ae),O.confirmButton.onclick=()=>{zS(A)},O.denyButton.onclick=()=>{hF(A)},O.cancelButton.onclick=()=>{EO(A,Yt)},O.closeButton.onclick=()=>{Yt(yt.close)},r0(A,O,Yt),Xi(A,r,F,Yt),TO(A,F),xF(F),rd(r,F,Yt),ZO(O,F),setTimeout(()=>{O.container.scrollTop=0})}),qO=(A,O)=>{const F=mw(A),te=Object.assign({},t0,O,F,A);return te.showClass=Object.assign({},t0.showClass,te.showClass),te.hideClass=Object.assign({},t0.hideClass,te.hideClass),te},CF=A=>{const O={popup:Z(),container:k(),actions:ue(),confirmButton:V(),denyButton:Y(),cancelButton:H(),loader:le(),closeButton:Ve(),validationMessage:U(),progressSteps:oe()};return o.domCache.set(A,O),O},rd=(A,O,F)=>{const te=Ie();tt(te),O.timer&&(A.timeout=new pw(()=>{F("timer"),delete A.timeout},O.timer),O.timerProgressBar&&(Ze(te),He(te,O,"timerProgressBar"),setTimeout(()=>{A.timeout&&A.timeout.running&&Vt(O.timer)})))},ZO=(A,O)=>{if(!O.toast){if(!C(O.allowEnterKey)){qy();return}XO(A,O)||Mr(-1,1)}},XO=(A,O)=>O.focusDeny&&$t(A.denyButton)?(A.denyButton.focus(),!0):O.focusCancel&&$t(A.cancelButton)?(A.cancelButton.focus(),!0):O.focusConfirm&&$t(A.confirmButton)?(A.confirmButton.focus(),!0):!1,qy=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const A=new Date,O=localStorage.getItem("swal-initiation");O?(A.getTime()-Date.parse(O))/(1e3*60*60*24)>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const F=document.createElement("audio");F.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",F.loop=!0,document.body.appendChild(F),setTimeout(()=>{F.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${A}`)}un.prototype.disableButtons=jS,un.prototype.enableButtons=OO,un.prototype.getInput=VS,un.prototype.disableInput=RO,un.prototype.enableInput=HS,un.prototype.hideLoading=Gy,un.prototype.disableLoading=Gy,un.prototype.showValidationMessage=MO,un.prototype.resetValidationMessage=ow,un.prototype.close=Nu,un.prototype.closePopup=Nu,un.prototype.closeModal=Nu,un.prototype.closeToast=Nu,un.prototype.rejectPromise=Tp,un.prototype.update=lw,un.prototype._destroy=FO,Object.assign(un,XS),Object.keys(Dc).forEach(A=>{un[A]=function(){return kc&&kc[A]?kc[A](...arguments):null}}),un.DismissReason=yt,un.version="11.7.12";const bw=un;return bw.default=bw,bw}),typeof Dm<"u"&&Dm.Sweetalert2&&(Dm.swal=Dm.sweetAlert=Dm.Swal=Dm.SweetAlert=Dm.Sweetalert2),typeof document<"u"&&function(i,r){var n=i.createElement("style");if(i.getElementsByTagName("head")[0].appendChild(n),n.styleSheet)n.styleSheet.disabled||(n.styleSheet.cssText=r);else try{n.innerHTML=r}catch{n.innerText=r}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:rgba(0,0,0,.4)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}div:where(.swal2-container) div:where(.swal2-actions):not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}div:where(.swal2-container) button:where(.swal2-styled).swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}div:where(.swal2-container) button:where(.swal2-styled).swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-styled):focus{outline:none}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em}div:where(.swal2-container) button:where(.swal2-close){z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:none;background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) .swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:#fff}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}div:where(.swal2-icon).swal2-warning{border-color:#facea8;color:#f8bb86}div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}div:where(.swal2-icon).swal2-info{border-color:#9de0f6;color:#3fc3ee}div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}div:where(.swal2-icon).swal2-question{border-color:#c9dae1;color:#87adbd}div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}')})(Goe);var NTe=Goe.exports;const FTe=DTe(NTe),kTe=(t,e)=>new Array(e).fill("foo").map(()=>{const i=Math.random()*(t.xmax-t.xmin)+t.xmin,r=Math.random()*(t.ymax-t.ymin)+t.ymin;return{type:"point",x:i,y:r,spatialReference:t.spatialReference}}),UTe=(t,e)=>{const i=t.map(r=>e.queryElevation(r));return Promise.all(i)},zTe=(t,e)=>new Promise((i,r)=>{const n=t.extent,s=kTe(n,10);s.push(t.center),UTe(s,e).then(o=>{const a=o.map(c=>c.geometry.z);a.sort(function(c,u){return c-u});const l=a[a.length-1]-a[0];i(l)})}),BTe="modulepreload",VTe=function(t,e){return new URL(t,e).href},OZ={},Oe=function(e,i,r){if(!i||i.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(i.map(s=>{if(s=VTe(s,r),s in OZ)return;OZ[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const p=n[u];if(p.href===s&&(!o||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":BTe,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,p)=>{c.addEventListener("load",u),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e())};function d(t,e,i,r){var n,s=arguments.length,o=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,i,o):n(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o}function yft(t,e,i,r){function n(s){return s instanceof i?s:new i(function(o){o(s)})}return new(i||(i=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(p){o(p)}}function l(u){try{c(r.throw(u))}catch(p){o(p)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((r=r.apply(t,e||[])).next())})}function vft(t){const e=[];return function*(){yield*e;for(const i of t)e.push(i),yield i}}function GTe(t,e){for(const i of t)if(i!=null&&e(i))return i}function l8(t){return t!=null&&typeof t[Symbol.iterator]=="function"}function Eh(t,e){return t!=null?e(t):null}function uc(t,e){return HN(t,e),t}function HN(t,e){if(t==null)throw new Error(e??"value is None")}function Je(t){return t==null||t.destroy(),null}function et(t){return t==null||t.dispose(),null}function Qr(t){return t==null||t.remove(),null}function wu(t){return t==null||t.abort(),null}function nn(t){return t==null||t.release(),null}function bft(t,e,i){return t!=null&&e!=null?i!=null?i(t,e):t.equals(e):t===e}function eS(t){return null}function wft(t,e){const i=new Array;for(const r of t)i.push(r!=null?e(r):null);return i}function xft(t,e){for(const i of t)Eh(i,e)}function Tft(t){return t}let an=class c8{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(i=>{e+=i.length}),e}add(e,i){if(l8(e)){const r=this._getOrCreateGroup(i);for(const n of e)this._isHandle(n)&&r.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(i).push(e);return this}forEach(e,i){if(typeof e=="function")this._groups.forEach(r=>r.forEach(e));else{const r=this._getGroup(e);r&&i&&r.forEach(i)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&l8(e)){for(const i of e)this.remove(i);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof c8)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const i=[];return this._groups.set(this._ensureGroupKey(e),i),i}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const i of e)i instanceof c8?i.removeAll():i.remove()}};const joe=Symbol("Accessor-beforeDestroy");function aT(t){return il(()=>t.forEach(e=>e!=null&&e.remove()))}function il(t){return{remove:()=>{t&&(t(),t=void 0)}}}function Sft(t){return il(t!=null?()=>t.destroy():void 0)}let wA=class Av{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*Av._m}getInt(){return this._seed=(Av._a*this._seed+Av._c)%Av._m,this._seed}getFloat(){return this.getInt()/(Av._m-1)}getIntRange(e,i){return Math.round(this.getFloatRange(e,i))}getFloatRange(e,i){const r=i-e;return e+this.getInt()/Av._m*r}};wA._m=2147483647,wA._a=48271,wA._c=0;const WN=1.5,jTe=1/WN,HTe=.5;function qN(t,e){return e?t.filter((i,r,n)=>n.findIndex(e.bind(null,i))===r):t.filter((i,r,n)=>n.indexOf(i)===r)}function Ag(t,e,i){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function KV(t,e){let i=t.length!==e.length;i&&(t.length=e.length);for(let r=0;r<e.length;++r)t[r]!==e[r]&&(t[r]=e[r],i=!0);return i}function WTe(t,e,i){let r,n;return i?(r=e.filter(s=>!t.some(o=>i(o,s))),n=t.filter(s=>!e.some(o=>i(o,s)))):(r=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:r,removed:n}}function qTe(t){return t&&typeof t.length=="number"}function Cft(t,e){const i=t.length;if(i===0)return[];const r=[];for(let n=0;n<i;n+=e)r.push(t.slice(n,n+e));return r}const ZTe=!!Array.prototype.fill;function Eft(t,e){if(ZTe)return new Array(t).fill(e);const i=new Array(t);for(let r=0;r<t;r++)i[r]=e;return i}function XTe(t,e){e===void 0&&(e=t,t=0);const i=new Array(e-t);for(let r=t;r<e;r++)i[r-t]=r;return i}function YTe(t,e,i){const r=t.length;let n=0,s=r-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return i?e>=t[r-1]?-1:o===e?n:n-1:o===e?n:-1}let Hoe=class{constructor(){this.last=0}};const Woe=new Hoe;function u8(t,e,i,r){r=r||Woe;const n=Math.max(0,r.last-10);for(let o=n;o<i;++o)if(t[o]===e)return r.last=o,o;const s=Math.min(n,i);for(let o=0;o<s;++o)if(t[o]===e)return r.last=o,o;return-1}function gP(t,e,i,r){const n=i??t.length,s=u8(t,e,n,r);if(s!==-1)return t[s]=t[n-1],i==null&&t.pop(),e}const nd=new Set;function JTe(t,e,i=t.length,r=e.length,n,s){if(r===0||i===0)return i;nd.clear();for(let a=0;a<r;++a)nd.add(e[a]);n=n||Woe;const o=Math.max(0,n.last-10);for(let a=o;a<i;++a)if(nd.has(t[a])&&(s&&s.push(t[a]),nd.delete(t[a]),t[a]=t[i-1],--i,--a,nd.size===0||i===0))return nd.clear(),i;for(let a=0;a<o;++a)if(nd.has(t[a])&&(s&&s.push(t[a]),nd.delete(t[a]),t[a]=t[i-1],--i,--a,nd.size===0||i===0))return nd.clear(),i;return nd.clear(),i}function KTe(t,e){let i=0;for(let r=0;r<t.length;++r){const n=t[r];e(n,r)&&(t[i]=n,i++)}t.length=i}function QTe(t){return t?(RZ.seed=t,()=>RZ.getFloat()):Math.random}function Pft(t,e){const i=QTe(e);for(let r=t.length-1;r>0;r--){const n=Math.floor(i()*(r+1)),s=t[r];t[r]=t[n],t[n]=s}return t}const RZ=new wA;function QV(t,e){const i=t.indexOf(e);return i!==-1?(t.splice(i,1),e):null}function Oft(t,e){const i=new Map,r=t.length;for(let n=0;n<r;n++){const s=t[n],o=e(s,n,t),a=i.get(o);a?a.push(s):i.set(o,[s])}return i}function w3(t,e){return t!=null}const eSe=[];let R_;function ge(t){return typeof R_[t]=="function"?R_[t]=R_[t](globalThis):R_[t]}var Ooe,Roe,Moe,$oe;R_=(Ooe=globalThis.dojoConfig)!=null&&Ooe.has||(Roe=globalThis.esriConfig)!=null&&Roe.has?{...(Moe=globalThis.dojoConfig)==null?void 0:Moe.has,...($oe=globalThis.esriConfig)==null?void 0:$oe.has}:{},ge.add=(t,e,i,r)=>((r||R_[t]===void 0)&&(R_[t]=e),i&&ge(t)),ge.cache=R_,ge.add("esri-deprecation-warnings",!0),ge.add("esri-force-fullscreen-debug",!1),(()=>{var e;ge.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(ge.add("host-browser",t),ge.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),ge.add("dom",t),ge("host-browser")){const i=navigator,r=i.userAgent,n=i.appVersion,s=parseFloat(n);if(ge.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),ge.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),ge.add("khtml",n.includes("Konqueror")?s:void 0),ge.add("edge",parseFloat(r.split("Edge/")[1])||void 0),ge.add("opr",parseFloat(r.split("OPR/")[1])||void 0),ge.add("webkit",!ge("wp")&&!ge("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),ge.add("chrome",!ge("edge")&&!ge("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),ge.add("android",!ge("wp")&&parseFloat(r.split("Android ")[1])||void 0),ge.add("safari",!n.includes("Safari")||ge("wp")||ge("chrome")||ge("android")||ge("edge")||ge("opr")?void 0:parseFloat(n.split("Version/")[1])),ge.add("mac",n.includes("Macintosh")),!ge("wp")&&/(iPhone|iPod|iPad)/.test(r)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(r)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));ge.add(o,l),ge.add("ios",l)}ge("webkit")||(!r.includes("Gecko")||ge("wp")||ge("khtml")||ge("edge")||ge.add("mozilla",s),ge("mozilla")&&ge.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),i=/iPhone/i.test(t);e&&ge.add("esri-mobile",e),i&&ge.add("esri-iPhone",i),ge.add("esri-geolocation",!!navigator.geolocation)}ge.add("esri-wasm","WebAssembly"in globalThis),ge.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),ge.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),ge.add("esri-atomics","Atomics"in globalThis),ge.add("esri-workers","Worker"in globalThis),ge.add("web-feat:cache","caches"in globalThis),ge.add("esri-workers-arraybuffer-transfer",!ge("safari")||Number(ge("safari"))>=12),ge.add("workers-pool-size",8),ge.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),ge.add("featurelayer-simplify-payload-size-factors",[1,1,4]),ge.add("featurelayer-animation-enabled",!0),ge.add("featurelayer-snapshot-enabled",!0),ge.add("featurelayer-snapshot-point-min-threshold",8e4),ge.add("featurelayer-snapshot-point-max-threshold",4e5),ge.add("featurelayer-snapshot-point-coverage",.1),ge.add("featurelayer-advanced-symbols",!1),ge.add("featurelayer-pbf",!0),ge.add("featurelayer-pbf-statistics",!1),ge.add("feature-layers-workers",!0),ge.add("feature-polyline-generalization-factor",1),ge.add("mapview-transitions-duration",200),ge.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),ge.add("mapserver-pbf-version-support",10.81),ge.add("mapservice-popup-identify-max-tolerance",20),ge.add("heatmap-allow-raster-fallback",!1),ge.add("heatmap-force-raster",!1),ge("host-webworker")||ge("host-browser")&&(ge.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),ge.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{ge.add("esri-image-decode",!0,!0,!0)}).catch(()=>{ge.add("esri-image-decode",!1,!0,!0)})}return!1}),ge.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();function nE(t){return t instanceof ArrayBuffer}function eG(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function M_(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function qoe(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function tG(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function ZN(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function iG(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function XN(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function tS(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function iS(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function cp(t){return!("buffer"in t)}function $_(t){return t!=null?cp(t)?8*t.length+12:t.byteLength+Zoe:0}const Zoe=145,xu=1024;function tSe(t){return iS(t)||tS(t)||iG(t)||tG(t)||eG(t)}function iSe(t){return iS(t)||tS(t)}function rSe(t){return iS(t)?179769e303:tS(t)?3402823e32:XN(t)?4294967295:ZN(t)?65535:M_(t)||qoe(t)?255:iG(t)?2147483647:tG(t)?32767:eG(t)?127:256}function Xoe(t,e){let i;if(e)for(i in t)t.hasOwnProperty(i)&&(t[i]===void 0?delete t[i]:t[i]instanceof Object&&Xoe(t[i],!0));else for(i in t)t.hasOwnProperty(i)&&t[i]===void 0&&delete t[i];return t}function Le(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=Koe(t);if(e!=null)return e;if(_L(t))return t.clone();if(Yoe(t))return t.map(Le);if(Joe(t))return t.clone();const i={};for(const r of Object.getOwnPropertyNames(t))i[r]=Le(t[r]);return i}function h8(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=Koe(t);if(e!=null)return e;if(Yoe(t)){let i=!0;const r=t.map(n=>{const s=h8(n);return n!=null&&s==null&&(i=!1),s});return i?r:null}if(_L(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!Joe(t)){const i=new(Object.getPrototypeOf(t)).constructor;for(const r of Object.getOwnPropertyNames(t)){const n=t[r],s=h8(n);if(n!=null&&s==null)return null;i[r]=s}return i}return null}function _L(t){return typeof t.clone=="function"}function Yoe(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function Joe(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function MZ(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function Koe(t){if(eG(t)||M_(t)||qoe(t)||tG(t)||ZN(t)||iG(t)||XN(t)||tS(t)||iS(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[i,r]of t)e.set(i,Le(r));return e}if(t instanceof Set){const e=new Set;for(const i of t)e.add(Le(i));return e}return null}function rG(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function Qoe(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&Ag(t,e):t instanceof Set?e instanceof Set&&sSe(t,e):t instanceof Map?e instanceof Map&&oSe(t,e):!!MZ(t)&&MZ(e)&&nSe(t,e))}function nSe(t,e){if(t===null||e===null)return!1;const i=Object.keys(t);if(e===null||Object.keys(e).length!==i.length)return!1;for(const r of i)if(t[r]!==e[r]||!Object.prototype.hasOwnProperty.call(e,r))return!1;return!0}function sSe(t,e){if(t.size!==e.size)return!1;for(const i of t)if(!e.has(i))return!1;return!0}function oSe(t,e){if(t.size!==e.size)return!1;for(const[i,r]of t){const n=e.get(i);if(n!==r||n===void 0&&!e.has(i))return!1}return!0}function iy(t){return t.__accessor__??null}function aSe(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function B$(t,e,i){return i?yL(t,e,{policy:i,path:""}):yL(t,e,null)}function yL(t,e,i){return e?Object.keys(e).reduce((r,n)=>{const s=n;let o=null,a="merge";if(i&&(o=i.path?`${i.path}.${n}`:n,a=i.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(r[s]))return r[s]=e[s],r;if(r[s]===void 0)return r[s]=Le(e[s]),r;let l=r[s],c=e[s];if(l===c)return r;if(Array.isArray(c)||Array.isArray(r))l=l?Array.isArray(l)?r[s]=l.concat():r[s]=[l]:r[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(i){const u=i.path;i.path=o,r[s]=yL(l,c,i),i.path=u}else r[s]=yL(l,c,null);else r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[s]=c);return r},t||{}):t}function eae(t){return Array.isArray(t)?t:t.split(".")}function $Z(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function lSe(t){if(Array.isArray(t)){const e=[];for(const i of t)e.push(...$Z(i));return e}return $Z(t)}function tae(t,e,i,r){const n=lSe(e);if(n.length!==1){const s=n.map(o=>r(t,o,i));return aT(s)}return r(t,n[0],i)}function nG(t){let e=!1;return()=>{e||(e=!0,t())}}function iae(t,e){const i=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const r=iy(e);return aSe(r,i)?r.get(i):e[i]}function rae(t,e,i){if(t==null)return t;const r=iae(e[i],t);return!r&&i<e.length-1?void 0:i===e.length-1?r:rae(r,e,i+1)}function x3(t,e,i=0){return typeof e!="string"||e.includes(".")?rae(t,eae(e),i):iae(e,t)}function vL(t,e){return x3(t,e)}function IZ(t,e){return x3(e,t)!==void 0}function T3(t){let e=t.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!i){e=Object.create(e);for(const r in e)e[r]=Le(e[r]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function YN(t,e){const i=T3(t);let r=i[e];return r||(r=i[e]={}),r}function cSe(t,e){return B$(t,e,hSe)}const uSe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function hSe(t){return uSe.test(t)?"replace":"merge"}function dSe(t,e,i=!1){return sae(t,e,i)}function S3(t,e){if(e!=null)return e[t]||nae(t.split("."),!1,e)}function rS(t,e,i){const r=t.split("."),n=r.pop(),s=nae(r,!0,i);s&&n&&(s[n]=e)}function nae(t,e,i){let r=i;for(const n of t){if(r==null)return;if(!(n in r)){if(!e)return;r[n]={}}r=r[n]}return r}function sae(t,e,i){return e?Object.keys(e).reduce((r,n)=>{let s=r[n],o=e[n];return s===o?r:s===void 0?(r[n]=Le(o),r):(Array.isArray(o)||Array.isArray(r)?(s=s?Array.isArray(s)?r[n]=s.concat():r[n]=[s]:r[n]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{s.includes(a)||s.push(a)}):r[n]=o.concat())):o&&typeof o=="object"?r[n]=sae(s,o,i):r.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(r[n]=o),r)},t||{}):t}var Ioe;const Er={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:(Ioe=globalThis.location)==null?void 0:Ioe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(dSe(Er,globalThis.esriConfig,!0),delete Er.has),!Er.assetsPath){{const t="4.27";Er.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Er.defaultAssetsPath=Er.assetsPath}const pSe=/\{([^\}]+)\}/g;function LZ(t){return t??""}function JN(t,e){return t.replaceAll(pSe,typeof e=="object"?(i,r)=>LZ(S3(r,e)):(i,r)=>LZ(e(r)))}function Rft(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>e&&e.includes(i)?i:`\\${i}`)}function oae(t){let e=0;for(let i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}function Mft(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function $ft(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const DZ={info:0,warn:1,error:2,none:3};let ye=class Na{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,Na._loggers.set(this.module,this);const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Na.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const i=Na._loggers;return Na._loggers=e,i},set throttlingDisabled(e){Na._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,Na._loggers.get(e)||new Na({module:e})}_log(e,i,...r){if(this._matchLevel(e)){if(i!=="always"&&!Na._throttlingDisabled){const n=this._argsToKey(r),s=this._loggedMessages[e].get(n);if(i==="once"&&s!=null||i==="oncePerTick"&&s&&s>=Na._tickCounter)return;this._loggedMessages[e].set(n,Na._tickCounter),Na._scheduleTickCounterIncrement()}for(const n of Er.log.interceptors)if(n(e,this.module,...r))return;this._inheritedWriter()(e,this.module,...r)}}_parentWithMember(e,i){let r=this;for(;r!=null;){const n=r[e];if(n!=null)return n;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,i,...r){console[e](`[${i}]`,...r)}_matchLevel(e){const i=Er.log.level||"warn";return DZ[this._parentWithMember("level",i)]<=DZ[e]}_argsToKey(...e){return oae(JSON.stringify(e,(r,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){Na._tickCounterScheduled||(Na._tickCounterScheduled=!0,Promise.resolve().then(()=>{Na._tickCounter++,Na._tickCounterScheduled=!1}))}};ye._loggers=new Map,ye._tickCounter=0,ye._tickCounterScheduled=!1,ye._throttlingDisabled=!1;function fSe(t){return t&&t.release&&typeof t.release=="function"}function mSe(t){return t&&t.acquire&&typeof t.acquire=="function"}let ea=class d8{constructor(e,i,r,n=1,s=0){if(this._ctor=e,this._acquireFunction=i,this._releaseFunction=r,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let i;if(d8.test.disabled)i=new this._ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let n=0;n<r;n++)this._pool[n]=new this._ctor}i=this._pool.pop()}return this._acquireFunction?this._acquireFunction(i,...e):mSe(i)&&i.acquire(...e),i}release(e){e&&!d8.test.disabled&&(this._releaseFunction?this._releaseFunction(e):fSe(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let i=e;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};ea.test={disabled:!1};var og;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(og||(og={}));let gSe=class{constructor(e,i){this._observers=e,this._observer=i}remove(){QV(this._observers,this._observer)}},aae=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return _Se;this._observers==null&&(this._observers=[]);const i=this._observers;let r=!1,n=!1;const s=i.length;for(let o=0;o<s;++o){const a=i[o];if(a.destroyed)n=!0;else if(a===e){r=!0;break}}return r||(i.push(e),n&&this._removeDestroyedObservers()),new gSe(i,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const i=e.length;let r=0;for(let n=0;n<i;++n){for(;n+r<i&&e[n+r].destroyed;)++r;if(r>0){if(!(n+r<i))break;e[n]=e[n+r]}}e.length=i-r}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const i of e)i.onCommitted();this._observers=null}}};const _Se=il();var Sr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Sr||(Sr={}));const Dft=Sr.USER+1;function lae(t){switch(t){case"defaults":return Sr.DEFAULTS;case"service":return Sr.SERVICE;case"portal-item":return Sr.PORTAL_ITEM;case"web-scene":return Sr.WEB_SCENE;case"web-map":return Sr.WEB_MAP;case"link-chart":return Sr.LINK_CHART;case"user":return Sr.USER;default:return null}}function p8(t){switch(t){case Sr.DEFAULTS:return"defaults";case Sr.SERVICE:return"service";case Sr.PORTAL_ITEM:return"portal-item";case Sr.WEB_SCENE:return"web-scene";case Sr.WEB_MAP:return"web-map";case Sr.LINK_CHART:return"link-chart";case Sr.USER:return"user"}return void 0}function ySe(t){return p8(t)}var qr;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(qr||(qr={}));const bL={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},sE=[];let xA=bL;function hi(t){xA.onObservableAccessed(t)}let V$=!1,G$=!1;function Pg(t,e,i){if(V$)return sG(t,e,i);cae(t);const r=e.call(i);return uae(),r}function vSe(t,e){return Pg(bL,t,e)}function sG(t,e,i){const r=V$;V$=!0,cae(t);let n=null;try{n=e.call(i)}catch(s){G$&&ye.getLogger("esri.core.accessorSupport.tracking").error(s)}return uae(),V$=r,n}function cae(t){xA=t,sE.push(t)}function uae(){const t=sE.length;if(t>1){const e=sE.pop();xA=sE[t-2],e.onTrackingEnd()}else if(t===1){const e=sE.pop();xA=bL,e.onTrackingEnd()}else xA=bL}function hae(t,e){const i=e.observerObject;if(i.flags&qr.DepTrackingInitialized)return;const r=G$;G$=!1,i.flags&qr.AutoTracked?sG(e,e.metadata.get,t):dae(t,e),G$=r}const bSe=[];function dae(t,e){const i=e.observerObject;i.flags&qr.ExplicitlyTracking||(i.flags|=qr.ExplicitlyTracking,sG(e,()=>{const r=e.metadata.dependsOn||bSe;for(const n of r)if(typeof n!="string"||n.includes(".")){const s=eae(n);for(let o=0,a=t;o<s.length&&a!=null&&typeof a=="object";++o)a=NZ(a,s[o],o!==s.length-1)}else NZ(t,n,!1)}),i.flags&=~qr.ExplicitlyTracking)}function NZ(t,e,i){const r=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(r,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=iy(t);if(n){const s=n.propertiesByName.get(r);s&&(hi(s.observerObject),hae(t,s))}return i?t[r]:void 0}let FZ=class{constructor(e,i){this.propertyName=e,this.metadata=i,this.observerObject=new wSe,this._accessed=null,this._handles=null,this.observerObject.flags=qr.Dirty|(i.nonNullable?qr.NonNullable:0)|(i.hasOwnProperty("value")?qr.HasDefaultValue:0)|(i.get===void 0?qr.DepTrackingInitialized:0)|(i.dependsOn===void 0?qr.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const i=this.observerObject;hi(i);const r=e.store,n=this.propertyName,s=i.flags,o=r.get(n);if(s&qr.Computing||~s&qr.Dirty&&r.has(n))return o;i.flags|=qr.Computing;const a=e.host;let l;s&qr.AutoTracked?l=Pg(this,this.metadata.get,a):(dae(a,this),l=this.metadata.get.call(a)),r.set(n,l,Sr.COMPUTED);const c=r.get(n);return c===o?i.flags&=~qr.Dirty:vSe(this.commit,this),i.flags&=~qr.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let i=this._accessed;if(i==null)i=[],this._accessed=i;else if(i.includes(e))return;i.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=qr.DepTrackingInitialized;const i=this._accessed;if(i==null||i.length===0)return;let r=this._handles;r==null&&(r=[],this._handles=r);for(let n=0;n<i.length;++n)r.push(i[n].observe(e));i.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~qr.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let i=0;i<e.length;++i)e[i].remove();e.length=0}}},wSe=class extends aae{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&qr.Overriden&&(this.flags|=qr.Dirty);const e=this._observers;if(e&&e.length>0)for(const i of e)i.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onCommitted()}}destroy(){this.flags&qr.Dirty&&this.onCommitted(),super.destroy()}},xSe=class pae{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new pae;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,Le(r))}),i}get(e){return this._values.get(e)}originOf(){return Sr.USER}keys(){return[...this._values.keys()]}set(e,i){this._values.set(e,i)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function JO(t,e,i){return t!==void 0}function kZ(t,e,i,r){return t!==void 0&&(!(i==null&&t.observerObject.flags&qr.NonNullable)||(r.lifecycle,og.INITIALIZING,!1))}function TSe(t){return t&&typeof t.destroy=="function"}ye.getLogger("esri.core.accessorSupport.Properties");let SSe=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=og.INITIALIZING,this.store=new xSe,this._origin=Sr.USER;const i=this.host.constructor.__accessorMetadata__;for(const r in i){const n=new FZ(r,i[r]);this.propertiesByName.set(r,n)}this.metadatas=i}initialize(){this.lifecycle=og.CONSTRUCTING}constructed(){this.lifecycle=og.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,i]of this.propertiesByName){if(i.metadata.autoDestroy){const r=this.internalGet(e);r&&TSe(r)&&(r.destroy(),~i.observerObject.flags&qr.NonNullable&&this._internalSet(i,null))}i.destroy()}}get initialized(){return this.lifecycle!==og.INITIALIZING}get(e){const i=this.propertiesByName.get(e);if(i.metadata.get)return i.getComputed(this);hi(i.observerObject);const r=this.store;return r.has(e)?r.get(e):i.metadata.value}originOf(e){const i=this.store.originOf(e);if(i===void 0){const r=this.propertiesByName.get(e);if(r!==void 0&&r.observerObject.flags&qr.HasDefaultValue)return"defaults"}return p8(i)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const i=this.propertiesByName.get(e);if(JO(i))return this.store.has(e)?this.store.get(e):i.metadata.value}internalSet(e,i){const r=this.propertiesByName.get(e);JO(r)&&this._internalSet(r,i)}getDependsInfo(e,i,r){const n=this.propertiesByName.get(i);if(!JO(n))return"";const s=new Set,o=Pg({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${r}${e.declaredClass.split(".").pop()}.${i}: ${o}
`;if(s.size===0)return a;r+="  ";for(const l of s)l instanceof FZ&&(a+=`${r}${l.propertyName}: undefined
`);return a}setAtOrigin(e,i,r){const n=this.propertiesByName.get(e);if(JO(n))return this._setAtOrigin(n,i,r)}isOverridden(e){const i=this.propertiesByName.get(e);return i!==void 0&&!!(i.observerObject.flags&qr.Overriden)}clearOverride(e){const i=this.propertiesByName.get(e),r=i==null?void 0:i.observerObject;r&&r.flags&qr.Overriden&&(r.flags&=~qr.Overriden,i.notifyChange())}override(e,i){const r=this.propertiesByName.get(e);if(!kZ(r,e,i,this))return;const n=r.metadata.cast;if(n){const s=this._cast(n,i),{valid:o,value:a}=s;if(OF.release(s),!o)return;i=a}r.observerObject.flags|=qr.Overriden,this._internalSet(r,i)}set(e,i){const r=this.propertiesByName.get(e);if(!kZ(r,e,i,this))return;const n=r.metadata.cast;if(n){const o=this._cast(n,i),{valid:a,value:l}=o;if(OF.release(o),!a)return;i=l}const s=r.metadata.set;s?s.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(e){this._origin=lae(e)}getDefaultOrigin(){return p8(this._origin)}notifyChange(e){const i=this.propertiesByName.get(e);i!==void 0&&i.notifyChange()}invalidate(e){const i=this.propertiesByName.get(e);i!==void 0&&i.invalidate()}commit(e){const i=this.propertiesByName.get(e);i!==void 0&&i.commit()}_internalSet(e,i){const r=this.lifecycle!==og.INITIALIZING?this._origin:Sr.DEFAULTS;this._setAtOrigin(e,i,r)}_setAtOrigin(e,i,r){const n=this.store,s=e.propertyName;n.has(s,r)&&rG(i,n.get(s))&&~e.observerObject.flags&qr.Overriden&&r===n.originOf(s)||(e.invalidate(),n.set(s,i,r),e.commit(),hae(this.host,e))}_cast(e,i){const r=OF.acquire();return r.valid=!0,r.value=i,e&&(r.value=e.call(this.host,i,r)),r}},CSe=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const OF=new ea(CSe);function ESe(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>r===""?"$":(S3(r,e)??"").toString())}let fae=class{constructor(e,i,r){this.name=e,this.details=r,this.message=(i&&ESe(i,r))??""}toString(){return"["+this.name+"]: "+this.message}},ce=class mae extends fae{constructor(e,i,r){super(e,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return Le(i)}catch{return"[object]"}}))}}catch(e){throw ye.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new mae(e.name,e.message,e.details)}};ce.prototype.type="error";function wL(t,e,i){if(t&&e)if(typeof e=="object")for(const r of Object.getOwnPropertyNames(e))wL(t,r,e[r]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(n.length-1,1)[0];return void wL(vL(t,n),s,i)}const r=t.__accessor__;r!=null&&ASe(e,r),t[e]=i}}function ASe(t,e){if(ge("esri-unknown-property-errors")&&!PSe(t,e))throw new ce("set:unknown-property",OSe(t,e))}function PSe(t,e){return e.metadatas[t]!=null}function OSe(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let RSe;function MSe(){return RSe}function $Se(t){t.length=0}let fc=class{constructor(e=50,i=50){this._pool=new ea(Array,void 0,$Se,i,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return RF.acquire()}static release(e){return RF.release(e)}static prune(){RF.prune()}};const RF=new fc(100);let gae=class extends ea{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=eS(this._set)}acquire(...e){const i=super.acquire(...e);return this._set.delete(i),i}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const KO=[];function lT(t){KO.push(t),KO.length===1&&queueMicrotask(()=>{const e=KO.slice();KO.length=0;for(const i of e)i()})}let cg=class{constructor(e,i=30){this.name=e,this._counter=0,this._samples=new Array(i)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,i)=>e-i)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,i)=>e+i,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var f8;(function(t){const e=(s,o,a,l)=>{let c=o,u=o;const p=a>>>1,f=s[c-1];for(;u<=p;){u=c<<1,u<a&&l(s[u-1],s[u])<0&&++u;const y=s[u-1];if(l(y,f)<=0)break;s[c-1]=y,c=u}s[c-1]=f},i=(s,o)=>s<o?-1:s>o?1:0;function r(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(s,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const p=s[o];s[o]=s[u],s[u]=p,e(s,c,u,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=i);for(let u=a>>>1;u>o;u--)e(s,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const p=s[o];s[o]=s[u],s[u]=p,e(s,c,u,l),yield}}t.sort=r,t.iterableSort=n})(f8||(f8={}));const UZ=f8,ISe=1.5,LSe=1.1;let ri=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new Hoe,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>zZ(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const i=new Array;for(let r=0;r<this._length;r++){const n=this.data[r];e(n)&&i.push(n)}return i}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,i){const r=this.data.indexOf(e,i);return r!==-1&&r<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let i=e;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,i=e.length){for(let r=0;r<i;r++)this.data[this._length++]=e[r]}fill(e,i){for(let r=0;r<i;r++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,zZ(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const i=u8(this.data,e,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(u8(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,i=e.length,r){this.length=JTe(this.data,e,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,i){if(e>=this.length||i>=this.length||e===i)return;const r=this.data[e];this.data[e]=this.data[i],this.data[i]=r}sort(e){UZ.sort(this.data,0,this.length,e)}iterableSort(e){return UZ.iterableSort(this.data,0,this.length,e)}some(e,i){for(let r=0;r<this.length;++r)if(e.call(i,this.data[r],r,this.data))return!0;return!1}find(e,i){for(let r=0;r<this.length;++r){const n=this.data[r];if(e.call(i,n,r))return n}}filterInPlace(e,i){let r=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(i,s,n,this.data)&&(this.data[n]=this.data[r],this.data[r]=s,r++)}if(this._deallocator)for(let n=r;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=r,this._shrink(),this}forAll(e,i){const r=this.length,n=this.data;for(let s=0;s<r;++s)e.call(i,n[s],s,n)}forEach(e,i){for(let r=0;r<this.length;++r)e.call(i,this.data[r],r,this.data)}map(e,i){const r=new Array(this.length);for(let n=0;n<this.length;++n)r[n]=e.call(i,this.data[n],n,this.data);return r}reduce(e,i){let r=i;for(let n=0;n<this.length;++n)r=e(r,this.data[n],n,this.data);return r}has(e){const i=this.length,r=this.data;for(let n=0;n<i;++n)if(r[n]===e)return!0;return!1}};function zZ(t){t.data.length>ISe*t.length&&(t.data.length=Math.floor(t.length*LSe))}function DSe(t){return{setTimeout:(e,i)=>{const r=t.setTimeout(e,i);return{remove:()=>t.clearTimeout(r)}}}}const C3=DSe(globalThis);function KN(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function E3(t,e,i){if(!KN(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,i);if(Array.isArray(e)){const r=e.slice();for(const n of r)t.addEventListener(n,i);return{remove(){for(const n of r)t.removeEventListener(n,i)}}}return t.addEventListener(e,i),{remove(){t.removeEventListener(e,i)}}}function _ae(t,e,i){if(!KN(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,i);const r=E3(t,e,n=>{r.remove(),i.call(t,n)});return{remove(){r.remove()}}}const NSe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function FSe({key:t}){return NSe[t]||t}function Qi(t="Aborted"){return new ce("AbortError",t)}function Ti(t,e="Aborted"){if(Gs(t))throw Qi(e)}function QN(t){return t!=null?"aborted"in t?t:t.signal:t}function Gs(t){const e=QN(t);return e!=null&&e.aborted}function kb(t){if(ms(t))throw t}function BZ(t){if(!ms(t))throw t}function Ca(t,e){const i=QN(t);if(i!=null){if(!i.aborted)return _ae(i,"abort",()=>e());e()}}function oG(t,e){const i=QN(t);if(i!=null)return Ti(i),_ae(i,"abort",()=>e(Qi()))}function kSe(t,e){return QN(e)==null?t:new Promise((i,r)=>{let n=Ca(e,()=>r(Qi()));const s=()=>n=Qr(n);t.then(s,s),t.then(i,r)})}function ms(t){return(t==null?void 0:t.name)==="AbortError"}async function m8(t){try{return await t}catch(e){if(!ms(e))throw e;return}}async function Hft(t,e=ye.getLogger("esri")){try{return await t}catch(i){ms(i)||e.error(i)}}async function Ay(t){if(!t)return;if(typeof t.forEach!="function"){const i=Object.keys(t),r=i.map(o=>t[o]),n=await Ay(r),s={};return i.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(i=>Array.from(e,(r,n)=>{const s=i[n];return s.status==="fulfilled"?{promise:r,value:s.value}:{promise:r,error:s.reason}}))}async function g8(t){return(await Ay(t)).filter(e=>!!e.value).map(e=>e.value)}function _P(t,e=void 0,i){const r=new AbortController;return Ca(i,()=>r.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);Ca(r,()=>{o&&(clearTimeout(o),s(Qi()))})})}function Pu(t){return t&&typeof t.then=="function"}function _8(t){return Pu(t)?t:Promise.resolve(t)}function yae(t,e=-1){let i,r,n,s,o=null;const a=(...l)=>{if(i){r=l,s&&s.reject(Qi()),s=sa();const f=s.promise;if(o){const y=o;o=null,y.abort()}return f}if(n=s||sa(),s=null,e>0){const f=new AbortController;i=_8(t(...l,f.signal));const y=i;_P(e).then(()=>{i===y&&(s?f.abort():o=f)})}else i=1,i=_8(t(...l));const c=()=>{const f=r;r=n=i=o=null,f!=null&&a(...f)},u=i,p=n;return u.then(c,c),u.then(p.resolve,p.reject),p.promise};return a}function sa(){let t,e;const i=new Promise((n,s)=>{t=n,e=s}),r=n=>{t(n)};return r.resolve=n=>t(n),r.reject=n=>e(n),r.timeout=(n,s)=>C3.setTimeout(()=>r.reject(s),n),r.promise=i,r}function Wft(t,e){return t.then(e,e)}async function VZ(t){await Promise.resolve(),Ti(t)}function qft(t){return t}function vae(t){return 1e3*t}function aG(t){return .001*t}function USe(){return performance.now()}let zSe=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},BSe=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},y8=0,v8=0;const QS={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},b8=["prepare","preRender","render","postRender","update","finish"],w8=[],eb=new ri;let VSe=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const xL={frameTasks:eb,willDispatch:!1,clearFrameTasks:GSe,dispatch:xae,executeFrameTasks:HSe};function A3(t){const e=new BSe(t);return w8.push(e),xL.willDispatch||(xL.willDispatch=!0,lT(xae)),e}function cT(t){const e=new zSe(t);return eb.push(e),TL==null&&(y8=performance.now(),TL=requestAnimationFrame(bae)),new VSe(e)}let TL=null;function GSe(t=!1){eb.forAll(e=>{e.removed=!0}),t&&wae()}function jSe(t){v8=Math.max(0,t)}function bae(){const t=performance.now();TL=null,TL=eb.length>0?requestAnimationFrame(bae):null,xL.executeFrameTasks(t)}function HSe(t){const e=t-y8;y8=t;const i=v8>0?v8:1e3/60,r=Math.max(0,e-i);QS.time=t,QS.frameDuration=i-r;for(let n=0;n<b8.length;n++){const s=performance.now(),o=b8[n];eb.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(QS.elapsedFrameTime=performance.now()-t,QS.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,QS)))}),WSe[n].record(performance.now()-s)}wae(),qSe.record(performance.now()-t)}const QO=new ri;function wae(){eb.forAll(t=>{t.removed&&QO.push(t)}),eb.removeUnorderedMany(QO.data,QO.length),QO.clear()}function xae(){for(;w8.length;){const t=w8.shift();t.isActive&&t.callback()}xL.willDispatch=!1}function Jft(t=1,e){const i=sa(),r=()=>{Gs(e)?i.reject(Qi()):t===0?i():(--t,lT(()=>r()))};return r(),i.promise}const WSe=b8.map(t=>new cg(t)),qSe=new cg("total");function j$(t,e){for(const i of t.entries())if(e(i[0]))return!0;return!1}let ZSe=0;const XSe=0;function xc(){return++ZSe}let e5=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new YSe(e),GZ.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;GZ.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const i=this._accessed;i.includes(e)||i.push(e)}onTrackingEnd(){const e=this._handles,i=this._accessed,r=this._observerObject;for(let n=0;n<i.length;++n)e.push(i[n].observe(r));i.length=0}clear(){const e=this._handles;for(let i=0;i<e.length;++i)e[i].remove();e.length=0}},YSe=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=JSe}};const GZ=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function JSe(){}let N2=!1;const SL=[];function Tae(t,e){let i=new e5(s),r=null,n=!1;function s(){if(!i||n)return;if(N2)return void Eae(s);const a=r;i.clear(),N2=!0,n=!0,r=Pg(i,t),n=!1,N2=!1,e(r,a),Aae()}function o(){i&&(i.destroy(),i=null,r=null)}return n=!0,r=Pg(i,t),n=!1,{remove:o}}function Sae(t,e){let i=new e5(n),r=null;function n(){e(r,o)}function s(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=Pg(i,t),r):null}return o(),{remove:s}}function Cae(t){let e=new e5(r),i=!1;function r(){e&&!i&&(N2?Eae(r):(e.clear(),N2=!0,i=!0,Pg(e,t),i=!1,N2=!1,Aae()))}function n(){e&&(e.destroy(),e=null)}return i=!0,Pg(e,t),i=!1,{remove:n}}function Eae(t){SL.includes(t)||SL.unshift(t)}function Aae(){for(;SL.length;)SL.pop()()}var TA;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(TA||(TA={}));let yP=class{constructor(){this.uid=xc(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,i,r,n,s){return this.pool.acquire(TA.Untracked,e,i,r,n,s,rG)}static acquireTracked(e,i,r,n){return this.pool.acquire(TA.Tracked,e,i,r,null,null,n)}notify(e,i){this.type===TA.Untracked?this.callback.call(this.target,e,i,this.path,this.target):this.callback.call(null,e,i,void 0,void 0)}acquire(e,i,r,n,s,o,a){this.uid=xc(),this.removed=!1,this.type=e,this.oldValue=i,this.callback=r,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=xc(),this.removed=!0}};yP.pool=new gae(yP);const H$=new fc,fg=new Set;let CL;function EL(t){fg.delete(t),fg.add(t),CL||(CL=A3(eCe))}function KSe(t){if(t.removed)return;const e=t.oldValue,i=t.getValue();t.equals(e,i)||(t.oldValue=i,t.notify(i,e))}function QSe(t){for(const e of fg.values())e.target===t&&(e.removed=!0)}function eCe(){let t=10;for(;CL&&t--;){CL=null;const e=tCe(),i=H$.acquire();for(const r of e){const n=r.uid;KSe(r),n===r.uid&&r.removed&&i.push(r)}for(const r of fg)r.removed&&(i.push(r),fg.delete(r));for(const r of i)yP.pool.release(r);H$.release(i),H$.release(e),x8.forEach(r=>r())}}function tCe(){const t=H$.acquire();t.length=fg.size;let e=0;for(const i of fg)t[e]=i,++e;return fg.clear(),t}const x8=new Set;function Pae(t){return x8.add(t),{remove(){x8.delete(t)}}}function iCe(t,e,i){let r=tae(t,e,i,(n,s,o)=>{let a,l,c=Sae(()=>x3(n,s),(u,p)=>{n.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=yP.acquireUntracked(u,o,p,n,s),l=a.uid),EL(a))});return{remove:nG(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,EL(a)),a=null),r=c=null})}});return r}function rCe(t,e,i){const r=tae(t,e,i,(n,s,o)=>{let a=!1;return Tae(()=>x3(n,s),(l,c)=>{n.__accessor__.destroyed?r.remove():a||(a=!0,rG(c,l)||o.call(n,l,c,s,n),a=!1)})});return r}function nCe(t,e,i,r=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:r?rCe(t,e,i):iCe(t,e,i)}function sCe(t,e,i){let r,n,s=Sae(t,(o,a)=>{r&&r.uid!==n?s.remove():(r||(r=yP.acquireTracked(o,e,a,i),n=r.uid),EL(r))});return{remove:nG(()=>{s.remove(),r&&(r.uid!==n||r.removed||(r.removed=!0,EL(r)),r=null),s=null})}}function oCe(t,e,i){let r=!1;return Tae(t,(n,s)=>{r||(r=!0,i(s,n)||e(n,s),r=!1)})}function aCe(t,e,i=!1,r=Qoe){return i?oCe(t,e,r):sCe(t,e,r)}function jZ(t){return j$(fg,e=>e.oldValue===t)}function Yo(t,e){for(const[i,r]of t)if(e(r,i))return!0;return!1}function tmt(t,e){for(const[i,r]of t)if(e(r,i))return r;return null}function Oae(t,e,i){const r=t.get(e);if(r!==void 0)return r;const n=i();return t.set(e,n),n}const F2=ye.getLogger("esri.core.accessorSupport.ensureTypes");function lCe(t){return t==null?t:new Date(t)}function cCe(t){return t==null?t:!!t}function uCe(t){return t==null?t:t.toString()}function Vd(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function lG(t){return t==null?t:Math.round(parseFloat(t))}function Rae(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function AL(t,e){return e!=null&&t&&!(e instanceof t)}function Mae(t){return t&&"isCollection"in t}function HZ(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function hCe(t,e){if(!e||!e.constructor||!Mae(e.constructor))return T8(t,e)?e:new t(e);const i=HZ(t.prototype.itemType),r=HZ(e.constructor.prototype.itemType);return i?r?i===r?e:i.prototype.isPrototypeOf(r.prototype)?new t(e):(T8(t,e),e):new t(e):e}function T8(t,e){return!!Rae(e)&&(F2.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+t5(t)+"'"),!0)}function uT(t,e){return e==null?e:Mae(t)?hCe(t,e):AL(t,e)?T8(t,e)?e:new t(e):e}function t5(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const dCe=new WeakMap;function pCe(t){switch(t){case Number:return Vd;case js:return lG;case Boolean:return cCe;case String:return uCe;case Date:return lCe;default:return Oae(dCe,t,()=>uT.bind(null,t))}}function rl(t,e){const i=pCe(t);return arguments.length===1?i:i(e)}function vP(t,e,i){return arguments.length===1?vP.bind(null,t):e&&(Array.isArray(e)?e.map(r=>t(r,i)):[t(e,i)])}function fCe(t,e){return arguments.length===1?vP(i=>rl(t,i)):vP(i=>rl(t,i),e)}function $ae(t,e,i){return e!==0&&Array.isArray(i)?i.map(r=>$ae(t,e-1,r)):t(i)}function PL(t,e,i){if(arguments.length===2)return s=>PL(t,e,s);if(!i)return i;i=$ae(t,e,i);let r=e,n=i;for(;r>0&&Array.isArray(n);)r--,n=n[0];if(n!==void 0)for(let s=0;s<r;s++)i=[i];return i}function mCe(t,e,i){return arguments.length===2?PL(r=>rl(t,r),e):PL(r=>rl(t,r),e,i)}function Iae(t){return!!Array.isArray(t)&&!t.some(e=>{const i=typeof e;return!(i==="string"||i==="number"||i==="function"&&t.length>1)})}function S8(t,e){if(arguments.length===2)return S8(t).call(null,e);const i=new Set,r=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||i.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(i.has(a)||n.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&n.some(p=>!AL(a,p))?a:(u&&r.length?(s||(s=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),F2.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(p=>t5(p)).join(", ")),F2.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):F2.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function ry(t,e){if(arguments.length===2)return ry(t).call(null,e);const i={},r=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];i[l]=rl(c),r.push(t5(c)),n.push(l)}const s=()=>`'${r.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!AL(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=i[c];if(!u)return F2.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!AL(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!Rae(l)){const p={};for(const f in l)f!==t.key&&(p[f]=l[f]);return u(p)}return u(l)}}let js=class{};const rmt={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function gCe(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function Lae(t){switch(t.type){case"native":return rl(t.value);case"array":return vP(Lae(t.value));case"one-of":return _Ce(t);default:return null}}function _Ce(t){let e=null;return(i,r)=>E8(i,t)?i:(e==null&&(e=C8(t)),F2.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),r&&(r.valid=!1),null)}function C8(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case js:return"integer";case Date:return"date";default:return t5(t.value)}case"array":return`array of ${C8(t.value)}`;case"one-of":{const e=t.values.map(i=>C8(i));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function E8(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case js:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(i=>!E8(i,e.value));case"one-of":return e.values.some(i=>E8(t,i))}}function m(t={}){return(e,i)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(e,i),n=YN(e,i);r&&(r.get||r.set?(n.get=r.get||n.get,n.set=r.set||n.set):"value"in r&&("value"in t&&ye.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=r.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let p=vL(this,l);if(typeof p=="function"){u||(u=l.split(".").slice(0,-1).join("."));const f=vL(this,u);f&&(p=p.bind(f))}return p},n.readOnly||(n.set=c?function(p){this._override(i,p)}:function(p){wL(this,l,p)})}const o=t.type,a=t.types;n.cast||(o?n.cast=yCe(o):a&&(Array.isArray(a)?n.cast=vP(ry(a[0])):n.cast=ry(a))),cSe(n,t),t.range&&(n.cast=vCe(n.cast,t.range))}}function Dae(t,e,i){const r=YN(t,i);r.json||(r.json={});let n=r.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function yCe(t){let e=0,i=t;if(gCe(t))return Lae(t);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],e++;const r=i;if(Iae(r))return e===0?S8(r):PL(S8(r),e);if(e===1)return fCe(r);if(e>1)return mCe(r,e);const n=t;return n.from?n.from:rl(n)}function vCe(t,e){return i=>{let r=+t(i);return e.step!=null&&(r=Math.round(r/e.step)*e.step),e.min!=null&&(r=Math.max(e.min,r)),e.max!=null&&(r=Math.min(e.max,r)),r}}function bCe(t){if(t.json&&t.json.origins){const e=t.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(e[r]){const n=e[r];i[r].forEach(s=>{e[s]=n}),delete e[r]}}}let tb=class extends fae{constructor(e,i,r){super(e,i,r)}};tb.prototype.type="warning";function Nae(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const A8=ye.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function WZ(t,e,i){var r,n;t&&(!i&&!e.read||(r=e.read)!=null&&r.reader||((n=e.read)==null?void 0:n.enabled)===!1||TCe(t)&&rS("read.reader",Fae(t),e))}function Fae(t){var i,r;const e=t.ndimArray??0;if(e>1)return xCe(t);if(e===1)return qZ(t);if("type"in t&&Uae(t.type)){const n=(r=(i=t.type.prototype)==null?void 0:i.itemType)==null?void 0:r.Type,s=qZ(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return cG(t)}function cG(t){return"type"in t?wCe(t.type):SCe(t.types)}function wCe(t){return t.prototype.read?(e,i,r)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void A8.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,r),s}:t.fromJSON}function kae(t,e,i,r){return r!==0&&Array.isArray(e)?e.map(n=>kae(t,n,i,r-1)):t(e,void 0,i)}function xCe(t){const e=cG(t),i=kae.bind(null,e),r=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=i(n,o,r);let a=r,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function qZ(t){const e=cG(t);return(i,r,n)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(i,void 0,n);return s!==void 0?[s]:void 0}}function Uae(t){if(!Nae(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?uG(e.Type):zae(e.Type))}function TCe(t){return"types"in t?zae(t.types):uG(t.type)}function uG(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||Uae(t))}function zae(t){for(const e in t.typeMap)if(!uG(t.typeMap[e]))return!1;return!0}function SCe(t){let e=null;const i=t.errorContext??"type";return(r,n,s)=>{if(r==null)return r;const o=typeof r;if(o!=="object")return void A8.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=CCe(t));const a=t.key;if(typeof a!="string")return;const l=r[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const p=`Type '${l||"unknown"}' is not supported`;return s&&s.messages&&r&&s.messages.push(new tb(`${i}:unsupported`,p,{definition:r,context:s})),void A8.error(p)}const u=new c;return u.read(r,s),u}}function CCe(t){var i,r;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=T3(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(i=a.json)!=null&&i.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){e[n]=s;continue}const c=l.target,u=typeof c=="string"?c:t.key,p={};l.writer(n,p,u),p[u]&&(e[p[u]]=s)}return e}function ECe(t){if(t.json||(t.json={}),XZ(t.json),YZ(t.json),ZZ(t.json),t.json.origins)for(const e in t.json.origins)XZ(t.json.origins[e]),YZ(t.json.origins[e]),ZZ(t.json.origins[e]);return!0}function ZZ(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function XZ(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function YZ(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function JZ(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const i=(t==null?void 0:t.ndimArray)??0;t&&(i===1||"type"in t&&Nae(t.type))?e.write.writer=OCe:i>1?e.write.writer=RCe(i):e.types?Array.isArray(e.types)?e.write.writer=PCe(e.types[0]):e.write.writer=ACe(e.types):e.write.writer=bP}function ACe(t){return(e,i,r,n)=>e?Bae(e,t,n)?bP(e,i,r,n):void 0:bP(e,i,r,n)}function Bae(t,e,i){for(const r in e.typeMap)if(t instanceof e.typeMap[r])return!0;if(i!=null&&i.messages){const r=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&t&&i.messages.push(new ce(`${r}:unsupported`,n,{definition:t,context:i})),ye.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function PCe(t){return(e,i,r,n)=>!e||!Array.isArray(e)?bP(e,i,r,n):bP(e.filter(s=>Bae(s,t,n)),i,r,n)}function bP(t,e,i,r){rS(i,OL(t,r),e)}function OL(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?RL(t):t}function RL(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function OCe(t,e,i,r){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>OL(s,r)),typeof n.toArray=="function"&&(n=n.toArray())):n=[OL(t,r)],rS(i,n,e)}function Vae(t,e,i){return i!==0&&Array.isArray(t)?t.map(r=>Vae(r,e,i-1)):OL(t,e)}function RCe(t){return(e,i,r,n)=>{let s;if(e===null)s=null;else{s=Vae(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}rS(r,s,i)}}function MCe(t,e){return hG(t,"any",e==null?void 0:e.origin)}function P8(t,e){return hG(t,"read",e==null?void 0:e.origin)}function Gae(t,e){return hG(t,"write",e==null?void 0:e.origin)}function hG(t,e,i){let r=t==null?void 0:t.json;if(r!=null&&r.origins&&i){let n;n=i==="link-chart"?r.origins[i]&&(e==="any"||e in r.origins[i])?r.origins[i]:r.origins["web-map"]:r.origins[i],n&&(e==="any"||e in n)&&(r=n)}return r}function $Ce(t){const e=ICe(t);if(t.json.origins)for(const i in t.json.origins){const r=t.json.origins[i],n=r.types?LCe(r):e;WZ(n,r,!1),r.types&&!r.write&&t.json.write&&t.json.write.enabled&&(r.write={...t.json.write}),JZ(n,r)}WZ(e,t.json,!0),JZ(e,t.json)}function ICe(t){return t.json.types?O8(t.json):t.type?jae(t):O8(t)}function LCe(t){return t.type?jae(t):O8(t)}function jae(t){if(!t.type)return;let e=0,i=t.type;for(;Array.isArray(i)&&!Iae(i);)i=i[0],e++;return{type:i,ndimArray:e}}function O8(t){if(!t.types)return;let e=0,i=t.types;for(;Array.isArray(i);)i=i[0],e++;return{types:i,ndimArray:e}}function DCe(t){ECe(t)&&(bCe(t),$Ce(t))}const MF=new Set,$F=new Set;function J(t){return e=>{e.prototype.declaredClass=t,FCe(e);const i=[],r=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!MF.has(n.initialize)&&(MF.add(n.initialize),i.push(n.initialize)),n.hasOwnProperty("destroy")&&!$F.has(n.destroy)&&($F.add(n.destroy),r.push(n.destroy)),n=Object.getPrototypeOf(n);MF.clear(),$F.clear();class s extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;const c=this[joe];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<r.length;u++)r[u].call(this)}}})}this.postscript(...a)}}}return s.__accessorMetadata__=T3(e.prototype),s.prototype.declaredClass=t,s}}function NCe(t,e){return e.get==null?function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r===void 0)return;hi(r.observerObject);const n=i.store;return n.has(t)?n.get(t):r.metadata.value}:function(){const i=this.__accessor__,r=i.propertiesByName.get(t);if(r!==void 0)return r.getComputed(i)}}function FCe(t){const e=t.prototype,i=T3(e),r={};for(const n of Object.getOwnPropertyNames(i)){const s=i[n];DCe(s),r[n]={enumerable:!0,configurable:!0,get:NCe(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===og.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,r)}var Hae,Wae;function kCe(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const V0=Symbol("Accessor-Handles"),R8=Symbol("Accessor-Initialized");let ke=class qae{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}T3(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let p;this.inherited=function(...f){if(s.prototype[a])return s.prototype[a].apply(this,f)};try{p=l.apply(this,c)}catch(f){throw this.inherited=u,f}return this.inherited=u,p}:e[a]}for(const a in i){const l=kCe(i[a]);m(l)(o.prototype,a)}return J(r)(o)}constructor(...e){if(this[Hae]=null,this[Wae]=!1,this.constructor===qae)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const i=new SSe(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:i}),e.length>0&&this.normalizeCtorArgs&&(i.ctorArgs=this.normalizeCtorArgs.apply(this,e)),KZ.register(this,i.propertiesByName,this)}postscript(e){const i=this.__accessor__,r=i.ctorArgs||e;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize(),this[R8]=!0}initialize(){}[joe](){this[V0]=Je(this[V0])}destroy(){var e;this.destroyed||(KZ.unregister(this),QSe(this),this.__accessor__.destroy(),(e=MSe())==null||e.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[R8]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return vL(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,i){return wL(this,e,i),this}watch(e,i,r){return nCe(this,e,i,r)}own(e){this.addHandles(e)}addHandles(e,i){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let r=this[V0];r==null&&(r=this[V0]=new an),r.add(e,i)}removeHandles(e){const i=this[V0];i!=null&&i.remove(e)}removeAllHandles(){const e=this[V0];e!=null&&e.removeAll()}hasHandles(e){const i=this[V0];return i!=null&&i.has(e)}_override(e,i){i===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,i){i==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,i)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,i){return this.__accessor__.internalSet(e,i),this}};Hae=V0,Wae=R8;const KZ=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()}),em=t=>{let e=class extends t{clone(){var l;const i=uc(iy(this),"unable to clone instance of non-accessor class"),r=i.metadatas,n=i.store,s={},o=new Map;for(const c in r){const u=r[c],p=n==null?void 0:n.originOf(c),f=u.clonable;if(u.readOnly||f===!1||p!==Sr.USER&&p!==Sr.DEFAULTS&&p!==Sr.WEB_MAP&&p!==Sr.WEB_SCENE)continue;const y=this[c];let v=null;v=typeof f=="function"?f(y):f==="reference"?y:h8(y),y!=null&&v==null||(p===Sr.DEFAULTS?o.set(c,v):s[c]=v)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=iy(a))==null?void 0:l.store;if(c)for(const[u,p]of o)c.set(u,p,Sr.DEFAULTS)}return a}};return e=d([J("esri.core.Clonable")],e),e};let QZ=class extends em(ke){};QZ=d([J("esri.core.Clonable")],QZ);function I(){return[0,0,0]}function Kn(t){return[t[0],t[1],t[2]]}function Ge(t,e,i){return[t,e,i]}function Za(t){const e=I(),i=Math.min(3,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function dG(t,e){return new Float64Array(t,e,3)}function Zae(){return I()}function Xae(){return Ge(1,1,1)}function Yae(){return Ge(1,0,0)}function Jae(){return Ge(0,1,0)}function pG(){return Ge(0,0,1)}const tl=Zae(),ug=Xae(),Kae=Yae(),Qae=Jae(),fG=pG();Object.freeze(Object.defineProperty({__proto__:null,ONES:ug,UNIT_X:Kae,UNIT_Y:Qae,UNIT_Z:fG,ZEROS:tl,clone:Kn,create:I,createView:dG,fromArray:Za,fromValues:Ge,ones:Xae,unitX:Yae,unitY:Jae,unitZ:pG,zeros:Zae},Symbol.toStringTag,{value:"Module"}));let mG=1e-6;function ol(){return mG}function UCe(t){mG=t}const P3=Math.random,zCe=Math.PI/180,BCe=180/Math.PI;function i5(t){return t*zCe}function VCe(t){return t*BCe}function GCe(t,e){return Math.abs(t-e)<=mG*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:P3,equals:GCe,getEpsilon:ol,setEpsilon:UCe,toDegree:VCe,toRadian:i5},Symbol.toStringTag,{value:"Module"}));function ze(t){const e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function fe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function me(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t}function xe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ce(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function r5(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function ML(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function jCe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function ele(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function $L(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function tle(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function gG(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function HCe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function WCe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function pe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function P1(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Nr(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(i*i+r*r+n*n)}function Io(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function ba(t){const e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}function Ea(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function qCe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Me(t,e){const i=e[0],r=e[1],n=e[2];let s=i*i+r*r+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function Re(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Rt(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];return t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o,t}function pr(t,e,i,r){const n=e[0],s=e[1],o=e[2];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t}function ZCe(t,e,i,r,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+i[0]*l+r[0]*c+n[0]*u,t[1]=e[1]*a+i[1]*l+r[1]*c+n[1]*u,t[2]=e[2]*a+i[2]*l+r[2]*c+n[2]*u,t}function XCe(t,e,i,r,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,p=3*l*o,f=l*s;return t[0]=e[0]*c+i[0]*u+r[0]*p+n[0]*f,t[1]=e[1]*c+i[1]*u+r[1]*p+n[1]*f,t[2]=e[2]*c+i[2]*u+r[2]*p+n[2]*f,t}function YCe(t,e){e=e||1;const i=P3,r=2*i()*Math.PI,n=2*i()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function st(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12],t[1]=i[1]*r+i[5]*n+i[9]*s+i[13],t[2]=i[2]*r+i[6]*n+i[10]*s+i[14],t}function yc(t,e,i){const r=e[0],n=e[1],s=e[2];return t[0]=r*i[0]+n*i[3]+s*i[6],t[1]=r*i[1]+n*i[4]+s*i[7],t[2]=r*i[2]+n*i[5]+s*i[8],t}function Mh(t,e,i){const r=i[0],n=i[1],s=i[2],o=i[3],a=e[0],l=e[1],c=e[2];let u=n*c-s*l,p=s*a-r*c,f=r*l-n*a,y=n*f-s*p,v=s*u-r*f,b=r*p-n*u;const x=2*o;return u*=x,p*=x,f*=x,y*=2,v*=2,b*=2,t[0]=a+u+y,t[1]=l+p+v,t[2]=c+f+b,t}function JCe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0],s[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),s[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function KCe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),s[1]=n[1],s[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function QCe(t,e,i,r){const n=[],s=[];return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],s[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),s[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),s[2]=n[2],t[0]=s[0]+i[0],t[1]=s[1]+i[1],t[2]=s[2]+i[2],t}function ile(t,e){fe(eR,t),fe(tR,e),Me(eR,eR),Me(tR,tR);const i=Re(eR,tR);return i>1?0:i<-1?Math.PI:Math.acos(i)}const eR=I(),tR=I();function eEe(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function xa(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function ny(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=ol();return Math.abs(i-s)<=l*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=l*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function zg(t,e,i){const r=i[0]-e[0],n=i[1]-e[1],s=i[2]-e[2];let o=r*r+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=r*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const uo=Ce,tEe=r5,iEe=ML,O3=Nr,n5=Io,ac=ze,M8=ba,eX=Object.freeze(Object.defineProperty({__proto__:null,abs:$L,add:xe,angle:ile,bezier:XCe,ceil:jCe,copy:fe,cross:Rt,direction:zg,dist:O3,distance:Nr,div:iEe,divide:ML,dot:Re,equals:ny,exactEquals:xa,floor:ele,hermite:ZCe,inverse:qCe,len:ac,length:ze,lerp:pr,max:HCe,min:gG,mul:tEe,multiply:r5,negate:Ea,normalize:Me,random:YCe,rotateX:JCe,rotateY:KCe,rotateZ:QCe,round:WCe,scale:pe,scaleAndAdd:P1,set:me,sign:tle,sqrDist:n5,sqrLen:M8,squaredDistance:Io,squaredLength:ba,str:eEe,sub:uo,subtract:Ce,transformMat3:yc,transformMat4:st,transformQuat:Mh},Symbol.toStringTag,{value:"Module"}));function Ah(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Br(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function _G(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function rle(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function nle(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function sle(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function rEe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function nEe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function sEe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t}function oEe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t}function aEe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function ib(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function lEe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}function ole(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(i*i+r*r+n*n+s*s)}function IL(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return i*i+r*r+n*n+s*s}function yG(t){const e=t[0],i=t[1],r=t[2],n=t[3];return Math.sqrt(e*e+i*i+r*r+n*n)}function vG(t){const e=t[0],i=t[1],r=t[2],n=t[3];return e*e+i*i+r*r+n*n}function cEe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function uEe(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ale(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*i+r*r+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=i*o,t[1]=r*o,t[2]=n*o,t[3]=s*o),t}function lle(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function bG(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t[2]=o+r*(i[2]-o),t[3]=a+r*(i[3]-a),t}function hEe(t,e){const i=P3;let r,n,s,o,a,l;e=e||1;do r=2*i()-1,n=2*i()-1,a=r*r+n*n;while(a>=1);do s=2*i()-1,o=2*i()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*r,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function hu(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3];return t[0]=i[0]*r+i[4]*n+i[8]*s+i[12]*o,t[1]=i[1]*r+i[5]*n+i[9]*s+i[13]*o,t[2]=i[2]*r+i[6]*n+i[10]*s+i[14]*o,t[3]=i[3]*r+i[7]*n+i[11]*s+i[15]*o,t}function dEe(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2],c=i[3],u=c*r+a*s-l*n,p=c*n+l*r-o*s,f=c*s+o*n-a*r,y=-o*r-a*n-l*s;return t[0]=u*c+y*-o+p*-l-f*-a,t[1]=p*c+y*-a+f*-o-u*-l,t[2]=f*c+y*-l+u*-a-p*-o,t[3]=e[3],t}function pEe(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function k2(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function LL(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ol();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}const fEe=rle,mEe=nle,gEe=sle,_Ee=ole,yEe=IL,vEe=yG,bEe=vG,cle=Object.freeze(Object.defineProperty({__proto__:null,add:_G,ceil:rEe,copy:Ah,dist:_Ee,distance:ole,div:gEe,divide:sle,dot:lle,equals:LL,exactEquals:k2,floor:nEe,inverse:uEe,len:vEe,length:yG,lerp:bG,max:oEe,min:sEe,mul:mEe,multiply:nle,negate:cEe,normalize:ale,random:hEe,round:aEe,scale:ib,scaleAndAdd:lEe,set:Br,sqrDist:yEe,sqrLen:bEe,squaredDistance:IL,squaredLength:vG,str:pEe,sub:fEe,subtract:rle,transformMat4:hu,transformQuat:dEe},Symbol.toStringTag,{value:"Module"})),tX=new Float32Array(1);function wEe(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function $e(t,e,i){return Math.min(Math.max(t,e),i)}function rb(t){return(t&t-1)==0}function omt(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function amt(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Bt(t,e,i){return t+(e-t)*i}function Qt(t){return t*Math.PI/180}function nl(t){return 180*t/Math.PI}function $8(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function qs(t){return Math.acos($e(t,-1,1))}function Nh(t){return Math.asin($e(t,-1,1))}function U2(t,e,i=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=i}const DL=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function I8(t){return DL.setFloat64(0,t),DL.getBigInt64(0)}function xEe(t){return DL.setBigInt64(0,t),DL.getFloat64(0)}const W$=BigInt("1000000"),TEe=ule(1);function ule(t){const e=I8(t=Math.abs(t)),i=xEe(e<=W$?W$:e-W$);return Math.abs(t-i)}function lmt(t,e,i=TEe){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(i!=null&&ule(Math.min(Math.abs(t),Math.abs(e)))<i)return Math.abs(t-e)<=i;const r=I8(t),n=I8(e);return r<0!=n<0?!1:!((r<n?n-r:r-n)>W$)}function SEe(t,e,i=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const r=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(r>.01*i)return!1}else if(r/(n+s)>i)return!1;return!0}function CEe(t){return hle(Math.max(-L8,Math.min(t,L8)))}function hle(t){return tX[0]=t,tX[0]}function wP(t,e,i){const r=$e((i-t)/(e-t),0,1);return r*r*(3-2*r)}function iX(t,e){const i=ze(t),r=Nh(t[2]/i),n=Math.atan2(t[1]/i,t[0]/i);return me(e,i,r,n),e}function cmt(t,e,i){return Br(t,e[0],e[1],e[2],e[3]*i)}function umt(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],r=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(U2(e,1)&&U2(i,1)&&U2(r,1))}const L8=hle(34028234663852886e22);let sy=class{constructor(e,i){this.min=e,this.max=i,this.range=i-e}ndiff(e,i=0){return Math.ceil((e-i)/this.range)*this.range+i}_normalize(e,i,r,n=0,s=!1){return(r-=n)<e?r+=this.ndiff(e-r):r>i&&(r-=this.ndiff(r-i)),s&&r===i&&(r=e),r+n}normalize(e,i=0,r=!1){return this._normalize(this.min,this.max,e,i,r)}clamp(e,i=0){return $e(e-i,this.min,this.max)+i}monotonic(e,i,r){return e<i?i:i+this.ndiff(e-i,r)}minimalMonotonic(e,i,r){return this._normalize(e,e+this.range,i,r)}center(e,i,r){return i=this.monotonic(e,i,r),this.normalize((e+i)/2,r)}diff(e,i,r){return this.monotonic(e,i,r)-e}shortestSignedDiff(e,i){e=this.normalize(e);const r=(i=this.normalize(i))-e,n=i<e?this.minimalMonotonic(e,i)-e:i-this.minimalMonotonic(i,e);return Math.abs(r)<Math.abs(n)?r:n}contains(e,i,r){return i=this.minimalMonotonic(e,i),(r=this.minimalMonotonic(e,r))>e&&r<i}};function wG(t){for(const e in t){const i=t[e];i instanceof Function&&(t[e]=i.bind(t))}return t}const EEe=wG(new sy(0,2*Math.PI)),oy=wG(new sy(-Math.PI,Math.PI)),xG=wG(new sy(0,360));let AEe=class dle{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const i=new dle;return this._values.forEach((r,n)=>{e&&e.has(n)||i.set(n,Le(r.value),r.origin)}),i}get(e,i){i=this._normalizeOrigin(i);const r=this._values.get(e);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(e){var i;return((i=this._values.get(e))==null?void 0:i.origin)??Sr.USER}keys(e){e=this._normalizeOrigin(e);const i=[...this._values.keys()];return e==null?i:i.filter(r=>{var n;return((n=this._values.get(r))==null?void 0:n.origin)===e})}set(e,i,r){if((r=this._normalizeOrigin(r))===Sr.DEFAULTS){const n=this._values.get(e);if(n&&n.origin!=null&&n.origin>r)return}this._values.set(e,new PEe(i,r))}delete(e,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(e))==null?void 0:r.origin)!==i||this._values.delete(e)}has(e,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(e))==null?void 0:r.origin)===i:this._values.has(e)}forEach(e){this._values.forEach(({value:i},r)=>e(i,r))}_normalizeOrigin(e){if(e!=null)return e===Sr.DEFAULTS?e:Sr.USER}},PEe=class{constructor(e,i){this.value=e,this.origin=i}};function OEe(t,e,i){e.keys().forEach(n=>{i.set(n,e.get(n),Sr.DEFAULTS)});const r=t.metadatas;Object.keys(r).forEach(n=>{t.internalGet(n)&&i.set(n,t.internalGet(n),Sr.DEFAULTS)})}function REe(t,e,i){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const r=t.read.source;if(typeof r=="string"){if(r===e||r.includes(".")&&r.indexOf(e)===0&&IZ(r,i))return!0}else for(const n of r)if(n===e||n.includes(".")&&n.indexOf(e)===0&&IZ(n,i))return!0;return!1}function MEe(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function $Ee(t,e,i,r,n){let s=P8(e[i],n);MEe(s)&&(t[i]=!0);for(const o of Object.getOwnPropertyNames(e))s=P8(e[o],n),REe(s,i,r)&&(t[o]=!0)}function IEe(t,e,i,r){const n=i.metadatas,s=MCe(n[e],r),o=s==null?void 0:s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,r):o;a!==void 0&&i.set(e,a)}const ple={origin:"service"};function LEe(t,e,i=ple){if(!e||typeof e!="object")return;const r=iy(t),n=r.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))$Ee(s,n,o,e,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(s)){const a=P8(n[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?x3(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||IEe(t,o,r,i)}r.setDefaultOrigin("user")}function pmt(t,e,i,r=ple){var s;const n={...r,messages:[]};i(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?r&&r.messages&&r.messages.push(o):t.loadWarnings.push(o)})}function DEe(t,e,i,r,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,r,s,i,n),s}function fle(t,e,i,r,n,s){if(!r||!r.write)return!1;const o=t.get(i);if(!n&&r.write.overridePolicy){const a=r.write.overridePolicy.call(t,o,i,s??void 0);a!==void 0&&(n=a)}if(n||(n=r.write),!n||n.enabled===!1)return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new ce("web-document-write:property-required",`Missing value for required property '${i}' on '${t.declaredClass}'`,{propertyName:i,target:t});return a&&s&&s.messages?s.messages.push(a):a&&!s&&ye.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(i)===Sr.DEFAULTS)&&NEe(t,i,s,r,o)||!n.ignoreOrigin&&s&&s.origin&&e.store.multipleOriginsSupported&&e.store.originOf(i)<lae(s.origin))}function NEe(t,e,i,r,n){const s=r.default;if(s===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,i??void 0);return Ag(o,n)}return!1}return s===n}function fmt(t,e,i,r){const n=iy(t),s=n.metadatas,o=Gae(s[e],r);return!!o&&fle(t,n,e,o,i,r)}function FEe(t,e,i){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return B$(e,t.toJSON(i));const r=iy(t),n=r.metadatas;for(const a in n){const l=Gae(n[a],i);if(!fle(t,r,a,l,void 0,i))continue;const c=t.get(a),u=DEe(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(u).length>0&&(e=B$(e,u),(o=(s=i==null?void 0:i.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&i.resources.pendingOperations.push(Promise.all(i.resources.pendingOperations).then(()=>B$(e,u,()=>"replace-arrays"))),i&&i.writtenProperties&&i.writtenProperties.push({target:t,propName:a,oldOrigin:ySe(r.store.originOf(a)),newOrigin:i.origin}))}return e}const R3=t=>{let e=class extends t{constructor(...i){super(...i);const r=iy(this),n=r.store,s=new AEe;r.store=s,OEe(r,n,s)}read(i,r){LEe(this,i,r)}write(i,r){return FEe(this,i??{},r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return kEe.call(this,i,r)}};return e=d([J("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function kEe(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(t,e),i}let Nt=class extends R3(ke){};Nt=d([J("esri.core.JSONSupport")],Nt);const UEe=Object.prototype.toString;function zEe(t){const e="__accessorMetadata__"in t?rl(t):t;return function(...i){if(i.push(e),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return BEe.apply(this,i)}}function BEe(t,e,i,r){YN(t,e).cast=r}function VEe(t){return(e,i)=>{YN(e,t).cast=e[i]}}function Sn(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&UEe.call(t[0])==="[object Function]"?zEe(t[0]):t.length===1&&typeof t[0]=="string"?VEe(t[0]):void 0}function yr(t,e,i){let r,n;return e===void 0||Array.isArray(e)?(n=t,i=e,r=[void 0]):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;r.forEach(l=>{const c=Dae(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function Pr(t,e,i){let r,n;return e===void 0?(n=t,r=[void 0]):typeof e!="string"?(n=t,r=[void 0],i=e):(n=e,r=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of r){const c=Dae(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}let Tu=class{constructor(e,i={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=i,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,n,s)=>{const o=this.toJSON(r);o!==void 0&&rS(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const i=this._apiToJSON[e];return this._options.useNumericKeys?+i:i}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const i={};for(const r in e)i[e[r]]=r;return i}_getKeysSorted(e){const i=[];for(const r in e)i.push(r);return i.sort(),i}};function Ou(){return function(t,e){return new Tu(t,{ignoreUnknown:!0,...e})}}let TG=class{constructor(e,i,r,n){this.semiMajorAxis=e,this.flattening=i,this.outerAtmosphereRimWidth=r;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const vi=new TG(6378137,1/298.257223563,3e5,.006694379990137799),$f=new TG(3396190,1/169.8944472236118,23e4),Og=new TG(1737400,0,0);var Th;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Th||(Th={}));let g;const z={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(g=2e3;g<=2045;g++)z[g]=0;for(g=2056;g<=2065;g++)z[g]=0;for(g=2067;g<=2135;g++)z[g]=0;for(g=2137;g<=2154;g++)z[g]=0;for(g=2161;g<=2170;g++)z[g]=0;for(g=2172;g<=2193;g++)z[g]=0;for(g=2195;g<=2198;g++)z[g]=0;for(g=2200;g<=2203;g++)z[g]=0;for(g=2205;g<=2217;g++)z[g]=0;for(g=2222;g<=2224;g++)z[g]=1;for(g=2225;g<=2250;g++)z[g]=2;for(g=2251;g<=2253;g++)z[g]=1;for(g=2257;g<=2264;g++)z[g]=2;for(g=2274;g<=2279;g++)z[g]=2;for(g=2280;g<=2282;g++)z[g]=1;for(g=2283;g<=2289;g++)z[g]=2;for(g=2290;g<=2292;g++)z[g]=0;for(g=2308;g<=2313;g++)z[g]=0;for(g=2315;g<=2491;g++)z[g]=0;for(g=2494;g<=2866;g++)z[g]=0;for(g=2867;g<=2869;g++)z[g]=1;for(g=2870;g<=2888;g++)z[g]=2;for(g=2891;g<=2895;g++)z[g]=2;for(g=2896;g<=2898;g++)z[g]=1;for(g=2902;g<=2908;g++)z[g]=2;for(g=2915;g<=2920;g++)z[g]=2;for(g=2921;g<=2923;g++)z[g]=1;for(g=2924;g<=2930;g++)z[g]=2;for(g=2931;g<=2962;g++)z[g]=0;for(g=2964;g<=2968;g++)z[g]=2;for(g=2969;g<=2973;g++)z[g]=0;for(g=2975;g<=2991;g++)z[g]=0;for(g=2995;g<=3051;g++)z[g]=0;for(g=3054;g<=3079;g++)z[g]=0;for(g=3081;g<=3088;g++)z[g]=0;for(g=3092;g<=3101;g++)z[g]=0;for(g=3106;g<=3138;g++)z[g]=0;for(g=3146;g<=3151;g++)z[g]=0;for(g=3153;g<=3166;g++)z[g]=0;for(g=3168;g<=3172;g++)z[g]=0;for(g=3174;g<=3203;g++)z[g]=0;for(g=3294;g<=3358;g++)z[g]=0;for(g=3367;g<=3403;g++)z[g]=0;for(g=3408;g<=3416;g++)z[g]=0;for(g=3417;g<=3438;g++)z[g]=2;for(g=3441;g<=3446;g++)z[g]=2;for(g=3447;g<=3450;g++)z[g]=0;for(g=3451;g<=3459;g++)z[g]=2;for(g=3460;g<=3478;g++)z[g]=0;for(g=3554;g<=3559;g++)z[g]=0;for(g=3560;g<=3570;g++)z[g]=2;for(g=3571;g<=3581;g++)z[g]=0;for(g=3594;g<=3597;g++)z[g]=0;for(g=3601;g<=3604;g++)z[g]=0;for(g=3637;g<=3639;g++)z[g]=0;for(g=3665;g<=3667;g++)z[g]=0;for(g=3693;g<=3695;g++)z[g]=0;for(g=3701;g<=3727;g++)z[g]=0;for(g=3728;g<=3739;g++)z[g]=2;for(g=3740;g<=3751;g++)z[g]=0;for(g=3753;g<=3760;g++)z[g]=2;for(g=3761;g<=3773;g++)z[g]=0;for(g=3775;g<=3777;g++)z[g]=0;for(g=3779;g<=3781;g++)z[g]=0;for(g=3783;g<=3785;g++)z[g]=0;for(g=3788;g<=3791;g++)z[g]=0;for(g=3797;g<=3802;g++)z[g]=0;for(g=3814;g<=3816;g++)z[g]=0;for(g=3825;g<=3829;g++)z[g]=0;for(g=3832;g<=3841;g++)z[g]=0;for(g=3844;g<=3852;g++)z[g]=0;for(g=3873;g<=3885;g++)z[g]=0;for(g=3890;g<=3893;g++)z[g]=0;for(g=3907;g<=3912;g++)z[g]=0;for(g=3942;g<=3950;g++)z[g]=0;for(g=3968;g<=3970;g++)z[g]=0;for(g=3973;g<=3976;g++)z[g]=0;for(g=3986;g<=3989;g++)z[g]=0;for(g=3994;g<=3997;g++)z[g]=0;for(g=4048;g<=4051;g++)z[g]=0;for(g=4056;g<=4063;g++)z[g]=0;for(g=4093;g<=4096;g++)z[g]=0;for(g=4390;g<=4398;g++)z[g]=0;for(g=4399;g<=4413;g++)z[g]=2;for(g=4418;g<=4433;g++)z[g]=2;for(g=4455;g<=4457;g++)z[g]=2;for(g=4484;g<=4489;g++)z[g]=0;for(g=4491;g<=4554;g++)z[g]=0;for(g=4568;g<=4589;g++)z[g]=0;for(g=4652;g<=4656;g++)z[g]=0;for(g=4766;g<=4800;g++)z[g]=0;for(g=5014;g<=5016;g++)z[g]=0;for(g=5069;g<=5072;g++)z[g]=0;for(g=5105;g<=5130;g++)z[g]=0;for(g=5173;g<=5188;g++)z[g]=0;for(g=5253;g<=5259;g++)z[g]=0;for(g=5269;g<=5275;g++)z[g]=0;for(g=5292;g<=5311;g++)z[g]=0;for(g=5329;g<=5331;g++)z[g]=0;for(g=5343;g<=5349;g++)z[g]=0;for(g=5355;g<=5357;g++)z[g]=0;for(g=5387;g<=5389;g++)z[g]=0;for(g=5459;g<=5463;g++)z[g]=0;for(g=5479;g<=5482;g++)z[g]=0;for(g=5518;g<=5520;g++)z[g]=0;for(g=5530;g<=5539;g++)z[g]=0;for(g=5550;g<=5552;g++)z[g]=0;for(g=5562;g<=5583;g++)z[g]=0;for(g=5623;g<=5625;g++)z[g]=2;for(g=5631;g<=5639;g++)z[g]=0;for(g=5649;g<=5653;g++)z[g]=0;for(g=5663;g<=5680;g++)z[g]=0;for(g=5682;g<=5685;g++)z[g]=0;for(g=5875;g<=5877;g++)z[g]=0;for(g=5896;g<=5899;g++)z[g]=0;for(g=5921;g<=5940;g++)z[g]=0;for(g=6050;g<=6125;g++)z[g]=0;for(g=6244;g<=6275;g++)z[g]=0;for(g=6328;g<=6348;g++)z[g]=0;for(g=6350;g<=6356;g++)z[g]=0;for(g=6366;g<=6372;g++)z[g]=0;for(g=6381;g<=6387;g++)z[g]=0;for(g=6393;g<=6404;g++)z[g]=0;for(g=6480;g<=6483;g++)z[g]=0;for(g=6511;g<=6514;g++)z[g]=0;for(g=6579;g<=6581;g++)z[g]=0;for(g=6619;g<=6624;g++)z[g]=0;for(g=6625;g<=6627;g++)z[g]=2;for(g=6628;g<=6632;g++)z[g]=0;for(g=6634;g<=6637;g++)z[g]=0;for(g=6669;g<=6692;g++)z[g]=0;for(g=6707;g<=6709;g++)z[g]=0;for(g=6720;g<=6723;g++)z[g]=0;for(g=6732;g<=6738;g++)z[g]=0;for(g=6931;g<=6933;g++)z[g]=0;for(g=6956;g<=6959;g++)z[g]=0;for(g=7005;g<=7007;g++)z[g]=0;for(g=7057;g<=7070;g++)z[g]=2;for(g=7074;g<=7082;g++)z[g]=0;for(g=7109;g<=7118;g++)z[g]=0;for(g=7119;g<=7127;g++)z[g]=1;for(g=7374;g<=7376;g++)z[g]=0;for(g=7528;g<=7586;g++)z[g]=0;for(g=7587;g<=7645;g++)z[g]=2;for(g=7692;g<=7696;g++)z[g]=0;for(g=7755;g<=7787;g++)z[g]=0;for(g=7791;g<=7795;g++)z[g]=0;for(g=7799;g<=7801;g++)z[g]=0;for(g=7803;g<=7805;g++)z[g]=0;for(g=7825;g<=7831;g++)z[g]=0;for(g=7845;g<=7859;g++)z[g]=0;for(g=8013;g<=8032;g++)z[g]=0;for(g=8065;g<=8068;g++)z[g]=1;for(g=8518;g<=8529;g++)z[g]=2;for(g=8533;g<=8536;g++)z[g]=2;for(g=8538;g<=8540;g++)z[g]=2;for(g=8677;g<=8679;g++)z[g]=0;for(g=8836;g<=8840;g++)z[g]=0;for(g=8857;g<=8859;g++)z[g]=0;for(g=8908;g<=8910;g++)z[g]=0;for(g=9154;g<=9159;g++)z[g]=0;for(g=9205;g<=9218;g++)z[g]=0;for(g=9271;g<=9273;g++)z[g]=0;for(g=9295;g<=9297;g++)z[g]=0;for(g=9356;g<=9360;g++)z[g]=0;for(g=9404;g<=9407;g++)z[g]=0;for(g=9476;g<=9482;g++)z[g]=0;for(g=9487;g<=9494;g++)z[g]=0;for(g=9697;g<=9699;g++)z[g]=0;for(g=9821;g<=9865;g++)z[g]=0;for(g=20002;g<=20032;g++)z[g]=0;for(g=20047;g<=20049;g++)z[g]=0;for(g=20062;g<=20092;g++)z[g]=0;for(g=20135;g<=20138;g++)z[g]=0;for(g=20248;g<=20258;g++)z[g]=0;for(g=20348;g<=20358;g++)z[g]=0;for(g=20436;g<=20440;g++)z[g]=0;for(g=20822;g<=20824;g++)z[g]=0;for(g=20904;g<=20932;g++)z[g]=0;for(g=20934;g<=20936;g++)z[g]=0;for(g=21004;g<=21032;g++)z[g]=0;for(g=21035;g<=21037;g++)z[g]=0;for(g=21095;g<=21097;g++)z[g]=0;for(g=21148;g<=21150;g++)z[g]=0;for(g=21207;g<=21264;g++)z[g]=0;for(g=21307;g<=21364;g++)z[g]=0;for(g=21413;g<=21423;g++)z[g]=0;for(g=21453;g<=21463;g++)z[g]=0;for(g=21473;g<=21483;g++)z[g]=0;for(g=21780;g<=21782;g++)z[g]=0;for(g=21891;g<=21894;g++)z[g]=0;for(g=21896;g<=21899;g++)z[g]=0;for(g=22171;g<=22177;g++)z[g]=0;for(g=22181;g<=22187;g++)z[g]=0;for(g=22191;g<=22197;g++)z[g]=0;for(g=22207;g<=22222;g++)z[g]=0;for(g=22234;g<=22236;g++)z[g]=0;for(g=22243;g<=22250;g++)z[g]=0;for(g=22262;g<=22265;g++)z[g]=0;for(g=22307;g<=22322;g++)z[g]=0;for(g=22348;g<=22357;g++)z[g]=0;for(g=22407;g<=22422;g++)z[g]=0;for(g=22462;g<=22465;g++)z[g]=0;for(g=22521;g<=22525;g++)z[g]=0;for(g=22607;g<=22622;g++)z[g]=0;for(g=22641;g<=22646;g++)z[g]=0;for(g=22648;g<=22657;g++)z[g]=0;for(g=22707;g<=22722;g++)z[g]=0;for(g=22762;g<=22765;g++)z[g]=0;for(g=22991;g<=22994;g++)z[g]=0;for(g=23028;g<=23038;g++)z[g]=0;for(g=23830;g<=23853;g++)z[g]=0;for(g=23866;g<=23872;g++)z[g]=0;for(g=23877;g<=23884;g++)z[g]=0;for(g=23886;g<=23894;g++)z[g]=0;for(g=23946;g<=23948;g++)z[g]=0;for(g=24311;g<=24313;g++)z[g]=0;for(g=24342;g<=24347;g++)z[g]=0;for(g=24370;g<=24374;g++)z[g]=10;for(g=24375;g<=24381;g++)z[g]=0;for(g=24718;g<=24721;g++)z[g]=0;for(g=24817;g<=24821;g++)z[g]=0;for(g=24877;g<=24882;g++)z[g]=0;for(g=24891;g<=24893;g++)z[g]=0;for(g=25391;g<=25395;g++)z[g]=0;for(g=25828;g<=25838;g++)z[g]=0;for(g=26191;g<=26195;g++)z[g]=0;for(g=26391;g<=26393;g++)z[g]=0;for(g=26701;g<=26722;g++)z[g]=0;for(g=26729;g<=26799;g++)z[g]=2;for(g=26801;g<=26803;g++)z[g]=2;for(g=26811;g<=26813;g++)z[g]=2;for(g=26847;g<=26870;g++)z[g]=2;for(g=26891;g<=26899;g++)z[g]=0;for(g=26901;g<=26923;g++)z[g]=0;for(g=26929;g<=26946;g++)z[g]=0;for(g=26948;g<=26998;g++)z[g]=0;for(g=27037;g<=27040;g++)z[g]=0;for(g=27205;g<=27232;g++)z[g]=0;for(g=27258;g<=27260;g++)z[g]=0;for(g=27391;g<=27398;g++)z[g]=0;for(g=27561;g<=27564;g++)z[g]=0;for(g=27571;g<=27574;g++)z[g]=0;for(g=27581;g<=27584;g++)z[g]=0;for(g=27591;g<=27594;g++)z[g]=0;for(g=28191;g<=28193;g++)z[g]=0;for(g=28348;g<=28358;g++)z[g]=0;for(g=28402;g<=28432;g++)z[g]=0;for(g=28462;g<=28492;g++)z[g]=0;for(g=29118;g<=29122;g++)z[g]=0;for(g=29168;g<=29172;g++)z[g]=0;for(g=29177;g<=29185;g++)z[g]=0;for(g=29187;g<=29195;g++)z[g]=0;for(g=29900;g<=29903;g++)z[g]=0;for(g=30161;g<=30179;g++)z[g]=0;for(g=30491;g<=30494;g++)z[g]=0;for(g=30729;g<=30732;g++)z[g]=0;for(g=31251;g<=31259;g++)z[g]=0;for(g=31265;g<=31268;g++)z[g]=0;for(g=31275;g<=31279;g++)z[g]=0;for(g=31281;g<=31297;g++)z[g]=0;for(g=31461;g<=31469;g++)z[g]=0;for(g=31491;g<=31495;g++)z[g]=0;for(g=31917;g<=31922;g++)z[g]=0;for(g=31965;g<=32e3;g++)z[g]=0;for(g=32001;g<=32003;g++)z[g]=2;for(g=32005;g<=32031;g++)z[g]=2;for(g=32033;g<=32060;g++)z[g]=2;for(g=32064;g<=32067;g++)z[g]=2;for(g=32074;g<=32077;g++)z[g]=2;for(g=32081;g<=32086;g++)z[g]=0;for(g=32107;g<=32130;g++)z[g]=0;for(g=32133;g<=32159;g++)z[g]=0;for(g=32164;g<=32167;g++)z[g]=2;for(g=32180;g<=32199;g++)z[g]=0;for(g=32201;g<=32260;g++)z[g]=0;for(g=32301;g<=32360;g++)z[g]=0;for(g=32601;g<=32662;g++)z[g]=0;for(g=32664;g<=32667;g++)z[g]=2;for(g=32701;g<=32761;g++)z[g]=0;for(g=53001;g<=53004;g++)z[g]=0;for(g=53008;g<=53019;g++)z[g]=0;for(g=53021;g<=53032;g++)z[g]=0;for(g=53034;g<=53037;g++)z[g]=0;for(g=53042;g<=53046;g++)z[g]=0;for(g=53074;g<=53080;g++)z[g]=0;for(g=54001;g<=54004;g++)z[g]=0;for(g=54008;g<=54019;g++)z[g]=0;for(g=54021;g<=54032;g++)z[g]=0;for(g=54034;g<=54037;g++)z[g]=0;for(g=54042;g<=54046;g++)z[g]=0;for(g=54048;g<=54053;g++)z[g]=0;for(g=54074;g<=54080;g++)z[g]=0;for(g=54098;g<=54101;g++)z[g]=0;for(g=102001;g<=102040;g++)z[g]=0;for(g=102042;g<=102063;g++)z[g]=0;for(g=102065;g<=102067;g++)z[g]=0;for(g=102070;g<=102117;g++)z[g]=0;for(g=102122;g<=102216;g++)z[g]=0;for(g=102221;g<=102377;g++)z[g]=0;for(g=102382;g<=102388;g++)z[g]=0;for(g=102389;g<=102398;g++)z[g]=2;for(g=102399;g<=102444;g++)z[g]=0;for(g=102445;g<=102447;g++)z[g]=2;for(g=102448;g<=102458;g++)z[g]=0;for(g=102459;g<=102468;g++)z[g]=2;for(g=102469;g<=102499;g++)z[g]=0;for(g=102500;g<=102519;g++)z[g]=1;for(g=102520;g<=102524;g++)z[g]=0;for(g=102525;g<=102529;g++)z[g]=2;for(g=102530;g<=102588;g++)z[g]=0;for(g=102590;g<=102598;g++)z[g]=0;for(g=102601;g<=102603;g++)z[g]=0;for(g=102605;g<=102628;g++)z[g]=0;for(g=102629;g<=102646;g++)z[g]=2;for(g=102648;g<=102700;g++)z[g]=2;for(g=102701;g<=102703;g++)z[g]=0;for(g=102707;g<=102730;g++)z[g]=2;for(g=102733;g<=102758;g++)z[g]=2;for(g=102767;g<=102900;g++)z[g]=0;for(g=102901;g<=102933;g++)z[g]=2;for(g=102934;g<=102950;g++)z[g]=13;for(g=102951;g<=102955;g++)z[g]=0;for(g=102961;g<=102963;g++)z[g]=0;for(g=102965;g<=102969;g++)z[g]=0;for(g=102971;g<=102973;g++)z[g]=0;for(g=102975;g<=102989;g++)z[g]=0;for(g=102990;g<=102992;g++)z[g]=1;for(g=102997;g<=103002;g++)z[g]=0;for(g=103003;g<=103008;g++)z[g]=2;for(g=103009;g<=103011;g++)z[g]=0;for(g=103012;g<=103014;g++)z[g]=2;for(g=103019;g<=103021;g++)z[g]=0;for(g=103022;g<=103024;g++)z[g]=2;for(g=103029;g<=103031;g++)z[g]=0;for(g=103032;g<=103034;g++)z[g]=2;for(g=103065;g<=103068;g++)z[g]=0;for(g=103074;g<=103076;g++)z[g]=0;for(g=103077;g<=103079;g++)z[g]=1;for(g=103080;g<=103082;g++)z[g]=0;for(g=103083;g<=103085;g++)z[g]=2;for(g=103090;g<=103093;g++)z[g]=0;for(g=103097;g<=103099;g++)z[g]=0;for(g=103100;g<=103102;g++)z[g]=2;for(g=103107;g<=103109;g++)z[g]=0;for(g=103110;g<=103112;g++)z[g]=2;for(g=103113;g<=103116;g++)z[g]=0;for(g=103117;g<=103120;g++)z[g]=2;for(g=103153;g<=103157;g++)z[g]=0;for(g=103158;g<=103162;g++)z[g]=2;for(g=103163;g<=103165;g++)z[g]=0;for(g=103166;g<=103168;g++)z[g]=1;for(g=103169;g<=103171;g++)z[g]=2;for(g=103186;g<=103188;g++)z[g]=0;for(g=103189;g<=103191;g++)z[g]=2;for(g=103192;g<=103195;g++)z[g]=0;for(g=103196;g<=103199;g++)z[g]=2;for(g=103200;g<=103224;g++)z[g]=0;for(g=103225;g<=103227;g++)z[g]=1;for(g=103232;g<=103237;g++)z[g]=0;for(g=103238;g<=103243;g++)z[g]=2;for(g=103244;g<=103246;g++)z[g]=0;for(g=103247;g<=103249;g++)z[g]=2;for(g=103254;g<=103256;g++)z[g]=0;for(g=103257;g<=103259;g++)z[g]=2;for(g=103264;g<=103266;g++)z[g]=0;for(g=103267;g<=103269;g++)z[g]=2;for(g=103300;g<=103375;g++)z[g]=0;for(g=103381;g<=103383;g++)z[g]=0;for(g=103384;g<=103386;g++)z[g]=1;for(g=103387;g<=103389;g++)z[g]=0;for(g=103390;g<=103392;g++)z[g]=2;for(g=103397;g<=103399;g++)z[g]=0;for(g=103400;g<=103471;g++)z[g]=2;for(g=103476;g<=103478;g++)z[g]=0;for(g=103479;g<=103481;g++)z[g]=2;for(g=103486;g<=103488;g++)z[g]=0;for(g=103489;g<=103491;g++)z[g]=2;for(g=103492;g<=103495;g++)z[g]=0;for(g=103496;g<=103499;g++)z[g]=2;for(g=103528;g<=103543;g++)z[g]=0;for(g=103544;g<=103548;g++)z[g]=2;for(g=103549;g<=103551;g++)z[g]=0;for(g=103552;g<=103554;g++)z[g]=1;for(g=103555;g<=103557;g++)z[g]=2;for(g=103558;g<=103560;g++)z[g]=0;for(g=103571;g<=103573;g++)z[g]=0;for(g=103574;g<=103576;g++)z[g]=2;for(g=103577;g<=103580;g++)z[g]=0;for(g=103581;g<=103583;g++)z[g]=2;for(g=103595;g<=103694;g++)z[g]=0;for(g=103696;g<=103699;g++)z[g]=0;for(g=103700;g<=103793;g++)z[g]=2;for(g=103794;g<=103890;g++)z[g]=0;for(g=103891;g<=103896;g++)z[g]=2;for(g=103900;g<=103971;g++)z[g]=2;for(g=103972;g<=103977;g++)z[g]=0;for(g=112e3;g<=112101;g++)z[g]=0;const GEe={102113:!0,102100:!0,3857:!0,3785:!0},jEe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},rX='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',iR=[-20037508342788905e-9,20037508342788905e-9],rR=[-20037508342787e-6,20037508342787e-6],mle={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:iR,origin:rR,dx:1e-5},102100:{wkTemplate:rX,valid:iR,origin:rR,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:iR,origin:rR,dx:1e-5},3857:{wkTemplate:rX,valid:iR,origin:rR,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function go(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||nb(t)&&nb(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function F1(t){return Ta(t)&&t.wkid&&mle[t.wkid]||null}function gle(t){return!!Ta(t)&&(t.wkid?z[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function xP(t){return!(tm(t)||im(t))}function TP(t){return Ta(t)&&t.wkid===4326}function _le(t){return Ta(t)&&t.wkid===Th.CGCS2000}function nb(t){return Ta(t)&&t.wkid!=null&&GEe[t.wkid]===!0}function SG(t){return Ta(t)&&t.wkid===32662}function CG(t){return t===Th.GCSMARS2000||t===Th.GCSMARS2000_SPHERE}function tm(t){return Ta(t)&&t.wkid!=null&&CG(t.wkid)}function EG(t){return t===Th.GCSMOON2000}function im(t){return Ta(t)&&t.wkid!=null&&EG(t.wkid)}function HEe(t){return Ta(t)&&t.wkid!=null&&jEe[t.wkid]===!0}function Ta(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const WEe={wkid:4326,wkt:JN(mle[4326].wkTemplate,{Central_Meridian:"0.0"})},qEe={wkid:102100,latestWkid:3857},ZEe={wkid:32662};function AG(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const yle=AG(vi),PG=AG($f),OG=AG(Og),vle={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${vi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function lr(t){return t!=null&&(tm(t)||go(t,PG))?$f:t!=null&&(im(t)||go(t,OG))?Og:vi}function ymt(t){return CG(t)?$f:EG(t)?Og:vi}const RG=39.37,XEe=vi.radius*Math.PI/200,ble=/UNIT\[([^\]]+)\]\]$/i,k1=z,wle=/UNIT\[([^\]]+)\]/i,YEe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),JEe=Ou()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Ap=t=>t*t,a0=t=>t*t*t,SP={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Ap(.001)},"square-centimeters":{inBaseUnits:Ap(.01)},"square-decimeters":{inBaseUnits:Ap(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Ap(1e3)},"square-inches":{inBaseUnits:Ap(.0254)},"square-feet":{inBaseUnits:Ap(.3048)},"square-yards":{inBaseUnits:Ap(.9144)},"square-miles":{inBaseUnits:Ap(1609.344)},"square-us-feet":{inBaseUnits:Ap(1200/3937)},acres:{inBaseUnits:.0015625*Ap(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*a0(.001)},"cubic-centimeters":{inBaseUnits:1e3*a0(.01)},"cubic-decimeters":{inBaseUnits:1e3*a0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*a0(1e3)},"cubic-inches":{inBaseUnits:1e3*a0(.0254)},"cubic-feet":{inBaseUnits:1e3*a0(.3048)},"cubic-yards":{inBaseUnits:1e3*a0(.9144)},"cubic-miles":{inBaseUnits:1e3*a0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},KEe=(()=>{const t={};for(const e in SP)for(const i in SP[e].units)t[i]=e;return t})();function QEe(t,e,i){return t*SP[i].units[e].inBaseUnits}function eAe(t,e,i){return t/SP[i].units[e].inBaseUnits}const tAe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function D8(t){const e=KEe[t];if(!e)throw new Error("unknown type");return e}function nX(t,e=null){return e=e||D8(t),SP[e].baseUnit===t}function Wo(t,e,i){if(e===i)return t;const r=D8(e);if(r!==D8(i))throw new Error("incompatible units");const n=nX(e,r)?t:QEe(t,e,r);return nX(i,r)?n:eAe(n,i,r)}function vmt(t,e,i){switch(i){case"metric":return iAe(t,e);case"imperial":return nAe(t,e);default:return i}}function bmt(t,e,i){switch(i){case"metric":return rAe(t,e);case"imperial":return sAe(t,e);default:return i}}function iAe(t,e){const i=Wo(t,e,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function rAe(t,e){const i=Wo(t,e,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function nAe(t,e){const i=Wo(t,e,"feet");return Math.abs(i)<1e3?"feet":"miles"}function sAe(t,e){const i=Wo(t,e,"feet");return Math.abs(i)<1e5?"feet":"miles"}function wmt(t,e){const i=Wo(t,e,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function xmt(t,e){const i=Wo(t,e,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function oAe(t,e,i){return Wo(t,e,"meters")/(i*Math.PI/180)}function xle(t){return JEe.fromJSON(t.toLowerCase())||null}function N8(t){if(t!=null&&!xP(t))return 1;const e=al(t);return e>1e5?1:e}function aAe(t){return al(t)>=lr(t).metersPerDegree?"meters":s5(t)}function al(t,e=vi.metersPerDegree){return lAe(t,!0)??e}function lAe(t,e=!1){const i=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let n=null;if(i){if(CG(i))return $f.metersPerDegree;if(EG(i))return Og.metersPerDegree;n=k1.values[k1[i]],!n&&e&&YEe.has(i)&&(n=XEe)}else r&&(Cle(r)?n=oX(ble.exec(r),n):Sle(r)&&(n=oX(wle.exec(r),n)));return n}function sX(t){return t.isGeographic?1:al(t)}function oX(t,e){return t&&t[1]?Tle(t[1]):e}function Tle(t){return parseFloat(t.split(",")[1])}function s5(t){const e=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let r=null;if(e)r=k1.units[k1[e]];else if(i){const n=Cle(i)?ble:Sle(i)?wle:null;if(n){const s=n.exec(i);s&&s[1]&&(r=uAe(s[1]))}}return r!=null?xle(r):null}function Tmt(t){const e=s5(t);return e!=null&&tAe.includes(e)?e:null}function Sle(t){return/^GEOCCS/i.test(t)}function Cle(t){return/^PROJCS/i.test(t)}const cAe=1e-7;function uAe(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let i=e&&e[1];if(!i||!k1.units.includes(i)){const r=Tle(t);i=null;const n=k1.values;for(let s=0;s<n.length;++s)if(Math.abs(r-n[s])<cAe){i=k1.units[s];break}}return i}function Smt(t){const e=s5(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const hAe={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},dAe={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},pAe={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},Cmt=Ou()(hAe),Emt=Ou()(dAe),Amt=Ou()(pAe);var qp;let Ur=qp=class extends Nt{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return qp.WebMercator;if(t.wkid===4326)return qp.WGS84}const e=new qp;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return TP(this)}get isWebMercator(){return nb(this)}get isGeographic(){return gle(this)}get isWrappable(){return HEe(this)}get metersPerUnit(){return al(this)}get unit(){return s5(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===qp.WGS84)return qp.WGS84;if(this===qp.WebMercator)return qp.WebMercator;const t=new qp;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=Le(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:i}=t.imageCoordinateSystem,{geodataXform:r}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||r?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):i?n.id===e&&n.referenceServiceName===i:n.id===e}return go(this,t)}toJSON(t){return this.write(void 0,t)}};Ur.GCS_NAD_1927=null,Ur.WGS84=null,Ur.WebMercator=null,Ur.PlateCarree=null,d([m({readOnly:!0})],Ur.prototype,"isWGS84",null),d([m({readOnly:!0})],Ur.prototype,"isWebMercator",null),d([m({readOnly:!0})],Ur.prototype,"isGeographic",null),d([m({readOnly:!0})],Ur.prototype,"isWrappable",null),d([m({type:js,json:{write:!0}})],Ur.prototype,"latestWkid",void 0),d([m({readOnly:!0})],Ur.prototype,"metersPerUnit",null),d([m({readOnly:!0})],Ur.prototype,"unit",null),d([m({type:js,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Ur.prototype,"wkid",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Ur.prototype,"wkt",void 0),d([Pr("wkt"),Pr("web-scene","wkt")],Ur.prototype,"writeWkt",null),d([m({type:js,json:{write:!0}})],Ur.prototype,"vcsWkid",void 0),d([m({type:js,json:{write:!0}})],Ur.prototype,"latestVcsWkid",void 0),d([m()],Ur.prototype,"imageCoordinateSystem",void 0),Ur=qp=d([J("esri.geometry.SpatialReference")],Ur),Ur.prototype.toJSON.isDefaultToJSON=!0,Ur.GCS_NAD_1927=new Ur({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Ur.WGS84=new Ur(WEe),Ur.WebMercator=new Ur(qEe),Ur.PlateCarree=new Ur(ZEe),Object.freeze&&(Object.freeze(Ur.GCS_NAD_1927),Object.freeze(Ur.WGS84),Object.freeze(Ur.WebMercator));const jt=Ur;let Zp=class extends Nt{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=jt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,i){if(e instanceof jt)return e;if(e!=null){const r=new jt;return r.read(e,i),r}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,i){this.cache[e]=i}};d([m()],Zp.prototype,"type",void 0),d([m({readOnly:!0})],Zp.prototype,"cache",null),d([m({readOnly:!0})],Zp.prototype,"extent",null),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zp.prototype,"hasM",void 0),d([m({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Zp.prototype,"hasZ",void 0),d([m({type:jt,json:{write:!0},value:jt.WGS84})],Zp.prototype,"spatialReference",void 0),d([yr("spatialReference")],Zp.prototype,"readSpatialReference",null),Zp=d([J("esri.geometry.Geometry")],Zp);const Py=Zp;function fAe(t,e){const i=t.x-e.x,r=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(i*i+r*r+n*n)}const mAe=57.29577951308232,gAe=.017453292519943;function aX(t){return t*mAe}function lX(t){return t*gAe}function cX(t){return t/vi.radius}function NL(t){return Math.PI/2-2*Math.atan(Math.exp(-t/vi.radius))}function F8(t){return t.wkid!=null||t.wkt!=null}const IF=[0,0];function FL(t,e,i,r,n){const s=t,o=n;if(o.spatialReference=i,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,IF,r);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,IF,r),[o.xmax,o.ymax]=e(s.xmax,s.ymax,IF,r);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<a.length;u++){const p=a[u];c=[],l.push(c);for(let f=0;f<p.length;f++)c.push(e(p[f][0],p[f][1],[0,0],r)),p[f].length>2&&c[f].push(p[f][2]),p[f].length>3&&c[f].push(p[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function Z_(t,e){const i=t&&(F8(t)?t:t.spatialReference),r=e&&(F8(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!i||!r)&&(!!go(r,i)||nb(r)&&TP(i)||nb(i)&&TP(r))}function Ub(t,e){if(t==null)return null;const i=t.spatialReference,r=e&&(F8(e)?e:e.spatialReference);return Z_(i,r)?go(i,r)?Le(t):nb(r)?FL(t,g2,jt.WebMercator,!1,Le(t)):TP(r)?FL(t,SA,jt.WGS84,!1,Le(t)):null:null}function g2(t,e,i=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const r=lX(e);return i[0]=lX(t)*vi.radius,i[1]=vi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function SA(t,e,i=[0,0],r=!1){const n=aX(t/vi.radius);return i[0]=r?n:n-360*Math.floor((n+180)/360),i[1]=aX(Math.PI/2-2*Math.atan(Math.exp(-e/vi.radius))),i}function CA(t,e=!1,i=Le(t)){return FL(t,g2,jt.WebMercator,e,i)}function nR(t,e=!1,i=Le(t)){return FL(t,SA,jt.WGS84,e,i)}var q$;const eC=[0,0];function uX(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let _l=q$=class extends Py{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const i=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(i)?i:i.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,i,r,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],i=s[2],r=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,i=s.z,r=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new jt(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)ye.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)ye.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=g2(s.longitude,s.latitude,eC);t=a[0],e=a[1]}}}else uX(i)?(n=i,i=null):uX(r)&&(n=r,r=null);const o={x:t,y:e};return o.x==null&&o.y!=null?ye.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&ye.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:i}=this;if(t){if(t.isWebMercator)return SA(e,i,eC)[1];if(t.isGeographic)return i}return null}set latitude(t){const{spatialReference:e,x:i}=this;t!=null&&e&&(e.isWebMercator?this._set("y",g2(i,t,eC)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:i}=this;if(i){if(i.isWebMercator)return SA(t,e,eC)[0];if(i.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:i}=this;t!=null&&i&&(i.isWebMercator?this._set("x",g2(t,e,eC)[0]):i.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,i){e[i]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new q$;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return q$.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:i,z:r,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=g2(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=SA(l,c),u=s}return e===l&&i===c&&r===o&&n===a&&s.wkid===u.wkid}offset(t,e,i){return this.x+=t,this.y+=e,i!=null&&(this.z=(this.z??0)+i),this}normalize(){if(!this.spatialReference)return this;const t=F1(this.spatialReference);if(!t)return this;let e=this.x;const[i,r]=t.valid,n=2*r;let s;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n),this._set("x",e),this}distance(t){return fAe(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],_l.prototype,"cache",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],_l.prototype,"hasM",null),d([m({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],_l.prototype,"hasZ",null),d([m({type:Number})],_l.prototype,"latitude",null),d([m({type:Number})],_l.prototype,"longitude",null),d([m({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),Sn(t=>isNaN(t)?t:Vd(t))],_l.prototype,"x",void 0),d([Pr("x")],_l.prototype,"writeX",null),d([yr("x")],_l.prototype,"readX",null),d([m({type:Number,json:{write:!0}})],_l.prototype,"y",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],_l.prototype,"z",void 0),d([m({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],_l.prototype,"m",void 0),_l=q$=d([J("esri.geometry.Point")],_l),_l.prototype.toJSON.isDefaultToJSON=!0;const Ft=_l;let Nm=class extends em(Nt){constructor(...e){super(...e),this.position=new Ft([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,i,r,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return i!=null&&(s.heading=i),r!=null&&(s.tilt=r),n!=null&&(s.fov=n),s}return e}writePosition(e,i,r,n){const s=e.clone();s.x=Vd(e.x||0),s.y=Vd(e.y||0),s.z=e.hasZ?Vd(e.z||0):e.z,i[r]=s.write({},n)}readPosition(e,i){const r=new Ft;return r.read(e,i),r.x=Vd(r.x||0),r.y=Vd(r.y||0),r.z=r.hasZ?Vd(r.z||0):r.z,r}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};d([m({type:Ft,json:{write:{isRequired:!0}}})],Nm.prototype,"position",void 0),d([Pr("position")],Nm.prototype,"writePosition",null),d([yr("position")],Nm.prototype,"readPosition",null),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Sn(t=>xG.normalize(Vd(t)))],Nm.prototype,"heading",void 0),d([m({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),Sn(t=>$e(Vd(t),-180,180))],Nm.prototype,"tilt",void 0),d([m({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Nm.prototype,"fov",void 0),Nm=d([J("esri.Camera")],Nm);const Fh=Nm,LF=[0,0];function MG(t,e){return e!=null&&ja(t,e.x,e.y,e.z)}function Rmt(t,e){if(!e.points||e.points.length)return!1;for(const i of e.points)if(!hT(t,i))return!1;return!0}function _Ae(t,e){const{xmin:i,ymin:r,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?ja(t,i,r,n)&&ja(t,i,o,n)&&ja(t,s,o,n)&&ja(t,s,r,n)&&ja(t,i,r,a)&&ja(t,i,o,a)&&ja(t,s,o,a)&&ja(t,s,r,a):ja(t,i,r)&&ja(t,i,o)&&ja(t,s,o)&&ja(t,s,r)}function hT(t,e){return ja(t,e[0],e[1])}function yAe(t,e){return ja(t,e[0],e[1],e[2])}function ja(t,e,i,r){return e>=t.xmin&&e<=t.xmax&&i>=t.ymin&&i<=t.ymax&&(r==null||!t.hasZ||r>=t.zmin&&r<=t.zmax)}function vAe(t,e){return LF[1]=e.y,LF[0]=e.x,bAe(t,LF)}function bAe(t,e){return Ele(t.rings,e)}function Ele(t,e){if(!t)return!1;if(wAe(t))return hX(!1,t,e);let i=!1;for(let r=0,n=t.length;r<n;r++)i=hX(i,t[r],e);return i}function wAe(t){return!Array.isArray(t[0][0])}function hX(t,e,i){const[r,n]=i;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[p,f]=e[o];(u<n&&f>=n||f<n&&u>=n)&&c+(n-u)/(f-u)*(p-c)<r&&(s=!s)}return s}function xAe(t,e){return MG(t,e)}function TAe(t,e){const i=t.hasZ&&e.hasZ;let r,n,s;if(t.xmin<=e.xmin){if(r=e.xmin,t.xmax<r)return!1}else if(r=t.xmin,e.xmax<r)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(i&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function SAe(t,e){const{points:i,hasZ:r}=e,n=r?yAe:hT;for(const s of i)if(n(t,s))return!0;return!1}const sb=[0,0],ob=[0,0],ab=[0,0],lb=[0,0],CAe=[sb,ob,ab,lb],Ale=[[ab,sb],[sb,ob],[ob,lb],[lb,ab]];function EAe(t,e){return AAe(t,e.rings)}function AAe(t,e){sb[0]=t.xmin,sb[1]=t.ymax,ob[0]=t.xmax,ob[1]=t.ymax,ab[0]=t.xmin,ab[1]=t.ymin,lb[0]=t.xmax,lb[1]=t.ymin;for(const i of CAe)if(Ele(e,i))return!0;for(const i of e){if(!i.length)continue;let r=i[0];if(hT(t,r))return!0;for(let n=1;n<i.length;n++){const s=i[n];if(hT(t,s)||Ple(r,s,Ale))return!0;r=s}}return!1}function PAe(t,e){sb[0]=t.xmin,sb[1]=t.ymax,ob[0]=t.xmax,ob[1]=t.ymax,ab[0]=t.xmin,ab[1]=t.ymin,lb[0]=t.xmax,lb[1]=t.ymin;const i=e.paths;for(const r of i){if(!i.length)continue;let n=r[0];if(hT(t,n))return!0;for(let s=1;s<r.length;s++){const o=r[s];if(hT(t,o)||Ple(n,o,Ale))return!0;n=o}}return!1}const Bo=[0,0];function OAe(t){for(let e=0;e<t.length;e++){const i=t[e];for(let n=0;n<i.length-1;n++){const s=i[n],o=i[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(k8(s,o,c,u,Bo)&&!(Bo[0]===s[0]&&Bo[1]===s[1]||Bo[0]===c[0]&&Bo[1]===c[1]||Bo[0]===o[0]&&Bo[1]===o[1]||Bo[0]===u[0]&&Bo[1]===u[1]))return!0}}const r=i.length;if(!(r<=4))for(let n=0;n<r-3;n++){let s=r-1;n===0&&(s=r-2);const o=i[n],a=i[n+1];for(let l=n+2;l<s;l++){const c=i[l],u=i[l+1];if(k8(o,a,c,u,Bo)&&!(Bo[0]===o[0]&&Bo[1]===o[1]||Bo[0]===c[0]&&Bo[1]===c[1]||Bo[0]===a[0]&&Bo[1]===a[1]||Bo[0]===u[0]&&Bo[1]===u[1]))return!0}}}return!1}function Ple(t,e,i){for(let r=0;r<i.length;r++)if(k8(t,e,i[r][0],i[r][1]))return!0;return!1}function k8(t,e,i,r,n){const[s,o]=t,[a,l]=e,[c,u]=i,[p,f]=r,y=p-c,v=s-c,b=a-s,x=f-u,S=o-u,P=l-o,C=x*b-y*P;if(C===0)return!1;const R=(y*S-x*v)/C,N=(b*S-P*v)/C;return R>=0&&R<=1&&N>=0&&N<=1&&(n&&(n[0]=s+R*(a-s),n[1]=o+R*(l-o)),!0)}function RAe(t){switch(t){case"esriGeometryEnvelope":case"extent":return TAe;case"esriGeometryMultipoint":case"multipoint":return SAe;case"esriGeometryPoint":case"point":return xAe;case"esriGeometryPolygon":case"polygon":return EAe;case"esriGeometryPolyline":case"polyline":return PAe}}var Yu;function MAe(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function l0(t,e,i){return e==null?i:i==null?e:t(e,i)}let xo=Yu=class extends Py{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,r,n){return MAe(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?jt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:r,spatialReference:n??jt.WGS84}}static fromBounds(t,e){return new Yu({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Yu({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Ft({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Yu;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Z_(e,i)&&(t=e.isWebMercator?CA(t):nR(t,!0)),t.type==="point"?MG(this,t):t.type==="extent"&&_Ae(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&Z_(e,i)&&(t=e.isWebMercator?CA(t):nR(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,r=this.height*e;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!go(e,i)&&Z_(e,i)&&(t=e.isWebMercator?CA(t):nR(t,!0)),RAe(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=l0(Math.min,this.zmin,t.zmin),this.zmax=l0(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=l0(Math.min,this.mmin,t.mmin),this.mmax=l0(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=l0(Math.max,this.zmin,t.zmin),this.zmax=l0(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=l0(Math.max,this.mmin,t.mmin),this.mmax=l0(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=F1(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,i=this._getCM(t);if(i){const r=e.isWebMercator?nR(i):i;this.xmin-=i.x,this.xmax-=i.x,e.isWebMercator||(r.x=this._normalizeX(r.x,t).x),this.spatialReference=new jt(JN((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,r]=t.valid,n=this.xmin,s=this.xmax;return n>=i&&n<=r&&s>=i&&s<=r||(e=this.center),e}_normalize(t,e,i){const r=this.spatialReference;if(!r)return this;const n=i??F1(r);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let p=0;p<c.length;p++)c[p].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let p=0;p<c.length;p++)c[p].push(u)}return c}),hasZ:o,hasM:a,spatialReference:r}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||F1(o);const[p,f]=t.valid;u=this._normalizeX(this.xmin,t);const y=u.x,v=u.frameId;u=this._normalizeX(this.xmax,t);const b=u.x,x=u.frameId,S=y===b&&a>0;if(a>2*f){const P=new Yu(l<c?y:b,n,f,s,o),C=new Yu(p,n,l<c?b:y,s,o),R=new Yu(0,n,f,s,o),N=new Yu(p,n,0,s,o),$=[],k=[];P.contains(R)&&$.push(v),P.contains(N)&&k.push(v),C.contains(R)&&$.push(x),C.contains(N)&&k.push(x);for(let B=v+1;B<x;B++)$.push(B),k.push(B);e.push({extent:P,frameIds:[v]},{extent:C,frameIds:[x]},{extent:R,frameIds:$},{extent:N,frameIds:k})}else y>b||S?e.push({extent:new Yu(y,n,f,s,o),frameIds:[v]},{extent:new Yu(p,n,b,s,o),frameIds:[x]}):e.push({extent:new Yu(y,n,b,s,o),frameIds:[v]});this.cache._parts=e}const i=this.hasZ,r=this.hasM;if(i||r){const n={};i&&(n.zmin=this.zmin,n.zmax=this.zmax),r&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[i,r]=e.valid,n=2*r;let s,o=0;return t>r?(s=Math.ceil(Math.abs(t-r)/n),t-=s*n,o=s):t<i&&(s=Math.ceil(Math.abs(t-i)/n),t+=s*n,o=-s),{x:t,frameId:o}}};d([m({readOnly:!0})],xo.prototype,"cache",null),d([m({readOnly:!0})],xo.prototype,"center",null),d([m({readOnly:!0})],xo.prototype,"extent",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],xo.prototype,"hasM",null),d([m({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],xo.prototype,"hasZ",null),d([m({readOnly:!0})],xo.prototype,"height",null),d([m({readOnly:!0})],xo.prototype,"width",null),d([m({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],xo.prototype,"xmin",void 0),d([m({type:Number,json:{write:!0}})],xo.prototype,"ymin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],xo.prototype,"mmin",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],xo.prototype,"zmin",void 0),d([m({type:Number,json:{write:!0}})],xo.prototype,"xmax",void 0),d([m({type:Number,json:{write:!0}})],xo.prototype,"ymax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],xo.prototype,"mmax",void 0),d([m({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],xo.prototype,"zmax",void 0),xo=Yu=d([J("esri.geometry.Extent")],xo),xo.prototype.toJSON.isDefaultToJSON=!0;const Ar=xo;function dT(t,e,i=!1){let{hasM:r,hasZ:n}=t;Array.isArray(e)?e.length!==4||r||n?e.length===3&&i&&!r?(n=!0,r=!1):e.length===3&&r&&n&&(r=!1,n=!1):(r=!0,n=!0):(n=!n&&e.hasZ&&(!r||e.hasM),r=!r&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=r}var U8;function dX(t){return(e,i)=>e==null?i:i==null?e:t(e,i)}function $Ae(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let G0=U8=class extends Py{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const i={};Array.isArray(t)?(i.points=t,i.spatialReference=e):$Ae(t)?i.spatialReference=t:(t.points&&(i.points=t.points),t.spatialReference&&(i.spatialReference=t.spatialReference),t.hasZ&&(i.hasZ=t.hasZ),t.hasM&&(i.hasM=t.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new Ar,i=this.hasZ,r=this.hasM,n=i?3:2,s=t[0],o=dX(Math.min),a=dX(Math.max);let l,c,u,p,[f,y]=s,[v,b]=s;for(let x=0,S=t.length;x<S;x++){const P=t[x],[C,R]=P;if(f=o(f,C),y=o(y,R),v=a(v,C),b=a(b,R),i&&P.length>2){const N=P[2];l=o(l,N),u=a(u,N)}if(r&&P.length>n){const N=P[n];c=o(c,N),p=a(p,N)}}return e.xmin=f,e.ymin=y,e.xmax=v,e.ymax=b,e.spatialReference=this.spatialReference,i?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),r?(e.mmin=c,e.mmax=p):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=Le(this.points)}addPoint(t){return dT(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:Le(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new U8(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],i={x:e[0],y:e[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=e[2],r=3),this.hasM&&(i.m=e[r]),new Ft(i)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Ft(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(dT(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([m({readOnly:!0})],G0.prototype,"cache",null),d([m()],G0.prototype,"extent",null),d([m({type:[[Number]],json:{write:{isRequired:!0}}})],G0.prototype,"points",void 0),d([Pr("points")],G0.prototype,"writePoints",null),G0=U8=d([J("esri.geometry.Multipoint")],G0),G0.prototype.toJSON.isDefaultToJSON=!0;const M3=G0;function Mmt(t){const e=[];for(t.reset();t.nextPath();){const i=[];for(;t.nextPoint();)i.push([t.x,t.y]);e.push(i)}return t.reset(),e}function IAe(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function o5(t,e){const i=e[0]-t[0],r=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}return Math.sqrt(i*i+r*r)}function Ole(t,e,i){const r=t[0]+i*(e[0]-t[0]),n=t[1]+i*(e[1]-t[1]);return t.length>2&&e.length>2?[r,n,t[2]+i*(e[2]-t[2])]:[r,n]}function $mt(t,e,i,r){const[n,s]=e,[o,a]=i[r],[l,c]=i[r+1],u=l-o,p=c-a,f=u*u+p*p,y=(n-o)*u+(s-a)*p,v=Math.min(1,Math.max(0,y/f));return t[0]=o+u*v,t[1]=a+p*v,t}function Imt(t,e,i){let r,n,s,o,a=!1,l=1/0;for(i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,n=i.y;i.nextPoint();)s=i.x,o=i.y,n>e!=o>e&&t<(s-r)*(e-n)/(o-n)+r&&(a=!a),l=Math.min(l,LAe(t,e,r,n,s,o)),r=s,n=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function LAe(t,e,i,r,n,s){let o=i,a=r,l=n-o,c=s-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=n,a=s):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function Rle(t,e){return Ole(t,e,.5)}function Mle(t){const e=t.length;let i=0;for(let r=0;r<e-1;++r)i+=o5(t[r],t[r+1]);return i}function $le(t,e){if(e<=0)return t[0];const i=t.length;let r=0;for(let n=0;n<i-1;++n){const s=o5(t[n],t[n+1]);if(e-r<s){const o=(e-r)/s;return Ole(t[n],t[n+1],o)}r+=s}return t[i-1]}function Ile(t,e,i){const r=t.length;let n=0,s=0,o=0;for(let a=0;a<r;a++){const l=t[a],c=t[(a+1)%r];let u=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(s+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&e&&(o+=l[0]*c[u]-c[0]*l[u])}return n<=0&&s<=0&&o<=0}function DAe(t){const e=t.length;return e>2&&Ag(t[0],t[e-1])}function Lmt(t){if("rings"in t)for(const e of t.rings)DAe(e)||e.push(e[0].slice())}function Dmt(t){if(!t||t.length<3)return 0;let e=0;const i=t.length-1;for(let r=0;r<i;r++)e+=(t[r][0]-t[r+1][0])*(t[r][1]+t[r+1][1]);return e+=(t[i][0]-t[0][0])*(t[i][1]+t[0][1]),-.5*e}function Lle(t){if(!t||t.numPoints<3)return 0;let e,i,r=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,i=t.y;const n=e,s=i;for(;t.nextPoint();)r+=(e-t.x)*(i+t.y),e=t.x,i=t.y;return r+=(e-n)*(i+s),-.5*r}function Nmt(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function NAe(t){return t?Dle(t.rings,t.hasZ??!1):null}function Dle(t,e){if(!t||!t.length)return null;const i=[],r=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=Nle(t[s],e,n);a&&r.push(a)}if(r.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],e&&(i[2]=r[0][3]),(i[0]<n[0]||i[0]>n[1]||i[1]<n[2]||i[1]>n[3]||e&&(i[2]<n[4]||i[2]>n[5]))&&(i.length=0)),!i.length){const s=t[0]&&t[0].length?FAe(t[0],e):null;if(!s)return null;i[0]=s[0],i[1]=s[1],e&&s.length>2&&(i[2]=s[2])}return i}function Nle(t,e,i){let r=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const y=t[f],v=t[(f+1)%t.length],[b,x,S]=y,P=b-l,C=x-c,[R,N,$]=v,k=R-l,B=N-c,W=P*B-k*C;if(o+=W,r+=(P+k)*W,n+=(C+B)*W,e&&y.length>2&&v.length>2){const Z=S-u,K=$-u,X=P*K-k*Z;s+=(Z+K)*X,a+=X}b<i[0]&&(i[0]=b),b>i[1]&&(i[1]=b),x<i[2]&&(i[2]=x),x>i[3]&&(i[3]=x),e&&(S<i[4]&&(i[4]=S),S>i[5]&&(i[5]=S))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,n/(6*o)+c,o];return e&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=s/(6*a)+u,p[4]=a)),p}function FAe(t,e){const i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],p=t[l+1];if(u&&p){i[0]=u[0],i[1]=u[1],r[0]=p[0],r[1]=p[1],e&&u.length>2&&p.length>2&&(i[2]=u[2],r[2]=p[2]);const f=o5(i,r);if(f){n+=f;const y=Rle(u,p);s+=f*y[0],o+=f*y[1],e&&y.length>2&&(a+=f*y[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function kAe(t){const{hasZ:e,numPaths:i}=t;if(i===0)return null;const r=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=Nle(IAe(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(r[0]=n[0][0],r[1]=n[0][1],e&&(r[2]=n[0][3]),(r[0]<s[0]||r[0]>s[1]||r[1]<s[2]||r[1]>s[3]||e&&(r[2]<s[4]||r[2]>s[5]))&&(r.length=0)),!r.length){t.reset(),t.nextPath();const o=t.numPoints?UAe(t):null;if(!o)return null;r[0]=o[0],r[1]=o[1],e&&o.length>2&&(r[2]=o[2])}return r}function UAe(t){const{hasZ:e}=t,i=e?[0,0,0]:[0,0],r=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const p=t.x,f=t.y,y=t.z;i[0]=l,i[1]=c,r[0]=p,r[1]=f,e&&(i[2]=u,r[2]=y);const v=o5(i,r);if(v){n+=v;const b=Rle(i,r);s+=v*b[0],o+=v*b[1],e&&b.length>2&&(a+=v*b[2])}l=p,c=f,u=y}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const zAe=1e-6;function Fmt(t){let e=0;for(t.reset();t.nextPath();)e+=Lle(t);if(e<zAe){const n=kAe(t);return n?[n[0],n[1]]:null}const i=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const r=[t.x,t.y];for(t.reset();t.nextPath();)VAe(i,r,t);return i[0]*=1/e,i[1]*=1/e,i[0]+=r[0],i[1]+=r[1],i}const BAe=1/3;function VAe(t,e,i){if(!t||!i||i.numPoints<3)return null;i.nextPoint();const r=i.x,n=i.y;i.nextPoint();let s,o=i.x-r,a=i.y-n,l=0,c=0;for(;i.nextPoint();)l=i.x-r,c=i.y-n,s=.5*BAe*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const u=Lle(i),p=[r,n];return p[0]-=e[0],p[1]-=e[1],p[0]*=u,p[1]*=u,t[0]+=p[0],t[1]+=p[1],t}function li(t=WAe){return[t[0],t[1],t[2],t[3]]}function kmt(t){return[t[0],t[1],t[2],t[3]]}function Rg(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function $G(t,e,i,r,n=li()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function Fle(t,e=li()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function a5(t,e){return new Ar({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function IG(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function X_(t,e,i){if(e!=null)if("length"in e)V8(e)?(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[2]),i[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(i[0]=Math.min(t[0],e[0]),i[1]=Math.min(t[1],e[1]),i[2]=Math.max(t[2],e[0]),i[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":i[0]=Math.min(t[0],e.xmin),i[1]=Math.min(t[1],e.ymin),i[2]=Math.max(t[2],e.xmax),i[3]=Math.max(t[3],e.ymax);break;case"point":i[0]=Math.min(t[0],e.x),i[1]=Math.min(t[1],e.y),i[2]=Math.max(t[2],e.x),i[3]=Math.max(t[3],e.y)}else Rg(i,t)}function DF(t,e,i=t){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<r;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=n,i[1]=s,i[2]=o,i[3]=a,i}function z8(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function lu(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function up(t){return t[1]>=t[3]?0:t[3]-t[1]}function kle(t){return lu(t)*up(t)}function LG(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function Ule(t,e){return l5(t,e[0],e[1])}function pX(t,e){const i=e[3],r=.5*(t[0]+t[2]),n=Math.abs(e[0]-r),s=.5*(t[2]-t[0]);if(n>i+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>i+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=i*i}function Umt(t,e,i){const r=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=i,p=(x,S)=>(u-l)*x+(a-c)*S+(c*l-a*u)<0,f=p(r,o),y=p(s,o),v=p(s,n),b=p(r,n);return!(f===y&&y===v&&v===b&&b===f||a<r&&c<r||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function zmt(t,e){return l5(t,e.x,e.y)}function l5(t,e,i){return e>=t[0]&&i>=t[1]&&e<=t[2]&&i<=t[3]}function GAe(t,e,i){return e[0]>=t[0]-i&&e[1]>=t[1]-i&&e[0]<=t[2]+i&&e[1]<=t[3]+i}function c5(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function fX(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function B8(t,e,i){if(e==null)return Rg(i,t);const r=e[0],n=e[1],s=e[2],o=e[3];return i[0]=$e(t[0],r,s),i[1]=$e(t[1],n,o),i[2]=$e(t[2],r,s),i[3]=$e(t[3],n,o),i}function jAe(t,e){const i=(t[0]+t[2])/2,r=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-i)-lu(t)/2,0),s=Math.max(Math.abs(e[1]-r)-up(t)/2,0);return Math.sqrt(n*n+s*s)}function kL(t,e,i,r=t){return r[0]=t[0]+e,r[1]=t[1]+i,r[2]=t[2]+e,r[3]=t[3]+i,r}function kh(t){return t?Rg(t,G8):li(G8)}function V8(t){return t!=null&&t.length===4}function HAe(t){return!(lu(t)!==0&&isFinite(t[0])||up(t)!==0&&isFinite(t[1]))}function U1(t,e){return V8(t)&&V8(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const Bmt=[-1/0,-1/0,1/0,1/0],G8=[1/0,1/0,-1/0,-1/0],WAe=[0,0,0,0];function zle(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Ble(t){return t.points!==void 0}function Vle(t){return t.x!==void 0&&t.y!==void 0}function Gle(t){return t.paths!==void 0}function jle(t){return t.rings!==void 0}function Hle(t){function e(i,r){return i==null?r:r==null?i:t(i,r)}return e}const I_=Hle(Math.min),L_=Hle(Math.max);function Vmt(t,e){return Gle(e)?pT(t,e.paths,!1,!1):jle(e)?pT(t,e.rings,!1,!1):Ble(e)?DG(t,e.points,!1,!1,!1,!1):zle(e)?Wle(t,e):(Vle(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function Gmt(t){let e,i,r,n;for(t.reset(),e=r=1/0,i=n=-1/0;t.nextPath();){const s=qAe(t);e=Math.min(s[0],e),r=Math.min(s[1],r),i=Math.max(s[2],i),n=Math.max(s[3],n)}return li([e,r,i,n])}function qAe(t){let e,i,r,n;for(e=r=1/0,i=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),r=Math.min(t.y,r),i=Math.max(t.x,i),n=Math.max(t.y,n);return li([e,r,i,n])}function jmt(t,e){return Gle(e)?pT(t,e.paths,!0,!1):jle(e)?pT(t,e.rings,!0,!1):Ble(e)?DG(t,e.points,!0,!1,!0,!1):zle(e)?Wle(t,e,!0,!1,!0,!1):(Vle(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function pT(t,e,i,r){const n=i?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,u]=e[0][0],[p,f]=e[0][0];for(let y=0;y<e.length;y++){const v=e[y];for(let b=0;b<v.length;b++){const x=v[b],[S,P]=x;if(c=I_(c,S),u=I_(u,P),p=L_(p,S),f=L_(f,P),i&&x.length>2){const C=x[2];s=I_(s,C),o=L_(o,C)}if(r&&x.length>n){const C=x[n];a=I_(s,C),l=L_(o,C)}}}return i?r?(t[0]=c,t[1]=u,t[2]=s,t[3]=a,t[4]=p,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=s,t[3]=p,t[4]=f,t[5]=o,t.length=6,t):r?(t[0]=c,t[1]=u,t[2]=a,t[3]=p,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=p,t[3]=f,t.length=4,t)}function Wle(t,e,i,r,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,p=e.zmax,f=e.mmin,y=e.mmax;return n?(u=u||0,p=p||0,s?(f=f||0,y=y||0,t[0]=o,t[1]=l,t[2]=u,t[3]=f,t[4]=a,t[5]=c,t[6]=p,t[7]=y,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=p,t)):s?(f=f||0,y=y||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=y,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function DG(t,e,i,r,n,s){const o=i?3:2,a=r&&s,l=i&&n;if(!e.length||!e[0].length)return null;let c,u,p,f,[y,v]=e[0],[b,x]=e[0];for(let S=0;S<e.length;S++){const P=e[S],[C,R]=P;if(y=I_(y,C),v=I_(v,R),b=L_(b,C),x=L_(x,R),l&&P.length>2){const N=P[2];c=I_(c,N),u=L_(u,N)}if(a&&P.length>o){const N=P[o];p=I_(c,N),f=L_(u,N)}}return n?(c=c||0,u=u||0,s?(p=p||0,f=f||0,t[0]=y,t[1]=v,t[2]=c,t[3]=p,t[4]=b,t[5]=x,t[6]=u,t[7]=f,t):(t[0]=y,t[1]=v,t[2]=c,t[3]=b,t[4]=x,t[5]=u,t)):s?(p=p||0,f=f||0,t[0]=y,t[1]=v,t[2]=p,t[3]=b,t[4]=x,t[5]=f,t):(t[0]=y,t[1]=v,t[2]=b,t[3]=x,t)}function ZAe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function XAe(t){return t.points!==void 0}function YAe(t){return t.x!==void 0&&t.y!==void 0}function JAe(t){return t.paths!==void 0}function KAe(t){return t.rings!==void 0}const NG=[];function qle(t,e,i,r){return{xmin:t,ymin:e,xmax:i,ymax:r}}function Zle(t,e,i,r,n,s){return{xmin:t,ymin:e,zmin:i,xmax:r,ymax:n,zmax:s}}function Xle(t,e,i,r,n,s){return{xmin:t,ymin:e,mmin:i,xmax:r,ymax:n,mmax:s}}function Yle(t,e,i,r,n,s,o,a){return{xmin:t,ymin:e,zmin:i,mmin:r,xmax:n,ymax:s,zmax:o,mmax:a}}function FG(t,e=!1,i=!1){return e?i?Yle(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):Zle(t[0],t[1],t[2],t[3],t[4],t[5]):i?Xle(t[0],t[1],t[2],t[3],t[4],t[5]):qle(t[0],t[1],t[2],t[3])}function Hmt(t){return t?ZAe(t)?t:YAe(t)?ePe(t):KAe(t)?Jle(t):JAe(t)?Kle(t):XAe(t)?QAe(t):null:null}function QAe(t){const{hasZ:e,hasM:i,points:r}=t;return FG(DG(NG,r,e??!1,i??!1),e,i)}function ePe(t){const{x:e,y:i,z:r,m:n}=t,s=n!=null;return r!=null?s?Yle(e,i,r,n,e,i,r,n):Zle(e,i,r,e,i,r):s?Xle(e,i,n,e,i,n):qle(e,i,e,i)}function Jle(t){const{hasZ:e,hasM:i,rings:r}=t,n=pT(NG,r,e??!1,i??!1);return n?FG(n,e,i):null}function Kle(t){const{hasZ:e,hasM:i,paths:r}=t,n=pT(NG,r,e??!1,i??!1);return n?FG(n,e,i):null}var Z$;function mX(t){return!Array.isArray(t[0])}let Xp=Z$=class extends Py{static fromExtent(t){const e=t.clone().normalize(),i=t.spatialReference;let r=!1,n=!1;for(const o of e)o.hasZ&&(r=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(s.hasZ=!0),n&&(s.hasM=!0),new Z$(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||jt.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=s.length>3):i===void 0?i=r?s.length>3:s.length>2:r===void 0&&(r=i?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=NAe(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Ft;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=Jle(this);if(!e)return null;const i=new Ar(e);return i.spatialReference=t,i}get isSelfIntersecting(){return OAe(this.rings)}writeRings(t,e){e.rings=Le(this.rings)}addRing(t){if(!t)return;const e=this.rings,i=e.length;if(mX(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new Z$;return t.spatialReference=this.spatialReference,t.rings=Le(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,i=t.spatialReference;if(e!=null!=(i!=null)||e!=null&&i!=null&&!e.equals(i)||this.rings.length!==t.rings.length)return!1;const r=([n,s,o,a],[l,c,u,p])=>n===l&&s===c&&(o==null&&u==null||o===u)&&(a==null&&p==null||a===p);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!Ag(s,o,r))return!1}return!0}contains(t){if(!t)return!1;const e=Ub(t,this.spatialReference);return vAe(this,e??t)}isClockwise(t){let e;return e=mX(t)?t.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):t,Ile(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.rings[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new Ft(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new Ft(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new Ft(i[0],i[1],i[2],i[3],this.spatialReference):new Ft(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(dT(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t].splice(e,0,i),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Ft(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new Ft(n,i));return this.notifyChange("rings"),r}setPoint(t,e,i){return this._validateInputs(t,e)?(dT(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[t][e]=i,this.notifyChange("rings"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const r=this.rings[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],Xp.prototype,"cache",null),d([m({readOnly:!0})],Xp.prototype,"centroid",null),d([m({readOnly:!0})],Xp.prototype,"extent",null),d([m({readOnly:!0})],Xp.prototype,"isSelfIntersecting",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],Xp.prototype,"rings",void 0),d([Pr("rings")],Xp.prototype,"writeRings",null),Xp=Z$=d([J("esri.geometry.Polygon")],Xp),Xp.prototype.toJSON.isDefaultToJSON=!0;const zb=Xp;var j8;function tPe(t){return!Array.isArray(t[0])}let j0=j8=class extends Py{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let i,r,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),i=t.hasZ,r=t.hasM):n=t,n=n||[],e=e||jt.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(i===void 0&&r===void 0?(i=s.length>2,r=!1):i===void 0?i=!r&&s.length>3:r===void 0&&(r=!i&&s.length>3)),{paths:n,spatialReference:e,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=Kle(this);if(!e)return null;const i=new Ar(e);return i.spatialReference=t,i}writePaths(t,e){e.paths=Le(this.paths)}addPath(t){if(!t)return;const e=this.paths,i=e.length;if(tPe(t)){const r=[];for(let n=0,s=t.length;n<s;n++)r[n]=t[n].toArray();e[i]=r}else e[i]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new j8;return t.spatialReference=this.spatialReference,t.paths=Le(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const i=this.paths[t][e],r=this.hasZ,n=this.hasM;return r&&!n?new Ft(i[0],i[1],i[2],void 0,this.spatialReference):n&&!r?new Ft(i[0],i[1],void 0,i[2],this.spatialReference):r&&n?new Ft(i[0],i[1],i[2],i[3],this.spatialReference):new Ft(i[0],i[1],this.spatialReference)}insertPoint(t,e,i){return this._validateInputs(t,e,!0)?(dT(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t].splice(e,0,i),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],i=this.spatialReference,r=e.map(n=>new Ft(n,i));return this.notifyChange("paths"),r}removePoint(t,e){if(!this._validateInputs(t,e))return null;const i=new Ft(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(t,e,i){return this._validateInputs(t,e)?(dT(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[t][e]=i,this.notifyChange("paths"),this):this}_validateInputs(t,e,i=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const r=this.paths[t];if(i&&(e<0||e>r.length)||!i&&(e<0||e>=r.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([m({readOnly:!0})],j0.prototype,"cache",null),d([m({readOnly:!0})],j0.prototype,"extent",null),d([m({type:[[[Number]]],json:{write:{isRequired:!0}}})],j0.prototype,"paths",void 0),d([Pr("paths")],j0.prototype,"writePaths",null),j0=j8=d([J("esri.geometry.Polyline")],j0),j0.prototype.toJSON.isDefaultToJSON=!0;const u5=j0,iPe=Ou()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Wmt=Ou()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function Qle(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function kG(t){return t.points!==void 0}function UG(t){return t.x!==void 0&&t.y!==void 0}function zG(t){return t.paths!==void 0}function BG(t){return t.rings!==void 0}function CP(t){return t==null?null:t instanceof Py?t:UG(t)?Ft.fromJSON(t):zG(t)?u5.fromJSON(t):BG(t)?zb.fromJSON(t):kG(t)?M3.fromJSON(t):Qle(t)?Ar.fromJSON(t):null}function VG(t){return t?UG(t)?"esriGeometryPoint":zG(t)?"esriGeometryPolyline":BG(t)?"esriGeometryPolygon":Qle(t)?"esriGeometryEnvelope":kG(t)?"esriGeometryMultipoint":null:null}const rPe={esriGeometryPoint:Ft,esriGeometryPolyline:u5,esriGeometryPolygon:zb,esriGeometryEnvelope:Ar,esriGeometryMultipoint:M3};function nPe(t){return t&&rPe[t]||null}const GG={base:Py,key:"type",typeMap:{extent:Ar,multipoint:M3,point:Ft,polyline:u5,polygon:zb}};ry(GG);let X$=class ece{constructor(){this._emitter=new ece.EventEmitter(this)}emit(e,i){return this._emitter.emit(e,i)}on(e,i){return this._emitter.on(e,i)}once(e,i){return this._emitter.once(e,i)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){var n;(n=this._listenersMap)==null||n.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){const o=this._listenersMap&&this._listenersMap.get(n);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,s)}),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return aT(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(n)||[],l=a.indexOf(s);l>=0&&a.splice(l,1)}}}once(n,s){const o=this.on(n,a=>{o.remove(),s.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap&&this._listenersMap.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=r=>{let n=class extends r{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=d([J("esri.core.Evented")],n),n};let i=class extends ke{constructor(){super(...arguments),this._emitter=new X$.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,n){return this._emitter.emit(r,n)}on(r,n){return this._emitter.on(r,n)}once(r,n){return this._emitter.once(r,n)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=d([J("esri.core.Evented")],i),t.EventedAccessor=i})(X$||(X$={}));const os=X$;var xr;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(xr||(xr={}));function tce(t){return(e,i)=>{e[i]=t}}let h5=class extends aae{notify(){const e=this._observers;if(e&&e.length>0){const i=e.slice();for(const r of i)r.onInvalidated(),r.onCommitted()}}};var rg;let sPe=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const ku=new ea(sPe,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),oPe=()=>{};function NF(t){return t?t instanceof d1?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function FF(t){if(t&&t.length)return t[0]}function aPe(t,e,i,r){const n=Math.min(t.length-i,e.length-r);let s=0;for(;s<n&&t[i+s]===e[r+s];)s++;return s}function ice(t,e,i,r){e&&e.forEach((n,s,o)=>{t.push(n),ice(t,i.call(r,n,s,o),i,r)})}const c0=new Set,u0=new Set,h0=new Set,kF=new Map;let lPe=0,d1=rg=class extends os.EventedAccessor{static isCollection(t){return t!=null&&t instanceof rg}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new h5,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:lPe++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof rg?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return hi(this._observable),this._items}set items(t){this._emitBeforeChanges(xr.ADD)||(this._splice(0,this.length,NF(t)),this._emitAfterChanges(xr.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const i=this._chgListeners,r={removed:!1,callback:e};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=oPe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(t,e)}once(t,e){const i=this.on(t,e);return{remove(){i.remove()}}}add(t,e){if(hi(this._observable),this._emitBeforeChanges(xr.ADD))return this;const i=this.getNextIndex(e??null);return this._splice(i,0,[t]),this._emitAfterChanges(xr.ADD),this}addMany(t,e=this._items.length){if(hi(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(xr.ADD))return this;const i=this.getNextIndex(e);return this._splice(i,0,NF(t)),this._emitAfterChanges(xr.ADD),this}at(t){if(hi(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(hi(this._observable),!this.length||this._emitBeforeChanges(xr.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(xr.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return hi(this._observable),this._createNewInstance({items:this._items.map(Le)})}concat(...t){hi(this._observable);const e=t.map(NF);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(hi(this._observable),!this.length||this._emitBeforeChanges(xr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let n=0;n<r;n++)t.call(e,i[n],n,i);this._emitAfterChanges(xr.REMOVE)}every(t,e){return hi(this._observable),this._items.every(t,e)}filter(t,e){let i;return hi(this._observable),i=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:i})}find(t,e){return hi(this._observable),this._items.find(t,e)}findIndex(t,e){return hi(this._observable),this._items.findIndex(t,e)}flatten(t,e){hi(this._observable);const i=[];return ice(i,this,t,e),new rg(i)}forEach(t,e){return hi(this._observable),this._items.forEach(t,e)}getItemAt(t){return hi(this._observable),this._items[t]}getNextIndex(t){hi(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return hi(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return hi(this._observable),this._items.indexOf(t,e)}join(t=","){return hi(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return hi(this._observable),this._items.lastIndexOf(t,e)}map(t,e){hi(this._observable);const i=this._items.map(t,e);return new rg({items:i})}reorder(t,e=this.length-1){hi(this._observable);const i=this.indexOf(t);if(i!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),i!==e){if(this._emitBeforeChanges(xr.MOVE))return t;this._splice(i,1),this._splice(e,0,[t]),this._emitAfterChanges(xr.MOVE)}return t}}pop(){if(hi(this._observable),!this.length||this._emitBeforeChanges(xr.REMOVE))return;const t=FF(this._splice(this.length-1,1));return this._emitAfterChanges(xr.REMOVE),t}push(...t){return hi(this._observable),this._emitBeforeChanges(xr.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(xr.ADD)),this.length}reduce(t,e){hi(this._observable);const i=this._items;return arguments.length===2?i.reduce(t,e):i.reduce(t)}reduceRight(t,e){hi(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(t,e):i.reduceRight(t)}remove(t){return hi(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(hi(this._observable),t<0||t>=this.length||this._emitBeforeChanges(xr.REMOVE))return;const e=FF(this._splice(t,1));return this._emitAfterChanges(xr.REMOVE),e}removeMany(t){if(hi(this._observable),!t||!t.length||this._emitBeforeChanges(xr.REMOVE))return[];const e=t instanceof rg?t.toArray():t,i=this._items,r=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=i.indexOf(o);if(a>-1){const l=1+aPe(e,i,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),s+=l-1}}return this._emitAfterChanges(xr.REMOVE),r}reverse(){if(hi(this._observable),this._emitBeforeChanges(xr.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(xr.MOVE),this}shift(){if(hi(this._observable),!this.length||this._emitBeforeChanges(xr.REMOVE))return;const t=FF(this._splice(0,1));return this._emitAfterChanges(xr.REMOVE),t}slice(t=0,e=this.length){return hi(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return hi(this._observable),this._items.some(t,e)}sort(t){if(hi(this._observable),!this.length||this._emitBeforeChanges(xr.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(xr.MOVE),this}splice(t,e,...i){hi(this._observable);const r=(e?xr.REMOVE:0)|(i.length?xr.ADD:0);if(this._emitBeforeChanges(r))return[];const n=this._splice(t,e,i)||[];return this._emitAfterChanges(r),n}toArray(){return hi(this._observable),this._items.slice()}toJSON(){return hi(this._observable),this.toArray()}toLocaleString(){return hi(this._observable),this._items.toLocaleString()}toString(){return hi(this._observable),this._items.toString()}unshift(...t){return hi(this._observable),!t.length||this._emitBeforeChanges(xr.ADD)||(this._splice(0,0,t),this._emitAfterChanges(xr.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,i){const r=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=A3(()=>this._dispatchChange())),e){if(o=r.splice(t,e),this.hasEventListener("before-remove")){const a=ku.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(t,0,s),t+=1,l-=1,c-=1);ku.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=ku.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);ku.release(a)}}if(i&&i.length){if(n){const u=[];for(const p of i){const f=n.ensureType(p);f==null&&p!=null||u.push(f)}i=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=ku.acquire();u.target=this,u.cancellable=!0;const p=ku.acquire();p.target=this,p.cancellable=!1;for(const f of i)a?(u.reset(f),this.emit("before-add",u),u.defaultPrevented||(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),l&&(p.reset(f),this.emit("after-add",p)))):(c?r.push(f):r.splice(t++,0,f),this._set("length",r.length),p.reset(f),this.emit("after-add",p));ku.release(p),ku.release(u)}else{if(c)for(const u of i)r.push(u);else r.splice(t,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const i=ku.acquire();i.target=this,i.cancellable=!0,i.type=t,this.emit("before-changes",i),e=i.defaultPrevented,ku.release(i)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=ku.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),ku.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const i=e.changes;c0.clear(),u0.clear(),h0.clear();for(const{added:l,removed:c}of i){if(l)if(h0.size===0&&u0.size===0)for(const u of l)c0.add(u);else for(const u of l)u0.has(u)?(h0.add(u),u0.delete(u)):h0.has(u)||c0.add(u);if(c)if(h0.size===0&&c0.size===0)for(const u of c)u0.add(u);else for(const u of c)c0.has(u)?c0.delete(u):(h0.delete(u),u0.add(u))}const r=fc.acquire();c0.forEach(l=>{r.push(l)});const n=fc.acquire();u0.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=fc.acquire();if(h0.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(r.length||n.length||a.length)){const l={target:this,added:r,removed:n,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const p=e.listeners[u];p.removed||p.callback.call(this,l)}}fc.release(r),fc.release(n),fc.release(a)}c0.clear(),u0.clear(),h0.clear()}};d1.ofType=t=>{if(!t)return rg;if(kF.has(t))return kF.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const r in t.typeMap){const n=t.typeMap[r].prototype.declaredClass;e?e+=` | ${n}`:e=n}let i=class extends rg{};return d([tce({Type:t,ensureType:typeof t=="function"?rl(t):ry(t)})],i.prototype,"itemType",void 0),i=d([J(`esri.core.Collection<${e}>`)],i),kF.set(t,i),i},d([m()],d1.prototype,"length",void 0),d([m()],d1.prototype,"items",null),d1=rg=d([J("esri.core.Collection")],d1);const Ci=d1;var fT;function cPe(t,e){switch(t.type){case"range":{const i="range"in t?t.range[0]:t.minValue,r="range"in t?t.range[1]:t.maxValue;if(i!=null&&+e<i||r!=null&&+e>r)return fT.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(i=>i==null||i.code!==e))return fT.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(fT||(fT={}));const uPe=ye.getLogger("esri.support.arcadeOnDemand");let UF;function jG(){return UF||(UF=(async()=>{const t=await Oe(()=>import("./arcadeUtils-c31bc4d2.js").then(e=>e.az),["./arcadeUtils-c31bc4d2.js","./arcadeTimeUtils-cf7e2dfd.js","./executionError-c92d3b85.js","./FieldsIndex-06c42f48.js","./number-0a517102.js","./hash-6f442295.js"],import.meta.url);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),UF}const hPe=(t,e,i)=>HG.create(t,e,i,null,["$feature"],[]),dPe=(t,e,i)=>HG.create(t,e,i,null,["$feature","$view"],[]),Xmt=(t,e,i,r)=>HG.create(t,e,i,r,["$feature","$view"],[]);let HG=class rce{constructor(e,i,r,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=r,this._arcade=i,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,i,r,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await jG(),u=jt.fromJSON(i);let p;try{p=a.parseScript(e,o)}catch(B){return uPe.error(new ce("arcade-bad-expression","Failed to parse arcade script",{script:e,error:B})),null}const f=s.reduce((B,W)=>({...B,[W]:null}),{});let y=null;n!=null&&(y=new c(n),y.immutable=!0,f.$config=null);const v=a.scriptUsesGeometryEngine(p),b=v&&a.enableGeometrySupport(),x=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),S=a.scriptIsAsync(p),P=S&&a.enableAsyncSupport(),C={vars:f,spatialReference:u,useAsync:!!P};await Promise.all([b,x,P]);const R=new Set;await a.loadDependentModules(R,p,null,S,v);const N=new c;N.immutable=!1,N.setField("scale",0);const $=a.compileScript(p,C),k=(B,W)=>("$view"in B&&B.$view&&(N.setField("scale",typeof B.$view=="object"&&"scale"in B.$view?B.$view.scale:void 0),B.$view=N),y&&(B.$config=y),$({vars:B,spatialReference:u,services:W}));return new rce(e,a,p,k,new l,r,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const pPe=/^([0-9_])/,fPe=/[^a-z0-9_\u0080-\uffff]+/gi;function Ymt(t){return t==null?null:t.trim().replaceAll(fPe,"_").replace(pPe,"F$1")||null}const mPe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],gPe=["field","normalizationField"];function Jmt(t,e){if(t!=null&&e!=null){for(const i of Array.isArray(t)?t:[t])if(gX(mPe,i,e),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)gX(gPe,r,e)}}function gX(t,e,i){if(t)for(const r of t){const n=S3(r,e),s=n&&typeof n!="function"&&i.get(n);s&&rS(r,s.name,e)}}function Kmt(t,e){var i;if(t!=null&&((i=e==null?void 0:e.fields)!=null&&i.length))if("startField"in t){const r=e.get(t.startField),n=e.get(t.endField);t.startField=(r==null?void 0:r.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const r=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(r==null?void 0:r.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const zF=new Set;function nce(t,e){return t&&e?(zF.clear(),EP(zF,t,e),Array.from(zF).sort()):[]}function EP(t,e,i){var r;if(i)if((r=e==null?void 0:e.fields)!=null&&r.length)if(i.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of i)d5(t,e,n);else{if(i.includes("*"))return t.clear(),void t.add("*");for(const n of i)n!=null&&t.add(n)}}function d5(t,e,i){if(typeof i=="string")if(e){const r=e.get(i);r&&t.add(r.name)}else t.add(i)}function Qmt(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(i=>i.name):e}async function cb(t,e,i){var s;if(!i)return;const{arcadeUtils:r}=await jG(),n=r.extractFieldNames(i,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)d5(t,e,o)}async function sce(t,e,i){if(i&&i!=="1=1"){const{WhereClause:r}=await Oe(()=>import("./WhereClause-40a2a5ab.js").then(s=>s.W),["./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js"],import.meta.url),n=r.create(i,e);if(!n.isStandardized)throw new ce("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});EP(t,e,n.fieldNames)}}function egt({displayField:t,fields:e}){return t||(e&&e.length?BF(e,"name-or-title")||BF(e,"unique-identifier")||BF(e,"type-or-category")||_Pe(e):null)}function _Pe(t){for(const e of t){if(!e||!e.name)continue;const i=e.name.toLowerCase();if(i.includes("name")||i.includes("title"))return e.name}return null}function BF(t,e){for(const i of t)if(i&&i.valueType&&i.valueType===e)return i.name;return null}async function tgt(t,e){var r;if(!e)return;const i=(r=e.elevationInfo)==null?void 0:r.featureExpressionInfo;return i?i.collectRequiredFields(t,e.fieldsIndex):void 0}function yPe(t,e,i){i.onStatisticExpression?cb(t,e,i.onStatisticExpression.expression):t.add(i.onStatisticField)}async function igt(t,e,i){if(!e||!i||!("fields"in i))return;const r=[],n=i.popupTemplate;r.push(vPe(t,e,n)),i.fields&&r.push(...i.fields.map(async s=>yPe(t,e.fieldsIndex,s))),await Promise.all(r)}async function vPe(t,e,i){const r=[];i!=null&&i.expressionInfos&&r.push(...i.expressionInfos.map(s=>cb(t,e.fieldsIndex,s.expression)));const n=i==null?void 0:i.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&r.push(cb(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(r)}async function rgt(t,e,i){e&&(e.timeInfo&&i!=null&&i.timeExtent&&EP(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&EP(t,e.fieldsIndex,[e.floorInfo.floorField]),i!=null&&i.where!=null&&await sce(t,e.fieldsIndex,i.where))}async function ngt(t,e,i){e&&i&&await Promise.all(i.map(r=>bPe(t,e,r)))}async function bPe(t,e,i){e&&i&&(i.valueExpression?await cb(t,e.fieldsIndex,i.valueExpression):i.field&&d5(t,e.fieldsIndex,i.field))}function sgt(t){return t?nce(t.fieldsIndex,oce(t)):[]}function wPe(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?nce(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const xPe=["oid","global-id","guid"],TPe=["oid","global-id"],SPe=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function CPe(t){const e=new Set;ace(t).forEach(r=>e.add(r)),wPe(t).forEach(r=>e.add(r.toLowerCase()));const i=t&&"infoFor3D"in t?t.infoFor3D:void 0;return i&&(Object.values(i.assetMapFieldRoles).forEach(r=>e.add(r.toLowerCase())),Object.values(i.transformFieldRoles).forEach(r=>e.add(r.toLowerCase()))),Array.from(e)}function oce(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:i,creatorField:r,editDateField:n,editorField:s}=e;return[i,r,n,s].filter(Boolean)}function ace(t){return oce(t).map(e=>e.toLowerCase())}function ogt(t,e){var i;return t.editable&&!xPe.includes(t.type)&&!ace(e).includes(((i=t.name)==null?void 0:i.toLowerCase())??"")}function agt(t,e){var r;const i=((r=t.name)==null?void 0:r.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&i===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&i===e.globalIdField.toLowerCase()||CPe(e).includes(i)||TPe.includes(t.type)||SPe.some(n=>n.test(i)))}async function lgt(t,e){const{labelingInfo:i,fieldsIndex:r}=e;i&&i.length&&await Promise.all(i.map(n=>EPe(t,r,n)))}async function EPe(t,e,i){if(!i)return;const r=i.getLabelExpression(),n=i.where;if(r.type==="arcade")await cb(t,e,r.expression);else{const s=r.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{d5(t,e,o.slice(1,-1))})}await sce(t,e,n)}function cgt(t){const e=t.defaultValue;return e!==void 0&&uce(t,e)?e:t.nullable?null:void 0}function lce(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function APe(t){return t===null||lce(t)}const WG="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function PPe(t){return t===null||WG(t)}function cce(t){return t!=null&&typeof t=="string"}function OPe(t){return t===null||cce(t)}function RPe(){return!0}function uce(t,e){let i;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=t.nullable?PPe:WG;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=t.nullable?APe:lce;break;case"string":case"esriFieldTypeString":i=t.nullable?OPe:cce;break;default:i=RPe}return arguments.length===1?i:i(e)}const MPe=["integer","small-integer","single","double"],$Pe=new Set([...MPe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),IPe=["date","date-only","time-only","timestamp-offset"],LPe=new Set([...IPe,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function hce(t){return t!=null&&$Pe.has(t.type)}function ugt(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function hgt(t){return t!=null&&LPe.has(t.type)}var UL,zL;function dgt(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function pgt(t,e){return t==null||t.nullable&&e===null?null:hce(t)&&!DPe(t.type,Number(e))?UL.OUT_OF_RANGE:uce(t,e)?t.domain?cPe(t.domain,e):null:zL.INVALID_TYPE}function DPe(t,e){const i=typeof t=="string"?dce(t):t;if(!i)return!1;const r=i.min,n=i.max;return i.isInteger?WG(e)&&e>=r&&e<=n:e>=r&&e<=n}function dce(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return NPe;case"esriFieldTypeInteger":case"integer":return FPe;case"esriFieldTypeBigInteger":case"big-integer":return kPe;case"esriFieldTypeSingle":case"single":return UPe;case"esriFieldTypeDouble":case"double":return zPe}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(UL||(UL={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(zL||(zL={}));const NPe={min:-32768,max:32767,isInteger:!0},FPe={min:-2147483648,max:2147483647,isInteger:!0},kPe={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},UPe={min:-34e37,max:12e37,isInteger:!1},zPe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function fgt(t,e,i){switch(t){case fT.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case fT.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case zL.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case UL.OUT_OF_RANGE:{const{min:r,max:n}=dce(e.type);return`Value ${i} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${r} to ${n}`}}}function mgt(t,e){return!BPe(t,e,null)}function BPe(t,e,i){if(!e||!e.attributes||!t){if(i!=null)for(const s of t??[])i.add(s);return!0}const r=e.attributes;let n=!1;for(const s of t)if(!(s in r)){if(n=!0,i==null)break;i.add(s)}return n}function ggt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}let Y$=class extends Nt{constructor(e){super(e),this.type=null}};d([m({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],Y$.prototype,"type",void 0),Y$=d([J("esri.popup.content.Content")],Y$);const Oy=Y$;var H8;let Pv=H8=class extends Oy{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new H8({description:this.description,displayType:this.displayType,title:this.title})}};d([m({type:String,json:{write:!0}})],Pv.prototype,"description",void 0),d([m({type:["auto","preview","list"],json:{write:!0}})],Pv.prototype,"displayType",void 0),d([m({type:String,json:{write:!0}})],Pv.prototype,"title",void 0),d([m({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Pv.prototype,"type",void 0),Pv=H8=d([J("esri.popup.content.AttachmentsContent")],Pv);const BL=Pv;var W8;let Ov=W8=class extends Oy{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new W8({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?Le(this.outFields):null})}};d([m()],Ov.prototype,"creator",void 0),d([m()],Ov.prototype,"destroyer",void 0),d([m()],Ov.prototype,"outFields",void 0),d([m({type:["custom"],readOnly:!0})],Ov.prototype,"type",void 0),Ov=W8=d([J("esri.popup.content.CustomContent")],Ov);const VPe=Ov;var q8;let Ix=q8=class extends Nt{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new q8({title:this.title,expression:this.expression})}};d([m({type:String,json:{write:!0}})],Ix.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],Ix.prototype,"expression",void 0),d([m({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],Ix.prototype,"returnType",void 0),Ix=q8=d([J("esri.popup.ElementExpressionInfo")],Ix);const GPe=Ix;var Z8;let oE=Z8=class extends Oy{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new Z8({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};d([m({type:GPe,json:{write:!0}})],oE.prototype,"expressionInfo",void 0),d([m({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],oE.prototype,"type",void 0),oE=Z8=d([J("esri.popup.content.ExpressionContent")],oE);const qG=oE;function Si(t,e={}){const i=t instanceof Tu?t:new Tu(t,e),r={type:(e==null?void 0:e.ignoreUnknown)??1?i.apiValues:String,json:{type:i.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(r.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(r.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(r.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(r.nonNullable=e.nonNullable),m(r)}let EA;var Loe,Doe;const jPe=((Loe=globalThis.esriConfig)==null?void 0:Loe.locale)??((Doe=globalThis.dojoConfig)==null?void 0:Doe.locale);function pce(){var t;return jPe??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function ip(){return EA===void 0&&(EA=pce()),EA}const AA=[];function fce(t){return AA.push(t),{remove(){AA.splice(AA.indexOf(t),1)}}}const X8=[];function ZG(t){return X8.push(t),{remove(){AA.splice(X8.indexOf(t),1)}}}function HPe(){const t=pce();EA!==t&&(EA=t,[...X8].forEach(e=>{e.call(null,t)}),[...AA].forEach(e=>{e.call(null,t)}))}var Noe;(Noe=globalThis.addEventListener)==null||Noe.call(globalThis,"languagechange",HPe);class Bb extends Error{}class WPe extends Bb{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class qPe extends Bb{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class ZPe extends Bb{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class aE extends Bb{}class mce extends Bb{constructor(e){super(`Invalid unit ${e}`)}}class gh extends Bb{}class d0 extends Bb{constructor(){super("Zone is an abstract class")}}const dt="numeric",hp="short",fu="long",VL={year:dt,month:dt,day:dt},gce={year:dt,month:hp,day:dt},XPe={year:dt,month:hp,day:dt,weekday:hp},_ce={year:dt,month:fu,day:dt},yce={year:dt,month:fu,day:dt,weekday:fu},vce={hour:dt,minute:dt},bce={hour:dt,minute:dt,second:dt},wce={hour:dt,minute:dt,second:dt,timeZoneName:hp},xce={hour:dt,minute:dt,second:dt,timeZoneName:fu},Tce={hour:dt,minute:dt,hourCycle:"h23"},Sce={hour:dt,minute:dt,second:dt,hourCycle:"h23"},Cce={hour:dt,minute:dt,second:dt,hourCycle:"h23",timeZoneName:hp},Ece={hour:dt,minute:dt,second:dt,hourCycle:"h23",timeZoneName:fu},Ace={year:dt,month:dt,day:dt,hour:dt,minute:dt},Pce={year:dt,month:dt,day:dt,hour:dt,minute:dt,second:dt},Oce={year:dt,month:hp,day:dt,hour:dt,minute:dt},Rce={year:dt,month:hp,day:dt,hour:dt,minute:dt,second:dt},YPe={year:dt,month:hp,day:dt,weekday:hp,hour:dt,minute:dt},Mce={year:dt,month:fu,day:dt,hour:dt,minute:dt,timeZoneName:hp},$ce={year:dt,month:fu,day:dt,hour:dt,minute:dt,second:dt,timeZoneName:hp},Ice={year:dt,month:fu,day:dt,weekday:fu,hour:dt,minute:dt,timeZoneName:fu},Lce={year:dt,month:fu,day:dt,weekday:fu,hour:dt,minute:dt,second:dt,timeZoneName:fu};class $3{get type(){throw new d0}get name(){throw new d0}get ianaName(){return this.name}get isUniversal(){throw new d0}offsetName(e,i){throw new d0}formatOffset(e,i){throw new d0}offset(e){throw new d0}equals(e){throw new d0}get isValid(){throw new d0}}let VF=null;class p5 extends $3{static get instance(){return VF===null&&(VF=new p5),VF}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return Nce(e,i,r)}formatOffset(e,i){return OA(this.offset(e),i)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let J$={};function JPe(t){return J$[t]||(J$[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),J$[t]}const KPe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function QPe(t,e){const i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,n,s,o,a,l,c,u]=r;return[o,n,s,a,l,c,u]}function e3e(t,e){const i=t.formatToParts(e),r=[];for(let n=0;n<i.length;n++){const{type:s,value:o}=i[n],a=KPe[s];s==="era"?r[a]=o:Tr(a)||(r[a]=parseInt(o,10))}return r}let sR={};class Mg extends $3{static create(e){return sR[e]||(sR[e]=new Mg(e)),sR[e]}static resetCache(){sR={},J$={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=Mg.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:i,locale:r}){return Nce(e,i,r,this.name)}formatOffset(e,i){return OA(this.offset(e),i)}offset(e){const i=new Date(e);if(isNaN(i))return NaN;const r=JPe(this.name);let[n,s,o,a,l,c,u]=r.formatToParts?e3e(r,i):QPe(r,i);a==="BC"&&(n=-Math.abs(n)+1);const f=JG({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let y=+i;const v=y%1e3;return y-=v>=0?v:1e3+v,(f-y)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let _X={};function t3e(t,e={}){const i=JSON.stringify([t,e]);let r=_X[i];return r||(r=new Intl.ListFormat(t,e),_X[i]=r),r}let Y8={};function J8(t,e={}){const i=JSON.stringify([t,e]);let r=Y8[i];return r||(r=new Intl.DateTimeFormat(t,e),Y8[i]=r),r}let K8={};function i3e(t,e={}){const i=JSON.stringify([t,e]);let r=K8[i];return r||(r=new Intl.NumberFormat(t,e),K8[i]=r),r}let Q8={};function r3e(t,e={}){const{base:i,...r}=e,n=JSON.stringify([t,r]);let s=Q8[n];return s||(s=new Intl.RelativeTimeFormat(t,e),Q8[n]=s),s}let lE=null;function n3e(){return lE||(lE=new Intl.DateTimeFormat().resolvedOptions().locale,lE)}function s3e(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const i=t.indexOf("-u-");if(i===-1)return[t];{let r,n;try{r=J8(t).resolvedOptions(),n=t}catch{const l=t.substring(0,i);r=J8(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=r;return[n,s,o]}}function o3e(t,e,i){return(i||e)&&(t.includes("-u-")||(t+="-u"),i&&(t+=`-ca-${i}`),e&&(t+=`-nu-${e}`)),t}function a3e(t){const e=[];for(let i=1;i<=12;i++){const r=Li.utc(2016,i,1);e.push(t(r))}return e}function l3e(t){const e=[];for(let i=1;i<=7;i++){const r=Li.utc(2016,11,13+i);e.push(t(r))}return e}function oR(t,e,i,r,n){const s=t.listingMode(i);return s==="error"?null:s==="en"?r(e):n(e)}function c3e(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class u3e{constructor(e,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:n,floor:s,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=i3e(e,a)}}format(e){if(this.inf){const i=this.floor?Math.floor(e):e;return this.inf.format(i)}else{const i=this.floor?Math.floor(e):YG(e,3);return lo(i,this.padTo)}}}class h3e{constructor(e,i,r){this.opts=r,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&Mg.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=J8(i,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(i=>{if(i.type==="timeZoneName"){const r=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...i,value:r}}else return i}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class d3e{constructor(e,i,r){this.opts={style:"long",...r},!i&&Dce()&&(this.rtf=r3e(e,r))}format(e,i){return this.rtf?this.rtf.format(e,i):O3e(i,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,i){return this.rtf?this.rtf.formatToParts(e,i):[]}}class Hn{static fromOpts(e){return Hn.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,i,r,n=!1){const s=e||oo.defaultLocale,o=s||(n?"en-US":n3e()),a=i||oo.defaultNumberingSystem,l=r||oo.defaultOutputCalendar;return new Hn(o,a,l,s)}static resetCache(){lE=null,Y8={},K8={},Q8={}}static fromObject({locale:e,numberingSystem:i,outputCalendar:r}={}){return Hn.create(e,i,r)}constructor(e,i,r,n){const[s,o,a]=s3e(e);this.locale=s,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=o3e(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=c3e(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&i?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:Hn.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,i=!1,r=!0){return oR(this,e,r,Uce,()=>{const n=i?{month:e,day:"numeric"}:{month:e},s=i?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=a3e(o=>this.extract(o,n,"month"))),this.monthsCache[s][e]})}weekdays(e,i=!1,r=!0){return oR(this,e,r,Vce,()=>{const n=i?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=i?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=l3e(o=>this.extract(o,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(e=!0){return oR(this,void 0,e,()=>Gce,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Li.utc(2016,11,13,9),Li.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(e,i=!0){return oR(this,e,i,jce,()=>{const r={era:e};return this.eraCache[e]||(this.eraCache[e]=[Li.utc(-40,1,1),Li.utc(2017,1,1)].map(n=>this.extract(n,r,"era"))),this.eraCache[e]})}extract(e,i,r){const n=this.dtFormatter(e,i),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(e={}){return new u3e(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,i={}){return new h3e(e,this.intl,i)}relFormatter(e={}){return new d3e(this.intl,this.isEnglish(),e)}listFormatter(e={}){return t3e(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let GF=null;class el extends $3{static get utcInstance(){return GF===null&&(GF=new el(0)),GF}static instance(e){return e===0?el.utcInstance:new el(e)}static parseSpecifier(e){if(e){const i=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new el(m5(i[1],i[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${OA(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${OA(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,i){return OA(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class p3e extends $3{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function x_(t,e){if(Tr(t)||t===null)return e;if(t instanceof $3)return t;if(f3e(t)){const i=t.toLowerCase();return i==="default"?e:i==="local"||i==="system"?p5.instance:i==="utc"||i==="gmt"?el.utcInstance:el.parseSpecifier(i)||Mg.create(t)}else return z1(t)?el.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new p3e(t)}let yX=()=>Date.now(),vX="system",bX=null,wX=null,xX=null,TX=60,SX;class oo{static get now(){return yX}static set now(e){yX=e}static set defaultZone(e){vX=e}static get defaultZone(){return x_(vX,p5.instance)}static get defaultLocale(){return bX}static set defaultLocale(e){bX=e}static get defaultNumberingSystem(){return wX}static set defaultNumberingSystem(e){wX=e}static get defaultOutputCalendar(){return xX}static set defaultOutputCalendar(e){xX=e}static get twoDigitCutoffYear(){return TX}static set twoDigitCutoffYear(e){TX=e%100}static get throwOnInvalid(){return SX}static set throwOnInvalid(e){SX=e}static resetCaches(){Hn.resetCache(),Mg.resetCache()}}function Tr(t){return typeof t>"u"}function z1(t){return typeof t=="number"}function f5(t){return typeof t=="number"&&t%1===0}function f3e(t){return typeof t=="string"}function m3e(t){return Object.prototype.toString.call(t)==="[object Date]"}function Dce(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function g3e(t){return Array.isArray(t)?t:[t]}function CX(t,e,i){if(t.length!==0)return t.reduce((r,n)=>{const s=[e(n),n];return r&&i(r[0],s[0])===r[0]?r:s},null)[1]}function _3e(t,e){return e.reduce((i,r)=>(i[r]=t[r],i),{})}function mT(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function hg(t,e,i){return f5(t)&&t>=e&&t<=i}function y3e(t,e){return t-e*Math.floor(t/e)}function lo(t,e=2){const i=t<0;let r;return i?r="-"+(""+-t).padStart(e,"0"):r=(""+t).padStart(e,"0"),r}function p_(t){if(!(Tr(t)||t===null||t===""))return parseInt(t,10)}function Zy(t){if(!(Tr(t)||t===null||t===""))return parseFloat(t)}function XG(t){if(!(Tr(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function YG(t,e,i=!1){const r=10**e;return(i?Math.trunc:Math.round)(t*r)/r}function I3(t){return t%4===0&&(t%100!==0||t%400===0)}function PA(t){return I3(t)?366:365}function GL(t,e){const i=y3e(e-1,12)+1,r=t+(e-i)/12;return i===2?I3(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function JG(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function jL(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,i=t-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return e===4||r===3?53:52}function e9(t){return t>99?t:t>oo.twoDigitCutoffYear?1900+t:2e3+t}function Nce(t,e,i,r=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(s.timeZone=r);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(i,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function m5(t,e){let i=parseInt(t,10);Number.isNaN(i)&&(i=0);const r=parseInt(e,10)||0,n=i<0||Object.is(i,-0)?-r:r;return i*60+n}function Fce(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new gh(`Invalid unit value ${t}`);return e}function HL(t,e){const i={};for(const r in t)if(mT(t,r)){const n=t[r];if(n==null)continue;i[e(r)]=Fce(n)}return i}function OA(t,e){const i=Math.trunc(Math.abs(t/60)),r=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${lo(i,2)}:${lo(r,2)}`;case"narrow":return`${n}${i}${r>0?`:${r}`:""}`;case"techie":return`${n}${lo(i,2)}${lo(r,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function g5(t){return _3e(t,["hour","minute","second","millisecond"])}const v3e=["January","February","March","April","May","June","July","August","September","October","November","December"],kce=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],b3e=["J","F","M","A","M","J","J","A","S","O","N","D"];function Uce(t){switch(t){case"narrow":return[...b3e];case"short":return[...kce];case"long":return[...v3e];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const zce=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Bce=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],w3e=["M","T","W","T","F","S","S"];function Vce(t){switch(t){case"narrow":return[...w3e];case"short":return[...Bce];case"long":return[...zce];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Gce=["AM","PM"],x3e=["Before Christ","Anno Domini"],T3e=["BC","AD"],S3e=["B","A"];function jce(t){switch(t){case"narrow":return[...S3e];case"short":return[...T3e];case"long":return[...x3e];default:return null}}function C3e(t){return Gce[t.hour<12?0:1]}function E3e(t,e){return Vce(e)[t.weekday-1]}function A3e(t,e){return Uce(e)[t.month-1]}function P3e(t,e){return jce(e)[t.year<0?0:1]}function O3e(t,e,i="always",r=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(i==="auto"&&s){const p=t==="days";switch(e){case 1:return p?"tomorrow":`next ${n[t][0]}`;case-1:return p?"yesterday":`last ${n[t][0]}`;case 0:return p?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],u=r?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function EX(t,e){let i="";for(const r of t)r.literal?i+=r.val:i+=e(r.val);return i}const R3e={D:VL,DD:gce,DDD:_ce,DDDD:yce,t:vce,tt:bce,ttt:wce,tttt:xce,T:Tce,TT:Sce,TTT:Cce,TTTT:Ece,f:Ace,ff:Oce,fff:Mce,ffff:Ice,F:Pce,FF:Rce,FFF:$ce,FFFF:Lce};class Ja{static create(e,i={}){return new Ja(e,i)}static parseFormat(e){let i=null,r="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),i=null,r="",n=!n):n||a===i?r+=a:(r.length>0&&s.push({literal:/^\s+$/.test(r),val:r}),r=a,i=a)}return r.length>0&&s.push({literal:n||/^\s+$/.test(r),val:r}),s}static macroTokenToFormatOpts(e){return R3e[e]}constructor(e,i){this.opts=i,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTime(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).format()}formatDateTimeParts(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).formatToParts()}formatInterval(e,i={}){return this.loc.dtFormatter(e.start,{...this.opts,...i}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,i={}){return this.loc.dtFormatter(e,{...this.opts,...i}).resolvedOptions()}num(e,i=0){if(this.opts.forceSimple)return lo(e,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(e)}formatDateTimeFromString(e,i){const r=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(y,v)=>this.loc.extract(e,y,v),o=y=>e.isOffsetFixed&&e.offset===0&&y.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,y.format):"",a=()=>r?C3e(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(y,v)=>r?A3e(e,y):s(v?{month:y}:{month:y,day:"numeric"},"month"),c=(y,v)=>r?E3e(e,y):s(v?{weekday:y}:{weekday:y,month:"long",day:"numeric"},"weekday"),u=y=>{const v=Ja.macroTokenToFormatOpts(y);return v?this.formatWithSystemDefault(e,v):y},p=y=>r?P3e(e,y):s({era:y},"era"),f=y=>{switch(y){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(y)}};return EX(Ja.parseFormat(i),f)}formatDurationFromString(e,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=r(c);return u?this.num(l.get(u),c.length):c},s=Ja.parseFormat(i),o=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(r).filter(l=>l));return EX(s,n(a))}}class qd{constructor(e,i){this.reason=e,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const Hce=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function nS(...t){const e=t.reduce((i,r)=>i+r.source,"");return RegExp(`^${e}$`)}function sS(...t){return e=>t.reduce(([i,r,n],s)=>{const[o,a,l]=s(e,n);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function oS(t,...e){if(t==null)return[null,null];for(const[i,r]of e){const n=i.exec(t);if(n)return r(n)}return[null,null]}function Wce(...t){return(e,i)=>{const r={};let n;for(n=0;n<t.length;n++)r[t[n]]=p_(e[i+n]);return[r,null,i+n]}}const qce=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,M3e=`(?:${qce.source}?(?:\\[(${Hce.source})\\])?)?`,KG=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Zce=RegExp(`${KG.source}${M3e}`),QG=RegExp(`(?:T${Zce.source})?`),$3e=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,I3e=/(\d{4})-?W(\d\d)(?:-?(\d))?/,L3e=/(\d{4})-?(\d{3})/,D3e=Wce("weekYear","weekNumber","weekDay"),N3e=Wce("year","ordinal"),F3e=/(\d{4})-(\d\d)-(\d\d)/,Xce=RegExp(`${KG.source} ?(?:${qce.source}|(${Hce.source}))?`),k3e=RegExp(`(?: ${Xce.source})?`);function z2(t,e,i){const r=t[e];return Tr(r)?i:p_(r)}function U3e(t,e){return[{year:z2(t,e),month:z2(t,e+1,1),day:z2(t,e+2,1)},null,e+3]}function aS(t,e){return[{hours:z2(t,e,0),minutes:z2(t,e+1,0),seconds:z2(t,e+2,0),milliseconds:XG(t[e+3])},null,e+4]}function L3(t,e){const i=!t[e]&&!t[e+1],r=m5(t[e+1],t[e+2]),n=i?null:el.instance(r);return[{},n,e+3]}function D3(t,e){const i=t[e]?Mg.create(t[e]):null;return[{},i,e+1]}const z3e=RegExp(`^T?${KG.source}$`),B3e=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function V3e(t){const[e,i,r,n,s,o,a,l,c]=t,u=e[0]==="-",p=l&&l[0]==="-",f=(y,v=!1)=>y!==void 0&&(v||y&&u)?-y:y;return[{years:f(Zy(i)),months:f(Zy(r)),weeks:f(Zy(n)),days:f(Zy(s)),hours:f(Zy(o)),minutes:f(Zy(a)),seconds:f(Zy(l),l==="-0"),milliseconds:f(XG(c),p)}]}const G3e={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function ej(t,e,i,r,n,s,o){const a={year:e.length===2?e9(p_(e)):p_(e),month:kce.indexOf(i)+1,day:p_(r),hour:p_(n),minute:p_(s)};return o&&(a.second=p_(o)),t&&(a.weekday=t.length>3?zce.indexOf(t)+1:Bce.indexOf(t)+1),a}const j3e=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function H3e(t){const[,e,i,r,n,s,o,a,l,c,u,p]=t,f=ej(e,n,r,i,s,o,a);let y;return l?y=G3e[l]:c?y=0:y=m5(u,p),[f,new el(y)]}function W3e(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const q3e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Z3e=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,X3e=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function AX(t){const[,e,i,r,n,s,o,a]=t;return[ej(e,n,r,i,s,o,a),el.utcInstance]}function Y3e(t){const[,e,i,r,n,s,o,a]=t;return[ej(e,a,i,r,n,s,o),el.utcInstance]}const J3e=nS($3e,QG),K3e=nS(I3e,QG),Q3e=nS(L3e,QG),eOe=nS(Zce),Yce=sS(U3e,aS,L3,D3),tOe=sS(D3e,aS,L3,D3),iOe=sS(N3e,aS,L3,D3),rOe=sS(aS,L3,D3);function nOe(t){return oS(t,[J3e,Yce],[K3e,tOe],[Q3e,iOe],[eOe,rOe])}function sOe(t){return oS(W3e(t),[j3e,H3e])}function oOe(t){return oS(t,[q3e,AX],[Z3e,AX],[X3e,Y3e])}function aOe(t){return oS(t,[B3e,V3e])}const lOe=sS(aS);function cOe(t){return oS(t,[z3e,lOe])}const uOe=nS(F3e,k3e),hOe=nS(Xce),dOe=sS(aS,L3,D3);function pOe(t){return oS(t,[uOe,Yce],[hOe,dOe])}const fOe="Invalid Duration",Jce={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},mOe={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...Jce},Uu=146097/400,Tw=146097/4800,gOe={years:{quarters:4,months:12,weeks:Uu/7,days:Uu,hours:Uu*24,minutes:Uu*24*60,seconds:Uu*24*60*60,milliseconds:Uu*24*60*60*1e3},quarters:{months:3,weeks:Uu/28,days:Uu/4,hours:Uu*24/4,minutes:Uu*24*60/4,seconds:Uu*24*60*60/4,milliseconds:Uu*24*60*60*1e3/4},months:{weeks:Tw/7,days:Tw,hours:Tw*24,minutes:Tw*24*60,seconds:Tw*24*60*60,milliseconds:Tw*24*60*60*1e3},...Jce},Rv=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],_Oe=Rv.slice(0).reverse();function p0(t,e,i=!1){const r={values:i?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new Ir(r)}function yOe(t){return t<0?Math.floor(t):Math.ceil(t)}function Kce(t,e,i,r,n){const s=t[n][i],o=e[i]/s,a=Math.sign(o)===Math.sign(r[n]),l=!a&&r[n]!==0&&Math.abs(o)<=1?yOe(o):Math.trunc(o);r[n]+=l,e[i]-=l*s}function vOe(t,e){_Oe.reduce((i,r)=>Tr(e[r])?i:(i&&Kce(t,e,i,e,r),r),null)}function bOe(t){const e={};for(const[i,r]of Object.entries(t))r!==0&&(e[i]=r);return e}class Ir{constructor(e){const i=e.conversionAccuracy==="longterm"||!1;let r=i?gOe:mOe;e.matrix&&(r=e.matrix),this.values=e.values,this.loc=e.loc||Hn.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=r,this.isLuxonDuration=!0}static fromMillis(e,i){return Ir.fromObject({milliseconds:e},i)}static fromObject(e,i={}){if(e==null||typeof e!="object")throw new gh(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new Ir({values:HL(e,Ir.normalizeUnit),loc:Hn.fromObject(i),conversionAccuracy:i.conversionAccuracy,matrix:i.matrix})}static fromDurationLike(e){if(z1(e))return Ir.fromMillis(e);if(Ir.isDuration(e))return e;if(typeof e=="object")return Ir.fromObject(e);throw new gh(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,i){const[r]=aOe(e);return r?Ir.fromObject(r,i):Ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,i){const[r]=cOe(e);return r?Ir.fromObject(r,i):Ir.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,i=null){if(!e)throw new gh("need to specify a reason the Duration is invalid");const r=e instanceof qd?e:new qd(e,i);if(oo.throwOnInvalid)throw new ZPe(r);return new Ir({invalid:r})}static normalizeUnit(e){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!i)throw new mce(e);return i}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Ja.create(this.loc,r).formatDurationFromString(this,e):fOe}toHuman(e={}){const i=Rv.map(r=>{const n=this.values[r];return Tr(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:r.slice(0,-1)}).format(n)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=YG(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const r=this.shiftTo("hours","minutes","seconds","milliseconds");let n=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(n+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||r.milliseconds!==0)&&(n+=".SSS"));let s=r.toFormat(n);return e.includePrefix&&(s="T"+s),s}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e),r={};for(const n of Rv)(mT(i.values,n)||mT(this.values,n))&&(r[n]=i.get(n)+this.get(n));return p0(this,{values:r},!0)}minus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e);return this.plus(i.negate())}mapUnits(e){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=Fce(e(this.values[r],r));return p0(this,{values:i},!0)}get(e){return this[Ir.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const i={...this.values,...HL(e,Ir.normalizeUnit)};return p0(this,{values:i})}reconfigure({locale:e,numberingSystem:i,conversionAccuracy:r,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:i}),matrix:n,conversionAccuracy:r};return p0(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return vOe(this.matrix,e),p0(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=bOe(this.normalize().shiftToAll().toObject());return p0(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>Ir.normalizeUnit(o));const i={},r={},n=this.toObject();let s;for(const o of Rv)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;z1(n[o])&&(a+=n[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in n)Rv.indexOf(c)>Rv.indexOf(o)&&Kce(this.matrix,n,c,i,o)}else z1(n[o])&&(r[o]=n[o]);for(const o in r)r[o]!==0&&(i[s]+=o===s?r[o]:r[o]/this.matrix[s][o]);return p0(this,{values:i},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const i of Object.keys(this.values))e[i]=this.values[i]===0?0:-this.values[i];return p0(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function i(r,n){return r===void 0||r===0?n===void 0||n===0:r===n}for(const r of Rv)if(!i(this.values[r],e.values[r]))return!1;return!0}}const Sw="Invalid Interval";function wOe(t,e){return!t||!t.isValid?bs.invalid("missing or invalid start"):!e||!e.isValid?bs.invalid("missing or invalid end"):e<t?bs.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class bs{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,i=null){if(!e)throw new gh("need to specify a reason the Interval is invalid");const r=e instanceof qd?e:new qd(e,i);if(oo.throwOnInvalid)throw new qPe(r);return new bs({invalid:r})}static fromDateTimes(e,i){const r=rC(e),n=rC(i),s=wOe(r,n);return s??new bs({start:r,end:n})}static after(e,i){const r=Ir.fromDurationLike(i),n=rC(e);return bs.fromDateTimes(n,n.plus(r))}static before(e,i){const r=Ir.fromDurationLike(i),n=rC(e);return bs.fromDateTimes(n.minus(r),n)}static fromISO(e,i){const[r,n]=(e||"").split("/",2);if(r&&n){let s,o;try{s=Li.fromISO(r,i),o=s.isValid}catch{o=!1}let a,l;try{a=Li.fromISO(n,i),l=a.isValid}catch{l=!1}if(o&&l)return bs.fromDateTimes(s,a);if(o){const c=Ir.fromISO(n,i);if(c.isValid)return bs.after(s,c)}else if(l){const c=Ir.fromISO(r,i);if(c.isValid)return bs.before(a,c)}}return bs.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(e),r=this.end.startOf(e);return Math.floor(r.diff(i,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:i}={}){return this.isValid?bs.fromDateTimes(e||this.s,i||this.e):this}splitAt(...e){if(!this.isValid)return[];const i=e.map(rC).filter(o=>this.contains(o)).sort(),r=[];let{s:n}=this,s=0;for(;n<this.e;){const o=i[s]||this.e,a=+o>+this.e?this.e:o;r.push(bs.fromDateTimes(n,a)),n=a,s+=1}return r}splitBy(e){const i=Ir.fromDurationLike(e);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,n=1,s;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(bs.fromDateTimes(r,s)),r=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const i=this.s>e.s?this.s:e.s,r=this.e<e.e?this.e:e.e;return i>=r?null:bs.fromDateTimes(i,r)}union(e){if(!this.isValid)return this;const i=this.s<e.s?this.s:e.s,r=this.e>e.e?this.e:e.e;return bs.fromDateTimes(i,r)}static merge(e){const[i,r]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return r&&i.push(r),i}static xor(e){let i=null,r=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&n.push(bs.fromDateTimes(i,l.time)),i=null);return bs.merge(n)}difference(...e){return bs.xor([this].concat(e)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:Sw}toLocaleString(e=VL,i={}){return this.isValid?Ja.create(this.s.loc.clone(i),e).formatInterval(this):Sw}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:Sw}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:Sw}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:Sw}toFormat(e,{separator:i="  "}={}){return this.isValid?`${this.s.toFormat(e)}${i}${this.e.toFormat(e)}`:Sw}toDuration(e,i){return this.isValid?this.e.diff(this.s,e,i):Ir.invalid(this.invalidReason)}mapEndpoints(e){return bs.fromDateTimes(e(this.s),e(this.e))}}class aR{static hasDST(e=oo.defaultZone){const i=Li.now().setZone(e).set({month:12});return!e.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(e){return Mg.isValidZone(e)}static normalizeZone(e){return x_(e,oo.defaultZone)}static months(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Hn.create(i,r,s)).months(e)}static monthsFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||Hn.create(i,r,s)).months(e,!0)}static weekdays(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||Hn.create(i,r,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:i=null,numberingSystem:r=null,locObj:n=null}={}){return(n||Hn.create(i,r,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return Hn.create(e).meridiems()}static eras(e="short",{locale:i=null}={}){return Hn.create(i,null,"gregory").eras(e)}static features(){return{relative:Dce()}}}function PX(t,e){const i=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(e)-i(t);return Math.floor(Ir.fromMillis(r).as("days"))}function xOe(t,e,i){const r=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=PX(l,c);return(u-u%7)/7}],["days",PX]],n={},s=t;let o,a;for(const[l,c]of r)i.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n)):t=a);return[t,n,a,o]}function TOe(t,e,i,r){let[n,s,o,a]=xOe(t,e,i);const l=e-n,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=Ir.fromObject(s,r);return c.length>0?Ir.fromMillis(l,r).shiftTo(...c).plus(u):u}const tj={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},OX={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},SOe=tj.hanidec.replace(/[\[|\]]/g,"").split("");function COe(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);if(t[i].search(tj.hanidec)!==-1)e+=SOe.indexOf(t[i]);else for(const n in OX){const[s,o]=OX[n];r>=s&&r<=o&&(e+=r-s)}}return parseInt(e,10)}else return e}function sd({numberingSystem:t},e=""){return new RegExp(`${tj[t||"latn"]}${e}`)}const EOe="missing Intl.DateTimeFormat.formatToParts support";function Hr(t,e=i=>i){return{regex:t,deser:([i])=>e(COe(i))}}const AOe=String.fromCharCode(160),Qce=`[ ${AOe}]`,eue=new RegExp(Qce,"g");function POe(t){return t.replace(/\./g,"\\.?").replace(eue,Qce)}function RX(t){return t.replace(/\./g,"").replace(eue," ").toLowerCase()}function od(t,e){return t===null?null:{regex:RegExp(t.map(POe).join("|")),deser:([i])=>t.findIndex(r=>RX(i)===RX(r))+e}}function MX(t,e){return{regex:t,deser:([,i,r])=>m5(i,r),groups:e}}function lR(t){return{regex:t,deser:([e])=>e}}function OOe(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function ROe(t,e){const i=sd(e),r=sd(e,"{2}"),n=sd(e,"{3}"),s=sd(e,"{4}"),o=sd(e,"{6}"),a=sd(e,"{1,2}"),l=sd(e,"{1,3}"),c=sd(e,"{1,6}"),u=sd(e,"{1,9}"),p=sd(e,"{2,4}"),f=sd(e,"{4,6}"),y=x=>({regex:RegExp(OOe(x.val)),deser:([S])=>S,literal:!0}),b=(x=>{if(t.literal)return y(x);switch(x.val){case"G":return od(e.eras("short",!1),0);case"GG":return od(e.eras("long",!1),0);case"y":return Hr(c);case"yy":return Hr(p,e9);case"yyyy":return Hr(s);case"yyyyy":return Hr(f);case"yyyyyy":return Hr(o);case"M":return Hr(a);case"MM":return Hr(r);case"MMM":return od(e.months("short",!0,!1),1);case"MMMM":return od(e.months("long",!0,!1),1);case"L":return Hr(a);case"LL":return Hr(r);case"LLL":return od(e.months("short",!1,!1),1);case"LLLL":return od(e.months("long",!1,!1),1);case"d":return Hr(a);case"dd":return Hr(r);case"o":return Hr(l);case"ooo":return Hr(n);case"HH":return Hr(r);case"H":return Hr(a);case"hh":return Hr(r);case"h":return Hr(a);case"mm":return Hr(r);case"m":return Hr(a);case"q":return Hr(a);case"qq":return Hr(r);case"s":return Hr(a);case"ss":return Hr(r);case"S":return Hr(l);case"SSS":return Hr(n);case"u":return lR(u);case"uu":return lR(a);case"uuu":return Hr(i);case"a":return od(e.meridiems(),0);case"kkkk":return Hr(s);case"kk":return Hr(p,e9);case"W":return Hr(a);case"WW":return Hr(r);case"E":case"c":return Hr(i);case"EEE":return od(e.weekdays("short",!1,!1),1);case"EEEE":return od(e.weekdays("long",!1,!1),1);case"ccc":return od(e.weekdays("short",!0,!1),1);case"cccc":return od(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return MX(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return MX(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return lR(/[a-z_+-/]{1,256}?/i);case" ":return lR(/[^\S\n\r]/);default:return y(x)}})(t)||{invalidReason:EOe};return b.token=t,b}const MOe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function $Oe(t,e){const{type:i,value:r}=t;if(i==="literal"){const o=/^\s+$/.test(r);return{literal:!o,val:o?" ":r}}const n=e[i];let s=MOe[i];if(typeof s=="object"&&(s=s[n]),s)return{literal:!1,val:s}}function IOe(t){return[`^${t.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,t]}function LOe(t,e,i){const r=t.match(e);if(r){const n={};let s=1;for(const o in i)if(mT(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(r.slice(s,s+l))),s+=l}return[r,n]}else return[r,{}]}function DOe(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return Tr(t.z)||(i=Mg.create(t.z)),Tr(t.Z)||(i||(i=new el(t.Z)),r=t.Z),Tr(t.q)||(t.M=(t.q-1)*3+1),Tr(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),Tr(t.u)||(t.S=XG(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),i,r]}let jF=null;function NOe(){return jF||(jF=Li.fromMillis(1555555555555)),jF}function FOe(t,e){if(t.literal)return t;const i=Ja.macroTokenToFormatOpts(t.val),r=rue(i,e);return r==null||r.includes(void 0)?t:r}function tue(t,e){return Array.prototype.concat(...t.map(i=>FOe(i,e)))}function iue(t,e,i){const r=tue(Ja.parseFormat(i),t),n=r.map(o=>ROe(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:r,invalidReason:s.invalidReason};{const[o,a]=IOe(n),l=RegExp(o,"i"),[c,u]=LOe(e,l,a),[p,f,y]=u?DOe(u):[null,null,void 0];if(mT(u,"a")&&mT(u,"H"))throw new aE("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:r,regex:l,rawMatches:c,matches:u,result:p,zone:f,specificOffset:y}}}function kOe(t,e,i){const{result:r,zone:n,specificOffset:s,invalidReason:o}=iue(t,e,i);return[r,n,s,o]}function rue(t,e){return t?Ja.create(e,t).formatDateTimeParts(NOe()).map(n=>$Oe(n,t)):null}const nue=[0,31,59,90,120,151,181,212,243,273,304,334],sue=[0,31,60,91,121,152,182,213,244,274,305,335];function Ph(t,e){return new qd("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function oue(t,e,i){const r=new Date(Date.UTC(t,e-1,i));t<100&&t>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const n=r.getUTCDay();return n===0?7:n}function aue(t,e,i){return i+(I3(t)?sue:nue)[e-1]}function lue(t,e){const i=I3(t)?sue:nue,r=i.findIndex(s=>s<e),n=e-i[r];return{month:r+1,day:n}}function t9(t){const{year:e,month:i,day:r}=t,n=aue(e,i,r),s=oue(e,i,r);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=jL(a)):o>jL(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...g5(t)}}function $X(t){const{weekYear:e,weekNumber:i,weekday:r}=t,n=oue(e,1,4),s=PA(e);let o=i*7+r-n-3,a;o<1?(a=e-1,o+=PA(a)):o>s?(a=e+1,o-=PA(e)):a=e;const{month:l,day:c}=lue(a,o);return{year:a,month:l,day:c,...g5(t)}}function HF(t){const{year:e,month:i,day:r}=t,n=aue(e,i,r);return{year:e,ordinal:n,...g5(t)}}function IX(t){const{year:e,ordinal:i}=t,{month:r,day:n}=lue(e,i);return{year:e,month:r,day:n,...g5(t)}}function UOe(t){const e=f5(t.weekYear),i=hg(t.weekNumber,1,jL(t.weekYear)),r=hg(t.weekday,1,7);return e?i?r?!1:Ph("weekday",t.weekday):Ph("week",t.week):Ph("weekYear",t.weekYear)}function zOe(t){const e=f5(t.year),i=hg(t.ordinal,1,PA(t.year));return e?i?!1:Ph("ordinal",t.ordinal):Ph("year",t.year)}function cue(t){const e=f5(t.year),i=hg(t.month,1,12),r=hg(t.day,1,GL(t.year,t.month));return e?i?r?!1:Ph("day",t.day):Ph("month",t.month):Ph("year",t.year)}function uue(t){const{hour:e,minute:i,second:r,millisecond:n}=t,s=hg(e,0,23)||e===24&&i===0&&r===0&&n===0,o=hg(i,0,59),a=hg(r,0,59),l=hg(n,0,999);return s?o?a?l?!1:Ph("millisecond",n):Ph("second",r):Ph("minute",i):Ph("hour",e)}const WF="Invalid DateTime",LX=864e13;function cR(t){return new qd("unsupported zone",`the zone "${t.name}" is not supported`)}function qF(t){return t.weekData===null&&(t.weekData=t9(t.c)),t.weekData}function tC(t,e){const i={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new Li({...i,...e,old:i})}function hue(t,e,i){let r=t-e*60*1e3;const n=i.offset(r);if(e===n)return[r,e];r-=(n-e)*60*1e3;const s=i.offset(r);return n===s?[r,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function DX(t,e){t+=e*60*1e3;const i=new Date(t);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function K$(t,e,i){return hue(JG(t),e,i)}function NX(t,e){const i=t.o,r=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:r,month:n,day:Math.min(t.c.day,GL(r,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=Ir.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=JG(s);let[l,c]=hue(a,i,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function iC(t,e,i,r,n,s){const{setZone:o,zone:a}=i;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=Li.fromObject(t,{...i,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return Li.invalid(new qd("unparsable",`the input "${n}" can't be parsed as ${r}`))}function uR(t,e,i=!0){return t.isValid?Ja.create(Hn.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(t,e):null}function ZF(t,e){const i=t.c.year>9999||t.c.year<0;let r="";return i&&t.c.year>=0&&(r+="+"),r+=lo(t.c.year,i?6:4),e?(r+="-",r+=lo(t.c.month),r+="-",r+=lo(t.c.day)):(r+=lo(t.c.month),r+=lo(t.c.day)),r}function FX(t,e,i,r,n,s){let o=lo(t.c.hour);return e?(o+=":",o+=lo(t.c.minute),(t.c.second!==0||!i)&&(o+=":")):o+=lo(t.c.minute),(t.c.second!==0||!i)&&(o+=lo(t.c.second),(t.c.millisecond!==0||!r)&&(o+=".",o+=lo(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=lo(Math.trunc(-t.o/60)),o+=":",o+=lo(Math.trunc(-t.o%60))):(o+="+",o+=lo(Math.trunc(t.o/60)),o+=":",o+=lo(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const due={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},BOe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},VOe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},pue=["year","month","day","hour","minute","second","millisecond"],GOe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],jOe=["year","ordinal","hour","minute","second","millisecond"];function kX(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new mce(t);return e}function UX(t,e){const i=x_(e.zone,oo.defaultZone),r=Hn.fromObject(e),n=oo.now();let s,o;if(Tr(t.year))s=n;else{for(const c of pue)Tr(t[c])&&(t[c]=due[c]);const a=cue(t)||uue(t);if(a)return Li.invalid(a);const l=i.offset(n);[s,o]=K$(t,l,i)}return new Li({ts:s,zone:i,loc:r,o})}function zX(t,e,i){const r=Tr(i.round)?!0:i.round,n=(o,a)=>(o=YG(o,r||i.calendary?0:2,!0),e.loc.clone(i).relFormatter(i).format(o,a)),s=o=>i.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(i.unit)return n(s(i.unit),i.unit);for(const o of i.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,i.units[i.units.length-1])}function BX(t){let e={},i;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],i=Array.from(t).slice(0,t.length-1)):i=Array.from(t),[e,i]}class Li{constructor(e){const i=e.zone||oo.defaultZone;let r=e.invalid||(Number.isNaN(e.ts)?new qd("invalid input"):null)||(i.isValid?null:cR(i));this.ts=Tr(e.ts)?oo.now():e.ts;let n=null,s=null;if(!r)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(i))[n,s]=[e.old.c,e.old.o];else{const a=i.offset(this.ts);n=DX(this.ts,a),r=Number.isNaN(n.year)?new qd("invalid input"):null,n=r?null:n,s=r?null:a}this._zone=i,this.loc=e.loc||Hn.create(),this.invalid=r,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new Li({})}static local(){const[e,i]=BX(arguments),[r,n,s,o,a,l,c]=i;return UX({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,i]=BX(arguments),[r,n,s,o,a,l,c]=i;return e.zone=el.utcInstance,UX({year:r,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,i={}){const r=m3e(e)?e.valueOf():NaN;if(Number.isNaN(r))return Li.invalid("invalid input");const n=x_(i.zone,oo.defaultZone);return n.isValid?new Li({ts:r,zone:n,loc:Hn.fromObject(i)}):Li.invalid(cR(n))}static fromMillis(e,i={}){if(z1(e))return e<-LX||e>LX?Li.invalid("Timestamp out of range"):new Li({ts:e,zone:x_(i.zone,oo.defaultZone),loc:Hn.fromObject(i)});throw new gh(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,i={}){if(z1(e))return new Li({ts:e*1e3,zone:x_(i.zone,oo.defaultZone),loc:Hn.fromObject(i)});throw new gh("fromSeconds requires a numerical input")}static fromObject(e,i={}){e=e||{};const r=x_(i.zone,oo.defaultZone);if(!r.isValid)return Li.invalid(cR(r));const n=oo.now(),s=Tr(i.specificOffset)?r.offset(n):i.specificOffset,o=HL(e,kX),a=!Tr(o.ordinal),l=!Tr(o.year),c=!Tr(o.month)||!Tr(o.day),u=l||c,p=o.weekYear||o.weekNumber,f=Hn.fromObject(i);if((u||a)&&p)throw new aE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new aE("Can't mix ordinal dates with month/day");const y=p||o.weekday&&!u;let v,b,x=DX(n,s);y?(v=GOe,b=BOe,x=t9(x)):a?(v=jOe,b=VOe,x=HF(x)):(v=pue,b=due);let S=!1;for(const B of v){const W=o[B];Tr(W)?S?o[B]=b[B]:o[B]=x[B]:S=!0}const P=y?UOe(o):a?zOe(o):cue(o),C=P||uue(o);if(C)return Li.invalid(C);const R=y?$X(o):a?IX(o):o,[N,$]=K$(R,s,r),k=new Li({ts:N,zone:r,o:$,loc:f});return o.weekday&&u&&e.weekday!==k.weekday?Li.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${k.toISO()}`):k}static fromISO(e,i={}){const[r,n]=nOe(e);return iC(r,n,i,"ISO 8601",e)}static fromRFC2822(e,i={}){const[r,n]=sOe(e);return iC(r,n,i,"RFC 2822",e)}static fromHTTP(e,i={}){const[r,n]=oOe(e);return iC(r,n,i,"HTTP",i)}static fromFormat(e,i,r={}){if(Tr(e)||Tr(i))throw new gh("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=r,o=Hn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,u]=kOe(o,e,i);return u?Li.invalid(u):iC(a,l,r,`format ${i}`,e,c)}static fromString(e,i,r={}){return Li.fromFormat(e,i,r)}static fromSQL(e,i={}){const[r,n]=pOe(e);return iC(r,n,i,"SQL",e)}static invalid(e,i=null){if(!e)throw new gh("need to specify a reason the DateTime is invalid");const r=e instanceof qd?e:new qd(e,i);if(oo.throwOnInvalid)throw new WPe(r);return new Li({invalid:r})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,i={}){const r=rue(e,Hn.fromObject(i));return r?r.map(n=>n?n.val:null).join(""):null}static expandFormat(e,i={}){return tue(Ja.parseFormat(e),Hn.fromObject(i)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?qF(this).weekYear:NaN}get weekNumber(){return this.isValid?qF(this).weekNumber:NaN}get weekday(){return this.isValid?qF(this).weekday:NaN}get ordinal(){return this.isValid?HF(this.c).ordinal:NaN}get monthShort(){return this.isValid?aR.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?aR.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?aR.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?aR.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return I3(this.year)}get daysInMonth(){return GL(this.year,this.month)}get daysInYear(){return this.isValid?PA(this.year):NaN}get weeksInWeekYear(){return this.isValid?jL(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:i,numberingSystem:r,calendar:n}=Ja.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:n}}toUTC(e=0,i={}){return this.setZone(el.instance(e),i)}toLocal(){return this.setZone(oo.defaultZone)}setZone(e,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(e=x_(e,oo.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(i||r){const s=e.offset(this.ts),o=this.toObject();[n]=K$(o,s,e)}return tC(this,{ts:n,zone:e})}else return Li.invalid(cR(e))}reconfigure({locale:e,numberingSystem:i,outputCalendar:r}={}){const n=this.loc.clone({locale:e,numberingSystem:i,outputCalendar:r});return tC(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const i=HL(e,kX),r=!Tr(i.weekYear)||!Tr(i.weekNumber)||!Tr(i.weekday),n=!Tr(i.ordinal),s=!Tr(i.year),o=!Tr(i.month)||!Tr(i.day),a=s||o,l=i.weekYear||i.weekNumber;if((a||n)&&l)throw new aE("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new aE("Can't mix ordinal dates with month/day");let c;r?c=$X({...t9(this.c),...i}):Tr(i.ordinal)?(c={...this.toObject(),...i},Tr(i.day)&&(c.day=Math.min(GL(c.year,c.month),c.day))):c=IX({...HF(this.c),...i});const[u,p]=K$(c,this.o,this.zone);return tC(this,{ts:u,o:p})}plus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e);return tC(this,NX(this,i))}minus(e){if(!this.isValid)return this;const i=Ir.fromDurationLike(e).negate();return tC(this,NX(this,i))}startOf(e){if(!this.isValid)return this;const i={},r=Ir.normalizeUnit(e);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const n=Math.ceil(this.month/3);i.month=(n-1)*3+1}return this.set(i)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,i={}){return this.isValid?Ja.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,e):WF}toLocaleString(e=VL,i={}){return this.isValid?Ja.create(this.loc.clone(i),e).formatDateTime(this):WF}toLocaleParts(e={}){return this.isValid?Ja.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=ZF(this,o);return a+="T",a+=FX(this,o,i,r,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?ZF(this,e==="extended"):null}toISOWeekDate(){return uR(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+FX(this,o==="extended",i,e,r,s):null}toRFC2822(){return uR(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return uR(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ZF(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let n="HH:mm:ss.SSS";return(i||e)&&(r&&(n+=" "),i?n+="z":e&&(n+="ZZ")),uR(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():WF}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const i={...this.c};return e.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,i="milliseconds",r={}){if(!this.isValid||!e.isValid)return Ir.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...r},s=g3e(i).map(Ir.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=TOe(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",i={}){return this.diff(Li.now(),e,i)}until(e){return this.isValid?bs.fromDateTimes(this,e):this}hasSame(e,i){if(!this.isValid)return!1;const r=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(i)<=r&&r<=n.endOf(i)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const i=e.base||Li.fromObject({},{zone:this.zone}),r=e.padding?this<i?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),zX(i,this.plus(r),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?zX(e.base||Li.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(Li.isDateTime))throw new gh("min requires all arguments be DateTimes");return CX(e,i=>i.valueOf(),Math.min)}static max(...e){if(!e.every(Li.isDateTime))throw new gh("max requires all arguments be DateTimes");return CX(e,i=>i.valueOf(),Math.max)}static fromFormatExplain(e,i,r={}){const{locale:n=null,numberingSystem:s=null}=r,o=Hn.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return iue(o,e,i)}static fromStringExplain(e,i,r={}){return Li.fromFormatExplain(e,i,r)}static get DATE_SHORT(){return VL}static get DATE_MED(){return gce}static get DATE_MED_WITH_WEEKDAY(){return XPe}static get DATE_FULL(){return _ce}static get DATE_HUGE(){return yce}static get TIME_SIMPLE(){return vce}static get TIME_WITH_SECONDS(){return bce}static get TIME_WITH_SHORT_OFFSET(){return wce}static get TIME_WITH_LONG_OFFSET(){return xce}static get TIME_24_SIMPLE(){return Tce}static get TIME_24_WITH_SECONDS(){return Sce}static get TIME_24_WITH_SHORT_OFFSET(){return Cce}static get TIME_24_WITH_LONG_OFFSET(){return Ece}static get DATETIME_SHORT(){return Ace}static get DATETIME_SHORT_WITH_SECONDS(){return Pce}static get DATETIME_MED(){return Oce}static get DATETIME_MED_WITH_SECONDS(){return Rce}static get DATETIME_MED_WITH_WEEKDAY(){return YPe}static get DATETIME_FULL(){return Mce}static get DATETIME_FULL_WITH_SECONDS(){return $ce}static get DATETIME_HUGE(){return Ice}static get DATETIME_HUGE_WITH_SECONDS(){return Lce}}function rC(t){if(Li.isDateTime(t))return t;if(t&&t.valueOf&&z1(t.valueOf()))return Li.fromJSDate(t);if(t&&typeof t=="object")return Li.fromObject(t);throw new gh(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const HOe={year:void 0,month:void 0,day:void 0,weekday:void 0},WOe={hour:void 0,minute:void 0,second:void 0},qOe={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},ij={timeZone:"Etc/UTC"},Pp={year:"numeric",month:"numeric",day:"numeric"},nC={year:"numeric",month:"long",day:"numeric"},sC={year:"numeric",month:"short",day:"numeric"},oC={year:"numeric",month:"long",weekday:"long",day:"numeric"},Ju={hour:"numeric",minute:"numeric"},ad={...Ju,second:"numeric"},lS={"short-date":Pp,"short-date-short-time":{...Pp,...Ju},"short-date-short-time-24":{...Pp,...Ju,hour12:!1},"short-date-long-time":{...Pp,...ad},"short-date-long-time-24":{...Pp,...ad,hour12:!1},"short-date-le":Pp,"short-date-le-short-time":{...Pp,...Ju},"short-date-le-short-time-24":{...Pp,...Ju,hour12:!1},"short-date-le-long-time":{...Pp,...ad},"short-date-le-long-time-24":{...Pp,...ad,hour12:!1},"long-month-day-year":nC,"long-month-day-year-short-time":{...nC,...Ju},"long-month-day-year-short-time-24":{...nC,...Ju,hour12:!1},"long-month-day-year-long-time":{...nC,...ad},"long-month-day-year-long-time-24":{...nC,...ad,hour12:!1},"day-short-month-year":sC,"day-short-month-year-short-time":{...sC,...Ju},"day-short-month-year-short-time-24":{...sC,...Ju,hour12:!1},"day-short-month-year-long-time":{...sC,...ad},"day-short-month-year-long-time-24":{...sC,...ad,hour12:!1},"long-date":oC,"long-date-short-time":{...oC,...Ju},"long-date-short-time-24":{...oC,...Ju,hour12:!1},"long-date-long-time":{...oC,...ad},"long-date-long-time-24":{...oC,...ad,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Ju,"long-time":ad},ZOe=Ou()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),fue={ar:"ar-u-nu-latn-ca-gregory"};let i9=new WeakMap,mue=lS["short-date-short-time"];function XOe(t){const e=t||mue;let i=i9.get(e);if(!i){const r=ip(),n=fue[r]||r;i=new Intl.DateTimeFormat(n,e),i9.set(e,i)}return i}function cE(t){return lS[t]}function ay(t,e){return XOe(e).format(t)}function YOe(t,e=lS["short-date"]){return ay(new Date(t),{...e,...ij,...WOe})}function JOe(t,e=lS["short-time"]){return ay(new Date(`1970-01-01T${t}Z`),{...e,...ij,...HOe})}function KOe(t,e=lS["short-date-short-time"]){const i=Li.fromISO(t,{setZone:!0}),r=ip(),n=fue[r]??r;return i.toLocaleString({...qOe,...e},{locale:n})}ZG(()=>{i9=new WeakMap,mue=lS["short-date-short-time"]});const QOe={ar:"ar-u-nu-latn"};let Q$=new WeakMap,gue={};function eRe(t){const e=t||gue;if(!Q$.has(e)){const i=ip(),r=QOe[ip()]||i;Q$.set(e,new Intl.NumberFormat(r,t))}return Q$.get(e)}function tRe(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function gT(t,e){return Object.is(t,-0)&&(t=0),eRe(e).format(t)}ZG(()=>{Q$=new WeakMap,gue={}});let Lx=class extends em(Nt){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return gT(e,tRe(this))}formatDate(e,i=!1){return this.dateFormat?ay(e,{...cE(this.dateFormat),...i&&ij}):this.formatNumber(e)}formatDateOnly(e){const i=(this.dateFormat&&cE(this.dateFormat))??void 0;return YOe(e,i)}formatTimeOnly(e){const i=(this.dateFormat&&cE(this.dateFormat))??void 0;return JOe(e,i)}formatTimestamp(e){const i=(this.dateFormat&&cE(this.dateFormat))??void 0;return KOe(e,i)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,i,r){return e&&i&&r?e.trim().split(i).map(n=>this.formatNumber(Number(n))).join(r):e}};d([Si(ZOe)],Lx.prototype,"dateFormat",void 0),d([m({type:Boolean,json:{write:!0}})],Lx.prototype,"digitSeparator",void 0),d([m({type:js,json:{write:!0}})],Lx.prototype,"places",void 0),Lx=d([J("esri.popup.support.FieldInfoFormat")],Lx);const iRe=Lx;var r9;let yd=r9=class extends Nt{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new r9({fieldName:this.fieldName,format:this.format?Le(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([m({type:String,json:{write:!0}})],yd.prototype,"fieldName",void 0),d([m({type:iRe,json:{write:!0}})],yd.prototype,"format",void 0),d([m({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],yd.prototype,"isEditable",void 0),d([m({type:String,json:{write:!0}})],yd.prototype,"label",void 0),d([Si(new Tu({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],yd.prototype,"stringFieldOption",void 0),d([m({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],yd.prototype,"statisticType",void 0),d([m({type:String,json:{write:!0}})],yd.prototype,"tooltip",void 0),d([m({type:Boolean,json:{write:!0}})],yd.prototype,"visible",void 0),yd=r9=d([J("esri.popup.FieldInfo")],yd);const _ue=yd;var n9;let Fm=n9=class extends Oy{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(i=>i.toJSON())}clone(){return new n9(Le({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([m({type:Object,json:{write:!0}})],Fm.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],Fm.prototype,"description",void 0),d([m({type:[_ue]})],Fm.prototype,"fieldInfos",void 0),d([Pr("fieldInfos")],Fm.prototype,"writeFieldInfos",null),d([m({type:String,json:{write:!0}})],Fm.prototype,"title",void 0),d([m({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Fm.prototype,"type",void 0),Fm=n9=d([J("esri.popup.content.FieldsContent")],Fm);const WL=Fm;let Mv=class extends Nt{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([m({type:String,json:{write:!0}})],Mv.prototype,"altText",void 0),d([m({type:String,json:{write:!0}})],Mv.prototype,"caption",void 0),d([m({type:String,json:{write:!0}})],Mv.prototype,"title",void 0),d([m({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Mv.prototype,"type",void 0),Mv=d([J("esri.popup.content.mixins.MediaInfo")],Mv);const rj=Mv;var s9;let Dx=s9=class extends ke{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new s9({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([m()],Dx.prototype,"fieldName",void 0),d([m()],Dx.prototype,"tooltip",void 0),d([m()],Dx.prototype,"value",void 0),Dx=s9=d([J("esri.popup.content.support.ChartMediaInfoValueSeries")],Dx);const rRe=Dx;var o9;let $v=o9=class extends Nt{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new o9({fields:Le(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};d([m({type:[String],json:{write:!0}})],$v.prototype,"fields",void 0),d([m({type:String,json:{write:!0}})],$v.prototype,"normalizeField",void 0),d([m({type:[rRe],json:{read:!1}})],$v.prototype,"series",void 0),d([m({type:String,json:{write:!0}})],$v.prototype,"tooltipField",void 0),$v=o9=d([J("esri.popup.content.support.ChartMediaInfoValue")],$v);const nRe=$v;let uE=class extends rj{constructor(e){super(e),this.type=null,this.value=null}};d([m({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],uE.prototype,"type",void 0),d([m({type:nRe,json:{write:!0}})],uE.prototype,"value",void 0),uE=d([J("esri.popup.content.mixins.ChartMediaInfo")],uE);const _5=uE,y5=Ou()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var a9;let eI=a9=class extends _5{constructor(t){super(t),this.type="bar-chart"}clone(){return new a9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:y5.write}})],eI.prototype,"type",void 0),eI=a9=d([J("esri.popup.content.BarChartMediaInfo")],eI);const yue=eI;var l9;let tI=l9=class extends _5{constructor(t){super(t),this.type="column-chart"}clone(){return new l9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:y5.write}})],tI.prototype,"type",void 0),tI=l9=d([J("esri.popup.content.ColumnChartMediaInfo")],tI);const vue=tI;var c9;let hE=c9=class extends Nt{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new c9({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([m({type:String,json:{write:!0}})],hE.prototype,"linkURL",void 0),d([m({type:String,json:{write:!0}})],hE.prototype,"sourceURL",void 0),hE=c9=d([J("esri.popup.content.support.ImageMediaInfoValue")],hE);const sRe=hE;var u9;let Nx=u9=class extends rj{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new u9({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};d([m({type:Number,json:{write:!0}})],Nx.prototype,"refreshInterval",void 0),d([m({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],Nx.prototype,"type",void 0),d([m({type:sRe,json:{write:!0}})],Nx.prototype,"value",void 0),Nx=u9=d([J("esri.popup.content.ImageMediaInfo")],Nx);const bue=Nx;var h9;let iI=h9=class extends _5{constructor(t){super(t),this.type="line-chart"}clone(){return new h9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:y5.write}})],iI.prototype,"type",void 0),iI=h9=d([J("esri.popup.content.LineChartMediaInfo")],iI);const wue=iI;var d9;let rI=d9=class extends _5{constructor(t){super(t),this.type="pie-chart"}clone(){return new d9({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([m({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:y5.write}})],rI.prototype,"type",void 0),rI=d9=d([J("esri.popup.content.PieChartMediaInfo")],rI);const xue=rI,Tue={base:rj,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":yue,"column-chart":vue,"line-chart":wue,"pie-chart":xue,image:bue}};var p9;let vd=p9=class extends Oy{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?bue.fromJSON(e):e.type==="barchart"?yue.fromJSON(e):e.type==="columnchart"?vue.fromJSON(e):e.type==="linechart"?wue.fromJSON(e):e.type==="piechart"?xue.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(i=>i.toJSON())}clone(){return new p9(Le({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([m()],vd.prototype,"activeMediaInfoIndex",void 0),d([m({type:Object,json:{write:!0}})],vd.prototype,"attributes",void 0),d([m({type:String,json:{write:!0}})],vd.prototype,"description",void 0),d([m({types:[Tue]})],vd.prototype,"mediaInfos",void 0),d([yr("mediaInfos")],vd.prototype,"readMediaInfos",null),d([Pr("mediaInfos")],vd.prototype,"writeMediaInfos",null),d([m({type:String,json:{write:!0}})],vd.prototype,"title",void 0),d([m({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],vd.prototype,"type",void 0),vd=p9=d([J("esri.popup.content.MediaContent")],vd);const qL=vd;var f9;let dE=f9=class extends Nt{constructor(t){super(t),this.field=null,this.order=null}clone(){return new f9({field:this.field,order:this.order})}};d([m({type:String,json:{write:!0}})],dE.prototype,"field",void 0),d([m({type:["asc","desc"],json:{write:!0}})],dE.prototype,"order",void 0),dE=f9=d([J("esri.popup.support.RelatedRecordsInfoFieldOrder")],dE);const Sue=dE;let Yp=class extends em(Oy){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([m({type:String,json:{write:!0}})],Yp.prototype,"description",void 0),d([m({type:Number,json:{type:js,write:!0}})],Yp.prototype,"displayCount",void 0),d([m({type:["list"],json:{write:!0}})],Yp.prototype,"displayType",void 0),d([m({type:[Sue],json:{write:!0}})],Yp.prototype,"orderByFields",void 0),d([m({type:Number,json:{type:js,write:!0}})],Yp.prototype,"relationshipId",void 0),d([m({type:String,json:{write:!0}})],Yp.prototype,"title",void 0),d([m({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Yp.prototype,"type",void 0),Yp=d([J("esri.popup.content.RelationshipContent")],Yp);const ZL=Yp;var m9;let pE=m9=class extends Oy{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new m9({text:this.text})}};d([m({type:String,json:{write:!0}})],pE.prototype,"text",void 0),d([m({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],pE.prototype,"type",void 0),pE=m9=d([J("esri.popup.content.TextContent")],pE);const XL=pE,oRe={base:null,key:"type",typeMap:{attachment:BL,media:qL,text:XL,expression:qG,field:WL,relationship:ZL}};var g9;let Iv=g9=class extends Nt{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new g9({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([m({type:String,json:{write:!0}})],Iv.prototype,"name",void 0),d([m({type:String,json:{write:!0}})],Iv.prototype,"title",void 0),d([m({type:String,json:{write:!0}})],Iv.prototype,"expression",void 0),d([m({type:["string","number"],json:{write:!0}})],Iv.prototype,"returnType",void 0),Iv=g9=d([J("esri.popup.ExpressionInfo")],Iv);const aRe=Iv;var _9;let fE=_9=class extends Nt{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new _9({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([m({type:Boolean,json:{write:!0}})],fE.prototype,"returnTopmostRaster",void 0),d([m({type:Boolean,json:{write:!0}})],fE.prototype,"showNoDataRecords",void 0),fE=_9=d([J("esri.popup.LayerOptions")],fE);const lRe=fE;var y9;let mE=y9=class extends Nt{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new y9({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?Le(this.orderByFields):null})}};d([m({type:Boolean,json:{write:!0}})],mE.prototype,"showRelatedRecords",void 0),d([m({type:[Sue],json:{write:!0}})],mE.prototype,"orderByFields",void 0),mE=y9=d([J("esri.popup.RelatedRecordsInfo")],mE);const cRe=mE;let Cue=0;const nj=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+Cue++})}};return e=d([J("esri.core.Identifiable")],e),e},xgt=t=>{let e=class extends t{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Cue++})}};return e=d([J("esri.core.NumericIdentifiable")],e),e};let VX=class extends nj(class{}){};VX=d([J("esri.core.Identifiable")],VX);var v9;let Ku=v9=class extends nj(ke){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new v9({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([m()],Ku.prototype,"active",void 0),d([m()],Ku.prototype,"className",void 0),d([m()],Ku.prototype,"disabled",void 0),d([m()],Ku.prototype,"icon",void 0),d([m()],Ku.prototype,"id",void 0),d([m()],Ku.prototype,"indicator",void 0),d([m()],Ku.prototype,"title",void 0),d([m()],Ku.prototype,"type",void 0),d([m()],Ku.prototype,"visible",void 0),Ku=v9=d([J("esri.support.actions.ActionBase")],Ku);const sj=Ku;var b9;let nI=b9=class extends sj{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new b9({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([m()],nI.prototype,"image",void 0),nI=b9=d([J("esri.support.Action.ActionButton")],nI);const uRe=nI;var w9;let gE=w9=class extends sj{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new w9({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([m()],gE.prototype,"image",void 0),d([m()],gE.prototype,"value",void 0),gE=w9=d([J("esri.support.Action.ActionToggle")],gE);const hRe=gE,dRe="esri.PopupTemplate",pRe=ye.getLogger(dRe),aC="relationships/",GX="expression/",fRe=Ci.ofType({key:"type",defaultKeyValue:"button",base:sj,typeMap:{button:uRe,toggle:hRe}}),mRe={base:Oy,key:"type",typeMap:{media:qL,custom:VPe,text:XL,attachments:BL,fields:WL,expression:qG,relationship:ZL}},gRe=["attachments","fields","media","text","expression","relationship"];let To=class extends em(Nt){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(i=>ry(mRe,i)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Pu(e)?e:(pRe.error("content error","unsupported content value",{value:e}),null)}readContent(e,i){const{popupElements:r}=i;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(i.description,i.mediaInfos,r):this._readPopupInfo(i)}writeContent(e,i,r,n){typeof e!="string"?Array.isArray(e)&&(i.popupElements=e.filter(s=>gRe.includes(s.type)).map(s=>s&&s.toJSON(n)),i.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(i):s.type==="media"?this._writeMediaContent(s,i):s.type==="text"?this._writeTextContent(s,i):s.type==="relationship"&&this._writeRelationshipContent(s,i)})):i.description=e}writeFieldInfos(e,i,r,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});i.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(n);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,i)}writeLayerOptions(e,i,r,n){i[r]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,i){i.title=e||""}async collectRequiredFields(e,i){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,i,[...r,...this._getContentExpressionInfos(this.content,r)]),EP(e,i,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const i=new Set;return await this.collectRequiredFields(i,e),[...i].sort()}_writeFieldsContent(e,i){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=Le(e.fieldInfos);Array.isArray(i.fieldInfos)?r.forEach(n=>{const s=i.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:i.fieldInfos.push(n)}):i.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,i){var s,o;const r=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=i.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...r];i.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,i){!i.description&&e.text&&(i.description=e.text)}_writeMediaContent(e,i){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=Le(e.mediaInfos);Array.isArray(i.mediaInfos)?i.mediaInfos=[...i.mediaInfos,...r]:i.mediaInfos=r}_readPopupInfoElements(e,i,r){const n={description:!1,mediaInfos:!1};return r.map(s=>s.type==="media"?(s.mediaInfos||!i||n.mediaInfos||(s.mediaInfos=i,n.mediaInfos=!0),qL.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),XL.fromJSON(s)):s.type==="attachments"?BL.fromJSON(s):s.type==="fields"?WL.fromJSON(s):s.type==="expression"?qG.fromJSON(s):s.type==="relationship"?ZL.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:i,order:r}=e;if(!(i!=null&&i.startsWith(aC)))return null;const n=i.replace(aC,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?ZL.fromJSON({relationshipId:s,orderByFields:[{field:o,order:r}]}):null}_toFieldOrderJSON(e,i){const{order:r,field:n}=e;return{field:`${aC}${i}/${n}`,order:r}}_readPopupInfo({description:e,mediaInfos:i,showAttachments:r,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new XL({text:e})):s.push(new WL),Array.isArray(i)&&i.length&&s.push(qL.fromJSON({mediaInfos:i})),r&&s.push(BL.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const i=e==null?void 0:e.type;if(i==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(i==="custom")return e.outFields||[];if(i==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(i==="media"){const r=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...r.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return i==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:i,title:r,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=s,p=[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&p.push(a),l&&p.push(l),p}_getContentExpressionInfos(e,i){return Array.isArray(e)?e.reduce((r,n)=>[...r,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],i):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((i,r)=>[...i,...this._getContentElementFields(r)],[]):[]}async _collectExpressionInfoFields(e,i,r){r&&await Promise.all(r.map(n=>cb(e,i,n.expression)))}_getFieldInfoFields(e){return e?e.filter(i=>i.visible===void 0||!!i.visible).map(i=>i.fieldName).filter(i=>!i.startsWith(aC)&&!i.startsWith(GX)):[]}_getActionsFields(e){return e?e.toArray().reduce((i,r)=>[...i,...this._getActionFields(r)],[]):[]}_getActionFields(e){const{className:i,title:r,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(i),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const i=/{[^}]*}/g,r=e.match(i);if(!r)return[];const n=/\{(\w+):.+\}/,s=r.filter(o=>!(o.indexOf(`{${aC}`)===0||o.indexOf(`{${GX}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};d([m({type:fRe})],To.prototype,"actions",void 0),d([m()],To.prototype,"content",void 0),d([Sn("content")],To.prototype,"castContent",null),d([yr("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],To.prototype,"readContent",null),d([Pr("content",{popupElements:{type:Ci.ofType(oRe)},showAttachments:{type:Boolean},mediaInfos:{type:Ci.ofType(Tue)},description:{type:String},relatedRecordsInfo:{type:cRe}})],To.prototype,"writeContent",null),d([m({type:[aRe],json:{write:!0}})],To.prototype,"expressionInfos",void 0),d([m({type:[_ue]})],To.prototype,"fieldInfos",void 0),d([Pr("fieldInfos")],To.prototype,"writeFieldInfos",null),d([m({type:lRe})],To.prototype,"layerOptions",void 0),d([Pr("layerOptions")],To.prototype,"writeLayerOptions",null),d([m({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],To.prototype,"lastEditInfoEnabled",void 0),d([m()],To.prototype,"outFields",void 0),d([m()],To.prototype,"overwriteActions",void 0),d([m()],To.prototype,"returnGeometry",void 0),d([m({json:{type:String}})],To.prototype,"title",void 0),d([Pr("title")],To.prototype,"writeTitle",null),To=d([J("esri.PopupTemplate")],To);const _Re=To,YL={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Eue(t){return!!YL[t]||!!YL[t.toLowerCase()]}function oj(t){return YL[t]??YL[t.toLowerCase()]}function yRe(t){return[...oj(t)]}function XF(t,e,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?t+(e-t)*r:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function Aue(t,e,i,r=1){const n=(t%360+360)%360/360,s=i<=.5?i*(e+1):i+e-i*e,o=2*i-s;return[Math.round(255*XF(o,s,n+1/3)),Math.round(255*XF(o,s,n)),Math.round(255*XF(o,s,n-1/3)),r]}function vRe(t){const e=t.length>5,i=e?8:4,r=(1<<i)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&r,o>>=i,a[3]=n*l/255),l=o&r,o>>=i,a[2]=n*l,l=o&r,o>>=i,a[1]=n*l,l=o&r,o>>=i,a[0]=n*l,a}function hR(t){return $e(lG(t),0,255)}function dR(t,e,i){return t=Number(t),isNaN(t)?i:t<e?e:t>i?i:t}let sI=class ha{static blendColors(e,i,r,n=new ha){return n.r=Math.round(e.r+(i.r-e.r)*r),n.g=Math.round(e.g+(i.g-e.g)*r),n.b=Math.round(e.b+(i.b-e.b)*r),n.a=e.a+(i.a-e.a)*r,n._sanitize()}static fromRgb(e,i){const r=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const n=r[2].split(/\s*,\s*/),s=r[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),ha.fromArray(a,i)}return ha.fromArray(n.map(a=>parseFloat(a)),i)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return ha.fromArray(Aue(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),i)}return null}static fromHex(e,i=new ha){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const r=e.length===4?4:8,n=(1<<r)-1;let s=+("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach(o=>{const a=s&n;s>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(e,i=new ha){return i._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(e,i){const r=Eue(e)?oj(e):null;return r&&ha.fromArray(r,i)||ha.fromRgb(e,i)||ha.fromHex(e,i)}static fromJSON(e){return e&&new ha([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?ha.fromString(e,this):Array.isArray(e)?ha.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof ha||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${e.length<2?"0"+e:e}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(e=!1){const i=this.r+", "+this.g+", "+this.b;return e?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=ha.AlphaMode.ALWAYS){const i=hR(this.r),r=hR(this.g),n=hR(this.b);return e===ha.AlphaMode.ALWAYS||this.a!==1?[i,r,n,hR(255*this.a)]:[i,r,n]}clone(){return new ha(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(dR(this.r,0,255)),this.g=Math.round(dR(this.g,0,255)),this.b=Math.round(dR(this.b,0,255)),this.a=dR(this.a,0,1),this}_set(e,i,r,n){this.r=e,this.g=i,this.b=r,this.a=n}};sI.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(sI||(sI={}));const Lt=sI,jX=new Tu({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let bRe=0,Fx=class extends Nt{constructor(e){super(e),this.id="sym"+bRe++,this.type=null,this.color=new Lt([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,i){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([m({type:jX.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:jX.write}}})],Fx.prototype,"type",void 0),d([m({type:Lt,json:{write:{allowNull:!0}}})],Fx.prototype,"color",void 0),d([yr("color")],Fx.prototype,"readColor",null),Fx=d([J("esri.symbols.Symbol")],Fx);const Ru=Fx;var x9;let H0=x9=class extends Ru{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var i;if(((i=this.data)==null?void 0:i.type)==="CIMSymbolReference"){const r=this.data.primitiveOverrides;if(r){const n=r.map(s=>{const o=s.valueExpressionInfo;return cb(t,e,o.expression)});await Promise.all(n)}}}clone(){return new x9({data:Le(this.data)})}hash(){return oae(JSON.stringify(this.data)).toString()}};d([m({json:{write:!1}})],H0.prototype,"color",void 0),d([m({json:{write:!0}})],H0.prototype,"data",void 0),d([yr("data",["symbol"])],H0.prototype,"readData",null),d([Pr("data",{})],H0.prototype,"writeData",null),d([Si({CIMSymbolReference:"cim"},{readOnly:!0})],H0.prototype,"type",void 0),H0=x9=d([J("esri.symbols.CIMSymbol")],H0);const N3=H0;let kx=class extends Nt{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,i,r){e||(i[r]=e)}};d([m({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],kx.prototype,"enabled",void 0),d([Pr("enabled")],kx.prototype,"writeEnabled",null),d([m({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],kx.prototype,"type",void 0),kx=d([J("esri.symbols.Symbol3DLayer")],kx);const rm=kx,wRe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,xRe="screenUtils.toPt: input not recognized!",Pue=96;function Sa(t){return t?t/72*Pue:0}function dp(t){return t?72*t/Pue:0}function ns(t){if(typeof t=="string"){const e=t.match(wRe);if(e){const i=Number(e[1]),r=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=r==="px"?dp(i):i;return n?-s:s}return console.warn(xRe),null}return t}function Uh(t=0,e=0){return{x:t,y:e}}function fn(t=0,e=0){return[t,e]}function Oue(t=0,e=0){return[t,e]}function ta(t=0,e=0,i=0){return[t,e,i]}function Agt(t){return t}function Pgt(t){return t}function Ogt(t){return t}function bf(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function Rue(t){const e=lG(100*(1-t));return Math.max(0,Math.min(e,100))}function Mue(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}function TRe(t,e){const i=e.transparency!=null?Mue(e.transparency):1,r=e.color;return r&&Array.isArray(r)?new Lt([r[0]||0,r[1]||0,r[2]||0,i]):null}function SRe(t,e){e.color=t.toJSON().slice(0,3);const i=Rue(t.a);i!==0&&(e.transparency=i)}const Bg={type:Lt,json:{type:[js],default:null,read:{source:["color","transparency"],reader:TRe},write:{target:{color:{type:[js]},transparency:{type:js}},writer:SRe}}},jf={type:Number,cast:ns,json:{write:!0}};let Lv=class extends Nt{constructor(e){super(e),this.color=new Lt([0,0,0,1]),this.extensionLength=0,this.size=dp(1)}clone(){}cloneProperties(){return{color:Le(this.color),size:this.size,extensionLength:this.extensionLength}}};d([m({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Lv.prototype,"type",void 0),d([m(Bg)],Lv.prototype,"color",void 0),d([m({...jf,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],Lv.prototype,"extensionLength",void 0),d([m(jf)],Lv.prototype,"size",void 0),Lv=d([J("esri.symbols.edges.Edges3D")],Lv);const aj=Lv;var T9;let oI=T9=class extends aj{constructor(t){super(t),this.type="sketch"}clone(){return new T9(this.cloneProperties())}};d([Si({sketch:"sketch"},{readOnly:!0})],oI.prototype,"type",void 0),oI=T9=d([J("esri.symbols.edges.SketchEdges3D")],oI);const CRe=oI;var S9;let aI=S9=class extends aj{constructor(t){super(t),this.type="solid"}clone(){return new S9(this.cloneProperties())}};d([Si({solid:"solid"},{readOnly:!0})],aI.prototype,"type",void 0),aI=S9=d([J("esri.symbols.support.SolidEdges3D")],aI);const ERe=aI,$ue={types:{key:"type",base:aj,typeMap:{solid:ERe,sketch:CRe}},json:{write:!0}};var C9;let mu=C9=class extends Nt{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new C9(t)}};d([m(Bg)],mu.prototype,"color",void 0),mu=C9=d([J("esri.symbols.support.Symbol3DMaterial")],mu);var E9;let W0=E9=class extends rm{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new E9({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};d([Si({Extrude:"extrude"},{readOnly:!0})],W0.prototype,"type",void 0),d([m({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],W0.prototype,"size",void 0),d([m({type:mu,json:{write:!0}})],W0.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],W0.prototype,"castShadows",void 0),d([m($ue)],W0.prototype,"edges",void 0),W0=E9=d([J("esri.symbols.ExtrudeSymbol3DLayer")],W0);const Iue=W0;let _E=class extends Ru{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([Si({esriSLS:"simple-line"},{readOnly:!0})],_E.prototype,"type",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],_E.prototype,"width",void 0),_E=d([J("esri.symbols.LineSymbol")],_E);const ARe=_E,PRe=["begin","end","begin-end"],Lue=["arrow","circle","square","diamond","cross","x"];var A9;let Jp=A9=class extends Nt{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,i,r){e[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,i,r){(r==null?void 0:r.origin)==="web-map"||(e[i]=t)}clone(){return new A9({color:Le(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};d([m({type:["begin","end","begin-end"],json:{write:!0}})],Jp.prototype,"placement",void 0),d([Si({"line-marker":"line-marker"},{readOnly:!0}),m({json:{origins:{"web-map":{write:!1}}}})],Jp.prototype,"type",void 0),d([m({type:Lue})],Jp.prototype,"style",void 0),d([Pr("style")],Jp.prototype,"writeStyle",null),d([m({type:Lt,value:null,json:{write:{allowNull:!0}}})],Jp.prototype,"color",null),d([yr("color")],Jp.prototype,"readColor",null),d([Pr("color")],Jp.prototype,"writeColor",null),Jp=A9=d([J("esri.symbols.LineSymbolMarker")],Jp);const ORe=Jp;var P9;const YF=new Tu({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let km=P9=class extends ARe{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,i,r,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),i!=null&&(o.width=ns(i)),r!=null&&(o.cap=r),n!=null&&(o.join=n),s!=null&&(o.miterLimit=ns(s)),o}clone(){var t;return new P9({color:Le(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};d([Si({esriSLS:"simple-line"},{readOnly:!0})],km.prototype,"type",void 0),d([m({type:YF.apiValues,json:{read:YF.read,write:YF.write}})],km.prototype,"style",void 0),d([m({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],km.prototype,"cap",void 0),d([m({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,i)=>({enabled:t!=="round"&&(i==null||i.origin==null)})}}})],km.prototype,"join",void 0),d([m({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":ORe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],km.prototype,"marker",void 0),d([m({type:Number,json:{read:!1,write:!1}})],km.prototype,"miterLimit",void 0),km=P9=d([J("esri.symbols.SimpleLineSymbol")],km);const Vb=km;let yE=class extends Ru{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Vb}},json:{default:null,write:!0}})],yE.prototype,"outline",void 0),d([m({type:["simple-fill","picture-fill"],readOnly:!0})],yE.prototype,"type",void 0),yE=d([J("esri.symbols.FillSymbol")],yE);const Due=yE;let lI=class extends Nt{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],lI.prototype,"type",void 0),lI=d([J("esri.symbols.patterns.LinePattern3D")],lI);const Nue=lI,RRe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var O9;const MRe=Ou()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let vE=O9=class extends Nue{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new O9(t)}};d([m({type:["style"]})],vE.prototype,"type",void 0),d([Si(MRe),m({type:RRe})],vE.prototype,"style",void 0),vE=O9=d([J("esri.symbols.patterns.LineStylePattern3D")],vE);const lj=vE;let cI=class extends Nt{constructor(e){super(e)}clone(){}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],cI.prototype,"type",void 0),cI=d([J("esri.symbols.patterns.Pattern3D")],cI);const Fue=cI,$Re=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var R9;let bE=R9=class extends Fue{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new R9(t)}};d([m({type:["style"]})],bE.prototype,"type",void 0),d([m({type:$Re,json:{read:!0,write:!0}})],bE.prototype,"style",void 0),bE=R9=d([J("esri.symbols.patterns.StylePattern3D")],bE);const kue=bE,IRe={types:{key:"type",base:Fue,typeMap:{style:kue}},json:{write:!0}},Uue={types:{key:"type",base:Nue,typeMap:{style:lj}},json:{write:!0}},RA=new Lt("white");new Lt("black");const LRe=new Lt([255,255,255,0]);function DRe(t){return t.r===0&&t.g===0&&t.b===0}var M9;let MA=M9=class extends mu{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new M9(t)}};d([Si({multiply:"multiply",replace:"replace",tint:"tint"})],MA.prototype,"colorMixMode",void 0),MA=M9=d([J("esri.symbols.support.Symbol3DFillMaterial")],MA);function $s(t=jue){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function ub(t,e,i,r,n,s,o=$s()){return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function Dgt(t,e){const i=isFinite(t[2])||isFinite(t[5]);return new Ar(i?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function _T(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function NRe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function Hf(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function du(t,e,i=0,r=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<r;u++)n=Math.min(n,e[i+3*u]),s=Math.min(s,e[i+3*u+1]),o=Math.min(o,e[i+3*u+2]),a=Math.max(a,e[i+3*u]),l=Math.max(l,e[i+3*u+1]),c=Math.max(c,e[i+3*u+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function JF(t,e,i){const r=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(i)for(let u=0;u<r;u++){const p=e[u];n=Math.min(n,p[0]),s=Math.min(s,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let u=0;u<r;u++){const p=e[u];n=Math.min(n,p[0]),s=Math.min(s,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function FRe(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function Gb(t){return t[0]>=t[3]?0:t[3]-t[0]}function jb(t){return t[1]>=t[4]?0:t[4]-t[1]}function Ry(t){return t[2]>=t[5]?0:t[5]-t[2]}function zue(t){const e=Gb(t),i=Ry(t),r=jb(t);return Math.sqrt(e*e+i*i+r*r)}function Zd(t,e=[0,0,0]){return e[0]=t[0]+Gb(t)/2,e[1]=t[1]+jb(t)/2,e[2]=t[2]+Ry(t)/2,e}function pR(t,e=[0,0,0]){return e[0]=Gb(t),e[1]=jb(t),e[2]=Ry(t),e}function cj(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function Ngt(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function kRe(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function Xd(t,e){return e==null||kRe(t,e)}function Bue(t,e,i,r,n=t){return n[0]=t[0]+e,n[1]=t[1]+i,n[2]=t[2]+r,n[3]=t[3]+e,n[4]=t[4]+i,n[5]=t[5]+r,n}function Fgt(t,e,i=t){const r=t[0]+Gb(t)/2,n=t[1]+jb(t)/2,s=t[2]+Ry(t)/2;return i[0]=r+(t[0]-r)*e,i[1]=n+(t[1]-n)*e,i[2]=s+(t[2]-s)*e,i[3]=r+(t[3]-r)*e,i[4]=n+(t[4]-n)*e,i[5]=s+(t[5]-s)*e,i}function Vue(t,e,i=t){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i!==t&&(i[3]=t[3],i[4]=t[4],i[5]=t[5]),i}function Gue(t,e,i=t){return i[3]=e[0],i[4]=e[1],i[5]=e[2],i!==t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),t}function v5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Gr(t){return t?v5(t,HX):$s(HX)}function uj(t,e){return e||(e=li()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function kgt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function URe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=Number.NEGATIVE_INFINITY,t[3]=r,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function $9(t){return t.length===6}function hj(t){return Gb(t)===0&&jb(t)===0&&Ry(t)===0}function Ugt(t,e,i){if(t==null||e==null)return t===e;if(!$9(t)||!$9(e))return!1;if(i){for(let r=0;r<t.length;r++)if(!i(t[r],e[r]))return!1}else for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function zRe(t,e,i,r,n,s){return ub(t,e,i,r,n,s,BRe)}const zgt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],HX=[1/0,1/0,1/0,-1/0,-1/0,-1/0],jue=[0,0,0,0,0,0],BRe=$s();function KF(t,{isPrimitive:e,width:i,depth:r,height:n}){const s=e?10:1;if(i==null&&n==null&&r==null)return[s*t[0],s*t[1],s*t[2]];const o=Ge(i,r,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const VRe=ub(-.5,-.5,-.5,.5,.5,.5),GRe=ub(-.5,-.5,0,.5,.5,1),jRe=ub(-.5,-.5,0,.5,.5,.5);function HRe(t){switch(t){case"sphere":case"cube":case"diamond":return VRe;case"cylinder":case"cone":case"inverted-cone":return GRe;case"tetrahedron":return jRe;default:return}}const dj=["butt","square","round"],WRe=[...dj,"none"],Hue=["miter","bevel","round"];var I9;let Dv=I9=class extends Nt{constructor(t){super(t),this.color=new Lt([0,0,0,1]),this.size=dp(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new I9(t)}};d([m(Bg)],Dv.prototype,"color",void 0),d([m(jf)],Dv.prototype,"size",void 0),d([m(Uue)],Dv.prototype,"pattern",void 0),d([m({type:dj,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],Dv.prototype,"patternCap",void 0),Dv=I9=d([J("esri.symbols.support.Symbol3DOutline")],Dv);var uI;let Um=uI=class extends rm{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new uI(t)}static fromSimpleFillSymbol(t){var r,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new lj({style:t.outline.style}):null,i={size:((r=t.outline)==null?void 0:r.width)??0,color:(((n=t.outline)==null?void 0:n.color)??RA).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(i.patternCap=t.outline.cap),new uI({material:new MA({color:(t.color??LRe).clone()}),pattern:t.style&&t.style!=="solid"?new kue({style:t.style}):null,outline:i})}};d([Si({Fill:"fill"},{readOnly:!0})],Um.prototype,"type",void 0),d([m({type:MA,json:{write:!0}})],Um.prototype,"material",void 0),d([m(IRe)],Um.prototype,"pattern",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Um.prototype,"castShadows",void 0),d([m({type:Dv,json:{write:!0}})],Um.prototype,"outline",void 0),d([m($ue)],Um.prototype,"edges",void 0),Um=uI=d([J("esri.symbols.FillSymbol3DLayer")],Um);const F3=Um,qRe=["none","underline","line-through"],ZRe=["normal","italic","oblique"],XRe=["normal","lighter","bold","bolder"],Wue={type:Number,cast:t=>{const e=Vd(t);return e===0?1:$e(e,.1,4)},nonNullable:!0},YRe=["left","right","center"],JRe=["baseline","top","middle","bottom"],que={type:YRe,nonNullable:!0},Zue={type:JRe,nonNullable:!0},Bgt=8;var L9;let zm=L9=class extends Nt{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return ns(t)}clone(){return new L9({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([m({type:qRe,json:{default:"none",write:!0}})],zm.prototype,"decoration",void 0),d([m({type:String,json:{write:!0}})],zm.prototype,"family",void 0),d([m({type:Number,json:{write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.textSymbol3D})}}})],zm.prototype,"size",void 0),d([Sn("size")],zm.prototype,"castSize",null),d([m({type:ZRe,json:{default:"normal",write:!0}})],zm.prototype,"style",void 0),d([m({type:XRe,json:{default:"normal",write:!0}})],zm.prototype,"weight",void 0),zm=L9=d([J("esri.symbols.Font")],zm);const b5=zm,KRe=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,QRe={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function WX(t){const e=t==null?void 0:t.match(KRe);if(!e)return null;const[,i,r,n]=e;if(!i)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:u}=QRe;if(r)if(s=i,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(i.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function eMe(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function tMe(t){const e=atob(t),i=new Uint8Array(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return i.buffer}const iMe=ye.getLogger("esri.core.urlUtils"),cS=Er.request,qX="esri/config: esriConfig.request.proxyUrl is not set.",Xue=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Yue=/^\s*http:/i,rMe=/^\s*https:/i,nMe=/^\s*file:/i,sMe=/:\d+$/,oMe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,aMe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),lMe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let B2=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(aMe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(lMe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}};const fR={},cMe=new B2(Er.applicationUrl);let Ka=cMe;const uMe=hMe();let pj=uMe;const fj=()=>Ka,Ggt=()=>pj;function hMe(){const t=Ka.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${Ka.scheme}://${Ka.host}${Ka.port!=null?`:${Ka.port}`:""}`}${e}`}function sl(t){if(!t)return null;const e={path:null,query:null},i=new B2(t),r=t.indexOf("?");return i.query===null?e.path=t:(e.path=t.substring(0,r),e.query=mj(i.query)),i.fragment&&(e.hash=i.fragment,i.query===null&&(e.path=e.path.substring(0,e.path.length-(i.fragment.length+1)))),e}function mj(t){const e=t.split("&"),i={};for(const r of e){if(!r)continue;const n=r.indexOf("=");let s,o;n<0?(s=decodeURIComponent(r),o=""):(s=decodeURIComponent(r.slice(0,n)),o=decodeURIComponent(r.slice(n+1)));let a=i[s];typeof a=="string"&&(a=i[s]=[a]),Array.isArray(a)?a.push(o):i[s]=o}return i}function ZX(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function AP(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(e(i,t[i]))).join("&"):Object.keys(t).map(i=>{const r=t[i];if(r==null)return"";const n=encodeURIComponent(i)+"=",s=e&&e[i];return s?n+encodeURIComponent(s(r)):Array.isArray(r)?r.map(o=>ZX(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):ZX(r)?n+encodeURIComponent(JSON.stringify(r)):n+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function dMe(t=!1){let e,i=cS.proxyUrl;if(typeof t=="string"){e=yMe(t);const r=w5(t);r&&(i=r.proxyUrl)}else e=!!t;if(!i)throw iMe.warn(qX),new ce("urlutils:proxy-not-set",qX);return e&&D9()&&(i=wj(i)),sl(i)}function jgt(t){const e=w5(t);let i,r;if(e){const n=gj(e.proxyUrl);i=n.path,r=n.query?mj(n.query):null}if(i){const n=sl(t);t=i+"?"+n.path;const s=AP({...r,...n.query});s&&(t=`${t}?${s}`)}return t}const lC={path:"",query:""};function gj(t){const e=t.indexOf("?");return e!==-1?(lC.path=t.slice(0,e),lC.query=t.slice(e+1)):(lC.path=t,lC.query=null),lC}function Jue(t){return t=(t=KL(t=TMe(t=gj(t).path),!0)).toLowerCase()}function pMe(t){const e={proxyUrl:t.proxyUrl,urlPrefix:Jue(t.urlPrefix)},i=cS.proxyRules,r=e.urlPrefix;let n=i.length;for(let s=0;s<i.length;s++){const o=i[s].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;n=s;break}o.indexOf(r)===0&&(n=s+1)}return i.splice(n,0,e),n}function w5(t){const e=cS.proxyRules,i=Jue(t);for(let r=0;r<e.length;r++)if(i.indexOf(e[r].urlPrefix)===0)return e[r]}function Hgt(t,e){if(!t||!e)return!1;t=JL(t),e=JL(e);const i=WX(t),r=WX(e);return i!=null&&r!=null?i.portalHostname===r.portalHostname:i==null&&r==null&&yT(t,e,!0)}function fMe(t,e){return t=JL(t),e=JL(e),KL(t)===KL(e)}function JL(t){const e=(t=mg(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function Kue(t){const e=r=>r==null||r instanceof RegExp&&r.test(t)||typeof r=="string"&&t.startsWith(r),i=cS.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(e))return r}else if(e(r.urls))return r}return null}function yT(t,e,i=!1){if(!t||!e)return!1;const r=F9(t),n=F9(e);return!(!i&&r.scheme!==n.scheme)&&r.host!=null&&n.host!=null&&r.host.toLowerCase()===n.host.toLowerCase()&&r.port===n.port}function _j(t){if(typeof t=="string"){if(!gu(t))return!0;t=F9(t)}if(yT(t,Ka))return!0;const e=cS.trustedServers||[];for(let i=0;i<e.length;i++){const r=mMe(e[i]);for(let n=0;n<r.length;n++)if(yT(t,r[n]))return!0}return!1}function mMe(t){return fR[t]||(bj(t)||Wf(t)?fR[t]=[new B2(cu(t))]:fR[t]=[new B2(`http://${t}`),new B2(`https://${t}`)]),fR[t]}function cu(t,e=pj,i){return Wf(t)?i&&i.preserveProtocolRelative?t:Ka.scheme==="http"&&Ka.authority===rp(t).slice(2)?`http:${t}`:`https:${t}`:bj(t)?t:x5(t[0]==="/"?xMe(e):e,t)}function yj(t,e=pj,i){if(t==null||!gu(t))return t;const r=mg(t),n=r.toLowerCase(),s=mg(e).toLowerCase().replace(/\/+$/,""),o=i?mg(i).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(p,f,y)=>(y=p.indexOf(f,y))===-1?p.length:y;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=r.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let p=0;p<u;p++)t=`../${t}`;else t=`./${t}`;return t}function mg(t){return t=EMe(t=CMe(t=SMe(t=cu(t=t.trim()))))}function x5(...t){const e=t.filter(w3);if(!e||!e.length)return;const i=[];if(gu(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(i.push(n.slice(0,s+1)),bMe(e[0])&&(i[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&i.push("");const r=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<r.length;n++){const s=r[n];s===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!s&&n===r.length-1||s&&(s!=="."||i.length===0))&&i.push(s)}return i.join("/")}function rp(t,e=!1){if(t==null||PP(t)||nm(t))return null;let i=t.indexOf("://");if(i===-1&&Wf(t))i=2;else{if(i===-1)return null;i+=3}const r=t.indexOf("/",i);return r!==-1&&(t=t.slice(0,r)),e&&(t=KL(t,!0)),t}function gu(t){return Wf(t)||bj(t)}function PP(t){return t!=null&&t.slice(0,5)==="blob:"}function nm(t){return t!=null&&t.slice(0,5)==="data:"}function vj(t){const e=hb(t);return e&&e.isBase64?tMe(e.data):null}function Wgt(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const gMe=/^data:(.*?)(;base64)?,(.*)$/;function hb(t){const e=t.match(gMe);if(!e)return null;const[,i,r,n]=e;return{mediaType:i,isBase64:!!r,data:n}}function Que(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function qgt(t){const e=vj(t);if(!e)return null;const i=hb(t);return new Blob([e],{type:i.mediaType})}function Zgt(t,e){_Me(t,e)}function _Me(t,e){if(!t)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(t);return i.download=e,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function Wf(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function bj(t){return t!=null&&Xue.test(t)}function yMe(t){return t!=null&&rMe.test(t)||Ka.scheme==="https"&&Wf(t)}function vMe(t){return t!=null&&Yue.test(t)||Ka.scheme==="http"&&Wf(t)}function bMe(t){return t!=null&&nMe.test(t)}function wj(t){return Wf(t)?`https:${t}`:t.replace(Yue,"https:")}function wMe(){return Ka.scheme==="http"}function D9(){return Ka.scheme==="https"}function KL(t,e=!1){return Wf(t)?t.slice(2):(t=t.replace(Xue,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function xMe(t){const e=t.indexOf("//"),i=t.indexOf("/",e+2);return i===-1?t:t.slice(0,i)}function xj(t){let e=0;if(gu(t)){const r=t.indexOf("//");r!==-1&&(e=r+2)}const i=t.lastIndexOf("/");return i<e?t:t.slice(0,i+1)}function Xgt(t,e){if(!t)return"";const i=sl(t).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(e!=null&&e.length))return r;const n=new RegExp(`.(${e.join("|")})$`,"ig");return r.replace(n,"")}function TMe(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function ehe(t){return t.replace(/\/+$/,"")}function SMe(t){if(/^https?:\/\//i.test(t)){const e=gj(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function CMe(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function EMe(t){const e=cS.httpsDomains;if(!vMe(t))return t;const i=t.indexOf("/",7);let r;if(r=i===-1?t:t.slice(0,i),r=r.toLowerCase().slice(7),sMe.test(r)){if(!r.endsWith(":80"))return t;r=r.slice(0,-3),t=t.replace(":80","")}return wMe()&&r===Ka.authority&&!oMe.test(t)||(D9()&&r===Ka.authority||e&&e.some(n=>r===n||r.endsWith(`.${n}`))||D9()&&!w5(t))&&(t=wj(t)),t}function N9(t,e,i){if(!(e&&i&&t&&gu(t)))return t;const r=t.indexOf("//"),n=t.indexOf("/",r+2),s=t.indexOf(":",r+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(r+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,r+2)}${i}${t.slice(o)}`}function F9(t){return typeof t=="string"?new B2(cu(t)):(t.scheme||(t.scheme=Ka.scheme),t)}function the(t){return AMe.test(t)}function ihe(t,e){const i=sl(t),r=Object.keys(i.query||{});return r.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function rhe(t,e,i){const r=sl(t),n=r.query||{};return n[e]=String(i),`${r.path}?${AP(n)}`}function QF(t,e){const i=sl(t),r=i.query||{};for(const s in e)r[s]=e[s];const n=AP(r);return n?`${i.path}?${n}`:i.path}function Ygt(t){if(t==null)return null;const e=t.match(nhe);return e?e[2]:null}function XX(t){if(t==null)return null;const e=t.match(nhe);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function Jgt(t){return typeof t=="string"?hb(t)??{data:t}:new Promise((e,i)=>{const r=new FileReader;r.readAsDataURL(t),r.onload=()=>e(hb(r.result)),r.onerror=n=>i(n)})}const nhe=/([^.]*)\.([^\/]*)$/,AMe=/(^data:image\/svg|\.svg$)/i;function db(t,e){const i=e&&e.url&&e.url.path;if(t&&i&&(t=cu(t,i,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const r=yj(t,e.portalItem.itemUrl);r!=null&&PMe.test(r)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(r).path)}return k9(t,e&&e.portal)}function vT(t,e,i=OP.YES){if(t==null)return t;!gu(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let r=cu(t);if(e){const n=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(n){const s=k9(n,e.portal),o=k9(r,e.portal);r=yj(o,s,s),r!=null&&r!==o&&r!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=ohe(r,e==null?void 0:e.portal),gu(r)&&(r=mg(r)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!gu(r)&&!nm(r)&&i===OP.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),r}function Tj(t,e,i){return db(t,i)}function pb(t,e,i,r){const n=vT(t,r);n!==void 0&&(e[i]=n)}const she=/\/items\/([^\/]+)\/resources\/(.*)/,PMe=/^\.\/resources\//;function OMe(t){const e=(t==null?void 0:t.match(she))??null;return(e==null?void 0:e[1])??null}function RMe(t){const e=(t==null?void 0:t.match(she))??null;if(e==null)return null;const i=e[2],r=i.lastIndexOf("/");if(r===-1){const{path:o,extension:a}=XX(i);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=XX(i.slice(r+1));return{prefix:i.slice(0,r),filename:n,extension:s}}function ohe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?N9(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function k9(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const i=`${e.urlKey}.${e.customBaseUrl}`,r=fj();return yT(r,`${r.scheme}://${i}`)?N9(t,e.portalHostname,i):N9(t,i,e.portalHostname)}var OP;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(OP||(OP={}));const Kgt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return OP},ensureMainOnlineDomain:ohe,fromJSON:db,itemIdFromResourceUrl:OMe,prefixAndFilenameFromResourceUrl:RMe,read:Tj,toJSON:vT,write:pb},Symbol.toStringTag,{value:"Module"}));var U9;const MMe=Ou()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Nv=U9=class extends Nt{constructor(t){super(t)}readHref(t,e,i){return t?db(t,i):e.dataURI}writeHref(t,e,i,r){t&&(nm(t)?e.dataURI=t:(e.href=vT(t,r),gu(e.href)&&(e.href=mg(e.href))))}clone(){return new U9({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Nv.prototype,"href",void 0),d([yr("href")],Nv.prototype,"readHref",null),d([Pr("href",{href:{type:String},dataURI:{type:String}})],Nv.prototype,"writeHref",null),d([Si(MMe)],Nv.prototype,"primitive",void 0),Nv=U9=d([J("esri.symbols.support.IconSymbol3DLayerResource")],Nv);const $Me="circle";var z9;let _2=z9=class extends ke{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new z9({x:this.x,y:this.y})}};d([m({type:Number})],_2.prototype,"x",void 0),d([m({type:Number})],_2.prototype,"y",void 0),_2=z9=d([J("esri.symbols.support.Symbol3DAnchorPosition2D")],_2);var B9;let wE=B9=class extends Nt{constructor(t){super(t),this.color=new Lt([0,0,0,1]),this.size=dp(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new B9(t)}};d([m(Bg)],wE.prototype,"color",void 0),d([m(jf)],wE.prototype,"size",void 0),wE=B9=d([J("esri.symbols.support.Symbol3DIconOutline")],wE);var Ux;const ahe="esri.symbols.IconSymbol3DLayer";let Kp=Ux=class extends rm{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new Ux({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||RA,i=YX(t),r=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||RA).clone()}:null;return new Ux({size:t.size,resource:{primitive:LMe(t.style)},material:{color:e},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(t){const e=!t.color||DRe(t.color)?RA:t.color,i=YX(t);return new Ux({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(t){return new Ux({resource:{href:Que({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function YX(t){const e="width"in t?t.width:t.size,i="height"in t?t.height:t.size,r=JX(t.xoffset),n=JX(t.yoffset);return(r||n)&&e&&i?{x:-r/e,y:n/i}:null}function JX(t){return isFinite(t)?t:0}d([m({type:mu,json:{write:!0}})],Kp.prototype,"material",void 0),d([m({type:Nv,json:{write:!0}})],Kp.prototype,"resource",void 0),d([Si({Icon:"icon"},{readOnly:!0})],Kp.prototype,"type",void 0),d([m(jf)],Kp.prototype,"size",void 0),d([Si({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),m({json:{default:"center"}})],Kp.prototype,"anchor",void 0),d([m({type:_2,json:{type:[Number],read:{reader:t=>new _2({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Kp.prototype,"anchorPosition",void 0),d([m({type:wE,json:{write:!0}})],Kp.prototype,"outline",void 0),Kp=Ux=d([J(ahe)],Kp);const IMe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function LMe(t){return IMe[t]||(ye.getLogger(ahe).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const D_=Kp;function fb(t,e,i=Ci){return e||(e=new i),e===t||(e.removeAll(),DMe(t)?e.addMany(t):t&&e.add(t)),e}function lhe(t){return t}function DMe(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const che="20230626",uhe="b81703b48e0b92e492f4cc6b739af02a9af50038",NMe="4.27";let Sj=NMe;Sj="4.27.6";const FMe={async request(t,e){var a,l;const{default:i}=await Oe(()=>Promise.resolve().then(()=>e$e),void 0,import.meta.url),r=t.options,n=r.responseType;r.signal=e==null?void 0:e.signal,r.responseType=n==="native"||n==="native-request-init"?"native-request-init":n&&["blob","json","text"].includes(n)&&((a=Kue(t.url))!=null&&a.after)?n:"array-buffer";const s=await i(t.url,r),o={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((l=s.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let En;function Qgt(t){En=t}function e0t(t){const e=En==null?void 0:En.findCredential(t);return e!=null&&e.token?rhe(t,"token",e.token):t}ge("host-webworker");const kMe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function hhe(t){const e=rp(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!kMe.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function dhe(t,e,i=!1,r){return new Promise((n,s)=>{if(Gs(r))return void s(KX());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),n(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",s(KX())};const c=()=>{ge("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,r!=null&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(e)};r!=null&&r.addEventListener("abort",l),ge("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function KX(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const phe="Timeout exceeded";function UMe(){return new Error(phe)}function t0t(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===phe}function zMe(t){Er.request.crossOriginNoCorsDomains||(Er.request.crossOriginNoCorsDomains={});const e=Er.request.crossOriginNoCorsDomains;for(let i of t)i=i.toLowerCase(),/^https?:\/\//.test(i)?e[rp(i)??""]=0:(e[rp("http://"+i)??""]=0,e[rp("https://"+i)??""]=0)}function BMe(t){const e=Er.request.crossOriginNoCorsDomains;if(e){let i=rp(t);if(i)return i=i.toLowerCase(),!yT(i,fj())&&e[i]<Date.now()-36e5}return!1}async function VMe(t){var n;const e=Er.request.crossOriginNoCorsDomains,i=rp(t);e&&i&&(e[i.toLowerCase()]=Date.now());const r=sl(t);t=r.path,((n=r.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function ps(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=mj(e.query.toString().replaceAll("+"," ")));const i=nm(t),r=PP(t);r||i||(t=mg(t));const n={url:t,requestOptions:{...e}};let s=Kue(t);if(s){const u=await YMe(s,n);if(u!=null)return{data:u,getHeader:Cj,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(ge("host-webworker")||ge("host-node")))throw If("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw If("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(i||r)throw If("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await qMe(),QL)return QL.execute(t,e);const o=new AbortController;Ca(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:kd.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await KMe(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let QL;const kd=Er.request,fhe="FormData"in globalThis,GMe=[499,498,403,401],jMe=["COM_0056","COM_0057","SB_0008"],HMe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Cj=()=>null,eD=Symbol();function WMe(t){const e=rp(t);e&&!ps._corsServers.includes(e)&&ps._corsServers.push(e)}function QX(t){const e=rp(t);return!e||e.endsWith(".arcgis.com")||ps._corsServers.includes(e)||_j(e)}function If(t,e,i,r){let n="Error";const s={url:i.url,requestOptions:i.requestOptions,getHeader:Cj,ssl:!1};if(e instanceof ce)return e.details?(e.details=Le(e.details),e.details.url=i.url,e.details.requestOptions=i.requestOptions):e.details=s,e;if(e){const o=r&&(c=>r.headers.get(c)),a=r==null?void 0:r.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=eD in e?e[eD]:e}return ms(e)?Qi():new ce(t,n,s)}async function qMe(){ge("host-webworker")?QL||(QL=await Oe(()=>import("./request-61e76031.js"),[],import.meta.url)):ps._abortableFetch||(ps._abortableFetch=globalThis.fetch.bind(globalThis))}async function V9(){En||await Oe(()=>import("./IdentityManager-7a2fd61f.js"),["./IdentityManager-7a2fd61f.js","./widget-93850baa.js"],import.meta.url)}async function ZMe(t){var a;const e=t.params.url,i=t.params.requestOptions,r=t.controller.signal,n=i.body;let s=null,o=null;if(fhe&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:i.cacheBust&&!("polyfill"in ps._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:kd.priority,redirect:"follow",signal:r},(s||o)&&(t.fetchOptions.body=s||o),i.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=i.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&Er.apiKey&&hhe(e)&&(i.query||(i.query={}),i.query.token=Er.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!mhe(e)&&!Gs(r)){let l;i.authMode==="immediate"?(await V9(),l=await En.getCredential(e,{signal:r}),t.credential=l):i.authMode==="no-prompt"?(await V9(),l=await En.getCredential(e,{prompt:!1,signal:r}).catch(()=>{}),t.credential=l):En&&(l=En.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function mhe(t){return HMe.some(e=>e.test(t))}async function XMe(t){let e=t.params.url;const i=t.params.requestOptions,r=t.fetchOptions??{},n=PP(e)||nm(e),s=i.responseType||"json",o=n?0:i.timeout!=null?i.timeout:kd.timeout;let a=!1;if(!n){t.useSSL&&(e=wj(e)),i.cacheBust&&r.cache==="default"&&(e=rhe(e,"request.preventCache",Date.now()));let f={...i.query};t.credentialToken&&(f.token=t.credentialToken);let y=AP(f);ge("esri-url-encodes-apostrophe")&&(y=y.replaceAll("'","%27"));const v=e.length+1+y.length;let b;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||v>kd.maxUrlLength;const x=i.useProxy||!!w5(e);if(x){const S=dMe(e);b=S.path,!a&&b.length+1+v>kd.maxUrlLength&&(a=!0),S.query&&(f={...S.query,...f})}if(r.method==="HEAD"&&(a||x)){if(a)throw v>kd.maxUrlLength?If("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):If("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(x)throw If("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?e=QF(e,f):(r.body=AP(f),r.headers||(r.headers={}),r.headers["Content-Type"]="application/x-www-form-urlencoded")):e=QF(e,f),x&&(t.useProxy=!0,e=`${b}?${e}`),f.token&&fhe&&r.body instanceof FormData&&!eMe(e)&&r.body.set("token",f.token),i.hasOwnProperty("withCredentials"))t.withCredentials=i.withCredentials;else if(!yT(e,fj())){if(_j(e))t.withCredentials=!0;else if(En){const S=En.findServerInfo(e);S!=null&&S.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(r.credentials="include",BMe(e)&&await VMe(a?QF(e,f):e))}let l,c,u=0,p=!1;o>0&&(u=setTimeout(()=>{p=!0,t.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=e;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||JMe(i.headers)||!n&&!t.useProxy&&kd.proxyUrl&&!QX(e)){if(l=await ps._abortableFetch(e,r),t.useProxy||WMe(e),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=eY(c,"application/xml");break;case"document":c=eY(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[s==="blob"?"size":"byteLength"]<=750)try{const y=await new Response(c).json();y.error&&(c=y)}catch{}}s==="image"&&c instanceof Blob&&(c=await tY(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await tY(e,t)}catch(f){if(f.name==="AbortError")throw p?UMe():Qi("Request canceled");if(!(!l&&f instanceof TypeError&&kd.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||t.useProxy||QX(e))throw f;t.redoRequest=!0,pMe({proxyUrl:kd.proxyUrl,urlPrefix:rp(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function YMe(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let i,r;try{r=await t.before(e)}catch(n){i=If("request:interceptor",n,e)}if((r instanceof Error||r instanceof ce)&&(i=If("request:interceptor",r,e)),i)throw t.error&&t.error(i),i;return r}}function JMe(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function eY(t,e){let i;try{i=new DOMParser().parseFromString(t,e)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function KMe(t){var s,o;let e,i;await ZMe(t);try{do[e,i]=await XMe(t);while(!await QMe(t,e,i))}catch(a){const l=If("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(s=t.interceptor)!=null&&s.error&&t.interceptor.error(l),l}const r=t.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!t.hasToken&&!t.credentialToken&&((o=i.user)!=null&&o.username)&&!_j(r)){const a=rp(r,!0);a&&kd.trustedServers.push(a)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&zMe(i.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&En){const a=En.findServerInfo(n.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=En.findCredential(l,n.userId);c&&En._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:i,getHeader:e?a=>e==null?void 0:e.headers.get(a):Cj,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function QMe(t,e,i){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const r=t.params.requestOptions;if(!e||r.responseType==="native"||r.responseType==="native-request-init")return!0;let n,s;if(i&&(i.error?n=i.error:i.status==="error"&&Array.isArray(i.messages)&&(n={...i},n[eD]=i,n.details=i.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[eD]=i,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o==null?void 0:o.toUpperCase());const l=r.authMode;if(s===403&&(a===4||(c=n.message)!=null&&c.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&GMe.includes(s)&&!mhe(t.params.url)&&(s!==403||o&&!jMe.includes(o)&&(a==null||a===2&&t.credentialToken))){await V9();try{const u=await En.getCredential(t.params.url,{error:If("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=u}}if(n)throw n;return!0}function tY(t,e,i=!1){const r=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=kd.priority,n.src=t,dhe(n,t,i,r)}ps._abortableFetch=null,ps._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const e$e=Object.freeze(Object.defineProperty({__proto__:null,default:ps},Symbol.toStringTag,{value:"Module"}));var f_;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(f_||(f_={}));let t$e=class{constructor(){this._resolver=sa(),this._status=f_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=f_.RESOLVED,this._cleanUp()},()=>{this._status=f_.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===f_.RESOLVED}isRejected(){return this._status===f_.REJECTED}isFulfilled(){return this._status!==f_.PENDING}abort(){this._resolver.reject(Qi())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=sa(),i=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==r||ms(n)||this._resolver.reject(n)}),e.resolve()}};const Ej=t=>{let e=class extends t{constructor(...i){super(...i),this._promiseProps=new t$e,this.addResolvingPromise(Promise.resolve())}destroy(){var i;(i=this._promiseProps)==null||i.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return this._promiseProps.promise.then(()=>this).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return e=d([J("esri.core.Promise")],e),e};let tD=class extends Ej(ke){};tD=d([J("esri.core.Promise")],tD);const i$e="not-loaded",r$e="loading",n$e="failed",iY="loaded",ghe=t=>{let e=class extends t{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=oG(s,l);this.destroyed&&l(new ce("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===i$e){this._set("loadStatus",r$e);const a=this._loadController=new AbortController;n({signal:a.signal}),Ca(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",iY),this._loadController=null},r=>{this._set("loadStatus",n$e),this._set("loadError",r),this._loadController=null})}destroy(){this._loadController=wu(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===iY}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new ce("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return d([m({readOnly:!0})],e.prototype,"loaded",null),d([m({readOnly:!0})],e.prototype,"loadError",void 0),d([m({clonable:!1})],e.prototype,"loadStatus",void 0),d([m({type:[tb],readOnly:!0})],e.prototype,"loadWarnings",null),e=d([J("esri.core.Loadable")],e),e};let xE=class extends ghe(tD){};xE=d([J("esri.core.Loadable")],xE),function(t){function e(i){return!(!i||!i.load)}t.LoadableMixin=ghe,t.isLoadable=e}(xE||(xE={}));const ly=xE;let mR;function s$e(t){return mR&&!mR.destroyed||(mR=t()),mR}var G9;const o$e=new Tu({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Qu=G9=class extends ke{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new G9({categories:this.categories?Le(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let i=[];this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let r="";if(this.extent){const o=Ub(this.extent,jt.WGS84);o!=null&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:i,bbox:r,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>o$e.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};d([m()],Qu.prototype,"categories",void 0),d([m()],Qu.prototype,"disableExtraQuery",void 0),d([m({type:Ar})],Qu.prototype,"extent",void 0),d([m()],Qu.prototype,"filter",void 0),d([m()],Qu.prototype,"num",void 0),d([m()],Qu.prototype,"query",void 0),d([m()],Qu.prototype,"sortField",void 0),d([m()],Qu.prototype,"sortOrder",null),d([m()],Qu.prototype,"start",void 0),Qu=G9=d([J("esri.portal.PortalQueryParams")],Qu);const wf=Qu;let Fv=class extends ke{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([m()],Fv.prototype,"nextQueryParams",void 0),d([m()],Fv.prototype,"queryParams",void 0),d([m()],Fv.prototype,"results",void 0),d([m()],Fv.prototype,"total",void 0),Fv=d([J("esri.portal.PortalQueryResult")],Fv);const a$e=Fv;let Bm=class extends Nt{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new ce("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([m({type:Date})],Bm.prototype,"created",void 0),d([m()],Bm.prototype,"id",void 0),d([m()],Bm.prototype,"portal",void 0),d([m()],Bm.prototype,"title",void 0),d([m({readOnly:!0})],Bm.prototype,"url",null),d([m()],Bm.prototype,"username",void 0),Bm=d([J("esri.portal.PortalFolder")],Bm);const l$e=Bm;let So=class extends Nt{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var r;const e=this.url,i=this.thumbnail;return e&&i&&this.portal?(r=this.portal)==null?void 0:r.normalizeUrl(`${e}/info/${i}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return uc(this.portal).request(this.url+"/categorySchema",e).then(i=>{const r=i.categorySchema||[];return r.some(n=>n.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return uc(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let i=this.thumbnailUrl;return i&&e&&(i+=`&w=${e}`),i}toJSON(){throw new ce("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,i){let r=rl(wf,e);const n=uc(this.portal);return parseFloat(n.currentVersion)>5?(r=r||new wf,n.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",i)):(r=r?r.clone():new wf,r.query="group:"+this.id+(r.query?" "+r.query:""),n.queryItems(r,i))}_fetchCategorySchemaSet(e,i){const r=uc(this.portal);return r.fetchSelf(r.authMode,!0,i).then(n=>{const s=n.contentCategorySetsGroupQuery;if(s){const o=new wf;return o.disableExtraQuery=!0,o.num=1,o.query=s,r.queryGroups(o,i)}throw new ce("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(n=>{if(n.total){const s=n.results[0],o=new wf;return o.num=1,o.query=`typekeywords:"${e}"`,s.queryItems(o,i)}throw new ce("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(n=>n.total?n.results[0].fetchData("json",i).then(s=>{const o=s&&s.categorySchema;return o&&o.length?o:[]}):[])}};d([m()],So.prototype,"access",void 0),d([m({type:Date})],So.prototype,"created",void 0),d([m()],So.prototype,"description",void 0),d([m()],So.prototype,"id",void 0),d([m()],So.prototype,"isInvitationOnly",void 0),d([m({type:Date})],So.prototype,"modified",void 0),d([m()],So.prototype,"owner",void 0),d([m()],So.prototype,"portal",void 0),d([m()],So.prototype,"snippet",void 0),d([m()],So.prototype,"sortField",void 0),d([m()],So.prototype,"sortOrder",void 0),d([m()],So.prototype,"tags",void 0),d([m()],So.prototype,"thumbnail",void 0),d([m({readOnly:!0})],So.prototype,"thumbnailUrl",null),d([m()],So.prototype,"title",void 0),d([m({readOnly:!0})],So.prototype,"url",null),So=d([J("esri.portal.PortalGroup")],So);const j9=So,c$e=Object.freeze(Object.defineProperty({__proto__:null,default:j9},Symbol.toStringTag,{value:"Module"}));var H9;let $n=H9=class extends Nt{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,i=t&&t.data,r=t&&t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),i!=null&&(typeof i=="string"?n.query.text=i:typeof i=="object"&&(n.query.text=JSON.stringify(i))));let s=this.userContentUrl;return r&&(s+="/"+(typeof r=="string"?r:r.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",i=t.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal.request(e,r).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let i;return i=e&&e.folders?e.folders.map(r=>{const n=l$e.fromJSON(r);return n.portal=this.portal,n}):[],i})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(i=>{const r=j9.fromJSON(i);return r.portal=this.portal,r}):[],e})}fetchItems(t){const e=t??{};let i,r=this.userContentUrl??"";return e.folder&&(r+="/"+e.folder.id),Oe(()=>Promise.resolve().then(()=>tfe),void 0,import.meta.url).then(({default:n})=>{i=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(r,{query:s})}).then(n=>{let s;return n&&n.items?(s=n.items.map(o=>{const a=i.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new j9({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new ce("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new ce("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new H9;return e.sourceJSON=t,e.read(t),e}};d([m()],$n.prototype,"access",void 0),d([m({type:Date})],$n.prototype,"created",void 0),d([m()],$n.prototype,"culture",void 0),d([m()],$n.prototype,"description",void 0),d([m()],$n.prototype,"email",void 0),d([m()],$n.prototype,"favGroupId",void 0),d([m()],$n.prototype,"fullName",void 0),d([m({type:Date})],$n.prototype,"modified",void 0),d([m()],$n.prototype,"orgId",void 0),d([m()],$n.prototype,"portal",void 0),d([m()],$n.prototype,"preferredView",void 0),d([m()],$n.prototype,"privileges",void 0),d([m()],$n.prototype,"region",void 0),d([m()],$n.prototype,"role",void 0),d([m()],$n.prototype,"roleId",void 0),d([m()],$n.prototype,"sourceJSON",void 0),d([m()],$n.prototype,"thumbnail",void 0),d([m({readOnly:!0})],$n.prototype,"thumbnailUrl",null),d([m()],$n.prototype,"units",void 0),d([m({readOnly:!0})],$n.prototype,"userContentUrl",null),d([m({readOnly:!0})],$n.prototype,"url",null),d([m()],$n.prototype,"username",void 0),d([m()],$n.prototype,"userType",void 0),$n=H9=d([J("esri.portal.PortalUser")],$n);const _he=$n,u$e=Object.freeze(Object.defineProperty({__proto__:null,default:_he},Symbol.toStringTag,{value:"Module"}));var Vm;let gR;const rY={PortalGroup:()=>Oe(()=>Promise.resolve().then(()=>c$e),void 0,import.meta.url),PortalItem:()=>Oe(()=>Promise.resolve().then(()=>tfe),void 0,import.meta.url),PortalUser:()=>Oe(()=>Promise.resolve().then(()=>u$e),void 0,import.meta.url)};let Ye=Vm=class extends R3(ly){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Er.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){nY.unregister(this),this.defaultBasemap=Je(this.defaultBasemap),this.defaultDevBasemap=Je(this.defaultDevBasemap),this.defaultVectorBasemap=Je(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=Qr(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Er.request.trustedServers.includes(e)||Er.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=_he.fromJSON(t),e.portal=this),e}load(t){const e=Oe(()=>Promise.resolve().then(()=>B5e),void 0,import.meta.url).then(({default:i})=>{Ti(t),gR=i}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(i=>{var r;if(En){const n=En;this.credential=n.findCredential(this.restUrl),this.credential||this.authMode!==Vm.AUTH_MODE_AUTO||((r=this._esriIdCredentialCreateHandle)==null||r.remove(),this._esriIdCredentialCreateHandle=n.on("credential-create",h$e(new WeakRef(this))),nY.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await Oe(()=>import("./ElevationLayer-43496b9b.js"),["./ElevationLayer-43496b9b.js","./MultiOriginJSONSupport-d720758b.js","./ArcGISCachedService-10f06da9.js","./TileInfoTilemapCache-33c0bbbf.js","./TilemapCache-0b766e05.js","./ArcGISService-163e63f0.js","./OperationalLayer-5b164959.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./PortalLayer-473e8b12.js","./portalItemUtils-89a0d48a.js"],import.meta.url)).default;return t?t.map(i=>new e({id:i.id,url:i.url})):[]}async fetchBasemaps(t,e){const i=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const r=await this._fetchBasemaps3D(t,e);i.unshift(...r)}return i}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):Gs(t)?Promise.reject(Qi()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,i=new wf;if(i.num=100,i.sortField="title",e&&e.length){const r=[];for(const n of e)r.push(`(title:"${n.title}" AND owner:${n.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,t).then(n=>n.results)}return Gs(t)?Promise.reject(Qi()):Promise.resolve([])}fetchRegions(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||ip();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var i;const e=((i=this.user)==null?void 0:i.culture)||this.culture||ip();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return s$e(()=>new Vm)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,i){const r=this.restUrl+"/portals/self",n={authMode:t,query:{culture:ip().toLowerCase()},...i};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(r,n)}queryPortal(t,e,i,r){const n=rl(wf,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...r}).then(a=>{const l=n.clone();return l.start=a.nextStart,new a$e({nextQueryParams:l,queryParams:n,total:a.total,results:Vm._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(kb(l),a)));return i&&rY[i]?rY[i]().then(({default:o})=>(Ti(r),s(o))):s()}signIn(){if(this.authMode===Vm.AUTH_MODE_ANONYMOUS)return Promise.reject(new ce("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return En?En.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,i){return this.request(t,e).then(r=>{const n=Vm._resultsToTypedArray(i,{portal:this},r);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():r)).then(()=>n,()=>n)})}request(t,e={}){const i={f:"json",...e.query},{authMode:r=this.authMode===Vm.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:r,body:n,cacheBust:s,method:o,query:i,responseType:a,timeout:0,signal:l};return ps(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new ce("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new Vm({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new ce("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const i=new wf;i.query=t||(Er.apiKey&&hhe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0;const r=await this.queryGroups(i,e);if(!r.total)return[];const n=r.results[0];i.num=100,i.query='type:"Web Map" -type:"Web Application"',i.sortField=n.sortField||"name",i.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(i,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new gR({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const i=t||this.basemapGalleryGroupQuery3D;if(!i)return[];const r=new wf({query:i,disableExtraQuery:!0}),n=await this.queryGroups(r,e);if(!n.total)return[];const s=n.results[0];r.num=100,r.query='type:"Web Scene"',r.sortField=s.sortField||"name",r.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(r,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new gR({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=gR.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,i,r){let n=[];if(i){const s=r!=null?r.signal:null;n=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};Ye.AUTH_MODE_ANONYMOUS="anonymous",Ye.AUTH_MODE_AUTO="auto",Ye.AUTH_MODE_IMMEDIATE="immediate",d([m()],Ye.prototype,"access",void 0),d([m()],Ye.prototype,"allSSL",void 0),d([m()],Ye.prototype,"authMode",void 0),d([m()],Ye.prototype,"authorizedCrossOriginDomains",void 0),d([yr("authorizedCrossOriginDomains")],Ye.prototype,"readAuthorizedCrossOriginDomains",null),d([m()],Ye.prototype,"basemapGalleryGroupQuery",void 0),d([m({json:{name:"3DBasemapGalleryGroupQuery"}})],Ye.prototype,"basemapGalleryGroupQuery3D",void 0),d([m()],Ye.prototype,"bingKey",void 0),d([m()],Ye.prototype,"canListApps",void 0),d([m()],Ye.prototype,"canListData",void 0),d([m()],Ye.prototype,"canListPreProvisionedItems",void 0),d([m()],Ye.prototype,"canProvisionDirectPurchase",void 0),d([m()],Ye.prototype,"canSearchPublic",void 0),d([m()],Ye.prototype,"canShareBingPublic",void 0),d([m()],Ye.prototype,"canSharePublic",void 0),d([m()],Ye.prototype,"canSignInArcGIS",void 0),d([m()],Ye.prototype,"canSignInIDP",void 0),d([m()],Ye.prototype,"colorSetsGroupQuery",void 0),d([m()],Ye.prototype,"commentsEnabled",void 0),d([m({type:Date})],Ye.prototype,"created",void 0),d([m()],Ye.prototype,"credential",void 0),d([m()],Ye.prototype,"culture",void 0),d([m()],Ye.prototype,"currentVersion",void 0),d([m()],Ye.prototype,"customBaseUrl",void 0),d([m()],Ye.prototype,"defaultBasemap",void 0),d([yr("defaultBasemap")],Ye.prototype,"readDefaultBasemap",null),d([m()],Ye.prototype,"defaultDevBasemap",void 0),d([yr("defaultDevBasemap")],Ye.prototype,"readDefaultDevBasemap",null),d([m({type:Ar})],Ye.prototype,"defaultExtent",void 0),d([m()],Ye.prototype,"defaultVectorBasemap",void 0),d([yr("defaultVectorBasemap")],Ye.prototype,"readDefaultVectorBasemap",null),d([m()],Ye.prototype,"description",void 0),d([m()],Ye.prototype,"devBasemapGalleryGroupQuery",void 0),d([m()],Ye.prototype,"eueiEnabled",void 0),d([m({readOnly:!0})],Ye.prototype,"extraQuery",null),d([m()],Ye.prototype,"featuredGroups",void 0),d([m()],Ye.prototype,"featuredItemsGroupQuery",void 0),d([m()],Ye.prototype,"galleryTemplatesGroupQuery",void 0),d([m()],Ye.prototype,"livingAtlasGroupQuery",void 0),d([m()],Ye.prototype,"hasCategorySchema",void 0),d([m()],Ye.prototype,"helpBase",void 0),d([m()],Ye.prototype,"helperServices",void 0),d([m()],Ye.prototype,"helpMap",void 0),d([m()],Ye.prototype,"homePageFeaturedContent",void 0),d([m()],Ye.prototype,"homePageFeaturedContentCount",void 0),d([m()],Ye.prototype,"httpPort",void 0),d([m()],Ye.prototype,"httpsPort",void 0),d([m()],Ye.prototype,"id",void 0),d([m()],Ye.prototype,"ipCntryCode",void 0),d([m({readOnly:!0})],Ye.prototype,"isOrganization",null),d([m()],Ye.prototype,"isPortal",void 0),d([m()],Ye.prototype,"isReadOnly",void 0),d([m({readOnly:!0})],Ye.prototype,"itemPageUrl",null),d([m()],Ye.prototype,"layerTemplatesGroupQuery",void 0),d([m()],Ye.prototype,"maxTokenExpirationMinutes",void 0),d([m({type:Date})],Ye.prototype,"modified",void 0),d([m()],Ye.prototype,"name",void 0),d([m()],Ye.prototype,"portalHostname",void 0),d([m()],Ye.prototype,"portalMode",void 0),d([m()],Ye.prototype,"portalProperties",void 0),d([m()],Ye.prototype,"region",void 0),d([m({readOnly:!0})],Ye.prototype,"restUrl",null),d([m()],Ye.prototype,"rotatorPanels",void 0),d([m()],Ye.prototype,"showHomePageDescription",void 0),d([m()],Ye.prototype,"sourceJSON",void 0),d([m()],Ye.prototype,"staticImagesUrl",void 0),d([m({json:{name:"2DStylesGroupQuery"}})],Ye.prototype,"stylesGroupQuery2d",void 0),d([m({json:{name:"stylesGroupQuery"}})],Ye.prototype,"stylesGroupQuery3d",void 0),d([m()],Ye.prototype,"supportsHostedServices",void 0),d([m()],Ye.prototype,"symbolSetsGroupQuery",void 0),d([m()],Ye.prototype,"templatesGroupQuery",void 0),d([m()],Ye.prototype,"thumbnail",void 0),d([m({readOnly:!0})],Ye.prototype,"thumbnailUrl",null),d([m()],Ye.prototype,"units",void 0),d([m()],Ye.prototype,"url",void 0),d([m()],Ye.prototype,"urlKey",void 0),d([yr("urlKey")],Ye.prototype,"readUrlKey",null),d([m()],Ye.prototype,"user",void 0),d([yr("user")],Ye.prototype,"readUser",null),d([m()],Ye.prototype,"use3dBasemaps",void 0),d([m()],Ye.prototype,"useStandardizedQuery",void 0),d([m()],Ye.prototype,"useVectorBasemaps",void 0),d([m()],Ye.prototype,"vectorBasemapGalleryGroupQuery",void 0),Ye=Vm=d([J("esri.portal.Portal")],Ye);const zh=Ye,nY=new FinalizationRegistry(t=>{t.remove()});function h$e(t){const e=En;return()=>{const i=t.deref();i&&e.findCredential(i.restUrl)&&i.signIn().catch(()=>{})}}let kv=class extends em(Nt){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([m({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],kv.prototype,"type",void 0),d([m({type:PRe,json:{default:"begin-end",write:!0}})],kv.prototype,"placement",void 0),d([m({type:Lue,json:{default:"arrow",write:!0}})],kv.prototype,"style",void 0),d([m({type:Lt,json:{type:[js],default:null,write:!0}})],kv.prototype,"color",void 0),kv=d([J("esri.symbols.LineStyleMarker3D")],kv);const W9=kv;var hI;let Qp=hI=class extends rm{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=dp(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new hI(t)}static fromSimpleLineSymbol(t){var i;const e={enabled:!0,size:t.width??dp(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new lj({style:t.style}):null,material:new mu({color:(t.color||RA).clone()}),marker:t.marker?new W9({placement:t.marker.placement,style:t.marker.style,color:((i=t.marker.color)==null?void 0:i.clone())??null}):null};return new hI(e)}};d([m({type:mu,json:{write:!0}})],Qp.prototype,"material",void 0),d([Si({Line:"line"},{readOnly:!0})],Qp.prototype,"type",void 0),d([m({type:Hue,json:{write:!0,default:"miter"}})],Qp.prototype,"join",void 0),d([m({type:dj,json:{write:!0,default:"butt"}})],Qp.prototype,"cap",void 0),d([m(jf)],Qp.prototype,"size",void 0),d([m(Uue)],Qp.prototype,"pattern",void 0),d([m({types:{key:"type",base:W9,typeMap:{style:W9}},json:{write:!0}})],Qp.prototype,"marker",void 0),Qp=hI=d([J("esri.symbols.LineSymbol3DLayer")],Qp);const k3=Qp;var q9;const d$e=Ou()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let TE=q9=class extends Nt{clone(){return new q9({href:this.href,primitive:this.primitive})}};d([m({type:String,json:{read:Tj,write:pb}})],TE.prototype,"href",void 0),d([Si(d$e)],TE.prototype,"primitive",void 0),TE=q9=d([J("esri.symbols.support.ObjectSymbol3DLayerResource")],TE);const yhe="sphere";var Z9;let p1=Z9=class extends ke{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Z9({x:this.x,y:this.y,z:this.z})}};d([m({type:Number})],p1.prototype,"x",void 0),d([m({type:Number})],p1.prototype,"y",void 0),d([m({type:Number})],p1.prototype,"z",void 0),p1=Z9=d([J("esri.symbols.support.Symbol3DAnchorPosition3D")],p1);var X9;let Fa=X9=class extends rm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new X9({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([m({type:mu,json:{write:!0}})],Fa.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Fa.prototype,"castShadows",void 0),d([m({type:TE,json:{write:!0}})],Fa.prototype,"resource",void 0),d([Si({Object:"object"},{readOnly:!0})],Fa.prototype,"type",void 0),d([m({type:Number,json:{write:!0}})],Fa.prototype,"width",void 0),d([m({type:Number,json:{write:!0}})],Fa.prototype,"height",void 0),d([m({type:Number,json:{write:!0}})],Fa.prototype,"depth",void 0),d([Si({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),m({json:{default:"origin"}})],Fa.prototype,"anchor",void 0),d([m({type:p1,json:{type:[Number],read:{reader:t=>new p1({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Fa.prototype,"anchorPosition",void 0),d([m({type:Number,json:{write:!0}})],Fa.prototype,"heading",void 0),d([m({type:Number,json:{write:!0}})],Fa.prototype,"tilt",void 0),d([m({type:Number,json:{write:!0}})],Fa.prototype,"roll",void 0),d([m({readOnly:!0})],Fa.prototype,"isPrimitive",null),Fa=X9=d([J("esri.symbols.ObjectSymbol3DLayer")],Fa);const Aj=Fa;var Y9;let yl=Y9=class extends rm{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Y9({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([m({type:mu,json:{write:!0}})],yl.prototype,"material",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],yl.prototype,"castShadows",void 0),d([Si({Path:"path"},{readOnly:!0})],yl.prototype,"type",void 0),d([m({type:["circle","quad"],json:{write:!0,default:"circle"}})],yl.prototype,"profile",void 0),d([m({type:Hue,json:{write:!0,default:"miter"}})],yl.prototype,"join",void 0),d([m({type:WRe,json:{write:!0,default:"butt"}})],yl.prototype,"cap",void 0),d([m({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],yl.prototype,"width",void 0),d([yr("width",["width","size","height"])],yl.prototype,"readWidth",null),d([m({type:Number,json:{write:!0}})],yl.prototype,"height",void 0),d([yr("height",["height","size","width"])],yl.prototype,"readHeight",null),d([m({type:["center","bottom","top"],json:{write:!0,default:"center"}})],yl.prototype,"anchor",void 0),d([m({type:["heading","all"],json:{write:!0,default:"all"}})],yl.prototype,"profileRotation",void 0),yl=Y9=d([J("esri.symbols.PathSymbol3DLayer")],yl);const Pj=yl;var J9;let y2=J9=class extends Nt{constructor(){super(...arguments),this.color=new Lt([0,0,0,1]),this.size=0}clone(){const t={color:Le(this.color),size:this.size};return new J9(t)}};d([m(Bg)],y2.prototype,"color",void 0),d([m(jf)],y2.prototype,"size",void 0),y2=J9=d([J("esri.symbols.support.Symbol3DHalo")],y2);let $A=class extends em(Nt){constructor(e){super(e),this.color=null}};d([m(Bg)],$A.prototype,"color",void 0),$A=d([J("esri.symbols.support.Symbol3DTextBackground")],$A);var dI;let Kl=dI=class extends rm{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,i,r){const n={...r,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new dI({enabled:this.enabled,font:this.font&&Le(this.font),halo:this.halo&&Le(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:Le(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new dI({font:t.font!=null?t.font.clone():new b5,halo:p$e(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new mu({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new $A({color:t.backgroundColor.clone()}):null})}};function p$e(t,e){return t&&e!=null&&e>0?new y2({color:Le(t),size:e}):null}d([m({type:b5,json:{write:!0}})],Kl.prototype,"font",null),d([Pr("font")],Kl.prototype,"writeFont",null),d([m({type:y2,json:{write:!0}})],Kl.prototype,"halo",void 0),d([m({...que,json:{default:"center",write:!0}})],Kl.prototype,"horizontalAlignment",void 0),d([m({...Wue,json:{default:1,write:!0}})],Kl.prototype,"lineHeight",void 0),d([m({type:mu,json:{write:!0}})],Kl.prototype,"material",void 0),d([m({type:$A,json:{write:!0}})],Kl.prototype,"background",void 0),d([m(jf)],Kl.prototype,"size",null),d([m({type:String,json:{write:!0}})],Kl.prototype,"text",void 0),d([Si({Text:"text"},{readOnly:!0})],Kl.prototype,"type",void 0),d([m({...Zue,json:{default:"baseline",write:!0}})],Kl.prototype,"verticalAlignment",void 0),Kl=dI=d([J("esri.symbols.TextSymbol3DLayer")],Kl);const Hb=Kl;var K9;let q0=K9=class extends rm{constructor(t){super(t),this.color=Q9.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new K9({color:Le(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([m({type:Lt,nonNullable:!0,json:{type:[js],write:(t,e,i)=>e[i]=t.toArray(Lt.AlphaMode.UNLESS_OPAQUE),default:()=>Q9.clone(),defaultEquals:t=>t.toCss(!0)===Q9.toCss(!0)}})],q0.prototype,"color",void 0),d([Si({Water:"water"},{readOnly:!0})],q0.prototype,"type",void 0),d([m({type:["small","medium","large"],json:{write:!0,default:"medium"}})],q0.prototype,"waterbodySize",void 0),d([m({type:Number,json:{write:!0,default:null}})],q0.prototype,"waveDirection",void 0),d([m({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],q0.prototype,"waveStrength",void 0),q0=K9=d([J("esri.symbols.WaterSymbol3DLayer")],q0);const Q9=new Lt([0,119,190]),vhe=q0;var ez;let Uv=ez=class extends ke{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new ez({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([m({type:String})],Uv.prototype,"name",void 0),d([m({type:String})],Uv.prototype,"styleUrl",void 0),d([m({type:String})],Uv.prototype,"styleName",void 0),d([m({type:zh})],Uv.prototype,"portal",void 0),Uv=ez=d([J("esri.symbols.support.StyleOrigin")],Uv);const RP=Uv;var tz;let B1=tz=class extends ke{constructor(){super(...arguments),this.url=""}clone(){return new tz({url:this.url})}};d([m({type:String})],B1.prototype,"url",void 0),B1=tz=d([J("esri.symbols.support.Thumbnail")],B1);const bhe={icon:D_,object:Aj,line:k3,path:Pj,fill:F3,extrude:Iue,text:Hb,water:vhe},f$e=Ci.ofType({base:rm,key:"type",typeMap:bhe,errorContext:"symbol-layer"});let ef=class extends Ru{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const i=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,r=i&&i.type||Ci;this._set("symbolLayers",new r)}get color(){return null}set color(e){this.constructed&&ye.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){fb(e,this._get("symbolLayers"))}readStyleOrigin(e,i,r){if(e.styleUrl&&e.name){const n=db(e.styleUrl,r);return new RP({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new RP({portal:r&&r.portal||zh.getDefault(),styleName:e.styleName,name:e.name});r&&r.messages&&r.messages.push(new tb("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,i,r,n){if(e.styleUrl&&e.name){let s=vT(e.styleUrl,n);gu(s)&&(s=mg(s)),i.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n&&n.portal&&!fMe(e.portal.restUrl,n.portal.restUrl)?n&&n.messages&&n.messages.push(new tb("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):i.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof rm||e&&bhe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([m({json:{read:!1,write:!1}})],ef.prototype,"color",null),d([m({type:f$e,nonNullable:!0,json:{write:!0}}),Sn(lhe)],ef.prototype,"symbolLayers",null),d([m({type:RP})],ef.prototype,"styleOrigin",void 0),d([yr("styleOrigin")],ef.prototype,"readStyleOrigin",null),d([Pr("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],ef.prototype,"writeStyleOrigin",null),d([m({type:B1,json:{read:!1}})],ef.prototype,"thumbnail",void 0),d([m({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],ef.prototype,"type",void 0),ef=d([J("esri.symbols.Symbol3D")],ef);const uS=ef;let SE=class extends Nt{constructor(e){super(e),this.visible=!0}clone(){}};d([m({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],SE.prototype,"type",void 0),d([m({readOnly:!0})],SE.prototype,"visible",void 0),SE=d([J("esri.symbols.callouts.Callout3D")],SE);const whe=SE;var iz;let pI=iz=class extends Nt{constructor(){super(...arguments),this.color=new Lt("white")}clone(){return new iz({color:Le(this.color)})}};d([m(Bg)],pI.prototype,"color",void 0),pI=iz=d([J("esri.symbols.callouts.LineCallout3DBorder")],pI);const xhe=pI;Object.freeze(Object.defineProperty({__proto__:null,default:xhe},Symbol.toStringTag,{value:"Module"}));var rz;let Z0=rz=class extends whe{constructor(t){super(t),this.type="line",this.color=new Lt([0,0,0,1]),this.size=dp(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new rz({color:Le(this.color),size:this.size,border:Le(this.border)})}};d([Si({line:"line"},{readOnly:!0})],Z0.prototype,"type",void 0),d([m(Bg)],Z0.prototype,"color",void 0),d([m(jf)],Z0.prototype,"size",void 0),d([m({type:xhe,json:{write:!0}})],Z0.prototype,"border",void 0),d([m({readOnly:!0})],Z0.prototype,"visible",null),Z0=rz=d([J("esri.symbols.callouts.LineCallout3D")],Z0);const m$e=Z0;function Oj(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function The(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Oj(t)}function Rj(t){return t.type==="point-3d"||t.type==="label-3d"}function She(t){return t.horizontalAlignment==="center"}const Che={types:{key:"type",base:whe,typeMap:{line:m$e}},json:{write:!0}};var nz;let zx=nz=class extends Nt{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new nz({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([m(jf)],zx.prototype,"screenLength",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0,default:0}})],zx.prototype,"minWorldLength",void 0),d([m({type:Number,json:{write:!0}})],zx.prototype,"maxWorldLength",void 0),zx=nz=d([J("esri.symbols.support.Symbol3DVerticalOffset")],zx);const Ehe=zx;var fI;const Ahe=Ci.ofType({base:null,key:"type",typeMap:{text:Hb}});let X0=fI=class extends uS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Ahe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return The(this)}hasVisibleVerticalOffset(){return Oj(this)}clone(){return new fI({styleOrigin:Le(this.styleOrigin),symbolLayers:Le(this.symbolLayers),thumbnail:Le(this.thumbnail),callout:Le(this.callout),verticalOffset:Le(this.verticalOffset)})}static fromTextSymbol(t){return new fI({symbolLayers:[Hb.fromTextSymbol(t)]})}};d([m({type:Ehe,json:{write:!0}})],X0.prototype,"verticalOffset",void 0),d([m(Che)],X0.prototype,"callout",void 0),d([m({json:{read:!1,write:!1}})],X0.prototype,"styleOrigin",void 0),d([m({type:Ahe})],X0.prototype,"symbolLayers",void 0),d([Si({LabelSymbol3D:"label-3d"},{readOnly:!0})],X0.prototype,"type",void 0),X0=fI=d([J("esri.symbols.LabelSymbol3D")],X0);const T5=X0;var mI;const Phe=Ci.ofType({base:null,key:"type",typeMap:{line:k3,path:Pj}}),g$e=Ci.ofType({base:null,key:"type",typeMap:{line:k3,path:Pj}});let CE=mI=class extends uS{constructor(t){super(t),this.symbolLayers=new Phe,this.type="line-3d"}clone(){return new mI({styleOrigin:Le(this.styleOrigin),symbolLayers:Le(this.symbolLayers),thumbnail:Le(this.thumbnail)})}static fromSimpleLineSymbol(t){return new mI({symbolLayers:[k3.fromSimpleLineSymbol(t)]})}};d([m({type:Phe,json:{type:g$e}})],CE.prototype,"symbolLayers",void 0),d([Si({LineSymbol3D:"line-3d"},{readOnly:!0})],CE.prototype,"type",void 0),CE=mI=d([J("esri.symbols.LineSymbol3D")],CE);const S5=CE;let Y0=class extends Ru{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Y0.prototype,"angle",void 0),d([m({type:["simple-marker","picture-marker"],readOnly:!0})],Y0.prototype,"type",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],Y0.prototype,"xoffset",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],Y0.prototype,"yoffset",void 0),d([m({type:Number,cast:t=>t==="auto"?t:ns(t),json:{write:!0}})],Y0.prototype,"size",void 0),Y0=d([J("esri.symbols.MarkerSymbol")],Y0);const Ohe=Y0;var gI;const Rhe=Ci.ofType({base:null,key:"type",typeMap:{fill:F3}});let EE=gI=class extends uS{constructor(t){super(t),this.symbolLayers=new Rhe,this.type="mesh-3d"}clone(){return new gI({styleOrigin:Le(this.styleOrigin),symbolLayers:Le(this.symbolLayers),thumbnail:Le(this.thumbnail)})}static fromSimpleFillSymbol(t){return new gI({symbolLayers:[F3.fromSimpleFillSymbol(t)]})}};d([m({type:Rhe})],EE.prototype,"symbolLayers",void 0),d([Si({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],EE.prototype,"type",void 0),EE=gI=d([J("esri.symbols.MeshSymbol3D")],EE);const C5=EE;function _$e(t,e,i){return e.imageData?Que({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):Mhe(e.url,i)}function Mhe(t,e){var i;return v$e(e)&&!gu(t)&&((i=e==null?void 0:e.layer)!=null&&i.parsedUrl)?x5(e.layer.parsedUrl.path,"images",t):db(t,e)}function y$e(t,e,i,r){if(nm(t)){const n=hb(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,i&&i.imageData===e.imageData&&i.url&&pb(i.url,e,"url",r)}else pb(t,e,"url",r)}const $he={json:{read:{source:["imageData","url"],reader:_$e},write:{writer(t,e,i,r){y$e(t,e,this.source,r)}}}},Ihe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,i){const r={};return e.imageData&&(r.imageData=e.imageData),e.contentType&&(r.contentType=e.contentType),e.url&&(r.url=Mhe(e.url,i)),r}}}};function v$e(t){var e,i;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((i=t.layer)==null?void 0:i.type)!=="stream")}var sz;let eh=sz=class extends Due{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),i!=null&&(n.width=ns(i)),r!=null&&(n.height=ns(r)),n}clone(){const t=new sz({color:Le(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",Le(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([Si({esriPFS:"picture-fill"},{readOnly:!0})],eh.prototype,"type",void 0),d([m($he)],eh.prototype,"url",void 0),d([m({type:Number,json:{write:!0}})],eh.prototype,"xscale",void 0),d([m({type:Number,json:{write:!0}})],eh.prototype,"yscale",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],eh.prototype,"width",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],eh.prototype,"height",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],eh.prototype,"xoffset",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],eh.prototype,"yoffset",void 0),d([m(Ihe)],eh.prototype,"source",void 0),eh=sz=d([J("esri.symbols.PictureFillSymbol")],eh);const Lhe=eh;var oz;let bd=oz=class extends Ohe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const r={};return t&&(r.url=t),e!=null&&(r.width=ns(e)),i!=null&&(r.height=ns(i)),r}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new oz({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",Le(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([m({json:{write:!1}})],bd.prototype,"color",void 0),d([Si({esriPMS:"picture-marker"},{readOnly:!0})],bd.prototype,"type",void 0),d([m($he)],bd.prototype,"url",void 0),d([m(Ihe)],bd.prototype,"source",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],bd.prototype,"height",void 0),d([yr("height",["height","size"])],bd.prototype,"readHeight",null),d([m({type:Number,cast:ns,json:{write:!0}})],bd.prototype,"width",void 0),d([m({json:{write:!1}})],bd.prototype,"size",void 0),bd=oz=d([J("esri.symbols.PictureMarkerSymbol")],bd);const E5=bd;var zv;const Dhe=Ci.ofType({base:null,key:"type",typeMap:{icon:D_,object:Aj,text:Hb}});let Bv=zv=class extends uS{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Dhe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return The(this)}hasVisibleVerticalOffset(){return Oj(this)}clone(){return new zv({verticalOffset:Le(this.verticalOffset),callout:Le(this.callout),styleOrigin:Le(this.styleOrigin),symbolLayers:Le(this.symbolLayers),thumbnail:Le(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new zv({symbolLayers:[D_.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new zv({symbolLayers:[D_.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var r,n;if(((n=(r=t.data)==null?void 0:r.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const i=t.data.symbol;return new zv(i!=null&&i.callout?{symbolLayers:[D_.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[D_.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new zv({symbolLayers:[Hb.fromTextSymbol(t)]})}};d([m({type:Ehe,json:{write:!0}})],Bv.prototype,"verticalOffset",void 0),d([m(Che)],Bv.prototype,"callout",void 0),d([m({type:Dhe,json:{origins:{"web-scene":{write:!0}}}})],Bv.prototype,"symbolLayers",void 0),d([Si({PointSymbol3D:"point-3d"},{readOnly:!0})],Bv.prototype,"type",void 0),Bv=zv=d([J("esri.symbols.PointSymbol3D")],Bv);const N_=Bv;var AE;const Nhe=Ci.ofType({base:null,key:"type",typeMap:{extrude:Iue,fill:F3,icon:D_,line:k3,object:Aj,text:Hb,water:vhe}});let PE=AE=class extends uS{constructor(t){super(t),this.symbolLayers=new Nhe,this.type="polygon-3d"}clone(){return new AE({styleOrigin:Le(this.styleOrigin),symbolLayers:Le(this.symbolLayers),thumbnail:Le(this.thumbnail)})}static fromJSON(t){const e=new AE;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const i=e.symbolLayers.at(0),r=e.symbolLayers.at(1);!r.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:r.material!=null?r.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new AE({symbolLayers:[F3.fromSimpleFillSymbol(t)]})}};d([m({type:Nhe,json:{write:!0}})],PE.prototype,"symbolLayers",void 0),d([Si({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],PE.prototype,"type",void 0),PE=AE=d([J("esri.symbols.PolygonSymbol3D")],PE);const A5=PE;var az;const e6=new Tu({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let Vv=az=class extends Due{constructor(...t){super(...t),this.color=new Lt([0,0,0,.25]),this.outline=new Vb,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.style=t),e&&(r.outline=e),i&&(r.color=i),r}clone(){return new az({color:Le(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([m()],Vv.prototype,"color",void 0),d([m()],Vv.prototype,"outline",void 0),d([Si({esriSFS:"simple-fill"},{readOnly:!0})],Vv.prototype,"type",void 0),d([m({type:e6.apiValues,json:{read:e6.read,write:e6.write}})],Vv.prototype,"style",void 0),Vv=az=d([J("esri.symbols.SimpleFillSymbol")],Vv);const Mj=Vv;var lz;const t6=new Tu({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let tf=lz=class extends Ohe{constructor(...t){super(...t),this.color=new Lt([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Vb}normalizeCtorArgs(t,e,i,r){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=ns(e)),i&&(n.outline=i),r&&(n.color=r),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new lz({angle:this.angle,color:Le(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};d([m()],tf.prototype,"color",void 0),d([Pr("color")],tf.prototype,"writeColor",null),d([Si({esriSMS:"simple-marker"},{readOnly:!0})],tf.prototype,"type",void 0),d([m()],tf.prototype,"size",void 0),d([m({type:t6.apiValues,json:{read:t6.read,write:t6.write}})],tf.prototype,"style",void 0),d([m({type:String,json:{write:!0}})],tf.prototype,"path",null),d([m({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Vb}},json:{default:null,write:!0}})],tf.prototype,"outline",void 0),tf=lz=d([J("esri.symbols.SimpleMarkerSymbol")],tf);const P5=tf;var cz;let Bn=cz=class extends Ru{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new b5,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,i){if(t&&typeof t!="string")return t;const r={};return t&&(r.text=t),e&&(r.font=e),i&&(r.color=i),r}writeLineWidth(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}castLineWidth(t){return ns(t)}writeLineHeight(t,e,i,r){r&&typeof r!="string"?r.origin:e[i]=t}clone(){return new cz({angle:this.angle,backgroundColor:Le(this.backgroundColor),borderLineColor:Le(this.borderLineColor),borderLineSize:this.borderLineSize,color:Le(this.color),font:this.font&&this.font.clone(),haloColor:Le(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([m({type:Lt,json:{write:!0}})],Bn.prototype,"backgroundColor",void 0),d([m({type:Lt,json:{write:!0}})],Bn.prototype,"borderLineColor",void 0),d([m({type:Number,json:{write:!0},cast:ns})],Bn.prototype,"borderLineSize",void 0),d([m({type:b5,json:{write:!0}})],Bn.prototype,"font",void 0),d([m({...que,json:{write:!0}})],Bn.prototype,"horizontalAlignment",void 0),d([m({type:Boolean,json:{write:!0}})],Bn.prototype,"kerning",void 0),d([m({type:Lt,json:{write:!0}})],Bn.prototype,"haloColor",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],Bn.prototype,"haloSize",void 0),d([m({type:Boolean,json:{write:!0}})],Bn.prototype,"rightToLeft",void 0),d([m({type:Boolean,json:{write:!0}})],Bn.prototype,"rotated",void 0),d([m({type:String,json:{write:!0}})],Bn.prototype,"text",void 0),d([Si({esriTS:"text"},{readOnly:!0})],Bn.prototype,"type",void 0),d([m({...Zue,json:{write:!0}})],Bn.prototype,"verticalAlignment",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],Bn.prototype,"xoffset",void 0),d([m({type:Number,cast:ns,json:{write:!0}})],Bn.prototype,"yoffset",void 0),d([m({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],Bn.prototype,"angle",void 0),d([m({type:Number,json:{write:!0}})],Bn.prototype,"width",void 0),d([m({type:Number})],Bn.prototype,"lineWidth",void 0),d([Pr("lineWidth")],Bn.prototype,"writeLineWidth",null),d([Sn("lineWidth")],Bn.prototype,"castLineWidth",null),d([m(Wue)],Bn.prototype,"lineHeight",void 0),d([Pr("lineHeight")],Bn.prototype,"writeLineHeight",null),Bn=cz=d([J("esri.symbols.TextSymbol")],Bn);const U3=Bn;var uz;let wd=uz=class extends Ru{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:zh.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new uz({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const i=e!=null?e.cache:null,r=i?this._fetchCacheKey:null;if(i!=null){const a=r&&i.get(r);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await Oe(()=>Promise.resolve().then(()=>iQe),void 0,import.meta.url);Ti(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{ye.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(i!=null&&i.set(r,o.clone()),o):null}};d([m({json:{write:!1}})],wd.prototype,"color",void 0),d([m({type:String,json:{write:!0}})],wd.prototype,"styleName",void 0),d([m({type:zh,json:{write:!1}})],wd.prototype,"portal",void 0),d([m({type:String,json:{read:Tj,write:pb}})],wd.prototype,"styleUrl",void 0),d([m({type:B1,json:{read:!1}})],wd.prototype,"thumbnail",void 0),d([m({type:String,json:{write:!0}})],wd.prototype,"name",void 0),d([Si({styleSymbolReference:"web-style"},{readOnly:!0})],wd.prototype,"type",void 0),d([m()],wd.prototype,"_fetchCacheKey",null),wd=uz=d([J("esri.symbols.WebStyleSymbol")],wd);const hS=wd;function O5(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function mb(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const $j={base:Ru,key:"type",typeMap:{"simple-fill":Mj,"picture-fill":Lhe,"picture-marker":E5,"simple-line":Vb,"simple-marker":P5,text:U3,"label-3d":T5,"line-3d":S5,"mesh-3d":C5,"point-3d":N_,"polygon-3d":A5,"web-style":hS,cim:N3},errorContext:"symbol"},p0t={base:Ru,key:"type",typeMap:{"picture-marker":E5,"simple-marker":P5,text:U3,"web-style":hS,cim:N3},errorContext:"symbol"},b$e=Fae({types:$j}),f0t={base:Ru,key:"type",typeMap:{"simple-fill":Mj,"picture-fill":Lhe,"picture-marker":E5,"simple-line":Vb,"simple-marker":P5,text:U3,"line-3d":S5,"mesh-3d":C5,"point-3d":N_,"polygon-3d":A5,"web-style":hS,cim:N3},errorContext:"symbol"},m0t={base:Ru,key:"type",typeMap:{text:U3,"label-3d":T5},errorContext:"symbol"},g0t={base:Ru,key:"type",typeMap:{"line-3d":S5,"mesh-3d":C5,"point-3d":N_,"polygon-3d":A5,"web-style":hS,cim:N3},errorContext:"symbol"},_0t={base:Ru,key:"type",typeMap:{"label-3d":T5},errorContext:"symbol"},y0t=ry($j);var hz;function w$e(t){if(!t)return null;const e={};for(const i in t){const r=CP(t[i]);r&&(e[i]=r)}return Object.keys(e).length!==0?e:null}function x$e(t){if(t==null)return null;const e={};for(const i in t){const r=t[i];r&&(e[i]=r.toJSON())}return Object.keys(e).length!==0?e:null}let Ql=hz=class extends em(Nt){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:xc(),configurable:!0})}normalizeCtorArgs(t,e,i,r){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:i,popupTemplate:r}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new hz({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const i=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",i,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:x$e(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const i={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",i,i,t.action)}}_notifyLayer(t,e,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:i};t==="origin-transform"&&(n.action=r),t==="attributes"&&(n.attributeName=r),this.layer.graphicChanged(n)}};d([m({value:null,json:{read:w$e}})],Ql.prototype,"aggregateGeometries",null),d([m({value:null})],Ql.prototype,"attributes",null),d([m({value:null,types:GG,json:{read:CP}})],Ql.prototype,"geometry",null),d([m({type:Boolean})],Ql.prototype,"isAggregate",void 0),d([m({clonable:"reference"})],Ql.prototype,"layer",void 0),d([m({type:_Re})],Ql.prototype,"popupTemplate",void 0),d([m({clonable:"reference"})],Ql.prototype,"sourceLayer",void 0),d([m({value:null,types:$j})],Ql.prototype,"symbol",null),d([m({type:Boolean,value:!0})],Ql.prototype,"visible",null),Ql=hz=d([J("esri.Graphic")],Ql),function(t){t.generateUID=xc}(Ql||(Ql={}));const gb=Ql;var dz;let J0=dz=class extends Nt{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new dz({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function i6(){return{enabled:!this.camera}}d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:i6}}}}})],J0.prototype,"rotation",void 0),d([Sn("rotation")],J0.prototype,"castRotation",null),d([m({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:i6}}}}})],J0.prototype,"scale",void 0),d([m({types:GG,json:{read:CP,write:!0,origins:{"web-scene":{read:CP,write:{overridePolicy:i6}}}}})],J0.prototype,"targetGeometry",void 0),d([m({type:Fh,json:{write:!0}})],J0.prototype,"camera",void 0),J0=dz=d([J("esri.Viewpoint")],J0);const pp=J0;function R5(t){return typeof t=="string"?document.getElementById(t):t??null}function Fhe(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function sY(t,e){const i=e.parentNode;i&&i.insertBefore(t,e)}function oY(t,e){for(;;){const i=t.firstChild;if(!i)break;e.appendChild(i)}}function Pe(t,e,i={}){return Ij(t,e,i,khe)}function Bh(t,e,i={}){return Ij(t,e,i,Uhe)}function Ij(t,e,i={},r){let n=null;const s=i.once?(o,a)=>{r(o)&&(Qr(n),e(o,a))}:(o,a)=>{r(o)&&e(o,a)};if(n=aCe(t,s,i.sync,i.equals),i.initial){const o=t();s(o,o)}return n}function $l(t,e,i,r={}){let n=null,s=null,o=null;function a(){var u;n&&s&&(s.remove(),(u=r.onListenerRemove)==null||u.call(r,n),n=null,s=null)}function l(u){r.once&&r.once&&Qr(o),i(u)}const c=Pe(t,(u,p)=>{var f;a(),KN(u)&&(n=u,s=E3(u,e,l),(f=r.onListenerAdd)==null||f.call(r,u))},{sync:r.sync,initial:!0});return o=il(()=>{c.remove(),a()}),o}function MP(t,e){return T$e(t,Uhe,e)}function T$e(t,e,i){if(Gs(i))return Promise.reject(Qi());const r=t();if(e!=null&&e(r))return Promise.resolve(r);let n=null;function s(){n=Qr(n)}return new Promise((o,a)=>{n=aT([Ca(i,()=>{s(),a(Qi())}),Ij(t,l=>{s(),o(l)},{sync:!1,once:!0},e??khe)])})}function khe(t){return!0}function Uhe(t){return!!t}const gr={sync:!0},ar={initial:!0},qn={sync:!0,initial:!0};let pz=class{constructor(e=i=>i.values().next().value){this._peeker=e,this._observable=new h5,this._items=new Set}get length(){return hi(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return hi(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const i=this.length;return this._items.forEach(r=>{e(r)||this._items.delete(r)}),i!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){hi(this._observable),yield*this._items}};const S$e={statsWorker:()=>Oe(()=>import("./statsWorker-4b4c6e1a.js"),["./statsWorker-4b4c6e1a.js","./heatmapUtils-fe1f2bfa.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js"],import.meta.url),geometryEngineWorker:()=>Oe(()=>import("./geometryEngineWorker-b794cc98.js"),["./geometryEngineWorker-b794cc98.js","./geometryEngineJSON-f5a6f910.js","./geometryEngineBase-8afca563.js","./json-48e3ea08.js"],import.meta.url),CSVSourceWorker:()=>Oe(()=>import("./CSVSourceWorker-206a0a30.js"),["./CSVSourceWorker-206a0a30.js","./json-48e3ea08.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FieldsIndex-06c42f48.js","./number-0a517102.js","./clientSideDefaults-76ae825d.js","./defaultsJSON-59981e75.js"],import.meta.url),EdgeProcessingWorker:()=>Oe(()=>import("./EdgeProcessingWorker-2459172a.js"),[],import.meta.url),ElevationSamplerWorker:()=>Oe(()=>import("./ElevationSamplerWorker-bebf5c83.js"),["./ElevationSamplerWorker-bebf5c83.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./georeference-840449ac.js","./MeshGeoreferencedRelativeVertexSpace-01dadcff.js","./MeshLocalVertexSpace-e2febaf3.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>Oe(()=>import("./FeatureServiceSnappingSourceWorker-14fbea07.js"),["./FeatureServiceSnappingSourceWorker-14fbea07.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FieldsIndex-06c42f48.js","./Query-cdee9722.js","./ElevationInfo-f714f054.js","./symbologySnappingCandidates-cf61961a.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./query-af06498b.js","./queryZScale-2a8227ea.js"],import.meta.url),GeoJSONSourceWorker:()=>Oe(()=>import("./GeoJSONSourceWorker-cd72b9f8.js"),["./GeoJSONSourceWorker-cd72b9f8.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FieldsIndex-06c42f48.js","./geojson-5528191c.js","./clientSideDefaults-76ae825d.js","./defaultsJSON-59981e75.js","./sourceUtils-9e4b32d5.js"],import.meta.url),LercWorker:()=>Oe(()=>import("./LercWorker-616e226f.js"),[],import.meta.url),MemorySourceWorker:()=>Oe(()=>import("./MemorySourceWorker-9a151b23.js"),["./MemorySourceWorker-9a151b23.js","./objectIdUtils-789e911a.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FieldsIndex-06c42f48.js","./clientSideDefaults-76ae825d.js","./defaultsJSON-59981e75.js","./sourceUtils-9e4b32d5.js"],import.meta.url),PBFDecoderWorker:()=>Oe(()=>import("./PBFDecoderWorker-5e593e26.js"),["./PBFDecoderWorker-5e593e26.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js"],import.meta.url),Pipeline:()=>Oe(()=>import("./Pipeline-2bd66142.js").then(t=>t.P),["./Pipeline-2bd66142.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FieldsIndex-06c42f48.js","./StreamFeatureManager-140d5c90.js","./quickselect-70c375a5.js","./diffUtils-3c37f4e6.js","./arcadeTimeUtils-cf7e2dfd.js","./centroid-8e8cfa47.js","./ogcFeatureUtils-81a58dfc.js","./geojson-5528191c.js","./clientSideDefaults-76ae825d.js","./defaultsJSON-59981e75.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./Query-cdee9722.js","./createConnection-cea53b95.js","./definitions-bc94d273.js","./TileInfoView-b5d908d2.js","./number-e491b09e.js","./geohashUtils-77d8429b.js"],import.meta.url),PointCloudWorker:()=>Oe(()=>import("./PointCloudWorker-40d2ad6c.js"),["./PointCloudWorker-40d2ad6c.js","./PointCloudWorkerUtil-2680b882.js","./PointCloudUniqueValueRenderer-1def1441.js","./ColorStop-0686847d.js","./I3SBinaryReader-2204e87b.js"],import.meta.url),RasterWorker:()=>Oe(()=>import("./RasterWorker-369a8e22.js"),["./RasterWorker-369a8e22.js","./dataUtils-1f09f6c8.js","./colorUtils-c0f43caf.js","./utils-0a7ba8ea.js","./colorRamps-54548a9c.js","./rasterProjectionHelper-0467928e.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>Oe(()=>import("./SceneLayerSnappingSourceWorker-74c2cd3f.js"),[],import.meta.url),SceneLayerWorker:()=>Oe(()=>import("./SceneLayerWorker-3285c2a1.js").then(t=>t.a),["./SceneLayerWorker-3285c2a1.js","./MeshGeoreferencedRelativeVertexSpace-01dadcff.js","./MeshLocalVertexSpace-e2febaf3.js","./I3SNode-cc10b91f.js"],import.meta.url),WFSSourceWorker:()=>Oe(()=>import("./WFSSourceWorker-b58dd7ba.js"),["./WFSSourceWorker-b58dd7ba.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FieldsIndex-06c42f48.js","./geojson-5528191c.js","./sourceUtils-9e4b32d5.js","./wfsUtils-e5682077.js","./xmlUtils-444cb4c0.js"],import.meta.url),WorkerTileHandler:()=>Oe(()=>import("./WorkerTileHandler-133167f9.js"),["./WorkerTileHandler-133167f9.js","./TileClipper-ae6eca9e.js","./StyleRepository-e2eb595e.js","./colorUtils-c0f43caf.js","./definitions-bc94d273.js","./Rect-98da58d6.js","./pbf-18997bde.js","./TurboLine-659445c1.js","./BidiEngine-9a40f2f4.js"],import.meta.url)};var Xo;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Xo||(Xo={}));let C$e=0;function zhe(){return C$e++}function E$e(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function $P(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function Lj(t,e,i,r){if(e.type===Xo.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Xo.INVOKE&&e.type!==Xo.RESPONSE)return void t.postMessage(e);let n;if(E$e(i)?(n=aY(i.transferList),e.data=i.result):(n=aY(r),e.data=i),n){if(ge("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Xo.INVOKE:throw o;case Xo.RESPONSE:return void Lj(t,{type:Xo.RESPONSE,jobId:e.jobId,error:$P(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function IP(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function aY(t){if(!t||!t.length)return null;if(ge("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(i=>!A$e(i));return e.length?e:null}function A$e(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:lY,ABORT:cY,INVOKE:uY,RESPONSE:cC,OPEN_PORT:hY,ON:P$e}=Xo,O$e=2;let R$e=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Xo.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},cy=class Bx{static connect(e){const i=new MessageChannel;let r;r=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new Bx(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=n),Bx.clients.set(n,r),i.port2}static loadWorker(e){const i=S$e[e];return i?i():Promise.resolve(null)}constructor(e,i,r){this._port=e,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new R$e(n=>this._onInvokeMessage(n)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:lY}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,i,r){const n=r==null?void 0:r.signal,s=r==null?void 0:r.transferList;if(!this._port)return Promise.reject(new ce("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:i}));const o=zhe();return new Promise((a,l)=>{if(Gs(n))return this._processWork(),void l(Qi());const c=Ca(n,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Qr(p.abortHandle),this._post({type:cY,jobId:o}),l(Qi()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:uY,jobId:o,methodName:e,abortable:n!=null},i,s)})}on(e,i){const r=new MessageChannel;function n(s){i(s.data)}return this._port.postMessage({type:Xo.ON,eventType:e,port:r.port2},[r.port2]),r.port1.addEventListener("message",n),r.port1.start(),{remove(){r.port1.postMessage({type:Xo.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",n)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:hY,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=O$e)return;const e=this._getNextJob();if(!e)return;const{methodName:i,data:r,invokeOptions:n,resolver:s}=e;this.invoke(i,r,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{Qr(e.abortHandle),e.reject(Qi(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const i=IP(e);if(i)switch(i.type){case cC:this._onResponseMessage(i);break;case uY:this._invokeQueue.push(i);break;case cY:this._onAbortMessage(i);break;case lY:this._onCloseMessage();break;case hY:this._onOpenPortMessage(i);break;case P$e:this._onOnMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),i.delete(r))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&Bx.clients.get(this)===e&&e.destroy(),Bx.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[i];try{if(!u&&i&&i.includes(".")){const p=i.split(".");for(let f=0;f<p.length-1;f++)c=c[p[f]],u=c[p[f+1]]}if(typeof u!="function")throw new TypeError(`${i} is not a function`);l=u.call(c,n,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:cC,jobId:r,error:$P(p)})}Pu(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:cC,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),ms(p)||this._post({type:cC,jobId:r,error:$P(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:cC,jobId:r},l)}_onOpenPortMessage(e){new Bx(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:i}=e,r=this._client.on(e.eventType,s=>{i.postMessage(s)}),n=E3(e.port,"message",s=>{const o=IP(s);(o==null?void 0:o.type)===Xo.CLOSE&&(n.remove(),r.remove(),i.close())})}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs;if(!s.has(i))return;const o=s.get(i);s.delete(i),this._processWork(),Qr(o.abortHandle),r?o.reject(ce.fromJSON(JSON.parse(r))):o.resolve(n)}_post(e,i,r){return Lj(this._port,e,i,r)}};cy.kernelInfo={buildDate:che,fullVersion:Sj,revision:uhe},cy.clients=new Map;let M$e=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new pz}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,i){return new Promise((r,n)=>{let s=!0;const o=a=>{Ti(i.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Pu(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new cy(c,i,()=>this._ongoingJobsQueue.pop()??null),o(r),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new cy(l,i,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(e,i,r){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,i,r))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Qi(`Worker closing, aborting job calling '${e.methodName}'`));for(const i of this._clientPromises)i.then(r=>r==null?void 0:r.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,i,r){let n;Array.isArray(r)?(ye.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:r}):n=r;const s=sa();this._ongoingJobsQueue.push({methodName:e,data:i,invokeOptions:n,resolver:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return s.promise}on(e,i){return Promise.all(this._clientPromises).then(()=>aT(this._clients.map(r=>r.on(e,i))))}openPorts(){return new Promise(e=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(i[n]=s.openPort()),--r==0&&e(i)})})}get test(){return{numClients:this._clients.length}}};const $$e=ye.getLogger("esri.assets");function I$e(t,e){return ps(dr(t),e)}function dr(t){if(!Er.assetsPath)throw $$e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new ce("assets:path-not-set","config.assetsPath is not set");return x5(Er.assetsPath,t)}const Bhe=ye.getLogger("esri.intl.substitute");function x0t(t,e,i={}){const{format:r={}}=i;return JN(t,n=>L$e(n,e,r))}function L$e(t,e,i){let r,n;const s=t.indexOf(":");if(s===-1?r=t.trim():(r=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!r)return"";const o=S3(r,e);if(o==null)return"";const a=(n?i==null?void 0:i[n]:null)??(i==null?void 0:i[r]);return a?D$e(o,a):n?N$e(o,n):Dj(o)}function D$e(t,e){switch(e.type){case"date":return ay(t,e.intlOptions);case"number":return gT(t,e.intlOptions);default:return Bhe.warn("missing format descriptor for key {key}"),Dj(t)}}function N$e(t,e){switch(e.toLowerCase()){case"dateformat":return ay(t);case"numberformat":return gT(t);default:return Bhe.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?ay(t):/^numberformat/i.test(e)?gT(t):Dj(t)}}function Dj(t){switch(typeof t){case"string":return t;case"number":return gT(t);case"boolean":return""+t;default:return t instanceof Date?ay(t):""}}const dY=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,F$e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function pY(t){return t in F$e}const OE=[],V2=new Map;function fY(t){for(const e of V2.keys())Ghe(t.pattern,e)&&V2.delete(e)}function k$e(t){return OE.includes(t)||(fY(t),OE.unshift(t)),{remove(){const e=OE.indexOf(t);e>-1&&(OE.splice(e,1),fY(t))}}}async function Vhe(t){const e=ip();V2.has(t)||V2.set(t,z$e(t,e));const i=V2.get(t);return i&&await B$e.add(i),i}function U$e(t){if(!dY.test(t))return null;const e=dY.exec(t);if(e===null)return null;const[,i,r]=e,n=i+(r?"-"+r.toUpperCase():"");return pY(n)?n:pY(i)?i:null}async function z$e(t,e){const i=[];for(const r of OE)if(Ghe(r.pattern,t))try{return await r.fetchMessageBundle(t,e)}catch(n){i.push(n)}throw i.length?new ce("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:i}):new ce("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function Ghe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}ZG(()=>{V2.clear()});const B$e=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=sa())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function V$e(t,e,i,r){const n=e.exec(i);if(!n)throw new ce("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=U$e(r),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await mY(t(c))}catch(p){if(c===l)throw new ce("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{u=await mY(t(l))}catch(f){throw new ce("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:f})}}return u}async function mY(t){if(gY.fetchBundleAsset!=null)return gY.fetchBundleAsset(t);const e=await ps(t,{responseType:"text"});return JSON.parse(e.data)}let G$e=class{constructor({base:e="",pattern:i,location:r=new URL(window.location.href)}){let n;n=typeof r=="string"?s=>new URL(s,new URL(r,window.location.href)).href:r instanceof URL?s=>new URL(s,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,i){return V$e(this.getAssetUrl,this.matcher,e,i)}};function j$e(t){return new G$e(t)}const gY={};k$e(j$e({pattern:"esri/",location:dr}));const H$e={};function W$e(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=H$e.baseUrl),e}let q$e=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>e[i](...r)})}},_I=class{constructor(){this._dispatcher=new q$e,this._workerPostMessage({type:Xo.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){lT(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,i,r){this._dispatcher.addEventListener(e,i,r)}removeEventListener(e,i,r){this._dispatcher.removeEventListener(e,i,r)}_workerPostMessage(e){lT(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const i=IP(e);if(i&&i.type===Xo.OPEN){const{modulePath:r,jobId:n}=i;let s=await cy.loadWorker(r);s||(s=await Oe(()=>import(r),[],import.meta.url));const o=cy.connect(s);this._workerPostMessage({type:Xo.OPENED,jobId:n,data:o})}}};const fz=ye.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:Z$e}=Xo,X$e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let _R,yR;const _Y="Failed to create Worker. Fallback to execute module in main thread";async function Y$e(){if(!ge("esri-workers")||(ge("mozilla"),0))return yY(new _I);if(!_R&&!yR)try{const e=X$e.split('"{CONFIGURATION}"').join(`'${J$e()}'`);_R=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){yR=e||{}}let t;if(_R)try{t=new Worker(_R,{name:"esri-worker-"+K$e++})}catch{fz.warn(_Y,yR),t=new _I}else fz.warn(_Y,yR),t=new _I;return yY(t)}async function yY(t){return new Promise(e=>{function i(n){const s=IP(n);s&&s.type===Z$e&&(t.removeEventListener("message",i),t.removeEventListener("error",r),e(t))}function r(n){n.preventDefault(),t.removeEventListener("message",i),t.removeEventListener("error",r),fz.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new _I).addEventListener("message",i),t.addEventListener("error",r)}t.addEventListener("message",i),t.addEventListener("error",r)})}function J$e(){let t;if(Er.default!=null){const n={...Er};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(Er));t.assetsPath=cu(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?cu(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=ip(),t.has={"esri-csp-restrictions":ge("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":ge("esri-2d-update-debug"),"esri-2d-log-updating":ge("esri-2d-log-updating"),"featurelayer-pbf":ge("featurelayer-pbf"),"featurelayer-simplify-thresholds":ge("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":ge("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":ge("featurelayer-simplify-mobile-factor"),"esri-atomics":ge("esri-atomics"),"esri-shared-array-buffer":ge("esri-shared-array-buffer"),"esri-tiles-debug":ge("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":ge("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":ge("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":ge("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=cu(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=cu(t.workers.workerPath):t.workers.workerPath=cu(dr("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Er.workers.loaderConfig,i=W$e({baseUrl:e==null?void 0:e.baseUrl,locale:ip(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:i,kernelInfo:{buildDate:che,fullVersion:Sj,revision:uhe}})}let K$e=0;const{ABORT:vY,INVOKE:Q$e,OPEN:eIe,OPENED:tIe,RESPONSE:uC}=Xo;let iIe=class jhe{static async create(e){const i=await Y$e();return new jhe(i,e)}constructor(e,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=i,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",r=>{r.preventDefault(),ye.getLogger("esri.core.workers.WorkerOwner").error(r)})}terminate(){this.worker.terminate()}async open(e,i={}){const{signal:r}=i,n=zhe();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:oG(r,()=>{this._outJobs.delete(n),this._post({type:vY,jobId:n})})};this._outJobs.set(n,a),this._post({type:eIe,jobId:n,modulePath:e})})}_onMessage(e){const i=IP(e);if(i)switch(i.type){case tIe:this._onOpenedMessage(i);break;case uC:this._onResponseMessage(i);break;case vY:this._onAbortMessage(i);break;case Q$e:this._onInvokeMessage(i)}}_onAbortMessage(e){const i=this._inJobs,r=e.jobId,n=i.get(r);n&&(n.controller&&n.controller.abort(),i.delete(r))}_onInvokeMessage(e){const{methodName:i,jobId:r,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=FMe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(u){return void this._post({type:uC,jobId:r,error:$P(u)})}Pu(c)?(a.set(r,{controller:o,promise:c}),c.then(u=>{a.has(r)&&(a.delete(r),this._post({type:uC,jobId:r},u))},u=>{a.has(r)&&(a.delete(r),u||(u={message:"Error encountered at method"+i}),ms(u)||this._post({type:uC,jobId:r,error:$P(u||{message:`Error encountered at method ${i}`})}))})):this._post({type:uC,jobId:r},c)}_onOpenedMessage(e){const{jobId:i,data:r}=e,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Qr(n.abortHandle),n.resolve(r))}_onResponseMessage(e){const{jobId:i,error:r,data:n}=e,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Qr(s.abortHandle),r?s.reject(ce.fromJSON(JSON.parse(r))):s.resolve(n))}_post(e,i,r){return Lj(this.worker,e,i,r)}};const bY=ge("host-browser")?Math.min(navigator.hardwareConcurrency-1,ge("workers-pool-size")):0;let O1=ge("esri-mobile")?Math.min(bY,3):bY;O1||(O1=ge("safari")&&ge("mac")?7:2);let wY=0;const yI=[];function rIe(){Hhe()}async function vR(t,e){const i=new M$e;return await i.open(t,e),i}async function nIe(t,e={}){if(typeof t!="string")throw new ce("workers:undefined-module","modulePath is missing");let i=e.strategy||"distributed";if(ge("host-webworker")&&!ge("esri-workers")&&(i="local"),i==="local"){let r=await cy.loadWorker(t);r||(r=await Oe(()=>import(t),[],import.meta.url)),Ti(e.signal);const n=e.client||r;return vR([cy.connect(r)],{...e,client:n})}if(await Hhe(),Ti(e.signal),i==="dedicated"){const r=wY++%O1;return vR([await yI[r].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const r=Math.min(e.maxNumWorkers,O1);if(r<O1){const n=new Array(r);for(let s=0;s<r;++s){const o=wY++%O1;n[s]=yI[o].open(t,e)}return vR(n,e)}}return vR(yI.map(r=>r.open(t,e)),e)}let bR=null;async function Hhe(){if(bR)return bR;new AbortController;const t=[];for(let e=0;e<O1;e++){const i=iIe.create(e).then(r=>(yI[e]=r,r));t.push(i)}return bR=Promise.all(t),bR}let Lf=class extends ke{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new an,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,i,r={}){return this._installWatch(e,i,r,Pe)}addWhen(e,i,r={}){return this._installWatch(e,i,r,Bh)}addOnCollectionChange(e,i,{initial:r=!1,final:n=!1}={}){const s=++this._handleId;return this._handles.add([$l(e,"after-changes",this._createSyncUpdatingCallback(),gr),$l(e,"change",i,{onListenerAdd:r?o=>i({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>i({added:[],removed:o.toArray()}):void 0})],s),il(()=>this._handles.remove(s))}addPromise(e){if(e==null)return e;const i=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(wR)||this._set("updating",!1))}},i),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this._handles.remove(i);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,i,r={},n){const s=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,i,r);return this._handles.add(o,s),il(()=>this._handles.remove(s))}_installSyncUpdatingWatch(e,i){const r=this._createSyncUpdatingCallback(),n=Pe(e,r,{sync:!0,equals:()=>!1});return this._handles.add(n,i),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(wR),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(A3(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(wR))}),wR)}}};d([m({readOnly:!0})],Lf.prototype,"updating",void 0),Lf=d([J("esri.core.support.WatchUpdatingTracking")],Lf);const wR=-42,Nj=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new an,this._updatingHandles=new Lf}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return d([m({readOnly:!0})],e.prototype,"handles",null),d([m({readOnly:!0})],e.prototype,"updatingHandles",null),e=d([J("esri.core.HandleOwner")],e),e};let LP=class extends Nj(ke){};LP=d([J("esri.core.HandleOwner")],LP);let IA=class extends Nj(Ci){constructor(e){super(e),this.handles.add([this.on("before-add",i=>{i.item==null&&i.preventDefault()}),this.on("after-add",i=>this._own(i.item)),this.on("after-remove",i=>this._release(i.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(Ci.ofType(this.itemType.Type))(e):new Ci(e)}};function mz(t,e){return{type:t,cast:lhe,set(i){const r=fb(i,this._get(e),t);r.owner=this,this._set(e,r)}}}d([m()],IA.prototype,"owner",null),IA=d([J("esri.core.support.OwningCollection")],IA);var RE;const iD=Ou()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),Whe=iD.jsonValues.slice();gP(Whe,"orthometric");const LA=Ou()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let xd=RE=class extends Nt{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,i){return iD.write(t,e,i)}readHeightModel(t,e,i){return iD.read(t)||(i&&i.messages&&i.messages.push(sIe(t,{context:i})),null)}readHeightUnit(t,e,i){return LA.read(t)||(i&&i.messages&&i.messages.push(xY(t,{context:i})),null)}readHeightUnitService(t,e,i){return xle(t)||LA.read(t)||(i&&i.messages&&i.messages.push(xY(t,{context:i})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new RE({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const i=aAe(e);return new RE({heightModel:t.heightModel,heightUnit:i,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new RE;return e.read(t,{origin:"web-scene"}),e}};function xY(t,e){return new tb("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function sIe(t,e){return new tb("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([m({type:iD.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Whe,default:"ellipsoidal"}}}})],xd.prototype,"heightModel",void 0),d([Pr("web-scene","heightModel")],xd.prototype,"writeHeightModel",null),d([yr(["web-scene","service"],"heightModel")],xd.prototype,"readHeightModel",null),d([m({type:LA.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:LA.jsonValues,write:LA.write}}}})],xd.prototype,"heightUnit",void 0),d([yr("web-scene","heightUnit")],xd.prototype,"readHeightUnit",null),d([yr("service","heightUnit")],xd.prototype,"readHeightUnitService",null),d([m({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],xd.prototype,"vertCRS",void 0),d([yr("service","vertCRS",["vertCRS","ellipsoid","geoid"])],xd.prototype,"readVertCRS",null),xd=RE=d([J("esri.geometry.HeightModelInfo")],xd);const z3=xd;function Qn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sm(t,e,i,r,n,s,o,a,l,c,u,p,f,y,v,b,x){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=p,t[11]=f,t[12]=y,t[13]=v,t[14]=b,t[15]=x,t}function Vh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Cc(t,e){if(t===e){const i=e[1],r=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function dS(t,e){return fo(t,e)||Vh(t),t}function fo(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=e[9],f=e[10],y=e[11],v=e[12],b=e[13],x=e[14],S=e[15],P=i*a-r*o,C=i*l-n*o,R=i*c-s*o,N=r*l-n*a,$=r*c-s*a,k=n*c-s*l,B=u*b-p*v,W=u*x-f*v,Z=u*S-y*v,K=p*x-f*b,X=p*S-y*b,ae=f*S-y*x;let re=P*ae-C*X+R*K+N*Z-$*W+k*B;return re?(re=1/re,t[0]=(a*ae-l*X+c*K)*re,t[1]=(n*X-r*ae-s*K)*re,t[2]=(b*k-x*$+S*N)*re,t[3]=(f*$-p*k-y*N)*re,t[4]=(l*Z-o*ae-c*W)*re,t[5]=(i*ae-n*Z+s*W)*re,t[6]=(x*R-v*k-S*C)*re,t[7]=(u*k-f*R+y*C)*re,t[8]=(o*X-a*Z+c*B)*re,t[9]=(r*Z-i*X-s*B)*re,t[10]=(v*$-b*R+S*P)*re,t[11]=(p*R-u*$-y*P)*re,t[12]=(a*W-o*K-l*B)*re,t[13]=(i*K-r*W+n*B)*re,t[14]=(b*C-v*N-x*P)*re,t[15]=(u*N-p*C+f*P)*re,t):null}function oIe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=e[9],f=e[10],y=e[11],v=e[12],b=e[13],x=e[14],S=e[15];return t[0]=a*(f*S-y*x)-p*(l*S-c*x)+b*(l*y-c*f),t[1]=-(r*(f*S-y*x)-p*(n*S-s*x)+b*(n*y-s*f)),t[2]=r*(l*S-c*x)-a*(n*S-s*x)+b*(n*c-s*l),t[3]=-(r*(l*y-c*f)-a*(n*y-s*f)+p*(n*c-s*l)),t[4]=-(o*(f*S-y*x)-u*(l*S-c*x)+v*(l*y-c*f)),t[5]=i*(f*S-y*x)-u*(n*S-s*x)+v*(n*y-s*f),t[6]=-(i*(l*S-c*x)-o*(n*S-s*x)+v*(n*c-s*l)),t[7]=i*(l*y-c*f)-o*(n*y-s*f)+u*(n*c-s*l),t[8]=o*(p*S-y*b)-u*(a*S-c*b)+v*(a*y-c*p),t[9]=-(i*(p*S-y*b)-u*(r*S-s*b)+v*(r*y-s*p)),t[10]=i*(a*S-c*b)-o*(r*S-s*b)+v*(r*c-s*a),t[11]=-(i*(a*y-c*p)-o*(r*y-s*p)+u*(r*c-s*a)),t[12]=-(o*(p*x-f*b)-u*(a*x-l*b)+v*(a*f-l*p)),t[13]=i*(p*x-f*b)-u*(r*x-n*b)+v*(r*f-n*p),t[14]=-(i*(a*x-l*b)-o*(r*x-n*b)+v*(r*l-n*a)),t[15]=i*(a*f-l*p)-o*(r*f-n*p)+u*(r*l-n*a),t}function aIe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],p=t[10],f=t[11],y=t[12],v=t[13],b=t[14],x=t[15];return(e*o-i*s)*(p*x-f*b)-(e*a-r*s)*(u*x-f*v)+(e*l-n*s)*(u*b-p*v)+(i*a-r*o)*(c*x-f*y)-(i*l-n*o)*(c*b-p*y)+(r*l-n*a)*(c*v-u*y)}function Cr(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=e[8],f=e[9],y=e[10],v=e[11],b=e[12],x=e[13],S=e[14],P=e[15];let C=i[0],R=i[1],N=i[2],$=i[3];return t[0]=C*r+R*a+N*p+$*b,t[1]=C*n+R*l+N*f+$*x,t[2]=C*s+R*c+N*y+$*S,t[3]=C*o+R*u+N*v+$*P,C=i[4],R=i[5],N=i[6],$=i[7],t[4]=C*r+R*a+N*p+$*b,t[5]=C*n+R*l+N*f+$*x,t[6]=C*s+R*c+N*y+$*S,t[7]=C*o+R*u+N*v+$*P,C=i[8],R=i[9],N=i[10],$=i[11],t[8]=C*r+R*a+N*p+$*b,t[9]=C*n+R*l+N*f+$*x,t[10]=C*s+R*c+N*y+$*S,t[11]=C*o+R*u+N*v+$*P,C=i[12],R=i[13],N=i[14],$=i[15],t[12]=C*r+R*a+N*p+$*b,t[13]=C*n+R*l+N*f+$*x,t[14]=C*s+R*c+N*y+$*S,t[15]=C*o+R*u+N*v+$*P,t}function Dl(t,e,i){const r=i[0],n=i[1],s=i[2];if(e===t)t[12]=e[0]*r+e[4]*n+e[8]*s+e[12],t[13]=e[1]*r+e[5]*n+e[9]*s+e[13],t[14]=e[2]*r+e[6]*n+e[10]*s+e[14],t[15]=e[3]*r+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],p=e[5],f=e[6],y=e[7],v=e[8],b=e[9],x=e[10],S=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=p,t[6]=f,t[7]=y,t[8]=v,t[9]=b,t[10]=x,t[11]=S,t[12]=o*r+u*n+v*s+e[12],t[13]=a*r+p*n+b*s+e[13],t[14]=l*r+f*n+x*s+e[14],t[15]=c*r+y*n+S*s+e[15]}return t}function M5(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function vc(t,e,i,r){let n,s,o,a,l,c,u,p,f,y,v,b,x,S,P,C,R,N,$,k,B,W,Z,K,X=r[0],ae=r[1],re=r[2],ee=Math.sqrt(X*X+ae*ae+re*re);return ee<ol()?null:(ee=1/ee,X*=ee,ae*=ee,re*=ee,n=Math.sin(i),s=Math.cos(i),o=1-s,a=e[0],l=e[1],c=e[2],u=e[3],p=e[4],f=e[5],y=e[6],v=e[7],b=e[8],x=e[9],S=e[10],P=e[11],C=X*X*o+s,R=ae*X*o+re*n,N=re*X*o-ae*n,$=X*ae*o-re*n,k=ae*ae*o+s,B=re*ae*o+X*n,W=X*re*o+ae*n,Z=ae*re*o-X*n,K=re*re*o+s,t[0]=a*C+p*R+b*N,t[1]=l*C+f*R+x*N,t[2]=c*C+y*R+S*N,t[3]=u*C+v*R+P*N,t[4]=a*$+p*k+b*B,t[5]=l*$+f*k+x*B,t[6]=c*$+y*k+S*B,t[7]=u*$+v*k+P*B,t[8]=a*W+p*Z+b*K,t[9]=l*W+f*Z+x*K,t[10]=c*W+y*Z+S*K,t[11]=u*W+v*Z+P*K,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function bT(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],p=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*r,t[5]=o*n+u*r,t[6]=a*n+p*r,t[7]=l*n+f*r,t[8]=c*n-s*r,t[9]=u*n-o*r,t[10]=p*n-a*r,t[11]=f*n-l*r,t}function $5(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],p=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*r,t[1]=o*n-u*r,t[2]=a*n-p*r,t[3]=l*n-f*r,t[8]=s*r+c*n,t[9]=o*r+u*n,t[10]=a*r+p*n,t[11]=l*r+f*n,t}function wT(t,e,i){const r=Math.sin(i),n=Math.cos(i),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],p=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*r,t[1]=o*n+u*r,t[2]=a*n+p*r,t[3]=l*n+f*r,t[4]=c*n-s*r,t[5]=u*n-o*r,t[6]=p*n-a*r,t[7]=f*n-l*r,t}function B3(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function lIe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Su(t,e,i){if(e===0)return Vh(t);let r,n,s,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<ol()?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*r,t[2]=l*o*s-a*r,t[3]=0,t[4]=o*a*s-l*r,t[5]=a*a*s+n,t[6]=l*a*s+o*r,t[7]=0,t[8]=o*l*s+a*r,t[9]=a*l*s-o*r,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function qhe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function cIe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zhe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xhe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=r+r,l=n+n,c=s+s,u=r*a,p=r*l,f=r*c,y=n*l,v=n*c,b=s*c,x=o*a,S=o*l,P=o*c;return t[0]=1-(y+b),t[1]=p+P,t[2]=f-S,t[3]=0,t[4]=p-P,t[5]=1-(u+b),t[6]=v+x,t[7]=0,t[8]=f+S,t[9]=v-x,t[10]=1-(u+y),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function uIe(t,e){const i=hIe,r=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=r*r+n*n+s*s+o*o;return p>0?(i[0]=2*(a*o+u*r+l*s-c*n)/p,i[1]=2*(l*o+u*n+c*r-a*s)/p,i[2]=2*(c*o+u*s+a*n-l*r)/p):(i[0]=2*(a*o+u*r+l*s-c*n),i[1]=2*(l*o+u*n+c*r-a*s),i[2]=2*(c*o+u*s+a*n-l*r)),Xhe(t,e,i),t}const hIe=I();function gz(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Yhe(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(i*i+r*r+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function dIe(t,e){const i=e[0]+e[5]+e[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function pIe(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,u=o+o,p=n*l,f=n*c,y=n*u,v=s*c,b=s*u,x=o*u,S=a*l,P=a*c,C=a*u,R=r[0],N=r[1],$=r[2];return t[0]=(1-(v+x))*R,t[1]=(f+C)*R,t[2]=(y-P)*R,t[3]=0,t[4]=(f-C)*N,t[5]=(1-(p+x))*N,t[6]=(b+S)*N,t[7]=0,t[8]=(y+P)*$,t[9]=(b-S)*$,t[10]=(1-(p+v))*$,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function fIe(t,e,i,r,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,u=o+o,p=a+a,f=s*c,y=s*u,v=s*p,b=o*u,x=o*p,S=a*p,P=l*c,C=l*u,R=l*p,N=r[0],$=r[1],k=r[2],B=n[0],W=n[1],Z=n[2],K=(1-(b+S))*N,X=(y+R)*N,ae=(v-C)*N,re=(y-R)*$,ee=(1-(f+S))*$,oe=(x+P)*$,U=(v+C)*k,V=(x-P)*k,H=(1-(f+b))*k;return t[0]=K,t[1]=X,t[2]=ae,t[3]=0,t[4]=re,t[5]=ee,t[6]=oe,t[7]=0,t[8]=U,t[9]=V,t[10]=H,t[11]=0,t[12]=i[0]+B-(K*B+re*W+U*Z),t[13]=i[1]+W-(X*B+ee*W+V*Z),t[14]=i[2]+Z-(ae*B+oe*W+H*Z),t[15]=1,t}function mIe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,u=r*o,p=r*a,f=n*o,y=n*a,v=n*l,b=s*o,x=s*a,S=s*l;return t[0]=1-p-v,t[1]=u+S,t[2]=f-x,t[3]=0,t[4]=u-S,t[5]=1-c-v,t[6]=y+b,t[7]=0,t[8]=f+x,t[9]=y-b,t[10]=1-c-p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Jhe(t,e,i,r,n,s,o){const a=1/(i-e),l=1/(n-r),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(i+e)*a,t[9]=(n+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function gIe(t,e,i,r,n){const s=1/Math.tan(e/2);let o;return t[0]=s/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(r-n),t[10]=(n+r)*o,t[14]=2*n*r*o):(t[10]=-1,t[14]=-2*r),t}function _Ie(t,e,i,r){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=r/(i-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*i/(i-r),t[15]=0,t}function Khe(t,e,i,r,n,s,o){const a=1/(e-i),l=1/(r-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*a,t[13]=(n+r)*l,t[14]=(o+s)*c,t[15]=1,t}function I5(t,e,i,r){const n=e[0],s=e[1],o=e[2];let a=n-i[0],l=s-i[1],c=o-i[2];const u=ol();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void Vh(t);let p=1/Math.sqrt(a*a+l*l+c*c);a*=p,l*=p,c*=p;const f=r[0],y=r[1],v=r[2];let b=y*c-v*l,x=v*a-f*c,S=f*l-y*a;p=Math.sqrt(b*b+x*x+S*S),p?(p=1/p,b*=p,x*=p,S*=p):(b=0,x=0,S=0);let P=l*S-c*x,C=c*b-a*S,R=a*x-l*b;p=Math.sqrt(P*P+C*C+R*R),p?(p=1/p,P*=p,C*=p,R*=p):(P=0,C=0,R=0),t[0]=b,t[1]=P,t[2]=a,t[3]=0,t[4]=x,t[5]=C,t[6]=l,t[7]=0,t[8]=S,t[9]=R,t[10]=c,t[11]=0,t[12]=-(b*n+x*s+S*o),t[13]=-(P*n+C*s+R*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function Qhe(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=r[0],l=r[1],c=r[2];let u=n-i[0],p=s-i[1],f=o-i[2],y=u*u+p*p+f*f;y>0&&(y=1/Math.sqrt(y),u*=y,p*=y,f*=y);let v=l*f-c*p,b=c*u-a*f,x=a*p-l*u;return y=v*v+b*b+x*x,y>0&&(y=1/Math.sqrt(y),v*=y,b*=y,x*=y),t[0]=v,t[1]=b,t[2]=x,t[3]=0,t[4]=p*x-f*b,t[5]=f*v-u*x,t[6]=u*b-p*v,t[7]=0,t[8]=u,t[9]=p,t[10]=f,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function yIe(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function vIe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function bIe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t}function ede(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}function wIe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t}function xIe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t[9]=e[9]+i[9]*r,t[10]=e[10]+i[10]*r,t[11]=e[11]+i[11]*r,t[12]=e[12]+i[12]*r,t[13]=e[13]+i[13]*r,t[14]=e[14]+i[14]*r,t[15]=e[15]+i[15]*r,t}function tde(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function Fj(t,e){if(t===e)return!0;const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],p=t[9],f=t[10],y=t[11],v=t[12],b=t[13],x=t[14],S=t[15],P=e[0],C=e[1],R=e[2],N=e[3],$=e[4],k=e[5],B=e[6],W=e[7],Z=e[8],K=e[9],X=e[10],ae=e[11],re=e[12],ee=e[13],oe=e[14],U=e[15],V=ol();return Math.abs(i-P)<=V*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(r-C)<=V*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(n-R)<=V*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(s-N)<=V*Math.max(1,Math.abs(s),Math.abs(N))&&Math.abs(o-$)<=V*Math.max(1,Math.abs(o),Math.abs($))&&Math.abs(a-k)<=V*Math.max(1,Math.abs(a),Math.abs(k))&&Math.abs(l-B)<=V*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(c-W)<=V*Math.max(1,Math.abs(c),Math.abs(W))&&Math.abs(u-Z)<=V*Math.max(1,Math.abs(u),Math.abs(Z))&&Math.abs(p-K)<=V*Math.max(1,Math.abs(p),Math.abs(K))&&Math.abs(f-X)<=V*Math.max(1,Math.abs(f),Math.abs(X))&&Math.abs(y-ae)<=V*Math.max(1,Math.abs(y),Math.abs(ae))&&Math.abs(v-re)<=V*Math.max(1,Math.abs(v),Math.abs(re))&&Math.abs(b-ee)<=V*Math.max(1,Math.abs(b),Math.abs(ee))&&Math.abs(x-oe)<=V*Math.max(1,Math.abs(x),Math.abs(oe))&&Math.abs(S-U)<=V*Math.max(1,Math.abs(S),Math.abs(U))}function kj(t){const e=ol(),i=t[0],r=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}function L5(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const TIe=Cr,SIe=ede;Object.freeze(Object.defineProperty({__proto__:null,add:bIe,adjoint:oIe,copy:Qn,determinant:aIe,equals:Fj,exactEquals:tde,frob:vIe,fromQuat:mIe,fromQuat2:uIe,fromRotation:Su,fromRotationTranslation:Xhe,fromRotationTranslationScale:pIe,fromRotationTranslationScaleOrigin:fIe,fromScaling:lIe,fromTranslation:B3,fromXRotation:qhe,fromYRotation:cIe,fromZRotation:Zhe,frustum:Jhe,getRotation:dIe,getScaling:Yhe,getTranslation:gz,hasIdentityRotation:L5,identity:Vh,invert:fo,invertOrIdentity:dS,isOrthoNormal:kj,lookAt:I5,mul:TIe,multiply:Cr,multiplyScalar:wIe,multiplyScalarAndAdd:xIe,ortho:Khe,perspective:gIe,perspectiveFromFieldOfView:_Ie,rotate:vc,rotateX:bT,rotateY:$5,rotateZ:wT,scale:M5,set:sm,str:yIe,sub:SIe,subtract:ede,targetTo:Qhe,translate:Dl,transpose:Cc},Symbol.toStringTag,{value:"Module"}));let r6,he=null;function ide(){return!!he}function CIe(){return!!ge("esri-wasm")}function rde(){return r6||(r6=Oe(()=>import("./pe-wasm-03513fe7.js"),[],import.meta.url).then(t=>t.p).then(({default:t})=>t({locateFile:e=>dr(`esri/geometry/support/${e}`)})).then(t=>{sde(t)}),r6)}var _z,jn,yz;(function(t){function e(s,o,a){he.ensureCache.prepare();const l=f1(a),c=a===l,u=he.ensureFloat64(l),p=he._pe_geog_to_proj(he.getPointer(s),o,u);return p&&T_(a,o,u,c),p}function i(s,o,a,l){switch(l){case jn.PE_TRANSFORM_P_TO_G:return r(s,o,a);case jn.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function r(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){he.ensureCache.prepare();const c=f1(a),u=a===c,p=he.ensureFloat64(c),f=he._pe_proj_to_geog_center(he.getPointer(s),o,p,l);return f&&T_(a,o,p,u),f}t.geogToProj=e,t.projGeog=i,t.projToGeog=r,t.projToGeogCenter=n})(_z||(_z={})),function(t){function e(){t.PE_BUFFER_MAX=he.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=he.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=he.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=he.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=he.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=he.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=he.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=he.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=he.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=he.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=he.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=he.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=he.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=he.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=he.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=he.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=he.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=he.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=he.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=he.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=he.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=he.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=he.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=he.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=he.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=he.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=he.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=he.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=he.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=he.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(jn||(jn={})),function(t){const e={},i={},r=y=>{if(y){const v=y.getType();switch(v){case jn.PE_TYPE_GEOGCS:y=he.castObject(y,he.PeGeogcs);break;case jn.PE_TYPE_PROJCS:y=he.castObject(y,he.PeProjcs);break;case jn.PE_TYPE_GEOGTRAN:y=he.castObject(y,he.PeGeogtran);break;default:v&jn.PE_TYPE_UNIT&&(y=he.castObject(y,he.PeUnit))}}return y};function n(){he.PeFactory.prototype.initialize(null)}function s(y){return o(jn.PE_TYPE_COORDSYS,y)}function o(y,v){let b=null,x=e[y];if(x||(x={},e[y]=x),x.hasOwnProperty(String(v)))b=x[v];else{const S=he.PeFactory.prototype.factoryByType(y,v);he.compare(S,he.NULL)||(b=S,x[v]=b)}return b=r(b),b}function a(y,v){let b=null,x=i[y];if(x||(x={},i[y]=x),x.hasOwnProperty(v))b=x[v];else{const S=he.PeFactory.prototype.fromString(y,v);he.compare(S,he.NULL)||(b=S,x[v]=b)}return b=r(b),b}function l(y){return o(jn.PE_TYPE_GEOGCS,y)}function c(y){return o(jn.PE_TYPE_GEOGTRAN,y)}function u(y){return he.PeFactory.prototype.getCode(y)}function p(y){return o(jn.PE_TYPE_PROJCS,y)}function f(y){return o(jn.PE_TYPE_UNIT,y)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=p,t.unit=f}(yz||(yz={}));let nde=null;var rD,vz,bz,wz,nD,xz,sD,oD,Tz;function sde(t){function e(s,o,a){s[o]=a(s[o])}he=t,jn.init(),rD.init(),nD.init(),sD.init(),oD.init(),nde=class extends he.PeGCSExtent{destroy(){he.destroy(this)}};const i=[he.PeDatum,he.PeGeogcs,he.PeGeogtran,he.PeObject,he.PeParameter,he.PePrimem,he.PeProjcs,he.PeSpheroid,he.PeUnit];for(const s of i)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(jn.PE_NAME_MAX))});for(const s of[he.PeGeogtran,he.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(jn.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=he.getValue(l,"*");a[c]=u?he.wrapPointer(u,he.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(he.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return T_(a,o,s.call(this)),a}),e(he.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=he._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!he.compare(l,he.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=he.getPointer(l);for(let p=1;p<c;p++)a.push(he.wrapPointer(u+o*p,he.PeGTlistExtendedGTs))}}return a}});const r=he._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!he.compare(l,he.NULL)){a=[l];const c=l.getNump();if(c>1){const u=he.getPointer(l);for(let p=1;p<c;p++)a.push(he.wrapPointer(u+r*p,he.PeHorizon))}}return o.set(s,a),a};e(he.PeProjcs.prototype,"horizonGcsGenerate",n),e(he.PeProjcs.prototype,"horizonPcsGenerate",n),he.PeObject.prototype.toString=function(s=jn.PE_STR_OPTS_NONE){he.ensureCache.prepare();const o=he.getPointer(this),a=he.ensureInt8(new Array(jn.PE_BUFFER_MAX));return he.UTF8ToString(he._pe_object_to_string_ext(o,s,a))}}function ym(t){if(!t)return;const e=he.getClass(t);if(!e)return;const i=he.getCache(e);if(!i)return;const r=he.getPointer(t);r&&delete i[r]}function xR(t,e){const i=[],r=new Array(e);for(let n=0;n<t;n++)i.push(he.ensureInt8(r));return i}function f1(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(i=>{e.push(i[0],i[1])})):e=t,e}function T_(t,e,i,r=!1){if(r)for(let n=0;n<2*e;n++)t[n]=he.getValue(i+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=he.getValue(i,"double"),t[s][1]=he.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function i(){t.PE_GTLIST_OPTS_COMMON=he.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=he._pe_getPeGTlistExtendedEntrySize()}function r(n,s,o,a,l,c){let u=null;const p=new he.PeInteger(c);try{const f=he.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,p);if((c=p.val)&&(u=[f],c>1)){const y=he.getPointer(f);for(let v=1;v<c;v++)u.push(he.wrapPointer(y+e*v,he.PeGTlistExtendedEntry))}}finally{he.destroy(p)}return u}t.init=i,t.getGTlist=r})(rD||(rD={})),function(t){function e(i){if(i&&i.length){for(const r of i)ym(r),r.getEntries().forEach(n=>{ym(n);const s=n.getGeogtran();ym(s),s.getParameters().forEach(ym),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{ym(o);const a=o.getDatum();ym(a),ym(a.getSpheroid()),ym(o.getPrimem()),ym(o.getUnit())})});he.PeGTlistExtendedEntry.prototype.Delete(i[0])}}t.destroy=e}(vz||(vz={})),function(t){function e(i,r,n,s,o){he.ensureCache.prepare();const a=f1(n),l=n===a,c=he.ensureFloat64(a);let u=0;s&&(u=he.ensureFloat64(s));const p=he._pe_geog_to_geog(he.getPointer(i),r,c,u,o);return p&&T_(n,r,c,l),p}t.geogToGeog=e}(bz||(bz={})),function(t){const e=(c,u,p,f,y,v)=>{let b,x;switch(he.ensureCache.prepare(),c){case"dd":b=he._pe_geog_to_dd,x=jn.PE_DD_MAX;break;case"ddm":b=he._pe_geog_to_ddm,x=jn.PE_DDM_MAX;break;case"dms":b=he._pe_geog_to_dms,x=jn.PE_DMS_MAX}let S=0;u&&(S=he.getPointer(u));const P=f1(f),C=he.ensureFloat64(P),R=xR(p,x),N=b(S,p,C,y,he.ensureInt32(R));if(N)for(let $=0;$<p;$++)v[$]=he.UTF8ToString(R[$]);return N},i=(c,u,p,f,y)=>{let v;switch(he.ensureCache.prepare(),c){case"dd":v=he._pe_dd_to_geog;break;case"ddm":v=he._pe_ddm_to_geog;break;case"dms":v=he._pe_dms_to_geog}let b=0;u&&(b=he.getPointer(u));const x=f.map(R=>he.ensureString(R)),S=he.ensureInt32(x),P=he.ensureFloat64(new Array(2*p)),C=v(b,p,S,P);return C&&T_(y,p,P),C};function r(c,u,p,f,y){return e("dms",c,u,p,f,y)}function n(c,u,p,f){return i("dms",c,u,p,f)}function s(c,u,p,f,y){return e("ddm",c,u,p,f,y)}function o(c,u,p,f){return i("ddm",c,u,p,f)}function a(c,u,p,f,y){return e("dd",c,u,p,f,y)}function l(c,u,p,f){return i("dd",c,u,p,f)}t.geogToDms=r,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(wz||(wz={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=he.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=he.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=he.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(n,s,o,a,l,c,u){he.ensureCache.prepare();let p=0;n&&(p=he.getPointer(n));const f=f1(o),y=he.ensureFloat64(f),v=xR(s,jn.PE_MGRS_MAX),b=he.ensureInt32(v),x=he._pe_geog_to_mgrs_extended(p,s,y,a,l,c,b);if(x)for(let S=0;S<s;S++)u[S]=he.UTF8ToString(v[S]);return x}function r(n,s,o,a,l){he.ensureCache.prepare();let c=0;n&&(c=he.getPointer(n));const u=o.map(v=>he.ensureString(v)),p=he.ensureInt32(u),f=he.ensureFloat64(new Array(2*s)),y=he._pe_mgrs_to_geog_extended(c,s,p,a,f);return y&&T_(l,s,f),y}t.init=e,t.geogToMgrsExtended=i,t.mgrsToGeogExtended=r}(nD||(nD={})),function(t){function e(r,n,s,o,a,l,c){he.ensureCache.prepare();let u=0;r&&(u=he.getPointer(r));const p=f1(s),f=he.ensureFloat64(p),y=xR(n,jn.PE_MGRS_MAX),v=he.ensureInt32(y),b=he._pe_geog_to_usng(u,n,f,o,a,l,v);if(b)for(let x=0;x<n;x++)c[x]=he.UTF8ToString(y[x]);return b}function i(r,n,s,o){he.ensureCache.prepare();let a=0;r&&(a=he.getPointer(r));const l=s.map(f=>he.ensureString(f)),c=he.ensureInt32(l),u=he.ensureFloat64(new Array(2*n)),p=he._pe_usng_to_geog(a,n,c,u);return p&&T_(o,n,u),p}t.geogToUsng=e,t.usngToGeog=i}(xz||(xz={})),function(t){function e(){t.PE_UTM_OPTS_NONE=he.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=he.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=he.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(n,s,o,a,l){he.ensureCache.prepare();let c=0;n&&(c=he.getPointer(n));const u=f1(o),p=he.ensureFloat64(u),f=xR(s,jn.PE_UTM_MAX),y=he.ensureInt32(f),v=he._pe_geog_to_utm(c,s,p,a,y);if(v)for(let b=0;b<s;b++)l[b]=he.UTF8ToString(f[b]);return v}function r(n,s,o,a,l){he.ensureCache.prepare();let c=0;n&&(c=he.getPointer(n));const u=o.map(v=>he.ensureString(v)),p=he.ensureInt32(u),f=he.ensureFloat64(new Array(2*s)),y=he._pe_utm_to_geog(c,s,p,a,f);return y&&T_(l,s,f),y}t.init=e,t.geogToUtm=i,t.utmToGeog=r}(sD||(sD={})),function(t){const e=new Map;function i(){t.PE_PCSINFO_OPTION_NONE=he.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=he.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=he.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=he.PePCSInfo.prototype.PE_POLE_POINT}function r(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=he.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=i,t.generate=r}(oD||(oD={})),function(t){function e(){return he.PeVersion.prototype.version_string()}t.versionString=e}(Tz||(Tz={}));const EIe=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return _z},get PeDefs(){return jn},get PeFactory(){return yz},get PeGCSExtent(){return nde},get PeGTTransformations(){return bz},get PeGTlistExtended(){return rD},get PeGTlistExtendedEntry(){return vz},get PeNotationDms(){return wz},get PeNotationMgrs(){return nD},get PeNotationUsng(){return xz},get PeNotationUtm(){return sD},get PePCSInfo(){return oD},get PeVersion(){return Tz},_init:sde,get _pe(){return he},isLoaded:ide,isSupported:CIe,load:rde},Symbol.toStringTag,{value:"Module"})),O0t=Math.PI/180,R0t=/SPHEROID\[([^\]]+)]/i,f0=vi.radius,ld=vi.eccentricitySquared,AIe={a1:f0*ld,a2:f0*ld*f0*ld,a3:f0*ld*ld/2,a4:f0*ld*f0*ld*2.5,a5:f0*ld+f0*ld*ld/2,a6:1-ld},M0t={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:vi.radius,f:vi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:Og.radius,f:Og.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:$f.radius,f:$f.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:$f.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let TR=0,n6=class Sz{static fromGE(e){const i=new Sz;return i._wkt=e.wkt,i._wkid=e.wkid,i._isInverse=e.isInverse,i}constructor(e){this.uid=TR++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=TR++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=TR++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=TR++}getInverse(){const e=new Sz;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},aD=class ME{static cacheKey(e,i){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(e){const i=new ME;let r="";for(const n of e.steps){const s=n6.fromGE(n);i.steps.push(s),r+=s.uid.toString()+","}return i._cachedProjection={},i._gtlistentry=null,i._chain=r,i}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const i of e.steps)i instanceof n6?this.steps.push(i):this.steps.push(new n6({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}getInverse(){const e=new ME;e.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];e.steps.push(r.getInverse())}return e}getGTListEntry(){let e="";for(const i of this.steps)e+=i.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,i,r){this._cachedProjection[ME.cacheKey(e,i)]=r}getCachedGeTransformation(e,i){let r="";for(const s of this.steps)r+=s.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=r);const n=this._cachedProjection[ME.cacheKey(e,i)];return n===void 0?null:n}};function PIe(t,e,i){if(e==null||i==null||i.vcsWkid||go(e,i))return null;const r=N8(e)/N8(i);if(r===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>OIe(n,r);case"polyline":case"esriGeometryPolyline":return n=>MIe(n,r);case"polygon":case"esriGeometryPolygon":return n=>RIe(n,r);case"multipoint":case"esriGeometryMultipoint":return n=>$Ie(n,r);case"extent":case"esriGeometryEnvelope":return n=>IIe(n,r);default:return null}}function OIe(t,e){t&&t.z!=null&&(t.z*=e)}function RIe(t,e){if(t)for(const i of t.rings)for(const r of i)r.length>2&&(r[2]*=e)}function MIe(t,e){if(t)for(const i of t.paths)for(const r of i)r.length>2&&(r[2]*=e)}function $Ie(t,e){if(t)for(const i of t.points)i.length>2&&(i[2]*=e)}function IIe(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let np=null,uy=null,DA=null,vI={};const ode=new h5;function D5(){return!!np&&ide()}function DP(t){return DA==null&&(DA=Promise.all([rde(),Oe(()=>import("./geometryEngineBase-8afca563.js"),[],import.meta.url).then(e=>e.g),Oe(()=>import("./hydrated-4fea88d3.js"),[],import.meta.url)])),DA.then(([,e,{hydratedAdapter:i}])=>{Ti(t),uy=i,np=e.default,np._enableProjection(EIe),ode.notify()})}function pS(t,e,i=null,r=null){return Array.isArray(t)?t.length===0?[]:Cz(uy,t,t[0].spatialReference,e,i,r):Cz(uy,[t],t.spatialReference,e,i,r)[0]}function Cz(t,e,i,r,n=null,s=null){if(i==null||r==null)return e;if(hy(i,r,n))return e.map(o=>Uj(o,i,r));if(n==null){const o=aD.cacheKey(i,r);vI[o]!==void 0?n=vI[o]:((n=lde(i,r,void 0))==null&&(n=new aD),vI[o]=n)}if(np==null||t==null)throw new N5;return s!=null?np._project(t,e,i,r,n,s):np._project(t,e,i,r,n)}function LIe(t,e){const i=ade([t],e);return i.pending!=null?{pending:i.pending,geometry:null}:i.geometries!=null?{pending:null,geometry:i.geometries[0]}:{pending:null,geometry:null}}function ade(t,e){if(!D5()){for(const i of t)if(i!=null&&!go(i.spatialReference,e)&&Ta(i.spatialReference)&&Ta(e)&&!hy(i.spatialReference,e))return hi(ode),{pending:DP(),geometries:null}}return{pending:null,geometries:t.map(i=>i==null?null:go(i.spatialReference,e)?i:Ta(i.spatialReference)&&Ta(e)?cde(i,e):null)}}function lde(t,e,i=null){if(t==null||e==null)return null;if(np==null||uy==null)throw new N5;const r=np._getTransformation(uy,t,e,i,i==null?void 0:i.spatialReference);return r!==null?aD.fromGE(r):null}function DIe(t,e,i=null){if(np==null||uy==null)throw new N5;const r=np._getTransformationBySuitability(uy,t,e,i,i==null?void 0:i.spatialReference);if(r!==null){const n=[];for(const s of r)n.push(aD.fromGE(s));return n}return[]}class N5 extends ce{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var ne;function NIe(){np=null,uy=null,DA=null,vI={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(ne||(ne={}));const FIe={get loadPromise(){return DA}};function cde(t,e){try{const i=pS(t,e);if(i==null)return null;"xmin"in t&&"xmin"in i&&(i.zmin=t.zmin,i.zmax=t.zmax);const r=PIe(i.type,t.spatialReference,e);return r!=null&&r(i),i}catch(i){if(!(i instanceof N5))throw i;return null}}function hy(t,e,i){return!i&&(!!go(t,e)||Ta(t)&&Ta(e)&&!!Gj(t,e,Hj))}async function kIe(t,e,i,r){if(D5())return VZ(r);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!hy(n,s,o))return DP(r)}else if(!hy(t,e,i))return DP(r);return VZ(r)}function UIe(t,e){switch(Gj(t,e,Hj)){case Wr:return"copy3";case k_:return"wgs84ToSphericalECEF";case _b:return"wgs84ToWebMercator";case F_:return"wgs84ToPlateCarree";case z_:return"wgs84ToWGS84ECEF";case V1:return"webMercatorToWGS84";case bde:return"webMercatorToSphericalECEF";case wde:return"webMercatorToWGS84ECEF";case xde:return"webMercatorToPlateCarree";case B_:return"wgs84ECEFToWGS84";case Ede:return"wgs84ECEFToSphericalECEF";case Ade:return"wgs84ECEFToWebMercator";case U_:return"sphericalECEFToWGS84";case Sde:return"sphericalECEFToWebMercator";case Rz:return"sphericalMarsPCPFToMars2000";case Oz:return"sphericalMoonPCPFToMoon2000";case Cde:return"sphericalECEFToWGS84ECEF";case Pz:return"mars2000ToSphericalPCPF";case Az:return"moon2000ToSphericalPCPF";default:return null}}function Uj(t,e,i){return t?"x"in t?hde(t,e,new Ft,i,0):"xmin"in t?mde(t,e,new Ar,i,0):"rings"in t?fde(t,e,new zb,i,0):"paths"in t?pde(t,e,new u5,i,0):"points"in t?dde(t,e,new M3,i,0):null:null}function ude(t,e,i=e.spatialReference,r=0){return i!=null&&t.spatialReference!=null&&hde(t,t.spatialReference,e,i,r)!=null}function hde(t,e,i,r,n){nr[0]=t.x,nr[1]=t.y;const s=t.z;return nr[2]=s!==void 0?s:n,_n(nr,e,0,nr,r,0,1)?(i.x=nr[0],i.y=nr[1],i.spatialReference=r,s===void 0?(i.z=void 0,i.hasZ=!1):(i.z=nr[2],i.hasZ=!0),t.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=t.m,i.hasM=!0),i):null}function zIe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&dde(t,t.spatialReference,e,i,r)!=null}function dde(t,e,i,r,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,u=[];for(const p of s)u.push(p[0],p[1],o?p[2]:n);if(!_n(u,e,0,u,r,0,c))return null;for(let p=0;p<c;++p){const f=3*p,y=u[f],v=u[f+1];o&&a?l.push([y,v,u[f+2],s[p][3]]):o?l.push([y,v,u[f+2]]):a?l.push([y,v,s[p][2]]):l.push([y,v])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function BIe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&pde(t,t.spatialReference,e,i,r)!=null}function pde(t,e,i,r,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];return yde(s,o??!1,a??!1,e,l,r,n)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function VIe({hasZ:t,spatialReference:e,paths:i},r,n=0){const s=qf(e,fS),o=Oh[s][ne.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>me(nr,l[0],l[1],n);for(const l of i){const c=[];for(const u of l){const p=[0,0,n];o(a(u),0,p,0),c.push(p)}r.push(c)}return!0}function GIe({hasZ:t,spatialReference:e,rings:i},r,n=0){const s=qf(e,fS),o=Oh[s][ne.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>me(nr,l[0],l[1],n);for(const l of i){const c=[];for(const u of l){const p=[0,0,n];o(a(u),0,p,0),c.push(p)}r.push(c)}return!0}function jIe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&fde(t,t.spatialReference,e,i,r)!=null}function fde(t,e,i,r,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];return yde(s,o??!1,a??!1,e,l,r,n)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function HIe(t,e,i=e.spatialReference,r=0){return t.spatialReference!=null&&i!=null&&mde(t,t.spatialReference,e,i,r)!=null}function mde(t,e,i,r,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t;return Ez(s,o,c?t.zmin:n,e,nr,r)?(i.xmin=nr[0],i.ymin=nr[1],c&&(i.zmin=nr[2]),Ez(a,l,c?t.zmax:n,e,nr,r)?(i.xmax=nr[0],i.ymax=nr[1],c&&(i.zmax=nr[2]),u&&(i.mmin=t.mmin,i.mmax=t.mmax),i.spatialReference=r,i):null):null}function $g(t,e,i){if(e==null||i==null)return null;const r=new Ft({spatialReference:i});return _n(t,e,0,nr,i,0,1)?(r.x=nr[0],r.y=nr[1],r.z=nr[2],r):null}function zj(t,e,i){return _n(t,e,0,nr,i.spatialReference,0,1)?(i.x=nr[0],i.y=nr[1],i.z=nr[2],i):null}function No(t,e,i,r=0){nr[0]=t.x,nr[1]=t.y;const n=t.z;return nr[2]=n!==void 0?n:r,_n(nr,t.spatialReference,0,e,i,0,1)}function Ez(t,e,i,r,n,s){return wn[0]=t,wn[1]=e,wn[2]=i,_n(wn,r,0,n,s,0,1)}function Ws(t,e,i,r){return!(e==null||r==null||t.length<2)&&(t.length===2&&(wn[0]=t[0],wn[1]=t[1],wn[2]=0,t=wn),_n(t,e,0,i,r,0,1))}function gde(t,e){nr[0]=t.x,nr[1]=t.y;const i=t.z;return nr[2]=i!==void 0?i:0,_de(nr,t.spatialReference,e)}function _de(t,e,i){return WIe(t,e,i)}function WIe(t,e,i){if(e==null)return!1;const r=qf(e,fS),n=Oh[r][ne.WGS84_COMPARABLE_LON_LAT];return n!=null&&(n(t,0,wn,0),i!==wn&&(i[0]=wn[0],i[1]=wn[1],i.length>2&&(i[2]=wn[2])),!0)}function _n(t,e,i,r,n,s,o=1){const a=Gj(e,n,Hj);if(a==null)return!1;if(a===Wr){if(t===r&&i===s)return!0;const c=i+3*o;for(let u=i,p=s;u<c;u++,p++)r[p]=t[u];return!0}const l=i+3*o;for(let c=i,u=s;c<l;c+=3,u+=3)a(t,c,r,u);return!0}function qIe(t,e,i,r,n){fe(nr,t),xe(SR,t,e),Ws(nr,i,nr,n),Ws(SR,i,SR,n),Ce(r,SR,nr),Me(r,r)}function yde(t,e,i,r,n,s,o=0){const a=new Array;for(const c of t)for(const u of c)a.push(u[0],u[1],e?u[2]:o);if(!_n(a,r,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;for(const c of t){const u=new Array;for(const p of c)e&&i?u.push([a[l++],a[l++],a[l++],p[3]]):e?u.push([a[l++],a[l++],a[l++]]):i?(u.push([a[l++],a[l++],p[2]]),l++):(u.push([a[l++],a[l++]]),l++);n.push(u)}return!0}function ZIe(t,e,i,r){if(e==null||r==null)return!1;const n=Pde(e,r,iLe);if(n.projector===Wr)return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],!0;if(n.projector==null)return!1;const{source:s,dest:o}=n;if(o.spatialReferenceId===ne.WEB_MERCATOR){const a=Oh[s.spatialReferenceId][ne.WGS84];return a!=null&&(a(t,0,Nd,0),_b(Nd,0,i,0),i[3]=TY(Nd[1],t[2],t[3],vi.radius),!0)}if(s.spatialReferenceId!==ne.WGS84&&s.spatialReferenceId!==ne.CGCS2000||o.spatialReferenceId!==ne.PLATE_CARREE){n.projector(t,0,i,0);const a=s.metersPerUnit??1,l=o.metersPerUnit??1;i[3]=t[3]*a/l}else{const a=Oh[s.spatialReferenceId][ne.SPHERICAL_ECEF],l=Oh[ne.SPHERICAL_ECEF][ne.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=TY(t[1],t[2],t[3],vi.radius)),n.projector(t,0,i,0),i[3]=c}return!0}function TY(t,e,i,r){const n=r+e;if(n<r/2||i>n)return Number.MAX_VALUE;const s=Math.abs(Yd*t)+Math.asin(i/n);return s>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(s)}function V3(t,e,i,r){return t!=null&&(go(e,r)?(Rg(i,t),!0):(wn[0]=t[0],wn[1]=t[1],wn[2]=0,!!_n(wn,e,0,wn,r,0,1)&&(i[0]=wn[0],i[1]=wn[1],wn[0]=t[2],wn[1]=t[3],wn[2]=0,!!_n(wn,e,0,wn,r,0,1)&&(i[2]=wn[0],i[3]=wn[1],!0))))}function XIe(t,e,i,r){if(e==null||r==null)return!1;const n=qf(e,fS),s=qf(r,Ode);if(n===s&&n!==ne.UNKNOWN||go(e,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(n===ne.SPHERICAL_ECEF){const o=ze(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/vi.radius;if(s===ne.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(s===ne.WGS84||s===ne.CGCS2000){const c=NA;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(n===ne.PLATE_CARREE){if(s===ne.WGS84||s===ne.CGCS2000)return i[0]=NA,i[1]=NA,i[2]=1,!0;if(s===ne.WEB_MERCATOR){const o=t[1]/vi.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function _u(t,e,i,r){if(t==null||r==null)return!1;const n=qf(t,fS),s=qf(r,Ode);if(n===s&&!SY(s)&&(n!==ne.UNKNOWN||go(t,r)))return B3(i,e),!0;if(SY(s)){const o=Oh[n][ne.LON_LAT],a=Oh[ne.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,Nd,0),a(Nd,0,m0,0),Bj(Yd*Nd[0],Yd*Nd[1],i),i[12]=m0[0],i[13]=m0[1],i[14]=m0[2],!0)}if((s===ne.WEB_MERCATOR||s===ne.PLATE_CARREE)&&(n===ne.WGS84||n===ne.CGCS2000&&s===ne.PLATE_CARREE||n===ne.SPHERICAL_ECEF||n===ne.WEB_MERCATOR)){const o=Oh[n][ne.LON_LAT],a=Oh[ne.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,Nd,0),a(Nd,0,m0,0),n===ne.SPHERICAL_ECEF?vde(Yd*Nd[0],Yd*Nd[1],i):Vh(i),i[12]=m0[0],i[13]=m0[1],i[14]=m0[2],!0)}return!1}function SY(t){return t===ne.SPHERICAL_ECEF||t===ne.SPHERICAL_MARS_PCPF||t===ne.SPHERICAL_MOON_PCPF}function Bj(t,e,i){const r=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=i;return a[0]=-r,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function vde(t,e,i){return Bj(t,e,i),Cc(i,i),i}function qf(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=al(t,1)),t.wkt===yle.wkt?e.spatialReferenceId=ne.SPHERICAL_ECEF:TP(t)?e.spatialReferenceId=ne.WGS84:nb(t)?e.spatialReferenceId=ne.WEB_MERCATOR:SG(t)?e.spatialReferenceId=ne.PLATE_CARREE:t.wkt===vle.wkt?e.spatialReferenceId=ne.WGS84_ECEF:t.wkid===Th.CGCS2000?e.spatialReferenceId=ne.CGCS2000:t.wkt===PG.wkt?e.spatialReferenceId=ne.SPHERICAL_MARS_PCPF:t.wkt===OG.wkt?e.spatialReferenceId=ne.SPHERICAL_MOON_PCPF:tm(t)?e.spatialReferenceId=ne.GCSMARS2000:im(t)?e.spatialReferenceId=ne.GCSMOON2000:e.spatialReferenceId=ne.UNKNOWN):ne.UNKNOWN}function Wr(t,e,i,r){t!==i&&(i[r++]=t[e++],i[r++]=t[e++],i[r]=t[e])}function V1(t,e,i,r){i[r++]=xT*(t[e++]/vi.radius),i[r++]=xT*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/vi.radius))),i[r]=t[e]}function bde(t,e,i,r){V1(t,e,i,r),k_(i,r,i,r)}function wde(t,e,i,r){V1(t,e,i,r),z_(i,r,i,r)}function F5(t,e,i,r,n){const s=.4999999*Math.PI,o=$e(Yd*t[e+1],-s,s),a=Math.sin(o);i[r++]=Yd*t[e]*n.radius,i[r++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=t[e+2]}function _b(t,e,i,r){F5(t,e,i,r,vi)}const CY=vi.radius*Math.PI/180,NA=180/(vi.radius*Math.PI);function F_(t,e,i,r){i[r]=t[e]*CY,i[r+1]=t[e+1]*CY,i[r+2]=t[e+2]}function R1(t,e,i,r){i[r]=t[e]*NA,i[r+1]=t[e+1]*NA,i[r+2]=t[e+2]}function xde(t,e,i,r){V1(t,e,i,r),F_(i,r,i,r)}function YIe(t,e,i,r){B_(t,e,i,r),F_(i,r,i,r)}function JIe(t,e,i,r){U_(t,e,i,r),F_(i,r,i,r)}function KIe(t,e,i,r){R1(t,e,i,r),k_(i,r,i,r)}function QIe(t,e,i,r){R1(t,e,i,r),_b(i,r,i,r)}function eLe(t,e,i,r){R1(t,e,i,r),z_(i,r,i,r)}function dy(t){if(t==null)return!1;const e=qf(t,fS);return!!Oh[e][ne.WGS84_COMPARABLE_LON_LAT]}function Tde(t,e,i,r){const n=Math.cos(i);t[0]=Math.cos(e)*n*r,t[1]=Math.sin(e)*n*r,t[2]=Math.sin(i)*r}function Vj(t,e,i,r,n){const s=n+t[e+2],o=Yd*t[e+1],a=Yd*t[e],l=Math.cos(o);i[r++]=Math.cos(a)*l*s,i[r++]=Math.sin(a)*l*s,i[r]=Math.sin(o)*s}function Az(t,e,i,r){Vj(t,e,i,r,Og.radius)}function Pz(t,e,i,r){Vj(t,e,i,r,$f.radius)}function k_(t,e,i,r){Vj(t,e,i,r,vi.radius)}function k5(t,e,i,r,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=Nh(a/(l===0?1:l)),u=Math.atan2(o,s);i[r++]=xT*u,i[r++]=xT*c,i[r]=l-n}function Oz(t,e,i,r){k5(t,e,i,r,Og.radius)}function Rz(t,e,i,r){k5(t,e,i,r,$f.radius)}function U_(t,e,i,r){k5(t,e,i,r,vi.radius)}function Sde(t,e,i,r){U_(t,e,i,r),_b(i,r,i,r)}function Cde(t,e,i,r){U_(t,e,i,r),z_(i,r,i,r)}function tLe(t,e,i,r,n){const s=Yd*t[e],o=Yd*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);i[r++]=(u+a)*c*Math.cos(s),i[r++]=(u+a)*c*Math.sin(s),i[r++]=(u*(1-n.eccentricitySquared)+a)*l}function z_(t,e,i,r){tLe(t,e,i,r,vi)}function B_(t,e,i,r){const n=AIe,s=t[e],o=t[e+1],a=t[e+2];let l,c,u,p,f,y,v,b,x,S,P,C,R,N,$,k,B,W,Z,K,X;l=Math.abs(a),c=s*s+o*o,u=Math.sqrt(c),p=c+a*a,f=Math.sqrt(p),K=Math.atan2(o,s),y=a*a/p,v=c/p,N=n.a2/f,$=n.a3-n.a4/f,v>.3?(b=l/f*(1+v*(n.a1+N+y*$)/f),Z=Math.asin(b),S=b*b,x=Math.sqrt(1-S)):(x=u/f*(1-y*(n.a5-N-v*$)/f),Z=Math.acos(x),S=1-x*x,b=Math.sqrt(S)),P=1-vi.eccentricitySquared*S,C=vi.radius/Math.sqrt(P),R=n.a6*C,N=u-C*x,$=l-R*b,B=x*N+b*$,k=x*$-b*N,W=k/(R/P+B),Z+=W,X=B+k*W/2,a<0&&(Z=-Z),i[r++]=xT*K,i[r++]=xT*Z,i[r]=X}function Ede(t,e,i,r){B_(t,e,i,r),k_(i,r,i,r)}function Ade(t,e,i,r){B_(t,e,i,r),_b(i,r,i,r)}const Oh={[ne.WGS84]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Wr,[ne.WGS84_COMPARABLE_LON_LAT]:Wr,[ne.SPHERICAL_ECEF]:k_,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:_b,[ne.PLATE_CARREE]:F_,[ne.WGS84]:Wr,[ne.WGS84_ECEF]:z_},[ne.CGCS2000]:{[ne.CGCS2000]:Wr,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Wr,[ne.WGS84_COMPARABLE_LON_LAT]:Wr,[ne.SPHERICAL_ECEF]:k_,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:F_,[ne.WGS84]:null,[ne.WGS84_ECEF]:z_},[ne.GCSMARS2000]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:Wr,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Wr,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:Pz,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.GCSMOON2000]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:Wr,[ne.LON_LAT]:Wr,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:Az,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.WEB_MERCATOR]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:V1,[ne.WGS84_COMPARABLE_LON_LAT]:V1,[ne.SPHERICAL_ECEF]:bde,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:Wr,[ne.PLATE_CARREE]:xde,[ne.WGS84]:V1,[ne.WGS84_ECEF]:wde},[ne.WGS84_ECEF]:{[ne.CGCS2000]:B_,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:B_,[ne.WGS84_COMPARABLE_LON_LAT]:B_,[ne.SPHERICAL_ECEF]:Ede,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:Ade,[ne.PLATE_CARREE]:YIe,[ne.WGS84]:B_,[ne.WGS84_ECEF]:Wr},[ne.SPHERICAL_ECEF]:{[ne.CGCS2000]:U_,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:U_,[ne.WGS84_COMPARABLE_LON_LAT]:U_,[ne.SPHERICAL_ECEF]:Wr,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:Sde,[ne.PLATE_CARREE]:JIe,[ne.WGS84]:U_,[ne.WGS84_ECEF]:Cde},[ne.SPHERICAL_MARS_PCPF]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:Rz,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Rz,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:Wr,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.SPHERICAL_MOON_PCPF]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:Oz,[ne.LON_LAT]:Oz,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:Wr,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.UNKNOWN]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:null,[ne.WGS84_COMPARABLE_LON_LAT]:null,[ne.SPHERICAL_ECEF]:null,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:Wr,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:null,[ne.WGS84]:null,[ne.WGS84_ECEF]:null},[ne.LON_LAT]:{[ne.CGCS2000]:Wr,[ne.GCSMARS2000]:Wr,[ne.GCSMOON2000]:Wr,[ne.LON_LAT]:Wr,[ne.WGS84_COMPARABLE_LON_LAT]:Wr,[ne.SPHERICAL_ECEF]:k_,[ne.SPHERICAL_MARS_PCPF]:Pz,[ne.SPHERICAL_MOON_PCPF]:Az,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:_b,[ne.PLATE_CARREE]:F_,[ne.WGS84]:Wr,[ne.WGS84_ECEF]:z_},[ne.WGS84_COMPARABLE_LON_LAT]:{[ne.CGCS2000]:null,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:Wr,[ne.WGS84_COMPARABLE_LON_LAT]:Wr,[ne.SPHERICAL_ECEF]:k_,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:null,[ne.PLATE_CARREE]:F_,[ne.WGS84]:Wr,[ne.WGS84_ECEF]:z_},[ne.PLATE_CARREE]:{[ne.CGCS2000]:R1,[ne.GCSMARS2000]:null,[ne.GCSMOON2000]:null,[ne.LON_LAT]:R1,[ne.WGS84_COMPARABLE_LON_LAT]:R1,[ne.SPHERICAL_ECEF]:KIe,[ne.SPHERICAL_MARS_PCPF]:null,[ne.SPHERICAL_MOON_PCPF]:null,[ne.UNKNOWN]:null,[ne.WEB_MERCATOR]:QIe,[ne.PLATE_CARREE]:Wr,[ne.WGS84]:R1,[ne.WGS84_ECEF]:eLe}};function Gj(t,e,i=jj()){return t==null||e==null?null:Pde(t,e,i).projector}function Pde(t,e,i){if(t==null||e==null||i.source.spatialReference===t&&i.dest.spatialReference===e)return i;const r=qf(t,i.source),n=qf(e,i.dest);return r===ne.UNKNOWN&&n===ne.UNKNOWN?go(t,e)?i.projector=Wr:i.projector=null:i.projector=Oh[r][n],i}function jj(){return{source:{spatialReference:null,spatialReferenceId:ne.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ne.UNKNOWN,metersPerUnit:1},projector:Wr}}const fS={spatialReference:null,spatialReferenceId:ne.UNKNOWN},Ode={spatialReference:null,spatialReferenceId:ne.UNKNOWN},Hj=jj(),iLe=jj(),Yd=Qt(1),xT=nl(1),wn=I(),Nd=I(),m0=I(),nr=I(),SR=I(),$0t=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:dy,canProjectWithoutEngine:hy,computeENUToSphericalPCPFLocalRotation:Bj,computeSphericalPCPFToENULocalRotation:vde,computeTranslationToOriginAndRotation:_u,getProjectorName:UIe,getTransformation:lde,getTransformations:DIe,initializeProjection:kIe,isLoaded:D5,load:DP,localLinearScaleFactors:XIe,lonLatToSphericalPCPF:Tde,lonLatToWebMercatorComparable:F5,project:pS,projectBoundingRect:V3,projectBoundingSphere:ZIe,projectBuffer:_n,projectDirection:qIe,projectExtent:HIe,projectMany:Cz,projectMultipoint:zIe,projectOrLoad:LIe,projectOrLoadMany:ade,projectPoint:ude,projectPointToVector:No,projectPointToWGS84ComparableLonLat:gde,projectPolygon:jIe,projectPolygonToWGS84ComparableLonLat:GIe,projectPolyline:BIe,projectPolylineToWGS84ComparableLonLat:VIe,projectVectorToDehydratedPoint:zj,projectVectorToPoint:$g,projectVectorToVector:Ws,projectVectorToWGS84ComparableLonLat:_de,projectWithoutEngine:Uj,projectXYZToVector:Ez,sphericalPCPFtoLonLatElevation:k5,test:FIe,tryProjectWithZConversion:cde,unload:NIe},Symbol.toStringTag,{value:"Module"}));let Vg=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&lT(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*EY);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,EY));e++)this._items.push(this._allocator())}};const EY=1024;function Ne(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function TT(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function Wj(t,e,i,r,n,s,o,a,l,c,u,p,f,y,v,b){return[t,e,i,r,n,s,o,a,l,c,u,p,f,y,v,b]}function Rde(t,e){return new Float64Array(t,e,16)}const Os=Ne();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:Os,clone:TT,create:Ne,createView:Rde,fromValues:Wj},Symbol.toStringTag,{value:"Module"}));var bc;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(bc||(bc={}));var lD;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(lD||(lD={}));function on(){return[1,0,0,0,1,0,0,0,1]}function Mde(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function rLe(t,e,i,r,n,s,o,a,l){return[t,e,i,r,n,s,o,a,l]}function $de(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:Mde,create:on,createView:$de,fromValues:rLe},Symbol.toStringTag,{value:"Module"}));function Xh(){return[0,0,0,1]}function nLe(t){return[t[0],t[1],t[2],t[3]]}function sLe(t,e,i,r){return[t,e,i,r]}function Ide(t,e){return new Float64Array(t,e,4)}const oLe=Xh();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:oLe,clone:nLe,create:Xh,createView:Ide,fromValues:sLe},Symbol.toStringTag,{value:"Module"}));function it(){return[0,0]}function $E(t){return[t[0],t[1]]}function Ri(t,e){return[t,e]}function Lde(t){const e=it(),i=Math.min(2,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Dde(t,e){return new Float64Array(t,e,2)}function Nde(){return it()}function Fde(){return Ri(1,1)}function kde(){return Ri(1,0)}function Ude(){return Ri(0,1)}const fp=Nde(),aLe=Fde(),zde=kde(),lLe=Ude();Object.freeze(Object.defineProperty({__proto__:null,ONES:aLe,UNIT_X:zde,UNIT_Y:lLe,ZEROS:fp,clone:$E,create:it,createView:Dde,fromArray:Lde,fromValues:Ri,ones:Fde,unitX:kde,unitY:Ude,zeros:Nde},Symbol.toStringTag,{value:"Module"}));function gi(){return[0,0,0,0]}function G3(t){return[t[0],t[1],t[2],t[3]]}function Kt(t,e,i,r){return[t,e,i,r]}function qj(t){const e=gi(),i=Math.min(4,t.length);for(let r=0;r<i;++r)e[r]=t[r];return e}function Bde(t,e){return new Float64Array(t,e,4)}function Vde(){return gi()}function Gde(){return Kt(1,1,1,1)}function jde(){return Kt(1,0,0,0)}function Hde(){return Kt(0,1,0,0)}function Wde(){return Kt(0,0,1,0)}function qde(){return Kt(0,0,0,1)}const Df=Vde(),Sh=Gde(),cLe=jde(),uLe=Hde(),hLe=Wde(),dLe=qde();Object.freeze(Object.defineProperty({__proto__:null,ONES:Sh,UNIT_W:dLe,UNIT_X:cLe,UNIT_Y:uLe,UNIT_Z:hLe,ZEROS:Df,clone:G3,create:gi,createView:Bde,fromArray:qj,fromValues:Kt,ones:Gde,unitW:qde,unitX:jde,unitY:Hde,unitZ:Wde,zeros:Vde},Symbol.toStringTag,{value:"Module"}));let mS=class Gv{constructor(e,i,r){this._itemByteSize=e,this._itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this._itemByteSize)}get(){this._itemsPtr===0&&lT(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const i=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this._itemCreate(i,r*this._itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=Cw){return new Gv(16,Dde,e)}static createVec3f64(e=Cw){return new Gv(24,dG,e)}static createVec4f64(e=Cw){return new Gv(32,Bde,e)}static createMat3f64(e=Cw){return new Gv(72,$de,e)}static createMat4f64(e=Cw){return new Gv(128,Rde,e)}static createQuatf64(e=Cw){return new Gv(32,Ide,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const Cw=4*lD.KILOBYTES,L0t=mS.createVec2f64(),Qe=mS.createVec3f64(),Zj=mS.createVec4f64();mS.createMat3f64();const Xj=mS.createMat4f64(),D0t=mS.createQuatf64();function yp(t){return t?{origin:Kn(t.origin),vector:Kn(t.vector)}:{origin:I(),vector:I()}}function pLe(t,e){const i=mLe.get();return i.origin=t,i.vector=e,i}function N0t(t,e=yp()){return fLe(t.origin,t.vector,e)}function fLe(t,e,i=yp()){return fe(i.origin,t),fe(i.vector,e),i}function G1(t,e,i=yp()){return fe(i.origin,t),Ce(i.vector,e,t),i}function Yj(t,e){const i=Ce(Qe.get(),e,t.origin),r=Re(t.vector,i),n=Re(t.vector,t.vector),s=$e(r/n,0,1),o=Ce(Qe.get(),pe(Qe.get(),t.vector,s),i);return Re(o,o)}function F0t(t,e,i){return Mz(t,e,0,1,i)}function k0t(t,e,i){return xe(i,t.origin,pe(i,t.vector,e))}function Mz(t,e,i,r,n){const{vector:s,origin:o}=t,a=Ce(Qe.get(),e,o),l=Re(s,a)/ba(s);return pe(n,s,$e(l,i,r)),xe(n,n,t.origin)}function U0t(t,e){if(Xde(t,pLe(e.origin,e.direction),!1,cD)){const{tA:i,pB:r,distance2:n}=cD;if(i>=0&&i<=1)return n;if(i<0)return Io(t.origin,r);if(i>1)return Io(xe(Qe.get(),t.origin,t.vector),r)}return null}function Zde(t,e,i){return!!Xde(t,e,!0,cD)&&(fe(i,cD.pA),!0)}function Xde(t,e,i,r){const s=t.origin,o=xe(Qe.get(),s,t.vector),a=e.origin,l=xe(Qe.get(),a,e.vector),c=Qe.get(),u=Qe.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const p=Qe.get();if(p[0]=o[0]-s[0],p[1]=o[1]-s[1],p[2]=o[2]-s[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const f=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],y=u[0]*p[0]+u[1]*p[1]+u[2]*p[2],v=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],b=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],x=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*b-y*y;if(Math.abs(x)<1e-6)return!1;let S=(f*y-v*b)/x,P=(f+y*S)/b;i&&(S=$e(S,0,1),P=$e(P,0,1));const C=Qe.get(),R=Qe.get();return C[0]=s[0]+S*p[0],C[1]=s[1]+S*p[1],C[2]=s[2]+S*p[2],R[0]=a[0]+P*u[0],R[1]=a[1]+P*u[1],R[2]=a[2]+P*u[2],r.tA=S,r.tB=P,r.pA=C,r.pB=R,r.distance2=Io(C,R),!0}const cD={tA:0,tB:0,pA:I(),pB:I(),distance2:0},mLe=new Vg(()=>yp());function ho(t){return t?AY(Kn(t.origin),Kn(t.direction)):AY(I(),I())}function AY(t,e){return{origin:t,direction:e}}function z0t(t,e){return Ag(t.origin,e.origin)&&Ag(t.direction,e.direction)}function Cu(t,e){const i=vLe.get();return i.origin=t,i.direction=e,i}function uD(t,e=ho()){return Yde(t.origin,t.direction,e)}function gLe(t,e,i=ho()){return fe(i.origin,t),Ce(i.direction,e,t),i}function Yde(t,e,i=ho()){return fe(i.origin,t),fe(i.direction,e),i}function _Le(t,e){const i=Rt(Qe.get(),Me(Qe.get(),t.direction),Ce(Qe.get(),e,t.origin));return Re(i,i)}function yLe(t,e,i){const r=Re(t.direction,Ce(i,e,t.origin));return xe(i,t.origin,pe(i,t.direction,r)),i}const vLe=new Vg(()=>ho());function FA(t,e){return Re(t,e)/ze(t)}function U5(t,e){const i=Re(t,e)/(ze(t)*ze(e));return-qs(i)}function Jde(t,e,i){Me(CR,t),Me(s6,e);const r=Re(CR,s6),n=qs(r),s=Rt(CR,CR,s6);return Re(s,i)<0?2*Math.PI-n:n}const CR=I(),s6=I(),Kde=kn();function kn(){return gi()}function ST(t,e=kn()){return Ah(e,t)}function Qde(t,e){return Kt(t[0],t[1],t[2],e)}function bLe(t){return t}function wLe(t){t[0]=t[1]=t[2]=t[3]=0}function z5(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function gg(t){return t[3]}function xLe(t){return t}function epe(t,e,i,r){return Kt(t,e,i,r)}function TLe(t,e,i){return t!==i&&fe(i,t),i[3]=t[3]+e,i}function SLe(t,e,i){return ye.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===i?i:ST(t,i)}function My(t,e,i){if(e==null)return!1;const{origin:r,direction:n}=e,s=CLe;s[0]=r[0]-t[0],s[1]=r[1]-t[1],s[2]=r[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(u<0||p<u&&p>0)&&(u=p),!(u<0)&&(i&&(i[0]=r[0]+n[0]*u,i[1]=r[1]+n[1]*u,i[2]=r[2]+n[2]*u),!0)}const CLe=I();function $z(t,e){return My(t,e,null)}function ELe(t,e,i){if(My(t,e,i))return i;const r=gS(t,e,Qe.get());return xe(i,e.origin,pe(Qe.get(),e.direction,Nr(e.origin,r)/ze(e.direction))),i}function gS(t,e,i){const r=Qe.get(),n=Xj.get();Rt(r,e.origin,e.direction);const s=gg(t);Rt(i,r,e.origin),pe(i,i,1/ze(i)*s);const o=rpe(t,e.origin),a=U5(e.origin,i);return Su(n,a+o,r),st(i,i,n),i}function ALe(t,e,i){return My(t,e,i)?i:(yLe(e,t,i),tpe(t,i,i))}function tpe(t,e,i){const r=Ce(Qe.get(),e,t),n=pe(Qe.get(),r,t[3]/ze(r));return xe(i,n,t)}function ipe(t,e){const i=Ce(Qe.get(),e,t),r=ba(i),n=t[3]*t[3];return Math.sqrt(Math.abs(r-n))}function rpe(t,e){const i=Ce(Qe.get(),e,t),r=ze(i),n=gg(t),s=n+Math.abs(n-r);return qs(n/s)}const o6=I();function npe(t,e,i,r){const n=Ce(o6,e,t);switch(i){case bc.X:{const s=iX(n,o6)[2];return me(r,-Math.sin(s),Math.cos(s),0)}case bc.Y:{const s=iX(n,o6),o=s[1],a=s[2],l=Math.sin(o);return me(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case bc.Z:return Me(r,n);default:return}}function spe(t,e){const i=Ce(Iz,e,t);return ze(i)-t[3]}function PLe(t,e,i,r){const n=spe(t,e),s=npe(t,e,bc.Z,Iz),o=pe(Iz,s,i-n);return xe(r,e,o)}function OLe(t,e){const i=Io(t,e),r=gg(t);return i<=r*r}function RLe(t,e,i=kn()){const r=Nr(t,e),n=t[3],s=e[3];return r+s<n?(Ah(i,t),i):r+n<s?(Ah(i,e),i):(pr(i,t,e,(r+s-n)/(2*r)),i[3]=(r+n+s)/2,i)}const Iz=I(),B5=kn(),MLe=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:Kde,altitudeAt:spe,angleToSilhouette:rpe,axisAt:npe,clear:wLe,closestPoint:ALe,closestPointOnSilhouette:gS,containsPoint:OLe,copy:ST,create:kn,distanceToSilhouette:ipe,elevate:TLe,fromCenterAndRadius:Qde,fromRadius:z5,fromValues:epe,getCenter:xLe,getRadius:gg,intersectRay:My,intersectRayClosestSilhouette:ELe,intersectsRay:$z,projectPoint:tpe,setAltitudeAt:PLe,setExtent:SLe,tmpSphere:B5,union:RLe,wrap:bLe},Symbol.toStringTag,{value:"Module"}));function CT(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],i=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],r=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}function $Le(t,e){const i=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),r=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return me(t,i,r,n),t}function B0t(t,e,i){i=i||t;const r=Re(t,e);me(i,t[0]-r*e[0],t[1]-r*e[1],t[2]-r*e[2]),Me(i,i)}function V0t(t,e,i){Math.abs(t[0])>Math.abs(t[1])?me(e,0,1,0):me(e,1,0,0),Rt(i,t,e),Me(e,e),Rt(e,i,t),Me(i,i)}function ER(t,e,i,r,n,s){const o=t+(e-t)*n;return o+(i+(r-i)*n-o)*s}function ILe(t,e,i,r=I()){const n=ze(t),s=ze(e),o=Re(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*n+i*s)/Math.sin(a),c=l/n*Math.sin((1-i)*a),u=l/s*Math.sin(i*a);return pe(M1,t,c),pe($1,e,u),xe(r,M1,$1)}return pr(r,t,e,i)}function G0t(t,e,i,r=I(),n=I()){const s=ze(t),o=ze(e),a=Re(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(i*l),p=Math.sin((1-i)*l),f=(1-i)*s+i*o;{const y=f/c,v=y/o*u;pe(M1,t,y/s*p),pe($1,e,v),xe(r,M1,$1)}{const y=1/s*(-Math.cos((1-i)*l)*l*f+p*(-s+o));pe(M1,t,y);const v=1/o*(Math.cos(i*l)*l*f+u*(-s+o));pe($1,e,v),xe(n,M1,$1),pe(n,n,1/c)}return n}return pr(r,t,e,i),Ce(n,e,t),Me(n,n),n}function bI(t,e,i){t=Me(M1,t),e=Me($1,e);const r=qs(Re(t,e));if(i){const n=Rt(LLe,t,e);if(Re(n,i)<0)return-r}return r}function wI(t){const e=t.length;return i=>{if(i<=t[0][0])return t[0][1];if(i>=t[e-1][0])return t[e-1][1];let r=1;for(;i>t[r][0];)r++;const n=t[r-1][0],s=t[r][0],o=(s-i)/(s-n);return o*t[r-1][1]+(1-o)*t[r][1]}}function j0t(t,e,i,r){Ce(PY,e,t),Ce(OY,i,t),Rt(r,PY,OY),Me(r,r),r[3]=-Re(t,r)}const PY=I(),OY=I(),LLe=I(),M1=I(),$1=I();function Yi(t=IE){return[t[0],t[1],t[2],t[3]]}function DLe(t=IE[0],e=IE[1],i=IE[2],r=IE[3]){return Jj(t,e,i,r,Zj.get())}function V5(t,e){return Jj(e[0],e[1],e[2],e[3],t)}function Jj(t,e,i,r,n=Yi()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function ope(t,e,i){return fe(i,t),i[3]=e,i}function j3(t,e,i){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function ya(t,e,i,r=Yi()){const n=i[0]-e[0],s=i[1]-e[1],o=i[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=s*c-o*l,p=o*a-n*c,f=n*l-s*a,y=u*u+p*p+f*f,v=Math.abs(y-1)>1e-5&&y>1e-12?1/Math.sqrt(y):1;return r[0]=u*v,r[1]=p*v,r[2]=f*v,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function ape(t,e,i,r,n){const s=t.length/3;if(s<3)return!1;me(hC,t[3*i],t[3*i+1],t[3*i+2]);let o=r,a=!1;for(;o<s-1&&!a;){const l=3*o;me(Ew,t[l],t[l+1],t[l+2]),o++,a=!xa(hC,Ew)}if(!a)return!1;for(o=Math.max(o,n),a=!1;o<s&&!a;){const l=3*o;me(m1,t[l],t[l+1],t[l+2]),o++,Ce(AR,hC,Ew),Me(AR,AR),Ce(PR,Ew,m1),Me(PR,PR),a=!xa(hC,m1)&&!xa(Ew,m1)&&Math.abs(Re(AR,PR))<NLe}return a?(ya(hC,Ew,m1,e),!0):(i!==0||r!==1||n!==2)&&ape(t,e,0,1,2)}const NLe=.99619469809,hC=I(),Ew=I(),m1=I(),AR=I(),PR=I();function Lz(t,e,i){return e!==t&&V5(t,e),t[3]=-Re(t,i),t}function Dz(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function NP(t,e,i,r){return Rt(m1,e,t),j3(i,m1,r)}function H0t(t,e,i,r){return G5(t,e,Ce(Qe.get(),i,e),VLe,r)}function Wb(t,e,i){return e!=null&&G5(t,e.origin,e.direction,GLe,i)}function FLe(t,e,i){return G5(t,e.origin,e.vector,Nf.NONE,i)}function kLe(t,e,i){return G5(t,e.origin,e.vector,Nf.CLAMP,i)}function lpe(t,e){return Dr(t,e)>=0}function ULe(t,e){const i=Re(t,e.ray.direction),r=-Dr(t,e.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function zLe(t,e){const i=Re(t,e.ray.direction),r=-Dr(t,e.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const n=r/i;return i>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function BLe(t,e,i){const r=pe(Qe.get(),t,-t[3]),n=Nz(t,Ce(Qe.get(),e,r),Qe.get());return xe(i,n,r),i}function Nz(t,e,i){const r=pe(Qe.get(),t,Re(t,e));return Ce(i,e,r),i}function Dr(t,e){return Re(t,e)+t[3]}function G5(t,e,i,r,n){const s=Re(t,i);if(s===0)return!1;let o=-(Re(t,e)+t[3])/s;return r&Nf.CLAMP&&(o=$e(o,0,1)),!(!(r&Nf.INFINITE_MIN)&&o<0||!(r&Nf.INFINITE_MAX)&&o>1)&&(xe(n,e,pe(n,i,o)),!0)}function W0t(t){return t}const IE=[0,0,1,0];var Nf;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Nf||(Nf={}));const VLe=Nf.INFINITE_MIN|Nf.INFINITE_MAX,GLe=Nf.INFINITE_MAX,a6=ye.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let jLe=class{constructor(){this.plane=Yi(),this.origin=I(),this.basis1=I(),this.basis2=I()}};const cpe=jLe;function Gg(t=bpe){return{plane:Yi(t.plane),origin:Kn(t.origin),basis1:Kn(t.basis1),basis2:Kn(t.basis2)}}function HLe(t,e,i){const r=rDe.get();return r.origin=t,r.basis1=e,r.basis2=i,r.plane=DLe(0,0,0,0),j5(r),r}function qb(t,e=Gg()){return Kj(t.origin,t.basis1,t.basis2,e)}function WLe(t,e){fe(e.origin,t.origin),fe(e.basis1,t.basis1),fe(e.basis2,t.basis2),V5(e.plane,t.plane)}function Kj(t,e,i,r=Gg()){return fe(r.origin,t),fe(r.basis1,e),fe(r.basis2,i),j5(r),tDe(r,"fromValues()"),r}function j5(t){NP(t.basis2,t.basis1,t.origin,t.plane)}function upe(t,e,i){t!==i&&qb(t,i);const r=pe(Qe.get(),Ig(t),e);return xe(i.origin,i.origin,r),i.plane[3]-=e,i}function qLe(t,e,i){return hpe(e,i),upe(i,iH(t,t.origin),i),i}function hpe(t,e=Gg()){const i=(t[2]-t[0])/2,r=(t[3]-t[1])/2;return me(e.origin,t[0]+i,t[1]+r,0),me(e.basis1,i,0,0),me(e.basis2,0,r,0),Jj(0,0,1,0,e.plane),e}function Qj(t,e,i){return!!Wb(t.plane,e,i)&&ype(t,i)}function ZLe(t,e,i){if(Qj(t,e,i))return i;const r=dpe(t,e,Qe.get());return xe(i,e.origin,pe(Qe.get(),e.direction,Nr(e.origin,r)/ze(e.direction))),i}function dpe(t,e,i){const r=hD.get();vpe(t,e,r,hD.get());let n=Number.POSITIVE_INFINITY;for(const s of nH){const o=rH(t,s,H5.get()),a=Qe.get();if(FLe(r,o,a)){const l=zg(Qe.get(),e.origin,a),c=Math.abs(qs(Re(e.direction,l)));c<n&&(n=c,fe(i,a))}}return n===Number.POSITIVE_INFINITY?ppe(t,e,i):i}function ppe(t,e,i){if(Qj(t,e,i))return i;const r=hD.get(),n=hD.get();vpe(t,e,r,n);let s=Number.POSITIVE_INFINITY;for(const o of nH){const a=rH(t,o,H5.get()),l=Qe.get();if(kLe(r,a,l)){const c=_Le(e,l);if(!lpe(n,l))continue;c<s&&(s=c,fe(i,l))}}return eH(t,e.origin)<s&&fpe(t,e.origin,i),i}function fpe(t,e,i){const r=BLe(t.plane,e,Qe.get()),n=Mz(RY(t,t.basis1),r,-1,1,Qe.get()),s=Mz(RY(t,t.basis2),r,-1,1,Qe.get());return Ce(i,xe(Qe.get(),n,s),t.origin),i}function mpe(t,e,i){const{origin:r,basis1:n,basis2:s}=t,o=Ce(Qe.get(),e,r),a=FA(n,o),l=FA(s,o),c=FA(Ig(t),o);return me(i,a,l,c)}function eH(t,e){const i=mpe(t,e,Qe.get()),{basis1:r,basis2:n}=t,s=ze(r),o=ze(n),a=Math.max(Math.abs(i[0])-s,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function XLe(t,e){return Math.sqrt(eH(t,e))}function YLe(t,e){let i=Number.NEGATIVE_INFINITY;for(const r of nH){const n=rH(t,r,H5.get()),s=Yj(n,e);s>i&&(i=s)}return Math.sqrt(i)}function tH(t,e){return lpe(t.plane,e)&&ype(t,e)}function JLe(t,e,i,r){return eDe(t,i,r)}function iH(t,e){const i=-t.plane[3];return FA(Ig(t),e)-i}function KLe(t,e,i,r){const n=iH(t,e),s=pe(iDe,Ig(t),i-n);return xe(r,e,s),r}function gpe(t,e){return xa(t.basis1,e.basis1)&&xa(t.basis2,e.basis2)&&xa(t.origin,e.origin)}function _pe(t,e,i){return t!==i&&qb(t,i),fo(Aw,e),Cc(Aw,Aw),st(i.basis1,t.basis1,Aw),st(i.basis2,t.basis2,Aw),st(i.plane,t.plane,Aw),st(i.origin,t.origin,e),Lz(i.plane,i.plane,i.origin),i}function QLe(t,e,i,r){return t!==r&&qb(t,r),Su(l6,e,i),st(r.basis1,t.basis1,l6),st(r.basis2,t.basis2,l6),j5(r),r}function Ig(t){return t.plane}function eDe(t,e,i){switch(e){case bc.X:fe(i,t.basis1),Me(i,i);break;case bc.Y:fe(i,t.basis2),Me(i,i);break;case bc.Z:fe(i,Ig(t))}return i}function ype(t,e){const i=Ce(Qe.get(),e,t.origin),r=ba(t.basis1),n=ba(t.basis2),s=Re(t.basis1,i),o=Re(t.basis2,i);return-s-r<0&&s-r<0&&-o-n<0&&o-n<0}function RY(t,e){const i=H5.get();return fe(i.origin,t.origin),fe(i.vector,e),i}function rH(t,e,i){const{basis1:r,basis2:n,origin:s}=t,o=pe(Qe.get(),r,e.origin[0]),a=pe(Qe.get(),n,e.origin[1]);xe(i.origin,o,a),xe(i.origin,i.origin,s);const l=pe(Qe.get(),r,e.direction[0]),c=pe(Qe.get(),n,e.direction[1]);return pe(i.vector,xe(l,l,c),2),i}function tDe(t,e){Math.abs(Re(t.basis1,t.basis2)/(ze(t.basis1)*ze(t.basis2)))>1e-6&&a6.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(Re(t.basis1,Ig(t)))>1e-6&&a6.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-Re(Ig(t),t.origin)-t.plane[3])>1e-6&&a6.warn(e,"Plane offset is not consistent with plane origin")}function vpe(t,e,i,r){const n=Ig(t);NP(n,e.direction,e.origin,i),NP(i,n,e.origin,r)}const bpe={plane:Yi(),origin:Ge(0,0,0),basis1:Ge(1,0,0),basis2:Ge(0,1,0)},hD=new Vg(Yi),H5=new Vg(yp),iDe=I(),rDe=new Vg(()=>Gg()),nH=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Aw=Ne(),l6=Ne(),nDe=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:cpe,UP:bpe,altitudeAt:iH,axisAt:JLe,closestPoint:ppe,closestPointOnSilhouette:dpe,copy:qb,copyWithoutVerify:WLe,create:Gg,distance:XLe,distance2:eH,distanceToSilhouette:YLe,elevate:upe,equals:gpe,extrusionContainsPoint:tH,fromAABoundingRect:hpe,fromValues:Kj,intersectRay:Qj,intersectRayClosestSilhouette:ZLe,normal:Ig,projectPoint:fpe,projectPointLocal:mpe,rotate:QLe,setAltitudeAt:KLe,setExtent:qLe,transform:_pe,updateUnboundedPlane:j5,wrap:HLe},Symbol.toStringTag,{value:"Module"})),sDe=new jt(yle),MY=new jt(PG),$Y=new jt(OG),Z0t=new jt(vle);function W5(t){return t&&(tm(t)||go(t,MY))?MY:t&&(im(t)||go(t,$Y))?$Y:sDe}function oDe(t){const{value:e,operations:i}=t;return{operations:i,value:i.create(e)}}function aDe(t,e,i){return t.operations.setExtent(t.value,e,i.value),i}function lDe(t){return{operations:t,value:t.create()}}function wpe(t,e,i=lDe(t)){return i.operations=t,t.copy(e,i.value),i}function cDe(t){return wpe(MLe,epe(0,0,0,lr(t).radius))}const IY=2**50;function uDe(){return wpe(nDe,Kj([0,0,0],[IY,0,0],[0,IY,0]))}function hDe(t,e,i){return t.operations.axisAt(t.value,e,bc.Z,i)}function dDe(t,e,i,r){return t.operations.axisAt(t.value,e,i,r)}function pDe(t,e,i){return t.operations.intersectRay(t.value,e,i)}function fDe(t,e,i){return t.operations.intersectRayClosestSilhouette(t.value,e,i)}function mDe(t,e){return t.operations.altitudeAt(t.value,e)}function xpe(t,e,i,r){return t.operations.setAltitudeAt(t.value,e,i,r)}function gDe(t,e,i,r){return e!==r&&Qn(r,e),me(Pw,r[12],r[13],r[14]),xpe(t,Pw,i,Pw),r[12]=Pw[0],r[13]=Pw[1],r[14]=Pw[2],r}function c6(t,e,i){return t.operations.elevate(t.value,e,i.value)}const Pw=I();function LY(t,e,i,r,n){return n[0]=Re(t,e),n[1]=Re(t,i),n[2]=Re(t,r),n}function Fz(t,e,i,r,n){fe(i,t),fe(OR,e),Me(OR,OR),Rt(r,OR,i),Rt(n,r,i)}function _De(t,e){return t?W5(e):e.isGeographic?jt.PlateCarree:e}const OR=I(),sH=96;function X0t(t,e){const i=e||t.extent,r=t.width,n=al(i&&i.spatialReference);return i&&r?i.width/r*n*RG*sH:0}function yDe(t,e){return t/(al(e)*RG*sH)}function vDe(t){return t/(RG*sH)}const bDe="OBJECTID";function Y0t(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function kA(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function ET(t){return t!=null&&"type"in t&&t.type==="group"}const J0t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function wDe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function DY(t){return(t==null?void 0:t.type)==="voxel"}function NY(t){return(t==null?void 0:t.type)==="imagery-tile"}function Tpe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function oH(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function K0t(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function xDe(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const i=t.activeLayer.tileMatrixSets;if(i)return i}return null}async function Q0t(t,e){const i=En==null?void 0:En.findServerInfo(t);if((i==null?void 0:i.currentVersion)!=null)return i.owningSystemUrl||null;const r=t.toLowerCase().indexOf("/rest/services");if(r===-1)return null;const n=`${t.substring(0,r)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await ps(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function TDe(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function SDe(t){return TDe(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function CDe(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function EDe(t){return!!CDe(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}let AT=class extends IA{constructor(e){super(e),this.handles.add(this.on("before-add",i=>{i.item!=null&&i.item.parent===this.owner&&(ye.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),i.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};AT=d([J("esri.support.AnalysesCollection")],AT);const xI={widthBreakpoint:{getValue(t){const e=t.viewSize[0],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],i=t.breakpoints,r=this.values;return e<=i.xsmall?r.xsmall:e<=i.small?r.small:e<=i.medium?r.medium:e<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,i=e[0],r=e[1],n=this.values;return r>=i?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},u6={xsmall:544,small:768,medium:992,large:1200};function ADe(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function h6(t,e){return e?xI[t].valueToClassName[e].split(" "):[]}const PDe=t=>{let e=class extends t{constructor(...i){super(...i),this._breakpointsHandles=new an,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=u6}initialize(){this._breakpointsHandles.add(Pe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),ar))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Je(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=ADe(i);if(!r){const n=JSON.stringify(u6,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}i=r?i:u6,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=fc.acquire(),r=fc.acquire();let n,s=!1;for(n in xI){const o=this[n],a=xI[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,h6(n,o).forEach(l=>r.push(l)),h6(n,a).forEach(l=>i.push(l)))}s&&(this._applyClassNameChanges(i,r),fc.release(i),fc.release(r))}_applyClassNameChanges(i,r){const n=this.container;n&&(r.forEach(s=>n.classList.remove(s)),i.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in xI)h6(r,this[r]).forEach(n=>i.classList.remove(n))}};return d([m()],e.prototype,"breakpoints",null),d([m()],e.prototype,"orientation",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),d([m()],e.prototype,"heightBreakpoint",void 0),e=d([J("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var ODe=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},g1={exports:{}},gs={},FP={exports:{}},Zb={};function Spe(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function RDe(t,e,i){}function MDe(t,e,i){}var $De=/javascript\s*\:/img;function IDe(t,e){return $De.test(e)?"":e}Zb.whiteList=Spe();Zb.getDefaultWhiteList=Spe;Zb.onAttr=RDe;Zb.onIgnoreAttr=MDe;Zb.safeAttrValue=IDe;var LDe={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},dC=LDe;function DDe(t,e){t=dC.trimRight(t),t[t.length-1]!==";"&&(t+=";");var i=t.length,r=!1,n=0,s=0,o="";function a(){if(!r){var u=dC.trim(t.slice(n,s)),p=u.indexOf(":");if(p!==-1){var f=dC.trim(u.slice(0,p)),y=dC.trim(u.slice(p+1));if(f){var v=e(n,o.length,f,y,u);v&&(o+=v+"; ")}}}n=s+1}for(;s<i;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return dC.trim(o)}var NDe=DDe,RR=Zb,FDe=NDe;function FY(t){return t==null}function kDe(t){var e={};for(var i in t)e[i]=t[i];return e}function Cpe(t){t=kDe(t||{}),t.whiteList=t.whiteList||RR.whiteList,t.onAttr=t.onAttr||RR.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||RR.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||RR.safeAttrValue,this.options=t}Cpe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onAttr,s=i.onIgnoreAttr,o=i.safeAttrValue,a=FDe(t,function(l,c,u,p,f){var y=r[u],v=!1;if(y===!0?v=y:typeof y=="function"?v=y(p):y instanceof RegExp&&(v=y.test(p)),v!==!0&&(v=!1),p=o(u,p),!!p){var b={position:c,sourcePosition:l,source:f,isWhite:v};if(v){var x=n(u,p,b);return FY(x)?u+":"+p:x}else{var x=s(u,p,b);if(!FY(x))return x}}});return a};var UDe=Cpe;(function(t,e){var i=Zb,r=UDe;function n(o,a){var l=new r(a);return l.process(o)}e=t.exports=n,e.FilterCSS=r;for(var s in i)e[s]=i[s]})(FP,FP.exports);var aH={indexOf:function(t,e){var i,r;if(Array.prototype.indexOf)return t.indexOf(e);for(i=0,r=t.length;i<r;i++)if(t[i]===e)return i;return-1},forEach:function(t,e,i){var r,n;if(Array.prototype.forEach)return t.forEach(e,i);for(r=0,n=t.length;r<n;r++)e.call(i,t[r],r,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,i=e.exec(t);return i?i.index:-1}},zDe=FP.exports.FilterCSS,BDe=FP.exports.getDefaultWhiteList,dD=aH;function Epe(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Ape=new zDe;function VDe(t,e,i){}function GDe(t,e,i){}function jDe(t,e,i){}function HDe(t,e,i){}function Ppe(t){return t.replace(qDe,"&lt;").replace(ZDe,"&gt;")}function WDe(t,e,i,r){if(i=Lpe(i),e==="href"||e==="src"){if(i=dD.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(e==="background"){if(MR.lastIndex=0,MR.test(i))return""}else if(e==="style"){if(kY.lastIndex=0,kY.test(i)||(UY.lastIndex=0,UY.test(i)&&(MR.lastIndex=0,MR.test(i))))return"";r!==!1&&(r=r||Ape,i=r.process(i))}return i=Dpe(i),i}var qDe=/</g,ZDe=/>/g,XDe=/"/g,YDe=/&quot;/g,JDe=/&#([a-zA-Z0-9]*);?/gim,KDe=/&colon;?/gim,QDe=/&newline;?/gim,MR=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,kY=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,UY=/u\s*r\s*l\s*\(.*/gi;function Ope(t){return t.replace(XDe,"&quot;")}function Rpe(t){return t.replace(YDe,'"')}function Mpe(t){return t.replace(JDe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function $pe(t){return t.replace(KDe,":").replace(QDe," ")}function Ipe(t){for(var e="",i=0,r=t.length;i<r;i++)e+=t.charCodeAt(i)<32?" ":t.charAt(i);return dD.trim(e)}function Lpe(t){return t=Rpe(t),t=Mpe(t),t=$pe(t),t=Ipe(t),t}function Dpe(t){return t=Ope(t),t=Ppe(t),t}function eNe(){return""}function tNe(t,e){typeof e!="function"&&(e=function(){});var i=!Array.isArray(t);function r(o){return i?!0:dD.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return dD.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function iNe(t){for(var e="",i=0;i<t.length;){var r=t.indexOf("<!--",i);if(r===-1){e+=t.slice(i);break}e+=t.slice(i,r);var n=t.indexOf("-->",r);if(n===-1)break;i=n+3}return e}function rNe(t){var e=t.split("");return e=e.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),e.join("")}gs.whiteList=Epe();gs.getDefaultWhiteList=Epe;gs.onTag=VDe;gs.onIgnoreTag=GDe;gs.onTagAttr=jDe;gs.onIgnoreTagAttr=HDe;gs.safeAttrValue=WDe;gs.escapeHtml=Ppe;gs.escapeQuote=Ope;gs.unescapeQuote=Rpe;gs.escapeHtmlEntities=Mpe;gs.escapeDangerHtml5Entities=$pe;gs.clearNonPrintableCharacter=Ipe;gs.friendlyAttrValue=Lpe;gs.escapeAttrValue=Dpe;gs.onIgnoreTagStripAll=eNe;gs.StripTagBody=tNe;gs.stripCommentTag=iNe;gs.stripBlankChar=rNe;gs.cssFilter=Ape;gs.getDefaultCSSWhiteList=BDe;var q5={},m_=aH;function nNe(t){var e=m_.spaceIndex(t),i;return e===-1?i=t.slice(1,-1):i=t.slice(1,e+1),i=m_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function sNe(t){return t.slice(0,2)==="</"}function oNe(t,e,i){var r="",n=0,s=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var p=t.charAt(a);if(s===!1){if(p==="<"){s=a;continue}}else if(o===!1){if(p==="<"){r+=i(t.slice(n,a)),s=a,n=a;continue}if(p===">"){r+=i(t.slice(n,s)),u=t.slice(s,a+1),c=nNe(u),r+=e(s,r.length,c,u,sNe(u)),n=a+1,s=!1;continue}if(p==='"'||p==="'")for(var f=1,y=t.charAt(a-f);y.trim()===""||y==="=";){if(y==="="){o=p;continue e}y=t.charAt(a-++f)}}else if(p===o){o=!1;continue}}return n<t.length&&(r+=i(t.substr(n))),r}var aNe=/[^a-zA-Z0-9\\_:.-]/gim;function lNe(t,e){var i=0,r=0,n=[],s=!1,o=t.length;function a(f,y){if(f=m_.trim(f),f=f.replace(aNe,"").toLowerCase(),!(f.length<1)){var v=e(f,y||"");v&&n.push(v)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,p;if(s===!1&&c==="="){s=t.slice(i,l),i=l+1,r=t.charAt(i)==='"'||t.charAt(i)==="'"?i:uNe(t,l+1);continue}if(s!==!1&&l===r){if(p=t.indexOf(c,l+1),p===-1)break;u=m_.trim(t.slice(r+1,p)),a(s,u),s=!1,l=p,i=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(p=cNe(t,l),p===-1){u=m_.trim(t.slice(i,l)),a(u),s=!1,i=l+1;continue}else{l=p-1;continue}else if(p=hNe(t,l-1),p===-1){u=m_.trim(t.slice(i,l)),u=zY(u),a(s,u),s=!1,i=l+1;continue}else continue}return i<t.length&&(s===!1?a(t.slice(i)):a(s,zY(m_.trim(t.slice(i))))),m_.trim(n.join(" "))}function cNe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="="?e:-1}}function uNe(t,e){for(;e<t.length;e++){var i=t[e];if(i!==" ")return i==="'"||i==='"'?e:-1}}function hNe(t,e){for(;e>0;e--){var i=t[e];if(i!==" ")return i==="="?e:-1}}function dNe(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function zY(t){return dNe(t)?t.substr(1,t.length-2):t}q5.parseTag=oNe;q5.parseAttr=lNe;var pNe=FP.exports.FilterCSS,Fd=gs,Npe=q5,fNe=Npe.parseTag,mNe=Npe.parseAttr,TI=aH;function $R(t){return t==null}function gNe(t){var e=TI.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=TI.trim(t.slice(e+1,-1));var i=t[t.length-1]==="/";return i&&(t=TI.trim(t.slice(0,-1))),{html:t,closing:i}}function _Ne(t){var e={};for(var i in t)e[i]=t[i];return e}function yNe(t){var e={};for(var i in t)Array.isArray(t[i])?e[i.toLowerCase()]=t[i].map(function(r){return r.toLowerCase()}):e[i.toLowerCase()]=t[i];return e}function Fpe(t){t=_Ne(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=Fd.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=yNe(t.whiteList||t.allowList):t.whiteList=Fd.whiteList,t.onTag=t.onTag||Fd.onTag,t.onTagAttr=t.onTagAttr||Fd.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||Fd.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||Fd.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||Fd.safeAttrValue,t.escapeHtml=t.escapeHtml||Fd.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new pNe(t.css))}Fpe.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,i=e.options,r=i.whiteList,n=i.onTag,s=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,u=e.cssFilter;i.stripBlankChar&&(t=Fd.stripBlankChar(t)),i.allowCommentTag||(t=Fd.stripCommentTag(t));var p=!1;i.stripIgnoreTagBody&&(p=Fd.StripTagBody(i.stripIgnoreTagBody,s),s=p.onIgnoreTag);var f=fNe(t,function(y,v,b,x,S){var P={sourcePosition:y,position:v,isClosing:S,isWhite:Object.prototype.hasOwnProperty.call(r,b)},C=n(b,x,P);if(!$R(C))return C;if(P.isWhite){if(P.isClosing)return"</"+b+">";var R=gNe(x),N=r[b],$=mNe(R.html,function(k,B){var W=TI.indexOf(N,k)!==-1,Z=o(b,k,B,W);return $R(Z)?W?(B=l(b,k,B,u),B?k+'="'+B+'"':k):(Z=a(b,k,B,W),$R(Z)?void 0:Z):Z});return x="<"+b,$&&(x+=" "+$),R.closing&&(x+=" /"),x+=">",x}else return C=s(b,x,P),$R(C)?c(x):C},c);return p&&(f=p.remove(f)),f};var vNe=Fpe;(function(t,e){var i=gs,r=q5,n=vNe;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in i)e[a]=i[a];for(var l in r)e[l]=r[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(g1,g1.exports);var bNe=function(){function t(e,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?r.sanitizeUrl(a):g1.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!i?n=e:e&&i?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new g1.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,i){switch(i===void 0&&(i={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,i);default:return i.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,i){var r=(i??{}).isProtocolRequired,n=r===void 0?!0:r,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?g1.exports.escapeAttrValue(e):!s&&!n?g1.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,i,r,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,i,r,n):g1.exports.safeAttrValue(e,i,r,n)},t.prototype.validate=function(e,i){i===void 0&&(i={});var r=this.sanitize(e,i);return{isValid:e===r,sanitized:r}},t.prototype.encodeHTML=function(e){var i=this;return String(e).replace(/[&<>"'\/]/g,function(r){return i._entityMap[r]})},t.prototype.encodeAttrValue=function(e){var i=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(r,n){return i.test(r)?r:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var i={};return e.forEach(function(r){Object.keys(r).forEach(function(n){Array.isArray(r[n])&&Array.isArray(i[n])?i[n]=i[n].concat(r[n]):i[n]=r[n]})}),i},t.prototype._iterateOverObject=function(e,i){var r=this;i===void 0&&(i={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(ODe(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],u=r.validate(c,i);return u.isValid?a[l]=c:(n=!0,a[l]=u.sanitized),a},{})}else return i.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const Z5=new Map;function kpe(){Z5.clear()}function wNe(t){return Z5.get(t)}function xNe(t,e){Z5.set(t,e)}function d6(t){Z5.delete(t)}var yb,PT,TNe=function(t){if("WebkitTransition"in t.style)yb="webkitTransitionEnd",PT="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");yb="transitionend",PT="animationend"}},Upe=function(t){yb||TNe(t)},SNe=function(t,e){return e===void 0&&(e=t+"-active"),function(i){Upe(i);var r=!1,n=function(s){r||(r=!0,i.removeEventListener(yb,n),i.removeEventListener(PT,n),i.classList.remove(t),i.classList.remove(e))};i.classList.add(t),i.addEventListener(yb,n),i.addEventListener(PT,n),requestAnimationFrame(function(){i.classList.add(e)})}},CNe=function(t,e){return e===void 0&&(e=t+"-active"),function(i,r){Upe(i);var n=!1,s=function(o){n||(n=!0,i.removeEventListener(yb,s),i.removeEventListener(PT,s),r())};i.classList.add(t),i.addEventListener(yb,s),i.addEventListener(PT,s),requestAnimationFrame(function(){i.classList.add(e)})}};const ENe=ye.getLogger("esri.widgets.support.widgetUtils");function ANe(t){const e=fc.acquire();for(let r=0;r<arguments.length;r++){const n=arguments[r],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const i=e.join(" ");return fc.release(e),i}(()=>{const t=new Map,e=new ResizeObserver(r=>{var n;kpe();for(const s of r)(n=t.get(s.target))==null||n(s)}),i=(r,n,s)=>(t.has(r)&&ENe.error("Already observing element",r),t.set(r,n),e.observe(r,s),il(()=>{e.unobserve(r),t.delete(r)}));return(r,n,s)=>{let o=null;return Pe(()=>typeof r=="function"?r():r,a=>{o==null||o.remove(),a&&(o=i(a,n,s))},qn)}})();function PNe(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function t_t(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function i_t(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function r_t(t,e){return(t==="enter"?SNe:CNe)(e)}const ONe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],RNe=ONe.reduce((t,e)=>(t[e]=[],t),{}),MNe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],zpe=new bNe({whiteList:RNe,onTagAttr:(t,e,i)=>{const r=`${e}="${i}"`;if(MNe.includes(e))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function $Ne(t){return t==="Enter"||t===" "}const Bpe="http://www.w3.org/",X5=`${Bpe}2000/svg`,Vpe=`${Bpe}1999/xlink`;let BY=[],lH=(t,e)=>{let i={};return Object.keys(t).forEach(r=>{i[r]=t[r]}),e&&Object.keys(e).forEach(r=>{i[r]=e[r]}),i},cH=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Gpe=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},INe=(t,e,i)=>{if(e.vnodeSelector!==""){for(let r=i;r<t.length;r++)if(cH(t[r],e))return r}return-1},p6=(t,e,i,r)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(cH(a,n))throw new Error(`${i.vnodeSelector} had a ${n.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},LNe=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},kz=[],Uz=!1,jpe=t=>{(t.children||[]).forEach(jpe),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},VY=()=>{Uz=!1,kz.forEach(jpe),kz.length=0},GY=t=>{kz.push(t),Uz||(Uz=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(VY,{timeout:16}):setTimeout(VY,16))},jY=t=>{let e=t.domNode;if(t.properties){let i=t.properties.exitAnimation;if(i)return e.style.pointerEvents="none",void i(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),GY(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),GY(t))},DNe=(t,e,i)=>{if(!e)return;let r=i.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")zz(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let p=0;p<u;p++){let f=c[p];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let p=0;p<u;p++){let f=c[p],y=l[f];y&&(Gpe(y),i.styleApplyer(t,f,y))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(p){u.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),t[a]=l):i.namespace===X5?a==="href"?t.setAttributeNS(Vpe,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=zpe.sanitize(l):Hpe(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function Hpe(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let pD,NNe=(t,e,i)=>{if(e)for(let r of e)v2(r,t,void 0,i)},Wpe=(t,e,i)=>{NNe(t,e.children,i),e.text&&(t.textContent=e.text),DNe(t,e.properties,i),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,i,e.vnodeSelector,e.properties,e.children])},v2=(t,e,i,r)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),i!==void 0?e.insertBefore(n,i):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(s-1),p=o.slice(s,l);u==="."?n.classList.add(p):u==="#"?n.id=p:(p==="svg"&&(r=lH(r,{namespace:X5})),r.namespace!==void 0?n=t.domNode=a.createElementNS(r.namespace,p):(n=t.domNode=t.domNode||a.createElement(p),p==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),i!==void 0?e.insertBefore(n,i):n.parentNode!==e&&e.appendChild(n)),s=l+1}}Wpe(n,t,r)}},zz=(t,e,i)=>{e&&e.split(" ").forEach(r=>{r&&t.classList.toggle(r,i)})},FNe=(t,e,i,r)=>{if(!i)return;let n=!1,s=Object.keys(i),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=i[l],u=e[l];if(l==="class")u!==c&&(zz(t,u,!1),zz(t,c,!0));else if(l==="classes"){let p=t.classList,f=Object.keys(c),y=f.length;for(let v=0;v<y;v++){let b=f[v],x=!!c[b];x!==!!u[b]&&(n=!0,x?p.add(b):p.remove(b))}}else if(l==="styles"){let p=Object.keys(c),f=p.length;for(let y=0;y<f;y++){let v=p[y],b=c[v];b!==u[v]&&(n=!0,b?(Gpe(b),r.styleApplyer(t,v,b)):r.styleApplyer(t,v,""))}}else if(c||typeof u!="string"||(c=""),l==="value"){let p=t[l];p!==c&&(t["oninput-value"]?p===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(n=!0)}else if(c!==u){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===X5?l==="href"?t.setAttributeNS(Vpe,l,c):t.setAttribute(l,c):p==="string"?l==="innerHTML"?t[l]=zpe.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):Hpe(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}return n},kNe=(t,e,i,r,n)=>{if(i===r)return!1;r=r||BY;let s,o=(i=i||BY).length,a=r.length,l=0,c=0,u=!1;for(;c<a;){let p=l<o?i[l]:void 0,f=r[c];if(p!==void 0&&cH(p,f))u=pD(p,f,n)||u,l++;else{let y=INe(i,f,l+1);if(y>=0){for(s=l;s<y;s++)jY(i[s]),p6(i,s,t,"removed");u=pD(i[y],f,n)||u,l=y+1}else v2(f,e,l<o?i[l].domNode:void 0,n),LNe(f),p6(r,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)jY(i[s]),p6(i,s,t,"removed");return u};pD=(t,e,i)=>{let r=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=r.ownerDocument.createTextNode(e.text);return r.parentNode.replaceChild(o,r),e.domNode=o,n=!0,n}e.domNode=r}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(i=lH(i,{namespace:X5})),t.text!==e.text&&(s=!0,e.text===void 0?r.removeChild(r.firstChild):r.textContent=e.text),e.domNode=r,s=kNe(e,r,t.children,e.children,i)||s,s=FNe(r,t.properties,e.properties,i)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[r,i,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(r,e.properties,t.properties),n};let pC=(t,e)=>({getLastRender:()=>t,update:i=>{if(t.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=t;t=i,pD(r,i,e)},domNode:t.domNode});const UNe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{e.charAt(0)==="-"?t.style.setProperty(e,i):t.style[e]=i}};let Vx=t=>lH(UNe,t),V_={create:(t,e)=>(e=Vx(e),v2(t,document.createElement("div"),void 0,e),pC(t,e)),append:(t,e,i)=>(i=Vx(i),v2(e,t,void 0,i),pC(e,i)),insertBefore:(t,e,i)=>(i=Vx(i),v2(e,t.parentNode,t,i),pC(e,i)),merge:(t,e,i)=>(i=Vx(i),e.domNode=t,Wpe(t,e,i),pC(e,i)),replace:(t,e,i)=>(i=Vx(i),v2(e,t.parentNode,t,i),t.parentNode.removeChild(t),pC(e,i))},qpe,zNe=(t,e)=>{let i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i};qpe=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let BNe=(t,e)=>{let i=t;return e.forEach(r=>{i=i&&i.children?qpe(i.children,n=>n.domNode===r):void 0}),i},VNe=(t,e,i)=>{let r=function(n){i("domEvent",n);let s=e(),o=zNe(n.currentTarget,s.domNode);o.reverse();let a,l=BNe(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",n),a};return(n,s,o,a)=>r},HY=t=>{let e,i,r=Vx(t),n=r.performanceLogger,s=!0,o=!1,a=[],l=[],c=(p,f,y)=>{let v,b=()=>v;r.eventHandlerInterceptor=VNe(e,b,n),v=p(f,y(),r),a.push(v),l.push(y)},u=()=>{if(i=void 0,s){s=!1,n("renderStart",void 0);for(let p=0;p<a.length;p++){let f=l[p]();n("rendered",void 0),a[p].update(f),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:u,scheduleRender:()=>{i||o||(i=requestAnimationFrame(u))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(p,f)=>{c(V_.append,p,f)},insertBefore:(p,f)=>{c(V_.insertBefore,p,f)},merge:(p,f)=>{c(V_.merge,p,f)},replace:(p,f)=>{c(V_.replace,p,f)},detach:p=>{for(let f=0;f<l.length;f++)if(l[f]===p)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},K0=class extends ke{constructor(){super(...arguments),this.items=new Ci,this._watchUpdatingTracking=new Lf,this._callbacks=new Map,this._projector=HY(),this._hiddenProjector=HY()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,i=>{for(const r of i.added){const n=()=>r.render();this._callbacks.set(r,n),this._projector.append(this.surface,n)}for(const r of i.removed){const n=this._projector.detach(this._callbacks.get(r));this.surface.removeChild(n.domNode),this._callbacks.delete(r)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const i=this._hiddenSurface,r=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);r.append(i,s),r.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(r.detach(s);i.firstChild;)i.removeChild(i.firstChild);return o}overlaps(e,i){const r=this.computeBoundingRect(e),n=this.computeBoundingRect(i);return Math.max(r.left,n.left)<=Math.min(r.right,n.right)&&Math.max(r.top,n.top)<=Math.min(r.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(r=>r.visible))return;const i=e.getContext("2d");i.save(),i.font=this._fontString(),this.items.forEach(r=>{i.save(),r.renderCanvas(i),i.restore()}),i.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([m({readOnly:!0})],K0.prototype,"surface",void 0),d([m({readOnly:!0})],K0.prototype,"items",void 0),d([m({readOnly:!0})],K0.prototype,"needsRender",null),d([m({readOnly:!0})],K0.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],K0.prototype,"updating",null),K0=d([J("esri.views.overlay.ViewOverlay")],K0);const WY=K0,f6=[0,0];function GNe(t){const e=(t.ownerDocument||window.document).defaultView,i=t.getBoundingClientRect();return f6[0]=i.left+((e==null?void 0:e.pageXOffset)??0),f6[1]=i.top+((e==null?void 0:e.pageYOffset)??0),f6}function qY(t){t&&(Fhe(t),t.parentNode&&t.parentNode.removeChild(t))}function jNe(t){const e=document.createElement("div");return t.appendChild(e),e}const fC=16,IR=750,HNe=512,WNe=2,qNe=t=>{let e=class extends t{constructor(...i){super(...i),this._freqInfo={freq:fC,time:IR},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([Pe(()=>this.cursor,r=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",r)}),Pe(()=>this.navigating,r=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",r.toString())})])}initialize(){this.addHandles([Pe(()=>this.ui,(i,r)=>this._handleUIChange(i,r),ar),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=Je(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(i){const r=this._get("container"),n=R5(i);if(n||typeof i!="string"||ye.getLogger(this).error("#container",`element with id '${i}' not found`),r===n)return;if(this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(qY(this.root),this._set("root",null)),this.userContent&&(oY(this.userContent,r),qY(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",oY(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new WY;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(Pe(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=cT({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=Qr(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get size(){return[this.width,this.height]}blur(){var i;(i=this.surface)==null||i.blur()}focus(){var i;(i=this.surface)==null||i.focus()}pageToContainer(i,r,n){const s=this.position;return i-=s?s[0]:0,r-=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}containerToPage(i,r,n){const s=this.position;return i+=s?s[0]:0,r+=s?s[1]:0,n?(n[0]=i,n[1]=r):n=[i,r],n}_handleUIChange(i,r){this.removeHandles("ui"),r&&r!==i&&r.destroy(),i&&(i.view=this,this.addHandles(Pe(()=>this.root,n=>{i.container=n?jNe(n):null},ar),"ui")),this._set("ui",i)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=fC,i.time=IR,this.addHandles([(()=>{const r=()=>{i.freq=fC,i.time=IR};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),cT({prepare:r=>{const n=this._measure(),s=this._freqInfo;if(s.time+=r.deltaTime,n&&(s.freq=fC,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?fC:Math.min(IR,s.freq*WNe),!n&&s.freq>=HNe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,n=i?i.clientHeight:0;if(r===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return r===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:r,height:n}),!0)}_position(){const i=this.container,r=this.position,n=i&&GNe(i);return!!n&&(!r||n[0]!==r[0]||n[1]!==r[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return d([m()],e.prototype,"container",null),d([m({readOnly:!0})],e.prototype,"focused",null),d([m({readOnly:!0})],e.prototype,"height",void 0),d([m({type:WY})],e.prototype,"overlay",void 0),d([m({readOnly:!0})],e.prototype,"position",void 0),d([m({readOnly:!0})],e.prototype,"resizing",void 0),d([m({readOnly:!0})],e.prototype,"root",void 0),d([m({value:null,readOnly:!0})],e.prototype,"size",null),d([m({readOnly:!0})],e.prototype,"surface",void 0),d([m({readOnly:!0})],e.prototype,"suspended",void 0),d([m()],e.prototype,"ui",void 0),d([m({readOnly:!0})],e.prototype,"userContent",void 0),d([m({readOnly:!0})],e.prototype,"width",void 0),d([m()],e.prototype,"widthBreakpoint",void 0),e=d([J("esri.views.DOMContainer")],e),e},uH=ye.getLogger("esri.layers.support.ElevationSampler");let Zpe=class{queryElevation(e){return Xpe(e.clone(),this)}on(){return KNe}projectIfRequired(e,i){return Ype(e,i)}},ZNe=class extends Zpe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){super(),this.tile=e,this.noDataValue=r;const n=e.tile.extent;this.extent=a5(n,i.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=al(i.spatialReference),o=i.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const i=this.projectIfRequired(e,this.spatialReference);return i!=null&&this.containsAt(i.x,i.y)}containsAt(e,i){return l5(this._aaExtent,e,i)}elevationAt(e,i){if(!this.containsAt(e,i)){const r=this.extent,n=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return uH.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,i)??this.noDataValue}},a_t=class extends Zpe{get spatialReference(){return this.extent.spatialReference}constructor(e,i,r){let n;super(),typeof i=="number"?(this.noDataValue=i,n=null):(n=i,this.noDataValue=r),this.samplers=n?e.map(o=>new ZNe(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=a5(li(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,i){for(const r of this.samplers)if(r.containsAt(e,i))return r.elevationAt(e,i);return uH.warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler`),this.noDataValue}};function Xpe(t,e){const i=Ype(t,e.spatialReference);if(!i)return null;switch(t.type){case"point":XNe(t,i,e);break;case"polyline":YNe(t,i,e);break;case"multipoint":JNe(t,i,e)}return t}function Ype(t,e){if(t==null)return null;const i=t.spatialReference;if(i.equals(e))return t;const r=Ub(t,e);return r||uH.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),r}function XNe(t,e,i){t.z=i.elevationAt(e.x,e.y)}function YNe(t,e,i){xf.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];xf.x=c[0],xf.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(xf.x,xf.y)}}t.hasZ=!0}function JNe(t,e,i){xf.spatialReference=e.spatialReference;const r=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];xf.x=o[0],xf.y=o[1],r&&(s[3]=s[2]),s[2]=i.elevationAt(xf.x,xf.y)}t.hasZ=!0}const xf=new Ft,KNe={remove(){}};var Bz;let rf=Bz=class extends Nt{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new Bz({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],rf.prototype,"cols",void 0),d([m({type:js,json:{write:!0}})],rf.prototype,"level",void 0),d([m({type:String,json:{write:!0}})],rf.prototype,"levelValue",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],rf.prototype,"origin",void 0),d([m({type:Number,json:{write:!0}})],rf.prototype,"resolution",void 0),d([m({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],rf.prototype,"rows",void 0),d([m({type:Number,json:{write:!0}})],rf.prototype,"scale",void 0),rf=Bz=d([J("esri.layers.support.LOD")],rf);const Gd=rf;let QNe=class{constructor(e,i,r,n,s=void 0){this.id=e,this.level=i,this.row=r,this.col=n,this.extent=s}};var Q0;const ZY=new Tu({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let da=Q0=class extends Nt{static create(t={}){const{resolutionFactor:e=1,scales:i,size:r=256,spatialReference:n=jt.WebMercator,numLODs:s=24}=t;if(!Ta(n)){const p=[];if(i)for(let f=0;f<i.length;f++){const y=i[f];p.push(new Gd({level:f,scale:y,resolution:y}))}else{let f=5e-4;for(let y=s-1;y>=0;y--)p.unshift(new Gd({level:y,scale:f,resolution:f})),f*=2}return new Q0({dpi:96,lods:p,origin:new Ft(0,0,n),size:[r,r],spatialReference:n})}const o=F1(n),a=t.origin?new Ft({x:t.origin.x,y:t.origin.y,spatialReference:n}):new Ft(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(al(n)*39.37*l),u=[];if(i)for(let p=0;p<i.length;p++){const f=i[p],y=f*c;u.push(new Gd({level:p,scale:f,resolution:y}))}else{let p=gle(n)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const f=Math.ceil(s/e);u.push(new Gd({level:0,scale:p,resolution:p*c}));for(let y=1;y<f;y++){const v=p/2**e,b=v*c;u.push(new Gd({level:y,scale:v,resolution:b})),p=v}}return new Q0({dpi:l,lods:u,origin:a,size:[r,r],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const i=F1(t);return t.isWrappable&&!!i&&Math.abs(i.origin[0]-e.x)<=i.dx}return!1}readOrigin(t,e){return Ft.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,i=0;const r=[],n=this._levelToLOD={};t&&(e=-1/0,i=1/0,t.forEach(s=>{r.push(s.scale),e=s.scale>e?s.scale:e,i=s.scale<i?s.scale:i,n[s.level]=s})),this._set("scales",r),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const i=Math.floor(t),r=i+1;return e[i]/(e[i]/e[r])**(t-i)}scaleToZoom(t){const e=this.scales,i=e.length-1;let r=0;for(;r<i;r++){const n=e[r],s=e[r+1];if(n<=t)return r;if(s===t)return r+1;if(n>t&&s<t)return r+Math.log(n/t)/Math.log(n/s)}return r}snapScale(t,e=.95){const i=this.scaleToZoom(t);return i%Math.floor(i)>=e?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(t,e,i,r){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=i;else if(go(e.spatialReference,this.spatialReference))s=e.x,o=e.y,r=i;else{const c=Ub(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,r=i}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return r||(r=new QNe(null,0,0,0,li())),r.level=t,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(t,e=Q0.ExtrapolateOptions.NONE){let i=this.lodAt(t.level);if(!i&&e===Q0.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(i=o)}if(!i)return;const r=t.level-i.level,n=i.resolution*this.size[0]/2**r,s=i.resolution*this.size[1]/2**r;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=li()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const i=this.lodAt(e.level);if(i==null)return null;const{resolution:r}=i,n=r*this.size[0],s=r*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return Q0.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const i=[],r=this.lods.length;for(let n=0;n<r;n++){const s=this.lods[n],o=s.resolution*e;i.push(new Gd({level:s.level,scale:s.scale,resolution:o}))}return new Q0({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let i=0;i<t.length;i++){const r=t[i];this._upsampleLevels[r.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/r.resolution:0},e=r}}};d([m({type:Number,json:{write:!0}})],da.prototype,"compressionQuality",void 0),d([m({type:Number,json:{write:!0}})],da.prototype,"dpi",void 0),d([m({type:String,json:{read:ZY.read,write:ZY.write,origins:{"web-scene":{read:!1,write:!1}}}})],da.prototype,"format",void 0),d([m({readOnly:!0})],da.prototype,"isWrappable",null),d([m({type:Ft,json:{write:!0}})],da.prototype,"origin",void 0),d([yr("origin")],da.prototype,"readOrigin",null),d([m({type:[Gd],value:null,json:{write:!0}})],da.prototype,"lods",null),d([m({readOnly:!0})],da.prototype,"scales",void 0),d([m({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],da.prototype,"size",void 0),d([yr("size",["rows","cols"])],da.prototype,"readSize",null),d([Pr("size",{cols:{type:js},rows:{type:js}})],da.prototype,"writeSize",null),d([m({type:jt,json:{write:!0}})],da.prototype,"spatialReference",void 0),da=Q0=d([J("esri.layers.support.TileInfo")],da),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(da||(da={}));const SI=da,e5e=12;let mc=class vl{constructor(e){const i=vl.checkUnsupported(e);if(i!=null)throw i;const r=e;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=dy(this.spatialReference)||tm(this.spatialReference)||im(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const n=r.lods.reduce((c,u,p)=>(u.level<c.min&&(c.min=u.level,c.minIndex=p),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=r.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new vl(this.toTileInfo())}toTileInfo(){return new SI({dpi:this.dpi,origin:new Ft({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,i)=>new Gd({level:i,scale:e.scale,resolution:e.resolution}))})}getExtent(e,i,r,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+r*o,n[2]=this.origin[0]+(r+1)*o,n[3]=this.origin[1]-i*a,n[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(e,i){this._isWebMercator?(i[0]=cX(e[0]),i[1]=NL(e[1]),i[2]=cX(e[2]),i[3]=NL(e[3])):this._isGCS&&(i[0]=Qt(e[0]),i[1]=Qt(e[1]),i[2]=Qt(e[2]),i[3]=Qt(e[3]))}getExtentGeometry(e,i,r,n=new Ar){return this.getExtent(e,i,r,Op),n.spatialReference=this.spatialReference,n.xmin=Op[0],n.ymin=Op[1],n.xmax=Op[2],n.ymax=Op[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let i=!1;for(;this.levels.length<=e;){const r=this.levels[this.levels.length-1],n=r.resolution/2;this.levels.push({resolution:n,scale:r.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),i=!0}return i}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const i=this.levels[0].scale;return e>=i?0:Math.log(i/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof vl)){if(vl.checkUnsupported(e))return!1;e=new vl(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,e.levels.length)-1,r=this.levels[i].resolution;let n=.5*r;return!U2(e.origin[0],this.origin[0],n)||!U2(e.origin[1],this.origin[1],n)?!1:(n=.5*r/2**i/this.pixelSize*e5e,U2(r,e.levels[i].resolution,n))}rootTilesInExtent(e,i=null,r=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;vl.computeRowColExtent(e,s,this.origin,Op);let o=Op[1],a=Op[3],l=Op[0],c=Op[2];const u=c-l,p=a-o;if(u*p>r){const f=Math.floor(Math.sqrt(r));p>f&&(o=o+Math.floor(.5*p)-Math.floor(.5*f),a=o+f),u>f&&(l=l+Math.floor(.5*u)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let y=l;y<c;y++)n.push([0,f,y]);return i!=null&&(i[0]=this.origin[0]+l*s[0],i[1]=this.origin[1]-a*s[1],i[2]=this.origin[0]+c*s[0],i[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,i,r,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-r[0])/i[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-r[0])/i[0])),n[1]=Math.max(0,Math.floor((r[1]-e[3]+s)/i[1])),n[3]=Math.max(0,Math.ceil((r[1]-e[1]-s)/i[1]))}static isPowerOfTwo(e){const i=e.lods,r=i[0].resolution*2**i[0].level;return!i.some(n=>!SEe(n.resolution,r/2**n.level))}static hasGapInLevels(e){const i=e.lods.map(r=>r.level);i.sort((r,n)=>r-n);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(e){const i=e.size[1];return i===e.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(e){const i=e.origin;return e.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new ce("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?hH():e.lods.length<1?new ce("tilingscheme:generic","Tiling scheme must have at least one level"):vl.isPowerOfTwo(e)?vl.hasGapInLevels(e)?new ce("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):vl.tileSizeSupported(e)?vl.hasOriginPerLODs(e)?new ce("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new ce("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new ce("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,i){const r=e[2]-e[0],n=e[3]-e[1],s=al(i),o=1.2*Math.max(r,n),a=256,l=96,c=.0254,u=new vl(new SI({size:[a,a],origin:new Ft({x:e[0]-.5*(o-r),y:e[3]+.5*(o-n)}),lods:[new Gd({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:i}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const i=new vl(vl.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(e),i}static makeGCSWithTileSize(e,i=256,r=16){const n=256/i,s=new vl(new SI({size:[i,i],origin:new Ft({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Gd({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(r),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function hH(){return new ce("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}mc.WebMercatorAuxiliarySphereTileInfo=new SI({size:[256,256],origin:new Ft({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:jt.WebMercator}),spatialReference:jt.WebMercator,lods:[new Gd({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),mc.WebMercatorAuxiliarySphere=mc.makeWebMercatorAuxiliarySphere(19);const Op=li(),b2=64,LE=512,t5e=2.5,kP=CEe(L8/10),Jpe=2,Kpe=li();mc.WebMercatorAuxiliarySphere.getExtent(0,0,0,Kpe);const i5e=li([-180,-90,180,90]),r5e="Cannot extend surface to encompass all layers because it would result in too many root tiles.",n5e="Surface extent is too large for tile resolution at level 0.",s5e=3;let o5e=s5e;function Vz(t){return t<4?3:o5e}let e_=class extends os.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=kP}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const i=a5(e.extent,e.spatialReference);return i.zmin=e.visibleElevationBounds.min,i.zmax=e.visibleElevationBounds.max,i}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??jt.WGS84}elevationAt(e,i){var r;if(this.extent==null||!ja(this.extent,e,i)){const n=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return ye.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${i}) is outside of the sampler extent (${n})`),this.noDataValue}return((r=this.view.elevationProvider)==null?void 0:r.getElevation(e,i,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return Xpe(e.clone(),this)}};d([m({readOnly:!0})],e_.prototype,"demResolution",void 0),d([m({readOnly:!0})],e_.prototype,"extent",null),d([m({readOnly:!0})],e_.prototype,"noDataValue",void 0),d([m()],e_.prototype,"spatialReference",null),d([m({constructOnly:!0})],e_.prototype,"view",void 0),e_=d([J("esri.views.support.GroundViewElevationSampler")],e_);const a5e=e_;let t_=class extends ke{constructor(e){super(e),this.view=null,this.layerViews=new Ci}initialize(){this.addHandles(Bh(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new a5e({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>Pe(()=>e.updating,()=>this._updateUpdating(),gr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([m({readOnly:!0})],t_.prototype,"elevationSampler",null),d([m({type:Boolean,readOnly:!0})],t_.prototype,"updating",null),d([m({constructOnly:!0})],t_.prototype,"view",void 0),d([m({type:Ci,readOnly:!0})],t_.prototype,"layerViews",void 0),d([m({readOnly:!0})],t_.prototype,"suspended",null),t_=d([J("esri.views.GroundView")],t_);const l5e=t_;function Y5(t,e,i){return Ay(t.map((r,n)=>e.apply(i,[r,n])))}async function c5e(t,e,i){return(await Ay(t.map((r,n)=>e.apply(i,[r,n])))).map(r=>r.value)}function dH(t){return{ok:!0,value:t}}function pH(t){return{ok:!1,error:t}}function u5e(t){return t!=null&&t.ok===!0?t.value:null}function h5e(t){return t!=null&&t.ok===!1?t.error:null}async function Lg(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return dH(await t)}catch(e){return pH(e)}}async function d_t(t){try{return dH(await t)}catch(e){return kb(e),pH(e)}}function p_t(t){if(t.ok===!0)return t.value;throw t.error}function _S(t,e){return new i_(t,e)}let i_=class extends ke{get value(){return u5e(this._result)}get error(){return h5e(this._result)}get finished(){return this._result!=null}constructor(e,i){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=wu(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(n=>{this._result=dH(n),this._cleanup()},n=>{this._result=pH(n),this._cleanup()}),this._abortHandle=Ca(i,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=Qr(this._abortHandle),this._abortController=null}};d([m()],i_.prototype,"value",null),d([m()],i_.prototype,"error",null),d([m()],i_.prototype,"finished",null),d([m()],i_.prototype,"promise",void 0),d([m()],i_.prototype,"_result",void 0),i_=d([J("esri.core.asyncUtils.ReactiveTask")],i_);const XY=new Set;function d5e(t,e,i=!1){i&&XY.has(e)||(i&&XY.add(e),t.warn(` DEPRECATED - ${e}`))}function G_(t,e,i={}){if(ge("esri-deprecation-warnings")){const{moduleName:r}=i;fD(t,`Property: ${(r?r+"::":"")+e}`,i)}}function fD(t,e,i={}){if(ge("esri-deprecation-warnings")){const{replacement:r,version:n,see:s,warnOnce:o}=i;let a=e;r&&(a+=`
	 Replacement: ${r}`),n&&(a+=`
	 Version: ${n}`),s&&(a+=`
	 See ${s} for more details.`),d5e(t,a,o)}}let Dg=class{constructor(e,i){this._owner=i,this._properties={},this._afterDispatchHandle=null;for(const r in e){const n=e[r],s=new gae(n,void 0,void 0,2,2);this._properties[r]={pool:s,acquired:[]}}this._afterDispatchHandle=Pae(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const i=this._properties[e];for(const r of i.acquired)jZ(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this._properties=null,this._owner=null}get(e){const i=this._owner._get(e),r=this._properties[e];let n=r.pool.acquire();for(r.acquired.push(n);n===i;)r.acquired.push(n),n=r.pool.acquire();return n}_release(){for(const e in this._properties){const i=this._properties[e];let r=0;for(const n of i.acquired)jZ(n)?i.acquired[r++]=n:i.pool.release(n);i.acquired.length=r}}};const p5e=ge("mac")?"Meta":"Ctrl",J5={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)J5[t]=String.fromCharCode(t);for(let t=1;t<25;t++)J5[111+t]=`F${t}`;for(let t=65;t<91;t++)J5[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function f5e(t){if(t.key!==void 0)return FSe(t);const e=J5[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function m5e(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let g5e=class{constructor(e,i=[]){this.eventType=e,this.keyModifiers=i}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=e.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}};const YY=ye.getLogger("esri.views.input.InputHandler");let ko=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const i=this._incoming[e];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?YY.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(i=>this._handleEvent(i)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,i,r){let n;typeof i=="function"?(r=i,n=[]):n=i||[];const s=typeof e=="string"?new g5e(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const p=this._incoming[u.match.eventType];if(p){const f=p.indexOf(u);p.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new _5e(s,r,{onPause:a,onRemove:a,onResume:u=>{const p=this._incoming[u.match.eventType];p&&!p.includes(u)&&(p.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const i=new y5e(e,{onEmit:(r,n,s,o)=>{var a;(a=this._manager)==null||a.emit(r.eventType,n,s,o)},onRemove:r=>{var n;delete this._outgoing[r.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!0)}stopCapturingPointer(e){var i;(i=this._manager)==null||i.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):YY.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var r;const i=this._incoming[e.type];if(i){for(const n of i)if(n.match.matches(e)&&((r=n.callback)==null||r.call(n,e),e.shouldStopPropagation()))break}}},_5e=class{constructor(e,i,r){this.match=e,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},y5e=class{constructor(e,i){this.eventType=e,this._removed=!1,this._handler=i}emit(e,i,r){this._removed||this._handler.onEmit(this,e,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}},v5e=class extends ko{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{this._update(i.data)})}_update(e){const i=e.native.pointerType==="touch"?"touch":"mouse",{x:r,y:n}=e;i===this._value&&this._x===r&&this._y===n||(this._value=i,this._x=r,this._y=n,this._onChange(i,r,n))}},b5e=class{constructor(e,i){this._observable=new h5,this._value=e,this._equalityFunction=i}get value(){return hi(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function UP(t,e=Qoe){return new b5e(t,e)}let w5e=class extends ko{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=UP(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},th=class extends ke{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=p5e,this._latestPointerType="mouse",this._propertiesPool=new Dg({latestPointerLocation:S5e},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const i of e)this.uninstallHandlers(i);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,i,r=Y_.INTERNAL){if(this._nameToGroup[e])return void ye.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(i.length===0)return void ye.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:i.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:r,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,p)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,p,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const i=this._nameToGroup[e];i?(i.handlers.forEach(r=>{var n;r.removed=!0,(n=r.uninstallCallback)==null||n.call(r)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):ye.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,i=new Set;this._handlersPriority=[];for(let r=this._handlers.length-1;r>=0;r--){const n=this._handlers[r];n.priorityIndex=r,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let r=this._handlersPriority.length-1;r>=0;r--){const n=this._handlersPriority[r];n.priorityIndex=r;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)m5e(a)||i.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=i,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,i,r){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==i||n.y!==r){const s=this._propertiesPool.get("latestPointerLocation");s.x=i,s.y=r,this._set("latestPointerLocation",s)}}_onEventReceived(e,i){if(e==="pointer-capture-lost"){const s=i;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,i);const r=this.test.timestamp!=null?this.test.timestamp:i.native?i.native.timestamp:void 0,n=i.native?i.native.cancelable:void 0;this._emitInputEventFromSource(e,i,r,n)}_updateKeyModifiers(e,i){if(!i)return;let r=!1;const n=()=>{if(!r){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,r=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=i.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=i.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new v5e((e,i,r)=>this._setLatestPointer(e,i,r)),this._multiTouchHandler=new w5e,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Y_.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Y_.INTERNAL)}_setPointerCapture(e,i,r,n){const s=e.name+"-"+i.priorityIndex,o=this._pointerCaptures.get(r.pointerId)||new Set;this._pointerCaptures.set(r.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(r,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(r.pointerId),this.eventSource&&this.eventSource.setPointerCapture(r,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,i,r,n){this._emitInputEvent(0,e,i,r,n)}_emitInputEvent(e,i,r,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new x5e(i,r,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new pz,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var i,r;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:s}=e.events.pop(),o=n.data&&n.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((r=(i=e.currentHandler).eventCallback)==null||r.call(i,n)),n.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const i=new pz;i.push(e);const r=this._currentPropagation;if(r){for(;r.events.length;)i.push(r.events.pop());r.events=i,r.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,i){if(e.handler.hasSideEffects!==i.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==i.groupPriority)return e.groupPriority>i.groupPriority?-1:1;for(const r of e.handler.incomingEventMatches)for(const n of i.handler.incomingEventMatches){if(r.eventType!==n.eventType)continue;const s=r.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===r.keyModifiers.length!=(s.length===n.keyModifiers.length))return r.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>i.priorityIndex?-1:1}_sortHandlersPriority(e){const i=[];for(const r of e){let n=0;for(;n<i.length&&this._compareHandlerPriority(r,i[n])>=0;)n++;i.splice(n,0,r)}return i}get debug(){const e=i=>{const r=this._setPointerCapture;this._setPointerCapture=()=>{},i(),this._setPointerCapture=r};return{injectEvent:(i,r)=>{e(()=>{this._onEventReceived(i,r)})},disablePointerCapture:e}}};d([m({readOnly:!0})],th.prototype,"hasPendingInputs",null),d([m({constructOnly:!0})],th.prototype,"eventSource",void 0),d([m({constructOnly:!0})],th.prototype,"recognizers",void 0),d([m()],th.prototype,"_latestPointerType",void 0),d([m()],th.prototype,"latestPointerType",null),d([m()],th.prototype,"multiTouchActive",null),d([m({readOnly:!0})],th.prototype,"latestPointerLocation",void 0),d([m()],th.prototype,"_paused",void 0),d([m({readOnly:!0})],th.prototype,"updating",null),th=d([J("esri.views.input.InputManager")],th);let x5e=class{constructor(e,i,r,n,s){this.type=e,this.data=i,this.timestamp=r,this.modifiers=n,this.cancelable=s,this._propagationState=g_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=g_.STOPPED}shouldStopPropagation(){return(this._propagationState&g_.STOPPED)!=0}async(e){this._propagationState|=g_.PAUSED;const i=(r,n)=>{this._propagationState&=~g_.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw r;return r};return(typeof e=="function"?e():e).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(e){return!!(this._propagationState&g_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var g_;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(g_||(g_={}));const Y_={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let T5e=class{};const S5e=T5e;function Rp(t){return t!=null&&"open"in t&&"declaredClass"in t}function JY(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const C5e=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([Pe(()=>[this.ui,this.popup],([i,r],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&Rp(l)&&(l.view=null,JY(l)&&a.remove(l,s))}i&&Rp(r)&&(r.view=this,JY(r)&&i.add(r,{key:s,position:o,internal:!0}))},ar),this.on("click",i=>{this.popup&&this.popupEnabled&&(i.pointerType!=="mouse"||i.button===0)&&(!Rp(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Rp(this.popup)?this.popup.viewModel.handleViewClick(i):i.async(async()=>{await this.setupPopup(),Rp(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(i)})))},Y_.WIDGET)]),MP(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{Oe(()=>import("./Popup-80111c53.js").then(i=>i.a0),["./Popup-80111c53.js","./unitFormatUtils-0710b747.js","./AttachmentInfo-03541bb8.js","./AttachmentQuery-dd62ce87.js","./widget-93850baa.js","./ColorStop-0686847d.js","./jsonUtils-dc7d3627.js","./UniqueValueRenderer-ad13318a.js","./diffUtils-3c37f4e6.js","./colorRamps-54548a9c.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./Query-cdee9722.js","./executeQueryJSON-838e0f16.js","./query-af06498b.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./FeatureSet-d4d9321c.js","./RelationshipQuery-ab8c76dd.js","./TopFeaturesQuery-da745a52.js","./FeatureLayer-7c5e0432.js","./MultiOriginJSONSupport-d720758b.js","./sql-a39124b8.js","./FeatureLayerBase-43dae5ea.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./featureLayerUtils-ce39121a.js","./serviceCapabilitiesUtils-8d66cffa.js","./APIKeyMixin-be880531.js","./ArcGISService-163e63f0.js","./BlendLayer-08a76f1b.js","./jsonUtils-555359b4.js","./CustomParametersMixin-64be6818.js","./FeatureEffectLayer-142ba535.js","./FeatureEffect-82bb4002.js","./FeatureFilter-e71c77dc.js","./FeatureReductionLayer-b84a7e30.js","./LabelClass-3b8bddeb.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./OperationalLayer-5b164959.js","./OrderedLayer-908cb5be.js","./PortalLayer-473e8b12.js","./portalItemUtils-89a0d48a.js","./ScaleRangeLayer-31eefac8.js","./TemporalLayer-5e4b9999.js","./FeatureTemplate-0db006f4.js","./FeatureType-e95921de.js","./fieldProperties-ff8bee5a.js","./labelingInfo-66d1a5d0.js","./versionUtils-9472ade8.js","./styleUtils-5fb07ac6.js","./popupUtils-8d4c7bed.js"],import.meta.url)})}destroy(){this.destroyed||this.closePopup()}async openPopup(i){Rp(this.popup)&&this.popup.open(i);try{if(await this.setupPopup(),!this.popup)return void ye.getLogger(this).error(new ce("view:null-popup","Popup is null and can't be opened"));this.popup.open(i)}catch{}}closePopup(){var i;(i=this._popupSetupTask)==null||i.abort(),Rp(this.popup)&&this.popup.close()}async fetchPopupFeatures(i,r){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,r),u=c.map(p=>p.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:g8([l,...u]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}async setupPopup(){var i;if((i=this._popupSetupTask)==null||i.abort(),this.popup&&!Rp(this.popup))return this._popupSetupTask=_S(async r=>{const{default:n}=await Oe(()=>import("./Popup-80111c53.js").then(o=>o.a0),["./Popup-80111c53.js","./unitFormatUtils-0710b747.js","./AttachmentInfo-03541bb8.js","./AttachmentQuery-dd62ce87.js","./widget-93850baa.js","./ColorStop-0686847d.js","./jsonUtils-dc7d3627.js","./UniqueValueRenderer-ad13318a.js","./diffUtils-3c37f4e6.js","./colorRamps-54548a9c.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./Query-cdee9722.js","./executeQueryJSON-838e0f16.js","./query-af06498b.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./FeatureSet-d4d9321c.js","./RelationshipQuery-ab8c76dd.js","./TopFeaturesQuery-da745a52.js","./FeatureLayer-7c5e0432.js","./MultiOriginJSONSupport-d720758b.js","./sql-a39124b8.js","./FeatureLayerBase-43dae5ea.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./featureLayerUtils-ce39121a.js","./serviceCapabilitiesUtils-8d66cffa.js","./APIKeyMixin-be880531.js","./ArcGISService-163e63f0.js","./BlendLayer-08a76f1b.js","./jsonUtils-555359b4.js","./CustomParametersMixin-64be6818.js","./FeatureEffectLayer-142ba535.js","./FeatureEffect-82bb4002.js","./FeatureFilter-e71c77dc.js","./FeatureReductionLayer-b84a7e30.js","./LabelClass-3b8bddeb.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./OperationalLayer-5b164959.js","./OrderedLayer-908cb5be.js","./PortalLayer-473e8b12.js","./portalItemUtils-89a0d48a.js","./ScaleRangeLayer-31eefac8.js","./TemporalLayer-5e4b9999.js","./FeatureTemplate-0db006f4.js","./FeatureType-e95921de.js","./fieldProperties-ff8bee5a.js","./labelingInfo-66d1a5d0.js","./versionUtils-9472ade8.js","./styleUtils-5fb07ac6.js","./popupUtils-8d4c7bed.js"],import.meta.url);if(Ti(r),!this.popup||Rp(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new n(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(i,r,n){return r.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:n!=null?n.event:void 0,signal:n!=null?n.signal:void 0,defaultPopupTemplateEnabled:n!=null&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(i,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(r!=null&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(i,r){const n=await this.popupHitTest(i),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,r)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return i!=null&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const n=[],s=new Map,o=r.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return d([m({cast(i){return!i||Rp(i)||typeof i=="object"&&(i.open=r=>(fD(ye.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(r)),i.close=()=>(fD(ye.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),i}})],e.prototype,"popup",void 0),d([m()],e.prototype,"popupEnabled",void 0),e=d([J("esri.views.PopupView")],e),e};async function Qpe(t,e){return await t.load(),E5e(t,e)}async function E5e(t,e){const i=[],r=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?r(...o):Ci.isCollection(o)?o.forEach(a=>r(a)):ly.isLoadable(o)&&i.push(o))};e(r);let n=null;if(await c5e(i,async s=>{const o=await Lg(A5e(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function A5e(t){return"loadAll"in t&&typeof t.loadAll=="function"}let Gm=class extends ke{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&gu(e)?ye.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",i){const r=this.cdnUrl;if(r==null)throw new ce("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(r,{responseType:e,query:{token:this.portalItem.apiKey},signal:i==null?void 0:i.signal})}async update(e,i){const{addOrUpdateResource:r}=await Oe(()=>import("./resourceUtils-3b75c8f2.js"),[],import.meta.url);return r(this,"update",e,i)}hasPath(){return this.path!=null}_normalizePath(e,i){return e==null?e:(e=e.replace(/^\/+/,""),i!=null&&gu(e)&&(e=yj(e,i.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};d([m()],Gm.prototype,"portalItem",void 0),d([m({type:String,value:null})],Gm.prototype,"path",null),d([Sn("path")],Gm.prototype,"_castPath",null),d([m({type:String,readOnly:!0})],Gm.prototype,"url",null),d([m({type:String,readOnly:!0})],Gm.prototype,"cdnUrl",null),d([m({type:String,readOnly:!0})],Gm.prototype,"itemRelativeUrl",null),Gm=d([J("esri.portal.PortalItemResource")],Gm);const P5e=Gm;let DE=class extends ke{constructor(e){super(e),this.created=null,this.rating=null}};d([m()],DE.prototype,"created",void 0),d([m()],DE.prototype,"rating",void 0),DE=d([J("esri.portal.PortalRating")],DE);const m6=DE;var jv;const O5e=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),R5e=new Set(["KML","GeoJson","CSV"]);let wi=jv=class extends R3(ly){static from(t){return uT(jv,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let i=t;return t==="Feature Service"||t==="Feature Collection"?i=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?i=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?i="Scene Layer":t==="Video Service"?i="Video Layer":t==="Scene Package"?i="Scene Layer Package":t==="Stream Service"?i="Feature Layer":t==="Geoprocessing Service"?i=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?i="Locator":t==="Geoenrichment Service"?i="GeoEnrichment Service":t==="Microsoft Powerpoint"?i="Microsoft PowerPoint":t==="GeoJson"?i="GeoJSON":t==="Globe Service"?i="Globe Layer":t==="Vector Tile Service"?i="Tile Layer":t==="netCDF"?i="NetCDF":t==="Map Service"?i=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?i=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?i="Big Data File Share":t==="Compact Tile Package"?i="Tile Package (tpkx)":t==="OGCFeatureServer"?i="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?i="Instant App":t==="Insights Page"?i="Insights Report":t==="Excalibur Imagery Project"&&(i="Excalibur Project"),i}readExtent(t){return t&&t.length?new Ar(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],i="esri/images/portal/",r="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":u?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):n=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",n?dr(i+n+r+".png"):null}get isLayer(){return this.type!=null&&O5e.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&En&&!En.findCredential(t)&&(t=En._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var i;const t=this.itemUrl,e=this.thumbnail;return t&&e?((i=this.portal)==null?void 0:i.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=zh.getDefault()),i=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(r=>{this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(i),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof m6&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new m6({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:Le(this.applicationProxies),avgRating:this.avgRating,categories:Le(this.categories),created:Le(this.created),culture:this.culture,description:this.description,extent:Le(this.extent),groupCategories:Le(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:Le(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:Le(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Le(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Le(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new jv({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var i;const t=this.toJSON();for(const r of["tags","typeKeywords","categories"])t[r]=(i=t[r])==null?void 0:i.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await uc(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return uc(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await uc(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new m6(e)):null}fetchRelatedItems(t,e){return uc(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},jv)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return uc(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>uc(this.portal).signIn()).then(()=>{const e=t&&t.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?i.query.text=e:typeof e=="object"&&(i.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new ce("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new ce("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:i}=this;await uc(e).signIn();const{copyResources:r,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:r==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!r,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${i}/copy`,a);return new jv({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,i=t.filename,r={method:"post"};if(typeof e=="string")nm(e)?r.query={data:e}:r.query={url:cu(e)},i!=null&&(r.query.filename=i);else{const n=new FormData;i!=null?n.append("file",e,i):n.append("file",e),r.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new ce("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:i}=await Oe(()=>import("./resourceUtils-3b75c8f2.js"),[],import.meta.url);return i(this,t,e)}async addResource(t,e,i){const{addOrUpdateResource:r}=await Oe(()=>import("./resourceUtils-3b75c8f2.js"),[],import.meta.url);return t.portalItem=this,r(t,"add",e,i)}async removeResource(t,e){const{removeResource:i}=await Oe(()=>import("./resourceUtils-3b75c8f2.js"),[],import.meta.url);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new ce("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await Oe(()=>import("./resourceUtils-3b75c8f2.js"),[],import.meta.url);return e(this,t)}resourceFromPath(t){return new P5e({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:Le(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:Le(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:Le(this.typeKeywords),url:this.url};return Xoe(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new jv({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([m({type:["private","shared","org","public"]})],wi.prototype,"access",void 0),d([m()],wi.prototype,"accessInformation",void 0),d([m({type:String})],wi.prototype,"apiKey",void 0),d([m({json:{read:{source:"appProxies"}}})],wi.prototype,"applicationProxies",void 0),d([m()],wi.prototype,"avgRating",void 0),d([m()],wi.prototype,"categories",void 0),d([m({type:Date})],wi.prototype,"created",void 0),d([m()],wi.prototype,"culture",void 0),d([m()],wi.prototype,"description",void 0),d([m({readOnly:!0})],wi.prototype,"displayName",null),d([m({type:Ar})],wi.prototype,"extent",void 0),d([yr("extent")],wi.prototype,"readExtent",null),d([m()],wi.prototype,"groupCategories",void 0),d([m({readOnly:!0})],wi.prototype,"iconUrl",null),d([m()],wi.prototype,"id",void 0),d([m({readOnly:!0})],wi.prototype,"isLayer",null),d([m({type:Boolean,readOnly:!0})],wi.prototype,"isOrgItem",void 0),d([m()],wi.prototype,"itemControl",void 0),d([m({readOnly:!0})],wi.prototype,"itemPageUrl",null),d([m({readOnly:!0})],wi.prototype,"itemUrl",null),d([m()],wi.prototype,"licenseInfo",void 0),d([m({type:Date})],wi.prototype,"modified",void 0),d([m()],wi.prototype,"name",void 0),d([m()],wi.prototype,"numComments",void 0),d([m()],wi.prototype,"numRatings",void 0),d([m()],wi.prototype,"numViews",void 0),d([m()],wi.prototype,"owner",void 0),d([m()],wi.prototype,"ownerFolder",void 0),d([m({type:zh})],wi.prototype,"portal",void 0),d([m()],wi.prototype,"screenshots",void 0),d([m()],wi.prototype,"size",void 0),d([m()],wi.prototype,"snippet",void 0),d([m()],wi.prototype,"sourceJSON",void 0),d([m({type:String})],wi.prototype,"sourceUrl",void 0),d([m({type:String})],wi.prototype,"spatialReference",void 0),d([m()],wi.prototype,"tags",void 0),d([m()],wi.prototype,"thumbnail",void 0),d([m({readOnly:!0})],wi.prototype,"thumbnailUrl",null),d([m()],wi.prototype,"title",void 0),d([m()],wi.prototype,"type",void 0),d([m()],wi.prototype,"typeKeywords",void 0),d([m({type:String,json:{read(t,e){var i;if(R5e.has(e.type)){const r=(i=this.portal)==null?void 0:i.restUrl;t||(t=r&&this.id?`${r}/content/items/${this.id}/data`:null)}return t}}})],wi.prototype,"url",void 0),d([m({readOnly:!0})],wi.prototype,"userItemUrl",null),wi=jv=d([J("esri.portal.PortalItem")],wi);const efe=wi,tfe=Object.freeze(Object.defineProperty({__proto__:null,default:efe},Symbol.toStringTag,{value:"Module"}));async function M5e(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,i=await Vhe("esri/t9n/basemaps");return i[t]||i[e]}const Gz={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return dr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return dr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return dr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return dr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return dr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return dr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return dr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return dr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return dr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return dr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return dr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return dr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return dr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return dr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return dr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return dr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}},$5e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),I5e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function L5e(t){return t.layerContainerType==="basemap"?$5e:t.layerContainerType==="operational-layers"?I5e:null}function D5e(t,e){if(e.restrictedWebMapWriting){const i=L5e(e);return i==null||i.has(t.type)&&!oH(t)}return!0}function N5e(t,e){if(e)if(oH(t)){const i=S3("featureCollection.layers",e),r=i&&i[0]&&i[0].layerDefinition;r&&KY(t,r)}else t.type!=="group"&&KY(t,e)}function KY(t,e){"maxScale"in t&&(e.maxScale=RL(t.maxScale)??void 0),"minScale"in t&&(e.minScale=RL(t.minScale)??void 0)}function F5e(t,e){if(N5e(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=RL(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(oH(t)){const i=e.featureCollection;i&&(i.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function QY(t,e,i){if(!("write"in t)||!t.write)return i&&i.messages&&i.messages.push(new ce("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(D5e(t,i)){const r={};return t.write(r,i)?r:null}return e!=null&&F5e(t,e=Le(e)),e}var CI;let k5e=0;const ife="esri.Basemap";let ih=CI=class extends R3(ly){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+k5e++,this.baseLayers=new Ci,this.referenceLayers=new Ci;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&ye.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.addHandles([this.baseLayers.on("after-add",r=>e(r.item)),this.referenceLayers.on("after-add",r=>e(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{ye.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const t=this.baseLayers.removeAll();for(const r of t)r.destroy();const e=this.referenceLayers.removeAll();for(const r of e)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",fb(t,this._get("baseLayers")))}_writeBaseLayers(t,e,i){const r=[];t&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=QY(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&r.push(s)}),this.referenceLayers.forEach(n=>{const s=QY(n,i.webmap?i.webmap.getLayerJSONFromResourceInfo(n):null,i);s!=null&&(n.type!=="scene"&&(s.isReference=!0),r.push(s))})),e.baseMapLayers=r}set referenceLayers(t){this._set("referenceLayers",fb(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Qpe(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>_L(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>_L(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new CI({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=Le(i);return r.url&&Wf(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Wf(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:i}=this;Ti(t);const r=[];if(e){const n=e.context?e.context.url:null;if(r.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const s=e.data.id;r.push(M5e(s).then(o=>{o&&this.read({title:o},e.context)}))}}else i&&r.push(this._loadFromItem(i,t));await Promise.all(r)}async _loadLayersFromJSON(t,e,i){const r=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||r&&r.portal||null,s=z5e[(r==null?void 0:r.origin)||""]??"web-map",{populateOperationalLayers:o}=await Oe(()=>import("./layersCreator-e7089b20.js"),["./layersCreator-e7089b20.js","./lazyLayerLoader-96de67c1.js","./portalLayers-eb8e7866.js","./layersLoader-5ce6da48.js","./fetchService-0e9cd09b.js","./jsonContext-b54dc638.js","./portalItemUtils-89a0d48a.js","./styleUtils-5fb07ac6.js"],import.meta.url),a=[];if(Ti(i),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>s==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(u);const p=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(p)}await Ay(a)}async _loadFromItem(t,e){const i=await t.load(e),r=await i.fetchData("json",e),n=sl(t.itemUrl??"");return this._set("resourceInfo",{data:r.baseMap??{},context:{origin:U5e[t.type||""]??"web-map",portal:t.portal||zh.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||zh.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=Gz[t];if(!e)return null;if(e.deprecated){let i=null;t==="dark-gray"?i="dark-gray-vector":t==="gray"?i="gray-vector":t==="streets"?i="streets-vector":t==="topo"&&(i="topo-vector"),fD(ye.getLogger(ife),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return CI.fromJSON(e)}};d([m({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,i,r){this._writeBaseLayers(t,e,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:Ci}},writer(t,e,i,r){this._writeBaseLayers(t,e,r)}}}}}})],ih.prototype,"baseLayers",null),d([m({type:String,json:{origins:{"web-scene":{write:!0}}}})],ih.prototype,"id",void 0),d([m({type:efe})],ih.prototype,"portalItem",void 0),d([m()],ih.prototype,"referenceLayers",null),d([m({readOnly:!0})],ih.prototype,"resourceInfo",void 0),d([m({type:jt})],ih.prototype,"spatialReference",void 0),d([m()],ih.prototype,"thumbnailUrl",void 0),d([m({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],ih.prototype,"title",void 0),d([Pr("title")],ih.prototype,"writeTitle",null),ih=CI=d([J(ife)],ih);const U5e={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},z5e={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},mD=ih,B5e=Object.freeze(Object.defineProperty({__proto__:null,default:mD},Symbol.toStringTag,{value:"Module"}));function P_t(t){}function V5e(t){return()=>t}var jz;let EI=jz=class extends Nt{constructor(t){super(t),this.type="none"}clone(){return new jz({type:this.type})}};d([Si({none:"none",stayAbove:"stay-above"})],EI.prototype,"type",void 0),EI=jz=d([J("esri.ground.NavigationConstraint")],EI);var Hz;let jm=Hz=class extends R3(ly){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Ci;const e=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&ye.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>e(r.item)),this.layers.on("after-remove",r=>i(r.item))])}initialize(){this.when().catch(t=>{ms(t)||ye.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",fb(t,this._get("layers")))}writeLayers(t,e,i,r){const n=[];t&&(r={...r,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};V5e(s)().write(o,r)&&n.push(o)}else r&&r.messages&&r.messages.push(new ce("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return Qpe(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await Oe(()=>import("./ElevationQuery-7a3fa25e.js"),[],import.meta.url);Ti(e);const r=new i,n=this.layers.filter(eJ).toArray();return r.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:i}=await Oe(()=>import("./ElevationQuery-7a3fa25e.js"),[],import.meta.url);Ti(e);const r=new i,n=this.layers.filter(eJ).toArray();return r.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:Le(this.surfaceColor),navigationConstraint:Le(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new Hz({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,i){const r=e&&e.origin||"web-scene",n=e&&e.portal||null,s=e&&e.url||null;return Oe(()=>import("./layersCreator-e7089b20.js"),["./layersCreator-e7089b20.js","./lazyLayerLoader-96de67c1.js","./portalLayers-eb8e7866.js","./layersLoader-5ce6da48.js","./fetchService-0e9cd09b.js","./jsonContext-b54dc638.js","./portalItemUtils-89a0d48a.js","./styleUtils-5fb07ac6.js"],import.meta.url).then(({populateOperationalLayers:o})=>{Ti(i);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:r,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return Ay(a)}).then(()=>{})}};function G5e(t){return t&&"createElevationSampler"in t}function eJ(t){return t.type==="elevation"||G5e(t)}d([m({json:{read:!1}})],jm.prototype,"layers",null),d([Pr("layers")],jm.prototype,"writeLayers",null),d([m({readOnly:!0})],jm.prototype,"resourceInfo",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:js,read:{reader:Mue,source:"transparency"},write:{writer:(t,e)=>{e.transparency=Rue(t)},target:"transparency"}}})],jm.prototype,"opacity",void 0),d([m({type:Lt,json:{type:[js],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],jm.prototype,"surfaceColor",void 0),d([m({type:EI,json:{write:!0}})],jm.prototype,"navigationConstraint",void 0),jm=Hz=d([J("esri.Ground")],jm);const gD=jm;let Gx=class extends Ci{constructor(e){super(e),this.getCollections=null}initialize(){this.own(Cae(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let i=0;for(const r of e)r!=null&&(i=this._processCollection(i,r));this.splice(i,this.length)}_createNewInstance(e){return new Ci(e)}_processCollection(e,i){if(!i)return e;const r=this.itemFilterFunction??(n=>!!n);for(const n of i)if(n){if(r(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};d([m()],Gx.prototype,"getCollections",void 0),d([m()],Gx.prototype,"getChildrenFunction",void 0),d([m()],Gx.prototype,"itemFilterFunction",void 0),Gx=d([J("esri.core.CollectionFlattener")],Gx);const zP=Gx,j5e=[["binary","application/octet-stream","bin",""]];function H5e(t,e){return mH(Z5e(t,e))}function W5e(t,e){return mH(X5e(t,e))}function R_t(t,e){return rfe(q5e(t,e))}function fH(t){return[...j5e,...t]}function q5e(t,e){return fH(e).find(i=>mH(i)===t)}function Z5e(t,e){return fH(e).find(i=>rfe(i)===t)}function X5e(t,e){const i=t.toLowerCase();return fH(e).find(r=>Y5e(r).some(n=>i.endsWith(n)))}function mH(t){return t==null?void 0:t[0]}function rfe(t){return t==null?void 0:t[1]}function Y5e(t){return(t==null?void 0:t[2].split(","))??[]}function M_t(t){var e;return(e=t.tables)==null?void 0:e.find(i=>i.role==="assetMaps")}function J5e(t){var e,i;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((i=(e=SDe(t))==null?void 0:e.operations)!=null&&i.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!EDe(t)||t.type==="scene"&&!K5e(t))}function K5e(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:i,queryFormats:r}=e,n=H5e("model/gltf-binary",i)??W5e("glb",i);return n!=null&&r.includes(n)}const tJ=ye.getLogger("esri.support.basemapUtils");function Q5e(){return{}}function e4e(t){for(const e in t){const i=t[e];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete t[e]}}function t4e(t,e){let i;if(typeof t=="string"){if(!(t in Gz)){const r=Object.entries(Gz).filter(([n,s])=>Er.apiKey&&!s.classic||!Er.apiKey&&s.classic&&!s.deprecated).map(([n])=>`"${n}"`).join(", ");return tJ.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${r}`),null}e&&(i=e[t]),i||(i=mD.fromId(t),e&&(e[t]=i))}else i=rl(mD,t);return i!=null&&i.destroyed&&(tJ.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function $_t(t,e){var i,r,n,s;return((r=(i=t.basemap)==null?void 0:i.referenceLayers)==null?void 0:r.some(o=>o.uid===e))||((s=(n=t.basemap)==null?void 0:n.baseLayers)==null?void 0:s.some(o=>o.uid===e))}function i4e(t){return new zP({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const i=[];return"tables"in e&&i.push(e.tables),"layers"in e&&i.push(e.layers),i},itemFilterFunction:e=>{const i=e.parent;return!!i&&"tables"in i&&i.tables.includes(e)}})}function g6(t){for(const e of t.values())e==null||e.destroy();t.clear()}const iJ={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function r4e(t){let e=null;if(typeof t=="string")if(t in iJ){const i=iJ[t];e=new gD({resourceInfo:{data:{layers:[i]}}})}else ye.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=rl(gD,t);return e}async function n4e(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:i}=await Oe(()=>import("./portalLayers-eb8e7866.js"),["./portalLayers-eb8e7866.js","./lazyLayerLoader-96de67c1.js","./layersLoader-5ce6da48.js","./fetchService-0e9cd09b.js","./jsonContext-b54dc638.js","./portalItemUtils-89a0d48a.js","./styleUtils-5fb07ac6.js"],import.meta.url);try{return await i(e)}catch(r){const n=e&&e.portalItem,s=n&&n.id||"unset",o=n&&n.portal&&n.portal.url||Er.portalUrl;throw ye.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",r),r}}let s4e=0,Co=class extends os.EventedMixin(nj(ly)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new Ar(-180,-90,180,90,jt.WGS84),this.id=Date.now().toString(16)+"-layer-"+s4e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=jt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const i=typeof e=="string"?{url:e}:e;return(await Oe(()=>import("./arcgisLayers-eaa1e57f.js"),["./arcgisLayers-eaa1e57f.js","./fetchService-0e9cd09b.js","./lazyLayerLoader-96de67c1.js"],import.meta.url)).fromUrl(i)}static fromPortalItem(e){return n4e(e)}initialize(){this.when().catch(e=>{ms(e)||ye.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,i=this.parent;"layers"in i&&i.layers.includes(e)?i.layers.remove(e):"tables"in i&&i.tables.includes(e)?i.tables.remove(e):"baseLayers"in i&&i.baseLayers.includes(e)?i.baseLayers.remove(e):"baseLayers"in i&&i.referenceLayers.includes(e)&&i.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return sl(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ps(e,{query:{f:"json"},responseType:"json"})).data;throw new ce("layer:no-attribution-data","Layer does not have attribution data")}};d([m({type:String})],Co.prototype,"attributionDataUrl",void 0),d([m({type:Ar})],Co.prototype,"fullExtent",void 0),d([m({readOnly:!0})],Co.prototype,"hasAttributionData",null),d([m({type:String,clonable:!1})],Co.prototype,"id",void 0),d([m({type:Boolean,nonNullable:!0})],Co.prototype,"legendEnabled",void 0),d([m({type:["show","hide","hide-children"]})],Co.prototype,"listMode",void 0),d([m({type:Number,range:{min:0,max:1},nonNullable:!0})],Co.prototype,"opacity",void 0),d([m({clonable:!1})],Co.prototype,"parent",void 0),d([m({readOnly:!0})],Co.prototype,"parsedUrl",null),d([m({type:Boolean})],Co.prototype,"popupEnabled",void 0),d([m({type:Boolean})],Co.prototype,"attributionVisible",void 0),d([m({type:jt})],Co.prototype,"spatialReference",void 0),d([m({type:String})],Co.prototype,"title",void 0),d([m({readOnly:!0,json:{read:!1}})],Co.prototype,"type",void 0),d([m()],Co.prototype,"url",void 0),d([m({type:Boolean,nonNullable:!0})],Co.prototype,"visible",void 0),Co=d([J("esri.layers.Layer")],Co);const o4e=Co;function Wz(t,e,i){let r,n;if(t)for(let s=0,o=t.length;s<o;s++){if(r=t.at(s),(r==null?void 0:r[e])===i)return r;if((r==null?void 0:r.type)==="group"&&(n=Wz(r.layers,e,i),n))return n}}const a4e=t=>{let e=class extends t{constructor(...i){super(...i),this.layers=new Ci;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||ye.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const i=this.layers.toArray();for(const r of i)r.destroy();this.layers.destroy()}set layers(i){this._set("layers",fb(i,this._get("layers")))}add(i,r){const n=this.layers;if(r=n.getNextIndex(r),i instanceof o4e){const s=i;s.parent===this?this.reorder(s,r):n.add(s,r)}else Pu(i)?i.then(s=>{this.destroyed||this.add(s,r)}):ye.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const n=this.layers;let s=n.getNextIndex(r);i.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(i){return Wz(this.layers,"id",i)}findLayerByUid(i){return Wz(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return d([m()],e.prototype,"layers",null),e=d([J("esri.support.LayersMixin")],e),e};function qz(t,e,i){if(t)for(let r=0,n=t.length;r<n;r++){const s=t.at(r);if(s[e]===i)return s;if((s==null?void 0:s.type)==="group"){const o=qz(s.tables,e,i);if(o)return o}}}const l4e=t=>{let e=class extends t{constructor(...i){super(...i),this.tables=new Ci,this.addHandles([this.tables.on("after-add",r=>{const n=r.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&ye.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})])}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",fb(i,this._get("tables")))}findTableById(i){return qz(this.tables,"id",i)}findTableByUid(i){return qz(this.tables,"uid",i)}};return d([m()],e.prototype,"tables",null),e=d([J("esri.support.TablesMixin")],e),e};let nf=class extends l4e(a4e(os.EventedMixin(ke))){constructor(e){super(e),this.allLayers=new zP({getCollections:()=>{var i,r,n;return[(i=this.basemap)==null?void 0:i.baseLayers,(r=this.ground)==null?void 0:r.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:i=>"layers"in i?i.layers:null}),this.allTables=i4e(this),this.basemap=null,this.editableLayers=new zP({getCollections:()=>[this.allLayers],itemFilterFunction:J5e}),this.ground=new gD,this._basemapCache=Q5e()}destroy(){var e,i;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(i=this.basemap)==null||i.destroy(),e4e(this._basemapCache),this._basemapCache=null}castBasemap(e){return t4e(e,this._basemapCache)}castGround(e){return r4e(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(i=>i.id===e)}findTableById(e){return this.allTables.find(i=>i.id===e)}};d([m({readOnly:!0,dependsOn:[]})],nf.prototype,"allLayers",void 0),d([m({readOnly:!0})],nf.prototype,"allTables",void 0),d([m({type:mD})],nf.prototype,"basemap",void 0),d([Sn("basemap")],nf.prototype,"castBasemap",null),d([m({readOnly:!0})],nf.prototype,"editableLayers",void 0),d([m({type:gD,nonNullable:!0})],nf.prototype,"ground",void 0),d([Sn("ground")],nf.prototype,"castGround",null),nf=d([J("esri.Map")],nf);const nfe=nf,rJ={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},c4e={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function u4e(t,e){const i=new Date(t,e+1,1);return i.setDate(0),i.getDate()}function _6(t,e,i){const r=new Date(t.getTime());if(e&&i){const n=c4e[i],{getter:s,setter:o,multiplier:a}=n;if(i==="months"){const l=u4e(r.getFullYear(),r.getMonth()+e);r.getDate()>l&&r.setDate(l)}r[o](r[s]()+e*a)}return r}function nJ(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function D_t(t,e,i){return t===0?0:t*rJ[e]/rJ[i]}var Td;let Kc=Td=class extends Nt{static get allTime(){return sJ}static get empty(){return h4e}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(Td.allTime)}get isEmpty(){return this.equals(Td.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new Td({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,i=this.end!=null?this.end.getTime():this.end,r=t.start!=null?t.start.getTime():t.start,n=t.end!=null?t.end.getTime():t.end;return e===r&&i===n}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=Eh(this.start,r=>nJ(r,t)),i=Eh(this.end,r=>{const n=nJ(r,t);return r.getTime()===n.getTime()?n:_6(n,1,t)});return new Td({start:e,end:i})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Td.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,i=((l=this.end)==null?void 0:l.getTime())??1/0,r=((c=t.start)==null?void 0:c.getTime())??-1/0,n=((u=t.end)==null?void 0:u.getTime())??1/0;let s,o;if(r>=e&&r<=i?s=r:e>=r&&e<=n&&(s=e),i>=r&&i<=n?o=i:n>=e&&n<=i&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const p=new Td;return p.start=s===-1/0?null:new Date(s),p.end=o===1/0?null:new Date(o),p}return Td.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Td,{start:r,end:n}=this;return r!=null&&(i.start=_6(r,t,e)),n!=null&&(i.end=_6(n,t,e)),i}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return sJ.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,i=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Td({start:e,end:i})}};d([m({type:Date,json:{write:{allowNull:!0}}})],Kc.prototype,"end",void 0),d([yr("end")],Kc.prototype,"readEnd",null),d([Pr("end")],Kc.prototype,"writeEnd",null),d([m({readOnly:!0,json:{read:!1}})],Kc.prototype,"isAllTime",null),d([m({readOnly:!0,json:{read:!1}})],Kc.prototype,"isEmpty",null),d([m({type:Date,json:{write:{allowNull:!0}}})],Kc.prototype,"start",void 0),d([yr("start")],Kc.prototype,"readStart",null),d([Pr("start")],Kc.prototype,"writeStart",null),Kc=Td=d([J("esri.TimeExtent")],Kc);const sJ=new Kc,h4e=new Kc({start:void 0,end:void 0}),d4e=Kc;let UA=class extends IA{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([tce({Type:gb,ensureType:rl(gb)})],UA.prototype,"itemType",void 0),UA=d([J("esri.support.GraphicsCollection")],UA);const oJ=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function p4e(t,e="system"){if(!t||!oJ.has(t.timeZone))return e;const i=oJ.get(t.timeZone);return m4e(t.timeZone)||t.respectsDaylightSaving?i:f4e(i)}function f4e(t){const e=Li.local().setZone(t),i=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return i===0?"Etc/UTC":`Etc/GMT${el.instance(-i).formatOffset(0,"narrow")}`}function m4e(t){return t.startsWith("UTC")}let r_=class extends em(Nt){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,i){const{timeZone:r,respectsDaylightSaving:n}=i;return{timeZone:r,respectsDaylightSaving:n}}readTimeZone(e,i){return"timeZoneIANA"in i?i.timeZoneIANA:p4e(i)}writeTimeZone(e,i){i.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};d([m()],r_.prototype,"legacy",void 0),d([yr("legacy",["timeZone"])],r_.prototype,"readLegacy",null),d([m({type:String,nonNullable:!0})],r_.prototype,"timeZone",void 0),d([yr("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],r_.prototype,"readTimeZone",null),d([Pr("timeZone")],r_.prototype,"writeTimeZone",null),r_=d([J("esri.time.TimeReference")],r_);const sfe=r_;let n_=class extends ke{constructor(e){super(e),this.view=null,this.baseLayerViews=new Ci,this.referenceLayerViews=new Ci,this._loadingHandle=Pe(()=>{var i,r;return(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap},i=>{i&&i.load().catch(()=>{})},ar)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var i,r;if(this.view&&this.view.suspended)return!1;const e=(r=(i=this.view)==null?void 0:i.map)==null?void 0:r.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};d([m({constructOnly:!0})],n_.prototype,"view",void 0),d([m({readOnly:!0})],n_.prototype,"baseLayerViews",void 0),d([m({readOnly:!0})],n_.prototype,"referenceLayerViews",void 0),d([m({readOnly:!0})],n_.prototype,"suspended",null),d([m({type:Boolean,readOnly:!0})],n_.prototype,"updating",null),n_=d([J("esri.views.BasemapView")],n_);function g4e(t){return"tryRecycleWith"in t}let _4e=class{constructor(e,i,r){this.layer=e,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=sa(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Ca(this._controller.signal,()=>{const n=new ce("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!g4e(this.layerView))return null;const i=this.layer.type,r=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==i)continue;const o=this.layerView.tryRecycleWith(s,{signal:r});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(Ti(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Ca(this._controller.signal,()=>u(Qi())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:e}),r.emit("layerview-destroy",{layer:i,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var n,s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:i,view:r}=this;this._map=r.map;try{let a,l;if(await i.load({signal:e}),"prefetchResources"in i&&await((n=i.prefetchResources)==null?void 0:n.call(i,{signal:e})),v4e(i))a=await i.createLayerView(r,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new ce("layer:view-not-supported","No layerview implementation was found");const p=await this.layerViewImporter.importLayerView(i);Ti(e),a="default"in p?new p.default({layer:i,view:r}):new p({layer:i,view:r})}const c=()=>{l=Qr(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=Ca(e,c),Ti(e);try{await a.when()}catch(p){throw c(),p}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(i)))return c(),void this._deferred.reject(new ce("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=a,i.emit("layerview-create",{view:r,layerView:a}),r.emit("layerview-create",{layer:i,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){i.emit("layerview-create-error",{view:r,error:a}),r.emit("layerview-create-error",{layer:i,error:a}),this.done=!0,this._deferred.reject(new ce("layerview:create-error","layerview creation failed",{layer:i,error:a}))}}},rh=class extends ke{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Lf,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var r;const i=(r=this.view.map)==null?void 0:r.allLayers;if(i)for(const n of i)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=sa(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(A3(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const i=this.view.map;if(this._map!==i&&(this.clear(),this._map=i),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const r=new Set,n=[],s=this.view.ready,o=p=>{if(p!=null){for(const f of p)if(f){r.add(f);const y=this._layerLayerViewInfoMap.get(f);y&&s?y.start():y||this._recyclingInfoMap.has(f)||n.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const p of this._rootCollectionNames)o(this.get(p));for(const[p,f]of this._layerLayerViewInfoMap)if(!r.has(p)){this._layerLayerViewInfoMap.delete(f.layer);const y=f.tryRecycle(n);y?(this.notifyChange("updating"),this._recyclingInfoMap.set(f.layer,f),y.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[p,f]of this._recyclingInfoMap)r.has(p)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy());for(const p of n)this._createLayerView(p);this._refreshCollections();const a=[(l=i==null?void 0:i.ground)==null?void 0:l.layers,(c=i==null?void 0:i.basemap)==null?void 0:c.baseLayers,(u=i==null?void 0:i.basemap)==null?void 0:u.referenceLayers,i==null?void 0:i.layers].filter(p=>!!p);r.forEach(p=>"layers"in p&&a.push(p.layers)),this.addHandles(a.map(p=>this._watchUpdatingTracking.addOnCollectionChange(()=>p,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([$l(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),Pe(()=>{const e=this.view,i=e==null?void 0:e.map;return[i==null?void 0:i.basemap,i==null?void 0:i.ground,i==null?void 0:i.layers,e==null?void 0:e.ready]},()=>this._reschedule(),qn)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),g6(this._recyclingInfoMap),g6(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Qi()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Yo(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const i of this._layerLayerViewInfoMap.values())i.done||++e;return e}clear(){this.destroyed||(g6(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new ce("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,i]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(i),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,i,r){if(!e||!i)return void(i&&i.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=s,a.parent=r,i.at(n)!==a&&i.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<i.length&&i.splice(n,i.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const i=new _4e(e,this.view,this.layerViewImporter);i.promise.then(()=>this._refreshCollections(),r=>{r&&(ms(r)||r.name==="cancelled:layerview-create")||ye.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:r}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,i),this.view.ready&&i.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([m()],rh.prototype,"_workPromise",void 0),d([m({readOnly:!0})],rh.prototype,"_watchUpdatingTracking",void 0),d([m({readOnly:!0})],rh.prototype,"_layersToLayerViews",null),d([m({readOnly:!0})],rh.prototype,"_rootCollectionNames",null),d([m()],rh.prototype,"layerViewImporter",void 0),d([m()],rh.prototype,"supportsGround",void 0),d([m({readOnly:!0})],rh.prototype,"updating",null),d([m({readOnly:!0})],rh.prototype,"updatingRemaining",null),d([m({constructOnly:!0})],rh.prototype,"view",void 0),rh=d([J("esri.views.LayerViewManager")],rh);const y4e=rh;function v4e(t){return"createLayerView"in t&&t.createLayerView!=null}let qc=class extends ke{constructor(e){super(e),this.factor=1.5,this.offset=Uh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([m({type:Number})],qc.prototype,"factor",void 0),d([m({nonNullable:!0})],qc.prototype,"offset",void 0),d([m()],qc.prototype,"position",void 0),d([m({type:Number,range:{min:0}})],qc.prototype,"size",void 0),d([m()],qc.prototype,"maskUrl",void 0),d([m()],qc.prototype,"maskEnabled",void 0),d([m()],qc.prototype,"overlayUrl",void 0),d([m()],qc.prototype,"overlayEnabled",void 0),d([m({readOnly:!0})],qc.prototype,"version",null),d([m({type:Boolean})],qc.prototype,"visible",void 0),qc=d([J("esri.views.Magnifier")],qc);const ofe=qc;let b4e=class{constructor(){this._tasks=new Array,this._running=UP(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.push(new aJ(n,s,e,i,r)))}unshift(e,i,r){return this._running.value=!0,new Promise((n,s)=>this._tasks.unshift(new aJ(n,s,e,i,r)))}_process(e){var r;if(this._tasks.length===0)return!1;const i=this._tasks.shift();try{const n=Gs(i.signal);if(n&&!i.abortCallback)i.reject(Qi());else{const s=n?(r=i.abortCallback)==null?void 0:r.call(i,Qi()):i.callback(e);Pu(s)?s.then(i.resolve,i.reject):i.resolve(s)}}catch(n){i.reject(n)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=Qi();for(const i of this._tasks)if(i.abortCallback){const r=i.abortCallback(e);i.resolve(r)}else i.reject(e);this._tasks.length=0,this._running.value=!1}},aJ=class{constructor(e,i,r,n=void 0,s=void 0){this.resolve=e,this.reject=i,this.callback=r,this.signal=n,this.abortCallback=s}},NE=class extends ke{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([m()],NE.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([m()],NE.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),NE=d([J("esri.views.support.DebugFlags")],NE);const w4e=new NE;var Ji;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(Ji||(Ji={}));function x4e(){return new _D.Scheduler}var na,Dt;(function(t){t[t.YIELD=1]="YIELD"})(na||(na={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(Dt||(Dt={}));const _f=0,lJ=new Map([[Dt.RESOURCE_CONTROLLER_IMMEDIATE,_f],[Dt.RESOURCE_CONTROLLER,4],[Dt.SLIDE,_f],[Dt.STREAM_DATA_LOADER,_f],[Dt.ELEVATION_QUERY,_f],[Dt.TERRAIN_SURFACE,1],[Dt.SURFACE_GEOMETRY_UPDATES,1],[Dt.LOD_RENDERER,2],[Dt.GRAPHICS_CORE,2],[Dt.I3S_CONTROLLER,2],[Dt.POINT_CLOUD_LAYER,2],[Dt.FEATURE_TILE_FETCHER,2],[Dt.OVERLAY,4],[Dt.STAGE,4],[Dt.GRAPHICS_DECONFLICTOR,4],[Dt.FILTER_VISIBILITY,4],[Dt.SCALE_VISIBILITY,4],[Dt.FRUSTUM_VISIBILITY,4],[Dt.CLOUDS_GENERATOR,4],[Dt.POINT_OF_INTEREST_FREQUENT,6],[Dt.POINT_OF_INTEREST_INFREQUENT,30],[Dt.LABELER,8],[Dt.FEATURE_QUERY_ENGINE,8],[Dt.FEATURE_TILE_TREE,16],[Dt.FEATURE_TILE_TREE_ACTIVE,_f],[Dt.ELEVATION_ALIGNMENT,12],[Dt.TEXT_TEXTURE_ATLAS,12],[Dt.TEXTURE_UNLOAD,12],[Dt.LINE_OF_SIGHT_TOOL,16],[Dt.LINE_OF_SIGHT_TOOL_INTERACTIVE,_f],[Dt.SNAPPING,_f],[Dt.SHADOW_ACCUMULATOR,30]]);function cJ(t){return lJ.has(t)?lJ.get(t):typeof t=="number"?t:1}const uJ=6.5,hJ=1,T4e=30,dJ=1e3/30,pJ=100,fJ=.9;var _D,Xy;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=UP(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new cg("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=Ji.INTERACTING,this._tasks=new ri,this._runQueue=new ri,this._load=0,this._idleStateCallbacks=new ri,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=Pe(()=>w4e.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,ar);for(const o of Object.keys(Dt))this.performanceInfo.tasks.set(Dt[o],new cg(Dt[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:uJ,INTERACTING_BUDGET:dJ,IDLE_BUDGET:pJ,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Qr(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=cJ(s),l=new i(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new cg(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===Ji.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===Ji.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==Ji.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=uJ,a=s.frameDuration,l=hJ;switch(this.state){case Ji.IDLE:o=0,a=Math.max(pJ,s.frameDuration),l=T4e;break;case Ji.INTERACTING:a=Math.max(dJ,s.frameDuration);case Ji.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==Ji.IDLE&&a<hJ&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ji.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case Ji.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return Xy.SCHEDULED;let o=Xy.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=Xy.READY:o!==Xy.READY&&(o=Xy.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*fJ+s*(1-fJ)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===_f&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==_f&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===na.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){ye.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,Dt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(Dt))this._frameTaskTimes.set(Dt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class i{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new b4e,this._handles=new an,this.schedulePriority=this._basePriority,this._task=UP(a??this._queue),this._handles.add(Bh(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(Qa),this._scheduler.removeTask(this),this.schedule=OT.schedule,this.reschedule=OT.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=cJ(s);this._basePriority!==_f&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=Ji.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=r})(_D||(_D={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Xy||(Xy={}));const Qa=(()=>{const t=new _D.Budget;return t.enabled=!1,t})();let S4e=class{remove(){}processQueue(){}schedule(e,i,r){try{if(Gs(i)){const n=Qi();return r?Promise.resolve(r(n)):Promise.reject(n)}return _8(e(Qa))}catch(n){return Promise.reject(n)}}reschedule(e,i,r){return this.schedule(e,i,r)}};const OT=new S4e;let w2=class extends ke{constructor(e,i){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i==null?void 0:i.registerTask(Dt.TEXTURE_UNLOAD))??OT}normalizeCtorArgs(){return{}}destroy(){var e,i,r;super.destroy(),(e=this._frameTask)==null||e.remove(),(i=this._textureRequests)==null||i.forEach(n=>this._releaseTextureRequest(n)),(r=this._textureRequests)==null||r.clear()}get updating(){return this._frameTask.updating}fromData(e,i,r){var o,a;const n=this.makeUid(e);let s=this._textureRequests.get(n);if(!s){const l=new afe(r);l.texture=i(),(o=this._stage)==null||o.add(l.texture),(a=this._stage)==null||a.loadImmediate(l.texture),this._textureRequests.set(n,l),s=l}return s.referenceCount++,{uid:n,texture:s.texture,release:()=>this._release(n)}}_release(e){const i=this._textureRequests.get(e);i?(i.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),i.referenceCount--,i.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const i=this._textureRequests.get(e);!i||i.referenceCount>0||(this._releaseTextureRequest(i),this._textureRequests.delete(e))}_releaseTextureRequest(e){var i;e.onRemove&&e.onRemove(),e.texture?(i=this._stage)==null||i.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,i=null){return i!=null?`${e}.${i}px`:e}};d([m()],w2.prototype,"_frameTask",void 0),d([m()],w2.prototype,"updating",null),w2=d([J("esri.views.3d.support.TextureCollection")],w2);let afe=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var mJ;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(mJ||(mJ={}));const lfe=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],cfe={};function ufe(t){return!!cfe[t]}function C4e(t){for(const e of t)if(!ufe(e))return!1;return!0}lfe.forEach(t=>{cfe[t]=!0});let E4e=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:i,priority:r},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[i],r)})}disconnect(){this.inputManager&&this._handlers.forEach((e,i)=>{var r;return(r=this.inputManager)==null?void 0:r.uninstallHandlers(i)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,i,r,n){const s=Array.isArray(e)?e:e.split(",");if(!C4e(s))return s.some(ufe)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:n=r,n=n??Y_.DEFAULT;const l=this._createUniqueGroupName(),c=new A4e(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const u of s){const p=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),{remove:()=>this._removeHandler(l,s)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,i){if(this._handlers.has(e)){this._handlers.delete(e);for(const r of i){const n=this._handlerCounts.get(r);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):n===1?this._handlerCounts.delete(r):this._handlerCounts.set(r,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},A4e=class extends ko{constructor(e,i,r,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of i)switch(s){case"click":this.registerIncoming("click",r,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:i=>e.async(i),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:u,screenPoint:Uh(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:p=>e.async(p),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:p}=e;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:p}=e;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:i,button:r,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:i,button:r,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,i){return this.view.toMap(Uh(e,i),{exclude:[]})}_wrapDrag(e){const i=e.data,{x:r,y:n}=i.center,{action:s,pointerType:o,button:a}=i;if(s==="start"&&(this._latestDragStart=i),!this._latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:u,timestamp:p}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:r,y:n,origin:f,pointerType:o,button:a,buttons:c,radius:i.radius,angle:nl(i.angle),native:l,timestamp:p,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:i,repeat:r,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:i,repeat:r,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:i,native:r}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:i,native:r,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,i){const{x:r,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:p,timestamp:f}=e;return{type:i,x:r,y:n,pointerId:c,pointerType:u,button:s,buttons:o,native:a,timestamp:f,eventId:l,cancelable:p,stopPropagation:()=>e.stopPropagation(),async:y=>e.async(y),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:i,y:r,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,p={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:y}=e;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:n,action:u,origin:p,native:s,timestamp:y,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:v=>e.async(v),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:i,data:r,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:i,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:i,state:r,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=r;return{type:"gamepad",device:n,timestamp:o,action:i,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var BP,gJ,_J;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(BP||(BP={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(gJ||(gJ={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(_J||(_J={}));function P4e(t){return[t.on("before-add",e=>{const i=e.item;if(i==null||t.includes(i))return ye.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();i.onAdd()}),t.on("after-remove",e=>{const i=e.item;i.active&&(i.view.activeTool=null),i.destroy()})]}function Zz(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(BP.USER)&&t.getEditableFlag(BP.MANAGER)}function sf(t){return Uh(t.x,t.y)}function Y_t(t){return fn(t.x,t.y)}function hfe(t,e){var r;const i=(r=t instanceof HTMLElement?t:t.surface)==null?void 0:r.getBoundingClientRect();return i?Uh(e.clientX-i.left,e.clientY-i.top):Uh(0,0)}function yJ(t,e){return e instanceof Event?hfe(t,e):sf(e)}function vJ(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let O4e=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,i){const r=()=>e.stopPropagation();switch(e.type){case"pointer-move":bJ(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!wJ(e))break;const n=sf(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,i),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&i.activeTool==null&&(this._revertToNullActiveTool=!0,i.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),r());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,i);break;case"pointer-drag":{if(!wJ(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=Eh(n,({manipulator:u})=>u),o=Eh(n,({tool:u})=>u);if(s==null||o==null)break;const a=sf(e);a.x=$e(a.x,0,i.view.width),a.y=$e(a.y,0,i.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,i)}r();break}case"immediate-click":{const n=sf(e),s=this._intersect(n,e.pointerType,i.forEachTool);if(R4e(e)||i.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:p})=>{p.selected&&(p.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:r});break}case"click":{const n=sf(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),r();break}case"double-click":{const n=sf(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const n=sf(e),s=this._intersect(n,e.pointerType,i.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(e,i,r){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:sf(i)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(r.setActiveTool)}_handlePointerEnd(e,i){const r=Eh(this._grabbedManipulators.get(e.pointerId),({manipulator:n})=>n);r!=null&&r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:sf(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(i.setActiveTool))}_cursorFromMap(e){let i=null;return Yo(e,({manipulator:r})=>!(r==null||!r.interactive)&&(r.grabbing&&r.grabCursor?(i=r.grabCursor,!0):!!r.cursor&&(i=r.cursor,!0))),i}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const i=new Set,r=new Set;this._grabbedManipulators.forEach(({tool:n})=>{i.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{r.add(n)}),e(n=>{n.hasGrabbedManipulators=i.has(n),n.hasHoveredManipulators=r.has(n);const s=this._grabbedManipulators.values(),o=GTe(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:i,setActiveTool:r},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(r),this._onFocusChange(i)}_intersect(e,i,r){let n=null;return r(s=>{if(s.manipulators==null||!Zz(s))return!1;const o=s.manipulators.intersect(e,i);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(Uh(i.x,i.y),r,i.pointerType,e)})}handleHoverEvent(e,i){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!bJ(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(sf(e),e.pointerId,e.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(e,i,r,n){let s=this._intersect(e,r,n);const o=Eh(this._hoveredManipulators.get(i),({manipulator:a})=>a);s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(i,s)):this._hoveredManipulators.delete(i),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function bJ(t){return t==="mouse"}function wJ(t){return t.pointerType!=="mouse"||t.button===0}function R4e(t){return!!t.native.shiftKey}const xJ="attached",y6="tools",M4e=1e3;let Sd=class extends LP{constructor(e){super(e),this._clock=C3,this._manipulatorState=new O4e,this.tools=new Ci,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=i=>{for(const r of this.tools.items)if(i(r))return}}initialize(){this.handles.add([this.view.on(lfe,e=>{this._handleInputEvent(e)},Y_.TOOL),...P4e(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void ye.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const i=this.activeTool;this._set("activeTool",e),i!=null&&i.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const r of this.tools){this._updateToolEditableFlag(r);const n=Zz(r);this.activeTool!=null&&n||this._manipulatorState.clearPointers(r,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=Qr(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,M4e)}attach(){var e;this.view.type==="3d"?(this._set("textures",new w2(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([Pe(()=>{const{state:i}=this.view;return"camera"in i&&i.camera},()=>this._forEachManipulator(i=>i.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",i=>this._forEachManipulator(r=>r.onElevationChange(i))),il(()=>this._set("textures",Je(this.textures)))],xJ)):this.handles.add(Pe(()=>this.view.extent,()=>this._forEachManipulator(i=>i.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(xJ),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(i=>{i.manipulators&&i.manipulators.forEach(({manipulator:r})=>e(r,i))})}_handleInputEvent(e){let i=!1;const r={...e,stopPropagation:()=>{i=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(r):this._forEachTool(n=>{!i&&n.visible&&n.handleInputEvent(r)}),!i&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(r,this._manipulatorStateEventArgs),i||this.activeTool==null||this.activeTool.handleInputEventAfter(r),this._manipulatorState.handleHoverEvent(r,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(y6),this._forEachTool(e=>{if(e instanceof ke){const i=Pe(()=>[e.cursor,e.visible,e.editable],()=>{Zz(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(i,y6)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",i=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,i.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],y6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var i;(i=e.setEditableFlag)==null||i.call(e,BP.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(i=>!(i.cursor==null||!i.visible)&&(e=i.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(i=>(e==null||i!==e)&&!i.created&&i.removeIncompleteOnCancel).forEach(i=>{this.tools.remove(i)})}get test(){return{setClock:e=>this._clock=e}}};d([m({constructOnly:!0,nonNullable:!0})],Sd.prototype,"view",void 0),d([m({readOnly:!0,nonNullable:!0})],Sd.prototype,"textures",void 0),d([m({value:null})],Sd.prototype,"activeTool",null),d([m({readOnly:!0,type:Ci})],Sd.prototype,"tools",void 0),d([m({readOnly:!0})],Sd.prototype,"cursor",void 0),d([m({readOnly:!0})],Sd.prototype,"updating",null),d([m()],Sd.prototype,"_interacting",void 0),d([m({readOnly:!0})],Sd.prototype,"interacting",null),Sd=d([J("esri.views.ToolViewManager")],Sd);let jx=class extends ke{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":$4e.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return I4e[this.deviceType]}};d([m({nonNullable:!0,readOnly:!0})],jx.prototype,"nativeIndex",void 0),d([m({type:String,readOnly:!0})],jx.prototype,"deviceType",null),d([m({type:Number,readOnly:!0})],jx.prototype,"axisThreshold",null),jx=d([J("esri.views.input.gamepad.GamepadInputDevice")],jx);const $4e=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),I4e={standard:.15,spacemouse:.025,unknown:0},gH=jx;let FE=class extends ke{constructor(...e){super(...e),this.devices=new Ci,this.enabledFocusMode="document"}};d([m({type:Ci.ofType(gH),readOnly:!0})],FE.prototype,"devices",void 0),d([m({type:["document","view","none"]})],FE.prototype,"enabledFocusMode",void 0),FE=d([J("esri.views.input.gamepad.GamepadSettings")],FE);const L4e=FE;let AI=class extends ke{constructor(){super(...arguments),this.gamepad=new L4e}};d([m({readOnly:!0})],AI.prototype,"gamepad",void 0),AI=d([J("esri.views.input.Input")],AI);const D4e=AI;let s_=class extends ke{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([m({type:Boolean,nonNullable:!0})],s_.prototype,"enabled",void 0),d([m({type:gH})],s_.prototype,"device",void 0),d([m({type:["pan","zoom"],nonNullable:!0})],s_.prototype,"mode",void 0),d([m({type:["forward-down","forward-up"],nonNullable:!0})],s_.prototype,"tiltDirection",void 0),d([m({type:Number,nonNullable:!0})],s_.prototype,"velocityFactor",void 0),s_=d([J("esri.views.navigation.gamepad.GamepadSettings")],s_);const dfe=s_;let Hv=class extends ke{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new dfe,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};d([m({type:Boolean})],Hv.prototype,"browserTouchPanEnabled",void 0),d([m({type:dfe,nonNullable:!0})],Hv.prototype,"gamepad",void 0),d([m({type:Boolean})],Hv.prototype,"momentumEnabled",void 0),d([m({type:Boolean})],Hv.prototype,"mouseWheelZoomEnabled",void 0),Hv=d([J("esri.views.navigation.Navigation")],Hv);const pfe=Hv,ffe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},mfe=Object.values(ffe),gfe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${mfe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),N4e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${mfe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),F4e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function nyt(t){return!!gfe.test(t)}function _H(t){if(t==null)return null;const e=sl(t),i=e.path.match(gfe)||e.path.match(N4e);if(!i)return null;const[,r,n,s,o]=i,a=n.indexOf("/");return{title:_fe(a!==-1?n.slice(a+1):n),serverType:ffe[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function k4e(t){const e=sl(t).path.match(F4e);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function _fe(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function syt(t,e){const i=[];if(t){const r=_H(t);r!=null&&r.title&&i.push(r.title)}if(e){const r=_fe(e);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function oyt(t){if(!t)return!1;const e=".arcgis.com/",i="//services",r="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(i)||t.includes(r)||t.includes(n);return s&&o}function ayt(t,e){return t&&ehe(ihe(t,e))}function lyt(t){let{url:e}=t;if(!e)return{url:e};e=ihe(e,t.logger);const i=sl(e),r=_H(i.path);let n;if(r!=null)r.sublayer!=null&&t.layer.layerId==null&&(n=r.sublayer),e=r.url.path;else if(t.nonStandardUrlAllowed){const s=k4e(i.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:ehe(e),layerId:n}}function cyt(t,e,i,r,n){pb(e,r,"url",n),r.url&&t.layerId!=null&&(r.url=x5(r.url,i,t.layerId.toString()))}function uyt(t){if(!t)return!1;const e=t.toLowerCase(),i=e.includes("/services/"),r=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return i&&(r||n||s)}function hyt(t,e,i){const r=yfe(t),n=e,s=U4e(r,n,i);if(r){const o=z3.deriveUnitFromSR(r,t.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new ce("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new ce("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!z4e(t)||s===lc.Unsupported)return new ce("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(s){case lc.Units:{const o=(r==null?void 0:r.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new ce("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new ce("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case lc.HeightModel:{const o=(r==null?void 0:r.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new ce("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new ce("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}case lc.CRS:{const o=(r==null?void 0:r.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new ce("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new ce("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:n,error:l})}}return null}function U4e(t,e,i){if(!TJ(t)||!TJ(e))return lc.Unsupported;if(t==null||e==null)return lc.Ok;if(!i&&t.heightUnit!==e.heightUnit)return lc.Units;if(t.heightModel!==e.heightModel)return lc.HeightModel;switch(t.heightModel){case"gravity-related-height":return lc.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?lc.Ok:lc.CRS;default:return lc.Unsupported}}var lc;function TJ(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function z4e(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!wfe(t)}function yfe(t){var r;const e=t.url?_H(t.url):void 0;return!(((r=t.spatialReference)==null?void 0:r.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&vfe(t)&&t.heightModelInfo?t.heightModelInfo:wfe(t)?z3.deriveUnitFromSR(V4e,t.spatialReference):null}function vfe(t){return"heightModelInfo"in t}function bfe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function wfe(t){return bfe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):xfe(t)}function B4e(t){return t.layers!=null||xfe(t)||bfe(t)||vfe(t)}function xfe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(lc||(lc={}));const V4e=new z3({heightModel:"gravity-related-height"});var Ke;function SJ(t){return t==="global"?Ke.Global:Ke.Local}function v6(t){return t===Ke.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(Ke||(Ke={}));let Xz,b6=null;async function G4e(t){b6||(b6=Oe(()=>Promise.resolve().then(()=>git),void 0,import.meta.url).then(e=>Xz=e)),await b6,Ti(t)}async function Tfe(t,e,i,r){if(!t)return null;const n=t.spatialReference;return D5()||hy(n,e)?pS(t,e):Xz?Xz.projectGeometry(t,e,i,r):(await Promise.race([G4e(r),DP(r)]),Tfe(t,e,i,r))}let tn=class extends ke{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=wu(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var r,n,s,o;const e=(r=this.map)==null?void 0:r.call(this),i=[];return this.priorityCollection!=null&&i.push(this.priorityCollection),i.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),i}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;let r=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(r,o);a!=null&&(r=a)}if(r!=null&&r.length===1)break}if(i&&(r==null||r.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(r);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var r,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:i}=this._collectLayers([{parent:(n=(r=this.map)==null?void 0:r.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:i}}get _heightModelInfoTask(){var r,n,s;if(!this.required.heightModelInfo||this.suspended&&((r=this._get("_heightModelInfoTask"))!=null&&r.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:i}=this._allLayers;for(const o of e)if(B4e(o)){const a=yfe(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:i}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,i=e.updating,r=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)r.push({extent:l,layer:n})}return{candidates:r,updating:i}}get _extentTask(){const{candidates:e,updating:i}=this._extentCandidatesTask;if(i)return{updating:i};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const r=this._pickExtentCandidate(e),n=this.spatialReference;return r.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=wu(this._projectExtentTask.task)),this._projectExtentTask={input:r.extent.clone(),output:null,spatialReference:n.clone(),task:_S(async s=>{try{const o=await Tfe(r.extent,n,"portalItem"in r.layer?r.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(Gs(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,i){if(e==null)return i;const r=[],n=(s,o)=>s!=null?o!=null?s===o&&s:s:o;for(const s of e)for(const o of i){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){r.push({spatialReference:s.spatialReference,viewingMode:a});break}}return r.length>0?r:null}_pickSpatialReferenceCandidate(e){const i=this.defaultSpatialReference;return e==null||e.length<1?i!=null?{spatialReference:i,viewingMode:null}:null:(i!=null&&e.length>1&&e.some(({spatialReference:r})=>r.equals(i))&&(e=e.filter(({spatialReference:r})=>r.equals(i))),e.length>1&&e.some(({viewingMode:r})=>r!==Ke.Local)&&(e=e.filter(({viewingMode:r})=>r!==Ke.Local)),e[0])}_getSupportedSpatialReferences(e){const i="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(i.length===0)return[];const r=[];for(const n of i){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const o=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||r.push({spatialReference:a,viewingMode:l})}}return r}_pickExtentCandidate(e){const i=this.spatialReference;return e.find(({extent:r})=>i.equals(r.spatialReference))||e[0]}_collectLayers(e){var r;if(this._loadMaybe((r=this.map)==null?void 0:r.call(this))!=="loaded")return{layers:[],updating:!0};const i=new j4e;for(const n of e)if(this._collectCollection(n,i),i.preloading===this.sourcePreloadCount)break;return{layers:i.layers,updating:i.updating}}_collectCollection(e,i){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return i.updating=!0,void++i.preloading;case"failed":return}for(const r of e.layers){switch(this._loadMaybe(r)){case"failed":continue;case"loading":i.updating=!0,++i.preloading;break;case"loaded":i.updating||i.layers.push(r),"layers"in r&&this._collectCollection({layers:r.layers},i)}if(i.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(i=>{ms(i)||console.log(i)}),"loading"):e.loadStatus:"loaded"}};d([m()],tn.prototype,"required",void 0),d([m({constructOnly:!0})],tn.prototype,"map",void 0),d([m({constructOnly:!0})],tn.prototype,"getSpatialReferenceSupport",void 0),d([m()],tn.prototype,"defaultSpatialReference",void 0),d([m()],tn.prototype,"userSpatialReference",void 0),d([m()],tn.prototype,"sourcePreloadCount",void 0),d([m()],tn.prototype,"priorityCollection",void 0),d([m()],tn.prototype,"requiresExtentInSpatialReference",void 0),d([m()],tn.prototype,"suspended",void 0),d([m({readOnly:!0})],tn.prototype,"ready",null),d([m({readOnly:!0})],tn.prototype,"heightModelInfoReady",null),d([m({readOnly:!0})],tn.prototype,"spatialReference",null),d([m({readOnly:!0})],tn.prototype,"extent",null),d([m({readOnly:!0})],tn.prototype,"heightModelInfo",null),d([m({readOnly:!0})],tn.prototype,"vcsWkid",null),d([m({readOnly:!0})],tn.prototype,"latestVcsWkid",null),d([m({readOnly:!0})],tn.prototype,"viewingMode",null),d([m({readOnly:!0})],tn.prototype,"tileInfo",null),d([m({readOnly:!0})],tn.prototype,"mapCollections",null),d([m({readOnly:!0})],tn.prototype,"_allLayers",null),d([m({readOnly:!0})],tn.prototype,"_spatialReferenceTask",null),d([m({readOnly:!0})],tn.prototype,"_tileInfoTask",null),d([m({readOnly:!0})],tn.prototype,"_heightModelInfoTask",null),d([m({readOnly:!0})],tn.prototype,"_extentCandidatesTask",null),d([m()],tn.prototype,"_extentTask",null),d([m()],tn.prototype,"_projectExtentTask",void 0),tn=d([J("esri.views.support.DefaultsFromMap")],tn);let j4e=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var kE;let Xt=kE=class extends Nj(os.EventedMixin(Ej(ke))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new zP({getCollections:()=>{var e,i,r;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:W4e}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new UA,this.analyses=new AT,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Ci,this.magnifier=new ofe,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new sfe,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new D4e,this.navigation=new pfe,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new E4e(this),this.persistableViewModels=new Ci,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(Pe(()=>this.preconditionsReady,e=>{var i,r;e?(this._currentSpatialReference=this.spatialReference,kE.views.add(this)):(this._currentSpatialReference=null,kE.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((i=this.toolViewManager)==null||i.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(r=this.layerViewManager)==null||r.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},gr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,MP(()=>this.ready)))),this.basemapView=new n_({view:this}),this.layerViewManager=new y4e({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Sd({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([Pe(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),Pe(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),Pe(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([Pe(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(e&&!this.spatialReference&&i){if(t!=null)return;const n=il(()=>t=wu(t));t=_S(async s=>{try{await _P(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}ye.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(n,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(kE.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Je(this.graphics),this.analyses=Je(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Je(this.analysisViewManager),this.toolViewManager=Je(this.toolViewManager),this.layerViewManager=Je(this.layerViewManager),this.basemapView=Je(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(i=>i.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=Je(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return ye.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new tn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||ly.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(ye.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),ly.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,i;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((i=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&i.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!go(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new ce("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&ye.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(Bh(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};Xt.views=new Ci,d([m()],Xt.prototype,"_userSpatialReference",void 0),d([m()],Xt.prototype,"activeTool",null),d([m({readOnly:!0})],Xt.prototype,"allLayerViews",void 0),d([m()],Xt.prototype,"groundView",void 0),d([m()],Xt.prototype,"animation",null),d([m()],Xt.prototype,"basemapView",void 0),d([m()],Xt.prototype,"center",null),d([m({readOnly:!0})],Xt.prototype,"_defaultsFromMapSettings",null),d([m()],Xt.prototype,"defaultsFromMap",null),d([m()],Xt.prototype,"fatalError",void 0),d([m({type:Ar})],Xt.prototype,"extent",null),d([m(mz(UA,"graphics"))],Xt.prototype,"graphics",void 0),d([m(mz(AT,"analyses"))],Xt.prototype,"analyses",void 0),d([m({readOnly:!0,type:z3})],Xt.prototype,"heightModelInfo",null),d([m({readOnly:!0})],Xt.prototype,"interacting",null),d([m({readOnly:!0})],Xt.prototype,"navigating",null),d([m({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Xt.prototype,"preconditionsReady",null),d([m({readOnly:!0})],Xt.prototype,"typeSpecificPreconditionsReady",void 0),d([m({type:Ci,readOnly:!0})],Xt.prototype,"layerViews",void 0),d([m()],Xt.prototype,"resolution",null),d([m({type:ofe})],Xt.prototype,"magnifier",void 0),d([m({value:null,type:nfe})],Xt.prototype,"map",null),d([m()],Xt.prototype,"padding",void 0),d([m({readOnly:!0})],Xt.prototype,"ready",void 0),d([m({type:jt})],Xt.prototype,"spatialReference",null),d([m()],Xt.prototype,"spatialReferenceWarningDelay",void 0),d([m()],Xt.prototype,"stationary",null),d([m({readOnly:!0})],Xt.prototype,"supportsGround",void 0),d([m({type:d4e})],Xt.prototype,"timeExtent",void 0),d([m({type:sfe,nonNullable:!0})],Xt.prototype,"timeReference",void 0),d([m()],Xt.prototype,"tools",null),d([m()],Xt.prototype,"toolViewManager",void 0),d([m({readOnly:!0})],Xt.prototype,"type",void 0),d([m({type:Number})],Xt.prototype,"scale",void 0),d([m({readOnly:!0})],Xt.prototype,"updating",void 0),d([m({readOnly:!0})],Xt.prototype,"initialExtentRequired",void 0),d([m({readOnly:!0})],Xt.prototype,"initialExtent",null),d([m()],Xt.prototype,"cursor",null),d([m({readOnly:!0})],Xt.prototype,"input",void 0),d([m({type:pfe,nonNullable:!0})],Xt.prototype,"navigation",void 0),d([m()],Xt.prototype,"layerViewManager",void 0),d([m()],Xt.prototype,"analysisViewManager",void 0),d([m()],Xt.prototype,"width",void 0),d([m()],Xt.prototype,"height",void 0),d([m({readOnly:!0})],Xt.prototype,"resizing",void 0),d([m({value:null,readOnly:!0})],Xt.prototype,"size",null),d([m({readOnly:!0})],Xt.prototype,"suspended",void 0),d([m({readOnly:!0})],Xt.prototype,"viewEvents",void 0),d([m({readOnly:!0})],Xt.prototype,"persistableViewModels",void 0),d([m()],Xt.prototype,"_isValid",void 0),d([m()],Xt.prototype,"_readyCycleForced",void 0),d([m()],Xt.prototype,"_currentSpatialReference",void 0),Xt=kE=d([J("esri.views.View")],Xt);const H4e=Xt;function W4e(t){return t.layerViews}let o_=class extends tD{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=sa(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new ce("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,i){i||(i=Pu(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",i)}};d([m({readOnly:!0})],o_.prototype,"done",null),d([m({readOnly:!0,type:String})],o_.prototype,"state",void 0),d([m()],o_.prototype,"target",void 0),o_=d([J("esri.views.ViewAnimation")],o_),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(o_||(o_={}));const RT=o_,mC=()=>Oe(()=>import("./TileLayerView3D-96195bc2.js"),["./TileLayerView3D-96195bc2.js","./LayerView3D-ba0927cb.js","./TiledLayerView3D-a62304ae.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./MapServiceLayerViewHelper-cc81f0b8.js","./floorFilterUtils-080a7cd2.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./sql-a39124b8.js","./sublayerUtils-212558d3.js","./popupUtils-81d67c22.js","./drapedUtils-fd696ea8.js"],import.meta.url),CJ=()=>Oe(()=>import("./ElevationLayerView3D-71a09930.js"),["./ElevationLayerView3D-71a09930.js","./LayerView3D-ba0927cb.js","./TiledLayerView3D-a62304ae.js","./LayerView-dc80e8d1.js"],import.meta.url),EJ={"base-dynamic":()=>Oe(()=>import("./BaseDynamicLayerView3D-64c18aa7.js"),["./BaseDynamicLayerView3D-64c18aa7.js","./DynamicLayerView3D-e8db3982.js","./LayerView3D-ba0927cb.js","./projectExtentUtils-a83fe3e6.js","./ImageMaterial-b5d1ffc4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),"base-elevation":CJ,"base-tile":mC,"bing-maps":mC,"building-scene":()=>Oe(()=>import("./BuildingSceneLayerView3D-e67f9da8.js"),["./BuildingSceneLayerView3D-e67f9da8.js","./BuildingGroupSublayer-2d82894a.js","./BuildingComponentSublayer-109daa01.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./diffUtils-3c37f4e6.js","./colorRamps-54548a9c.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./FeatureLayer-7c5e0432.js","./MultiOriginJSONSupport-d720758b.js","./sql-a39124b8.js","./FeatureLayerBase-43dae5ea.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./featureLayerUtils-ce39121a.js","./AttachmentQuery-dd62ce87.js","./Query-cdee9722.js","./RelationshipQuery-ab8c76dd.js","./serviceCapabilitiesUtils-8d66cffa.js","./queryZScale-2a8227ea.js","./FeatureSet-d4d9321c.js","./APIKeyMixin-be880531.js","./ArcGISService-163e63f0.js","./BlendLayer-08a76f1b.js","./jsonUtils-555359b4.js","./CustomParametersMixin-64be6818.js","./FeatureEffectLayer-142ba535.js","./FeatureEffect-82bb4002.js","./FeatureFilter-e71c77dc.js","./FeatureReductionLayer-b84a7e30.js","./LabelClass-3b8bddeb.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./OperationalLayer-5b164959.js","./OrderedLayer-908cb5be.js","./PortalLayer-473e8b12.js","./portalItemUtils-89a0d48a.js","./ScaleRangeLayer-31eefac8.js","./TemporalLayer-5e4b9999.js","./FeatureTemplate-0db006f4.js","./FeatureType-e95921de.js","./fieldProperties-ff8bee5a.js","./labelingInfo-66d1a5d0.js","./versionUtils-9472ade8.js","./styleUtils-5fb07ac6.js","./TopFeaturesQuery-da745a52.js","./popupUtils-8d4c7bed.js","./capabilities-5d185925.js","./I3SIndexInfo-27be0331.js","./I3SLayerDefinitions-3ba92081.js","./I3SUtil-8ed72294.js","./I3SBinaryReader-2204e87b.js","./popupUtils-81d67c22.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./I3SMeshView3D-8bd9e500.js","./I3SOverrides-27af5843.js","./I3SNode-cc10b91f.js","./meshFeatureSet-14795b8b.js","./MeshGeoreferencedRelativeVertexSpace-01dadcff.js","./MeshLocalVertexSpace-e2febaf3.js","./georeference-840449ac.js","./External-c5d404b6.js","./FeatureLayerView3D-1f9d56b0.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./Graphics3DObjectStates-a2a2a068.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./EventedSet-8099b172.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./SceneModification-b2c3b385.js","./persistable-6c8e20e5.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-045df4e7.js","./SceneLayerWorker-3285c2a1.js","./I3SQueryFeatureStore-40694f11.js","./DefinitionExpressionSceneLayerView-5474fc38.js"],import.meta.url),csv:()=>Oe(()=>import("./CSVLayerView3D-7132b49a.js"),["./CSVLayerView3D-7132b49a.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./Query-cdee9722.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureSet-d4d9321c.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),dimension:()=>Oe(()=>import("./DimensionLayerView3D-981d8cb4.js"),["./DimensionLayerView3D-981d8cb4.js","./LayerView3D-ba0927cb.js","./LayerView-dc80e8d1.js"],import.meta.url),elevation:CJ,feature:()=>Oe(()=>import("./FeatureLayerView3D-1f9d56b0.js"),["./FeatureLayerView3D-1f9d56b0.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./Query-cdee9722.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureSet-d4d9321c.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),geojson:()=>Oe(()=>import("./GeoJSONLayerView3D-44145e47.js"),["./GeoJSONLayerView3D-44145e47.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./Query-cdee9722.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureSet-d4d9321c.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),graphics:()=>Oe(()=>import("./GraphicsLayerView3D-c7a9edf3.js"),["./GraphicsLayerView3D-c7a9edf3.js","./LayerView3D-ba0927cb.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./GraphicsProcessor-c1075744.js","./diffUtils-3c37f4e6.js","./Query-cdee9722.js","./Graphics3DObjectStates-a2a2a068.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./projectExtentUtils-a83fe3e6.js","./LayerView-dc80e8d1.js"],import.meta.url),group:()=>Oe(()=>import("./GroupLayerView-221bdabe.js"),["./GroupLayerView-221bdabe.js","./LayerView-dc80e8d1.js"],import.meta.url),imagery:()=>Oe(()=>import("./ImageryLayerView3D-f97cdec5.js"),["./ImageryLayerView3D-f97cdec5.js","./DynamicLayerView3D-e8db3982.js","./LayerView3D-ba0927cb.js","./projectExtentUtils-a83fe3e6.js","./ImageMaterial-b5d1ffc4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./Query-cdee9722.js","./popupUtils-81d67c22.js"],import.meta.url),"integrated-mesh":()=>Oe(()=>import("./IntegratedMeshLayerView3D-4b7a04df.js"),["./IntegratedMeshLayerView3D-4b7a04df.js","./I3SMeshView3D-8bd9e500.js","./I3SOverrides-27af5843.js","./I3SNode-cc10b91f.js","./I3SUtil-8ed72294.js","./Query-cdee9722.js","./I3SBinaryReader-2204e87b.js","./meshFeatureSet-14795b8b.js","./MeshGeoreferencedRelativeVertexSpace-01dadcff.js","./MeshLocalVertexSpace-e2febaf3.js","./georeference-840449ac.js","./External-c5d404b6.js","./FeatureSet-d4d9321c.js","./FeatureLayerView3D-1f9d56b0.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./SceneModification-b2c3b385.js","./persistable-6c8e20e5.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-045df4e7.js","./SceneLayerWorker-3285c2a1.js"],import.meta.url),"line-of-sight":()=>Oe(()=>import("./LineOfSightLayerView3D-052fc3b1.js"),["./LineOfSightLayerView3D-052fc3b1.js","./LayerView3D-ba0927cb.js","./LayerView-dc80e8d1.js"],import.meta.url),"map-image":()=>Oe(()=>import("./MapImageLayerView3D-9cfafdf7.js"),["./MapImageLayerView3D-9cfafdf7.js","./DynamicLayerView3D-e8db3982.js","./LayerView3D-ba0927cb.js","./projectExtentUtils-a83fe3e6.js","./ImageMaterial-b5d1ffc4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./ExportImageParameters-ea1f759a.js","./sql-a39124b8.js","./floorFilterUtils-080a7cd2.js","./sublayerUtils-212558d3.js","./MapServiceLayerViewHelper-cc81f0b8.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./popupUtils-81d67c22.js","./drapedUtils-fd696ea8.js"],import.meta.url),media:()=>Oe(()=>import("./MediaLayerView3D-64a4aa89.js"),["./MediaLayerView3D-64a4aa89.js","./MediaElementView-e70737ce.js","./normalizeUtilsSync-be783f45.js","./normalizeUtilsCommon-a78292a0.js","./LayerView3D-ba0927cb.js","./ImageMaterial-b5d1ffc4.js","./LayerView-dc80e8d1.js"],import.meta.url),"ogc-feature":()=>Oe(()=>import("./OGCFeatureLayerView3D-a5b6d1ea.js"),["./OGCFeatureLayerView3D-a5b6d1ea.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./Query-cdee9722.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureSet-d4d9321c.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),"open-street-map":mC,"oriented-imagery":()=>Oe(()=>import("./FeatureLayerView3D-1f9d56b0.js"),["./FeatureLayerView3D-1f9d56b0.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./Query-cdee9722.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureSet-d4d9321c.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),"point-cloud":()=>Oe(()=>import("./PointCloudLayerView3D-bf74950a.js").then(t=>t.P),["./PointCloudLayerView3D-bf74950a.js","./LayerView3D-ba0927cb.js","./I3SUtil-8ed72294.js","./Query-cdee9722.js","./I3SBinaryReader-2204e87b.js","./PointCloudWorkerUtil-2680b882.js","./PointCloudUniqueValueRenderer-1def1441.js","./ColorStop-0686847d.js","./PopupSceneLayerView-bc5cd82c.js","./popupUtils-81d67c22.js","./LayerView-dc80e8d1.js"],import.meta.url),voxel:()=>Oe(()=>import("./VoxelLayerView3D-9b3680d4.js"),["./VoxelLayerView3D-9b3680d4.js","./LayerView3D-ba0927cb.js","./PopupSceneLayerView-bc5cd82c.js","./popupUtils-81d67c22.js","./LayerView-dc80e8d1.js"],import.meta.url),route:()=>Oe(()=>import("./RouteLayerView3D-2893618c.js"),["./RouteLayerView3D-2893618c.js","./Stop-6fae4448.js","./LayerView3D-ba0927cb.js","./GraphicsProcessor-c1075744.js","./diffUtils-3c37f4e6.js","./Query-cdee9722.js","./Graphics3DObjectStates-a2a2a068.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./projectExtentUtils-a83fe3e6.js","./EventedSet-8099b172.js","./LayerView-dc80e8d1.js"],import.meta.url),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?Oe(()=>import("./SceneLayerView3D-a940590f.js"),["./SceneLayerView3D-a940590f.js","./I3SOverrides-27af5843.js","./I3SNode-cc10b91f.js","./I3SUtil-8ed72294.js","./Query-cdee9722.js","./I3SBinaryReader-2204e87b.js","./meshFeatureSet-14795b8b.js","./MeshGeoreferencedRelativeVertexSpace-01dadcff.js","./MeshLocalVertexSpace-e2febaf3.js","./georeference-840449ac.js","./External-c5d404b6.js","./FeatureSet-d4d9321c.js","./FeatureLayerView3D-1f9d56b0.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./I3SMeshView3D-8bd9e500.js","./SceneModification-b2c3b385.js","./persistable-6c8e20e5.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-045df4e7.js","./SceneLayerWorker-3285c2a1.js","./SceneLayerView-bbe86e7f.js","./DefinitionExpressionSceneLayerView-5474fc38.js","./I3SQueryFeatureStore-40694f11.js","./PopupSceneLayerView-bc5cd82c.js"],import.meta.url):Oe(()=>import("./SceneLayerGraphicsView3D-e7f32903.js"),["./SceneLayerGraphicsView3D-e7f32903.js","./I3SOverrides-27af5843.js","./I3SNode-cc10b91f.js","./I3SUtil-8ed72294.js","./Query-cdee9722.js","./I3SBinaryReader-2204e87b.js","./meshFeatureSet-14795b8b.js","./MeshGeoreferencedRelativeVertexSpace-01dadcff.js","./MeshLocalVertexSpace-e2febaf3.js","./georeference-840449ac.js","./External-c5d404b6.js","./FeatureSet-d4d9321c.js","./FeatureLayerView3D-1f9d56b0.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./SceneLayerView-bbe86e7f.js","./DefinitionExpressionSceneLayerView-5474fc38.js","./PopupSceneLayerView-bc5cd82c.js"],import.meta.url),stream:()=>Oe(()=>import("./StreamLayerView3D-937a523d.js"),["./StreamLayerView3D-937a523d.js","./StreamFeatureManager-140d5c90.js","./createConnection-cea53b95.js","./query-af06498b.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./Query-cdee9722.js","./EventedSet-8099b172.js","./FeatureLikeLayerView3D-c7be134f.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureSet-d4d9321c.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./LayerView-dc80e8d1.js"],import.meta.url),tile:mC,"imagery-tile":()=>Oe(()=>import("./ImageryTileLayerView3D-694e3bb4.js"),["./ImageryTileLayerView3D-694e3bb4.js","./LayerView3D-ba0927cb.js","./TiledLayerView3D-a62304ae.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./rasterProjectionHelper-0467928e.js","./popupUtils-81d67c22.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./drapedUtils-fd696ea8.js"],import.meta.url),"vector-tile":()=>Oe(()=>import("./VectorTileLayerView3D-33ed2cdb.js"),["./VectorTileLayerView3D-33ed2cdb.js","./Rect-98da58d6.js","./pbf-18997bde.js","./rasterizingUtils-a3cc983a.js","./TileInfoView-b5d908d2.js","./definitions-bc94d273.js","./number-e491b09e.js","./GeometryUtils-0258f920.js","./StyleRepository-e2eb595e.js","./colorUtils-c0f43caf.js","./TileClipper-ae6eca9e.js","./LayerView3D-ba0927cb.js","./TiledLayerView3D-a62304ae.js","./LayerView-dc80e8d1.js"],import.meta.url),wcs:()=>Oe(()=>import("./ImageryTileLayerView3D-694e3bb4.js"),["./ImageryTileLayerView3D-694e3bb4.js","./LayerView3D-ba0927cb.js","./TiledLayerView3D-a62304ae.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./rasterProjectionHelper-0467928e.js","./popupUtils-81d67c22.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./drapedUtils-fd696ea8.js"],import.meta.url),"web-tile":mC,wfs:()=>Oe(()=>import("./WFSLayerView3D-f5da873c.js"),["./WFSLayerView3D-f5da873c.js","./FeatureLayerViewBase3D-9c2bf55c.js","./FeatureLikeLayerView3D-c7be134f.js","./Query-cdee9722.js","./dehydratedFeatureComparison-acae6d2e.js","./queryForSymbologySnapping-ae73b710.js","./elevationInfoUtils-a7c808f6.js","./hash-6f442295.js","./diffUtils-3c37f4e6.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./Graphics3DObjectStates-a2a2a068.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js","./FeatureFilter-e71c77dc.js","./floorFilterUtils-080a7cd2.js","./QueryEngine-75e718c4.js","./normalizeUtils-1bd513d6.js","./normalizeUtilsCommon-a78292a0.js","./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js","./json-48e3ea08.js","./QueryEngineCapabilities-42e44ded.js","./utils-d3077f8c.js","./generateRendererUtils-77922da6.js","./FeatureSet-d4d9321c.js","./FeatureStore-bf0dfefe.js","./BoundsStore-a85528e9.js","./projectExtentUtils-a83fe3e6.js","./LayerView3D-ba0927cb.js","./query-af06498b.js","./pbfQueryUtils-8c741d64.js","./pbf-18997bde.js","./queryZScale-2a8227ea.js","./EventedSet-8099b172.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./FeatureEffect-82bb4002.js","./jsonUtils-555359b4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),wms:()=>Oe(()=>import("./WMSLayerView3D-1477be9e.js"),["./WMSLayerView3D-1477be9e.js","./DynamicLayerView3D-e8db3982.js","./LayerView3D-ba0927cb.js","./projectExtentUtils-a83fe3e6.js","./ImageMaterial-b5d1ffc4.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./ExportWMSImageParameters-e746bf7a.js"],import.meta.url),wmts:()=>Oe(()=>import("./WMTSLayerView3D-00e8c5f9.js"),["./WMTSLayerView3D-00e8c5f9.js","./LayerView3D-ba0927cb.js","./TiledLayerView3D-a62304ae.js","./LayerView-dc80e8d1.js","./RefreshableLayerView-5aa0dbef.js"],import.meta.url),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function q4e(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",i=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new ce(`${i}:view-not-supported`,`${e} is not supported in 3D`)}const AJ={hasLayerViewModule:t=>EJ[t.type]!=null,importLayerView:t=>{const e=EJ[t.type];if(e==null)throw q4e(t);return e(t)}},PJ="analyses-owner-handles";var x2,_1;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(x2||(x2={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(_1||(_1={}));let Wv=class extends LP{constructor(e){super(e),this._allAnalysisViews=new Ci,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=OJ(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Qi("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Qi()),this._attachedToViewResolver=OJ()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const i=this._items.get(e);if(i==null||i.state.list===_1.REMOVED)throw new ce("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return i.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),PJ)}_disconnectOwners(){this.handles.remove(PJ),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const i=e.on("after-add",n=>this._addAnalysis(n.item)),r=e.on("after-remove",n=>this._removeAnalysis(n.item));return{remove:()=>{i.remove(),r.remove();for(const n of e)this._removeAnalysis(n)}}}_addAnalysis(e){const i=this._items.get(e);if(i==null){const r={state:{view:x2.PENDING,list:_1.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,r),r.createAnalysisViewTask=_S(n=>this._createAnalysisViewPromise(r,n))}else i.state.list=_1.ADDED}_removeAnalysis(e){const i=this._items.get(e);i!=null?(i.state.list=_1.REMOVED,this._scheduleUpdate()):ye.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=A3(()=>this._update()))}_update(){this._scheduledUpdateHandle=Qr(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===_1.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case x2.PENDING:e.createAnalysisViewTask=wu(e.createAnalysisViewTask);break;case x2.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=Je(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,i){const r=e.analysis,n=r.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(Gs(i))throw this._creatingViewCount-=1,Qi("AnalysisView creation aborted");const o=new s.module.default({analysis:r,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(Gs(i))throw this._creatingViewCount-=1,o.destroy(),Qi("AnalysisView creation aborted");return e.view=o,e.state.view=x2.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return Oe(()=>import("./AreaMeasurementAnalysisView3D-fa153eba.js").then(i=>i.A),["./AreaMeasurementAnalysisView3D-fa153eba.js","./UnitNormalizer-f4e524a5.js","./Segment-af4f81e7.js","./unitFormatUtils-0710b747.js","./LineVisualElement-a36de091.js","./elevationInfoUtils-a7c808f6.js","./geometryEngine-9bdf7794.js","./geometryEngineBase-8afca563.js","./hydrated-4fea88d3.js","./EditGeometryOperations-e94f7516.js"],import.meta.url);case"dimension":return Oe(()=>import("./DimensionAnalysisView3D-027ab1bb.js").then(i=>i.D),["./DimensionAnalysisView3D-027ab1bb.js","./LineVisualElement-a36de091.js","./LengthDimension-86debf18.js","./Segment-af4f81e7.js","./unitFormatUtils-0710b747.js","./elevationInfoUtils-a7c808f6.js","./analysisViewUtils-e4b7dec6.js","./ImageMaterial-b5d1ffc4.js","./Factory-4bdbc3dc.js","./RightAngleQuadVisualElement-db8fb4e5.js","./VisualElementResources-f2bb03cc.js","./PointVisualElement-0e3f767c.js","./EditGeometryOperations-e94f7516.js","./dehydratedFeatureComparison-acae6d2e.js"],import.meta.url);case"direct-line-measurement":return Oe(()=>import("./DirectLineMeasurementAnalysisView3D-ccf1d12c.js").then(i=>i.D),["./DirectLineMeasurementAnalysisView3D-ccf1d12c.js","./UnitNormalizer-f4e524a5.js","./Segment-af4f81e7.js","./unitFormatUtils-0710b747.js","./LineVisualElement-a36de091.js","./elevationInfoUtils-a7c808f6.js","./geometryEngine-9bdf7794.js","./geometryEngineBase-8afca563.js","./hydrated-4fea88d3.js","./RightAngleQuadVisualElement-db8fb4e5.js","./VisualElementResources-f2bb03cc.js"],import.meta.url);case"line-of-sight":return Oe(()=>import("./LineOfSightAnalysisView3D-63d319d1.js"),["./LineOfSightAnalysisView3D-63d319d1.js","./LineVisualElement-a36de091.js","./LineOfSightAnalysisTarget-f203bd64.js","./persistable-6c8e20e5.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-045df4e7.js","./ElevationInfo-f714f054.js","./elevationInfoUtils-a7c808f6.js","./analysisViewUtils-e4b7dec6.js","./ImageMaterial-b5d1ffc4.js","./PointVisualElement-0e3f767c.js","./VisualElementResources-f2bb03cc.js"],import.meta.url);case"slice":return Oe(()=>import("./SliceAnalysisView3D-a1382f33.js").then(i=>i.S),["./SliceAnalysisView3D-a1382f33.js","./LineVisualElement-a36de091.js","./persistable-6c8e20e5.js","./multiOriginJSONSupportUtils-c978f4c3.js","./resourceExtension-045df4e7.js","./BuildingComponentSublayer-109daa01.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./diffUtils-3c37f4e6.js","./colorRamps-54548a9c.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./FeatureLayer-7c5e0432.js","./MultiOriginJSONSupport-d720758b.js","./sql-a39124b8.js","./FeatureLayerBase-43dae5ea.js","./commonProperties-1e64caff.js","./ElevationInfo-f714f054.js","./featureLayerUtils-ce39121a.js","./AttachmentQuery-dd62ce87.js","./Query-cdee9722.js","./RelationshipQuery-ab8c76dd.js","./serviceCapabilitiesUtils-8d66cffa.js","./queryZScale-2a8227ea.js","./FeatureSet-d4d9321c.js","./APIKeyMixin-be880531.js","./ArcGISService-163e63f0.js","./BlendLayer-08a76f1b.js","./jsonUtils-555359b4.js","./CustomParametersMixin-64be6818.js","./FeatureEffectLayer-142ba535.js","./FeatureEffect-82bb4002.js","./FeatureFilter-e71c77dc.js","./FeatureReductionLayer-b84a7e30.js","./LabelClass-3b8bddeb.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./OperationalLayer-5b164959.js","./OrderedLayer-908cb5be.js","./PortalLayer-473e8b12.js","./portalItemUtils-89a0d48a.js","./ScaleRangeLayer-31eefac8.js","./TemporalLayer-5e4b9999.js","./FeatureTemplate-0db006f4.js","./FeatureType-e95921de.js","./fieldProperties-ff8bee5a.js","./labelingInfo-66d1a5d0.js","./versionUtils-9472ade8.js","./styleUtils-5fb07ac6.js","./TopFeaturesQuery-da745a52.js","./popupUtils-8d4c7bed.js","./capabilities-5d185925.js","./I3SIndexInfo-27be0331.js","./I3SLayerDefinitions-3ba92081.js","./I3SUtil-8ed72294.js","./I3SBinaryReader-2204e87b.js","./popupUtils-81d67c22.js","./analysisViewUtils-e4b7dec6.js","./ImageMaterial-b5d1ffc4.js","./Factory-4bdbc3dc.js"],import.meta.url)}}};function OJ(){const t=sa();return t.promise.catch(()=>{}),t}d([m()],Wv.prototype,"updating",null),d([m({constructOnly:!0})],Wv.prototype,"view",void 0),d([m()],Wv.prototype,"_allAnalysisViews",void 0),d([m()],Wv.prototype,"_creatingViewCount",void 0),Wv=d([J("esri.views.3d.analysis.AnalysisViewManager3D")],Wv);const Z4e=Wv;let Hm=class extends ke{constructor(e){super(e),this.collision=new UE,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===Ke.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==Ke.Local?this._set("altitude",e):ye.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?$e(e,this.altitude.min,this.altitude.max):e}clampTilt(e,i){if(!this.tilt)return i;const r=this.tilt(e);return $e(i,r.min,r.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===Ke.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(i,r=w6)=>(r.min=qo.min,r.max=e,r)}_createDefaultTiltLocal(){const e=this.collision.enabled?wI([[4e3,qo.max],[1e4,Qt(88)],[6e6,Qt(88)]]):()=>qo.max;return(i,r=w6)=>(r.min=qo.min,r.max=e(i),r)}_createDefaultTiltGlobal(){const e=this.collision.enabled?wI([[4e3,qo.max],[5e4,Qt(88)],[6e6,Qt(88)],[2e7,qo.min]]):wI([[3e5,qo.max],[3e6,Qt(88)],[6e6,Qt(88)],[2e7,qo.min]]);return(i,r=w6)=>(r.min=qo.min,r.max=e(i),r)}};function X4e(t){return{min:-2e5,max:4*t.radius}}d([m()],Hm.prototype,"altitude",null),d([m({readOnly:!0})],Hm.prototype,"collision",void 0),d([m()],Hm.prototype,"distance",void 0),d([m({readOnly:!0})],Hm.prototype,"minimumPoiDistance",void 0),d([m()],Hm.prototype,"tilt",void 0),d([m({constructOnly:!0})],Hm.prototype,"mode",void 0),Hm=d([J("esri.views.3d.state.Constraints")],Hm);const RJ=X4e(vi),qo={min:Qt(.5),max:Qt(179.5)},w6={min:0,max:0};let UE=class extends ke{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([m({type:Boolean})],UE.prototype,"enabled",void 0),d([m({type:Number})],UE.prototype,"elevationMargin",void 0),UE=d([J("esri.views.3d.state.Constraints.CollisionConstraint")],UE);let T2=class extends ke{constructor(){super(...arguments),this.min=RJ.min,this.max=RJ.max}};d([m({type:Number})],T2.prototype,"min",void 0),d([m({type:Number})],T2.prototype,"max",void 0),T2=d([J("esri.views.3d.constraints.AltitudeConstraint")],T2);let eg=class extends ke{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,i){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==i&&this._set("far",i))}};d([m({type:Number,value:1e-8})],eg.prototype,"near",null),d([Sn("near")],eg.prototype,"castNear",null),d([m({type:Number,value:1e-8})],eg.prototype,"far",null),d([Sn("far")],eg.prototype,"castFar",null),d([m({type:["auto","manual"]})],eg.prototype,"mode",void 0),eg=d([J("esri.views.3d.constraints.ClipDistanceConstraint")],eg);const Yz={min:nl(qo.min),max:nl(qo.max)};let y1=class extends ke{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return $e(e,Yz.min,Yz.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([m({type:["auto","manual"]})],y1.prototype,"mode",void 0),d([m({type:Number,value:Yz.max})],y1.prototype,"max",null),d([Sn("max")],y1.prototype,"castMax",null),y1=d([J("esri.views.3d.constraints.TiltConstraint")],y1);let v1=class extends ke{constructor(){super(...arguments),this.tilt=new y1,this.altitude=new T2,this.clipDistance=new eg}};d([m({type:y1})],v1.prototype,"tilt",void 0),d([m({type:T2})],v1.prototype,"altitude",void 0),d([m({type:eg})],v1.prototype,"clipDistance",void 0),v1=d([J("esri.views.3d.constraints.Constraints")],v1);var Jz;let nh=Jz=class extends Nt{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,i){e[i]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,i){t&&(e[i]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new Jz(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};d([m({readOnly:!0,type:["sun"],json:{write:!0}})],nh.prototype,"type",void 0),d([m({type:Date,json:{type:Number,write:{target:"datetime"}}})],nh.prototype,"date",void 0),d([yr("date",["datetime"])],nh.prototype,"readDate",null),d([Pr("date")],nh.prototype,"writeDate",null),d([m({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],nh.prototype,"directShadowsEnabled",void 0),d([yr("directShadowsEnabled",["directShadows"])],nh.prototype,"readDirectShadowsEnabled",null),d([Pr("directShadowsEnabled")],nh.prototype,"writedirectShadowsEnabled",null),d([m({type:Number,json:{write:!0}})],nh.prototype,"displayUTCOffset",void 0),d([Pr("displayUTCOffset")],nh.prototype,"writeDisplayUTCOffset",null),nh=Jz=d([J("esri.webscene.SunLighting")],nh);const VP=nh;var Hx;const Sfe="esri.views.3d.environment.SunLighting",LR=ye.getLogger(Sfe);let of=Hx=class extends os.EventedMixin(VP){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),i=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get ambientOcclusionEnabled(){return G_(LR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){G_(LR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return G_(LR,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){G_(LR,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new Hx(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const i=Hx.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let r=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(r=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(r=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=Hx.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==n&&(DR.target=this,DR.timezoneOffset=n,this.emit("timezone-will-change",DR),DR.target=null),t!=null)return isNaN(t.getTime())||r!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new Hx({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],of.prototype,"cameraTrackingEnabled",void 0),d([m({type:Boolean})],of.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],of.prototype,"waterReflectionEnabled",null),d([m({type:Date})],of.prototype,"defaultDate",null),d([m({type:Date})],of.prototype,"date",null),of=Hx=d([J(Sfe)],of),function(t){function e({hours:i,minutes:r,seconds:n}){return Math.round(i+r/60+n/3600)}t.calculateTimezoneOffset=e}(of||(of={}));const DR={target:null,timezoneOffset:0},a_=of;var Kz;let zE=Kz=class extends Nt{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Kz(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([m({readOnly:!0,type:["virtual"],json:{write:!0}})],zE.prototype,"type",void 0),d([m({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],zE.prototype,"directShadowsEnabled",void 0),zE=Kz=d([J("esri.webscene.VirtualLighting")],zE);const K5=zE;var PI;const Cfe="esri.views.3d.environment.VirtualLighting",NR=ye.getLogger(Cfe);let Wx=PI=class extends os.EventedMixin(K5){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return G_(NR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){G_(NR,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return G_(NR,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){G_(NR,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new PI({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new PI(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([m({type:Boolean})],Wx.prototype,"ambientOcclusionEnabled",null),d([m({type:Boolean})],Wx.prototype,"waterReflectionEnabled",null),d([m({type:Boolean})],Wx.prototype,"cameraTrackingEnabled",void 0),Wx=PI=d([J(Cfe)],Wx);const BE=Wx,Y4e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:a_,virtual:BE}};var Qz;let zA=Qz=class extends ke{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new Qz({quality:this.quality})}};d([m({type:["low","high"],value:"low"})],zA.prototype,"quality",null),zA=Qz=d([J("esri.views.3d.environment.SceneViewAtmosphere")],zA);var eB;let VE=eB=class extends Nt{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new eB({cloudCover:this.cloudCover})}};d([Si({sunny:"sunny"})],VE.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],VE.prototype,"cloudCover",void 0),VE=eB=d([J("esri.views.3d.environment.SunnyWeather")],VE);const tB=VE;var iB;let GE=iB=class extends Nt{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new iB({cloudCover:this.cloudCover})}};d([Si({cloudy:"cloudy"})],GE.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],GE.prototype,"cloudCover",void 0),GE=iB=d([J("esri.views.3d.environment.CloudyWeather")],GE);const J4e=GE;var rB;let jE=rB=class extends Nt{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new rB({fogStrength:this.fogStrength})}};d([Si({foggy:"foggy"})],jE.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],jE.prototype,"fogStrength",void 0),jE=rB=d([J("esri.views.3d.environment.FoggyWeather")],jE);const K4e=jE;var nB;let qx=nB=class extends Nt{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new nB({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Si({rainy:"rainy"})],qx.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qx.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qx.prototype,"precipitation",void 0),qx=nB=d([J("esri.views.3d.environment.RainyWeather")],qx);const Q4e=qx;var sB;let qv=sB=class extends Nt{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new sB({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Si({snowy:"snowy"})],qv.prototype,"type",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qv.prototype,"cloudCover",void 0),d([m({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qv.prototype,"precipitation",void 0),d([m({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],qv.prototype,"snowCover",void 0),qv=sB=d([J("esri.views.3d.environment.SnowyWeather")],qv);const eFe=qv,Efe={key:"type",base:tB,typeMap:{sunny:tB,cloudy:J4e,rainy:Q4e,snowy:eFe,foggy:K4e}},tFe=Object.keys(Efe.typeMap);function iFe(t,e){return!!tFe.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const yf=1e4,rFe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:VP,virtual:K5}};let OI=class extends Nt{constructor(e){super(e)}clone(){}};d([m({readOnly:!0,json:{read:!1}})],OI.prototype,"type",void 0),OI=d([J("esri.webscene.background.Background")],OI);const Afe=OI;var oB;const nFe={...Bg,nonNullable:!0};let HE=oB=class extends Afe{constructor(t){super(t),this.type="color",this.color=new Lt([0,0,0,1])}clone(){return new oB(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([Si({color:"color"},{readOnly:!0})],HE.prototype,"type",void 0),d([m(nFe)],HE.prototype,"color",void 0),HE=oB=d([J("esri.webscene.background.ColorBackground")],HE);const Pfe=HE,MJ={base:Afe,key:"type",typeMap:{color:Pfe}};function sFe(t){return(e,i,r)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,r),s}}}const oFe={types:MJ,json:{read:sFe(MJ),write:{overridePolicy:(t,e,i)=>({enabled:!i||!i.isPresentation})}}};var aB;const Ofe="esri.webscene.Environment",aFe=ye.getLogger(Ofe),$J=(t,e,i)=>({enabled:!i||!i.isPresentation});let l_=aB=class extends Nt{constructor(t){super(t),this.lighting=new VP,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){iFe(t==null?void 0:t.type,aFe)&&this._set("weather",t)}clone(){return new aB(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?K5.prototype.clone.call(this.lighting):VP.prototype.clone.call(this.lighting),background:Le(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([m({types:rFe,nonNullable:!0,json:{write:!0}})],l_.prototype,"lighting",void 0),d([m(oFe)],l_.prototype,"background",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:$J}}})],l_.prototype,"atmosphereEnabled",void 0),d([m({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:$J}}})],l_.prototype,"starsEnabled",void 0),d([m({types:Efe,nonNullable:!0,json:{write:!0},value:new tB})],l_.prototype,"weather",null),l_=aB=d([J(Ofe)],l_);const Rfe=l_;var WE;let Zx=WE=class extends Rfe{constructor(t){super(t),this.atmosphere=new zA,this.lighting=new a_,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new WE({...e,lighting:e.lighting?e.lighting.type==="virtual"?BE.fromWebsceneLighting(e.lighting):a_.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,i;return t?t instanceof a_||t instanceof BE?t:t instanceof VP?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new a_({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof K5?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new BE({...t.cloneConstructProperties(),...(i=this.lighting)==null?void 0:i.cloneNonPersistentConstructProperties()}):ry(Y4e,t):new a_}clone(){return new WE({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Le(this.background)})}cloneWithWebsceneEnvironment(t){return new WE({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:Le(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):a_.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):BE.fromWebsceneLighting(t.lighting);default:return t.lighting,a_.fromWebsceneLighting(t.lighting)}}};d([m({type:zA,json:{read:!1},nonNullable:!0})],Zx.prototype,"atmosphere",void 0),d([m({nonNullable:!0})],Zx.prototype,"lighting",void 0),d([Sn("lighting")],Zx.prototype,"castLighting",null),Zx=WE=d([J("esri.views.3d.environment.SceneViewEnvironment")],Zx);const Xx=Zx;var fa;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(fa||(fa={}));function Is(t,e){return t[0]=e[0],t[1]=e[1],t}function bi(t,e,i){return t[0]=e,t[1]=i,t}function Ud(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function Tf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function yH(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function Mfe(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function lFe(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function cFe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function uFe(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t}function hFe(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t}function dFe(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function gc(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function pFe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t}function vb(t,e){const i=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(i*i+r*r)}function yD(t,e){const i=e[0]-t[0],r=e[1]-t[1];return i*i+r*r}function vH(t){const e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}function $fe(t){const e=t[0],i=t[1];return e*e+i*i}function bH(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Ife(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function GP(t,e){const i=e[0],r=e[1];let n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function ws(t,e){return t[0]*e[0]+t[1]*e[1]}function fFe(t,e,i){const r=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=r,t}function _h(t,e,i,r){const n=e[0],s=e[1];return t[0]=n+r*(i[0]-n),t[1]=s+r*(i[1]-s),t}function mFe(t,e){e=e||1;const i=2*P3()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t}function Lfe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n,t[1]=i[1]*r+i[3]*n,t}function Zv(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[2]*n+i[4],t[1]=i[1]*r+i[3]*n+i[5],t}function gFe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[3]*n+i[6],t[1]=i[1]*r+i[4]*n+i[7],t}function _Fe(t,e,i){const r=e[0],n=e[1];return t[0]=i[0]*r+i[4]*n+i[12],t[1]=i[1]*r+i[5]*n+i[13],t}function yFe(t,e,i,r){const n=e[0]-i[0],s=e[1]-i[1],o=Math.sin(r),a=Math.cos(r);return t[0]=n*a-s*o+i[0],t[1]=n*o+s*a+i[1],t}function vFe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(i*n+r*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function bFe(t){return"vec2("+t[0]+", "+t[1]+")"}function Dfe(t,e){return t[0]===e[0]&&t[1]===e[1]}function Nfe(t,e){const i=t[0],r=t[1],n=e[0],s=e[1],o=ol();return Math.abs(i-n)<=o*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))}function wFe(t,e,i,r,n){let s=e[0]-i[0],o=e[1]-i[1];const a=(r[0]*s+r[1]*o)*(n-1);return s=r[0]*a,o=r[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const xFe=vH,Ffe=Tf,TFe=yH,SFe=Mfe,kfe=vb,CFe=yD,EFe=$fe;Object.freeze(Object.defineProperty({__proto__:null,add:Ud,angle:vFe,ceil:lFe,copy:Is,cross:fFe,dist:kfe,distance:vb,div:SFe,divide:Mfe,dot:ws,equals:Nfe,exactEquals:Dfe,floor:cFe,inverse:Ife,len:xFe,length:vH,lerp:_h,max:hFe,min:uFe,mul:TFe,multiply:yH,negate:bH,normalize:GP,projectAndScale:wFe,random:mFe,rotate:yFe,round:dFe,scale:gc,scaleAndAdd:pFe,set:bi,sqrDist:CFe,sqrLen:EFe,squaredDistance:yD,squaredLength:$fe,str:bFe,sub:Ffe,subtract:Tf,transformMat2:Lfe,transformMat2d:Zv,transformMat3:gFe,transformMat4:_Fe},Symbol.toStringTag,{value:"Module"}));function wH(t){return $e((t-1e5)/(1e6-1e5),0,1)}const lB=1e4,AFe=.085,__=1e5;let PFe=class{};const wr=PFe;function T(t,...e){let i="";for(let r=0;r<e.length;r++)i+=t[r]+e[r];return i+=t[t.length-1],i}(function(t){function e(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}t.int=e,t.float=i})(T||(T={}));var M;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(M||(M={}));var Yn;function Ff(t,e){switch(e.textureCoordinateType){case Yn.Default:return t.attributes.add(M.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Yn.Compressed:return t.attributes.add(M.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case Yn.Atlas:return t.attributes.add(M.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(M.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case Yn.None:return void t.vertex.code.add(T`void forwardTextureCoordinates() {}`);case Yn.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(Yn||(Yn={}));function Ac(t){t.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Eu(t){t.include(Ac),t.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function Q5(t){t.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var vr;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(vr||(vr={}));let On=class{constructor(e,i,r,n,s=null){this.name=e,this.type=i,this.arraySize=s,this.bind={[vr.Pass]:null,[vr.Draw]:null},r!=null&&n!=null&&(this.bind[r]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},ei=class extends On{constructor(e,i){super(e,"vec3",vr.Pass,(r,n,s)=>r.setUniform3fv(e,i(n,s)))}};function jg(t){t.uniforms.add(new ei("mainLightDirection",(e,i)=>i.lighting.mainLight.direction))}function om(t){t.uniforms.add(new ei("mainLightIntensity",(e,i)=>i.lighting.mainLight.intensity))}function vD(t){jg(t.fragment),om(t.fragment),t.fragment.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Bi=class extends On{constructor(e,i){super(e,"vec2",vr.Pass,(r,n,s)=>r.setUniform2fv(e,i(n,s)))}},yi=class extends On{constructor(e,i){super(e,"vec4",vr.Pass,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}},je=class extends On{constructor(e,i){super(e,"float",vr.Pass,(r,n,s)=>r.setUniform1f(e,i(n,s)))}},en=class extends On{constructor(e,i){super(e,"mat4",vr.Pass,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};const Ia=gi();let OFe=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function xt(t,e){if(!t){e=e||"Assertion";const i=new Error(e).stack;throw new OFe(`${e} at ${i}`)}}function Ow(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function IJ(t,e,i,r){let n,s=(i[0]-t[0])/e[0],o=(r[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(i[1]-t[1])/e[1],l=(r[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(i[2]-t[2])/e[2],u=(r[2]-t[2])/e[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function FR(t,e,i,r,n,s=it()){const o=(r[n]-i[n])*(e[0]-t[0])-(r[0]-i[0])*(e[n]-t[n]),a=(r[0]-i[0])*(t[n]-i[n])-(r[n]-i[n])*(t[0]-i[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function LJ(t,e,i,r,n){Ia[0]=t[0],Ia[1]=t[1],Ia[2]=t[2],Ia[3]=1,hu(Ia,Ia,e),n.length>2&&(n[2]=-Ia[2]),hu(Ia,Ia,i),xt(Ia[3]!==0),n[0]=Ia[0]/Ia[3],n[1]=Ia[1]/Ia[3],n[2]=Ia[2]/Ia[3],n[0]=(.5*n[0]+.5)*r[2]+r[0],n[1]=(.5*n[1]+.5)*r[3]+r[1]}function RFe(t,e){return Math.log(t)/Math.log(e)}function MFe(t,e,i,r){t[12]=e,t[13]=i,t[14]=r}function Ufe(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const zfe=ye.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let Bfe=class{constructor(){this._includedModules=new Map}include(e,i){if(this._includedModules.has(e)){const r=this._includedModules.get(e);if(r!==i){zfe.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(r))r[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))r[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${r[s]} new ${e[s]}`))}}else this._includedModules.set(e,i),e(this.builder,i)}},Fi=class extends Bfe{constructor(){super(...arguments),this.vertex=new DJ,this.fragment=new DJ,this.attributes=new LFe,this.varyings=new DFe,this.extensions=new cB,this.constants=new Vfe}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?FFe:NFe,c=this.constants.generateSource().concat(s.constants.generateSource());return`#version 300 es
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${n.join(`
`)}

${a.join(`
`)}`}generateBind(e,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&r.set(o.name,a)});const n=Array.from(r.values()),s=n.length;return(o,a,l)=>{for(let c=0;c<s;++c)n[c](i,o,a,l)}}},$Fe=class{constructor(){this._entries=new Map}add(...e){for(const i of e)this._add(i)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new ce(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else zfe.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},IFe=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},DJ=class extends Bfe{constructor(){super(...arguments),this.uniforms=new $Fe,this.code=new IFe,this.constants=new Vfe}get builder(){return this}},LFe=class{constructor(){this._entries=new Array}add(e,i){this._entries.push([e,i])}generateSource(e){return e==="fragment"?[]:this._entries.map(i=>`in ${i[1]} ${i[0]};`)}},DFe=class{constructor(){this._entries=new Map}add(e,i){this._entries.has(e)&&xt(this._entries.get(e)===i),this._entries.set(e,i)}generateSource(e){const i=new Array;return this._entries.forEach((r,n)=>i.push(e==="vertex"?`out ${r} ${n};`:`in ${r} ${n};`)),i}},cB=class uB{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const i=e==="vertex"?uB.ALLOWLIST_VERTEX:uB.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}};cB.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],cB.ALLOWLIST_VERTEX=[];let Vfe=class vs{constructor(){this._entries=new Set}add(e,i,r){let n="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":n=vs._numberToFloatStr(r);break;case"int":n=vs._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${vs._numberToFloatStr(r[0])},                            ${vs._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${vs._numberToFloatStr(r[0])},                            ${vs._numberToFloatStr(r[1])},                            ${vs._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${vs._numberToFloatStr(r[0])},                            ${vs._numberToFloatStr(r[1])},                            ${vs._numberToFloatStr(r[2])},                            ${vs._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${vs._numberToIntStr(r[0])},                             ${vs._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${vs._numberToIntStr(r[0])},                             ${vs._numberToIntStr(r[1])},                             ${vs._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${vs._numberToIntStr(r[0])},                             ${vs._numberToIntStr(r[1])},                             ${vs._numberToIntStr(r[2])},                             ${vs._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${i}(${Array.prototype.map.call(r,s=>vs._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${i} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const NFe=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,FFe=`precision highp float;
precision highp sampler2D;`;let vt=class extends On{constructor(e,i){super(e,"sampler2D",vr.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};const BA=Ge(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),x6=3,T6=Ge(x6*parseFloat(65e-8.toFixed(6)),x6*parseFloat(1881e-9.toFixed(6)),x6*parseFloat(85e-9.toFixed(6))),kFe=3996e-9,UFe=Ge(parseFloat(Number(BA[0]+T6[0]).toFixed(6)),parseFloat(Number(BA[1]+T6[1]).toFixed(6)),parseFloat(Number(BA[2]+T6[2]).toFixed(6)));function zFe(t){const e=new Fi;e.attributes.add(M.POSITION,"vec2"),e.include(Ff,{textureCoordinateType:Yn.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=e;return i.uniforms.add(new en("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new en("inverseViewMatrix",(n,s)=>dS(BFe,s.camera.viewMatrix))),i.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new ei("backgroundColor",n=>n.backgroundColor),new Bi("radii",n=>n.radii),new ei("cameraPosition",(n,s)=>s.camera.eye),new yi("heightParameters",n=>n.heightParameters),new je("innerFadeDistance",n=>n.innerFadeDistance),new je("altitudeFade",n=>n.altitudeFade),new vt("depthTexture",n=>n.depthTexture),new je("hazeStrength",n=>n.hazeStrength)),r.constants.add("betaRayleigh","vec3",BA),r.constants.add("betaCombined","vec3",UFe),r.constants.add("betaMie","float",kFe),r.constants.add("scaleHeight","float",AFe*__),jg(r),e.include(Q5),t.haze&&(r.include(Eu),r.uniforms.add(new Bi("nearFar",(n,s)=>s.camera.nearFar))),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(T`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":T`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":T`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?T`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?T`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?T`cameraSpaceRay *= -textureBilinear(vuv0);`:T`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:T`${t.reduced?"":T`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:T`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":T`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const BFe=Ne(),VFe=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:BA,build:zFe},Symbol.toStringTag,{value:"Module"}));let Vi=class{constructor(e,i){this._module=e,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Vr,Ht,De,Zf,zt,Jd,MT,bt,br,Fn,qt,Jt,Cn,Gt,mt,ss,hs,zi,ou,Oo;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Vr||(Vr={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Ht||(Ht={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(De||(De={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Zf||(Zf={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(zt||(zt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Jd||(Jd={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(MT||(MT={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(bt||(bt={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(br||(br={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(Fn||(Fn={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(qt||(qt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Jt||(Jt={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Cn||(Cn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Gt||(Gt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(mt||(mt={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(ss||(ss={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(hs||(hs={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(zi||(zi={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(ou||(ou={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Oo||(Oo={}));const S6=33984;var Hs,Qc;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(Hs||(Hs={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Qc||(Qc={}));const NJ=33306;var In,FJ,kJ,UJ,bD,hB,zJ;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(In||(In={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(FJ||(FJ={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(kJ||(kJ={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(UJ||(UJ={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(bD||(bD={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(hB||(hB={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(zJ||(zJ={}));let qi=class{constructor(e,i,r){this.release=r,this.initializeConfiguration(e,i),this._configuration=i.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=et(this._program),this._pipeline=this._configuration=null}reload(e){et(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,i=null,r){e.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Ht.TRIANGLES}getPipelineState(e,i){return this._pipeline}initializeConfiguration(e,i){}};const Ni=new Map([[M.POSITION,0],[M.NORMAL,1],[M.NORMALCOMPRESSED,1],[M.UV0,2],[M.COLOR,3],[M.COLORFEATUREATTRIBUTE,3],[M.SIZE,4],[M.TANGENT,4],[M.AUXPOS1,5],[M.SYMBOLCOLOR,5],[M.AUXPOS2,6],[M.FEATUREATTRIBUTE,6],[M.INSTANCEFEATUREATTRIBUTE,6],[M.INSTANCECOLOR,7],[M.OBJECTANDLAYERIDCOLOR,7],[M.INSTANCEOBJECTANDLAYERIDCOLOR,7],[M.MODEL,8],[M.MODELNORMAL,12],[M.MODELORIGINHI,11],[M.MODELORIGINLO,15]]),GFe=ye.getLogger("esri.views.webgl.checkWebGLError");function jFe(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const Gfe=!!ge("enable-feature:webgl-debug");function hh(){return Gfe}function dB(){return Gfe}function S_(t){if(hh()){const e=t.getError();if(e){const i=jFe(t,e),r=new Error().stack;GFe.error(new ce("webgl-error","WebGL error occured",{message:i,stack:r}))}}}let Gi=class{constructor(e,i,r){this._context=e,this._locations=r,this._textures=new Map,this._freeTextureUnits=new ri({deallocator:null}),this._glProgram=e.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(vr.Pass,this),this.bindDraw=i.generateBind(vr.Draw,this),this._fragmentUniforms=hh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,i){this._glProgram.setUniform1i(e,i?1:0)}setUniform1i(e,i){this._glProgram.setUniform1i(e,i)}setUniform1f(e,i){this._glProgram.setUniform1f(e,i)}setUniform2fv(e,i){this._glProgram.setUniform2fv(e,i)}setUniform3fv(e,i){this._glProgram.setUniform3fv(e,i)}setUniform4fv(e,i){this._glProgram.setUniform4fv(e,i)}setUniformMatrix3fv(e,i){this._glProgram.setUniformMatrix3fv(e,i)}setUniformMatrix4fv(e,i){this._glProgram.setUniformMatrix4fv(e,i)}setUniform1fv(e,i){this._glProgram.setUniform1fv(e,i)}setUniform1iv(e,i){this._glProgram.setUniform1iv(e,i)}setUniform2iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform3iv(e,i){this._glProgram.setUniform3iv(e,i)}setUniform4iv(e,i){this._glProgram.setUniform4iv(e,i)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,i){if(i==null||i.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let r=this._textures.get(e);return r==null?(r=this._allocTextureUnit(i),this._textures.set(e,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(e,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,i)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(i,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Fr,bb,Dn,_g,Il,Ng,$T,_r,wb,yg;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Fr||(Fr={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(bb||(bb={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(Dn||(Dn={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(_g||(_g={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Il||(Il={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(Ng||(Ng={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}($T||($T={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(_r||(_r={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(wb||(wb={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(yg||(yg={}));function Ec(t,e,i=Zf.ADD,r=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Fo(t,e,i,r,n=Zf.ADD,s=Zf.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const xH={face:Jd.BACK,mode:MT.CCW},jfe={face:Jd.FRONT,mode:MT.CCW},e4=t=>t===Fr.Back?xH:t===Fr.Front?jfe:null,Nl={zNear:0,zFar:1},ni={r:!0,g:!0,b:!0,a:!0};function HFe(t){return QFe.intern(t)}function WFe(t){return e6e.intern(t)}function qFe(t){return t6e.intern(t)}function ZFe(t){return i6e.intern(t)}function XFe(t){return r6e.intern(t)}function YFe(t){return n6e.intern(t)}function JFe(t){return s6e.intern(t)}function KFe(t){return o6e.intern(t)}function Zt(t){return a6e.intern(t)}let Hg=class{constructor(e,i){this._makeKey=e,this._makeRef=i,this._interns=new Map}intern(e){if(!e)return null;const i=this._makeKey(e),r=this._interns;return r.has(i)||r.set(i,this._makeRef(e)),r.get(i)??null}};function Wg(t){return"["+t.join(",")+"]"}const QFe=new Hg(Hfe,t=>({__tag:"Blending",...t}));function Hfe(t){return t?Wg([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const e6e=new Hg(Wfe,t=>({__tag:"Culling",...t}));function Wfe(t){return t?Wg([t.face,t.mode]):null}const t6e=new Hg(qfe,t=>({__tag:"PolygonOffset",...t}));function qfe(t){return t?Wg([t.factor,t.units]):null}const i6e=new Hg(Zfe,t=>({__tag:"DepthTest",...t}));function Zfe(t){return t?Wg([t.func]):null}const r6e=new Hg(Xfe,t=>({__tag:"StencilTest",...t}));function Xfe(t){return t?Wg([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const n6e=new Hg(Yfe,t=>({__tag:"DepthWrite",...t}));function Yfe(t){return t?Wg([t.zNear,t.zFar]):null}const s6e=new Hg(Jfe,t=>({__tag:"ColorWrite",...t}));function Jfe(t){return t?Wg([t.r,t.g,t.b,t.a]):null}const o6e=new Hg(Kfe,t=>({__tag:"StencilWrite",...t}));function Kfe(t){return t?Wg([t.mask]):null}const a6e=new Hg(l6e,t=>({blending:HFe(t.blending),culling:WFe(t.culling),polygonOffset:qFe(t.polygonOffset),depthTest:ZFe(t.depthTest),stencilTest:XFe(t.stencilTest),depthWrite:YFe(t.depthWrite),colorWrite:JFe(t.colorWrite),stencilWrite:KFe(t.stencilWrite)}));function l6e(t){return t?Wg([Hfe(t.blending),Wfe(t.culling),qfe(t.polygonOffset),Zfe(t.depthTest),Xfe(t.stencilTest),Yfe(t.depthWrite),Jfe(t.colorWrite),Kfe(t.stencilWrite)]):null}let c6e=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,i,r,n){return(r||e!==i)&&(n(e),this._pipelineInvalid=!0),e}},u6e=class extends wr{constructor(){super(...arguments),this.heightParameters=gi(),this.radii=it(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=it(),this.backgroundColor=I()}},qE=class Qfe extends qi{initializeProgram(e){return new Gi(e.rctx,Qfe.shader.get().build(this.configuration),Ni)}initializePipeline(){return this.configuration.reduced?Zt({blending:Ec(De.ONE,De.ZERO),depthTest:{func:br.ALWAYS},colorWrite:ni}):this.configuration.haze?Zt({blending:Fo(De.ONE,De.ZERO,De.ONE_MINUS_SRC_COLOR,De.ONE),colorWrite:ni}):Zt({blending:Ec(De.SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ni})}};qE.shader=new Vi(VFe,()=>Oe(()=>import("./ChapmanAtmosphere.glsl-eac34711.js"),[],import.meta.url));let Oa=class extends wr{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,i={key:this.key};for(const r of e)i[r]=this[r];return i}};function q(t={}){return(e,i)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(i),t.constValue!=null)Object.defineProperty(e,i,{get:()=>t.constValue});else{const r=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,i,{get(){return this[r]},set(u){if(this[r]!==u&&(this[r]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+i+" must be boolean or number, got "+typeof u)}})}}}let wD=class extends Oa{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};d([q()],wD.prototype,"haze",void 0),d([q()],wD.prototype,"reduced",void 0);let Lo=class{constructor(e,i,r,n,s,o=!1,a=0){this.name=e,this.count=i,this.type=r,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new Lo(M.POSITION,3,bt.FLOAT,0,12);new Lo(M.POSITION,3,bt.FLOAT,0,20),new Lo(M.UV0,2,bt.FLOAT,12,20);new Lo(M.POSITION,3,bt.FLOAT,0,32),new Lo(M.NORMAL,3,bt.FLOAT,12,32),new Lo(M.UV0,2,bt.FLOAT,24,32);new Lo(M.POSITION,3,bt.FLOAT,0,16),new Lo(M.COLOR,4,bt.UNSIGNED_BYTE,12,16);const TH=[new Lo(M.POSITION,2,bt.FLOAT,0,8)],H3=[new Lo(M.POSITION,2,bt.FLOAT,0,16),new Lo(M.UV0,2,bt.FLOAT,8,16)];function BJ(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function Jo(t,e){return t.vertexBuffers[e].byteLength/h6e(t.layout[e])}function h6e(t){return t[0].stride}function SH(t,e,i,r,n=0){const s=t.gl,o=t.capabilities.instancing;t.bindBuffer(i);for(const a of r){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)s.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)s.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function CH(t,e,i,r){const n=t.gl,s=t.capabilities.instancing;t.bindBuffer(i);for(const o of r){const a=e.get(o.name);if(o.count<=4)n.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(zt.ARRAY_BUFFER)}function EH(t){switch(t){case Gt.ALPHA:case Gt.LUMINANCE:case Gt.RED:case Gt.RED_INTEGER:case mt.R8:case mt.R8I:case mt.R8UI:case mt.R8_SNORM:case hs.STENCIL_INDEX8:return 1;case Gt.LUMINANCE_ALPHA:case Gt.RG:case Gt.RG_INTEGER:case mt.RGBA4:case mt.R16F:case mt.R16I:case mt.R16UI:case mt.RG8:case mt.RG8I:case mt.RG8UI:case mt.RG8_SNORM:case mt.RGB565:case mt.RGB5_A1:case hs.DEPTH_COMPONENT16:return 2;case Gt.DEPTH_COMPONENT:case Gt.RGB:case Gt.RGB_INTEGER:case mt.RGB8:case mt.RGB8I:case mt.RGB8UI:case mt.RGB8_SNORM:case mt.SRGB8:case hs.DEPTH_COMPONENT24:return 3;case Gt.DEPTH_STENCIL:case Gt.DEPTH24_STENCIL8:case Gt.RGBA:case Gt.RGBA_INTEGER:case mt.RGBA8:case mt.R32F:case mt.R11F_G11F_B10F:case mt.RG16F:case mt.R32I:case mt.R32UI:case mt.RG16I:case mt.RG16UI:case mt.RGBA8I:case mt.RGBA8UI:case mt.RGBA8_SNORM:case mt.SRGB8_ALPHA8:case mt.RGB9_E5:case mt.RGB10_A2UI:case mt.RGB10_A2:case hs.DEPTH_STENCIL:case hs.DEPTH_COMPONENT32F:case hs.DEPTH24_STENCIL8:return 4;case hs.DEPTH32F_STENCIL8:return 5;case mt.RGB16F:case mt.RGB16I:case mt.RGB16UI:return 6;case mt.RG32F:case mt.RG32I:case mt.RG32UI:case mt.RGBA16F:case mt.RGBA16I:case mt.RGBA16UI:return 8;case mt.RGB32F:case mt.RGB32I:case mt.RGB32UI:return 12;case mt.RGBA32F:case mt.RGBA32I:case mt.RGBA32UI:return 16;case In.COMPRESSED_RGB_S3TC_DXT1_EXT:case In.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case In.COMPRESSED_RGBA_S3TC_DXT3_EXT:case In.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case In.COMPRESSED_R11_EAC:case In.COMPRESSED_SIGNED_R11_EAC:case In.COMPRESSED_RGB8_ETC2:case In.COMPRESSED_SRGB8_ETC2:case In.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case In.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case In.COMPRESSED_RG11_EAC:case In.COMPRESSED_SIGNED_RG11_EAC:case In.COMPRESSED_RGBA8_ETC2_EAC:case In.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const Rw=ye.getLogger("esri.views.webgl.VertexArrayObject");let Gh=class{constructor(e,i,r,n,s=null){this._context=e,this._locations=i,this._layout=r,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(Hs.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,i)=>e+this._buffers[i].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*Zoe}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const i in this._buffers)(e=this._buffers[i])==null||e.dispose(),delete this._buffers[i];this._indexBuffer=et(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&Rw.warn("Leaked WebGL VAO")}disposeVAOOnly(){var e,i;this._glName&&(((i=(e=this._context)==null?void 0:e.capabilities)==null?void 0:i.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(Hs.VertexArrayObject,this),this._context=eS(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const i=e.createVertexArray();e.bindVertexArray(i),this._bindLayout(),e.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:i,_indexBuffer:r}=this;e||Rw.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||Rw.error("Vertex buffer is uninitialized!");const a=i[s];a||Rw.error("Vertex element descriptor is empty!"),SH(this._context,this._locations,o,a)}r!=null&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:i}=this;e||Rw.error("Vertex buffer dictionary is empty!");for(const r in e){const n=e[r];n||Rw.error("Vertex buffer is uninitialized!");const s=i[r];CH(this._context,this._locations,n,s)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},vp=class extends Gh{};var xi;function pB(t,e,i={}){const r=e===xi.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const n of r){const s=t.getContext(n,i);if(s)return s}return null}function d6e(t,e,i={}){const r=eme(t);for(const n of r){const s=pB(e,n,i);if(s)return s}return null}function eme(t){if(t==="3d")return[xi.WEBGL2];const e=ge("esri-force-webgl");return e===xi.WEBGL1||e===xi.WEBGL2?[e]:ge("mac")&&ge("chrome")?[xi.WEBGL1,xi.WEBGL2]:[xi.WEBGL2,xi.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(xi||(xi={}));const Mp=ye.getLogger("esri.views.webgl.BufferObject");let Ki=class Yx{static createIndex(e,i,r){return new Yx(e,zt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(e,i,r){return new Yx(e,zt.ARRAY_BUFFER,i,r)}static createUniform(e,i,r){if(e.type!==xi.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Yx(e,zt.UNIFORM_BUFFER,i,r)}static createPixelPack(e,i=zi.STREAM_READ,r){if(e.type!==xi.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new Yx(e,zt.PIXEL_PACK_BUFFER,i);return r&&n.setSize(r),n}static createPixelUnpack(e,i=zi.STREAM_DRAW,r){if(e.type!==xi.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Yx(e,zt.PIXEL_UNPACK_BUFFER,i,r)}constructor(e,i,r,n){this._context=e,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(Hs.BufferObject,this),this._glName=this._context.gl.createBuffer(),S_(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===zt.ELEMENT_ARRAY_BUFFER?this._indexType===bt.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===zt.ELEMENT_ARRAY_BUFFER||this.bufferType===zt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Hs.BufferObject,this),this._context=eS(this._context)):this._glName&&Mp.warn("Leaked WebGL buffer object")}setSize(e,i=null){if(e<=0&&Mp.error("Buffer size needs to be positive!"),this.bufferType===zt.ELEMENT_ARRAY_BUFFER&&i!=null)switch(this._indexType=i,i){case bt.UNSIGNED_SHORT:e*=2;break;case bt.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let i=e.byteLength;this.bufferType===zt.ELEMENT_ARRAY_BUFFER&&(ZN(e)&&(i/=2,this._indexType=bt.UNSIGNED_SHORT),XN(e)&&(i/=4,this._indexType=bt.UNSIGNED_INT)),this._setBufferData(i,e)}_setBufferData(e,i=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;i!=null?n.bufferData(this.bufferType,i,this.usage):n.bufferData(this.bufferType,e,this.usage),S_(n),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,i,r,n){if(!e)return;(i<0||i*e.BYTES_PER_ELEMENT>=this.byteLength)&&Mp.error("offset is out of range!"),r>=n&&Mp.error("end must be bigger than start!"),(i+(n-r))*e.BYTES_PER_ELEMENT>this.byteLength&&Mp.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===xi.WEBGL2)o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,e,r,n-r);else{const a=r===0&&n===e.length?e:e.subarray(r,n);o.bufferSubData(this.bufferType,i*e.BYTES_PER_ELEMENT,a)}S_(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,i=0,r,n){if(this._context.type!==xi.WEBGL2)return void Mp.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||n<0)return void Mp.error("Problem getting subdata: offset and length were less than zero!");const s=p6e(e)?e.BYTES_PER_ELEMENT:1;if(s*((r??0)+(n??0))>e.byteLength)return void Mp.error("Problem getting subdata: offset and length exceeded destination size!");i+s*(n??0)>this.byteLength&&Mp.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,zt.COPY_READ_BUFFER),o.getBufferSubData(zt.COPY_READ_BUFFER,i,e,r,n),this._context.unbindBuffer(zt.COPY_READ_BUFFER)}async getSubDataAsync(e,i=0,r,n){this._context.type===xi.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,i,r,n)):Mp.error("Get buffer subdata is supported in WebGL2 only!")}};function p6e(t){return qTe(t)}var py;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(py||(py={}));let Di=class{constructor(e=0,i=e){this.width=e,this.height=i,this.target=Cn.TEXTURE_2D,this.pixelFormat=Gt.RGBA,this.dataType=ss.UNSIGNED_BYTE,this.samplingMode=qt.LINEAR,this.wrapMode=Jt.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function f6e(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*EH(t.internalFormat)}let m6e=class tme extends Di{constructor(e,i){switch(super(),this.context=e,Object.assign(this,i),this.internalFormat){case mt.R16F:case mt.R16I:case mt.R16UI:case mt.R32F:case mt.R32I:case mt.R32UI:case mt.R8_SNORM:case mt.R8:case mt.R8I:case mt.R8UI:this.pixelFormat=Gt.RED}}static validate(e,i){return new tme(e,i)}};const VJ=4;let Wt=class{constructor(e,i=null,r=null){if(this.type=py.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,r=i;else{const n=m6e.validate(e,i);if(!n)throw new ce("Texture descriptor invalid");this._descriptor=n}if(this._descriptor.context.instanceCounter.increment(Hs.Texture,this),this._descriptor.context.type!==xi.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),Xv(this._descriptor.target)))throw new ce("3D and array textures are not supported in WebGL1");this._descriptor.target===Cn.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return b6e.delete(this),f6e(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(Hs.Texture,this))}release(){this.dispose()}resize(e,i){const r=this._descriptor;if(r.width!==e||r.height!==i){if(this._wasImmutablyAllocated)throw new ce("Immutable textures can't be resized!");r.width=e,r.height=i,this._descriptor.target===Cn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let i=Cn.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Cn.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(e,i)}setData(e){this._setData(e)}_setData(e,i){if(!this._descriptor.context||!this._descriptor.context.gl)return;const r=this._descriptor.context.gl;S_(r),this._glName||(this._glName=r.createTexture()),e===void 0&&(e=null);const n=this._descriptor,s=i??n.target,o=Xv(s);e===null&&(n.width=n.width||VJ,n.height=n.height||VJ,o&&(n.depth=n.depth??1));const a=this._descriptor.context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),C6(this._descriptor.context,n),this._configurePixelStorage(),S_(r);const l=this._deriveInternalFormat();if(E6(e)){let c=e.width,u=e.height;const p=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,u=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,p),this._texImage(s,0,l,c,u,p,e),S_(r),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=c),n.height||(n.height=u),o&&!n.depth&&(n.depth=p)}else{const{width:c,height:u,depth:p}=n;if(c==null||u==null)throw new ce("Width and height must be specified!");if(o&&p==null)throw new ce("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,p),RI(e)){const f=e.levels,y=HJ(s,c,u,p),v=Math.min(y-1,f.length-1);this._descriptor.context.gl2!=null?r.texParameteri(n.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,v):n.hasMipmap=n.hasMipmap&&y===f.length;const b=l;if(!y6e(b))throw new ce("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((x,S,P,C)=>{const R=f[Math.min(x,f.length-1)];this._compressedTexImage(s,x,b,S,P,C,R)},v)}else this._texImage(s,0,l,c,u,p,e),S_(r),n.hasMipmap&&this.generateMipmap()}GJ(r,this._descriptor),jJ(r,this._descriptor),g6e(this._descriptor.context,this._descriptor),S_(r),this._descriptor.context.bindTexture(a,Wt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,i,r,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,u=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:y,target:v,isImmutable:b}=u;if(b&&!this._wasImmutablyAllocated)throw new ce("Cannot update immutable texture before allocation!");const x=this._descriptor.context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES,!0);if((i<0||r<0||n>u.width||s>u.height||i+n>u.width||r+s>u.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(E6(o)?c?c.texSubImage2D(v,e,i,r,n,s,f,y,o):l.texSubImage2D(v,e,i,r,f,y,o):RI(o)?l.compressedTexSubImage2D(v,e,i,r,n,s,p,o.levels[e]):l.texSubImage2D(v,e,i,r,n,s,f,y,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(x,Wt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,i,r,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new ce("3D textures are not supported in WebGL1");const u=this._descriptor,p=this._deriveInternalFormat(),{pixelFormat:f,dataType:y,isImmutable:v,target:b}=u;if(v&&!this._wasImmutablyAllocated)throw new ce("Cannot update immutable texture before allocation!");Xv(b)||console.warn("Attempting to set 3D texture data on a non-3D texture");const x=this._descriptor.context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||n<0||s>u.width||o>u.height||a>u.depth||i+s>u.width||r+o>u.height||n+a>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),RI(l))l=l.levels[e],c.compressedTexSubImage3D(b,e,i,r,n,s,o,a,p,l);else{const S=l;c.texSubImage3D(b,e,i,r,n,s,o,a,f,y,S)}this._descriptor.context.bindTexture(x,Wt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new ce("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,C6(this._descriptor.context,e)}e.samplingMode===qt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=qt.LINEAR_MIPMAP_NEAREST):e.samplingMode===qt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=qt.NEAREST_MIPMAP_NEAREST);const i=this._descriptor.context.bindTexture(this,Wt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(i,Wt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,C6(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,i=this._descriptor;this._samplingModeDirty&&(GJ(e,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(jJ(e,i),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===xi.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Gt.DEPTH_STENCIL&&(this._descriptor.internalFormat=Gt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case ss.FLOAT:switch(this._descriptor.pixelFormat){case Gt.RGBA:return this._descriptor.internalFormat=mt.RGBA32F;case Gt.RGB:return this._descriptor.internalFormat=mt.RGB32F;default:throw new ce("Unable to derive format")}case ss.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Gt.RGBA:return this._descriptor.internalFormat=mt.RGBA8;case Gt.RGB:return this._descriptor.internalFormat=mt.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Gt.DEPTH_STENCIL?Gt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,i),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,i,r,n,s,o){const a=this._descriptor.context.gl2;if(a==null)throw new ce("Immutable textures are not supported in WebGL1");if(!_6e(i))throw new ce("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?HJ(e,n,s,o):1;if(Xv(e)){if(o==null)throw new ce("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,i,n,s,o)}else a.texStorage2D(e,l,i,n,s);this._wasImmutablyAllocated=!0}_texImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl,c=Xv(e),{isImmutable:u,pixelFormat:p,dataType:f}=this._descriptor,y=this._descriptor.context.type===xi.WEBGL2,v=y?l:null;if(y||!E6(a))if(u){if(a!=null){const b=a;if(c){if(o==null)throw new ce("Missing depth dimension for 3D texture upload");v.texSubImage3D(e,i,0,0,0,n,s,o,p,f,b)}else l.texSubImage2D(e,i,0,0,n,s,p,f,b)}}else{const b=a;if(c){if(o==null)throw new ce("Missing depth dimension for 3D texture upload");v.texImage3D(e,i,r,n,s,o,0,p,f,b)}else l.texImage2D(e,i,r,n,s,0,p,f,b)}else l.texImage2D(e,0,r,p,f,a)}_compressedTexImage(e,i,r,n,s,o,a){const l=this._descriptor.context.gl;let c=null;const u=Xv(e),p=this._descriptor.isImmutable;if(u){if(this._descriptor.context.type!==xi.WEBGL2)throw new ce("3D textures are not supported in WebGL1");c=l}if(p){if(a!=null)if(u){if(o==null)throw new ce("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,i,0,0,0,n,s,o,r,a)}else l.compressedTexSubImage2D(e,i,0,0,n,s,r,a)}else if(u){if(o==null)throw new ce("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,i,r,n,s,o,0,a)}else l.compressedTexImage2D(e,i,r,n,s,0,a)}_forEachMipmapLevel(e,i=1/0){let{width:r,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===Cn.TEXTURE_3D;if(r==null||n==null||l&&s==null)throw new ce("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,r,n,s),o&&(r!==1||n!==1||l&&s!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function C6(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const i=t.type===xi.WEBGL2;i||!e.isImmutable&&!Xv(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!i&&(e.width!=null&&rb(e.width)&&e.height!=null&&rb(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==Jt.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===Jt.CLAMP_TO_EDGE&&e.wrapMode.t===Jt.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function GJ(t,e){let i=e.samplingMode,r=e.samplingMode;i===qt.LINEAR_MIPMAP_NEAREST||i===qt.LINEAR_MIPMAP_LINEAR?(i=qt.LINEAR,e.hasMipmap||(r=qt.LINEAR)):i!==qt.NEAREST_MIPMAP_NEAREST&&i!==qt.NEAREST_MIPMAP_LINEAR||(i=qt.NEAREST,e.hasMipmap||(r=qt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,i),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,r)}function jJ(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function g6e(t,e){const i=t.capabilities.textureFilterAnisotropic;i&&t.gl.texParameterf(e.target,i.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function _6e(t){return t in mt}function y6e(t){return t in In}function RI(t){return t!=null&&"type"in t&&t.type==="compressed"}function v6e(t){return t!=null&&"byteLength"in t}function E6(t){return t!=null&&!RI(t)&&!v6e(t)}function Xv(t){return t===Cn.TEXTURE_3D||t===Cn.TEXTURE_2D_ARRAY}function HJ(t,e,i,r=1){let n=Math.max(e,i);return t===Cn.TEXTURE_3D&&(n=Math.max(n,r)),Math.round(Math.log(n)/Math.LN2)+1}Wt.TEXTURE_UNIT_FOR_UPDATES=0;const b6e=new Map;function Fl(t,e=TH,i=Ni,r=-1,n=1){let s=null;return e===H3?s=new Float32Array([r,r,0,0,n,r,1,0,r,n,0,1,n,n,1,1]):s=new Float32Array([r,r,n,r,r,n,n,n]),new vp(t,i,{geometry:e},{geometry:Ki.createVertex(t,zi.STATIC_DRAW,s)})}function w6e(t,e=TH,i=Ni){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new vp(t,i,{geometry:e},{geometry:Ki.createVertex(t,zi.STATIC_DRAW,r)})}const ime=4;function rme(t,e=ime){const i=new Di;return i.samplingMode=qt.NEAREST,i.width=i.height=e,new Wt(t,i)}function x6e(t,e,i=ime){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s]=255*e[0],r[s+1]=255*e[1],r[s+2]=255*e[2],r[s+3]=255*e[3];const n=new Di;return n.samplingMode=qt.NEAREST,n.width=n.height=i,new Wt(t,n,r)}function nme(t){const e=new Di;return e.samplingMode=qt.NEAREST,e.width=e.height=1,new Wt(t,e,new Uint8Array([255,255,255,255]))}let WJ=class{constructor(e,i){this._view=e,this.type=fa.Realistic,this._handles=new an,this._passParameters=new u6e,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=vi.radius,this._fadeHaze=0,this._tmpScale=it(),this._updateRadius(vi.radius);const r=i.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([Pe(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateRootTileElevationBounds():null}),Pe(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateVisibleElevationBounds():null})]);const n=new wD;n.haze=!1,this._atmosphereTechnique=i.techniqueRepository.acquire(qE,n),n.haze=!0,this._atmosphereHazeTechnique=i.techniqueRepository.acquire(qE,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=i.techniqueRepository.acquire(qE,n),n.haze=!0,this._atmosphereHazeReducedTechnique=i.techniqueRepository.acquire(qE,n),this._vao=Fl(r,H3)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,i){this._render(e,i?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,i,!1)}renderHaze(e,i,r){this._fadeHaze=i,this._render(e,r?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,r,!0)}_render(e,i,r,n,s){if(r==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=r;const a=o.background.color;me(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);if(n)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),u=ze(e.bindParameters.camera.eye)-vi.radius;let p;if(u<__){const v=Math.min(1,Math.max(0,u/__));p=s?Bt(.4,.5,v):Bt(.2,.3,v)}else{const v=Math.min(1,Math.max(0,(u-__)/(15*__)));p=s?Bt(.5,1,v):Bt(.3,.6,v)}const f=Math.floor(p*e.bindParameters.camera.fullViewport[2]),y=Math.floor(p*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,f,y),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),bi(this._tmpScale,f/e.bindParameters.camera.fullViewport[2],y/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,s,r,this._tmpScale)}}_renderCommon(e,i){this._vao!=null&&(i.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.rctx.drawArrays(Ht.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=vi.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(vi.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,bi(this._passParameters.radii,e,e+__),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-lB)*lB)}_update(e){if(!e)return;const i=ba(e.eye),r=Math.sqrt(i),n=i-this._passParameters.radii[1]*this._passParameters.radii[1],s=$e((r-this._passParameters.radii[0])/__,0,1);Br(this._passParameters.heightParameters,r,i,n,s),this._passParameters.altitudeFade=wH(r-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Bt(Bt(.6,1,wP(9500,10500,r-vi.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function sme(t){t.fragment.code.add(T`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function AH(t,e){switch(t.include(Ff,e),e.textureCoordinateType){case Yn.Default:case Yn.Compressed:return void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case Yn.Atlas:return t.include(sme),void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case Yn.None:case Yn.COUNT:return}}let yu=class extends On{constructor(e,i){super(e,"vec3",vr.Draw,(r,n,s,o)=>r.setUniform3fv(e,i(n,s,o)))}},$h=class extends On{constructor(e,i){super(e,"sampler2D",vr.Draw,(r,n,s)=>r.bindTexture(e,i(n,s)))}},$y=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,i){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,i),this._technique),this._technique}ensureResources(e){return _g.LOADED}},PH=class extends $y{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,i=>this._texture=i),this._acquire(e.normalTextureId,i=>this._textureNormal=i),this._acquire(e.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(e.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(e.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=nn(this._texture),this._textureNormal=nn(this._textureNormal),this._textureEmissive=nn(this._textureEmissive),this._textureOcclusion=nn(this._textureOcclusion),this._textureMetallicRoughness=nn(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?_g.LOADED:_g.LOADING}get textureBindParameters(){return new ome(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=nn(this._texture),this._textureId=e,this._acquire(this._textureId,i=>this._texture=i))}_acquire(e,i){if(e==null)return void i(null);const r=this._textureRepository.acquire(e);if(Pu(r))return++this._numLoading,void r.then(n=>{if(this._disposed)return nn(n),void i(null);i(n)}).finally(()=>--this._numLoading);i(r)}},ome=class extends wr{constructor(e=null,i=null,r=null,n=null,s=null){super(),this.texture=e,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=n,this.textureMetallicRoughness=s}};var Ct;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Ct||(Ct={}));function OH(t,e){const i=t.fragment,r=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Ct.Normal&&r&&t.include(AH,e),e.pbrMode!==Ct.Schematic)if(e.pbrMode!==Ct.Disabled){if(e.pbrMode===Ct.Normal){i.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(i.uniforms.add(n===vr.Pass?new vt("texMetallicRoughness",s=>s.textureMetallicRoughness):new $h("texMetallicRoughness",s=>s.textureMetallicRoughness)),i.code.add(T`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(i.uniforms.add(n===vr.Pass?new vt("texEmission",s=>s.textureEmissive):new $h("texEmission",s=>s.textureEmissive)),i.code.add(T`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(i.uniforms.add(n===vr.Pass?new vt("texOcclusion",s=>s.textureOcclusion):new $h("texOcclusion",s=>s.textureOcclusion)),i.code.add(T`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(T`float getBakedOcclusion() { return 1.0; }`),n===vr.Pass?i.uniforms.add(new ei("emissionFactor",s=>s.emissiveFactor),new ei("mrrFactors",s=>s.mrrFactors)):i.uniforms.add(new yu("emissionFactor",s=>s.emissiveFactor),new yu("mrrFactors",s=>s.mrrFactors)),i.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?T`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?T`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?T`applyEmission(${e.hasEmissiveTextureTransform?T`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?T`applyOcclusion(${e.hasOcclusionTextureTransform?T`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else i.code.add(T`float getBakedOcclusion() { return 1.0; }`);else i.code.add(T`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function RH(t,e){const i=t.fragment,r=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new ei("lightingAmbientSH0",(n,s)=>me(qJ,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add(new yi("lightingAmbientSH_R",(n,s)=>Br(vm,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new yi("lightingAmbientSH_G",(n,s)=>Br(vm,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new yi("lightingAmbientSH_B",(n,s)=>Br(vm,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add(new ei("lightingAmbientSH0",(n,s)=>me(qJ,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new yi("lightingAmbientSH_R1",(n,s)=>Br(vm,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new yi("lightingAmbientSH_G1",(n,s)=>Br(vm,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new yi("lightingAmbientSH_B1",(n,s)=>Br(vm,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new yi("lightingAmbientSH_R2",(n,s)=>Br(vm,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new yi("lightingAmbientSH_G2",(n,s)=>Br(vm,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new yi("lightingAmbientSH_B2",(n,s)=>Br(vm,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),i.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Ct.Normal&&e.pbrMode!==Ct.Schematic||i.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const qJ=I(),vm=gi();function W3(t){t.vertex.code.add(T`const float PI = 3.141592653589793;`),t.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var Zn,xb;function T6e(t){return(t==null?void 0:t.cubeMap)!=null}function MH(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(Zn||(Zn={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(xb||(xb={}));let S6e=class{constructor(){this.readChannels=xb.RG,this.renderingStage=Zn.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=I(),this.isCameraPositionFinal=!0,this.parallax=new ZJ,this.parallaxNew=new ZJ,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:Fs.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:hc.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:fy.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===Fs.FADE_OUT||this.fadeInOut.stage===Fs.FADE_IN||this.fadeIn.stage===hc.FADE_IN||this.fadeInOutHeight.stage!==fy.FINISHED||this.renderingStage===Zn.FADING_TEXTURE_CHANNELS}};var hc,Fs,fy;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(hc||(hc={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(Fs||(Fs={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(fy||(fy={}));let ZJ=class{constructor(){this.anchorPointClouds=I(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=Ne()}},kf=class extends On{constructor(e,i){super(e,"bool",vr.Pass,(r,n,s)=>r.setUniform1b(e,i(n,s)))}},C6e=class extends On{constructor(e,i){super(e,"samplerCube",vr.Pass,(r,n,s)=>r.bindTexture(e,i(n,s)))}};function ame(t){const e=t.fragment;e.uniforms.add(new en("rotationMatrixClouds",(i,r)=>r.cloudsFade.parallax.transform),new en("rotationMatrixCloudsCrossFade",(i,r)=>r.cloudsFade.parallaxNew.transform),new ei("anchorPosition",(i,r)=>r.cloudsFade.parallax.anchorPointClouds),new ei("anchorPositionCrossFade",(i,r)=>r.cloudsFade.parallaxNew.anchorPointClouds),new je("cloudsHeight",(i,r)=>r.cloudsFade.parallax.cloudsHeight),new je("radiusCurvatureCorrectionFactor",(i,r)=>r.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new je("totalFadeInOut",(i,r)=>r.cloudsFade.fadeInOut.stage===Fs.FINISHED?r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeIn.factor:r.cloudsFade.fadeInOutHeight.factor+1-r.cloudsFade.fadeInOut.factor),new je("crossFadeAnchorFactor",(i,r)=>$e(r.cloudsFade.crossFade.factor,0,1)),new C6e("cubeMap",(i,r)=>{var n;return(n=r.cloudsFade.data)!=null&&n.cubeMap?r.cloudsFade.data.cubeMap.colorTexture:null}),new kf("crossFade",(i,r)=>r.cloudsFade.crossFade.enabled),new kf("readChannelsRG",(i,r)=>r.cloudsFade.readChannels===xb.RG),new kf("fadeTextureChannels",(i,r)=>r.cloudsFade.renderingStage===Zn.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",vi.radius),e.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),jg(e),om(e),e.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(T`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(T`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(T`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(T`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function am(t){t.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function E6e(){const t=new Fi;t.attributes.add(M.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new en("inverseProjectionMatrix",(r,n)=>n.camera.inverseProjectionMatrix),new en("inverseViewMatrix",(r,n)=>dS(A6e,n.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(am),i.include(Ac),t.include(RH,{pbrMode:Ct.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(W3),t.include(Q5),t.include(vD),t.include(ame,{instancedDoublePrecision:!1}),i.uniforms.add(new ei("cameraPosition",(r,n)=>n.camera.eye)),i.code.add(T`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const A6e=Ne(),P6e=Object.freeze(Object.defineProperty({__proto__:null,build:E6e},Symbol.toStringTag,{value:"Module"}));let lme=class cme extends qi{constructor(e){super(e,new Oa,()=>this.destroy())}initializeProgram(e){return new Gi(e.rctx,cme.shader.get().build(),Ni)}initializePipeline(){return Zt({blending:Fo(De.ONE,De.ZERO,De.SRC_ALPHA,De.ONE),depthTest:{func:br.LEQUAL},colorWrite:ni})}};lme.shader=new Vi(P6e,()=>Oe(()=>import("./CloudsComposition.glsl-05ad1e45.js"),[],import.meta.url));let Yv=class extends ke{constructor(e){super(e),this._technique=new lme(e),this._vao=Fl(e.rctx)}destroy(){this._technique=nn(this._technique),this._vao=et(this._vao)}render(e){const i=e.bindParameters.cloudsFade;if(this._vao==null||i.data==null)return;if(!this._technique.compiled)return void this.requestRender();const r=e.rctx.bindTechnique(this._technique,O6e,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Ht.TRIANGLE_STRIP,0,4)}};d([m({constructOnly:!0})],Yv.prototype,"rctx",void 0),d([m({constructOnly:!0})],Yv.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],Yv.prototype,"planetRadius",void 0),d([m({constructOnly:!0})],Yv.prototype,"requestRender",void 0),Yv=d([J("esri.views.3d.environment.CloudsComposition")],Yv);const O6e=new wr;function jh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function R6e(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function $H(t,e,i,r,n,s,o,a,l,c){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function IH(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Hh(t,e){if(t===e){const i=e[1],r=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Xb(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=u*o-a*c,f=-u*s+a*l,y=c*s-o*l;let v=i*p+r*f+n*y;return v?(v=1/v,t[0]=p*v,t[1]=(-u*r+n*c)*v,t[2]=(a*r-n*o)*v,t[3]=f*v,t[4]=(u*i-n*l)*v,t[5]=(-a*i+n*s)*v,t[6]=y*v,t[7]=(-c*i+r*l)*v,t[8]=(o*i-r*s)*v,t):null}function M6e(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=n*c-r*u,t[2]=r*a-n*o,t[3]=a*l-s*u,t[4]=i*u-n*l,t[5]=n*s-i*a,t[6]=s*c-o*l,t[7]=r*l-i*c,t[8]=i*o-r*s,t}function $6e(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+i*(-c*n+o*a)+r*(l*n-s*a)}function IT(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=e[8],f=i[0],y=i[1],v=i[2],b=i[3],x=i[4],S=i[5],P=i[6],C=i[7],R=i[8];return t[0]=f*r+y*o+v*c,t[1]=f*n+y*a+v*u,t[2]=f*s+y*l+v*p,t[3]=b*r+x*o+S*c,t[4]=b*n+x*a+S*u,t[5]=b*s+x*l+S*p,t[6]=P*r+C*o+R*c,t[7]=P*n+C*a+R*u,t[8]=P*s+C*l+R*p,t}function xD(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=e[8],f=i[0],y=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=f*r+y*o+c,t[7]=f*n+y*a+u,t[8]=f*s+y*l+p,t}function LH(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],p=e[8],f=Math.sin(i),y=Math.cos(i);return t[0]=y*r+f*o,t[1]=y*n+f*a,t[2]=y*s+f*l,t[3]=y*o-f*r,t[4]=y*a-f*n,t[5]=y*l-f*s,t[6]=c,t[7]=u,t[8]=p,t}function DH(t,e,i){const r=i[0],n=i[1],s=i[2];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function I6e(t,e,i){const r=i[0],n=i[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function L6e(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function D6e(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function N6e(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function F6e(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function NH(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i+i,a=r+r,l=n+n,c=i*o,u=r*o,p=r*a,f=n*o,y=n*a,v=n*l,b=s*o,x=s*a,S=s*l;return t[0]=1-p-v,t[3]=u-S,t[6]=f+x,t[1]=u+S,t[4]=1-c-v,t[7]=y-b,t[2]=f-x,t[5]=y+b,t[8]=1-c-p,t}function ume(t,e){const i=e[0],r=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],p=u*o-a*c,f=-u*s+a*l,y=c*s-o*l,v=i*p+r*f+n*y;if(!v)return null;const b=1/v;return t[0]=p*b,t[1]=(-u*r+n*c)*b,t[2]=(a*r-n*o)*b,t[3]=f*b,t[4]=(u*i-n*l)*b,t[5]=(-a*i+n*s)*b,t[6]=y*b,t[7]=(-c*i+r*l)*b,t[8]=(o*i-r*s)*b,t}function my(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],p=e[9],f=e[10],y=e[11],v=e[12],b=e[13],x=e[14],S=e[15],P=i*a-r*o,C=i*l-n*o,R=i*c-s*o,N=r*l-n*a,$=r*c-s*a,k=n*c-s*l,B=u*b-p*v,W=u*x-f*v,Z=u*S-y*v,K=p*x-f*b,X=p*S-y*b,ae=f*S-y*x;let re=P*ae-C*X+R*K+N*Z-$*W+k*B;return re?(re=1/re,t[0]=(a*ae-l*X+c*K)*re,t[1]=(l*Z-o*ae-c*W)*re,t[2]=(o*X-a*Z+c*B)*re,t[3]=(n*X-r*ae-s*K)*re,t[4]=(i*ae-n*Z+s*W)*re,t[5]=(r*Z-i*X-s*B)*re,t[6]=(b*k-x*$+S*N)*re,t[7]=(x*R-v*k-S*C)*re,t[8]=(v*$-b*R+S*P)*re,t):null}function k6e(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function U6e(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function z6e(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function B6e(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t}function hme(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}function V6e(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t}function G6e(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t[6]=e[6]+i[6]*r,t[7]=e[7]+i[7]*r,t[8]=e[8]+i[8]*r,t}function j6e(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function H6e(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],p=e[0],f=e[1],y=e[2],v=e[3],b=e[4],x=e[5],S=e[6],P=e[7],C=e[8],R=ol();return Math.abs(i-p)<=R*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=R*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(n-y)<=R*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-v)<=R*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(o-b)<=R*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-x)<=R*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(l-S)<=R*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-P)<=R*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(u-C)<=R*Math.max(1,Math.abs(u),Math.abs(C))}function FH(t){const e=ol(),i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(i*i+s*s+l*l))<=e&&Math.abs(1-(r*r+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}const W6e=IT,q6e=hme;Object.freeze(Object.defineProperty({__proto__:null,add:B6e,adjoint:M6e,copy:R6e,determinant:$6e,equals:H6e,exactEquals:j6e,frob:z6e,fromMat2d:F6e,fromMat4:jh,fromQuat:NH,fromRotation:D6e,fromScaling:N6e,fromTranslation:L6e,identity:IH,invert:Xb,isOrthoNormal:FH,mul:W6e,multiply:IT,multiplyScalar:V6e,multiplyScalarAndAdd:G6e,normalFromMat4:my,normalFromMat4Legacy:ume,projection:k6e,rotate:LH,scale:DH,scaleByVec2:I6e,set:$H,str:U6e,sub:q6e,subtract:hme,translate:xD,transpose:Hh},Symbol.toStringTag,{value:"Module"}));function Tn(){return new Float32Array(3)}function TD(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function mr(t,e,i){const r=new Float32Array(3);return r[0]=t,r[1]=e,r[2]=i,r}function dme(t,e){return new Float32Array(t,e,3)}function kH(){return Tn()}function pme(){return mr(1,1,1)}function fme(){return mr(1,0,0)}function mme(){return mr(0,1,0)}function gme(){return mr(0,0,1)}const Z6e=kH(),X6e=pme(),Y6e=fme(),J6e=mme(),K6e=gme();Object.freeze(Object.defineProperty({__proto__:null,ONES:X6e,UNIT_X:Y6e,UNIT_Y:J6e,UNIT_Z:K6e,ZEROS:Z6e,clone:TD,create:Tn,createView:dme,fromValues:mr,ones:pme,unitX:fme,unitY:mme,unitZ:gme,zeros:kH},Symbol.toStringTag,{value:"Module"}));var Rl;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(Rl||(Rl={}));let MI=class extends Oa{constructor(){super(...arguments),this.steps=Rl.SIXTEEN,this.writeTextureChannels=xb.RG}};d([q({count:Rl.COUNT})],MI.prototype,"steps",void 0),d([q({constValue:ge("esri-mobile")?1024:2048})],MI.prototype,"cubeMapSize",void 0),d([q()],MI.prototype,"writeTextureChannels",void 0);let ZE=class{constructor(e,i,r,n,s,o,a,l,c=.5){this.coverage=e,this.density=i,this.absorption=r,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const XJ=new ZE([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Rl.SIXTEEN),pa={sunny:XJ,cloudy:new ZE([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Rl.TWOHUNDRED,.6),rainy:new ZE([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Rl.TWOHUNDRED,.4),snowy:new ZE([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Rl.HUNDRED,.65),foggy:new ZE([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Rl.SIXTEEN),default:XJ},mh=ge("esri-mobile")?64:128,Q6e=mh/128,Ld=Math.ceil(Math.sqrt(mh)),J_=(mh+2)*Ld,eke=1e5,A6=128,tke=J_/1560;function Yh(t,e=!0){t.attributes.add(M.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let jP=class extends On{constructor(e,i){super(e,"mat3",vr.Draw,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}},_me=class extends wr{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=pa.default.raymarchingSteps,this.weatherTile=it()}},yme=class extends wr{constructor(){super(...arguments),this.viewMatrix=on()}};function ike(t){const e=new Fi;e.include(Yh,!1);const i=e.fragment;return i.uniforms.add(new je("cloudRadius",r=>r.cloudRadius),new je("power",r=>Bt(35,120,r.absorption)),new je("sigmaE",r=>1+r.absorption),new je("density",r=>Bt(0,.3,r.density)),new je("cloudSize",r=>Bt(0,.02,Math.max(.01,1-r.cloudSize))),new je("detailSize",r=>Bt(0,.2,Math.max(.01,1-r.detailSize))),new je("smoothness",r=>Bt(0,.5,1-r.smoothness)),new je("cloudHeight",r=>Bt(0,1500,r.cloudHeight)),new je("coverage",r=>r.coverage),new jP("view",r=>r.viewMatrix),new vt("cloudShapeTexture",r=>r.noiseTexture!=null?r.noiseTexture.textureAtlas:null),new Bi("cloudVariables",r=>bi(rke,r.coverage,r.absorption))),i.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),i.code.add(T`
    const int STEPS = ${t.steps===Rl.SIXTEEN?T`16`:t.steps===Rl.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),i.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(J_)};
      const float dataWidth = ${T.float(J_)};
      const float tileRows = ${T.float(Ld)};
      const vec3 atlasDimensions = vec3(${T.float(mh)}, ${T.float(mh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float(Q6e)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${T.float(tke)} * p) / ${T.float(J_)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),i.code.add(T`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),i.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),i.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),i.code.add(T`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),i.code.add(T`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),i.code.add(T`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const rke=it(),nke=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:yme,CloudsPassParameters:_me,build:ike},Symbol.toStringTag,{value:"Module"}));let vme=class bme extends qi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Gi(e.rctx,bme.shader.get().build(this.configuration),Ni)}initializePipeline(){return Zt({blending:Ec(De.CONSTANT_COLOR,De.ONE_MINUS_CONSTANT_COLOR,Zf.ADD,this.configuration.writeTextureChannels===xb.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:br.LEQUAL},colorWrite:ni})}};vme.shader=new Vi(nke,()=>Oe(()=>import("./Clouds.glsl-c7cd89f7.js"),[],import.meta.url));var uu;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(uu||(uu={}));let fB=class extends Oa{constructor(){super(...arguments),this.mode=uu.Full}};d([q({count:uu.COUNT})],fB.prototype,"mode",void 0);let wme=class extends wr{constructor(){super(...arguments),this.weatherTile=Ri(0,0)}};function ske(t){const e=new Fi;return e.include(Yh,!1),e.fragment.code.add(T`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===uu.Full&&e.fragment.code.add(T`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${T.float(Ld)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(8)});

      float worley0 = worley(p, ${T.float(2)} * 2.0);
      float worley1 = worley(p, ${T.float(2)} * 8.0);
      float worley2 = worley(p, ${T.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(2)});
      float worley1 = worley(p, ${T.float(2)} * 2.0);
      float worley2 = worley(p, ${T.float(2)} * 4.0);
      float worley3 = worley(p, ${T.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Bi("weatherTile",i=>i.weatherTile)),e.fragment.code.add(T`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${T.float(A6)});

      // Get global coordinates of p
      p += weatherTile * ${T.float(A6)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${T.float(eke)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(T`void main() {`),t.mode===uu.Full&&e.fragment.code.add(T`
        float padWidth = 1.0;
        float paddedSize = ${T.float(mh)} + 2.0 * padWidth;
        float tileCount = ${T.float(Ld)} * ${T.float(Ld)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${T.float(mh)};
          }

          if (startPadY) {
            pixel.y += ${T.float(mh)};
          }

          if (endPadX) {
            pixel.x -= ${T.float(mh)};
          }

          if (endPadY) {
            pixel.y -= ${T.float(mh)};
          }

          uv = vec2(pixel.xy / ${T.float(mh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${T.float(mh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${T.float(Ld)} * ${T.float(Ld)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${T.float(Ld)} * ${T.float(Ld)});
        p = p_;
        p.z /= (${T.float(Ld)} * ${T.float(Ld)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(T`
      vec2 mapUV = ${T.float(A6)} * (gl_FragCoord.xy / ${T.float(J_)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===uu.Full?T`fragColor.ba = vec2(0.0, map);`:T`fragColor = vec4(map);`};
    }
  `),e}const oke=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:wme,build:ske},Symbol.toStringTag,{value:"Module"}));let mB=class xme extends qi{initializeProgram(e){return new Gi(e.rctx,xme.shader.get().build(this.configuration),Ni)}initializePipeline(){return Zt({blending:this.configuration.mode===uu.Full?Ec(De.ONE,De.ZERO):Fo(De.ZERO,De.ONE,De.ONE,De.ZERO),depthTest:{func:br.ALWAYS},colorWrite:ni})}};mB.shader=new Vi(oke,()=>Oe(()=>import("./NoiseTextureAtlas.glsl-b0370ade.js"),[],import.meta.url));let SD=class{constructor(e,i,r=i){this.internalFormat=e,this.width=i,this.height=r,this.multisampled=!1,this.samples=1}};function ake(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*EH(t.internalFormat)}let lke=class{constructor(e,i){this._context=e,this._descriptor=i,this.type=py.RenderBuffer,this._context.instanceCounter.increment(Hs.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==xi.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,n,s)}else r.renderbufferStorage(r.RENDERBUFFER,o,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,i=this._context.parameters.maxSamples;return e?Math.min(e,i):i}get gpuMemoryUsage(){return ake(this._descriptor)}resize(e,i){const r=this._descriptor;if(r.width===e&&r.height===i)return;r.width=e,r.height=i;const n=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):n.renderbufferStorage(n.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Hs.Renderbuffer,this),this._context=eS(this._context))}};const cke=ye.getLogger("esri.views.webgl.FramebufferObject");let Rs=class Jx{constructor(e,i,r=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(Hs.FramebufferObject,this);const n=$I(i)?i:new Wt(this._context,i);if(this._colorAttachments.set(Qc.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(Qc.COLOR_ATTACHMENT0),r!=null)if(hke(r))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=$I(r)?r:new Wt(this._context,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=uke(r)?r:new lke(this._context,r),o=s.descriptor;o.internalFormat===hs.STENCIL_INDEX8?this._stencilBuffer=s:this._depthBuffer=s,this._validateRenderBufferDescriptor(o)}}dispose(){var i,r;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((n,s)=>{var o;return(o=this.detachColorTexture(s))==null?void 0:o.dispose()}),(i=this.detachDepthStencilBuffer())==null||i.dispose(),(r=this.detachDepthStencilTexture())==null||r.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(Hs.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Qc.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var i;const e=this._colorAttachments.get(Qc.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.width)??0}get height(){var i;const e=this._colorAttachments.get(Qc.COLOR_ATTACHMENT0);return((i=e==null?void 0:e.descriptor)==null?void 0:i.height)??0}get gpuMemoryUsage(){var e;return[...this._colorAttachments].reduce((i,[r,n])=>i+n.gpuMemoryUsage,((e=this.depthStencilAttachment)==null?void 0:e.gpuMemoryUsage)??0)}getColorTexture(e){const i=this._colorAttachments.get(e);return i&&$I(i)?i:null}attachColorTexture(e,i=Qc.COLOR_ATTACHMENT0){var n;if(!e)return;this._validateColorAttachmentPoint(i);const r=e.descriptor;this._validateTextureDescriptor(r),(n=this.detachColorTexture(i))==null||n.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,i)),this._colorAttachments.set(i,e)}detachColorTexture(e=Qc.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(e);if(i)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),i}setColorTextureTarget(e,i=Qc.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);r&&this._framebufferTexture2D(r.glName,i,e)}attachDepthStencil(e){if(e)switch(e.type){case py.Texture:return this._attachDepthStencilTexture(e);case py.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var r;if(e==null)return;const i=e.descriptor;i.pixelFormat!==Gt.DEPTH_STENCIL&&i.pixelFormat!==Gt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==ss.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,NJ)),(r=this._depthStencilTexture)==null||r.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,NJ)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){var r;if(e==null)return;const i=e.descriptor;if(i.internalFormat!==hs.DEPTH_STENCIL&&i.internalFormat!==hs.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(i),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const n=this._context.gl,s=this._getGLAttachmentPoint(i);n.framebufferRenderbuffer(Oo.FRAMEBUFFER,s,n.RENDERBUFFER,e.glName)}(r=this._depthBuffer)==null||r.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const i=this._context.gl,r=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(Oo.FRAMEBUFFER,r,i.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,i,r,n,s,o,a){(e<0||i<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==Cn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+r>this.width||i+n>this.height||s+r>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Wt.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Wt.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(Cn.TEXTURE_2D,0,s,o,e,i,r,n),c.bindTexture(u,Wt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,i,r,n,s,o,a){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,i,r,n,s,o,a)}async readPixelsAsync(e,i,r,n,s,o,a){if(this._context.type!==xi.WEBGL2)return hh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,i,r,n,s,o,a);const l=this._context.gl,c=Ki.createPixelPack(this._context,zi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,i,r,n,s,o,0),this._context.unbindBuffer(zt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,i){var n,s,o;if(this.width===e&&this.height===i)return;const r={width:e,height:i};I1(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(a=>a.resize(r.width,r.height)),(n=this._depthStencilTexture)==null||n.resize(r.width,r.height),this._initialized&&(I1(r,this._context.parameters.maxRenderbufferSize),(s=this._depthBuffer)==null||s.resize(r.width,r.height),(o=this._stencilBuffer)==null||o.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Oo.FRAMEBUFFER){const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(e,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=i.createFramebuffer();i.bindFramebuffer(e,r),this._colorAttachments.forEach((s,o)=>this._framebufferTexture2D(s.glName,o,YJ(s),e));const n=this._depthBuffer||this._stencilBuffer;if(n){const s=this._getGLAttachmentPoint(n.descriptor);i.framebufferRenderbuffer(e,s,i.RENDERBUFFER,n.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,YJ(this._depthStencilTexture),e);hh()&&i.checkFramebufferStatus(e)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,i=Qc.COLOR_ATTACHMENT0,r=Cn.TEXTURE_2D,n=Oo.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,i,r,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const i=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(Oo.FRAMEBUFFER,i,e.RENDERBUFFER,null)}this._depthBuffer=et(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(Oo.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=et(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=et(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==Cn.TEXTURE_2D&&e.target!==Cn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),I1(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){I1(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case hs.DEPTH_COMPONENT16:case hs.DEPTH_COMPONENT24:case hs.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case hs.DEPTH24_STENCIL8:case hs.DEPTH32F_STENCIL8:case hs.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case hs.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(Jx._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const n=this._context.gl;Jx._MAX_COLOR_ATTACHMENTS=n.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Jx._MAX_COLOR_ATTACHMENTS=1}const i=e-Qc.COLOR_ATTACHMENT0;i+1>Jx._MAX_COLOR_ATTACHMENTS&&ye.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Jx._MAX_COLOR_ATTACHMENTS} color attachments`)}};function $I(t){return t!=null&&"type"in t&&t.type===py.Texture}function uke(t){return t!=null&&"type"in t&&t.type===py.RenderBuffer}function hke(t){return $I(t)||t!=null&&"pixelFormat"in t}function I1(t,e){const i=Math.max(t.width,t.height);if(i>e){cke.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const r=e/i;return t.width=Math.round(t.width*r),t.height=Math.round(t.height*r),!1}return!0}function YJ(t){return t.descriptor.target===Cn.TEXTURE_CUBE_MAP?Cn.TEXTURE_CUBE_MAP_POSITIVE_X:Cn.TEXTURE_2D}Rs._MAX_COLOR_ATTACHMENTS=-1;let XE=class extends ke{constructor(e){super(e),this._needsRender=!0,this._passParameters=new wme,this._frameBuffer=new Rs(e.context.renderContext.rctx,new Di(J_)),this._vao=Fl(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(uu.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(uu.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Is(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=nn(this._fullTechniqueCached),this._weatherMapTechniqueCached=nn(this._weatherMapTechniqueCached),this._frameBuffer=et(this._frameBuffer),this._vao=et(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new fB;e.mode=uu.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(mB,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new fB;e.mode=uu.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(mB,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const i=e===uu.Full?this._fullTechnique:this._weatherMapTechnique,r=this.context.renderContext.rctx,n=r.getViewport();r.setViewport(0,0,J_,J_),r.bindFramebuffer(this._frameBuffer);const s=r.bindTechnique(i,this._passParameters,null);return r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};d([m({constructOnly:!0})],XE.prototype,"context",void 0),d([m({readOnly:!0})],XE.prototype,"_techniqueRepository",null),XE=d([J("esri.views.3d.environment.NoiseTextureAtlas")],XE);function Tme(t){t.include(Eu),t.uniforms.add(new vt("geometryDepthTexture",(e,i)=>i.multipassGeometry.linearDepthTexture),new Bi("nearFar",(e,i)=>i.camera.nearFar)),t.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let dke=class{constructor(){this.enabled=!1}};function Au(t,e){e.hasMultipassTerrain&&(t.fragment.include(Eu),t.fragment.uniforms.add(new vt("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Bi("nearFar",(i,r)=>r.camera.nearFar)),t.fragment.uniforms.add(new Bi("inverseViewport",(i,r)=>r.inverseViewport)),t.fragment.code.add(T`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let pke=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function fke(t,e){const i=t.fragment;i.include(Eu),i.uniforms.add(new Bi("nearFar",(r,n)=>n.camera.nearFar)),i.uniforms.add(new vt("depthMap",(r,n)=>n.linearDepthTexture)),i.uniforms.add(new en("proj",(r,n)=>n.ssr.camera.projectionMatrix)),i.uniforms.add(new je("invResolutionHeight",(r,n)=>1/n.ssr.camera.height)),i.uniforms.add(new en("reprojectionMatrix",(r,n)=>n.ssr.reprojectionMatrix)),i.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let mke=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=Ne()}};function t4(t){return t?{ray:ho(t.ray),c0:t.c0,c1:t.c1}:{ray:ho(),c0:0,c1:Number.MAX_VALUE}}function gke(t,e=t4()){return uD(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function _ke(t,e,i=t4()){const r=ze(t.vector);return Yde(t.origin,e,i.ray),i.c0=0,i.c1=r,i}function xvt(t,e){return Sme(t,t.c0,e)}function Tvt(t,e){return Sme(t,t.c1,e)}function Sme(t,e,i){return xe(i,t.ray.origin,pe(i,t.ray.direction,e))}new Vg(()=>t4());function HP(t){return t?[Yi(t[0]),Yi(t[1]),Yi(t[2]),Yi(t[3]),Yi(t[4]),Yi(t[5])]:[Yi(),Yi(),Yi(),Yi(),Yi(),Yi()]}function Cme(){return[I(),I(),I(),I(),I(),I(),I(),I()]}function CD(t,e){for(let i=0;i<yS;i++)V5(t[i],e[i])}function Eme(t,e,i,r=Tke){const n=Cr(Xj.get(),e,t);fo(n,n);for(let s=0;s<wke;++s){const o=hu(Zj.get(),xke[s],n);me(r[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Ame(i,r)}function Ame(t,e){ya(e[gt.FAR_BOTTOM_LEFT],e[gt.NEAR_BOTTOM_LEFT],e[gt.NEAR_TOP_LEFT],t[Lr.LEFT]),ya(e[gt.NEAR_BOTTOM_RIGHT],e[gt.FAR_BOTTOM_RIGHT],e[gt.FAR_TOP_RIGHT],t[Lr.RIGHT]),ya(e[gt.FAR_BOTTOM_LEFT],e[gt.FAR_BOTTOM_RIGHT],e[gt.NEAR_BOTTOM_RIGHT],t[Lr.BOTTOM]),ya(e[gt.NEAR_TOP_LEFT],e[gt.NEAR_TOP_RIGHT],e[gt.FAR_TOP_RIGHT],t[Lr.TOP]),ya(e[gt.NEAR_BOTTOM_LEFT],e[gt.NEAR_BOTTOM_RIGHT],e[gt.NEAR_TOP_RIGHT],t[Lr.NEAR]),ya(e[gt.FAR_BOTTOM_RIGHT],e[gt.FAR_BOTTOM_LEFT],e[gt.FAR_TOP_LEFT],t[Lr.FAR])}function j_(t,e){for(let i=0;i<yS;i++){const r=t[i];if(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]>=e[3])return!1}return!0}function yke(t,e){return Ome(t,gke(e,Rme.get()))}function Svt(t,e){for(let i=0;i<yS;i++){const r=t[i];if(!zLe(r,e))return!1}return!0}function vke(t,e,i){return Ome(t,_ke(e,i,Rme.get()))}function Pme(t,e){for(let i=0;i<yS;i++)if(Dr(t[i],e)>0)return!1;return!0}function Ome(t,e){for(let i=0;i<yS;i++)if(!ULe(t[i],e))return!1;return!0}var Lr,gt;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Lr||(Lr={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(gt||(gt={}));const bke={bottom:[gt.FAR_BOTTOM_RIGHT,gt.NEAR_BOTTOM_RIGHT,gt.NEAR_BOTTOM_LEFT,gt.FAR_BOTTOM_LEFT],near:[gt.NEAR_BOTTOM_LEFT,gt.NEAR_BOTTOM_RIGHT,gt.NEAR_TOP_RIGHT,gt.NEAR_TOP_LEFT],far:[gt.FAR_BOTTOM_RIGHT,gt.FAR_BOTTOM_LEFT,gt.FAR_TOP_LEFT,gt.FAR_TOP_RIGHT],right:[gt.NEAR_BOTTOM_RIGHT,gt.FAR_BOTTOM_RIGHT,gt.FAR_TOP_RIGHT,gt.NEAR_TOP_RIGHT],left:[gt.FAR_BOTTOM_LEFT,gt.NEAR_BOTTOM_LEFT,gt.NEAR_TOP_LEFT,gt.FAR_TOP_LEFT],top:[gt.FAR_TOP_LEFT,gt.NEAR_TOP_LEFT,gt.NEAR_TOP_RIGHT,gt.FAR_TOP_RIGHT]},yS=6,wke=8,xke=[Kt(-1,-1,-1,1),Kt(1,-1,-1,1),Kt(1,1,-1,1),Kt(-1,1,-1,1),Kt(-1,-1,1,1),Kt(1,-1,1,1),Kt(1,1,1,1),Kt(-1,1,1,1)],Rme=new Vg(t4),Tke=Cme();function Ske(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}function Cke(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}function Eke(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}function Ake(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}var gB;let It=gB=class extends ke{constructor(t={}){super(t),this._center=I(),this._up=I(),this._viewUp=I(),this._viewForward=I(),this._viewRight=I(),this._ray=ho(),this._viewport=Kt(0,0,1,1),this._padding=Kt(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Ri(1,1e3),this._viewDirty=!0,this._viewMatrix=Ne(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Ne(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Ne(),this._frustumDirty=!0,this._frustum=HP(),this._fullViewport=gi(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return Ce(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Qn(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=ib(gi(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&LL(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=ib(gi(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&LL(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[fi.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[fi.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[fi.RIGHT]+this._padding[fi.LEFT]}set fullWidth(t){this.width=t-(this._padding[fi.RIGHT]+this._padding[fi.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[fi.TOP]+this._padding[fi.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[fi.TOP]+this._padding[fi.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[fi.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[fi.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){k2(this._padding,t)||(this._viewport[0]+=t[fi.LEFT]-this._padding[fi.LEFT],this._viewport[1]+=t[fi.BOTTOM]-this._padding[fi.BOTTOM],this._viewport[2]-=t[fi.RIGHT]+t[fi.LEFT]-(this._padding[fi.RIGHT]+this._padding[fi.LEFT]),this._viewport[3]-=t[fi.TOP]+t[fi.BOTTOM]-(this._padding[fi.TOP]+this._padding[fi.BOTTOM]),Ah(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Cr(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,n=Jhe(Ne(),-r*(1+2*this._padding[fi.LEFT]/t),r*(1+2*this._padding[fi.RIGHT]/t),-i*(1+2*this._padding[fi.BOTTOM]/e),i*(1+2*this._padding[fi.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&Fj(s,n)?s:n}get inverseProjectionMatrix(){return fo(Ne(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Ne()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return Eke(this._fov,this.width,this.height)}set fovX(t){this._fov=Ske(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return Ake(this._fov,this.width,this.height)}set fovY(t){this._fov=Cke(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Nr(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(fo(this._viewInverseTransposeMatrix,this.viewMatrix),Cc(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){fe(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Ah(this._viewport,t.viewport),this.notifyChange("_viewport"),Ah(this._padding,t.padding),this.notifyChange("_padding"),Is(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Qn(this._viewMatrix,t.viewMatrix),fe(this._viewRight,t.viewRight),fe(this._viewUp,t.viewUp),fe(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(CD(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Qn(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Ah(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new gB().copyFrom(this)}equals(t){return xa(this.eye,t.eye)&&xa(this.center,t.center)&&xa(this.up,t.up)&&k2(this._viewport,t.viewport)&&k2(this._padding,t.padding)&&Dfe(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||IL(t.screenPadding,this.screenPadding)>=1||IL(this.screenViewport,t.screenViewport)>=1)return!1;uo(aa,t.eye,t.center),uo(P6,this.eye,this.center);const e=Re(aa,P6),i=M8(aa),r=M8(P6),n=5e-4;return e*e>=(1-1e-10)*i*r&&n5(t.eye,this.eye)<Math.max(i,r)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(FA(this.viewForward,Ce(aa,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=fn()){return t[0]=(this.padding[fi.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[fi.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,i=.5){return t[0]=this.padding[fi.LEFT]+this.width*e,t[1]=this.padding[fi.BOTTOM]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==pi&&fe(pi,t),pi[3]=1,hu(pi,pi,this.projectionMatrix);const i=Math.abs(pi[3]);pe(pi,pi,1/i);const r=this.fullViewport;e[0]=Bt(0,r[0]+r[2],.5+.5*pi[0]),e[1]=Bt(0,r[1]+r[3],.5+.5*pi[1]),e[2]=.5*(pi[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;pi[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],pi[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],pi[2]=(2*t[2]-1)*t[3],pi[3]=t[3],this.inverseProjectionMatrix!=null&&(hu(pi,pi,this.inverseProjectionMatrix),e[0]=pi[0],e[1]=pi[1],e[2]=pi[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,O6),this.renderToScreen(O6,e),e}projectToRenderScreen(t,e){if(pi[0]=t[0],pi[1]=t[1],pi[2]=t[2],pi[3]=1,hu(pi,pi,this.viewProjectionMatrix),pi[3]===0)return null;pe(pi,pi,1/Math.abs(pi[3]));const i=this.fullViewport;return"x"in e?(e.x=Bt(0,i[0]+i[2],.5+.5*pi[0]),e.y=Bt(0,i[1]+i[3],.5+.5*pi[1])):(e[0]=Bt(0,i[0]+i[2],.5+.5*pi[0]),e[1]=Bt(0,i[1]+i[3],.5+.5*pi[1]),e.length>2&&(e[2]=.5*(pi[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,O6),e)}unprojectFromRenderScreen(t,e){if(Cr(kR,this.projectionMatrix,this.viewMatrix),!fo(kR,kR))return null;const i=this.fullViewport;return pi[0]=2*(t[0]-i[0])/i[2]-1,pi[1]=2*(t[1]-i[1])/i[3]-1,pi[2]=2*t[2]-1,pi[3]=1,hu(pi,pi,kR),pi[3]===0?null:(e[0]=pi[0]/pi[3],e[1]=pi[1]/pi[3],e[2]=pi[2]/pi[3],e)}constrainWindowSize(t,e,i,r){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0);return[o,a,i-l- -Math.min(this.fullWidth-n-i/2,0),r-c- -Math.min(s-r/2,0)]}computeUp(t){t===Ke.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,r=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=r,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,r=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=r}_computeUpGlobal(){Ce(aa,this.center,this.eye);const t=ze(this.center);t<1?(me(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(Re(aa,this.center))>.9999*ze(aa)*t||(Rt(this._up,aa,this.center),Rt(this._up,this._up,aa),Me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){zg(aa,this.eye,this.center),Math.abs(aa[2])<=.9999&&(pe(aa,aa,aa[2]),me(this._up,-aa[0],-aa[1],1-aa[2]),Me(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,i=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?xa(t,e)||(fe(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):ye.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Eme(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(I5(this._viewMatrix,this.eye,this.center,this.up),me(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),me(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),me(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([m()],It.prototype,"_center",void 0),d([m()],It.prototype,"_up",void 0),d([m()],It.prototype,"_viewport",void 0),d([m()],It.prototype,"_padding",void 0),d([m()],It.prototype,"_fov",void 0),d([m()],It.prototype,"_nearFar",void 0),d([m()],It.prototype,"_pixelRatio",void 0),d([m()],It.prototype,"pixelRatio",null),d([m()],It.prototype,"eye",null),d([m()],It.prototype,"center",null),d([m()],It.prototype,"up",null),d([m({readOnly:!0})],It.prototype,"nearFar",null),d([m()],It.prototype,"near",null),d([m()],It.prototype,"far",null),d([m()],It.prototype,"viewport",null),d([m({readOnly:!0})],It.prototype,"screenViewport",null),d([m({readOnly:!0})],It.prototype,"screenPadding",null),d([m()],It.prototype,"x",null),d([m()],It.prototype,"y",null),d([m()],It.prototype,"width",null),d([m()],It.prototype,"height",null),d([m()],It.prototype,"fullWidth",null),d([m()],It.prototype,"fullHeight",null),d([m({readOnly:!0})],It.prototype,"_aspect",null),d([m()],It.prototype,"padding",null),d([m({readOnly:!0})],It.prototype,"projectionMatrix",null),d([m({readOnly:!0})],It.prototype,"inverseProjectionMatrix",null),d([m()],It.prototype,"fov",null),d([m()],It.prototype,"fovX",null),d([m()],It.prototype,"fovY",null),It=gB=d([J("esri.views.3d.webgl-engine.lib.Camera")],It);const pi=gi(),kR=Ne(),aa=I(),P6=I(),O6=ta();var fi;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(fi||(fi={}));var Te;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(Te||(Te={}));var At;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(At||(At={}));let UH=class{constructor(e=I()){this.intensity=e}},Mme=class{constructor(e=I(),i=Ge(.57735,.57735,.57735)){this.intensity=e,this.direction=i}},ED=class{constructor(e=I(),i=Ge(.57735,.57735,.57735),r=!0,n=1,s=1){this.intensity=e,this.direction=i,this.castShadows=r,this.specularStrength=n,this.environmentStrength=s}},$me=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function Pke(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e[r];return i}function R6(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]*e;return i}function G2(t,e,i){(i=i||t).length=t.length;for(let r=0;r<t.length;r++)i[r]=t[r]+e[r];return i}function Ime(t){return(t+1)*(t+1)}function Oke(t){return $e(Math.floor(Math.sqrt(t)-1),0,2)}function Lme(t,e,i){const r=t[0],n=t[1],s=t[2],o=i||[];return o.length=Ime(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*r*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*r*s,o[8]=.54627421529*(r*r-n*n)),o}function Rke(t,e){const i=Ime(t),r=e||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let n=0;n<i;n++)r.r[n]=r.g[n]=r.b[n]=0;return r}function Mke(t,e){const i=Oke(e.r.length);for(const r of t)Ea(_B,r.direction),Lme(_B,i,ag),Pke(ag,II),R6(ag,r.intensity[0],Mw),G2(e.r,Mw),R6(ag,r.intensity[1],Mw),G2(e.g,Mw),R6(ag,r.intensity[2],Mw),G2(e.b,Mw);return e}function $ke(t,e){Lme(_B,0,ag);for(const i of t)e.r[0]+=ag[0]*II[0]*i.intensity[0]*4*Math.PI,e.g[0]+=ag[0]*II[0]*i.intensity[1]*4*Math.PI,e.b[0]+=ag[0]*II[0]*i.intensity[2]*4*Math.PI;return e}function Ike(t,e,i,r){Rke(e,r),me(i.intensity,0,0,0);let n=!1;const s=Lke,o=Dke,a=Nke;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof ED&&!n?(fe(i.direction,l.direction),fe(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,n=!0):l instanceof ED||l instanceof Mme?s.push(l):l instanceof UH?o.push(l):l instanceof $me&&a.push(l);Mke(s,r),$ke(o,r);for(const l of a)G2(r.r,l.r),G2(r.g,l.g),G2(r.b,l.b)}const Lke=[],Dke=[],Nke=[],ag=[0],Mw=[0],_B=I(),II=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let JJ=class{constructor(){this.color=I(),this.intensity=1}},Fke=class{constructor(){this.direction=I(),this.ambient=new JJ,this.diffuse=new JJ}};const Dme=.4;let M6=class{constructor(){this._shOrder=2,this._legacy=new Fke,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new $me,this._mainLight=new ED(I(),Ge(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){Ike(e,this._shOrder,this._mainLight,this._sphericalHarmonics),fe(this._legacy.direction,this._mainLight.direction);const i=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,pe(this._legacy.diffuse.color,this._mainLight.intensity,i),fe(UR,this._legacy.diffuse.color),pe(UR,UR,Dme*this.globalFactor),xe(this._legacy.ambient.color,this._legacy.ambient.color,UR)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),fe(this._mainLight.direction,e.mainLight.direction),fe(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,r){if(pr(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,r),this._mainLight.environmentStrength=Bt(e.mainLight.environmentStrength,i.mainLight.environmentStrength,r),this._mainLight.specularStrength=Bt(e.mainLight.specularStrength,i.mainLight.specularStrength,r),fe(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=Bt(e.globalFactor,i.globalFactor,r),this.noonFactor=Bt(e.noonFactor,i.noonFactor,r),e.sh.r.length===i.sh.r.length)for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=Bt(e.sh.r[n],i.sh.r[n],r),this._sphericalHarmonics.g[n]=Bt(e.sh.g[n],i.sh.g[n],r),this._sphericalHarmonics.b[n]=Bt(e.sh.b[n],i.sh.b[n],r);else for(let n=0;n<i.sh.r.length;n++)this._sphericalHarmonics.r[n]=i.sh.r[n],this._sphericalHarmonics.g[n]=i.sh.g[n],this._sphericalHarmonics.b[n]=i.sh.b[n]}};const UR=I();let i4=class{constructor(e,i,r){this.shadowMap=e,this.ssaoHelper=i,this.slicePlane=r,this.slot=Te.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=At.NONE,this.alignPixelEnabled=!1,this._camera=new It,this._inverseViewport=it(),this.oldLighting=new M6,this.newLighting=new M6,this._fadedLighting=new M6,this._lighting=this.newLighting,this.ssr=new mke,this.multipassTerrain=new pke,this.multipassGeometry=new dke,this.overlays=[],this.cloudsFade=new S6e}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:i,newLighting:r}=this;e>=1?this._lighting=r:(this._fadedLighting.lerpLighting(i,r,e),this._lighting=this._fadedLighting)}},bl=class extends ke{constructor(e){super(e),this._handles=new an,this._techniques=new Array,this._techniqueConfiguration=new MI,this._bindParameters=new i4(null,null,null),this._passParameters=new _me,this._drawParameters=new yme,this._weatherTile=it(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Bt(pa.default.coverage[0],pa.default.coverage[1],.5),this.density=Bt(pa.default.density[0],pa.default.density[1],.5),this.absorption=Bt(pa.default.absorption[0],pa.default.absorption[1],.5),this.cloudSize=Bt(pa.default.cloudSize[0],pa.default.cloudSize[1],.5),this.detailSize=Bt(pa.default.detailSize[0],pa.default.detailSize[1],.5),this.smoothness=Bt(pa.default.smoothness[0],pa.default.smoothness[1],.5),this.cloudHeight=Bt(pa.default.cloudHeight[0],pa.default.cloudHeight[1],.5),this.raymarchingSteps=pa.default.raymarchingSteps,this._viewMatrix=Ne(),this._dirty=!1,this.running=!1,this._vao=Fl(e.context.renderContext.rctx)}_getTechnique(e){const i=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,r=i===xb.RG?2*e:2*e+1;return this._techniques[r]||(this._techniqueConfiguration.writeTextureChannels=i,this._techniqueConfiguration.steps=e,this._techniques[r]=new vme({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[r])}updateWeatherTile(){const e=this.view.camera.position.latitude,i=this.view.camera.position.longitude;if(e==null||i==null)return;bi(this._weatherTile,(e+90)/180,(i+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-r)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),Nfe(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=lr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(Dt.CLOUDS_GENERATOR,this),Pe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),ar)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>nn(e)),this._frameBufferCube=et(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=Je(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case Rl.SIXTEEN:return 1;case Rl.HUNDRED:return 4;case Rl.COUNT:case Rl.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new XE({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const i=new Di(e);i.target=Cn.TEXTURE_CUBE_MAP,i.wrapMode=Jt.CLAMP_TO_EDGE,this._frameBufferCube=new Rs(this.context.renderContext.rctx,i)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=et(this._frameBufferCube)}applyPreset(e,i){const r=e.median,n=s=>{const o=Bt(s[0],s[1],r);return i<.5?Bt(s[0],o,2*i):Bt(o,s[1],2*(i-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Is(this._passParameters.weatherTile,this._weatherTile));const i=this._getTechnique(this._passParameters.raymarchingSteps);if(!i.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return na.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=Zn.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const r=this.context.renderContext.rctx,n=r.bindTechnique(i,this._passParameters,this._bindParameters);r.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=r.getViewport(),o=i.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;r.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);r.bindFramebuffer(c);const u=kke[this._faceIndex],p=Uke[this._faceIndex];Qhe(this._viewMatrix,zke,u,p),jh(this._drawParameters.viewMatrix,this._viewMatrix);const f=Cn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush(),r.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=Zn.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),na.YIELD}};d([m({constructOnly:!0})],bl.prototype,"context",void 0),d([m({constructOnly:!0})],bl.prototype,"view",void 0),d([m({constructOnly:!0})],bl.prototype,"requestRender",void 0),d([m()],bl.prototype,"coverage",void 0),d([m()],bl.prototype,"density",void 0),d([m()],bl.prototype,"absorption",void 0),d([m()],bl.prototype,"cloudSize",void 0),d([m()],bl.prototype,"detailSize",void 0),d([m()],bl.prototype,"smoothness",void 0),d([m()],bl.prototype,"cloudHeight",void 0),d([m()],bl.prototype,"raymarchingSteps",void 0),d([m()],bl.prototype,"running",void 0),bl=d([J("esri.views.3d.environment.CloudsGenerator")],bl);const kke=[mr(1,0,0),mr(-1,0,0),mr(0,1,0),mr(0,-1,0),mr(0,0,1)],Uke=[mr(0,1,0),mr(0,1,0),mr(0,0,-1),mr(0,0,1),mr(0,1,0)],zke=kH();let Nme=class extends wr{constructor(){super(...arguments),this.fogColor=I(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function Bke(){const t=new Fi;t.attributes.add(M.POSITION,"vec2"),t.include(Ff,{textureCoordinateType:Yn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:i}=t;return e.uniforms.add(new en("inverseProjectionMatrix",(r,n)=>n.camera.inverseProjectionMatrix),new en("inverseViewMatrix",(r,n)=>dS(Vke,n.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new je("atmosphereC",r=>r.atmosphereC),new ei("cameraPosition",(r,n)=>n.camera.eye),new Bi("nearFar",(r,n)=>n.camera.nearFar),new vt("depthTexture",r=>r.depthTexture),new je("fogStrength",r=>r.fogStrength),new je("fogAmount",r=>r.fogAmount),new ei("fogColor",r=>r.fogColor)),t.include(Q5),i.include(Eu),i.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),i.code.add(T`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const Vke=Ne(),Gke=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:Nme,build:Bke},Symbol.toStringTag,{value:"Module"}));let Fme=class kme extends qi{constructor(e){super(e,new Oa,()=>this.destroy())}initializeProgram(e){return new Gi(e.rctx,kme.shader.get().build(),Ni)}initializePipeline(){return Zt({blending:Fo(De.SRC_ALPHA,De.ZERO,De.ONE_MINUS_SRC_ALPHA,De.ONE),colorWrite:ni})}};Fme.shader=new Vi(Gke,()=>Oe(()=>import("./Fog.glsl-2b25a02c.js"),[],import.meta.url));const jke=.95,Hke=1;let Jv=class extends ke{constructor(e){super(e),this._passParameters=new Nme;const i=e.context.renderContext.rctx;this._vao=Fl(i,H3),this._technique=new Fme(e);const r=lr(e.view.spatialReference);this._planetRadius=r.radius,this._atmosphereRadius=r.radius+__}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,i){if(this._update(e,i),this._passParameters.fogAmount<=0)return;const r=this._technique;if(!r.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,i){const r=i.rctx;r.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Ht.TRIANGLE_STRIP,0,4)}_update(e,i){const r=e.bindParameters.camera;Me(KJ,r.eye);const n=Math.max(0,Re(KJ,e.bindParameters.lighting.mainLight.direction)),s=i.color;pe(QJ,s,.1),pr(this._passParameters.fogColor,QJ,s,n);const o=ze(r.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-wP(jke*yf,Hke*yf,Math.abs(o-this._planetRadius)))*i.amount,this._passParameters.fogStrength=i.strength}static isSupported(e){return e.capabilities.depthTexture}};d([m({constructOnly:!0})],Jv.prototype,"context",void 0),d([m({constructOnly:!0})],Jv.prototype,"view",void 0),d([m({constructOnly:!0})],Jv.prototype,"rctx",void 0),d([m({constructOnly:!0})],Jv.prototype,"viewingMode",void 0),Jv=d([J("esri.views.3d.environment.Fog")],Jv);let Wke=class{constructor(){this.color=I(),this.strength=0,this.amount=0}};const KJ=I(),QJ=I();let Ko=class extends Oa{};d([q({constValue:!0})],Ko.prototype,"hasSliceHighlight",void 0),d([q({constValue:!1})],Ko.prototype,"hasSliceInVertexProgram",void 0),d([q({constValue:!1})],Ko.prototype,"instancedDoublePrecision",void 0),d([q({constValue:!1})],Ko.prototype,"hasModelTransformation",void 0),d([q({constValue:vr.Pass})],Ko.prototype,"pbrTextureBindType",void 0);var Xf;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(Xf||(Xf={}));let zH=class extends Ko{constructor(){super(...arguments),this.geometry=Xf.Cone}};d([q({count:Xf.COUNT})],zH.prototype,"geometry",void 0);var j;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(j||(j={}));function q3(t){t.attributes.add(M.POSITION,"vec3"),t.vertex.code.add(T`vec3 positionModel() { return position; }`)}function AD({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let Jh=class extends On{constructor(e,i){super(e,"mat3",vr.Pass,(r,n,s)=>r.setUniformMatrix3fv(e,i(n,s)))}};function j2(t,e){t.include(q3);const i=t.vertex;i.include(AD,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),i.uniforms.add(new ei("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new ei("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Jh("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new en("transformProjFromView",r=>r.transformProjFromView),new jP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new yu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new yu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)),i.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(T`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?T`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:T`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new ei("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let Ume=class extends wr{constructor(){super(...arguments),this.transformWorldFromViewTH=I(),this.transformWorldFromViewTL=I(),this.transformViewFromCameraRelativeRS=on(),this.transformProjFromView=Ne()}},zme=class extends wr{constructor(){super(...arguments),this.transformWorldFromModelRS=on(),this.transformWorldFromModelTH=I(),this.transformWorldFromModelTL=I()}};function gy(t){t.varyings.add("linearDepth","float")}function Tb(t){t.vertex.uniforms.add(new Bi("nearFar",(e,i)=>i.camera.nearFar))}function r4(t){t.vertex.code.add(T`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function vS(t,e){const{vertex:i}=t;switch(e.output){case j.Color:if(e.receiveShadows)return gy(t),void i.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case j.Depth:case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:return t.include(j2,e),gy(t),Tb(t),r4(t),void i.code.add(T`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}i.code.add(T`void forwardLinearDepth() {}`)}function Ml(t){r4(t),t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let BH=class extends wr{constructor(){super(...arguments),this.texV=it(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new Bme}},Bme=class{constructor(){this.center=I(),this.v1=I(),this.v2=I()}};function qke(t){const e=new Fi,{vertex:i,fragment:r}=e;if(jg(i),t.geometry===Xf.Underground)e.attributes.add(M.POSITION,"vec2"),e.varyings.add("color","vec4"),i.uniforms.add(new ei("cameraPosition",(n,s)=>s.camera.eye),new je("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),i.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(T`void main() {
fragColor = color;
}`);else{e.include(Ml,t),e.attributes.add(M.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===Xf.Cylinder;i.uniforms.add(new en("proj",(a,l)=>l.camera.projectionMatrix),new en("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),i.uniforms.add(new ei("silCircleCenter",a=>a.silhouette.center)),i.uniforms.add(new ei("silCircleV1",a=>a.silhouette.v1)),i.uniforms.add(new ei("silCircleV2",a=>a.silhouette.v2)),i.uniforms.add(new Bi("texV",a=>a.texV)),i.uniforms.add(new je("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;i.code.add(T`
		void main(void) {
      ${n?T`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new vt("tex",a=>a.texture)),n||r.uniforms.add(new je("altitudeFade",a=>a.altitudeFade)),r.code.add(T`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?T`fragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const Zke=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:Bme,SimpleAtmospherePassParameters:BH,build:qke},Symbol.toStringTag,{value:"Module"}));let PD=class Vme extends qi{initializeProgram(e){return new Gi(e.rctx,Vme.shader.get().build(this.configuration),Ni)}initializePipeline(){return this.configuration.geometry===Xf.Cylinder?Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),culling:xH,depthTest:{func:br.LEQUAL},colorWrite:ni}):Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ni})}};PD.shader=new Vi(Zke,()=>Oe(()=>import("./SimpleAtmosphere.glsl-d77ed82a.js"),[],import.meta.url));const Xke=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Pc(t,e=0){const i=t.stride;return Array.from(t.fields.keys()).filter(r=>{var s;const n=(s=t.fields.get(r))==null?void 0:s.optional;return!(n&&n.glPadding)}).map(r=>{const n=t.fields.get(r),s=n.constructor.ElementCount,o=Yke(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new Lo(r,s,o,a,i,l,e)})}function Yke(t){const e=Jke[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const Jke={u8:bt.UNSIGNED_BYTE,u16:bt.UNSIGNED_SHORT,u32:bt.UNSIGNED_INT,i8:bt.BYTE,i16:bt.SHORT,i32:bt.INT,f32:bt.FLOAT};let VH=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};VH.ElementCount=9;let GH=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)i[n]=this.typedBuffer[r++];return i}setMat(e,i){let r=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[r++]=i[n]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};GH.ElementCount=16;let qg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,i){this.typedBuffer[e*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}};qg.ElementCount=1;let Zg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,bi(i,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e]=i[1]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e]=r}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Zg.ElementCount=2;let Xg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,me(i,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e]=i[2]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e]=n}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Xg.ElementCount=3;let Yg=class{constructor(e,i,r=0,n,s){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=s==null?new o(i,a):new o(i,a,(s-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,i,r=this.count-i){const n=this.typedBuffer.byteOffset+i*this.stride;return new e(this.buffer,n,this.stride,n+r*this.stride)}getVec(e,i){return e*=this.typedBufferStride,Br(i,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,i){e*=this.typedBufferStride,this.typedBuffer[e++]=i[0],this.typedBuffer[e++]=i[1],this.typedBuffer[e++]=i[2],this.typedBuffer[e]=i[3]}get(e,i){return this.typedBuffer[e*this.typedBufferStride+i]}set(e,i,r){this.typedBuffer[e*this.typedBufferStride+i]=r}setValues(e,i,r,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=i,this.typedBuffer[e++]=r,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,i,r){const n=this.typedBuffer,s=i.typedBuffer;let o=e*this.typedBufferStride,a=r*i.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};Yg.ElementCount=4;let n4=class Gme extends qg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}static fromTypedArray(e,i){return new Gme(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};n4.ElementType="f32";let Iy=class yB extends Zg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(yB,e,i)}static fromTypedArray(e,i){return new yB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Iy.ElementType="f32";let Ms=class vB extends Xg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(vB,e,i)}static fromTypedArray(e,i){return new vB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Ms.ElementType="f32";let mp=class bB extends Yg{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(bB,e,i)}static fromTypedArray(e,i){return new bB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};mp.ElementType="f32";let _y=class wB extends VH{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(wB,e,i)}static fromTypedArray(e,i){return new wB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};_y.ElementType="f32";let jH=class xB extends VH{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(xB,e,i)}static fromTypedArray(e,i){return new xB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};jH.ElementType="f64";let HH=class TB extends GH{constructor(e,i=0,r,n){super(Float32Array,e,i,r,n),this.elementType="f32"}slice(e,i){return this.sliceBuffer(TB,e,i)}static fromTypedArray(e,i){return new TB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};HH.ElementType="f32";let WP=class SB extends GH{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(SB,e,i)}static fromTypedArray(e,i){return new SB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};WP.ElementType="f64";let WH=class CB extends qg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(CB,e,i)}static fromTypedArray(e,i){return new CB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};WH.ElementType="f64";let qH=class EB extends Zg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(EB,e,i)}static fromTypedArray(e,i){return new EB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};qH.ElementType="f64";let Wh=class AB extends Xg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(AB,e,i)}static fromTypedArray(e,i){return new AB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Wh.ElementType="f64";let s4=class PB extends Yg{constructor(e,i=0,r,n){super(Float64Array,e,i,r,n),this.elementType="f64"}slice(e,i){return this.sliceBuffer(PB,e,i)}static fromTypedArray(e,i){return new PB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};s4.ElementType="f64";let LT=class OB extends qg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(OB,e,i)}static fromTypedArray(e,i){return new OB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};LT.ElementType="u8";let o4=class RB extends Zg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(RB,e,i)}static fromTypedArray(e,i){return new RB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};o4.ElementType="u8";let a4=class MB extends Xg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer(MB,e,i)}static fromTypedArray(e,i){return new MB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};a4.ElementType="u8";let Aa=class $B extends Yg{constructor(e,i=0,r,n){super(Uint8Array,e,i,r,n),this.elementType="u8"}slice(e,i){return this.sliceBuffer($B,e,i)}static fromTypedArray(e,i){return new $B(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Aa.ElementType="u8";let l4=class IB extends qg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(IB,e,i)}static fromTypedArray(e,i){return new IB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};l4.ElementType="u16";let ZH=class LB extends Zg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(LB,e,i)}static fromTypedArray(e,i){return new LB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ZH.ElementType="u16";let c4=class DB extends Xg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(DB,e,i)}static fromTypedArray(e,i){return new DB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};c4.ElementType="u16";let Z3=class NB extends Yg{constructor(e,i=0,r,n){super(Uint16Array,e,i,r,n),this.elementType="u16"}slice(e,i){return this.sliceBuffer(NB,e,i)}static fromTypedArray(e,i){return new NB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Z3.ElementType="u16";let u4=class FB extends qg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(FB,e,i)}static fromTypedArray(e,i){return new FB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};u4.ElementType="u32";let XH=class kB extends Zg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(kB,e,i)}static fromTypedArray(e,i){return new kB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};XH.ElementType="u32";let jme=class UB extends Xg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(UB,e,i)}static fromTypedArray(e,i){return new UB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};jme.ElementType="u32";let Hme=class zB extends Yg{constructor(e,i=0,r,n){super(Uint32Array,e,i,r,n),this.elementType="u32"}slice(e,i){return this.sliceBuffer(zB,e,i)}static fromTypedArray(e,i){return new zB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Hme.ElementType="u32";let YH=class BB extends qg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(BB,e,i)}static fromTypedArray(e,i){return new BB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};YH.ElementType="i8";let h4=class VB extends Zg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(VB,e,i)}static fromTypedArray(e,i){return new VB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};h4.ElementType="i8";let Wme=class GB extends Xg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(GB,e,i)}static fromTypedArray(e,i){return new GB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Wme.ElementType="i8";let qme=class jB extends Yg{constructor(e,i=0,r,n){super(Int8Array,e,i,r,n),this.elementType="i8"}slice(e,i){return this.sliceBuffer(jB,e,i)}static fromTypedArray(e,i){return new jB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};qme.ElementType="i8";let Zme=class HB extends qg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(HB,e,i)}static fromTypedArray(e,i){return new HB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Zme.ElementType="i16";let X3=class WB extends Zg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(WB,e,i)}static fromTypedArray(e,i){return new WB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};X3.ElementType="i16";let Xme=class qB extends Xg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(qB,e,i)}static fromTypedArray(e,i){return new qB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Xme.ElementType="i16";let Yme=class ZB extends Yg{constructor(e,i=0,r,n){super(Int16Array,e,i,r,n),this.elementType="i16"}slice(e,i){return this.sliceBuffer(ZB,e,i)}static fromTypedArray(e,i){return new ZB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Yme.ElementType="i16";let Jme=class XB extends qg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(XB,e,i)}static fromTypedArray(e,i){return new XB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Jme.ElementType="i32";let Kme=class YB extends Zg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(YB,e,i)}static fromTypedArray(e,i){return new YB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Kme.ElementType="i32";let Qme=class JB extends Xg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(JB,e,i)}static fromTypedArray(e,i){return new JB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};Qme.ElementType="i32";let ege=class KB extends Yg{constructor(e,i=0,r,n){super(Int32Array,e,i,r,n),this.elementType="i32"}slice(e,i){return this.sliceBuffer(KB,e,i)}static fromTypedArray(e,i){return new KB(e.buffer,e.byteOffset,i,e.byteOffset+e.byteLength)}};ege.ElementType="i32";function eK(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let tK=class tge{constructor(e,i){this.layout=e,this.buffer=typeof i=="number"?new ArrayBuffer(i*e.stride):i;for(const r of e.fields.keys()){const n=e.fields.get(r);this[r]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,i){const r=this[e];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(e,i){return new tge(this.layout,this.buffer.slice(e*this.stride,i*this.stride))}copyFrom(e,i=0,r=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,i*s,n*s/4);new Uint32Array(this.buffer,r*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,i*s,n*s);new Uint8Array(this.buffer,r*s,n*s).set(o)}return this}},ige=class rge{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(i=>this._fields.set(i[0],{...i[1],constructor:eUe(i[1].constructor)})))}vec2f(e,i){return this._appendField(e,Iy,i),this}vec2f64(e,i){return this._appendField(e,qH,i),this}vec3f(e,i){return this._appendField(e,Ms,i),this}vec3f64(e,i){return this._appendField(e,Wh,i),this}vec4f(e,i){return this._appendField(e,mp,i),this}vec4f64(e,i){return this._appendField(e,s4,i),this}mat3f(e,i){return this._appendField(e,_y,i),this}mat3f64(e,i){return this._appendField(e,jH,i),this}mat4f(e,i){return this._appendField(e,HH,i),this}mat4f64(e,i){return this._appendField(e,WP,i),this}vec4u8(e,i){return this._appendField(e,Aa,i),this}f32(e,i){return this._appendField(e,n4,i),this}f64(e,i){return this._appendField(e,WH,i),this}u8(e,i){return this._appendField(e,LT,i),this}u16(e,i){return this._appendField(e,l4,i),this}i8(e,i){return this._appendField(e,YH,i),this}vec2i8(e,i){return this._appendField(e,h4,i),this}vec2i16(e,i){return this._appendField(e,X3,i),this}vec2u8(e,i){return this._appendField(e,o4,i),this}vec4u16(e,i){return this._appendField(e,Z3,i),this}u32(e,i){return this._appendField(e,u4,i),this}_appendField(e,i,r){if(this._fields.has(e))return void xt(!1,`${e} already added to vertex buffer layout`);const n=i.ElementCount*eK(i.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:i,offset:s,optional:r})}createBuffer(e){return new tK(this,e)}createView(e){return new tK(this,e)}clone(){const e=new rge;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((i,r)=>e._fields.set(r,i)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(i=>e=Math.max(e,eK(i.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function ln(){return new ige}let Kke=class{constructor(e){this.fields=new Array,e.fields.forEach((i,r)=>{const n={...i,constructor:nge(i.constructor)};this.fields.push([r,n])}),this.stride=e.stride}};const Qke=[n4,Iy,Ms,mp,_y,HH,WH,qH,Wh,s4,jH,WP,LT,o4,a4,Aa,l4,ZH,c4,Z3,u4,XH,jme,Hme,YH,h4,Wme,qme,Zme,X3,Xme,Yme,Jme,Kme,Qme,ege];function nge(t){return`${t.ElementType}_${t.ElementCount}`}function eUe(t){return sge.get(t)}const sge=new Map;Qke.forEach(t=>sge.set(nge(t),t));function ia(t,e=!1){return t<=xu?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function oge(t){return(cp(t)?t.length:t.byteLength/8)<=xu?Array.from(t):new Float64Array(t)}function Ih(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Jvt(t,e){for(let i=0;i<e.length;++i)t[i]=e[i];return t}function Kvt(t){return Array.isArray(t)?new Float64Array(t):t}function mn(t,e=!1){return t<=xu?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Qvt(t){return cp(t)?t.length<xu?t:new Float32Array(t):t.length<xu?Array.from(t):t}function iK(t){return(cp(t)?t.length:t.byteLength/8)<=xu?Array.from(t):new Float32Array(t)}function OD(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}function Uf(t){return cp(t)?t.length<xu?t:rK(t):t.length<xu?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:rK(t)}function rK(t){let e=!0;for(const i of t){if(i>=65536)return cp(t)?new Uint32Array(t):t;i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function RD(t){return t<=xu?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function tUe(t){return t<=xu?new Array(t):new Uint32Array(t)}let $w=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const age=[0],$6=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function DT(t){if(t===1)return age;if(t<xu)return Array.from(new Uint16Array($6.buffer,0,t));if(t<$6.length)return new Uint16Array($6.buffer,0,t);if(t>$w.length){const e=Math.max(2*$w.length,t);$w=new Uint32Array(e);for(let i=0;i<$w.length;i++)$w[i]=i}return new Uint32Array($w.buffer,0,t)}let zR=new Uint8Array(65536);function bS(t){if(t===1)return age;if(t<xu)return new Array(t).fill(0);if(t>zR.length){const e=Math.max(2*zR.length,t);zR=new Uint8Array(e)}return new Uint8Array(zR.buffer,0,t)}let nt=class{constructor(e,i,r=!1,n=i){this.data=e,this.size=i,this.exclusive=r,this.stride=n}};var QB;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function i(o,a){const l=o[a],c=o[a+1],u=o[a+2],p=1/Math.sqrt(l*l+c*c+u*u);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,u,p=a){(u=u||o)[p]=o[a]+l[c],u[p+1]=o[a+1]+l[c+1],u[p+2]=o[a+2]+l[c+2]}function s(o,a,l,c,u,p=a){(u=u||o)[p]=o[a]-l[c],u[p+1]=o[a+1]-l[c+1],u[p+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=i,t.scale=r,t.add=n,t.subtract=s})(QB||(QB={}));var An;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(An||(An={}));function iUe(t){if(t.length<xu)return Array.from(t);if(cp(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return ZN(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let lge=class cge{constructor(e,i,r,n){this.primitiveIndices=e,this._numIndexPerPrimitive=i,this.indices=r,this.position=n,this._children=void 0,xt(e.length>=1),xt(r.length%this._numIndexPerPrimitive==0),xt(r.length>=e.length*this._numIndexPerPrimitive),xt(n.size===3||n.size===4);const{data:s,size:o}=n,a=e.length;let l=o*r[this._numIndexPerPrimitive*e[0]];Yy.clear(),Yy.push(l);const c=Ge(s[l],s[l+1],s[l+2]),u=Kn(c);for(let y=0;y<a;++y){const v=this._numIndexPerPrimitive*e[y];for(let b=0;b<this._numIndexPerPrimitive;++b){l=o*r[v+b],Yy.push(l);let x=s[l];c[0]=Math.min(x,c[0]),u[0]=Math.max(x,u[0]),x=s[l+1],c[1]=Math.min(x,c[1]),u[1]=Math.max(x,u[1]),x=s[l+2],c[2]=Math.min(x,c[2]),u[2]=Math.max(x,u[2])}}this.bbMin=c,this.bbMax=u;const p=pr(I(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let f=this.radius*this.radius;for(let y=0;y<Yy.length;++y){l=Yy.at(y);const v=s[l]-p[0],b=s[l+1]-p[1],x=s[l+2]-p[2],S=v*v+b*b+x*x;if(S<=f)continue;const P=Math.sqrt(S),C=.5*(P-this.radius);this.radius=this.radius+C,f=this.radius*this.radius;const R=C/P;p[0]+=v*R,p[1]+=b*R,p[2]+=x*R}this.center=p,Yy.clear()}getChildren(){if(this._children||Io(this.bbMin,this.bbMax)<=1)return this._children;const e=pr(I(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),n=new Array(8);for(let c=0;c<8;++c)n[c]=0;const{data:s,size:o}=this.position;for(let c=0;c<i;++c){let u=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[p],y=s[f],v=s[f+1],b=s[f+2];for(let x=1;x<this._numIndexPerPrimitive;++x){f=o*this.indices[p+x];const S=s[f],P=s[f+1],C=s[f+2];S<y&&(y=S),P<v&&(v=P),C<b&&(b=C)}y<e[0]&&(u|=1),v<e[1]&&(u|=2),b<e[2]&&(u|=4),r[c]=u,++n[u]}let a=0;for(let c=0;c<8;++c)n[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=n[c]>0?new Uint32Array(n[c]):void 0;for(let c=0;c<8;++c)n[c]=0;for(let c=0;c<i;++c){const u=r[c];l[u][n[u]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new cge(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Yy.prune()}};const Yy=new ri({deallocator:null});let Y3=class{constructor(){this.id=xc()}unload(){}};function rUe(t){return t?{p0:Kn(t.p0),p1:Kn(t.p1),p2:Kn(t.p2)}:{p0:I(),p1:I(),p2:I()}}function nK(t,e,i){const r=e[0]-t[0],n=e[1]-t[1],s=i[0]-t[0],o=i[1]-t[1];return .5*Math.abs(r*o-n*s)}function nUe(t,e,i){return Ce(I6,e,t),Ce(sK,i,t),ze(Rt(I6,I6,sK))/2}new Vg(yp);new Vg(()=>rUe());const I6=I(),sK=I();function sUe(t,e,i){if(!t||!e)return!1;const{size:r,data:n}=t;me(i,0,0,0),me(dh,0,0,0);let s=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*r,c=e[a+1]*r,u=e[a+2]*r;me(ao,n[l],n[l+1],n[l+2]),me(lg,n[c],n[c+1],n[c+2]),me(BR,n[u],n[u+1],n[u+2]);const p=nUe(ao,lg,BR);p?(xe(ao,ao,lg),xe(ao,ao,BR),pe(ao,ao,1/3*p),xe(i,i,ao),s+=p):(xe(dh,dh,ao),xe(dh,dh,lg),xe(dh,dh,BR),o+=3)}return(o!==0||s!==0)&&(s!==0?(pe(i,i,1/s),!0):o!==0&&(pe(i,dh,1/o),!0))}function oUe(t,e,i){if(!t||!e)return!1;const{size:r,data:n}=t;me(i,0,0,0);let s=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*r;s!==l&&(i[0]+=n[l],i[1]+=n[l+1],i[2]+=n[l+2],o++),s=l}return o>1&&pe(i,i,1/o),o>0}function aUe(t,e,i,r){if(!t)return!1;me(r,0,0,0),me(dh,0,0,0);let n=0,s=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(i?2:0);for(let u=0;u<c;u+=2){const p=u<l?u:l,f=u<l?u+1:0,y=(e?e[p]:p)*o,v=(e?e[f]:f)*o;ao[0]=a[y],ao[1]=a[y+1],ao[2]=a[y+2],lg[0]=a[v],lg[1]=a[v+1],lg[2]=a[v+2],pe(ao,xe(ao,ao,lg),.5);const b=O3(ao,lg);b>0?(xe(r,r,pe(ao,ao,b)),n+=b):n===0&&(xe(dh,dh,ao),s++)}return n!==0?(pe(r,r,1/n),!0):s!==0&&(pe(r,dh,1/s),!0)}const ao=I(),lg=I(),BR=I(),dh=I();let MD=class{constructor(e){this.channel=e,this.id=xc()}};function e7(t,e,i){for(let r=0;r<i;++r)e[2*r]=t[r],e[2*r+1]=t[r]-e[2*r]}function lUe(t,e){const i=t.length;for(let r=0;r<i;++r)S2[0]=t[r],e[r]=S2[0];return e}function cUe(t,e){const i=t.length;for(let r=0;r<i;++r)S2[0]=t[r],S2[1]=t[r]-S2[0],e[r]=S2[1];return e}const S2=new Float32Array(2);function t7(t,e){return t==null&&(t=[]),t.push(e),t}function i7(t,e){if(t==null)return null;const i=t.filter(r=>r!==e);return i.length===0?null:i}function uUe(t,e,i,r,n){VR[0]=t.get(e,0),VR[1]=t.get(e,1),VR[2]=t.get(e,2),e7(VR,Jy,3),i.set(n,0,Jy[0]),r.set(n,0,Jy[1]),i.set(n,1,Jy[2]),r.set(n,1,Jy[3]),i.set(n,2,Jy[4]),r.set(n,2,Jy[5])}const VR=I(),Jy=new Float32Array(6);let fs=class uge extends Y3{constructor(e,i,r=[],n=null,s=An.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=n,this.type=s,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of i)c&&this._vertexAttributes.set(l,{...c});if(r==null||r.length===0){const l=hUe(this._vertexAttributes),c=DT(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const u of this._vertexAttributes.keys())this._indices.set(u,c)}else for(const[l,c]of r)c&&(this._indices.set(l,Uf(c)),l===M.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const i=new uge(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((r,n)=>{r.exclusive=!1,i._vertexAttributes.set(n,r)}),this._indices.forEach((r,n)=>i._indices.set(n,r)),i._boundingInfo=this._boundingInfo,i.transformation=e.transformation||this.transformation,i}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let i=this._vertexAttributes.get(e);return i&&!i.exclusive&&(i={...i,exclusive:!0,data:iUe(i.data)},this._vertexAttributes.set(e,i)),i}setAttributeData(e,i){const r=this._vertexAttributes.get(e);r&&this._vertexAttributes.set(e,{...r,exclusive:!0,data:i})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===An.Mesh?this._computeAttachmentOriginTriangles(e):this.type===An.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&st(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const i=this.indices.get(M.POSITION),r=this.vertexAttributes.get(M.POSITION);return sUe(r,i,e)}_computeAttachmentOriginLines(e){const i=this.vertexAttributes.get(M.POSITION),r=this.indices.get(M.POSITION);return aUe(i,r,r&&dUe(this.material.parameters,i,r),e)}_computeAttachmentOriginPoints(e){const i=this.indices.get(M.POSITION),r=this.vertexAttributes.get(M.POSITION);return oUe(r,i,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(M.POSITION),i=this.vertexAttributes.get(M.POSITION);if(!e||e.length===0||!i)return null;const r=this.type===An.Mesh?3:1;xt(e.length%r==0,"Indexing error: "+e.length+" not divisible by "+r);const n=DT(e.length/r);return new lge(n,r,e,i)}get transformation(){return this._transformation??Os}set transformation(e){this._transformation=e&&e!==Os?TT(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new MD(Ng.Highlight);return this.highlights=t7(this.highlights,e),e}removeHighlight(e){this.highlights=i7(this.highlights,e)}};function hUe(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function dUe(t,e,i){return!(!("isClosed"in t)||!t.isClosed)&&(i?i.length>2:e.data.length>6)}const Iw=QB,L6=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],pUe=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],fUe=[0,0,1,0,1,1,0,1],mUe=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],hge=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)hge[6*t+e]=t;const Kv=new Array(36);for(let t=0;t<6;t++)Kv[6*t]=0,Kv[6*t+1]=1,Kv[6*t+2]=2,Kv[6*t+3]=2,Kv[6*t+4]=3,Kv[6*t+5]=0;function gUe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(24);for(let r=0;r<8;r++)i[3*r]=L6[r][0]*e[0],i[3*r+1]=L6[r][1]*e[1],i[3*r+2]=L6[r][2]*e[2];return new fs(t,[[M.POSITION,new nt(i,3,!0)],[M.NORMAL,new nt(pUe,3)],[M.UV0,new nt(fUe,2)]],[[M.POSITION,mUe],[M.NORMAL,hge],[M.UV0,Kv]])}const D6=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],_Ue=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],yUe=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],vUe=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function bUe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(18);for(let r=0;r<6;r++)i[3*r]=D6[r][0]*e[0],i[3*r+1]=D6[r][1]*e[1],i[3*r+2]=D6[r][2]*e[2];return new fs(t,[[M.POSITION,new nt(i,3,!0)],[M.NORMAL,new nt(_Ue,3)]],[[M.POSITION,yUe],[M.NORMAL,vUe]])}const LI=mr(-.5,0,-.5),DI=mr(.5,0,-.5),NI=mr(0,0,.5),FI=mr(0,.5,0),Lw=Tn(),Dw=Tn(),H2=Tn(),W2=Tn(),q2=Tn();Ce(Lw,LI,FI),Ce(Dw,LI,DI),Rt(H2,Lw,Dw),Me(H2,H2),Ce(Lw,DI,FI),Ce(Dw,DI,NI),Rt(W2,Lw,Dw),Me(W2,W2),Ce(Lw,NI,FI),Ce(Dw,NI,LI),Rt(q2,Lw,Dw),Me(q2,q2);const N6=[LI,DI,NI,FI],wUe=[0,-1,0,H2[0],H2[1],H2[2],W2[0],W2[1],W2[2],q2[0],q2[1],q2[2]],xUe=[0,1,2,3,1,0,3,2,1,3,0,2],TUe=[0,0,0,1,1,1,2,2,2,3,3,3];function SUe(t,e){Array.isArray(e)||(e=[e,e,e]);const i=new Array(12);for(let r=0;r<4;r++)i[3*r]=N6[r][0]*e[0],i[3*r+1]=N6[r][1]*e[1],i[3*r+2]=N6[r][2]*e[2];return new fs(t,[[M.POSITION,new nt(i,3,!0)],[M.NORMAL,new nt(wUe,3)]],[[M.POSITION,xUe],[M.NORMAL,TUe]])}function r1t(t,e,i,r,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(i)),u=Math.max(2,Math.floor(r)),p=(c+1)*(u+1),f=mn(3*p),y=mn(3*p),v=mn(2*p),b=[];let x=0;for(let R=0;R<=u;R++){const N=[],$=R/u,k=a+$*l,B=Math.cos(k);for(let W=0;W<=c;W++){const Z=W/c,K=s+Z*o,X=Math.cos(K)*B,ae=Math.sin(k),re=-Math.sin(K)*B;f[3*x]=X*e,f[3*x+1]=ae*e,f[3*x+2]=re*e,y[3*x]=X,y[3*x+1]=ae,y[3*x+2]=re,v[2*x]=Z,v[2*x+1]=$,N.push(x),++x}b.push(N)}const S=new Array;for(let R=0;R<u;R++)for(let N=0;N<c;N++){const $=b[R][N],k=b[R][N+1],B=b[R+1][N+1],W=b[R+1][N];R===0?(S.push($),S.push(B),S.push(W)):R===u-1?(S.push($),S.push(k),S.push(B)):(S.push($),S.push(k),S.push(B),S.push(B),S.push(W),S.push($))}const P=[[M.POSITION,S],[M.NORMAL,S]],C=[[M.POSITION,new nt(f,3,!0)],[M.NORMAL,new nt(y,3,!0)]];return n.uv&&(C.push([M.UV0,new nt(v,2,!0)]),P.push([M.UV0,S])),n.offset&&(P[0][0]=M.OFFSET,C[0][0]=M.OFFSET,P.push([M.POSITION,bS(S.length)]),C.push([M.POSITION,new nt(Float64Array.from(n.offset),3,!0)])),new fs(t,C,P)}function CUe(t,e,i,r){const{vertexAttributes:n,indices:s}=dge(e,i,r);return new fs(t,n,s)}function dge(t,e,i){const r=t;let n,s;if(i)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const u=r*(1+Math.sqrt(5))/2;n=[-r,u,0,r,u,0,-r,-u,0,r,-u,0,0,-r,u,0,r,u,0,-r,-u,0,r,-u,u,0,-r,u,0,r,-u,0,-r,-u,0,r],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let u=0;u<n.length;u+=3)Iw.scale(n,u,t/Iw.length(n,u));let o={};function a(u,p){u>p&&([u,p]=[p,u]);const f=u.toString()+"."+p.toString();if(o[f])return o[f];let y=n.length;return n.length+=3,Iw.add(n,3*u,n,3*p,n,y),Iw.scale(n,y,t/Iw.length(n,y)),y/=3,o[f]=y,y}for(let u=0;u<e;u++){const p=s.length,f=new Array(4*p);for(let y=0;y<p;y+=3){const v=s[y],b=s[y+1],x=s[y+2],S=a(v,b),P=a(b,x),C=a(x,v),R=4*y;f[R]=v,f[R+1]=S,f[R+2]=C,f[R+3]=b,f[R+4]=P,f[R+5]=S,f[R+6]=x,f[R+7]=C,f[R+8]=P,f[R+9]=S,f[R+10]=P,f[R+11]=C}s=f,o={}}const l=iK(n);for(let u=0;u<l.length;u+=3)Iw.normalize(l,u);const c=[[M.POSITION,s],[M.NORMAL,s]];return{vertexAttributes:[[M.POSITION,new nt(iK(n),3,!0)],[M.NORMAL,new nt(l,3,!0)]],indices:c}}function r7(t,e,i,r,n,s,o,a,l=null){const c=i?[i[0],i[1],i[2]]:[0,0,0],u=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const p=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],f=n!=null&&n.length===2?n:[1,1],y=[[M.POSITION,new nt(c,3,!0)],[M.NORMAL,new nt(u,3,!0)],[M.UV0,new nt(o,o.length)],[M.COLOR,new nt(p,4,!0)],[M.SIZE,new nt(f,2)]];if(s!=null){const v=[s[0],s[1],s[2],s[3]];y.push([M.AUXPOS1,new nt(v,4)])}if(a!=null){const v=[a[0],a[1],a[2],a[3]];y.push([M.AUXPOS2,new nt(v,4)])}return new fs(t,y,null,null,An.Point,l)}const EUe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function n1t(t,e=EUe){const i=new Array(12);for(let u=0;u<4;u++)for(let p=0;p<3;p++)i[3*u+p]=e[u][p];const r=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[M.POSITION,r],[M.NORMAL,s],[M.UV0,r],[M.COLOR,s]],c=[[M.POSITION,new nt(i,3,!0)],[M.NORMAL,new nt(n,3,!0)],[M.UV0,new nt(o,2,!0)],[M.COLOR,new nt(a,4,!0)]];return new fs(t,c,l)}function oK(t,e,i,r,n,s=!0,o=!0){let a=0;const l=i,c=e;let u=mr(0,a,0),p=mr(0,a+c,0),f=mr(0,-1,0),y=mr(0,1,0);n&&(a=c,p=mr(0,0,0),u=mr(0,a,0),f=mr(0,1,0),y=mr(0,-1,0));const v=[p,u],b=[f,y],x=r+2,S=Math.sqrt(c*c+l*l);if(n)for(let B=r-1;B>=0;B--){const W=B*(2*Math.PI/r),Z=mr(Math.cos(W)*l,a,Math.sin(W)*l);v.push(Z);const K=mr(c*Math.cos(W)/S,-l/S,c*Math.sin(W)/S);b.push(K)}else for(let B=0;B<r;B++){const W=B*(2*Math.PI/r),Z=mr(Math.cos(W)*l,a,Math.sin(W)*l);v.push(Z);const K=mr(c*Math.cos(W)/S,l/S,c*Math.sin(W)/S);b.push(K)}const P=new Array,C=new Array;if(s){for(let B=3;B<v.length;B++)P.push(1),P.push(B-1),P.push(B),C.push(0),C.push(0),C.push(0);P.push(v.length-1),P.push(2),P.push(1),C.push(0),C.push(0),C.push(0)}if(o){for(let B=3;B<v.length;B++)P.push(B),P.push(B-1),P.push(0),C.push(B),C.push(B-1),C.push(1);P.push(0),P.push(2),P.push(v.length-1),C.push(1),C.push(2),C.push(b.length-1)}const R=mn(3*x);for(let B=0;B<x;B++)R[3*B]=v[B][0],R[3*B+1]=v[B][1],R[3*B+2]=v[B][2];const N=mn(3*x);for(let B=0;B<x;B++)N[3*B]=b[B][0],N[3*B+1]=b[B][1],N[3*B+2]=b[B][2];const $=[[M.POSITION,P],[M.NORMAL,C]],k=[[M.POSITION,new nt(R,3,!0)],[M.NORMAL,new nt(N,3,!0)]];return new fs(t,k,$)}function AUe(t,e,i,r,n,s,o){const a=n?TD(n):mr(1,0,0),l=s?TD(s):mr(0,0,0);o??(o=!0);const c=Tn();Me(c,a);const u=Tn();pe(u,c,Math.abs(e));const p=Tn();pe(p,u,-.5),xe(p,p,l);const f=mr(0,1,0);Math.abs(1-Re(c,f))<.2&&me(f,0,0,1);const y=Tn();Rt(y,c,f),Me(y,y),Rt(f,y,c);const v=2*r+(o?2:0),b=r+(o?2:0),x=mn(3*v),S=mn(3*b),P=mn(2*v),C=new Array(3*r*(o?4:2)),R=new Array(3*r*(o?4:2));o&&(x[3*(v-2)]=p[0],x[3*(v-2)+1]=p[1],x[3*(v-2)+2]=p[2],P[2*(v-2)]=0,P[2*(v-2)+1]=0,x[3*(v-1)]=x[3*(v-2)]+u[0],x[3*(v-1)+1]=x[3*(v-2)+1]+u[1],x[3*(v-1)+2]=x[3*(v-2)+2]+u[2],P[2*(v-1)]=1,P[2*(v-1)+1]=1,S[3*(b-2)]=-c[0],S[3*(b-2)+1]=-c[1],S[3*(b-2)+2]=-c[2],S[3*(b-1)]=c[0],S[3*(b-1)+1]=c[1],S[3*(b-1)+2]=c[2]);const N=(K,X,ae)=>{C[K]=X,R[K]=ae};let $=0;const k=Tn(),B=Tn();for(let K=0;K<r;K++){const X=K*(2*Math.PI/r);pe(k,f,Math.sin(X)),pe(B,y,Math.cos(X)),xe(k,k,B),S[3*K]=k[0],S[3*K+1]=k[1],S[3*K+2]=k[2],pe(k,k,i),xe(k,k,p),x[3*K]=k[0],x[3*K+1]=k[1],x[3*K+2]=k[2],P[2*K]=K/r,P[2*K+1]=0,x[3*(K+r)]=x[3*K]+u[0],x[3*(K+r)+1]=x[3*K+1]+u[1],x[3*(K+r)+2]=x[3*K+2]+u[2],P[2*(K+r)]=K/r,P[2*K+1]=1;const ae=(K+1)%r;N($++,K,K),N($++,K+r,K),N($++,ae,ae),N($++,ae,ae),N($++,K+r,K),N($++,ae+r,ae)}if(o){for(let K=0;K<r;K++){const X=(K+1)%r;N($++,v-2,b-2),N($++,K,b-2),N($++,X,b-2)}for(let K=0;K<r;K++){const X=(K+1)%r;N($++,K+r,b-1),N($++,v-1,b-1),N($++,X+r,b-1)}}const W=[[M.POSITION,C],[M.NORMAL,R],[M.UV0,C]],Z=[[M.POSITION,new nt(x,3,!0)],[M.NORMAL,new nt(S,3,!0)],[M.UV0,new nt(P,2,!0)]];return new fs(t,Z,W)}function s1t(t,e,i,r,n,s,o=mr(0,0,0)){const a=e.length,l=mn(i.length*a*3+(6*r.length||0)),c=mn(i.length*a*3+(r?6:0)),u=new Array,p=new Array;let f=0,y=0;const v=Tn(),b=Tn(),x=Tn(),S=Tn(),P=Tn(),C=Tn(),R=Tn(),N=I(),$=Tn(),k=Tn(),B=Tn(),W=Tn(),Z=Tn(),K=Yi();me($,0,1,0),Ce(b,i[1],i[0]),Me(b,b),s?(xe(N,i[0],o),Me(x,N)):me(x,0,0,1),$D(b,x,$,$,P,x,aK),fe(S,x),fe(W,P);for(let H=0;H<r.length;H++)pe(C,P,r[H][0]),pe(N,x,r[H][2]),xe(C,C,N),xe(C,C,i[0]),l[f++]=C[0],l[f++]=C[1],l[f++]=C[2];c[y++]=-b[0],c[y++]=-b[1],c[y++]=-b[2];for(let H=0;H<n.length;H++)u.push(n[H][0]>0?n[H][0]:-n[H][0]-1+r.length),u.push(n[H][1]>0?n[H][1]:-n[H][1]-1+r.length),u.push(n[H][2]>0?n[H][2]:-n[H][2]-1+r.length),p.push(0),p.push(0),p.push(0);let X=r.length;const ae=r.length-1;for(let H=0;H<i.length;H++){let Y=!1;H>0&&(fe(v,b),H<i.length-1?(Ce(b,i[H+1],i[H]),Me(b,b)):Y=!0,xe(k,v,b),Me(k,k),xe(B,i[H-1],S),j3(i[H],k,K),Wb(K,Cu(B,v),N)?(Ce(N,N,i[H]),Me(x,N),Rt(P,k,x),Me(P,P)):$D(k,S,W,$,P,x,aK),fe(S,x),fe(W,P)),s&&(xe(N,i[H],o),Me(Z,N));for(let ie=0;ie<a;ie++)if(pe(C,P,e[ie][0]),pe(N,x,e[ie][1]),xe(C,C,N),Me(R,C),c[y++]=R[0],c[y++]=R[1],c[y++]=R[2],xe(C,C,i[H]),l[f++]=C[0],l[f++]=C[1],l[f++]=C[2],!Y){const le=(ie+1)%a;u.push(X+ie),u.push(X+a+ie),u.push(X+le),u.push(X+le),u.push(X+a+ie),u.push(X+a+le);for(let ue=0;ue<6;ue++){const ve=u.length-6;p.push(u[ve+ue]-ae)}}X+=a}const re=i[i.length-1];for(let H=0;H<r.length;H++)pe(C,P,r[H][0]),pe(N,x,r[H][1]),xe(C,C,N),xe(C,C,re),l[f++]=C[0],l[f++]=C[1],l[f++]=C[2];const ee=y/3;c[y++]=b[0],c[y++]=b[1],c[y++]=b[2];const oe=X-a;for(let H=0;H<n.length;H++)u.push(n[H][0]>=0?X+n[H][0]:-n[H][0]-1+oe),u.push(n[H][2]>=0?X+n[H][2]:-n[H][2]-1+oe),u.push(n[H][1]>=0?X+n[H][1]:-n[H][1]-1+oe),p.push(ee),p.push(ee),p.push(ee);const U=[[M.POSITION,u],[M.NORMAL,p]],V=[[M.POSITION,new nt(l,3,!0)],[M.NORMAL,new nt(c,3,!0)]];return new fs(t,V,U)}function o1t(t,e,i,r){xt(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),xt(e[0].length===3,"createPolylineGeometry(): malformed vertex"),xt(i==null||i.length===e.length,"createPolylineGeometry: need same number of points and normals"),xt(i==null||i[0].length===3,"createPolylineGeometry(): malformed normal");const n=ia(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let u=0;u<e.length;u++){for(let p=0;p<3;p++)n[o++]=e[u][p];u>0&&(s[a++]=u-1,s[a++]=u)}const l=[],c=[];if(l.push([M.POSITION,s]),c.push([M.POSITION,new nt(n,3,!0)]),i){const u=mn(3*i.length);let p=0;for(let f=0;f<e.length;f++)for(let y=0;y<3;y++)u[p++]=i[f][y];l.push([M.NORMAL,s]),c.push([M.NORMAL,new nt(u,3,!0)])}return r&&(c.push([M.COLOR,new nt(r,4)]),l.push([M.COLOR,DT(r.length/4)])),new fs(t,c,l,null,An.Line)}function PUe(t,e=t){const i=t.vertexAttributes,r=i.get(M.POSITION).data,n=i.get(M.NORMAL).data;if(n){const s=e.getMutableAttribute(M.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(r){const s=e.getMutableAttribute(M.POSITION).data;for(let o=0;o<r.length;o+=3){const a=r[o+1];s[o+1]=-r[o+2],s[o+2]=a}}}function F6(t,e,i,r,n){return!(Math.abs(Re(e,t))>n)&&(Rt(i,t,e),Me(i,i),Rt(r,i,t),Me(r,r),!0)}function $D(t,e,i,r,n,s,o){return F6(t,e,n,s,o)||F6(t,i,n,s,o)||F6(t,r,n,s,o)}const aK=.99619469809;let OUe=class{constructor(e,i){this.type=fa.Local,this._configuration=new zH,this._passParameters=new BH,this._configuration.geometry=Xf.Cylinder,this._technique=i.techniqueRepository.acquire(PD,this._configuration);const r=i.renderContext.rctx;this._vao=this._createVertexArrayObject(r),this._vaoCount=Jo(this._vao,"geometry");const n=new Di;n.wrapMode=Jt.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Wt(r,n,Xke)}destroy(){this._passParameters.texture=et(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const i=e.rctx,r=i.bindTechnique(this._technique,this._passParameters,e.bindParameters);RUe(lK,e.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",lK),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ht.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const i=dge(1,2,!1),r=i.indices[0][1],n=i.vertexAttributes[0][1];for(let l=0;l<r.length;l+=3){const c=r[l];r[l]=r[l+2],r[l+2]=c}const s=n.data,o=cK.createBuffer(r.length),a=o.position;for(let l=0;l<r.length;++l){const c=3*r[l];a.set(l,0,s[c]),a.set(l,1,s[c+1]),a.set(l,2,s[c+2])}return new vp(e,Ni,{geometry:Pc(cK)},{geometry:Ki.createVertex(e,zi.STATIC_DRAW,o.buffer)})}};function RUe(t,e){Qn(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const lK=Ne(),cK=ln().vec3f(M.POSITION),MUe=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),GR=128,uK=-lB,hK=0,k6=50,$Ue=()=>1-511/512,IUe=wI([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let LUe=class{constructor(e,i){this.view=e,this.type=fa.Mars,this._passParameters=new BH,this._vaoCount=0,this._texV1=1;const r=lr(e.spatialReference);this._planetRadius=r.radius,this._outerRimWidth=r.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+uK)/this._planetRadius,this._middleRimFactor=(this._planetRadius+hK)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=hK/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=i.techniqueRepository;const n=i.renderContext.rctx;this._cameraChangeHandle=Pe(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>i.requestRender(),qn),this._vao=this._createRibbon(n),this._vaoCount=Jo(this._vao,"geometry"),this._fadeVao=Fl(n),this._fadeVaoCount=Jo(this._fadeVao,"geometry");const s=new Di;s.wrapMode=Jt.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Wt(n,s,MUe);const o=new zH;o.geometry=Xf.Cone,this._coneTechnique=this._techniqueRepository.acquire(PD,o),o.geometry=Xf.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(PD,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=et(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const i=e.bindParameters.camera;this._update(i);const r=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(r.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._vao),r.drawArrays(Ht.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(r.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),r.bindVAO(this._fadeVao),r.drawArrays(Ht.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const i=I(),r=this._planetRadius,n=ze(e.eye),s=n-r;if(s<0){const y=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=y}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(k6,s),a=r+uK;this._passParameters.innerScale=DUe(r+o,r,a)-1,this._passParameters.altitudeFade=wH(s),pe(i,e.eye,(r+k6)/n),dK(i,e.center,e.up,r,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,i,e.up,this._passParameters.silhouette),c=$Ue(),u=IUe(s);let p=this._texV0+c*this._texVScale,f=this._texV0+l*u*this._texVScale;if(s>k6){dK(e.eye,e.center,e.up,r,this._passParameters.silhouette);const y=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),v=$e((y-1.5)/(l-1.5),0,1);p=this._texV0+v*c*this._texVScale,f=this._texV0+Bt(this._texV1,l*u,v)*this._texVScale}bi(this._passParameters.texV,p,f)}_createRibbon(e){const i=mn(3+3*GR*3),r=new Uint32Array(3*GR*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<GR;o++){const a=9*o+3;i[a]=o,i[a+1]=this._innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this._middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this._outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===GR-1?1:l+3,u=15*o;r[u]=l,r[u+1]=l+1,r[u+2]=c+1,r[u+3]=c+1,r[u+4]=c,r[u+5]=l,r[u+6]=l+1,r[u+7]=l+2,r[u+8]=c+2,r[u+9]=c+2,r[u+10]=c+1,r[u+11]=l+1,r[u+12]=l,r[u+13]=c,r[u+14]=0}const n=pK.createBuffer(r.length),s=n.position;for(let o=0;o<r.length;++o){const a=3*r[o];s.set(o,0,i[a]),s.set(o,1,i[a+1]),s.set(o,2,i[a+2])}return new vp(e,Ni,{geometry:Pc(pK)},{geometry:Ki.createVertex(e,zi.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,i,r,n){return xe(Nw,n.center,n.v2),pe(jR,Nw,this._outerRimFactor),I5(U6,i,Nw,r),LJ(Nw,U6,e.projectionMatrix,e.viewport,Nw),LJ(jR,U6,e.projectionMatrix,e.viewport,jR),Nr(Nw,jR)/e.height}};function dK(t,e,i,r,n){const s=ze(t),o=r*Math.sqrt(s*s-r*r)/s,a=Math.sqrt(r*r-o*o),l=n.v1,c=n.v2;return pe(n.center,t,a/s),Rt(l,t,e),ba(l)<1&&Rt(l,t,i),pe(l,l,o/ze(l)),Rt(c,l,t),pe(c,c,o/ze(c)),o}const U6=Ne(),Nw=I(),jR=I();function DUe(t,e,i){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-i*i)+e*i)}const pK=ln().vec3f(M.POSITION);var Fg;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(Fg||(Fg={}));let n7=class extends Oa{constructor(){super(...arguments),this.type=Fg.Rain}};d([q({count:Fg.COUNT})],n7.prototype,"type",void 0);function NUe(t){const e=new Fi;return e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new ei("cameraPosition",(i,r)=>r.camera.eye)),e.vertex.uniforms.add(new ei("offset",(i,r)=>FUe(i,r))),e.vertex.uniforms.add(new je("width",i=>i.width)),e.vertex.uniforms.add(new en("proj",(i,r)=>r.camera.projectionMatrix)),e.vertex.uniforms.add(new en("view",(i,r)=>r.camera.viewMatrix)),e.vertex.uniforms.add(new je("time",i=>i.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===Fg.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new je("opacity",i=>i.opacity),new ei("particleColor",(i,r)=>kUe(r,t))),e.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===Fg.Rain?T`d = 0.35 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function FUe(t,e){const i=e.camera.eye,r=.5*t.width,n=1/t.width,s=ele(s7,me(s7,(i[0]+r)*n,(i[1]+r)*n,(i[2]+r)*n));return uo(s,i,pe(s,s,t.width))}function kUe(t,e){const i=e.type===Fg.Rain?zUe:UUe,r=pe(s7,i,BUe),n=t.camera.eye;Me(fK,n);const s=Math.max(0,Re(fK,t.lighting.mainLight.direction));return pr(r,r,i,s)}const s7=I(),fK=I(),UUe=Ge(1,1,1),zUe=Ge(.85,.85,.85),BUe=.7,VUe=Object.freeze(Object.defineProperty({__proto__:null,build:NUe},Symbol.toStringTag,{value:"Module"}));let GUe=class extends wr{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},o7=class pge extends qi{initializeProgram(e){return new Gi(e.rctx,pge.shader.get().build(this.configuration),kI)}initializePipeline(){return Zt({blending:Fo(De.ONE,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ni})}};o7.shader=new Vi(VUe,()=>Oe(()=>import("./Precipitation.glsl-a0b5ac22.js"),[],import.meta.url));const kI=new Map([[M.POSITION,0],[M.INSTANCEFEATUREATTRIBUTE,1]]);let fge=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:i}){return i!=null?this._time!==i&&(this._time=i,!0):(this._time=this._time+e,e!==0)}},jUe=class{constructor(e,i){this.deltaTime=e,this.fixedTime=i}},Qv=class extends ke{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new GUe,this._animation=new fge,this._updatingTracking=new Lf,this._passParameters.time=0,this._passParameters.radius=lr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=nn(this._snowTechniqueCached),this._rainTechniqueCached=nn(this._rainTechniqueCached),this._vao=et(this._vao),this._instanceIdBuffer=et(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new n7;e.type=Fg.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(o7,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new n7;e.type=Fg.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(o7,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,i,r){var l;const n=r==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;i=i<.5?Bt(0,o,2*i):Bt(o,1,2*(i-.5)),this._passParameters.time=(r==="rainy"?this._rainSpeed:this._snowSpeed)*aG(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),SH(s,kI,this._instanceIdBuffer,mK,0),(l=s.capabilities.instancing)==null||l.drawArraysInstanced(Ht.TRIANGLES,0,3,this._numParticles*i),CH(s,kI,this._instanceIdBuffer,mK)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const i=[];for(let r=0;r<this._numParticles;r++)i.push(r);return Ki.createVertex(e,zi.STATIC_DRAW,new Float32Array(i))}_createVertexArrayObject(e){const i=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new vp(e,kI,{geometry:Pc(HUe)},{geometry:Ki.createVertex(e,zi.STATIC_DRAW,i)})}};d([m({constructOnly:!0})],Qv.prototype,"context",void 0),d([m({constructOnly:!0})],Qv.prototype,"view",void 0),d([m({readOnly:!0})],Qv.prototype,"updating",null),d([m()],Qv.prototype,"_updatingTracking",void 0),Qv=d([J("esri.views.3d.environment.Precipitation")],Qv);const HUe=ln().vec3f(M.POSITION),mK=Pc(ln().f32(M.INSTANCEFEATUREATTRIBUTE),1);function WUe(){const t=new Fi;return t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.COLOR,"vec4"),t.attributes.add(M.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new en("transform",(e,i)=>qUe(e,i)),new yi("viewport",(e,i)=>i.camera.fullViewport),new je("pixelRatio",(e,i)=>i.camera.pixelRatio)),t.vertex.code.add(T`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function qUe(t,e){return Qn(g0,e.camera.projectionMatrix),g0[10]=24e-8-1,g0[11]=-1,g0[14]=(24e-8-2)*e.camera.near,Cr(g0,g0,e.camera.viewMatrix),Cr(g0,g0,t.modelMatrix)}const g0=Ne(),ZUe=Object.freeze(Object.defineProperty({__proto__:null,build:WUe},Symbol.toStringTag,{value:"Module"}));let XUe=class extends wr{constructor(){super(...arguments),this.modelMatrix=Ne()}},mge=class gge extends qi{constructor(e){super(e,new Oa,()=>this.destroy())}initializeProgram(e){return new Gi(e.rctx,gge.shader.get().build(),Ni)}initializePipeline(){return Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.LEQUAL},colorWrite:ni})}};mge.shader=new Vi(ZUe,()=>Oe(()=>import("./Stars.glsl-fa4c2bec.js"),[],import.meta.url));let c_=class extends ke{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new XUe,this._updatingTracking=new Lf}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=wu(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=nn(this._technique),this._vao=et(this._vao),Ky=null}render(e){const{rctx:i}=e;if(this._ensureResources(i),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const r=i.bindTechnique(this._technique,this._renderParameter,e.bindParameters);i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Ht.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Ky==null)return;this._technique=new mge({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Ky.byteLength/gK;const i=new Float32Array(Ky,0,2*this._numPoints),r=new Uint8Array(Ky,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,i,r,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),ar)}_computeDayDuration(e){const i=e,r=new Date(e.getFullYear(),0,1,11,58,56);return(+i-+r)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+r)}_update(e){if(!e)return;const i=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,r=2*this._computeDayDuration(e),n=Qn(this._renderParameter.modelMatrix,KUe);wT(n,n,-r*Math.PI),Cr(n,JUe,n),wT(n,n,-i*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,i,r,n){const s=_K.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const u=i[2*c],p=i[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(p)),o.set(c,1,-Math.sin(u)*Math.sin(p)),o.set(c,2,-Math.cos(p));const f=this._unpackUint8Attributes(r[c]),y=this._hexToRGB(YUe[f[1]]);a.set(c,0,255*y[0]),a.set(c,1,255*y[1]),a.set(c,2,255*y[2]),a.set(c,3,255),l.set(c,f[0])}return new vp(e,Ni,{geometry:Pc(_K)},{geometry:Ki.createVertex(e,zi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(Ky!=null)return null;const e=_S(async i=>{const{data:r}=await I$e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:i});this._verifyStarData(r),Ky=r});return e.promise.catch(i=>{ms(i)||ye.getLogger(this).error(i)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new ce("stars:no-data-received","Failed to create stars because star catalogue is missing");const i=e.byteLength/gK;if(i%1!=0||i>5e4||i<5e3)throw new ce("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};d([m({constructOnly:!0})],c_.prototype,"view",void 0),d([m({constructOnly:!0})],c_.prototype,"requestRender",void 0),d([m({readOnly:!0})],c_.prototype,"updating",null),d([m()],c_.prototype,"_loadDataTask",void 0),d([m()],c_.prototype,"_updatingTracking",void 0),c_=d([J("esri.views.3d.environment.Stars")],c_);const YUe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],JUe=Wj(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),KUe=Wj(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),gK=9,_K=ln().vec3f(M.POSITION).vec4u8(M.COLOR).f32(M.SIZE);let Ky=null;function QUe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function ID(t,e,i){i*=.5;const r=Math.sin(i);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i),t}function JH(t,e){const i=2*Math.acos(e[3]),r=Math.sin(i/2);return r>ol()?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),i}function KH(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*u+o*a+n*c-s*l,t[1]=n*u+o*l+s*a-r*c,t[2]=s*u+o*c+r*l-n*a,t[3]=o*u-r*a-n*l-s*c,t}function e8e(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-r*a,t}function t8e(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l-s*a,t[1]=n*l+o*a,t[2]=s*l+r*a,t[3]=o*l-n*a,t}function i8e(t,e,i){i*=.5;const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+n*a,t[1]=n*l-r*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function r8e(t,e){const i=e[0],r=e[1],n=e[2];return t[0]=i,t[1]=r,t[2]=n,t[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t}function UI(t,e,i,r){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,p,f,y=i[0],v=i[1],b=i[2],x=i[3];return c=n*y+s*v+o*b+a*x,c<0&&(c=-c,y=-y,v=-v,b=-b,x=-x),1-c>ol()?(l=Math.acos(c),u=Math.sin(l),p=Math.sin((1-r)*l)/u,f=Math.sin(r*l)/u):(p=1-r,f=r),t[0]=p*n+f*y,t[1]=p*s+f*v,t[2]=p*o+f*b,t[3]=p*a+f*x,t}function n8e(t){const e=P3,i=e(),r=e(),n=e(),s=Math.sqrt(1-i),o=Math.sqrt(i);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function s8e(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=i*i+r*r+n*n+s*s,a=o?1/o:0;return t[0]=-i*a,t[1]=-r*a,t[2]=-n*a,t[3]=s*a,t}function yy(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function _ge(t,e){const i=e[0]+e[4]+e[8];let r;if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*s+o]-e[3*o+s])*r,t[s]=(e[3*s+n]+e[3*n+s])*r,t[o]=(e[3*o+n]+e[3*n+o])*r}return t}function o8e(t,e,i,r){const n=.5*Math.PI/180;e*=n,i*=n,r*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),u=Math.cos(r);return t[0]=s*l*u-o*a*c,t[1]=o*a*u+s*l*c,t[2]=o*l*c-s*a*u,t[3]=o*l*u+s*a*c,t}function a8e(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const QH=Ah,l8e=Br,c8e=_G,u8e=KH,h8e=ib,d8e=lle,p8e=bG,yge=yG,f8e=yge,vge=vG,m8e=vge,eW=ale,g8e=k2,_8e=LL;function y8e(t,e,i){const r=Re(e,i);return r<-.999999?(Rt($p,v8e,e),ac($p)<1e-6&&Rt($p,b8e,e),Me($p,$p),ID(t,$p,Math.PI),t):r>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Rt($p,e,i),t[0]=$p[0],t[1]=$p[1],t[2]=$p[2],t[3]=1+r,eW(t,t))}const $p=I(),v8e=Ge(1,0,0),b8e=Ge(0,1,0);function w8e(t,e,i,r,n,s){return UI(yK,e,n,s),UI(vK,i,r,s),UI(t,yK,vK,2*s*(1-s)),t}const yK=Xh(),vK=Xh();function x8e(t,e,i,r){const n=T8e;return n[0]=i[0],n[3]=i[1],n[6]=i[2],n[1]=r[0],n[4]=r[1],n[7]=r[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],eW(t,_ge(t,n))}const T8e=on();Object.freeze(Object.defineProperty({__proto__:null,add:c8e,calculateW:r8e,conjugate:yy,copy:QH,dot:d8e,equals:_8e,exactEquals:g8e,fromEuler:o8e,fromMat3:_ge,getAxisAngle:JH,identity:QUe,invert:s8e,len:f8e,length:yge,lerp:p8e,mul:u8e,multiply:KH,normalize:eW,random:n8e,rotateX:e8e,rotateY:t8e,rotateZ:i8e,rotationTo:y8e,scale:h8e,set:l8e,setAxes:x8e,setAxisAngle:ID,slerp:UI,sqlerp:w8e,sqrLen:m8e,squaredLength:vge,str:a8e},Symbol.toStringTag,{value:"Module"}));function Jg(t=C8e){return[t[0],t[1],t[2],t[3]]}function z6(t,e,i=Jg()){return fe(i,t),i[3]=e,i}function bK(t,e,i=Jg()){return Rt(i,t,e),Me(i,i),i[3]=-ile(t,e),i}function wK(t,e,i=Jg()){return ID(HR,t,xK(t)),ID(TK,e,xK(e)),KH(HR,TK,HR),S8e(i,nl(JH(i,HR)))}function g1t(t,e,i,r=Jg()){return z6(Kae,t,WR),z6(Qae,e,SK),z6(fG,i,CK),wK(WR,SK,WR),wK(WR,CK,r),r}function _1t(t){return t}function y1t(t){return t[3]}function xK(t){return Qt(t[3])}function S8e(t,e){return t[3]=e,t}const C8e=[0,0,1,0],HR=Xh(),TK=Xh();Jg();const WR=Jg(),SK=Jg(),CK=Jg();function E8e(t,e,i){const r=t.parallax.anchorPointClouds;t.fadeIn.stage===hc.FINISHED&&(t.fadeIn.factor=0,fe(r,Sf),t.fadeIn.stage=hc.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=Fs.FINISHED),t.fadeIn.stage===hc.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(MH(t.data)&&t.renderingStage!==Zn.RENDERING||t.renderingStage===Zn.FADING_TEXTURE_CHANNELS)&&(fe(r,Sf),t.fadeIn.stage=hc.FADE_IN,t.startTime=e,t.renderingStage===Zn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Zn.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===hc.FADE_IN?t.fadeIn.factor=i?$e((e-t.startTime)/(bge*i),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===hc.FADE_IN&&(t.fadeIn.stage=hc.FINISHED,t.fadeIn.factor=1)}function A8e(t,e,i){const{fadeInOut:r,crossFade:n}=t;r.stage===Fs.FINISHED&&(t.startTime=e,r.factor=1,r.stage=Fs.FADE_OUT),r.factor>0&&r.stage===Fs.FADE_OUT?r.factor=i?1-$e((e-t.startTime)/($8e*i),0,1):0:(r.factor<=0&&r.stage===Fs.FADE_OUT&&(r.factor=0,fe(t.parallax.anchorPointClouds,Sf)),r.factor<=0&&r.stage===Fs.FADE_OUT&&t.isCameraPositionFinal&&(r.factor=0,r.stage=Fs.SWITCH,t.crossFade.enabled=!1,n.factor=1),r.stage===Fs.SWITCH&&(MH(t.data)&&t.renderingStage!==Zn.RENDERING||t.renderingStage===Zn.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,r.factor=0,r.stage=Fs.FADE_IN,fe(t.parallax.anchorPointClouds,Sf),t.crossFade.enabled=!1,n.factor=1,t.renderingStage===Zn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Zn.SWITCH_CHANNELS)),r.factor<1&&r.stage===Fs.FADE_IN?r.factor=i?$e((e-t.startTime)/(bge*i),0,1):1:r.factor>=1&&r.stage===Fs.FADE_IN&&(r.stage=Fs.FINISHED,r.factor=1))}function P8e(t,e,i,r){const{crossFade:n}=t,s=t.parallax.anchorPointClouds;t.crossFade.enabled&&!r||(fe(t.parallaxNew.anchorPointClouds,Sf),t.startTime=e,n.factor=0,t.crossFade.enabled=!0),n.factor<1&&t.crossFade.enabled?n.factor=i?$e((e-t.startTime)/(I8e*i),0,1):1:n.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,n.factor=1,fe(s,t.parallaxNew.anchorPointClouds),t.renderingStage===Zn.FADING_TEXTURE_CHANNELS&&(t.renderingStage=Zn.SWITCH_CHANNELS))}function EK(t,e,i,r){const n=t.fadeInOutHeight,s=n.stage===fy.FINISHED?i:t.startTimeHeightFade;if(r!==0){const o=(i-s)/(L8e*r);n.factor+=e?-o:o}else n.factor=e?0:1;t.startTimeHeightFade=i,n.factor=$e(n.factor,0,1),n.stage=fy.HEIGHT_FADE}function O8e(t,e,i,r,n){t.renderingStage===Zn.FINISHED_RENDERING&&(t.renderingStage=Zn.FADING_TEXTURE_CHANNELS);const s=ze(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=s-vi.radius>yf?1:0),t.isCameraPositionFinal=ny(t.cameraPositionLastFrame,e.eye),Me(Sf,e.eye),pe(Sf,Sf,vi.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&fe(o.anchorPointClouds,Sf);const a=ze(Ce(M8e,o.anchorPointClouds,Sf));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==hc.FINISHED?E8e(t,r,n):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==Fs.FINISHED?A8e(t,r,n):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===Zn.FADING_TEXTURE_CHANNELS?P8e(t,r,n,(i!==Ji.IDLE||!MH(t.data))&&t.renderingStage!==Zn.FADING_TEXTURE_CHANNELS):l=!1;const c=s-vi.radius;if((c>1.7*yf||c<-yf)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>yf||c<-.35*yf)&&t.fadeInOutHeight.factor<1?EK(t,!1,r,n):c<yf&&c>-.35*yf&&t.fadeInOutHeight.factor>0?EK(t,!0,r,n):t.fadeInOutHeight.stage=fy.FINISHED,t.renderingStage===Zn.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=Zn.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(s*s-vi.radius*vi.radius,0))/s,bK(AK,o.anchorPointClouds,Fw),vc(o.transform,Os,Fw[3],Fw),l){const{parallaxNew:u}=t;bK(AK,u.anchorPointClouds,Fw),vc(u.transform,Os,Fw[3],Fw)}fe(t.cameraPositionLastFrame,e.eye)}function R8e(t){return t.crossFade.enabled||t.fadeInOut.stage!==Fs.FINISHED||t.fadeIn.stage!==hc.FINISHED||t.fadeInOutHeight.stage!==fy.FINISHED||t.renderingStage!==Zn.FINISHED}const AK=Ge(0,0,1),Fw=Jg(),Sf=I(),M8e=I(),bge=1,$8e=.5,I8e=1.3,L8e=1;let wS=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,i){var r;return(r=this._outer.get(e))==null?void 0:r.get(i)}set(e,i,r){const n=this._outer.get(e);n?n.set(i,r):this._outer.set(e,new Map([[i,r]]))}delete(e,i){const r=this._outer.get(e);r&&(r.delete(i),r.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((i,r)=>e(i,r))}};var ds;function PK(t=!ge("disable-feature:high-quality-idle"),e=null){const i=new wS;return t?(i.set(Ji.IDLE,ds.Antialiasing,e!=="low"),i.set(Ji.IDLE,ds.HighResolutionAtmosphere,e!=="low"),i.set(Ji.IDLE,ds.HighQualityTransparency,!0),i.set(Ji.IDLE,ds.SSAO,!0),i.set(Ji.IDLE,ds.WaterReflection,!0),i.set(Ji.IDLE,ds.PhysicalPixelRendering,!ge("esri-mobile"))):(i.set(Ji.ANIMATING,ds.HighResolutionShadows,!0),i.set(Ji.INTERACTING,ds.HighResolutionShadows,!0)),i.set(Ji.IDLE,ds.HighResolutionShadows,!0),i.set(Ji.IDLE,ds.HighResolutionVoxel,!0),i}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(ds||(ds={}));var Z2;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})(Z2||(Z2={}));var YE;const D8e=[Te.POSTPROCESSING_ENVIRONMENT_OPAQUE,Te.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Vo=YE=class extends ke{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new B6,this._newWeatherParameters=new B6,this._fadedWeatherParameters=new B6,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(D8e,this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:fa.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===fa.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return ze(this.view.state.camera.eye)-lr(this.view.spatialReference).radius<=yf}get _stars(){var r;const t=this.view,e=((r=t.environment)==null?void 0:r.starsEnabled)??!1,i=this._get("_stars");return e&&this._context!=null?i??new c_({view:t,requestRender:()=>this._setNeedsRender()}):(Je(i),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return Je(t),null;const e=this.view,i=this._context;return t!=null&&t.context===i?t:(Je(t),new Qv({context:i,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return Je(t),null;if(t!=null)return t;const e=this.view,i=this._context;return Je(t),new bl({context:i,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return Je(t),null;const e=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=lr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===r?t:(Je(t),new Yv({rctx:i,viewingMode:e,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return Je(t),null;if(t!=null)return t;const e=this.view,i=this._context,r=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new Jv({context:i,view:e,rctx:r,viewingMode:n})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([Pe(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),i=>this._updateAtmosphere(i),qn),Pe(()=>this._stars,e),Pe(()=>this._precipitation,e),Pe(()=>this._clouds,()=>this._updateWeather(),ar),Pe(()=>this._fog,()=>this._updateFogHaze(),ar),Pe(()=>this.view.state.mode,()=>{this._setNeedsRender()},gr),Pe(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},qn)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Je(this._atmosphere),this._set("_stars",Je(this._stars)),this._set("_precipitation",Je(this._precipitation)),this._set("_clouds",Je(this._clouds)),this._set("_cloudsComposition",Je(this._cloudsComposition)),this._set("_fog",Je(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=T6e(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(O8e(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===Zn.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){var e,i,r,n,s,o,a,l,c;if(t.output===j.Color)switch(t.bindParameters.slot){case Te.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,((e=this.view)==null?void 0:e.qualitySettings.highResolutionAtmosphere)||((n=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer)==null?void 0:n.isFeatureEnabled(ds.HighResolutionAtmosphere))),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),R8e(t.bindParameters.cloudsFade)&&this._context!=null&&((s=t.bindParameters.cloudsFade.data)==null?void 0:s.cubeMap)!=null&&this._context.requestRender());break;case Te.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,((o=this.view)==null?void 0:o.qualitySettings.highResolutionAtmosphere)||((c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.isFeatureEnabled(ds.HighResolutionAtmosphere))),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const u=this.view.environment.weather;u.type!=="rainy"&&u.type!=="snowy"||this._precipitation.render(t,u.precipitation,u.type)}}}updateLightSources(t,e,i,r){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=i,n.bindParameters.newLighting.set(t),r===Z2.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===hc.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===Fs.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:i}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(i,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(pa[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Bt(3e-5,.005,t.weatherAdjustment**3),fe(this._newWeatherParameters.fog.color,OK),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(t.effect??0)**3),fe(this._newWeatherParameters.fog.color,N8e),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Bt(4e-6,2e-4,(t.effect??0)**3),fe(this._newWeatherParameters.fog.color,OK),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==fa.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=Je(this._atmosphere);const i=this._getAtmosphereClass(e);i&&(this._atmosphere=new i(this.view,this._context))}}else this._atmosphere=Je(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case fa.Realistic:return WJ;case fa.Local:return OUe;case fa.Mars:return LUe;default:case fa.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:i}=t;return!e||im(this.view.spatialReference)?fa.None:i===Ke.Local?fa.Local:this._context!=null&&WJ.isSupported(this._context)&&xP(this.view.spatialReference)?fa.Realistic:tm(this.view.spatialReference)?fa.Mars:fa.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{RK=YE.prototype._getAtmosphereClass,YE.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{YE.prototype._getAtmosphereClass=RK}}}};d([m({constructOnly:!0})],Vo.prototype,"view",void 0),d([m({readOnly:!0})],Vo.prototype,"atmosphere",null),d([m({readOnly:!0})],Vo.prototype,"_atmosphereType",null),d([m({type:Boolean,readOnly:!0})],Vo.prototype,"updating",null),d([m({readOnly:!0})],Vo.prototype,"weatherVisible",null),d([m()],Vo.prototype,"_context",void 0),d([m()],Vo.prototype,"_atmosphere",void 0),d([m({readOnly:!0})],Vo.prototype,"_stars",null),d([m({readOnly:!0})],Vo.prototype,"_precipitation",null),d([m({readOnly:!0})],Vo.prototype,"_clouds",null),d([m({readOnly:!0})],Vo.prototype,"_cloudsComposition",null),d([m({readOnly:!0})],Vo.prototype,"_fog",null),d([m({readOnly:!0})],Vo.prototype,"weatherEnabled",null),d([m({readOnly:!0})],Vo.prototype,"_precipitationEnabled",null),d([m({readOnly:!0})],Vo.prototype,"_weatherUpdateParameters",null),Vo=YE=d([J("esri.views.3d.environment.EnvironmentRenderer")],Vo);let B6=class{constructor(){this.fog=new Wke,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,fe(this.fog.color,e.fog.color)}lerp(e,i,r){this.fog.amount=Bt(e.fog.amount,i.fog.amount,r),this.hazeAmount=Bt(e.hazeAmount,i.hazeAmount,r),this.fog.strength=Bt(e.fog.strength,i.fog.strength,r),pr(this.fog.color,e.fog.color,i.fog.color,r)}};const N8e=Ge(.5,.5,.5),OK=Ge(1.5,1.5,1.5);let RK;function MK(t,e,i){if(e.longitude==null||e.latitude==null||i.longitude==null||i.latitude==null)throw new Error("Invalid points: no lon/lat");return F8e(t,e.longitude,e.latitude,i.longitude,i.latitude)}function F8e(t,e,i,r,n){const s=Qt(i),o=Qt(n),a=s-o,l=Qt(e)-Qt(r),c=Math.sin(a/2),u=Math.sin(l/2),p=2*Nh(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*u*u))*t;return Math.round(1e4*p)/1e4}function k8e(t,e,i){const r=e.spatialReference,n=lr(r),s=new Ft(e.x,t.y,r),o=new Ft(i.x,t.y,r),a=new Ft(t.x,e.y,r),l=new Ft(t.x,i.y,r);return{lon:MK(n.radius,s,o),lat:MK(n.radius,a,l)}}function U8e(t,e,i){const r=e/i,n=Qt(t),s=Math.sin(r/2),o=Math.cos(n),a=2*Nh(Math.sqrt(s*s/(o*o)));return nl(a)}function z8e(t,e){let i=t/15;return e||(i=Math.round(i)),i}function $K(t,e){const i=t==null?void 0:t[0];if(i==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=z8e(i,!0);const r=e.hours%1;e.hours-=r,e.minutes=60*r;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}var w1t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function J3(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var IK,LK,DK,a7={exports:{}};a7.exports,IK=a7,LK=function(){var t=Math.PI,e=Math.sin,i=Math.cos,r=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,p={dec:0,ra:0};function f(U){return U.valueOf()/l-.5+c}function y(U){return new Date((U+.5-c)*l)}function v(U){return f(U)-u}var b=23.4397*a;function x(U,V){return s(e(U)*i(b)-r(V)*e(b),i(U))}function S(U,V){return n(e(V)*i(b)+i(V)*e(b)*e(U))}function P(U,V,H){return s(e(U),i(U)*e(V)-r(H)*i(V))}function C(U,V,H){return n(e(V)*e(H)+i(V)*i(H)*i(U))}function R(U,V){return a*(280.16+360.9856235*U)-V}function N(U){return a*(357.5291+.98560028*U)}function $(U){return a*(1.9148*e(U)+.02*e(2*U)+3e-4*e(3*U))}function k(U,V){return U+V+102.9372*a+t}function B(U,V){var H=N(U),Y=k(H,$(H));return V||(V={dec:0,ra:0}),V.dec=S(Y,0),V.ra=x(Y,0),V}var W={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(U,V,H,Y){var ie=a*-H,le=a*V,ue=v(U),ve=B(ue,p),Ie=R(ue,ie)-ve.ra;return Y||(Y={azimuth:0,altitude:0}),Y.azimuth=P(Ie,le,ve.dec),Y.altitude=C(Ie,le,ve.dec),Y}},Z=[[-.83,"sunrise","sunset"]];W.addTime=function(U,V,H){Z.push([U,V,H])};var K=9e-4;function X(U,V){return Math.round(U-K-V/(2*t))}function ae(U,V,H){return K+(U+V)/(2*t)+H}function re(U,V,H){return u+U+.0053*e(V)-.0069*e(2*H)}function ee(U,V,H){return o((e(U)-e(V)*e(H))/(i(V)*i(H)))}function oe(U){var V=a*(134.963+13.064993*U),H=a*(93.272+13.22935*U),Y=a*(218.316+13.176396*U)+6.289*a*e(V),ie=5.128*a*e(H),le=385001-20905*i(V);return{ra:x(Y,ie),dec:S(Y,ie),dist:le}}return W.getTimes=function(U,V,H){var Y=a*-H,ie=a*V,le=X(v(U),Y),ue=ae(0,Y,le),ve=N(ue),Ie=$(ve),Ve=k(ve,Ie),Mt=S(Ve,0),ot=re(ue,ve,Ve);function Pt(wt){return re(ae(ee(wt,ie,Mt),Y,le),ve,Ve)}function qe(wt){var _t=(e(wt)-e(ie)*e(Mt))/(i(ie)*i(Mt));return _t<-1?W.PolarException.MIDNIGHT_SUN:_t>1?W.PolarException.POLAR_NIGHT:W.PolarException.NORMAL}var Ee,at,ht,Ue,He,rt={solarNoon:y(ot),nadir:y(ot-.5),polarException:W.PolarException.NORMAL};for(Ee=0,at=Z.length;Ee<at;Ee+=1)He=ot-((Ue=Pt((ht=Z[Ee])[0]*a))-ot),rt[ht[1]]=y(He),rt[ht[2]]=y(Ue);return rt.polarException=qe(Z[0][0]*a),rt},W.getMoonPosition=function(U,V,H){var Y=a*-H,ie=a*V,le=v(U),ue=oe(le),ve=R(le,Y)-ue.ra,Ie=C(ve,ie,ue.dec);return Ie+=.017*a/r(Ie+10.26*a/(Ie+5.1*a)),{azimuth:P(ve,ie,ue.dec),altitude:Ie,distance:ue.dist}},W.getMoonFraction=function(U){var V=v(U),H=B(V),Y=oe(V),ie=149598e3,le=o(e(H.dec)*e(Y.dec)+i(H.dec)*i(Y.dec)*i(H.ra-Y.ra)),ue=s(ie*e(le),Y.dist-ie*i(le));return(1+i(ue))/2},W},(DK=LK())!==void 0&&(IK.exports=DK);const Sb=J3(a7.exports),Xa={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let qR=class{constructor(e,i){this.direct=e,this.ambient=i}};function B8e(t,e,i,r,n,s){me(s.ambient.color,1,1,1),s.ambient.intensity=Xa.global.ambient,me(s.direct.color,1,1,1),s.direct.intensity=Xa.global.direct;const o=e[2],a=$e((Math.abs(o)-Xa.local.altitude)/(Xa.global.altitude-Xa.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=Sb.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=Z8e(t,l,r);else{const u=Tge(r);c={direct:{intensity:Xa.local.directAtNoon*u.direct,color:Ge(1,1,1)},ambient:{intensity:Xa.local.ambientAtNoon*u.ambient,color:Ge(1,1,1)},timeOfDay:"early afternoon"}}pr(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Bt(c.ambient.intensity,s.ambient.intensity,a),pr(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Bt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,s.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}s.noonFactor=t!=null?q8e(t,l):1,t!=null?V8e(t,e,i,s.direct.directionToLightSource):wge(n,i,s.direct.directionToLightSource)}function wge(t,e,i){e===Ke.Global?Me(H6,t.eye):me(H6,0,0,1),pe(W6,t.viewForward,-1);const r=bI(W6,H6),n=Math.max(r-2*q6,0),s=.85*n/(n+1),o=Math.max(q6,r-q6-s);Su(WK,-o,t.viewRight),st(i,W6,WK),xe(i,i,pe(X8e,t.viewRight,Y8e)),Me(i,i)}function V8e(t,e,i,r){const n=W8e,s=Vh(H8e);if(i===Ke.Global)Sb.getPosition(t,0,0,n),me(r,0,0,-1),bT(s,s,-n.azimuth),$5(s,s,-n.altitude),st(r,r,s);else{const o=Xa.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=$e(c,0,1),c<1?(Sb.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),me(r,0,-1,0),wT(s,s,-n.azimuth),bT(s,s,-n.altitude),st(r,r,s)}}function G8e(t,e){if(e===Ke.Global)return!0;const i=Xa.planarDirection;return Math.abs(t)<i.localAltitude}const j8e=Ge(.5773502691896258,-.5773502691896258,.5773502691896258);let xge=class{constructor(){this.ambient={color:Ge(1,1,1),intensity:.55},this.direct={color:Ge(1,1,1),intensity:.55,directionToLightSource:Kn(j8e)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const H8e=Ne(),W8e={azimuth:0,altitude:0};function q8e(t,e){const i=t.valueOf();let r,n;e.polarException===Sb.PolarException.MIDNIGHT_SUN?(r=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=r+432e6):e.polarException===Sb.PolarException.POLAR_NIGHT?(r=i-2,n=i-1):(r=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=r+(n-r)/2;return 1-$e(Math.abs(i-s)/432e5,0,1)}function Tge(t){switch(t){case"disabled":case"sunny":case"cloudy":return new qR(1,1);case"rainy":return new qR(.4,1.2);case"snowy":return new qR(.5,1.3);case"foggy":return new qR(.2,1.6)}}function NK(t,e){const i=(t[0]+t[1]+t[2])/3;t[0]+=(i-t[0])*e,t[1]+=(i-t[1])*e,t[2]+=(i-t[2])*e}const V6=Ge(.01,.01,.01),l7=Ge(1,.6,.5),c7=Ge(1,.98,.98),FK=Ge(1,1,1),G6=Ge(.8,.8,1),u7=Ge(.8,.8,1),h7=Ge(.98,.98,1),kK=Ge(1,1,1),j6=Ri(.01,Xa.local.ambientAtNight),d7=Ri(Xa.local.directAtTwilight,Xa.local.ambientAtTwilight),p7=Ri(.9*Xa.local.directAtNoon,Xa.local.ambientAtNoon),UK=Ri(Xa.local.directAtNoon,Xa.local.ambientAtNoon),zK=p7,BK=c7,VK=h7,GK=d7,jK=l7,HK=u7;function Z8e(t,e,i){const r=t.valueOf();let n,s;e.polarException===Sb.PolarException.MIDNIGHT_SUN?(n=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===Sb.PolarException.POLAR_NIGHT?(n=r-2,s=r-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,p=.06*o,f=n-p/2,y=n+p/2,v=s-p/2,b=s+p/2,x=it(),S=I(),P=I();let C="";if(r<f||r>b)Is(x,j6),fe(S,V6),fe(P,G6),C="night";else if(r<y){const $=(r-f)/(y-f);_h(x,j6,d7,$),pr(S,V6,l7,$),pr(P,G6,u7,$),C="sun rising"}else if(r<c){const $=(r-y)/(c-y);_h(x,d7,p7,$),pr(S,l7,c7,$),pr(P,u7,h7,$),C="early morning"}else if(r<a){const $=(r-c)/(a-c);_h(x,p7,UK,$),pr(S,c7,FK,$),pr(P,h7,kK,$),C="late morning"}else if(r<u){const $=(r-a)/(u-a);_h(x,UK,zK,$),pr(S,FK,BK,$),pr(P,kK,VK,$),C="early afternoon"}else if(r<v){const $=(r-u)/(v-u);_h(x,zK,GK,$),pr(S,BK,jK,$),pr(P,VK,HK,$),C="late afternoon"}else if(r<b){const $=(r-v)/(b-v);_h(x,GK,j6,$),pr(S,jK,V6,$),pr(P,HK,G6,$),C="sun setting"}let R=0;switch(i){case"rainy":case"foggy":R=.8;break;case"snowy":R=.5}R>0&&(NK(S,R),NK(P,R));const N=Tge(i);return{direct:{intensity:x[0]*N.direct,color:S},ambient:{intensity:x[1]*N.ambient,color:P},timeOfDay:C}}const WK=Ne(),H6=I(),W6=I(),X8e=I(),q6=.25,Y8e=.2;let Cd=class extends os.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new an,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new ED,this._ambientLight=new UH,this._moonLight=new Mme,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,i,r;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((r=(i=this._view)==null?void 0:i.state)==null?void 0:r.viewingMode)===Ke.Global&&xP(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Vo({view:e});const i=()=>this._updateRenderParameters(),r=()=>this._cameraHandler();this._viewHandles.add([Pe(()=>e.environment.lighting,n=>this._updateLightingHandler(n),gr),Pe(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),gr),Pe(()=>e.stationary,()=>this._interactingStationaryHandler()),Pe(()=>e.environment.lighting.directShadowsEnabled,i,gr),Pe(()=>e.qualitySettings.ambientOcclusion,i,gr),Pe(()=>e.qualitySettings.reflections,i,gr),Pe(()=>{var n;return(n=e.environment.background)==null?void 0:n.color},i,gr),Pe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),gr),Pe(()=>e.environment.weather.type,()=>this._updateLighting(null,Z2.Faded),gr),Pe(()=>this.weatherEnabled,()=>this._updateLighting(null,Z2.Faded),gr),Pe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),qn),Pe(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),qn),Pe(()=>e.state.camera,r,qn),Pe(()=>this.disableQueries,r)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Je(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const i=this._view.environment.lighting;(i==null?void 0:i.type)!=="virtual"&&(i.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const i=this._view.environment.lighting;if((i==null?void 0:i.type)!=="virtual"){if(e){if(!i.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const r=this._view.spatialReference;if(!dy(r)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=$K(this._referencePosWGS84Comparable,qK);n!=null&&(i.autoUpdate(null,n),this._trackingEnabled&&(i.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const i=this._view;if(!i.ready)return;const r=i.stateManager.camera;r&&(this._cameraHandlerClientSide(r,e)||this._cameraHandlerServerSide(r))}_cameraHandlerClientSide(e,i){const r=xP(this._view.spatialReference);if(r&&!dy(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=I()),r?gde(n,this._referencePosWGS84Comparable):me(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,i)||this._updateLighting(i),!0}_cameraHandlerServerSide(e){const i=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(i))&&this._requestReferencePositionUpdate(i,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(i.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,i=Z2.Immediate){const r=this._view;e=e||(r.environment.lighting.type==="virtual"?null:r.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n!=null?J8e:K8e,o=this.weatherVisible?r.environment.weather.type:"disabled";n!=null?B8e(e,n,r.state.viewingMode,o,r.state.camera,s):r.environment.lighting.type==="virtual"&&wge(r.state.camera,r.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;pe(a.intensity,l.color,l.intensity*Math.PI),fe(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;pe(c.intensity,s.ambient.color,s.ambient.intensity);const u=this._moonLight;pr(u.intensity,e9e,t9e,s.globalFactor);const p=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));pe(u.intensity,u.intensity,p),fe(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],s.noonFactor,s.globalFactor,i),this._updateRenderParameters()}_autoUpdateTimezone(e,i=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const r=Q8e;r.setTime((i||this._view.environment.lighting.date).getTime());const n=$K(e,qK);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=r.getUTCHours()-(n.hours-s.hours),a=r.getUTCMinutes()-(n.minutes-s.minutes),l=r.getUTCSeconds()-(n.seconds-s.seconds);return r.setUTCHours(o),r.setUTCMinutes(a),r.setUTCSeconds(l),!i&&this._view.environment.lighting.autoUpdate(r,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const i=this._referencePosWGS84Comparable==null||G8e(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),r=this._view.environment.background,n=r instanceof Pfe?{type:"color",color:qj(Lt.toUnitRGBA(r.color))}:{type:"color",color:Kt(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&i,background:n,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,i=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!i,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const r=this._referencePosUpdateQuery=_P(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===r){const s=()=>this._referencePosUpdateQuery!==r;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===r&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=_P(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const i=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(i[0])&&!isNaN(i[1])){const r=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=i[0],this._referencePosWGS84Comparable[1]=i[1],this._referencePosWGS84Comparable[2]=r):this._referencePosWGS84Comparable=[i[0],i[1],r],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let i=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(i*=this._view.mapCoordsHelper.unitInMeters),i>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(i){e._referencePointUpdateInterval=i},set referencePointUpdateDistThreshold(i){e._referencePointUpdateDistThreshold=i},set referencePosUpdateTimer(i){e._referencePosUpdateTimer=i},set referencePointUpdateDelay(i){e._referencePointUpdateDelay=i},set disableWeather(i){e._disableWeather=i}}}};d([m({type:Boolean,readOnly:!0})],Cd.prototype,"updating",null),d([m()],Cd.prototype,"disableQueries",void 0),d([m()],Cd.prototype,"_disableWeather",void 0),d([m()],Cd.prototype,"weatherEnabled",null),d([m()],Cd.prototype,"weatherVisible",null),d([m()],Cd.prototype,"referencePositionWGS84Comparable",null),d([m()],Cd.prototype,"_renderer",void 0),d([m()],Cd.prototype,"_referencePosWGS84Comparable",void 0),Cd=d([J("esri.views.3d.environment.SceneViewEnvironmentManager")],Cd);const J8e=new xge,K8e=new xge,Q8e=new Date,qK={hours:0,minutes:0,seconds:0},e9e=Ge(.22,.22,.33),t9e=Ge(.22,.22,.22);var Zr;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(Zr||(Zr={}));var di;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(di||(di={}));var mo;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(mo||(mo={}));function qP(t,e){return(t&e)!=0}function LD(t,e,i,r,n,s){t!==0&&(i?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):r!=null?(s.min-=Math.max(0,(e-s.min)*(1-r)),s.max+=Math.max(0,(e-s.max)*(1-r))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const vy={selection:Zr.NONE,interactionType:di.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:mo.TUMBLE};function Sge(t,e,i,r){return e=e||t.viewForward,fe(r,e),pe(r,r,Math.sign(Re(e,i))),r}function i9e(t,e,i,r){return a9e(t,e,i,s9e(r,e,i,!0))}function r9e(t,e,i,r){const n=Re(i,Ce(t,r,e));return xe(t,e,pe(t,i,n))}const n9e={dir:I(),len:0,clip:it()};function s9e(t,e,i,r){const n=n9e;return t?(i&&r&&(n.len=Nr(e,i)),fe(n.dir,t)):r?(n.len=Nr(e,i),Ce(n.dir,i,e),pe(n.dir,n.dir,1/n.len)):(Ce(n.dir,i,e),Me(n.dir,n.dir)),n}function o9e(t,e,i){const r=Re(t,i.dir),n=-Dr(t,e);if(n<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return n>0;if((n<0||r<0)&&!(n<0&&r<0))return!0;const s=n/r;return r>0?s<i.clip[1]&&(i.clip[1]=s):s>i.clip[0]&&(i.clip[0]=s),i.clip[0]<=i.clip[1]}function a9e(t,e,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!o9e(t[n],e,r))return!1;return!0}function l9e(t,e,i=vy){const r=tW(t,e,i);if(r===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+r,o=Sge(e,i.interactionDirection,h9e(t,e,Math.sign(r),m9e),f9e),a=fe(g9e,e.viewForward),l=n.intersectInfiniteManifold(Cu(e.eye,o),s,Z6);return e.eye=l??n.setAltitude(Z6,s,e.eye),e.center=r9e(Z6,e.eye,a,e.center),!0}function tW(t,e,i=vy){if(!c9e(t,i)||!t.state.constraints.altitude)return 0;const r=d9e(t.state.constraints.altitude,p9e);u9e(t,i,r);const n=t.renderCoordsHelper.getAltitude(e.eye),s=$e(n,r.min,r.max)-n;return Math.abs(s)<=1e-6?0:s}function c9e(t,e){const i=t.state.constraints.altitude;return!(!t.state.isGlobal||!i)&&(e.interactionType!==di.TUMBLE||!qP(e.selection,Zr.TILT))}function u9e(t,e,i){const r=e.interactionType;if(r===di.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===di.TUMBLE||r===di.ZOOM,c=tW(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);i.min=n,i.max=s,LD(c,u,l,a,.05*u,i)}function h9e(t,e,i,r){return t.renderCoordsHelper.worldUpAtPosition(e.eye,r),pe(r,r,i),r}function d9e(t,e){return e.min=t.min,e.max=t.max,e}const p9e={min:0,max:0},f9e=I(),m9e=I(),g9e=I(),Z6=I();function iW(t,e,i=vy){if(!t.state.isLocal)return 0;const r=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;ZR.min=0,ZR.max=r,y9e(t,i,ZR);const n=rW(t,e),s=ZR.max-n;return s>=-1e-6?0:s}function _9e(t,e,i=vy){const r=iW(t,e,i);if(r===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=rW(t,e)+r,o=fe(b9e,e.eye),a=Sge(e,i.interactionDirection,v9e(e,n.renderLocation,T9e),x9e);if(!My(Qde(n.renderLocation,s),Cu(e.eye,a),XR))return!1;e.eye=XR;const l=Ce(w9e,e.eye,o);e.center=xe(XR,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,XR);return u!=null&&(e.center=u),!0}function y9e(t,e,i){const r=e.interactionType;if(r===di.NONE)return;const{min:n,max:s}=i,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=r===di.ZOOM||r===di.PAN,c=iW(t,o),u=c===0?0:rW(t,o);i.min=n,i.max=s,LD(c,u,l,a,.05*u,i)}function rW(t,e){const i=t.pointsOfInterest.surfaceOrigin;return i.renderLocation?Nr(e.eye,i.renderLocation):0}function v9e(t,e,i){return zg(i,t.eye,e)}const ZR={min:0,max:0},b9e=I(),w9e=I(),x9e=I(),T9e=I(),XR=I();var sn,Do;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(sn||(sn={}));let S9e=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Do.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Do||(Do={}));let C9e=class{constructor(e,i,r){this.object=e,this.geometryId=i,this.triangleNr=r}},E9e=class extends C9e{constructor(e,i,r,n){super(e,i,r),this.center=n!=null?Kn(n):null}},Cge=class{constructor(e){this.layerUid=e}},d4=class extends Cge{constructor(e,i){super(e),this.graphicUid=i}};function bp(t){return t!=null&&t.dist!=null}function ZK(t){return(e,i,r)=>(pr(XK,e,i,r),!tH(t,XK))}function p4(t){return bp(t)&&t.intersector===sn.OBJECT&&!!t.target}function f4(t){return bp(t)&&t.intersector===sn.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const XK=I();let A9e=class{constructor(){this._transform=Ne(),this._transformInverse=new YR({value:this._transform},fo,Ne),this._transformInverseTranspose=new YR(this._transformInverse,Cc,Ne),this._transformTranspose=new YR({value:this._transform},Cc,Ne),this._transformInverseRotation=new YR({value:this._transform},ume,on)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Qn(this._transform,e)}multiplyTransform(e){Cr(this._transform,this._transform,e)}set(e){Qn(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,i){this.setTransformMatrix(e),this.multiplyTransform(i),this._invalidateLazyTransforms()}},YR=class{constructor(e,i,r){this._original=e,this._update=i,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},P9e=class{constructor(e=0){this.offset=e,this.tmpVertex=I()}applyToVertex(e,i,r){const n=e+this.localOrigin[0],s=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(n*n+s*s+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=i+s*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(e){for(let s=0;s<3;++s)_0[s]=e[0+s]+this.localOrigin[s],JR[s]=e[3+s]+this.localOrigin[s],gC[s]=_0[s];const i=this.applyToVertex(_0[0],_0[1],_0[2]);for(let s=0;s<3;++s)e[s]=i[s],e[s+3]=i[s];const r=s=>{const o=this.applyToVertex(s[0],s[1],s[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let s=1;s<8;++s){for(let o=0;o<3;++o)gC[o]=s&1<<o?JR[o]:_0[o];r(gC)}let n=0;for(let s=0;s<3;++s)_0[s]*JR[s]<0&&(n|=1<<s);if(n!==0&&n!==7){for(let s=0;s<8;++s)if(!(n&s)){for(let o=0;o<3;++o)gC[o]=n&1<<o?0:s&1<<o?_0[o]:JR[o];r(gC)}}for(let s=0;s<3;++s)e[s]-=this.localOrigin[s],e[s+3]-=this.localOrigin[s];return e}};const _0=I(),JR=I(),gC=I();let O9e=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=I(),this._mbs=kn(),this._obb={center:I(),halfSize:Tn(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,i,r){const n=e,s=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(n*n+s*s+o*o);return this._tmpVertex[0]=e+n*a,this._tmpVertex[1]=i+s*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(e){const i=e[0],r=e[1],n=e[2]+this.componentLocalOriginLength,s=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=i*s<0?0:Math.min(Math.abs(i),Math.abs(s)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),u=n*a<0?0:Math.min(Math.abs(n),Math.abs(a)),p=Math.sqrt(l*l+c*c+u*u);if(p<this._totalOffset)return e[0]-=i<0?this._totalOffset:0,e[1]-=r<0?this._totalOffset:0,e[2]-=n<0?this._totalOffset:0,e[3]+=s>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(i),Math.abs(s)),y=Math.max(Math.abs(r),Math.abs(o)),v=Math.max(Math.abs(n),Math.abs(a)),b=Math.sqrt(f*f+y*y+v*v),x=this._totalOffset/b,S=this._totalOffset/p;return e[0]+=i*(i>0?x:S),e[1]+=r*(r>0?x:S),e[2]+=n*(n>0?x:S),e[3]+=s*(s<0?x:S),e[4]+=o*(o<0?x:S),e[5]+=a*(a<0?x:S),e}applyToMbs(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this._totalOffset/i;return this._mbs[0]=e[0]+e[0]*r,this._mbs[1]=e[1]+e[1]*r,this._mbs[2]=e[2]+e[2]*r,this._mbs[3]=e[3]+e[3]*this._totalOffset/i,this._mbs}applyToObb(e){const i=e.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,Mh(this._obb.halfSize,e.halfSize,e.quaternion),xe(this._obb.halfSize,this._obb.halfSize,e.center);const n=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*n,this._obb.halfSize[1]+=this._obb.halfSize[1]*n,this._obb.halfSize[2]+=this._obb.halfSize[2]*n,Ce(this._obb.halfSize,this._obb.halfSize,e.center),yy(QK,e.quaternion),Mh(this._obb.halfSize,this._obb.halfSize,QK),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},R9e=class{constructor(e=0){this.offset=e,this.sphere=kn(),this.tmpVertex=I()}applyToVertex(e,i,r){const n=this.objectTransform.transform;let s=n[0]*e+n[4]*i+n[8]*r+n[12],o=n[1]*e+n[5]*i+n[9]*r+n[13],a=n[2]*e+n[6]*i+n[10]*r+n[14];const l=this.offset/Math.sqrt(s*s+o*o+a*a);s+=s*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*s+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*s+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,i){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const n=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*n,i[1]+=i[1]*n,i[2]+=i[2]*n}applyToAabb(e){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const i=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),r=this.offset/i;return this.sphere[0]=e[0]+e[0]*r,this.sphere[1]=e[1]+e[1]*r,this.sphere[2]=e[2]+e[2]*r,this.sphere[3]=e[3]+e[3]*this.offset/i,this.sphere}};const YK=new R9e;function f7(t){return t!=null?(YK.offset=t,YK):null}const JK=new O9e;function M9e(t){return t!=null?(JK.offset=t,JK):null}const KK=new P9e;function $9e(t){return t!=null?(KK.offset=t,KK):null}const C_="terrain",QK=Xh(),NT=1e-5;let I9e=class{constructor(e){this.options=new S9e,this._results=new L9e,this.transform=new A9e,this.tolerance=NT,this.verticalOffset=null,this._ray=ho(),this._rayEnd=I(),this._rayBeginTransformed=I(),this._rayEndTransformed=I(),this.viewingMode=e??Ke.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,i,r){this.resetWithRay(gLe(e,i,this._ray),r)}resetWithRay(e,i){this.camera=i,e!==this._ray&&uD(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===Ke.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,xe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,i,r,n,s){this.point=i,this.filterPredicate=n,this.tolerance=r??NT;const o=f7(this.verticalOffset);if(e&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const i=e.geometries;if(!i)return;const r=e.shaderTransformation,n=f7(this.verticalOffset);for(const s of i){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(r,s.shaderTransformation),st(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),st(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,p,f,y,v)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const b=f?this._results.hud:this._results,x=f?S=>{const P=new E9e(e,a,p,v);S.set(sn.HUD,P,c,u,Os,y)}:S=>S.set(sn.OBJECT,{object:e,geometryId:a,triangleNr:p},c,u,l,y);if((b.min.drapedLayerOrder==null||y>=b.min.drapedLayerOrder)&&(b.min.dist==null||c<b.min.dist)&&x(b.min),this.options.store!==Do.MIN&&(b.max.drapedLayerOrder==null||y<b.max.drapedLayerOrder)&&(b.max.dist==null||c>b.max.dist)&&x(b.max),this.options.store===Do.ALL)if(f){const S=new m7(this._ray);x(S),this._results.hud.all.push(S)}else{const S=new X2(this._ray);x(S),this._results.all.push(S)}}})}}sortResults(e=this._results.all){e.sort((i,r)=>i.dist!==r.dist?(i.dist??0)-(r.dist??0):i.drapedLayerOrder!==r.drapedLayerOrder?(i.drapedLayerOrder??Number.MAX_VALUE)-(r.drapedLayerOrder??Number.MAX_VALUE):(r.drapedLayerGraphicOrder??Number.MIN_VALUE)-(i.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function qh(t){return new I9e(t)}let L9e=class{constructor(){this.min=new X2(ho()),this.max=new X2(ho()),this.hud={min:new m7(ho()),max:new m7(ho()),all:new Array},this.ground=new X2(ho()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},X2=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(pe(KR,this.ray.direction,this.dist),ze(KR)):null}getIntersectionPoint(e){return!!bp(this)&&(pe(KR,this.ray.direction,this.dist),xe(e,this.ray.origin,KR),!0)}getTransformedNormal(e){return fe(_C,this.normal),_C[3]=0,hu(_C,_C,this.transformation),fe(e,_C),Me(e,e)}constructor(e){this.intersector=sn.OBJECT,this.normal=I(),this.transformation=Ne(),this._ray=ho(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=sn.OBJECT,uD(e,this._ray)}set(e,i,r,n,s,o,a){this.intersector=e,this.dist=r,fe(this.normal,n??fG),Qn(this.transformation,s??Os),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){uD(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,fe(this.normal,e.normal),Qn(this.transformation,e.transformation)}},m7=class extends X2{constructor(){super(...arguments),this.intersector=sn.HUD}};function nW(t){return new X2(t)}const KR=I(),_C=gi();function Ege(t,e,i,r){return t.renderCoordsHelper.fromRenderCoords(e.eye,DD,r)!=null&&Ule(i,DD)}function m4(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function Yb(t,e,i,r){const n=t.state.camera.clone();e&&i&&r&&(n.eye=e,n.center=i,n.up=r),D9e(t,n.ray,y0)||fe(y0,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(Io(n.eye,y0)<o){const a=s.collision.enabled;fe(Qy,n.viewForward),pe(Qy,Qy,o),a?n.eye=Ce(DD,y0,Qy):xe(y0,n.eye,Qy);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;a&&c<u&&(Ce(Qy,y0,n.eye),n.eye=l.setAltitude(DD,u,n.eye),xe(y0,n.eye,Qy))}return n.center=y0,n}function eQ(t,e,i){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const r=m4(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,i,t.renderDataExtent,r,F9e),o=s*s;return Io(e,i)>o}function D9e(t,e,i){let r=tQ[t.viewingMode];r||(r=qh(t.state.viewingMode),r.options.backfacesTerrain=!t.state.isGlobal,r.options.invisibleTerrain=!0,tQ[t.viewingMode]=r);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,r,i)||eQ(t,e.origin,i))||!(!t.renderCoordsHelper.intersectManifold(e,0,i)||eQ(t,e.origin,i))||!!n&&N9e(e,i,lr(t.spatialReference).radius)}function N9e(t,e,i){const r=Re(t.origin,t.origin)-i*i,n=r>0?Math.sqrt(r)/3:1;return pe(e,t.direction,n/ze(t.direction)),xe(e,e,t.origin),!0}const tQ={},DD=I(),y0=I(),Qy=I(),F9e={near:0,far:0};function xS(t,e,i=Rh.EYE){const r=t.state.constraints;if(!r.collision.enabled)return!1;const n=m4(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+r.collision.elevationMargin;if(s>=o)return!1;const a=ze(e.eye);if(Ce(QR,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(k9e,o,e.eye),i===Rh.EYE_AND_CENTER)e.center=xe(QR,e.eye,QR);else if(i===Rh.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=pe(QR,e.center,l)}return!0}var Rh;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Rh||(Rh={}));const QR=I(),k9e=I();function by(t,e,i){t.worldUpAtPosition(e,iQ),Ce(X6,i,e);const r=ze(X6);return r===0?0:qs(Re(X6,iQ)/r)}const iQ=I(),X6=I();function Age(t,e,i=vy,r=!0){yC.eyeCenterDistance=0,yC.requiresTwoSteps=!1;const n=sW(t,e,i,void 0,yC);if(n===0)return!1;switch(Su(eM,-n,e.viewRight),i.tiltMode){case mo.LOOK_AROUND:st(v0,e.viewForward,eM),pe(v0,v0,yC.eyeCenterDistance),e.center=xe(E_,e.eye,v0);break;case mo.TUMBLE:Ce(v0,e.center,e.eye),st(v0,v0,eM),e.eye=Ce(E_,e.center,v0);break;default:i.tiltMode}return e.up=st(E_,e.up,eM),!yC.requiresTwoSteps||!r||Age(t,e,i,!1)}function sW(t,e,i=vy,r=vy,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,Z9e);return q9e(t,i,o),r.interactionType===di.TUMBLE&&qP(r.selection,Zr.ALTITUDE)&&Pge(t,r.interactionStartCamera,o),i.tiltMode===mo.LOOK_AROUND||r.tiltMode===mo.LOOK_AROUND?z9e(t,e,o,n):U9e(t,e,o)}function U9e(t,e,i){const r=by(t.renderCoordsHelper,e.center,e.eye),n=r-$e(r,i.min,i.max);return ZP(n)?n:0}function z9e(t,e,i,r){switch(r&&(r.requiresTwoSteps=!1),t.viewingMode){case"global":return V9e(t,e,i,r);case"local":return B9e(t,e,i,r)}}function B9e(t,e,i,r){const n=by(t.renderCoordsHelper,e.center,e.eye),s=$e(n,i.min,i.max),o=n-s;if(!ZP(o))return 0;if(r){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=e.distance}return o}function V9e(t,e,i,r){const n=G9e(t,e,X9e),s=$e(n.tiltAtCenter,i.min,i.max);if(!ZP(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=j9e(n),a=H9e(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=W9e(n,o)),r&&(r.eyeCenterDistance=g7(n,o)),a}function G9e(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=r+lr(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,r,E_);return i.eyeCenterDistance=e.distance,i.centerIsOnSurface=!1,s!=null?(i.eyeCenterDistance=Nr(e.eye,s),i.tiltAtCenter=by(t.renderCoordsHelper,s,e.eye),i.centerIsOnSurface=!0):t.state.isLocal?i.tiltAtCenter=by(t.renderCoordsHelper,e.center,e.eye):(gS(z5(B5,n),e.ray,E_),i.eyeCenterDistance=Nr(e.eye,E_),i.tiltAtCenter=qs(-Re(e.viewForward,Me(E_,E_)))),i.radius=n,i.eyeRadius=ze(e.eye),i.constraints=t.state.constraints,i}function ZP(t){return Math.abs(t)>1e-9}function j9e(t){const{constraints:e,eyeCenterDistance:i,tiltAtCenter:r}=t;let n=r,s=e.clampTilt(i,r);const o=g7(t,s);if(e.clampTilt(o,r)===s)return s;let a=0;for(;a<10&&ZP(s-n);){const l=(n+s)/2,c=g7(t,l);ZP(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function g7(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const i=Math.PI-$e(e,0,Math.PI),r=Nh(t.radius/t.eyeRadius*Math.sin(i)),n=Math.PI-i-r,s=Math.sin(n)/Math.sin(i);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*t.eyeRadius}return s*t.eyeRadius}function H9e(t,e){const i=Nh(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),r=Nh(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?i-r:r-i}function W9e(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function q9e(t,e,i){if(e.interactionType===di.NONE)return;const{interactionStartCamera:r,interactionFactor:n}=e;if(!r)return;const{min:s,max:o}=i,a=sW(t,r,vy,e),l=a===0?0:by(t.renderCoordsHelper,r.center,r.eye);i.min=s,i.max=o,e.interactionType===di.TUMBLE?(qP(e.selection,Zr.ALTITUDE)&&Pge(t,r,i),LD(a,l,!0,n,rQ,i)):LD(a,l,!1,n,rQ,i)}function Pge(t,e,i){const r=t.state.constraints;if(t.state.isLocal||!r.altitude||!e)return;const n=ba(e.center),s=Math.sqrt(n),o=e.distance,a=lr(t.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),p=(c*c-o*o-n)/(-2*s*o);i.min=Math.max(i.min,Math.min(Math.PI-qs(p),i.max)),i.max=Math.min(i.max,Math.PI-qs(u))}const v0=I(),eM=Ne(),E_=I(),rQ=Qt(5),Z9e={min:0,max:0},X9e={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},yC={eyeCenterDistance:0,requiresTwoSteps:!1};function Y9e(t){return t}const g4=t=>t*t,oW=t=>1-g4(1-t),J9e=t=>t<.5?g4(2*t)/2:(oW(2*(t-.5))+1)/2,aW=t=>t*t*t,Oge=t=>1-aW(1-t),Rge=t=>t<.5?aW(2*t)/2:(Oge(2*(t-.5))+1)/2,lW=t=>t*t*t*t,Mge=t=>1-lW(1-t),K9e=t=>t<.5?lW(2*t)/2:(Mge(2*(t-.5))+1)/2,cW=t=>t*t*t*t*t,$ge=t=>1-cW(1-t),Q9e=t=>t<.5?cW(2*t)/2:($ge(2*(t-.5))+1)/2,uW=t=>1-Math.cos(t*Math.PI/2),Ige=t=>1-uW(1-t),eze=t=>t<.5?uW(2*t)/2:(Ige(2*(t-.5))+1)/2,hW=t=>2**(10*(t-1)),K3=t=>1-hW(1-t),tze=t=>t<.5?hW(2*t)/2:(K3(2*(t-.5))+1)/2,dW=t=>-(Math.sqrt(1-t*t)-1),Lge=t=>1-dW(1-t),ize=t=>t<.5?dW(2*t)/2:(Lge(2*(t-.5))+1)/2;function Kh(t){const e=2*(t-Math.sqrt((t-1)*t)),i=e/2/t;return r=>r<i?t*r*r:e*r-e+1}function Qh(t,e){return(i,r)=>i<e?e*t(i/e,r):1-t((1-i)/(1-e),r)*(1-e)}const rze=Qh(Kh(1),1),nze=Qh(Kh(1),0),Dge=Qh(Kh(1),.5),sze=Qh(Kh(2),1),oze=Qh(Kh(2),0),aze=Qh(Kh(2),.5),lze=Qh(Kh(3),1),cze=Qh(Kh(3),0),uze=Qh(Kh(3),.5),hze=Qh(Kh(4),1),dze=Qh(Kh(4),0),pze=Qh(Kh(4),.5),fze={linear:Y9e,"in-quad":g4,"out-quad":oW,"in-out-quad":J9e,"in-coast-quad":rze,"out-coast-quad":nze,"in-out-coast-quad":Dge,"in-cubic":aW,"out-cubic":Oge,"in-out-cubic":Rge,"in-coast-cubic":sze,"out-coast-cubic":oze,"in-out-coast-cubic":aze,"in-quart":lW,"out-quart":Mge,"in-out-quart":K9e,"in-coast-quart":lze,"out-coast-quart":cze,"in-out-coast-quart":uze,"in-quint":cW,"out-quint":$ge,"in-out-quint":Q9e,"in-coast-quint":hze,"out-coast-quint":dze,"in-out-coast-quint":pze,"in-sine":uW,"out-sine":Ige,"in-out-sine":eze,"in-expo":hW,"out-expo":K3,"in-out-expo":tze,"in-circ":dW,"out-circ":Lge,"in-out-circ":ize};function Xn(t,e,i=yze,r=e){r!==e&&r.copyFrom(e),r.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<vze;a++){let l=0;for(const c of _ze)if(qP(i.selection,c.type)){const u=Math.abs(c.error(t,r,i));c.apply(t,r,i)&&(n=!0,l+=u)}if(l===0)break}const s=qP(i.selection,Zr.COLLISION),o=mze(i.interactionType,t);return s&&xS(t,r,o)&&(n=!0),n&&r.computeUp(t.state.viewingMode),n}function mze(t,e){switch(t){case di.PAN:return Rh.EYE_AND_CENTER;case di.ASCEND:return e.state.isGlobal?Rh.EYE_AND_CENTER_SCALE:Rh.EYE_AND_CENTER;default:return Rh.EYE}}function jd(t){const e=Math.min(1,t/150);return Rge(e)}function gze(t,e,i){return sW(t,e,i)*e.distance}const _ze=[{type:Zr.TILT,error:gze,apply:Age},{type:Zr.ALTITUDE,error:tW,apply:l9e},{type:Zr.DISTANCE,error:iW,apply:_9e}],yze={selection:Zr.ALL,interactionType:di.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:mo.TUMBLE},vze=5,Uc=I(),jl=I(),b0=I(),la=I(),ev=I(),bze=I(),zc={upward:Ge(0,0,1),forward:Ge(0,1,0),sideway:Ge(1,0,0)},nQ=on();let sQ=class{constructor(e=Ke.Global){this.viewingMode=e,this.center=I(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=Kn(zc.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Ke.Global){const s=(ze(this.center)+ze(e.center))/2;i.pan=bI(this.center,e.center)*s}else i.pan=Nr(this.center,e.center);let r=Math.abs(e.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const n=Math.abs(e.pitch-this.pitch);return i.rotate=Math.max(r,n),i.sourceZoom=this.distance,i.targetZoom=e.distance,i}interpolate(e,i,r){this.viewingMode===Ke.Global?ILe(e.center,i.center,r.pan,this.center):pr(this.center,e.center,i.center,r.pan),this.distance=isFinite(i.distance)?Bt(e.distance,i.distance,r.zoom):e.distance,this.pitch=Bt(e.pitch,i.pitch,r.rotate);let n=e.yaw;const s=i.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Bt(n,s,r.rotate)}copyFrom(e){fe(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,fe(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const i=this._lookAtOrientation(e.center,nQ);fe(this.center,e.center),Ce(la,e.center,e.eye),yc(la,la,i),yc(ev,e.up,i),this.distance=ze(la),this.distance!==0&&(la[0]/=this.distance,la[1]/=this.distance,la[2]/=this.distance),this.pitch=this._eyeUpToPitch(la),this.yaw=this._eyeUpToYaw(la,ev),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const i=this._lookAtOrientation(this.center,nQ);Hh(i,i),this._axisAngleVec3(zc.sideway,this.pitch-Math.PI/2,zc.forward,la),this._axisAngleVec3(zc.upward,this.yaw,la),this._axisAngleVec3(zc.sideway,this.pitch-Math.PI/2,zc.upward,ev),this._axisAngleVec3(zc.upward,this.yaw,ev),pe(la,la,this.distance),yc(la,la,i),yc(ev,ev,i),e.center=this.center,e.eye=Ce(la,this.center,la),e.up=ev}_axisAngleVec3(e,i,r,n=r){const s=Math.cos(i),o=Math.sin(i);return pe(Uc,r,s),Rt(jl,e,r),pe(jl,jl,o),pe(b0,e,(1-s)*Re(e,r)),xe(n,xe(n,Uc,jl),b0)}_lookAtOrientation(e,i=on()){return this._upAtLookAt(e,b0),Rt(Uc,this.lookAtDirection,b0),Me(Uc,Uc),Uc[0]===0&&Uc[1]===0&&Uc[2]===0&&fe(Uc,zc.sideway),Rt(jl,b0,Uc),Me(jl,jl),i[0]=Uc[0],i[1]=jl[0],i[2]=b0[0],i[3]=Uc[1],i[4]=jl[1],i[5]=b0[1],i[6]=Uc[2],i[7]=jl[2],i[8]=b0[2],i}_upAtLookAt(e,i){return this.viewingMode===Ke.Local?fe(i,zc.upward):Me(i,e)}_eyeUpToPitch(e){return Math.PI-bI(zc.upward,e)}_eyeUpToYaw(e,i){const r=bze;return Math.abs(i[2])<.5?(fe(r,i),e[2]>0&&pe(r,r,-1)):fe(r,e),Rt(jl,r,zc.upward),Me(jl,jl),bI(zc.sideway,jl,zc.upward)}};const ND={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let wze=class Nge{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:ND.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new Nge(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,i,r){this.source!==e&&this.source.copyFrom(e),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:ND.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const i=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},xze=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,i)=>e+i.time,0)}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1),e*=this.time;let r=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(i=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,i),s.hasPan&&!isNaN(i.pan)&&isFinite(s.compared.pan)?i.pan=(r+l.compared.pan*i.pan)/s.compared.pan:i.pan=1,s.hasRotate&&!isNaN(i.rotate)&&isFinite(s.compared.rotate)?i.rotate=(n+l.compared.rotate*i.rotate)/s.compared.rotate:i.rotate=1,s.hasZoom&&!isNaN(i.zoom)&&isFinite(l.compared.targetZoom)){const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;i.zoom=(c-u)/(p-u)}else i.zoom=1;return i}e-=a.time,r+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,i,r){return e.interpolateComponentsAt(i,r)}},Y6=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,i=e.compared,r=i.sourceZoom,n=i.targetZoom;this._zoomSign=r>n?1:-1,this._panPixelsAtSource=i.pan*e.source.pixelsPerPanAtZoom(r);const s=(e.source.pixelsPerRotateAtZoom(r)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=i.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;r&&(n&&(o=(i/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:r?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:r?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=e*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-e-i)/(r-i)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*e*this._time)-1))/(i*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,i){e=Math.min(Math.max(e,0),1);const r=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return i?(i.zoom=r,i.pan=n,i.rotate=s):i={zoom:r,pan:n,rotate:s},i}};function Tze(t,e,i){const r=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(r);return-t.halfWindowSize*(i.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function Sze(t,e,i){const r=1/e,n=Math.log(t.compared.sourceZoom*r),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*r*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function Cze(t,e,i){const r=e-t.compared.sourceZoom,n=1/r,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(i.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(r))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Eze(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function Aze(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Pze(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function Oze(t,e,i){return-t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function Rze(t,e,i){return t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function Mze(t,e,i){return-2*t.compared.pan*t.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function $ze(t,e,i){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function Ize(t,e,i){const r=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-i.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*r*n*s*a+t.halfWindowSize*r*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function Lze(t,e,i){const r=e-t.compared.targetZoom,n=1/r,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+i.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(r*r)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function Dze(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function Nze(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function Fze(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function kze(t){const e=Math.LN2*t.compared.pan,i=t.compared.sourceZoom-t.compared.targetZoom,r=t.halfWindowPanAtZoom(i),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*r);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-r):n*(e+r)}function Uze(t,e){let i=zze(t,e);const r={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=r.ascensionFactor===0,s=r.descensionFactor===0,o=n?Eze:Tze,a=n?Aze:Sze,l=n?Pze:Cze,c=s?Dze:$ze,u=s?Nze:Ize,p=s?Fze:Lze,f=R=>o(t,R,r)+Oze(t,R,r)+c(t,R,r),y=R=>a(t,R,r)+Rze(t,R,r)+u(t,R,r),v=R=>l(t,R,r)+Mze(t,R,r)+p(t,R,r);let b=f(i);const x=kze(t);let S;const P=e.maximumIterations||20,C=e.maximumDistance!=null?e.maximumDistance:1/0;for(S=0;S<P;S++){const N=(y(i)+1e-6)/v(i);if(isNaN(N)||i>=C&&N<0){if(!isFinite(C))return null;i=C,b=f(i);break}if(i-=N,i<t.compared.sourceZoom||i<t.compared.targetZoom)return null;const $=f(i);if(Math.abs($-b)/b<=.005)break;b=$}return b>x*(1-.3)||i<t.compared.sourceZoom||i<t.compared.targetZoom?null:i}function zze(t,e){const i=Math.max(t.compared.sourceZoom,t.compared.targetZoom),r=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return r<i?e.maximumDistance!=null?i+(e.maximumDistance-i)/2:1.5*i:e.maximumDistance?Math.min(e.maximumDistance,r):r}let Bze=class extends xze{constructor(e,i){super(),this._preallocSegments=[new Y6,new Y6,new Y6],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,i)}update(e,i){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let r=null;i&&i.apex&&(r=Uze(e,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i==null?void 0:i.apex)}segmentInterpolateComponentsAt(e,i,r){return r=e.interpolateComponentsAt(i,r),e===this._ascensionSegment?r.zoom=oW(r.zoom):e===this._descensionSegment&&(r.zoom=g4(r.zoom)),r}_updateWithApex(e,i){const[r,n,s]=this._preallocSegments,o=(i==null?void 0:i.ascensionFactor)??.5,a=Math.min(1-o,(i==null?void 0:i.ascensionFactor)!=null&&i.descensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=e,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const Vze={zoom:0,pan:0,rotate:0};let Gze=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new wze(e),this.path=new Bze}update(e,i,r){this.definition.update(e,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(vae(isFinite(this.path.time)?this.path.time:0),r),this._easing=r.easing??(this._time>=1e3?Dge:K3)}cameraAt(e,i){i=i||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const r=this.path.interpolateComponentsAt(e,Vze);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(e){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(e,this._time)-i)/(r-i)}_applyTimeSettings(e,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?e=i.duration:i.speedFactor!=null&&(e=e/r);const n=i.minDuration!=null?i.minDuration:ND.minDuration/r,s=i.maxDuration!=null?i.maxDuration:ND.maxDuration/r;return Math.min(Math.max(n,e),s)}};const jze=I();let Hze=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new Gze(()=>new sQ(e)),this._current=new sQ(e)}update(e,i,r){const n=this._animation.definition.source,s=this._animation.definition.target,o=Ce(jze,i.center,e.center),a=ze(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),fe(n.lookAtDirection,o),fe(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(i),this._current.copyFrom(n),this._animation.update(n,s,r),this.currentTime=0,e.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(e,i){return this._animation.cameraAt(e,this._current),i=i||new It,this._current.copyToRenderCamera(i),i}step(e,i){return this.finished||(this.currentTime=this.currentTime+vae(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}};var dn;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(dn||(dn={}));let ng=class extends ke{constructor(e){super(e),this.state=dn.Ready}get active(){return this.state===dn.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=dn.Stopped,!0)}finishController(){this.state=dn.Finished}get steppingFinished(){return!1}};d([m({constructOnly:!0})],ng.prototype,"view",void 0),d([m({readOnly:!0})],ng.prototype,"active",null),d([m()],ng.prototype,"state",void 0),d([m({readOnly:!0})],ng.prototype,"isInteractive",null),ng=d([J("esri.views.3d.state.controllers.CameraController")],ng);let XP=class extends ng{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Qi()),this._asyncResult=null),this.state===dn.Finished||this.state===dn.Stopped?(HN(e),this.state===dn.Finished?e.resolve():e.reject(Qi())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=dn.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==dn.Ready&&this.state!==dn.Running||(this.viewAnimation.state===RT.State.FINISHED?this.finish():this.viewAnimation.state===RT.State.STOPPED&&(this.state=dn.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===dn.Finished?this.viewAnimation.finish():this.state===dn.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===dn.Finished?this._asyncResult.resolve():this._asyncResult.reject(Qi()))}finish(){this.finishController()}};XP=d([J("esri.views.3d.state.controllers.AnimationController")],XP);let dg=class extends XP{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new Hze(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new RT}get isInteractive(){return this.mode==="interaction"}begin(e,i){this._hasTarget=!0;const r=this.animationSettings(i);tM.copyFrom(this.view.state.camera);const n=qh(this.view.state.viewingMode);this.intersectionHelper.intersectRay(tM.ray,n,oQ)&&(tM.center=oQ),this.animation.update(tM,e,r),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,i){this._hasTarget&&this.animation.step(e,i)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?fze[e.easing]:e.easing}}};d([m({constructOnly:!0})],dg.prototype,"mode",void 0),d([m({readOnly:!0})],dg.prototype,"isInteractive",null),dg=d([J("esri.views.3d.state.controllers.PointToPointAnimationController")],dg);const tM=new It,oQ=I();function _4(t=qze){return[t[0],t[1],t[2],t[3]]}function YP(t,e){return Wze(t[0],t[1],t[2],e,Zj.get())}function Wze(t,e,i,r,n=_4()){return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function pW(t,e,i){return Rt(i,t,e),Me(i,i),i[3]=U5(t,e),i}const qze=[0,0,1,0];function Fge(t,e,i){return Zze(t,t.screenToRender(e,Qe.get()),i)}function Zze(t,e,i){const r=Is(Qe.get(),e);if(r[2]=0,!t.unprojectFromRenderScreen(r,i.origin))return null;const n=Is(Qe.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,Qe.get());return s==null?null:(Ce(i.direction,s,i.origin),i)}function TS(t,e,i){return fW(t,t.screenToRender(e,Qe.get()),i)}function fW(t,e,i){fe(i.origin,t.eye);const r=me(Qe.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(r,Qe.get());return n==null?null:(Ce(i.direction,n,i.origin),i)}function mW(t,e,i,r){const n=TS(e,i,Xze);return My(t,n,r)}const Xze=ho();var FT;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(FT||(FT={}));const kge=30,FD=[1,3e8],y4=80,Uge=8,zge=200,Bge=1508e5,Vge=5,Gge=50,Yze=5,Jze=10,J6=90,Jb={exclude:new Set([C_])};function j1(t,e,i){return i[0]=e[0]/(t.fullWidth/t.pixelRatio),i[1]=e[1]/(t.fullHeight/t.pixelRatio),i}function _7(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function wy(t,e,i){const r=Su(Xj.get(),i[3],i);r==null||tde(r,Os)||(Ce(fr,t.eye,e),st(fr,fr,r),t.eye=xe(fr,fr,e),Ce(fr,t.center,e),st(fr,fr,r),t.center=xe(fr,fr,e),t.up=st(fr,t.up,r))}function Kze(t,e,i,r){return Wb(t,Fge(e,i,yW),r)}function y7(t,e,i,r){return Wb(t,TS(e,i,yW),r)}function gW(t,e,i,r){const n=Qe.get();let s=1-i;Ce(n,e,t.eye);const o=ze(n);let a=o*(1-s);s>=0&&a<r&&(a=r,s=-(a-o)/o),Math.abs(o-a)<1e-6||(pe(n,n,s),t.eye=xe(fr,t.eye,n),t.center=pr(fr,t.center,e,s))}function jge(t,e,i){e.getScreenCenter(aQ),mW(t,e,aQ,fr)&&(e.center=fr);const r=e.distance,n=r*i;if(Math.abs(r-n)<1e-6)return;const s=pe(Qe.get(),e.viewForward,n);e.eye=Ce(fr,e.center,s)}const aQ=fn();function K6(t,e){me(e,0,0,0);for(const i of t)xe(e,e,i);pe(e,e,1/t.length)}function zI(t,e,i,r){return Math.sin(t/ze(e))*(i+r.radius)}function lQ(t,e,i,r){return zI(Math.PI/2,e,i,r)+(t-Math.PI/2)}var po;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(po||(po={}));const cQ={Elevation:3e4,Angle:Qt(16)},iM={Pole:.95,Angle:Qt(18),Tilt:45},Hge=Qt(80);function Wge(t,e,i,r,n,s){const o=I(),a=kn();let l=!0,c=!0;return t.intersectScreen(i,o,s)?a[3]=ze(o):(c=!1,e.aboveGround&&n!==FT.Ellipsoid?a[3]=Math.max(ze(e.center),.9*r.radius):a[3]=ze(e.eye)-e.relativeElevation,n===FT.Silhouette?JP(a,e,i,o):l=mW(a,e,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function v4(t,e,i){return ze(t.eye)-i.radius>cQ.Elevation?po.Horizontal:(TS(t,e,_Q),-Math.sign(t.relativeElevation)*(.5*Math.PI+U5(t.eye,_Q.direction))<cQ.Angle?po.Vertical:po.Horizontal)}function qge(t,e,i){Ce(Q6,i,e),t.eye=Ce(fr,t.eye,Q6),t.center=Ce(fr,t.center,Q6)}const Q6=I();function JP(t,e,i,r){const n=TS(e,i,yW);return n!=null&&(gS(t,n,rM),My(t,n,r)?!(Io(rM,n.origin)<Io(r,n.origin))||(fe(r,rM),!1):(Ce(kw,e.eye,e.center),Me(kw,kw),ope(kw,-Re(Me(kw,kw),rM),uQ),Wb(uQ,n,r),!1))}const rM=I(),kw=I(),uQ=Yi();function Zge(t,e,i,r,n,s){let o=0;if(Rt(zD,t,e),Ce(aM,t,e),ze(t)<=n||!r.aboveGround){Rt(i,aM,r.eye);const a=Re(t,e)/(ze(t)*ze(e));if(a<.9999)o=qs(a);else{const c=ze(Rt(I(),t,e))/(ze(t)*ze(e));o=Nh(c)}const l=Math.cos($e(oy.normalize(Qt(s)),0,Hge));o=-o-Math.max(0,ze(e)-n)/(l*n)}else Ce(hQ,r.eye,r.center),Rt(i,aM,hQ),o=-ze(aM)/n;return Me(i,i),pe(i,i,ze(zD)),o}const hQ=I();function dQ(t,e,i,r){let n,s;const o=Math.cos($e(oy.normalize(Qt(r)),0,Hge));return n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):qs(e/i),s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):qs(t/i),(s-n)*i}function Qze(t,e,i,r,n,s,o,a,l,c){const u=dQ(t[2],e[2],s[3],a),p=l?dQ(t[0],e[0],s[3],180):e[0]-t[0],f=Math.sin(o)*p-Math.cos(o)*u,y=Math.cos(o)*p+Math.sin(o)*u;Me(fr,n);const v=l?f/Math.sqrt(Math.abs(s[3]**2-Re(i,fr)**2)):f/s[3],b=y/Math.sqrt(Math.abs(s[3]**2-Re(i,r)**2));bi(c,v,b)}function Xge(t,e,i,r,n,s,o,a,l,c){Rt(zD,t,e),Fz(s.up,s.eye,nM,sM,oM),Fz([0,0,1],s.eye,vg,K_,Qge),fe(i,K_),fe(r,vg),Me(i,i),pe(i,i,ze(zD)),LY(t,Me(sM,sM),Me(oM,oM),Me(nM,nM),pQ),LY(e,sM,oM,nM,fQ),Qze(pQ,fQ,t,vg,K_,o,a,l,c,n)}function eBe(t,e,i,r,n,s,o){Su(kD,n,r),Su(UD,o,s),Cr(C2,kD,UD),Ce(e,t,i),st(e,e,C2),xe(e,e,i)}function Yge(t,e,i,r,n,s){Su(kD,r,i),Su(UD,s,n),Cr(C2,kD,UD),Ce(fr,t.eye,e),st(fr,fr,C2),t.eye=xe(fr,fr,e),Ce(fr,t.center,e),st(fr,fr,C2),t.center=xe(fr,fr,e),Ce(fr,t.up,e),st(fr,fr,C2),t.up=xe(fr,fr,e)}function _W(t,e,i,r,n,s){return(Math.abs(r)>Math.PI-iM.Angle||Math.abs(r)<iM.Angle)&&(Math.abs(t[2])<i*iM.Pole||Math.abs(e)>i)&&s.aboveGround&&n<iM.Tilt}function Jge(t,e,i,r,n,s){if(s)pW(i,r,mQ),wy(e,t,mQ);else{const o=Zge(i,r,gQ,e,t[3],n);wy(e,t,YP(gQ,o))}}function Kge(t,e,i,r,n,s,o){const a=o?20:1,l=1e-12;let c,u;fe(tv,r),lM.copyFrom(e);for(let p=0;p<a&&Io(i,tv)>l&&(c=Io(i,tv),Xge(i,tv,K_,vg,vC,lM,t,n,s,o),Yge(lM,t,vg,vC[1],K_,vC[0]),eBe(tv,tv,t,vg,vC[1],K_,vC[0]),u=Io(i,tv),u<c||p===0);p++)e.copyFrom(lM)}function tBe(t,e,i,r,n,s,o){_W(i,Re(e.up,i),t[3],-oy.normalize(Qt(n)),s,e)?Kge(t,e,i,r,-oy.normalize(Qt(n)),s,o):Jge(t,e,i,r,s,o)}function iBe(t,e,i,r,n,s){const{eye:o}=t;Fz([0,0,1],o,vg,K_,Qge);const a=e.translation[0]*i.pan,l=n.mode==="zoom"?0:e.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-Re(t.center,vg)**2/ze(t.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,p=-Math.cos(s)*l+Math.sin(s)*a;switch(vc(r.pan.matrix,r.pan.matrix,u,vg),r.pan.enabled=!0,n.mode){case"pan":vc(r.pan.matrix,r.pan.matrix,p,K_),r.pan.enabled=!0;break;case"zoom":r.zoom=-e.translation[1]*i.zoom}}function rBe(t,e,i,r,n){const{eye:s,viewRight:o}=t,a=Rt(Qe.get(),o,s),l=e.translation[0]*i.pan;switch(l!==0&&(vc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*i.pan;c!==0&&(vc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-e.translation[1]*i.zoom}}function nBe(t,e,i,r,n,s,o,a,l){_W(t.center,Re(t.up,t.center),ze(t.center),-oy.normalize(Qt(s)),o,e)?iBe(e,i,r,a,l,-oy.normalize(Qt(n))):rBe(e,i,r,a,l)}const vg=I(),K_=I(),Qge=I(),nM=I(),sM=I(),oM=I(),pQ=I(),fQ=I(),vC=it(),mQ=_4(),kD=Ne(),UD=Ne(),C2=Ne(),tv=I(),fr=I(),aM=I(),lM=new It,zD=I(),gQ=I(),yW={origin:I(),direction:I()},_Q={origin:I(),direction:I()},yQ=.6,ek=4,sBe=60;let BD=class extends dg{constructor(){super(...arguments),this._zoomLocation=I(),this._tmpCamera=new It,this._tmpViewDir=I(),this._tmpRayDir={origin:I(),direction:I()},this._targetOnSphere=I(),this._tmpCenter=I(),this._constraintOptions={selection:Zr.ALL_EXCEPT_COLLISION,interactionType:di.ZOOM,interactionFactor:null,interactionStartCamera:new It,interactionDirection:null,tiltMode:mo.TUMBLE},this._sphere=kn()}initialize(){this._intersector=qh(this.view.state.viewingMode)}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(i,this._zoomLocation,this.view.map.ground.opacity===0?Jb:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(r.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:fe(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,i,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:K3}}_updateCamera(e,i,r,n,s){const o=lr(this.view.spatialReference),a=v4(e,n,o),l=Math.abs(this.view.camera.position.z);Me(uM,e.eye),pe(uM,uM,-1),TS(e,n,this._tmpRayDir),Me(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=$e(Math.min(Uge,1/Math.abs(Re(uM,this._tmpRayDir.direction)))*l,zge,Bge);if(a===po.Horizontal){let u=yQ**i;this._sphere[3]=ze(r),Ce(this._tmpViewDir,e.center,e.eye);const p=Math.min(ze(this._tmpViewDir),c);let f=p*u;if(u<=1&&f<ek&&(f=ek,u=f/p),Math.abs(p-f)<1e-6)return;const y=ze(e.center);if(this._sphere[3]!==y){const v=this._sphere[3]+u*(y-this._sphere[3]);e.center=pe(cM,e.center,v/y)}pe(this._tmpViewDir,this._tmpViewDir,-u),e.eye=xe(cM,e.center,this._tmpViewDir),Xn(this.view,e,this._constraintOptions),Io(r,e.center)>1e-12&&mW(this._sphere,e,n,this._targetOnSphere)&&tBe(this._sphere,e,r,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=yQ**Math.abs(i);const p=i>0?1:-1;Ce(this._tmpViewDir,r,e.eye);const f=ze(this._tmpViewDir),y=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,sBe);let v=y??c;v=s&&i>0?Math.min(v,f):v,pe(this._tmpRayDir.direction,this._tmpRayDir.direction,v),xe(r,this._tmpRayDir.origin,this._tmpRayDir.direction);let b=v*u;const x=Math.max(ek,1.01*e.nearFar[0]);if(i>0&&b<x&&(b=x,u=b/v),Math.abs(v-b)<1e-6)return;pe(this._tmpRayDir.direction,this._tmpRayDir.direction,p*(1-u)),e.eye=xe(cM,e.eye,this._tmpRayDir.direction),e.center=xe(cM,e.center,this._tmpRayDir.direction)}xS(this.view,e)}};BD=d([J("esri.views.3d.state.controllers.global.ZoomStepController")],BD);const cM=I(),uM=I(),oBe=.6,aBe=4,lBe=60;let VD=class extends dg{constructor(){super(...arguments),this._zoomLocation=I(),this._tmpCamera=new It,this._tmpRayDir=I(),this._tmpCenter=I(),this._constraintOptions={selection:Zr.ALL,interactionType:di.ZOOM,interactionFactor:null,interactionStartCamera:new It,interactionDirection:null,tiltMode:mo.TUMBLE}}zoomStep(e,i){if(!this.active)return;const r=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(r.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(r.camera);const s=qh(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(i,this._zoomLocation,this.view.map.ground.opacity===0?Jb:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:fe(this._zoomLocation,this._tmpCamera.center);const a=oBe**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i[0],i[1],this.view.state.camera,lBe);Ce(hM,this._tmpCamera.eye,this._zoomLocation),Me(hM,hM);const c=$e(Math.min(Uge,1/Math.abs(Re(cBe,hM)))*Math.abs(this.view.camera.position.z),zge,Bge);if(l=l??c,l){const u=I();Ce(u,this._zoomLocation,this._tmpCamera.eye),(l<ze(u)||!o)&&(Me(u,u),xe(this._zoomLocation,this._tmpCamera.eye,pe(u,u,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:K3}}_updateCamera(e,i,r){Ce(this._tmpRayDir,r,e.eye);const n=ze(this._tmpRayDir);let s=n*i;const o=i<=1,a=Math.max(aBe,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,i=s/n),Math.abs(n-s)<1e-6||(pe(this._tmpRayDir,this._tmpRayDir,i),e.eye=Ce(vQ,r,this._tmpRayDir),e.center=pr(vQ,e.center,r,1-i),Xn(this.view,e,this._constraintOptions)))}};VD=d([J("esri.views.3d.state.controllers.local.ZoomStepController")],VD);const vQ=I(),cBe=Ge(0,0,1),hM=I();function uBe(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function vW(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let hBe=class extends ko{constructor(e,i){super(!0),this._view=e,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(e){const i=e.data;if(uBe(i,"primary")){const r=this._view.state.isGlobal?new BD({view:this._view,mode:"animation"}):new VD({view:this._view,mode:"animation"});this._view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),fn(i.x,i.y)),e.stopPropagation()}}};function dBe(t,e,i){return t===Ke.Global?new fBe(i):new pBe(e,i)}let pBe=class{constructor(e,i){this._elevationProvider=e,this._referenceEllipsoid=lr(i),this._unitInMeters=al(i,this._referenceEllipsoid.metersPerDegree)}compute(e,i,r,n,s){var C;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(C=this._elevationProvider)==null?void 0:C.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(r=r??new Ar({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(u.x,u.y,u.z);Ce(iv,i,e),Uw[0]=iv[0]>0?r.xmax:r.xmin,Uw[1]=iv[1]>0?r.ymax:r.ymin,Uw[2]=iv[2]>0?p/2:-p/2,Ce(Uw,Uw,e),Me(iv,iv);const f=1.1*Re(Uw,iv)*this._unitInMeters,y=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),v=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),b=v*_Be*this._unitInMeters,x=v*yBe*this._unitInMeters,S=$e((o-x)/(b-x),0,1)**3,P=Math.min(Bt(y,f,S),y)*Math.max(Math.log(Math.abs(l)),1);return e0e(Math.min(P,Math.max(34064e4,p))/this._unitInMeters,mBe,this._unitInMeters,s)}},fBe=class{constructor(e){this._referenceEllipsoid=lr(e)}compute(e,i,r,n,s){s||(s={near:0,far:0});const o=ze(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),u=Math.max(c,Math.abs(a)),p=Math.sqrt(u*(u+2*l)),f=o+this._referenceEllipsoid.radius;return e0e(1.2*Bt(p,f,wH(u)),$e(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function e0e(t,e,i,r){const n=gBe/i;return t/e>n?(r.far=t,r.near=r.far/e):(r.near=n,r.far=r.near*e),r}const mBe=2e4,gBe=2,_Be=.001,yBe=1e-4,Uw=I(),iv=I();let BI=class extends ke{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const i=this.view.state.camera;e.spatialReference!=null&&Ege(this.view,i,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>xS(this.view,e,Rh.EYE_AND_CENTER))}};d([m({constructOnly:!0})],BI.prototype,"view",void 0),BI=d([J("esri.views.3d.state.ElevationCollisionConstraint")],BI);let JE=class extends ke{constructor(e){super(e),this.nearFarHeuristic=dBe(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([Pe(()=>{var e,i,r,n;return[(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.near,(n=(r=this.view.constraints)==null?void 0:r.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),Pe(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:i.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),Pe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),gr),Pe(()=>{var e,i,r,n;return[(i=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:i.min,(n=(r=this.view.constraints)==null?void 0:r.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),gr),Pe(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.max},()=>this._updateTiltMax(),gr),Pe(()=>{var e,i;return(i=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:i.mode},()=>this._updateTilt(),gr),Pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),gr),Pe(()=>{var e,i,r,n,s,o;return[(r=(i=(e=this.view.map)==null?void 0:e.ground)==null?void 0:i.navigationConstraint)==null?void 0:r.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),gr)]),this.view.state.isLocal&&this.addHandles(Pe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),ar)),this._updateNearFar(),this.view.state.viewingMode!==Ke.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new BI({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var i;const e=(i=this.view.constraints)==null?void 0:i.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(r=>this._updateCameraNearFarManual(r,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const i=this.view.constraints&&this.view.constraints.clipDistance;(i?i.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,i):this._updateCameraNearFarAuto(e,i)}_updateCameraNearFarAuto(e,i){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,m4(this.view,e.eye),e),i&&i.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,i){i&&(e.near=i.near,e.far=i.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,i=!e||e==="stay-above",r=this.view.state.constraints.collision;if(i!==r.enabled){r.enabled=i,i&&this._reapplyConstraints(Zr.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==Ke.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const i=this.view.state.constraints;i.tilt=i.createConstantMaxTilt(Qt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const i=this.view.state.constraints;if(i.tilt){const r=i.tilt(this.view.state.camera.distance).max;e.autoUpdate(nl(r))}}_updateLocalSurfaceDistance(e){if(e==null)return;let i=Math.max(e.width,e.height);if(i<=0)return;e.zmax!=null&&e.zmin!=null&&(i=Math.max(i,e.zmax-e.zmin));const r=this.view.state,n=3*i/Math.atan(r.camera.fov/2);n!==r.constraints.distance&&(r.constraints.distance=n)}_reapplyConstraints(e=Zr.ALL){this.view.state.updateCamera(i=>Xn(this.view,i,{selection:e,interactionType:di.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:mo.TUMBLE}))}};d([m({constructOnly:!0})],JE.prototype,"view",void 0),d([m({readOnly:!0})],JE.prototype,"surfaceCollisionConstraint",void 0),JE=d([J("esri.views.3d.state.ConstraintsManager")],JE);let A_=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=HP(),this._points=Cme(),this.lines=new Array(12),this._origin=I(),this._direction=I(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:I(),endpoint:null}}update(e){Eme(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),fe(this._origin,e.eye),fe(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let i=0;i<this._points.length;i++)fe(this._points[i],e[i]);Ame(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return j_(this.frustum,e)}intersectsRay(e){return yke(this.frustum,e)}intersectsLineSegment(e,i){return vke(this.frustum,e,i)}intersectsPoint(e){return Pme(this.frustum,e)}_updateLines(){const e=this._points;for(let i=0;i<4;i++){const r=i+4;tk(this.lines[i],e[i],e[r]),tk(this.lines[i+4],e[i],i===3?e[0]:e[i+1]),tk(this.lines[i+8],e[r],i===3?e[4]:e[r+1])}}};function tk(t,e,i){t.origin=e,t.endpoint=i,zg(t.direction,e,i)}A_.planePointIndices=bke,A_.nearFarLineIndices=[[gt.NEAR_BOTTOM_LEFT,gt.FAR_BOTTOM_LEFT],[gt.NEAR_BOTTOM_RIGHT,gt.FAR_BOTTOM_RIGHT],[gt.NEAR_TOP_RIGHT,gt.FAR_TOP_RIGHT],[gt.NEAR_TOP_LEFT,gt.FAR_TOP_LEFT]];let VA=class extends ng{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=dn.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||Ege(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),xS(this.view,e,Rh.EYE_AND_CENTER)||this.constraintEnabled||(this.state=dn.Stopped)})}};d([m({constructOnly:!0})],VA.prototype,"desiredCamera",null),VA=d([J("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],VA);const vBe=I(),dM=I();function bW(){return{direction:I(),up:I()}}function t0e(t,e,i,r,n){let s=Me(vBe,t),o=Re(s,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(Re(e,r)),o<.99?(fe(s,e),a&&pe(s,s,-1)):s=null);let l=0;if(s){pe(dM,r,Re(r,s)),Ce(s,s,dM);const u=Re(s,n)/(ze(s)*ze(n));Rt(dM,s,n),l=(Re(dM,r)>0?1:-1)*nl(qs(u))}const c=nl(qs(-Re(r,t)/ze(t)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const i0e=Ge(0,1,0),r0e=Ge(0,0,1),bC=Ne(),bm=I(),wm=I();function n0e(t,e,i,r=bW()){const{direction:n,up:s}=r;return Zhe(bC,-Qt(e)),bT(bC,bC,Qt(i)),st(n,r0e,bC),pe(n,n,-1),st(s,i0e,bC),r}function bBe(t,e,i,r){return t0e(e,i,r,r0e,i0e)}function wBe(t,e,i,r){const n=n0e(t,i,r),s=I();return pe(s,n.direction,-e),xe(s,s,t),{up:n.up,eye:s,heading:i,tilt:r}}function xBe(t){return nl(t)}function TBe(t){return Qt(t)}function s0e(t,e,i,r,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return No(e,bm,s),No(e,wm,s),bm[0]-=i/2,wm[0]+=i/2,bm[1]-=r/2,wm[1]+=r/2,Ws(bm,s,bm,o),Ws(wm,s,wm,o),n?(n.xmin=bm[0],n.ymin=bm[1],n.xmax=wm[0],n.ymax=wm[1],n.spatialReference=o):n=new Ar(bm[0],bm[1],wm[0],wm[1],o),n}const SBe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:bBe,eyeForCenterWithHeadingTilt:wBe,eyeTiltToLookAtTilt:TBe,headingTiltToDirectionUp:n0e,lookAtTiltToEyeTilt:xBe,toExtent:s0e},Symbol.toStringTag,{value:"Module"})),o0e=Ge(0,0,1),a0e=Me(I(),Ge(1,1,1)),CBe=new sy(-180,180),wC=Ne(),y_=I(),zw=I();function l0e(t,e,i,r=bW()){Rt(y_,t,o0e),Re(y_,y_)===0&&Rt(y_,t,a0e),Su(wC,-Qt(e),t),vc(wC,wC,-Qt(i),y_);const{up:n,direction:s}=r;return Rt(n,y_,t),Me(n,n),st(n,n,wC),Me(s,t),Ea(s,s),st(s,s,wC),r}function EBe(t,e,i,r){const n=y_,s=zw;return Me(n,t),Rt(zw,n,o0e),Re(zw,zw)===0&&Rt(zw,n,a0e),Rt(s,zw,n),t0e(e,i,r,n,s)}function ABe(t,e,i,r){const n={eye:I(),up:null,tilt:r,heading:i},s=y_;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=Qt(i),l=Qt(r),c=Math.sin(a),u=Math.cos(a),p=Math.sin(l),f=Math.cos(l),y=ze(s);let v;if(Math.abs(l)<1e-8)v=o+y;else{const oe=y/p,U=Nh(o/oe),V=Math.PI-l-U;v=oe*Math.sin(V)}const b=f*o,x=o*o*(p*p),S=u*u*x,P=v-b,C=P*P,R=S*(S+C-s[1]*s[1]);if(R<0)return pe(n.eye,s,v/y),n.tilt=0,pM(n,t);const N=Math.sqrt(R),$=s[1]*P,k=S+C;let B;if(B=u>0?-N+$:N+$,Math.abs(k)<1e-8)return y<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):pe(n.eye,s,v/y),n.tilt=0,ik(n.eye),pM(n,t);n.eye[1]=B/k;const W=c*c*x,Z=p*o,K=u*Z*n.eye[1],X=n.eye[1]*n.eye[1],ae=1-X,re=Math.sqrt(ae),ee=S*X+W-2*K*re*P+ae*C;return Math.abs(ee)<1e-8?(pe(n.eye,s,v/y),n.tilt=0,ik(n.eye),pM(n,t)):(n.eye[0]=(ae*(v*s[0]-b*s[0])-Z*re*(s[0]*n.eye[1]*u+s[2]*c))/ee,n.eye[2]=(ae*(v*s[2]-b*s[2])-Z*re*(s[2]*n.eye[1]*u-s[0]*c))/ee,pe(n.eye,n.eye,v),ik(n.eye),pM(n,t))}function ik(t){const e=t[1];t[1]=-t[2],t[2]=e}function pM(t,e){const i=l0e(e,t.heading,t.tilt);return t.up=i.up,t}function PBe(t,e,i){const r=ze(e),n=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),s=Nh(i/(n/Math.sin(t)));return nl(t-s)}function OBe(t,e,i){const r=Qt(t),n=ze(e);return Nh(i/(n/Math.sin(r)))+r}function c0e(t,e,i,r,n){let s,o,a,l;const c=e.latitude,u=lr(t.spatialReference).radius,p=e.longitude,f=U8e(c,i,u)/2;s=p-f,o=p+f;const y=Qt(c),v=(1+Math.sin(y))/(1-Math.sin(y)),b=(v+1)*Math.tan(r/u/2),x=b*b;function S(C){const R=Math.PI/2;return(C=EEe.normalize(C,-R))>R&&(C=Math.PI-C),C}if(a=1.5*Math.PI-2*Math.atan(.5*(b+Math.sqrt(4*v+x))),l=a+r/u,a=S(a),l=S(l),l<a){const C=l;l=a,a=C}if(a=Math.max(nl(a),-90),l=Math.min(nl(l),90),o=CBe.monotonic(s,o),o-s>180){const C=(o-s-180)/2;s+=C,o-=C}const P=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:jt.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=P):n=new Ar(s,a,o,l,P),t.spatialReference&&t.spatialReference.isWebMercator&&CA(n,!1,n),n}const RBe=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:EBe,eyeForCenterWithHeadingTilt:ABe,eyeTiltToLookAtTilt:OBe,headingTiltToDirectionUp:l0e,lookAtTiltToEyeTilt:PBe,toExtent:c0e},Symbol.toStringTag,{value:"Module"}));function GD(t){return t.type==="point"}let wW=class{constructor(e,i=null,r=0){this.array=e,this.spatialReference=i,this.offset=r}};function u0e(t){return"array"in t}function Af(t,e,i="ground"){if(GD(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,i);if(u0e(e)){let r=e.offset;return t.getElevation(e.array[r++],e.array[r++],e.array[r]||0,e.spatialReference??t.spatialReference,i)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,i)}function v7(t,e){return t!=null&&(e==null||(e===Ke.Local?!t.isGeographic||t.isWGS84||t.wkid===Th.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Th.CGCS2000||t.wkid===Th.GCSMARS2000||t.wkid===Th.GCSMARS2000_SPHERE||t.wkid===Th.GCSMOON2000))}const h0e=ye.getLogger("esri.views.3d.support.cameraUtils"),d0e=39.37,p0e=96,b7=1,MBe=8,$Be=5,f0e=1,bQ=I(),IBe={heading:0,tilt:0},P_=new Ft,LBe=new sy(-20037508342788905e-9,20037508342788905e-9),DBe=new sy(-180,180);var ra;function Q3(t){return t.spatialReference||jt.WGS84}function SS(t){return t.viewingMode==="global"?RBe:SBe}function NBe(t,e,i,r,n){return SS(t).headingTiltToDirectionUp(e,i,r,n)}function tg(t,e){if(e==null)return null;const i=t.renderSpatialReference,r=SS(t).headingTiltToDirectionUp,n=I();if(!No(e.position,n,i))return null;const s=r(n,e.heading,e.tilt);pe(s.direction,s.direction,t.state.camera.distance),xe(s.direction,s.direction,n);const o=Yb(t,n,s.direction,s.up);return o.fov=Qt(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(ra||(ra={}));const Bw=I();function kT(t,e,i){const r=t.renderSpatialReference,n=b4(t,e.eye,e.viewForward,e.up,IBe);let s=Q3(t);return Ws(e.eye,r,Bw,s)||(s=jt.WGS84,Ws(e.eye,r,Bw,s)),i==null?new Fh(new Ft(Bw,s),n.heading,n.tilt,nl(e.fov)):(i.position.x=Bw[0],i.position.y=Bw[1],i.position.z=Bw[2],i.position.spatialReference=s,i.heading=n.heading,i.tilt=n.tilt,i.fov=nl(e.fov),i)}function xW(t,e,i){const r=t.state.camera,n=r.width/2/r.pixelRatio;return t.renderCoordsHelper.viewingMode===Ke.Global&&i!=null&&(e*=Math.cos(Qt(i))),e/=t.renderCoordsHelper.unitInMeters,n/(p0e*d0e/e)/Math.tan(r.fovX/2)}function Cb(t,e,i){const r=t.state.camera,n=e*Math.tan(r.fovX/2),s=r.width/2/r.pixelRatio;let o=p0e*d0e/(s/n);return t.renderCoordsHelper.viewingMode===Ke.Global&&i!=null&&(o/=Math.cos(Qt(i))),o*t.renderCoordsHelper.unitInMeters}function m0e(t,e,i,r,n,s){return g0e(t,e,xW(t,i,e.latitude),r,n,s)}function g0e(t,e,i,r,n,s){if(H1(s)){const a=new CS(s.signal);return KP(t,r.heading,r.tilt,e,i,n,a),void a.resolver.promise.then(l=>{const c=HD(t,l,r.fov);if(c!=null)return s.resolver.resolve(c);s.resolver.reject()},l=>s.resolver.reject(l))}const o=KP(t,r.heading,r.tilt,e,i,n);return HD(t,o,r.fov,s)}function b4(t,e,i,r,n){return SS(t).directionToHeadingTilt(e,i,r,n)}function FBe(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,P_,t.spatialReference)&&t.elevationProvider&&(Af(t.elevationProvider,P_)??0)>(P_.z??0)-f0e)}async function kBe(t,e,i){if(!t.renderCoordsHelper.fromRenderCoords(e,P_,t.spatialReference)||!t.elevationProvider)return!1;const r=P_.z??0;return(await t.elevationProvider.queryElevation(P_.x,P_.y,r,P_.spatialReference,"ground",i)??0)>r-f0e}async function UBe(t,e,i){const r=I();if(e)if(e instanceof Ft){if(No(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const n=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",i);return n!=null&&t.renderCoordsHelper.setAltitude(r,n),r}}else fe(r,e);else fe(r,t.state.camera.center);return r}function zBe(t,e){const i=I();if(e&&e instanceof Ft){if(No(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const r=Af(t.elevationProvider,e);r!=null&&t.renderCoordsHelper.setAltitude(i,r)}}else fe(i,e||t.state.camera.center);return i}function KP(t,e,i,r,n,s,o){const a=r&&r instanceof Ft?r:null;if(H1(o))return UBe(t,r,o.signal).then(c=>{w7(t,e,i,a,c,n,s,o)},c=>o.resolver.reject(c)),null;const l=zBe(t,r);return w7(t,e,i,a,l,n,s,o)}function w7(t,e,i,r,n,s,o,a){if(r==null){const p=t.renderSpatialReference;if((r=$g(n,p,Q3(t)))==null)return null}s=Math.max(s,t.state.constraints.minimumPoiDistance);const l=GBe(t,e,i,n,s,o),c=(0,SS(t).eyeForCenterWithHeadingTilt)(n,s,l.heading,l.tilt);if(o===ra.ADJUST&&t.viewingMode==="global"&&i>0){const p=()=>{const y=_0e(t,n,s,HBe(t,s,i,n));return o=i-y<1?ra.LOCKED:ra.ADJUST,w7(t,e,y,r,n,s,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(FBe(t,c.eye))return p();if(H1(a))return kBe(t,c.eye,a.signal).then(y=>y?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:Kn(n),heading:c.heading,tilt:c.tilt}),null)),null}}const u=!a||H1(a)?{center:I(),eye:I(),up:I(),tilt:0,heading:0}:a;return u.eye=c.eye,u.up=c.up,u.center=Kn(n),u.heading=c.heading,u.tilt=c.tilt,H1(a)&&a.resolver.resolve(u),u}function GA(t,e,i,r,n,s=null){let o,a,l;if(t.state.isGlobal){if(!v7(e.spatialReference,Ke.Global))return H1(s)&&s.resolver.reject(),null;const x=new Ft(e.xmin,e.ymin,e.spatialReference),S=new Ft(e.xmax,e.ymax,e.spatialReference),P=e.spatialReference.isGeographic?DBe:LBe;o=new Ft({x:P.center(x.x,S.x),y:(S.y+x.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const C=lr(e.spatialReference),R=k8e(o,x,S);a=R.lon,l=R.lat,P.diff(x.x,S.x)>P.range/2&&(a+=C.halfCircumference),a=Math.min(a,C.halfCircumference),l=Math.min(l,C.halfCircumference)}else{const x=t.renderSpatialReference??e.spatialReference;x.equals(e.spatialReference)||(e=pS(e,x)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const S=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new Ft({x:e.xmin+.5*a,y:e.ymin+.5*l,z:S,spatialReference:x})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,u=t.state.camera,p=1/Math.tan(u.fovX/2),f=1/Math.tan(u.fovY/2),y=1/Math.tan(u.fov/2),v=Math.max(.5*a*p,.5*l*f,.5*c*y)/b7;if(H1(s)){const x=new CS(s.signal);return KP(t,i,r,o,v,n,x),void x.resolver.promise.then(S=>{const P=HD(t,S,t.camera.fov);if(P!=null)return s.resolver.resolve(P);s.resolver.reject()},S=>s.resolver.reject(S))}const b=KP(t,i,r,o,v,n);return HD(t,b,t.camera.fov,s)}function BBe(t,e,i){const r=t.renderSpatialReference,n=$g(i,r,Q3(t));if(n==null)return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=O3(e.eye,i),l=2*a*s*b7,c=2*a*o*b7;return t.viewingMode==="global"?c0e(t,n,l,c):s0e(t,n,l,c)}function VBe(t,e,i){const r=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>MBe)return!0;const n=t.renderSpatialReference,s=Q3(t),o=$g(e,n,s),a=$g(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*r;return a.distance(o)/l>$Be}function GBe(t,e,i,r,n,s){let o=0;return s===ra.ADJUST&&VBe(t,r,n)?(e=0,o=jBe(t,n,i,r)):o=TW(t,r,n,i),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:i=_0e(t,r,n,o)}}const jD=.7;function jBe(t,e,i,r){const n=TW(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-jD)+s.max*jD;return Math.min(n,o)}function HBe(t,e,i,r){let n=TW(t,r,e,i);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-jD)+n*jD}function _0e(t,e,i,r){return SS(t).lookAtTiltToEyeTilt(r,e,i)}function TW(t,e,i,r){return SS(t).eyeTiltToLookAtTilt(r,e,i)}function HD(t,e,i,r){if(e==null)return null;const n=t.renderSpatialReference,s=$g(e.eye,n,Q3(t));return s==null?null:r!=null?(r.position=s,r.heading=e.heading,r.tilt=e.tilt,r.fov=i,r):new Fh(s,e.heading,e.tilt,i)}function WBe(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(e);h0e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function y0e(t,e){var r;const i=(r=t.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(e);h0e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function v0e(t,e){return Ws(e.center,t.renderSpatialReference,bQ,jt.WGS84),Cb(t,e.distance,bQ[1])}let CS=class{constructor(e){this.signal=e,this.resolver=sa()}};function H1(t){return t&&"resolver"in t}const qBe=.66;function b0e(t){return 360-xG.normalize(t)}function w4(t){return xG.normalize(360-t)}function xC(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function ZBe(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function w0e(t,e,i,r=null){if(!e)return xC(r);const n=t.spatialReference||jt.WGS84;if(e.camera!=null){const c=Ub(e.camera.position,n);if(c==null)return xC(r);const u=e.camera.clone();return u.position=c.clone(),ZBe(r,u)}if(e.targetGeometry==null)return xC(r);const s=e.get("targetGeometry.spatialReference");if(s&&!Z_(s,n))return xC(r);const o=kT(t,t.state.camera);let a=ra.ADJUST;if(e.rotation!=null&&(o.heading=b0e(e.rotation),a=ra.LOCKED),i!=null&&(o.tilt=i),e.targetGeometry.type==="point"){const c=e.targetGeometry;let u;const p=e.targetGeometry.clone();return u=e.scale!=null?xW(t,e.scale,c.latitude):t.state.camera.distance,g0e(t,p,u,o,a,r)}const l=e.targetGeometry.extent;return l?GA(t,l,o.heading,o.tilt,a,r):xC(r)}function XBe(t,e,i=null){return i==null&&(i=new pp),EW(t,null,e.clone(),i)}async function YBe(t,e,i){const r=o7e(t,e);if(!r)throw new ce("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new Fh({fov:t.camera.fov}),s=new pp({camera:n});if(r.target instanceof pp)return rv(await QBe(t,r.target,r,i,s));if(r.target instanceof Fh)return rv(T0e(t,r.target,s));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof Ar){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return rv(o||c?await x7(t,r,r.target.center,n,i,s):await r7e(t,r,r.target,n,i,s))}const a={boundingBox:Gr(),hasZ:!1,screenSpaceObjects:[]},l=o?JBe(t,r):void 0;if(await x0e(t,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(Zd(a.boundingBox,Wn),eu.x=Wn[0],eu.y=Wn[1],eu.z=Wn[2],eu.spatialReference=t.spatialReference,isFinite(eu.z)&&a.hasZ?c=hj(a.boundingBox):(eu.z=void 0,c=HAe(uj(a.boundingBox,l7e))),o||c)return rv(await x7(t,r,eu,n,i,s));const u=a7e(t,a.screenSpaceObjects);return rv(await s7e(t,r,eu,a.boundingBox,u,n,i,s))}return r.position?rv(t7e(t,r,n,s)):rv(await i7e(t,r,n,i,s))}function SW(t,e){return e.scale==null&&e.zoom!=null?y0e(t,e.zoom):e.scale}function JBe(t,e){const i=SW(t,e);return i?vDe(i):void 0}function CW(t,e){let i=!1;return e.heading!=null?(t.heading=e.heading,i=!0):e.rotation!=null&&(t.heading=b0e(e.rotation),i=!0),e.tilt!=null&&(t.tilt=e.tilt,i=!0),e.fov!=null&&(t.fov=e.fov),i}function EW(t,e,i,r){const n=t.spatialReference||jt.WGS84;return(e=e??tg(t,i))==null||(r.targetGeometry=$g(e.center,t.renderSpatialReference,n),r.scale=v0e(t,e),r.rotation=w4(i.heading),r.camera=i),r}function WD(t,e,i){var a,l;const r=()=>new ce("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw r();if(!Z_(e.spatialReference,t.spatialReference))throw new ce("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const n=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&t.basemapTerrain.spatialReference!=null&&Z_(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?Wn[2]=Af(t.elevationProvider,c)??0:Wn[2]=0}(0,c7e[e.type])(e,c=>{n.push(c[0],c[1],c[2])},Wn);const s=n.length/3;if(s===0)throw r();const o=new Array(n.length);if(_n(n,e.spatialReference,0,o,t.spatialReference,0,s)){e.hasZ&&(i.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(Wn[0]=o[c],Wn[1]=o[c+1],Wn[2]=o[c+2]):(Wn[0]=o[c],Wn[1]=o[c+1]),Hf(i.boundingBox,Wn)}}async function KBe(t,e,i,r){const n=await Lg(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void WD(t,e.geometry,r);const s=n.value,o=await Lg(s.whenGraphicBounds(e,{minDemResolution:i}));if(o.ok===!1)return void WD(t,e.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;_T(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function x0e(t,e,i,r){var n;if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return eu.x=s,eu.y=o,eu.z=void 0,eu.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:jt.WGS84,void WD(t,eu,r)}e&&"map"in e&&typeof e.map=="function"?await Ay(e.map(s=>x0e(t,s,i,r))):e instanceof Py?WD(t,e,r):e instanceof gb&&await KBe(t,e,i,r)}async function QBe(t,e,i,r,n){if(e.camera!=null)return T0e(t,e.camera,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,i.heading!=null?n.rotation=w4(i.heading):i.rotation!=null&&(n.rotation=i.rotation);const s=SW(t,i);s!=null&&(n.scale=s);const o=new CS(r);return w0e(t,n,i.tilt,o),n.camera=await o.resolver.promise,n}function T0e(t,e,i){const r=t.spatialReference,n=Ub(e.position,r);return n==null?null:((e=e.clone()).fov=t.camera.fov,e.position=n,EW(t,null,e,i))}function e7e(t,e,i,r,n,s){const o=t.renderSpatialReference;return No(i,mM,o),No(e,rk,o),s.targetGeometry=new Ft(e),n.position=new Ft(i),Ce(qD,rk,mM),b4(t,mM,qD,r.up,n),s.scale=Cb(t,Nr(mM,rk),s.targetGeometry.latitude),s.rotation=w4(n.heading),s.camera=n,s}async function x7(t,e,i,r,n,s){if(i==null)throw new ce("createfromcenter","invalid point");s.targetGeometry=i.clone();const o=Yb(t);if(e.position)return e7e(t,s.targetGeometry,e.position,o,r,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=pe(Wn,o.viewForward,-l);o.eye=xe(Wn,o.center,c),s.scale=Cb(t,l,i.latitude)}kT(t,o,r);const a=CW(r,e)?ra.LOCKED:ra.ADJUST;if(!e.zoomFactor){const l=SW(t,e);l==null?(No(i,Wn,t.renderSpatialReference),Pme(o.frustum,Wn)?s.scale=Cb(t,Nr(o.eye,Wn),i.latitude):s.scale=v0e(t,o)):s.scale=l;const c=new CS(n);m0e(t,s.targetGeometry,s.scale,r,a,c),s.camera=await c.resolver.promise}return s}function t7e(t,e,i,r){const n=Yb(t);return fe(qD,n.viewForward),b4(t,n.eye,qD,n.up,nk),i.position=new Ft(e.position),i.heading=e.heading!=null?e.heading:nk.heading,i.tilt=e.tilt!=null?e.tilt:nk.tilt,EW(t,null,i,r)}async function i7e(t,e,i,r,n){const s=Yb(t);return x7(t,e,$g(s.center,t.renderSpatialReference,t.spatialReference),i,r,n)}async function r7e(t,e,i,r,n,s){s.targetGeometry=i.clone();const o=Yb(t);kT(t,o,r);const a=CW(r,e)?ra.LOCKED:ra.ADJUST,l=new CS(n);return GA(t,i,r.heading,r.tilt,a,l),s.camera=await l.resolver.promise,s}function n7e(t,e,i,r,n){let s=0;i.z!=null?s=i.z:t.basemapTerrain&&t.elevationProvider&&(s=Af(t.elevationProvider,i)),me(Wn,i.x,i.y,s),_u(t.spatialReference,Wn,wQ,t.renderSpatialReference),jh(fM,wQ),Hh(fM,fM),Gr(TC);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let v=0;v<o.length;v++){const b=o[v];let x=r[b[2]];isFinite(x)||(x=s),me(Wn,r[b[0]],r[b[1]],x),Ws(Wn,t.spatialReference,Wn,t.renderSpatialReference),Hf(TC,yc(Wn,Wn,fM))}const a=Gb(TC),l=Ry(TC),c=jb(TC),u=1/Math.tan(e.fovX/2),p=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(p,u)+.5*l,y=.5*l*p+.5*Math.max(a,c);return Math.max(f,y)/n}async function s7e(t,e,i,r,n,s,o,a){a.targetGeometry=i.clone();const l=Yb(t),c=n7e(t,l,i,r,n);kT(t,l,s);const u=CW(s,e)?ra.LOCKED:ra.ADJUST;a.scale=Cb(t,c,a.targetGeometry.latitude);const p=new CS(o);return m0e(t,a.targetGeometry,a.scale,s,u,p),a.camera=await p.resolver.promise,a}function o7e(t,e){if(!e||!t.spatialReference)return null;const i={target:void 0};return"declaredClass"in e||Array.isArray(e)?i.target=e:(Object.assign(i,e),e.center&&!i.target&&(i.target=e.center)),i}function rv(t){return t&&t.camera!=null&&(t.rotation=w4(t.camera.heading)),t}function a7e(t,e){const i=qBe;if(!e.length)return i;let r=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;r=Math.max(r,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return i-r/Math.min(t.width,t.height)*2}const Wn=I(),wQ=Ne(),fM=on(),TC=$s(),l7e=li(),qD=I(),mM=I(),rk=I(),nk={heading:0,tilt:0},eu=new Ft,c7e={point(t,e,i){i[0]=t.x,i[1]=t.y,t.z!=null&&(i[2]=t.z),e(i)},polygon(t,e,i){const r=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},polyline(t,e,i){const r=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)i[0]=s[o][0],i[1]=s[o][1],r&&(i[2]=s[o][2]),e(i)}},multipoint(t,e,i){const r=t.points,n=t.hasZ;for(let s=0;s<r.length;s++)i[0]=r[s][0],i[1]=r[s][1],n&&(i[2]=r[s][2]),e(i)},extent(t,e,i){t.zmin!=null&&t.zmax!=null?(e(me(i,t.xmin,t.ymin,t.zmin)),e(me(i,t.xmax,t.ymin,t.zmin)),e(me(i,t.xmin,t.ymax,t.zmin)),e(me(i,t.xmax,t.ymax,t.zmin)),e(me(i,t.xmin,t.ymin,t.zmax)),e(me(i,t.xmax,t.ymin,t.zmax)),e(me(i,t.xmin,t.ymax,t.zmax)),e(me(i,t.xmax,t.ymax,t.zmax))):(e(me(i,t.xmin,t.ymin,i[2])),e(me(i,t.xmax,t.ymin,i[2])),e(me(i,t.xmin,t.ymax,i[2])),e(me(i,t.xmax,t.ymax,i[2])))},mesh(t,e,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(r)for(let n=0;n<r.length;n+=3)e(me(i,r[n],r[n+1],r[n+2]))}};let u7e=class{constructor(e,i,r){this.target=e,this.options=i,this.view=r,this.state="pending",this._animationController=null,this._promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this.options.signal!=null&&Ca(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,i){return this._promise.then(e,i)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Qi())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await MP(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,YBe(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const i=e?this._getCameraFromViewpoint(e):null;if(i!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(i,this._animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var s;const i=!!(this.target instanceof pp&&this.target.camera||this.target instanceof Fh),r=e.camera;if(r==null)return null;if(!this.view.stateManager.isCompatible(r)){const o=r.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new ce("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:r})),null}const n=tg(this.view,r);return n==null?(this.reject(new ce("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:i}}startAnimation(e,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(r==null)return void this.reject(new ce("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(e.viewpoint,"running"),!i.active||i.viewAnimation==null||i.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==i)return this.abort();let n;e.isFullySpecified?(n=new VA({view:this.view,desiredCamera:e.camera}),xS(this.view,e.camera,Rh.EYE_AND_CENTER)):Xn(this.view,e.camera),i.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof dg&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):i.viewAnimation!=null&&i.viewAnimation.target===e.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(i.state){case dn.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case dn.Ready:case dn.Rejected:case dn.Running:case dn.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(s,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,i=null;const r=this.view.state.cameraController;return r instanceof dg&&(r.updateStateFromViewAnimation(),r.active&&(e=r,i=e.viewAnimation)),e!=null||(e=new dg({view:this.view,mode:"animation"}),i=e.viewAnimation,this.view.state.switchCameraController(e))?e:(i!=null&&i.stop(),this.reject(new ce("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Ns=class extends ke{get camera(){const e=this._get("camera");if(!this.ready)return e;const i=kT(this.view,this.view.state.camera,sk);return i&&e&&i.equals(e)?e:i.clone()}set camera(e){var i,r;this._updatePropertyBeforeReady("camera",e)||((i=this.view.elevationProvider)==null||i.enableElevationCache(!0),this.setStateCamera(tg(this.view,e),{applyConstraints:!1})||ye.getLogger(this).error("#camera=","Invalid camera",e),(r=this.view.elevationProvider)==null||r.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const i=kT(this.view,this.view.state.contentCamera,sk);return i&&e&&i.equals(e)?e:i.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const i=tg(this.view,e);i!=null?(this._updateElevation(i),this.view.state.contentCamera=i):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(ok),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const i=this.zoom,r=this.view.state.camera.distance**2,n=Za(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([Pe(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(ok),this.test.contentCameraResetState.clear())}),Pe(()=>this.zoom,o=>{o!==void 0&&i!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-i)/2),Math.abs(o-i)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),Pe(()=>this.view.state.camera,o=>{const a=Io(n,o.center);this.test.contentCameraResetState.set("camera.center",a/r),a>r?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],ok),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var i;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():ye.getLogger(this).error("#center=","Invalid center",e):ye.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):ye.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,i=BBe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return i??this._get("extent")}set extent(e){var i;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||ye.getLogger(this).error("#extent=","Invalid extent",e):ye.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e):ye.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Cb(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||ye.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,i=e.padding,r=e.pixelRatio,n=this._get("padding"),s=Math.round(i[fi.TOP]/r),o=Math.round(i[fi.RIGHT]/r),a=Math.round(i[fi.BOTTOM]/r),l=Math.round(i[fi.LEFT]/r);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,gM),this.view.state.updateCamera(i=>i.padding=gM))}_paddingToArray(e,i,r){e?Br(r,e.top||0,e.right||0,e.bottom||0,e.left||0):Br(r,0,0,0,0);for(let n=0;n<4;n++)r[n]=Math.round(r[n]*i)}get screenCenter(){const e=this.padding;return Uh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?XBe(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var i;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||ye.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const r=e.camera!=null?e.camera.position:e.targetGeometry,n=r!=null&&r.spatialReference;ye.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((i=this.view.spatialReference)==null?void 0:i.wkid)+")",e)}else ye.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?WBe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||ye.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),i=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*i),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*i);const r=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return I1(this._tmpCanvasSize,r)?this._tmpCanvasSize.pixelRatio=i:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:i,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,i;return((i=(e=this.view)==null?void 0:e._stage)==null?void 0:i.renderer.isFeatureEnabled(ds.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var i,r;const e=(r=(i=this.view)==null?void 0:i._stage)==null?void 0:r.renderer;return e&&(e.isFeatureEnabled(ds.PhysicalPixelRendering,Ji.IDLE)||e.isFeatureEnabled(ds.PhysicalPixelRendering,Ji.INTERACTING)||e.isFeatureEnabled(ds.PhysicalPixelRendering,Ji.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:i=>this._devicePixelRatioOverride=i,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(i){this.viewStateManager._updatingIgnoreRenderState=i},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new Dg({frustum:A_},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new h7e}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([$l(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),Pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,i)=>this._cameraChangedHandler(e,i),gr)]),Bh(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([cT({prepare:()=>this._prepareFrame()}),Pe(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(_M)}),$l(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=Je(this._propertiesPool)}init(){this.constraintsManager=new JE({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const i of e)this.set(i.name,i.value);if(!this._cameraSetByUser){const i=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;i&&this.isCompatible(i)?this._setInitialView(i):this.view.state.viewingMode===Ke.Local&&this.addHandles(Bh(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(_M),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),_M)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(_M),this.constraintsManager=Je(this.constraintsManager))}async goTo(e,i){const r={animate:!0,...i};return this._gotoOperation!=null&&this._gotoOperation.abort(r.animate),this._gotoOperation=new u7e(e,r,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(Yb(this.view),{applyConstraints:!1})}step(e){const i=this.view.state,r=i==null?void 0:i.cameraController;r&&(i.updateCamera(n=>r.stepController(e,n)),r.steppingFinished&&r.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,i=[];for(const{propertyName:r,overrides:n}of p7e){const s=e.has(r),o=this._isOverridden(r);!s&&o&&i.push({name:r,value:this._get(r)}),this._clearOverride(r),(s||o)&&n.forEach(a=>e.add(a))}return i}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof Fh)return void this.setStateCamera(tg(this.view,e),{applyConstraints:!1});if(e instanceof pp){if(e.targetGeometry instanceof Ar){const s=GA(this.view,e.targetGeometry,0,.5,ra.LOCKED);return void(s!=null&&this.setStateCamera(tg(this.view,s),{applyConstraints:!0}))}const r={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,r)}const i=GA(this.view,e,0,.5,ra.LOCKED);i!=null&&this.setStateCamera(tg(this.view,i),{applyConstraints:!0})}_updatePropertyBeforeReady(e,i){return!this.ready&&(this._override(e,i),i&&d7e.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof pp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof Fh?this.isCompatible(e.position):e.spatialReference&&Z_(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=f7e){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,i,r=w0){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=KP(this.view,n,s,e,i,ra.ADJUST);return o==null?null:(r.copyFrom(this.view.state.camera),r.eye=o.eye,r.center=o.center,r.up=o.up,r)}_centerToCamera(e){const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.distance;return this._centerPointAtDistanceToCamera(e,r)}_extentToCamera(e){const{heading:i,tilt:r}=this._getPreservingHeadingTilt(),n=GA(this.view,e,i,r,ra.ADJUST,sk);return n?tg(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const i=this.view.pointsOfInterest.centerOnContent;i.runTask();const r=i.renderLocation,n=i.location.latitude;if(n==null)return null;const s=xW(this.view,e,n);return this._centerPointAtDistanceToCamera(r,s)}_zoomToCamera(e){return this._scaleToCamera(y0e(this.view,e))}_viewpointToCamera(e){return tg(this.view,w0e(this.view,e))}setStateCamera(e,i){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,i.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(r=>{i.positionAndOrientationOnly?(r.eye=e.eye,r.center=e.center,r.up=e.up):r.copyFrom(e),i.applyConstraints&&Xn(this.view,r)}),i.applyConstraints||(this.view.state.cameraController=new VA({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:i}=this.view;if(!e||!i)return;this._windowDevicePixelRatio=window.devicePixelRatio;const r=this._computeCanvasSize();if(r.width!==0&&r.height!==0&&(i.width===r.width&&i.height===r.height||(i.width=r.width,i.height=r.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===r.width&&n.fullHeight===r.height&&n.pixelRatio===r.pixelRatio||(w0.copyFrom(n),w0.pixelRatio!==r.pixelRatio&&(this._paddingToArray(this.padding,r.pixelRatio,gM),w0.padding=gM),w0.fullWidth=r.width,w0.fullHeight=r.height,w0.pixelRatio=r.pixelRatio,this.view.state.camera=w0),this._updateViewState()}}_updateElevation(e){var s;const i=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,r=((s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))??0,n=i?m4(this.view,e.eye):0;e.relativeElevation=r-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=Ji.ANIMATING:this.view.interacting?this.view.state.mode=Ji.INTERACTING:(this.view.state.mode===Ji.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=m7e?this.view.state.mode=Ji.INTERACTING:this.view.state.mode=Ji.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,i){e&&i&&e.almostEquals(i)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([m({type:Fh,dependsOn:["view.state.camera","ready"]})],Ns.prototype,"camera",null),d([m({type:Fh,dependsOn:["view.state.contentCamera","ready"]})],Ns.prototype,"contentCamera",null),d([m({type:Ft})],Ns.prototype,"center",null),d([m({type:Ar})],Ns.prototype,"extent",null),d([m({readOnly:!0})],Ns.prototype,"frustum",null),d([m({readOnly:!0})],Ns.prototype,"hasInitialView",null),d([m({readOnly:!0,type:Boolean})],Ns.prototype,"ready",void 0),d([m({type:Number})],Ns.prototype,"scale",null),d([m()],Ns.prototype,"padding",null),d([m({readOnly:!0})],Ns.prototype,"screenCenter",null),d([m({constructOnly:!0})],Ns.prototype,"view",void 0),d([m({type:pp})],Ns.prototype,"viewpoint",null),d([m({type:Number})],Ns.prototype,"zoom",null),d([m({readOnly:!0})],Ns.prototype,"_rasterPixelRatio",null),d([m({readOnly:!0})],Ns.prototype,"_usePhysicalPixelRendering",null),d([m({readOnly:!0})],Ns.prototype,"_usePhysicalPixelRenderingAny",null),d([m()],Ns.prototype,"_windowDevicePixelRatio",void 0),d([m()],Ns.prototype,"_devicePixelRatioOverride",void 0),Ns=d([J("esri.views.3d.state.ViewStateManager")],Ns);let h7e=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const d7e=["camera","viewpoint","extent","scale","center","zoom"],p7e=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],f7e={heading:0,tilt:0},sk=new Fh,w0=new It,gM=gi(),_M="pending-initial-view",ok="content-camera-reset",m7e=300,xQ=100;let Pf=class extends ng{constructor(){super(...arguments),this.startCamera=new It,this.currentCamera=new It,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<xQ}stepController(e,i){i.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(i)}onControllerStart(e){this.state=dn.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),xQ),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([m({readOnly:!0})],Pf.prototype,"isInteractive",null),d([m()],Pf.prototype,"_lastInteraction",void 0),Pf=d([J("esri.views.3d.state.controllers.InteractiveController")],Pf);var cc;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(cc||(cc={}));let jA=class extends Pf{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=cc.CENTER,this._rotScale=0,this._lastPoint=it(),this._tmpWorldUp=I(),this._tmpViewDir=I(),this._tmpRotCurPoint=it(),this._tmpTransf=Ne(),this._tmpAxis=I(),this._tmpPivotPoint=I(),this._pivotPos=I(),this._constraintOptions={selection:Zr.ALL,interactionType:di.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:mo.TUMBLE}}initialize(){this._rotScale=this.pivot===cc.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case cc.EYE:fe(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=di.LOOK_AROUND,this._constraintOptions.tiltMode=mo.LOOK_AROUND,this._constraintOptions.selection=Zr.NONE;break;case cc.CENTER:{const i=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?Jb:{});i||fe(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,i),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=di.TUMBLE,this._constraintOptions.tiltMode=mo.TUMBLE,this._constraintOptions.selection=Zr.ALL&~Zr.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,j1(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,i){const r=this.startCamera,n=I();Ce(n,this._pivotPos,r.eye);const s=ze(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(r.eye,TQ);let a=Math.max(Math.min(Yze,1/Math.abs(Re(TQ,r.viewForward)))*o,Jze);i&&(a=Math.min(s,a));const l=lr(this.view.spatialReference),c=fn(r.width/r.pixelRatio*.5,r.height/r.pixelRatio*.5),u=v4(this.startCamera,c,l);let p=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r.fullWidth/r.pixelRatio*.5,r.fullHeight/r.pixelRatio*.5,r,2.5*J6,J6),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],r,J6);p==null&&f==null||(p=p??f??0,f=f==null||u===po.Horizontal?p:f,a=p>f?f:p,a=i?Math.min(a,s):a),Me(n,n),fe(this._pivotPos,xe(this._tmpPivotPoint,r.eye,pe(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case cc.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case cc.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}Xn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,i,r,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),j1(e,i,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;Ce(this._tmpViewDir,r,n);const a=ze(this._tmpViewDir),l=qs(Re(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===cc.EYE){s*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;s=c-Math.max(-u,Math.min(u,c+s))}return s=$e(s+l,qo.min,qo.max)-l,Rt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===cc.CENTER&&(o=-o),Su(this._tmpTransf,o,this._tmpWorldUp),vc(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),st(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=st(ak,e.up,this._tmpTransf),xe(ak,n,this._tmpViewDir),Is(this._lastPoint,this._tmpRotCurPoint),ak}};d([m()],jA.prototype,"pivot",void 0),jA=d([J("esri.views.3d.state.controllers.RotateController")],jA);const ak=I(),TQ=I();let lk=class extends ko{constructor(e,i,r,n){super(!0),this._view=e,this.pointerAction=i,this._pivot=r,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!vW(e.data,this.pointerAction))return;const r=fn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new jA({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},T7=class extends Pf{constructor(){super(...arguments),this._pickPoint=I(),this._tmpP0=it(),this._panAxisAngle=_4(),this._tmpRayDir=I(),this._tmpRayDirPick=I(),this._targetOnSphere=I(),this._navMode=po.Horizontal,this._tmpRay={origin:I(),direction:I()},this.dragBeginPoint=fn(),this._normalizedAnchorPoint=it(),this._constraintOptions={selection:Zr.ALL_EXCEPT_COLLISION,interactionType:di.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:mo.TUMBLE},this._sphere=kn(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Is(this.dragBeginPoint,e),j1(this.startCamera,e,this._normalizedAnchorPoint);const i=lr(this.view.spatialReference),r=Wge(this._intersectionHelper,this.startCamera,e,i,FT.Ellipsoid,this.view.map.ground.opacity===0?Jb:{});if(this._navMode=v4(this.startCamera,e,i),this._navMode===po.Horizontal)this._hasPickPoint=!!r.scenePickPoint,this._pickPoint=r.scenePickPoint??this._pickPoint,this._sphere=r.sphere;else{let n;TS(this.startCamera,e,this._tmpRay),Me(this._tmpRay.direction,this._tmpRay.direction),r.scenePickPoint!=null&&(Ce(this._tmpRayDirPick,this.startCamera.eye,r.scenePickPoint),n=ze(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,SQ);let o=$e(Math.min(kge,1/Math.abs(Re(SQ,this._tmpRay.direction)))*s,FD[0],FD[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,y4);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,pe(this._tmpRay.direction,this._tmpRay.direction,o),xe(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===po.Horizontal){Ce(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const i=ze(this._tmpRayDir);j1(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;if(this._hasPickPoint&&n<i){const o=1-(1-n/i)*(1-this._sphere[3]/ze(this.currentCamera.center));this.currentCamera.center=pe(yM,this.currentCamera.center,o)}pe(this._tmpRayDir,this._tmpRayDir,-n/i),this.currentCamera.eye=xe(yM,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=jd(vb(this.dragBeginPoint,e)),Xn(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(JP(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),pW(this._pickPoint,this._targetOnSphere,this._panAxisAngle),wy(this.currentCamera,this._sphere,this._panAxisAngle))}else{const i=ze(this._tmpRay.direction);j1(this.currentCamera,e,this._tmpP0);const r=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=i*2**r;const s=this.view.state.constraints.minimumPoiDistance;if(r<0&&n<s&&(n=s),Math.abs(i-n)<1e-6)return;pe(this._tmpRayDir,this._tmpRay.direction,1-n/i),this.currentCamera.eye=xe(yM,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=xe(yM,this.currentCamera.center,this._tmpRayDir)}xS(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};T7=d([J("esri.views.3d.state.controllers.global.ZoomController")],T7);const yM=I(),SQ=I();let S7=class extends Pf{constructor(){super(...arguments),this._tmpP=I(),this._tmpDir=I(),this._tmpN=I(),this._tmpP0=it(),this._tmpPoi=I(),this._tmpRayDir=I(),this.dragBeginPoint=fn(),this._normalizedAnchorPoint=it(),this._constraintOptions={selection:Zr.ALL,interactionType:di.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:I(),tiltMode:mo.TUMBLE},this._plane=Yi()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Is(this.dragBeginPoint,e),j1(this.startCamera,e,this._normalizedAnchorPoint);const i=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?Jb:{});Ce(this._tmpDir,this._tmpP,this.startCamera.eye);const r=ze(this._tmpDir);Me(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=$e(Math.min(kge,1/Math.abs(Re(g7e,this._tmpDir)))*n,FD[0],FD[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,y4);s=o??s,s=i?Math.min(s,r):s,pe(this._tmpDir,this._tmpDir,s),xe(this._tmpP,this.startCamera.eye,this._tmpDir),Ce(this._tmpN,this.startCamera.eye,this.startCamera.center),Me(this._tmpN,this._tmpN),this._tmpN[1]<0&&Ea(this._tmpN,this._tmpN),j3(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;Kze(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||fe(this._tmpPoi,this.currentCamera.center),j1(this.currentCamera,e,this._tmpP0);let i=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Is(this._normalizedAnchorPoint,this._tmpP0),Ce(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const r=ze(this._tmpRayDir);let n=r*(1-i);this._constraintOptions.interactionDirection&&(fe(this._constraintOptions.interactionDirection,this._tmpRayDir),pe(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(i)/r));const s=this.view.state.constraints.minimumPoiDistance;i>=0&&n<s&&(n=s,i=-(n-r)/r),Math.abs(r-n)<1e-6||(pe(this._tmpRayDir,this._tmpRayDir,i),this.currentCamera.eye=xe(nv,this.currentCamera.eye,this._tmpRayDir),pr(nv,this.currentCamera.center,this._tmpPoi,i),this._tmpPoi[2]>this.startCamera.center[2]?nv[2]=Math.max(this.startCamera.center[2],nv[2]):nv[2]=Math.min(this.startCamera.center[2],nv[2]),this.currentCamera.center=nv,this._constraintOptions.interactionFactor=jd(vb(this.dragBeginPoint,e)),Xn(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};S7=d([J("esri.views.3d.state.controllers.local.ZoomController")],S7);const nv=I(),g7e=Ge(0,0,1);let _7e=class extends ko{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){const i=e.data;if(i.pointers.size>1||!vW(e.data,this.pointerAction))return;const r=fn(i.center.x,i.center.y);switch(i.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new T7({view:this._view}):this._cameraController=new S7({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":this._cameraController&&this._cameraController.update(r);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function cd(t){let e=t*t;return t<0&&(e*=-1),e}function CQ(t,e,i){const r=i,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(r.translation[0]=cd(n.axes[0]),r.translation[1]=cd(n.axes[1]),r.translation[2]=cd(n.buttons[7])-cd(n.buttons[6]),r.heading=cd(n.axes[2]),r.tilt=cd(n.axes[3])):s.deviceType==="spacemouse"&&(r.translation[0]=1.2*cd(n.axes[0]),r.translation[1]=1.2*cd(n.axes[1]),r.translation[2]=2*-cd(n.axes[2]),r.heading=1.2*cd(n.axes[5]),r.tilt=1.2*cd(n.axes[3])),r.tilt*=o,pe(r.translation,r.translation,a),r}function EQ(t,e){const i=e;return i.translation[0]=t[1]-t[0],i.translation[1]=t[3]-t[2],i.translation[2]=t[4]-t[5],i.heading=t[7]-t[6],i.tilt=t[8]-t[9],i.zoom=t[10]-t[11],i}function ck(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let L1=class extends Pf{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new It,this._headingStart=0,this._constraintOptions={selection:Zr.ALL,interactionType:di.NONE,interactionStartCamera:new It,interactionFactor:0,interactionDirection:null,tiltMode:mo.LOOK_AROUND}}handleEventGamepad(e){const i=CQ(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||ck(i))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,EQ(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const i=EQ(this._keysButtonState,this._transformation);ck(i)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const i=this.view.pointsOfInterest.cameraOnSurface.location.z,r=1;this._filteredSurfaceElevation+=r*(i-this._filteredSurfaceElevation)*e}stepController(e,i){var r;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(i),this._updateCameraCenter(),(r=this._constraintOptions.interactionStartCamera)==null||r.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,sv),this._applyDisabledMovementTypes(sv),this._applyPan(sv.pan),this._applyRotate(sv.rotate),this._applyZoom(sv.zoom),this._applyAscend(sv.ascend),this._constraintOptions.interactionType=di.NONE,this._constraintOptions.selection=Zr.COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,i)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const i=this.currentCamera;Ce(ul,i.center,i.eye),st(ul,ul,e.matrix),i.center=xe(ul,ul,i.eye),i.up=st(ul,i.up,e.matrix),this._constraintOptions.interactionType=di.LOOK_AROUND,this._constraintOptions.selection=Zr.ALL_EXCEPT_COLLISION,Xn(this.view,i,this._constraintOptions)}_applyPan(e,i=this.currentCamera){e.enabled&&(i.eye=st(ul,i.eye,e.matrix),i.center=st(ul,i.center,e.matrix),this.view.state.isGlobal&&(i.up=st(ul,i.up,e.matrix)),this._constraintOptions.interactionType=di.PAN,this._constraintOptions.selection=Zr.ALL,Xn(this.view,i,this._constraintOptions))}_applyZoom(e){if(!e)return;const i=this.currentCamera.viewForward;this.currentCamera.eye=xe(ul,this.currentCamera.eye,pe(Qe.get(),i,e)),fe(SC,i),Ea(SC,SC),this._constraintOptions.interactionDirection=SC,this._constraintOptions.interactionType=di.ZOOM,this._constraintOptions.selection=Zr.ALL_EXCEPT_COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const i=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Qe.get());if(this._constraintOptions.interactionDirection=fe(SC,i),this.view.state.isGlobal){const r=ze(this.currentCamera.eye),n=(r+e)/r;this.currentCamera.eye=pe(ul,this.currentCamera.eye,n),this.currentCamera.center=pe(ul,this.currentCamera.center,n)}else{const r=pe(Qe.get(),i,e);this.currentCamera.eye=xe(ul,this.currentCamera.eye,r),this.currentCamera.center=xe(ul,this.currentCamera.center,r)}this._updateCameraCenter(),this._constraintOptions.interactionType=di.ASCEND,this._constraintOptions.selection=Zr.COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=Zr.ALL_EXCEPT_COLLISION,Xn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,i,r){S7e(r);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,i,r):this._calculateControlTransformationGlobal(n,i,r)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,i=this.view.renderCoordsHelper,r=this.currentCamera.ray;this.currentCamera.center=i.intersectManifoldClosestSilhouette(r,e,ul)}_calculateControlTransformationLocal(e,i,r){const{viewRight:n,viewForward:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=me(Qe.get(),s[0],s[1],0);Me(l,l);const c=o.translation[0]*e.pan;if(c!==0){const b=pe(Qe.get(),n,c);Dl(r.pan.matrix,r.pan.matrix,b),r.pan.enabled=!0}switch(a.mode){case"pan":{const b=-o.translation[1]*e.pan;if(b!==0){const x=pe(Qe.get(),l,b);Dl(r.pan.matrix,r.pan.matrix,x),r.pan.enabled=!0}r.zoom=o.zoom*e.zoom;break}case"zoom":r.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;r.ascend=u;const p=-o.heading*e.rotate;p!==0&&(vc(r.rotate.matrix,r.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(i.eye,Qe.get())),r.rotate.enabled=!0);const f=o.tilt*e.rotate,y=by(this.view.renderCoordsHelper,i.center,i.eye),v=$e(y+f,qo.min,qo.max)-y;v&&(vc(r.rotate.matrix,r.rotate.matrix,v,n),r.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,i,r){const{eye:n,viewRight:s}=i,o=this._transformation,a=this.view.navigation.gamepad,l=Rt(Qe.get(),s,n);Me(l,l),Ea(l,l),nBe(this.startCamera,i,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,r,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(sv.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;r.ascend=u;const p=-o.heading*e.rotate;p!==0&&(vc(r.rotate.matrix,r.rotate.matrix,p,this._tmpCamera.eye),r.rotate.enabled=!0);const f=o.tilt*e.rotate,y=this._clampTiltDeltaGlobalToValidRange(f,i.ray,c);y!==0&&(vc(r.rotate.matrix,r.rotate.matrix,y,this._tmpCamera.viewRight),r.rotate.enabled=!0),r.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,i,r){const n=lr(this.view.spatialReference),s=zI(qo.min,i.origin,r,n);let o=0,a=0;const l=Qe.get();if(this.view.renderCoordsHelper.intersectManifold(i,r,l)){const c=by(this.view.renderCoordsHelper,l,i.origin);o=zI(c,i.origin,r,n),a=zI(qo.max,i.origin,r,n)}else{gS(z5(B5,r+n.radius),i,l);const c=Math.PI+U5(i.direction,l);o=lQ(c,i.origin,r,n),a=lQ(qo.max,i.origin,r,n)}return $e(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,i,r){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=i+Math.abs(s-i);return n.setAltitude(r,o,e),o}_clampedDistanceToSurface(e,i){const{renderCoordsHelper:r}=this.view,{camera:n}=this.view.state,{direction:s}=NBe(this.view,i,0,S0e,T7e),o=r.intersectManifoldClosestSilhouette(Cu(i,s),e,Qe.get()),a=Nr(i,o),l=r.intersectManifoldClosestSilhouette(Cu(i,zg(Qe.get(),i,n.center)),e,Qe.get()),c=Nr(i,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:i,state:r}=this.view,{camera:n,isGlobal:s}=r,o=i.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,Qe.get());if(s){const a=Ce(Qe.get(),e,o),l=ze(a);pe(a,a,1/l);const c=Me(Qe.get(),e),u=qs(Re(c,a));return l*Math.sin(Math.min(v7e,u))}{const a=fe(Qe.get(),e);return i.setAltitude(a,this._filteredSurfaceElevation),Nr(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:b7e}_computeVelocities(e){const i=this._filteredSurfaceElevation,r=i+lr(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=Qe.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,i,o),l=this._clampedDistanceToSurface(i,o),c=n.width/2,u=AQ*n.width,p=AQ*n.width,f=l*Math.tan(.5*n.fovX)/c,y=f/r,v=f/this._computeHeadingRotateRadius(o),b=a-i;return{pan:(s?y:f)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*b-b),zoom:2**(u*e/c)*l-l,rotate:$e(v*p,w7e,x7e)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Vh(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Vh(e.rotate.matrix))}static activatesFor(e,i){const r=CQ(i,e.navigation.gamepad,y7e);return!(i.action==="end"||ck(r))}};d([m({constructOnly:!0})],L1.prototype,"gamepadDevice",void 0),d([m({constructOnly:!0})],L1.prototype,"disableMovements",void 0),L1=d([J("esri.views.3d.state.controllers.GamepadKeyboardController")],L1);const y7e={translation:[0,0,0],heading:0,tilt:0,zoom:0},S0e=80,v7e=Qt(S0e),AQ=.75,b7e=5,w7e=Qt(30),x7e=Qt(80),sv={zoom:0,ascend:0,pan:{enabled:!1,matrix:Ne()},rotate:{enabled:!1,matrix:Ne()}},ul=I(),SC=I(),T7e=bW();function S7e(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,Vh(t.pan.matrix),t.rotate.enabled=!1,Vh(t.rotate.matrix)}let C7e=class extends ko{constructor(e){super(!0),this._view=e,this._watchHandles=new an,this._handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([Pe(()=>this._view.navigation.gamepad.enabled,i=>{i?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},ar),Pe(()=>this._view.navigation.gamepad.device,i=>{this._cameraControllerGamepad&&i&&this._cameraControllerGamepad.gamepadDevice!==i&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const i=this._view.navigation.gamepad.device;if(i&&e.data.device!==i)return;const r=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(r||L1.activatesFor(this._view,e.data)){if(!r){const n=new L1({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var ic;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(ic||(ic={}));let E7e=class extends ko{constructor(e,i){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Ke.Local},this._keyToNumber={[i.left]:ic.LEFT,[i.right]:ic.RIGHT,[i.forward]:ic.FORWARD,[i.backward]:ic.BACKWARD,[i.up]:ic.UP,[i.down]:ic.DOWN,[i.headingLeft]:ic.HEADINGLEFT,[i.headingRight]:ic.HEADINGRIGHT,[i.tiltUp]:ic.TILTUP,[i.tiltDown]:ic.TILTDOWN,[i.zoomIn]:ic.ZOOMIN,[i.zoomOut]:ic.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new L1({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(i),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const i=this._keyToNumber[e.data.key];i!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(i),e.stopPropagation())}},A7e=class extends ko{constructor(e,i){super(!0),this._view=e,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const i=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new BD({view:this._view,mode:"interaction"}):new VD({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*i.deltaY,fn(i.x,i.y)),e.preventDefault(),e.stopPropagation()}},ZD=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},Eb=class extends XP{constructor(){super(...arguments),this._beginCamera=new It,this._elapsedTimeSec=0,this.constraintOptions={selection:Zr.ALL,interactionType:di.PAN,interactionFactor:0,interactionStartCamera:new It,interactionDirection:null,tiltMode:mo.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new RT}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,i){i.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,i),Xn(this.view,i,this.constraintOptions)}};Eb=d([J("esri.views.3d.state.controllers.momentum.MomentumController")],Eb);let HA=class extends Eb{constructor(e){super(e),this.interactionType=di.PAN,this._tmpPan=I()}momentumStep(e,i){const r=this.momentum.value(e);pe(this._tmpPan,this.momentum.direction,r),i.eye=Ce(PQ,i.eye,this._tmpPan),i.center=Ce(PQ,i.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([m({constructOnly:!0})],HA.prototype,"momentum",void 0),HA=d([J("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],HA);const PQ=I(),P7e=I(),vM=I();let VI=class extends Eb{constructor(e){super(e),this.interactionType=di.PAN}momentumStep(e,i){const r=this.momentum.value1(e),n=this.momentum.value2(e);fe(vM,i.eye),Me(vM,vM),Rt(this.momentum.axis2,vM,this.momentum.axis1),Yge(i,P7e,this.momentum.axis1,r,this.momentum.axis2,n)}};d([m({constructOnly:!0})],VI.prototype,"momentum",void 0),VI=d([J("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],VI);let b1=class extends Eb{set center(e){this._set("center",Kn(e))}set axis(e){this._set("axis",Kn(e))}constructor(e){super(e),this.interactionType=di.TUMBLE}momentumStep(e,i){const r=this.momentum.value(e);wy(i,this.center,YP(this.axis,r))}};d([m({constructOnly:!0})],b1.prototype,"momentum",void 0),d([m({constructOnly:!0})],b1.prototype,"center",null),d([m({constructOnly:!0})],b1.prototype,"axis",null),b1=d([J("esri.views.3d.state.controllers.momentum.MomentumController")],b1);let E2=class extends Eb{set zoomCenter(e){this._set("zoomCenter",Kn(e))}constructor(e){super(e),this.interactionType=di.ZOOM,this.constraintOptions.interactionDirection=I()}momentumStep(e,i){const{interactionDirection:r}=this.constraintOptions;if(!r)return;fe(r,i.eye);const n=this.momentum.valueDelta(0,e);gW(i,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),zg(r,i.eye,r)}};d([m({constructOnly:!0})],E2.prototype,"momentum",void 0),d([m({constructOnly:!0})],E2.prototype,"zoomCenter",null),E2=d([J("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],E2);let e1=class extends Eb{set screenCenter(e){this._set("screenCenter",fn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",Kn(e))}constructor(e){super(e),this.interactionType=di.ZOOM,this.radius=0,this._tmpSceneCenter=I(),this._tmpZoomAxisAngle=_4(),this._sphere=kn()}initialize(){this._sphere[3]=this.radius}momentumStep(e,i){const r=this.momentum.valueDelta(0,e);jge(this._sphere,i,r),this.constraintOptions.interactionType=di.ZOOM,Xn(this.view,i,this.constraintOptions),JP(this._sphere,i,this.screenCenter,this._tmpSceneCenter),pW(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),wy(i,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=di.PAN}};d([m({constructOnly:!0})],e1.prototype,"momentum",void 0),d([m({constructOnly:!0})],e1.prototype,"screenCenter",null),d([m({constructOnly:!0})],e1.prototype,"sceneCenter",null),d([m({constructOnly:!0})],e1.prototype,"radius",void 0),e1=d([J("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],e1);let Hd=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const i=this.computeDelta(e);this._updateDelta(i)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},x4=class{constructor(e,i,r){this._initialVelocity=e,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,i){const r=this.value(e);return this.value(e+i)-r}valueFromInitialVelocity(e,i){i=Math.min(i,this.duration);const r=1-this.friction;return e*(r**i-1)/Math.log(r)}},O7e=class extends x4{constructor(e,i,r,n,s){super(e,i,r),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},C0e=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._time=new Hd(.6),this._screen=[new Hd(.4),new Hd(.4)],this._scene=[new Hd(.6),new Hd(.6),new Hd(.6)],this._tmpDirection=I()}add(e,i,r){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(r)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(i[0]),this._scene[1].update(i[1]),this._scene[2].update(i[2]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?0:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=n==null||r==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){me(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=ze(this._tmpDirection);n>0&&pe(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new O7e(e,i,r,s==null?0:n/s,this._tmpDirection)}},OQ=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const RQ=1e-5;let R7e=class extends x4{constructor(e,i,r,n,s,o=0,a){super(e,i,r),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},M7e=class{constructor(e=300,i=12,r=.84){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this.enabled=!0,this._tmpAxis1=I(),this._tmpAxis2=I(),this._tmpAngles=it(),this._time=new Hd(.3),this._screen=[new Hd(.4),new Hd(.4)],this._angle1=new OQ(.6),this._angle2=new OQ(.6),this._axis1=I(),this._axis2=I(),this._lastScene=I()}addMomentumDirectRotation(e,i,r,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;let a=Zge(this._lastScene,i,this._tmpAxis2,n,s,o);this._angle2.update(0),ba(this._tmpAxis2)<RQ?a=0:Me(this._axis1,this._tmpAxis2),this._angle1.update(a),fe(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}addMomentumPreserveHeading(e,i,r,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(r)<.01)return;Xge(this._lastScene,i,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),ba(this._tmpAxis2)<RQ?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Me(this._axis1,this._tmpAxis1),Me(this._axis2,this._tmpAxis2)),fe(this._lastScene,i)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(r)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,i=this._screen[1].filteredDelta,r=e==null||i==null?null:Math.sqrt(e*e+i*i),n=this._time.filteredDelta,s=r==null||n==null?0:r/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,i,r){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new R7e(e,i,r,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},E0e=class{constructor(e=2.5,i=.01,r=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=r,this._maxVelocity=n,this.enabled=!0,this.value=new Hd(.8),this.time=new Hd(.3)}add(e,i){if(this.enabled&&i!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta()){const r=this.value.computeDelta(e);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=$e(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,i,r){return new x4(e,i,r)}},A0e=class extends E0e{constructor(e=3,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){const r=this.value.lastValue;if(r!=null){let n=e-r;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=r+n}super.add(e,i)}},$7e=class extends x4{constructor(e,i,r){super(e,i,r)}value(e){const i=super.value(e);return Math.exp(i)}valueDelta(e,i){const r=super.value(e),n=super.value(e+i)-r;return Math.exp(n)}},P0e=class extends E0e{constructor(e=2.5,i=.01,r=.95,n=12){super(e,i,r,n)}add(e,i){super.add(Math.log(e),i)}createMomentum(e,i,r){return new $7e(e,i,r)}},C7=class extends Pf{constructor(){super(...arguments),this._smoothRotation=new ZD(.05),this._rotationAxis=I(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=Yi(),this._beginRadius=0,this._smoothScaling=new ZD(.05),this._zoomCenterScreen=fn(),this._zoomMomentumEstimator=new P0e,this._rotationMomentumEstimator=new A0e,this._panSphericalMomentumEstimator=new M7e,this._panPlanarMomentumEstimator=new C0e,this._adjustedSphere=kn(),this._tmp3d=I(),this._tmpScreenPointArray=fn(),this._beginScreenPoint=fn(),this._beginScenePoint=I(),this._screenPickPoint=fn(),this._scenePickPoint=I(),this._mode=po.Horizontal,this._sphere=kn(),this._pointerCount=0,this._tmpInteractionDirection=I(),this._constraintOptions={selection:Zr.ALL,interactionType:di.NONE,interactionFactor:0,interactionStartCamera:new It,interactionDirection:null,tiltMode:mo.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panPlanarMomentumEstimator.enabled=i,this._panSphericalMomentumEstimator.enabled=i,this._beginHeading=-oy.normalize(Qt(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),bf(e.center,this._screenPickPoint),Is(this._beginScreenPoint,this._screenPickPoint);const r=lr(this.view.spatialReference),n=Wge(this._intersectionHelper,this.startCamera,this._screenPickPoint,r,FT.Silhouette,this.view.map.ground.opacity===0?Jb:{});n.scenePickPoint!=null&&(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,fe(this._beginScenePoint,this._scenePickPoint),this._mode=v4(this.startCamera,this._screenPickPoint,r),this._mode===po.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1;this._mode===po.Horizontal?(i&&this._zoomSpherical(e),this._panningSpherical(e),i&&this._rotateSpherical(e)):(i&&this._zoomPlanar(e),this._panningPlanar(e),i&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return this._mode===po.Horizontal?new e1({view:this.view,momentum:i,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new E2({view:this.view,momentum:i,zoomCenter:this._beginScenePoint});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new b1({view:this.view,momentum:r,center:this._sphere,axis:this._rotationAxis});if(this._mode===po.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new VI({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new HA({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,i){const r=Ea(this._tmp3d,this.startCamera.viewForward);j3(this._scenePickPoint,r,this._panningPlane);const n=fn(this._screenPickPoint[0],0),s=I(),o=ze(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],JP(this._adjustedSphere,this.startCamera,n,s);const a=ta();this.startCamera.projectToRenderScreen(s,a);const l=I(),c=I(),u=I();Ce(l,this._scenePickPoint,this.currentCamera.eye);const p=ze(l);Me(l,l);const f=Vge*Math.max(Math.abs(this.view.camera.position.z),Gge),y=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,y4);let v=y??f;v=i?Math.min(v,p):v,fe(u,xe(c,this.currentCamera.eye,pe(c,l,v))),this._panningPlane[3]=-Re(this._panningPlane,u),this.startCamera.center=xe(c,this.startCamera.eye,pe(c,this.startCamera.viewForward,v));const b=bf(e.center,this._tmpScreenPointArray);y7(this._panningPlane,this.startCamera,b,this._beginScenePoint)}_zoomSpherical(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),jge(this._sphere,this.currentCamera,this._smoothScaling.value),bf(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=di.ZOOM,this._constraintOptions.interactionFactor=jd(e.radius-this._beginRadius),Xn(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const i=bf(e.center,this._tmpScreenPointArray);JP(this._sphere,this.currentCamera,i,this._tmp3d),_W(this._beginScenePoint,Re(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(Kge(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(Jge(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(i,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=di.PAN,this._constraintOptions.interactionFactor=jd(vb(this._screenPickPoint,i)),Xn(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Me(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Ea(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value,r=i+_7(e.angle-i),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(r);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),wy(this.currentCamera,this._sphere,YP(this._rotationAxis,s)),this._constraintOptions.interactionType=di.TUMBLE,this._constraintOptions.interactionFactor=jd(e.radius*r),Xn(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const i=bf(e.center,this._tmpScreenPointArray);y7(this._panningPlane,this.currentCamera,i,this._tmp3d)&&(qge(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(i,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=di.PAN,this._constraintOptions.interactionFactor=jd(vb(this._beginScreenPoint,i)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),Xn(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const i=this._beginRadius/e.radius,r=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=r,this._smoothScaling.update(i),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),gW(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=di.ZOOM,this._constraintOptions.interactionFactor=jd(e.radius-this._beginRadius),Xn(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){fe(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Ea(this._rotationAxis,this._rotationAxis);const i=this._smoothRotation.value;let r=e.angle-i;r=_7(r);const n=i+r,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),wy(this.currentCamera,this._sphere,YP(this._rotationAxis,o)),this._constraintOptions.interactionType=di.TUMBLE,this._constraintOptions.interactionFactor=jd(e.radius*o),Xn(this.view,this.currentCamera,this._constraintOptions)}};C7=d([J("esri.views.3d.state.controllers.global.PinchAndPanController")],C7);const MQ=Ge(0,0,1),I7e={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let E7=class extends Pf{constructor(){super(...arguments),this._rotationValueSmooth=new ZD(.05),this._scalingValueSmooth=new ZD(.05),this._planeHorizontal=Yi(),this._planeVertical=Yi(),this._rotationMomentumEstimator=new A0e,this._panMomentumEstimator=new C0e(300,12,.9),this._zoomMomentumEstimator=new P0e,this._beginRadius=0,this._beginCenter=I(),this._beginAngle=0,this._tmpPoints=[],this._panMode=po.Horizontal,this._beginCenterScreen=fn(),this._tmpCentroid3d=I(),this._tmpCentroid2d=fn(),this._tmp2d=fn(),this._pointerCount=0,this._constraintOptions={selection:Zr.ALL,interactionType:di.NONE,interactionFactor:0,interactionStartCamera:new It,interactionDirection:null,tiltMode:mo.TUMBLE}}begin(e){var v;if(!this.active)return;const i=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=i,this._rotationMomentumEstimator.enabled=i,this._panMomentumEstimator.enabled=i,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),bf(e.center,this._beginCenterScreen),ope(MQ,0,this._planeHorizontal);const r=I(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,r,this.view.map.ground.opacity===0?Jb:{}),s=I();Ea(s,this.startCamera.viewForward);const o=I();fe(o,MQ);const a=Re(s,o),l=Nh(a<0?-a:a);this._panMode=l>=I7e.ANGLE_THRESHOLD?po.Horizontal:po.Vertical;const c=Math.min(Vge,1/Math.abs(Re(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),Gge);Lz(this._planeHorizontal,this._planeHorizontal,r),this.startCamera.aboveGround||Dz(this._planeHorizontal,this._planeHorizontal);const u=I(),p=I(),f=I();Ce(u,r,this.currentCamera.eye);const y=ze(u);if(Me(u,u),this._panMode===po.Vertical){pe(o,o,a),Ce(this._planeVertical,s,o),Me(this._planeVertical,this._planeVertical),Lz(this._planeVertical,this._planeVertical,r);const b=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,y4);let x=b??c;x=n?Math.min(x,y):x,fe(f,xe(p,this.currentCamera.eye,pe(p,u,x))),this._planeVertical[3]=-Re(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),K6(this._tmpPoints,this._beginCenter)}else{const b=n?y:c;fe(f,xe(p,this.currentCamera.eye,pe(p,u,b))),this._planeHorizontal[3]=-Re(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),K6(this._tmpPoints,this._beginCenter)}(v=this._constraintOptions.interactionStartCamera)==null||v.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const i=e.pointers.size>1,r=this._panMode===po.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(i){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),gW(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=di.ZOOM,this._constraintOptions.interactionFactor=jd(Math.abs(e.radius-this._beginRadius)),Xn(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,r,this.currentCamera,this._tmpPoints),K6(this._tmpPoints,this._tmpCentroid3d),bf(e.center,this._tmpCentroid2d),qge(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=di.PAN,this._constraintOptions.interactionFactor=jd(vb(this._beginCenterScreen,this._tmpCentroid2d)),Xn(this.view,this.currentCamera,this._constraintOptions),i){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+_7(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp),wy(this.currentCamera,o,YP(s,u)),this._constraintOptions.interactionType=di.TUMBLE,this._constraintOptions.interactionFactor=jd(Math.abs(e.radius*u)),Xn(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const i=this._zoomMomentumEstimator.evaluateMomentum();if(i)return new E2({view:this.view,momentum:i,zoomCenter:this._beginCenter});const r=this._rotationMomentumEstimator.evaluateMomentum();if(r)return new b1({view:this.view,momentum:r,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new HA({view:this.view,momentum:n}):null}_computePlanePoints(e,i,r,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=I()),y7(i,r,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};E7=d([J("esri.views.3d.state.controllers.local.PinchAndPanController")],E7);let $Q=class extends ko{constructor(e,i,r){super(!0),this._view=e,this.pointerAction=i,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",r,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!vW(e.data,this.pointerAction))return;const i=e.timestamp-this._lastEndTimestamp,r=40,n=this._momentum&&this._momentum.active&&i<r;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,i){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const r=this._controller.end(e.data);i&&r&&(this._momentum=r,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new C7({view:this._view}):new E7({view:this._view})}},L7e=class extends ko{constructor(e,i){super(!0),this.view=e,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}},O0e=class extends ko{constructor(e,i){super(!0),this.key=e,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},D7e=class extends O0e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},N7e=class extends O0e{constructor(e,i,r){super(i,r),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},F7e=class extends ko{constructor(e,i=!1){super(!0),this._view=e,this._invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(e){var n,s,o;const i=this._invert?-1:1,r=fn(0,e.data.delta*i);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new jA({view:this._view,pivot:cc.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(r);break;case"update":(s=this._cameraController)==null||s.update(r);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function IQ(t){const e=t.native;return e?{buttons:e.buttons.map(i=>i.pressed?i.value||1:0),axes:e.axes.map(i=>z7e(i,t.axisThreshold))}:{buttons:[],axes:[]}}function k7e(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let i=0;i<t.axes.length;i++)if(t.axes[i]!==e.axes[i])return!1;for(let i=0;i<t.buttons.length;i++)if(t.buttons[i]!==e.buttons[i])return!1;return!0}function U7e(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function z7e(t,e){const i=Math.abs(t);return i<e?0:Math.sign(t)*(i-e)/(1-e)}let B7e=class{constructor(e,i){this._element=e,this._input=i,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,IQ(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const r="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=r&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const i=new gH(e);i.deviceType!=="unknown"&&(this._inputDevices[e.index]=i,this._input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=cT({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),i=this._element.contains(document.activeElement),r=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=IQ(s),l=r||U7e(a);o&&(o.timestamp===n.timestamp||!o.active&&l||k7e(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const n=i[r];this._validate(n)&&e(n)}}_emitGamepadEvent(e,i,r){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!r)return;const o=!s&&r?"start":s&&r?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:i,active:r},this._callback&&this._callback({device:this._inputDevices[e.index],state:i,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let i=0;i<e.axes.length;i++)if(isNaN(e.axes[i]))return!1;return!0}};const LQ=ge("edge"),V7e=ge("chrome"),G7e=ge("ff"),j7e=ge("safari"),DQ="esri-view-surface",Vw={touchNone:`${DQ}--touch-none`,touchPan:`${DQ}--touch-pan`};let R0e=class M0e{constructor(e,i){this._input=i,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new B7e(e,this._input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=Je(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const i in this._active)if(!e||!e.has(i)){const r=this._active[i];this._element.removeEventListener(uk[i],r),delete this._active[i]}e&&e.forEach(i=>{if(!this._active[i]&&uk[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(uk[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,i){i?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?Vw.touchNone:Vw.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?Vw.touchPan:Vw.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(Vw.touchNone),this._element.classList.remove(Vw.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,i){const r=hfe(this._element,e);return M0e.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(e,i){const r=f5e(i);r&&e==="key-up"&&this._keyDownState.delete(r);const n={native:i,key:r,repeat:!!r&&this._keyDownState.has(r)};r&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(e,r)}_handlePointerPreventDefault(e,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(e,r)}_handleMouseWheel(e,i){let r=i.deltaY;switch(i.deltaMode){case 0:LQ&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}LQ?r*=.7:V7e||j7e?r*=.6:G7e&&(r*=1.375);const n=100,s=Math.abs(r);s>n&&(r=r/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(e,o)}_handlePointerCaptureLost(e,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(e,i)}_handleDefault(e,i){const r={native:i};i.preventDefault(),this._callback(e,r)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};R0e.test={disableSubpixelCoordinates:!1};const uk={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let H7e=class extends ko{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function $0e(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function W7e(t,e){const i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function q7e(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Uh()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[C,R]=t,[N,$]=[R.x-C.x,R.y-C.y];return e.radius=Math.sqrt(N*N+$*$)/2,e.center.x=(C.x+R.x)/2,e.center.y=(C.y+R.y)/2,e}let i=0,r=0;for(let C=0;C<t.length;C++)i+=t[C].x,r+=t[C].y;i/=t.length,r/=t.length;const n=t.map(C=>C.x-i),s=t.map(C=>C.y-r);let o=0,a=0,l=0,c=0,u=0,p=0,f=0;for(let C=0;C<n.length;C++){const R=n[C],N=s[C],$=R*R,k=N*N;o+=$,a+=k,l+=R*N,c+=$*R,u+=k*N,p+=R*k,f+=N*$}const y=.5*(c+p),v=.5*(u+f),b=o*a-l*l,x=(y*a-v*l)/b,S=(o*v-l*y)/b,P=Uh(x+i,S+r);return{radius:Math.sqrt(x*x+S*S+(o+a)/t.length),center:P}}function WA(t){const{native:e}=t,{pointerId:i,button:r,pointerType:n}=e;return n==="mouse"?`${i}:${r}`:`${n}`}let Z7e=class extends ko{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,i,r,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:i.buttons,timestamp:n,pointers:X7e(this._activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(e){const i=e.native.pointerId,r=bM(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(i,n);const s=GI(n,I0e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(r)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const i=e.native.pointerId,r=this._activePointerMap.get(i);r?r.event=e:this._addPointer(e)}_removePointer(e){const i=bM(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(i)}_updatePointerAngles(e){const i=bM(this._activePointerMap);this._activePointerMap.forEach(r=>{r.initialAngle=GI(r,i)-e,r.lastAngle=GI(r,i)-e})}_emitEvent(e,i,r){const n=bM(this._activePointerMap);this._drag.emit(this._createPayload(e,i,n,r),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const i=e.data.native.pointerId,r=e.timestamp;this._activePointerMap.get(i)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,r),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const i=e.data,r=i.currentEvent,n=e.timestamp;switch(i.action){case"start":case"update":this._isDragging?this._activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this._isCurrentDragSuppressed&&this._emitEvent("update",r,n)):(this._addPointer(r),this._emitEvent("added",r,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(r),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",r,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function I0e(t){const e=[];return t.forEach(i=>{e.push(Uh(i.event.x,i.event.y))}),q7e(e)}function bM(t){const e=I0e(t);let i=0;return t.forEach(r=>{let n=GI(r,e),s=n-r.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=r.lastAngle+s,r.lastAngle=n;const o=n-r.initialAngle;i+=o}),i/=t.size||1,{angle:i,radius:e.radius,center:e.center}}function X7e(t){const e=new Map;return t.forEach((i,r)=>e.set(r,i.event)),e}function GI(t,e){const i=t.event,r=i.x-e.center.x,n=i.y-e.center.y;return Math.atan2(n,r)}var NQ;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(NQ||(NQ={}));const H_={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let Y7e=class extends ko{constructor(e=H_.maximumDoubleClickDelay,i=H_.maximumDoubleClickDistance,r=H_.maximumDoubleTouchDelay,n=H_.maximumDoubleTouchDistance,s=C3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=Qr(e.doubleClickTimer))}get hasPendingInputs(){return Yo(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,i){const r=this._pointerState.get(e);r&&(r.doubleClickTimer=Qr(r.doubleClickTimer),i&&this._click.emit(r.event.data,void 0,r.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const i=this._pointerState.get(e);i.pointerDownCount===1&&this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:i,pointerType:r,button:n}=e.native;return r==="mouse"?`${i}:${n}`:`${r}`}_handleImmediateClick(e){const i=e.data,{pointerType:r}=i.native,n=this._getPointerId(i);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=r==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;$0e(o,i)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const i=WA(e.data),r=this._pointerState.get(i);r&&(r.pointerDownCount+=1)}_startClick(e){const{data:i}=e,{native:{pointerType:r}}=i,n=WA(i),s=r==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},J7e=class extends ko{constructor(e=H_.maximumDoubleClickDelay,i=H_.maximumDoubleClickDistance,r=H_.maximumDoubleTouchDelay,n=H_.maximumDoubleTouchDistance,s=C3){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=i,this._maximumDoubleTouchDelay=r,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=WA(i);if(!this._pointerState.has(r)){const n={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,n),this.startCapturingPointer(i.native)}}_handlePointerUp(e){const i=e.data,r=WA(i),n=this._pointerState.get(r);if(n&&n.downButton===i.native.button){const s=n.immediateDoubleClick;if(s){s.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;$0e(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(i))}else this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,i){const r=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;i.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),r)}}_removeState(e){const i=WA(e);this._pointerState.delete(i),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const CC={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let K7e=class extends ko{constructor(e=CC.maximumClickDelay,i=CC.movementUntilMouseDrag,r=CC.movementUntilPenDrag,n=CC.movementUntilTouchDrag,s=CC.holdDelay,o=C3){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=i,this._movementUntilPenDrag=r,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=Qr(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const i=e.data,r=i.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:i,previousEvent:i,startTimestamp:e.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(r,s),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,i,r){return{action:e,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(e){const i=e.data,r=i.native.pointerId,n=this._pointerState.get(r);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,i),void 0,n.modifiers):W7e(i,n.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(e),n.previousEvent=i)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const i=e.data,r=i.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,r===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,i)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,i){const r=e.data,n=r.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,i==="pointer-up"?r:s.previousEvent),void 0,s.modifiers):i==="pointer-up"&&s.downButton===r.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(n),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}},Q7e=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const i=e.data,r=i.pointers.size;switch(i.action){case"start":this._currentCount=r,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=r,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var i,r;this._startEvent=e,(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var i,r;(r=(i=this._callbacks).condition)!=null&&r.call(i,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},eVe=class extends ko{constructor(e=20,i=40){super(!1),this._threshold=e,this._maxDelta=i,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new Q7e({start:(r,n)=>this._observeStart(r,n),update:(r,n,s)=>this._observeUpdate(r,n,s),end:(r,n)=>this._observeEnd(n)}),this.registerIncoming("drag",r=>this._dragEventSeparator.handle(r))}get failed(){return this._state==="failed"}_observeStart(e,i){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,i,r){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,i){let r=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:b,y:x}of i.pointers.values())r=Math.max(r,b),n=Math.min(n,b),s=Math.max(s,x),o=Math.min(o,x);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:b,y:x}of e.pointers.values())a=Math.max(a,b),l=Math.min(l,b),c=Math.max(c,x),u=Math.min(u,x);const p=r-n,f=s-o,y=a-l,v=c-u;return Math.abs(e.center.x-i.center.x)<this._threshold&&Math.abs(y-p)<=this._maxDelta&&Math.abs(v-f)<=this._maxDelta}_checkVerticalThresholdReached(e,i){let r=Math.abs(e.center.y-i.center.y);return e.pointers.forEach((n,s)=>{const o=i.pointers.get(s);r=Math.min(r,Math.abs(n.y-o.y))}),r>=this._threshold}},Ed=class extends ke{constructor(){super(...arguments),this._handles=new an}destroy(){this._handles=Je(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=Je(this._inputManager)}connect(){const e=this.view;this._source=new R0e(this.view.surface,e.input);const i=[new J7e,new K7e,new Y7e,new Z7e(this.view.navigation),new eVe],r=new th({eventSource:this._source,recognizers:i});this._inputManager=r,r.installHandlers("prevent-context-menu",[new H7e],Y_.INTERNAL),this._modeDragPan=new $Q(e,"primary"),this._modeDragRotate=new lk(e,"secondary",cc.CENTER),this._modeDragZoom=new _7e(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};r.installHandlers("navigation",[new L7e(e),new hBe(e),new C7e(e),new E7e(e,n.pan),new A7e(e),new N7e(e,n.resetTilt),new D7e(e,n.resetHeading),new lk(e,"primary",cc.EYE,[n.lookAround]),new lk(e,"secondary",cc.CENTER,[n.lookAround]),new $Q(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new F7e(e)],Y_.INTERNAL),this.view.viewEvents.connect(r),this._updateMode(),this._handles.add(Pe(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},ar))}_updateMode(){var n;const e=this.mode,i=this.primaryDragAction,r=(n=A7.get(e))==null?void 0:n.get(i);r&&(this._modeDragPan&&(this._modeDragPan.pointerAction=r.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=r.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=r.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};d([m()],Ed.prototype,"view",void 0),d([m({value:"pan"})],Ed.prototype,"primaryDragAction",null),d([m({value:"default"})],Ed.prototype,"mode",null),d([m({readOnly:!0})],Ed.prototype,"updating",null),d([m()],Ed.prototype,"latestPointerType",null),d([m()],Ed.prototype,"latestPointerLocation",null),d([m()],Ed.prototype,"multiTouchActive",null),d([m()],Ed.prototype,"_inputManager",void 0),Ed=d([J("esri.views.3d.input.SceneInputManager")],Ed);const A7=new Map,hk=new Map,dk=new Map;hk.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),hk.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),dk.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),dk.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),A7.set("default",hk),A7.set("pro",dk);const tVe=Ed;let Vn=class extends ke{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([m()],Vn.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([m()],Vn.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([m()],Vn.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([m()],Vn.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([m()],Vn.prototype,"LABELS_SHOW_BORDER",void 0),d([m()],Vn.prototype,"TEXT_SHOW_BASELINE",void 0),d([m()],Vn.prototype,"TEXT_SHOW_BORDER",void 0),d([m()],Vn.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([m()],Vn.prototype,"OVERLAY_SHOW_CENTER",void 0),d([m()],Vn.prototype,"SHOW_POI",void 0),d([m()],Vn.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([m()],Vn.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([m()],Vn.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([m()],Vn.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([m()],Vn.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([m()],Vn.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([m()],Vn.prototype,"I3S_TREE_SHOW_TILES",void 0),d([m()],Vn.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([m()],Vn.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([m()],Vn.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([m()],Vn.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([m()],Vn.prototype,"LINE_WIREFRAMES",void 0),Vn=d([J("esri.views.3d.support.DebugFlags")],Vn);const Or=new Vn;let tu,Y2,P7=!1,O7=!1,R7=!1,M7=!1,qA=null;function iVe(t,e){if(!O7||!Y2)return;L0e();const i=Y2;let r=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];r+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,u=(s+1)*t.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),D0e(a,l,c,u,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+e.size,70,50),i.fillText("total numTests: "+t.accNumTests,70,30)}function rVe(t){R7=Or.DECONFLICTOR_SHOW_VISIBLE,M7=Or.DECONFLICTOR_SHOW_INVISIBLE,P7=R7||M7,O7=Or.DECONFLICTOR_SHOW_GRID,qA=null,P7||O7?qA=()=>nVe(t):tu&&(tu.parentElement.removeChild(tu),tu=null)}function L0e(){qA&&(qA(),qA=null)}function nVe(t){tu==null&&(tu=document.createElement("canvas"),tu.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(tu));const{state:e}=t,{camera:i,pixelRatio:r}=e,{width:n,height:s}=i,o=n*r,a=s*r;tu.setAttribute("width",`${o}px`),tu.setAttribute("height",`${a}px`),tu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),Y2=tu.getContext("2d"),Y2.clearRect(0,0,n,s),Y2.font="12px Arial"}function D0e(t,e,i,r,n){L0e();const s=tu.height,o=Y2;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-i),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.lineTo(t,s-i),o.stroke(),o.closePath()}function sVe(t,e){P7&&(e&&R7||!e&&M7)&&D0e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var Qo,co;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(Qo||(Qo={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(co||(co={}));function N0e(t,e){return new z0e(t,V0e,e)}function oVe(t,e){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:n}=V0e;return new z0e(t,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:pk.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:pk.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:n,minPixelSize:pk.minPixelSize},e)}function aVe(t){return Math.abs(t*t*t)}function F0e(t,e,i){const r=i.parameters,n=i.paddingPixelsOverride;return EC.scale=Math.min(r.divisor/(e-r.offset),1),EC.factor=aVe(t),EC.minPixelSize=r.minPixelSize,EC.paddingPixels=n,EC}function k0e(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function AW(t,e){return Math.max(Bt(t*e.scale,t,e.factor),k0e(t,e))}function lVe(t,e,i){const r=F0e(t,e,i);return r.minPixelSize=0,r.paddingPixels=0,AW(1,r)}function FQ(t,e,i,r){r.scale=lVe(t,e,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function U0e(t,e,i=[0,0]){const r=Math.min(Math.max(e.scale,k0e(t[1],e)/Math.max(1e-5,t[1])),1);return i[0]=t[0]*r,i[1]=t[1]*r,i}function cVe(t,e,i,r){return AW(t,F0e(e,i,r))}let z0e=class B0e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,i,r,n=uVe(),s){this._viewingMode=e,this._description=i,this._ellipsoidRadius=r,this.parameters=n,this._paddingPixelsOverride=s,this._viewingMode===Ke.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new B0e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,i,r){const{scaleStart:n,scaleFallOffRange:s,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,i),u=this._coverageCompensation(e,i,c),{tiltAngle:p,scaleFallOffFactor:f}=c,y=Math.sin(p)*l,v=.5*Math.PI-p-a*(.5-n*u),b=y/Math.cos(v),x=v+a*s*u,S=(b-f*(y/Math.cos(x)))/(1-f);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=S,r.divisor=b-S,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(e,i,r=kQ){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,i,r=kQ){const n=this._description.curvatureDependent,s=1+e.distance/i,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=$e((o-a)/(l-a),0,1),[u,p]=[n.min,n.max];return r.tiltAngle=Bt(u.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=Bt(u.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(e,i,r){return(e.fovY-r.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,i,r){const n=i*i,s=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*i,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(i/(c/Math.sin(s)))+.5*o)/o}};const V0e={curvatureDependent:{min:{curvature:Qt(10),tiltAngle:Qt(12),scaleFallOffFactor:.5},max:{curvature:Qt(70),tiltAngle:Qt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},pk={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function uVe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const EC={scale:0,factor:0,minPixelSize:0,paddingPixels:0},kQ={tiltAngle:0,scaleFallOffFactor:0};function hVe(t){return t instanceof Float32Array&&t.length>=16}function dVe(t){return Array.isArray(t)&&t.length>=16}function pVe(t){return hVe(t)||dVe(t)}function PW(t){t.vertex.code.add(T`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(T`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function fVe(t){t.uniforms.add(new yi("screenSizePerspective",e=>G0e(e.screenSizePerspective)))}function T4(t){t.uniforms.add(new yi("screenSizePerspectiveAlignment",e=>G0e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function G0e(t){return Br(mVe,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const mVe=gi();var Jr,yh,ZA,xn,Ss;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(Jr||(Jr={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(yh||(yh={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(ZA||(ZA={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(xn||(xn={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(Ss||(Ss={}));let gVe=class{constructor(e,i){this.vec3=e,this.id=i}};function XD(t,e,i,r){return new gVe(Ge(t,e,i),r)}var Wa;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(Wa||(Wa={}));const OW=1.3;let UQ=class{get extent(){return this._extent}constructor(e,i){this.index=e,this.renderTargets=i,this._extent=li(),this.resolution=0,this.renderLocalOrigin=XD(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new _Ve,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(i.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const i=e===Wa.ColorAndWater?this.renderTargets.getTarget(xn.Color):e===Wa.Highlight?this.renderTargets.getTarget(xn.Highlight):e===Wa.ObjectAndLayerIdColor?this.renderTargets.getTarget(xn.ObjectAndLayerIdColor):this.renderTargets.getTarget(xn.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(xn.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(xn.Color):null}getNormalTexture(e){const i=e===Wa.ColorAndWater?this.renderTargets.getTarget(xn.Water):null;return i?i.getTexture():null}draw(e,i){const r=this.computeRenderTargetValidityBitfield();for(const n of this.renderTargets.renderTargets)n.type!==xn.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[n.type]=e.drawTarget(this,n,i):this.validTargets[n.type]=!1;return r^this.computeRenderTargetValidityBitfield()?$T.CHANGED:$T.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[xn.Color]|+e[xn.ColorNoRasterImage]<<1|+e[xn.Highlight]<<2|+e[xn.Water]<<3|+e[xn.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const i=.001*e.range;if(this._extent[0]-i<=e.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];kL(this._extent,e.range,0,r)}if(this._extent[2]+i>=e.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];kL(this._extent,-e.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Rg(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const i=this.canvasGeometries.extents[e];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===Jr.INNER?0:this.resolution,0,this.resolution,this.resolution)}},_Ve=class{constructor(){this.extents=[li(),li(),li()],this.numViews=0}},j0e=class extends On{constructor(e,i){super(e,"mat4",vr.Draw,(r,n,s)=>r.setUniformMatrix4fv(e,i(n,s)))}};function gp(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",tl):t.uniforms.add(new yu("cameraPosition",(i,r)=>me(H0e,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Tc(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new en("proj",(r,n)=>n.camera.projectionMatrix),new j0e("view",(r,n)=>Dl(zQ,n.camera.viewMatrix,r.origin)),new yu("localOrigin",r=>r.origin));const i=r=>me(H0e,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new en("proj",(r,n)=>n.camera.projectionMatrix),new en("view",(r,n)=>Dl(zQ,n.camera.viewMatrix,i(n))),new ei("localOrigin",(r,n)=>i(n)))}const zQ=Ne(),H0e=I();function UT(t){t.uniforms.add(new en("viewNormal",(e,i)=>i.camera.viewInverseTransposeMatrix))}function ES(t,e){t.uniforms.add(new je("pixelRatio",(i,r)=>r.camera.pixelRatio/(e.draped?OW:1)))}function W0e(t,e){const i=t.vertex;e.hasVerticalOffset?(q0e(i),e.hasScreenSizePerspective&&(t.include(PW),T4(i),gp(t.vertex,e)),i.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const yVe=gi();function q0e(t){t.uniforms.add(new yi("verticalOffset",(e,i)=>{const{minWorldLength:r,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return Br(yVe,s*a,o,r,n)}))}function S4(t){t.uniforms.add(new kf("alignPixelEnabled",(e,i)=>i.alignPixelEnabled)),t.code.add(T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var oc;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(oc||(oc={}));var Pl;function Z0e(t,e){t.include(PW),t.attributes.add(M.POSITION,"vec3"),t.attributes.add(M.NORMAL,"vec3"),t.attributes.add(M.AUXPOS1,"vec4");const i=t.vertex;Tc(i,e),gp(i,e),i.uniforms.add(new yi("viewport",(r,n)=>n.camera.fullViewport),new je("polygonOffset",r=>r.shaderPolygonOffset),new je("cameraGroundRelative",(r,n)=>n.camera.aboveGround?1:-1),new je("renderTransparentlyOccludedHUD",(r,n)=>n.renderTransparentlyOccludedHUD===oc.Occluded?1:n.renderTransparentlyOccludedHUD===oc.NotOccluded?0:.75),new vt("hudVisibilityTexture",(r,n)=>n.hudVisibilityTexture)),e.hasVerticalOffset&&q0e(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(T`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||UT(i),e.draped||(i.uniforms.add(new je("perDistancePixelRatio",(r,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),i.code.add(T`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===Pl.Screen&&ES(i,e),e.hasScreenSizePerspective&&T4(i),i.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===Pl.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==Pl.Screen?T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===Pl.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===Pl.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.include(S4),i.code.add(T`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(Pl||(Pl={}));const wM=$s();function X0e(t,e,i,r,n,s){if(t.visible)if(t.boundingInfo){xt(t.type===An.Mesh);const o=e.tolerance;Y0e(t.boundingInfo,i,r,o,n,s)}else{const o=t.indices.get(M.POSITION),a=t.vertexAttributes.get(M.POSITION);eO(i,r,0,o.length/3,o,a,void 0,n,s)}}const vVe=I();function Y0e(t,e,i,r,n,s){if(t==null)return;const o=K0e(e,i,vVe);if(Vue(wM,t.bbMin),Gue(wM,t.bbMax),n!=null&&n.applyToAabb(wM),MW(wM,e,o,r)){const{primitiveIndices:a,indices:l,position:c}=t,u=a?a.length:l.length/3;if(u>TVe){const p=t.getChildren();if(p!==void 0){for(const f of p)Y0e(f,e,i,r,n,s);return}}eO(e,i,0,u,l,c,a,n,s)}}const J0e=I();function eO(t,e,i,r,n,s,o,a,l){if(o)return bVe(t,e,i,r,n,s,o,a,l);const{data:c,stride:u}=s,p=t[0],f=t[1],y=t[2],v=e[0]-p,b=e[1]-f,x=e[2]-y;for(let S=i,P=3*i;S<r;++S){let C=u*n[P++],R=c[C++],N=c[C++],$=c[C];C=u*n[P++];let k=c[C++],B=c[C++],W=c[C];C=u*n[P++];let Z=c[C++],K=c[C++],X=c[C];a!=null&&([R,N,$]=a.applyToVertex(R,N,$,S),[k,B,W]=a.applyToVertex(k,B,W,S),[Z,K,X]=a.applyToVertex(Z,K,X,S));const ae=k-R,re=B-N,ee=W-$,oe=Z-R,U=K-N,V=X-$,H=b*V-U*x,Y=x*oe-V*v,ie=v*U-oe*b,le=ae*H+re*Y+ee*ie;if(Math.abs(le)<=Number.EPSILON)continue;const ue=p-R,ve=f-N,Ie=y-$,Ve=ue*H+ve*Y+Ie*ie;if(le>0){if(Ve<0||Ve>le)continue}else if(Ve>0||Ve<le)continue;const Mt=ve*ee-re*Ie,ot=Ie*ae-ee*ue,Pt=ue*re-ae*ve,qe=v*Mt+b*ot+x*Pt;if(le>0){if(qe<0||Ve+qe>le)continue}else if(qe>0||Ve+qe<le)continue;const Ee=(oe*Mt+U*ot+V*Pt)/le;Ee>=0&&l(Ee,RW(ae,re,ee,oe,U,V,J0e),S,!1)}}function bVe(t,e,i,r,n,s,o,a,l){const{data:c,stride:u}=s,p=t[0],f=t[1],y=t[2],v=e[0]-p,b=e[1]-f,x=e[2]-y;for(let S=i;S<r;++S){const P=o[S];let C=3*P,R=u*n[C++],N=c[R++],$=c[R++],k=c[R];R=u*n[C++];let B=c[R++],W=c[R++],Z=c[R];R=u*n[C];let K=c[R++],X=c[R++],ae=c[R];a!=null&&([N,$,k]=a.applyToVertex(N,$,k,S),[B,W,Z]=a.applyToVertex(B,W,Z,S),[K,X,ae]=a.applyToVertex(K,X,ae,S));const re=B-N,ee=W-$,oe=Z-k,U=K-N,V=X-$,H=ae-k,Y=b*H-V*x,ie=x*U-H*v,le=v*V-U*b,ue=re*Y+ee*ie+oe*le;if(Math.abs(ue)<=Number.EPSILON)continue;const ve=p-N,Ie=f-$,Ve=y-k,Mt=ve*Y+Ie*ie+Ve*le;if(ue>0){if(Mt<0||Mt>ue)continue}else if(Mt>0||Mt<ue)continue;const ot=Ie*oe-ee*Ve,Pt=Ve*re-oe*ve,qe=ve*ee-re*Ie,Ee=v*ot+b*Pt+x*qe;if(ue>0){if(Ee<0||Mt+Ee>ue)continue}else if(Ee>0||Mt+Ee<ue)continue;const at=(U*ot+V*Pt+H*qe)/ue;at>=0&&l(at,RW(re,ee,oe,U,V,H,J0e),P,!1)}}const BQ=I(),VQ=I();function RW(t,e,i,r,n,s,o){return me(BQ,t,e,i),me(VQ,r,n,s),Rt(o,BQ,VQ),Me(o,o),o}function K0e(t,e,i){return me(i,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function MW(t,e,i,r){return $W(t,e,i,r,1/0)}function $W(t,e,i,r,n){const s=(t[0]-r-e[0])*i[0],o=(t[3]+r-e[0])*i[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-r-e[1])*i[1],u=(t[4]+r-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const p=(t[2]-r-e[2])*i[2],f=(t[5]+r-e[2])*i[2];return l=Math.min(l,Math.max(p,f)),!(l<0)&&(a=Math.max(a,Math.min(p,f)),!(a>l)&&a<n)}function Q0e(t,e,i,r,n){let s=(i.screenLength||0)*t.pixelRatio;n!=null&&(s=cVe(s,r,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return $e(o*e,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function e_e(t,e){const i=e?e_e(e):{};for(const r in t){let n=t[r];n&&n.forEach&&(n=xVe(n)),n==null&&r in i||(i[r]=n)}return i}function wVe(t,e){let i=!1;for(const r in e){const n=e[r];n!==void 0&&(Array.isArray(n)?t[r]===null?(t[r]=n.slice(),i=!0):KV(t[r],n)&&(i=!0):t[r]!==n&&(i=!0,t[r]=n))}return i}function xVe(t){const e=[];return t.forEach(i=>e.push(i)),e}const t_e={multiply:1,ignore:2,replace:3,tint:4},TVe=1e3;let Ly=class extends Y3{constructor(e,i){super(),this.type=An.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Ni,this._pp0=Ge(0,0,1),this._pp1=Ge(0,0,0),this._parameters=e_e(e,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,i=!0){wVe(this._parameters,e)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,i,r,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,i,r,this._pp0,this._pp1,s)}},i_e=class extends jUe{constructor(e,i,r){super(i,r),this.camera=e}};var Kr;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(Kr||(Kr={}));let IW=class extends wr{constructor(){super(...arguments),this.renderOccluded=Kr.Occlude}},r_e=class{constructor(){this.factor=new GQ,this.factorAlignment=new GQ}},GQ=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function cwt(t,e,i,r,n=1){const s=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,n===1)for(let l=0;l<a;++l)s[r]=e[t[l]],r+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let u=0;u<n;u++)s[r]=c,r+=o}}function jQ(t,e,i,r){const n=i.typedBuffer,s=i.typedBufferStride,o=t.length;r*=s;for(let a=0;a<o;++a){const l=2*t[a];n[r]=e[l],n[r+1]=e[l+1],r+=s}}function n_e(t,e,i,r,n){const s=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,n==null||n===1)for(let l=0;l<a;++l){const c=3*t[l];s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let u=0;u<n;++u)s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],r+=o}}function zT(t,e,i,r,n=1){const s=i.typedBuffer,o=i.typedBufferStride,a=t.length;if(r*=o,n===1)for(let l=0;l<a;++l){const c=4*t[l];s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],s[r+3]=e[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let u=0;u<n;++u)s[r]=e[c],s[r+1]=e[c+1],s[r+2]=e[c+2],s[r+3]=e[c+3],r+=o}}function HQ(t,e,i){const r=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<i;++s)r[e]=0,r[e+1]=0,r[e+2]=0,r[e+3]=0,e+=n}function LW(t,e,i,r,n,s=1){if(!i)return void n_e(t,e,r,n,s);const o=r.typedBuffer,a=r.typedBufferStride,l=t.length,c=i[0],u=i[1],p=i[2],f=i[4],y=i[5],v=i[6],b=i[8],x=i[9],S=i[10],P=i[12],C=i[13],R=i[14];n*=a;let N=0,$=0,k=0;const B=L5(i)?W=>{N=e[W]+P,$=e[W+1]+C,k=e[W+2]+R}:W=>{const Z=e[W],K=e[W+1],X=e[W+2];N=c*Z+f*K+b*X+P,$=u*Z+y*K+x*X+C,k=p*Z+v*K+S*X+R};if(s===1)for(let W=0;W<l;++W)B(3*t[W]),o[n]=N,o[n+1]=$,o[n+2]=k,n+=a;else for(let W=0;W<l;++W){B(3*t[W]);for(let Z=0;Z<s;++Z)o[n]=N,o[n+1]=$,o[n+2]=k,n+=a}}function DW(t,e,i,r,n,s=1){if(!i)return void n_e(t,e,r,n,s);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,u=o[0],p=o[1],f=o[2],y=o[4],v=o[5],b=o[6],x=o[8],S=o[9],P=o[10],C=!kj(o),R=1e-6,N=1-R;n*=l;let $=0,k=0,B=0;const W=L5(o)?Z=>{$=e[Z],k=e[Z+1],B=e[Z+2]}:Z=>{const K=e[Z],X=e[Z+1],ae=e[Z+2];$=u*K+y*X+x*ae,k=p*K+v*X+S*ae,B=f*K+b*X+P*ae};if(s===1)if(C)for(let Z=0;Z<c;++Z){W(3*t[Z]);const K=$*$+k*k+B*B;if(K<N&&K>R){const X=1/Math.sqrt(K);a[n]=$*X,a[n+1]=k*X,a[n+2]=B*X}else a[n]=$,a[n+1]=k,a[n+2]=B;n+=l}else for(let Z=0;Z<c;++Z)W(3*t[Z]),a[n]=$,a[n+1]=k,a[n+2]=B,n+=l;else for(let Z=0;Z<c;++Z){if(W(3*t[Z]),C){const K=$*$+k*k+B*B;if(K<N&&K>R){const X=1/Math.sqrt(K);$*=X,k*=X,B*=X}}for(let K=0;K<s;++K)a[n]=$,a[n+1]=k,a[n+2]=B,n+=l}}function SVe(t,e,i,r,n,s=1){if(!i)return void zT(t,e,r,n,s);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=t.length,u=o[0],p=o[1],f=o[2],y=o[4],v=o[5],b=o[6],x=o[8],S=o[9],P=o[10],C=!kj(o),R=1e-6,N=1-R;if(n*=l,s===1)for(let $=0;$<c;++$){const k=4*t[$],B=e[k],W=e[k+1],Z=e[k+2],K=e[k+3];let X=u*B+y*W+x*Z,ae=p*B+v*W+S*Z,re=f*B+b*W+P*Z;if(C){const ee=X*X+ae*ae+re*re;if(ee<N&&ee>R){const oe=1/Math.sqrt(ee);X*=oe,ae*=oe,re*=oe}}a[n]=X,a[n+1]=ae,a[n+2]=re,a[n+3]=K,n+=l}else for(let $=0;$<c;++$){const k=4*t[$],B=e[k],W=e[k+1],Z=e[k+2],K=e[k+3];let X=u*B+y*W+x*Z,ae=p*B+v*W+S*Z,re=f*B+b*W+P*Z;if(C){const ee=X*X+ae*ae+re*re;if(ee<N&&ee>R){const oe=1/Math.sqrt(ee);X*=oe,ae*=oe,re*=oe}}for(let ee=0;ee<s;++ee)a[n]=X,a[n+1]=ae,a[n+2]=re,a[n+3]=K,n+=l}}function s_e(t,e,i,r,n,s=1){const o=r.typedBuffer,a=r.typedBufferStride,l=t.length;if(n*=a,i!==e.length||i!==4)if(s!==1)if(i!==4)for(let c=0;c<l;++c){const u=3*t[c];for(let p=0;p<s;++p)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}else for(let c=0;c<l;++c){const u=4*t[c];for(let p=0;p<s;++p)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}else{if(i===4){for(let c=0;c<l;++c){const u=4*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}return}for(let c=0;c<l;++c){const u=3*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}}else{o[n]=e[0],o[n+1]=e[1],o[n+2]=e[2],o[n+3]=e[3];const c=new Uint32Array(r.typedBuffer.buffer,r.start),u=a/4,p=c[n/=4];n+=u;const f=l*s;for(let y=1;y<f;++y)c[n]=p,n+=u}}function CVe(t,e,i,r){const n=i.typedBuffer,s=i.typedBufferStride,o=t.length,a=e[0];r*=s;for(let l=0;l<o;++l)n[r]=a,r+=s}function o_e(t,e,i,r,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(r*=o,n===1)for(let a=0;a<i;++a)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o;else for(let a=0;a<i;++a)for(let l=0;l<n;++l)s[r]=t[0],s[r+1]=t[1],s[r+2]=t[2],s[r+3]=t[3],r+=o}function a_e(t,e,i,r,n,s){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)l_e(o,a,l,i,r,n,s);else if(o===M.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(M.POSITION);if(xt(!!c,`No buffer view for ${o}`),c){const u=c.length,p=n.getField(o,Aa);o_e(t.objectAndLayerIdColor,p,u,s)}}}}function l_e(t,e,i,r,n,s,o){switch(t){case M.POSITION:{xt(e.size===3);const a=s.getField(t,Ms);xt(!!a,`No buffer view for ${t}`),a&&LW(i,e.data,r,a,o);break}case M.NORMAL:{xt(e.size===3);const a=s.getField(t,Ms);xt(!!a,`No buffer view for ${t}`),a&&DW(i,e.data,n,a,o);break}case M.NORMALCOMPRESSED:{xt(e.size===2);const a=s.getField(t,X3);xt(!!a,`No buffer view for ${t}`),a&&jQ(i,e.data,a,o);break}case M.UV0:{xt(e.size===2);const a=s.getField(t,Iy);xt(!!a,`No buffer view for ${t}`),a&&jQ(i,e.data,a,o);break}case M.COLOR:case M.SYMBOLCOLOR:{const a=s.getField(t,Aa);xt(!!a,`No buffer view for ${t}`),xt(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||s_e(i,e.data,e.size,a,o);break}case M.COLORFEATUREATTRIBUTE:{const a=s.getField(t,n4);xt(!!a,`No buffer view for ${t}`),xt(e.size===1),a&&e.size===1&&CVe(i,e.data,a,o);break}case M.TANGENT:{xt(e.size===4);const a=s.getField(t,mp);xt(!!a,`No buffer view for ${t}`),a&&SVe(i,e.data,n,a,o);break}case M.PROFILERIGHT:case M.PROFILEUP:case M.PROFILEVERTEXANDNORMAL:case M.FEATUREVALUE:{xt(e.size===4);const a=s.getField(t,mp);xt(!!a,`No buffer view for ${t}`),a&&zT(i,e.data,a,o)}}}function QP(t,e,i=0){const r=$e(t,0,PVe);for(let n=0;n<4;n++)e[i+n]=Math.floor(256*OVe(r*EVe[n]))}function NW(t,e=0){let i=0;for(let r=0;r<4;r++)i+=t[e+r]*AVe[r];return i}const EVe=[1,256,65536,16777216],AVe=[1/256,1/65536,1/16777216,1/4294967296],PVe=NW(new Uint8ClampedArray([255,255,255,255]));function OVe(t){return t-Math.floor(t)}async function kg(t,e){const{data:i}=await ps(t,{responseType:"image",...e});return i}function RVe(){if(fk==null){const t=e=>dr(`esri/libs/basisu/${e}`);fk=Oe(()=>import("./basis_transcoder-3b07e2b7.js"),[],import.meta.url).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(i=>(i.initializeBasis(),delete i.then,i)))}return fk}let fk;var w1;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(w1||(w1={}));let sp=null,xM=null;async function c_e(){return xM==null&&(xM=RVe(),sp=await xM),xM}function MVe(t,e){if(sp==null)return t.byteLength;const i=new sp.BasisFile(new Uint8Array(t)),r=h_e(i)?u_e(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),r}function $Ve(t,e){if(sp==null)return t.byteLength;const i=new sp.KTX2File(new Uint8Array(t)),r=d_e(i)?u_e(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),r}function u_e(t,e,i,r,n){const s=EH(e?In.COMPRESSED_RGBA8_ETC2_EAC:In.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*r*s*o)}function h_e(t){return t.getNumImages()>=1&&!t.isUASTC()}function d_e(t){return t.getFaces()>=1&&t.isETC1S()}async function IVe(t,e,i){sp==null&&(sp=await c_e());const r=new sp.BasisFile(new Uint8Array(i));if(!h_e(r))return null;r.startTranscoding();const n=p_e(t,e,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(s,o)=>r.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>r.transcodeImage(a,0,s,o,0,0));return r.close(),r.delete(),n}async function LVe(t,e,i){sp==null&&(sp=await c_e());const r=new sp.KTX2File(new Uint8Array(i));if(!d_e(r))return null;r.startTranscoding();const n=p_e(t,e,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(s,o)=>r.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>r.transcodeImage(a,s,0,0,o,0,-1,-1));return r.close(),r.delete(),n}function p_e(t,e,i,r,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,p]=l?r?[w1.ETC2_RGBA,In.COMPRESSED_RGBA8_ETC2_EAC]:[w1.ETC1_RGB,In.COMPRESSED_RGB8_ETC2]:c?r?[w1.BC3_RGBA,In.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[w1.BC1_RGB,In.COMPRESSED_RGB_S3TC_DXT1_EXT]:[w1.RGBA32,Gt.RGBA],f=e.hasMipmap?i:Math.min(1,i),y=[];for(let v=0;v<f;v++)y.push(new Uint8Array(o(v,u))),a(v,u,y[v]);return e.internalFormat=p,e.hasMipmap=y.length>1,e.samplingMode=e.hasMipmap?qt.LINEAR_MIPMAP_LINEAR:qt.LINEAR,e.width=n,e.height=s,new Wt(t,e,{type:"compressed",levels:y})}const TM=ye.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),DVe=542327876,NVe=131072,FVe=4;function FW(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function kVe(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const UVe=FW("DXT1"),zVe=FW("DXT3"),BVe=FW("DXT5"),VVe=31,GVe=0,jVe=1,HVe=2,WVe=3,qVe=4,ZVe=7,XVe=20,YVe=21;function JVe(t,e,i){const r=KVe(i,e.hasMipmap??!1);if(r==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=r;return e.samplingMode=n.levels.length>1?qt.LINEAR_MIPMAP_LINEAR:qt.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new Wt(t,e,n)}function KVe(t,e){const i=new Int32Array(t,0,VVe);if(i[GVe]!==DVe)return TM.error("Invalid magic number in DDS header"),null;if(!(i[XVe]&FVe))return TM.error("Unsupported format, must contain a FourCC code"),null;const r=i[YVe];let n,s;switch(r){case UVe:n=8,s=In.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case zVe:n=16,s=In.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case BVe:n=16,s=In.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return TM.error("Unsupported FourCC code:",kVe(r)),null}let o=1,a=i[qVe],l=i[WVe];!(3&a)&&!(3&l)||(TM.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let p,f;i[HVe]&NVe&&e!==!1&&(o=Math.max(1,i[ZVe]));let y=i[jVe]+4;const v=[];for(let b=0;b<o;++b)f=(a+3>>2)*(l+3>>2)*n,p=new Uint8Array(t,y,f),v.push(p),y+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:v},internalFormat:s,width:c,height:u}}let Kb=class extends Y3{constructor(e,i){super(),this._data=e,this.type=An.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new os,this.parameters=i||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:Jt.REPEAT,t:Jt.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(PP(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const i=!e.paused;if(e.src=e.src,i&&e.autoplay){const r=()=>{e.removeEventListener("canplay",r),e.play()};e.addEventListener("canplay",r)}}}_startPreloadImageElement(e){nm(e.src)||PP(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const i=new Di;return i.wrapMode=this.parameters.wrap??Jt.REPEAT,i.flipped=!this.parameters.noUnpackFlip,i.samplingMode=this.parameters.mipmap?qt.LINEAR_MIPMAP_LINEAR:qt.LINEAR,i.hasMipmap=!!this.parameters.mipmap,i.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,i.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),i}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.gpuMemoryUsage)||QVe(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const i=this._data;return i==null?(this._glTexture=new Wt(e,this._createDescriptor(e),null),this._glTexture):typeof i=="string"?this._loadFromURL(e,i):i instanceof Image?this._loadFromImageElement(e,i):i instanceof HTMLVideoElement?this._loadFromVideoElement(e,i):i instanceof ImageData||i instanceof HTMLCanvasElement?this._loadFromImage(e,i):(nE(i)||M_(i))&&this.parameters.encoding===yg.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,i)):(nE(i)||M_(i))&&this.parameters.encoding===yg.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,i)):(nE(i)||M_(i))&&this.parameters.encoding===yg.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,i)):M_(i)?this._loadFromPixelData(e,i):nE(i)?this._loadFromPixelData(e,new Uint8Array(i)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<XA.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,i){return this._glTexture=JVe(e,this._createDescriptor(e),i),this._glTexture}_loadFromKTX2(e,i){return this._loadAsync(()=>LVe(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(e,i){return this._loadAsync(()=>IVe(e,this._createDescriptor(e),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(e,i){xt(this.parameters.width>0&&this.parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=this.parameters.components===1?Gt.LUMINANCE:this.parameters.components===3?Gt.RGB:Gt.RGBA,r.width=this.parameters.width??0,r.height=this.parameters.height??0,this._glTexture=new Wt(e,r,i),this._glTexture}_loadFromURL(e,i){return this._loadAsync(async r=>{const n=await kg(i,{signal:r});return Ti(r),this._loadFromImage(e,n)})}_loadFromImageElement(e,i){return i.complete?this._loadFromImage(e,i):this._loadAsync(async r=>{const n=await dhe(i,i.src,!1,r);return Ti(r),this._loadFromImage(e,n)})}_loadFromVideoElement(e,i){return i.readyState>=XA.HAVE_CURRENT_DATA?this._loadFromImage(e,i):this._loadFromVideoElementAsync(e,i)}_loadFromVideoElementAsync(e,i){return this._loadAsync(r=>new Promise((n,s)=>{const o=()=>{i.removeEventListener("loadeddata",a),i.removeEventListener("error",l),Qr(c)},a=()=>{i.readyState>=XA.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,i)))},l=u=>{o(),s(u||new ce("Failed to load video"))};i.addEventListener("loadeddata",a),i.addEventListener("error",l);const c=Ca(r,()=>l(Qi()))}))}_loadFromImage(e,i){const r=f_e(i);this.parameters.width=r.width,this.parameters.height=r.height;const n=this._createDescriptor(e);return n.pixelFormat=this.parameters.components===3?Gt.RGB:Gt.RGBA,n.width=r.width,n.height=r.height,this._glTexture=new Wt(e,n,i),this._glTexture}_loadAsync(e){const i=new AbortController;this._loadingController=i;const r=e(i.signal);this._loadingPromise=r;const n=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(n,n),r}unload(){if(this._glTexture=et(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function QVe(t,e){if(t==null)return 0;if(nE(t)||M_(t))return e.encoding===yg.KTX2_ENCODING?$Ve(t,!!e.mipmap):e.encoding===yg.BASIS_ENCODING?MVe(t,!!e.mipmap):t.byteLength;const{width:i,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?f_e(t):e;return(e.mipmap?4/3:1)*i*r*(e.components||4)||0}function f_e(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var XA;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(XA||(XA={}));const e3=128,kW=.5;function eGe(t,e=e3,i=e*kW,r=0){const n=m_e(t,e,i,r);return new Kb(n,{mipmap:!1,wrap:{s:Jt.CLAMP_TO_EDGE,t:Jt.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function m_e(t,e=e3,i=e*kW,r=0){switch(t){case"circle":default:return tGe(e,i);case"square":return iGe(e,i);case"cross":return nGe(e,i,r);case"x":return sGe(e,i,r);case"kite":return rGe(e,i);case"triangle":return oGe(e,i);case"arrow":return aGe(e,i)}}function tGe(t,e){const i=t/2-.5;return tO(t,y_e(i,i,e/2))}function iGe(t,e){return g_e(t,e,!1)}function rGe(t,e){return g_e(t,e,!0)}function nGe(t,e,i=0){return __e(t,e,!1,i)}function sGe(t,e,i=0){return __e(t,e,!0,i)}function oGe(t,e){return tO(t,v_e(t/2,e,e/2))}function aGe(t,e){const i=e,r=e/2,n=t/2,s=.8*i,o=y_e(n,(t-e)/2-s,Math.sqrt(s*s+r*r)),a=v_e(n,i,r);return tO(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function g_e(t,e,i){return i&&(e/=Math.SQRT2),tO(t,(r,n)=>{let s=r-.5*t+.25,o=.5*t-n-.75;if(i){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function __e(t,e,i,r=0){e-=r,i&&(e*=Math.SQRT2);const n=.5*e;return tO(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(i){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=r/2,a})}function y_e(t,e,i){return(r,n)=>{const s=r-t,o=n-e;return Math.sqrt(s*s+o*o)-i}}function v_e(t,e,i){const r=Math.sqrt(e*e+i*i);return(n,s)=>{const o=Math.abs(n-t)-i,a=s-t+e/2+.75,l=(e*o+i*a)/r,c=-a;return Math.max(l,c)}}function tO(t,e){const i=new Uint8Array(4*t*t);for(let r=0;r<t;r++)for(let n=0;n<t;n++){const s=n+t*r;let o=e(n,r);o=o/t+.5,QP(o,i,4*s)}return i}let hwt=class extends wr{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function lGe(t,e){b_e(t,e,new ei("slicePlaneOrigin",(i,r)=>S_e(e,i,r)),new ei("slicePlaneBasis1",(i,r)=>{var n;return YD(e,i,r,(n=r.slicePlane)==null?void 0:n.basis1)}),new ei("slicePlaneBasis2",(i,r)=>{var n;return YD(e,i,r,(n=r.slicePlane)==null?void 0:n.basis2)}))}function Nn(t,e){b_e(t,e,new yu("slicePlaneOrigin",(i,r)=>S_e(e,i,r)),new yu("slicePlaneBasis1",(i,r)=>{var n;return YD(e,i,r,(n=r.slicePlane)==null?void 0:n.basis1)}),new yu("slicePlaneBasis2",(i,r)=>{var n;return YD(e,i,r,(n=r.slicePlane)==null?void 0:n.basis2)}))}function b_e(t,e,...i){if(!e.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...i),t.fragment.uniforms.add(...i);const r=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?T`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(r),t.fragment.code.add(r),t.fragment.code.add(s)}function w_e(t,e,i){return t.instancedDoublePrecision?me(cGe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function x_e(t,e){return t!=null?Ce(JD,e.origin,t):e.origin}function T_e(t,e,i){return t.hasSliceTranslatedView?e!=null?Dl(uGe,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function S_e(t,e,i){if(i.slicePlane==null)return tl;const r=w_e(t,e,i),n=x_e(r,i.slicePlane),s=T_e(t,r,i);return s!=null?st(JD,n,s):n}function YD(t,e,i,r){if(r==null||i.slicePlane==null)return tl;const n=w_e(t,e,i),s=x_e(n,i.slicePlane),o=T_e(t,n,i);return o!=null?(xe(AC,r,s),st(JD,s,o),st(AC,AC,o),Ce(AC,AC,JD)):r}const cGe=I(),JD=I(),AC=I(),uGe=Ne();function iO(t,e){const i=e.output===j.ObjectAndLayerIdColor,r=e.objectAndLayerIdColorInstanced;i&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),r?t.attributes.add(M.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(M.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(T`
     void forwardObjectAndLayerIdColor() {
      ${i?r?T`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:T`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:T``} }`),t.fragment.code.add(T`
      void outputObjectAndLayerIdColor() {
        ${i?T`fragColor = objectAndLayerIdColorVarying;`:T``} }`)}function hGe(t,e){const{vertex:i,fragment:r}=t;i.include(S4),e.hasMultipassGeometry&&i.include(Tme),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?T`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&r.include(Eu),e.hasMultipassTerrain&&r.uniforms.add(new vt("terrainDepthTexture",(n,s)=>s.multipassTerrain.linearDepthTexture),new Bi("nearFar",(n,s)=>s.camera.nearFar)),r.include(Ac),r.code.add(T`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?T`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const dGe=Kt(1,1,0,1),C_e=Kt(1,0,1,1);function Kg(t){t.fragment.uniforms.add(new vt("depthTexture",(e,i)=>i.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",dGe).add("unoccludedHighlightFlag","vec4",C_e),t.fragment.code.add(T`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let E_e=class extends On{constructor(e,i,r){super(e,"vec4",vr.Pass,(n,s,o)=>n.setUniform4fv(e,i(s,o)),r)}},Ol=class extends On{constructor(e,i,r){super(e,"float",vr.Pass,(n,s,o)=>n.setUniform1fv(e,i(s,o)),r)}};const BT={unknown:1,inches:Wo(1,"meters","inches"),feet:Wo(1,"meters","feet"),"us-feet":Wo(1,"meters","us-feet"),yards:Wo(1,"meters","yards"),miles:Wo(1,"meters","miles"),"nautical-miles":Wo(1,"meters","nautical-miles"),millimeters:Wo(1,"meters","millimeters"),centimeters:Wo(1,"meters","centimeters"),decimeters:Wo(1,"meters","decimeters"),meters:Wo(1,"meters","meters"),kilometers:Wo(1,"meters","kilometers"),"decimal-degrees":1/oAe(1,"meters",vi.radius)};var va,WQ;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(va||(va={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(WQ||(WQ={}));let UW=class{constructor(e){this.field=e}},pGe=class extends UW{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[va.Undefined,va.Undefined,va.Undefined]}},fGe=class extends UW{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},mGe=class extends UW{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},gGe=class{};function PC(t){return t!=null}function Gw(t){return typeof t=="number"}function C4(t){return typeof t=="string"}function _Ge(t){return t==null||C4(t)}function Cs(t,e){t&&t.push(e)}function yGe(t,e,i,r=Ne()){const n=t||0,s=e||0,o=i||0;return n!==0&&wT(r,r,-n/180*Math.PI),s!==0&&bT(r,r,s/180*Math.PI),o!==0&&$5(r,r,o/180*Math.PI),r}function x0(t,e,i,r,n){const s=t.minSize,o=t.maxSize;if(t.expression)return Cs(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=r.symbolSize[i];return e.minSize[i]=a,e.maxSize[i]=a,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=va.DefinedSize,!0}if(PC(t.field))return PC(t.stops)?t.stops.length===2&&Gw(t.stops[0].size)&&Gw(t.stops[1].size)?(qQ(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=va.DefinedSize,!0):(Cs(n,"Could not convert size info: stops only supported with 2 elements"),!1):Gw(s)&&Gw(o)&&PC(t.minDataValue)&&PC(t.maxDataValue)?(qQ(s,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=va.DefinedSize,!0):t.valueUnit==="unknown"?(Cs(n,"Could not convert size info: proportional size not supported"),!1):BT[t.valueUnit]!=null?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/BT[t.valueUnit],e.type[i]=va.DefinedSize,!0):(Cs(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!PC(t.field)){if(t.stops&&t.stops[0]&&Gw(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=va.DefinedSize,!0;if(Gw(s))return e.minSize[i]=s,e.maxSize[i]=s,e.offset[i]=s,e.factor[i]=0,e.type[i]=va.DefinedSize,!0}return Cs(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function qQ(t,e,i,r,n,s){const o=Math.abs(r-i)>0?(e-t)/(r-i):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-i*o,n.factor[s]=o}function vGe(t,e,i,r){if(t.normalizationField||t.valueRepresentation)return Cs(r,"Could not convert size info: unsupported property"),null;if(!_Ge(t.field))return Cs(r,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return Cs(r,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new pGe(t.field);let n;switch(t.axis){case"width":return n=x0(t,e.size,0,i,r),n?e:null;case"height":return n=x0(t,e.size,2,i,r),n?e:null;case"depth":return n=x0(t,e.size,1,i,r),n?e:null;case"width-and-depth":return n=x0(t,e.size,0,i,r),n&&x0(t,e.size,1,i,r),n?e:null;case null:case void 0:case"all":return n=x0(t,e.size,0,i,r),n=n&&x0(t,e.size,1,i,r),n=n&&x0(t,e.size,2,i,r),n?e:null;default:return Cs(r,`Could not convert size info: unknown axis "${t.axis}""`),null}}function bGe(t,e,i){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===va.DefinedSize&&(s*=e.modelSize[n],t.type[n]=va.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let r;if(t.type[0]!==va.Undefined)r=0;else if(t.type[1]!==va.Undefined)r=1;else{if(t.type[2]===va.Undefined)return Cs(i,"No size axis contains a valid size or scale"),!1;r=2}for(let n=0;n<3;++n)t.type[n]===va.Undefined&&(t.minSize[n]=t.minSize[r],t.maxSize[n]=t.maxSize[r],t.offset[n]=t.offset[r],t.factor[n]=t.factor[r],t.type[n]=t.type[r]);return!0}function ZQ(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function wGe(t,e,i){if(t.normalizationField)return Cs(i,"Could not convert color info: unsupported property"),null;if(C4(t.field)){if(!t.stops)return Cs(i,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return Cs(i,"Could not convert color info: too many color stops"),null;e.color=new fGe(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.color.values[n]=s.value,ZQ(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return Cs(i,"Could not convert color info: no field and no colors/stops"),null;{const r=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,ZQ(e.color.colors,n,r)}}return e}function xGe(t,e,i){if(t.normalizationField)return Cs(i,"Could not convert opacity info: unsupported property"),null;if(C4(t.field)){if(!t.stops)return Cs(i,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return Cs(i,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new mGe(t.field);const r=t.stops;for(let n=0;n<8;++n){const s=r[Math.min(n,r.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return Cs(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=r}}return e}function mk(t,e,i){const r=i===2&&t.rotationType==="arithmetic";e.offset[i]=r?90:0,e.factor[i]=r?-1:1,e.type[i]=1}function TGe(t,e,i){if(!C4(t.field))return Cs(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return Cs(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return mk(t,e.rotation,0),e;case"roll":return mk(t,e.rotation,1),e;case null:case void 0:case"heading":return mk(t,e.rotation,2),e;default:return Cs(i,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let rO=class{constructor(e,i=[1,1,1],r=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=i,this.symbolSize=r,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function A_e(t,e,i){if(!t)return null;const r=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return Cs(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?vGe(s,n,e,i):n;case"color":return e.supports.color?wGe(s,n,i):n;case"opacity":return e.supports.opacity?xGe(s,n,i):null;case"rotation":return e.supports.rotation?TGe(s,n,i):n;default:return null}},new gGe);return!(t.length>0&&r)||r.size||r.color||r.opacity||r.rotation?r&&r.size&&!bGe(r.size,e,i)?null:r:null}let SGe=class{constructor(e,i,r){this.visualVariables=e,this.materialParameters=i,this.requiresShaderTransformation=r}};function VT(t,e){if(!t||Or.TESTS_DISABLE_FAST_UPDATES)return null;const i=A_e(t.visualVariables,e);return i?new SGe(i,O_e(i,e),!!i.size):null}function GT(t,e,i){if(!e||!t)return!1;const r=t.visualVariables,n=A_e(e.visualVariables,i);return!!n&&!!(SM(r.size,n.size,"size")&&SM(r.color,n.color,"color")&&SM(r.rotation,n.rotation,"rotation")&&SM(r.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=O_e(n,i),t.requiresShaderTransformation=!!n.size,!0)}function SM(t,e,i){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&i==="rotation"){const r=t,n=e;for(let s=0;s<3;s++)if(r.type[s]!==n.type[s]||r.offset[s]!==n.offset[s]||r.factor[s]!==n.factor[s])return!1}return!0}let P_e=class extends wr{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function O_e(t,e){const i=new P_e(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,Vh(YA),yGe(e.rotation[2],e.rotation[0],e.rotation[1],YA),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||on(),jh(i.vvSymbolRotationMatrix,YA)),i}function $7(t,e,i){if(!t.vvSize)return i;Qn(T0,i);const r=t.vvSymbolRotationMatrix;sm(YA,r[0],r[1],r[2],0,r[3],r[4],r[5],0,r[6],r[7],r[8],0,0,0,0,1),Cr(T0,T0,YA);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];XQ[n]=$e(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return M5(T0,T0,XQ),Dl(T0,T0,t.vvSymbolAnchor),T0}function CGe(t,e,i){if(e.vvSize)for(let r=0;r<3;++r){const n=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=$e(n,e.vvSize.minSize[r],e.vvSize.maxSize[r])}else me(t,1,1,1)}function op(t,e){const i=t==null?0:e.attributes[t];return typeof i=="number"&&isFinite(i)?i:0}const T0=Ne(),XQ=I(),YA=Ne();let nO=class extends P_e{constructor(){super(...arguments),this.renderOccluded=Kr.Occlude}};const J2=8;function bg(t,e){const{vertex:i,attributes:r}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&r.add(M.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(i.uniforms.add(new ei("vvSizeMinSize",n=>n.vvSize.minSize)),i.uniforms.add(new ei("vvSizeMaxSize",n=>n.vvSize.maxSize)),i.uniforms.add(new ei("vvSizeOffset",n=>n.vvSize.offset)),i.uniforms.add(new ei("vvSizeFactor",n=>n.vvSize.factor)),i.uniforms.add(new Jh("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),i.uniforms.add(new ei("vvSymbolAnchor",n=>n.vvSymbolAnchor)),i.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(i.constants.add("vvColorNumber","int",J2),i.uniforms.add(new Ol("vvColorValues",n=>n.vvColor.values,J2),new E_e("vvColorColors",n=>n.vvColor.colors,J2)),i.code.add(T`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?T`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):i.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const KD=.1,Mo=.001;function EGe(t){const e=new Fi,i=t.signedDistanceFieldEnabled;if(e.include(Z0e,t),e.include(Nn,t),t.occlusionPass)return e.include(hGe,t),e;const{vertex:r,fragment:n}=e;e.include(PW),n.include(Ac),n.include(am),e.include(bg,t),e.include(iO,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),r.uniforms.add(new yi("viewport",(c,u)=>u.camera.fullViewport),new Bi("screenOffset",(c,u)=>bi(R_e,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new Bi("anchorPosition",c=>QD(c)),new yi("materialColor",c=>c.color)),ES(r,t),i&&(r.uniforms.add(new yi("outlineColor",c=>c.outlineColor)),n.uniforms.add(new yi("outlineColor",c=>YQ(c)?c.outlineColor:Df),new je("outlineSize",c=>YQ(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(fVe(r),T4(r)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.COLOR,"vec4"),e.attributes.add(M.SIZE,"vec2"),e.attributes.add(M.AUXPOS2,"vec4"),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?T`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const s=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&r.include(S4);const o=t.pixelSnappingEnabled?i?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;r.code.add(T`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===j.ObjectAndLayerIdColor?T`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${T.float(Mo)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(Mo)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new vt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(KD)})`:T.float(KD),l=T`
    ${t.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?T`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${T.float(e3)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(Mo)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?T`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===j.Alpha&&n.code.add(T`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===j.ObjectAndLayerIdColor&&n.code.add(T`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===j.Color&&n.code.add(T`
    void main() {
      ${l}
      ${t.transparencyPassType===At.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===j.Highlight&&(e.include(Kg,t),n.code.add(T`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?T`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function YQ(t){return t.outlineColor[3]>0&&t.outlineSize>0}function QD(t,e=R_e){return t.textureIsSignedDistanceField?AGe(t.anchorPosition,t.distanceFieldBoundingBox,e):Is(e,t.anchorPosition),e}function AGe(t,e,i){e!=null?bi(i,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):bi(i,0,0)}const R_e=it(),PGe=Object.freeze(Object.defineProperty({__proto__:null,build:EGe,calculateAnchorPosForRendering:QD},Symbol.toStringTag,{value:"Module"})),vu=Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),OGe=Ec(De.ONE,De.ONE),M_e=Ec(De.ZERO,De.ONE_MINUS_SRC_ALPHA);function Qg(t){return t===At.FrontFace?null:t===At.Alpha?M_e:OGe}function E4(t){return t===At.FrontFace?Nl:null}const A4=5e5,P4={factor:-1,units:-2};function O4(t){return t?P4:null}function Dy(t,e=br.LESS){return t===At.NONE||t===At.FrontFace?e:br.LEQUAL}let $_e=class I_e extends qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ke.Global}initializeProgram(e){return new Gi(e.rctx,I_e.shader.get().build(this.configuration),Ni)}_setPipelineState(e){const i=this.configuration,r=e===At.NONE,n=e===At.FrontFace,s=this.configuration.hasPolygonOffset?RGe:null,o=(r||n)&&i.output!==j.Highlight&&(i.depthEnabled||i.occlusionPass)?Nl:null;return Zt({blending:i.output===j.Color||i.output===j.Alpha||i.output===j.Highlight?r?MGe:Qg(e):null,depthTest:{func:br.LEQUAL},depthWrite:o,colorWrite:ni,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Ht.POINTS:Ht.TRIANGLES}};$_e.shader=new Vi(PGe,()=>Oe(()=>import("./HUDMaterial.glsl-8f4fc43a.js"),[],import.meta.url));const RGe={factor:0,units:-4},MGe=Ec(De.ONE,De.ONE_MINUS_SRC_ALPHA);let Gn=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.screenCenterOffsetUnitsEnabled=Pl.World,this.transparencyPassType=At.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([q({count:j.COUNT})],Gn.prototype,"output",void 0),d([q({count:Pl.COUNT})],Gn.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([q({count:At.COUNT})],Gn.prototype,"transparencyPassType",void 0),d([q()],Gn.prototype,"spherical",void 0),d([q()],Gn.prototype,"occlusionTestEnabled",void 0),d([q()],Gn.prototype,"signedDistanceFieldEnabled",void 0),d([q()],Gn.prototype,"vvSize",void 0),d([q()],Gn.prototype,"vvColor",void 0),d([q()],Gn.prototype,"hasVerticalOffset",void 0),d([q()],Gn.prototype,"hasScreenSizePerspective",void 0),d([q()],Gn.prototype,"debugDrawLabelBorder",void 0),d([q()],Gn.prototype,"binaryHighlightOcclusionEnabled",void 0),d([q()],Gn.prototype,"hasSlicePlane",void 0),d([q()],Gn.prototype,"hasPolygonOffset",void 0),d([q()],Gn.prototype,"depthEnabled",void 0),d([q()],Gn.prototype,"pixelSnappingEnabled",void 0),d([q()],Gn.prototype,"draped",void 0),d([q()],Gn.prototype,"hasMultipassGeometry",void 0),d([q()],Gn.prototype,"hasMultipassTerrain",void 0),d([q()],Gn.prototype,"cullAboveGround",void 0),d([q()],Gn.prototype,"occlusionPass",void 0),d([q()],Gn.prototype,"objectAndLayerIdColorInstanced",void 0),d([q({constValue:!0})],Gn.prototype,"hasSliceInVertexProgram",void 0),d([q({constValue:!1})],Gn.prototype,"hasVvInstancing",void 0);let jT=class extends Ly{constructor(e){super(e,new BGe),this._configuration=new Gn}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Pl.Screen:Pl.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=i.slot===Te.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===j.Color||e===j.Alpha),e===j.Color&&(this._configuration.debugDrawLabelBorder=!!Or.LABELS_SHOW_BORDER),e===j.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!r.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(jh(_k,i),e.shaderTransformer!=null){const P=e.shaderTransformer(QQ);l=P[0],c=P[5],LGe(_k)}const u=e.vertexAttributes.get(M.POSITION),p=e.vertexAttributes.get(M.SIZE),f=e.vertexAttributes.get(M.NORMAL),y=e.vertexAttributes.get(M.AUXPOS1);xt(u.size>=3);const v=r.point,b=r.camera,x=QD(a);l*=b.pixelRatio,c*=b.pixelRatio;const S=this.parameters.centerOffsetUnits==="screen";for(let P=0;P<u.data.length/u.size;P++){const C=P*u.size;me(ca,u.data[C],u.data[C+1],u.data[C+2]),st(ca,ca,i);const R=P*p.size;S0[0]=p.data[R]*l,S0[1]=p.data[R+1]*c,st(ca,ca,b.viewMatrix);const N=P*y.size;if(me(Bc,y.data[N],y.data[N+1],y.data[N+2]),!S&&(ca[0]+=Bc[0],ca[1]+=Bc[1],Bc[2]!==0)){const k=Bc[2];Me(Bc,ca),Ce(ca,ca,pe(Bc,Bc,k))}const $=P*f.size;if(me(OC,f.data[$],f.data[$+1],f.data[$+2]),this._normalAndViewAngle(OC,_k,b,yk),this._applyVerticalOffsetTransformationView(ca,yk,b,gk),b.applyProjection(ca,La),La[0]>-1){La[0]=Math.floor(La[0]),La[1]=Math.floor(La[1]),S&&(Bc[0]||Bc[1])&&(La[0]+=Bc[0],Bc[1]!==0&&(La[1]+=AW(Bc[1],gk.factorAlignment)),b.unapplyProjection(La,ca)),La[0]+=this.parameters.screenOffset[0],La[1]+=this.parameters.screenOffset[1],U0e(S0,gk.factor,S0);const k=kGe*b.pixelRatio;let B=0;if(a.textureIsSignedDistanceField&&(B=a.outlineSize*b.pixelRatio/2),v&&JQ(v,La[0],La[1],S0,k,B,a,x)){const W=r.ray;if(st(KQ,ca,fo(FGe,b.viewMatrix)),La[0]=v[0],La[1]=v[1],b.unprojectFromRenderScreen(La,ca)){const Z=I();fe(Z,W.direction);const K=1/ze(Z);pe(Z,Z,K),o(Nr(W.origin,ca)*K,Z,-1,!0,1,KQ)}}}}}intersectDraped(e,i,r,n,s,o){const a=e.vertexAttributes.get(M.POSITION),l=e.vertexAttributes.get(M.SIZE),c=this.parameters,u=QD(c);let p=1,f=1;if(e.shaderTransformer!=null){const v=e.shaderTransformer(QQ);p=v[0],f=v[5]}p*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const y=UGe*e.screenToWorldRatio;for(let v=0;v<a.data.length/a.size;v++){const b=v*a.size,x=a.data[b],S=a.data[b+1],P=v*l.size;S0[0]=l.data[P]*p,S0[1]=l.data[P+1]*f;let C=0;c.textureIsSignedDistanceField&&(C=c.outlineSize*e.screenToWorldRatio/2),JQ(n,x,S,S0,y,C,c,u)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new GGe(this)}_normalAndViewAngle(e,i,r,n){return pVe(i)&&(i=jh(NGe,i)),yc(n.normal,e,i),st(n.normal,n.normal,r.viewInverseTransposeMatrix),n.cosAngle=Re(L_e,zGe),n}_updateScaleInfo(e,i,r){const n=this.parameters;n.screenSizePerspective!=null?FQ(r,i,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment!=null?FQ(r,i,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,i,r,n,s,o,a){const l=this._normalAndViewAngle(i,r,s,yk);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,i,r,n,s){return this._applyCenterOffsetNDC(e,i,r,n),s!=null&&fe(s,n),this._applyPolygonOffsetNDC(n,i,r,n),n}_applyPolygonOffsetView(e,i,r,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return fe(s,e);const c=$e(Math.abs(i.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return pe(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,i,r,n){const s=ze(e),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(s),l=pe(ca,i.normal,o*a);return xe(n,e,l),n}_applyVerticalOffsetTransformationView(e,i,r,n){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=ze(e);this._updateScaleInfo(n,c,i.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=ze(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=Q0e(r,o,s.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(n,o,i.cosAngle),pe(i.normal,i.normal,l),xe(e,e,i.normal)}_applyCenterOffsetView(e,i,r){const n=this.parameters.centerOffsetUnits!=="screen";return r!==e&&fe(r,e),n&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(Me(OC,r),xe(r,r,pe(OC,OC,i[2])))),r}_applyCenterOffsetNDC(e,i,r,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&fe(n,e),s||(n[0]+=i[0]/r.fullWidth*2,n[1]+=i[1]/r.fullHeight*2),n}_applyPolygonOffsetNDC(e,i,r,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&fe(n,e),s){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);n[2]-=(a||o)*s}return n}requiresSlot(e,i){if(i===j.Color||i===j.Alpha||i===j.Highlight||i===j.ObjectAndLayerIdColor){if(e===Te.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:r,occlusionTest:n}=this.parameters;return e===(r?Te.LABEL_MATERIAL:Te.HUD_MATERIAL)||n&&e===Te.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new $Ge(e)}calculateRelativeScreenBounds(e,i,r=li()){return IGe(this.parameters,e,i,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}},$Ge=class extends PH{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique($_e,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function IGe(t,e,i,r=DGe){return Is(r,t.anchorPosition),r[0]*=-e[0],r[1]*=-e[1],r[0]+=t.screenOffset[0]*i,r[1]+=t.screenOffset[1]*i,r}function LGe(t){const e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+i*i+r*r),p=1/Math.sqrt(n*n+s*s+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=i*u,t[2]=r*u,t[3]=n*p,t[4]=s*p,t[5]=o*p,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function JQ(t,e,i,r,n,s,o,a){let l=e-n-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*n,u=i-n-(a[1]>0?r[1]*a[1]:0),p=u+r[1]+2*n;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=r[0]*f[0],u+=r[1]*f[1],c-=r[0]*(1-f[2]),p-=r[1]*(1-f[3]),l-=s,c+=s,u-=s,p+=s),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<p}const gk=new r_e,DGe=it(),ca=I(),OC=I(),La=gi(),L_e=I(),KQ=I(),_k=on(),NGe=on(),FGe=Ne(),Bc=I(),yk={normal:L_e,cosAngle:0},QQ=Ne(),kGe=1,UGe=2,S0=[0,0],zGe=Ge(0,0,1);let BGe=class extends ome{constructor(){super(...arguments),this.renderOccluded=Kr.Occlude,this.color=Kt(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Ri(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=Kt(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const D_e=ln().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4u8(M.COLOR).vec2f(M.SIZE).vec4f(M.AUXPOS1).vec4f(M.AUXPOS2),VGe=D_e.clone().vec4u8(M.OBJECTANDLAYERIDCOLOR);let GGe=class{constructor(e){this._material=e,this.vertexBufferLayout=ge("enable-feature:objectAndLayerId-rendering")?VGe:D_e}elementCount(e){return 6*e.indices.get(M.POSITION).length}write(e,i,r,n,s){LW(r.indices.get(M.POSITION),r.vertexAttributes.get(M.POSITION).data,e,n.position,s,6),DW(r.indices.get(M.NORMAL),r.vertexAttributes.get(M.NORMAL).data,i,n.normal,s,6);const o=r.vertexAttributes.get(M.UV0).data;let a,l,c,u;if(o==null||o.length<4){const S=this._material.parameters;a=0,l=0,c=S.texCoordScale[0],u=S.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let p=r.indices.get(M.POSITION).length,f=s;const y=n.uv0;for(let S=0;S<p;++S)y.set(f,0,a),y.set(f,1,l),f+=1,y.set(f,0,c),y.set(f,1,l),f+=1,y.set(f,0,c),y.set(f,1,u),f+=1,y.set(f,0,c),y.set(f,1,u),f+=1,y.set(f,0,a),y.set(f,1,u),f+=1,y.set(f,0,a),y.set(f,1,l),f+=1;s_e(r.indices.get(M.COLOR),r.vertexAttributes.get(M.COLOR).data,4,n.color,s,6);const v=r.indices.get(M.SIZE),b=r.vertexAttributes.get(M.SIZE).data;p=v.length;const x=n.size;f=s;for(let S=0;S<p;++S){const P=b[2*v[S]],C=b[2*v[S]+1];for(let R=0;R<6;++R)x.set(f,0,P),x.set(f,1,C),f+=1}if(r.indices.get(M.AUXPOS1)&&r.vertexAttributes.get(M.AUXPOS1)?zT(r.indices.get(M.AUXPOS1),r.vertexAttributes.get(M.AUXPOS1).data,n.auxpos1,s,6):HQ(n.auxpos1,s,6*p),r.indices.get(M.AUXPOS2)&&r.vertexAttributes.get(M.AUXPOS2)?zT(r.indices.get(M.AUXPOS2),r.vertexAttributes.get(M.AUXPOS2).data,n.auxpos2,s,6):HQ(n.auxpos2,s,6*p),r.objectAndLayerIdColor!=null&&r.indices.get(M.POSITION)){const S=r.indices.get(M.POSITION).length,P=n.getField(M.OBJECTANDLAYERIDCOLOR,Aa);o_e(r.objectAndLayerIdColor,P,S,s,6)}}};const Ip=I(),jw=gi(),RC=gi(),vk=I(),jGe=Ne(),HGe=kn(),bk=ho(),WGe=I(),qGe=li();class ZGe{constructor(){this.aabr=li(),this.distance=0,this.culled=!1,this.visible=!1}}class XGe{constructor(e,i){this.graphics3DGraphic=e,this.slicePlaneEnabled=i,this.info={}}}var sc;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(sc||(sc={}));class N_e{constructor(){this.camera=new It,this.slicePlane=Gg(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),qb(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let A2=class extends ke{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new N_e,this._state=sc.Idle,this._active=new Map,this._visible=new Map,this._iterators=new QGe,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==sc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/sc.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case sc.Idle:this._startUpdate(),t.madeProgress();case sc.Process:if(this._state=sc.Process,!this._processActiveGraphics(t))return;case sc.Sort:if(this._state=sc.Sort,!this._sortVisibleGraphics(t))return;case sc.Deconflict:if(this._state=sc.Deconflict,!this._deconflictVisibleGraphics(t))return;default:iVe(this,this._visible),this._state=sc.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(i=>this.addToActiveGraphics(i)):t.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const i=e==null?void 0:e.geometries[0];return(i==null?void 0:i.material)instanceof jT}_startUpdate(){rVe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new ZGe,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),YGe(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),i=dS(jGe,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?HGe:null;let n=0;for(r!=null&&(st(r,tl,this._runningViewState.camera.viewMatrix),r[3]=lr(this.view.spatialReference).radius,n=ipe(r,tl));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const i=e.next();if(t.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===co.LABEL;for(;!t.done;){t.madeProgress();const r=e.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=r.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const o=n.graphics3DGraphic,a=!i||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),sVe(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=eee(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=eee(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=JGe(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,i,r){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(co.GRAPHIC,Qo.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);kh(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=ije,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Ip)||i!=null&&this._isCulledByHorizon(a,i,r)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,i){const r=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;st(Ip,a,r.viewMatrix);const l=s.vertexAttributes,c=l.get(M.NORMAL).data,u=l.get(M.AUXPOS1).data;o.applyShaderOffsetsView(Ip,c,n.transformation,u,r,i.scaleInfo,Ip),Br(jw,Ip[0],Ip[1],Ip[2],1),hu(RC,jw,r.projectionMatrix),pe(i.positionNDC,RC,1/RC[3]),o.applyShaderOffsetsNDC(i.positionNDC,u,r,i.positionNDC,vk),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(vk[2]),i.distance=vk[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),Br(RC,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),hu(jw,RC,e),ib(jw,jw,1/jw[3]),me(i.positionView,Ip[0],Ip[1],Ip[2])}_isCulledByHorizon(t,e,i){return fe(bk.direction,t.positionView),me(bk.origin,0,0,0),!!My(e,bk,WGe)&&t.distanceWithoutPolygonOffset>i}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&tH(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,i,{positionNDC:r,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(eje);U0e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=kL(i.calculateRelativeScreenBounds(o,n.factorAlignment.scale,qGe),Bt(0,s.fullWidth,.5+.5*r[0]),Bt(0,s.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(lu(a),up(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}X_(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,i=t.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this._accBinsSizeX);r<=Math.floor(i.aabr[2]/this._accBinsSizeX);r++)if(!(r<0||r>=this._accBinsNumX))for(let n=Math.floor(i.aabr[1]/this._accBinsSizeY);n<=Math.floor(i.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;const s=this._accBins[r][n];for(let o=0;o<s.length;o++){const a=s.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,c5(l.aabr,i.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let i=0;i<this._accBinsNumX;i++){this._accBins.push([]);const r=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)r.push(new ri)}}else for(let i=0;i<this._accBinsNumX;i++)for(let r=0;r<this._accBinsNumY;r++)this._accBins[i][r].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],i=Math.floor(e.aabr[0]/this._accBinsSizeX),r=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const i=t.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(this.visibilityGroup,Qo.DECONFLICTION,e),this.visibilityGroup===co.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,e))}};function YGe(t,e){const i=t.graphics3DGraphic;i.destroyed||i.setVisibilityFlag(e,Qo.DECONFLICTION,!0)}function*eee(t){if(Map.prototype.entries){const e=t.entries();for(let i=e.next();!i.done;i=e.next())yield i.value[1]}else yield*t.values()}function*JGe(t,e,i){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(i,Qo.DECONFLICTION);const a=n.info&&n.info[i];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const r=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=r.next();!n.done;n=r.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}d([m({constructOnly:!0})],A2.prototype,"view",void 0),d([m({type:Boolean,readOnly:!0})],A2.prototype,"updating",null),A2=d([J("esri.views.3d.layers.graphics.Deconflictor")],A2);class KGe{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class QGe{constructor(e=null,i=null,r=null){this.active=e,this.visible=i,this.sort=r,this.sortArray=new ri({allocator:n=>n||new KGe})}}const eje=it();class tje{constructor(){this.positionView=I(),this.positionNDC=I(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new r_e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const ije=new tje,rje=2e3;let jI=class extends A2{constructor(e){super(e),this.visibilityGroup=co.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return na.YIELD;const i=performance.now();if(e.state!==Ji.IDLE&&i-this._lastDeconfliction<rje)return na.YIELD;super.runTask(e),this.state===sc.Idle&&(this._lastDeconfliction=i)}enabledChanged(e,i){this.modifyGraphics(i,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([m({constructOnly:!0})],jI.prototype,"parent",void 0),jI=d([J("esri.views.3d.layers.graphics.LabelDeconflictor")],jI);let I7=class extends A2{constructor(){super(...arguments),this._handles=new an,this._contexts=new Map,this._viewState=new N_e,this.visibilityGroup=co.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([Pe(()=>{var e,i;return(i=(e=this.view)==null?void 0:e.state)==null?void 0:i.camera},()=>{this._updateViewState(),this.setDirty()}),Pe(()=>{var e,i,r;return(r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity},(e,i)=>{e!==1&&i!==1||this.setDirty()}),Pe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},ar)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Dt.GRAPHICS_DECONFLICTOR,this),this._labels=new jI({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,i){const r=!(this._graphicSupportsDeconfliction(i)&&wk(e));i.setVisibilityFlag(co.GRAPHIC,Qo.DECONFLICTION,r)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&_pe(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Yo(this._contexts,(e,i)=>i.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const i=this._getGraphicsContext(e);return{addGraphic:r=>this._addGraphic(e,i,r),removeGraphic:r=>this._removeGraphic(i,r),labelingInfoChange:()=>this._labels.enabledChanged(e,i),featureReductionChange:()=>this.enabledChanged(e,i),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,i),clear:()=>i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic))}}removeGraphicsOwner(e){const i=this._contexts.get(e);i&&(i.forEach(r=>this._removeGraphic(i,r.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,i,r){const n=r.graphic.uid,s=new XGe(r,e.symbolCreationContext.slicePlaneEnabled);i.set(n,s),wk(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,i){const r=i.graphic.uid,n=e.get(r);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(r),this.setDirty())}enabledChanged(e,i){const r=wk(e);r||nje(e),this.modifyGraphics(i,r)}_slicePlaneEnabledChanged(e,i){const r=e.symbolCreationContext.slicePlaneEnabled;i.forEach(n=>n.slicePlaneEnabled=r),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const i=e.layers;if(!i||!i.length)return!1;for(const r of i)if(this.layerSupportsDeconfliction(r))return!0;return!1}_getGraphicsContext(e){const i=this._contexts.get(e);if(i)return i;const r=new Map;return this._contexts.set(e,r),this.setDirty(),r}};function wk(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function nje(t){const e=t.graphics3DGraphics;e&&e.forEach(i=>i.setVisibilityFlag(co.GRAPHIC,Qo.DECONFLICTION,!0))}I7=d([J("esri.views.3d.layers.graphics.GraphicsDeconflictor")],I7);function F_e(t){return 32+t.length}function k_e(t){return 16}function U_e(t){if(!t)return 0;let e=V_e;for(const i in t)if(t.hasOwnProperty(i)){const r=t[i];switch(typeof r){case"string":e+=F_e(r);break;case"number":e+=k_e();break;case"boolean":e+=4}}return e}function z_e(t){if(!t)return 0;if(Array.isArray(t))return sje(t);let e=V_e;for(const i in t)t.hasOwnProperty(i)&&(e+=B_e(t[i]));return e}function sje(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let i=G_e;for(let r=0;r<e;r++)i+=B_e(t[r]);return i}function B_e(t){switch(typeof t){case"object":return z_e(t);case"string":return F_e(t);case"number":return k_e();case"boolean":return 4;default:return 8}}function Mwt(t,e){return G_e+t.length*e}const V_e=32,G_e=32,zW=(t,e,i)=>[e,i],HT=(t,e,i)=>[e,i,t[2]],BW=(t,e,i)=>[e,i,t[2],t[3]];function $wt(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function oje({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function aje({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function j_e({scale:t,translate:e},i){return i*t[0]+e[0]}function H_e({scale:t,translate:e},i){return e[1]-i*t[1]}function W_e(t,e,i){const r=new Array(i.length);if(!i.length)return r;const[n,s]=t.scale;let o=j_e(t,i[0][0]),a=H_e(t,i[0][1]);r[0]=e(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*n,a-=c[1]*s,r[l]=e(c,o,a)}return r}function q_e(t,e,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=W_e(t,e,i[n]);return r}function lje(t,e,i,r){return W_e(t,i?r?BW:HT:r?HT:zW,e)}function cje(t,e,i,r){return q_e(t,i?r?BW:HT:r?HT:zW,e)}function uje(t,e,i,r){return q_e(t,i?r?BW:HT:r?HT:zW,e)}function Iwt(t,e,i,r,n){return e.x=oje(t,i.x),e.y=aje(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m)),e}function Z_e(t,e,i,r,n){return i!=null&&(e.points=lje(t,i.points,r,n)),e}function X_e(t,e,i,r,n){return i==null||(e.x=j_e(t,i.x),e.y=H_e(t,i.y),e!==i&&(r&&(e.z=i.z),n&&(e.m=i.m))),e}function Y_e(t,e,i,r,n){return i!=null&&(e.rings=uje(t,i.rings,r,n)),e}function J_e(t,e,i,r,n){return i!=null&&(e.paths=cje(t,i.paths,r,n)),e}var L7;let KE=L7=class extends Nt{constructor(t){super(t),this.name=null,this.code=null}clone(){return new L7({name:this.name,code:this.code})}};d([m({type:String,json:{write:!0}})],KE.prototype,"name",void 0),d([m({type:[String,Number],json:{write:!0}})],KE.prototype,"code",void 0),KE=L7=d([J("esri.layers.support.CodedValue")],KE);const hje=new Tu({inherited:"inherited",codedValue:"coded-value",range:"range"});let QE=class extends Nt{constructor(e){super(e),this.name=null,this.type=null}};d([m({type:String,json:{write:!0}})],QE.prototype,"name",void 0),d([Si(hje)],QE.prototype,"type",void 0),QE=d([J("esri.layers.support.Domain")],QE);const R4=QE;var D7;let eA=D7=class extends R4{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const i=String(t);this.codedValues.some(r=>(String(r.code)===i&&(e=r.name),!!e))}return e}clone(){return new D7({codedValues:Le(this.codedValues),name:this.name})}};d([m({type:[KE],json:{write:!0}})],eA.prototype,"codedValues",void 0),d([Si({codedValue:"coded-value"})],eA.prototype,"type",void 0),eA=D7=d([J("esri.layers.support.CodedValueDomain")],eA);const K_e=eA;var N7;let HI=N7=class extends R4{constructor(t){super(t),this.type="inherited"}clone(){return new N7}};d([Si({inherited:"inherited"})],HI.prototype,"type",void 0),HI=N7=d([J("esri.layers.support.InheritedDomain")],HI);const Q_e=HI;var F7;let Kx=F7=class extends R4{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new F7({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([m({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,i){e[i]=[this.minValue||0,t]}}}})],Kx.prototype,"maxValue",void 0),d([m({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,i){e[i]=[t,this.maxValue||0]}}}})],Kx.prototype,"minValue",void 0),d([Si({range:"range"})],Kx.prototype,"type",void 0),Kx=F7=d([J("esri.layers.support.RangeDomain")],Kx);const eye=Kx,dje={key:"type",base:R4,typeMap:{range:eye,"coded-value":K_e,inherited:Q_e}};function pje(t){if(!t||!t.type)return null;switch(t.type){case"range":return eye.fromJSON(t);case"codedValue":return K_e.fromJSON(t);case"inherited":return Q_e.fromJSON(t)}return null}const fje=new Tu({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var k7;const mje=new Tu({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let ka=k7=class extends Nt{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return(i==null?void 0:i.value)??null}readValueType(t,{description:e}){let i=null;try{i=e?JSON.parse(e):null}catch{}return i?mje.fromJSON(i.fieldValueType):null}clone(){return new k7({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};d([m({type:String,json:{write:!0}})],ka.prototype,"alias",void 0),d([m({type:[String,Number],json:{write:{allowNull:!0}}})],ka.prototype,"defaultValue",void 0),d([m()],ka.prototype,"description",void 0),d([yr("description")],ka.prototype,"readDescription",null),d([m({types:dje,json:{read:{reader:pje},write:!0}})],ka.prototype,"domain",void 0),d([m({type:Boolean,json:{write:!0}})],ka.prototype,"editable",void 0),d([m({type:js,json:{write:!0}})],ka.prototype,"length",void 0),d([m({type:String,json:{write:!0}})],ka.prototype,"name",void 0),d([m({type:Boolean,json:{write:!0}})],ka.prototype,"nullable",void 0),d([Si(fje)],ka.prototype,"type",void 0),d([m()],ka.prototype,"valueType",void 0),d([yr("valueType",["description"])],ka.prototype,"readValueType",null),d([m({type:Boolean,json:{read:!1}})],ka.prototype,"visible",void 0),ka=k7=d([J("esri.layers.support.Field")],ka);const gje=ka;let Dwt=class{constructor(e,i,r){this.uid=e,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}};function Fwt(t){return t.geometry!=null}let kwt=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function zwt(t){var s;const e=iPe.fromJSON(t.geometryType),i=jt.fromJSON(t.spatialReference),r=t.transform,n=t.features.map(o=>{const a=_je(o,e,i,t.objectIdFieldName),l=a.geometry;if(l!=null&&r)switch(l.type){case"point":a.geometry=X_e(r,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=Z_e(r,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=Y_e(r,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=J_e(r,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:n,spatialReference:i,fields:((s=t.fields)==null?void 0:s.map(o=>gje.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function _je(t,e,i,r){return{uid:xc(),objectId:r&&t.attributes?t.attributes[r]:null,attributes:t.attributes,geometry:yje(t.geometry,e,i),visible:!0}}function yje(t,e,i){if(t==null)return null;switch(e){case"point":{const r=t;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=t;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=t;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=t;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function Qb(t,e,i,r){return{x:t,y:e,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function vje(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)i+=s.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32*(n.length+1);break}case"multipoint":{const i=2+(t.hasZ?1:0)+(t.hasM?1:0),r=t.points.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=$_(t.vertexAttributes.position),e+=$_(t.vertexAttributes.normal),e+=$_(t.vertexAttributes.uv),e+=$_(t.vertexAttributes.tangent)}return e}function Bwt(t){let e=32;return e+=U_e(t.attributes),e+=3,e+=8+vje(t.geometry),e}function bje(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const i of t.paths)e+=i.length;return e}case"polygon":{let e=0;for(const i of t.rings)e+=i.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function Vwt(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function Gwt(t,e){switch(Gr(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let i=0;i<t.paths.length;i++)JF(e,t.paths[i],!!t.hasZ);break;case"polygon":for(let i=0;i<t.rings.length;i++)JF(e,t.rings[i],!!t.hasZ);break;case"multipoint":JF(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function wje(t,e){switch(kh(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let i=0;i<t.paths.length;i++)DF(e,t.paths[i]);break;case"polygon":for(let i=0;i<t.rings.length;i++)DF(e,t.rings[i]);break;case"multipoint":DF(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function jwt(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function tye(t){return"declaredClass"in t}function tee(t){return"declaredClass"in t}function xje(t){return"declaredClass"in t}function Tje(t,e){return t?xje(t)?t:new gb({layer:e,sourceLayer:e,visible:t.visible,symbol:Le(t.symbol),attributes:Le(t.attributes),geometry:iye(t.geometry)}):null}function iye(t){return t==null?null:tye(t)?t:CP(Sje(t))}function Sje(t){const{wkid:e,wkt:i,latestWkid:r}=t.spatialReference,n={wkid:e,wkt:i,latestWkid:r};switch(t.type){case"point":{const{x:s,y:o,z:a,m:l}=t;return{x:s,y:o,z:a,m:l,spatialReference:n}}case"polygon":{const{rings:s,hasZ:o,hasM:a}=t;return{rings:iee(s),hasZ:o,hasM:a,spatialReference:n}}case"polyline":{const{paths:s,hasZ:o,hasM:a}=t;return{paths:iee(s),hasZ:o,hasM:a,spatialReference:n}}case"extent":{const{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:p,mmax:f,hasZ:y,hasM:v}=t;return{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:p,mmax:f,hasZ:y,hasM:v,spatialReference:n}}case"multipoint":{const{points:s,hasZ:o,hasM:a}=t;return{points:nye(s)?rye(s):s,hasZ:o,hasM:a,spatialReference:n}}default:return}}function iee(t){return Cje(t)?t.map(e=>rye(e)):t}function rye(t){return t.map(e=>Array.from(e))}function Cje(t){for(const e of t)if(e.length!==0)return nye(e);return!1}function nye(t){return t.length>0&&(tS(t[0])||iS(t[0]))}function Eje(t,e){if(!t)return null;let i;if(tee(t)){if(e==null)return t.clone();if(tee(e))return e.copy(t)}return e!=null?(i=e,i.x=t.x,i.y=t.y,i.spatialReference=t.spatialReference,t.hasZ?(i.z=t.z,i.hasZ=t.hasZ):(i.z=void 0,i.hasZ=!1),t.hasM?(i.m=t.m,i.hasM=!0):(i.m=void 0,i.hasM=!1)):(i=Qb(t.x,t.y,t.z,t.spatialReference),t.hasM&&(i.m=t.m,i.hasM=!0)),i}function Hwt(t){const{wkid:e,wkt:i,latestWkid:r}=t,n={wkid:e,wkt:i,latestWkid:r};return jt.fromJSON(n)}const VW="__begin__",GW="__end__",Aje=new RegExp(VW,"ig"),Pje=new RegExp(GW,"ig"),ree=new RegExp("^"+VW,"i"),nee=new RegExp(GW+"$","i"),eN='"',Oje=eN+" + ",Rje=" + "+eN;function Mje(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function Wwt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function jW(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=Mje(t.labelExpression),e.type="conventional"),e}function qwt(t){const e=jW(t);if(!e)return null;switch(e.type){case"conventional":return $je(e.expression);case"arcade":return e.expression}return null}function Zwt(t){const e=jW(t);if(!e)return null;switch(e.type){case"conventional":return Lje(e.expression);case"arcade":return sye(e.expression)}return null}function $je(t){let e;return t?(e=JN(t,i=>VW+'$feature["'+i+'"]'+GW),e=ree.test(e)?e.replace(ree,""):eN+e,e=nee.test(e)?e.replace(nee,""):e+eN,e=e.replaceAll(Aje,Oje).replaceAll(Pje,Rje)):e='""',e}const Ije=/^\s*\{([^}]+)\}\s*$/i;function Lje(t){const e=t==null?void 0:t.match(Ije);return e&&e[1].trim()||null}const Dje=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,Nje=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,Fje=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function sye(t){if(!t)return null;let e=Dje.exec(t)||Nje.exec(t);return e?e[1]||e[3]:(e=Fje.exec(t),e?e[2]:null)}const xk=ye.getLogger("esri.layers.support.labelFormatUtils"),Tk={type:"simple",evaluate:()=>null},kje={getAttribute:(t,e)=>t.field(e)};async function oye(t,e,i){if(!t||!t.symbol||!e)return Tk;const r=t.where,n=jW(t),s=r?await Oe(()=>import("./WhereClause-40a2a5ab.js").then(a=>a.W),["./WhereClause-40a2a5ab.js","./executionError-c92d3b85.js"],import.meta.url):null;let o;if(n.type==="arcade"){const a=await hPe(n.expression,i,e);if(a==null)return Tk;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){xk.error(new ce("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:n}))}return null},needsHydrationToEvaluate:()=>sye(n.expression)==null}}else o={type:"simple",evaluate:a=>n.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),u=e.get(c);if(!u)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[u.name]):p=a.field(u.name),p==null?"":aye(p,u)})};if(r){let a;try{a=s.WhereClause.create(r,e)}catch(c){return xk.error(new ce("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),Tk}const l=o.evaluate;o.evaluate=c=>{const u="attributes"in c?void 0:kje;try{if(a.testFeature(c,u))return l(c)}catch(p){xk.error(new ce("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function aye(t,e){if(t==null)return"";const i=e.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const n=t;for(const s of i.codedValues)if(s.code===n)return s.name}else if(i.type==="range"){const n=+t,s="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(s<=n&&n<=o)return i.name}}let r=t;return e.type==="date"||e.type==="esriFieldTypeDate"?r=ay(r,cE("short-date")):hce(e)&&(r=gT(+r)),r||""}const Xwt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:oye,formatField:aye},Symbol.toStringTag,{value:"Module"}));let lye=class{constructor(e=null,i="center",r="center",n=null,s=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",u=0,p=0){this.verticalOffset=e,this.horizontalPlacement=i,this.verticalPlacement=r,this.text=n,this.translation=s,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=u,this.displayHeight=p}};function HW(t,e){if(t.type==="point")return C0(t,e,!1);if(tye(t))switch(t.type){case"extent":return C0(t.center,e,!1);case"polygon":return C0(t.centroid,e,!1);case"polyline":return C0(see(t),e,!0);case"mesh":return C0(t.origin,e,!1)}else switch(t.type){case"extent":return C0(Uje(t),e,!0);case"polygon":return C0(zje(t),e,!0);case"polyline":return C0(see(t),e,!0)}}function see(t){const e=t.paths[0];if(!e||e.length===0)return null;const i=$le(e,Mle(e)/2);return Qb(i[0],i[1],i[2],t.spatialReference)}function Uje(t){return Qb(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function zje(t){const e=t.rings[0];if(!e||e.length===0)return null;const i=Dle(t.rings,!!t.hasZ);return Qb(i[0],i[1],i[2],t.spatialReference)}function C0(t,e,i){const r=i?t:Eje(t);return e&&t?ude(t,r,e)?r:null:r}function Jwt(t,e,i,r=0){if(t){e||(e=li());const n=t;let s=.5*n.width*(i-1),o=.5*n.height*(i-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),Br(e,n.xmin-s-r,n.ymin-o-r,n.xmax+s+r,n.ymax+o+r),e}return null}function cye(t,e){for(let i=0;i<t.geometries.length;++i){const r=t.geometries[i].getMutableAttribute(M.AUXPOS1);r&&r.data[3]!==e&&(r.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[i]))}}function JA(t,e,i=null){const r=G3(Sh);return t!=null&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),e!=null?r[3]=e:t!=null&&t.length>3&&(r[3]=t[3]),i&&(r[0]*=i,r[1]*=i,r[2]*=i,r[3]*=i),r}function Kwt(t,e,i,r,n,s=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?s[o]=t[o]:i!=null&&i[o]!=null?s[o]=i[o]:s[o]=n[o];return s[3]=e??r??n[3],s}function oee(t=ug,e,i,r=1){const n=new Array(3);if(e==null||i==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,p=a===0&&!s&&!u,f=i[a];l==="symbol-value"||p?c=f!==0?e[a]/f:1:u&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=r;return Za(n)}function Bje(t){return t.isPrimitive!=null}function M4(t){return U7(Bje(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function U7(t){const e=i=>i==null||i>=0;return Array.isArray(t)?t.every(e):e(t)}function Vje(t,e,i,r=Ne()){return t&&wT(r,r,-t/180*Math.PI),e&&bT(r,r,e/180*Math.PI),i&&$5(r,r,i/180*Math.PI),r}function WW(t,e,i){if(i.minDemResolution!=null)return i.minDemResolution;const r=al(e),n=Gb(t)*r,s=jb(t)*r,o=Ry(t)*(e.isGeographic?1:r);return n===0&&s===0&&o===0?i.minDemResolutionForPoints:.01*Math.max(n,s,o)}function uye(t,e,i,r,n,s,o,a,l,c,u){const p=Yje[u.mode];let f,y,v=0;if(_n(t,e,i,r,l.spatialReference,n,a))return p.requiresAlignment(u)?(v=p.applyElevationAlignmentBuffer(r,n,s,o,a,l,c,u),f=s,y=o):(f=r,y=n),_n(f,l.spatialReference,y,s,c.spatialReference,o,a)?v:void 0}function xy(t,e,i,r,n){const s=(GD(t)?t.z:u0e(t)?t.array[t.offset+2]:t[2])||0;switch(i.mode){case"on-the-ground":{const o=Af(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=Af(e,t,"ground")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=Af(e,t,"scene")??0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(s,r),a=Af(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function Gje(t,e,i,r){return xy(t,e,i,r,P2),P2.z}function sO(t,e,i){return e==null||i==null?t.definedChanged:e==="on-the-ground"&&i==="on-the-ground"?t.staysOnTheGround:e===i||e!=="on-the-ground"&&i!=="on-the-ground"?Pn.UPDATE:t.onTheGroundChanged}function Zh(t){return t==="relative-to-ground"||t==="relative-to-scene"}function Ty(t){return t!=="absolute-height"}function jje(t,e,i,r,n){xy(e,i,n,r,P2),cye(t,P2.verticalDistanceToGround);const s=P2.sampledElevation,o=Qn(Jje,t.transformation);return CM[0]=e.x,CM[1]=e.y,CM[2]=P2.z,_u(e.spatialReference,CM,o,r.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function Hje(t,e,i,r,n,s){let o=0;const a=s.spatialReference;e*=3,r*=3;for(let l=0;l<n;++l){const c=t[e],u=t[e+1],p=t[e+2],f=s.getElevation(c,u,p,a,"ground")??0;o+=f,i[r]=c,i[r+1]=u,i[r+2]=f,e+=3,r+=3}return o/n}function Wje(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,r*=3;for(let f=0;f<n;++f){const y=t[e],v=t[e+1],b=t[e+2],x=s.getElevation(y,v,b,p,"ground")??0;l+=x,i[r]=y,i[r+1]=v,i[r+2]=u==null?b+x+c:x+c,e+=3,r+=3}return l/n}function qje(t,e,i,r,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,p=s.spatialReference;e*=3,r*=3;for(let f=0;f<n;++f){const y=t[e],v=t[e+1],b=t[e+2],x=s.getElevation(y,v,b,p,"scene")??0;l+=x,i[r]=y,i[r+1]=v,i[r+2]=u==null?b+x+c:x+c,e+=3,r+=3}return l/n}function Zje(t){const e=t.meterUnitOffset,i=t.featureExpressionInfoContext;return e!==0||i!=null}function Xje(t,e,i,r,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,r*=3;for(let u=0;u<n;++u){const p=t[e],f=t[e+1],y=t[e+2];i[r]=p,i[r+1]=f,i[r+2]=c==null?y+l:l,e+=3,r+=3}return 0}let oO=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Pn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Pn||(Pn={}));const Yje={"absolute-height":{applyElevationAlignmentBuffer:Xje,requiresAlignment:Zje},"on-the-ground":{applyElevationAlignmentBuffer:Hje,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:Wje,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:qje,requiresAlignment:()=>!0}},Jje=Ne(),P2=new oO,CM=I();function qW(t){return t.mapPositions!=null}function hye(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!qW(l))continue;const{update:c,averageGeometrySampledElevation:u}=pye(l,e,i,r,n);a+=u,c&&s.geometryVertexAttrsUpdated(l)}return a/o.length}function W1(t,e,i,r,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(r(a,Al),cye(o,Al.verticalDistanceToGround),l=Al.sampledElevation):(r(a,Al),e.mode!=="absolute-height"&&(l=Al.sampledElevation));const c=Qn(Kje,s??o.transformation),u=me(dye,c[12],c[13],c[14]);Or.TESTS_DISABLE_OPTIMIZATIONS?(El[0]=a.x,El[1]=a.y,El[2]=Al.z,_u(a.spatialReference,El,c,n.spatialReference)&&(s?Qn(s,c):o.transformation=c)):n.setAltitudeOfTransformation(Al.z,c);const p=ZW/n.unitInMeters;return(Math.abs(c[12]-u[0])>=p||Math.abs(c[13]-u[1])>=p||Math.abs(c[14]-u[2])>=p)&&(s?Qn(s,c):o.transformation=c),l}const Kje=Ne();function Qje(t,e,i,r,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;r(o,Al);const a=e.mode!=="absolute-height"?Al.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,u=tHe;l.getGlobalTransform(c,u);const p=me(dye,u[12],u[13],u[14]);Or.TESTS_DISABLE_OPTIMIZATIONS?(El[0]=o.x,El[1]=o.y,El[2]=Al.z,_u(o.spatialReference,El,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(Al.z,u);const f=ZW/n.unitInMeters;return(Or.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-p[0])>=f||Math.abs(u[13]-p[1])>=f||Math.abs(u[14]-p[2])>=f)&&l.setGlobalTransform(c,u),a}function eHe(t,e,i,r,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const p of o){if(!qW(p))continue;const f=p.vertexAttributes.get(M.POSITION);if(f!==l){const{update:y,averageGeometrySampledElevation:v}=pye(p,e,i,r,n);c=v,l=f,u=y}u&&s.geometryVertexAttrsUpdated(p),a+=c}return a/o.length}const ZW=.01,El=I(),zu=I(),Hw=I(),tHe=Ne(),dye=I(),Al=new oO;function pye(t,e,i,r,n){let s=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;zu[0]=o[12],zu[1]=o[13],zu[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(M.POSITION),c=l.data,u=l.size,p=c.length/u,f=new wW(t.mapPositions,i);let y=0,v=0;for(let b=0;b<p;b++){if(Hw[0]=c[y],Hw[1]=c[y+1],Hw[2]=c[y+2],r(f,Al),a&&(v+=Al.sampledElevation),Or.TESTS_DISABLE_OPTIMIZATIONS)c[y]=f.array[f.offset],c[y+1]=f.array[f.offset+1],c[y+2]=Al.z,_n(c,i,y,c,n.spatialReference,y,1),c[y]-=zu[0],c[y+1]-=zu[1],c[y+2]-=zu[2],s=!0;else{El[0]=c[y]+zu[0],El[1]=c[y+1]+zu[1],El[2]=c[y+2]+zu[2],n.setAltitude(El,Al.z),c[y]=El[0]-zu[0],c[y+1]=El[1]-zu[1],c[y+2]=El[2]-zu[2];const x=ZW/n.unitInMeters;(Math.abs(Hw[0]-c[y])>=x||Math.abs(Hw[1]-c[y+1])>=x||Math.abs(Hw[2]-c[y+2])>=x)&&(s=!0)}y+=u,f.offset+=3}return v/=p,{update:s,averageGeometrySampledElevation:v}}function iHe(t){return!!t&&BT[t]!=null}function rHe(t){return 1/(BT[t]||1)}function nHe(){const t=Object.keys(BT);return t.sort(),t}const ext=nHe(),sHe=ye.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function oHe(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function txt(t){const e=t&&t.expression;if(typeof e=="string"){const i=gye(e);if(i!=null)return{cachedResult:i}}return null}async function ixt(t,e,i,r){const n=t&&t.expression;if(typeof n!="string")return null;const s=gye(n);if(s!=null)return{cachedResult:s};const o=await jG();Ti(i);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(r!=null&&r.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function fye(t,e,i){return t.arcadeUtils.createFeature(e.attributes,e.geometry,i)}function $4(t,e){if(t!=null&&!mye(t)){if(!e||!t.arcade)return void sHe.errorOncePerTick("Arcade support required but not provided");const i=e;i._geometry&&(i._geometry=iye(i._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function aHe(t){if(t!=null){if(mye(t))return t.cachedResult;const e=t.arcade;let i=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof i!="number"&&(t.cachedResult=0,i=0),i}return 0}function rxt(t,e=!1){let i=t&&t.featureExpressionInfo;const r=i&&i.expression;return e||r==="0"||(i=null),i??null}const lHe={cachedResult:0};function mye(t){return t.cachedResult!=null}function gye(t){return t==="0"?0:null}let wp=class _ye{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=rHe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:e+r}calculateOffsetRenderUnits(e){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=aHe(r)*this._metersPerElevationInfoUnit),i/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=iHe(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,i,r){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&i!=null&&r!=null?(this._featureExpressionInfoContext=oHe(e),$4(this._featureExpressionInfoContext,fye(n.modules,i,r))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const i=new _ye;return e!=null&&i.setFromElevationInfo(e),i}},cHe=class{constructor(e,i,r){this.graphic=e,this.renderingInfo=i,this.layer=r}};var oi;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(oi||(oi={}));let uHe=class{constructor(e,i,r){this.baseMaterial=e,this.edgeMaterials=i,this.properties=r}},lm=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,i,r,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const i=e.stage;i.addMany(this._uniqueMaterials),i.addMany(this._uniqueGeometries),i.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=e.renderer.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,i){if(this._edgeState==null)return;const r=aee(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==r&&(s.objectTransparency=r,n=!0);n&&this.resetEdgeObject(i),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,i){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!i),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const i=this._stageLayer.stage.renderer.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(e,i,r,n){if(this.elevationAligner==null)return;r!=null&&$4(this.elevationContext.featureExpressionInfoContext,r);const s=(o,a)=>xy(o,e,this.elevationContext,i,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,i),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,i,r){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,i),this.resetEdgeObject(r)}getCenterObjectSpace(e=I()){return fe(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=$s()){const i=this.stageObject.boundingVolumeObjectSpace;return Vue(e,i.min),Gue(e,i.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.shaderTransformation;e.render.origin[0]+=i[12],e.render.origin[1]+=i[13],e.render.origin[2]+=i[14],e.render.num++}else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(xm)&&(st(xm,xm,this.stageObject.shaderTransformation),xe(e.render.origin,e.render.origin,xm),e.render.num++)}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=hHe,l=hj(o)?1:a.length;for(let u=0;u<l;u++){const p=a[u];E0[0]=o[p[0]],E0[1]=o[p[1]],E0[2]=o[p[2]],st(E0,E0,this.stageObject.transformation),ov[3*u]=E0[0],ov[3*u+1]=E0[1],ov[3*u+2]=E0[2]}if(!e(ov,0,l))return null;Gr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],ov[u+p]),o[p+3]=Math.max(o[p+3],ov[u+p]);c&&r.push({location:ov.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){Zd(o,xm);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=i.service.getElevation(xm[0],xm[1],u)??0;else try{const f=WW(o,i.service.spatialReference,i);p=await i.service.queryElevation(xm[0],xm[1],n,f,u)??0}catch{}Bue(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(e,i){e===Ng.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),e===Ng.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const i=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,e):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,i){const r=this._edgeState;if(r==null)return;const n=aee(r.baseMaterial);for(const s of r.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function aee(t){return t.isVisible()?t.parameters.transparent?oi.TRANSPARENT:oi.OPAQUE:oi.INVISIBLE}const ov=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],E0=I(),xm=I(),hHe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let yye=class{constructor(e,i=null){this.labelText=i,this.elevationOffset=e??0}};var Jn;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Jn||(Jn={}));let XW=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=su.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,i){return this._loadStatus===su.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===su.FAILED?(i&&i(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=su.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=su.FAILED,!ms(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(e,i).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=wu(this._abortController):this._loadStatus===su.LOADING&&(this._loadStatus=su.FAILED),this._loader=null}};var su;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(su||(su={}));const vye=3,z7=3,bye=10;let wye=class{constructor(e,i=null){this.geometry=e,this.textures=i}};function EM(t){const e=[];return t.levels.forEach(i=>i.components.forEach(r=>e.push(r.geometry.material))),qN(e)}function lee(t){const e=new Array;return t.levels.forEach(i=>{i.components.forEach(r=>{r.textures!=null&&e.push(...r.textures)})}),qN(e)}function xye(t){const e=t.components.map(i=>i.geometry);return qN(e)}function cee(t){const e=[];return t.levels.forEach(i=>{i.components.forEach(r=>{e.push(r.geometry)})}),qN(e)}function dHe(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Tye(t,e){const i=(r,n,s=!1)=>({levels:r.map(o=>{const a=n(o.tesselation);return s&&PUe(a),{components:[new wye(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>CUe(e,.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>gUe(e,1));case"cone":return i(Sk,r=>oK(e,1,.5,r,!1),!0);case"inverted-cone":return i(Sk,r=>oK(e,1,.5,r,!0),!0);case"cylinder":return i(Sk,r=>AUe(e,1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>SUe(e,1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>bUe(e,1),!0);default:return}}const Sk=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function pHe(t){return t.type==="fill"}function fHe(t){return t.type==="extrude"}function mHe(t){return t&&t.enabled&&(fHe(t)||pHe(t))&&t.edges!=null}function gHe(t){return t&&t.enabled&&t.edges||null}function Sye(t,e){return _He(gHe(t),e)}function _He(t,e){if(t==null)return null;const i=t.color!=null?qj(Lt.toUnitRGBA(t.color)):Kt(0,0,0,0),r=Sa(t.size),n=Sa(t.extensionLength);switch(t.type){case"solid":return yHe({color:i,size:r,extensionLength:n,...e});case"sketch":return vHe({color:i,size:r,extensionLength:n,...e});default:return}}function yHe(t){return{...bHe,...t,type:"solid"}}function vHe(t){return{...wHe,...t,type:"sketch"}}const bHe={color:Kt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:oi.OPAQUE,hasSlicePlane:!1},wHe={color:Kt(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:oi.OPAQUE,hasSlicePlane:!1},YW={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function uxt(t){return t.type==="web-style"?YW:JW(t.symbolLayers.toArray().map(e=>Cye(t,e)))}function JW(t){let e=0,i=0,r=0,n=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,n=n||a.estimated,++s);return{primitivesPerFeature:e,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:n,memory:o,numComplexities:s}}function hxt(t){const e=JW(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const uee={};function Cye(t,e){var n;const i=Eye(t,e),r=mHe(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return(n=e.resource)!=null&&n.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...xHe(e.resource&&e.resource.primitive||yhe),memory:i};case"path":{let s=0,o=0;switch(e.profile){case"circle":s=bye;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":o=vye;break;case"miter":case"bevel":o=1;break;default:return}const a=2*s,l=s*o*2;let c=-2*l-a;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(s-1);break;case"round":c+=2*(s*(z7-1)*2+s);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function Eye(t,e){const i=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?hl.EXTRUDE_EDGES:hl.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?hl.FILL_OUTLINE:hl.FILL;case"water":return hl.FILL;case"line":return e.join==="round"?hl.LINE_ROUND:hl.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return hl.PATH_ROUND_CIRCLE;case"quad":return hl.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return hl.PATH_MITER_CIRCLE;case"quad":return hl.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return i?hl.OBJECT_POINT:hl.OBJECT_POLYGON;case"icon":case"text":return i?hl.ICON_POINT:hl.ICON_POLYGON;default:return}}function xHe(t){let e=uee[t];if(e)return e;const i=Tye(t,null);return e={primitivesPerFeature:xye(i.levels[0]).reduce((r,n)=>r+n.indices.get(M.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},uee[t]=e,e}const hl={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},Ww=ye.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let cm=class extends XW{constructor(e,i,r,n){super(r.schedule),this.symbol=e,this.symbolLayer=i,this._context=r,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=Ww,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new wp,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=hee(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const i=this._drivenProperties,r=hee(e);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,i,r,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(i,r,n)&&o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&Ww.warnOncePerTick(l)}_logGeometryValidationWarnings(e,i,r){const n=`${r} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(Ww.warnOncePerTick(`${n} (no ${i} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(Ww.warnOncePerTick(`${n} (${i} should be defined as a 2D array)`),!0)}_validateGeometry(e,i=null,r=null){if(i!=null&&!i.includes(e.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return Ww.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return THe}_defaultElevationInfoZ(){return SHe}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,i=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,i){const r=e.geometry,n=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,i.mode=this.getGeometryElevationMode(r,n),i.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";s&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=s?lHe:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,e,this._context.layer),i}prepareSymbolLayerPatch(e){}updateGeometry(e,i){return!1}updateTransform(e,i,r,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,i=dee){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?r*=e.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(e,i=dee){const r=this._getCombinedOpacity(e,i);if(this._drivenProperties.color)return JA(null,r);const n=e!=null?Lt.toUnitRGB(e):ug;return JA(n,r)}_getVertexOpacityAndColor(e,i=null){const r=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=JA(r,n);return i&&(s[0]*=i,s[1]*=i,s[2]*=i,s[3]*=i),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return Cye(this.symbol,this.symbolLayer)}globalPropertyChanged(e,i,r){switch(e){case"opacity":return this.layerOpacityChanged(i,r),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,n)!==Pn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,i,r){let n=Pn.UPDATE;return e.forEach(s=>{const o=i(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else n=Pn.RECREATE}),n}applyRendererDiff(e,i){return Jn.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const i=this._fastUpdates.visualVariables,r=i.size?op(i.size.field,e):0,n=i.color?op(i.color.field,e):0,s=i.opacity?op(i.opacity.field,e):0;return Kt(r,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&Ww.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var i,r,n,s,o,a,l,c;return{size:((r=(i=this._fastUpdates)==null?void 0:i.visualVariables.size)==null?void 0:r.field)??null,color:((s=(n=this._fastUpdates)==null?void 0:n.visualVariables.color)==null?void 0:s.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function hee(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(i=>{switch(i.type){case"color":if(e.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const n=i.stops[r].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const THe={mode:"on-the-ground",offset:0,unit:"meters"},SHe={mode:"absolute-height",offset:0,unit:"meters"},dee={hasIntrinsicColor:!1};let e0=class extends Y3{get geometries(){return this._geometries}get transformation(){return this._transformation??Os}set transformation(e){this._transformation=Qn(this._transformation??Ne(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=Qn(this._shaderTransformation??Ne(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=An.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new Aye),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){xt(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const i=this._geometries.splice(e,1)[0];i&&(this._emit("objectGeometryRemoved",{object:this,geometry:i}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const i of this._geometries)i.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new MD(Ng.MaskOccludee);for(const i of this._geometries)i.occludees=t7(i.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const i of this._geometries)i.occludees=i7(i.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new MD(Ng.Highlight);for(const i of this._geometries)i.highlights=t7(i.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const i of this._geometries)i.highlights=i7(i.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,i){return Cr(i,this.transformation,e.transformation)}getCombinedShaderTransformation(e,i=Ne()){return Cr(i,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new pee,this._validateBoundingVolume(this._bvWorldSpace,KA.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new pee,this._validateBoundingVolume(this._bvObjectSpace,KA.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,i){const r=i===KA.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&CHe(s,e,r?n.shaderTransformation:this.getCombinedShaderTransformation(n))}pr(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=r?n.shaderTransformation:this.getCombinedShaderTransformation(n),a=CT(o);st(fee,s.center,o);const l=Nr(fee,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var i;const e=(i=this._bvWorldSpace)==null?void 0:i.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,i){this._parentLayer&&this._parentLayer.events.emit(e,i)}get test(){const e=this;return{hasGeometry:i=>e._geometries.includes(i),getGeometryIndex:i=>e._geometries.indexOf(i)}}},Aye=class{constructor(){this.min=Ge(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ge(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},pee=class extends Aye{constructor(){super(...arguments),this.bounds=kn()}};function CHe(t,e,i){const r=t.bbMin,n=t.bbMax;if(L5(i)){const s=me(EHe,i[12],i[13],i[14]);xe(Vc,r,s),xe(ud,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Vc[o]),e.max[o]=Math.max(e.max[o],ud[o])}else if(st(Vc,r,i),xa(r,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Vc[s]),e.max[s]=Math.max(e.max[s],Vc[s]);else{st(ud,n,i);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Vc[s],ud[s]),e.max[s]=Math.max(e.max[s],Vc[s],ud[s]);for(let s=0;s<3;++s){fe(Vc,r),fe(ud,n),Vc[s]=n[s],ud[s]=r[s],st(Vc,Vc,i),st(ud,ud,i);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Vc[o],ud[o]),e.max[o]=Math.max(e.max[o],Vc[o],ud[o])}}}const EHe=I(),Vc=I(),ud=I(),fee=I();var KA;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(KA||(KA={}));function KW(t,e,i,r,n,s){const o=t.clippingExtent;if(No(e,W_,t.elevationProvider.spatialReference),o!=null&&!cj(o,W_))return null;No(e,W_,t.renderCoordsHelper.spatialReference),i.shaderTransformer=s,i.localOrigin=t.localOriginFactory.getOrigin(W_);const a=new e0({geometries:[i],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:jje(a,e,t.elevationProvider,t.renderCoordsHelper,r)}}function t3(t,e,i){const r=t.elevationContext,n=i.spatialReference;No(e,W_,n),r.centerPointInElevationSR=Qb(W_[0],W_[1],e.hasZ?W_[2]:0,n??null)}function i3(t){switch(t.type){case"point":return t;case"polygon":case"extent":return HW(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const i=$le(e,Mle(e)/2);return Qb(i[0],i[1],i[2],t.spatialReference)}case"mesh":return t.origin}return null}const W_=I();function Pye(){return new Float32Array(2)}function AHe(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function vh(t,e){const i=new Float32Array(2);return i[0]=t,i[1]=e,i}function PHe(t,e){return new Float32Array(t,e,2)}function Oye(){return Pye()}function Rye(){return vh(1,1)}function Mye(){return vh(1,0)}function $ye(){return vh(0,1)}const Iye=Oye(),Lye=Rye(),OHe=Mye(),RHe=$ye();Object.freeze(Object.defineProperty({__proto__:null,ONES:Lye,UNIT_X:OHe,UNIT_Y:RHe,ZEROS:Iye,clone:AHe,create:Pye,createView:PHe,fromValues:vh,ones:Rye,unitX:Mye,unitY:$ye,zeros:Oye},Symbol.toStringTag,{value:"Module"}));function MHe(t){const e=new Fi,{vertex:i,fragment:r}=e;return i.include(S4),e.include(Z0e,t),e.include(Nn,t),e.attributes.add(M.UV0,"vec2"),i.uniforms.add(new yi("viewport",(n,s)=>s.camera.fullViewport),new je("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new Bi("pixelToNDC",(n,s)=>bi(gee,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new je("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new Bi("screenOffset",(n,s)=>bi(gee,n.screenOffset[0]*s.camera.pixelRatio,n.screenOffset[1]*s.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&T4(i),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?T`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?T`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add(new yi("uColor",n=>mee(n.color)),new yi("borderColor",n=>mee(n.borderColor))),t.hasMultipassGeometry&&(r.include(Tme,t),r.uniforms.add(new Bi("inverseViewport",(n,s)=>s.inverseViewport))),r.code.add(T`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function mee(t){return t??Df}const gee=it(),$He=Object.freeze(Object.defineProperty({__proto__:null,build:MHe},Symbol.toStringTag,{value:"Module"}));let Dye=class Nye extends qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ke.Global}initializeProgram(e){return new Gi(e.rctx,Nye.shader.get().build(this.configuration),Ni)}setPipelineState(e){const i=e?br.ALWAYS:br.LESS;return this.configuration.depthHudEnabled?Zt({depthTest:{func:i},depthWrite:Nl}):Zt({blending:Fo(De.ONE,De.SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:ni})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};Dye.shader=new Vi($He,()=>Oe(()=>import("./LineCallout.glsl-1c7946fa.js"),[],import.meta.url));let sh=class extends Ko{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Pl.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};d([q({count:Pl.COUNT})],sh.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([q()],sh.prototype,"spherical",void 0),d([q()],sh.prototype,"occlusionTestEnabled",void 0),d([q()],sh.prototype,"hasVerticalOffset",void 0),d([q()],sh.prototype,"hasScreenSizePerspective",void 0),d([q()],sh.prototype,"depthHudEnabled",void 0),d([q()],sh.prototype,"depthHudAlignStartEnabled",void 0),d([q()],sh.prototype,"hasSlicePlane",void 0),d([q()],sh.prototype,"hasMultipassGeometry",void 0),d([q({constValue:!0})],sh.prototype,"hasSliceInVertexProgram",void 0),d([q({constValue:!1})],sh.prototype,"draped",void 0);let AM=class B7 extends Ly{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new Fye),this._configuration=new sh,this._uniqueMaterialIdentifier=B7.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,i){const r=(i==null?void 0:i.slot)!==Te.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=r,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Pl.Screen:Pl.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=i.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,i){if(i===j.Color)switch(e){case Te.LINE_CALLOUTS:case Te.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new IHe(e)}createBufferWriter(){return new DHe}validateParameters(e){const i=B7.uniqueMaterialIdentifier(e);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},IHe=class extends $y{beginSlot(e){return this.ensureTechnique(Dye,e)}},Fye=class extends IW{constructor(){super(...arguments),this.screenOffset=fp,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const LHe=ln().vec3f(M.POSITION).vec3f(M.NORMAL).vec2f(M.UV0).vec4f(M.AUXPOS1),_ee=[vh(0,0),vh(1,0),vh(0,1),vh(1,0),vh(1,1),vh(0,1)];let DHe=class{constructor(){this.vertexBufferLayout=LHe}elementCount(e){return 6*e.indices.get(M.POSITION).length}write(e,i,r,n,s){LW(r.indices.get(M.POSITION),r.vertexAttributes.get(M.POSITION).data,e,n.position,s,6),DW(r.indices.get(M.NORMAL),r.vertexAttributes.get(M.NORMAL).data,i,n.normal,s,6),zT(r.indices.get(M.AUXPOS1),r.vertexAttributes.get(M.AUXPOS1).data,n.auxpos1,s,6);for(let o=0;o<_ee.length;++o)n.uv0.setVec(s+o,_ee[o])}},kye=class Uye extends cm{constructor(e,i){super(e,null,i,kHe),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new AM(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const i=this._materialParameters;return i.screenOffset=e.screenOffset||fp,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){const e=new Fye,i=this.symbol,r=i.callout;if(e.color=r.color!=null?Lt.toUnitRGBA(r.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Sa(r.size||0),i.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=i.verticalOffset;e.verticalOffset={screenLength:Sa(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=r.border!=null&&r.border.color!=null?Lt.toUnitRGBA(r.border.color):null;const n=i.symbolLayers.at(0).type==="object",s=i.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return FHe}createGraphics3DGraphic(e){const i=e.renderingInfo,r=e.graphic,n=this.setGraphicElevationContext(r,new wp,i.elevationOffset||0),s=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!She(l)))return null;const a=HW(r.geometry);return a==null?null:this._createAs3DShape(a,n,i,r.uid)}layerOpacityChanged(){var e;(e=this._material)==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=sO(Uye.elevationModeChangeTypes,r,n);return s!==Pn.UPDATE||e.forEach(o=>{const a=i(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){var e;return(e=this._material)==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,i,r=0){const n=super.setGraphicElevationContext(e,i);return n.addOffsetRenderUnits(r),n}updateGraphicElevationContext(e,i){this.setGraphicElevationContext(e,i.elevationContext,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=Zh(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:YW.memory}}_createVertexData(e){const{translation:i,centerOffset:r}=e,n=new nt(i?[i[0],i[1],i[2]]:[0,0,0],3,!0),s=new nt(r?[r[0],r[1],r[2],r[3]]:[0,0,0,1],4,!0);return[[M.POSITION,n],[M.NORMAL,new nt([0,0,1],3,!0)],[M.AUXPOS1,s]]}_getOrCreateMaterial(e){const i=this._perInstanceMaterialParameters(e),r=AM.uniqueMaterialIdentifier(i);if(this._material&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(r);return n==null&&(n=new AM(i),e.materialCollection.add(r,n)),{material:n,isUnique:!1}}return{material:new AM(i),isUnique:!0}}_createAs3DShape(e,i,r,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(r),l=new fs(a.material,this._createVertexData(r),NHe,null,An.Point,o),c=KW(this._context,e,l,i,n);if(c==null)return null;const u=new lm(this,c.object,[l],a.isUnique?[a.material]:null,null,W1,i);return u.metadata=new yye(r.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=Zh(i.mode),t3(u,e,this._context.elevationProvider),u}};kye.elevationModeChangeTypes={definedChanged:Pn.UPDATE,staysOnTheGround:Pn.UPDATE,onTheGroundChanged:Pn.RECREATE};const Ck=[0],NHe=[[M.POSITION,Ck],[M.NORMAL,Ck],[M.AUXPOS1,Ck]],FHe={mode:"relative-to-ground",offset:0},kHe={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let UHe=class{constructor(e,i,r=I(),n=gi(),s=it(),o="world",a=0,l=null){this.renderer=e,this.symbol=i,this.translation=r,this.centerOffset=n,this.screenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},zHe=class extends cHe{};const yee=ye.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function BHe(t,e){if(!Rj(t))return yee.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const i=VHe[t.callout.type];return i?new i(t,e):(yee.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const VHe={line:kye};let Ab=class zye{constructor(e=null,i={},r,n){this.geometry=e,this.attributes=i,this.centroid=r,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new zye(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function xxt(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let Txt=class extends Ab{},GHe=class Bye{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new Bye;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},Sy=class WI{constructor(e=[],i=[],r=!1){this.lengths=e??[],this.coords=i??[],this.hasIndeterminateRingOrder=r}static fromRect(e){const[i,r,n,s]=e,o=n-i,a=s-r;return new WI([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,i)=>e+i)}forEachVertex(e){let i=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const n=this.lengths[r];for(let s=0;s<n;s++)e(this.coords[2*(s+i)],this.coords[2*(s+i)+1]);i+=n}}clone(e){return e?(e.set(this.coords),new WI(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new WI(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function Pa(t,e){return t?e?4:3:e?3:2}const aO=ye.getLogger("esri.layers.graphics.featureConversionUtils"),Vye={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},jHe=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s},vee=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2]},HHe=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+3]},WHe=(t,e,i,r,n,s)=>{t[i]=n,t[i+1]=s,t[i+2]=e[r+2],t[i+3]=e[r+3]};function QW(t,e,i,r){if(t){if(i)return e&&r?WHe:vee;if(e&&r)return HHe}else if(e&&r)return vee;return jHe}function Ek({scale:t,translate:e},i){return Math.round((i-e[0])/t[0])}function Ak({scale:t,translate:e},i){return Math.round((e[1]-i)/t[1])}function Pk({scale:t,translate:e},i,r){return i*t[r]+e[r]}function Cxt(t,e,i){return t?e?i?iq(t):eq(t):i?tq(t):I4(t):null}function I4(t){const e=t.coords;return{x:e[0],y:e[1]}}function Gye(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function eq(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function qHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function tq(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function ZHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function iq(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function XHe(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function YHe(t,e,i,r){let n=I4;i&&r?n=iq:i?n=eq:r&&(n=tq);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function rq(t,e){return t&&e?XHe:t?qHe:e?ZHe:Gye}function JHe(t,e,i,r,n){const s=rq(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new Sy,o):null;t.push(new Ab(l,a,null,n?a[n]:void 0))}return t}function Ext(t,e,i=rq(e.z!=null,e.m!=null)){return i(t,e)}function KHe(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?jye(n,i,r):null});return t}function jye(t,e,i){if(t==null)return null;const r=Pa(e,i),n=[];for(let s=0;s<t.coords.length;s+=r){const o=[];for(let a=0;a<r;a++)o.push(t.coords[s+a]);n.push(o)}return e?i?{points:n,hasZ:e,hasM:i}:{points:n,hasZ:e}:i?{points:n,hasM:i}:{points:n}}function QHe(t,e,i,r,n){const s=Pa(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?Hye(new Sy,o,s):null;t.push(new Ab(l,a,null,n?a[n]:void 0))}return t}function Hye(t,e,i=Pa(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let n=0;for(const s of e.points)for(let o=0;o<i;o++)r[n++]=s[o];return t}function eWe(t,e,i,r){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?Wye(n,i,r):null});return t}function Wye(t,e,i){if(!t)return null;const r=Pa(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const p=[];for(let f=0;f<r;f++)p.push(n[a++]);c.push(p)}o.push(c)}return e?i?{paths:o,hasZ:e,hasM:i}:{paths:o,hasZ:e}:i?{paths:o,hasM:i}:{paths:o}}function tWe(t,e,i,r,n){const s=Pa(i,r);for(const{geometry:o,attributes:a}of e){const l=o!=null?qye(new Sy,o,s):null;t.push(new Ab(l,a,null,n?a[n]:void 0))}return t}function qye(t,e,i=Pa(e.hasZ,e.hasM)){const{lengths:r,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<i;l++)n[s++]=a[l];r.push(o.length)}return t}function iWe(t,e,i,r){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?Zye(n,i,r):null;if(o!=null){const l=I4(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function Zye(t,e,i){if(!t)return null;const r=Pa(e,i),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const p=[];for(let f=0;f<r;f++)p.push(n[a++]);c.push(p)}o.push(c)}return e?i?{rings:o,hasZ:e,hasM:i}:{rings:o,hasZ:e}:i?{rings:o,hasM:i}:{rings:o}}function rWe(t,e,i,r,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?Xye(new Sy,s,i,r):null,c=n?a[n]:void 0;o!=null?t.push(new Ab(l,a,Gye(new Sy,o),c)):t.push(new Ab(l,a,null,c))}return t}function Xye(t,e,i=e.hasZ,r=e.hasM){return nWe(t,e.rings,i,r)}function nWe(t,e,i,r){const n=Pa(i,r),{lengths:s,coords:o}=t;let a=0;wg(t);for(const l of e){for(const c of l)for(let u=0;u<n;u++)o[a++]=c[u];s.push(l.length)}return t}const K2=[],QA=[];function Axt(t,e,i,r,n){K2[0]=t;const[s]=Yye(QA,K2,e,i,r,n);return _p(K2),_p(QA),s}function Yye(t,e,i,r,n,s){if(_p(t),!i){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new Ab(null,o.attributes,null,a))}return t}switch(i){case"esriGeometryPoint":return JHe(t,e,r,n,s);case"esriGeometryMultipoint":return QHe(t,e,r,n,s);case"esriGeometryPolyline":return tWe(t,e,r,n,s);case"esriGeometryPolygon":return rWe(t,e,r,n,s);default:aO.error("convertToFeatureSet:unknown-geometry",new ce(`Unable to parse unknown geometry type '${i}'`)),_p(t)}return t}function Pxt(t,e,i,r){QA[0]=t,Jye(K2,QA,e,i,r);const n=K2[0];return _p(K2),_p(QA),n}function sWe(t,e,i){if(t==null)return null;const r=new Sy;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&i==null&&(i=t.hasM),UG(t)?rq(e??t.z!=null,i??t.m!=null)(r,t):BG(t)?Xye(r,t,e,i):zG(t)?qye(r,t,Pa(e,i)):kG(t)?Hye(r,t,Pa(e,i)):void aO.error("convertFromGeometry:unknown-geometry",new ce(`Unable to parse unknown geometry type '${t}'`))}function oWe(t,e,i,r){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=I4;return i&&r?s=iq:i?s=eq:r&&(s=tq),s(n)}case"esriGeometryMultipoint":return jye(n,i,r);case"esriGeometryPolyline":return Wye(n,i,r);case"esriGeometryPolygon":return Zye(n,i,r);default:return aO.error("convertToGeometry:unknown-geometry",new ce(`Unable to parse unknown geometry type '${e}'`)),null}}function aWe(t,e){for(const i of e)t.push({attributes:i.attributes});return t}function Jye(t,e,i,r,n){if(_p(t),i==null)return aWe(t,e);switch(i){case"esriGeometryPoint":return YHe(t,e,r,n);case"esriGeometryMultipoint":return KHe(t,e,r,n);case"esriGeometryPolyline":return eWe(t,e,r,n);case"esriGeometryPolygon":return iWe(t,e,r,n);default:aO.error("convertToFeatureSet:unknown-geometry",new ce(`Unable to parse unknown geometry type '${i}'`))}return t}function Oxt(t){const{objectIdFieldName:e,spatialReference:i,transform:r,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:p,queryGeometryType:f}=t,y={features:Jye([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:i,uniqueIdField:u,queryGeometry:oWe(p,f,!1,!1)};return r&&(y.transform=r),c&&(y.exceededTransferLimit=c),s&&(y.hasM=s),o&&(y.hasZ=o),y}function Rxt(t,e){const i=new GHe,{hasM:r,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:p}=t;return p&&(i.fields=p),i.geometryType=l??null,i.objectIdFieldName=o??e??null,i.spatialReference=a??null,i.objectIdFieldName?(s&&Yye(i.features,s,l,n,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),n&&(i.hasZ=n),u&&(i.transform=u),i):(aO.error(new ce("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function Mxt(t){const{transform:e,features:i,hasM:r,hasZ:n}=t;if(!e)return t;for(const s of i)s.geometry!=null&&wee(s.geometry,s.geometry,r,n,e),s.centroid!=null&&wee(s.centroid,s.centroid,r,n,e);return t.transform=null,t}function $xt(t,e){const{geometryType:i,features:r,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new Sy,bee(l.geometry,a.geometry,n,s,i,t),a.centroid&&(l.centroid=new Sy,bee(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),r[o]=l}return e.transform=t,e}function bee(t,e,i,r,n,s,o=i,a=r){if(wg(t),e==null||!e.coords.length)return null;const l=Vye[n],{coords:c,lengths:u}=e,p=Pa(i,r),f=Pa(i&&o,r&&a),y=QW(i,r,o,a);if(!u.length)return y(t.coords,c,0,0,Ek(s,c[0]),Ak(s,c[1])),wg(t,p,0),t;let v,b,x,S,P=0,C=0,R=C;for(const N of u){if(N<l)continue;let $=0;C=R,x=v=Ek(s,c[P]),S=b=Ak(s,c[P+1]),y(t.coords,c,C,P,x,S),$++,P+=p,C+=f;for(let k=1;k<N;k++,P+=p)x=Ek(s,c[P]),S=Ak(s,c[P+1]),x===v&&S===b||(y(t.coords,c,C,P,x-v,S-b),C+=f,$++,v=x,b=S);$>=l&&(t.lengths.push($),R=C)}return _p(t.coords,R),t.coords.length?t:null}function Ixt(t,e,i,r,n,s,o=i,a=r){if(wg(t),!e||!e.coords.length)return null;const l=Vye[n],{coords:c,lengths:u}=e,p=Pa(i,r),f=Pa(i&&o,r&&a),y=QW(i,r,o,a);if(!u.length)return y(t.coords,c,0,0,c[0],c[1]),wg(t,p,0),t;let v=0;const b=s*s;for(const x of u){if(x<l){v+=x*p;continue}const S=t.coords.length/f,P=v,C=v+(x-1)*p;y(t.coords,c,t.coords.length,P,c[P],c[P+1]),V7(t.coords,c,p,b,y,P,C),y(t.coords,c,t.coords.length,C,c[C],c[C+1]);const R=t.coords.length/f-S;R>=l?t.lengths.push(R):_p(t.coords,S*f),v+=x*p}return t.coords.length?t:null}function lWe(t,e,i,r){const n=t[e],s=t[e+1],o=t[i],a=t[i+1],l=t[r],c=t[r+1];let u=o,p=a,f=l-u,y=c-p;if(f!==0||y!==0){const v=((n-u)*f+(s-p)*y)/(f*f+y*y);v>1?(u=l,p=c):v>0&&(u+=f*v,p+=y*v)}return f=n-u,y=s-p,f*f+y*y}function V7(t,e,i,r,n,s,o){let a,l=r,c=0;for(let u=s+i;u<o;u+=i)a=lWe(e,u,s,o),a>l&&(c=u,l=a);l>r&&(c-s>i&&V7(t,e,i,r,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>i&&V7(t,e,i,r,n,c,o))}function Lxt(t,e,i,r){if(e==null||!e.coords||!e.coords.length)return null;const n=Pa(i,r);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=n){const p=c[u],f=c[u+1];s=Math.min(s,p),a=Math.max(a,p),o=Math.min(o,f),l=Math.max(l,f)}}return $9(t)?URe(t,s,o,a,l):$G(s,o,a,l,t),t}function wee(t,e,i,r,n){const{coords:s,lengths:o}=e,a=Pa(i,r);if(!s.length)return t!==e&&wg(t),t;HN(n);const{originPosition:l,scale:c,translate:u}=n,p=uWe;p.originPosition=l;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const y=p.translate;if(y[0]=u[0]??0,y[1]=u[1]??0,y[2]=u[2]??0,y[3]=u[3]??0,!o.length){for(let b=0;b<a;++b)t.coords[b]=Pk(p,s[b],b);return t!==e&&wg(t,a,0),t}let v=0;for(let b=0;b<o.length;b++){const x=o[b];t.lengths[b]=x;for(let C=0;C<a;++C)t.coords[v+C]=Pk(p,s[v+C],C);let S=t.coords[v],P=t.coords[v+1];v+=a;for(let C=1;C<x;C++,v+=a){S+=s[v]*f[0],P+=s[v+1]*f[1],t.coords[v]=S,t.coords[v+1]=P;for(let R=2;R<a;++R)t.coords[v+R]=Pk(p,s[v+R],R)}}return t!==e&&wg(t,s.length,o.length),t}function Dxt(t,e,i,r,n,s){if(wg(t),t.lengths.push(...e.lengths),i===n&&r===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Pa(i,r),a=QW(i,r,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function cWe(t,e,i,r){let n=0,s=t[r*e],o=t[r*(e+1)];for(let a=1;a<i;a++){const l=s+t[r*(e+a)],c=o+t[r*(e+a)+1],u=(l-s)*(c+o);s=l,o=c,n+=u}return .5*n}function Nxt(t,e){const{coords:i,lengths:r}=t;let n=0,s=0;for(let o=0;o<r.length;o++){const a=r[o];s+=cWe(i,n,a,e),n+=a}return Math.abs(s)}function wg(t,e=0,i=0){_p(t.lengths,i),_p(t.coords,e)}function _p(t,e=0){t.length!==e&&(t.length=e)}const uWe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},xee=new ea(Array,t=>v5(t,jue),null,10,5),hWe=li();let dWe=class{get labelLayers(){return this._labelLayers||eSe}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,i,r,n,s){this.graphic=e,this.graphics3DSymbol=i,this.layers=r,this._visibleFlags=Qo.ALL_LABEL,this.deconflictionPriority=0,++i.referenced,this._featureExpressionFeature=s?fye(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(i=>{i.initialize(e),i.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,i){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(i),e.setVisibility(this.isVisible(co.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(e=!0)}),e}isVisible(e=co.GRAPHIC,i){const r=i?this._visibleFlags|i|co.LABEL*i:this._visibleFlags;return e===co.GRAPHIC?(r&Qo.ALL_GRAPHIC)===Qo.ALL_GRAPHIC:(r&Qo.ALL_LABEL)===Qo.ALL_LABEL}setVisibilityFlag(e,i,r){const n=this.isVisible(e);r?this._visibleFlags|=e*i:this._visibleFlags&=~(e*i);const s=this.isVisible(e);if(n===s)return!1;if(e===co.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(co.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,i){return(this._visibleFlags&e*i)!=0}computeExtent(e){if(!this._extent){const i=this.graphic.geometry;if(i==null)return!1;this._extent=li(),wje(i,this._extent);const r=i.spatialReference;if(!go(r,e)&&!V3(this._extent,r,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,i){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,i)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,i,r){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=zb.fromExtent(n.type==="mesh"?n.extent:n)),sWe(n,i,r)}get usedMemory(){let e=U_e(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(r==null)return;const n=i.type==="draped"?r.memory.draped:r.memory;e+=n.bytesPerFeature,n.bytesPerCoordinate&&(e+=bje(this.graphic.geometry)*n.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:I(),num:0},draped:{origin:it(),num:0}};for(const i of this.layers)i!=null&&i.computeAttachmentOrigin(e);return e.render.num>1&&pe(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&gc(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,i,r,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?Gr(s.boundingBox):s.boundingBox=Gr(),s.requiresDrapedElevation=!1,await Y5(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?i:e,l=xee.acquire(),c=await o.getProjectedBoundingBox(a,r,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&_T(s.boundingBox,l),xee.release(l)}),FRe(s.boundingBox)||z8(uj(s.boundingBox,hWe))?s:null}needsElevationUpdates(){var e;for(const i of this.layers)if(i!=null&&(i.type==="object3d"||i.type==="lod-instance")&&i.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(i=>(i==null?void 0:i.needsElevationUpdates)??!1))??!1}alignWithElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,i,this._featureExpressionFeature,r)})}alignWithAbsoluteElevation(e,i,r){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,i,r)})}addObjectStateSet(e,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(e,i))}removeObjectState(e){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(e))}_forEachGraphicList(e,i){e==null||e.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:i=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(i)}}}},kxt=class{constructor(e,i){this.scheduler=e,this.schedule=i,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},pWe=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var Tee,See,Cee,G7={exports:{}};G7.exports,Tee=G7,See=function(){function t(U,V,H){H=H||2;var Y,ie,le,ue,ve,Ie,Ve,Mt=V&&V.length,ot=Mt?V[0]*H:U.length,Pt=e(U,0,ot,H,!0),qe=[];if(!Pt||Pt.next===Pt.prev)return qe;if(Mt&&(Pt=l(U,V,Pt,H)),U.length>80*H){Y=le=U[0],ie=ue=U[1];for(var Ee=H;Ee<ot;Ee+=H)(ve=U[Ee])<Y&&(Y=ve),(Ie=U[Ee+1])<ie&&(ie=Ie),ve>le&&(le=ve),Ie>ue&&(ue=Ie);Ve=(Ve=Math.max(le-Y,ue-ie))!==0?1/Ve:0}return r(Pt,qe,H,Y,ie,Ve),qe}function e(U,V,H,Y,ie){var le,ue;if(ie===oe(U,V,H,Y)>0)for(le=V;le<H;le+=Y)ue=ae(le,U[le],U[le+1],ue);else for(le=H-Y;le>=V;le-=Y)ue=ae(le,U[le],U[le+1],ue);if(ue&&N(ue,ue.next)){var ve=ue.next;re(ue),ue=ve}return ue}function i(U,V){if(!U)return U;V||(V=U);var H,Y=U;do if(H=!1,Y.steiner||!N(Y,Y.next)&&R(Y.prev,Y,Y.next)!==0)Y=Y.next;else{var ie=Y.prev;if(re(Y),(Y=V=ie)===Y.next)break;H=!0}while(H||Y!==V);return V}function r(U,V,H,Y,ie,le,ue){if(U){!ue&&le&&v(U,Y,ie,le);for(var ve,Ie,Ve=U;U.prev!==U.next;)if(ve=U.prev,Ie=U.next,le?s(U,Y,ie,le):n(U))V.push(ve.i/H),V.push(U.i/H),V.push(Ie.i/H),re(U),U=Ie.next,Ve=Ie.next;else if((U=Ie)===Ve){ue?ue===1?r(U=o(i(U),V,H),V,H,Y,ie,le,2):ue===2&&a(U,V,H,Y,ie,le):r(i(U),V,H,Y,ie,le,1);break}}}function n(U){var V=U.prev,H=U,Y=U.next;if(R(V,H,Y)>=0)return!1;for(var ie=U.next.next;ie!==U.prev;){if(P(V.x,V.y,H.x,H.y,Y.x,Y.y,ie.x,ie.y)&&R(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function s(U,V,H,Y){var ie=U.prev,le=U,ue=U.next;if(R(ie,le,ue)>=0)return!1;for(var ve=ie.x<le.x?ie.x<ue.x?ie.x:ue.x:le.x<ue.x?le.x:ue.x,Ie=ie.y<le.y?ie.y<ue.y?ie.y:ue.y:le.y<ue.y?le.y:ue.y,Ve=ie.x>le.x?ie.x>ue.x?ie.x:ue.x:le.x>ue.x?le.x:ue.x,Mt=ie.y>le.y?ie.y>ue.y?ie.y:ue.y:le.y>ue.y?le.y:ue.y,ot=x(ve,Ie,V,H,Y),Pt=x(Ve,Mt,V,H,Y),qe=U.prevZ,Ee=U.nextZ;qe&&qe.z>=ot&&Ee&&Ee.z<=Pt;){if(qe!==U.prev&&qe!==U.next&&P(ie.x,ie.y,le.x,le.y,ue.x,ue.y,qe.x,qe.y)&&R(qe.prev,qe,qe.next)>=0||(qe=qe.prevZ,Ee!==U.prev&&Ee!==U.next&&P(ie.x,ie.y,le.x,le.y,ue.x,ue.y,Ee.x,Ee.y)&&R(Ee.prev,Ee,Ee.next)>=0))return!1;Ee=Ee.nextZ}for(;qe&&qe.z>=ot;){if(qe!==U.prev&&qe!==U.next&&P(ie.x,ie.y,le.x,le.y,ue.x,ue.y,qe.x,qe.y)&&R(qe.prev,qe,qe.next)>=0)return!1;qe=qe.prevZ}for(;Ee&&Ee.z<=Pt;){if(Ee!==U.prev&&Ee!==U.next&&P(ie.x,ie.y,le.x,le.y,ue.x,ue.y,Ee.x,Ee.y)&&R(Ee.prev,Ee,Ee.next)>=0)return!1;Ee=Ee.nextZ}return!0}function o(U,V,H){var Y=U;do{var ie=Y.prev,le=Y.next.next;!N(ie,le)&&$(ie,Y,Y.next,le)&&Z(ie,le)&&Z(le,ie)&&(V.push(ie.i/H),V.push(Y.i/H),V.push(le.i/H),re(Y),re(Y.next),Y=U=le),Y=Y.next}while(Y!==U);return i(Y)}function a(U,V,H,Y,ie,le){var ue=U;do{for(var ve=ue.next.next;ve!==ue.prev;){if(ue.i!==ve.i&&C(ue,ve)){var Ie=X(ue,ve);return ue=i(ue,ue.next),Ie=i(Ie,Ie.next),r(ue,V,H,Y,ie,le),void r(Ie,V,H,Y,ie,le)}ve=ve.next}ue=ue.next}while(ue!==U)}function l(U,V,H,Y){var ie,le,ue,ve=[];for(ie=0,le=V.length;ie<le;ie++)(ue=e(U,V[ie]*Y,ie<le-1?V[ie+1]*Y:U.length,Y,!1))===ue.next&&(ue.steiner=!0),ve.push(S(ue));for(ve.sort(c),ie=0;ie<ve.length;ie++)H=i(H=p(ve[ie],H),H.next);return H}function c(U,V){return U.x-V.x}function u(U){if(U.next.prev===U)return U;let V=U;for(;;){const H=V.next;if(H.prev===V||H===V||H===U)break;V=H}return V}function p(U,V){var H=f(U,V);if(!H)return V;var Y=X(H,U),ie=i(H,H.next);let le=u(Y);return i(le,le.next),ie=u(ie),u(V===H?ie:V)}function f(U,V){var H,Y=V,ie=U.x,le=U.y,ue=-1/0;do{if(le<=Y.y&&le>=Y.next.y&&Y.next.y!==Y.y){var ve=Y.x+(le-Y.y)*(Y.next.x-Y.x)/(Y.next.y-Y.y);if(ve<=ie&&ve>ue){if(ue=ve,ve===ie){if(le===Y.y)return Y;if(le===Y.next.y)return Y.next}H=Y.x<Y.next.x?Y:Y.next}}Y=Y.next}while(Y!==V);if(!H)return null;if(ie===ue)return H;var Ie,Ve=H,Mt=H.x,ot=H.y,Pt=1/0;Y=H;do ie>=Y.x&&Y.x>=Mt&&ie!==Y.x&&P(le<ot?ie:ue,le,Mt,ot,le<ot?ue:ie,le,Y.x,Y.y)&&(Ie=Math.abs(le-Y.y)/(ie-Y.x),Z(Y,U)&&(Ie<Pt||Ie===Pt&&(Y.x>H.x||Y.x===H.x&&y(H,Y)))&&(H=Y,Pt=Ie)),Y=Y.next;while(Y!==Ve);return H}function y(U,V){return R(U.prev,U,V.prev)<0&&R(V.next,U,U.next)<0}function v(U,V,H,Y){var ie=U;do ie.z===null&&(ie.z=x(ie.x,ie.y,V,H,Y)),ie.prevZ=ie.prev,ie.nextZ=ie.next,ie=ie.next;while(ie!==U);ie.prevZ.nextZ=null,ie.prevZ=null,b(ie)}function b(U){var V,H,Y,ie,le,ue,ve,Ie,Ve=1;do{for(H=U,U=null,le=null,ue=0;H;){for(ue++,Y=H,ve=0,V=0;V<Ve&&(ve++,Y=Y.nextZ);V++);for(Ie=Ve;ve>0||Ie>0&&Y;)ve!==0&&(Ie===0||!Y||H.z<=Y.z)?(ie=H,H=H.nextZ,ve--):(ie=Y,Y=Y.nextZ,Ie--),le?le.nextZ=ie:U=ie,ie.prevZ=le,le=ie;H=Y}le.nextZ=null,Ve*=2}while(ue>1);return U}function x(U,V,H,Y,ie){return(U=1431655765&((U=858993459&((U=252645135&((U=16711935&((U=32767*(U-H)*ie)|U<<8))|U<<4))|U<<2))|U<<1))|(V=1431655765&((V=858993459&((V=252645135&((V=16711935&((V=32767*(V-Y)*ie)|V<<8))|V<<4))|V<<2))|V<<1))<<1}function S(U){var V=U,H=U;do(V.x<H.x||V.x===H.x&&V.y<H.y)&&(H=V),V=V.next;while(V!==U);return H}function P(U,V,H,Y,ie,le,ue,ve){return(ie-ue)*(V-ve)-(U-ue)*(le-ve)>=0&&(U-ue)*(Y-ve)-(H-ue)*(V-ve)>=0&&(H-ue)*(le-ve)-(ie-ue)*(Y-ve)>=0}function C(U,V){return U.next.i!==V.i&&U.prev.i!==V.i&&!W(U,V)&&(Z(U,V)&&Z(V,U)&&K(U,V)&&(R(U.prev,U,V.prev)||R(U,V.prev,V))||N(U,V)&&R(U.prev,U,U.next)>0&&R(V.prev,V,V.next)>0)}function R(U,V,H){return(V.y-U.y)*(H.x-V.x)-(V.x-U.x)*(H.y-V.y)}function N(U,V){return U.x===V.x&&U.y===V.y}function $(U,V,H,Y){var ie=B(R(U,V,H)),le=B(R(U,V,Y)),ue=B(R(H,Y,U)),ve=B(R(H,Y,V));return ie!==le&&ue!==ve||!(ie!==0||!k(U,H,V))||!(le!==0||!k(U,Y,V))||!(ue!==0||!k(H,U,Y))||!(ve!==0||!k(H,V,Y))}function k(U,V,H){return V.x<=Math.max(U.x,H.x)&&V.x>=Math.min(U.x,H.x)&&V.y<=Math.max(U.y,H.y)&&V.y>=Math.min(U.y,H.y)}function B(U){return U>0?1:U<0?-1:0}function W(U,V){var H=U;do{if(H.i!==U.i&&H.next.i!==U.i&&H.i!==V.i&&H.next.i!==V.i&&$(H,H.next,U,V))return!0;H=H.next}while(H!==U);return!1}function Z(U,V){return R(U.prev,U,U.next)<0?R(U,V,U.next)>=0&&R(U,U.prev,V)>=0:R(U,V,U.prev)<0||R(U,U.next,V)<0}function K(U,V){var H=U,Y=!1,ie=(U.x+V.x)/2,le=(U.y+V.y)/2;do H.y>le!=H.next.y>le&&H.next.y!==H.y&&ie<(H.next.x-H.x)*(le-H.y)/(H.next.y-H.y)+H.x&&(Y=!Y),H=H.next;while(H!==U);return Y}function X(U,V){var H=new ee(U.i,U.x,U.y),Y=new ee(V.i,V.x,V.y),ie=U.next,le=V.prev;return U.next=V,V.prev=U,H.next=ie,ie.prev=H,Y.next=H,H.prev=Y,le.next=Y,Y.prev=le,Y}function ae(U,V,H,Y){var ie=new ee(U,V,H);return Y?(ie.next=Y.next,ie.prev=Y,Y.next.prev=ie,Y.next=ie):(ie.prev=ie,ie.next=ie),ie}function re(U){U.next.prev=U.prev,U.prev.next=U.next,U.prevZ&&(U.prevZ.nextZ=U.nextZ),U.nextZ&&(U.nextZ.prevZ=U.prevZ)}function ee(U,V,H){this.i=U,this.x=V,this.y=H,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function oe(U,V,H,Y){for(var ie=0,le=V,ue=H-Y;le<H;le+=Y)ie+=(U[ue]-U[le])*(U[le+1]+U[ue+1]),ue=le;return ie}return t.deviation=function(U,V,H,Y){var ie=V&&V.length,le=ie?V[0]*H:U.length,ue=Math.abs(oe(U,0,le,H));if(ie)for(var ve=0,Ie=V.length;ve<Ie;ve++){var Ve=V[ve]*H,Mt=ve<Ie-1?V[ve+1]*H:U.length;ue-=Math.abs(oe(U,Ve,Mt,H))}var ot=0;for(ve=0;ve<Y.length;ve+=3){var Pt=Y[ve]*H,qe=Y[ve+1]*H,Ee=Y[ve+2]*H;ot+=Math.abs((U[Pt]-U[Ee])*(U[qe+1]-U[Pt+1])-(U[Pt]-U[qe])*(U[Ee+1]-U[Pt+1]))}return ue===0&&ot===0?0:Math.abs((ot-ue)/ue)},t.flatten=function(U){for(var V=U[0][0].length,H={vertices:[],holes:[],dimensions:V},Y=0,ie=0;ie<U.length;ie++){for(var le=0;le<U[ie].length;le++)for(var ue=0;ue<V;ue++)H.vertices.push(U[ie][le][ue]);ie>0&&(Y+=U[ie-1].length,H.holes.push(Y))}return H},t},(Cee=See())!==void 0&&(Tee.exports=Cee);const WT=J3(G7.exports),L4=ye.getLogger("esri.views.3d.support.buffer.math");function fWe(t,e,i){qT(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function qT(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return L4.error("source and destination buffers need to have the same number of elements"),t;const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[4],u=i[5],p=i[6],f=i[8],y=i[9],v=i[10],b=i[12],x=i[13],S=i[14];let P=0,C=0;for(let R=0;R<s;R++){const N=e[P],$=e[P+1],k=e[P+2];t[C]=o*N+c*$+f*k+b,t[C+1]=a*N+u*$+y*k+x,t[C+2]=l*N+p*$+v*k+S,P+=n,C+=r}return t}function Kye(t,e,i){Pb(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Pb(t,e,i,r=3,n=r){if(t.length/r!==Math.ceil(e.length/n))return void L4.error("source and destination buffers need to have the same number of elements");const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],p=i[5],f=i[6],y=i[7],v=i[8];let b=0,x=0;for(let S=0;S<s;S++){const P=e[b],C=e[b+1],R=e[b+2];t[x]=o*P+c*C+f*R,t[x+1]=a*P+u*C+y*R,t[x+2]=l*P+p*C+v*R,b+=n,x+=r}}function mWe(t,e,i){tN(t.typedBuffer,e,i,t.typedBufferStride)}function tN(t,e,i,r=3){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=i*s[a],t[l+1]=i*s[a+1],t[l+2]=i*s[a+2],a+=o,l+=r}function gWe(t,e){D4(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function D4(t,e,i=3,r=i){const n=Math.min(t.length/i,e.length/r);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],u=e[s+2],p=l*l+c*c+u*u;if(p>0){const f=1/Math.sqrt(p);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*u}s+=r,o+=i}}function _We(t,e,i){const r=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<r;u++)n[c]=o[l]>>i,n[c+1]=o[l+1]>>i,n[c+2]=o[l+2]>>i,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:D4,normalizeView:gWe,scale:tN,scaleView:mWe,shiftRight:_We,transformMat3:Pb,transformMat3View:Kye,transformMat4:qT,transformMat4View:fWe},Symbol.toStringTag,{value:"Module"}));function yWe(t,e,i){return{objectId:t,target:e,distance:i,type:"vertex"}}function Eee(t,e,i,r,n,s=!1){return{objectId:t,target:e,distance:i,type:"edge",start:r,end:n,draped:s}}var xg,ga;function vWe(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function r3(t){return t!=null&&!isNaN(t)&&isFinite(t)}function bWe(t){return t.valueExpression?xg.Expression:t.field&&typeof t.field=="string"?xg.Field:xg.Unknown}function Bxt(t,e){const i=e||bWe(t),r=t.valueUnit||"unknown";return i===xg.Unknown?ga.Constant:t.stops?ga.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?ga.ClampedLinear:r==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?ga.Proportional:ga.Additive:ga.Identity:ga.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(xg||(xg={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(ga||(ga={}));const Cy=ye.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),Aee=new gb,qI=Math.PI,wWe=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function Qye(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(v=>v.type==="color"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void Cy.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let p=r.cache.compiledFunc;if(!l&&!u){const v=r.stops;return v&&v[0]&&v[0].color}if(typeof a!="number")if(u){if(i==null||i.arcade==null)return void Cy.error("Use of arcade expressions requires an arcade context");const v={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,x=b.getViewInfo(v),S=b.createExecContext(s,x);if(!p){const P=b.createSyntaxTree(r.valueExpression);p=b.createFunction(P),r.cache.compiledFunc=p}a=b.executeFunction(p,S)}else o&&(a=o[l]);const f=r.normalizationField,y=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(y)&&y!==0)){isNaN(y)||n||(a/=y);const v=sq(a,c);if(v){const b=v[0],x=v[1],S=b===x?r.stops[b].color:Lt.blendColors(r.stops[b].color,r.stops[x].color,v[2],i!=null?i.color:void 0);return new Lt(S)}}}function eve(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(v=>v.type==="opacity"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void Cy.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=r.field,{ipData:c,hasExpression:u}=r.cache;let p=r.cache.compiledFunc;if(!l&&!u){const v=r.stops;return v&&v[0]&&v[0].opacity}if(typeof a!="number")if(u){if(i==null||i.arcade==null)return void Cy.error("Use of arcade expressions requires an arcade context");const v={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,x=b.getViewInfo(v),S=b.createExecContext(s,x);if(!p){const P=b.createSyntaxTree(r.valueExpression);p=b.createFunction(P),r.cache.compiledFunc=p}a=b.executeFunction(p,S)}else o&&(a=o[l]);const f=r.normalizationField,y=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(y)&&y!==0)){isNaN(y)||n||(a/=y);const v=sq(a,c);if(v){const b=v[0],x=v[1];if(b===x)return r.stops[b].opacity;{const S=r.stops[b].opacity;return S+(r.stops[x].opacity-S)*v[2]}}}}function tve(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(y=>y.type==="rotation"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void Cy.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=r.axis||"heading",s=n==="heading"&&r.rotationType==="arithmetic"?90:0,o=n==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=r.field,{hasExpression:u}=r.cache;let p=r.cache.compiledFunc,f=0;if(!c&&!u)return f;if(u){if(i==null||i.arcade==null)return void Cy.error("Use of arcade expressions requires an arcade context");const y={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,b=v.getViewInfo(y),x=v.createExecContext(a,b);if(!p){const S=v.createSyntaxTree(r.valueExpression);p=v.createFunction(S),r.cache.compiledFunc=p}f=v.executeFunction(p,x)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:s+o*f,f}function xWe(t,e,i){const r=typeof e=="number",n=r?null:e,s=n&&n.attributes;let o=r?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=i!=null?i.scale:void 0,p=i!=null?i.view:void 0;o=u==null||p==="3d"?TWe(t):u}else if(!r)switch(t.inputValueType){case xg.Expression:{if(i==null||i.arcade==null)return void Cy.error("Use of arcade expressions requires an arcade context");const u={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,f=p.getViewInfo(u),y=p.createExecContext(n,f);if(!l){const v=p.createSyntaxTree(t.valueExpression);l=p.createFunction(v),t.cache.compiledFunc=l}o=p.executeFunction(l,y);break}case xg.Field:s&&(o=s[t.field]);break;case xg.Unknown:o=null}if(!r3(o))return null;if(r||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return r3(c)&&c!==0?o/c:null}function TWe(t){let e=null,i=null;const r=t.stops;return r?(e=r[0].value,i=r[r.length-1].value):(e=t.minDataValue||0,i=t.maxDataValue||0),(e+i)/2}function N4(t,e,i){const r="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void Cy.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=rve(xWe(r,e,i),r,e,i,r.cache.ipData);return n==null||isNaN(n)?0:n}function Sc(t,e,i){return t==null?null:vWe(t)?N4(t,e,i):r3(t)?t:null}function ive(t,e,i){return r3(i)&&t>i?i:r3(e)&&t<e?e:t}function SWe(t,e,i,r){return t+((Sc(e.minSize,i,r)||e.minDataValue)??0)}function CWe(t,e,i){const r=t.stops;let n=r&&r.length&&r[0].size;return n==null&&(n=t.minSize),Sc(n,e,i)}function EWe(t,e,i,r){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=Sc(e.minSize,i,r),o=Sc(e.maxSize,i,r),a=r!=null?r.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?qI*(s/2)**2:s*s,u=c+n*((l?qI*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/qI):Math.sqrt(u)}return s+n*(o-s)}function AWe(t,e,i,r){const n=r!=null?r.shape:void 0,s=t/e.minDataValue,o=Sc(e.minSize,i,r),a=Sc(e.maxSize,i,r);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,ive(l,o,a)}function PWe(t,e,i,r,n){var l,c,u;const[s,o,a]=sq(t,n);if(s===o)return Sc((l=e.stops)==null?void 0:l[s].size,i,r);{const p=Sc((c=e.stops)==null?void 0:c[s].size,i,r);return p+(Sc((u=e.stops)==null?void 0:u[o].size,i,r)-p)*a}}function OWe(t,e,i,r){const n=(r!=null&&r.resolution?r.resolution:1)*BT[e.valueUnit],s=Sc(e.minSize,i,r),o=Sc(e.maxSize,i,r),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/qI)/n:a==="radius"||a==="distance"?2*t/n:t/n,ive(l,s,o)}function rve(t,e,i,r,n){switch(e.transformationType){case ga.Additive:return SWe(t,e,i,r);case ga.Constant:return CWe(e,i,r);case ga.ClampedLinear:return EWe(t,e,i,r);case ga.Proportional:return AWe(t,e,i,r);case ga.Stops:return PWe(t,e,i,r,n);case ga.RealWorldSize:return OWe(t,e,i,r);case ga.Identity:return t;case ga.Unknown:return null}}function RWe(t,e,i){const{isScaleDriven:r}=t.cache;if(!(r&&i==="3d"||e))return null;const n={scale:e,view:i};let s=Sc(t.minSize,Aee,n),o=Sc(t.maxSize,Aee,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function nq(t,e,i){if(!t.visualVariables)return;const r=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=Qye(l,e,i);r.push({variable:l,value:c})}),s.forEach(l=>{const c=eve(l,e,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=tve(l,e,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=N4(l,e,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function sq(t,e){if(!e)return;let i=0,r=e.length-1;return e.some((n,s)=>t<n?(r=s,!0):(i=s,!1)),[i,r,(t-e[i])/(e[r]-e[i])]}function MWe(t,e,i){const r=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":N4(n,e,i);switch(n.axis){case"width":r[0]=s;break;case"depth":r[1]=s;break;case"height":r[2]=s;break;case"width-and-depth":r[0]=s,r[1]=s;break;case"all":case void 0:case null:r[0]=s,r[1]=s,r[2]=s;break;default:n.axis}}return r}const Vxt=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:MWe,getColor:Qye,getOpacity:eve,getRotationAngle:tve,getSize:N4,getSizeForValue:rve,getSizeFromNumberOrVariable:Sc,getSizeRangeAtScale:RWe,getVisualVariableValues:nq,viewScaleRE:wWe},Symbol.toStringTag,{value:"Module"}));function F4(t,e){if(!t||t.symbol)return null;const i=e&&e.renderer;return t&&i!=null&&i.getObservationRenderer?i.getObservationRenderer(t):i}function $We(t,e){if(t.symbol!=null)return t.symbol;const i=F4(t,e);return i!=null&&i.type!=="dot-density"?i.getSymbol(t,e):null}function Gxt(t,e){const i=F4(t,e),r=$We(t,e);if(r==null)return null;const n={renderer:i,symbol:r};if(i==null||!("visualVariables"in i)||!i.visualVariables)return n;const s=nq(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function IWe(t,e){if(t.symbol!=null)return t.symbol;const i=F4(t,e);return i!=null?i.getSymbolAsync(t,e):null}async function jxt(t,e){const i=F4(t,e),r=await IWe(t,e);if(!r)return null;const n={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return n;const s=nq(i,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=Lt.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function LWe(t,e=0){const i=t[e];return typeof i=="number"&&isFinite(i)?i:null}function DWe(t){for(let e=0;e<3;e++){const i=t[e];if(typeof i=="number")return isFinite(i)?i:0}return 0}function Pee(t){const e=[[M.POSITION,t.indices]],i=[[M.POSITION,new nt(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(i.push([M.COLORFEATUREATTRIBUTE,new nt([t.attributeData.colorFeature],1,!0)]),e.push([M.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(i.push([M.COLOR,new nt(t.attributeData.color,4,!0)]),e.push([M.COLOR,bS(t.indices.length)])),t.attributeData.uvMapSpace&&(i.push([M.UVMAPSPACE,new nt(t.attributeData.uvMapSpace,4,!0)]),e.push([M.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(i.push([M.BOUNDINGRECT,new nt(t.attributeData.boundingRect,9,!0)]),e.push([M.BOUNDINGRECT,t.indices])),new fs(t.material,i,e,t.mapPositions,An.Mesh,t.attributeData.objectAndLayerIdColor)}function Oee(t,e=null){const i=[[M.POSITION,t.indices],[M.UV0,t.indices]],r=[[M.POSITION,new nt(t.attributeData.position,3,!0)],[M.UV0,new nt(t.attributeData.uv0,2,!0)]];return new fs(t.material,r,i,t.mapPositions,An.Mesh,e)}function n3(t){switch(t.type){case"extent":if(t instanceof Ar)return zb.fromExtent(t);break;case"polygon":return t}return null}let k4=class{constructor(e,i,r){this.renderData=e,this.layerUid=i,this.graphicUid=r,this.outGeometries=new Array}};function j7(t,e,i){const r=Array.isArray(t),n=r?t.length/e:t.byteLength/(4*e),s=r?t:new Uint32Array(t,0,n*e),o=(i==null?void 0:i.minReduction)??0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let u=0;if(c)for(let $=0;$<c.length-1;$++){const k=c[$+1]-c[$];k>u&&(u=k)}else u=n;const p=Math.floor(1.1*u)+1;(Lp==null||Lp.length<2*p)&&(Lp=new Uint32Array(wEe(2*p)));for(let $=0;$<2*p;$++)Lp[$]=0;let f=0;const y=!!c&&!!a,v=y?l:n;let b=RD(n);const x=new Uint32Array(l),S=1.96;let P=o!==0?Math.ceil(4*S*S/(o*o)*o*(1-o)):v,C=1,R=c?c[1]:v;for(let $=0;$<v;$++){if($===P){const X=1-f/$;if(X+S*Math.sqrt(X*(1-X)/$)<o)return null;P*=2}if($===R){for(let X=0;X<2*p;X++)Lp[X]=0;if(a)for(let X=c[C-1];X<c[C];X++)x[X]=b[a[X]];R=c[++C]}const k=y?a[$]:$,B=k*e,W=kWe(s,B,e);let Z=W%p,K=f;for(;Lp[2*Z+1]!==0;){if(Lp[2*Z]===W){const X=Lp[2*Z+1]-1;if(NWe(s,B,X*e,e)){K=b[X];break}}Z++,Z>=p&&(Z-=p)}K===f&&(Lp[2*Z]=W,Lp[2*Z+1]=k+1,f++),b[k]=K}if(o!==0&&1-f/n<o)return null;if(y){for(let $=c[C-1];$<x.length;$++)x[$]=b[a[$]];b=Uf(x)}const N=r?new Array(f):new Uint32Array(f*e);f=0;for(let $=0;$<v;$++)b[$]===f&&(FWe(s,(y?a[$]:$)*e,N,f*e,e),f++);if(a&&!y){const $=new Uint32Array(l);for(let k=0;k<$.length;k++)$[k]=b[a[k]];b=Uf($)}return{buffer:Array.isArray(N)?N:N.buffer,indices:b,uniqueCount:f}}function NWe(t,e,i,r){for(let n=0;n<r;n++)if(t[e+n]!==t[i+n])return!1;return!0}function FWe(t,e,i,r,n){for(let s=0;s<n;s++)i[r+s]=t[e+s]}function kWe(t,e,i){let r=0;for(let n=0;n<i;n++)r=t[e+n]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let Lp=null;function Wxt(t){const e=lO(t.rings,t.hasZ,Yf.CCW_IS_HOLE),i=new Array;let r=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Ih(e.position,3*c,3*l),p=a.holeIndices.map(y=>y-c),f=Uf(WT(u,p,3));i.push({position:u,faces:f}),r+=u.length,n+=f.length}const s=UWe(i,r,n),o=Array.isArray(s.position)?j7(s.position,3,{originalIndices:s.faces}):j7(s.position.buffer,6,{originalIndices:s.faces});return s.position=oge(new Float64Array(o.buffer)),s.faces=o.indices,s}function UWe(t,e,i){if(t.length===1)return t[0];const r=ia(e),n=new Array(i);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)r[s++]=l.position[c];for(const c of l.faces)n[o++]=c+a;a=s/3}return{position:r,faces:Uf(n)}}function lO(t,e,i){const r=t.length,n=new Array(r),s=new Array(r),o=new Array(r);let a=0,l=0,c=0,u=0;for(let y=0;y<r;++y)u+=t[y].length;const p=ia(3*u);let f=0;for(let y=r-1;y>=0;y--){const v=t[y],b=i===Yf.CCW_IS_HOLE&&zWe(v);if(b&&r!==1)n[a++]=v;else{let x=v.length;for(let P=0;P<a;++P)x+=n[P].length;const S={index:f,pathLengths:new Array(a+1),count:x,holeIndices:new Array(a)};S.pathLengths[0]=v.length,v.length>0&&(o[c++]={index:f,count:v.length}),f=b?PM(v,v.length-1,-1,p,f,v.length,e):PM(v,0,1,p,f,v.length,e);for(let P=0;P<a;++P){const C=n[P];S.holeIndices[P]=f,S.pathLengths[P+1]=C.length,C.length>0&&(o[c++]={index:f,count:C.length}),f=PM(C,0,1,p,f,C.length,e)}a=0,S.count>0&&(s[l++]=S)}}for(let y=0;y<a;++y){const v=n[y];v.length>0&&(o[c++]={index:f,count:v.length}),f=PM(v,0,1,p,f,v.length,e)}return s.length=l,o.length=c,{position:p,polygons:s,outlines:o}}function PM(t,e,i,r,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];r[n++]=l[0],r[n++]=l[1],r[n++]=o?l[2]:0,e+=i}return n/3}function zWe(t){return!Ile(t,!1,!1)}var Yf;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Yf||(Yf={}));var eP,iN,H7;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(eP||(eP={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(iN||(iN={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(H7||(H7={}));let nve=class{constructor(e,i){this._fbo=null;const r=new Di;r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=qt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=i,r.maxAnisotropy=8,this._fbo=new Rs(e,r)}dispose(){this._fbo=et(this._fbo)}getTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}isValid(){return this._fbo!=null}resize(e,i){var r;(r=this._fbo)==null||r.resize(e,i)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){var i;const e=(i=this._fbo)==null?void 0:i.colorTexture;e!=null&&e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},qw=class{constructor(e,i,r,n=!0){this.output=i,this.type=r,this.valid=!1,this.lastUsed=1/0,this.fbo=new nve(e,n)}},BWe=class{constructor(e){this.renderTargets=[new qw(e,j.Color,xn.Color),new qw(e,j.Color,xn.ColorNoRasterImage),new qw(e,j.Highlight,xn.Highlight,!1),new qw(e,j.Normal,xn.Water),new qw(e,j.Color,xn.Occluded)],ge("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new qw(e,j.ObjectAndLayerIdColor,xn.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,i,r){return e?(i.lastUsed=r,!1):r-i.lastUsed>VWe?(i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0,!1):i.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,i)=>e+i.fbo.gpuMemoryUsage,0)}};const VWe=1e3;let sve=class extends wr{constructor(){super(...arguments),this.color=Kt(1,1,1,1)}};function GWe(){const t=new Fi;return t.include(Yh),t.fragment.uniforms.add(new vt("tex",e=>e.texture),new yi("uColor",e=>e.color)),t.fragment.code.add(T`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const jWe=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:sve,build:GWe},Symbol.toStringTag,{value:"Module"}));let ove=class{constructor(e){this._context=e,this._perConstructorInstances=new wS,this._frameCounter=0,this._keepAliveFrameCount=Ree}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,i=WWe){const r=i.key;let n=this._perConstructorInstances.get(e,r);if(n==null){const s=new e(this._context,i,()=>this.release(s));n=new HWe(s),this._perConstructorInstances.set(e,r,n)}return++n.refCount,n.technique}releaseAndAcquire(e,i,r){if(r!=null){if(i.key===r.key)return r;this.release(r)}return this.acquire(e,i)}release(e){if(e==null||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(e.constructor,e.key);i!=null&&(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Ree&&this._perConstructorInstances.forEach((e,i)=>{e.forEach((r,n)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((i,r)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(i,r))}),await Promise.all(e)}},HWe=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Ree=-1,WWe=new Oa;let ave=class{constructor(e,i,r,n){this._textureRepository=e,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=n,this._id2glMaterialRef=new wS}dispose(){this._textureRepository.destroy()}acquire(e,i,r){if(this._ownMaterial(e),!e.requiresSlot(i,r))return null;let n=this._id2glMaterialRef.get(r,e.id);if(n==null){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:r});n=new qWe(s),this._id2glMaterialRef.set(r,e.id,n)}return n.ref(),n.glMaterial}release(e,i){const r=this._id2glMaterialRef.get(i,e.id);r!=null&&(r.unref(),r.referenced||(et(r.glMaterial),this._id2glMaterialRef.delete(i,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&ye.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},qWe=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,xt(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const ZWe={orderedRepackingEnabled:!1},XWe=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let W7=class ZI{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,i){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new no,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}destroy(){this._degenerateObjects.clear(),no.clearPool(),q7[0]=null,av.prune(),t1.prune()}add(e,i=e.length){this._objectCount+=i,this._grow(e,i);const r=no.acquire();for(let n=0;n<i;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(r.init(this._root),this._add(s,r))}no.release(r)}remove(e,i=null){this._objectCount-=e.length;const r=no.acquire();for(const n of e){const s=i??ST(this.objectToBoundingSphere(n),eqe);tA(s[3])?(r.init(this._root),this._remove(n,s,r)):this._degenerateObjects.delete(n)}no.release(r),this._shrink()}update(e,i){if(!tA(i[3])&&this._isDegenerate(e))return;const r=QWe(e);this.remove(r,i),this.add(r)}forEachAlongRay(e,i,r){const n=Cu(e,i);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(e,i,r,n){const s=Cu(e,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&r(l)}),!0})}forEach(e){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(e),r.residents!==null&&r.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,i,r,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=Ok(e,i),u=p=>{if(--s,!n(p))return;const f=this.objectToBoundingSphere(p);if(!j_(r,f))return;const y=v_(e,i,f),v=y-f[3],b=y+f[3];v<o&&(o=v,a=b,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(s<=0||!j_(r,p.bounds)||(pe(Bu,c,p.halfSize),xe(Bu,Bu,p.bounds),v_(e,i,Bu)>a))return!1;const f=p.node;return f.terminals.forAll(y=>u(y)),f.residents!==null&&f.residents.forAll(y=>u(y)),!0},e,i),l}forEachInDepthRange(e,i,r,n,s,o,a){let l=-1/0,c=1/0;const u={setRange:b=>{r===ZI.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,b.near),c=Math.min(c,b.far)):(l=Math.max(l,-b.far),c=Math.min(c,-b.near))}};u.setRange(n);const p=v_(i,r,e),f=Ok(i,r),y=Ok(i,-r),v=b=>{if(!a(b))return;const x=this.objectToBoundingSphere(b),S=x,P=v_(i,r,S)-p,C=P-x[3],R=P+x[3];C>c||R<l||!j_(o,x)||s(b,u)};this._forEachNodeDepthOrdered(this._root,b=>{if(!j_(o,b.bounds)||(pe(Bu,f,b.halfSize),xe(Bu,Bu,b.bounds),v_(i,r,Bu)-p>c)||(pe(Bu,y,b.halfSize),xe(Bu,Bu,b.bounds),v_(i,r,Bu)-p<l))return!1;const x=b.node;return x.terminals.forAll(S=>v(S)),x.residents!==null&&x.residents.forAll(S=>v(S)),!0},i,r)}forEachNode(e){this._forEachNode(this._root,i=>e(i.node,i.bounds,i.halfSize,i.depth))}forEachNeighbor(e,i){const r=gg(i),n=i,s=l=>{const c=this.objectToBoundingSphere(l),u=gg(c),p=r+u;return!(Io(c,n)-p*p<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=gg(l.bounds),u=r+c;if(Io(l.bounds,n)-u*u>0)return!1;const p=l.node;return p.terminals.forAll(a),o&&p.residents!==null&&p.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,i){return OM(i.bounds,2*-i.halfSize,iu),OM(i.bounds,2*i.halfSize,ru),IJ(e.origin,e.direction,iu,ru)}_intersectsNodeWithOffset(e,i,r){return OM(i.bounds,2*-i.halfSize,iu),OM(i.bounds,2*i.halfSize,ru),r.applyToMinMax(iu,ru),IJ(e.origin,e.direction,iu,ru)}_intersectsObject(e,i){const r=this.objectToBoundingSphere(i);return!(r[3]>0)||$z(r,e)}_intersectsObjectWithOffset(e,i,r){const n=this.objectToBoundingSphere(i);return!(n[3]>0)||$z(r.applyToBoundingSphere(n),e)}_forEachNode(e,i){let r=no.acquire().init(e);const n=[r];for(;n.length!==0;){if(r=n.pop(),i(r)&&!r.isLeaf())for(let s=0;s<r.node.children.length;s++)r.node.children[s]&&n.push(no.acquire().init(r).advance(s));no.release(r)}}_forEachNodeDepthOrdered(e,i,r,n=ZI.DepthOrder.FRONT_TO_BACK){let s=no.acquire().init(e);const o=[s];for(KWe(r,n,Iee);o.length!==0;){if(s=o.pop(),i(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=Iee[a];s.node.children[l]&&o.push(no.acquire().init(s).advance(l))}no.release(s)}}_remove(e,i,r){av.clear();const n=r.advanceTo(i,(s,o)=>{av.push(s.node),av.push(o)})?r.node.terminals:r.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=av.length-2;s>=0;s-=2){const o=av.data[s],a=av.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let i=0;i<e.children.length;i++)if(e.children[i])return!1;return!0}_purge(e,i){return i>=0&&(e.children[i]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new ri({shrink:!0})),!0)}_add(e,i){i.advanceTo(this.objectToBoundingSphere(e))?i.node.terminals.push(e):(i.node.residents.push(e),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(e){const i=e.node.residents;e.node.residents=null;for(let r=0;r<i.length;r++){const n=no.acquire().init(e);this._add(i.at(r),n),no.release(n)}}_grow(e,i){if(i!==0&&(Mee(e,i,r=>this.objectToBoundingSphere(r),Tm),tA(Tm[3])&&!this._fitsInsideTree(Tm)))if(this._nodeIsEmpty(this._root.node))ST(Tm,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const r=this._rootBoundsForRootAsSubNode(Tm);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(Tm,r):this._growRootAsSubNode(r),no.release(r)}}_rebuildTree(e,i){fe(Mk,i.bounds),Mk[3]=i.halfSize,Mee([e,Mk],2,n=>n,$k);const r=no.acquire().init(this._root);this._root.initFrom(null,$k,$k[3]),this._root.increaseHalfSize(1.25),this._forEachNode(r,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),no.release(r)}_placingRootViolatesMaxDepth(e){const i=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,n=>(r=Math.max(r,n.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const i=e[3],r=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(r[l]-i),u=r[l]+i-(s[l]+o),p=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(u/(2*o)))+1,y=2**Math.ceil(Math.log(p+f)*Math.LOG2E);n=Math.max(n,y),RM[l].min=p,RM[l].max=f}for(let l=0;l<3;l++){let c=RM[l].min,u=RM[l].max;const p=(n-(c+u))/2;c+=Math.ceil(p),u+=Math.floor(p);const f=s[l]-o-c*o*2;Rk[l]=f+(u+c)*o}const a=n*o;return Rk[3]=a*cve,no.acquire().initFrom(null,Rk,a,0)}_growRootAsSubNode(e){const i=this._root.node;fe(Tm,this._root.bounds),Tm[3]=this._root.halfSize,this._root.init(e),e.advanceTo(Tm,null,!0),e.node.children=i.children,e.node.residents=i.residents,e.node.terminals=i.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const i=this._root.node.children;let r=0,n=0;for(;n<i.length&&e==null;)r=n++,e=i[r];for(;n<i.length;)if(i[n++])return-1;return r}_isDegenerate(e){return!tA(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const i=this._root.bounds,r=this._root.halfSize;return e[3]<=r&&e[0]>=i[0]-r&&e[0]<=i[0]+r&&e[1]>=i[1]-r&&e[1]<=i[1]+r&&e[2]>=i[2]-r&&e[2]<=i[2]+r}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:i,_objectCount:r}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:i,objectCount:r,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){var s,o;const i=e.children.map(a=>a?this._nodeToJSON(a):null),r=(s=e.residents)==null?void 0:s.map(a=>this.objectToBoundingSphere(a)),n=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:i,residents:r,terminals:n}}static fromJSON(e){const i=new ZI(r=>r,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return i._objectCount=e.objectCount,i._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),i}},no=class Qx{constructor(){this.bounds=kn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,i,r,n=this.depth){return this.node=e??Qx.createEmptyNode(),i!=null&&ST(i,this.bounds),this.halfSize=r,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*cve}advance(e){let i=this.node.children[e];i||(i=Qx.createEmptyNode(),this.node.children[e]=i),this.node=i,this.halfSize/=2,this.depth++;const r=lve[e];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,i,r=!1){for(;;){if(this.isTerminalFor(e))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);i&&i(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const i=this.bounds;return(i[0]<e[0]?1:0)+(i[1]<e[1]?2:0)+(i[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new ri({shrink:!0}),residents:new ri({shrink:!0})}}static acquire(){return Qx._pool.acquire()}static release(e){Qx._pool.release(e)}static clearPool(){Qx._pool.prune()}};function YWe(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function JWe(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function OM(t,e,i){i[0]=t[0]+e,i[1]=t[1]+e,i[2]=t[2]+e}function Mee(t,e,i,r){if(e===1){const n=i(t[0]);ST(n,r)}else{iu[0]=1/0,iu[1]=1/0,iu[2]=1/0,ru[0]=-1/0,ru[1]=-1/0,ru[2]=-1/0;for(let n=0;n<e;n++){const s=i(t[n]);tA(s[3])&&(YWe(iu,s),JWe(ru,s))}pr(r,iu,ru,.5),r[3]=Math.max(ru[0]-iu[0],ru[1]-iu[1],ru[2]-iu[2])/2}}function KWe(t,e,i){if(!t1.length)for(let r=0;r<8;++r)t1.push({index:0,distance:0});for(let r=0;r<8;++r){const n=lve[r];t1.data[r].index=r,t1.data[r].distance=v_(t,e,n)}t1.sort((r,n)=>r.distance-n.distance);for(let r=0;r<8;++r)i[r]=t1.data[r].index}function Ok(t,e){let i,r=1/0;for(let n=0;n<8;++n){const s=v_(t,e,$ee[n]);s<r&&(r=s,i=$ee[n])}return i}function v_(t,e,i){return e*(t[0]*i[0]+t[1]*i[1]+t[2]*i[2])}function tA(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}no._pool=new ea(no),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(W7||(W7={}));const lve=[Ge(-1,-1,-1),Ge(1,-1,-1),Ge(-1,1,-1),Ge(1,1,-1),Ge(-1,-1,1),Ge(1,-1,1),Ge(-1,1,1),Ge(1,1,1)],$ee=[Ge(-1,-1,-1),Ge(-1,-1,1),Ge(-1,1,-1),Ge(-1,1,1),Ge(1,-1,-1),Ge(1,-1,1),Ge(1,1,-1),Ge(1,1,1)],cve=Math.sqrt(3),q7=[null];function QWe(t){return q7[0]=t,q7}const Rk=kn(),Bu=I(),iu=I(),ru=I(),av=new ri,eqe=kn(),Tm=kn(),Mk=kn(),$k=kn(),RM=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],t1=new ri,Iee=[0,0,0,0,0,0,0,0],Kd=W7;var Q_;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(Q_||(Q_={}));let uve=class extends Y3{get objects(){return this._objects}constructor(e,i,r=""){super(),this.stage=e,this.apiLayerUid=r,this.type=An.Layer,this.events=new os,this.sliceable=!1,this._objects=new ri,this._objectsAdded=new ri,this._handles=new an,this.apiLayerUid=r,this.visible=(i==null?void 0:i.visible)??!0,this.pickable=(i==null?void 0:i.pickable)??!0,this.updatePolicy=(i==null?void 0:i.updatePolicy)??Q_.ASYNC,this._disableOctree=(i==null?void 0:i.disableOctree)??!1,e.add(this);for(const n of XWe)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const i of e)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const i=new Array;if(this._objects.removeUnorderedMany(e,e.length,i),i.length!==0){for(const r of i)r.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),this._octree!=null){for(let r=0;r<i.length;)this._objectsAdded.removeUnordered(i[r])?(i[r]=i[i.length-1],i.length-=1):++r;this._octree.remove(i)}}}sync(){this.updatePolicy!==Q_.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,i){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,i)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Kd(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Je(this._octree),this._objectsAdded.clear()}};function rN(t){return t!=null&&t.type===An.Layer}var bu,Ob;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(bu||(bu={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(Ob||(Ob={}));let Eo=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.transparencyPassType=At.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=bu.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=Ob.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===bu.Draped}};d([q({count:j.COUNT})],Eo.prototype,"output",void 0),d([q({count:At.COUNT})],Eo.prototype,"transparencyPassType",void 0),d([q()],Eo.prototype,"occluder",void 0),d([q()],Eo.prototype,"hasSlicePlane",void 0),d([q()],Eo.prototype,"writeDepth",void 0),d([q({count:bu.COUNT})],Eo.prototype,"space",void 0),d([q()],Eo.prototype,"hideOnShortSegments",void 0),d([q()],Eo.prototype,"hasCap",void 0),d([q({count:Ob.COUNT})],Eo.prototype,"anchor",void 0),d([q()],Eo.prototype,"hasTip",void 0),d([q()],Eo.prototype,"vvSize",void 0),d([q()],Eo.prototype,"vvColor",void 0),d([q()],Eo.prototype,"vvOpacity",void 0),d([q()],Eo.prototype,"hasOccludees",void 0),d([q()],Eo.prototype,"hasMultipassTerrain",void 0),d([q()],Eo.prototype,"cullAboveGround",void 0),d([q({constValue:!0})],Eo.prototype,"hasVvInstancing",void 0),d([q({constValue:!0})],Eo.prototype,"hasSliceTranslatedView",void 0);const Lee=8;function hve(t,e){const i=t.vertex;i.uniforms.add(new je("intrinsicWidth",r=>r.width)),e.vvSize?(t.attributes.add(M.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new ei("vvSizeMinSize",r=>r.vvSize.minSize),new ei("vvSizeMaxSize",r=>r.vvSize.maxSize),new ei("vvSizeOffset",r=>r.vvSize.offset),new ei("vvSizeFactor",r=>r.vvSize.factor)),i.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(M.SIZE,"float"),i.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(M.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new Ol("vvOpacityValues",r=>r.vvOpacity.values,Lee),new Ol("vvOpacityOpacities",r=>r.vvOpacity.opacityValues,Lee)),i.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(bg,e),t.attributes.add(M.COLORFEATUREATTRIBUTE,"float"),i.code.add(T`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(M.COLOR,"vec4"),i.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}function Ug(t,e){switch(t.fragment.include(Ac),e.output){case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:t.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case j.Depth:t.fragment.code.add(T`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let dve=class{constructor(e,i,r){this._createTexture=e,this._parametersKey=i,this._repository=new Map,this._orphanCache=r.newCache(`procedural-texture-repository:${xc()}`,n=>n.dispose())}destroy(){for(const[e,{texture:i}]of this._repository)i.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,i=null){const r=this._acquire(e);return this.release(i),r}release(e){if(e==null)return;const i=this._parametersKey(e),r=this._repository.get(i);if(r&&(r.refCount--,r.refCount===0)){this._repository.delete(i);const{texture:n}=r,s=n.gpuMemoryUsage;this._orphanCache.put(i,n,s)}}_acquire(e){if(e==null)return null;const i=this._parametersKey(e),r=this._repository.get(i);if(r)return r.refCount++,r.texture;const n=this._orphanCache.pop(i)??this._createTexture(e),s=new tqe(n);return this._repository.set(i,s),n}},tqe=class{constructor(e){this.texture=e,this.refCount=1}};function iqe(t,e){return new dve(i=>{const{encodedData:r,paddedPixels:n}=rqe(i),s=new Di;return s.internalFormat=Gt.RGBA,s.width=n,s.height=1,s.wrapMode=Jt.CLAMP_TO_EDGE,new Wt(t,s,r)},i=>`${i.pattern.join(",")}-r${i.pixelRatio}`,e)}function rqe(t){const e=oq(t),i=1/t.pixelRatio,r=pve(t),n=fve(t),s=(Math.floor(.5*(n-1))+.5)*i,o=[];let a=1;for(const y of e){for(let v=0;v<y;v++){const b=a*(Math.min(v,y-1-v)+.5)*i/s*.5+.5;o.push(b)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=r+mve,p=new Uint8Array(4*u);let f=4;for(const y of c)QP(y,p,f),f+=4;return p.copyWithin(0,f-4,f),p.copyWithin(f,4,8),{encodedData:p,paddedPixels:u}}function oq(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function pve(t){if(t==null)return 1;const e=oq(t);return Math.floor(e.reduce((i,r)=>i+r))}function fve(t){return oq(t).reduce((e,i)=>Math.max(e,i))}const mve=2;function nqe(t){return t==null?Df:t.length===4?t:Br(sqe,t[0],t[1],t[2],1)}const sqe=gi();function gve(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?oqe(t,e):aqe(t)}function oqe(t,e){const i=!(e.draped&&e.stipplePreferContinuous),{vertex:r,fragment:n}=t;n.include(Ac),e.draped||(gp(r,e),r.uniforms.add(new je("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),r.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${cqe};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(T`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),ES(r,e),r.code.add(T`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?T`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),n.constants.add("stippleTexturePadding","float",mve),n.uniforms.add(new vt("stipplePatternTexture",s=>s.stippleTexture),new je("stipplePatternSDFNormalizer",s=>lqe(s.stipplePattern)),new je("stipplePatternPixelSizeInv",s=>1/aq(s))),n.code.add(T`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),n.code.add(T`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?T`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:T`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?T`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?T`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:T`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?T`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:T`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(n.uniforms.add(new yi("stippleOffColor",s=>nqe(s.stippleOffColor))),n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function aqe(t){t.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function lqe(t){return t?(Math.floor(.5*(fve(t)-1))+.5)/t.pixelRatio:1}function aq(t){const e=t.stipplePattern;return e?pve(t.stipplePattern)/e.pixelRatio:1}const cqe=T.float(.4),q1=64,lq=q1/2,_ve=lq/5,uqe=q1/_ve,hqe=.25;function dqe(t,e){const i=m_e(t,q1,lq,_ve),r=new Di;return r.internalFormat=Gt.RGBA,r.width=q1,r.height=q1,r.wrapMode=Jt.CLAMP_TO_EDGE,new Wt(e,r,i)}function yve(t,e){const{vertex:i,constants:r}=t;r.add("markerSizePerLineWidth","float",uqe),ES(i,e),i.uniforms.get("markerScale")==null&&i.constants.add("markerScale","float",1),i.code.add(T`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===bu.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new je("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),i.code.add(T`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Lh;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Lh||(Lh={}));let rn=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.capType=Lh.BUTT,this.transparencyPassType=At.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};d([q({count:j.COUNT})],rn.prototype,"output",void 0),d([q({count:Lh.COUNT})],rn.prototype,"capType",void 0),d([q({count:At.COUNT})],rn.prototype,"transparencyPassType",void 0),d([q()],rn.prototype,"occluder",void 0),d([q()],rn.prototype,"hasSlicePlane",void 0),d([q()],rn.prototype,"hasPolygonOffset",void 0),d([q()],rn.prototype,"writeDepth",void 0),d([q()],rn.prototype,"draped",void 0),d([q()],rn.prototype,"stippleEnabled",void 0),d([q()],rn.prototype,"stippleOffColorEnabled",void 0),d([q()],rn.prototype,"stippleScaleWithLineWidth",void 0),d([q()],rn.prototype,"stipplePreferContinuous",void 0),d([q()],rn.prototype,"roundJoins",void 0),d([q()],rn.prototype,"applyMarkerOffset",void 0),d([q()],rn.prototype,"vvSize",void 0),d([q()],rn.prototype,"vvColor",void 0),d([q()],rn.prototype,"vvOpacity",void 0),d([q()],rn.prototype,"falloffEnabled",void 0),d([q()],rn.prototype,"innerColorEnabled",void 0),d([q()],rn.prototype,"hasOccludees",void 0),d([q()],rn.prototype,"hasMultipassTerrain",void 0),d([q()],rn.prototype,"cullAboveGround",void 0),d([q()],rn.prototype,"wireframe",void 0),d([q({constValue:!0})],rn.prototype,"stippleRequiresClamp",void 0),d([q({constValue:!0})],rn.prototype,"stippleRequiresStretchMeasure",void 0),d([q({constValue:!0})],rn.prototype,"hasVvInstancing",void 0),d([q({constValue:!0})],rn.prototype,"hasSliceTranslatedView",void 0),d([q()],rn.prototype,"objectAndLayerIdColorInstanced",void 0);const nN=1;function pqe(t){const e=new Fi,{vertex:i,fragment:r}=e,n=t.hasMultipassTerrain&&(t.output===j.Color||t.output===j.Alpha);e.include(W3),e.include(hve,t),e.include(gve,t);const s=t.applyMarkerOffset&&!t.draped;s&&(i.uniforms.add(new je("markerScale",y=>y.markerScale)),e.include(yve,{space:bu.World,draped:!1})),t.output===j.Depth&&e.include(Ug,t),e.include(iO,t),Tc(i,t),i.uniforms.add(new en("inverseProjectionMatrix",(y,v)=>v.camera.inverseProjectionMatrix),new Bi("nearFar",(y,v)=>v.camera.nearFar),new je("miterLimit",y=>y.join!=="miter"?0:y.miterLimit),new yi("viewport",(y,v)=>v.camera.fullViewport)),i.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.SUBDIVISIONFACTOR,"float"),e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.AUXPOS1,"vec3"),e.attributes.add(M.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),gy(e),n&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===Lh.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const u=t.stippleEnabled&&a,p=t.falloffEnabled||u;p&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),i.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),i.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r4(e),i.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),ES(i,t),i.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?T`vLineWidth = lineWidth;`:""}
      ${o?T`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&i.code.add(T`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),i.code.add(T`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&i.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),i.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?i.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((nN+2)/(nN+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):i.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Lh.BUTT;return i.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),i.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${p||c?T`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?T`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${p?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&i.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?i.uniforms.add(new je("worldToScreenRatio",(y,v)=>1/v.screenToPCSRatio)):i.code.add(T`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?i.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):i.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new je("stipplePatternPixelSize",y=>aq(y))),i.code.add(T`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),i.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(Au,t),e.include(Nn,t),r.include(am),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?r.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&r.code.add(T`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${T.float(Mo)}) {
        discard;
      }
    `),u?r.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(Mo)}, stippleCoverage);
      `):r.code.add(T`float stippleAlpha = getStippleAlpha();`),r.uniforms.add(new yi("intrinsicColor",y=>y.color)),t.output!==j.ObjectAndLayerIdColor&&r.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),r.code.add(T`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(r.uniforms.add(new yi("innerColor",y=>y.innerColor??y.color),new je("innerWidth",(y,v)=>y.innerWidth*v.camera.pixelRatio)),r.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),r.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(r.uniforms.add(new je("falloff",y=>y.falloff)),r.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),r.code.add(T`
    ${t.output===j.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(Mo)}) {
      discard;
    }

    ${t.output===j.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===j.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===j.Color&&t.transparencyPassType===At.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===j.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===j.Depth?T`outputDepth(linearDepth);`:""}
    ${t.output===j.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const fqe=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:nN,build:pqe},Symbol.toStringTag,{value:"Module"})),cq={func:br.LESS},sN={func:br.ALWAYS},Jf={mask:255},vve={mask:0},mqe=t=>({function:{func:br.NOTEQUAL,ref:t,mask:t},operation:{fail:Fn.KEEP,zFail:Fn.KEEP,zPass:Fn.KEEP}}),gqe=t=>({function:{func:br.ALWAYS,ref:t,mask:t},operation:{fail:Fn.KEEP,zFail:Fn.KEEP,zPass:Fn.REPLACE}}),Ny={function:{func:br.ALWAYS,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:Fn.KEEP,zFail:Fn.KEEP,zPass:Fn.ZERO}},Ey={function:{func:br.ALWAYS,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:Fn.KEEP,zFail:Fn.KEEP,zPass:Fn.REPLACE}},bve={function:{func:br.EQUAL,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:Fn.KEEP,zFail:Fn.KEEP,zPass:Fn.KEEP}},wve={function:{func:br.NOTEQUAL,ref:Il.OutlineVisualElementMask,mask:Il.OutlineVisualElementMask},operation:{fail:Fn.KEEP,zFail:Fn.KEEP,zPass:Fn.KEEP}},xve=new Map([[M.POSITION,0],[M.SUBDIVISIONFACTOR,1],[M.UV0,2],[M.AUXPOS1,3],[M.AUXPOS2,4],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.OPACITYFEATUREATTRIBUTE,7],[M.OBJECTANDLAYERIDCOLOR,8]]);let Tve=class Sve extends qi{initializeProgram(e){return new Gi(e.rctx,Sve.shader.get().build(this.configuration),xve)}_makePipelineState(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Zt({blending:r.output===j.Color||r.output===j.Alpha?n?vu:Qg(e):null,depthTest:{func:Dy(e)},depthWrite:n?r.writeDepth?Nl:null:E4(e),colorWrite:ni,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?Ey:Ny:null,polygonOffset:n||s?r.hasPolygonOffset?Dee:null:P4})}initializePipeline(){const e=this.configuration;if(e.occluder){const i=e.hasPolygonOffset?Dee:null;this._occluderPipelineTransparent=Zt({blending:vu,polygonOffset:i,depthTest:sN,depthWrite:null,colorWrite:ni,stencilWrite:null,stencilTest:wve}),this._occluderPipelineOpaque=Zt({blending:vu,polygonOffset:i,depthTest:sN,depthWrite:null,colorWrite:ni,stencilWrite:vve,stencilTest:bve}),this._occluderPipelineMaskWrite=Zt({blending:null,polygonOffset:i,depthTest:cq,depthWrite:null,colorWrite:null,stencilWrite:Jf,stencilTest:Ey})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Ht.LINES:Ht.TRIANGLE_STRIP}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Te.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Te.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};Tve.shader=new Vi(fqe,()=>Oe(()=>import("./RibbonLine.glsl-95f7abaa.js"),[],import.meta.url));const Dee={factor:0,units:-4};var rc;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(rc||(rc={}));let O2=class extends Ly{constructor(e){super(e,new yqe),this._configuration=new rn,this._vertexAttributeLocations=xve}isClosed(e,i){return Eve(this.parameters,e,i)}getConfiguration(e,i){this._configuration.output=e,this._configuration.draped=i.slot===Te.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null&&e!==j.Highlight;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&bqe(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Kr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(M.POSITION).data,l=e.vertexAttributes.get(M.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const b=e.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0];c*=$e(this.parameters.vvSize.offset[0]+b*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=n[0],p=n[1],f=(c/2+4)*e.screenToWorldRatio;let y=Number.MAX_VALUE,v=0;for(let b=0;b<a.length-5;b+=3){const x=a[b],S=a[b+1],P=u-x,C=p-S,R=a[b+3]-x,N=a[b+4]-S,$=$e((R*P+N*C)/(R*R+N*N),0,1),k=R*$-P,B=N*$-C,W=k*k+B*B;W<y&&(y=W,v=b/3)}y<f*f&&s(o.dist,o.normal,v,!1)}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!Ufe(i))return void ye.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(M.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const P=a.get(M.SIZEFEATUREATTRIBUTE).data[0];c*=$e(this.parameters.vvSize.offset[0]+P*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(M.SIZE)&&(c*=a.get(M.SIZE).data[0]);const u=r.camera,p=wqe;Is(p,r.point);const f=c*u.pixelRatio/2+4*u.pixelRatio;me(MC[0],p[0]-f,p[1]+f,0),me(MC[1],p[0]+f,p[1]+f,0),me(MC[2],p[0]+f,p[1]-f,0),me(MC[3],p[0]-f,p[1]-f,0);for(let P=0;P<4;P++)if(!u.unprojectFromRenderScreen(MC[P],Sm[P]))return;ya(u.eye,Sm[0],Sm[1],Lk),ya(u.eye,Sm[1],Sm[2],Dk),ya(u.eye,Sm[2],Sm[3],Nk),ya(u.eye,Sm[3],Sm[0],Fk);let y=Number.MAX_VALUE,v=0;const b=Cve(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let P=0;P<b;P+=3){dl[0]=l[P]+i[12],dl[1]=l[P+1]+i[13],dl[2]=l[P+2]+i[14];const C=(P+3)%l.length;if(pl[0]=l[C]+i[12],pl[1]=l[C+1]+i[13],pl[2]=l[C+2]+i[14],Dr(Lk,dl)<0&&Dr(Lk,pl)<0||Dr(Dk,dl)<0&&Dr(Dk,pl)<0||Dr(Nk,dl)<0&&Dr(Nk,pl)<0||Dr(Fk,dl)<0&&Dr(Fk,pl)<0)continue;if(u.projectToRenderScreen(dl,cv),u.projectToRenderScreen(pl,uv),cv[2]<0&&uv[2]>0){Ce(Dp,dl,pl);const N=u.frustum,$=-Dr(N[Lr.NEAR],dl)/Re(Dp,N[Lr.NEAR]);pe(Dp,Dp,$),xe(dl,dl,Dp),u.projectToRenderScreen(dl,cv)}else if(cv[2]>0&&uv[2]<0){Ce(Dp,pl,dl);const N=u.frustum,$=-Dr(N[Lr.NEAR],pl)/Re(Dp,N[Lr.NEAR]);pe(Dp,Dp,$),xe(pl,pl,Dp),u.projectToRenderScreen(pl,uv)}else if(cv[2]<0&&uv[2]<0)continue;cv[2]=0,uv[2]=0;const R=Yj(G1(cv,uv,kee),p);R<y&&(y=R,fe(Nee,dl),fe(Fee,pl),v=P/3)}const x=r.rayBegin,S=r.rayEnd;if(y<f*f){let P=Number.MAX_VALUE;if(Zde(G1(Nee,Fee,kee),G1(x,S,xqe),lv)){Ce(lv,lv,x);const C=ze(lv);pe(lv,lv,1/C),P=C/Nr(x,S)}o(P,lv,v,!1)}}get _layout(){const e=ln().vec3f(M.POSITION).f32(M.SUBDIVISIONFACTOR).vec2f(M.UV0).vec3f(M.AUXPOS1).vec3f(M.AUXPOS2);return this.parameters.vvSize?e.f32(M.SIZEFEATUREATTRIBUTE):e.f32(M.SIZE),this.parameters.vvColor?e.f32(M.COLORFEATUREATTRIBUTE):e.vec4f(M.COLOR),this.parameters.vvOpacity&&e.f32(M.OPACITYFEATUREATTRIBUTE),ge("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(M.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new vqe(this._layout,this.parameters)}requiresSlot(e,i){return i===j.Color||i===j.Alpha||i===j.Highlight||i===j.Depth||i===j.ObjectAndLayerIdColor?e===Te.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Kr.OccludeAndTransparentStencil?e===Te.OPAQUE_MATERIAL||e===Te.OCCLUDER_MATERIAL||e===Te.TRANSPARENT_OCCLUDER_MATERIAL:i===j.Color||i===j.Alpha?e===(this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Te.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new _qe(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},_qe=class extends $y{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==j.Color&&this._output!==j.Alpha||this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(Tve,e)}},yqe=class extends nO{constructor(){super(...arguments),this.width=0,this.color=Sh,this.join="miter",this.cap=Lh.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},vqe=class{constructor(e,i){this._parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const r=i.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=nN+r}}_isClosed(e){return Cve(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const r=e.indices.get(M.POSITION).length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?r:r-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,i,r,n,s){var ee;const o=Tqe,a=Sqe,l=Cqe,c=r.vertexAttributes.get(M.POSITION).data,u=r.indices&&r.indices.get(M.POSITION),p=(ee=r.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:ee.data;u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,y=0;this._parameters.vvSize?y=r.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.SIZE)&&(f=r.vertexAttributes.get(M.SIZE).data[0]);let v=[1,1,1,1],b=0;this._parameters.vvColor?b=r.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.COLOR)&&(v=r.vertexAttributes.get(M.COLOR).data);const x=ge("enable-feature:objectAndLayerId-rendering")?r.objectAndLayerIdColor:null;let S=0;this._parameters.vvOpacity&&(S=r.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const P=c.length/3,C=new Float32Array(n.buffer),R=ge("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,N=this.vertexBufferLayout.stride/4;let $=s*N;const k=$;let B=0;const W=p?(oe,U,V)=>B=p[V]:(oe,U,V)=>B+=Nr(oe,U),Z=ge("enable-feature:objectAndLayerId-rendering"),K=(oe,U,V,H,Y,ie,le)=>{if(C[$++]=U[0],C[$++]=U[1],C[$++]=U[2],C[$++]=H,C[$++]=le,C[$++]=Y,C[$++]=oe[0],C[$++]=oe[1],C[$++]=oe[2],C[$++]=V[0],C[$++]=V[1],C[$++]=V[2],C[$++]=this._parameters.vvSize?y:f,this._parameters.vvColor)C[$++]=b;else{const ue=Math.min(4*ie,v.length-4);C[$++]=v[ue],C[$++]=v[ue+1],C[$++]=v[ue+2],C[$++]=v[ue+3]}this._parameters.vvOpacity&&(C[$++]=S),Z&&(x!=null&&(R[4*$]=x[0],R[4*$+1]=x[1],R[4*$+2]=x[2],R[4*$+3]=x[3]),$++)};$+=N,me(a,c[0],c[1],c[2]),e&&st(a,a,e);const X=this._isClosed(r);if(X){const oe=c.length-3;me(o,c[oe],c[oe+1],c[oe+2]),e&&st(o,o,e)}else me(l,c[3],c[4],c[5]),e&&st(l,l,e),K(a,a,l,1,rc.LEFT_CAP_START,0,0),K(a,a,l,1,rc.RIGHT_CAP_START,0,0),fe(o,a),fe(a,l);const ae=X?0:1,re=X?P:P-1;for(let oe=ae;oe<re;oe++){const U=(oe+1)%P*3;me(l,c[U],c[U+1],c[U+2]),e&&st(l,l,e),W(o,a,oe),K(o,a,l,0,rc.LEFT_JOIN_END,oe,B),K(o,a,l,0,rc.RIGHT_JOIN_END,oe,B);const V=this.numJoinSubdivisions;for(let H=0;H<V;++H){const Y=(H+1)/(V+1);K(o,a,l,Y,rc.LEFT_JOIN_END,oe,B),K(o,a,l,Y,rc.RIGHT_JOIN_END,oe,B)}K(o,a,l,1,rc.LEFT_JOIN_START,oe,B),K(o,a,l,1,rc.RIGHT_JOIN_START,oe,B),fe(o,a),fe(a,l)}X?(me(l,c[3],c[4],c[5]),e&&st(l,l,e),B=W(o,a,re),K(o,a,l,0,rc.LEFT_JOIN_END,ae,B),K(o,a,l,0,rc.RIGHT_JOIN_END,ae,B)):(B=W(o,a,re),K(o,a,a,0,rc.LEFT_CAP_END,re,B),K(o,a,a,0,rc.RIGHT_CAP_END,re,B)),Ik(C,k+N,C,k,N),$=Ik(C,$-N,C,$,N),this._parameters.wireframe&&this._addWireframeVertices(n,k,$,N)}_addWireframeVertices(e,i,r,n){const s=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=Ik(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function Ik(t,e,i,r,n){for(let s=0;s<n;s++)i[r++]=t[e++];return r}function Cve(t,e,i){return Eve(t,e.get(M.POSITION).data,i?i.get(M.POSITION):null)}function Eve(t,e,i){return!!t.isClosed&&(i?i.length>2:e.length>6)}function bqe(t){return t.anchor===Ob.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const dl=I(),pl=I(),Dp=I(),lv=I(),wqe=I(),cv=ta(),uv=ta(),Nee=I(),Fee=I(),kee=yp(),xqe=yp(),Tqe=I(),Sqe=I(),Cqe=I(),MC=[ta(),ta(),ta(),ta()],Sm=[I(),I(),I(),I()],Lk=Yi(),Dk=Yi(),Nk=Yi(),Fk=Yi();let uq=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+xc()}getOrigin(e){const i=this._origins.get(this._rootOriginId);if(i==null){const u=XD(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const r=this._gridSize,n=Math.round(e[0]/r),s=Math.round(e[1]/r),o=Math.round(e[2]/r),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*r;if(Ce(vo,e,i.vec3),vo[0]=Math.abs(vo[0]),vo[1]=Math.abs(vo[1]),vo[2]=Math.abs(vo[2]),vo[0]<c&&vo[1]<c&&vo[2]<c){if(l){const u=Math.max(...vo);if(Ce(vo,e,l.vec3),vo[0]=Math.abs(vo[0]),vo[1]=Math.abs(vo[1]),vo[2]=Math.abs(vo[2]),Math.max(...vo)<u)return l}return i}return l||(l=XD(n*r,s*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(e,i=Kt(1,1,0,1)){const r=window.view,n=r._stage,s=i.toString();if(!this._objects.has(s)){this._material=new O2({width:2,color:i}),n.add(this._material);const y=new uve(n,{pickable:!1}),v=new e0({castShadow:!1});n.add(v),y.add(v),this._objects.set(s,v)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,p=.5*this._gridSize;for(let y=0;y<l;y++)c[3*y]=e[0]+(1&a[y]?p:-p),c[3*y+1]=e[1]+(2&a[y]?p:-p),c[3*y+2]=e[2]+(4&a[y]?p:-p),y>0&&u.push(y-1,y);_n(c,this._originSR,0,c,r.renderSpatialReference,0,l);const f=new fs(this._material,[[M.POSITION,new nt(c,3,!0)]],[[M.POSITION,u]],null,An.Line);n.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(i){e._gridSize=i}}}};const vo=I();let Ave=class{constructor(e,i,r,n=null){this.rctx=e,this.sliceHelper=n,this.lastFrameCamera=new It,this.output=j.Color,this.renderOccludedMask=Uee,this.bindParameters=new i4(i,r,n!=null?n.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=Uee}},Eqe=class extends Ave{constructor(e,i,r,n,s){super(e,r,n,s),this.offscreenRenderingHelper=i,this.sliceHelper=s,this.time=0}};const Uee=Kr.Occlude|Kr.OccludeAndTransparent|Kr.OccludeAndTransparentStencil;let iA=class extends It{constructor(){super(...arguments),this._projectionMatrix=Ne()}get projectionMatrix(){return this._projectionMatrix}};d([m()],iA.prototype,"_projectionMatrix",void 0),d([m({readOnly:!0})],iA.prototype,"projectionMatrix",null),iA=d([J("esri.views.3d.webgl-engine.lib.CascadeCamera")],iA);const zee=16;function hq(t){return Math.ceil(t/zee)*zee}var ZT;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(ZT||(ZT={}));let MM=class{constructor(){this.camera=new iA,this.lightMat=Ne()}},Aqe=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},dq=class{get depthTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return Br(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,i){this._rctx=e,this._viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new Aqe,this._projectionView=Ne(),this._projectionViewInverse=Ne(),this._modelViewLight=Ne(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=gi(),this._cascades=[new MM,new MM,new MM,new MM],this._lastOrigin=null,this._maxTextureSize=Math.min(ge("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=et(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=$e(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)Uk[e]=this._cascades[e];return Uk.length=this._numCascades,Uk}start(e,i,r,n,s){xt(this.enabled),this._textureSize=this._computeTextureSize(e,s,n),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(r);this._computeCascadeDistances(a,o,n),this._setupMatrices(e,i);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,i);this._lastOrigin=null,this.clear()}finish(e){xt(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!xa(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||I(),fe(this._lastOrigin,e);for(let i=0;i<this._numCascades;++i){Dl(Wee,this._cascades[i].lightMat,e);for(let r=0;r<16;++r)qee[16*i+r]=Wee[r]}}return qee}takeCascadeSnapshotTo(e,i){xt(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const n=this._rctx,s=n.bindTexture(r,Wt.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(Cn.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),n.bindTexture(s,Wt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT)}_computeTextureSize(e,i,r){const n=Math.min(window.devicePixelRatio,i)/e.pixelRatio,s=Math.max(e.fullWidth,e.fullHeight)*n,o=r?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,hq((this.numCascades===1?1:2)*s*o)))}_ensureDepthTexture(){var i,r;if(((i=this._fbo)==null?void 0:i.width)===this._textureSize)return;const e=new Di(this._textureSize);e.wrapMode=Jt.CLAMP_TO_EDGE,e.samplingMode=qt.NEAREST,(r=this._fbo)==null||r.dispose(),this._fbo=new Rs(this._rctx,e,new SD(hs.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let i=this._snapshots[e];if(i!=null&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(e);const r=new Di;return r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=qt.NEAREST,r.width=this._textureSize,r.height=this._textureSize,i=new Wt(this._rctx,r),this._snapshots[e]=i,i}_discardSnapshot(e){this._snapshots[e]=et(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,i,r,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);xt(l<c);for(let y=0;y<8;++y){Br(Bee,y%4==0||y%4==3?-1:1,y%4==0||y%4==1?-1:1,y<4?l:c,1);const v=ph[y];hu(v,Bee,this._projectionViewInverse),v[0]/=v[3],v[1]/=v[3],v[2]/=v[3]}Ea(kk,ph[0]),s.camera.viewMatrix=Dl(Pqe,this._modelViewLight,kk);for(let y=0;y<8;++y)st(ph[y],ph[y],s.camera.viewMatrix);let u=ph[0][2],p=ph[0][2];for(let y=1;y<8;++y)u=Math.min(u,ph[y][2]),p=Math.max(p,ph[y][2]);u-=200,p+=200,s.camera.near=-p,s.camera.far=-u,$qe(r,n,u,p,s.camera),Cr(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const f=this._textureSize/(this.numCascades===1?1:2);s.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,i){Cr(this._projectionView,e.projectionMatrix,e.viewMatrix),fo(this._projectionViewInverse,this._projectionView);const r=this._viewingMode===Ke.Global?e.eye:me(kk,0,0,1);I5(this._modelViewLight,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(e){let{near:i,far:r}=e;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(e,i,r){const n=r?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor(RFe(e/i,4)),n);const s=(e-i)/this._numCascades,o=(e/i)**(1/this._numCascades);let a=i,l=i;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Bt(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get gpuMemoryUsage(){var e;return this._snapshots.reduce((i,r)=>i+((r==null?void 0:r.gpuMemoryUsage)??0),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const Pqe=Ne(),Bee=gi(),ph=[];for(let t=0;t<8;++t)ph.push(gi());const Vee=it(),Gee=it(),Oqe=it(),jee=it(),Hee=it(),kk=I(),Uk=[],Wee=Ne(),qee=new Array(64),Gc=it(),Zw=it(),hv=[it(),it(),it(),it()],Ds=it(),zk=it(),A0=it(),$C=it(),Xw=it(),Yw=it(),$M=it();function Rqe(t,e,i,r,n,s,o,a){bi(Gc,0,0);for(let N=0;N<4;++N)Ud(Gc,Gc,t[N]);gc(Gc,Gc,.25),bi(Zw,0,0);for(let N=4;N<8;++N)Ud(Zw,Zw,t[N]);gc(Zw,Zw,.25),_h(hv[0],t[4],t[5],.5),_h(hv[1],t[5],t[6],.5),_h(hv[2],t[6],t[7],.5),_h(hv[3],t[7],t[4],.5);let l=0,c=yD(hv[0],Gc);for(let N=1;N<4;++N){const $=yD(hv[N],Gc);$<c&&(c=$,l=N)}Tf(Ds,hv[l],t[l+4]);const u=Ds[0];let p,f;Ds[0]=-Ds[1],Ds[1]=u,Tf(zk,Zw,Gc),ws(zk,Ds)<0&&bH(Ds,Ds),_h(Ds,Ds,zk,i),GP(Ds,Ds),p=f=ws(Tf(A0,t[0],Gc),Ds);for(let N=1;N<8;++N){const $=ws(Tf(A0,t[N],Gc),Ds);$<p?p=$:$>f&&(f=$)}Is(r,Gc),gc(A0,Ds,p-e),Ud(r,r,A0);let y=-1,v=1,b=0,x=0;for(let N=0;N<8;++N){Tf($C,t[N],r),GP($C,$C);const $=Ds[0]*$C[1]-Ds[1]*$C[0];$>0?$>y&&(y=$,b=N):$<v&&(v=$,x=N)}Ow(y>0,"leftArea"),Ow(v<0,"rightArea"),gc(Xw,Ds,p),Ud(Xw,Xw,Gc),gc(Yw,Ds,f),Ud(Yw,Yw,Gc),$M[0]=-Ds[1],$M[1]=Ds[0];const S=FR(r,t[x],Yw,Ud(A0,Yw,$M),1,n),P=FR(r,t[b],Yw,A0,1,s),C=FR(r,t[b],Xw,Ud(A0,Xw,$M),1,o),R=FR(r,t[x],Xw,A0,1,a);Ow(S,"rayRay"),Ow(P,"rayRay"),Ow(C,"rayRay"),Ow(R,"rayRay")}function Ii(t,e){return 3*e+t}const Zee=it();function Hl(t,e){return bi(Zee,t[e],t[e+3]),Zee}const fl=it(),pt=on();function Mqe(t,e,i,r,n){Tf(fl,i,r),gc(fl,fl,.5),pt[0]=fl[0],pt[1]=fl[1],pt[2]=0,pt[3]=fl[1],pt[4]=-fl[0],pt[5]=0,pt[6]=fl[0]*fl[0]+fl[1]*fl[1],pt[7]=fl[0]*fl[1]-fl[1]*fl[0],pt[8]=1,pt[Ii(0,2)]=-ws(Hl(pt,0),t),pt[Ii(1,2)]=-ws(Hl(pt,1),t);let s=ws(Hl(pt,0),i)+pt[Ii(0,2)],o=ws(Hl(pt,1),i)+pt[Ii(1,2)],a=ws(Hl(pt,0),r)+pt[Ii(0,2)],l=ws(Hl(pt,1),r)+pt[Ii(1,2)];s=-(s+a)/(o+l),pt[Ii(0,0)]+=pt[Ii(1,0)]*s,pt[Ii(0,1)]+=pt[Ii(1,1)]*s,pt[Ii(0,2)]+=pt[Ii(1,2)]*s,s=1/(ws(Hl(pt,0),i)+pt[Ii(0,2)]),o=1/(ws(Hl(pt,1),i)+pt[Ii(1,2)]),pt[Ii(0,0)]*=s,pt[Ii(0,1)]*=s,pt[Ii(0,2)]*=s,pt[Ii(1,0)]*=o,pt[Ii(1,1)]*=o,pt[Ii(1,2)]*=o,pt[Ii(2,0)]=pt[Ii(1,0)],pt[Ii(2,1)]=pt[Ii(1,1)],pt[Ii(2,2)]=pt[Ii(1,2)],pt[Ii(1,2)]+=1,s=ws(Hl(pt,1),e)+pt[Ii(1,2)],o=ws(Hl(pt,2),e)+pt[Ii(2,2)],a=ws(Hl(pt,1),i)+pt[Ii(1,2)],l=ws(Hl(pt,2),i)+pt[Ii(2,2)],s=-.5*(s/o+a/l),pt[Ii(1,0)]+=pt[Ii(2,0)]*s,pt[Ii(1,1)]+=pt[Ii(2,1)]*s,pt[Ii(1,2)]+=pt[Ii(2,2)]*s,s=ws(Hl(pt,1),e)+pt[Ii(1,2)],o=ws(Hl(pt,2),e)+pt[Ii(2,2)],a=-o/s,pt[Ii(1,0)]*=a,pt[Ii(1,1)]*=a,pt[Ii(1,2)]*=a,n[0]=pt[0],n[1]=pt[1],n[2]=0,n[3]=pt[2],n[4]=pt[3],n[5]=pt[4],n[6]=0,n[7]=pt[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=pt[6],n[13]=pt[7],n[14]=0,n[15]=pt[8]}function $qe(t,e,i,r,n){const s=1/ph[0][3],o=1/ph[4][3];xt(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(qs(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,Rqe(ph,a,l,Vee,Gee,Oqe,jee,Hee),Mqe(Vee,Gee,jee,Hee,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}function Iqe(t){return bp(t)&&t.intersector===sn.TERRAIN&&!!t.target}let Lqe=class extends d4{constructor(e,i,r){super(e,i),this.triangleNr=r}};function Pve(t){return bp(t)&&t.intersector===sn.OVERLAY&&!!t.target}let Z7=class{constructor(){this.adds=new ri,this.removes=new ri,this.updates=new ri({allocator:e=>e||new Dqe,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},Dqe=class{},Nqe=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var hn,zs;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(hn||(hn={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(zs||(zs={}));function Ove(t){const e=new Map,i=r=>{let n=e.get(r);return n||(n=new Nqe,e.set(r,n)),n};return t.removes.forAll(r=>{Bk(r)&&i(r.material).removes.push(r)}),t.adds.forAll(r=>{Bk(r)&&i(r.material).adds.push(r)}),t.updates.forAll(r=>{Bk(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),e}function Bk(t){return t.geometry.indexCount>=1}let Rve=class{constructor(e,i){this._material=e,this._repository=i,this._map=new Map}destroy(){this._map.forEach((e,i)=>{e!=null&&this._repository.release(this._material,i)})}load(e,i,r){if(!this._material.requiresSlot(i,r))return null;this._map.has(r)||this._map.set(r,this._repository.acquire(this._material,i,r));const n=this._map.get(r);if(n!=null){if(n.ensureResources(e)===_g.LOADED)return n;this._repository.requestRender()}return null}};function cO(t,e){switch(e.normalType){case Wi.Compressed:t.attributes.add(M.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(T`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case Wi.Attribute:t.attributes.add(M.NORMAL,"vec3"),t.vertex.code.add(T`vec3 normalModel() {
return normal;
}`);break;case Wi.ScreenDerivative:t.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case Wi.COUNT:case Wi.Ground:}}var Wi;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(Wi||(Wi={}));function U4(t,e){switch(e.normalType){case Wi.Attribute:case Wi.Compressed:t.include(cO,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new jP("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new Jh("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)),t.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case Wi.Ground:t.include(j2,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(T`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case Wi.ScreenDerivative:t.vertex.code.add(T`void forwardNormal() {}`);break;default:e.normalType;case Wi.COUNT:}}let Mve=class extends Ume{constructor(){super(...arguments),this.transformNormalViewFromGlobal=on()}},$ve=class extends zme{constructor(){super(...arguments),this.transformNormalGlobalFromModel=on(),this.toMapSpace=gi()}},X7=class extends $ve{constructor(e=I()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},AS=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(M.POSITION).length}write(e,i,r,n,s){a_e(r,this.vertexBufferLayout,e,i,n,s)}};const Fqe=ln().vec3f(M.POSITION),kqe=ln().vec3f(M.POSITION).vec2f(M.UV0),Uqe=ln().vec3f(M.POSITION).vec4u8(M.COLOR);ln().vec3f(M.POSITION).vec4u8(M.OBJECTANDLAYERIDCOLOR);const zqe=ln().vec3f(M.POSITION).vec2f(M.UV0).vec4u8(M.OBJECTANDLAYERIDCOLOR);ln().vec3f(M.POSITION).vec4u8(M.COLOR).vec4u8(M.OBJECTANDLAYERIDCOLOR);let pq=class extends Ly{intersect(e,i,r,n,s,o){return X0e(e,r,n,s,void 0,o)}};function Bqe(t){t.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function Vqe(t){t.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let uO=class extends On{constructor(e,i){super(e,"int",vr.Pass,(r,n,s)=>r.setUniform1i(e,i(n,s)))}},Gqe=class extends On{constructor(e,i,r){super(e,"mat4",vr.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,i(s,o,a)),r)}},jqe=class extends On{constructor(e,i,r){super(e,"mat4",vr.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,i(s,o)),r)}},Hqe=class extends wr{constructor(){super(...arguments),this.origin=I()}},Wqe=class extends Hqe{},qqe=class extends wr{constructor(){super(...arguments),this.modelTransformation=Os}},fq=class extends qqe{constructor(){super(...arguments),this.origin=I()}};function z4(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new jqe("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),Ive(t))}function Rb(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new Gqe("shadowMapMatrix",(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),Ive(t))}function Ive(t){const e=t.fragment;e.include(Ac),e.uniforms.add(new vt("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new uO("numCascades",(i,r)=>r.shadowMap.numCascades),new yi("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances)),e.code.add(T`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function Xee(t){t.fragment.uniforms.add(new vt("texWaveNormal",e=>e.waveNormal),new vt("texWavePerturbation",e=>e.wavePertubation),new yi("waveParams",e=>Br(Zqe,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Bi("waveDirection",e=>bi(Xqe,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(Bqe),t.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const Zqe=gi(),Xqe=it();function s3(t,e){e.spherical?t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function Yqe(t){const e=t.fragment.code;e.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function mq(t,e){const i=t.fragment.code;t.include(W3),e.pbrMode!==Ct.Normal&&e.pbrMode!==Ct.Schematic&&e.pbrMode!==Ct.Terrain&&e.pbrMode!==Ct.TerrainWithWater||(i.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Ct.Normal&&e.pbrMode!==Ct.Schematic||(t.include(Yqe),i.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function Jqe(t,e){const i=t.fragment.code;t.include(W3),i.add(T`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),i.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function Lve(t,e){t.include(Jqe,e),t.include(Q5),t.include(Vqe),e.hasCloudsReflections&&t.include(ame,e),e.hasScreenSpaceReflections&&t.include(fke,e);const i=t.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add(new je("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new je("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&i.code.add(T`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(i.uniforms.add(new en("view",(r,n)=>n.ssr.camera.viewMatrix),new vt("lastFrameColorTexture",(r,n)=>n.ssr.lastFrameColorTexture),new je("fadeFactorSSR",(r,n)=>n.ssr.fadeFactor)),i.code.add(T`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):i.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?i.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(T`return waterRenderedColor;
}`)}function Kqe(t){const e=new Fi,{vertex:i,fragment:r}=e;Tc(i,t),e.include(Ml,t),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.UV0,"vec2");const n=new yi("waterColor",s=>s.color);if(t.output===j.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Mo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(n),r.code.add(T`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==j.Color&&t.output!==j.Alpha||(e.include(s3,t),e.include(vS,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.uniforms.add(n),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Mo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===j.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Au,t),t.output){case j.Alpha:e.include(Nn,t),r.uniforms.add(n),r.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case j.Color:e.include(vD),e.include(RH,{pbrMode:Ct.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(Xee),e.include(Nn,t),e.include(Rb,t),e.include(Lve,t),r.uniforms.add(n,new je("timeElapsed",s=>s.timeElapsed),i.uniforms.get("view"),i.uniforms.get("localOrigin")),gp(r,t),r.include(am),jg(r),om(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===At.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case j.Normal:e.include(s3,t),e.include(Xee,t),e.include(Nn,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),i.uniforms.add(n),i.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Mo)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new je("timeElapsed",s=>s.timeElapsed)),r.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case j.Highlight:e.include(Kg,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Mo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(Nn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case j.ObjectAndLayerIdColor:e.include(iO,t),e.varyings.add("vpos","vec3"),i.uniforms.add(n),i.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Mo)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(Nn,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const Qqe=Object.freeze(Object.defineProperty({__proto__:null,build:Kqe},Symbol.toStringTag,{value:"Module"}));let Dve=class Nve extends qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ke.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gi(e.rctx,Nve.shader.get().build(this.configuration),Ni)}_setPipelineState(e){const i=this.configuration,r=e===At.NONE,n=e===At.FrontFace;return Zt({blending:i.output!==j.Normal&&i.output!==j.Highlight&&i.output!==j.ObjectAndLayerIdColor&&i.transparent?r?vu:Qg(e):null,depthTest:{func:Dy(e)},depthWrite:r?i.writeDepth?Nl:null:E4(e),colorWrite:ni,polygonOffset:r||n?null:O4(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Dve.shader=new Vi(Qqe,()=>Oe(()=>import("./WaterSurface.glsl-b816c004.js"),[],import.meta.url));let Ks=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.transparencyPassType=At.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};d([q({count:j.COUNT})],Ks.prototype,"output",void 0),d([q({count:At.COUNT})],Ks.prototype,"transparencyPassType",void 0),d([q()],Ks.prototype,"spherical",void 0),d([q()],Ks.prototype,"receiveShadows",void 0),d([q()],Ks.prototype,"hasSlicePlane",void 0),d([q()],Ks.prototype,"transparent",void 0),d([q()],Ks.prototype,"enableOffset",void 0),d([q()],Ks.prototype,"writeDepth",void 0),d([q()],Ks.prototype,"hasScreenSpaceReflections",void 0),d([q()],Ks.prototype,"doublePrecisionRequiresObfuscation",void 0),d([q()],Ks.prototype,"hasCloudsReflections",void 0),d([q()],Ks.prototype,"objectAndLayerIdColorInstanced",void 0),d([q()],Ks.prototype,"isDraped",void 0),d([q()],Ks.prototype,"hasMultipassTerrain",void 0),d([q()],Ks.prototype,"cullAboveGround",void 0),d([q({constValue:Ct.Water})],Ks.prototype,"pbrMode",void 0),d([q({constValue:!0})],Ks.prototype,"useCustomDTRExponentForWater",void 0),d([q({constValue:!0})],Ks.prototype,"highStepCount",void 0),d([q({constValue:!1})],Ks.prototype,"useFillLights",void 0);let eZe=class extends $y{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const i=e.cloudsFade.data!=null;i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===j.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Dve,e)}},Fve=class extends pq{constructor(e){super(e,new kve),this._configuration=new Ks,this.animation=new fge}getConfiguration(e,i){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<A4,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}update(e){const i=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<tZe;const r=this.animation.advance(e);return this.setParameters({timeElapsed:aG(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}requiresSlot(e,i){switch(i){case j.Normal:return e===Te.DRAPED_WATER;case j.Color:if(this.parameters.isDraped)return e===Te.DRAPED_MATERIAL;break;case j.Alpha:break;case j.Highlight:case j.ObjectAndLayerIdColor:return e===Te.OPAQUE_MATERIAL||e===Te.DRAPED_MATERIAL;default:return!1}let r=Te.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===r}createGLMaterial(e){return new eZe(e)}createBufferWriter(){return new AS(ge("enable-feature:objectAndLayerId-rendering")?zqe:kqe)}},kve=class extends IW{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Ri(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=Kt(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=I(),this.modelTransformation=null}};const tZe=35e3;let gq=class{constructor(e=0,i=0){this.from=e,this.to=i}get numElements(){return this.to-this.from}};function Yee(t){const e=new Map;t.forAll(r=>e.set(r.from,r));let i=!0;for(;i;)i=!1,t.forEach(r=>{const n=e.get(r.to);n&&(r.to=n.to,e.delete(n.from),t.removeUnordered(n),i=!0)})}let Jee=class extends gq{constructor(e,i,r){super(i,r),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},iZe=class{constructor(){this.first=0,this.count=0}},rZe=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new ri({allocator:e=>e||new gq,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=IM(),this.drawCommandsHighlight=IM(),this.drawCommandsOccludees=IM(),this.drawCommandsShadowHighlightRest=IM()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,i){this.deleteInstance(e),this._instances.set(e,i),this._numElements+=i.numElements}deleteInstance(e){const i=this._instances.get(e);i&&(this._numElements-=i.numElements,this._instances.delete(e))}updateInstance(e,i,r){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=i,n.to=r,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const r=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(r.first=0,void(r.count=n.from)):(r.first=1/0,r.count=0,this._instances.forEach(s=>{r.first=Math.min(r.first,s.from),r.count=Math.max(r.count,s.to)}),void(r.count-=r.first))}const i=Array.from(this._instances.values()).sort((r,n)=>r.from===n.from?r.to-n.to:r.from-n.from);for(const r of i)r.isVisible&&(Kee(r.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,r),Kee(r.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,r))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function nZe(t){return t.vao!=null}function IM(){return new ri({allocator:t=>t||new iZe,deallocator:t=>t})}function Kee(t,e){const i=t.back();if(i==null){const r=t.pushNew();return r.first=e.from,void(r.count=e.numElements)}if(sZe(i,e)){const r=e.from-i.first+e.numElements;i.count=r}else{const r=t.pushNew();r.first=e.from,r.count=e.numElements}}function sZe(t,e){return t.first+t.count>=e.from}let oZe=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(i=>i.instances.has(e))}};const XI=-3;var sg;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(sg||(sg={}));let aZe=class{constructor(e,i,r){this.name=e,this._storage=i,this.id=lZe+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),r&&(this._storage.registerRemoveFunc(this.id,r),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,i,r,n=0){this._storage.put(this,e,i,r,n)}get(e){const i=this._storage.get(this,e);return i===void 0?++this._miss:++this._hit,i}pop(e){const i=this._storage.pop(this,e);return i===void 0?++this._miss:++this._hit,i}updateSize(e,i,r){this._storage.updateSize(this,e,i,r)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},Uve=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new ri,this._users=new ri}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,i){this._removeFuncs.push([e,i])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(i=>i[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,i,r,n,s){i=e.id+i;const o=this._db.get(i);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(i),o.entry!==r&&this._notifyRemove(i,o.entry,sg.ALL)),n>this._maxSize)return void this._notifyRemove(i,r,sg.ALL);if(r===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return void console.warn("Refusing to cache entry with invalid size "+n);const a=1+Math.max(s,XI)-XI;this._db.set(i,{entry:r,size:n,lifetime:a,lives:a}),this._size+=n,e.size+=n,this._checkSizeLimits()}updateSize(e,i,r,n){i=e.id+i;const s=this._db.get(i);if(s&&s.entry===r){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(i,r,sg.SOME);if(!(o!=null&&o>0))return void this._db.delete(i);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSizeLimits()}}pop(e,i){i=e.id+i;const r=this._db.get(i);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(i),++this._hit,r.entry;++this._miss}get(e,i){i=e.id+i;const r=this._db.get(i);if(r!==void 0)return this._db.delete(i),r.lives=r.lifetime,this._db.set(i,r),++this._hit,r.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:p}=c;if(a.startsWith(u)){const f=i[p]||0;i[p]=f+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(i);s.sort((o,a)=>i[a]-i[o]),s.forEach(o=>e[o]=Math.round(i[o]/2**20)+"MB / "+n[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(e["Priority "+(o+XI-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const i=e.id;this._db.forEach((r,n)=>{n.startsWith(i)&&(this._size-=r.size,this._db.delete(n),this._notifyRemove(n,r.entry,sg.ALL))}),e.size=0}clearAll(){this._db.forEach((e,i)=>this._notifyRemove(i,e.entry,sg.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,i,r){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](i,r);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,i]of this._db)if(this._purgeItem(e,i),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[i,r]of this._db)if(i.startsWith(e.id)&&(this._purgeItem(i,r,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,i,r=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),i.lives<=1){this._size-=i.size,r&&(r.size-=i.size);const n=this._notifyRemove(e,i.entry,sg.SOME);n!=null&&n>0&&(this._size+=n,r&&(r.size+=n),i.lives=i.lifetime,i.size=n,this._db.set(e,i))}else--i.lives,this._db.set(e,i)}},lZe=0;const cZe=XI+1;let uZe=class{constructor(e,i,r){this._rctx=e,this._locations=i,this._layout=r,this._cache=e.newCache("VaoCache",hZe)}dispose(){this._cache.destroy()}newVao(e){const i=e.toString(),r=this._cache.pop(i);if(r!=null){const s=r.pop();return r.length>0&&this._cache.put(i,r,e*r.length,cZe),s}const n=new vp(this._rctx,this._locations,{geometry:this._layout},{geometry:Ki.createVertex(this._rctx,zi.STATIC_DRAW)});return n.vertexBuffers.geometry.setSize(e),n}deleteVao(e){if(e==null)return null;const i=e.byteSize,r=i.toString(),n=this._cache.pop(r);return n!=null?(n.push(e),this._cache.put(r,n,i*n.length,-1)):this._cache.put(r,[e],i,-1),null}};function hZe(t,e){if(e===sg.ALL)return void t.forEach(n=>n.dispose());const i=t.pop(),r=t.length*i.byteSize;return i.dispose(),r}let zve=class{constructor(e,i,r){this._rctx=e,this._materialRepository=i,this.material=r,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Rve(this.material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._vaoCache=new uZe(e,r.vertexAttributeLocations,Pc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof Fve}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==Kr.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(i=>e+=i.buffers.reduce((r,n)=>r+n.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(i=>i.buffers.forEach(r=>r.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(zs.GEOMETRY|zs.TRANSFORMATION)){const c=FM(i.elementCount(l.geometry.geometry)*r),u=i.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*r,0,l.numElements*r),kM()}n.updateType&(zs.HIGHLIGHT|zs.OCCLUDEE|zs.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,i){const r=new wS;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=r.get(s.id,null);o==null&&(o=new Qee(s.vec3),r.set(s.id,null,o)),o.changes.push(n)}for(const n of i){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)continue;let l=r.get(s.id,a);l==null&&(l=new Qee(s.vec3),r.set(s.id,a,l)),l.changes.push(n)}return r}_addAndRemoveGeometries(e,i){const{_bufferWriter:r,_dataByOrigin:n}=this,s=r.vertexBufferLayout.stride/4,o=this._computeDeltas(e,i);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let p=n.get(l);if(a.forEach((f,y)=>{if(o.delete(l,y),y==null)return void xt(!1,"No VAO for removed geometries");if(y.instances.size===f.changes.length)return this._vaoCache.deleteVao(y.vao),gP(p.buffers,y),void(p.buffers.length===0&&u.length===0&&n.delete(l));const v=y.numElements,b=y.vao.byteSize/4,x=u.reduce((R,N)=>R+r.elementCount(N.geometry),0),S=f.changes.reduce((R,N)=>R+r.elementCount(N.geometry),0),P=Math.min((v+x-S)*s,NM),C=P>b;P>oN&&P<b/2?(f.changes.forEach(({id:R})=>y.deleteInstance(R)),y.instances.forEach(({geometry:R})=>u.push(R)),this._vaoCache.deleteVao(y.vao),gP(p.buffers,y)):C?this._applyAndRebuild(y,u,f):this._applyRemoves(y,f)}),u.length>0)for(p==null&&(p=new oZe(c.origin),n.set(l,p)),p.buffers.forEach(f=>this._applyAdds(f,u));u.length>0;)p.buffers.push(this._applyAndRebuild(new rZe,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(i=>{i.drawCommandsDirty&&(i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,Yo(i.instances,r=>(i.updateDrawState(r),i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees)),i.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||i.hasHighlights,this._hasOccludees=this._hasOccludees||i.hasOccludees})})}_applyAndRebuild(e,i,r){if(r!=null)for(const v of r.changes)e.deleteInstance(v.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(NM/o);let l=e.numElements;for(;i.length>0;){const v=i.pop(),b=n.elementCount(v.geometry);if(l+b>a&&l>0){i.push(v);break}l+=b;const x=new Jee(v,0,0);xt(e.instances.get(v.id)==null),e.addInstance(v.id,x)}const c=l*o,u=FM(c),p=n.vertexBufferLayout.createView(u.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((v,b)=>{this._writeGeometry(v.geometry,p,f);const x=f;f+=n.elementCount(v.geometry.geometry),e.updateInstance(b,x,f),e.updateDrawState(v)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(ite(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,f*o),kM(),e.holes.clear();const y=e.holes.pushNew();return y.from=f,y.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,i){if(i.changes.length===0)return;for(const a of i.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Np.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const p=Np.pushNew();p.from=c.from,p.to=c.to}Yee(Np);const r=this._bufferWriter.vertexBufferLayout.stride/4,n=Np.reduce((a,l)=>Math.max(a,l.numElements),0)*r,s=FM(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;Np.forAll(a=>o.setSubData(s,a.from*r,0,a.numElements*r)),kM(),e.holes.pushArray(Np.data,Np.length),Np.forAll((a,l)=>Np.data[l]=null),Np.clear(),e.drawCommandsDirty=!0}_applyAdds(e,i){if(i.length===0)return;if(!nZe(e))return void this._applyAndRebuild(e,i,null);const r=this._bufferWriter,n=r.vertexBufferLayout.stride/4,s=e.numElements,o=i.reduce((S,P)=>S+r.elementCount(P.geometry),0),a=Math.min((s+o)*n,NM),l=4*a;if(e.vao.byteSize<ite(NM-oN)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,i,null);Yee(e.holes);const c=new Array;for(const S of i){const P=r.elementCount(S.geometry),C=dZe(e.holes,P);c.push(C)}const u=e.vao.vertexBuffers.geometry;let p=0,f=0,y=0;const v=FM(a),b=r.vertexBufferLayout.createView(v.buffer);i.forEach((S,P)=>{const C=c[P];if(C==null)return;if(y!==C){const $=y-f;$>0&&u.setSubData(v,f*n,0,$*n),f=C,p=0}const R=r.elementCount(S.geometry);this._writeGeometry(S,b,p),p+=R,y=C+R;const N=new Jee(S,C,C+R);xt(e.instances.get(S.id)==null),e.addInstance(S.id,N),e.drawCommandsDirty=!0});const x=y-f;x>0&&u.setSubData(v,f*n,0,x*n),KTe(i,(S,P)=>c[P]==null),kM()}_writeGeometry(e,i,r){const n=e.localOrigin.vec3;MFe(ete,-n[0],-n[1],-n[2]);const s=Cr(pZe,ete,e.transformation);fo(LM,s),Cc(LM,LM),this._bufferWriter.write(s,LM,e.geometry,i,r)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,i){return this.material.requiresSlot(e,i)}prepareTechnique(e){const{output:i,bindParameters:r}=e;if(!this.requiresSlot(r.slot,i))return null;const n=i===j.Highlight||i===j.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=i===j.ShadowExcludeHighlight,o=!(n||s);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(n&&!l.hasHighlights)continue;const c=(n?l.drawCommandsHighlight:s&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,u=o&&l.drawCommandsOccludees||null;if(c!=null&&c.length||u!=null&&u.length){const p=this._glMaterials.load(e.rctx,r.slot,i),f=p!=null?p.beginSlot(r):null;if(f!=null)return f}}return null}render(e,i){var c;const{output:r,bindParameters:n}=e,s=r===j.Highlight||r===j.ShadowHighlight,o=r===j.ShadowExcludeHighlight,a=!(s||o),l=this._rctx;(c=l.appleAmdDriverHelper)==null||c.resetIndicesType(),l.bindTechnique(i,this.material.parameters,n);for(const u of this._dataByOrigin.values())for(const p of u.buffers){if(s&&!p.hasHighlights)continue;const f=(s?p.drawCommandsHighlight:o&&p.needsMultipleCommands()?p.drawCommandsShadowHighlightRest:p.drawCommandsDefault)||null,y=a&&p.drawCommandsOccludees||null;(f!=null&&f.length||y!=null&&y.length)&&(i.program.bindDraw(new X7(u.origin),n,this.material.parameters),i.ensureAttributeLocations(p.vao),l.bindVAO(p.vao),f!=null&&f.length&&(i.bindPipelineState(l,n.slot,!1),f.forAll(v=>l.drawArrays(i.primitiveType,v.first,v.count))),y!=null&&y.length&&(i.bindPipelineState(l,n.slot,!0),y.forAll(v=>l.drawArrays(i.primitiveType,v.first,v.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},Qee=class{constructor(e){this.origin=e,this.changes=new Array}};function dZe(t,e){let i;if(!t.some(n=>!(n.numElements<e)&&(i=n,!0)))return null;const r=i.from;return i.from+=e,i.from>=i.to&&t.removeUnordered(i),r}const ete=Ne(),pZe=Ne(),LM=Ne(),Np=new ri({allocator:t=>t||new gq,deallocator:null}),oN=65536,DM=4*oN,tte=1024,Bve=16777216,NM=Bve/4;let YI=new Float32Array(oN);function FM(t){return YI.length<t&&(YI=new Float32Array(t)),YI}function ite(t){const e=4*t;return e<=tte?tte:e<DM?DM:Math.max(Math.min(Math.ceil(1.5*e/DM)*DM,Bve),e)}function kM(){YI=new Float32Array(2)}let Jc=class extends ke{constructor(e){super(e),this._pending=new fZe,this._changes=new Z7,this._materialRenderers=new Map,this._sortedMaterialRenderers=new ri,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Yo(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=Ove(this._changes);let i=!1,r=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.get(o);if(!a&&s.adds.length>0&&(a=new zve(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),i=!0,r=!0,n=!0),!a)return;const l=r||a.hasHighlights,c=n||a.hasWater;a.modify(s),r=r||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),i=!0)}),this._changes.clear(),i&&this._updateSortedMaterialRenderers(),r&&(this._hasHighlights=Yo(this._materialRenderers,s=>s.hasHighlights)),n&&(this._hasWater=Yo(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,i){if(e.length===0)return;const r=this._validateRenderGeometries(e);for(const s of r)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of r)this._pending.adds.add(s);n&&this.notifyChange("updating"),i===hn.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,i){const r=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);r&&!this._pending.empty&&this.notifyChange("updating"),i===hn.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,i){const r=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=i}switch(r&&this._changes.updates.length>0&&this.notifyChange("updating"),i){case zs.TRANSFORMATION:case zs.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case zs.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let i=!1;return this._sortedMaterialRenderers.forAll(r=>i=r.updateAnimation(e)||i),i}render(e){this._sortedMaterialRenderers.forAll(i=>{if(i.material.shouldRender(e)){const r=i.prepareTechnique(e);r!=null&&i.render(e,r)}})}intersect(e,i,r,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,r,i,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,r,i,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,r,i,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((i,r)=>{r.insertOrder=e++,this._sortedMaterialRenderers.push(i)}),this._sortedMaterialRenderers.sort((i,r)=>{const n=r.material.renderPriority-i.material.renderPriority;return n!==0?n:i.material.insertOrder-r.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const i=this._changes.updates.data[e];this._pending.has(i.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,i,r,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],Vk[0]=r[0]-n,Vk[1]=r[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,Vk,(l,c,u)=>{mZe(i,u,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},i)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicGeometryChanged(n),i=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let i;for(const r of e){const n=r.graphicUid;n!=null&&n!==i&&(this.drapeSource.notifyGraphicVisibilityChanged(n),i=n)}}_validateRenderGeometries(e){for(const i of e)this._validateRenderGeometry(i);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};d([m()],Jc.prototype,"drapeSource",void 0),d([m()],Jc.prototype,"updating",null),d([m()],Jc.prototype,"rctx",null),d([m()],Jc.prototype,"rendererContext",void 0),d([m()],Jc.prototype,"_materialRepository",null),d([m()],Jc.prototype,"_localOriginFactory",null),d([m({readOnly:!0})],Jc.prototype,"isEmpty",null),d([m()],Jc.prototype,"_materialRenderers",void 0),d([m()],Jc.prototype,"_geometries",void 0),Jc=d([J("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Jc);let fZe=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function mZe(t,e,i,r,n,s,o){const a=new Lqe(s,o,e),l=c=>{c.set(sn.OVERLAY,a,t.dist,t.normal,t.transformation,i,r)};if((n.results.min.drapedLayerOrder==null||i>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Do.MIN&&(n.results.max.drapedLayerOrder==null||i<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Do.ALL){const c=nW(n.ray);l(c),n.results.all.push(c)}}const Vk=it();let _q=class extends On{constructor(e,i){super(e,"vec2",vr.Draw,(r,n,s,o)=>r.setUniform2fv(e,i(n,s,o)))}};const Gk=4;function gZe(){const t=new Fi,e=t.fragment;t.include(Yh);const i=(Gk+1)/2,r=1/(2*i*i);return e.include(Eu),e.uniforms.add(new vt("depthMap",n=>n.depthTexture),new $h("tex",n=>n.colorTexture),new _q("blurSize",n=>n.blurSize),new je("projScale",(n,s)=>{const o=Nr(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new Bi("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(T`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${T.float(r)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(T`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${T.int(Gk)}; r <= ${T.int(Gk)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const _Ze=Object.freeze(Object.defineProperty({__proto__:null,build:gZe},Symbol.toStringTag,{value:"Module"}));let Vve=class Gve extends qi{initializeProgram(e){return new Gi(e.rctx,Gve.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:ni})}};Vve.shader=new Vi(_Ze,()=>Oe(()=>import("./SSAOBlur.glsl-12073cf6.js"),[],import.meta.url));const yZe="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function B4(t){t.fragment.uniforms.add(new yi("projInfo",(e,i)=>vZe(i))),t.fragment.uniforms.add(new Bi("zScale",(e,i)=>jve(i))),t.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function vZe(t){const e=t.camera.projectionMatrix;return e[11]===0?Br(rte,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Br(rte,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const rte=gi();function jve(t){return t.camera.projectionMatrix[11]===0?bi(nte,0,1):bi(nte,1,0)}const nte=it(),ste=16;function bZe(){const t=new Fi,e=t.fragment;return t.include(Yh),e.include(Eu),t.include(B4),e.uniforms.add(new je("radius",(i,r)=>yq(r.camera))),e.code.add(T`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Bi("nearFar",(i,r)=>r.camera.nearFar),new vt("normalMap",i=>i.normalTexture),new vt("depthMap",i=>i.depthTexture),new Bi("zScale",(i,r)=>jve(r)),new je("projScale",i=>i.projScale),new vt("rnm",i=>i.noiseTexture),new Bi("rnmScale",(i,r)=>bi(ote,r.camera.fullWidth/i.noiseTexture.descriptor.width,r.camera.fullHeight/i.noiseTexture.descriptor.height)),new je("intensity",i=>i.intensity),new Bi("screenSize",(i,r)=>bi(ote,r.camera.fullWidth,r.camera.fullHeight))),e.code.add(T`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${T.int(ste)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${T.int(ste)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function yq(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const ote=it(),wZe=Object.freeze(Object.defineProperty({__proto__:null,build:bZe,getRadius:yq},Symbol.toStringTag,{value:"Module"}));let Hve=class Wve extends qi{initializeProgram(e){return new Gi(e.rctx,Wve.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:ni})}};Hve.shader=new Vi(wZe,()=>Oe(()=>import("./SSAO.glsl-72c93d8d.js"),[],import.meta.url));let xZe=class extends wr{constructor(){super(...arguments),this.projScale=1}},TZe=class extends xZe{constructor(){super(...arguments),this.intensity=1}},SZe=class extends wr{},CZe=class extends SZe{constructor(){super(...arguments),this.blurSize=it()}};const rA=2;let qve=class{constructor(e,i,r,n){this._view=e,this._techniqueRepository=i,this._rctx=r,this._requestRender=n,this._quadVAO=null,this._passParameters=new TZe,this._drawParameters=new CZe}dispose(){this.enabled=!1,this._quadVAO=et(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){var e,i;(e=this._ssaoFBO)==null||e.resize(0,0),(i=this._blurFBO)==null||i.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){var e;return(e=this._ssaoFBO)==null?void 0:e.colorTexture}render(e,i,r,n){if(this._enableTime==null||r==null||n==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=i,void this._requestRender();this._enableTime===0&&(this._enableTime=i);const s=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,i-this._enableTime)/a:1;this._passParameters.normalTexture=n,this._passParameters.depthTexture=r,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*EZe/yq(o)**6*l;const c=o.fullViewport,u=c[2],p=c[3],f=u/rA,y=p/rA;this._ssaoFBO.resize(u,p),this._blurFBO.resize(f,y),this._quadVAO==null&&(this._quadVAO=Fl(this._rctx)),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,u,p),s.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),s.bindVAO(this._quadVAO);const v=Jo(this._quadVAO,"geometry");s.drawArrays(Ht.TRIANGLE_STRIP,0,v);const b=s.bindTechnique(this._blurTechnique,this._passParameters,e);s.setViewport(0,0,f,y),s.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,bi(this._drawParameters.blurSize,0,rA/p),b.bindDraw(this._drawParameters,e,this._passParameters),s.setViewport(0,0,f,y),s.drawArrays(Ht.TRIANGLE_STRIP,0,v),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,u,p),s.setClearColor(1,1,1,0),s.clear(Vr.COLOR_BUFFER_BIT),s.setViewport(0,0,f,y),this._drawParameters.colorTexture=this._blurFBO.colorTexture,bi(this._drawParameters.blurSize,rA/u,0),b.bindDraw(this._drawParameters,e,this._passParameters),s.drawArrays(Ht.TRIANGLE_STRIP,0,v),s.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new Di;e.wrapMode=Jt.CLAMP_TO_EDGE,this._ssaoFBO=new Rs(this._rctx,e),this._blurFBO=new Rs(this._rctx,e);const i=Uint8Array.from(atob(yZe),r=>r.charCodeAt(0));e.pixelFormat=Gt.RGB,e.wrapMode=Jt.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Wt(this._rctx,e,i),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(Hve)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(Vve)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=et(this._passParameters.noiseTexture),this._blurFBO=et(this._blurFBO),this._ssaoFBO=et(this._ssaoFBO)}get gpuMemoryUsage(){var e,i;return(((e=this._blurFBO)==null?void 0:e.gpuMemoryUsage)??0)+(((i=this._ssaoFBO)==null?void 0:i.gpuMemoryUsage)??0)}};const EZe=.5;let vq=class Zve extends qi{initializeProgram(e){return new Gi(e.rctx,Zve.shader.get().build(),Ni)}initializePipeline(){return this.configuration.hasAlpha?Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni}):Zt({colorWrite:ni})}};vq.shader=new Vi(jWe,()=>Oe(()=>import("./TextureOnly.glsl-733f88e0.js"),[],import.meta.url));let bq=class extends Oa{constructor(){super(...arguments),this.hasAlpha=!1}};d([q()],bq.prototype,"hasAlpha",void 0);let af=class extends ke{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new an,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new ri,this._passParameters=new sve,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new It,this.worldToPCSRatio=1,this.events=new os,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:i,stippleTextureRepository:r,markerTextureRepository:n}=e;this._shaderTechniqueRepository=new ove({rctx:this._rctx,viewingMode:Ke.Local,stippleTextureRepository:r,markerTextureRepository:n,waterTextureRepository:i}),this._renderContext=new Ave(this._rctx,new dq(this._rctx,this.view.state.viewingMode),new qve(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([Pe(()=>i.updating,()=>this.events.emit("content-changed"),qn),Pe(()=>this.spatialReference,s=>this._localOriginFactory=new uq(s),qn),$l(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new ave(e.textureRepository,this._shaderTechniqueRepository,s=>{(s.renderOccluded&aN)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Te.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=nme(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=At.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new UH(Ge(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(Dt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=nn(this._debugTextureTechnique),this._passParameters.texture=et(this._passParameters.texture),this._bindParameters.highlightDepthTexture=et(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=Je(this._shaderTechniqueRepository),this._temporaryFBO=et(this._temporaryFBO),this._quadVAO=et(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Yo(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Jc)}createDrapeSourceRenderer(e,i,r){const n=this._renderers.get(e);n!=null&&n.destroy();const s=new i({...r,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(Pe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const i=this._renderers.get(e);i!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),i.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const i=USe();if(this._overlayRenderTarget!=null)for(const r of this._overlayRenderTarget.renderTargets){const n=this.overlays[Jr.INNER].validTargets[r.type];e=this._overlayRenderTarget.validateUsageForTarget(n,r,i)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(i=>i.hasTargetWithoutRasterImage=j$(e,r=>r.drapeTargetType===H7.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(i=>{i.hasDrapedFeatureSource=j$(e,r=>r.drapeSourceType===eP.Features),i.hasDrapedRasterSource=j$(e,r=>r.drapeSourceType===eP.RasterImage)})}ensureOverlays(e,i){this._overlays==null&&(this._overlayRenderTarget=new BWe(this._rctx),this._overlays=[new UQ(Jr.INNER,this._overlayRenderTarget),new UQ(Jr.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(i)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=et(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,i){let r=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||i(n))&&s.commitChanges()&&(r=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,r=!0,this._updateSortedDrapeSourceRenderers()),r&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Qa,e=>e.updatePolicy===Q_.SYNC)}get isEmpty(){return!Or.OVERLAY_DRAW_DEBUG_TEXTURE&&!Yo(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let i=!1;return this._renderers.forEach(r=>i=r.updateAnimation(e)||i),i}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,i,r){const n=e.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:s,contentPixelRatio:o}=r;this._screenToWorldRatio=o*e.mapUnitsPerPixel/OW;const a=i.output;if(this.isEmpty||a===j.Highlight&&!this.hasHighlights||a===j.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=i.fbo;if(!l.isValid())return!1;const c=2*e.resolution,u=e.resolution;l.resize(c,u);const p=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===j.Normal?Te.DRAPED_WATER:Te.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(p),e.index===Jr.INNER&&(p.setClearColor(0,0,0,0),p.clearSafe(Vr.COLOR_BUFFER_BIT)),i.type===xn.Occluded&&(this._renderContext.renderOccludedMask=aN),Or.OVERLAY_DRAW_DEBUG_TEXTURE&&i.type!==xn.Occluded)for(let f=0;f<n.numViews;f++)this._setViewParameters(n.extents[f],e),this._drawDebugTexture(e.resolution,PZe[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:f,renderer:y})=>{if(i.type===xn.ColorNoRasterImage&&f.drapeSourceType===eP.RasterImage)return;const{fullOpacity:v}=f,b=v!=null&&v<1&&a===j.Color;b&&(this.bindTemporaryFramebuffer(this._rctx,c,u),p.clearSafe(Vr.COLOR_BUFFER_BIT));for(let x=0;x<n.numViews;x++)this._setViewParameters(n.extents[x],e),y.render(this._renderContext);b&&this._temporaryFBO!=null&&(l.bind(p),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),v,e.index))}),p.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,i,r){this._temporaryFBO==null&&(this._temporaryFBO=new nve(e,!1)),this._temporaryFBO.resize(i,r),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,i,r,n){var o;let s=0;for(const a of this._renderers.values())s=((o=a.intersect)==null?void 0:o.call(a,e,i,r,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((i,r)=>{const n=e.indexOf(r.layer),s=n>=0,o=this._renderers.size*(r.renderGroup??(s?iN.MapLayer:iN.ViewLayer))+(s?n:0);this._sortedRenderers.push(new AZe(r,i,o))}),this._sortedRenderers.sort((i,r)=>i.index-r.index)}_setViewParameters(e,i){const r=this._camera;r.viewport=[0,0,i.resolution,i.resolution],Khe(r.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],r.near,r.far),B3(r.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Yo(this._renderers,i=>i.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Yo(this._renderers,i=>i.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Yo(this._renderers,i=>i.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,i){this._ensureDebugPatternResources(e,i);const r=this._rctx;r.bindTechnique(this._debugTextureTechnique,this._passParameters,null),r.bindVAO(this._quadVAO),r.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,i){if(me(this._passParameters.color,i[0],i[1],i[2]),this._passParameters.texture)return;const r=new Uint8Array(e*e*4);let n=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=255):(r[n++]=255,r[n++]=255,r[n++]=255,r[n++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const s=new Di(e);s.samplingMode=qt.NEAREST,this._passParameters.texture=new Wt(this._rctx,s,r);const o=new bq;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(vq,o),this._quadVAO=Fl(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};d([m()],af.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([m({autoDestroy:!0})],af.prototype,"_shaderTechniqueRepository",void 0),d([m({constructOnly:!0})],af.prototype,"view",void 0),d([m()],af.prototype,"worldToPCSRatio",void 0),d([m()],af.prototype,"spatialReference",void 0),d([m({type:Boolean,readOnly:!0})],af.prototype,"updating",null),d([m()],af.prototype,"isEmpty",null),af=d([J("esri.views.3d.terrain.OverlayRenderer")],af);let AZe=class{constructor(e,i,r){this.drapeSource=e,this.renderer=i,this.index=r}};const PZe=[[1,.5,.5],[.5,.5,1]],wq=-2,aN=Kr.OccludeAndTransparent;function xq(t,e,i,r){const n=lO(t.rings,!!t.hasZ,Yf.CCW_IS_HOLE),s=ia(n.position.length),o=uye(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,i,r),a=o!=null;return new MZe(n.position,s,Jve(n.polygons,n.position,s),Yve(n.outlines,n.position,s),a,o)}function Xve(t,e){const i=lO(t.rings,!1,Yf.CCW_IS_HOLE),r=_n(i.position,t.spatialReference,0,i.position,e,0,i.position.length/3);for(let n=2;n<i.position.length;n+=3)i.position[n]=wq;return{position:i.position,polygons:Jve(i.polygons,i.position),outlines:Yve(i.outlines,i.position),projectionSuccess:r}}function Yve(t,e,i=null){return t.filter(({count:r})=>r>1).map(({index:r,count:n})=>{const s=3*r,o=3*n;return i!=null?new Kve(r,n,Ih(e,s,o),Ih(i,s,o)):new Tq(r,n,Ih(e,s,o))})}function Jve(t,e,i=null){const r=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,u=o.map(f=>f-n),p=i!=null?new OZe(n,s,Ih(e,3*n,3*s),Ih(i,l,c),u,a):new RZe(n,s,Ih(e,3*n,3*s),u,a);r.push(p)}return r}let Tq=class{constructor(e,i,r){this.index=e,this.count=i,this.position=r}},Kve=class extends Tq{constructor(e,i,r,n){super(e,i,r),this.mapPositions=n}},OZe=class extends Kve{constructor(e,i,r,n,s,o){super(e,i,r,n),this.holeIndices=s,this.pathLengths=o}},RZe=class extends Tq{constructor(e,i,r,n,s){super(e,i,r),this.holeIndices=n,this.pathLengths=s}},MZe=class{constructor(e,i,r,n,s,o){this.position=e,this.mapPositions=i,this.polygons=r,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function Mb(t,e,i,r,n,s=2){const o=1/(Math.abs(i)+Math.abs(r)+Math.abs(n)),a=i*o,l=r*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,p=e*s;t[p]=ate(c),t[p+1]=ate(u)}function $Ze(t){const e=t.length/3,i=new Int16Array(2*e);let r=0;for(let n=0;n<e;++n)Mb(i,n,t[r++],t[r++],t[r++]);return i}function IZe(t,e,i,r=2){const n=i*r,s=lte(e[n]),o=lte(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),Me(t,t)}function ate(t){return $e(Math.round(32767*t),-32767,32767)}function lte(t){return $e(t/32767,-1,1)}function Qve(t,e){const i=t.fragment;switch(i.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case gn.None:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case gn.View:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case gn.WindingOrder:i.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case gn.COUNT:}}var gn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(gn||(gn={}));function e1e({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:i,roughnessFactor:r,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||xa(s,tl))&&o==null&&(r==null||r===1)&&(i==null||i===1||i===0)}const V4=[1,1,.5],Sq=[0,.6,.2],LZe=[0,1,.2];function t1e(t){t.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let DZe=class extends Oa{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function i1e(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(M.MODELORIGINHI,"vec3"),t.attributes.add(M.MODELORIGINLO,"vec3"),t.attributes.add(M.MODEL,"mat3"),t.attributes.add(M.MODELNORMAL,"mat3"));const i=t.vertex;e.instancedDoublePrecision&&(i.include(AD,e),i.uniforms.add(new yu("viewOriginHi",(r,n)=>lUe(me(UM,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),UM)),new yu("viewOriginLo",(r,n)=>cUe(me(UM,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),UM)))),i.code.add(T`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(T`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?T`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===j.Normal&&(UT(i),i.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&i.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}d([q()],DZe.prototype,"instancedDoublePrecision",void 0);const UM=I();var Es;function NZe(t){switch(t){case"multiply":default:return Es.Multiply;case"ignore":return Es.Ignore;case"replace":return Es.Replace;case"tint":return Es.Tint}}function r1e(t,e,i){if(t==null||e===Es.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=$e(Math.round(t[3]*lN),0,lN),n=r===0||e===Es.Tint?0:e===Es.Replace?FZe:kZe;i[0]=$e(Math.round(t[0]*Jw),0,Jw),i[1]=$e(Math.round(t[1]*Jw),0,Jw),i[2]=$e(Math.round(t[2]*Jw),0,Jw),i[3]=r+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Es||(Es={}));const Jw=255,lN=85,FZe=lN,kZe=2*lN;function n1e(t){t.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(Es.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(Es.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(Es.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(Es.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function s1e(t,e){e.hasSymbolColors?(t.include(n1e),t.attributes.add(M.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new uO("colorMixMode",i=>t_e[i.colorMixMode])),t.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function ew(t,e){e.hasVertexColors?(t.attributes.add(M.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function UZe(t){t.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(Mo)}) { discard; } }
  `)}let Z1=class extends On{constructor(e,i){super(e,"float",vr.Draw,(r,n,s)=>r.setUniform1f(e,i(n,s)))}};function X1(t,e){o1e(t,e,new je("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function zZe(t,e){o1e(t,e,new Z1("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function o1e(t,e,i){const r=t.fragment;switch(e.alphaDiscardMode!==_r.Mask&&e.alphaDiscardMode!==_r.MaskBlend||r.uniforms.add(i),e.alphaDiscardMode){case _r.Blend:return t.include(UZe);case _r.Opaque:r.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case _r.Mask:r.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case _r.MaskBlend:t.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function a1e(t,e){const{vertex:i,fragment:r}=t,n=e.hasModelTransformation;if(n){const o=on();i.uniforms.add(new en("model",a=>a.modelTransformation??Os)),i.uniforms.add(new Jh("normalTransform",a=>(my(o,a.modelTransformation??Os),o)))}const s=e.hasColorTexture&&e.alphaDiscardMode!==_r.Opaque;switch(e.output){case j.Depth:case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:case j.ObjectAndLayerIdColor:Tc(i,e),t.include(Ml,e),t.include(Ff,e),t.include(bg,e),t.include(Ug,e),t.include(Nn,e),t.include(iO,e),Tb(t),t.varyings.add("depth","float"),s&&r.uniforms.add(new vt("tex",o=>o.texture)),i.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(X1,e),r.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===j.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:T`outputDepth(depth);`}
          }
        `);break;case j.Normal:{Tc(i,e),t.include(Ml,e),t.include(cO,e),t.include(U4,e),t.include(Ff,e),t.include(bg,e),s&&r.uniforms.add(new vt("tex",a=>a.texture)),e.normalType===Wi.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===Wi.Attribute||e.normalType===Wi.Compressed;i.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?T`vNormalWorld = ${n?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:T`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Nn,e),t.include(X1,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===Wi.ScreenDerivative?T`vec3 normal = screenDerivativeNormal(vPositionView);`:T`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case j.Highlight:Tc(i,e),t.include(Ml,e),t.include(Ff,e),t.include(bg,e),s&&r.uniforms.add(new vt("tex",o=>o.texture)),i.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(Nn,e),t.include(X1,e),t.include(Kg,e),r.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function l1e(t,e){const i=t.fragment;e.hasVertexTangents?(t.attributes.add(M.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===gn.WindingOrder?i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):i.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==Yn.None&&(t.include(AH,e),i.uniforms.add(e.pbrTextureBindType===vr.Pass?new vt("normalTexture",r=>r.textureNormal):new $h("normalTexture",r=>r.textureNormal)),i.code.add(T`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function hO(t,e){const i=t.fragment;e.receiveAmbientOcclusion?(i.uniforms.add(new vt("ssaoTex",(r,n)=>n.ssaoHelper.colorTexture)),i.constants.add("blurSizePixelsInverse","float",1/rA),i.code.add(T`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):i.code.add(T`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function dO(t){t.constants.add("ambientBoostFactor","float",Dme)}function PS(t){t.uniforms.add(new je("lightingGlobalFactor",(e,i)=>i.lighting.globalFactor))}function $b(t,e){const i=t.fragment;switch(t.include(hO,e),e.pbrMode!==Ct.Disabled&&t.include(mq,e),t.include(RH,e),t.include(W3),i.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Ct.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),dO(i),PS(i),jg(i),i.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),om(i),i.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Ct.Disabled:case Ct.WaterOnIntegratedMesh:case Ct.Water:t.include(vD),i.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Ct.Normal:case Ct.Schematic:i.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?i.uniforms.add(new kf("hasFillLights",(r,n)=>n.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add(new je("lightingSpecularStrength",(r,n)=>n.lighting.mainLight.specularStrength),new je("lightingEnvironmentStrength",(r,n)=>n.lighting.mainLight.environmentStrength)),i.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===Ct.Schematic?T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Ct.Terrain:case Ct.TerrainWithWater:t.include(vD),i.code.add(T`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Ct.COUNT:}}function Ll(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function c1e(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function JI(t,e,i,r,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=i,c[3]=r,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function BZe(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:c1e,create:Ll,createView:BZe,fromValues:JI},Symbol.toStringTag,{value:"Module"}));function VZe(t){t.vertex.uniforms.add(new Jh("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:Ll())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(T`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function GZe(t){t.vertex.uniforms.add(new Jh("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:Ll())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(T`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function jZe(t){t.vertex.uniforms.add(new Jh("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:Ll())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(T`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function HZe(t){t.vertex.uniforms.add(new Jh("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:Ll())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(T`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function WZe(t){t.vertex.uniforms.add(new Jh("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:Ll())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(T`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function o3(t){t.include(am),t.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(Es.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(Es.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Es.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(Es.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Es.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function qZe(t){const e=new Fi,{vertex:i,fragment:r,varyings:n}=e;if(Tc(i,t),e.include(q3),n.add("vpos","vec3"),e.include(bg,t),e.include(i1e,t),e.include(W0e,t),t.hasColorTextureTransform&&e.include(VZe),t.output===j.Color||t.output===j.Alpha){t.hasNormalTextureTransform&&e.include(GZe),t.hasEmissionTextureTransform&&e.include(jZe),t.hasOcclusionTextureTransform&&e.include(HZe),t.hasMetallicRoughnessTextureTransform&&e.include(WZe),gp(i,t),e.include(cO,t),e.include(Ml,t);const s=t.normalType===Wi.Attribute||t.normalType===Wi.Compressed;s&&t.offsetBackfaces&&e.include(t1e),e.include(l1e,t),e.include(U4,t),t.instancedColor&&e.attributes.add(M.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(Ff,t),e.include(vS,t),e.include(s1e,t),e.include(ew,t),i.uniforms.add(new yi("externalColor",a=>a.externalColor)),n.add("vcolorExt","vec4"),t.hasMultipassTerrain&&n.add("depth","float");const o=t.hasModelTransformation;if(o){const a=on();i.uniforms.add(new en("model",l=>l.modelTransformation??Os)),i.uniforms.add(new Jh("normalTransform",l=>(my(a,l.modelTransformation??Os),a)))}i.code.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(Mo)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?T`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?T`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?T`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?T`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?T`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?T`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case j.Alpha:e.include(Nn,t),e.include(X1,t),e.include(Au,t),r.uniforms.add(new je("opacity",s=>s.opacity),new je("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new vt("tex",s=>s.texture)),r.include(o3),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case j.Color:e.include(Nn,t),e.include($b,t),e.include(hO,t),e.include(X1,t),e.include(t.instancedDoublePrecision?z4:Rb,t),e.include(Au,t),gp(r,t),r.uniforms.add(i.uniforms.get("localOrigin"),new ei("ambient",s=>s.ambient),new ei("diffuse",s=>s.diffuse),new je("opacity",s=>s.opacity),new je("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new vt("tex",s=>s.texture)),e.include(OH,t),e.include(mq,t),r.include(o3),e.include(Qve,t),dO(r),PS(r),om(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===Wi.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:T`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Ct.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?T`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?T`normalUV`:"vuv0"});`:T`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?T`normalize(posWorld);`:T`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?T`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Ct.Normal||t.pbrMode===Ct.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===At.Color?T`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(a1e,t),e}const ZZe=Object.freeze(Object.defineProperty({__proto__:null,build:qZe},Symbol.toStringTag,{value:"Module"}));let XZe=class extends Mve{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Za(V4),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Fr.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ge(0,0,0),this.instancedDoublePrecision=!1,this.normalType=Wi.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ge(.2,.2,.2),this.diffuse=Ge(.8,.8,.8),this.externalColor=Kt(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=I(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=bb.Less,this.textureAlphaMode=_r.Blend,this.textureAlphaCutoff=KD,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=Kr.Occlude}},YZe=class extends $ve{constructor(){super(...arguments),this.origin=I(),this.slicePlaneLocalOrigin=this.origin}},Cq=class u1e extends qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ke.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,i.textureCoordinateType=i.hasColorTexture||i.hasMetallicRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Yn.Default:Yn.None,i.objectAndLayerIdColorInstanced=i.instanced}initializeProgram(e){return this._initializeProgram(e,u1e.shader)}_initializeProgram(e,i){return new Gi(e.rctx,i.get().build(this.configuration),Ni)}_convertDepthTestFunction(e){return e===bb.Lequal?br.LEQUAL:br.LESS}_makePipeline(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Zt({blending:r.output!==j.Color&&r.output!==j.Alpha||!r.transparent?null:n?vu:Qg(e),culling:JZe(r)?e4(r.cullFace):null,depthTest:{func:Dy(e,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:(n||s)&&r.writeDepth?Nl:null,colorWrite:ni,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?Ey:Ny:null,polygonOffset:n||s?null:O4(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};function JZe(t){return t.cullFace!==Fr.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Cq.shader=new Vi(ZZe,()=>Oe(()=>import("./DefaultMaterial.glsl-1a5bd69d.js"),[],import.meta.url));let si=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.alphaDiscardMode=_r.Opaque,this.doubleSidedMode=gn.None,this.pbrMode=Ct.Disabled,this.cullFace=Fr.None,this.transparencyPassType=At.NONE,this.normalType=Wi.Attribute,this.textureCoordinateType=Yn.None,this.customDepthTest=bb.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};d([q({count:j.COUNT})],si.prototype,"output",void 0),d([q({count:_r.COUNT})],si.prototype,"alphaDiscardMode",void 0),d([q({count:gn.COUNT})],si.prototype,"doubleSidedMode",void 0),d([q({count:Ct.COUNT})],si.prototype,"pbrMode",void 0),d([q({count:Fr.COUNT})],si.prototype,"cullFace",void 0),d([q({count:At.COUNT})],si.prototype,"transparencyPassType",void 0),d([q({count:Wi.COUNT})],si.prototype,"normalType",void 0),d([q({count:Yn.COUNT})],si.prototype,"textureCoordinateType",void 0),d([q({count:bb.COUNT})],si.prototype,"customDepthTest",void 0),d([q()],si.prototype,"spherical",void 0),d([q()],si.prototype,"hasVertexColors",void 0),d([q()],si.prototype,"hasSymbolColors",void 0),d([q()],si.prototype,"hasVerticalOffset",void 0),d([q()],si.prototype,"hasSlicePlane",void 0),d([q()],si.prototype,"hasSliceHighlight",void 0),d([q()],si.prototype,"hasColorTexture",void 0),d([q()],si.prototype,"hasMetallicRoughnessTexture",void 0),d([q()],si.prototype,"hasEmissionTexture",void 0),d([q()],si.prototype,"hasOcclusionTexture",void 0),d([q()],si.prototype,"hasNormalTexture",void 0),d([q()],si.prototype,"hasScreenSizePerspective",void 0),d([q()],si.prototype,"hasVertexTangents",void 0),d([q()],si.prototype,"hasOccludees",void 0),d([q()],si.prototype,"hasMultipassTerrain",void 0),d([q()],si.prototype,"hasModelTransformation",void 0),d([q()],si.prototype,"offsetBackfaces",void 0),d([q()],si.prototype,"vvSize",void 0),d([q()],si.prototype,"vvColor",void 0),d([q()],si.prototype,"receiveShadows",void 0),d([q()],si.prototype,"receiveAmbientOcclusion",void 0),d([q()],si.prototype,"textureAlphaPremultiplied",void 0),d([q()],si.prototype,"instanced",void 0),d([q()],si.prototype,"instancedColor",void 0),d([q()],si.prototype,"objectAndLayerIdColorInstanced",void 0),d([q()],si.prototype,"instancedDoublePrecision",void 0),d([q()],si.prototype,"doublePrecisionRequiresObfuscation",void 0),d([q()],si.prototype,"writeDepth",void 0),d([q()],si.prototype,"transparent",void 0),d([q()],si.prototype,"enableOffset",void 0),d([q()],si.prototype,"cullAboveGround",void 0),d([q()],si.prototype,"snowCover",void 0),d([q()],si.prototype,"hasColorTextureTransform",void 0),d([q()],si.prototype,"hasEmissionTextureTransform",void 0),d([q()],si.prototype,"hasNormalTextureTransform",void 0),d([q()],si.prototype,"hasOcclusionTextureTransform",void 0),d([q()],si.prototype,"hasMetallicRoughnessTextureTransform",void 0),d([q({constValue:!0})],si.prototype,"hasVvInstancing",void 0),d([q({constValue:!1})],si.prototype,"useCustomDTRExponentForWater",void 0),d([q({constValue:!1})],si.prototype,"supportsTextureAtlas",void 0),d([q({constValue:!0})],si.prototype,"useFillLights",void 0);function KZe(t){const e=new Fi,{vertex:i,fragment:r,varyings:n}=e;return Tc(i,t),e.include(q3),n.add("vpos","vec3"),e.include(bg,t),e.include(i1e,t),e.include(W0e,t),t.output!==j.Color&&t.output!==j.Alpha||(gp(e.vertex,t),e.include(cO,t),e.include(Ml,t),t.offsetBackfaces&&e.include(t1e),t.instancedColor&&e.attributes.add(M.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.hasMultipassTerrain&&n.add("depth","float"),e.include(Ff,t),e.include(vS,t),e.include(s1e,t),e.include(ew,t),i.uniforms.add(new yi("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),i.code.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(Mo)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===j.Alpha&&(e.include(Nn,t),e.include(X1,t),e.include(Au,t),r.uniforms.add(new je("opacity",s=>s.opacity),new je("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new vt("tex",s=>s.texture)),r.include(o3),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===j.Color&&(e.include(Nn,t),e.include($b,t),e.include(hO,t),e.include(X1,t),e.include(t.instancedDoublePrecision?z4:Rb,t),e.include(Au,t),gp(e.fragment,t),jg(r),dO(r),PS(r),r.uniforms.add(i.uniforms.get("localOrigin"),i.uniforms.get("view"),new ei("ambient",s=>s.ambient),new ei("diffuse",s=>s.diffuse),new je("opacity",s=>s.opacity),new je("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&r.uniforms.add(new vt("tex",s=>s.texture)),e.include(OH,t),e.include(mq,t),r.include(o3),om(r),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Ct.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?T`albedo = mix(albedo, vec3(1), 0.9);`:T``}
        ${T`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Ct.Normal||t.pbrMode===Ct.Schematic?t.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${t.pbrMode===Ct.Normal||t.pbrMode===Ct.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===At.Color?T`fragColor = premultiplyAlpha(fragColor);`:T``}
      }
    `)),e.include(a1e,t),e}const QZe=Object.freeze(Object.defineProperty({__proto__:null,build:KZe},Symbol.toStringTag,{value:"Module"}));let h1e=class d1e extends Cq{initializeConfiguration(e,i){super.initializeConfiguration(e,i),i.hasMetallicRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Wi.Attribute,i.doubleSidedMode=gn.WindingOrder,i.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,d1e.shader)}};h1e.shader=new Vi(QZe,()=>Oe(()=>import("./RealisticTree.glsl-38408ddc.js"),[],import.meta.url));let Kf=class extends Ly{constructor(e){super(e,iXe),this.supportsEdges=!0,this._configuration=new si,this._vertexBufferLayout=rXe(this.parameters)}isVisibleForOutput(e){return e!==j.Shadow&&e!==j.ShadowExcludeHighlight&&e!==j.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:i,hasVertexColors:r,hasSymbolColors:n,vvColor:s}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=i||s||n;return r&&c?o||a:r?o?l:a:c?o||a:o?l:a}getConfiguration(e,i){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Fr.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==j.Color&&e!==j.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=gn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?gn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?gn.WindingOrder:gn.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Ct.Schematic:Ct.Normal:Ct.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<A4,this._configuration.snowCover=this.hasSnowCover(i),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,i,r,n,s,o){if(this.parameters.verticalOffset!=null){const a=r.camera;me(Hk,i[12],i[13],i[14]);let l=null;switch(r.viewingMode){case Ke.Global:l=Me(cte,Hk);break;case Ke.Local:l=fe(cte,oXe)}let c=0;const u=Ce(aXe,Hk,a.eye),p=ze(u),f=pe(u,u,1/p);let y=null;this.parameters.screenSizePerspective&&(y=Re(l,f)),c+=Q0e(a,p,this.parameters.verticalOffset,y??0,this.parameters.screenSizePerspective),pe(l,l,c),yc(jk,l,r.transform.inverseRotation),n=Ce(nXe,n,jk),s=Ce(sXe,s,jk)}X0e(e,r,n,s,f7(r.verticalOffset),o)}requiresSlot(e,i){return i===j.Color||i===j.Alpha||i===j.Depth||i===j.Normal||i===j.Shadow||i===j.ShadowHighlight||i===j.ShadowExcludeHighlight||i===j.Highlight||i===j.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Te.OPAQUE_MATERIAL)||e===Te.DRAPED_MATERIAL:!1}createGLMaterial(e){return new eXe(e)}createBufferWriter(){return new AS(this._vertexBufferLayout)}},eXe=class extends PH{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==j.Color&&this._output!==j.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const i=this._material.parameters;this.updateTexture(i.textureId);const r=e.camera.viewInverseTransposeMatrix;return me(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?h1e:Cq,e)}},tXe=class extends XZe{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const iXe=new tXe;function rXe(t){const e=ln().vec3f(M.POSITION);return t.normalType===Wi.Compressed?e.vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(M.NORMAL),t.hasVertexTangents&&e.vec4f(M.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(M.UV0),t.hasVertexColors&&e.vec4u8(M.COLOR),t.hasSymbolColors&&e.vec4u8(M.SYMBOLCOLOR),ge("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(M.OBJECTANDLAYERIDCOLOR),e}const nXe=I(),sXe=I(),oXe=Ge(0,0,1),cte=I(),jk=I(),Hk=I(),aXe=I(),lXe=["polygon","extent"];let cXe=class extends cm{constructor(e,i,r,n){super(e,i,r,n),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=M4(this._getSymbolSize());if(c)throw new ce("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,i=this._getCombinedOpacityAndColor(e),r=Za(i),n=i[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:n,transparent:s,cullFace:s?Fr.None:Fr.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:Wi.Compressed};this._material=new Kf(o),this._bottomMaterial=new Kf({...o,cullFace:Fr.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,lXe,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i,new wp);return this._createAs3DShape(i,e.renderingInfo,r,n,i.uid)}layerOpacityChanged(e,i){var a,l;const r=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._getCombinedOpacity(r),s=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:s}),this._bottomMaterial.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(c=>{const u=i(c);u!=null&&u.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ty)}slicePlaneEnabledChanged(e,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(r=>{const n=i(r);n!=null&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let i;return i=e.size&&this._drivenProperties.size?LWe(e.size,2)??0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(e,i){return this._drivenPropertiesChanged(i)?Jn.RecreateSymbol:Jn.RecreateGraphics}async queryForSnapping(e,i,r,n){const s=this._getExtrusionSize(r)*this._context.renderCoordsHelper.unitInMeters/N8(i),{objectId:o,target:a}=e,l=Le(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:u}=e,p=Le(c),f=Le(u);return p.z=(p.z??0)+s,f.z=(f.z??0)+s,[Eee(o,l,1/0,p,f)]}case"vertex":return[yWe(o,l,1/0),Eee(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,i,r,n,s){const o=n3(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(B=>B.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=xq(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=HW(o);if(l==null)return null;const c=new Array,u=new Array,p=$s(),f=Ne(),y=I(),v=this._context.renderCoordsHelper.viewingMode===Ke.Global;v||this._context.renderCoordsHelper.worldUpAtPosition(null,y),_u(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const b=Ne();fo(b,f);const x=on();my(x,b);const{polygons:S,mapPositions:P,position:C}=a;for(const B of S){const W=B.count;if(this._context.clippingExtent&&(Gr(p),du(p,B.mapPositions),!Xd(p,this._context.clippingExtent)))continue;const Z=WT(B.mapPositions,B.holeIndices,3);if(Z.length===0)continue;const K=Z.length,X=6*W,ae=RD(X+K),re=RD(K),ee=ia(3*X),oe=ia(3*X),U=ia(3*X),V=ia(X);uXe(C,P,Z,B,ee,U,oe,V,ae,re,this._getExtrusionSize(i),y,v),qT(ee,ee,b);const H=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),Y=new mXe(ee,U,$Ze(oe),V);c.push(ute(this._material,ae,ae.length-re.length,Y,r,H),ute(this._bottomMaterial,re,0,Y,r,H)),u.push(Y.heights)}if(c.length===0)return null;const R=new e0({geometries:c,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});R.transformation=f;const N=Sye(this.symbolLayer,{opacity:this._getLayerOpacity()}),$=N!=null?{baseMaterial:this._material,edgeMaterials:[N],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,k=new lm(this,R,c,null,null,(B,W,Z,K,X)=>pXe(B,W,Z,K,X,u),n,$);return k.alignedSampledElevation=a.sampledElevation,k.needsElevationUpdates=Ty(n.mode),k}};function ute(t,e,i,r,n,s){const o=bS(e.length),a=[[M.POSITION,new nt(r.positions,3,!0)],[M.NORMALCOMPRESSED,new nt(r.normals,2,!0)],[M.COLOR,new nt(n,4,!0)]],l=[[M.POSITION,e],[M.NORMALCOMPRESSED,e],[M.COLOR,o]];return new fs(t,a,l,r.elevation,An.Mesh,s,i)}function uXe(t,e,i,r,n,s,o,a,l,c,u,p,f){const y=i.length/3;let v=0,b=2*r.count;hXe(t,e,r.index,r.count,i,0,y,n,s,o,a,l,c,b,u,p,f);let x=2*r.count;b=0,hte(n,s,a,o,v,r.pathLengths[0],r.count,x,l,b,u),x+=4*r.pathLengths[0],b+=2*r.pathLengths[0],v+=r.pathLengths[0];for(let S=1;S<r.pathLengths.length;++S)hte(n,s,a,o,v,r.pathLengths[S],r.count,x,l,b,u),x+=4*r.pathLengths[S],b+=2*r.pathLengths[S],v+=r.pathLengths[S]}function hXe(t,e,i,r,n,s,o,a,l,c,u,p,f,y,v,b,x){fe(ml,b);const S=v>0?1:-1;let P=3*i,C=0,R=3*C,N=r,$=3*N;for(let W=0;W<r;++W)x&&(ml[0]=t[P],ml[1]=t[P+1],ml[2]=t[P+2],Me(ml,ml)),a[R]=t[P],a[R+1]=t[P+1],a[R+2]=t[P+2],l[R]=e[P],l[R+1]=e[P+1],l[R+2]=e[P+2],c[R]=-S*ml[0],c[R+1]=-S*ml[1],c[R+2]=-S*ml[2],u[C]=0,a[$]=t[P]+v*ml[0],a[$+1]=t[P+1]+v*ml[1],a[$+2]=t[P+2]+v*ml[2],l[$]=e[P],l[$+1]=e[P+1],l[$+2]=e[P+2],c[$]=S*ml[0],c[$+1]=S*ml[1],c[$+2]=S*ml[2],u[N]=v,R+=3,$+=3,P+=3,C+=1,N+=1;P=3*s,R=0,$=3*y;const k=v<0?_te:gte,B=v<0?gte:_te;for(let W=0;W<o;++W)f[R]=n[P+k[0]],f[R+1]=n[P+k[1]],f[R+2]=n[P+k[2]],p[$]=n[P+B[0]]+r,p[$+1]=n[P+B[1]]+r,p[$+2]=n[P+B[2]]+r,R+=3,$+=3,P+=3}function zM(t,e,i,r,n,s,o){r[s]=r[o],o*=3,t[s*=3]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],i[s]=n[0],i[s+1]=n[1],i[s+2]=n[2]}const IC=I();function hte(t,e,i,r,n,s,o,a,l,c,u){let p=n,f=n+1,y=n+o,v=n+o+1,b=a,x=a+1,S=a+2*s,P=a+2*s+1;u<0&&(p=n+o+1,v=n),c*=3;for(let C=0;C<s;++C)C===s-1&&(u>0?(f=n,v=n+o):(f=n,p=n+o)),dXe(t,p,f,y,IC),zM(t,e,r,i,IC,b,p),zM(t,e,r,i,IC,x,f),zM(t,e,r,i,IC,S,y),zM(t,e,r,i,IC,P,v),l[c++]=b,l[c++]=S,l[c++]=P,l[c++]=b,l[c++]=P,l[c++]=x,p++,f++,y++,v++,b+=2,x+=2,S+=2,P+=2}const Wk=I(),dte=I(),pte=I(),fte=I(),mte=I();function dXe(t,e,i,r,n){e*=3,i*=3,r*=3,me(Wk,t[e++],t[e++],t[e++]),me(dte,t[i++],t[i++],t[i++]),me(pte,t[r++],t[r++],t[r++]),Ce(fte,dte,Wk),Ce(mte,pte,Wk),Rt(n,mte,fte),Me(n,n)}const Kw=I();function pXe(t,e,i,r,n,s){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const p=o.transformation,f=dS(Ne(),p);for(let y=0;y<l;y+=2){const v=a[y];if(!qW(v))continue;const b=v.getMutableAttribute(M.POSITION).data,x=s[y/2],S=new wW(v.mapPositions),P=b.length/3;let C=0,R=!1,N=0;for(let $=0;$<P;$++){Kw[0]=b[C],Kw[1]=b[C+1],Kw[2]=b[C+2],r(S,BM),c&&(N+=BM.sampledElevation),Or.TESTS_DISABLE_OPTIMIZATIONS?(me(Wl,S.array[S.offset],S.array[S.offset+1],BM.z+x[C/3]),i!=null&&n.toRenderCoords(Wl,i,Wl),st(Wl,Wl,f)):(me(Wl,b[C],b[C+1],b[C+2]),st(Wl,Wl,p),n.setAltitude(Wl,BM.z+x[C/3]),st(Wl,Wl,f)),b[C]=Wl[0],b[C+1]=Wl[1],b[C+2]=Wl[2];const k=fXe/n.unitInMeters;(Math.abs(Kw[0]-b[C])>=k||Math.abs(Kw[1]-b[C+1])>=k||Math.abs(Kw[2]-b[C+2])>=k)&&(R=!0),S.offset+=3,C+=3}R&&(v.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[y]),a[y+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[y+1])),u+=N/P}return u/l}const Wl=I(),ml=I(),BM=new oO,gte=[0,2,1],_te=[0,1,2],fXe=.01;let mXe=class{constructor(e,i,r,n){this.positions=e,this.elevation=i,this.normals=r,this.heights=n}};function G4(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function gXe(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function _Xe(t,e,i,r,n,s,o,a,l,c,u,p,f,y,v,b){const x=new Float32Array(16);return x[0]=t,x[1]=e,x[2]=i,x[3]=r,x[4]=n,x[5]=s,x[6]=o,x[7]=a,x[8]=l,x[9]=c,x[10]=u,x[11]=p,x[12]=f,x[13]=y,x[14]=v,x[15]=b,x}function yXe(t,e){return new Float32Array(t,e,16)}const vXe=G4();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:vXe,clone:gXe,create:G4,createView:yXe,fromValues:_Xe},Symbol.toStringTag,{value:"Module"}));const bXe=(t,e)=>{const i=sm(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Cc(i,i)},wXe=(t,e)=>{const i=sm(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Cc(i,i)},xXe=(t,e)=>{const i=1-e,r=sm(t,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Cc(r,r)},TXe=(t,e)=>{const i=Math.sin(e*Math.PI/180),r=Math.cos(e*Math.PI/180),n=sm(t,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Cc(n,n)},SXe=(t,e)=>{const i=1-2*e,r=sm(t,i,0,0,e,0,i,0,e,0,0,i,e,0,0,0,1);return Cc(r,r)},CXe=(t,e)=>{const i=sm(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Cc(i,i)},EXe=(t,e)=>{const i=1-e,r=sm(t,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Cc(r,r)};let p1e=class f1e{constructor(e,i,r){this.strength=e,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(e,i,r){this.strength=dc(e.strength,i.strength,r),this.radius=dc(e.radius,i.radius,r),this.threshold=dc(e.threshold,i.threshold,r)}clone(){return new f1e(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:tP(this.radius),strength:this.strength,threshold:this.threshold}}},m1e=class g1e{constructor(e){this.radius=e,this.type="blur"}interpolate(e,i,r){this.radius=Math.round(dc(e.radius,i.radius,r))}clone(){return new g1e(this.radius)}toJSON(){return{type:"blur",radius:tP(this.radius)}}},Y7=class _1e{constructor(e,i){this.type=e,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.amount=dc(e.amount,i.amount,r),this._updateMatrix()}clone(){return new _1e(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||G4();switch(this.type){case"brightness":this._colorMatrix=bXe(e,this.amount);break;case"contrast":this._colorMatrix=wXe(e,this.amount);break;case"grayscale":this._colorMatrix=xXe(e,this.amount);break;case"invert":this._colorMatrix=SXe(e,this.amount);break;case"saturate":this._colorMatrix=CXe(e,this.amount);break;case"sepia":this._colorMatrix=EXe(e,this.amount)}}},y1e=class v1e{constructor(e,i,r,n){this.offsetX=e,this.offsetY=i,this.blurRadius=r,this.color=n,this.type="drop-shadow"}interpolate(e,i,r){this.offsetX=dc(e.offsetX,i.offsetX,r),this.offsetY=dc(e.offsetY,i.offsetY,r),this.blurRadius=dc(e.blurRadius,i.blurRadius,r),this.color[0]=Math.round(dc(e.color[0],i.color[0],r)),this.color[1]=Math.round(dc(e.color[1],i.color[1],r)),this.color[2]=Math.round(dc(e.color[2],i.color[2],r)),this.color[3]=dc(e.color[3],i.color[3],r)}clone(){return new v1e(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:tP(this.offsetX),yoffset:tP(this.offsetY),blurRadius:tP(this.blurRadius),color:e}}},b1e=class w1e{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,i,r){this.angle=dc(e.angle,i.angle,r),this._updateMatrix()}clone(){return new w1e(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||G4();this._colorMatrix=TXe(e,this.angle)}},x1e=class T1e{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,i,r){this.amount=dc(e.amount,i.amount,r)}clone(){return new T1e(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function dc(t,e,i){return t+(e-t)*i}function tP(t){return Math.round(1e3*dp(t))/1e3}function AXe(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new Y7(t.type,0);case"saturate":case"brightness":case"contrast":return new Y7(t.type,1);case"opacity":return new x1e(1);case"hue-rotate":return new b1e(0);case"blur":return new m1e(0);case"drop-shadow":return new y1e(0,0,0,[...oj("transparent")]);case"bloom":return new p1e(0,0,1)}}function PXe(t,e){const i=t.length>e.length?t:e;return(t.length>e.length?e:t).every((r,n)=>r.type===i[n].type)}function OXe(t,e){const i=t.length>e.length?t:e,r=t.length>e.length?e:t;for(let n=r.length;n<i.length;n++)r.push(AXe(i[n]))}function bTt(t){const e=t[0];return!!e&&"type"in e}var yte,vte,J7={exports:{}};J7.exports,vte=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function i(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function r(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Ul},u=Ul,p="none",f=")",y=",",v="(",b="%",x="px",S="cm",P="mm",C="in",R="pt",N="pc",$="deg",k="rad",B="grad",W="turn",Z="#",K=".",X="e",ae=/^[ \t\n\r]/,re=/^[a-z\-]/,ee=/^[0-9a-fA-F]/,oe=/^[+\-]/,U=/^[0-9]/,V=Ls("none"),H=Rn("none",!1),Y=Rn(")",!1),ie=Rn(",",!1),le=Ls("whitespace"),ue=kl([" ","	",`
`,"\r"],!1,!1),ve=Ls("function"),Ie=Rn("(",!1),Ve=Ls("identifier"),Mt=kl([["a","z"],"-"],!1,!1),ot=Ls("percentage"),Pt=Rn("%",!1),qe=Ls("length"),Ee=Rn("px",!1),at=Rn("cm",!1),ht=Rn("mm",!1),Ue=Rn("in",!1),He=Rn("pt",!1),rt=Rn("pc",!1),wt=Ls("angle"),_t=Rn("deg",!1),lt=Rn("rad",!1),Xe=Rn("grad",!1),ct=Rn("turn",!1),ti=Ls("number"),Ze=Ls("color"),tt=Rn("#",!1),Ot=kl([["0","9"],["a","f"],["A","F"]],!1,!1),kt=kl(["+","-"],!1,!1),$t=kl([["0","9"]],!1,!1),cr=Rn(".",!1),ji=Rn("e",!1),er=function(){return[]},Vt=function(Q,Se){return{type:"function",name:Q,parameters:Se||[]}},sr=function(Q,Se){return Se.length>0?Bl(Q,Se,3):[Q]},Mi=function(Q){return{type:"quantity",value:Q.value,unit:Q.unit}},Hi=function(Q){return{type:"color",colorType:Q.type,value:Q.value}},Ei=function(Q){return Q},ki=function(){return _o()},Ai=function(Q){return{value:Q,unit:"%"}},or=function(Q){return{value:Q,unit:"px"}},tr=function(Q){return{value:Q,unit:"cm"}},_i=function(Q){return{value:Q,unit:"mm"}},ir=function(Q){return{value:Q,unit:"in"}},ur=function(Q){return{value:Q,unit:"pt"}},as=function(Q){return{value:Q,unit:"pc"}},ls=function(Q){return{value:Q,unit:"deg"}},yn=function(Q){return{value:Q,unit:"rad"}},cs=function(Q){return{value:Q,unit:"grad"}},kr=function(Q){return{value:Q,unit:"turn"}},Rr=function(Q){return{value:Q,unit:null}},$i=function(){return{type:"hex",value:_o()}},es=function(Q){return{type:"function",value:Q}},_s=function(){return{type:"named",value:_o()}},Zs=function(){return parseFloat(_o())},de=0,Pi=0,Tt=[{line:1,column:1}],Un=0,Ra=[],ut=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function _o(){return n.substring(Pi,de)}function Rn(Q,Se){return{type:"literal",text:Q,ignoreCase:Se}}function kl(Q,Se,be){return{type:"class",parts:Q,inverted:Se,ignoreCase:be}}function Xs(){return{type:"end"}}function Ls(Q){return{type:"other",description:Q}}function Ma(Q){var Se,be=Tt[Q];if(be)return be;for(Se=Q-1;!Tt[Se];)Se--;for(be={line:(be=Tt[Se]).line,column:be.column};Se<Q;)n.charCodeAt(Se)===10?(be.line++,be.column=1):be.column++,Se++;return Tt[Q]=be,be}function ts(Q,Se,be){var yt=Ma(Q),Xr=Ma(Se),Xi={source:l,start:{offset:Q,line:yt.line,column:yt.column},end:{offset:Se,line:Xr.line,column:Xr.column}};return be&&l&&typeof l.offset=="function"&&(Xi.start=l.offset(Xi.start),Xi.end=l.offset(Xi.end)),Xi}function ii(Q){de<Un||(de>Un&&(Un=de,Ra=[]),Ra.push(Q))}function Mu(Q,Se,be){return new e(e.buildMessage(Q,Se),Q,Se,be)}function Ul(){var Q;return(Q=Oc())===a&&(Q=us()),Q}function Oc(){var Q,Se;return ut++,Q=de,jr(),n.substr(de,4)===p?(Se=p,de+=4):(Se=a,ut===0&&ii(H)),Se!==a?(jr(),Pi=Q,Q=er()):(de=Q,Q=a),ut--,Q===a&&ut===0&&ii(V),Q}function us(){var Q,Se;if(Q=[],(Se=Uo())!==a)for(;Se!==a;)Q.push(Se),Se=Uo();else Q=a;return Q}function Uo(){var Q,Se,be,yt;return Q=de,jr(),(Se=Rc())!==a?(jr(),(be=zl())===a&&(be=null),jr(),n.charCodeAt(de)===41?(yt=f,de++):(yt=a,ut===0&&ii(Y)),yt!==a?(jr(),Pi=Q,Q=Vt(Se,be)):(de=Q,Q=a)):(de=Q,Q=a),Q}function zl(){var Q,Se,be,yt,Xr,Xi,Mr,Iu;if(Q=de,(Se=zn())!==a){for(be=[],yt=de,Xr=jr(),n.charCodeAt(de)===44?(Xi=y,de++):(Xi=a,ut===0&&ii(ie)),Xi===a&&(Xi=null),Mr=jr(),(Iu=zn())!==a?yt=Xr=[Xr,Xi,Mr,Iu]:(de=yt,yt=a);yt!==a;)be.push(yt),yt=de,Xr=jr(),n.charCodeAt(de)===44?(Xi=y,de++):(Xi=a,ut===0&&ii(ie)),Xi===a&&(Xi=null),Mr=jr(),(Iu=zn())!==a?yt=Xr=[Xr,Xi,Mr,Iu]:(de=yt,yt=a);Pi=Q,Q=sr(Se,be)}else de=Q,Q=a;return Q}function zn(){var Q,Se;return Q=de,(Se=ll())===a&&(Se=ed())===a&&(Se=$u())===a&&(Se=$a()),Se!==a&&(Pi=Q,Se=Mi(Se)),(Q=Se)===a&&(Q=de,(Se=Zi())!==a&&(Pi=Q,Se=Hi(Se)),Q=Se),Q}function jr(){var Q,Se;for(ut++,Q=[],ae.test(n.charAt(de))?(Se=n.charAt(de),de++):(Se=a,ut===0&&ii(ue));Se!==a;)Q.push(Se),ae.test(n.charAt(de))?(Se=n.charAt(de),de++):(Se=a,ut===0&&ii(ue));return ut--,Se=a,ut===0&&ii(le),Q}function Rc(){var Q,Se,be;return ut++,Q=de,(Se=Mc())!==a?(n.charCodeAt(de)===40?(be=v,de++):(be=a,ut===0&&ii(Ie)),be!==a?(Pi=Q,Q=Ei(Se)):(de=Q,Q=a)):(de=Q,Q=a),ut--,Q===a&&(Se=a,ut===0&&ii(ve)),Q}function Mc(){var Q,Se,be;if(ut++,Q=de,Se=[],re.test(n.charAt(de))?(be=n.charAt(de),de++):(be=a,ut===0&&ii(Mt)),be!==a)for(;be!==a;)Se.push(be),re.test(n.charAt(de))?(be=n.charAt(de),de++):(be=a,ut===0&&ii(Mt));else Se=a;return Se!==a&&(Pi=Q,Se=ki()),ut--,(Q=Se)===a&&(Se=a,ut===0&&ii(Ve)),Q}function ll(){var Q,Se,be;return ut++,Q=de,jr(),(Se=Ui())!==a?(n.charCodeAt(de)===37?(be=b,de++):(be=a,ut===0&&ii(Pt)),be!==a?(Pi=Q,Q=Ai(Se)):(de=Q,Q=a)):(de=Q,Q=a),ut--,Q===a&&ut===0&&ii(ot),Q}function ed(){var Q,Se,be;return ut++,Q=de,jr(),(Se=Ui())!==a?(n.substr(de,2)===x?(be=x,de+=2):(be=a,ut===0&&ii(Ee)),be!==a?(Pi=Q,Q=or(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,jr(),(Se=Ui())!==a?(n.substr(de,2)===S?(be=S,de+=2):(be=a,ut===0&&ii(at)),be!==a?(Pi=Q,Q=tr(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,jr(),(Se=Ui())!==a?(n.substr(de,2)===P?(be=P,de+=2):(be=a,ut===0&&ii(ht)),be!==a?(Pi=Q,Q=_i(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,jr(),(Se=Ui())!==a?(n.substr(de,2)===C?(be=C,de+=2):(be=a,ut===0&&ii(Ue)),be!==a?(Pi=Q,Q=ir(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,jr(),(Se=Ui())!==a?(n.substr(de,2)===R?(be=R,de+=2):(be=a,ut===0&&ii(He)),be!==a?(Pi=Q,Q=ur(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,jr(),(Se=Ui())!==a?(n.substr(de,2)===N?(be=N,de+=2):(be=a,ut===0&&ii(rt)),be!==a?(Pi=Q,Q=as(Se)):(de=Q,Q=a)):(de=Q,Q=a)))))),ut--,Q===a&&ut===0&&ii(qe),Q}function $u(){var Q,Se,be;return ut++,Q=de,(Se=Ui())!==a?(n.substr(de,3)===$?(be=$,de+=3):(be=a,ut===0&&ii(_t)),be!==a?(Pi=Q,Q=ls(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,(Se=Ui())!==a?(n.substr(de,3)===k?(be=k,de+=3):(be=a,ut===0&&ii(lt)),be!==a?(Pi=Q,Q=yn(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,(Se=Ui())!==a?(n.substr(de,4)===B?(be=B,de+=4):(be=a,ut===0&&ii(Xe)),be!==a?(Pi=Q,Q=cs(Se)):(de=Q,Q=a)):(de=Q,Q=a),Q===a&&(Q=de,(Se=Ui())!==a?(n.substr(de,4)===W?(be=W,de+=4):(be=a,ut===0&&ii(ct)),be!==a?(Pi=Q,Q=kr(Se)):(de=Q,Q=a)):(de=Q,Q=a)))),ut--,Q===a&&(Se=a,ut===0&&ii(wt)),Q}function $a(){var Q,Se;return ut++,Q=de,jr(),(Se=Ui())!==a?(Pi=Q,Q=Rr(Se)):(de=Q,Q=a),ut--,Q===a&&ut===0&&ii(ti),Q}function Zi(){var Q,Se,be,yt;if(ut++,Q=de,n.charCodeAt(de)===35?(Se=Z,de++):(Se=a,ut===0&&ii(tt)),Se!==a){if(be=[],ee.test(n.charAt(de))?(yt=n.charAt(de),de++):(yt=a,ut===0&&ii(Ot)),yt!==a)for(;yt!==a;)be.push(yt),ee.test(n.charAt(de))?(yt=n.charAt(de),de++):(yt=a,ut===0&&ii(Ot));else be=a;be!==a?(Pi=Q,Q=$i()):(de=Q,Q=a)}else de=Q,Q=a;return Q===a&&(Q=de,(Se=Uo())!==a&&(Pi=Q,Se=es(Se)),(Q=Se)===a&&(Q=de,(Se=Mc())!==a&&(Pi=Q,Se=_s()),Q=Se)),ut--,Q===a&&(Se=a,ut===0&&ii(Ze)),Q}function Ui(){var Q,Se,be,yt,Xr,Xi,Mr;for(Q=de,oe.test(n.charAt(de))?(n.charAt(de),de++):ut===0&&ii(kt),Se=de,be=[],U.test(n.charAt(de))?(yt=n.charAt(de),de++):(yt=a,ut===0&&ii($t));yt!==a;)be.push(yt),U.test(n.charAt(de))?(yt=n.charAt(de),de++):(yt=a,ut===0&&ii($t));if(n.charCodeAt(de)===46?(yt=K,de++):(yt=a,ut===0&&ii(cr)),yt!==a){if(Xr=[],U.test(n.charAt(de))?(Xi=n.charAt(de),de++):(Xi=a,ut===0&&ii($t)),Xi!==a)for(;Xi!==a;)Xr.push(Xi),U.test(n.charAt(de))?(Xi=n.charAt(de),de++):(Xi=a,ut===0&&ii($t));else Xr=a;Xr!==a?Se=be=[be,yt,Xr]:(de=Se,Se=a)}else de=Se,Se=a;if(Se===a)if(Se=[],U.test(n.charAt(de))?(be=n.charAt(de),de++):(be=a,ut===0&&ii($t)),be!==a)for(;be!==a;)Se.push(be),U.test(n.charAt(de))?(be=n.charAt(de),de++):(be=a,ut===0&&ii($t));else Se=a;if(Se!==a){if(be=de,n.charCodeAt(de)===101?(yt=X,de++):(yt=a,ut===0&&ii(ji)),yt!==a){if(oe.test(n.charAt(de))?(Xr=n.charAt(de),de++):(Xr=a,ut===0&&ii(kt)),Xr===a&&(Xr=null),Xi=[],U.test(n.charAt(de))?(Mr=n.charAt(de),de++):(Mr=a,ut===0&&ii($t)),Mr!==a)for(;Mr!==a;)Xi.push(Mr),U.test(n.charAt(de))?(Mr=n.charAt(de),de++):(Mr=a,ut===0&&ii($t));else Xi=a;Xi!==a?be=yt=[yt,Xr,Xi]:(de=be,be=a)}else de=be,be=a;be===a&&(be=null),Pi=Q,Q=Zs()}else de=Q,Q=a;return Q}function $c(Q,Se){return Q.map(function(be){return be[Se]})}function Bl(Q,Se,be){return[Q].concat($c(Se,be))}if((o=u())!==a&&de===n.length)return o;throw o!==a&&de<n.length&&ii(Xs()),Mu(Ra,Un<n.length?n.charAt(Un):null,Un<n.length?ts(Un,Un+1):ts(Un,Un))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var p=this.location.end,f=i("",c.line.toString().length," "),y=a[l.line-1],v=(l.line===p.line?p.column:y.length+1)-l.column||1;s+=`
 --> `+u+`
`+f+` |
`+c.line+" | "+y+`
`+f+" | "+i("",l.column-1," ")+i("",v,"^")}else s+=`
 at `+u}return s},e.buildMessage=function(n,s){var o={literal:function(y){return'"'+l(y.text)+'"'},class:function(y){var v=y.parts.map(function(b){return Array.isArray(b)?c(b[0])+"-"+c(b[1]):c(b)});return"["+(y.inverted?"^":"")+v.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(y){return y.description}};function a(y){return y.charCodeAt(0).toString(16).toUpperCase()}function l(y){return y.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+a(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+a(v)})}function c(y){return y.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+a(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+a(v)})}function u(y){return o[y.type](y)}function p(y){var v,b,x=y.map(u);if(x.sort(),x.length>0){for(v=1,b=1;v<x.length;v++)x[v-1]!==x[v]&&(x[b]=x[v],b++);x.length=b}switch(x.length){case 1:return x[0];case 2:return x[0]+" or "+x[1];default:return x.slice(0,-1).join(", ")+", or "+x[x.length-1]}}function f(y){return y?'"'+l(y)+'"':"end of input"}return"Expected "+p(n)+" but "+f(s)+" found."},{SyntaxError:e,parse:r}},(yte=J7).exports&&(yte.exports=vte());var RXe=J7.exports;function wTt(t){if(!t||t.length===0)return null;if(typeof t=="string"){const i=bte(t);return i&&i.length!==0?i:null}const e=t.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new ce("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:bte(i.value)}});e.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<e.length-1;i++){if(!PXe(e[i].effects,e[i+1].effects))throw new ce("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[i].effects,b:e[i+1].effects});OXe(e[i].effects,e[i+1].effects)}return e.sort((i,r)=>r.scale-i.scale),e}function bte(t){let e;if(!t)return[];try{e=RXe.parse(t)}catch(i){throw new ce("effect:invalid-syntax","Invalid effect syntax",{value:t,error:i})}return e.map(i=>MXe(i))}function MXe(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return $Xe(t);case"opacity":return IXe(t);case"hue-rotate":return LXe(t);case"blur":return DXe(t);case"drop-shadow":return NXe(t);case"bloom":return FXe(t)}}catch(e){throw e.details.filter=t,e}throw new ce("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function $Xe(t){let e=1;return OS(t.parameters,1),t.parameters.length===1&&(e=zd(t.parameters[0])),new Y7(t.name,e)}function IXe(t){let e=1;return OS(t.parameters,1),t.parameters.length===1&&(e=zd(t.parameters[0])),new x1e(e)}function LXe(t){let e=0;return OS(t.parameters,1),t.parameters.length===1&&(e=GXe(t.parameters[0])),new b1e(e)}function DXe(t){let e=0;return OS(t.parameters,1),t.parameters.length===1&&(e=Pq(t.parameters[0]),pO(e,t.parameters[0])),new m1e(e)}function NXe(t){const e=[];let i=null;for(const r of t.parameters)if(r.type==="color"){if(e.length&&Object.freeze(e),i)throw new ce("effect:type-error","Accepts only one color",{});i=jXe(r)}else{const n=Pq(r);if(Object.isFrozen(e))throw new ce("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&pO(n,r)}if(e.length<2||e.length>3)throw new ce("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new y1e(e[0],e[1],e[2]||0,i||S1e("black"))}function FXe(t){let e=1,i=0,r=0;return OS(t.parameters,3),t.parameters[0]&&(e=zd(t.parameters[0])),t.parameters[1]&&(i=Pq(t.parameters[1]),pO(i,t.parameters[1])),t.parameters[2]&&(r=zd(t.parameters[2])),new p1e(e,i,r)}function OS(t,e){if(t.length>e)throw new ce("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function j4(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Aq)return"<length>";if(t.unit in Eq)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function pO(t,e){if(t<0)throw new ce("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function kXe(t){if(t.type!=="quantity"||t.unit!==null)throw new ce("effect:type-error",`Expected <double>, Actual: ${j4(t)}`,{term:t})}function UXe(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new ce("effect:type-error",`Expected <double> or <percentage>, Actual: ${j4(t)}`,{term:t})}const Eq={deg:1,grad:.9,rad:180/Math.PI,turn:360};function zXe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Eq[t.unit]!=null))throw new ce("effect:type-error",`Expected <angle>, Actual: ${j4(t)}`,{term:t})}const Aq={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function BXe(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Aq[t.unit]!=null))throw new ce("effect:type-error",`Expected <length>, Actual: ${j4(t)}`,{term:t})}function zd(t){UXe(t);const e=t.value;return pO(e,t),t.unit==="%"?.01*e:e}function VXe(t){return kXe(t),pO(t.value,t),t.value}function GXe(t){return zXe(t),t.value*Eq[t.unit]||0}function Pq(t){return BXe(t),t.value*Aq[t.unit]||0}function jXe(t){switch(t.colorType){case"hex":return vRe(t.value);case"named":return S1e(t.value);case"function":return qXe(t.value)}}function S1e(t){if(!Eue(t))throw new ce("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return yRe(t)}const HXe=/^rgba?/i,WXe=/^hsla?/i;function qXe(t){if(OS(t.parameters,4),HXe.test(t.name))return[zd(t.parameters[0]),zd(t.parameters[1]),zd(t.parameters[2]),t.parameters[3]?zd(t.parameters[3]):1];if(WXe.test(t.name))return Aue(VXe(t.parameters[0]),zd(t.parameters[1]),zd(t.parameters[2]),t.parameters[3]?zd(t.parameters[3]):1);throw new ce("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function ZXe(t){return typeof t=="function"}function xTt(t,e,i,r){return ZXe(t)?t(e,i,r):t}function TTt(t){return[t.r,t.g,t.b,t.a]}const XXe=` /-,
`;function wte(t){let e=t.length;for(;e--;)if(!XXe.includes(t.charAt(e)))return!1;return!0}function YXe(t,e){const i=[];let r=0,n=-1;do if(n=t.indexOf("[",r),n>=r){if(n>r){const s=t.substr(r,n-r);i.push([s,null,wte(s)])}if(r=n+1,n=t.indexOf("]",r),n>=r){if(n>r){const s=e[t.substr(r,n-r)];s&&i.push([null,s,!1])}r=n+1}}while(n!==-1);if(r<t.length-1){const s=t.substr(r);i.push([s,null,wte(s)])}return i}function JXe(t,e,i){let r="",n=null;for(const s of e){const[o,a,l]=s;if(o)l?n=o:(n&&(r+=n,n=null),r+=o);else{const c=t.attributes[a];c&&(n&&(r+=n,n=null),r+=c)}}return KXe(r,i)}function STt(t,e,i){const r=YXe(e,t);return n=>JXe(n,r,i)}function KXe(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function CTt(t,e,i,r,n,s,o=!0){const a=e/n,l=i/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let p=0;p<s;p++)for(let f=0;f<n;f++){const y=4*(f+(o?s-p-1:p)*n);let v=0,b=0,x=0,S=0,P=0,C=0,R=0;const N=(p+.5)*l;for(let $=Math.floor(p*l);$<(p+1)*l;$++){const k=Math.abs(N-($+.5))/u,B=(f+.5)*a,W=k*k;for(let Z=Math.floor(f*a);Z<(f+1)*a;Z++){let K=Math.abs(B-(Z+.5))/c;const X=Math.sqrt(W+K*K);X>=-1&&X<=1&&(v=2*X*X*X-3*X*X+1,v>0&&(K=4*(Z+$*e),R+=v*t[K+3],x+=v,t[K+3]<255&&(v=v*t[K+3]/250),S+=v*t[K],P+=v*t[K+1],C+=v*t[K+2],b+=v))}}r[y]=S/b,r[y+1]=P/b,r[y+2]=C/b,r[y+3]=R/x}}function C1e(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function QXe(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function eYe(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function tYe(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function E1e(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const ETt=(t,e=0)=>t==null||isNaN(t)?e:t,ATt=t=>t.tintColor?C1e(t.tintColor):{r:255,g:255,b:255,a:1},PTt=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function OTt(){return Oe(()=>import("./geometryEngineJSON-5800d1f3.js"),["./geometryEngineJSON-5800d1f3.js","./geometryEngineBase-8afca563.js","./geometryEngineJSON-f5a6f910.js","./json-48e3ea08.js"],import.meta.url)}function RTt(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function MTt(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function $Tt(t){let e="normal",i="normal";if(t){const r=t.toLowerCase();r.includes("italic")?e="italic":r.includes("oblique")&&(e="oblique"),r.includes("bold")?i="bold":r.includes("light")&&(i="lighter")}return{style:e,weight:i}}function ITt(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function xte(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=xte(e);if(i!=null)return i}break;case"CIMTextSymbol":return xte(t.symbol);case"CIMSolidFill":return t.color}}function Tte(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const i of e){const r=Tte(i);if(r!=null)return r}break}case"CIMTextSymbol":return Tte(t.symbol);case"CIMSolidStroke":return t.color}}function Ste(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const i=Ste(e);if(i!==void 0)return i}break;case"CIMTextSymbol":return Ste(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function LTt(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function DTt(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function NTt(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const FTt=t=>t.includes("data:image/svg+xml");function kTt(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function A1e(t,e,i,r){if(t)if(t.type!=="CIMTextSymbol"){if(i&&t.effects)for(const n of t.effects)nYe(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":iYe(n,e,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r!=null&&r.preserveOutlineWidth)&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":A1e(n.lineSymbol,e,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function iYe(t,e,i){if(t&&(t.markerPlacement&&rYe(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const r of t.markerGraphics)t.scaleSymbolsProportionally||A1e(r.symbol,e,!0,i)}function rYe(t,e){switch(E1e(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const i=t.placementTemplate.map(r=>r*e);t.placementTemplate=i}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function nYe(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const i=t.dashTemplate.map(r=>r*e);t.dashTemplate=i}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function sYe(t){const e=[];return K7(QXe(t),e),e.length?new Lt(C1e(e[0])):null}function K7(t,e){var n;if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const r=t.type==="CIMPolygonSymbol";if(i!=null&&i.symbolLayers){for(const s of i.symbolLayers)if(!(s.colorLocked||r&&(tYe(s)||eYe(s)&&s.markerPlacement&&E1e(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&Cte(e,s.tintColor);break;case"CIMVectorMarker":(n=s.markerGraphics)==null||n.forEach(o=>{K7(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":Cte(e,s.color);break;case"CIMHatchFill":K7(s.lineSymbol,e)}}}function Cte(t,e){for(const i of t)if(i.join(".")===e.join("."))return;t.push(e)}let oYe=class{constructor(e,i){this._storage=new Uve,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),i&&this._storage.registerRemoveFunc("",i)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,i,r=1){this._storage.put(this,e,i,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};new oYe(1e3);new Lt([128,128,128]);const aYe=new Lt("white");function lYe(t){return uc(t.resource).href}function zTt(t,e){if(!t)return null;let i=null;return mb(t)?i=cYe(t):O5(t)&&(i=t.type==="cim"?sYe(t):t.color?new Lt(t.color):null),i?a3(i,e):null}function cYe(t){const e=t.symbolLayers;if(!e)return null;let i=null;return e.forEach(r=>{var n;r.type==="object"&&((n=r.resource)!=null&&n.href)||(i=r.type==="water"?r.color:r.material?r.material.color:null)}),i?new Lt(i):null}function a3(t,e){if(e==null||t==null)return t;const i=t.toRgba();return i[3]=i[3]*e,new Lt(i)}function uYe(t,e,i){const r=t.symbolLayers;if(!r)return;const n=s=>a3(e=e??s??(i!=null?aYe:null),i);r.forEach(s=>{var o;if(s.type!=="object"||!((o=s.resource)!=null&&o.href)||e)if(s.type==="water")s.color=n(s.color);else{const a=s.material!=null?s.material.color:null,l=n(a);s.material==null?s.material=new mu({color:l}):s.material.color=l,i!=null&&"outline"in s&&s.outline!=null&&s.outline.color!=null&&(s.outline.color=a3(s.outline.color,i))}})}function hYe(t,e,i){(e=e??t.color)&&(t.color=a3(e,i)),i!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=a3(t.outline.color,i))}function BTt(t,e,i){t&&(e||i!=null)&&(e&&(e=new Lt(e)),mb(t)?uYe(t,e,i):O5(t)&&hYe(t,e,i))}async function dYe(t,e){const i=t.symbolLayers;i&&await Y5(i,async r=>pYe(r,e))}async function pYe(t,e){switch(t.type){case"extrude":mYe(t,e);break;case"icon":case"line":case"text":fYe(t,e);break;case"path":_Ye(t,e);break;case"object":await gYe(t,e)}}function fYe(t,e){const i=P1e(e);i!=null&&(t.size=i)}function P1e(t){for(const e of t)if(typeof e=="number")return e;return null}function mYe(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function gYe(t,e){const{resourceSize:i,symbolSize:r}=await yYe(t),n=O1e(e,i,r);t.width=iP(e[0],r[0],i[0],n),t.depth=iP(e[1],r[1],i[1],n),t.height=iP(e[2],r[2],i[2],n)}function _Ye(t,e){const i=O1e(e,ug,[t.width,void 0,t.height]);t.width=iP(e[0],t.width,1,i),t.height=iP(e[2],t.height,1,i)}function O1e(t,e,i){for(let r=0;r<3;r++){const n=t[r];switch(n){case"symbol-value":{const s=i[r];return s!=null?s/e[r]:1}case"proportional":break;default:if(n&&e[r])return n/e[r]}}return 1}async function yYe(t){const{computeObjectLayerResourceSize:e}=await Oe(()=>import("./symbolLayerUtils-cf6fa35a.js"),[],import.meta.url),i=await e(t,10),{width:r,height:n,depth:s}=t,o=[r,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/i[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function iP(t,e,i,r){switch(t){case"proportional":return i*r;case"symbol-value":return e??i;default:return t}}function vYe(t,e){const i=P1e(e);if(i!=null)switch(t.type){case"simple-marker":t.size=i;break;case"picture-marker":{const r=t.width/t.height;r>1?(t.width=i,t.height=i*r):(t.width=i*r,t.height=i);break}case"simple-line":t.width=i;break;case"text":t.font.size=i}}async function VTt(t,e){if(t&&e)return mb(t)?dYe(t,e):void(O5(t)&&vYe(t,e))}function GTt(t,e,i){if(t&&e!=null)if(mb(t)){const r=t.symbolLayers;r&&r.forEach(n=>{if(n&&n.type==="object")switch(i){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else O5(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function jTt(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function HTt(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function bYe(t,e,i,r,n){if(t==null)return null;const s=t.referencesGeometry()&&n?wYe(e,r,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...i,$feature:o},t.services)}catch(a){return ye.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const qk=new Map;function wYe(t,e,i){const{transform:r,hasZ:n,hasM:s}=i;qk.has(e)||qk.set(e,xYe(e));const o=qk.get(e)(t.geometry,r,n,s);return{...t,geometry:o}}function xYe(t){const e={};switch(t){case"esriGeometryPoint":return(i,r,n,s)=>X_e(r,e,i,n,s);case"esriGeometryPolygon":return(i,r,n,s)=>Y_e(r,e,i,n,s);case"esriGeometryPolyline":return(i,r,n,s)=>J_e(r,e,i,n,s);case"esriGeometryMultipoint":return(i,r,n,s)=>Z_e(r,e,i,n,s);default:return ye.getLogger("esri.views.2d.support.arcadeOnDemand").error(new ce("mapview-arcade",`Unable to handle geometryType: ${t}`)),i=>i}}const WTt=1.2,TYe=Df;let H4=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,hn.ADD);if(e||this._addedToStage){for(const i of this.renderGeometries)i.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,zs.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,hn.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=I()){return me(e,0,0,0)}getBoundingBoxObjectSpace(e=$s()){return Gr(e)}addObjectState(e,i){e===Ng.Highlight&&(this.renderGeometries.forEach(r=>{const n=r.geometry.addHighlight();i.addRenderGeometry(r,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,zs.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(i=>{e.removeRenderGeometry(i)})}removeRenderGeometryObjectState(e,i){e.geometry.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,zs.HIGHLIGHT)}computeAttachmentOrigin(e){for(const i of this.renderGeometries)i.geometry.computeAttachmentOrigin(Qw)&&(e.draped.origin[0]+=Qw[0],e.draped.origin[1]+=Qw[1],e.draped.num++)}async getProjectedBoundingBox(e,i,r,n,s){Gr(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,Ete,r),NRe(s,Ete)}if(i){let o;Zd(s,Qw);const a=WW(s,i.service.spatialReference,i);try{o=await i.service.queryElevation(Qw[0],Qw[1],n,a,"ground")}catch{}o!=null&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,i,r,n){if(this.boundingBox)v5(Fp,this.boundingBox);else{const s=e.boundingSphere,o=s[3];Fp[0]=s[0]-o,Fp[1]=s[1]-o,Fp[2]=s[2]-o,Fp[3]=s[0]+o,Fp[4]=s[1]+o,Fp[5]=s[2]+o}return i(Fp,0,2),this.calculateRelativeScreenBounds&&n.push({location:Zd(Fp),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),uj(Fp,r)}};const Ete=li(),Fp=$s(),Qw=I();let R1e=class{constructor(e,i,r,n=2048){this.text=e,this._alignment=i,this._parameters=r,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),i=this._lineHeight;return Math.ceil(e+i+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=Q7(Ate,VM,VM).getContext("2d");this._setFontProperties(e,this._fontSize);let i=2*this._haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((v,b)=>{const x=e.measureText(v),S=x.width,P=S+i;this._textWidths.push(S),this._lineWidths.push(P),o=Math.max(o,P),a=Math.max(a,x.actualBoundingBoxAscent),l=Math.max(l,x.actualBoundingBoxDescent),b===0&&(n=x),b===this._lines.length-1&&(s=x)});const c=e.font;let u=Ote.get(c);if(!u){const v=e.measureText(CYe);u=new AYe(v.actualBoundingBoxAscent,v.actualBoundingBoxDescent),Ote.set(c,u)}a=Math.max(a,u.actualBoundingBoxAscent),l=Math.max(l,u.actualBoundingBoxDescent);const p=a+l,f=this._hasBackground?n.actualBoundingBoxAscent:a,y=this._hasBackground?s.actualBoundingBoxDescent:l;this._metricsCached=new EYe(a-f,l-y,p,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*SYe}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case ey.Left:return this._backgroundHorizontalPadding;case ey.Center:return(this.displayWidth-this._lineWidths[e])/2;case ey.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,i=0,r=0){e.save();const n=i/=this.renderPixelRatio,s=r/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;i+=o,r+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],p=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,i+p,r),this._renderLineDecoration(e,i+p,r,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,i+this._getLineXOffset(c),r),this._renderLineDecoration(e,i+p,r,this._textWidths[c]),r+=this._lineSpacing}if(Or.TEXT_SHOW_BASELINE){e.strokeStyle=Pte,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let u=0;u<this._lines.length;++u){const p=c+this._baselinePosition;this._drawLine(e,[n,p],[n+this.displayWidth,p]),c+=this._lineSpacing}}if(Or.TEXT_SHOW_BORDER&&(e.strokeStyle=Pte,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,i,r,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this._baselinePosition}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(i+n+l),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,i,r,n){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=$e(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(i,r+n),e.arcTo(i,r,i+n,r,n),e.lineTo(i+s-n,r),e.arcTo(i+s,r,i+s,r+n,n),e.lineTo(i+s,r+o-n),e.arcTo(i+s,r+o,i+s-n,r+o,n),e.lineTo(i+n,r+o),e.arcTo(i,r+o,i,r+o-n,n),e.closePath()):e.rect(i,r,s,o)}_renderHalo(e,i,r,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=Q7(Ate,Math.max(o,VM),Math.max(a,VM)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let p=s+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const y=this._getLineXOffset(f);this._renderLineDecoration(c,n+y,p,this._textWidths[f],!0),p+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),e.globalAlpha=1}_renderHaloEmulated(e,i,r){r+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of M1e)this._fillText(e,s,i+o+this._haloSize*a,r+this._haloSize*l);r+=this._lineSpacing}}_renderHaloNative(e,i,r){const n=2*this._haloSize;r+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const p=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(p*n),this._strokeText(e,o,i+a,r)}r+=this._lineSpacing}}_setFontProperties(e,i){e.font=this._parameters.fontString(i),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,i,r,n){e.fillText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_strokeText(e,i,r,n){e.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(n))}_drawLine(e,i,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,i,r){const n=this._toRenderUnit(i[0]),s=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,u=Math.floor(s)+.5,p=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,p),e.lineTo(l,p),e.lineTo(l,u),e.stroke()}};const M1e=[];for(let e=0;e<360;e+=360/16)M1e.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var ey;function Q7(t,e,i){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=i,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(ey||(ey={}));const Ate={canvas:null},SYe=.2,VM=512,Pte="rgb(255, 0, 255, 0.5)",CYe=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let EYe=class{constructor(e,i,r,n,s){this.paddingTop=e,this.paddingBottom=i,this.lineHeight=r,this.displayWidth=n,this.baselinePosition=s}},AYe=class{constructor(e,i){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=i}};const Ote=new Map,PYe=Object.freeze({left:0,center:.5,right:1}),KI=Object.freeze({"bottom-left":Ri(0,0),bottom:Ri(.5,0),"bottom-right":Ri(1,0),left:Ri(0,.5),center:Ri(.5,.5),right:Ri(1,.5),"top-left":Ri(0,1),top:Ri(.5,1),"top-right":Ri(1,1)});function $1e(t){switch(t){case"left":return ey.Left;case"right":return ey.Right;default:return ey.Center}}function Rte(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function OYe(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function RYe(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function MYe(t){return t==="middle"?"center":t}let XT=class{constructor(e,i={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=Ne(),this._shaderTransformation=null,this._boundingSphere=null,this.id=xc(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.shaderTransformer=i.shaderTransformer,this.castShadow=i.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=st(kn(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*CT(this.shaderTransformation),this._boundingSphere):Kde}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=Qn(Ne(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const $Ye=Ne(),Mte=Ge(0,0,1),IYe=16,LYe=1.5,D1=kW,DYe=[D1/2,D1/2,1-D1/2,1-D1/2],NYe=[e3*D1,e3*D1];let eV=class I1e extends cm{getCachedSize(){return{size:this._getIconSize()}}constructor(e,i,r,n){super(e,i,r,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(r!=null)this._prepareResourcesPrimitive(i,r);else{const n=lYe(this.symbolLayer),s=hb(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(s.data),e):await this._prepareResourcesHref(i,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=M4(this._getIconSize());if(e)throw new ce("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,i=Math.round(e.size!=null?Sa(e.size):IYe);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(e){const i=this._getGraphicHash(e);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height};r=new Kb(s.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(FYe(i)){const{screenLength:r,minWorldLength:n,maxWorldLength:s}=i.verticalOffset;e.verticalOffset={screenLength:Sa(r),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,i){const r=this._getOutlineSize();if(Zk(i)&&r===0)throw new Error("Nothing to render");if(this._outlineSize=r,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${i}-icon`,()=>eGe(i));this._texture=s.texture,this._releaseTexture=s,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=DYe;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/D1,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,i,r){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await Lg(this._context.sharedResources.textures.fromUrl(i,s,{signal:r}));if(o.ok===!1)throw kb(o.error),new ce("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[n,Math.round(n/l)]:[Math.round(n*l),n],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,i,r){const n=new N3({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await Oe(()=>import("./CIMSymbolRasterizer-259edb0a.js"),["./CIMSymbolRasterizer-259edb0a.js","./cimAnalyzer-9a5eb2c3.js","./TileClipper-ae6eca9e.js","./definitions-bc94d273.js","./number-e491b09e.js","./BidiEngine-9a40f2f4.js","./imageutils-cf396433.js","./rasterizingUtils-a3cc983a.js"],import.meta.url)).CIMSymbolRasterizer;Ti(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const p=u.scaleExpression,f=await dPe(p,this._context.layer.spatialReference,s);a=(y,v,b)=>{const x=bYe(f,y,{$view:b},"esriGeometryPoint",v);return x!==null?x:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Ti(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||$Me}_getOutlineSize(){let e=0;const i=this.symbolLayer;return i.outline!=null&&i.outline.size!=null?Math.max(Sa(i.outline.size),0):(e=Zk(this._getPrimitive())?LYe:0,Math.max(e,0))}_getOutlineColor(){var n;const e=this._getLayerOpacity(),i=this.symbolLayer,r=(n=i==null?void 0:i.outline)==null?void 0:n.color;if(r!=null){const s=Lt.toUnitRGB(r),o=r.a*e;return[s[0],s[1],s[2],o]}return[0,0,0,0]}_getFillColor(){var r,n;if(Zk(this._getPrimitive()))return TYe;const e=this._getPrimitive()==null,i=(n=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:n.color;return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:e})}_getAnchorPos(e,i){return e==="relative"?Ri((i.x||0)+.5,.5-(i.y||0)):e in KI?KI[e]:KI.center}_createMaterialAndAddToStage(e,i){if(this._cimLayers){this._fastUpdates=null;let r=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return r||(r=new jT(e),this._cimSymbolMaterials.set(e.textureId??0,r),i.add(r)),r}return this._fastUpdates=VT(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new jT(e),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=nn(this._releaseTexture)}_getScaleFactor(e,i){if(this._drivenProperties.size&&e.size){for(let r=0;r<3;r++){const n=e.size[r];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[r]=Sa(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/i;if(isFinite(+e.size[2]))return+e.size[2]/i}return 1}createGraphics3DGraphic(e){var p;const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;let r,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const f=this._generateTextureCIM(i),y={textureId:f.id,...this._cimMaterialParametersInfo};r=this._createMaterialAndAddToStage(y,this._context.stage),n=[f.parameters.width,f.parameters.height]}else n=this._size,r=this._material;const s=i3(i.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((p=this._fastUpdates)!=null&&p.visualVariables.size)){const f=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,f)}l*=this._symbolTextureRatio;const c=Ri(n[0]*l,n[1]*l),u=this.setGraphicElevationContext(i,new wp);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,s,r,a,c,e.layer.uid):this._createAs3DShape(i,s,r,a,c,u,i.uid)}layerOpacityChanged(){const e=this._getFillColor(),i=this._getOutlineColor();this._forEachMaterial(r=>{r.setParameters({color:e}),r.setParameters({outlineColor:i})})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=sO(I1e.elevationModeChangeTypes,r,n);if(s!==Pn.UPDATE)return s;const o=Zh(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!GT(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return Jn.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return Jn.FastUpdate}_defaultElevationInfoNoZ(){return kYe}_createAs3DShape(e,i,r,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?b=>$7(this._fastUpdates.materialParameters,l,b):void 0,u=this._context.layer.uid,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:u}),f=r7(r,Mte,null,n,s,UYe,null,l,p),y=KW(this._context,i,f,o,a,c);if(y==null)return null;const v=new lm(this,y.object,[f],null,null,W1,o);return v.alignedSampledElevation=y.sampledElevation,v.needsElevationUpdates=Zh(o.mode)||o.mode==="absolute-height",v.getScreenSize=this._createScreenSizeGetter(s,c),v.calculateRelativeScreenBounds=b=>r.calculateRelativeScreenBounds(v.getScreenSize(),1,b),t3(v,i,this._context.elevationProvider),v}_createAsOverlay(e,i,r,n,s,o){r.renderPriority=this._renderPriority;const a=gi();No(i,a,this._context.overlaySR),a[2]=wq;const l=this._context.clippingExtent;if(l!=null&&!cj(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=c&&this._fastUpdates?b=>$7(this._fastUpdates.materialParameters,c,b):void 0,p=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=r7(r,Mte,a,n,s,null,null,c,p),y=new XT(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:u}),v=new H4(this,[y],null,this._context.drapeSourceRenderer);return v.getScreenSize=this._createScreenSizeGetter(s,u),v.calculateRelativeScreenBounds=b=>r.calculateRelativeScreenBounds(v.getScreenSize(),1,b),v}_createScreenSizeGetter(e,i){const r=this._outlineSize+2;if(this._fastUpdates&&i){const n=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(o=it())=>{const a=i($Ye);return o[0]=a[0]*n+r,o[1]=a[5]*s+r,o}}{const n=e[0]/this._symbolTextureRatio+r,s=e[1]/this._symbolTextureRatio+r;return(o=it())=>(o[0]=n,o[1]=s,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),i=Ge(e,e,e),r=dp(1),n=e*r,s=Ge(n,n,n);return new rO({size:!0,color:!0,rotation:!0,opacity:!1},i,s,r)}_getGraphicHash(e){let i="";for(const r of this._cimRequiredFields)i+=r+e.attributes[r];return i}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function FYe(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function Zk(t){return t!=null&&(t==="cross"||t==="x")}eV.PRIMITIVE_SIZE=NYe,eV.elevationModeChangeTypes={definedChanged:Pn.UPDATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE};const kYe={mode:"relative-to-ground",offset:0},UYe=Kt(0,0,0,1);function tV(t){switch(t){case"butt":return Lh.BUTT;case"square":return Lh.SQUARE;case"round":return Lh.ROUND;default:return null}}function $te(t){return t==="diamond"?"kite":t}function iV(t,e,i=null){const r=[],n=[],s=e.mapPositions;zYe(e,n,r);const o=n[0][1].data,a=r[0][1].length,l=bS(a);return BYe(e,n,r,l),jYe(e,n,r,l),VYe(e,n,r,l),GYe(e,n,r,l),HYe(e,n,r,l),WYe(e,n,r,l),qYe(e,n,r,o),new fs(t,n,r,s,An.Line,i)}function zYe(t,e,i){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,s=ZYe(r)&&n,o=r.length/3-(s?1:0),a=new Array(2*(o-1)),l=s?r.slice(0,r.length-3):r;let c=0;for(let u=0;u<o-1;u++)a[c++]=u,a[c++]=u+1;e.push([M.POSITION,new nt(l,3,s)]),i.push([M.POSITION,a])}function BYe(t,e,i,r){if(t.attributeData.colorFeature!=null)return;const n=t.attributeData.color;e.push([M.COLOR,new nt(n??Sh,4)]),i.push([M.COLOR,r])}function VYe(t,e,i,r){if(t.attributeData.normal==null)return;const n=t.attributeData.normal;e.push([M.NORMAL,new nt(n,3)]),i.push([M.NORMAL,r])}function GYe(t,e,i,r){t.attributeData.colorFeature!=null&&(e.push([M.COLORFEATUREATTRIBUTE,new nt([t.attributeData.colorFeature],1,!0)]),i.push([M.COLOR,r]))}function jYe(t,e,i,r){t.attributeData.sizeFeature==null&&(e.push([M.SIZE,new nt([t.attributeData.size??1],1,!0)]),i.push([M.SIZE,r]))}function HYe(t,e,i,r){t.attributeData.sizeFeature!=null&&(e.push([M.SIZEFEATUREATTRIBUTE,new nt([t.attributeData.sizeFeature],1,!0)]),i.push([M.SIZEFEATUREATTRIBUTE,r]))}function WYe(t,e,i,r){const n=t.attributeData.opacityFeature;n!=null&&(e.push([M.OPACITYFEATUREATTRIBUTE,new nt([n],1,!0)]),i.push([M.OPACITYFEATUREATTRIBUTE,r]))}function qYe(t,e,i,r){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==Ke.Global||!t.overlayInfo.spatialReference.isGeographic)return;const n=ia(r.length),s=lr(t.overlayInfo.spatialReference);for(let f=0;f<n.length;f+=3)F5(r,f,n,f,s);const o=r.length/3,a=mn(o+1);let l=XYe,c=YYe,u=0,p=0;me(l,n[p++],n[p++],n[p++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(p=0),me(c,n[p++],n[p++],n[p++]),u+=kfe(l,c),a[f]=u,[l,c]=[c,l];e.push([M.DISTANCETOSTART,new nt(a,1,!0)]),i.push([M.DISTANCETOSTART,i[0][1]])}function ZYe(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const XYe=I(),YYe=I();function KTt(t,e){if(t==null||t.length===0)return[];const i=[];return t.forEach(r=>{const n=r.length,s=ia(3*n);r.forEach((a,l)=>{s[3*l]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};i.push(o)}),i}function JYe(t,e,i,r){const n=t.type==="polygon"?Yf.CCW_IS_HOLE:Yf.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=lO(s,!!t.hasZ,n),l=ia(o.length),c=uye(o,t.spatialReference,0,l,0,o,0,o.length/3,e,i,r),u=c!=null;return{lines:u?L1e(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function KYe(t,e){const i=t.type==="polygon"?Yf.CCW_IS_HOLE:Yf.NONE,r=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=lO(r,!1,i),o=_n(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=wq;return{lines:o?L1e(s,n):[],projectionSuccess:o}}function L1e(t,e,i=null){const r=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;r.push({position:Ih(e,3*n,3*s),mapPositions:i!=null?Ih(i,o,a):void 0})}return r}function QYe(t){const e=new Fi,i=t.hasMultipassTerrain&&(t.output===j.Color||t.output===j.Alpha),r=t.space===bu.World;e.include(hve,t),e.include(yve,t),t.output===j.Depth&&e.include(Ug,t);const{vertex:n,fragment:s}=e;return s.include(Ac),Tc(n,t),e.attributes.add(M.POSITION,"vec3"),e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),gy(e),i&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new Bi("nearFar",(o,a)=>a.camera.nearFar),new yi("viewport",(o,a)=>a.camera.fullViewport)),n.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),r?(e.attributes.add(M.NORMAL,"vec3"),UT(n),n.constants.add("tiltThreshold","float",.7),n.code.add(T`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(T`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(T`
      #define vecN ${r?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${r?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===Ob.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===bu.Screen&&(n.uniforms.add(new en("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new je("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),ES(n,t),r4(e),n.code.add(T`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),r?(t.hideOnShortSegments&&n.code.add(T`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(T`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(T`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===bu.Screen&&n.code.add(T`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(T`
        ${i?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${r?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&e.include(Au,t),e.include(Nn,t),s.uniforms.add(new yi("intrinsicColor",o=>o.color),new vt("tex",o=>o.markerTexture)),s.include(am),e.constants.add("texelSize","float",1/q1),s.code.add(T`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",lq/q1),e.constants.add("relativeTipLineWidth","float",hqe),s.code.add(T`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${r?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Mo),s.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${r?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===j.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===j.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===j.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===j.Color&&t.transparencyPassType===At.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===j.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===j.Depth?T`outputDepth(linearDepth);`:""}
  }
  `),e}const eJe=Object.freeze(Object.defineProperty({__proto__:null,build:QYe},Symbol.toStringTag,{value:"Module"})),D1e=new Map([[M.POSITION,0],[M.UV0,2],[M.AUXPOS1,3],[M.NORMAL,4],[M.COLOR,5],[M.COLORFEATUREATTRIBUTE,5],[M.SIZE,6],[M.SIZEFEATUREATTRIBUTE,6],[M.OPACITYFEATUREATTRIBUTE,7]]);let N1e=class F1e extends qi{initializeProgram(e){return new Gi(e.rctx,F1e.shader.get().build(this.configuration),D1e)}_makePipelineState(e,i){const r=this.configuration,n=e===At.NONE;return Zt({blending:r.output===j.Color||r.output===j.Alpha?n?vu:Qg(e):null,depthTest:{func:Dy(e)},depthWrite:n?r.writeDepth?Nl:null:E4(e),colorWrite:ni,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?Ey:Ny:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Zt({blending:vu,depthTest:sN,depthWrite:null,colorWrite:ni,stencilWrite:null,stencilTest:wve}),this._occluderPipelineOpaque=Zt({blending:vu,depthTest:sN,depthWrite:null,colorWrite:ni,stencilWrite:vve,stencilTest:bve}),this._occluderPipelineMaskWrite=Zt({blending:null,depthTest:cq,depthWrite:null,colorWrite:null,stencilWrite:Jf,stencilTest:Ey})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:this.configuration.occluder?e===Te.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===Te.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,i)}};N1e.shader=new Vi(eJe,()=>Oe(()=>import("./LineMarker.glsl-f799b034.js"),[],import.meta.url));let tJe=class extends Ly{constructor(e){super(e,new rJe),this._vertexAttributeLocations=D1e,this._configuration=new Eo,this._layout=this.createLayout()}dispose(){}getConfiguration(e,i){return this._configuration.output=e,this._configuration.space=i.slot===Te.DRAPED_MATERIAL?bu.Draped:this.parameters.worldSpace?bu.World:bu.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Lh.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===Kr.OccludeAndTransparentStencil,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=ln().vec3f(M.POSITION).vec2f(M.UV0).vec3f(M.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(M.NORMAL),this.parameters.vvSize?e.f32(M.SIZEFEATUREATTRIBUTE):e.f32(M.SIZE),this.parameters.vvColor?e.f32(M.COLORFEATUREATTRIBUTE):e.vec4f(M.COLOR),this.parameters.vvOpacity&&e.f32(M.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new nJe(this._layout,this.parameters)}requiresSlot(e,i){return i===j.Color||i===j.Alpha||i===j.Highlight||i===j.Depth?e===Te.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===Kr.OccludeAndTransparentStencil?e===Te.OPAQUE_MATERIAL||e===Te.OCCLUDER_MATERIAL||e===Te.TRANSPARENT_OCCLUDER_MATERIAL:i===j.Color||i===j.Alpha?e===(this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Te.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new iJe(e)}},iJe=class extends PH{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const i=this._material.parameters.markerPrimitive;return i!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(i,this._markerPrimitive)}),this._markerPrimitive=i),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(N1e,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==j.Color&&this._output!==j.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},rJe=class extends nO{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Lh.BUTT,this.anchor=Ob.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},nJe=class{constructor(e,i){this.vertexBufferLayout=e,this._parameters=i}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,i,r,n,s){const o=r.vertexAttributes.get(M.POSITION).data,a=o.length/3;let l=[1,0,0];const c=r.vertexAttributes.get(M.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,p=0;this._parameters.vvSize?p=r.vertexAttributes.get(M.SIZEFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.SIZE)&&(u=r.vertexAttributes.get(M.SIZE).data[0]);let f=[1,1,1,1],y=0;this._parameters.vvColor?y=r.vertexAttributes.get(M.COLORFEATUREATTRIBUTE).data[0]:r.vertexAttributes.has(M.COLOR)&&(f=r.vertexAttributes.get(M.COLOR).data);let v=0;this._parameters.vvOpacity&&(v=r.vertexAttributes.get(M.OPACITYFEATUREATTRIBUTE).data[0]);const b=new Float32Array(n.buffer);let x=s*(this.vertexBufferLayout.stride/4);const S=(N,$,k,B)=>{if(b[x++]=N[0],b[x++]=N[1],b[x++]=N[2],b[x++]=k[0],b[x++]=k[1],b[x++]=$[0],b[x++]=$[1],b[x++]=$[2],this._parameters.worldSpace&&(b[x++]=l[0],b[x++]=l[1],b[x++]=l[2]),this._parameters.vvSize?b[x++]=p:b[x++]=u,this._parameters.vvColor)b[x++]=y;else{const W=Math.min(4*B,f.length-4);b[x++]=f[W],b[x++]=f[W+1],b[x++]=f[W+2],b[x++]=f[W+3]}this._parameters.vvOpacity&&(b[x++]=v)};let P;(function(N){N[N.ASCENDING=1]="ASCENDING",N[N.DESCENDING=-1]="DESCENDING"})(P||(P={}));const C=(N,$)=>{const k=me(sJe,o[3*N],o[3*N+1],o[3*N+2]),B=oJe;let W=N+$;do me(B,o[3*W],o[3*W+1],o[3*W+2]),W+=$;while(ny(k,B)&&W>=0&&W<a);e&&(st(k,k,e),st(B,B,e)),S(k,B,[-1,-1],N),S(k,B,[1,-1],N),S(k,B,[1,1],N),S(k,B,[-1,-1],N),S(k,B,[1,1],N),S(k,B,[-1,1],N)},R=this._parameters.placement;R!=="begin"&&R!=="begin-end"||C(0,P.ASCENDING),R!=="end"&&R!=="begin-end"||C(a-1,P.DESCENDING)}};const sJe=I(),oJe=I(),ua={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},aJe={dash:ua.dash,"dash-dot":[...ua.dash,...ua.dot],dot:ua.dot,"long-dash":ua["long-dash"],"long-dash-dot":[...ua["long-dash"],...ua.dot],"long-dash-dot-dot":[...ua["long-dash"],...ua.dot,...ua.dot],none:null,"short-dash":ua["short-dash"],"short-dash-dot":[...ua["short-dash"],...ua["short-dot"]],"short-dash-dot-dot":[...ua["short-dash"],...ua["short-dot"],...ua["short-dot"]],"short-dot":ua["short-dot"],solid:null},lJe=8;function cJe(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function rSt(t){return{pattern:[t,t],pixelRatio:2}}function k1e(t){return t!=null&&t.type==="style"?uJe(t.style):null}function uJe(t){return t!=null?cJe(aJe[t],lJe):null}const hJe=["polyline","polygon","extent"],Ite=new rO({size:!0,color:!0,rotation:!1,opacity:!0});let U1e=class z1e extends cm{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){if(this._fastUpdates=VT(this._context.renderer,Ite),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:dp(1))<0)throw new ce("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,i=!1){var s,o;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:tV(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:k1e(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return(o=this._fastUpdates)!=null&&o.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new O2(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new O2(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new O2({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new O2({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new tJe({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:$te(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Sa(DWe(e.size)):1}_getDrivenColor(e){const i=Kt(1,1,1,1);return this._drivenProperties.color&&e.color&&(i[0]=e.color[0],i[1]=e.color[1],i[2]=e.color[2],e.color.length>0&&(i[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(i[3]=e.opacity),i}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,hJe,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new wp);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,r,i.uid)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables")return Jn.RecreateSymbol;{const n=this._fastUpdates;if(!GT(n,i,Ite))return Jn.RecreateSymbol;this._forEachMaterial(s=>s.setParameters(n.materialParameters))}}return Jn.FastUpdate}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const i=e.diff.diff,r={};((s=i.size)==null?void 0:s.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=tV(i.cap.newValue??"butt"),delete i.cap);const n=this._prepareMarkerPatch(e,i);this._prepareMaterialPatch(e,i,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){this._forEachMaterial((e,i)=>this._updateMaterialLayerOpacity(e,i))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,i=!1){var a,l;const r=e.parameters.color,n=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._patternHidesLine&&!i?0:this._getCombinedOpacity(n),o=Kt(r[0],r[1],r[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=sO(z1e.elevationModeChangeTypes,r,n);if(s!==Pn.UPDATE)return s;const o=Zh(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof Ar)return zb.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,i,r){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=$s(),c=JYe(s,this._context.elevationProvider,this._context.renderCoordsHelper,i),u=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let y=0;y<c.lines.length;y++){const v=c.lines[y],b=v.position,x=v.mapPositions;if(this._context.clippingExtent!=null&&(Gr(l),du(l,x),!Xd(l,this._context.clippingExtent)))continue;const S=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,b,x,s.type,rP.ELEVATED,r);a.push(S),Or.LINE_WIREFRAMES&&a.push(S.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(S.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const p=new e0({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),f=new lm(this,p,a,null,null,eHe,i);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=Zh(i.mode),f}_createGeometry(e,i,r,n,s,o,a){var b,x,S;const l=o===rP.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=s==="polygon",u=(b=this._fastUpdates)==null?void 0:b.visualVariables.color,p=(x=this._fastUpdates)==null?void 0:x.visualVariables.size,f=(S=this._fastUpdates)==null?void 0:S.visualVariables.opacity,y=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),v={position:r,size:p?null:this._getDrivenSize(i.renderingInfo),color:u?null:this._getDrivenColor(i.renderingInfo),sizeFeature:p?op(p.field,i.graphic):null,colorFeature:u?op(u.field,i.graphic):null,opacityFeature:f?op(f.field,i.graphic):null};return iV(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:n,attributeData:v},y)}_createAsOverlay(e,i){const r=e.graphic,n=this._getGeometryAsPolygonOrPolyline(r.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Or.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=$s(),p=Gr(),f=KYe(n,this._context.overlaySR),y=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,s,y,"LineSymbol3DLayer");for(const v of f.lines){if(Gr(u),du(u,v.position),!Xd(u,this._context.clippingExtent))continue;_T(p,u);const b=x=>{const S=this._createGeometry(x,e,v.position,void 0,n.type,rP.DRAPED,r.uid),P=new XT(S,{layerUid:i,graphicUid:r.uid});c.push(P)};if(l!=null){b(l);const x=this.symbolLayer.marker.placement;x!=="begin"&&x!=="begin-end"||du(u,v.position,0,1),x!=="end"&&x!=="begin-end"||du(u,v.position,v.position.length-3,1)}b(o),Or.LINE_WIREFRAMES&&b(a)}return new H4(this,c,p,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var i;return e=e??dp(1),this._drivenProperties.size?(i=this._fastUpdates)!=null&&i.visualVariables.size?Sa(1):1:Sa(e)}_prepareMaterialPatch(e,i,r){var a,l;const n=i.material;if(n==null)return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(n.type==="collection")return;const s=n.type==="complete"?(a=n.newValue)==null?void 0:a.color:((l=n.diff.color)==null?void 0:l.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);r.useMaterialColor&&this._patchMaterialColor(G3(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete i.material}_prepareMarkerPatch(e,i){var u;const r=i.marker,n=this._markerMaterial;if(r==null||r.type!=="partial"||r.diff==null||r.diff.placement!=null||r.diff.style!=null&&r.diff.style.type!=="complete"||r.diff.color!=null&&r.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=r.diff.color,o=s!=null,a=o?s.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),n,e);const c=(u=r.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:$te(c)})),delete i.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,i,r){i!=null&&r.symbolLayerStatePatches.push(()=>i.setParameters({color:e}))}};var rP;U1e.elevationModeChangeTypes={definedChanged:Pn.RECREATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(rP||(rP={}));let LC=null,cN=!0;function Xk(t,e,i){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(cN)try{return new ImageData(t,e)}catch{cN=!1}return B1e(t,e,i)}function dJe(t,e,i,r){if(!e||!i)throw new Error("Cannot construct image data without dimensions");if(cN)try{return new ImageData(t,e,i)}catch{cN=!1}const n=B1e(e,i,r);return n.data.set(t,0),n}function pJe(){return LC||(LC=document.createElement("canvas"),LC.width=1,LC.height=1),LC}function B1e(t,e,i){return i||(i=pJe()),i.getContext("2d").createImageData(t,e)}var e2;const Yk=new WeakMap;let fJe=0,lf=e2=class extends Nt{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,i,r){if(t instanceof HTMLImageElement){const n={type:"image-element",src:vT(t.src,r),crossOrigin:t.crossOrigin};e[i]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[i]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:vT(t.src,r),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[i]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[i]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").putImageData(e,0,0),i}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const i=e.substr(e.length-4,4).toLowerCase(),r=e.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(i="")=>`d:${i},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(Yk.has(this.data)||Yk.set(this.data,++fJe),e(Yk.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new e2(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const i=this.clone();return t.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let i=0;i<t.data.length;i++)e+=String.fromCharCode(t.data[i]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),i=new Uint8ClampedArray(e.length);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return dJe(i,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new e2({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new e2({data:t}):uT(e2,t)}};d([m({type:String,json:{write:pb}})],lf.prototype,"url",null),d([m({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),m()],lf.prototype,"data",null),d([Pr("data")],lf.prototype,"writeData",null),d([yr("data")],lf.prototype,"readData",null),d([m({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],lf.prototype,"transparent",null),d([m({json:{write:!0}})],lf.prototype,"wrap",void 0),d([m({readOnly:!0})],lf.prototype,"contentHash",null),lf=e2=d([J("esri.geometry.support.MeshTexture")],lf);const nP=lf;let t2=class extends em(Nt){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};d([m({type:[Number],nonNullable:!0,json:{write:!0}})],t2.prototype,"offset",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0}})],t2.prototype,"rotation",void 0),d([m({type:[Number],nonNullable:!0,json:{write:!0}})],t2.prototype,"scale",void 0),t2=d([J("esri.geometry.support.MeshTextureTransform")],t2);const Q2=t2;var rV;let Ad=rV=class extends Nt{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new rV(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}clonePropertiesWithDeduplication(t){var e,i,r,n;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(i=this.normalTexture)==null?void 0:i.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(r=this.colorTextureTransform)==null?void 0:r.clone(),normalTextureTransform:(n=this.normalTextureTransform)==null?void 0:n.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};d([m({type:Lt,json:{write:!0}})],Ad.prototype,"color",void 0),d([m({type:nP,json:{write:!0}})],Ad.prototype,"colorTexture",void 0),d([m({type:Q2,json:{write:!0}})],Ad.prototype,"colorTextureTransform",void 0),d([m({type:nP,json:{write:!0}})],Ad.prototype,"normalTexture",void 0),d([m({type:Q2,json:{write:!0}})],Ad.prototype,"normalTextureTransform",void 0),d([m({nonNullable:!0,json:{write:!0}})],Ad.prototype,"alphaMode",void 0),d([m({nonNullable:!0,json:{write:!0}})],Ad.prototype,"alphaCutoff",void 0),d([m({nonNullable:!0,json:{write:!0}})],Ad.prototype,"doubleSided",void 0),Ad=rV=d([J("esri.geometry.support.MeshMaterial")],Ad);const Oq=Ad;var nV;let oh=nV=class extends Oq{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const i=t!=null?t.get(this):null;if(i)return i;const r=new nV(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,r),r}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,i,r,n,s,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(i=this.emissiveTexture)==null?void 0:i.cloneWithDeduplication(t),emissiveTextureTransform:(r=this.emissiveTextureTransform)==null?void 0:r.clone(),occlusionTexture:(n=this.occlusionTexture)==null?void 0:n.cloneWithDeduplication(t),occlusionTextureTransform:(s=this.occlusionTextureTransform)==null?void 0:s.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};d([m({type:Lt,json:{write:!0}})],oh.prototype,"emissiveColor",void 0),d([m({type:nP,json:{write:!0}})],oh.prototype,"emissiveTexture",void 0),d([m({type:Q2,json:{write:!0}})],oh.prototype,"emissiveTextureTransform",void 0),d([m({type:nP,json:{write:!0}})],oh.prototype,"occlusionTexture",void 0),d([m({type:Q2,json:{write:!0}})],oh.prototype,"occlusionTextureTransform",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],oh.prototype,"metallic",void 0),d([m({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],oh.prototype,"roughness",void 0),d([m({type:nP,json:{write:!0}})],oh.prototype,"metallicRoughnessTexture",void 0),d([m({type:Q2,json:{write:!0}})],oh.prototype,"metallicRoughnessTextureTransform",void 0),oh=nV=d([J("esri.geometry.support.MeshMaterialMetallicRoughness")],oh);const V1e=oh;var QI;const G1e="esri.geometry.support.MeshVertexAttributes",ex=ye.getLogger(G1e);let Vu=QI=class extends Nt{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return i2(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},ex)}castPosition(t){return t&&t instanceof Float32Array&&ex.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),i2(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},ex)}castUv(t){return i2(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},ex)}castNormal(t){return i2(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},ex)}castTangent(t){return i2(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},ex)}clone(){const t={position:Le(this.position),uv:Le(this.uv),normal:Le(this.normal),tangent:Le(this.tangent),color:Le(this.color)};return new QI(t)}clonePositional(){const t={position:Le(this.position),normal:Le(this.normal),tangent:Le(this.tangent),uv:this.uv,color:this.color};return new QI(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function Jk(t,e,i,r){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(r.error(n,`Invalid array length, expected a multiple of ${s}`),new i([])):t}function i2(t,e,i,r,n){if(!t)return t;if(t instanceof e)return Jk(t,r,e,n);for(const s of i)if(t instanceof s)return Jk(new e(t),r,e,n);if(Array.isArray(t))return Jk(new e(t),r,e,n);{const s=i.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function DC(t,e,i){e[i]=mJe(t)}function mJe(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t[i];return e}d([m({json:{write:DC}})],Vu.prototype,"color",void 0),d([Sn("color")],Vu.prototype,"castColor",null),d([m({nonNullable:!0,json:{write:DC}})],Vu.prototype,"position",void 0),d([Sn("position")],Vu.prototype,"castPosition",null),d([m({json:{write:DC}})],Vu.prototype,"uv",void 0),d([Sn("uv")],Vu.prototype,"castUv",null),d([m({json:{write:DC}})],Vu.prototype,"normal",void 0),d([Sn("normal")],Vu.prototype,"castNormal",null),d([m({json:{write:DC}})],Vu.prototype,"tangent",void 0),d([Sn("tangent")],Vu.prototype,"castTangent",null),Vu=QI=d([J(G1e)],Vu);var nA;const j1e="esri.geometry.support.MeshComponent",gJe=ye.getLogger(j1e);let Wm=nA=class extends Nt{static from(t){return uT(nA,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return i2(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},gJe)}castMaterial(t){return uT(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?V1e:Oq,t)}clone(){return new nA({faces:Le(this.faces),shading:this.shading,material:Le(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const i={faces:Le(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new nA(i)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};d([m({json:{write:!0}})],Wm.prototype,"faces",void 0),d([Sn("faces")],Wm.prototype,"castFaces",null),d([m({type:Oq,json:{write:!0}})],Wm.prototype,"material",void 0),d([Sn("material")],Wm.prototype,"castMaterial",null),d([m({type:String,json:{write:!0}})],Wm.prototype,"shading",void 0),d([m({type:Boolean})],Wm.prototype,"trustSourceNormals",void 0),Wm=nA=d([J(j1e)],Wm);const _Je=Wm,W4=ye.getLogger("esri.geometry.support.meshUtils.normalProjection");function yJe(t,e,i,r,n){return Z4(r)?(q4(Tg.TO_PCPF,Ms.fromTypedArray(t),Wh.fromTypedArray(e),Wh.fromTypedArray(i),r,Ms.fromTypedArray(n)),n):(W4.error("Cannot convert spatial reference to PCPF"),n)}function sSt(t,e,i,r,n){return Z4(r)?(q4(Tg.FROM_PCPF,Ms.fromTypedArray(t),Wh.fromTypedArray(e),Wh.fromTypedArray(i),r,Ms.fromTypedArray(n)),n):(W4.error("Cannot convert to spatial reference from PCPF"),n)}function oSt(t,e,i){return _n(t,e,0,i,W5(e),0,t.length/3),i}function aSt(t,e,i){return _n(t,W5(i),0,e,i,0,t.length/3),e}function vJe(t,e,i){return my(so,i),Pb(e,t,so),FH(so)||D4(e,e),e}function bJe(t,e,i){if(my(so,i),Pb(e,t,so,4),FH(so)||D4(e,e,4),t!==e)for(let r=3;r<t.length;r+=4)e[r]=t[r];return e}function wJe(t,e,i,r,n){if(!Z4(r))return W4.error("Cannot convert spatial reference to PCPF"),n;q4(Tg.TO_PCPF,Ms.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),Wh.fromTypedArray(e),Wh.fromTypedArray(i),r,Ms.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function lSt(t,e,i,r,n){if(!Z4(r))return W4.error("Cannot convert to spatial reference from PCPF"),n;q4(Tg.FROM_PCPF,Ms.fromTypedArray(t,16),Wh.fromTypedArray(e),Wh.fromTypedArray(i),r,Ms.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function q4(t,e,i,r,n,s){if(!e)return;const o=i.count,a=W5(n);if(H1e(n))for(let l=0;l<o;l++)r.getVec(l,GM),e.getVec(l,kp),_u(a,GM,jM,a),jh(so,jM),t===Tg.FROM_PCPF&&Hh(so,so),yc(kp,kp,so),s.setVec(l,kp);else for(let l=0;l<o;l++){r.getVec(l,GM),e.getVec(l,kp),_u(a,GM,jM,a),jh(so,jM);const c=NL(i.get(l,1));let u=Math.cos(c);t===Tg.TO_PCPF&&(u=1/u),so[0]*=u,so[1]*=u,so[2]*=u,so[3]*=u,so[4]*=u,so[5]*=u,t===Tg.FROM_PCPF&&Hh(so,so),yc(kp,kp,so),Me(kp,kp),s.setVec(l,kp)}return s}function Z4(t){return H1e(t)||xJe(t)}function H1e(t){return t.isWGS84||_le(t)||tm(t)||im(t)}function xJe(t){return t.isWebMercator}var Tg;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(Tg||(Tg={}));const GM=I(),kp=I(),jM=Ne(),so=on();var sP;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(sP||(sP={}));let W1e=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=yg.KTX2_ENCODING}};function Y1(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function TJe(t){return new Promise((e,i)=>{const r=new Blob([t]),n=new FileReader;n.onload=()=>{const s=n.result;e(JSON.parse(s))},n.onerror=s=>{i(s)},n.readAsText(r)})}async function SJe(t,e){return e===yg.KTX2_ENCODING?new W1e(t):new Promise((i,r)=>{const n=new Blob([t],{type:e}),s=URL.createObjectURL(n),o=new Image,a=()=>{URL.revokeObjectURL(s),"decode"in o?o.decode().then(()=>i(o),()=>i(o)).then(c):(i(o),c())},l=u=>{URL.revokeObjectURL(s),r(u),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=s})}function Cf(t){if(t==null)return null;const e=t.offset!=null?t.offset:Iye,i=t.rotation!=null?t.rotation:0,r=t.scale!=null?t.scale:Lye,n=JI(1,0,0,0,1,0,e[0],e[1],1),s=JI(Math.cos(i),-Math.sin(i),0,Math.sin(i),Math.cos(i),0,0,0,1),o=JI(r[0],0,0,0,r[1],0,0,0,1),a=Ll();return IT(a,s,o),IT(a,n,a),a}ye.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let CJe=class extends lm{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,i){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:r}=this,n=r.geometries.slice();r.removeAllGeometries();const s=gz(Kk,r.transformation),o=i.getOrigin(s);for(const a of n){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,r.addGeometry(c)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:i}=this,r=i.geometries.map(n=>e(n.material));i.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],o=r[n];o.setParameters({modelTransformation:null}),o===s.material?i.addGeometry(s):i.addGeometry(s.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,i,r){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,o=gz(Kk,e),a=r.getOrigin(o);if(a===s)return;const l=(i==null?void 0:i.localMatrix)??Os;n.clearShaderTransformation(),n.transformation=e,n.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,i,r){const{stageObject:n}=this,s=(i==null?void 0:i.localMatrix)??Os;if(!this._fastTransformUpdatesEnabled)return n.clearShaderTransformation(),n.transformation=e,n.geometries.forEach(y=>{y.transformation=s}),void this.resetEdgeObject(r);const o=n.transformation,a=n.geometries[0].transformation,l=e,c=s,u=Cr(Lte,o,a),p=Cr(Dte,l,c);n.shaderTransformation=l,this._setFastMaterialTransformation({matA:u,matB:p});const f=()=>c;for(const y of n.geometries)y.shaderTransformer=f;this.resetEdgeObject(r)}alignWithElevation(e,i,r,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,i,r,n);r!=null&&$4(this.elevationContext.featureExpressionInfoContext,r);const s=(y,v)=>xy(y,e,this.elevationContext,i,v),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Cr(Lte,a,l),u=Qn(EJe,o.shaderTransformation);this.alignedSampledElevation=W1(this,this.elevationContext,e.spatialReference,s,i,u),o.shaderTransformation=u;const p=o.geometries[0].shaderTransformation,f=Cr(Dte,u,p);this._setFastMaterialTransformation({matA:c,matB:f}),this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:i}){const{stageObject:r}=this;if(r.geometries.length===0)return;const n=r.geometries[0].localOrigin,s=B3(AJe,pe(Kk,n.vec3,-1)),o=Cr(Nte,s,e),a=Cr(Fte,s,i),l=fo(Nte,o),c=Cr(Fte,a,l);for(const u of r.geometries)u.material.setParameters({modelTransformation:c})}};const Kk=I(),Lte=Ne(),Dte=Ne(),EJe=Ne(),Nte=Ne(),Fte=Ne(),AJe=Ne();let PJe=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,i,r){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const o=i.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,o),i.delete(n),n}const s=new Kf(n.parameters);return r.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},r.localOriginFactory)}disable(e,i,r){const n=new Set,s=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return i.has(u.uid)?(n.add(c),i.byUid(u.uid).material):(s.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),r.stage.remove(a),a.dispose(),l});for(const o of n)this._fastTransformOriginalMaterials.delete(o),r.stage.remove(o),o.dispose();for(const o of s){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),i.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,i,r){this._graphicReferenceCount--,this.disable(e,i,r)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:i})=>i)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},OJe=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,i){this._byUid.set(e,i),this._byMaterial.set(i.material,i)}delete(e){var r;const i=(r=this._byMaterial.get(e))==null?void 0:r.uid;i&&(this._byUid.delete(i),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function RJe(t){const e=new Fi,{vertex:i,fragment:r}=e;return e.include(Ml,t),e.include(ew,t),e.include(gve,t),Tc(i,t),t.stippleEnabled&&(e.attributes.add(M.UV0,"vec2"),e.attributes.add(M.AUXPOS1,"vec3"),i.uniforms.add(new yi("viewport",(n,s)=>s.camera.fullViewport))),e.attributes.add(M.POSITION,"vec3"),e.varyings.add("vpos","vec3"),i.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(i.code.add(T`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?i.uniforms.add(new je("worldToScreenRatio",(n,s)=>1/s.screenToPCSRatio)):i.code.add(T`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(T`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?i.code.add(T`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(T`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.uniforms.add(new je("stipplePatternPixelSize",n=>aq(n))),i.code.add(T`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(T`}`),t.output===j.Highlight&&e.include(Kg,t),e.include(Nn,t),r.uniforms.add(new je("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||r.uniforms.add(new yi("constantColor",n=>n.color)),r.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===j.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(Mo)}) {
      discard;
    }

    ${t.output===j.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===j.Highlight?T`outputHighlight();`:""}
  }
  `),e}const MJe=Object.freeze(Object.defineProperty({__proto__:null,build:RJe},Symbol.toStringTag,{value:"Module"}));let q1e=class Z1e extends qi{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==j.Highlight}initializeProgram(e){return new Gi(e.rctx,Z1e.shader.get().build(this.configuration),Ni)}initializePipeline(){const e=this.configuration,i=Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),r=(n,s=null,o=null)=>Zt({blending:s,depthTest:cq,depthWrite:o,colorWrite:ni,stencilWrite:e.hasOccludees?Jf:null,stencilTest:e.hasOccludees?n?Ey:Ny:null});return e.output===j.Color?(this._occludeePipelineState=r(!0,e.transparent||this._stippleEnabled?i:null,Nl),r(!1,e.transparent||this._stippleEnabled?i:null,Nl)):r(!1)}get primitiveType(){return Ht.LINES}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};q1e.shader=new Vi(MJe,()=>Oe(()=>import("./NativeLine.glsl-fa6f7f17.js"),[],import.meta.url));let Zc=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};d([q({count:j.COUNT})],Zc.prototype,"output",void 0),d([q()],Zc.prototype,"hasSlicePlane",void 0),d([q()],Zc.prototype,"hasVertexColors",void 0),d([q()],Zc.prototype,"transparent",void 0),d([q()],Zc.prototype,"draped",void 0),d([q()],Zc.prototype,"stippleEnabled",void 0),d([q()],Zc.prototype,"stippleOffColorEnabled",void 0),d([q()],Zc.prototype,"stipplePreferContinuous",void 0),d([q()],Zc.prototype,"hasOccludees",void 0),d([q({constValue:!1})],Zc.prototype,"stippleRequiresClamp",void 0),d([q({constValue:!1})],Zc.prototype,"stippleScaleWithLineWidth",void 0),d([q({constValue:!1})],Zc.prototype,"stippleRequiresStretchMeasure",void 0);var uN;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(uN||(uN={}));let kte=class extends Ly{constructor(e){super(e,new LJe),this._configuration=new Zc}getConfiguration(e,i){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=i.slot===Te.DRAPED_MATERIAL;const r=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=r,this._configuration.stippleOffColorEnabled=r&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,i,r,n,s,o){if(!r.options.selectionMode||!e.visible)return;if(!Ufe(i))return void ye.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(M.POSITION).data,l=r.camera,c=NJe;Is(c,r.point);const u=2;me(NC[0],c[0]-u,c[1]+u,0),me(NC[1],c[0]+u,c[1]+u,0),me(NC[2],c[0]+u,c[1]-u,0),me(NC[3],c[0]-u,c[1]-u,0);for(let b=0;b<4;b++)if(!l.unprojectFromRenderScreen(NC[b],Cm[b]))return;ya(l.eye,Cm[0],Cm[1],Qk),ya(l.eye,Cm[1],Cm[2],eU),ya(l.eye,Cm[2],Cm[3],tU),ya(l.eye,Cm[3],Cm[0],iU);let p=Number.MAX_VALUE,f=0;for(let b=0;b<a.length-5;b+=3){if(Ua[0]=a[b]+i[12],Ua[1]=a[b+1]+i[13],Ua[2]=a[b+2]+i[14],za[0]=a[b+3]+i[12],za[1]=a[b+4]+i[13],za[2]=a[b+5]+i[14],Dr(Qk,Ua)<0&&Dr(Qk,za)<0||Dr(eU,Ua)<0&&Dr(eU,za)<0||Dr(tU,Ua)<0&&Dr(tU,za)<0||Dr(iU,Ua)<0&&Dr(iU,za)<0)continue;if(l.projectToRenderScreen(Ua,pv),l.projectToRenderScreen(za,fv),pv[2]<0&&fv[2]>0){Ce(Up,Ua,za);const S=l.frustum,P=-Dr(S[Lr.NEAR],Ua)/Re(Up,S[Lr.NEAR]);pe(Up,Up,P),xe(Ua,Ua,Up),l.projectToRenderScreen(Ua,pv)}else if(pv[2]>0&&fv[2]<0){Ce(Up,za,Ua);const S=l.frustum,P=-Dr(S[Lr.NEAR],za)/Re(Up,S[Lr.NEAR]);pe(Up,Up,P),xe(za,za,Up),l.projectToRenderScreen(za,fv)}else if(pv[2]<0&&fv[2]<0)continue;pv[2]=0,fv[2]=0;const x=Yj(G1(pv,fv,Bte),c);x<p&&(p=x,fe(Ute,Ua),fe(zte,za),f=b/3)}const y=r.rayBegin,v=r.rayEnd;if(p<u*u){let b=Number.MAX_VALUE;if(Zde(G1(Ute,zte,Bte),G1(y,v,DJe),dv)){Ce(dv,dv,y);const x=ze(dv);pe(dv,dv,1/x),b=x/Nr(y,v)}o(b,dv,f,!1)}}intersectDraped(e,i,r,n,s,o){if(!r.options.selectionMode)return;const a=e.vertexAttributes.get(M.POSITION).data,l=e.vertexAttributes.get(M.SIZE),c=l?l.data[0]:0,u=n[0],p=n[1],f=((c+1)/2+4)*e.screenToWorldRatio;let y=Number.MAX_VALUE,v=0;for(let b=0;b<a.length-5;b+=3){const x=a[b],S=a[b+1],P=u-x,C=p-S,R=a[b+3]-x,N=a[b+4]-S,$=$e((R*P+N*C)/(R*R+N*N),0,1),k=R*$-P,B=N*$-C,W=k*k+B*B;W<y&&(y=W,v=b/3)}y<f*f&&s(o.dist,o.normal,v,!1)}requiresSlot(e,i){return!(i!==j.Color&&i!==j.Highlight&&i!==j.ObjectAndLayerIdColor||e!==Te.OPAQUE_MATERIAL&&e!==Te.DRAPED_MATERIAL)}createGLMaterial(e){return new $Je(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?Uqe:Fqe;return this.parameters.stipplePattern==null?new AS(e):new IJe(e.clone().vec3f(M.AUXPOS1).vec2f(M.UV0))}},$Je=class extends $y{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===j.Color&&this._updateOccludeeState(e);const i=this._material.parameters.stipplePattern;return this._stipplePattern!==i&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(i,this._stipplePattern)}),this._stipplePattern=i),this.ensureTechnique(q1e,e)}},IJe=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(M.POSITION).length}write(e,i,r,n,s){a_e(r,this.vertexBufferLayout,e,i,n,s),this._writeAuxpos1(e,r,n,s),this._writeUV0(e,r,n,s)}_writeAuxpos1(e,i,r,n){const s=r.getField(M.AUXPOS1,Ms),o=i.indices.get(M.POSITION),a=i.vertexAttributes.get(M.POSITION).data,l=e,c=s.typedBufferStride,u=s.typedBuffer;n*=c;for(let p=0;p<o.length-1;p+=2)for(const f of[1,0]){const y=3*o[p+f],v=a[y],b=a[y+1],x=a[y+2],S=l[0]*v+l[4]*b+l[8]*x+l[12],P=l[1]*v+l[5]*b+l[9]*x+l[13],C=l[2]*v+l[6]*b+l[10]*x+l[14];u[n]=S,u[n+1]=P,u[n+2]=C,n+=c}}_writeUV0(e,i,r,n){var C;const s=r.getField(M.UV0,Iy),o=i.indices.get(M.POSITION),a=i.vertexAttributes.get(M.POSITION).data,l=(C=i.vertexAttributes.get(M.DISTANCETOSTART))==null?void 0:C.data,c=s.typedBufferStride,u=s.typedBuffer;let p=0;u[n*=c]=uN.START,u[n+1]=p,n+=c;const f=3*o[0],y=me(Ua,a[f],a[f+1],a[f+2]);e&&st(y,y,e);const v=za,b=o.length-1;let x=1;const S=l?(R,N,$)=>p=l[$]:(R,N,$)=>p+=Nr(R,N);for(let R=1;R<b;R+=2){const N=3*o[R];me(v,a[N],a[N+1],a[N+2]),e&&st(v,v,e),S(y,v,x++);for(let $=0;$<2;++$)u[n]=1-$,u[n+1]=p,n+=c;fe(y,v)}const P=3*o[b];me(v,a[P],a[P+1],a[P+2]),e&&st(v,v,e),S(y,v,x),u[n]=uN.END,u[n+1]=p}},LJe=class extends IW{constructor(){super(...arguments),this.color=Sh,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const Ua=I(),za=I(),Up=I(),dv=I(),pv=ta(),fv=ta(),Ute=I(),zte=I(),Bte=yp(),DJe=yp(),NJe=I(),NC=[ta(),ta(),ta(),ta()],Cm=[I(),I(),I(),I()],Qk=Yi(),eU=Yi(),tU=Yi(),iU=Yi(),FJe=["mesh"];let kJe=class extends cm{constructor(e,i,r,n){super(e,i,r,n),this._materialInfoCache=new OJe,this._fastUpdateProcessor=new PJe,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Or.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new kte({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new kte({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,FJe,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new wp),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,i){const r=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:r});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{const s=i(n);s!=null&&s.layerOpacityChanged(r,this._context.isAsync)})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ty)}slicePlaneEnabledChanged(e,i){return this._updateMaterialParameters(({material:r})=>{r.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(r=>{const n=i(r);n!=null&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:i})=>i.setParameters({usePBR:e})),!0}updateTransform(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,o=UJe,{origin:a,transform:l}=r;switch(_u(i,me(bo,a.x,a.y,a.z??0),o,s),n){case sP.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case sP.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case sP.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:p}=this._context,f=(y,v)=>xy(y,u,c,p,v);return e.alignedSampledElevation=W1(e,c,u.spatialReference,f,p,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof Lt?e.toHex():e.contentHash}_materialPropertiesDefault(e,i){const r=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${i},svc:${r}`}}_textureTransformUid(e){const{offset:i,scale:r,rotation:n}=e??BJe;return`${i[0]},${i[1]},${n},${r[0]},${r[1]}`}_materialProperties(e,i,r){const n=this._materialPropertiesDefault(e,r);if(!i.material)return n;const{color:s,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:p,alphaMode:f}=i.material,y=this._colorOrTextureUid(s),v=this._colorOrTextureUid(o),b=this._textureTransformUid(a),x=this._colorOrTextureUid(l),S=this._textureTransformUid(c);if(n.color=s,n.colorTexture=o,n.normalTexture=l,n.uid=`${n.uid},cmuid:${y},ctmuid:${v},cttuid:${b},ntmuid:${x},nttuid:${S},ds:${u},ac:${p},am:${f}`,i.material instanceof V1e){const{metallic:P,roughness:C,metallicRoughnessTexture:R,metallicRoughnessTextureTransform:N,emissiveColor:$,emissiveTexture:k,emissiveTextureTransform:B,occlusionTexture:W,occlusionTextureTransform:Z}=i.material,K=this._colorOrTextureUid(R),X=this._textureTransformUid(N),ae=this._colorOrTextureUid($),re=this._colorOrTextureUid(k),ee=this._textureTransformUid(B),oe=this._colorOrTextureUid(W),U=this._textureTransformUid(Z);n.metallic=P,n.roughness=C,n.metallicRoughnessTexture=R,n.emissiveColor=$,n.emissiveTexture=k,n.occlusionTexture=W,n.colorTextureTransform=this._convertTextureTransform(a),n.normalTextureTransform=this._convertTextureTransform(c),n.emissiveTextureTransform=this._convertTextureTransform(B),n.occlusionTextureTransform=this._convertTextureTransform(Z),n.metallicRoughnessTextureTransform=this._convertTextureTransform(N),n.uid=`${n.uid},mrm:${P},mrr:${C},mrt:${K},mrtt:${X},emuid:${ae},etmuid:${re},ett:${ee},otmuid:${oe},ott:${U}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:i,offset:r,rotation:n}=e;return{scale:i,offset:r,rotation:Qt(n)}}_setInternalColorValueParameters(e,i){i.diffuse=Lt.toUnitRGB(e),i.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const i=this._getInternalTexture(e,_r.Opaque);return i!=null?i.id:null}_getInternalTexture(e,i){const r=this._getLoadableTextureResource(e);if(!r)return null;const n=`${e.contentHash}/${i}`;let s=this._textures.get(n);return s||(s=new Kb(Y1(r)?r.data:r,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!Y1(r)&&i!==_r.Opaque,encoding:Y1(r)&&r.encoding!=null?r.encoding:void 0}),this._textures.set(n,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const i=this._castTextureWrapIndividual(e);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return Jt.CLAMP_TO_EDGE;case"mirror":return Jt.MIRRORED_REPEAT;default:return Jt.REPEAT}}_setInternalMaterialParameters(e,i){if(e.color!=null&&this._setInternalColorValueParameters(e.color,i),e.colorTexture!=null){const r=this._getInternalTexture(e.colorTexture,i.textureAlphaMode);r!=null?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.parameters.preMultiplyAlpha):i.textureId=void 0}e.normalTexture!=null&&(i.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(i.emissiveFactor=Lt.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(i.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(i.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(i.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),i.colorTextureTransformMatrix=Cf(e.colorTextureTransform),i.normalTextureTransformMatrix=Cf(e.normalTextureTransform),i.occlusionTextureTransformMatrix=Cf(e.occlusionTextureTransform),i.emissiveTextureTransformMatrix=Cf(e.emissiveTextureTransform),i.metallicRoughnessTextureTransformMatrix=Cf(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const i=this._drivenProperties.color;let r=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(i)e.externalColor=Sh;else{const n=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;n!=null?e.externalColor=Lt.toUnitRGBA(n):(r=null,e.externalColor=Sh)}r&&(e.colorMixMode=r),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const i=e.vertexAttributes.color;if(i==null)return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(e,i){var v,b,x;const r=(v=i.material)==null?void 0:v.color,n=(b=i.material)==null?void 0:b.colorTexture,s=(x=i.material)==null?void 0:x.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||r!=null&&r.a<1||n!=null&&n.transparent||o),l=this._materialProperties(e,i,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=e1e({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:Lt.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:tl,diffuse:ug,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Fr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=p?[...Sq]:[l.metallic,l.roughness,V4[2]],i.material&&(f.doubleSided=i.material.doubleSided,f.cullFace=i.material.doubleSided?Fr.None:Fr.Back,f.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,u),this._setInternalMaterialParameters(l,f);const y=new Kf(f);return u.material=y,this._materialInfoCache.set(l.uid,u),this._context.stage.add(y),y}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,i){e.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,i.alphaMode==="auto"?e.textureAlphaMode=e.transparent?_r.MaskBlend:_r.Opaque:e.textureAlphaMode=i.alphaMode==="opaque"?_r.Opaque:i.alphaMode==="mask"?_r.Mask:_r.Blend}_addDebugNormals(e,i){const r=i.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let y=0;y<r;y++){const v=i[y],b=v.vertexAttributes.get(M.POSITION),x=v.vertexAttributes.get(M.NORMAL),S=v.indices.get(M.POSITION),P=v.indices.get(M.NORMAL),C=b.data,R=x.data;for(let N=0;N<S.length;N++){const $=3*S[N],k=3*P[N];for(let B=0;B<3;B++)o.push(C[$+B]);for(let B=0;B<3;B++)o.push(C[$+B]+R[k+B]*s);if(a.push(a.length),a.push(a.length),N%3==0){this._calculateFaceNormal(C,S,N,rx),this._getFaceVertices(C,S,N,bo,tx,ix),xe(bo,bo,tx),xe(bo,bo,ix),pe(bo,bo,1/3);for(let B=0;B<3;B++)l.push(bo[B]);for(let B=0;B<3;B++)l.push(bo[B]+rx[B]*s);c.push(c.length),c.push(c.length)}}}const u=i[0].transformation,p=new fs(this._debugVertexNormalMaterial,[[M.POSITION,new nt(o,3,!0)]],[[M.POSITION,a]],null,An.Line);i.push(p),p.transformation=u;const f=new fs(this._debugFaceNormalMaterial,[[M.POSITION,new nt(l,3,!0)]],[[M.POSITION,c]],null,An.Line);f.transformation=u,i.push(f)}_createAs3DShape(e,i,r,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,i,n);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;Or.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new e0({geometries:a,layerUid:this._context.layer.uid,graphicUid:n});c.transformation=l;const u=Sye(this.symbolLayer,{opacity:this._getLayerOpacity()}),p=u!=null?new uHe(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new CJe(this,c,a,null,null,W1,r,p);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=Ty(r.mode),f.useObjectOriginAsAttachmentOrigin=!0,r.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:y,renderCoordsHelper:v}=this._context,b=(x,S)=>xy(x,y,r,v,S);return f.alignedSampledElevation=W1(f,r,y.spatialReference,b,v),f}_getCenterPointInElevationSR(e){const i=Qb(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return zj([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(e,i,r,n){switch(r.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,i,r,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,i,r,n){if(i==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!r.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,rx);for(let a=0;a<3;a++){const l=3*n[o+a];bo[0]=i[l],bo[1]=i[l+1],bo[2]=i[l+2],Re(rx,bo)<0&&(i[l]=-i[l],i[l+1]=-i[l+1],i[l+2]=-i[l+2],s=!0)}}return new rU(i,n,s)}_createComponentNormalsFlat(e,i){const r=mn(i.length),n=new Array(3*i.length);for(let s=0;s<i.length;s+=3){const o=this._calculateFaceNormal(e,i,s,rx);for(let a=0;a<3;a++)r[s+a]=o[a],n[s+a]=s/3}return new rU(r,n,!1)}_createComponentNormalsSmooth(e,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(e,i,o,rx);for(let l=0;l<3;l++){const c=i[o+l];let u=r[c];u||(u={normal:I(),count:0},r[c]=u),xe(u.normal,u.normal,a),u.count++}}const n=mn(3*i.length),s=new Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(Me(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new rU(n,s,!1)}_getFaceVertices(e,i,r,n,s,o){const a=3*i[r],l=3*i[r+1],c=3*i[r+2];n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,i,r,n){return this._getFaceVertices(e,i,r,bo,tx,ix),Ce(tx,tx,bo),Ce(ix,ix,bo),Rt(bo,tx,ix),Me(n,bo),n}_getOrCreateComponents(e){return e.components??zJe}_createPositionBuffer(e,i){let r=e.vertexAttributes.position;const n=i.reprojection===nc.ECEF?i.transformBeforeProject:null;if(n!=null&&(r=qT(new Float64Array(r.length),r,n)),i.reprojection===nc.NONE)return i.needsBufferCopy?new Float64Array(r):r;const s=n!=null?r:new Float64Array(r.length);return _n(r,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,r.length/3),s}_createNormalBuffer(e,i,r){let n=e.vertexAttributes.normal;if(n==null)return null;const s=r.reprojection===nc.ECEF?r.transformBeforeProject:null;if(s!=null&&(n=vJe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===nc.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s!=null?n:new Float32Array(n.length);return yJe(n,o,i,e.spatialReference,a)}_createTangentBuffer(e,i,r){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=r.reprojection===nc.ECEF?r.transformBeforeProject:null;if(s!=null&&(n=bJe(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===nc.NONE)return r.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s!=null?n:new Float32Array(n.length);return wJe(n,o,i,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var i,r;if(this._requiresSymbolVertexColors()){const n=this._getVertexOpacityAndColor(e),s=NZe((r=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:r.colorMixMode),o=new Uint8Array(4);return r1e(n,s,o),o}return null}_createBuffers(e,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n!=null&&n.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s!=null&&s.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:f,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===nc.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,p,f),geometryTransformation:a.reprojection===nc.NONE&&a.geometryTransformation!=null?a.geometryTransformation:Ne()}}_computeReprojectionInfo(e){var s;const{vertexSpace:i}=e,r=i.isRelative,n=i.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===Ke.Local?nc.NONE:nc.ECEF:nc.NONE;if(r){const{origin:o}=i,a=Ne(),l=((s=e.transform)==null?void 0:s.localMatrix)??Os;if(n===nc.NONE)return _u(e.spatialReference,o,a,this._context.renderCoordsHelper.spatialReference),{reprojection:n,objectTransformation:a,geometryTransformation:TT(l),needsBufferCopy:!1};const c=B3(Ne(),o);return Cr(c,c,l),{reprojection:n,transformBeforeProject:c,needsBufferCopy:!0}}return{reprojection:n,needsBufferCopy:!0}}_transformOriginLocal(e,i,r,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;HM[0]=o.x,HM[1]=o.y,HM[2]=o.z??0;const a=Ne();return _u(e.spatialReference,HM,a,s),fo(Vte,a),qT(i,i,Vte),r==null&&n==null||(jh(FC,a),Hh(FC,FC),r!=null&&Pb(r,r,FC),n!=null&&Pb(n,n,FC,4)),a}_validateFaces(e,i){const r=e.vertexAttributes.position.length/3,n=i.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(r<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,i){return i.faces??DT(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let n;const s=i.length/3;return r==null||e.spatialReference.equals(r)?n=i:(n=new Float64Array(i.length),_n(e.vertexAttributes.position,e.spatialReference,0,n,r,0,s)),Gr(nU),du(nU,n,0,s),!Xd(nU,this._context.clippingExtent)}_createGeometryInfo(e,i,r){if(!hy(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,i);if(n==null)return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:p,geometryTransformation:f}=n,y=this._getOrCreateComponents(e),v=new Array;let b=!1;for(const x of y){if(!this._validateFaces(e,x))return null;const S=this._getOrCreateFaces(e,x);if(S.length===0)continue;const P=this._createComponentNormals(s,c,x,S);P.didFlipNormals&&(b=!0);const C=[[M.POSITION,new nt(s,3,!0)],[M.NORMAL,new nt(P.normals,3,!0)]],R=[[M.POSITION,S],[M.NORMAL,P.indices]];a!=null&&(C.push([M.COLOR,new nt(a,4,!0)]),R.push([M.COLOR,S])),l!=null&&(C.push([M.SYMBOLCOLOR,new nt(l,4,!0)]),R.push([M.SYMBOLCOLOR,bS(S.length)])),o!=null&&(C.push([M.UV0,new nt(o,2,!0)]),R.push([M.UV0,S])),u!=null&&(C.push([M.TANGENT,new nt(u,4,!0)]),R.push([M.TANGENT,S]));const N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerUid:this._context.layer.uid}),$=this._getOrCreateMaterial(e,x),k=new fs($,C,R,null,An.Mesh,N);k.transformation=f,v.push(k)}return b&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:v,objectTransformation:p}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((i,r)=>{r.setParameters(i.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}};class rU{constructor(e,i,r){this.normals=e,this.indices=i,this.didFlipNormals=r}}const HM=I(),bo=I(),tx=I(),ix=I(),rx=I(),Vte=Ne(),FC=on(),UJe=Ne(),nU=$s(),zJe=[new _Je],BJe=new Q2;var nc;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(nc||(nc={}));let VJe=class{constructor(e,i,r,n){this.graphics3DSymbolLayer=e,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const i=this._lodRenderer.instanceData;e!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,i,r){if(this.elevationAligner){$4(this.elevationContext.featureExpressionInfoContext,r);const n=(o,a)=>xy(o,e,this.elevationContext,i,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,i);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=I()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,zp),st(e,this._lodRenderer.baseBoundingSphere.center,zp)}getBoundingBoxObjectSpace(e=$s()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,zp);const i=this._lodRenderer.baseBoundingBox;Gr(e);for(let r=0;r<8;++r)me(Gu,1&r?i[3]:i[0],2&r?i[4]:i[1],4&r?i[5]:i[2]),st(Gu,Gu,zp),Hf(e,Gu);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,zp),e.render.origin[0]+=zp[12],e.render.origin[1]+=zp[13],e.render.origin[2]+=zp[14],e.render.num++}async getProjectedBoundingBox(e,i,r,n,s){const o=this.getBoundingBoxObjectSpace(s),a=GJe,l=hj(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,zp);for(let u=0;u<l;u++){const p=a[u];Gu[0]=o[p[0]],Gu[1]=o[p[1]],Gu[2]=o[p[2]],st(Gu,Gu,zp),mv[3*u]=Gu[0],mv[3*u+1]=Gu[1],mv[3*u+2]=Gu[2]}if(!e(mv,0,l))return null;Gr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],mv[u+p]),o[p+3]=Math.max(o[p+3],mv[u+p]);c&&r.push({location:mv.slice(u,u+3),screenSpaceBoundingRect:c})}if(i&&(Zd(o,sU),this.elevationContext.mode!=="absolute-height")){let u;const p=WW(o,i.service.spatialReference,i);try{u=await i.service.queryElevation(sU[0],sU[1],n,p,"ground")}catch{}u!=null&&Bue(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,i){if(e===Ng.Highlight){const r=new MD(e);this._addHighlightId(r),i.addExternal(n=>{this._removeHighlightId(n)},r)}}removeObjectState(e){this._highlights.forEach(i=>e.remove(i))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const mv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Gu=I(),sU=I(),GJe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],zp=Ne();function jJe(t){const e=new Array;return t.stageResources.geometries.forEach(i=>{const r=t.stageResources.textures;e.push(new wye(i,r))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function HJe(t){return{levels:t.map(e=>jJe(e))}}function WJe(t){return t=t||globalThis.location.hostname,qJe.some(e=>(t==null?void 0:t.match(e))!=null)}function sV(t,e){return t&&(e=e||globalThis.location.hostname)?e.match(X1e)!=null||e.match(J1e)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(Y1e)!=null||e.match(K1e)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const X1e=/^devext.arcgis.com$/,Y1e=/^qaext.arcgis.com$/,J1e=/^[\w-]*\.mapsdevext.arcgis.com$/,K1e=/^[\w-]*\.mapsqa.arcgis.com$/,qJe=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,X1e,Y1e,/^jsapps.esri.com$/,J1e,K1e];function ZJe(t,e,i){if(t.count!==e.count)return void L4.error("source and destination buffers need to have the same number of elements");const r=t.count,n=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],p=i[7],f=i[8],y=i[9],v=i[10],b=i[11],x=i[12],S=i[13],P=i[14],C=i[15],R=t.typedBuffer,N=t.typedBufferStride,$=e.typedBuffer,k=e.typedBufferStride;for(let B=0;B<r;B++){const W=B*N,Z=B*k,K=$[Z],X=$[Z+1],ae=$[Z+2],re=$[Z+3];R[W]=n*K+l*X+f*ae+x*re,R[W+1]=s*K+c*X+y*ae+S*re,R[W+2]=o*K+u*X+v*ae+P*re,R[W+3]=a*K+p*X+b*ae+C*re}}function XJe(t,e,i){Rq(t.typedBuffer,e.typedBuffer,i,t.typedBufferStride,e.typedBufferStride)}function Rq(t,e,i,r=4,n=r){if(t.length/r!=e.length/n)return void L4.error("source and destination buffers need to have the same number of elements");const s=t.length/r,o=i[0],a=i[1],l=i[2],c=i[3],u=i[4],p=i[5],f=i[6],y=i[7],v=i[8];let b=0,x=0;for(let S=0;S<s;S++){const P=e[b],C=e[b+1],R=e[b+2],N=e[b+3];t[x]=o*P+c*C+f*R,t[x+1]=a*P+u*C+y*R,t[x+2]=l*P+p*C+v*R,t[x+3]=N,b+=n,x+=r}}function YJe(t,e){const i=Math.min(t.count,e.count),r=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<i;a++){const l=a*n,c=a*o,u=s[c],p=s[c+1],f=s[c+2],y=u*u+p*p+f*f;if(y>0){const v=1/Math.sqrt(y);r[l]=v*u,r[l+1]=v*p,r[l+2]=v*f}}}function JJe(t,e,i){hN(t.typedBuffer,e,i,t.typedBufferStride)}function hN(t,e,i,r=4){const n=Math.min(t.length/r,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=i*s[a],t[l+1]=i*s[a+1],t[l+2]=i*s[a+2],t[l+3]=i*s[a+3],a+=o,l+=r}Object.freeze(Object.defineProperty({__proto__:null,normalize:YJe,scale:hN,scaleView:JJe,transformMat3:Rq,transformMat3View:XJe,transformMat4:ZJe},Symbol.toStringTag,{value:"Module"}));function KJe(t,e){Mq(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function Mq(t,e,i=2,r=i){const n=e.length/2;let s=0,o=0;if(cp(e)||iSe(e)){for(let l=0;l<n;++l)t[s]=e[o],t[s+1]=e[o+1],s+=i,o+=r;return}const a=rSe(e);if(tSe(e))for(let l=0;l<n;++l)t[s]=Math.max(e[o]/a,-1),t[s+1]=Math.max(e[o+1]/a,-1),s+=i,o+=r;else for(let l=0;l<n;++l)t[s]=e[o]/a,t[s+1]=e[o+1]/a,s+=i,o+=r}function QJe(t,e,i,r){const n=t.typedBuffer,s=t.typedBufferStride,o=(r==null?void 0:r.count)??t.count;let a=((r==null?void 0:r.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=i,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:QJe,normalizeIntegerBuffer:Mq,normalizeIntegerBufferView:KJe},Symbol.toStringTag,{value:"Module"}));function eKe(t,e){fO(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function fO(t,e,i=3,r=i){const n=e.length/r;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=i,o+=r}function tKe(t,e,i,r,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=i,s[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:fO,copyView:eKe,fill:tKe},Symbol.toStringTag,{value:"Module"}));function iKe(t,e){$q(t.typedBuffer,e,t.typedBufferStride)}function $q(t,e,i=4){const r=e.typedBuffer,n=e.typedBufferStride,s=e.count;let o=0,a=0;for(let l=0;l<s;++l)t[o]=r[a],t[o+1]=r[a+1],t[o+2]=r[a+2],t[o+3]=r[a+3],o+=i,a+=n}function rKe(t,e,i,r,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=i,o[c+2]=r,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:$q,copyView:iKe,fill:rKe},Symbol.toStringTag,{value:"Module"}));let Q1e=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,i){return this._load("json",e,i)}async loadBinary(e,i){return nm(e)?(Ti(i),vj(e)):this._load("binary",e,i)}async loadImage(e,i){return this._load("image",e,i)}async _load(e,i,r){if(this._streamDataRequester==null)return(await ps(i,{responseType:nKe[e]})).data;const n=await Lg(this._streamDataRequester.request(i,e,r));if(n.ok===!0)return n.value;throw kb(n.error),new ce("",`Request for resource failed: ${n.error}`)}};const nKe={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function sKe(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function oKe(t,e={}){return{data:t,parameters:{wrap:{s:Jt.REPEAT,t:Jt.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}let YT=class{constructor(e,i,r=""){this.major=e,this.minor=i,this._context=r}lessThan(e,i){return this.major<e||e===this.major&&this.minor<i}since(e,i){return!this.lessThan(e,i)}validate(e){if(this.major!==e.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new ce(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new YT(this.major,this.minor,this._context)}static parse(e,i=""){const[r,n]=e.split("."),s=/^\s*\d+\s*$/;if(!r||!r.match||!s.test(r))throw new ce((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n||!n.match||!s.test(n))throw new ce((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(r,10),a=parseInt(n,10);return new YT(o,a,i)}};function eL(t,e){const i=t.count;e||(e=new t.TypedArrayConstructor(i));for(let r=0;r<i;r++)e[r]=t.get(r);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:eL},Symbol.toStringTag,{value:"Module"}));let Gte=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const i=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,i,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var oP,jte;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})(oP||(oP={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(jte||(jte={}));const ebe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},aKe={pbrMetallicRoughness:ebe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},lKe={ESRI_externalColorMixMode:"tint"},Hte=(t={})=>{const e={...ebe,...t.pbrMetallicRoughness},i=cKe({...lKe,...t.extras});return{...aKe,...t,pbrMetallicRoughness:e,extras:i}};function cKe(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const uKe={magFilter:qt.LINEAR,minFilter:qt.LINEAR_MIPMAP_LINEAR,wrapS:Jt.REPEAT,wrapT:Jt.REPEAT},hKe=t=>({...uKe,...t});function dKe(t){let e,i;return t.replace(/^(.*\/)?([^/]*)$/,(r,n,s)=>(e=n||"",i=s||"","")),{dirPart:e,filePart:i}}const WM={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let pKe=class u_{constructor(e,i,r,n){if(this._context=e,this.uri=i,this.json=r,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=dKe(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),r.scenes==null)throw new ce("gltf-loader-unsupported-feature","Scenes must be defined.");if(r.meshes==null)throw new ce("gltf-loader-unsupported-feature","Meshes must be defined");if(r.nodes==null)throw new ce("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,i,r){if(nm(i)){const o=hb(i);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new u_(e,i,l)}catch{}const a=vj(i);if(u_._isGLBData(a))return this._fromGLBData(e,i,a)}if(i.endsWith(".gltf")){const o=await e.loadJSON(i,r);return new u_(e,i,o)}const n=await e.loadBinary(i,r);if(u_._isGLBData(n))return this._fromGLBData(e,i,n);const s=await e.loadJSON(i,r);return new u_(e,i,s)}static _isGLBData(e){if(e==null)return!1;const i=new Gte(e);return i.remainingBytes()>=4&&i.readUint32()===WM.MAGIC}static async _fromGLBData(e,i,r){const n=await u_._parseGLBData(r);return new u_(e,i,n.json,n.binaryData)}static async _parseGLBData(e){const i=new Gte(e);if(i.remainingBytes()<12)throw new ce("gltf-loader-error","GLB binary data is insufficiently large.");const r=i.readUint32(),n=i.readUint32(),s=i.readUint32();if(r!==WM.MAGIC)throw new ce("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<s)throw new ce("gltf-loader-error","GLB binary data is smaller than header specifies.");if(n!==2)throw new ce("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;i.remainingBytes()>=8;){const c=i.readUint32(),u=i.readUint32();if(l===0){if(u!==WM.CHUNK_TYPE_JSON)throw new ce("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new ce("gltf-loader-error","No JSON data found.");o=await TJe(i.readUint8Array(c))}else if(l===1){if(u!==WM.CHUNK_TYPE_BIN)throw new ce("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=i.readUint8Array(c)}else ye.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new ce("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,i){const r=this.json.buffers[e];if(r.uri==null){if(this._glbBuffer==null)throw new ce("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,i);if(n.byteLength!==r.byteLength)throw new ce("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,i){const r=this._bufferLoaders.get(e);if(r)return r;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),i).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,i){if(!this.json.accessors)throw new ce("gltf-loader-unsupported-feature","Accessors missing.");const r=this.json.accessors[e];if((r==null?void 0:r.bufferView)==null)throw new ce("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(r.type in[oP.MAT2,oP.MAT3,oP.MAT4])throw new ce("gltf-loader-unsupported-feature",`AttributeType ${r.type} is not supported`);const n=this.json.bufferViews[r.bufferView],s=await this.getBuffer(n.buffer,i),o=gKe[r.type],a=_Ke[r.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(r.byteOffset||0),entryCount:r.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:r.componentType,min:r.min,max:r.max,normalized:!!r.normalized}}async getIndexData(e,i){if(e.indices==null)return;const r=await this.getAccessor(e.indices,i);if(r.isDenselyPacked)switch(r.componentType){case bt.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case bt.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case bt.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case bt.UNSIGNED_BYTE:return eL(this._wrapAccessor(LT,r));case bt.UNSIGNED_SHORT:return eL(this._wrapAccessor(l4,r));case bt.UNSIGNED_INT:return eL(this._wrapAccessor(u4,r))}}async getPositionData(e,i){if(e.attributes.POSITION==null)throw new ce("gltf-loader-unsupported-feature","No POSITION vertex data found.");const r=await this.getAccessor(e.attributes.POSITION,i);if(r.componentType!==bt.FLOAT)throw new ce("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+bt[r.componentType]);if(r.componentCount!==3)throw new ce("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Ms,r)}async getNormalData(e,i){if(e.attributes.NORMAL==null)throw new ce("gltf-loader-error","No NORMAL vertex data found.");const r=await this.getAccessor(e.attributes.NORMAL,i);if(r.componentType!==bt.FLOAT)throw new ce("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+bt[r.componentType]);if(r.componentCount!==3)throw new ce("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+r.componentCount.toFixed());return this._wrapAccessor(Ms,r)}async getTangentData(e,i){if(e.attributes.TANGENT==null)throw new ce("gltf-loader-error","No TANGENT vertex data found.");const r=await this.getAccessor(e.attributes.TANGENT,i);if(r.componentType!==bt.FLOAT)throw new ce("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+bt[r.componentType]);if(r.componentCount!==4)throw new ce("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+r.componentCount.toFixed());return new mp(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*r.entryCount)}async getTextureCoordinates(e,i){if(e.attributes.TEXCOORD_0==null)throw new ce("gltf-loader-error","No TEXCOORD_0 vertex data found.");const r=await this.getAccessor(e.attributes.TEXCOORD_0,i);if(r.componentCount!==2)throw new ce("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+r.componentCount.toFixed());if(r.componentType===bt.FLOAT)return this._wrapAccessor(Iy,r);if(!r.normalized)throw new ce("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return yKe(r)}async getVertexColors(e,i){if(e.attributes.COLOR_0==null)throw new ce("gltf-loader-error","No COLOR_0 vertex data found.");const r=await this.getAccessor(e.attributes.COLOR_0,i);if(r.componentCount!==4&&r.componentCount!==3)throw new ce("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+r.componentCount.toFixed());if(r.componentCount===4){if(r.componentType===bt.FLOAT)return this._wrapAccessor(mp,r);if(r.componentType===bt.UNSIGNED_BYTE)return this._wrapAccessor(Aa,r);if(r.componentType===bt.UNSIGNED_SHORT)return this._wrapAccessor(Z3,r)}else if(r.componentCount===3){if(r.componentType===bt.FLOAT)return this._wrapAccessor(Ms,r);if(r.componentType===bt.UNSIGNED_BYTE)return this._wrapAccessor(a4,r);if(r.componentType===bt.UNSIGNED_SHORT)return this._wrapAccessor(c4,r)}throw new ce("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+bt[r.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,i,r){var s,o,a,l,c,u,p,f,y,v;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const b=e.material!=null?Hte(this.json.materials[e.material]):Hte(),x=b.pbrMetallicRoughness,S=this.hasVertexColors(e),P=this.getTexture(x.baseColorTexture,i),C=this.getTexture(b.normalTexture,i),R=r?this.getTexture(b.occlusionTexture,i):void 0,N=r?this.getTexture(b.emissiveTexture,i):void 0,$=r?this.getTexture(x.metallicRoughnessTexture,i):void 0,k=e.material!=null?e.material:-1;n={alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,color:x.baseColorFactor,doubleSided:!!b.doubleSided,colorTexture:await P,normalTexture:await C,name:b.name,id:k,occlusionTexture:await R,emissiveTexture:await N,emissiveFactor:b.emissiveFactor,metallicFactor:x.metallicFactor,roughnessFactor:x.roughnessFactor,metallicRoughnessTexture:await $,hasVertexColors:S,ESRI_externalColorMixMode:b.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=x==null?void 0:x.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=b.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=b.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(f=(p=b.emissiveTexture)==null?void 0:p.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(v=(y=x==null?void 0:x.metallicRoughnessTexture)==null?void 0:y.extensions)==null?void 0:v.KHR_texture_transform}}return n}async getTexture(e,i){if(!e)return;if((e.texCoord||0)!==0)throw new ce("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const r=e.index,n=this.json.textures[r],s=hKe(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(r,n,i);return Oae(this._textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,u=p=>{throw new ce("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${p}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:u(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:u(s.wrapT),minFilter:s.minFilter,name:a.name,id:r}})}getNodeTransform(e){if(e===void 0)return fKe;let i=this._nodeTransformCache.get(e);if(!i){const r=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?i=Cr(Ne(),r,n.matrix):n.translation||n.rotation||n.scale?(i=TT(r),n.translation&&Dl(i,i,n.translation),n.rotation&&(qM[3]=JH(qM,n.rotation),vc(i,i,qM[3],qM)),n.scale&&M5(i,i,n.scale)):i=TT(r),this._nodeTransformCache.set(e,i)}return i}_wrapAccessor(e,i){return new e(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(e){return cu(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=YT.parse(this.json.asset.version,"glTF");mKe.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(i=>this._supportedExtensions.includes(i)))throw new ce("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,i)=>{e.children&&e.children.forEach(r=>{this._nodeParentMap.set(r,i)})})}async _loadTextureImageData(e,i,r){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(i,r);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new ce("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,i){const r=this._getTextureSourceId(e),n=this.json.images[r];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),i);return new W1e(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),i)}if(n.bufferView==null)throw new ce("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new ce("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,i);if(s.byteStride!=null)throw new ce("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return SJe(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await g8(Array.from(this._bufferLoaders.values())),i=await g8(Array.from(this._textureLoaders.values()));return e.reduce((r,n)=>r+((n==null?void 0:n.byteLength)??0),0)+i.reduce((r,n)=>r+(n?Y1(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const fKe=qhe(Ne(),Math.PI/2),mKe=new YT(2,0,"glTF"),qM=Xh(),gKe={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_Ke={[bt.BYTE]:1,[bt.UNSIGNED_BYTE]:1,[bt.SHORT]:2,[bt.UNSIGNED_SHORT]:2,[bt.FLOAT]:4,[bt.INT]:4,[bt.UNSIGNED_INT]:4};function yKe(t){switch(t.componentType){case bt.BYTE:return new h4(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case bt.UNSIGNED_BYTE:return new o4(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case bt.SHORT:return new X3(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case bt.UNSIGNED_SHORT:return new ZH(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case bt.UNSIGNED_INT:return new XH(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case bt.FLOAT:return new Iy(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let vKe=0;async function tbe(t,e,i={},r=!0){const n=await pKe.load(t,e,i),s="gltf_"+vKe++,o={lods:[],materials:new Map,textures:new Map,meta:bKe(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await wKe(n,async(u,p,f,y)=>{const v=l.get(f)??0;l.set(f,v+1);const b=u.mode!==void 0?u.mode:Ht.TRIANGLES,x=b===Ht.TRIANGLES||b===Ht.TRIANGLE_STRIP||b===Ht.TRIANGLE_FAN?b:null;if(x==null)return void ye.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Ht[b]+"). Skipping primitive.");if(!n.hasPositions(u))return void ye.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const S=n.getPositionData(u,i),P=n.getMaterial(u,i,r),C=n.hasNormals(u)?n.getNormalData(u,i):null,R=n.hasTangents(u)?n.getTangentData(u,i):null,N=n.hasTextureCoordinates(u)?n.getTextureCoordinates(u,i):null,$=n.hasVertexColors(u)?n.getVertexColors(u,i):null,k=n.getIndexData(u,i),B={transform:TT(p),attributes:{position:await S,normal:C?await C:null,texCoord0:N?await N:null,color:$?await $:null,tangent:R?await R:null},indices:await k,primitiveType:x,material:TKe(o,await P,s)};let W=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(W=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:y,lodThreshold:W},o.lods[f].parts[v]=B});for(const u of o.lods)u.parts=u.parts.filter(p=>!!p);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function bKe(t){const e=t.json;let i=null;return e.nodes.forEach(r=>{const n=r.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(i=n)}),i}async function wKe(t,e){const i=t.json,r=i.scenes[i.scene||0].nodes,n=r.length>1,s=[];for(const a of r){const l=i.nodes[a];s.push(o(a,0)),xKe(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=i.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&ye.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const f of p.primitives)s.push(e(f,u,l,p.name))}for(const p of c.children||[])s.push(o(p,l))}await Promise.all(s)}function xKe(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function TKe(t,e,i){const r=s=>{const o=`${i}_tex_${s&&s.id}${s&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=oKe(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:SKe.includes(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${i}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=sKe({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?r(e.colorTexture):void 0,textureNormal:e.normalTexture?r(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?r(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?r(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?r(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const SKe=[qt.LINEAR_MIPMAP_LINEAR,qt.LINEAR_MIPMAP_NEAREST];function CKe(t,e){switch(e){case Ht.TRIANGLES:return EKe(t);case Ht.TRIANGLE_STRIP:return AKe(t);case Ht.TRIANGLE_FAN:return PKe(t)}}function EKe(t){return typeof t=="number"?DT(t):M_(t)?new Uint16Array(t):t}function AKe(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const i=e-2,r=RD(3*i);if(typeof t=="number"){let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=s,r[n++]=s+1,r[n++]=s+2):(r[n++]=s+1,r[n++]=s,r[n++]=s+2)}else{let n=0;for(let s=0;s<i;s+=1)s%2==0?(r[n++]=t[s],r[n++]=t[s+1],r[n++]=t[s+2]):(r[n++]=t[s+1],r[n++]=t[s],r[n++]=t[s+2])}return r}function PKe(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const i=e-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof t=="number"){let a=0;for(let l=0;l<i;++l)r[a++]=0,r[a++]=l+1,r[a++]=l+2;return r}const n=t[0];let s=t[1],o=0;for(let a=0;a<i;++a){const l=t[a+2];r[o++]=n,r[o++]=s,r[o++]=l,s=l}return r}let OKe=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},RKe=class{constructor(e,i,r){this.name=e,this.lodThreshold=i,this.pivotOffset=r,this.stageResources=new OKe,this.numberOfVertices=0}};const qm=ye.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function ibe(t,e){const i=await MKe(t,e),r=await NKe(i.textureDefinitions??{},e);let n=0;for(const s in r)if(r.hasOwnProperty(s)){const o=r[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:i,textures:r,size:n+z_e(i)}}async function MKe(t,e){const i=e!=null&&e.streamDataRequester;if(i)return $Ke(t,i,e);const r=await Lg(ps(t,e));if(r.ok===!0)return r.value.data;kb(r.error),rbe(r.error)}async function $Ke(t,e,i){const r=await Lg(e.request(t,"json",i));if(r.ok===!0)return r.value;kb(r.error),rbe(r.error.details.url)}function rbe(t){throw new ce("",`Request for object resource failed: ${t}`)}function IKe(t){const e=t.params,i=e.topology;let r=!0;switch(e.vertexAttributes||(qm.warn("Geometry must specify vertex attributes"),r=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(qm.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(qm.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(qm.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else qm.warn("Indexed geometries must specify faces"),r=!1;break}default:qm.warn(`Unsupported topology '${i}'`),r=!1}t.params.material||(qm.warn("Geometry requires material"),r=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(qm.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function LKe(t,e){var v;const i=new Array,r=new Array,n=new Array,s=new wS,o=t.resource,a=YT.parse(o.version||"1.0","wosr");kKe.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},p=t.textures;let f=0;const y=new Map;for(let b=0;b<c.length;b++){const x=c[b];if(!IKe(x))continue;const S=FKe(x),P=x.params.vertexAttributes,C=[];for(const X in P){const ae=P[X],re=ae.values;C.push([X,new nt(re,ae.valuesPerElement,!0)])}const R=[];if(x.params.topology!=="PerAttributeArray"){const X=x.params.faces;for(const ae in X)R.push([ae,X[ae].values])}const N=S.texture,$=p&&p[N];if($&&!y.has(N)){const{image:X,parameters:ae}=$,re=new Kb(X,ae);r.push(re),y.set(N,re)}const k=y.get(N),B=k?k.id:void 0,W=S.material;let Z=s.get(W,N);if(Z==null){const X=u[W.substring(W.lastIndexOf("/")+1)].params;X.transparency===1&&(X.transparency=0);const ae=$&&$.alphaChannelUsage,re=X.transparency>0||ae==="transparency"||ae==="maskAndTransparency",ee=$?nbe($.alphaChannelUsage):void 0,oe={ambient:Za(X.diffuse),diffuse:Za(X.diffuse),opacity:1-(X.transparency||0),transparent:re,textureAlphaMode:ee,textureAlphaCutoff:.33,textureId:B,initTextureTransparent:!0,doubleSided:!0,cullFace:Fr.None,colorMixMode:X.externalColorMixMode||"tint",textureAlphaPremultiplied:($==null?void 0:$.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParamsMixin&&Object.assign(oe,e.materialParamsMixin),Z=new Kf(oe),s.set(W,N,Z)}n.push(Z);const K=new fs(Z,C,R);f+=((v=R.find(X=>X[0]===M.POSITION))==null?void 0:v[1].length)??0,i.push(K)}return{engineResources:[{name:l,stageResources:{textures:r,materials:n,geometries:i},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:DKe(i)}}function DKe(t){const e=Gr();return t.forEach(i=>{const r=i.boundingInfo;r!=null&&(Hf(e,r.bbMin),Hf(e,r.bbMax))}),e}async function NKe(t,e){const i=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){qm.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:Jt.REPEAT,t:Jt.REPEAT},preMultiplyAlpha:nbe(u)!==_r.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):kg(l,e);i.push(f.then(y=>({refId:c,image:y,parameters:p,alphaChannelUsage:u})))}const r=await Promise.all(i),n={};for(const s of r)n[s.refId]=s;return n}function nbe(t){switch(t){case"mask":return _r.Mask;case"maskAndTransparency":return _r.MaskBlend;case"none":return _r.Opaque;default:return _r.Blend}}function FKe(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const kKe=new YT(1,2,"wosr"),nx=2.1;async function sbe(t,e){var p;const i=obe(sV(t));if(i.fileType==="wosr"){const f=await(e.cache?e.cache.loadWOSR(i.url,e):ibe(i.url,e)),{engineResources:y,referenceBoundingBox:v}=LKe(f,e);return{lods:y,referenceBoundingBox:v,isEsriSymbolResource:!1,isWosr:!0}}const r=await(e.cache?e.cache.loadGLTF(i.url,e,!!e.usePBR):tbe(new Q1e(e.streamDataRequester),i.url,e,e.usePBR)),n=(p=r.model.meta)==null?void 0:p.ESRI_proxyEllipsoid,s=r.meta.isEsriSymbolResource&&n!=null&&r.meta.uri.includes("/RealisticTrees/");s&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,VKe(r,n));const o=!!e.usePBR,a=r.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[...LZe]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...V4]},l={...e.materialParamsMixin,treeRendering:s},{engineResources:c,referenceBoundingBox:u}=abe(r,a,l,e.skipHighLods&&i.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:i.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function obe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function abe(t,e,i,r){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=Gr();return n.lods.forEach((u,p)=>{const f=r.skipHighLods===!0&&(l>1&&p===0||l>3&&p===1)||r.skipHighLods===!1&&r.singleLodIndex!=null&&p!==r.singleLodIndex;if(f&&p!==0)return;const y=new RKe(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(v=>{const b=f?new Kf({}):UKe(n,v,y,e,i,o,a),{geometry:x,vertexCount:S}=zKe(v,b??new Kf({})),P=x.boundingInfo;P!=null&&p===0&&(Hf(c,P.bbMin),Hf(c,P.bbMax)),b!=null&&(y.stageResources.geometries.push(x),y.numberOfVertices+=S)}),f||s.push(y)}),{engineResources:s,referenceBoundingBox:c}}function UKe(t,e,i,r,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const p=BKe(l.alphaMode);if(!s.has(a)){if(c){const N=($,k=!1)=>{if($!=null&&!o.has($)){const B=t.textures.get($);if(B!=null){const W=B.data;o.set($,new Kb(Y1(W)?W.data:W,{...B.parameters,preMultiplyAlpha:!Y1(W)&&k,encoding:Y1(W)&&W.encoding!=null?W.encoding:void 0}))}}};N(l.textureColor,p!==_r.Opaque),N(l.textureNormal),N(l.textureOcclusion),N(l.textureEmissive),N(l.textureMetallicRoughness)}const y=l.color[0]**(1/nx),v=l.color[1]**(1/nx),b=l.color[2]**(1/nx),x=l.emissiveFactor[0]**(1/nx),S=l.emissiveFactor[1]**(1/nx),P=l.emissiveFactor[2]**(1/nx),C=l.textureColor!=null&&c?o.get(l.textureColor):null,R=e1e({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});s.set(a,new Kf({...r,transparent:p===_r.Blend,customDepthTest:bb.Lequal,textureAlphaMode:p,textureAlphaCutoff:l.alphaCutoff,diffuse:[y,v,b],ambient:[y,v,b],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Fr.None:Fr.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?Wi.Attribute:Wi.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:C!=null?C.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:C!=null&&!!C.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[x,S,P],mrrFactors:R?[...Sq]:[l.metallicFactor,l.roughnessFactor,r.mrrFactors[2]],isSchematic:R,colorTextureTransformMatrix:Cf(l.colorTextureTransform),normalTextureTransformMatrix:Cf(l.normalTextureTransform),occlusionTextureTransformMatrix:Cf(l.occlusionTextureTransform),emissiveTextureTransformMatrix:Cf(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:Cf(l.metallicRoughnessTextureTransform),...n}))}const f=s.get(a);if(i.stageResources.materials.push(f),c){const y=v=>{v!=null&&i.stageResources.textures.push(o.get(v))};y(l.textureColor),y(l.textureNormal),y(l.textureOcclusion),y(l.textureEmissive),y(l.textureMetallicRoughness)}return f}function zKe(t,e){const i=t.attributes.position.count,r=CKe(t.indices||i,t.primitiveType),n=mn(3*i),{typedBuffer:s,typedBufferStride:o}=t.attributes.position;qT(n,s,t.transform,3,o);const a=[[M.POSITION,new nt(n,3,!0)]],l=[[M.POSITION,r]];if(t.attributes.normal!=null){const c=mn(3*i),{typedBuffer:u,typedBufferStride:p}=t.attributes.normal;my(ZM,t.transform),Pb(c,u,ZM,3,p),a.push([M.NORMAL,new nt(c,3,!0)]),l.push([M.NORMAL,r])}if(t.attributes.tangent!=null){const c=mn(4*i),{typedBuffer:u,typedBufferStride:p}=t.attributes.tangent;my(ZM,t.transform),Rq(c,u,ZM,4,p),a.push([M.TANGENT,new nt(c,4,!0)]),l.push([M.TANGENT,r])}if(t.attributes.texCoord0!=null){const c=mn(2*i),{typedBuffer:u,typedBufferStride:p}=t.attributes.texCoord0;Mq(c,u,2,p),a.push([M.UV0,new nt(c,2,!0)]),l.push([M.UV0,r])}if(t.attributes.color!=null){const c=new Uint8Array(4*i);t.attributes.color.elementCount===4?t.attributes.color instanceof mp?hN(c,t.attributes.color,255):t.attributes.color instanceof Aa?$q(c,t.attributes.color):t.attributes.color instanceof Z3&&hN(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof Ms?tN(c,t.attributes.color,255,4):t.attributes.color instanceof a4?fO(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof c4&&tN(c,t.attributes.color,1/256,4)),a.push([M.COLOR,new nt(c,4,!0)]),l.push([M.COLOR,r])}return{geometry:new fs(e,a,l),vertexCount:i}}const ZM=on();function BKe(t){switch(t){case"BLEND":return _r.Blend;case"MASK":return _r.Mask;case"OPAQUE":case null:case void 0:return _r.Opaque}}function VKe(t,e){for(let i=0;i<t.model.lods.length;++i){const r=t.model.lods[i];for(const n of r.parts){const s=n.attributes.normal;if(s==null)return;const o=n.attributes.position,a=o.count,l=I(),c=I(),u=I(),p=new Uint8Array(4*a),f=new Float64Array(3*a),y=fo(Ne(),n.transform);let v=0,b=0;for(let x=0;x<a;x++){o.getVec(x,c),s.getVec(x,l),st(c,c,n.transform),Ce(u,c,e.center),ML(u,u,e.radius);const S=u[2],P=ze(u),C=Math.min(.45+.55*P*P,1);ML(u,u,e.radius),y!==null&&st(u,u,y),Me(u,u),i+1!==t.model.lods.length&&t.model.lods.length>1&&pr(u,u,l,S>-1?.2:Math.min(-4*S-3.8,1)),f[v]=u[0],f[v+1]=u[1],f[v+2]=u[2],v+=3,p[b]=255*C,p[b+1]=255*C,p[b+2]=255*C,p[b+3]=255,b+=4}n.attributes.normal=new Ms(f),n.attributes.color=new Aa(p)}}}const CSt=Object.freeze(Object.defineProperty({__proto__:null,fetch:sbe,gltfToEngineResources:abe,parseUrl:obe},Symbol.toStringTag,{value:"Module"})),GKe=()=>!!ge("enable-feature:force-wosr"),ESt=()=>!!ge("enable-feature:direct-3d-object-feature-layer-display"),jKe=()=>ge.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),HKe=()=>ge.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),ASt=()=>!!ge("enable-i3s-patching"),WKe=()=>ge.add("enable-i3s-patching",!0,!0,!0),qKe=()=>ge.add("enable-i3s-patching",!1,!0,!0),PSt=()=>!!ge("enable-feature:SceneLayer-editing"),ZKe=(t="i3s-patching")=>{switch(qKe(),HKe(),ge.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":jKe();break;case"i3s-patching":WKe()}};ZKe("i3s-patching");let oU={};async function XKe(t,e){try{return{data:(await Iq(t,e)).data,baseUrl:xj(t),styleUrl:t}}catch(i){return kb(i),null}}function YKe(t,e,i){const r=e.portal!=null?e.portal:zh.getDefault();let n;const s=`${r.url} - ${r.user&&r.user.username} - ${t}`;return oU[s]||(oU[s]=JKe(t,r,i).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),oU[s]}function JKe(t,e,i){return e.load(i).then(()=>{const r=new wf({disableExtraQuery:!0,query:`owner:${Wte} AND type:${qte} AND typekeywords:"${t}"`});return e.queryItems(r,i)}).then(({results:r})=>{var o;let n=null;const s=t.toLowerCase();if(r&&Array.isArray(r)){for(const a of r)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===qte&&a.owner===Wte){n=a;break}}if(!n)throw new ce("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(i)})}function lbe(t,e,i){return t&&t.styleUrl!=null?XKe(t.styleUrl,i):t&&t.styleName!=null?YKe(t.styleName,e,i):Promise.reject(new ce("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function cbe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function ube(t,e,i=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!GKe())for(const r of i){const n=t.formatInfos.find(s=>s.type===r);if(n)return n.href}return t.webRef}function Iq(t,e){const i={responseType:"json",query:{f:"json"},...e};return ps(mg(t),i)}const Wte="esri_en",qte="Style",KKe="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",kC={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function QKe(t,e=kC){var a,l;if(!t)return{symbol:null};const{retainId:i=kC.retainId,ignoreDrivers:r=kC.ignoreDrivers,hasLabelingContext:n=kC.hasLabelingContext,retainCIM:s=kC.retainCIM}=e;let o=null;if(mb(t)||t instanceof hS)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new ce("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():N_.fromCIMSymbol(t)}else if(t instanceof Vb)o=S5.fromSimpleLineSymbol(t);else if(t instanceof P5)o=N_.fromSimpleMarkerSymbol(t);else if(t instanceof E5)o=N_.fromPictureMarkerSymbol(t);else if(t instanceof Mj)o=e.geometryType&&e.geometryType==="mesh"?C5.fromSimpleFillSymbol(t):A5.fromSimpleFillSymbol(t);else{if(!(t instanceof U3))return{error:new ce("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?T5.fromTextSymbol(t):N_.fromTextSymbol(t)}return i&&o&&o.type!=="cim"&&(o.id=t.id),r&&mb(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function OSt(t,e,i,r){const n=hbe(t,{},{context:r,isLabelSymbol:!1});n!=null&&(e[i]=n)}function RSt(t,e,i,r){const n=hbe(t,{},{context:r,isLabelSymbol:!0});n!=null&&(e[i]=n)}function Zte(t){return t instanceof uS||t instanceof hS}function hbe(t,e,i){if(t==null)return null;const{context:r,isLabelSymbol:n}=i,s=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(s==="web-scene"&&!Zte(t)){const a=QKe(t,{retainCIM:!0,hasLabelingContext:n});return a.symbol!=null?a.symbol.write(e,r):(o==null||o.push(new ce("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:r,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!wDe(r==null?void 0:r.layer))&&Zte(t)?(o==null||o.push(new ce("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:r})),null):t.write(e,r)}function dbe(t,e){return b$e(t,null,e)}function eQe(t,e,i,r){const n=t.name;return n==null?Promise.reject(new ce("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?tQe(n,e,r):lbe(t,e,r).then(s=>Dq(uc(s),n,e,i,ube,r))}function Lq(t,e){return e.items.find(i=>i.name===t)}function Dq(t,e,i,r,n,s){var y;const o=i&&i.portal!=null?i.portal:zh.getDefault(),a={portal:o,url:sl(t.baseUrl),origin:"portal-item"},l=Lq(e,t.data);if(!l){const v=`The symbol name '${e}' could not be found`;return Promise.reject(new ce("symbolstyleutils:symbol-name-not-found",v,{symbolName:e}))}let c=db(n(l,r),a),u=((y=l.thumbnail)==null?void 0:y.href)??null;const p=l.thumbnail&&l.thumbnail.imageData;WJe()&&(c=sV(c)??"",u=sV(u));const f={portal:o,url:sl(xj(c)),origin:"portal-item"};return Iq(c,s).then(v=>{const b=r==="cimRef"?cbe(v.data):v.data,x=dbe(b,f);if(x&&mb(x)){if(u){const S=db(u,a);x.thumbnail=new B1({url:S})}else p&&(x.thumbnail=new B1({url:`data:image/png;base64,${p}`}));t.styleUrl?x.styleOrigin=new RP({portal:i.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(x.styleOrigin=new RP({portal:i.portal,styleName:t.styleName,name:e}))}return x})}function tQe(t,e,i){const r=KKe.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:zh.getDefault();return Iq(r,i).then(s=>{const o=cbe(s.data);return dbe(o,{portal:n,url:sl(xj(r)),origin:"portal-item"})})}const iQe=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:Dq,getStyleItemFromStyle:Lq,resolveWebStyleSymbol:eQe},Symbol.toStringTag,{value:"Module"}));async function rQe(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new ce("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const i={portal:t.portal},r=await lbe(t,i).catch(()=>null);if(r===null)return null;const n=Lq(e,r.data);if(n&&!((a=n.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const s=await Dq(r,e,i,"webRef",(l,c)=>ube(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const o=s.symbolLayers.items[0];return o.type==="object"?o.resource:null}let nQe=class{constructor(e,i,r){this._elementSize=i,this._buffer=Ki.createVertex(e,zi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,i,r,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(i-e)*this.elementSize);new Uint8Array(r.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,i){const r=e*this._elementSize,n=i*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,n)}resize(e){const i=e*this._elementSize,r=new ArrayBuffer(i);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=e}},sQe=class{constructor(e){this.modelOriginHi=e.getField(M.MODELORIGINHI,Ms),this.modelOriginLo=e.getField(M.MODELORIGINLO,Ms),this.model=e.getField(M.MODEL,_y),this.modelNormal=e.getField(M.MODELNORMAL,_y),this.featureAttribute=e.getField(M.INSTANCEFEATUREATTRIBUTE,mp),this.color=e.getField(M.INSTANCECOLOR,Aa),this.objectAndLayerIdColor=e.getField(M.INSTANCEOBJECTANDLAYERIDCOLOR,Aa)}},Xte=class{constructor(e,i){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,i=this._tailIndex;return e>=i?e-i:e+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){xt(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){xt(this._updating,"not updating"),this.size<HTe*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){xt(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),xt(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){xt(this._updating,"not updating"),xt(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(dN,Math.floor(this._capacity*WN));this._resize(e)}_shrink(){const e=Math.max(dN,Math.floor(this._capacity*jTe));this._resize(e)}_resize(e){if(xt(this._updating,"not updating"),e===this._capacity)return;const i=new nQe(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,n=this._compactInstances(i);xt(n===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=i,this._view=new sQe(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,e),i-r):r>i?(this._buffer.copyRange(r,this._capacity,e),i>0&&this._buffer.copyRange(0,i,e,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,i){e<i?this._buffer.transferRange(e,i):e>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(e,this._capacity))}};const dN=64;var Yr;function oQe(t){let e=ln().mat4f64(M.LOCALTRANSFORM).mat4f64(M.GLOBALTRANSFORM).vec4f64(M.BOUNDINGSPHERE).vec3f64(M.MODELORIGIN).mat3f(M.MODEL).mat3f(M.MODELNORMAL).vec2f(M.MODELSCALEFACTORS);return t.includes(M.FEATUREATTRIBUTE)&&(e=e.vec4f(M.FEATUREATTRIBUTE)),t.includes(M.COLOR)&&(e=e.vec4u8(M.COLOR)),t.includes(M.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(M.OBJECTANDLAYERIDCOLOR)),e=e.u8(M.STATE).u8(M.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(Yr||(Yr={}));let Yte=class{constructor(e){this.localTransform=e.getField(M.LOCALTRANSFORM,WP),this.globalTransform=e.getField(M.GLOBALTRANSFORM,WP),this.modelOrigin=e.getField(M.MODELORIGIN,Wh),this.model=e.getField(M.MODEL,_y),this.modelNormal=e.getField(M.MODELNORMAL,_y),this.modelScaleFactors=e.getField(M.MODELSCALEFACTORS,Iy),this.boundingSphere=e.getField(M.BOUNDINGSPHERE,s4),this.featureAttribute=e.getField(M.FEATUREATTRIBUTE,mp),this.color=e.getField(M.COLOR,Aa),this.objectAndLayerIdColor=e.getField(M.OBJECTANDLAYERIDCOLOR,Aa),this.state=e.getField(M.STATE,LT),this.lodLevel=e.getField(M.LODLEVEL,LT)}},r2=class extends ke{constructor(e,i){super(e),this.events=new os,this._capacity=0,this._size=0,this._next=0,this._layout=oQe(i),this._capacity=dN,this._buffer=this._layout.createBuffer(this._capacity),this._view=new Yte(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,Yr.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const i=this._view.state;xt(e>=0&&e<this._capacity&&(i.get(e)&Yr.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,Yr.ACTIVE)?this._setStateFlags(e,Yr.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const i=this._view.state;xt(e>=0&&e<this._capacity&&(i.get(e)&Yr.ALLOCATED)!=0,"invalid instance handle"),i.set(e,0),this._size--}setLocalTransform(e,i,r=!0){this._view.localTransform.setMat(e,i),r&&this.updateModelTransform(e)}getLocalTransform(e,i){this._view.localTransform.getMat(e,i)}setGlobalTransform(e,i,r=!0){this._view.globalTransform.setMat(e,i),r&&this.updateModelTransform(e)}getGlobalTransform(e,i){this._view.globalTransform.getMat(e,i)}updateModelTransform(e){const i=this._view,r=ql,n=hd;i.localTransform.getMat(e,Jte),i.globalTransform.getMat(e,aU);const s=Cr(aU,aU,Jte);me(r,s[12],s[13],s[14]),i.modelOrigin.setVec(e,r),jh(n,s),i.model.setMat(e,n);const o=$Le(ql,s);o.sort(),i.modelScaleFactors.set(e,0,o[1]),i.modelScaleFactors.set(e,1,o[2]),Xb(n,n),Hh(n,n),i.modelNormal.setMat(e,n),this._setStateFlags(e,Yr.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,i){const r=this._view;r.model.getMat(e,hd),r.modelOrigin.getVec(e,ql),i[0]=hd[0],i[1]=hd[1],i[2]=hd[2],i[3]=0,i[4]=hd[3],i[5]=hd[4],i[6]=hd[5],i[7]=0,i[8]=hd[6],i[9]=hd[7],i[10]=hd[8],i[11]=0,i[12]=ql[0],i[13]=ql[1],i[14]=ql[2],i[15]=1}applyShaderTransformation(e,i){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedModelTransform(e,i){return this.getModelTransform(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i),i}getCombinedLocalTransform(e,i){this._view.localTransform.getMat(e,i),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,i)}getCombinedMaxScaleFactor(e){let i=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ql,this,e),i*=Math.max(ql[0],ql[1],ql[2])),i}getCombinedMedianScaleFactor(e){let i=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(ql,this,e),i*=aQe(ql[0],ql[1],ql[2])),i}getModel(e,i){this._view.model.getMat(e,i)}setFeatureAttribute(e,i){this._view.featureAttribute.setVec(e,i)}getFeatureAttribute(e,i){this._view.featureAttribute.getVec(e,i)}setColor(e,i){this._view.color.setVec(e,i)}setObjectAndLayerIdColor(e,i){this._view.objectAndLayerIdColor.setVec(e,i)}setVisible(e,i){i!==this.getVisible(e)&&(this._setStateFlag(e,Yr.VISIBLE,i),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,Yr.VISIBLE)}setHighlight(e,i){i!==this.getHighlight(e)&&(this._setStateFlag(e,Yr.HIGHLIGHT,i),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,Yr.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++i;return i}_setStateFlags(e,i){const r=this._view.state;i=r.get(e)|i,r.set(e,i)}_clearStateFlags(e,i){const r=this._view.state;i=r.get(e)&~i,r.set(e,i)}_setStateFlag(e,i,r){r?this._setStateFlags(e,i):this._clearStateFlags(e,i)}_getStateFlag(e,i){return!!(this._view.state.get(e)&i)}_grow(){this._capacity=Math.max(dN,Math.floor(this._capacity*WN)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new Yte(this._buffer)}_findSlot(){const e=this._view.state;let i=this._next;for(;e.get(i)&Yr.ALLOCATED;)i=i+1===this._capacity?0:i+1;return this._next=i+1===this._capacity?0:i+1,i}};function aQe(t,e,i){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),i))}d([m({constructOnly:!0})],r2.prototype,"shaderTransformation",void 0),d([m()],r2.prototype,"_size",void 0),d([m({readOnly:!0})],r2.prototype,"size",null),r2=d([J("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],r2);const ql=I(),hd=on(),Jte=Ne(),aU=Ne();let lQe=class extends Kd{constructor(e,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=i,this._tmpSphere=kn(),this._tmpMat4=Ne()}addInstance(e){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);st(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*CT(r),i.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},cQe=class{constructor(e,i){this._worldSpaceRadius=e,this._minScreenSpaceRadii=i}selectLevel(e,i,r){const n=r.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*i/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},uQe=class extends d4{constructor(e,i,r,n,s,o){super(e,i),this.layerUid=e,this.graphicUid=i,this.geometryId=r,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function Nq(t){return bp(t)&&t.intersector===sn.LOD&&!!t.target}let hQe=class{constructor(e,i){const r=e.renderContext.rctx,n=i.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=o.createBuffer(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new Rve(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=Ki.createVertex(r,zi.STATIC_DRAW,l.buffer),this.vao=new vp(r,Ni,{geometry:Pc(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,i,r,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,r,n,(u,p,f,y,v)=>{if(u>=0){if(i!=null&&!i(e.rayBegin,e.rayEnd,u))return;const b=new uQe(o.layerUid,o.graphicUid(s),c,f,a,l);if((e.results.min.drapedLayerOrder==null||v>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(sn.LOD,b,u,p,e.transform.transform,v),e.options.store!==Do.MIN&&(e.results.max.drapedLayerOrder==null||v>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(sn.LOD,b,u,p,e.transform.transform,v),e.options.store===Do.ALL){const x=nW(e.results.min.ray);x.set(sn.LOD,b,u,p,e.transform.transform,v),e.results.all.push(x)}}})}},dQe=class pbe{static async create(e,i,r){const n=await Promise.allSettled(i.components.map(o=>e.controller.schedule(()=>new hQe(e,o),r))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(w3);if(Gs(r)||s.length!==n.length){s.forEach(o=>o.destroy()),Ti(r);for(const o of n)if(o.status==="rejected")throw o.reason}return new pbe(i.minScreenSpaceRadius,s)}constructor(e,i){this.minScreenSpaceRadius=e,this.components=i}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,i,r,n,s,o,a){this.components.forEach(l=>l.intersect(e,i,r,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=Gr();this.components.forEach(i=>{i.boundingInfo!=null&&(Hf(e,i.boundingInfo.bbMin),Hf(e,i.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,i=I();Zd(e,i),this._boundingSphere={center:i,radius:.5*zue(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,i)=>e+i.triangleCount,0)}};const pQe=t=>{const e=t.baseBoundingSphere.radius,i=t.levels.map(r=>r.minScreenSpaceRadius);return new cQe(e,i)};let ah=class extends ke{constructor(e,i){super(e),this.type=sn.LOD,this.isGround=!1,this._handles=new an,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new It,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Te.OPAQUE_MATERIAL,Te.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new r2({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(i.registerTask(Dt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=mQe(this.optionalFields),this._glInstanceBufferLayout=Pc(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(i=>i.forEach(r=>{e.cpu+=r.memoryUsage.cpu,e.gpu+=r.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,i=[];return this._levels.forEach((r,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=r.triangleCount;i.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:i.reduce((r,n)=>r+n.renderedInstances,0),renderedTriangles:i.reduce((r,n)=>r+n.renderedTriangles,0),levels:i}}async initializeRenderContext(e,i){this._context=e;const r=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new Xte(r,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new Xte(r,this._instanceBufferLayout)),dQe.create(e,o,i)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(w3);if(Gs(i)||s.length!==n.length){s.forEach(o=>o.destroy()),Ti(i);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=pQe(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(i=>i.material.requiresSlot(Te.TRANSPARENT_MATERIAL,j.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!Or.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const i=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),i||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(Qa),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const i=this._getInstanceDatas(e.output);if(!i)return null;const r=new Array;return i.forEach(n=>this.levels.forEach((s,o)=>{s.components.forEach(a=>r.push(this._beginComponent(e,n[o],a)))})),r}render(e,i){const r=this._getInstanceDatas(e.output);if(!r)return;let n=0;e.rctx.bindVAO(),r.forEach(s=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,i[n++],s[a],l,a))}))}_getInstanceDatas(e){const i=e!==j.Highlight&&e!==j.ShadowHighlight,r=e!==j.ShadowExcludeHighlight;return i&&r?this._allRenderInstanceData:i?this._defaultRenderInstanceData:r?this._highlightRenderInstanceData:null}intersect(e,i,r,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=I();Ce(s,n,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,eie),e.transform.set(eie),st(tie,r,e.transform.inverse),st(iie,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;xt((l&Yr.ACTIVE)!=0,"invalid instance state"),xt(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,i,tie,iie,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(r,s,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const i=this._instanceData,r=(e=i.view)==null?void 0:e.state;if(!r)return null;this._octreeCached=new lQe(i,this.baseBoundingSphere);for(let n=0;n<i.capacity;++n)r.get(n)&Yr.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=Je(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const i=e.viewForward,r=this._octree.findClosest(i,Kd.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(i,Kd.DepthOrder.BACK_TO_FRONT,e.frustum);if(r==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(r,Bp),Ce(Bp,Bp,s);const a=Re(Bp,i)-Bp[3];o.boundingSphere.getVec(n,Bp),Ce(Bp,Bp,s);const l=Re(Bp,i)+Bp[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(i=>i.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:i,_camera:r,_levelSelector:n}=this;this._allRenderInstanceData.forEach(u=>u.forEach(p=>p.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;for(let u=0;u<a&&!e.done;++u){c===this._cycleStartIndex&&this._startUpdateCycle();const p=o.state.get(c);let f=0;if(!(p&Yr.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const y=o.lodLevel.get(c);if(p&Yr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][y].freeTail(),p&Yr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][y].freeTail(),p&Yr.REMOVE)s.freeInstance(c);else if(p&Yr.VISIBLE){let v=0;i&&(o.modelOrigin.getVec(c,Qte),v=n.selectLevel(Qte,s.getCombinedMedianScaleFactor(c),r)),f=p&~(Yr.ACTIVE|Yr.TRANSFORM_CHANGED),v>=0&&(p&Yr.HIGHLIGHT?(Kte(this._highlightRenderInstanceData[0][v],o,c),f|=Yr.HIGHLIGHT_ACTIVE):(Kte(this._defaultRenderInstanceData[0][v],o,c),f|=Yr.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,v)}else f=p&~(Yr.ACTIVE|Yr.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const v=!!(p&Yr.ACTIVE),b=!!(f&Yr.ACTIVE);!v&&b?this._octreeCached.addInstance(c):v&&!b?this._octreeCached.removeInstance(c):v&&b&&p&Yr.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(u=>u.forEach(p=>p.endUpdate())),this._context.requestRender()}_beginComponent(e,i,r){const{bindParameters:n,rctx:s,output:o}=e;if(i.size===0||!r.material.requiresSlot(n.slot,e.output))return null;const a=r.glMaterials.load(s,n.slot,o);return a!=null?a.beginSlot(n):null}_renderComponent(e,i,r,n,s){var x;if(!i)return;const{bindParameters:o,rctx:a}=e;(x=a.appleAmdDriverHelper)==null||x.resetIndicesType();const l=a.bindTechnique(i,n.material.parameters,o);a.bindVAO(n.vao),i.ensureAttributeLocations(n.vao),l.bindDraw(gQe,o,n.material.parameters),Or.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===j.Color&&(l.setUniform4fv("externalColor",rie[Math.min(s,rie.length-1)]),l.setUniform1i("colorMixMode",t_e.replace));const c=a.capabilities.instancing,u=r.capacity,p=r.headIndex,f=r.tailIndex,y=r.firstIndex,v=this._glInstanceBufferLayout,b=(S,P)=>{SH(a,Ni,r.buffer,v,S),c.drawArraysInstanced(i.primitiveType,0,n.vertexCount,P-S),CH(a,Ni,r.buffer,v)};n.material.parameters.transparent&&y!=null?p>f?(xt(y>=f&&y<=p,"invalid firstIndex"),b(y,p),b(f,y)):p<f&&(y<=p?(xt(y>=0&&y<=p,"invalid firstIndex"),b(y,p),b(f,u),b(0,y)):(xt(y>=f&&y<=u,"invalid firstIndex"),b(y,u),b(0,p),b(f,y))):p>f?b(f,p):p<f&&(b(0,p),b(f,u)),a.bindVAO(null)}};function Kte(t,e,i){const r=t.allocateHead();fQe(e,i,t.view,r)}function fQe(t,e,i,r){uUe(t.modelOrigin,e,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,t.model,e),i.modelNormal.copyFrom(r,t.modelNormal,e),t.color&&i.color&&i.color.copyFrom(r,t.color,e),t.objectAndLayerIdColor&&i.objectAndLayerIdColor&&i.objectAndLayerIdColor.copyFrom(r,t.objectAndLayerIdColor,e),t.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,t.featureAttribute,e)}function mQe(t){let e=ln().vec3f(M.MODELORIGINHI).vec3f(M.MODELORIGINLO).mat3f(M.MODEL).mat3f(M.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(M.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(M.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(M.INSTANCEOBJECTANDLAYERIDCOLOR)),e}d([m({constructOnly:!0})],ah.prototype,"symbol",void 0),d([m({constructOnly:!0})],ah.prototype,"optionalFields",void 0),d([m({constructOnly:!0})],ah.prototype,"metadata",void 0),d([m({constructOnly:!0})],ah.prototype,"shaderTransformation",void 0),d([m()],ah.prototype,"_instanceData",void 0),d([m()],ah.prototype,"_cycleStartIndex",void 0),d([m({readOnly:!0})],ah.prototype,"_enableLevelSelection",null),d([m()],ah.prototype,"_updateCyclesWithStaticCamera",void 0),d([m({readOnly:!0})],ah.prototype,"running",null),ah=d([J("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],ah);const Qte=I(),Bp=gi(),eie=Ne(),tie=I(),iie=I(),rie=[Kt(1,0,1,1),Kt(0,0,1,1),Kt(0,1,0,1),Kt(1,1,0,1),Kt(1,0,0,1)],gQe=new YZe;let nie=class{constructor(e,i,r,n,s,o,a,l,c,u,p,f){this.lodResources=e,this.lodRenderer=i,this.stageResources=r,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=p,this.pivotOffset=f}},_Qe=class extends cm{getCachedSize(){const[e,i,r]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:i,height:r}}constructor(e,i,r,n){super(e,i,r,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&M4(this.symbolLayer))throw new Error;if(this._isPrimitive){const i=this.symbolLayer.resource,r=i&&dHe(i.primitive)?i.primitive:yhe;this._resources=await this._createResourcesForPrimitive(r,e)}else{const i=await rQe(this.symbol.styleOrigin),r=(i==null?void 0:i.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(r,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}_setMaterialTransparencyParams(e,i=(n=>(n=(r=>(r=this.symbolLayer)==null?void 0:r.material)())==null?void 0:n.color)()){const s=this._getCombinedOpacity(i),o=s<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=s,e.cullFace=o?Fr.None:Fr.Back,e}async _createResourcesForPrimitive(e,i){const r=this.symbolLayer,n=$s(HRe(e)),s=Za(pR(n)),o=Za(KF(s,r)),a=ze(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...Sq],ambient:ug,diffuse:ug,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=!!u.usePBR;this._setMaterialTransparencyParams(u);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:P,minWorldLength:C,maxWorldLength:R}=f.verticalOffset;u.verticalOffset={screenLength:Sa(P),minWorldLength:C||0,maxWorldLength:R??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Sh;else{const P=r.material!=null?r.material.color:null,C=P!=null?Lt.toUnitRGBA(P):Sh;u.externalColor=C}this._fastUpdates=VT(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(M.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(M.COLOR)),ge("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(M.OBJECTANDLAYERIDCOLOR);const y=new Kf(u),v=Tye(e,y);if(!v)throw new Error(`Unknown object symbol primitive: ${e}`);const b=EM(v).map(P=>({opacity:1,transparent:P.parameters.transparent})),x=await this._createStageResources(v,p,i),S=await this._createLodRenderer(v,i);return new nie(v,S,x,b,s,l,c,n,o,a,p,null)}async _createResourcesForUrl(e,i){var Z,K;const r={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=VT(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(r.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(M.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(r.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(M.COLOR)),ge("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(M.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:X,minWorldLength:ae,maxWorldLength:re}=n.verticalOffset;r.materialParamsMixin.verticalOffset={screenLength:Sa(X),minWorldLength:ae||0,maxWorldLength:re??1/0},r.materialParamsMixin.castShadows=!1}r.signal=i,r.usePBR=this._context.physicalBasedRenderingEnabled,r.skipHighLods=this._context.skipHighSymbolLods;const s=r.usePBR,o=await sbe(e,r),a=o.isEsriSymbolResource,l=o.isWosr,c=HJe(o.lods);c.levels.sort((X,ae)=>X.minScreenSpaceRadius-ae.minScreenSpaceRadius);const u=this._context,p=this.symbolLayer.material,f=this._getExternalColorParameters(p),y=(K=(Z=this.symbolLayer)==null?void 0:Z.material)==null?void 0:K.color,v=this._getCombinedOpacity(y,{hasIntrinsicColor:!0}),b=this.needsDrivenTransparentPass,x=EM(c),S=EM(c).map(X=>({opacity:X.parameters.opacity||1,transparent:X.parameters.transparent}));x.forEach(X=>{const ae=X.parameters;X.setParameters(f);const re=ae.opacity*v,ee=re<1||b||ae.transparent;X.setParameters({opacity:re,transparent:ee}),u.screenSizePerspectiveEnabled&&X.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const P=o.referenceBoundingBox,C=Za(pR(P)),R=Za(c.levels[0].pivotOffset),N=Za(KF(C,this.symbolLayer)),$=ze(N),k=this._fastUpdates;GT(k,this._context.renderer,this._fastVisualVariableConvertOptions(P,N,C,R))&&x.forEach(X=>X.setParameters(k.materialParameters));const B=await this._createStageResources(c,s,i),W=await this._createLodRenderer(c,i);return new nie(c,W,B,S,C,a,l,P,N,$,s,R)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,i,r){const n=this._context.stage,s=EM(e);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=lee(e);n.addMany(o),this._addDisposeResource(()=>n.removeMany(o)),await n.load(o,r),Ti(r);const a=cee(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,i){const r=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},s=this._fastUpdates,o=s?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,XM),Qn(u,$7(s.materialParameters,XM,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,XM),CGe(l,s.materialParameters,XM)}}:null,a=new ah({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(a),a.destroy()}),await r.addRenderPlugin(a.slots,a,i),a}_getExternalColorParameters(e){const i={};return this._drivenProperties.color?i.externalColor=Sh:e!=null&&e.color!=null?i.externalColor=Lt.toUnitRGBA(e.color):(i.externalColor=Sh,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry))return null;const r=i3(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const n=this.setGraphicElevationContext(i,new wp),s=e.renderingInfo;return this._createAs3DShape(i,r,s,n,i.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var s,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,i=!this._isPrimitive,r=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let a=0;a<r.length;a++){const l=r[a],c=(o=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:o.color,u=n[a],p=this._getCombinedOpacity(c,{hasIntrinsicColor:i})*u.opacity,f=p<1||e||u.transparent;l.setParameters({opacity:p,transparent:f}),this._isPrimitive&&l.setParameters({cullFace:f?Fr.None:Fr.Back})}}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ty)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:i}=this._resources;for(const r of e.materials)this._isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,i){if(this._resources==null)return Jn.RecreateSymbol;const{stageResources:{materials:r},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!GT(this._fastUpdates,i,this._fastVisualVariableConvertOptions(s,o,a,l)))return Jn.RecreateSymbol;for(const u of r)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return Jn.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,i=xye(e.levels[0]).reduce((s,o)=>s+o.indices.get(M.POSITION).length,0)/3,r=s=>Array.from(s.vertexAttributes.values()).reduce((o,a)=>o+$_(a.data),0)+Array.from(s.indices.values()).reduce((o,a)=>o+$_(a),0),n=lee(e).reduce((s,o)=>s+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+cee(e).reduce((s,o)=>s+r(o),0);return{primitivesPerFeature:i,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...Eye(this.symbol,this.symbolLayer),resourceBytes:n}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,i,r,n,s,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(No(i,sx,this._context.elevationProvider.spatialReference),l!=null&&!cj(l,sx))return null;const c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(i,n,lU,YM),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,sie),f=this._resources.lodRenderer.instanceData,y=f.addInstance();this._instanceIndexToGraphicUid.set(y,s),f.setLocalTransform(y,p,!1),f.setGlobalTransform(y,u),a&&f.setFeatureAttribute(y,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(y,JA(r.color,r.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(y,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const v=new VJe(this,y,Qje,n);return c&&(v.alignedSampledElevation=YM.sampledElevation),v.needsElevationUpdates=Ty(n.mode),t3(v,i,this._context.elevationProvider),v}_computeGlobalTransform(e,i,r,n){return xy(e,this._context.elevationProvider,i,this._context.renderCoordsHelper,n),sx[0]=e.x,sx[1]=e.y,sx[2]=n.z,_u(e.spatialReference,sx,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(e,i,r,n){return Vh(n),this._applyObjectRotation(r,!1,n),this._applyObjectRotation(i,!0,n),this._applyObjectScale(e,r,n),this._applyAnchor(e,i,n),n}_applyObjectScale(e,i,r){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const n=this._drivenProperties.size&&i.size?i.size:e.symbolSize,s=oee(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||M5(r,r,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const i=e.diff.diff;this._preparePatchTransform(e,i),this._preparePatchColor(e,i)}updateGeometry(e,i){if(this._resources==null)return!0;const r=i&&i3(i);if(r==null)return!1;const n=this.getGeometryElevationMode(i);return e.elevationContext.mode===n&&(this._computeGlobalTransform(r,e.elevationContext,lU,YM),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=YM.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,lU,!0),t3(e,r,this._context.elevationProvider),!0)}_preparePatchTransform(e,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||this._resources==null)return;const r=(v,b,x)=>(v!=null&&v.type==="complete"?v.newValue:b)??x,n=r(i.heading,this.symbolLayer.heading,0),s=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),u=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const f={heading:n,tilt:s,roll:o,anchor:u,anchorPosition:p},y=this._resources;this.loadStatus===su.LOADED&&e.symbolLayerStatePatches.push(()=>{y.symbolSize=Za(KF(y.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((v,b)=>{const x=this._computeLocalTransform(y,f,b,sie),S=v.instanceIndex;y.lodRenderer.instanceData.setLocalTransform(S,x,!0)})}_preparePatchColor(e,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const n=r.color.newValue,s=n!=null?Lt.toUnitRGBA(n):Sh;delete r.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParams({},n)):l=this._setMaterialTransparencyParams({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,i,r){var n;if(!((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)||!i)return Vje(e.heading,e.tilt,e.roll,r)}_computeAnchor(e,i,r){const n=I();switch(r.anchor){case"center":fe(n,Zd(e)),Ea(n,n);break;case"top":{const s=Zd(e);me(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=Zd(e);me(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=Zd(e),o=pR(e),a=r.anchorPosition,l=a?Ge(a.x,a.y,a.z):tl;r5(n,o,l),xe(n,n,s),Ea(n,n);break}default:i!=null?Ea(n,i):fe(n,tl)}return n}_applyAnchor(e,i,r){var s;if((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,i);n&&Dl(r,r,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,i,r,n){const s=e!=null?Za(pR(e)):ug,o=e!=null?this._computeAnchor(e,n,this.symbolLayer):tl,a=this._context.renderCoordsHelper.unitInMeters,l=oee(i??void 0,i,r,a),c=Ge(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new rO({size:!0,color:!0,rotation:!0,opacity:!1},s,i??ug,a,o,l,c)}};const sx=I(),sie=Ne(),lU=Ne(),XM=gi(),YM=new oO;let yQe=class{constructor(e,i,r,n){this.vertices=e,this.positionsES=i,this.offset=n;const s=e.length,o=Math.floor(s/2),a=this.offset+3*o,l=r[a],c=r[a+1],u=r[a+2];this.origin=Ge(l,c,u),this.positions=mn(3*s);const p=this.offset+3*s;for(let f=this.offset;f<p;f+=3)this.positions[f]=r[f]-l,this.positions[f+1]=r[f+1]-c,this.positions[f+2]=r[f+2]-u;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,i=this.vertices[0];let r=this.offset;const n=this.positions;i.vRight[0]=n[r+3]-n[r],i.vRight[1]=n[r+4]-n[r+1],i.vRight[2]=n[r+5]-n[r+2],r+=3;let s=ze(i.vRight);i.vMinSiblingLength=s,Me(i.vRight,i.vRight);let o=i;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=n[r+3]-n[r],l.vRight[1]=n[r+4]-n[r+1],l.vRight[2]=n[r+5]-n[r+2];const c=ze(l.vRight);l.vMinSiblingLength=Math.min(s,c),s=c,Me(l.vRight,l.vRight)}else fe(l.vRight,l.vLeft),l.vMinSiblingLength=s;o=l,r+=3}}},vQe=class{constructor(e,i,r,n,s,o={}){this.path=e,this.profile=i,this.extruder=r,this.startCap=n,this.endCap=s,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=tUe(1*this.numVerticesTotal),this.profileRightAxes=mn(4*this.numVerticesTotal),this.profileUpAxes=mn(4*this.numVerticesTotal),this.profileVertexAndNormals=mn(4*this.numVerticesTotal),this.positions=OD(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,i,r,n,s){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=i.right[0],this.profileRightAxes[o+1]=i.right[1],this.profileRightAxes[o+2]=i.right[2],this.profileUpAxes[o]=i.up[0],this.profileUpAxes[o+1]=i.up[1],this.profileUpAxes[o+2]=i.up[2],this.profileVertexAndNormals[o]=r[0],this.profileVertexAndNormals[o+1]=r[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,i,r,n,s,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=i.right[0],this.profileRightAxes[a+1]=i.right[1],this.profileRightAxes[a+2]=i.right[2],this.profileRightAxes[a+3]=s,this.profileUpAxes[a]=i.up[0],this.profileUpAxes[a+1]=i.up[1],this.profileUpAxes[a+2]=i.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=r[0],this.profileVertexAndNormals[a+1]=r[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:i,vertices:r}=this.path;this.positions=OD(e,i,3*r.length);let n=0;const s=(a,l,c,u,p)=>this.emitCapVertex(n,a,l,c,u,p),o=(a,l,c,u)=>this.emitVertex(n,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=1;n<r.length-1;++n)this.extruder.extrude(r[n],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(r[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(r[n],s),n=r.length-1,this.endCap.rebuildCapGeometry(r[n],s)}buildTopology(){const e=this.profile.vertices.length,i=this.profile.numSegments,r=this.numExtrusionProfiles-1;let n=3*(2*(i*r));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,u,p)=>{s.push(c),s.push(u),s.push(p),o.push(c),o.push(u),o.push(p),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[p])};for(let c=0;c<i;++c){const u=this.profile.indices[2*c],p=this.profile.indices[2*c+1];for(let f=0;f<r;++f){const y=f*e+u,v=(f+1)*e+p,b=f*e+p;l(y,(f+1)*e+u,v),l(y,v,b)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Uf(s),this.normalIndices=Uf(o),this.pathVertexIndices=Uf(a)}onPathChanged(){this._rebuildGeometry()}},Fq=class{rebuildConnectingProfileGeometry(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],0,0)}},oie=class extends Fq{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},JM=class extends Fq{constructor(e,i=0,r=!1){super(),this.profile=e,this.profilePlaneOffset=i,this.flip=r}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,i,r){const n=this.profilePlaneOffset;for(let s=0;s<i.vertices.length;++s)r(e.frame,i.vertices[s],i.normals[s],n,0)}rebuildCapGeometry(e,i){const r=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,o=fbe;bi(o,0,0);for(let a=0;a<r.vertices.length;++a)i(e.frame,r.vertices[a],o,s,n)}buildTopology(e,i){const r=this.profile,n=this.vertexBufferStart+r.indices[0];for(let s=1;s<r.numSegments;++s){const o=r.indices[2*s],a=r.indices[2*s+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?i(c,l,n):i(n,l,c)}}},aie=class extends Fq{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const i=this.profile;e+=2*i.numSegments*(this.numSegments-1);for(let r=0;r<i.numSegments;++r){const n=i.indices[2*r],s=i.indices[2*r+1];i.poleIndices[n]===i.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,i){const r=this.profile,n=e.frame,s=.5*this.sign,o=bQe,a=fbe;bi(a,0,0);for(const l of r.poles)l.normal?i(n,l.position,l.normal,s,0):i(n,l.position,a,s,this.sign);if(this.breakNormals)for(let l=0;l<r.vertices.length;++l)i(n,r.vertices[l],r.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),p=Math.cos(c);for(let f=0;f<r.vertices.length;++f){const y=r.poles[r.poleIndices[f]];Tf(o,r.vertices[f],y.position),gc(o,o,u),y.normal?(Ud(o,o,y.position),i(n,o,y.normal,s*p,0)):(GP(a,o),gc(a,a,u),Ud(o,o,y.position),i(n,o,a,s*p,this.sign*p))}}}buildTopology(e,i){const r=this.profile,n=this.breakNormals?this.vertexBufferStart+r.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+r.poles.length+r.vertices.length:this.vertexBufferStart+r.poles.length;for(let o=0;o<r.numSegments;++o){const a=r.indices[2*o],l=r.indices[2*o+1],c=this.vertexBufferStart+r.poleIndices[a],u=this.vertexBufferStart+r.poleIndices[l];let p=n+a,f=n+l;for(let y=0;y<this.numSegments-1;++y){const v=s+y*r.vertices.length+a,b=s+y*r.vertices.length+l;this.flip?(i(v,f,p),i(f,v,b)):(i(p,f,v),i(b,v,f)),p=v,f=b}this.flip?(i(c,f,p),c!==u&&i(c,u,f)):(i(p,f,c),c!==u&&i(f,u,c))}}};const bQe=it(),fbe=it();let wQe=class{numProfilesPerJoin(){return 1}extrude(e,i,r){for(let n=0;n<i.vertices.length;++n)r(e.frame,i.vertices[n],i.normals[n],!1)}},cU=class{constructor(e,i){this.cutoffAngle=e,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,i,r){const n=TQe,{rotationAngle:s,rotationRight:o,frame:a}=e;if(Math.abs(s)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Su(cie,.5*-s+c*s/this.numBendSubdivisions,l),xQe(n,a,cie);for(let u=0;u<i.vertices.length;++u)ws(i.vertices[u],o)*s>=0?r(n,i.vertices[u],i.normals[u],!1):r(a,e.applyMiterStretch(lie,i.vertices[u]),i.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<i.vertices.length;++c){const u=ws(i.vertices[c],o)*s>=0;r(a,e.applyMiterStretch(lie,i.vertices[c]),i.normals[c],!u)}}},mbe=class{constructor(){this.up=I(),this.right=I()}};function xQe(t,e,i){st(t.up,e.up,i),st(t.right,e.right,i)}const lie=it(),cie=Ne(),TQe=new mbe;let SQe=class extends fs{constructor(e,i,r,n,s,o,a){super(e,i,r,null,An.Mesh,a),this.path=n,this.geometrySR=s,this.stencilWidth=o}};var zf;function gbe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(zf||(zf={}));let _be=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},ybe=class extends _be{constructor(e){super(e),this.vertexAttributeColor=Kt(255,255,255,255),this.size=new Array,this.vertexAttributePosition=mn(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:i,pathVertexData:r,path:n,positions:s,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<i;++c){let u=r[c];const p=u===0||u===n.vertices.length-1;u*=3;const f=OQe;let y=0,v=0;const b=4*c,x=me(RQe,o[b],o[b+1],o[b+2]),S=me(MQe,a[b],a[b+1],a[b+2]),P=bi(uie,l[b]*e[0],l[b+1]*e[1]);if(p)Rt(f,S,x),y=o[b+3]*e[0],v=a[b+3];else{const $=EQe,k=AQe;bi($,o[b+3],a[b+3]);const B=vH($);GP($,$);const W=ws(P,$);if(Math.abs(W)>B){bi(k,-$[1],$[0]);const Z=ws(P,k);gc($,$,B*Math.sign(W)),gc(k,k,Z),Ud(P,$,k)}me(f,0,0,0)}const C=me(PQe,x[0]*P[0]+S[0]*P[1],x[1]*P[0]+S[1]*P[1],x[2]*P[0]+S[2]*P[1]),R=3*c;this.vertexAttributePosition[R]=s[u]+C[0]+f[0]*y,this.vertexAttributePosition[R+1]=s[u+1]+C[1]+f[1]*y,this.vertexAttributePosition[R+2]=s[u+2]+C[2]+f[2]*y;const N=bi(uie,l[b+2],l[b+3]);Mb(this.vertexAttributeNormal,c,x[0]*N[0]+S[0]*N[1]+f[0]*v,x[1]*N[0]+S[1]*N[1]+f[1]*v,x[2]*N[0]+S[2]*N[1]+f[2]*v)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new vbe([[M.POSITION,new nt(this.vertexAttributePosition,3,!0)],[M.NORMALCOMPRESSED,new nt(this.vertexAttributeNormal,2,!0)],[M.COLOR,new nt(this.vertexAttributeColor,4)]],[[M.POSITION,this.builder.vertexIndices],[M.NORMALCOMPRESSED,this.builder.normalIndices],[M.COLOR,bS(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,i,r){const n=this.builder.vertexIndices,s=new nt(this.vertexAttributePosition,3),o=n.length/3;eO(e,i,0,o,n,s,void 0,void 0,r)}},CQe=class extends _be{constructor(e,i,r,n){super(e),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=n,this.vvData=null,this.baked=new ybe(e),this.vvData=mn(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=i,this.vvData[4*s+1]=r,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){return new vbe([[M.POSITION,new nt(this.builder.positions,3,!0)],[M.PROFILERIGHT,new nt(this.builder.profileRightAxes,4,!0)],[M.PROFILEUP,new nt(this.builder.profileUpAxes,4,!0)],[M.PROFILEVERTEXANDNORMAL,new nt(this.builder.profileVertexAndNormals,4,!0)],[M.FEATUREVALUE,new nt(this.vvData,4,!0)]],[[M.POSITION,this.builder.pathVertexIndices],[M.PROFILERIGHT,this.builder.vertexIndices],[M.PROFILEUP,this.builder.vertexIndices],[M.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[M.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const i=e.getMutableAttribute(M.POSITION);i&&(i.data=this.builder.positions)}},vbe=class{constructor(e,i){this.vertexAttributes=e,this.indices=i}};const uie=it(),EQe=it(),AQe=it(),PQe=I(),OQe=I(),RQe=I(),MQe=I();function $Qe(t,e){let i=null;const r=t.vertices.length,n=.99619469809,s=I(),o=I(),a=I(),l=I(),c=I(),u=I(),p=Yi();let f=t.vertices[0];fe(o,e),me(s,0,1,0),$D(f.vRight,o,s,s,a,o,n),fe(f.frame.up,o),fe(f.frame.right,a);const y=t.positions;let v=t.offset;i=f;for(let b=1;b<r;++b){f=t.vertices[b],xe(c,f.vLeft,f.vRight);let x=ze(c);x>0?(x=1/Math.sqrt(x),c[0]=c[0]*x,c[1]=c[1]*x,c[2]=c[2]*x):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),u[0]=y[v]+i.frame.up[0],u[1]=y[v+1]+i.frame.up[1],u[2]=y[v+2]+i.frame.up[2],v+=3;const S=me(IQe,y[v],y[v+1],y[v+2]);j3(S,c,p),Wb(p,Cu(u,f.vLeft),l)?(l[0]-=y[v],l[1]-=y[v+1],l[2]-=y[v+2],Me(o,l),Rt(a,c,o),Me(a,a)):$D(c,i.frame.up,i.frame.right,s,a,o,n),fe(f.frame.up,o),fe(f.frame.right,a),i=f}}const IQe=I();let bbe=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,i){return this.vertices.push($E(e)),this.normals.push($E(i)),this.vertices.length-1}addPole(e,i=null){return this.poles.push({position:$E(e),normal:i?$E(i):null}),this.poles.length-1}addSegment(e,i=null){this.indices.push(e.v0),this.indices.push(e.v1),i&&(this.poleIndices.push(i.v0),this.poleIndices.push(i.v1))}get numSegments(){return this.indices.length/2}translate(e,i){for(const r of this.vertices)r[0]+=e,r[1]+=i;for(const r of this.poles)r.position[0]+=e,r.position[1]+=i}};const wbe={top:[0,-.5],bottom:[0,.5]};function uU(t){const i=bye,r=new bbe,n={v0:0,v1:0};r.addPole(Ri(0,0));for(let o=0;o<i;++o){const a=2*o*Math.PI/i,l=Math.cos(a),c=Math.sin(a),u=Ri(l*.5,c*.5),p=Ri(l,c);r.addVertex(u,p)}for(let o=0;o<i-1;++o){const a={v0:o,v1:o+1};r.addSegment(a,n)}const s={v0:i-1,v1:0};if(r.addSegment(s,n),t!=="center"){const o=wbe[t];r.translate(o[0],o[1])}return r}const LQe={center:uU("center"),top:uU("top"),bottom:uU("bottom")},DQe={center:hU("center"),top:hU("top"),bottom:hU("bottom")};function hU(t){const r=new bbe,n=Ri(.5*-1,.5*-1),s=Ri(.5*1,.5*-1),o=Ri(.5*1,.5*1),a=Ri(.5*-1,.5*1),l=Ri(0,-1),c=Ri(1,0),u=Ri(0,1),p=Ri(-1,0);if(r.addPole(Ri(0,.5*1),u),r.addPole(Ri(0,.5*1)),r.addPole(Ri(0,.5*-1)),r.addPole(Ri(0,.5*-1),l),r.addVertex(n,l),r.addVertex(s,l),r.addSegment({v0:0,v1:1},{v0:3,v1:3}),r.addVertex(s,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},{v0:2,v1:1}),r.addVertex(o,u),r.addVertex(a,u),r.addSegment({v0:4,v1:5},{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(n,p),r.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=wbe[t];r.translate(f[0],f[1])}return r}function NQe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function FQe(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function xbe(t,e,i,r,n){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t}function kQe(t,e){if(t===e){const i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function UQe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3];let o=i*s-n*r;return o?(o=1/o,t[0]=s*o,t[1]=-r*o,t[2]=-n*o,t[3]=i*o,t):null}function zQe(t,e){const i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t}function BQe(t){return t[0]*t[3]-t[2]*t[1]}function Tbe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1],c=i[2],u=i[3];return t[0]=r*a+s*l,t[1]=n*a+o*l,t[2]=r*c+s*u,t[3]=n*c+o*u,t}function VQe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(i),l=Math.cos(i);return t[0]=r*l+s*a,t[1]=n*l+o*a,t[2]=r*-a+s*l,t[3]=n*-a+o*l,t}function GQe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=i[0],l=i[1];return t[0]=r*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function jQe(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t}function HQe(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function WQe(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function qQe(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function ZQe(t,e,i,r){return t[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-t[2]*i[1],[t,e,i]}function XQe(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t}function Sbe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function YQe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function JQe(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=ol();return Math.abs(i-o)<=u*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=u*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}function KQe(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function QQe(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t}const eet=Tbe,tet=Sbe;Object.freeze(Object.defineProperty({__proto__:null,LDU:ZQe,add:XQe,adjoint:zQe,copy:NQe,determinant:BQe,equals:JQe,exactEquals:YQe,frob:qQe,fromRotation:jQe,fromScaling:HQe,identity:FQe,invert:UQe,mul:eet,multiply:Tbe,multiplyScalar:KQe,multiplyScalarAndAdd:QQe,rotate:VQe,scale:GQe,set:xbe,str:WQe,sub:tet,subtract:Sbe,transpose:kQe},Symbol.toStringTag,{value:"Module"}));function Cbe(){return[1,0,0,1]}function iet(t){return[t[0],t[1],t[2],t[3]]}function ret(t,e,i,r){return[t,e,i,r]}function net(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:iet,create:Cbe,createView:net,fromValues:ret},Symbol.toStringTag,{value:"Module"}));let Ebe=class{constructor(){this.vLeft=I(),this.vRight=I(),this.vMinSiblingLength=0,this.frame=new mbe}setFrameFromUpVector(e){fe(this.frame.up,e),xe(zC,this.vLeft,this.vRight),Me(zC,zC),pe(pie,this.frame.up,Re(zC,this.frame.up)),Ce(KM,zC,pie),Me(KM,KM),Rt(this.frame.right,KM,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},set=class extends Ebe{get rotationFrameUp(){return this.frame.up}get rotationRight(){return zde}get rotationAngle(){return pe(P0,this.frame.up,Re(this.frame.up,this.vLeft)),Ce(P0,this.vLeft,P0),Ea(P0,P0),Me(P0,P0),pe(ax,this.frame.up,Re(this.frame.up,this.vRight)),Ce(ax,this.vRight,ax),Me(ax,ax),Rt(pN,this.rotationFrameUp,this.vLeft),Math.sign(Re(pN,this.vRight))*(Math.PI-qs(Re(P0,ax)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)<=0)return i;const n=$8(Math.cos(.5*r));return bi(e,(n-1+1)*i[0],i[1])}},oet=class extends Ebe{get rotationFrameUp(){const e=Math.sign(Re(this.frame.right,this.vRight));return Rt(UC,this.vRight,this.vLeft),pe(UC,UC,e),Me(UC,UC)}get rotationRight(){const e=this.rotationFrameUp,i=Re(e,this.frame.up),r=Re(e,this.frame.right);return pe(ox,this.frame.up,-r),pe(die,this.frame.right,i),xe(ox,ox,die),Me(ox,ox),aet(hie,this.frame,ox),hie}get rotationAngle(){const e=Math.sign(Re(this.frame.right,this.vRight));return Ea(pN,this.vLeft),-e*(Math.PI-qs(Re(pN,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*$8(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,i){const r=this.rotationAngle;if(Math.abs(r)===0)return i;const n=$8(Math.cos(.5*r)),s=this.rotationRight,o=xbe(uet,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return Lfe(e,i,o)}};function aet(t,e,i){bi(t,Re(i,e.right),Re(i,e.up))}function cet(t){switch(t){case zf.World:return new set;case zf.Path:return new oet}}const UC=I(),hie=it(),ox=I(),die=I(),pN=I(),P0=I(),ax=I(),pie=I(),zC=I(),KM=I(),uet=Cbe(),dU=8;function het(t,e){const i=M.FEATUREVALUE;t.attributes.add(i,"vec4");const r=t.vertex;r.code.add(T`
  bool isCapVertex() {
    return ${i}.w == 1.0;
  }
  `),r.uniforms.add(new Bi("size",n=>n.size)),e.vvSize?(r.uniforms.add(new ei("vvSizeMinSize",n=>n.vvSize.minSize),new ei("vvSizeMaxSize",n=>n.vvSize.maxSize),new ei("vvSizeOffset",n=>n.vvSize.offset),new ei("vvSizeFactor",n=>n.vvSize.factor)),r.code.add(T`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${i}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.code.add(T`vec2 getSize(){
return size;
}`),e.vvOpacity?(r.constants.add("vvOpacityNumber","int",dU),r.uniforms.add(new Ol("vvOpacityValues",n=>n.vvOpacity.values,dU),new Ol("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,dU)),r.code.add(T`
    vec4 applyOpacity(vec4 color) {
      float value = ${i}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):r.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(r.constants.add("vvColorNumber","int",J2),r.uniforms.add(new Ol("vvColorValues",n=>n.vvColor.values,J2),new E_e("vvColorColors",n=>n.vvColor.colors,J2)),r.code.add(T`
    vec4 getColor() {
      float value = ${i}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):r.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(q3),t.attributes.add(M.PROFILERIGHT,"vec4"),t.attributes.add(M.PROFILEUP,"vec4"),t.attributes.add(M.PROFILEVERTEXANDNORMAL,"vec4"),r.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),r.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),r.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),r.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let det=class extends nO{constructor(){super(...arguments),this.size=Ri(1,1)}};function pet(t){const e=new Fi,{vertex:i,fragment:r}=e;switch(Tc(i,t),e.varyings.add("vpos","vec3"),e.include(het,t),t.output!==j.Color&&t.output!==j.Alpha||(e.include(Ml,t),e.include(Rb,t),e.include(vS,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===j.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Au,t),t.output){case j.Alpha:e.include(Nn,t),r.uniforms.add(new je("opacity",n=>n.opacity)),r.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case j.Color:e.include(Nn,t),e.include($b,t),e.include(hO,t),e.include(Rb,t),e.include(Qve,t),gp(r,t),dO(r),PS(r),r.uniforms.add(i.uniforms.get("localOrigin"),new ei("ambient",n=>n.ambient),new ei("diffuse",n=>n.diffuse),new ei("specular",n=>n.specular),new je("opacity",n=>n.opacity)),r.include(am),om(r),r.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===At.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case j.Depth:case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:e.include(Ml,t),Tb(e),e.varyings.add("depth","float"),i.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(Nn,t),e.include(Ug,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case j.Normal:e.include(Ml,t),e.include(s3,t),UT(i),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Nn,t),r.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case j.Highlight:e.include(Ml,t),e.include(s3,t),e.varyings.add("vnormal","vec3"),i.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(Nn,t),e.include(Kg,t),r.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const fet=Object.freeze(Object.defineProperty({__proto__:null,build:pet},Symbol.toStringTag,{value:"Module"})),Abe=new Map([[M.POSITION,0],[M.PROFILERIGHT,1],[M.PROFILEUP,2],[M.PROFILEVERTEXANDNORMAL,3],[M.FEATUREVALUE,4]]);let met=class extends det{constructor(){super(...arguments),this.ambient=Ge(.2,.2,.2),this.diffuse=Ge(.8,.8,.8),this.specular=Ge(0,0,0),this.opacity=1,this.origin=I(),this.modelTransformation=null}},Pbe=class Obe extends qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ke.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gi(e.rctx,Obe.shader.get().build(this.configuration),Abe)}initializePipeline(){const e=this.configuration.transparencyPassType,i=this.configuration,r=e===At.NONE,n=e===At.FrontFace;return Zt({blending:i.output!==j.Color&&i.output!==j.Alpha||!i.transparent?null:r?vu:Qg(e),culling:i.hasSlicePlane&&!i.transparent&&i.doubleSidedMode!==gn.None?jfe:null,depthTest:{func:Dy(e)},depthWrite:r||n?Nl:null,colorWrite:ni,stencilWrite:i.hasOccludees?Jf:null,stencilTest:i.hasOccludees?Ny:null,polygonOffset:r||n?null:P4})}};Pbe.shader=new Vi(fet,()=>Oe(()=>import("./Path.glsl-4d30fadf.js"),[],import.meta.url));let Qs=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.doubleSidedMode=gn.None,this.transparencyPassType=At.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};d([q({count:j.COUNT})],Qs.prototype,"output",void 0),d([q({count:gn.COUNT})],Qs.prototype,"doubleSidedMode",void 0),d([q({count:At.COUNT})],Qs.prototype,"transparencyPassType",void 0),d([q()],Qs.prototype,"spherical",void 0),d([q()],Qs.prototype,"receiveShadows",void 0),d([q()],Qs.prototype,"receiveAmbientOcclusion",void 0),d([q()],Qs.prototype,"vvSize",void 0),d([q()],Qs.prototype,"vvColor",void 0),d([q()],Qs.prototype,"vvOpacity",void 0),d([q()],Qs.prototype,"hasSlicePlane",void 0),d([q()],Qs.prototype,"transparent",void 0),d([q()],Qs.prototype,"hasOccludees",void 0),d([q()],Qs.prototype,"hasMultipassTerrain",void 0),d([q()],Qs.prototype,"cullAboveGround",void 0),d([q()],Qs.prototype,"doublePrecisionRequiresObfuscation",void 0),d([q({constValue:Ct.Disabled})],Qs.prototype,"pbrMode",void 0),d([q({constValue:!0})],Qs.prototype,"hasVvInstancing",void 0),d([q({constValue:!1})],Qs.prototype,"useCustomDTRExponentForWater",void 0),d([q({constValue:!1})],Qs.prototype,"useFillLights",void 0);let get=class Rbe extends Ly{constructor(e){super(e,new yet),this.supportsEdges=!0,this._vertexAttributeLocations=Abe,this._configuration=new Qs,this._vertexBufferLayout=Rbe.getVertexBufferLayout()}getConfiguration(e,i){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==j.Color&&e!==j.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?gn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?gn.WindingOrder:gn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==j.Shadow&&e!==j.ShadowExcludeHighlight&&e!==j.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,i,r,n,s,o){const a=e;if(!gbe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:x,factor:S,minSize:P,maxSize:C}=this.parameters.vvSize,R=l.sizeAttributeValue;c[0]*=$e(x[0]+R*S[0],P[0],C[0]),c[1]*=$e(x[2]+R*S[2],P[2],C[2])}const u=Math.max(c[0],c[1]),p=e.boundingInfo;if(p==null)return void this._intersectTriangles(l,c,n,s,o);const f=ub(p.bbMin[0]-u,p.bbMin[1]-u,p.bbMin[2]-u,p.bbMax[0]+u,p.bbMax[1]+u,p.bbMax[2]+u),y=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],v=Math.sqrt(y[0]*y[0]+y[1]*y[1]+y[2]*y[2]),b=[v/y[0],v/y[1],v/y[2]];MW(f,n,b,r.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,i,r,n,s){e.baked.size&&e.baked.size[0]===i[0]&&e.baked.size[1]===i[1]||e.baked.bake(i),e.baked.intersect(r,n,s)}createBufferWriter(){return new AS(this._vertexBufferLayout)}requiresSlot(e,i){switch(i){case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case j.Color:case j.Alpha:case j.Depth:case j.Normal:case j.Highlight:case j.ObjectAndLayerIdColor:return e===(this.parameters.transparent?Te.TRANSPARENT_MATERIAL:Te.OPAQUE_MATERIAL)||e===Te.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new _et(e)}static getVertexBufferLayout(){return ln().vec3f(M.POSITION).vec4f(M.PROFILERIGHT).vec4f(M.PROFILEUP).vec4f(M.PROFILEVERTEXANDNORMAL).vec4f(M.FEATUREVALUE)}},_et=class extends $y{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==j.Color&&this._output!==j.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(Pbe,e)}},yet=class extends met{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const vet=["polyline"];let bet=class extends cm{constructor(e,i,r,n){super(e,i,r,n),this._intrinsicSize=Ri(1,1),this._upVectorAlignment=zf.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){var f,y,v,b;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,i=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new rO({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,i],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((y=(f=this._context.renderer)==null?void 0:f.visualVariables)==null?void 0:y.length)>0?VT(this._context.renderer,this._vvConvertOptions):null;const r=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?zf.World:zf.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=LQe[r];break;case"quad":this._profile=DQe[r]}switch(this.symbolLayer.join){case"round":this._extruder=new cU(0,vye);break;case"bevel":this._extruder=new cU(0,1);break;case"miter":this._extruder=new cU(.8*Math.PI,1);break;default:this._extruder=new wQe}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new oie,this._endCap=new oie;break;case"butt":default:this._startCap=new JM(this._profile,0),this._endCap=new JM(this._profile,0,!0);break;case"square":this._startCap=new JM(this._profile,-.5),this._endCap=new JM(this._profile,.5,!0);break;case"round":{const x=n==="quad";this._startCap=new aie({profile:this._profile,flip:!1,breakNormals:x,subdivisions:z7}),this._endCap=new aie({profile:this._profile,flip:!0,breakNormals:x,subdivisions:z7});break}}const o=(b=(v=this.symbolLayer)==null?void 0:v.material)==null?void 0:b.color,a=this._getCombinedOpacityAndColor(o),l=Za(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,p={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||s==="none"?Fr.None:Fr.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(bi(this._intrinsicSize,e,i),!U7(this._intrinsicSize[0])||!U7(this._intrinsicSize[1])))throw new ce("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||gc(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const x={...p,...this._fastUpdates.materialParameters,size:Lde(this._intrinsicSize)};this._material=new get(x)}else p.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,p.normalType=Wi.Compressed,this._material=new Kf(p);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,vet,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new wp),n=e.renderingInfo;return this._createAs3DShape(i,n,r,i.uid)}layerOpacityChanged(){var n,s;const e=(s=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:s.color,i=this._getCombinedOpacity(e),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:i,transparent:r})}layerElevationInfoChanged(e,i){return this.updateGraphics3DGraphicElevationInfo(e,i,Ty)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!GT(this._fastUpdates,i,this._vvConvertOptions))return Jn.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Jn.FastUpdate}_getVertexData(e){let i=0;const r=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const p of r)i+=p.length;const l=ia(3*i);let c,u=0;for(const p of r){n.push({offset:u,numVertices:p.length});for(const f of p)l[u++]=f[0],l[u++]=f[1],l[u++]=e.hasZ?f[2]:0}return o==null||s.equals(o)||_n(l,s,0,l,o,0,i)?(o==null||o.equals(a)?c=oge(l):(c=ia(3*i),_n(l,o,0,c,a,0,i)),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,i,r,n){var v,b,x;const s=e.geometry,o=this._getVertexData(s);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(S=>S.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=s.spatialReference,c=$s(),u=this._context.renderCoordsHelper,p=new wW(o.vertexDataES);for(const S of o.pathVertexDataInfos){const P=S.numVertices;if(P<2)continue;const C=S.offset;if(this._context.clippingExtent!=null&&(Gr(c),du(c,o.vertexDataES,C,P),!Xd(c,this._context.clippingExtent)))continue;const R=new Array,N=C+3*P;for(let ae=C;ae<N;ae+=3){p.offset=ae;const re=Gje(p,this._context.elevationProvider,r,u);me(Ln,o.vertexDataRS[ae],o.vertexDataRS[ae+1],o.vertexDataRS[ae+2]),u.setAltitude(Ln,re),o.vertexDataRS[ae]=Ln[0],o.vertexDataRS[ae+1]=Ln[1],o.vertexDataRS[ae+2]=Ln[2],R.push(cet(this._upVectorAlignment))}const $=new yQe(R,o.vertexDataES,o.vertexDataRS,C);Mbe($,this._upVectorAlignment,this._context.renderCoordsHelper);const k=new vQe($,this._profile,this._extruder,this._startCap,this._endCap);let B=null;if(this._fastUpdates){const ae=this._fastUpdates.visualVariables,re=op((v=ae.size)==null?void 0:v.field,e)??0,ee=op((b=ae.color)==null?void 0:b.field,e)??0,oe=op((x=ae.opacity)==null?void 0:x.field,e)??0;B=new CQe(k,re,ee,oe)}else{const ae=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const oe=i.size;ae[0]*=fie(oe[0],oe[2]==="symbol-value"?this.symbolLayer.height||0:oe[2],this.symbolLayer.width||0),ae[1]*=fie(oe[2],oe[0]==="symbol-value"?this.symbolLayer.width||0:oe[0],this.symbolLayer.height||0)}let re;this._drivenProperties.color&&(re=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(re=re?[re[0],re[1],re[2],i.opacity]:[1,1,1,i.opacity]);const ee=new ybe(k);ee.bake(ae),re&&ee.bakeVertexColors(re),B=ee}const{vertexAttributes:W,indices:Z}=B.createGeometryData(),K=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),X=new SQe(this._material,W,Z,B,l,this._stencilWidth,K);X.transformation=Dl(Ne(),Os,k.path.origin),a.push(X)}if(a.length===0)return null;const f=new e0({geometries:a,layerUid:this._context.layer.uid,graphicUid:n}),y=new lm(this,f,a,null,null,(S,P,C,R,N)=>xet(S,P,R,N,this._upVectorAlignment),r);return y.alignedSampledElevation=0,y.needsElevationUpdates=Ty(r.mode),y}};function Mbe(t,e,i){const{origin:r,positions:n}=t;let s=t.offset;switch(e){default:case zf.World:for(const o of t.vertices)Ln[0]=n[s++]+r[0],Ln[1]=n[s++]+r[1],Ln[2]=n[s++]+r[2],i.worldUpAtPosition(Ln,Ln),o.setFrameFromUpVector(Ln);break;case zf.Path:Ln[0]=n[s]+r[0],Ln[1]=n[s+1]+r[1],Ln[2]=n[s+2]+r[2],i.worldUpAtPosition(Ln,Ln),$Qe(t,Ln)}}function fie(t,e,i){switch(t){case"symbol-value":return i;case"proportional":return e;default:return t}}function wet(t,e,i,r){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)me(Ln,l[u],l[u+1],l[u+2]),i(Ln,pU),n+=pU.sampledElevation,Ln[0]=a[u]+s[0],Ln[1]=a[u+1]+s[1],Ln[2]=a[u+2]+s[2],r.setAltitude(Ln,pU.z),a[u]=Ln[0]-s[0],a[u+1]=Ln[1]-s[1],a[u+2]=Ln[2]-s[2];return t.updatePathVertexInformation(),n/o.length}function xet(t,e,i,r,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!gbe(l))continue;const c=l.path,u=c.builder.path;a+=wet(u,e,i,r),n!==zf.World&&Mbe(u,n,r),c.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(l)}return a/o.length}const Ln=I(),pU=new oO;function Tet(t,e,i,r,n=1){if(i.isGeographic&&r===Ke.Global){const c=ia(e.length),u=e.length,p=lr(i);for(let f=0;f<u;f+=3)F5(e,f,c,f,p);e=c}bi(Ts,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)Ts[0]=Math.min(Ts[0],e[c]),Ts[1]=Math.min(Ts[1],e[c+1]);const s=Ts[0]%n,o=Ts[1]%n,a=Ts[0]-s,l=Ts[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/n,t[u+1]=(e[c+1]-l)/n,t[u+2]=a/n,t[u+3]=l/n}}function $be(t,e,i,r,n=1){me(gv,1,0,0),me(_v,0,1,0),me(cx,0,0,1),Aet(fU,i),Cet(i,mie)&&Eet(mie,gv,_v,cx,r,fU),bi(Ts,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),bi(yv,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<i.length;u+=3){me(lx,i[u],i[u+1],i[u+2]);const p=Re(gv,lx),f=Re(_v,lx);Ts[0]=Math.min(Ts[0],p),Ts[1]=Math.min(Ts[1],f),yv[0]=Math.max(yv[0],p),yv[1]=Math.max(yv[1],f)}const s=Re(cx,fU);gU(O0,Ts[0],Ts[1],s,gv,_v,cx),gU(vv,yv[0],Ts[1],s,gv,_v,cx),gU(bv,Ts[0],yv[1],s,gv,_v,cx),Ce(vv,vv,O0),pe(vv,vv,.5),Ce(bv,bv,O0),pe(bv,bv,.5),xe(O0,O0,vv),xe(O0,O0,bv);const o=Ts[0]%n,a=Ts[1]%n,l=Ts[0]-o,c=Ts[1]-a;for(let u=0;u<i.length;u+=3){me(lx,i[u],i[u+1],i[u+2]);const p=u/3,f=4*p;t[f]=(Re(gv,lx)-l)/n,t[f+1]=(Re(_v,lx)-c)/n,t[f+2]=l/n,t[f+3]=c/n;const y=9*p;for(let v=0;v<3;v++)e[y+v]=O0[v],e[y+v+3]=vv[v],e[y+v+6]=bv[v]}}const fU=I(),lx=I(),mie=Yi(),gv=I(),_v=I(),cx=I(),Ts=it(),yv=it(),O0=I(),vv=I(),bv=I();function Cet(t,e){const i=t.length/3-1;return ape(t,e,0,Math.floor(i/3),Math.floor(i*(2/3)))}function Eet(t,e,i,r,n,s){n!=null?(n.basisMatrixAtPosition(s,Vp),me(QM,Vp[0],Vp[1],Vp[2]),me(e$,Vp[4],Vp[5],Vp[6]),me(mU,Vp[8],Vp[9],Vp[10])):(me(QM,1,0,0),me(e$,0,1,0),me(mU,0,0,1));const o=t;Re(o,mU)<0&&pe(o,o,-1),fe(r,o);const a=Re(o,e$),l=Re(o,QM);Math.abs(a)<Math.abs(l)?(P1(e,QM,o,-l),Me(e,e),Rt(i,e,o),Me(i,i),pe(i,i,-1)):(P1(i,e$,o,-a),Me(i,i),Rt(e,i,o),Me(e,e))}const Vp=Ne(),QM=I(),e$=I(),mU=I();function Aet(t,e){me(BC,0,0,0);for(let i=0;i<e.length-3;i+=3)BC[0]+=e[i],BC[1]+=e[i+1],BC[2]+=e[i+2];pe(t,BC,1/(e.length/3-1))}const BC=I();function gU(t,e,i,r,n,s,o){me(t,e*n[0]+i*s[0]+r*o[0],e*n[1]+i*s[1]+r*o[1],e*n[2]+i*s[2]+r*o[2])}function Pet(t){const e=new Fi,{vertex:i,fragment:r,attributes:n,varyings:s}=e;Tc(i,t),e.include(Ml,t),e.include(ew,t),e.include(bg,t),e.include(iO,t),n.add(M.POSITION,"vec3"),t.vvColor&&n.add(M.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===j.Color||t.output===j.Alpha);o&&s.add("depth","float"),i.uniforms.add(new yi("eColor",c=>c.color));const a=t.output===j.Depth;a&&(e.include(Ug,t),Tb(e),gy(e)),i.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Nn,t),o&&e.include(Au,t),r.include(am);const l=t.output===j.Highlight;return l&&e.include(Kg,t),r.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===j.ObjectAndLayerIdColor?T`fColor.a = 1.0;`:""}

    if (fColor.a < ${T.float(Mo)}) {
      discard;
    }

    ${t.output===j.Alpha?T`fragColor = vec4(fColor.a);`:""}

    ${t.output===j.Color?T`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===At.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?T`outputHighlight();`:""};
    ${t.output===j.Depth?T`outputDepth(linearDepth);`:""};
    ${t.output===j.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const Oet=Object.freeze(Object.defineProperty({__proto__:null,build:Pet},Symbol.toStringTag,{value:"Module"}));let Ibe=class Lbe extends qi{initializeProgram(e){return new Gi(e.rctx,Lbe.shader.get().build(this.configuration),Ni)}_createPipeline(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Zt({blending:r.output!==j.Color&&r.output!==j.Alpha||!r.transparent?null:n?vu:Qg(e),culling:e4(r.cullFace),depthTest:{func:Dy(e)},depthWrite:(n||s)&&r.writeDepth?Nl:null,colorWrite:ni,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?Ey:Ny:null,polygonOffset:n||s?r.polygonOffset?Ret:null:O4(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};Ibe.shader=new Vi(Oet,()=>Oe(()=>import("./ColorMaterial.glsl-c3dccd84.js"),[],import.meta.url));const Ret={factor:1,units:1};let Go=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.cullFace=Fr.None,this.transparencyPassType=At.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};d([q({count:j.COUNT})],Go.prototype,"output",void 0),d([q({count:Fr.COUNT})],Go.prototype,"cullFace",void 0),d([q({count:At.COUNT})],Go.prototype,"transparencyPassType",void 0),d([q()],Go.prototype,"hasSlicePlane",void 0),d([q()],Go.prototype,"hasVertexColors",void 0),d([q()],Go.prototype,"transparent",void 0),d([q()],Go.prototype,"polygonOffset",void 0),d([q()],Go.prototype,"enableOffset",void 0),d([q()],Go.prototype,"writeDepth",void 0),d([q()],Go.prototype,"hasOccludees",void 0),d([q()],Go.prototype,"hasMultipassTerrain",void 0),d([q()],Go.prototype,"cullAboveGround",void 0),d([q()],Go.prototype,"objectAndLayerIdColorInstanced",void 0),d([q()],Go.prototype,"vvColor",void 0),d([q({constValue:!0})],Go.prototype,"hasVvInstancing",void 0),d([q({constValue:!1})],Go.prototype,"vvSize",void 0),d([q({constValue:!1})],Go.prototype,"vvOpacity",void 0);let gie=class extends pq{constructor(e){super(e,new $et),this.supportsEdges=!0,this._configuration=new Go}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<A4,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,i){return i===j.Color||i===j.Alpha||i===j.Highlight||i===j.Depth&&this.parameters.writeLinearDepth||i===j.ObjectAndLayerIdColor?e===Te.DRAPED_MATERIAL?!0:i===j.Highlight?e===Te.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Te.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new Met(e)}createBufferWriter(){const e=ln().vec3f(M.POSITION);return ge("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(M.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(M.COLORFEATUREATTRIBUTE):e.vec4u8(M.COLOR),new AS(e)}},Met=class extends $y{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==j.Color&&this._output!==j.Alpha||this._updateOccludeeState(e),this.ensureTechnique(Ibe,e)}},$et=class extends nO{constructor(){super(...arguments),this.color=Df,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Fr.None,this.hasOccludees=!1}};var Ro;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Ro||(Ro={}));const oV=.70710678118,_ie=oV,Iet=.08715574274;function Let(t){const e=new Fi,i=t.hasMultipassTerrain&&(t.output===j.Color||t.output===j.Alpha),{vertex:r,fragment:n,attributes:s,varyings:o}=e;Tc(r,t),e.include(Ml,t),e.include(ew,t),e.include(bg,t),t.draped?r.uniforms.add(new je("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):s.add(M.BOUNDINGRECT,"mat3"),s.add(M.POSITION,"vec3"),s.add(M.UVMAPSPACE,"vec4"),t.vvColor&&s.add(M.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),i&&o.add("depth","float"),r.uniforms.add(new yi("uColor",c=>c.color));const a=t.style===Ro.ForwardDiagonal||t.style===Ro.BackwardDiagonal||t.style===Ro.DiagonalCross;a&&r.code.add(T`
      const mat2 rotate45 = mat2(${T.float(oV)}, ${T.float(-_ie)},
                                 ${T.float(_ie)}, ${T.float(oV)});
    `),t.draped||(gp(r,t),r.uniforms.add(new je("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),r.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),r.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),r.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(Iet)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),r.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===j.Depth;return l&&(e.include(Ug,t),Tb(e),gy(e)),r.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(Nn,t),n.include(am),t.draped&&n.uniforms.add(new je("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===j.Highlight&&e.include(Kg,t),i&&e.include(Au,t),t.output!==j.Highlight&&(n.code.add(T`
      const float lineWidth = ${T.float(t.lineWidth)};
      const float spacing = ${T.float(t.patternSpacing)};
      const float spacingINV = ${T.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(T`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==j.Highlight?T`color.a *= ${Det(t)};`:""}

      ${t.output===j.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

      if (color.a < ${T.float(Mo)}) {
        discard;
      }

      ${t.output===j.Alpha?T`fragColor = vec4(color.a);`:""}

      ${t.output===j.Color?T`fragColor = color; ${t.transparencyPassType===At.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===j.Highlight?T`outputHighlight();`:""}
      ${t.output===j.Depth?T`outputDepth(linearDepth);`:""};
    }
  `),e}function Det(t){function e(i){return t.draped?T`coverage(vuv.${i}, texelSize)`:T`sampleAA(vuv.${i})`}switch(t.style){case Ro.ForwardDiagonal:case Ro.Horizontal:return e("y");case Ro.BackwardDiagonal:case Ro.Vertical:return e("x");case Ro.DiagonalCross:case Ro.Cross:return T`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const Net=Object.freeze(Object.defineProperty({__proto__:null,build:Let},Symbol.toStringTag,{value:"Module"}));let Dbe=class Nbe extends qi{initializeProgram(e){return new Gi(e.rctx,Nbe.shader.get().build(this.configuration),Fbe)}_setPipelineState(e,i){const r=this.configuration,n=e===At.NONE,s=e===At.FrontFace;return Zt({blending:r.output===j.Color||r.output===j.Alpha?n?vu:Qg(e):null,culling:e4(r.cullFace),depthTest:{func:Dy(e)},depthWrite:n?r.writeDepth?Nl:null:E4(e),colorWrite:ni,stencilWrite:r.hasOccludees?Jf:null,stencilTest:r.hasOccludees?i?Ey:Ny:null,polygonOffset:n||s?r.polygonOffset?Fet:null:O4(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,i){return i?this._occludeePipelineState:super.getPipelineState(e,i)}};Dbe.shader=new Vi(Net,()=>Oe(()=>import("./Pattern.glsl-cb1299a1.js"),[],import.meta.url));const Fet={factor:1,units:1};let eo=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.cullFace=Fr.None,this.transparencyPassType=At.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};d([q({count:j.COUNT})],eo.prototype,"output",void 0),d([q({count:Fr.COUNT})],eo.prototype,"cullFace",void 0),d([q({count:Ro.COUNT})],eo.prototype,"style",void 0),d([q({count:At.COUNT})],eo.prototype,"transparencyPassType",void 0),d([q()],eo.prototype,"hasSlicePlane",void 0),d([q()],eo.prototype,"hasVertexColors",void 0),d([q()],eo.prototype,"polygonOffset",void 0),d([q()],eo.prototype,"writeDepth",void 0),d([q()],eo.prototype,"hasOccludees",void 0),d([q()],eo.prototype,"patternSpacing",void 0),d([q()],eo.prototype,"lineWidth",void 0),d([q()],eo.prototype,"enableOffset",void 0),d([q()],eo.prototype,"draped",void 0),d([q()],eo.prototype,"hasMultipassTerrain",void 0),d([q()],eo.prototype,"cullAboveGround",void 0),d([q()],eo.prototype,"vvColor",void 0),d([q({constValue:!1})],eo.prototype,"hasVvInstancing",void 0),d([q({constValue:!1})],eo.prototype,"vvSize",void 0),d([q({constValue:!1})],eo.prototype,"vvOpacity",void 0);const Fbe=new Map([[M.POSITION,0],[M.COLOR,3],[M.UVMAPSPACE,4],[M.COLORFEATUREATTRIBUTE,5],[M.BOUNDINGRECT,6]]);let kq=class extends pq{constructor(e){super(e,new zet),this.supportsEdges=!0,this._vertexAttributeLocations=Fbe,this._configuration=new eo}getConfiguration(e,i){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<A4,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,i){return i===j.Color||i===j.Alpha||i===j.Highlight||i===j.Depth&&this.parameters.writeLinearDepth?e===Te.DRAPED_MATERIAL?!0:i===j.Highlight?e===Te.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?Te.TRANSPARENT_MATERIAL:Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new ket(e)}createBufferWriter(){const e=ln().vec3f(M.POSITION).vec4f(M.UVMAPSPACE);return this.parameters.draped||e.mat3f(M.BOUNDINGRECT),this.parameters.vvColor?e.f32(M.COLORFEATUREATTRIBUTE):e.vec4u8(M.COLOR),new Uet(e)}},ket=class extends $y{_updateParameters(e){return this.ensureTechnique(Dbe,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==j.Color&&this._output!==j.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Uet=class extends AS{write(e,i,r,n,s){for(const o of this.vertexBufferLayout.fields.keys()){const a=r.vertexAttributes.get(o),l=r.indices.get(o);if(a&&l)switch(o){case M.UVMAPSPACE:{xt(a.size===4);const c=n.getField(o,mp);c&&zT(l,a.data,c,s);break}case M.BOUNDINGRECT:{xt(a.size===9);const c=n.getField(o,_y);c&&this.writeBoundingRect(l,a.data,e,c,s);break}default:l_e(o,a,l,e,i,n,s)}}}writeBoundingRect(e,i,r,n,s){const o=r,a=n.typedBuffer,l=n.typedBufferStride,c=e.length;s*=l;for(let u=0;u<c;++u){const p=9*e[u],f=i[p],y=i[p+1],v=i[p+2];a[s]=o[0]*f+o[4]*y+o[8]*v+o[12],a[s+1]=o[1]*f+o[5]*y+o[9]*v+o[13],a[s+2]=o[2]*f+o[6]*y+o[10]*v+o[14];for(let b=3;b<9;++b)a[s+b]=i[p+b];s+=l}}},zet=class extends nO{constructor(){super(...arguments),this.color=Kt(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Fr.None,this.hasOccludees=!1,this.style=Ro.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function Bet(t,e){const i=(t==null?void 0:t.pattern)??null;return i==null?new gie(e):i.style==="none"||i.style==="solid"?(i.style==="none"&&(e.color=Kt(0,0,0,0),e.transparent=!0),new gie(e)):(e.style=Vet(i.style),new kq(e))}function Vet(t){switch(t){case"horizontal":return Ro.Horizontal;case"vertical":return Ro.Vertical;case"cross":return Ro.Cross;case"forward-diagonal":return Ro.ForwardDiagonal;case"backward-diagonal":return Ro.BackwardDiagonal;case"diagonal-cross":return Ro.DiagonalCross;default:return}}function Get(t){return t.material instanceof kq&&!t.material.parameters.draped}function jet(t,e){if(Get(t)){const i=t.vertexAttributes.get(M.POSITION).data,r=t.getMutableAttribute(M.UVMAPSPACE).data,n=t.getMutableAttribute(M.BOUNDINGRECT).data;$be(r,n,i,e)}}function Het(t,e,i,r,n){const s=hye(t,e,i,r,n),o=t.stageObject.geometries;for(const a of o)jet(a,n);return s}const Wet=["polyline","polygon","extent"],yie=new rO({size:!1,color:!0,rotation:!1,opacity:!1});let kbe=class Ube extends cm{constructor(e,i,r,n){super(e,i,r,n),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=VT(this._context.renderer,yie)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){var r,n,s;if(this._material!=null)return;const e=(n=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:n.color,i=this._getCombinedOpacityAndColor(e);this._material=Bet(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(s=this._fastUpdates)==null?void 0:s.materialParameters}),this._needsUV=this._material instanceof kq,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const i=r=>{const n=k1e(e.pattern);return new O2({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,stippleScaleWithLineWidth:!0,cap:tV(e.patternCap||"butt")})};this._outlineMaterial=i(Sa(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,Wet,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(i,new wp);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,n)}applyRendererDiff(e,i){for(const r in e.diff){if(r!=="visualVariables"||!GT(this._fastUpdates,i,yie))return Jn.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return Jn.FastUpdate}layerOpacityChanged(){var e,i;if(this._material!=null){const r=this._material.parameters.color,n=(i=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:i.color,s=this._getCombinedOpacity(n);this._material.setParameters({color:[r[0],r[1],r[2],s],transparent:s<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const r=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[r[0],r[1],r[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=sO(Ube.elevationModeChangeTypes,r,n);if(s!==Pn.UPDATE)return s;const o=Zh(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var u;const n=n3(e.geometry);if(!n)return null;const s=xq(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=new qet(s,i,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=mn(4*a,!0),o.boundingRect=ia(9*a,!0),$be(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new e0({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new lm(this,l,o.outGeometries,null,null,Het,r);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=Zh(r.mode),c}_createAs3DShapeFill(e,i){var n;const r=i.renderData.polygons;for(const{position:s,mapPositions:o,holeIndices:a,index:l,count:c}of r){if(this._context.clippingExtent!=null&&(Gr(dd),du(dd,o),!Xd(dd,this._context.clippingExtent)))continue;const u=WT(o,a,3);if(u.length===0)continue;const p=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,f=Pee({material:this._material,indices:u,mapPositions:o,attributeData:{position:s,color:p?null:i.color,colorFeature:p?op(p.field,e):null,uvMapSpace:this._needsUV?OD(i.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Ih(i.boundingRect,9*l,9*c):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(f)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPositions:n,position:s}=i[r];if(this._context.clippingExtent!=null&&(Gr(dd),du(dd,n),!Xd(dd,this._context.clippingExtent)))continue;const o=iV(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:n,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,i){var a;const r=n3(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const n=Xve(r,this._context.overlaySR),s=new Zet(n,i,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=mn(4*o,!0),Tet(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=Gr(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._hasOutline&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,r.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new H4(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,i){var n;const r=i.renderData.polygons;for(const{position:s,holeIndices:o,index:a,count:l}of r){const c=Gr(dd);if(du(c,s),!Xd(c,this._context.clippingExtent))continue;const u=WT(s,o,3);if(u.length===0)continue;_T(i.outBoundingBox,c);const p=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,f=Pee({material:this._material,indices:u,attributeData:{position:s,color:p?null:i.color,colorFeature:p?op(p.field,e):null,uvMapSpace:this._needsUV?OD(i.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:i.objectAndLayerIdColor}});i.outGeometries.push(new XT(f,i))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const i=e.renderData.outlines;for(let r=0;r<i.length;++r){const{position:n}=i[r];if(Gr(dd),du(dd,n),!Xd(dd,this._context.clippingExtent))continue;_T(e.outBoundingBox,dd);const s=iV(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new XT(s,e))}}_getOutlineOpacity(){var i,r;const e=(r=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:r.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var r,n;const e=(n=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:n.color,i=this._getOutlineOpacity();return JA(e!=null?Lt.toUnitRGB(e):null,i)}test(){return{...super.test(),createAsOverlay:(e,i)=>this._createAsOverlay(e,i),createAs3DShape:(e,i,r)=>this._createAs3DShape(e,i,r)}}};kbe.elevationModeChangeTypes={definedChanged:Pn.RECREATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE};const dd=$s();let qet=class extends k4{constructor(e,i,r,n){super(e,r,n),this.color=i}},Zet=class extends k4{constructor(e,i,r,n){super(e,r,n),this.color=i}};const Xet="arial-unicode-ms",vie="woff2",bie=new Map,zbe=new Set;let Yet=class{constructor(e,i){this.fontFace=e,this.promise=i}};async function Jet(t){const e=ett(t),i=bie.get(e);if(i)return i.promise;const r=new FontFace(t.family,`url('${Er.fontsUrl}/woff2/${e}.${vie}') format('${vie}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(r)&&r.status==="loading")return r.loaded;const s=r.load().then(()=>(n.add(r),r));return bie.set(e,new Yet(r,s)),zbe.add(r),s}function Ket(t){return zbe.has(t)}function Qet(t){if(!t)return Xet;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function ett(t){const e=ttt(t)+itt(t);return Qet(t.family)+(e.length>0?e:"-regular")}function ttt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function itt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Bbe=class Vbe{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const i=this.definition.font;return`${i.style} ${i.weight} ${e}px ${i.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(i=>Math.floor(255*i)).toString()},${e[3]})`}static async fromSymbol(e,i){var f,y,v,b,x;const r=(f=e==null?void 0:e.material)==null?void 0:f.color,n=Lt.toUnitRGBA(r)??Df,s=e.size!=null?Sa(e.size):12,o=e.lineHeight,a=e.background!=null?Lt.toUnitRGBA(e.background.color):Df,l={family:((y=e.font)==null?void 0:y.family)??"sans-serif",decoration:((v=e.font)==null?void 0:v.decoration)??"none",weight:((b=e.font)==null?void 0:b.weight)??"normal",style:((x=e.font)==null?void 0:x.style)??"normal"},c=e.halo,u=c!=null&&c.color!=null&&c.size>0?{size:Sa(c.size),color:Lt.toUnitRGBA(c.color)}:{size:0,color:Df},p=new Vbe({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:i});if(e.font){let S=!1;const P=p.fontString(s);try{S=(await document.fonts.load(P)).some(C=>!Ket(C))}catch{ye.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${P}'. Some text symbology may be rendered using the default browser font.`)}if(!S&&!rtt.has(e.font.family))try{await Jet(e.font)}catch{}}return p}};const rtt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let ntt=class{constructor(e,i,r){this._renderer=new R1e(e,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=Q7(stt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=e.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new Kb(e,{wrap:{s:Jt.CLAMP_TO_EDGE,t:Jt.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const stt={canvas:null},ott=[0,0,1];let att=class extends cm{constructor(e,i,r,n){super(e,i,r,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=M4(this.symbolLayer.size);if(e)throw new ce("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await Bbe.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const i=e.graphic,r=i3(i.geometry);if(r==null)return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=Rj(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!She(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new lye(s,this.symbolLayer.horizontalAlignment,MYe(this.symbolLayer.verticalAlignment));return this._createAs3DShape(i,r,n,o)}createLabel(e,i,r,n){const s=e.graphic,o=i3(s.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,i,r,n)}setGraphicElevationContext(e,i,r=0){const n=super.setGraphicElevationContext(e,i);return n.addOffsetRenderUnits(r),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,i){return wie(e,i,(r,n)=>{this.updateGraphicElevationContext(n,r)}),Pn.UPDATE}slicePlaneEnabledChanged(e,i){return wie(e,i,r=>{for(const n of r.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,i){const r=i.elevationContext;this.setGraphicElevationContext(e,r,i.metadata!=null?i.metadata.elevationOffset:0),i.needsElevationUpdates=Zh(r.mode)||r.mode==="absolute-height"}_defaultElevationInfoNoZ(){return ctt}_createAs3DShape(e,i,r,n,s,o){var B;const a=this.setGraphicElevationContext(e,new wp,n.elevationOffset),l=((B=e.geometry)==null?void 0:B.type)==="polyline",c=e.uid;let u=null,p=null;if(o==null){const W=$1e(n.horizontalPlacement);u=new ntt(r,W,this._textRenderParameters);let Z=null;if(this._context.sharedResources.textures!=null){p=this._context.sharedResources.textures.fromData(u.key,()=>u.create(),()=>{Z!=null&&Z.release()});const K=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(K==null||Pu(K))return p.release(),null;Z=K}}const f=ltt(u,n),y={occlusionTest:!0,screenOffset:n.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?y.textureId=o.id:p!=null&&(y.textureId=p.texture.id),n.verticalOffset!=null){const{screenLength:W,minWorldLength:Z,maxWorldLength:K}=n.verticalOffset;y.verticalOffset={screenLength:Sa(W),minWorldLength:Z||0,maxWorldLength:K??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:W,screenSizePerspectiveSettingsLabels:Z}=this._context.sharedResources;y.screenSizePerspective=Z.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),y.screenSizePerspectiveAlignment=W}let v;if(l&&(y.shaderPolygonOffset=1e-4),y.hasSlicePlane=this._context.slicePlaneEnabled,s!=null){const W=JSON.stringify(y);v=s.get(W),v==null&&(v=new jT(y),s.add(W,v))}else v=new jT(y);const b=n.translation,x=u?Ri(u.displayWidth,u.displayHeight):fp,S=n.centerOffset,P=r7(v,ott,b,null,x,S,[0,0],null),C=KW(this._context,i,P,a,c);if(C==null)return null;const R=new lm(this,C.object,[P],s==null?[v]:null,p,W1,a);R.alignedSampledElevation=C.sampledElevation,R.needsElevationUpdates=Zh(a.mode)||a.mode==="absolute-height";const{displayWidth:N,displayHeight:$}=u??n;R.getScreenSize=(W=it())=>(W[0]=N,W[1]=$,W);const k=new yye(n.elevationOffset,r);return R.metadata=k,t3(R,i,this._context.elevationProvider),R}};function wie(t,e,i){t&&t.forEach(r=>{const n=e(r);n!=null&&i(n,r.graphic)})}function ltt(t,e){if(e.verticalPlacement==="baseline"){const r=PYe[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return Ri(r,n)}const i=RYe(e.horizontalPlacement,e.verticalPlacement);return KI[i]}const ctt={mode:"relative-to-ground",offset:0},utt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},htt=["polyline","polygon","extent"];let aV=class i1 extends cm{constructor(e,i,r,n){super(e,i,r,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const i=e.graphic;if(!this._validateGeometry(i.geometry,htt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new wp);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(this._material!=null)return;const e=new kve,i=this.symbolLayer.color;i!=null&&(e.color=Lt.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],r],e.transparent=r<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?i1.headingVectorFromAngle(this.symbolLayer.waveDirection):Ri(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=utt[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new Fve(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],i],transparent:r})}layerElevationInfoChanged(e,i,r){const n=this._elevationContext.mode,s=sO(i1.elevationModeChangeTypes,r,n);if(s!==Pn.UPDATE)return s;const o=Zh(n);return this.updateGraphics3DGraphicElevationInfo(e,i,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,i,r){var p;const n=n3(e.geometry);if(n==null)return null;const s=xq(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=s.position.length/3,a=ia(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new dtt(s,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(p=this._context.stage.renderView)==null?void 0:p.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new e0({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:r}),u=new lm(this,c,l.outGeometries,null,null,hye,i);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=Zh(i.mode),u}_createUVCoordsFromVertices(e,i,r,n){const s=al(n);kh(R0);for(let l=0;l<r;l++)bi(xie,i[3*l],i[3*l+1]),IG(R0,xie);ib(R0,R0,s);const o=R0[0]%i1.unitSizeOfTexture,a=R0[1]%i1.unitSizeOfTexture;t$[0]=R0[0]-o,t$[1]=R0[1]-a;for(let l=0;l<r;l++)e[2*l]=(i[3*l]*s-t$[0])/i1.unitSizeOfTexture,e[2*l+1]=(i[3*l+1]*s-t$[1])/i1.unitSizeOfTexture}_create3DShapeGeometries(e){const i=e.renderData.polygons,r=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of i){if(this._context.clippingExtent!=null&&(Gr(wv),du(wv,a),!Xd(wv,this._context.clippingExtent)))continue;const c=WT(a,l,3);if(c.length===0)continue;const u=Ih(r,2*s,2*n),p=Oee({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(p)}}_createAsOverlay(e){var a;const i=n3(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority;const r=Xve(i,this._context.overlaySR),n=r.position.length/3,s=ia(2*n);this._createUVCoordsFromVertices(s,r.position,n,this._context.overlaySR);const o=new ptt(r,s,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=Gr(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,i.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new H4(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const i=e.uvCoords,r=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of r){if(Gr(wv),du(wv,n),!Xd(wv,this._context.clippingExtent))continue;_T(e.outBoundingBox,wv);const l=WT(n,s,3);if(l.length===0)continue;const c=Ih(i,2*o,2*a),u=Oee({material:this._material,indices:l,attributeData:{position:n,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new XT(u,e))}}static headingVectorFromAngle(e){const i=it(),r=i5(e);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};aV.unitSizeOfTexture=100,aV.elevationModeChangeTypes={definedChanged:Pn.RECREATE,staysOnTheGround:Pn.NONE,onTheGroundChanged:Pn.RECREATE};const t$=it(),R0=li(),xie=it(),wv=$s();let dtt=class extends k4{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}},ptt=class extends k4{constructor(e,i,r,n){super(e,r,n),this.uvCoords=i}};function ftt(t,e,i,r){var s;const n=((s=gtt[t.type])==null?void 0:s[e.type])||mtt[e.type];return n?new n(t,e,i,r):(ye.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const mtt={icon:eV,object:_Qe,line:U1e,path:bet,fill:kbe,extrude:cXe,text:att,water:aV},gtt={"mesh-3d":{fill:kJe}};let _tt=class extends XW{set symbol(e){this._symbol=e,e.symbolLayers.forEach((i,r)=>{const n=this.symbolLayers[r];n!=null&&(n.symbol=e,n.symbolLayer=i)})}get symbol(){return this._symbol}constructor(e,i,r){super(i.schedule),this._symbol=e,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const n=[];for(let s=0;s<r;s++){const o=i.at(s);if(o.enabled===!1)continue;i$.renderPriority=1-(1+s)/r,i$.renderPriorityStep=1/r,i$.ignoreDrivers=o.ignoreDrivers;const a=ftt(this.symbol,o,this._context,i$),l=oG(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await Y5(this.symbolLayers,async(s,o)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),Ti(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const i=this.symbolLayers[e];return i!=null?i.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,i){const r=e.graphic,n=this.symbolLayers.map(o=>(o==null?void 0:o.createGraphics3DGraphic(e))??null),s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new dWe(r,i||this,n,e.layer,s)}get complexity(){return JW(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,i){const r=this.symbolLayers.length;for(let n=0;n<r;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof lm?l:null};if(s!=null&&!s.globalPropertyChanged(e,i,o))return!1}return!0}applyRendererDiff(e,i){return this.loadStatus!==su.LOADED?Jn.RecreateSymbol:this.symbolLayers.reduce((r,n)=>r!==Jn.RecreateSymbol&&n!=null?Math.min(r,n.applyRendererDiff(e,i)):r,Jn.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===su.FAILED||e.diff.type!=="partial")return;const i=e.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=r[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[s];u!=null&&a.graphics3DGraphicPatches.forEach(p=>p(u,c))})}})}updateGeometry(e,i){return this._updateGeometryOrTransform(e,(r,n)=>r.updateGeometry(n,i))}updateTransform(e,i,r,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,i,r,n))}_updateGeometryOrTransform(e,i){for(let r=0;r<this.symbolLayers.length;r++){const n=this.symbolLayers[r];if(n==null)continue;const s=e.layers[r];if(!s||!i(n,s))return!1}return!0}onRemoveGraphic(e){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(r==null)continue;const n=e.layers[i];n!=null&&r.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,i=0,r=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===su.LOADING?e++:n.isFastUpdatesEnabled()?r++:i++)}),{loading:e,slow:i,fast:r}}async queryForSnapping(e,i,r,n){const s=this.symbolLayers.filter(w3).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,i,r,n)),o=await Promise.all(s);return Ti(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const i$=new pWe;let ytt=class extends XW{constructor(e,i,r){super(i),this.symbol=e,this._convert=r,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const i=await this.symbol.fetchSymbol({signal:e});i.id=this.symbol.id,this.graphics3DSymbol=this._convert(i),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:YW}globalPropertyChanged(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,i)}applyRendererDiff(e,i){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,i):Jn.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,i){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,i)}updateTransform(e,i,r,n){var s;return((s=this.graphics3DSymbol)==null?void 0:s.updateTransform(e,i,r,n))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Uq(t){return t instanceof ytt?t.graphics3DSymbol:t instanceof _tt?t:null}const l3=ye.getLogger("esri.views.3d.layers.graphics.labelPlacement");function vtt(t){const e=Ptt(t);if(e==null)return null;const i=btt(t,e);if(i==null)return null;const r=i.anchor,n=!!e.hasLabelVerticalOffset;return xtt({anchor:r,verticalOffset:e.verticalOffset,screenOffset:it(),centerOffset:Kt(0,0,0,-1),centerOffsetUnits:"world",translation:I(),elevationOffset:0,hasLabelVerticalOffset:n},i,t)}function btt(t,e){if(e.anchor)return e;const i=t.labelClass.labelPlacement,r=Qd[i],n=r||fN(t);return i&&!r&&l3.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),wtt(n,t)}function zq(t){const e=t.graphics3DGraphic.graphics3DSymbol,i=Uq(e);return i!=null?i.symbol.symbolLayers.at(0):null}function wtt(t,e){const i=e.graphics3DGraphic.graphic.geometry;if(i==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(l3.warnOncePerTick(Tie(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),fN(e)):t;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return l3.warnOncePerTick(Tie(t==null?void 0:t.placement,`'${r}' geometries`)),fN(e);break;case"point":case"mesh":return t}return t}function Tie(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function fN(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=zq(t);return i!=null&&i.type==="extrude"?Qd["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Qd["above-center"];default:return}}function xtt(t,e,i){const r=i.graphics3DGraphic.graphic.geometry;if(r==null)return null;switch(r.type){case"point":Stt(t,e,i);break;case"polygon":Ttt(t,e,i);break;case"mesh":Bq(t,e,i.graphics3DGraphic.layers[0])}return t}function Ttt(t,e,i){const r=zq(i);if(r!=null)switch(r.type){case"extrude":{const n=i.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(aP),Zd(aP,t.translation),t.translation[2]=Ry(aP)/2):me(t.translation,0,0,0),Bq(t,e,n);break}}}function Stt(t,e,i){const r=zq(i);if(r==null)return;const n=i.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):me(t.translation,0,0,0),r.type){case"icon":case"text":Ctt(t,e,i,n);break;case"object":Bq(t,e,n)}}function Ctt(t,e,i,r){const{graphics3DGraphic:n}=i,s=r!=null?r.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Qd[i.labelClass.labelPlacement]&&l3.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=Ett(i);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function Ett(t,e=Ott){const{graphics3DGraphic:i}=t,r=i.layers[0],n=r!=null?r.stageObject.geometries[0].material:null;if(n&&n instanceof jT){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function Bq(t,e,i){const r=i!=null?i.getBoundingBoxObjectSpace(aP):aP,n=Ge(r[3]-r[0],r[4]-r[1],r[5]-r[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=ze(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function Att(t){return t==="above-center"}function Ptt(t){const e=t.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=t,n=Uq(r.graphics3DSymbol),s=Eh(n,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Qd[e]||fN(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:Sie(s.verticalOffset),anchor:null,normalizedOffset:null}:!i||!i.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!r.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&Att(o.placement)?{placement:"above-center",verticalOffset:Sie(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(l3.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function Sie(t){const{screenLength:e,minWorldLength:i,maxWorldLength:r}=t;return{screenLength:e,minWorldLength:i,maxWorldLength:r}}const Qd={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},Cie={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in Cie){const e=Cie[t],i=Qd[t];e.forEach(r=>{Qd[r]=i})}Object.freeze&&(Object.freeze(Qd),Object.keys(Qd).forEach(t=>{var e;Object.freeze(Qd[t]),Object.freeze((e=Qd[t])==null?void 0:e.normalizedOffset)}));const Ott=[0,0],aP=$s();let Eie=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,i){this._materials.set(e,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const r$=4096;let Rtt=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=gi()}},Mtt=class{constructor(e,i){this.textId=e,this.textRenderer=i,this.placement=new Rtt,this.rendered=!1}},$tt=class{constructor(e,i,r){this.size=e,this.cursor=i,this.lineHeight=r}resize(e){this.size.height=e}resetCursor(){this.cursor.x=lP,this.cursor.y=lP+Gbe,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},sA=class extends ke{constructor(e){super(e),this.type=An.Texture,this.id=xc(),this.events=new os,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new $tt({width:r$,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=et(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const i=new Di;return i.wrapMode=Jt.CLAMP_TO_EDGE,i.flipped=!0,i.samplingMode=qt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.preMultiplyAlpha=!0,i.maxAnisotropy=e.parameters.maxMaxAnisotropy,i}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Wt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Dt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=Qr(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=et(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,i,r,n){const s=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,Br(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+a)/s.size.height,(e.placement.offset.x+o)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=r,s.lineHeight=Math.max(s.lineHeight,n),this._elements.set(i,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const i=e.placement.offset;this._ctx.clearRect(i.x,i.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const i=this._stageObjects.get(e);if(i)return i;const r=new Set;return this._stageObjects.set(e,r),r}_addStageObject(e,i){this._ensureStageObjects(e).add(i)}_removeStageObject(e,i){const r=this._stageObjects.get(e);r&&r.delete(i)&&(i.geometries[0].setAttributeData(M.SIZE,[0,0]),i.geometryVertexAttrsUpdated(i.geometries[0]))}_processAddition(e,i){const r=this._atlas,n=e.textId,s=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=s+lP,l=o+lP+Gbe;if(r.cursor.x+a<r.size.width&&r.cursor.y+l<r.size.height)this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n);else{if(!(r.cursor.y+l+r.lineHeight<r.size.height)){const c=r.cursor.y+l+r.lineHeight-r.size.height,u=r.size.height+c<r$;if(u){const p=Math.ceil(r.size.height*Math.max(1.3,(c+r.size.height)/r.size.height));this._resizeAtlas(Math.min(hq(p),r$))}return!i||!u&&r.size.height===r$?(this._processRemovals(),R2.OK):(this._repack(),R2.REPACK)}r.cursor.x=lP,r.cursor.y+=r.lineHeight,r.lineHeight=0,this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n)}return R2.OK}_processRemovals(){this._elementsToRemove.forEach((e,i)=>{const r=this._stageObjects.get(i);r&&r.size!==0||this._removeAtlasElement(e),r&&r.size===0&&this._stageObjects.delete(i)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,i)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(i,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const i=this._stageObjects.get(e.textId);i&&i.forEach(r=>{r.geometries[0].setAttributeData(M.UV0,e.placement.uvMinMax),r.geometries[0].setAttributeData(M.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),r.geometryVertexAttrsUpdated(r.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,i=!0){if(this._glTexture==null)return na.YIELD;let r=!1;if(Yo(this._elementsToAddOrUpdate,(s,o)=>{const a=this._elements.get(o);if(a!=null&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const u=c.geometries[0],p=this._elements.get(o);u.setAttributeData(M.UV0,p.placement.uvMinMax),u.setAttributeData(M.SIZE,[p.textRenderer.displayWidth,p.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),i)===R2.REPACK&&(r=!0,!0)}),r)return this.runTask(Qa,!1),void e.madeProgress();let n=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Yo(this._elementsToRender,(s,o)=>(this._processRenderingRequest(s),this._elementsToRender.delete(o),n=!0,e.madeProgress(),e.done)),n&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&ZWe.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,i){const r=e.key;this._elementsToAddOrUpdate.has(r)||this._elementsToAddOrUpdate.set(r,new Mtt(r,e)),this._addStageObject(r,i),this._elementsToRemove.delete(r),this.setDirty()}removeTextTexture(e,i){const r=e.key;this._elementsToRemove.set(r,this._elements.get(r)),this._removeStageObject(r,i)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((r,n)=>e.push({element:r,key:n}));let i=!0;for(let r=0;r<e.length-1;r++)if(e[r].key.localeCompare(e[r+1].key)>0){i=!1;break}if(!i||this._elementsToRemove.size){e.sort((r,n)=>r.key.localeCompare(n.key)),this._elements.clear();for(const{element:r,key:n}of e)this._elements.set(n,r);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:i,_elementsToRemove:r,_atlas:n}=this,s=this;return{elements:e,stageObjects:i,elementsToRemove:r,atlas:n,resizeAtlas:o=>s._resizeAtlas(o),run:(o,a)=>s.runTask(o,a)}}};d([m({constructOnly:!0})],sA.prototype,"view",void 0),d([m({type:Boolean})],sA.prototype,"updating",void 0),sA=d([J("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],sA);const lP=2,Gbe=2;var R2;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(R2||(R2={}));let Aie=class{constructor(e,i){this.labelingContext=e,this.graphics3DGraphic=i,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},Itt=class{constructor(e,i,r,n,s){this.labelClass=e,this.graphics3DSymbol=i,this.graphics3DCalloutSymbolLayer=r,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},Ltt=class{constructor(e,i,r,n,s,o,a,l){this.layer=i,this.graphics3DCore=r,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new uve(e,{pickable:!0,disableOctree:!0},i.uid)}destroy(){this.stageLayer.destroy()}},r1=class extends ke{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new an,this._handles.add([Pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),Pe(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Dt.LABELER,this)]),this._textTextureAtlas=new sA({view:this.view}),this._hudMaterialCollection=new Eie(this.view._stage),this._calloutMaterialCollection=new Eie(this.view._stage)}dispose(){this._handles=Je(this._handles),this._textTextureAtlas=et(this._textTextureAtlas),this._hudMaterialCollection=et(this._hudMaterialCollection),this._calloutMaterialCollection=et(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),pd.graphic=null,pd.renderingInfo=null,pd.layer=null}_activateLabelingContext(e){e.graphics.forEach((i,r)=>{const n=new Aie(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n),i.setVisibilityFlag(co.LABEL,Qo.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((i,r)=>{i.setVisibilityFlag(co.LABEL,Qo.USER,!1),this.setLabelGraphicVisibility(i,!1),this._labels.delete(r)}),e.active=!1}_addLabelTextureToAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r&&this._textTextureAtlas.addTextTexture(r,i.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const i of e.graphics3DGraphic.labelLayers){if(!i._labelClass)continue;const r=e.textRenderers[i._labelIndex];r!=null&&this._textTextureAtlas.removeTextTexture(r,i.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),na.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const i of this._labelingContexts)if(i.active){if(!Pie(i)){if(Dtt(i)){this._deactivateLabelingContext(i);continue}if(this._createLabelClassContext(i),_U(i)){this._dirty=!0;continue}if(!Pie(i))continue}Yo(i.labelsToInitialize,(r,n)=>(this._ensureGraphics3DResources(r)&&(this._labels.set(n,r),this.deconflictor.setDirty(),e.madeProgress()),(r.visible&&r.textInitialized||!r.visible&&r.hasGraphics3DResources)&&(i.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(i=>this._removeLabelTextureFromAtlas(i)),this._labelsToAdd.forEach(i=>this._addLabelTextureToAtlas(i)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const i=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),Ti(i),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const r=e.graphics3DCore,n=r.layer,s=n.labelingInfo&&n.labelingInfo.filter(c=>!!c.symbol);!s||s.length===0||(await Y5(s,async(c,u)=>{const p=c.symbol,f=Uq(r.getOrCreateGraphics3DSymbol(p));if(f==null)return void ye.getLogger(this).error("Failed to create Graphics3DSymbol for label");await f.load(),Ti(i);let y=null;Rj(p)&&p.hasVisibleCallout()&&(y=BHe(p,r.symbolCreationContext),await y.load(),Ti(i));const v=await Lg(oye(c,e.layer.fieldsIndex,this.view.spatialReference));if(Ti(i),v.ok===!0){const b=await this._createTextRenderParameters(f.symbol);Ti(i),e.labelClassContexts[u]=new Itt(c,f,y,b,v.value)}else ye.getLogger(this).error(`Label expression failed to evaluate: ${v.error}`)}),Ti(i))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(i=>{if(ms(i))throw i;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const i=e.symbolLayers.at(0);return(i==null?void 0:i.type)!=="text"?null:Bbe.fromSymbol(i,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const r of e.labelClassContexts)--r.graphics3DSymbol.referenced;const i=e.labelClassAbortController;e.labelClassAbortController=new AbortController,wu(i),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,i,r,n,s){const o=new lye(r.verticalOffset,Rte(r.anchor),OYe(r.anchor),e.text,r.translation,r.elevationOffset,r.centerOffset,r.screenOffset,r.centerOffsetUnits,e.displayWidth,e.displayHeight);return pd.graphic=i,pd.renderingInfo=null,pd.layer=n,s.createLabel(pd,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,i,r,n,s){return pd.graphic=e,pd.layer=s,pd.renderingInfo=new UHe(null,i,n.translation,n.centerOffset,n.screenOffset,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),r.createGraphics3DGraphic(pd)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const i=e.graphics3DGraphic;if(i.destroyed)return!1;this._ensureTextTextureResources(e);const r=e.labelingContext,n=r.labelClassContexts;if(!n||n.length===0||!r.emptySymbolLabelSupported&&i.layers.length===0)return!1;let s=!1;const o=i.graphic,a=r.layer,l=n$(r.layer);for(let u=0;u<n.length;u++){const p=e.textRenderers[u],f=e.textLabelPlacements[u];if(p==null||f==null)continue;const y=n[u],v=y.graphics3DSymbol,b=v.symbol&&v.symbol.type==="label-3d"?v.symbol:null,x=v.symbolLayers[0];if(!x)continue;x.setElevationInfoOverride(r.elevationInfoOverride);const S=this._createTextSymbolGraphic(p,o,f,a,x);if(S==null)return!1;S._labelClass=y.labelClass,S._labelIndex=u,i.addLabelGraphic(S,r.stageLayer),i.deconflictionPriority=((c=y.textRenderParameters)==null?void 0:c.definition.size)??0,i.setVisibilityFlag(co.LABEL,Qo.USER,l),i.setVisibilityFlag(co.LABEL,Qo.SCALE_RANGE,!0),i.setVisibilityFlag(co.LABEL,Qo.DECONFLICTION,!1),s=!0;const P=y.graphics3DCalloutSymbolLayer;if(P&&f.hasLabelVerticalOffset){P.setElevationInfoOverride(r.elevationInfoOverride);const C=this._createLineCalloutGraphic(o,b,P,f,a);C!=null&&(y.calloutSymbolLayerIndex=i.labelLayers.length,i.addLabelGraphic(C,r.stageLayer))}break}return r.scaleVisibility&&s&&r.scaleVisibility.updateGraphicLabelScaleVisibility(i),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const i=e.labelingContext.labelClassContexts;for(const r of e.graphics3DGraphic.labelLayers){if(r._labelClass==null)continue;const n=i[r._labelIndex].graphics3DSymbol.symbolLayers[0];n!=null&&n.onRemoveGraphic(r)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<r.length;o++){const a=r[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const P=l.needsHydrationToEvaluate()?Tje(n,i.layer):n;c=l.evaluate(P)}catch{c=null}else c=l.evaluate(n);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,p=((s=u.symbol)==null?void 0:s.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const f=e.graphics3DGraphic,y=a.labelClass,v=i.disablePlacement,b=vtt({graphics3DGraphic:f,labelSymbol:p,labelClass:y,disablePlacement:v});if(b==null)continue;const x=Rte(b.anchor),S=$1e(x);e.textRenderers[o]=new R1e(c,S,a.textRenderParameters),e.textLabelPlacements[o]=b}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,i){const r=i.graphic.uid;if(e.graphics.set(r,i),e.active){const n=new Aie(e,i);this._labels.set(r,n),e.labelsToInitialize.set(r,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,i){const r=i.graphic.uid,n=this._labels.get(r);e.graphics.delete(r),n&&(this._destroyGraphic(n,r),e.labelsToInitialize.delete(r),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,i){this._labels.has(i)&&(this._labels.delete(i),this._labelsToAdd.delete(i),this._labelsToRemove.delete(i)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,i){if(!i)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const r of i){const n=e.graphics.get(r);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,i){for(const r of i.labelClassContexts){const n=new Map;i.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(r.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),r.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[r.calloutSymbolLayerIndex];r.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const i=n$(e.layer);i&&!e.active&&this._activateLabelingContext(e),!i&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((i,r)=>{const n=this._labels.get(r);n&&(this._destroyGraphic(n,r),n.visible=!1,n.rendered=!1,e.labelsToInitialize.set(r,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const i of this._labelingContexts)if(i.graphics3DCore===e)return i;return null}addGraphicsOwner(e,i,r){const n=r&&r.emptySymbolLabelSupported||!1,s=r&&r.elevationInfoOverride||null,o=r&&r.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new Ltt(this.view._stage,a,e,i,n,s,o,n$(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>n$(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const i=this._findLabelingContext(e);if(!i)return;const r=this._labelingContexts.indexOf(i);this._labelingContexts.splice(r,1),i.graphics.forEach(n=>this._removeGraphic(i,n)),i.destroy(),this.setDirty()}setLabelGraphicVisibility(e,i){const r=e.graphic.uid,n=this._labels.get(r);n&&n.visible!==i&&(i&&!n.rendered?(this._labelsToAdd.set(r,n),this._labelsToRemove.delete(r),n.textInitialized||n.labelingContext.labelsToInitialize.set(r,n)):!i&&n.rendered&&(this._labelsToRemove.set(r,n),this._labelsToAdd.delete(r)),n.visible=i,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(i=>_U(i))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((i,r)=>i+(_U(r)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function _U(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function Pie(t){return t.labelClassContexts&&t.labelClassContexts.length}function Dtt(t){return t.labelClassContexts===null}function n$(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(i=>!!i.symbol))}d([m({constructOnly:!0})],r1.prototype,"view",void 0),d([m({constructOnly:!0})],r1.prototype,"deconflictor",void 0),d([m()],r1.prototype,"_textTextureAtlas",void 0),d([m({type:Boolean,readOnly:!0})],r1.prototype,"updating",null),r1=d([J("esri.views.3d.layers.graphics.Labeler")],r1);const pd=new zHe(null,null,null);let oA=class n2{constructor(e,i,r,n=null){this.lij=[0,0,0],this.extent=li(),this.resolution=0,this.loadPriority=0,this.measures={visibility:ma.VISIBLE_ON_SURFACE,screenRect:li(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,i,r,n)}acquire(e,i,r,n){this.tilingScheme=n,this.id=n2.id(e,i,r),this.lij[0]=e,this.lij[1]=i,this.lij[2]=r,n.getExtent(e,i,r,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const i=this.lij[0]+1,r=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(i,r,n,this.tilingScheme),e[1].acquire(i,r+1,n,this.tilingScheme),e[2].acquire(i,r,n+1,this.tilingScheme),e[3].acquire(i,r+1,n+1,this.tilingScheme),e):[new n2(i,r,n,this.tilingScheme),new n2(i,r+1,n,this.tilingScheme),new n2(i,r,n+1,this.tilingScheme),new n2(i,r+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,Rg(e.measures.screenRect,this.measures.screenRect)}static id(e,i,r){return`${e}/${i}/${r}`}};var ma;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(ma||(ma={}));const jbe=.5*Math.PI,Ntt=jbe/Math.PI*180;let Ftt=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:I(),direction:I()};for(let i=0;i<4;i++)this._extent[i]={origin:I(),direction:I(),cap:{next:null,direction:I()}},this._planes[i]=Yi();this._planes[Lr.NEAR]=Yi(),this._planes[Lr.FAR]=Yi(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,i,r,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,i,r),xe(this._center.origin,s[0].origin,s[2].origin),pe(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||pe(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,zg(a.cap.direction,a.origin,l.origin),NP(a.direction,a.cap.direction,a.origin,this._planes[o]),n||pe(a.direction,a.direction,-1)}NP(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[Lr.NEAR]),n?Dz(this._planes[Lr.NEAR],this._planes[Lr.FAR]):(V5(this._planes[Lr.FAR],this._planes[Lr.NEAR]),Dz(this._planes[Lr.NEAR],this._planes[Lr.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=i,this._minGlobalAltitude=.9*lr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,i,r=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===Ke.Global){const s=this._maxSpanSpatialReference.isGeographic?Ntt:jbe*i;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(r||!e.intersectsRay(Cu(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!r&&e.intersectsRay(Cu(o.origin,o.direction))||e.intersectsLineSegment(G1(o.origin,o.cap.next,Utt),o.cap.direction))return!0}const n=r?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(i9e(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,i,r){LG(e,fd),fd[2]=r,_u(i,fd,yU,this._renderCoordsHelper.spatialReference),fo(Oie,yU),Gr(Zl);for(const{x0:s,x1:o,y0:a,y1:l}of ktt)for(let c=0;c<5;c++){const u=c/4;fd[0]=Bt(e[s],e[o],u),fd[1]=Bt(e[a],e[l],u),fd[2]=r,Ws(fd,i,fd,this._renderCoordsHelper.spatialReference),st(fd,fd,Oie),Hf(Zl,fd)}me(this._extent[0].origin,Zl[0],Zl[1],Zl[2]),me(this._extent[1].origin,Zl[3],Zl[1],Zl[2]),me(this._extent[2].origin,Zl[3],Zl[4],Zl[2]),me(this._extent[3].origin,Zl[0],Zl[4],Zl[2]);for(let s=0;s<4;++s)st(this._extent[s].origin,this._extent[s].origin,yU)}_toRenderBoundingExtentLocal(e,i,r){V3(e,i,Em,this._renderCoordsHelper.spatialReference),me(this._extent[0].origin,Em[0],Em[1],r),me(this._extent[1].origin,Em[2],Em[1],r),me(this._extent[2].origin,Em[2],Em[3],r),me(this._extent[3].origin,Em[0],Em[3],r)}_toRenderBoundingExtent(e,i,r){switch(this._renderCoordsHelper.viewingMode){case Ke.Global:this._toRenderBoundingExtentGlobal(e,i,r);break;case Ke.Local:this._toRenderBoundingExtentLocal(e,i,r);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(Dr(e.planes[Lr.NEAR],this._center.origin)<0&&Re(this._center.direction,e.direction)<0)return!0;for(let i=0;i<4;i++){const r=this._extent[i];if(Dr(e.planes[Lr.NEAR],r.origin)<0&&Re(r.direction,e.direction)<0)return!0}return!1}};const ktt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],fd=I(),yU=Ne(),Oie=Ne(),Zl=$s(),Em=li(),Utt=yp();let ztt=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new A_(e),this._extendedFrustum=new A_(e),this._intersector=new Ftt({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,i){this._surfaceElevation=i,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>i,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return ma.INVISIBLE;const i=this._renderCoordsHelper.viewingMode===Ke.Global&&e.lij[0]>=Btt&&e.lij[0]<Vtt,r=this._getOrCalculateSingleTileVisibility(e,!i);return r!==ma.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(e):r}_shortenFrustumFarPlane(e){const i=A_.nearFarLineIndices,r=e.mutablePoints;for(const n of i){const[s,o]=n,a=r[s],l=r[o];Ce(jc,l,a),pe(jc,jc,jtt),xe(r[o],a,jc)}e.updatePoints(r)}_calculateAggregatedChildrenVisibility(e){let i=ma.INVISIBLE;const r=this._cache.get(e.id);if(r!=null)return r;const n=Iie.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==ma.INVISIBLE&&(i=o,o===ma.VISIBLE_ON_SURFACE))break}return Iie.release(n),this._cache.set(e.id,i),i}_getOrCalculateSingleTileVisibility(e,i){const r=this._cache.get(e.id);if(r!=null)return r;const n=this._calculateSingleTileVisibility(e);return i&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===Ke.Global&&e.lij[0]<Gtt?this._calculateSingleTileVisibilitySided(e,!1)===ma.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,i){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,i);const r=lr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,r)?this._intersector.isVisibleInFrustum(this._frustum,r,!0)?ma.VISIBLE_ON_SURFACE:ma.VISIBLE_WHEN_EXTENDED:ma.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const i=this._renderCoordsHelper.worldUpAtPosition(e.eye,jc);this._aboveGround||Ea(i,i);const r=qs(-Re(i,e.viewForward));if(this._allTilesInvisible=r>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=r>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,jc),a){case gt.FAR_BOTTOM_LEFT:case gt.FAR_TOP_LEFT:case gt.NEAR_BOTTOM_LEFT:case gt.NEAR_TOP_LEFT:Nz(this._extendedFrustum.planes[Lr.LEFT],jc,jc);break;case gt.FAR_BOTTOM_RIGHT:case gt.FAR_TOP_RIGHT:case gt.NEAR_BOTTOM_RIGHT:case gt.NEAR_TOP_RIGHT:Nz(this._extendedFrustum.planes[Lr.RIGHT],jc,jc)}pe(jc,jc,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(Cu(l,jc),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),ya(s[gt.NEAR_BOTTOM_LEFT],s[gt.NEAR_BOTTOM_RIGHT],s[gt.NEAR_TOP_RIGHT],Mie),ya(s[gt.NEAR_BOTTOM_RIGHT],s[gt.NEAR_TOP_RIGHT],s[gt.NEAR_TOP_LEFT],$ie),Re(Mie,$ie)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[gt.NEAR_BOTTOM_LEFT],o[gt.NEAR_BOTTOM_RIGHT]]=[o[gt.NEAR_BOTTOM_RIGHT],o[gt.NEAR_BOTTOM_LEFT]]:[o[gt.NEAR_TOP_LEFT],o[gt.NEAR_TOP_RIGHT]]=[o[gt.NEAR_TOP_RIGHT],o[gt.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-Rie;return{zWithMargin:e,pointIndices:A_.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+Rie;return{zWithMargin:e,pointIndices:A_.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<e}}};const Btt=2,Vtt=6,Gtt=12,jtt=.95,Rie=1,jc=I(),Mie=Yi(),$ie=Yi(),Iie=new ea(Array,t=>{t.length!==4&&(t[0]=new oA,t[1]=new oA,t[2]=new oA,t[3]=new oA)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let Htt=class{constructor(e){this._camera=new It,this._focusOnMap=[0,0],this._screenRect=li(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new ztt(e.renderCoordsHelper)}begin(e,i,r){this._camera.copyFrom(e),this._surfaceElevation=r,this._focusOnMap[0]=i.x,this._focusOnMap[1]=i.y,$G(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,r)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=jAe(e.extent,this._focusOnMap),e.measures.visibility!==ma.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const i=Wtt,r=1<<i,n=e.measures.screenRect;kh(n);let s=0;const o=e.lij[0]+i,a=e.lij[1]<<i,l=e.lij[2]<<i,c=this._tileSizeWithBias(e),u=c*c;for(let p=0;p<r;p++)for(let f=0;f<r;f++)if(s+=this._computeScreenArea(e,o,a+p,l+f,n),s>u)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===ma.VISIBLE_WHEN_EXTENDED?this._tileSize*qtt:this._tileSize}_computeScreenArea(e,i,r,n,s){const o=e.measures.visibility===ma.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,n,o,M0),kh(vU);for(let a=0;a<4;a++)IG(vU,M0[a]);return X_(s,vU,s),nK(M0[0],M0[1],M0[2])+nK(M0[0],M0[2],M0[3])}_projectToScreen(e,i,r,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,i,r,VC),this._toRenderCoords(VC,0,3,$0[0]),this._toRenderCoords(VC,2,3,$0[1]),this._toRenderCoords(VC,2,1,$0[2]),this._toRenderCoords(VC,0,1,$0[3]),n&&(this._projectToPlane($0,this._camera.frustum[Lr.NEAR]),this._projectToPlane($0,this._camera.frustum[Lr.TOP]),this._projectToPlane($0,this._camera.frustum[Lr.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen($0[o],Lie),this._camera.renderToScreen(Lie,s[o])}_projectToPlane(e,i){for(let n=0;n<4;n++)jC[n]=Dr(i,e[n]);const r=Math.max(jC[0],jC[1],jC[2],jC[3]);if(r>0){const n=pe(GC,i,-r);for(let s=0;s<4;s++)xe(e[s],e[s],n)}}_toRenderCoords(e,i,r,n){return GC[0]=e[i],GC[1]=e[r],GC[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(GC,this._tilingScheme.spatialReference,n),n}};const vU=li(),Wtt=2,qtt=5,M0=[fn(),fn(),fn(),fn()],VC=li(),GC=I(),$0=[I(),I(),I(),I()],jC=[0,0,0,0],Lie=ta();function GCt(t,e,i){if(t==null||i==null)return!1;let r=!0;return xs[0]=t.xmin!=null?t.xmin:0,xs[1]=t.ymin!=null?t.ymin:0,xs[2]=t.zmin!=null?t.zmin:0,r=r&&_n(xs,t.spatialReference,0,e,i,0,1),xs[0]=t.xmax!=null?t.xmax:0,xs[1]=t.ymax!=null?t.ymax:0,xs[2]=t.zmax!=null?t.zmax:0,r=r&&_n(xs,t.spatialReference,0,e,i,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),r}function Hbe(t,e,i){if(t==null||i==null)return!1;let r=!0;return xs[0]=t.xmin!=null?t.xmin:0,xs[1]=t.ymin!=null?t.ymin:0,xs[2]=t.zmin!=null?t.zmin:0,r=r&&_n(xs,t.spatialReference,0,xs,i,0,1),e[0]=xs[0],e[1]=xs[1],xs[0]=t.xmax!=null?t.xmax:0,xs[1]=t.ymax!=null?t.ymax:0,xs[2]=t.zmax!=null?t.zmax:0,r=r&&_n(xs,t.spatialReference,0,xs,i,0,1),e[2]=xs[0],e[3]=xs[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),r}const xs=I();let Ao=class extends ke{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void ye.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const i=this._get("filterExtent");if(i===e||i!=null&&e&&i.equals(e))return;const r=e!=null?e.clone():null;this._set("filterExtent",r),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=li();return Hbe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new Ci,this.tileSize=512,this._idToTile=new Map,this._handles=new an,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new ri}initialize(){this._handles.add([Pe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),gr),Pe(()=>{var e,i,r;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(i=this.viewState)==null?void 0:i.contentCamera,(r=this.focus)==null?void 0:r.location]},()=>this._setDirty(),qn)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Dt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Qr(this._frameWorker),this._handles=Je(this._handles)}addClient(){const e=Xtt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),il(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Qa))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=Dt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=Dt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Htt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(i=>new oA(i[0],i[1],i[2],e))}_purgeHorizonTiles(e){e.sort((i,r)=>{const n=i.measures.screenRect,s=r.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),kh(s$);for(let i=0;i<e.length;i++)if(X_(s$,e.data[i].measures.screenRect,s$),up(s$)>Ytt)return e.data.slice(i,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:i}=this;for(;this._pendingTiles.length>0&&!e.done;){const r=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!c5(this._filterExtentRect,r.extent)||(this._tileMeasurements.updateTile(r),r.measures.visibility!==ma.INVISIBLE&&(r.measures.shouldSplit?(i.ensureMaxLod(r.lij[0]+1),this._pendingTiles.push(...r.getChildren())):this._newTiles.push(r)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const i=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),r=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(r),this.tiles.addMany(i),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,i)=>e.measures.visibility!==i.measures.visibility?e.measures.visibility===ma.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-i.measures.distance),this.tiles.forEach((e,i)=>e.loadPriority=i)}};d([m({constructOnly:!0})],Ao.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Ao.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],Ao.prototype,"tilingSchemeOwner",void 0),d([m({constructOnly:!0})],Ao.prototype,"cameraOnSurface",void 0),d([m({constructOnly:!0})],Ao.prototype,"focus",void 0),d([m({constructOnly:!0})],Ao.prototype,"viewState",void 0),d([m({constructOnly:!0})],Ao.prototype,"terrain",void 0),d([m()],Ao.prototype,"tiles",void 0),d([m()],Ao.prototype,"tileSize",void 0),d([m({readOnly:!0})],Ao.prototype,"tilingScheme",null),d([m()],Ao.prototype,"filterExtent",null),d([m({readOnly:!0})],Ao.prototype,"_filterExtentRect",null),d([m({readOnly:!0})],Ao.prototype,"_rootTileIds",null),d([m({value:!1})],Ao.prototype,"suspended",null),d([m({readOnly:!0})],Ao.prototype,"updating",null),Ao=d([J("esri.views.3d.layers.support.FeatureTileTree3D")],Ao);let Ztt=0;function Xtt(){return Ztt++}const s$=li(),Ytt=10;let vn=class extends ke{constructor(){super(...arguments),this._propertiesPool=new Dg({camera:It},this),this._lastSeenCameraProjectionValues=new It,this.mode=Ji.ANIMATING,this._cssCamera=new It,this._camera=new It,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new os,this.viewingMode=Ke.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,i){this._set("viewingMode",e),this._set("spatialReference",i),this._set("constraints",new Hm({mode:this.viewingMode}))}exit(){var e;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Dg({camera:It},this)}destroy(){var e,i;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,(i=this._propertiesPool)==null||i.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===Ke.Global){const e=lr(this.spatialReference).radius;this.camera=new It({eye:Ge(4*e,0,0),center:Ge(e,0,0),up:Ge(0,0,1)})}else this.camera=new It({eye:Ge(0,0,100),center:Ge(0,0,0),up:Ge(0,1,0)})}get animation(){return this.cameraController instanceof XP&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:i,width:r,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(i/n),e.width=Math.round(r/n),e}set camera(e){e!==ju&&ju.copyFrom(e),ju.computeUp(this.viewingMode),this.events.emit("before-camera-change",ju);const i=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,ju)&&(this._lastSeenCameraProjectionValues.copyFrom(ju),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!i.equals(ju)&&(this._camera=this._propertiesPool.get("camera").copyFrom(ju),this._cameraChanged=!i.almostEquals(ju),this._cameraChanged)){const r=Pae(()=>{this._cameraChanged=!1,r.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===Ji.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===Ke.Global}get isLocal(){return this.viewingMode===Ke.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var i;this.stopActiveCameraController()?((i=this.cameraController)==null||i.destroy(),e&&(this.removeHandles(Die),this.addHandles(Bh(()=>e.state===dn.Finished||e.state===dn.Stopped,()=>{this._set("cameraController",null),this.updateCamera(r=>e.onControllerEnd(r))},{sync:!0,once:!0}),Die),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=dn.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==dn.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();ju.copyFrom(this._get("camera")),e(ju),this.camera=ju,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,i){return e.fov!==i.fov||e.fullViewport[0]!==i.fullViewport[0]||e.fullViewport[1]!==i.fullViewport[1]||e.fullViewport[2]!==i.fullViewport[2]||e.fullViewport[3]!==i.fullViewport[3]||e.padding[fi.TOP]!==i.padding[fi.TOP]||e.padding[fi.RIGHT]!==i.padding[fi.RIGHT]||e.padding[fi.BOTTOM]!==i.padding[fi.BOTTOM]||e.padding[fi.LEFT]!==i.padding[fi.LEFT]}};d([m()],vn.prototype,"mode",void 0),d([m({readOnly:!0,type:RT})],vn.prototype,"animation",null),d([m({type:It})],vn.prototype,"camera",null),d([m({type:It})],vn.prototype,"cssCamera",null),d([m()],vn.prototype,"_cssCamera",void 0),d([m()],vn.prototype,"_camera",void 0),d([m({readOnly:!0})],vn.prototype,"pixelRatio",null),d([m()],vn.prototype,"rasterPixelRatio",void 0),d([m()],vn.prototype,"contentPixelRatio",void 0),d([m({readOnly:!0})],vn.prototype,"alignPixelEnabled",null),d([m({readOnly:!0})],vn.prototype,"updating",null),d([m({})],vn.prototype,"_contentCamera",void 0),d([m({type:It})],vn.prototype,"contentCamera",null),d([m({readOnly:!0})],vn.prototype,"fixedContentCamera",null),d([m({readOnly:!0})],vn.prototype,"constraints",void 0),d([m({readOnly:!0})],vn.prototype,"events",void 0),d([m({readOnly:!0})],vn.prototype,"isGlobal",null),d([m({readOnly:!0})],vn.prototype,"isLocal",null),d([m({readOnly:!0})],vn.prototype,"viewingMode",void 0),d([m({readOnly:!0})],vn.prototype,"spatialReference",void 0),d([m()],vn.prototype,"navigating",null),d([m()],vn.prototype,"stationary",null),d([m()],vn.prototype,"_cameraChanged",void 0),d([m()],vn.prototype,"cameraController",null),vn=d([J("esri.views.3d.state.ViewState")],vn);const Jtt=vn,ju=new It,Die="ViewStateHandles";let Ktt=class{constructor(e,i,r){this.viewingMode=e,this._forEachLayer=i,this._view=r,this._externalIntersectionHandlers=new ri,this._tolerance=NT,this._tmpRay=ho(),this._tmpRegion=li(),this._validateHUDIntersector=qh(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,i,r){return this.intersectRay(this._getPickRay(e,this._tmpRay),Nie(this.viewingMode),i,r)}intersectScreenFreePointFallback(e,i,r){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),i,r)}intersectRayFreePointFallback(e,i,r){return this.intersectRay(e,Nie(this.viewingMode),i,r)||this._intersectRayFreePointLocal(e,i)}intersectRay(e,i,r,n){return i.options.selectionMode=!1,i.options.store=Do.MIN,this.computeIntersection(e,i,n),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(e,i,r=.5,n=.5){return e.getRenderCenter(l$,r,n),l$[0]+=.0466,l$[1]-=.0123,fW(e,l$,i)}intersectIntersectorScreen(e,i,r){this.computeIntersection(this._getPickRay(e,this._tmpRay),i,r)}intersectToolIntersectorScreen(e,i,r){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,i,r)}intersectToolIntersectorRay(e,i,r){i.options.selectionMode=!0,this.computeIntersection(e,i,r);const n=i.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||bp(n)&&n.intersector!==sn.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(e,i,r))}setTolerance(e=NT){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((i,r)=>i.type===sn.TERRAIN?1:r.type===sn.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((i,r)=>i.type===sn.TERRAIN?1:r.type===sn.TERRAIN?-1:0)}_getPickRay(e,i){const r=this._view.state.camera;return Fge(r,e,i)}_intersectRayFreePointLocal(e,i){return this.viewingMode!==Ke.Local||e==null||xe(i,e.origin,Me(Qe.get(),e.direction)),!1}intersectElevationFromScreen(e,i,r=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),i,r,n)}_intersectElevation(e,i,r=0,n=null){if(e==null)return null;const s=i!=null?i.mode:"absolute-height",o=(i==null?void 0:i.offset)??0,a=s!=="on-the-ground"?o+r:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,a$)){const P=this._view.computeMapPointFromVec3d(a$);return P.z??(P.z=0),P.z-=o,P}return null}const c=this._view.state.camera,u=Qe.get();c.projectToRenderScreen(e.origin,u);const p=new Fie(null,this._forEachLayer),f=this._view.slicePlane,y=f!=null?ZK(f):null,v=qh(this.viewingMode);v.options.store=Do.MIN,v.options.verticalOffset=l;const b=e.origin,x=xe(Qe.get(),b,e.direction);v.reset(b,x,c),v.point=u;const S=n?"type"in n&&n.type==="graphics"?P=>P.layerUid!==n.uid:P=>P.graphicUid!==n.uid:null;switch(s){case"relative-to-scene":{const P=C=>(!S||S(C))&&!!C.lastValidElevationBB;v.intersect(p.layers,u,this._tolerance,null,P),this._externalIntersectionHandlers.forAll(C=>{if(C.type===sn.I3S||C.type===sn.TERRAIN){const R=C.slicePlaneEnabled?y:null;C.intersect(v,R,v.rayBegin,v.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(P=>{if(P.isGround){const C=P.slicePlaneEnabled?y:null;P.intersect(v,C,v.rayBegin,v.rayEnd,u)}})}if(v.results.min.getIntersectionPoint(a$)){const P=this._view.computeMapPointFromVec3d(a$);return P.z=r,P}return null}computeIntersection(e,i,r){var v;if(e==null)return;const n=this._view.state.camera,s=Qe.get();n.projectToRenderScreen(e.origin,s);const o=new Fie(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=e.origin,l=xe(Qe.get(),e.origin,e.direction);i.reset(a,l,n),i.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,u=c!=null?ZK(c):null;i.intersect(o.sliceableLayers,s,this._tolerance,u);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this._externalIntersectionHandlers.forAll(b=>{const x=b.layerUid,S=Array.isArray(x),P=S?x:[x];S&&(i.options.filteredLayerUids=[]);let C=!1;for(const R of P)o.filterLayerUid(R)?C=!0:S&&i.options.filteredLayerUids.push(R);if(i.options.isFiltered=!C,b.isGround&&p||!i.options.isFiltered){const R=b.slicePlaneEnabled?u:null;b.intersect(i,R,a,l,s)}});const f=Qe.get(),y=this._view.basemapTerrain;if(r&&r.enableDraped&&y.spatialReference!=null&&i.results.ground.getIntersectionPoint(f)){const b=y.overlayManager.renderer,x=this._view.renderCoordsHelper.spatialReference,S=Qe.get();this._view.renderCoordsHelper.fromRenderCoords(f,S,y.spatialReference),S[2]=((v=this._view.elevationProvider)==null?void 0:v.getElevation(f[0],f[1],f[2],x,"ground"))??0,b.intersect(i,S,i.results.ground,P=>o.filterRenderGeometry(P))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(e){const i=e.results.hud;Rg(this._tmpRegion,G8);const r=this._view.state.camera,n=[],s=this._tmpRegion,o=S=>{const P=new eit(S);r.projectToRenderScreen(S.target.center,P.screenPoint),P.screenPoint[0]=Math.floor(P.screenPoint[0]),P.screenPoint[1]=Math.floor(P.screenPoint[1]),n.push(P),IG(s,P.screenPoint)};e.sortResults(i.all),i.min.dist!=null&&o(i.min);for(const S of i.all)i.min.target.object!==S.target.object&&i.max.target.object!==S.target.object&&o(S);if(i.max.dist!=null&&i.max.target.object!==i.min.target.object&&o(i.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,s[0]-aA),u=Math.max(0,s[1]-aA),p=Math.min(lu(s)+2*aA,a-c),f=Math.min(up(s)+2*aA,l-u),y=new Uint8Array(p*f*4);this._view._stage.renderer.readHUDVisibility(c,u,p,f,y);let v=!0;const b=e.results.max.dist==null;let x=0;for(const S of n)for(const P of Qtt)if(y[4*(Math.min(S.screenPoint[0]+P[0],a)-s[0]+(Math.min(S.screenPoint[1]+P[1],l)-s[1])*p)]){v&&(e.results.min.copy(S.result),v=!1),b&&e.results.max.copy(S.result),e.options.store===Do.ALL&&e.results.all.splice(x++,0,S.result);break}}};const aA=1,Qtt=(()=>{const t=[],e=aA;for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)t.push([r+e,i+e]);return t})();let eit=class{constructor(e){this.result=e,this.screenPoint=ta()}},o$;function Nie(t){return o$&&o$.viewingMode===t||(o$=qh(t)),o$}let Fie=class{constructor(e,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,i(r=>{r.pickable&&this.filterLayerUid(r.apiLayerUid)&&(r.sliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(e){const{include:i,exclude:r}=this;return e==null?i==null&&r==null:(i==null||i.has(e))&&(r==null||!r.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function kie(t){return typeof t=="object"&&"intersect"in t}const a$=I(),l$=ta();let XCt=class{constructor(e,i){this.spatialReference=e,this._view=i}getElevation(e,i,r){return this._view.elevationProvider.getElevation(e,i,0,this.spatialReference,r)}async queryElevation(e,i,r,n,s){return this._view.elevationProvider.queryElevation(e,i,0,this.spatialReference,s,r,n)}},tit=class{constructor(e,i,r,n){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Dt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,i,r,n=0){const s=sa(),o={x:e,y:i,minDemResolution:n,result:s,signal:r};return this._queries.push(o),Ca(r,()=>{QV(this._queries,o),s.reject(Qi())}),s.promise}get running(){return this._queries.length>0}runTask(e){const i=this._queries;this._queries=[];const r=this._getElevationQueryProvider();if(!r)return i.forEach(u=>u.result.reject()),void e.madeProgress();const n=i.map(u=>[u.x,u.y]),s=i.reduce((u,p)=>Math.min(u,p.minDemResolution),1/0),o=new M3({points:n,spatialReference:this.spatialReference}),a=i.length>1&&i.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:i[0].signal;if(a!=null){let u=0;i.forEach(p=>Ca(p.signal,()=>{u++,p.result.reject(Qi()),u===i.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};r.queryElevation(o,c).then(u=>{i.forEach((p,f)=>{p.signal!=null&&p.signal.aborted?p.result.reject(Qi()):p.result.resolve(u.geometry.points[f][2])})}).catch(u=>{i.forEach(p=>p.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(Qa)}}},lA=class extends os.EventedMixin(ke){get spatialReference(){var e,i;return(i=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:i.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=Je(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new tit(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,i,r,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&i===a.y&&r===a.z&&go(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=c$(o,this._im,e,i,r,n,s),o==null&&(o=c$(o,this._ground,e,i,r,n,s)),s==="scene"&&(o=c$(o,this._scene,e,i,r,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:i,z:r,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,i){let r=1/0,n=-1/0;for(const s of[this._im,this._ground,this._scene])s.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,i);a!=null&&(r=Math.min(r,a.min),n=Math.max(n,a.max))}});return{min:r,max:n}}queryElevation(e,i,r,n,s,o=null,a=0){const l=sa();return this._elevationQuery.queryElevation(e,i,o,a).then(c=>{s==="scene"&&(c=c$(c,this._scene,e,i,r,n,s)),l.resolve(c)}).catch(c=>{ms(c)?l.reject(c):l.resolve(this.getElevation(e,i,r,n,s))}),l.promise}register(e,i){this._handles.set(i,i.on("elevation-change",r=>this.emit("elevation-change",r))),this._providersFromContext(e).push(i)}unregister(e){var i;this._handles.has(e)&&((i=this._handles.get(e))==null||i.remove(),this._handles.delete(e));for(const r of[this._im,this._ground,this._scene]){const n=r.indexOf(e);n>-1&&r.splice(n,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function c$(t,e,i,r,n,s,o){for(const a of e){const l=a.getElevation(i,r,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}d([m({constructOnly:!0})],lA.prototype,"view",void 0),d([m()],lA.prototype,"spatialReference",null),lA=d([J("esri.views.3d.support.CombinedElevationProvider")],lA);let cA=class lV{static isValidProfile(e){return e in lV.profiles}static getDefaultProfile(){return ge("esri-iPhone")?"low":"medium"}static apply(e,i){const r=lV.profiles[e];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable,i.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const n=i.sceneService.object,s=r.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.fadeDuration=r.fadeDuration,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.highResolutionAtmosphere=r.highResolutionAtmosphere,i.reflections=r.reflections,i.ambientOcclusion=r.ambientOcclusion,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumPixelRatio=r.maximumPixelRatio}};function Uie(){const t=!!ge("esri-mobile"),e=!!ge("ios"),i=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ge("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:i},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!ge("disable-feature:reduce-map-tile-levels"),textureFadeDuration:i},fadeDuration:i,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}cA.test={reset(){const t=Uie();for(const e of Object.keys(t))cA.profiles[e]=t[e]}},function(t){t.profiles=Uie()}(cA||(cA={}));const tL=cA;function Wbe(){return new Float32Array(4)}function iit(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Qf(t,e,i,r){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function rit(t,e){return new Float32Array(t,e,4)}function qbe(){return Wbe()}function Zbe(){return Qf(1,1,1,1)}function Xbe(){return Qf(1,0,0,0)}function Ybe(){return Qf(0,1,0,0)}function Jbe(){return Qf(0,0,1,0)}function Kbe(){return Qf(0,0,0,1)}const nit=qbe(),sit=Zbe(),oit=Xbe(),ait=Ybe(),lit=Jbe(),cit=Kbe();Object.freeze(Object.defineProperty({__proto__:null,ONES:sit,UNIT_W:cit,UNIT_X:oit,UNIT_Y:ait,UNIT_Z:lit,ZEROS:nit,clone:iit,create:Wbe,createView:rit,fromValues:Qf,ones:Zbe,unitW:Kbe,unitX:Xbe,unitY:Ybe,unitZ:Jbe,zeros:qbe},Symbol.toStringTag,{value:"Module"}));const zie=new Lt([0,255,255]),Bie=new Lt([0,0,0]),Vie=1,Gie=.25,jie=.4,Hie=.2;let cf=class extends ke{constructor(){super(...arguments),this.color=zie.clone(),this.haloColor=null,this.haloOpacity=Vie,this.fillOpacity=Gie,this.shadowOpacity=jie,this.shadowColor=Bie.clone(),this.shadowDifference=Hie}static toEngineOptions(e){const i=Lt.toUnitRGBA(e.color??zie),r=e.haloColor!=null?Lt.toUnitRGBA(e.haloColor):i,n=Lt.toUnitRGBA(e.shadowColor??Bie),s=e.haloOpacity??Vie,o=e.fillOpacity??Gie,a=e.shadowOpacity??jie,l=e.shadowDifference??Hie;return{color:Qf(i[0],i[1],i[2],i[3]),haloColor:Qf(r[0],r[1],r[2],r[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:Kt(n[0],n[1],n[2],n[3]),occludedShadowOpacity:a*(1-l)}}};d([m({type:Lt})],cf.prototype,"color",void 0),d([m({type:Lt})],cf.prototype,"haloColor",void 0),d([m()],cf.prototype,"haloOpacity",void 0),d([m()],cf.prototype,"fillOpacity",void 0),d([m()],cf.prototype,"shadowOpacity",void 0),d([m({type:Lt})],cf.prototype,"shadowColor",void 0),d([m()],cf.prototype,"shadowDifference",void 0),cf=d([J("esri.views.3d.support.HighlightOptions")],cf);const cV=cf;function uit(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function hit(t){return typeof t=="string"?sl(t):Le(t)}function dit(t,e,i){const r={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){r[n]=[];for(let o=0;o<s.length;o++)r[n][o]=dit(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(i&&i[n]);r[n]=e?o:JSON.stringify(o)}else r[n]=e?s:JSON.stringify(s);else r[n]=s}return r}function eEt(t){return{geometryType:VG(t[0]),geometries:t.map(e=>e.toJSON())}}function pit(t,e,i){const r=nPe(e);return t.map(n=>{const s=r.fromJSON(n);return s.spatialReference=i,s})}let n1=class extends Nt{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),i=this.geometries[0],r={};return r.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),r.inSR=i.spatialReference.wkid||JSON.stringify(i.spatialReference.toJSON()),r.geometries=JSON.stringify({geometryType:VG(i),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(r.transformForward=this.transformForward),r}};d([m()],n1.prototype,"geometries",void 0),d([m({json:{read:{source:"outSR"}}})],n1.prototype,"outSpatialReference",void 0),d([m()],n1.prototype,"transformation",void 0),d([m()],n1.prototype,"transformForward",void 0),n1=d([J("esri.rest.support.ProjectParameters")],n1);const Vq=n1,fit=rl(Vq);async function Qbe(t,e,i){e=fit(e);const r=hit(t),n={...r.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=VG(e.geometries[0]),a=uit(n,i);return ps(r.path+"/project",a).then(({data:{geometries:l}})=>pit(l,o,s))}async function Gq(t=null,e){var n,s;if(Er.geometryServiceUrl)return Er.geometryServiceUrl;if(!t)throw new ce("internal:geometry-service-url-not-configured");let i;i="portal"in t?t.portal||zh.getDefault():t,await i.load({signal:e});const r=(s=(n=i.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!r)throw new ce("internal:geometry-service-url-not-configured");return r}async function mit(t,e,i=null,r){const n=await Gq(i,r),s=new Vq;s.geometries=[t],s.outSpatialReference=e;const o=await Qbe(n,s,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new ce("internal:geometry-service-projection-failed")}const git=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Gq,projectGeometry:mit},Symbol.toStringTag,{value:"Module"}));let _it=class{constructor(e,i){this.spatialReference=i,this.unitInMeters=al(this.spatialReference,lr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Gq(e&&e.get("portalItem")).catch(()=>{throw new ce("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const i=await this._geometryServiceURLPromise;let r,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?r=e:(r=[e],n=!1);const s=r.map(l=>l instanceof Ft?l:new Ft(l,this.spatialReference)),o=new Vq({geometries:s,outSpatialReference:jt.WGS84}),a=(await Qbe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},Dd=class extends ke{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};d([m()],Dd.prototype,"minTotalNumberOfFeatures",void 0),d([m()],Dd.prototype,"maxTotalNumberOfFeatures",void 0),d([m()],Dd.prototype,"maxTotalNumberOfPrimitives",void 0),d([m()],Dd.prototype,"snapshotAvailable",void 0),d([m()],Dd.prototype,"polygonLodFactor",void 0),d([m()],Dd.prototype,"polylineLodFactor",void 0),d([m()],Dd.prototype,"skipHighSymbolLods",void 0),Dd=d([J("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Dd);let Bf=class extends ke{constructor(){super(...arguments),this.lodFactor=1}};d([m()],Bf.prototype,"lodFactor",void 0),Bf=d([J("esri.views.3d.support.QualitySettings.LoDFactorSettings")],Bf);let mN=class extends Bf{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};mN=d([J("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],mN);let ig=class extends ke{constructor(){super(...arguments),this.object=new mN,this.point=new Bf,this.integratedMesh=new Bf,this.pointCloud=new Bf,this.uncompressedTextureDownsamplingEnabled=!1}};d([m({type:mN})],ig.prototype,"object",void 0),d([m({type:Bf})],ig.prototype,"point",void 0),d([m({type:Bf})],ig.prototype,"integratedMesh",void 0),d([m({type:Bf})],ig.prototype,"pointCloud",void 0),d([m()],ig.prototype,"uncompressedTextureDownsamplingEnabled",void 0),ig=d([J("esri.views.3d.support.QualitySettings.SceneServiceSettings")],ig);let b_=class extends ke{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};d([m()],b_.prototype,"lodBias",void 0),d([m()],b_.prototype,"angledSplitBias",void 0),d([m()],b_.prototype,"reduceTileLevelDifferences",void 0),d([m()],b_.prototype,"textureFadeDuration",void 0),b_=d([J("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],b_);let M2=class extends ke{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([m()],M2.prototype,"pixelRatio",void 0),d([m()],M2.prototype,"maxTotalNumberOfFeatures",void 0),M2=d([J("esri.views.3d.support.QualitySettings.HeatmapSettings")],M2);let jo=class extends ke{constructor(){super(...arguments),this.graphics3D=new Dd,this.sceneService=new ig,this.tiledSurface=new b_,this.heatmap=new M2,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([m({type:Dd})],jo.prototype,"graphics3D",void 0),d([m({type:ig})],jo.prototype,"sceneService",void 0),d([m({type:b_})],jo.prototype,"tiledSurface",void 0),d([m({type:M2})],jo.prototype,"heatmap",void 0),d([m()],jo.prototype,"fadeDuration",void 0),d([m()],jo.prototype,"antialiasingEnabled",void 0),d([m()],jo.prototype,"physicallyBasedRenderingEnabled",void 0),d([m()],jo.prototype,"highQualityTransparency",void 0),d([m()],jo.prototype,"highResolutionAtmosphere",void 0),d([m()],jo.prototype,"reflections",void 0),d([m()],jo.prototype,"ambientOcclusion",void 0),d([m()],jo.prototype,"memoryLimit",void 0),d([m()],jo.prototype,"additionalCacheMemory",void 0),d([m()],jo.prototype,"frameRate",void 0),d([m()],jo.prototype,"maximumPixelRatio",void 0),jo=d([J("esri.views.3d.support.QualitySettings.QualitySettings")],jo);const Wie=jo;function yit(t){return tS(t)&&t.length>=3}function vit(t){return(iS(t)||Array.isArray(t))&&t.length>=3}function bit(t){return yit(t)||vit(t)}let wit=class uV{constructor(e,i,r,n){this.viewingMode=e,this.spatialReference=i,this.unitInMeters=r,this._coordinateSystem=n,this._tmpCoordinateSystem=oDe(n)}set extent(e){e&&aDe(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return mDe(this._coordinateSystem,e)}setAltitude(e,i,r=e){return xpe(this._coordinateSystem,r,i,e)}setAltitudeOfTransformation(e,i){gDe(this._coordinateSystem,i,e,i)}worldUpAtPosition(e,i){return hDe(this._coordinateSystem,e,i)}worldBasisAtPosition(e,i,r){return dDe(this._coordinateSystem,e,i,r)}basisMatrixAtPosition(e,i){const r=this.worldBasisAtPosition(e,bc.X,Qe.get()),n=this.worldBasisAtPosition(e,bc.Y,Qe.get()),s=this.worldBasisAtPosition(e,bc.Z,Qe.get());return sm(i,r[0],r[1],r[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),i}headingAtPosition(e,i){const r=this.worldUpAtPosition(e,Qe.get()),n=this.worldBasisAtPosition(e,bc.Y,Qe.get()),s=Jde(i,n,r);return nl(s)}intersectManifoldClosestSilhouette(e,i,r){return c6(this._coordinateSystem,i,this._tmpCoordinateSystem),fDe(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,i,r){c6(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=Qe.get();return pDe(this._tmpCoordinateSystem,e,n)?fe(r,n):null}intersectInfiniteManifold(e,i,r){if(this.viewingMode===Ke.Global)return this.intersectManifold(e,i,r);c6(this._coordinateSystem,i,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=Qe.get();return Wb(n.plane,e,s)?fe(r,s):null}toRenderCoords(e,i,r){return GD(e)?No(e,i,this.spatialReference):Ws(e,i,r,this.spatialReference)}fromRenderCoords(e,i,r=null){return GD(i)?(r!=null&&(i.spatialReference=r),zj(e,this.spatialReference,i)):bit(i)?Ws(e,this.spatialReference,i,r)?i:null:$g(e,this.spatialReference,i)}static create(e,i){switch(e){case Ke.Local:return new uV(Ke.Local,i,al(i),uDe());case Ke.Global:return new uV(Ke.Global,i,1,cDe(i))}}static renderUnitScaleFactor(e,i){return sX(e)/sX(i)}};var Ef;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})(Ef||(Ef={}));const xit=(()=>{const t=new Array;return t[Ef.ELEVATION]=10,t[Ef.BASEMAP]=10,t[Ef.I3S_INDEX]=10,t[Ef.I3S_DATA]=10,t[Ef.SYMBOLOGY]=5,t})(),Tit=30;function ewe(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function Sit(t){return new wl({view:t})}const u$=1,bU=1,Cit=.75,Eit=.6,qie=1.3;let wl=class extends ke{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new Uve,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(u$),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,i){return new aZe(e,this._cacheStorage,i)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Eit&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(u$);else if(e)(this._memoryPredicted>1.1*bU||this._usedMemory>bU)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/qie),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>bU)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/qie),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<Cit&&this._quality<u$){this._stableQuality=this._quality;const i=.05;e=this._updateQuality(this._quality+i)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),u$))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l;if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const i=((a=this.view)==null?void 0:a._stage)&&this.view._stage.renderView&&((l=this.view._stage.renderer)==null?void 0:l.edgeView);i!=null&&(e+=i.usedMemory);let r=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(c=>{if(ewe(c)){const u=c.ignoresMemoryFactor?this._quality:1;e+=c.usedMemory*u,r+=c.unloadedMemory*u}});const n=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&n){this._warnMemoryUsage=e;const c=p=>(p/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",u=Math.round(100*this._quality);ye.getLogger(this).warn(`Memory Limit exceeded! Limit: ${c(s)} Current: ${c(e)} Projected: ${c(e+r)} Quality: ${u}%`)}this._usedMemory=e/s,this._memoryPredicted=(e+r)/s;const o=s-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const i=e._numQualityChanges;return e._numQualityChanges=0,i}}}};d([m({constructOnly:!0})],wl.prototype,"view",void 0),d([m()],wl.prototype,"maxMemory",null),d([m()],wl.prototype,"additionalCacheMemory",null),d([m()],wl.prototype,"memoryFactor",null),d([m()],wl.prototype,"updating",null),d([m()],wl.prototype,"usedMemory",null),d([m()],wl.prototype,"_quality",void 0),d([m()],wl.prototype,"_usedMemory",void 0),d([m()],wl.prototype,"_updating",void 0),d([m()],wl.prototype,"_stableQuality",void 0),d([m()],wl.prototype,"_maxMemory",void 0),d([m()],wl.prototype,"_additionalCacheMemory",void 0),wl=d([J("esri.views.3d.support.MemoryController")],wl);let Ait=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},Pit=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new Oit}},Oit=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},Rit=class{constructor(e,i,r,n){this._workerFunc=e,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=n.map(s=>new Pit(s))}destroy(){this._clients.length=0}hasQuota(e){const i=this._clients[e];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(e){const i=this._clients[e.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(r,n)=>this._taskCallback(r,n))):i.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const i=this._clients[e.client];this._totalNumWorkers--,i&&(i.numWorkers--,i.statistics.requests++,i.statistics.size+=e.size||0,i.statistics.duration+=e.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,xt(i.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,i){e._cancelled||(this._callbackFunc(e,i),this._taskFinished(e))}getStatsForType(e){const i=this._clients[e];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const e=this;return{set workerFunc(i){e._workerFunc=i}}}},iL=class extends ke{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,i,r){this._loadQueue=new Rit((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,i),r&&(this._frameTask=r.registerTask(Dt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Qr(this._frameTask),this._tasks.forEach(e=>wu(e.abortController)),this._loadQueue=Je(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,i,r,n={}){const s=sa();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,i,r,n,s);return Ca(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,i,r,n,s,o){const a=new Iit(e,i,r,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,i){var r;gP(e.resolvers,i),i.reject(Qi()),e.resolvers.length===0&&(e.status===ch.DOWNLOADING&&(e.status=ch.CANCELLED,this._loadQueue.cancel(e),(r=e.abortController)==null||r.abort(),e.request=null,e.abortController=null),e.status=ch.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,i){e.resolvers.push(i)}_createOrUpdateTask(e,i,r,n,s){const o=Lit(n!=null&&n.uid||e,i,r),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,i,r,o,s)}_doneLoadingCB(e,i){this._loadQueue&&(xt(e.status===ch.DOWNLOADING),e.status=ch.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:i}):this._doneLoading(e,i))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const i=this._onLoadQueue.shift();Ti(i.task.abortController),i.task.abortController=null,i.callback(i.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const i=this._doneQueue.shift();i.task.status!==ch.DOWNLOADED&&(i.err=i.err||Qi()),this._doneLoading(i.task,i.err),e.madeProgress()}}_doneLoading(e,i){if(i&&!ms(i)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let r=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(i)ms(i)?n.reject(i):n.reject(new ce("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${i}`,{url:e.url,error:i}));else{--r;const s=r<=0?e.result:Le(e.result);n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,i){if(e.status===ch.CANCELLED)return!1;let r,n;switch(e.startTime=performance.now(),e.status=ch.DOWNLOADING,e.docType){case"binary":n="array-buffer",r=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ps(e.url,{...e.options,responseType:n,timeout:r,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:i,task:e}):(e.abortController=null,i(e))},l=c=>{e.status===ch.DOWNLOADING&&i(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,p=$it(u);if(n="image",e.size=u.byteLength,p==="unknown")return e.request=ps(e.url,{responseType:n,timeout:r,signal:s}),void e.request.then(v=>a(v.data),l);const f=new Blob([u],{type:p}),y=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(y),e.request=ps(y,{responseType:n,timeout:r,signal:s}),e.request.then(v=>a(new X4(v.data,p,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};d([m({readOnly:!0})],iL.prototype,"updating",void 0),iL=d([J("esri.views.3d.support.StreamDataLoader")],iL);const Mit={numRetries:0};function $it(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let X4=class{constructor(e,i,r){this.image=e,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}},Iit=class extends Ait{constructor(e,i,r,n,s){super(n),this.url=e,this.options=i,this.docType=r,this.key=s,this.result=null,this.status=ch.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Mit.numRetries}};function Lit(t,e,i){return`${t}:${e}:${i}`}var ch;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(ch||(ch={}));let rL=class extends ke{constructor(){super(...arguments),this.updating=!1}};function Dit(t){return new Pd({view:t})}d([m({readOnly:!0})],rL.prototype,"updating",void 0),rL=d([J("esri.views.3d.support.ResourceControllerMain")],rL);let Pd=class extends rL{constructor(){super(...arguments),this._immediateTask=OT,this._normalTask=OT,this._updatingObjects=UP([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=x4e(),this._memoryController=Sit(this.view),this._streamDataLoader=new iL,this._streamDataLoader.setup(Tit,xit,this._scheduler),this.addHandles([Pe(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},gr),Pe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=cT({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Dt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Dt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=Qr(this._frameTask),this._streamDataLoader=Je(this._streamDataLoader),this._memoryController=Je(this._memoryController),this._scheduler=Je(this._scheduler),this.view=null}get updating(){var e,i,r,n;return!!((e=this._memoryController)!=null&&e.updating||(i=this._streamDataLoader)!=null&&i.updating||(r=this._immediateTask)!=null&&r.updating)||((n=this._updatingObjects)==null?void 0:n.value.some(s=>s.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const i=this._streamDataLoader;return{request:(r,n,s)=>i.request(r,n,e,s),get busy(){return!i.hasDownloadSlots(e)}}}addUpdatingObject(e){const i=this._updatingObjects;return i.value=[...i.value,e],il(()=>{i.value=i.value.filter(r=>r!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(aG(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};d([m()],Pd.prototype,"view",void 0),d([m()],Pd.prototype,"_scheduler",void 0),d([m()],Pd.prototype,"_memoryController",void 0),d([m()],Pd.prototype,"_streamDataLoader",void 0),d([m()],Pd.prototype,"_immediateTask",void 0),d([m()],Pd.prototype,"_normalTask",void 0),d([m()],Pd.prototype,"_updatingObjects",void 0),d([m({readOnly:!0})],Pd.prototype,"updating",null),Pd=d([J("esri.views.3d.support.ResourceControllerImpl")],Pd);function Nit(t){return ewe(t)}function Fit(t){return"performanceInfo"in t}var _a,Et;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(_a||(_a={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(Et||(Et={}));const ux=I(),kit=I(),Am=I(),Pm=I();function Uit(t,e,i=0){const r=t.extent;if(r==null)return!1;if(i===0)return Ule(r,e);const n=Math.min(r[2]-r[0],r[3]-r[1]);return GAe(r,e,i*n)}function h$(t,e,i,r){fe(ux,i),ux[r]=e[r];const n=Ce(ux,ux,e),s=Ce(kit,t,e),o=Re(s,n),a=Re(n,n);let l;l=o<=0?e:a<=o?i:xe(ux,e,pe(n,n,o/a));const c=Ce(ux,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function zit(t,e,i){const r=t.extent;if(r==null)return 0;Am[0]=r[0],Am[1]=r[1],Am[2]=i,Pm[0]=r[2],Pm[1]=r[3],Pm[2]=i;let n=1/0,s=1/0;return e[0]<Am[0]?n=h$(e,Am,Pm,0):e[0]>Pm[0]&&(n=h$(e,Pm,Am,0)),e[1]<Am[1]?s=h$(e,Am,Pm,1):e[1]>Pm[1]&&(s=h$(e,Pm,Am,1)),Math.min(n,s)}function Bit(t,e,i){if(t==null)return hH();if(t.spatialReference.isGeographic&&!dy(t.spatialReference))return new ce("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=mc.checkUnsupported(t);if(r!=null)return r;if(i==null)return new ce("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=Vit(t,i);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new ce("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function Vit(t,e){const i=t.lods,r=i[0].resolution*2**i[0].level,n=[r*t.size[0],r*t.size[1]],s=[t.origin.x,t.origin.y],o=Fle(e),a=li();mc.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>b2){const c=i[0].scale*2**i[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/r;const p=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**p)*10**p,new ce("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:b2})}return null}const Git=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Bit,isInsideExtent:Uit,tiltToExtentEdge:zit},Symbol.toStringTag,{value:"Module"}));function jit(){return!0}function Hit(){return 0}function Wit(t,e){if(t==null)return hH();const i=t.lods.length-1,r=t.spatialReference,n=dy(r)||tm(r)||im(r);if(r.isWebMercator){if(!mc.makeWebMercatorAuxiliarySphere(i).compatibleWith(t))return new ce("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new ce("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!mc.makeGCSWithTileSize(t.spatialReference,t.size[0],i).compatibleWith(t))return t.spatialReference.isWGS84?new ce("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new ce("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new ce("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const qit=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:Wit,isInsideExtent:jit,tiltToExtentEdge:Hit},Symbol.toStringTag,{value:"Module"})),Zit={[Ke.Global]:qit,[Ke.Local]:Git};function vf(t,e){t||console.warn("Terrain: "+e)}let Ps=!1,gN=!1;function Xit(t){gN=t,Ps=Ps||t}function Yit(t){Ps=t}function Fe(t,e){var i;if(Ps&&!t){const r=(i=new Error().stack)==null?void 0:i.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+r),new Error("Assertion failed"+(e?": "+e:""))}}function hV(t){return Y4(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function _N(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function Y4(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function jq(t){return(t==null?void 0:t.type)==="tile-3d"}function c3(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function twe(t){return(t==null?void 0:t.type)==="wmts-3d"}function dV(t){return(t==null?void 0:t.type)==="elevation-3d"}function HC(t){return(t==null?void 0:t.type)==="group"}function yN(t){return t&&(jq(t)||twe(t)||Y4(t)||c3(t))}function pV(t){return t&&(jq(t)||Y4(t)||c3(t)||twe(t))}function u3(t){return pV(t)||dV(t)}function Jit(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function iwe(t){return rwe(t==null?void 0:t.sourceLayerInfo)}function Kit(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function Qit(t){var i;const e=(i=t==null?void 0:t.sourceLayerInfo)==null?void 0:i.data;return e instanceof HTMLImageElement||e instanceof X4||e instanceof HTMLCanvasElement||e instanceof ImageData}function rwe(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function eT(t){return t!=null&&"release"in t&&t.release(),null}function Zie(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Hq(t,e,i,r){return Zit[r].checkIfTileInfoSupportedForViewSR(t,i,e)}function J4(t,e,i){let r=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=ert(t,e,i);r=s.tileInfo,n=s.fullExtent}else{n=_N(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=i===Ke.Local;if(_N(t))r=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!trt(e)||irt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;r=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=t.tileInfo}return r!=null&&n!=null&&Hq(r,n,e,i)==null?{tileInfo:r,fullExtent:n}:null}function ert(t,e,i){const r=xDe(t);if(r!=null){if(!Ci.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const n=r.find(s=>Hq(s.tileInfo,s.fullExtent,e,i)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function trt(t){return t.isWGS84||t.isWebMercator||_le(t)||!xP(t)}const irt={force512VTL:!1};function Xie(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function Om(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function bh(t,e,i=srt){return Math.abs(t-e)<i}function vN(t){return t===Et.NORTH_EAST?Et.SOUTH_WEST:t===Et.NORTH_WEST?Et.SOUTH_EAST:t===Et.SOUTH_WEST?Et.NORTH_EAST:Et.NORTH_WEST}function bN(t){return t===Et.NORTH?Et.SOUTH:t===Et.EAST?Et.WEST:t===Et.SOUTH?Et.NORTH:Et.EAST}function rrt(t){return t===Et.NORTH_WEST||t===Et.SOUTH_WEST}function nrt(t){return t===Et.NORTH_WEST||t===Et.NORTH_EAST}function Yie(t){return t===Et.NORTH_WEST||t===Et.WEST||t===Et.SOUTH_WEST}function Jie(t){return t===Et.NORTH_EAST||t===Et.EAST||t===Et.SOUTH_EAST}function Kie(t){return t===Et.SOUTH_EAST||t===Et.SOUTH||t===Et.SOUTH_WEST}function Qie(t){return t===Et.NORTH_EAST||t===Et.NORTH||t===Et.NORTH_WEST}const Of=[Et.NORTH,Et.EAST,Et.SOUTH,Et.WEST],h3=[Et.NORTH_EAST,Et.SOUTH_EAST,Et.SOUTH_WEST,Et.NORTH_WEST],srt=1e-5;let ort=class{constructor(e,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=u3(e)?i.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,Fit(e)){const r=e.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}},art=class{constructor(e){var r;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const n=e.resourceController.memoryController;this.totalMemory=(n.maxMemory??0)*lD.MEGABYTES,this.usedMemory=Math.round(n.usedMemory*this.totalMemory),this.quality=n.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((r=e.basemapTerrain)==null?void 0:r.usedMemory)??0;const i=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=i!=null?i.usedMemory:0,e.allLayerViews.items.forEach(n=>{(Nit(n)||u3(n))&&this.layerPerformanceInfos.push(new ort(n,e))}),this.layerPerformanceInfos.sort((n,s)=>s.memory-n.memory)}},lrt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,i,r){const n=r?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>tbe(new Q1e(o.streamDataRequester),e,o,r),i)}loadWOSR(e,i){const r=`wosr:${e}:${i.disableTextures}`,n=this._wosrMemCache.get(r);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,r,s=>ibe(e,s),i)}async _loadOnce(e,i,r,n,s){Ti(s);const o=Ca(s,()=>this._abortLoad(e,r));let a=e.get(r);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(r,a)}try{const l=await a.promise;return i.put(r,l,l.size),e.delete(r),Ti(s),l}finally{Qr(o)}}_abortLoad(e,i){const r=e.get(i);r!=null&&--r.refCount>0||(e.delete(i),r!=null&&r.abortController.abort())}},crt=class extends w2{constructor(e,i,r){super(i,r),this._streamDataRequester=e}async fromUrl(e,i,r){Ti(r);const n=r!=null?r.signal:null,s=this.makeUid(e,i);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new afe,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async u=>{const p=this._createTexture(e,u,i);return c.texture=p,c.abortController=null,this._stage.add(p),await this._stage.load(p),{uid:s,texture:p,release:()=>this._release(s)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await kSe(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,i,r){var s;const n={width:i.width,height:i.height,wrap:{s:Jt.CLAMP_TO_EDGE,t:Jt.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(the(e)){if(r||i.width===0&&i.height===0){const o=i.width?i.height/i.width:1;r=r||64,o>1?(i.width=Math.round(r/o),i.height=r):(i.width=r,i.height=Math.round(r*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new Kb(i,n)}},urt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester(Ef.SYMBOLOGY),this.objectResourceCache=new lrt((r,n)=>e.resourceController.memoryController.newCache(r,n)),this.textures=new crt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const i=lr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=N0e(e.viewingMode,i),this.screenSizePerspectiveSettingsLabels=oVe(e.viewingMode,i)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return il();this._graphicsOwners.push(e);const i=Pe(()=>{var r;return(r=e.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),il(()=>{i.remove(),gP(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new an;const i=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([Pe(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,i,gr),this._viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=Je(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;d$.distance=e.centerOnSurfaceInfrequent.distance,d$.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(d$),this.screenSizePerspectiveSettingsLabels.update(d$),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const d$={distance:0,fovY:0};let s2=class{constructor(e,i,r=""){this.graphics=e,this._symbol=new N_({symbolLayers:[new D_({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new Hb({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(e,i){if(i==null)return;this.hide();const r=new Ft({x:e[0],y:e[1],z:e[2],spatialReference:i});this._graphic=new gb({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},O_=class extends ke{constructor(e){super(e),this.handles=new an}destroy(){this.handles.destroy()}};d([m({constructOnly:!0})],O_.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],O_.prototype,"surface",void 0),d([m({constructOnly:!0})],O_.prototype,"state",void 0),O_=d([J("esri.views.3d.support.PointOfInterest")],O_);const hrt=Array;let Od=class extends O_{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Dg({location:Ft,renderLocation:hrt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=I(),this._tmpPoint=new Ft}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add($l(()=>{var i,r;return(r=(i=this.map)==null?void 0:i.ground)==null?void 0:r.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=Je(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,i=Nr(e.eye,this.renderLocation),r={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Cb(r,i,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),na.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const i=(this._tmpPoint.z??0)>drt&&this.renderCoordsHelper.viewingMode===Ke.Global&&(e.isWGS84||e.isWebMercator);let r=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:r.signal,cache:this.cache,minDemResolution:i?prt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{ms(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===r&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),r=null}),this._pendingElevationQueryController=r,na.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(wU,this._estimatedSurfaceAltitude,this._camera.eye),xa(this._get("renderLocation"),wU)||(this._set("renderLocation",fe(this._propertiesPool.get("renderLocation"),wU)),this.notifyChange("renderLocation"))}};d([m({constructOnly:!0})],Od.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Od.prototype,"cache",void 0),d([m({constructOnly:!0})],Od.prototype,"task",void 0),d([m({readOnly:!0})],Od.prototype,"location",null),d([m({constructOnly:!0})],Od.prototype,"map",void 0),d([m({readOnly:!0})],Od.prototype,"renderLocation",void 0),d([m({readOnly:!0})],Od.prototype,"scale",null),d([m({readOnly:!0})],Od.prototype,"updating",null),Od=d([J("esri.views.3d.support.CameraOnSurface")],Od);const wU=I(),drt=1e5,prt=1e6,frt=Array;let uh=class extends O_{constructor(e){super(e),this._propertiesPool=new Dg({location:Ft,renderLocation:frt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=I(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Qr(this._frameWorker),this._propertiesPool=Je(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,na.YIELD}_updateRenderLocation(){const e=grt;let i=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const r=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!i&&r&&(i=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),i&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=_rt;i&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(fe(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),i?this.distance=Nr(this._camera.eye,e):(pe(e,this._camera.viewForward,this._get("distance")),xe(e,e,this._camera.eye)),xa(this._get("renderLocation"),e)||this._set("renderLocation",fe(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,i){var n,s;const r=this._camera;if(!this.renderCoordsHelper.intersectManifold(r.ray,e,i))return!1;if(this.state.isGlobal){const o=lr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=ba(r.eye),c=l<a*a,u=Nr(r.eye,i);if(c&&u>o/4){const p=a-Math.sqrt(l);return pe(i,r.viewForward,p),xe(i,i,r.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;o!=null&&V3(o,(s=this.surface)==null?void 0:s.spatialReference,WC,this.renderCoordsHelper.spatialReference)&&(i[0]=$e(i[0],WC[0],WC[2]),i[1]=$e(i[1],WC[1],WC[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,i){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,i)){if(Or.TESTS_DISABLE_OPTIMIZATIONS)return!0;const r=this._camera.eye,n=Nr(r,e),s=Nr(r,i);if(Math.abs(s-n)/n>mrt)return!0}return!1}};d([m({constructOnly:!0})],uh.prototype,"scheduler",void 0),d([m({constructOnly:!0})],uh.prototype,"task",void 0),d([m()],uh.prototype,"distance",void 0),d([m({constructOnly:!0})],uh.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([m({readOnly:!0})],uh.prototype,"location",null),d([m({readOnly:!0})],uh.prototype,"renderLocation",void 0),d([m()],uh.prototype,"updating",void 0),uh=d([J("esri.views.3d.support.CenterOnSurface")],uh);const mrt=.05,grt=I(),_rt=I(),WC=li();let yrt=class{constructor(e){this._handles=new an,this.events=new os,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=Je(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),e.removed.forEach(i=>this._handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",vrt)}};const vrt={},brt=Array;let uf=class extends O_{constructor(e){super(e),this._propertiesPool=new Dg({location:Ft,renderLocation:brt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([Pe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),Pe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Dt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=Je(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),i=this.centerOnSurface.renderLocation,r=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,r.worldUpAtPosition(i,ere);const s=Math.max(0,(Math.acos(Re(ere,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!ny(e,i)){const c=this._propertiesPool.get("renderLocation");fe(c,i),this._set("renderLocation",c)}return na.YIELD}const o=1-$e(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(tre);const l=this._propertiesPool.get("renderLocation");return pr(l,i,tre,a),e&&ny(e,l)||this._set("renderLocation",l),na.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const i=this.state.contentCamera,r=i.getRenderCenter(ta());if(r[1]=i.aboveGround?i.padding[fi.BOTTOM]:i.fullHeight-i.padding[fi.TOP],this.estimateSurfaceIntersectionAtRenderPoint(r,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(i.unprojectFromRenderScreen(r,qC)){Ce(qC,qC,i.eye);const s=Me(qC,qC);if(this.renderCoordsHelper.intersectManifold(Cu(i.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,i.eye)}updateRenderLocation(){this._dirty=!0}};d([m()],uf.prototype,"_dirty",void 0),d([m({constructOnly:!0})],uf.prototype,"scheduler",void 0),d([m({constructOnly:!0})],uf.prototype,"centerOnSurface",void 0),d([m({constructOnly:!0})],uf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([m({readOnly:!0})],uf.prototype,"updating",null),d([m({readOnly:!0})],uf.prototype,"location",null),d([m({readOnly:!0})],uf.prototype,"renderLocation",void 0),uf=d([J("esri.views.3d.support.pointsOfInterest.Focus")],uf);const ere=I(),qC=I(),tre=I();let Zm=class extends ke{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=I();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new an}initialize(){this.view.state.isLocal&&(this._handles.add([Pe(()=>{var e,i;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(i=this.surfaceView)==null?void 0:i.extent]},()=>this._update()),$l(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=LG(this.surfaceView.extent),i=new Ft({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(i,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(r=>{this._updateController=null,this._set("location",r.geometry)}).catch(r=>{ms(r)||r&&r.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",r)})):this._set("location",i)}};d([m({constructOnly:!0})],Zm.prototype,"view",void 0),d([m({constructOnly:!0})],Zm.prototype,"cache",void 0),d([m()],Zm.prototype,"surface",null),d([m()],Zm.prototype,"surfaceView",null),d([m({readOnly:!0})],Zm.prototype,"location",void 0),d([m({readOnly:!0})],Zm.prototype,"renderLocation",null),Zm=d([J("esri.views.3d.terrain.StableSurfaceCenter")],Zm);let Xm=class extends ke{constructor(e){super(e),this._tileGeometryUpdateExtent=kh(),this._tileGeometryUpdateSpatialReference=null,this.events=new os,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Dt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",wrt),kh(this._tileGeometryUpdateExtent),this._set("updating",!1)),na.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,X_(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let i=1;i<this.centerOnSurfaces.length;i++){const r=this.centerOnSurfaces[i];r.distance>e.distance&&(e=r)}return e}_centerIntersectsExtent(e,i){const r=this.state.contentCamera.eye,n=xrt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(r,xv,i),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,Tv,i),xv[0]<Tv[0]?(n[0]=xv[0],n[2]=Tv[0]):(n[0]=Tv[0],n[2]=xv[0]),xv[1]<Tv[1]?(n[1]=xv[1],n[3]=Tv[1]):(n[1]=Tv[1],n[3]=xv[1]),c5(n,e)}};d([m({constructOnly:!0})],Xm.prototype,"state",void 0),d([m({constructOnly:!0})],Xm.prototype,"centerOnSurfaces",void 0),d([m({constructOnly:!0})],Xm.prototype,"renderCoordsHelper",void 0),d([m({constructOnly:!0})],Xm.prototype,"scheduler",void 0),d([m({constructOnly:!0})],Xm.prototype,"surface",void 0),d([m({readOnly:!0})],Xm.prototype,"updating",void 0),Xm=d([J("esri.views.3d.support.SurfaceGeometryUpdates")],Xm);const wrt={},xv=I(),Tv=I(),xrt=kh();let Tl=class extends ke{constructor(e){super(e),this._handles=new an,this._tmpRay=ho(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Dg({renderPointOfView:Trt},this),this.renderPointOfView=I(),this._pois=new Array,this._debugCenters=new Map}initialize(){var u;const{state:e,basemapTerrain:i,renderCoordsHelper:r,map:n}=this.view;this._surfaceIntersector=qh(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Do.MIN,this._contentIntersector=qh(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:i,renderCoordsHelper:r};this._set("centerOnSurfaceInfrequent",new uh({...l,task:Dt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new uh({...l,task:Dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new uh({...l,task:Dt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new Od({...l,cache:a,task:Dt.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new Xm({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new yrt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:r})),this._set("surfaceOrigin",new Zm({cache:a,view:this.view})),this._set("focus",new uf({state:e,scheduler:o,surface:i,renderCoordsHelper:r,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(p,f)=>this._estimateSurfaceIntersectionAtRenderPoint(p,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new s2(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new s2(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new s2(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new s2(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new s2(c,"green","Focus")),this._handles.add([Pe(()=>e.contentCamera,p=>this._cameraChanged(p),gr),Pe(()=>i.extent,()=>this._updateCenterPointsOfInterest()),Bh(()=>!i.updating,()=>this._updateCenterPointsOfInterest(),gr),$l(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),$l(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Bh(()=>Or.SHOW_POI,p=>this._setDebug(p),ar)]),this._cameraChanged(this.view.state.contentCamera);for(const p of this._pois)p.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(i=>i.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,hx,Crt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(hx):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const i=e.origin,r=xe(hx,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,i,r),this._surfaceIntersector.results.min.getIntersectionPoint(hx)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(hx)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,i,r){const n=fW(i,e,Srt);if(n==null)return null;const s=n.origin,o=xe(hx,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,i),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(r)?r:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const i=e.eye;xa(this.renderPointOfView,i)||this._set("renderPointOfView",fe(this._propertiesPool.get("renderPointOfView"),i))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(i=>i.hide()),void this._handles.remove("debug");for(const i of this._pois)this._handles.add(Pe(()=>i.renderLocation,r=>{var n;return(n=this._debugCenters.get(i))==null?void 0:n.show(r,i.renderCoordsHelper.spatialReference)},ar),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};d([m({readOnly:!0})],Tl.prototype,"centerOnContent",void 0),d([m({readOnly:!0})],Tl.prototype,"centerOnSurfaceFrequent",void 0),d([m({readOnly:!0})],Tl.prototype,"centerOnSurfaceInfrequent",void 0),d([m({readOnly:!0})],Tl.prototype,"cameraOnSurface",void 0),d([m({readOnly:!0})],Tl.prototype,"focus",void 0),d([m({readOnly:!0})],Tl.prototype,"renderPointOfView",void 0),d([m({readOnly:!0})],Tl.prototype,"surfaceOrigin",void 0),d([m({readOnly:!0})],Tl.prototype,"contentGeometryUpdates",void 0),d([m({readOnly:!0})],Tl.prototype,"surfaceGeometryUpdates",void 0),d([m({constructOnly:!0})],Tl.prototype,"view",void 0),d([m({readOnly:!0})],Tl.prototype,"updating",null),Tl=d([J("esri.views.3d.support.PointsOfInterest")],Tl);const Trt=Array,hx=I(),Srt=ho(),Crt={exclude:new Set([C_])},d3=new Ci,cP=new WeakMap;function Ert(t){nwe(t)&&d3.push(t)}function Art(t){nwe(t)&&d3.includes(t)&&d3.remove(t)}function nwe(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function swe(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:swe(e,t%e):0}let xU=0,p$=0;function Prt(){const t=Date.now();for(const e of d3)e.refreshInterval&&t-(cP.get(e)??0)+5>=6e4*e.refreshInterval&&(cP.set(e,t),e.refresh(t))}Cae(()=>{const t=Date.now();let e=0;for(const i of d3)e=swe(Math.round(6e4*i.refreshInterval),e),i.refreshInterval?cP.get(i)||cP.set(i,t):cP.delete(i);if(e!==p$){if(p$=e,clearInterval(xU),p$===0)return void(xU=0);xU=setInterval(Prt,p$)}});function Ort(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const LEt=t=>{let e=class extends t{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=yae(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||Ert(this)},()=>{})}destroy(){Art(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){m8(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{ye.getLogger(this).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return d([m({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),d([m({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),d([m()],e.prototype,"refreshParameters",null),e=d([J("esri.layers.mixins.RefreshableLayer")],e),e};let Rrt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,i){this._store.put(e,i,i.values.byteLength+256)}},Mrt=class{constructor(e,i,r,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=i,this.height=r,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:i}=this;let r=1/0,n=-1/0,s=!0;for(const o of i)o===e?this._hasNoDataValues=!0:(r=o<r?o:r,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=r,this._maxValue=n>-3e38?n:0)}},owe=class{constructor(e,i,r,n,s={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=nIe(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>ye.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,i){const r={removed:!1,eventName:e,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),il(()=>{r.removed=!0,QV(this._listeners,r),this._thread&&r.threadHandle!=null&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,i){return this.invokeMethod(this._mainMethod,e,i)}invokeMethod(e,i,r){if(this._thread){const n=this._transferLists[e],s=n?n(i):[];return this._thread.invoke(e,i,{transferList:s,signal:r})}return this._promise?this._promise.then(()=>(Ti(r),this.invokeMethod(e,i,r))):Promise.reject(null)}broadcast(e,i){return this._thread?Promise.all(this._thread.broadcast(i,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,i)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(i=>{e.removed||(e.threadHandle=i)})}},ire=class extends owe{constructor(e=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,i,r){return e&&e.byteLength!==0?this.invoke({buffer:e,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(uP.forEach((e,i)=>{e===this&&uP.delete(i)}),this.destroy())}};const uP=new Map;function $rt(t=null){let e=uP.get(t);return e||(t!=null?(e=new ire(i=>t.immediate.schedule(i)),uP.set(t,e)):(e=new ire,uP.set(null,e))),++e.ref,e}var pc,rre,nre;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(pc||(pc={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(rre||(rre={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(nre||(nre={}));let Irt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},zEt=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function VEt(t,e,i,r,n,s){const o=i-n;if(o>=0)return(e>>o)+(r-(s<<o))*(t>>o);const a=-o;return e-(s-(r<<a))*(t>>a)<<a}let GEt=class{constructor(e,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(e/r),this._cellSize=r,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][n]||null}getCellSpan(e,i,r,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function Lrt(t,e,i,r,n,s){const o=e[r++];for(let a=0;a<o;a++){const l=new Irt(s);l.xTile=e[r++],l.yTile=e[r++],l.hash=e[r++],l.priority=e[r++];const c=e[r++];for(let f=0;f<c;f++){const y=e[r++],v=e[r++],b=e[r++],x=e[r++],S=!!e[r++],P=e[r++],C=i[r++],R=i[r++],N=e[r++],$=e[r++];l.colliders.push({xTile:y,yTile:v,dxPixels:b,dyPixels:x,hard:S,partIndex:P,width:N,height:$,minLod:C,maxLod:R})}const u=t[r++];for(let f=0;f<u;f++)l.textVertexRanges.push([t[r++],t[r++]]);const p=t[r++];for(let f=0;f<p;f++)l.iconVertexRanges.push([t[r++],t[r++]]);n.push(l)}return r}function HEt(t,e,i){for(const[r,n]of t.symbols)Drt(t,e,i,n,r)}function Drt(t,e,i,r,n){const s=t.layerData.get(n);if(s.type===pc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*u)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,u]of o.iconVertexRanges)for(let p=c;p<c+u;p+=4)s.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,p=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&p===0;const f=i?Math.floor(127*u)|p<<7:p?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,u]of o.textVertexRanges)for(let p=c;p<c+u;p+=4)s.textOpacity[p/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let K4=class{constructor(e,i){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let r=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[r++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},Nrt=class extends K4{constructor(e,i){super(e,i),this.type=pc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=r[n++],this.lineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=r[n++],l=r[n++],c=r[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.memoryEstimate)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=et(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ki.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ki.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=this.layer.lineMaterial;this.vao=new Gh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},Frt=class extends K4{constructor(e,i){super(e,i),this.type=pc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=r[n++],this.fillIndexCount=r[n++],this.outlineIndexStart=r[n++],this.outlineIndexCount=r[n++];const s=r[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=r[n++],l=r[n++],c=r[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.fillVAO)==null?void 0:i.memoryEstimate)??0)+(((r=this.outlineVAO)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=et(this.fillVAO),this.outlineVAO=et(this.outlineVAO)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ki.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ki.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=n[r++],p=Ki.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,u));r+=u;const f=n[r++],y=Ki.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,f));r+=f;const v=this.layer,b=v.fillMaterial,x=v.outlineMaterial;this.fillVAO=new Gh(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new Gh(e,x.getAttributeLocations(),x.getLayoutInfo(),{geometry:p},y)}},krt=class extends K4{constructor(e,i,r){super(e,i),this.type=pc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let f=0;f<l;f++){const y=n[a++],v=n[a++],b=n[a++];this.iconPerPageElementsMap.set(y,[v,b])}const c=n[a++];for(let f=0;f<c;f++){const y=n[a++],v=n[a++],b=n[a++];this.glyphPerPageElementsMap.set(y,[v,b])}const u=n[a++],p=n[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(p),a=Lrt(n,s,o,a,this.symbols,r),this.bufferDataOffset=a}get memoryUsed(){var e,i,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.iconVAO)==null?void 0:i.memoryEstimate)??0)+(((r=this.textVAO)==null?void 0:r.memoryEstimate)??0)+$_(this.iconOpacity)+$_(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[i,r]of this.iconPerPageElementsMap)e+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)e+=r[1];return e/3}doDestroy(){this.iconVAO=et(this.iconVAO),this.textVAO=et(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,i=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===i.byteLength&&i.setSubData(e,0,0,e.length);const r=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;r.length>0&&r.byteLength===n.byteLength&&n.setSubData(r,0,0,r.length)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ki.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ki.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=n[r++],p=Ki.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,u));r+=u;const f=n[r++],y=Ki.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,f));r+=f;const v=Ki.createVertex(e,zi.STATIC_DRAW,this.iconOpacity.buffer),b=Ki.createVertex(e,zi.STATIC_DRAW,this.textOpacity.buffer),x=this.layer,S=x.iconMaterial,P=x.textMaterial;this.iconVAO=new Gh(e,S.getAttributeLocations(),S.getLayoutInfo(),{geometry:a,opacity:v},c),this.textVAO=new Gh(e,P.getAttributeLocations(),P.getLayoutInfo(),{geometry:p,opacity:b},y)}},Urt=class extends K4{constructor(e,i){super(e,i),this.type=pc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=r[n++],this.circleIndexCount=r[n++],this.bufferDataOffset=n}get memoryUsed(){var e,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((i=this.vao)==null?void 0:i.memoryEstimate)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=et(this.vao)}doPrepareForRendering(e,i,r){const n=new Uint32Array(i),s=new Int32Array(n.buffer),o=n[r++],a=Ki.createVertex(e,zi.STATIC_DRAW,new Int32Array(s.buffer,4*r,o));r+=o;const l=n[r++],c=Ki.createIndex(e,zi.STATIC_DRAW,new Uint32Array(n.buffer,4*r,l));r+=l;const u=this.layer.circleMaterial;this.vao=new Gh(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const JEt=!0,KEt=32,sre=200,zrt=1/ge("mapview-transitions-duration");let Brt=class extends os{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var r;if(this._stage===e)return;const i=this._stage;this._stage=e,e?(r=this._stage)!=null&&r.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i==null||i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=sa(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=sa(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,i;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(i=this._fadeOutResolver)==null||i.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===r)this.computedVisible=this.visible;else{const s=e*zrt;this.computedOpacity=n>r?Math.max(r,n-s):Math.min(r,n+s),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},fV=class s1{static getId(e,i,r,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${i}/${r}/${n}`}constructor(e,i,r,n){this.set(e,i,r,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|e<<8|r}acquire(e,i,r,n){this.set(e,i,r,n)}contains(e){const i=e.level-this.level;return i>=0&&this.row===e.row>>i&&this.col===e.col>>i&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new s1(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,i,r,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+i,this.col=+r,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new s1(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,i=this.row<<1,r=this.col<<1,n=this.world;return[new s1(e,i,r,n),new s1(e,i,r+1,n),new s1(e,i+1,r,n),new s1(e,i+1,r+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};fV.pool=new ea(fV,null,null,25,50);let Vrt=class extends Brt{constructor(e,i,r,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new fV(e),this.resolution=i,this.x=r,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;$H(r,o,0,0,0,a,0,n,s,1),IT(this.transforms.dvs,e.displayViewMat3,r)}},TU=class awe extends Vrt{constructor(e,i,r,n,s,o,a,l=null){super(e,i,r,n,s,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<sre}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<sre)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){var r;let i=!1;for(const n of e)if(this.layerData.has(n)){const s=this.layerData.get(n);this._memoryUsedByLayerData-=s.memoryUsed,s.type===pc.SYMBOL&&this.symbols.has(n)&&(this.symbols.delete(n),i=!0),s.destroy(),this.layerData.delete(n),this.layerCount--}(r=this._memCache)==null||r.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(lwe.delete(this),awe._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var r;let i=!1;if(e){const{bucketsWithData:n,emptyBuckets:s}=e,o=this._createRenderBuckets(n);if(s&&s.byteLength>0){const a=new Uint32Array(s);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of o)this._deleteLayerData(a),l.type===pc.SYMBOL&&(this.symbols.set(a,l.symbols),i=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l),this.layerCount++;(r=this._memCache)==null||r.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[n,s]of this.layerData)s.type===pc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const i=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*i,n=this.height/this.rangeY*i,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;IH(o),xD(o,o,s),LH(o,o,Math.PI*e.rotation/180),DH(o,o,[r,n,1])}_createTransforms(){return{dvs:Ll(),tileMat3:Ll(),tileUnitsToPixels:Ll()}}static _destroyRenderBuckets(e){if(!e)return;const i=new Set;e.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),e.clear()}_createRenderBuckets(e){const i=new Map,r=new Map;for(const n of e){const s=this._deserializeBucket(n,r);for(const o of s.layerUIDs)i.set(o,s)}return i}_deserializeBucket(e,i){let r=i.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case pc.FILL:r=new Frt(e,this.styleRepository);break;case pc.LINE:r=new Nrt(e,this.styleRepository);break;case pc.SYMBOL:r=new krt(e,this.styleRepository,this);break;case pc.CIRCLE:r=new Urt(e,this.styleRepository)}return i.set(e,r),r}_deleteLayerData(e){if(!this.layerData.has(e))return;const i=this.layerData.get(e);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(e),this.layerCount--}};const lwe=new Map;function Grt(){lwe.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(i=>console.log(i)),console.log("========"),t[1].forEach(i=>console.log(i))})}const tAt={value:.5,readOnly:!0},jrt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let $2=class{constructor(e=0,i=0){this.min=e,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},Hrt=class{constructor(e,i){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(i[2]-i[0]),this.dy=(e.width-1)/(i[3]-i[1]),this.x0=i[0],this.y1=i[3]}},Wrt=class{constructor(e,i,r){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=i,this.samplerData=new Hrt(r,i)}computeMinMaxValue(e,i,r,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,p=.5*kP;let f=(c-1)/o,y=(r-this.j*o)*f,v=(i-this.i*o)*f;if(f<1){const b=Math.floor(y),x=Math.floor(v),S=b+x*c,P=u[S],C=u[S+1],R=u[S+c],N=u[S+c+1];if(P+C+R+N<p){const $=y-b,k=v-x,B=ER(P,C,R,N,$,k),W=ER(P,C,R,N,$+f,k),Z=ER(P,C,R,N,$,k+f),K=ER(P,C,R,N,$+f,k+f);return n.min=Math.min(B,W,Z,K),n.max=Math.max(B,W,Z,K),n}y=b,v=x,f=1}else y=Math.floor(y),v=Math.floor(v),f=Math.ceil(f);for(let b=y;b<=y+f;b++)for(let x=v;x<=v+f;x++){const S=u[b+x*c];S<p?(a=Math.min(a,S),l=Math.max(l,S)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const qrt=.5*kP;function pn(t,e,i){if(i==null)return null;for(const r of i){if(!r)continue;const n=r.safeWidth;let s=$e(r.dy*(r.y1-e),0,n),o=$e(r.dx*(t-r.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=r.data.width,u=a*c+l,p=r.data.values,f=p[u],y=p[u+1],v=u+c,b=p[v],x=p[v+1];if(f+b+y+x<qrt){s-=a,o-=l;const S=f+(y-f)*o;return S+(b+(x-b)*o-S)*s}}return null}let lh=class extends ke{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(i=>{const r=i.layer;if(r.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=cwe(r.fullExtent,this.viewSpatialReference);n!=null&&e.push(Fle(n))}}),e}};function Zrt(t,e){return t===Ke.Global?new mV(e):new gV(e)}d([m({readOnly:!0})],lh.prototype,"layerViewsExtent",null),d([m({readOnly:!0})],lh.prototype,"tiledLayersExtent",null),d([m({readOnly:!0})],lh.prototype,"stencilEnabledExtents",null),d([m()],lh.prototype,"viewSpatialReference",void 0),d([m()],lh.prototype,"tilingScheme",void 0),d([m()],lh.prototype,"defaultTiledLayersExtent",void 0),d([m({constructOnly:!0})],lh.prototype,"layers",void 0),d([m({constructOnly:!0})],lh.prototype,"layerViews",void 0),lh=d([J("esri.views.3d.terrain.ExtentHelper")],lh);let mV=class extends lh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Kpe:i5e}};mV=d([J("esri.views.3d.terrain.ExtentHelperGlobal")],mV);let gV=class extends lh{_computeLayerViewsExtent(){const e=kh(),i=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=cwe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,i);X_(e,a,e)}});const r=z8(e)?e:null,n=this._get("layerViewsExtent");return U1(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const i=this.viewSpatialReference,r=kh();this.layers.forEach(o=>{if(o.loaded&&kA(o)){const a=J4(o,i,Ke.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(_N(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&X_(r,c,r)}}),X_(r,this.defaultTiledLayersExtent,r);const n=z8(r)?r:null,s=this._get("tiledLayersExtent");return U1(n,s)?s:n}};function cwe(t,e){return t==null||t.spatialReference.equals(e)?t:Uj(t,t.spatialReference,e)}gV=d([J("esri.views.3d.terrain.ExtentHelperLocal")],gV);var mi;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(mi||(mi={}));const o1=[mi.ELEVATION,mi.MAP];function uwe(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const i=Object.keys(t);for(const r of i)r.search(".glsl")!==-1&&delete t[r]}}const Xrt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let I0,Ba=class extends ke{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Or.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?lr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new an,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=ge("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){var n;const e=this.view;this.renderer=new af({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const i=()=>this.setDrawTexturesDirty();this._groundIntersector=qh(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{i(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",s=>{var o;return(o=e._stage)==null?void 0:o.renderer.setParameters({hasOverlayWater:s})}),this.renderer.events.on("renders-occluded",()=>{i(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",i),Pe(()=>e.state.camera.pixelRatio,i),Pe(()=>e.state.alignPixelEnabled,i),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),Pe(()=>{var s,o,a;return[(s=e.pointsOfInterest)==null?void 0:s.renderPointOfView,(a=(o=e.pointsOfInterest)==null?void 0:o.centerOnSurfaceFrequent)==null?void 0:a.location]},()=>this.setPlacementDirty()),Pe(()=>{var s,o;return[(s=e.state)==null?void 0:s.pixelRatio,(o=e.state)==null?void 0:o.contentPixelRatio]},()=>this.setPlacementDirty(),gr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Dt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",s=>{this._updateOverlays(Qa,s.camera,Dn.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Dn.BACKGROUND,s)})]);let r=s=>this._renderOverlayCallback(s);this._removeRenderOverlayCallback=()=>{r=()=>{}},(n=e._stage)==null||n.renderer.setParameters({renderOverlay:s=>r(s)})}_renderOverlayCallback(e){this._contentUpdated=!1;const i=this.renderer;i.processSyncDrapeSources(),i.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(i.overlays,Dn.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){var e,i;this._handles=Je(this._handles),this._removeRenderOverlayCallback(),(i=(e=this.view)==null?void 0:e._stage)==null||i.renderer.setParameters({renderOverlay:()=>{}}),I0!=null&&(I0.hide(),I0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const i=this.view.renderSpatialReference;e!=null&&i!=null?(this._renderSR=i,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new sy(-20037508342787e-6,20037508342787e-6):new sy(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,i,r){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,i,r);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Jc)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,Dn.UPDATE)}_updateOverlays(e,i,r){if(!this._spatialReference)return na.YIELD;const n=this._computeOverlayResolution(i);this._computeOverlayExtents(i,n,Rm);const s=lu(Rm.inner)/lu(Rm.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(Jr.INNER,Rm.inner,n,1*Rm.pixelRatioAdjustment,Rm.mapUnitsPerPixel),a=this._updateOverlay(Jr.OUTER,Rm.outer,n,s*Rm.pixelRatioAdjustment,Rm.mapUnitsPerPixel);o!==gf.EXTENT&&a!==gf.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(r)),o===gf.NONE&&a===gf.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const i=this.view.state.contentPixelRatio,r=e.fullWidth/e.pixelRatio*i,n=e.fullHeight/e.pixelRatio*i,s=Math.ceil(1.5*Math.max(r,n));return Math.min(hq(s),this._maxResolution)}_updateOverlay(e,i,r,n,s){if(this.renderer.overlays.length===0)return gf.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,Yrt(i,o.extent)&&r===o.resolution)return a===s?gf.NONE:gf.RERENDER_ONLY;Rg(o.extent,i),o.resolution=r;const l=LG(o.extent);return o.renderLocalOrigin=XD(l[0],l[1],0,"OV_"+this._latestOriginId++),gf.EXTENT}setTileParameters(e){const i=e.renderData.overlay;if(this.renderer.overlays.length>0){const r=this.renderer.overlays[Jr.INNER],n=this.renderer.overlays[Jr.OUTER],s=e.extent;this._rectInsideRect(r.extent,s)||this._rectanglesOverlap(s,r.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,Jr.INNER,i),this._setTileOverlayData(s,Jr.OUTER,i)):(this._clearTileOverlayData(Jr.INNER,i),this._clearTileOverlayData(Jr.OUTER,i))}else this._clearTileOverlayData(Jr.INNER,i),this._clearTileOverlayData(Jr.OUTER,i)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const i=this.renderer.overlays[Jr.INNER],r=this.renderer.overlays[Jr.OUTER],n=this._pointIsInExtent(e,i.extent)?i:r;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,i,r){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[i].extent,s=lu(n),o=up(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}r.setScale(i,lu(e)/s,up(e)/o),r.setOffset(i,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,i){i.setScale(e,-1,-1),i.setOffset(e,-1,-1)}async reloadShaders(){uwe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(Qa)}_dispatchAnimationUpdate(e){const i=e-this._animationTimeLast;if(i>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const r=i/this.surface.view._stage.renderer.animationTimeDilation,n=new i_e(this.view.state.camera,r,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,i,r,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,Qrt,i,r);if(s==null)return!1;const o=s.origin,a=xe(f$,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,i){let r=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=$e(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=f$;gS(z5(B5,lr(this.view.spatialReference).radius+l),Cu(e.eye,e.viewForward),u),Ce(u,u,e.eye);const p=oy.normalize(Jde(e.viewForward,u,e.viewRight))/e.fovY+.5,f=p<=0||p>=1?.5:n;r=c?f*p:p+f*(1-p)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),p=Math.tan(u),f=Kt(0,p,1,0),y=hu(f,f,e.projectionMatrix)[1],v=$e(.5+.5*y,0,1);r=v===1||v===0?.5:c?v*n:1-(1-v)*n}return!!this._intersectGroundFromView(e,.5,r,i)&&n5(i,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,i,r){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=I();this._findHorizonBasedPointOfInterest(e,s)||fe(s,n),Or.OVERLAY_SHOW_CENTER?(I0==null&&(I0=new s2(this.view.graphics,"red")),I0.show(s,this._renderSR)):I0!=null&&I0.hide();const o=Math.max(.1,Nr(e.eye,s)),a=by(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||Ws(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,u=c&&this._spatialReference!=null?1/lr(this._spatialReference).metersPerDegree:1,p=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/p*o*u;r.mapUnitsPerPixel=f/this._worldToPCSRatio;let y=i*f/2*OW,v=!1,b=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(y/=Math.cos(NL(s[1])),b=l[3]):(v=!0,y/=lr(this._spatialReference).metersPerDegree,b=90),y>=b&&(y=b,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let x=1;v&&(x=1/Math.max(.2,Math.cos(Math.abs(Qt(s[1])))),y*x>180&&(x=180/y),r.mapUnitsPerPixel*=x);const S=Math.log(2)/12;y=Math.exp(Math.round(Math.log(y)/S)*S);const P=y*x,C=32,R=.5*i/(C*P),N=.5*i/(C*y);s[0]=Math.round(s[0]*R)/R,s[1]=Math.round(s[1]*N)/N;const $=r.inner;$[0]=s[0]-P,$[1]=s[1]-y,$[2]=s[0]+P,$[3]=s[1]+y,this._isSpherical&&this._shiftExtentToFitBounds($,1/0,b);const k=r.outer;if(6*P>lu(l))Rg(k,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)k[0]=$[0]-P,k[1]=$[1]-y,k[2]=$[2]+P,k[3]=$[3]+y;else{Ws(e.eye,this._renderSR,f$,this._spatialReference),Tf(Sv,s,f$);let W=-Math.atan2(Sv[1],Sv[0])+.125*Math.PI;W<0&&(W+=2*Math.PI);const Z=Math.floor(W/(.25*Math.PI));ib(Sv,Xrt[Z],2*y),Sv[0]*=x,Sv[2]*=x,_G(k,$,Sv)}if(this._isSpherical)k[0]=this._longitudeCyclical.clamp(k[0]),k[2]=this._longitudeCyclical.clamp(k[2]),k[1]=Math.max(k[1],-b),k[3]=Math.min(k[3],b);else{const W=B8($,l,Jrt),Z=B8(k,l,Krt);fX(W,Z)&&(k[2]=k[0],k[3]=k[1])}const B=Math.abs($[2]-$[0])/i;r.mapUnitsPerPixel=Math.max(r.mapUnitsPerPixel,B),r.pixelRatioAdjustment=r.mapUnitsPerPixel/B}_drawOverlayTextures(e,i,r){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const n=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[Jr.INNER],r),o=this._drawOverlay(e[Jr.OUTER],r);s!==$T.CHANGED&&o!==$T.CHANGED||this.surface.updateTileOverlayParams(Dn.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),n?(this.surface.requestRender(i),i===Dn.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Dn.BACKGROUND)}_drawOverlay(e,i){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,i)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,i){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(i[0],i[2],e[0])||this._longitudeCyclical.contains(i[0],i[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],i[0]))&&!(e[1]>i[3]||e[3]<i[1]):c5(e,i))}_rectInsideRect(e,i){return i!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],i[0])&&this._longitudeCyclical.contains(e[0],e[2],i[2])&&i[1]>e[1]&&i[3]<e[3]:fX(e,i))}_pointIsInExtent(e,i){if(this._longitudeCyclical)return this._longitudeCyclical.contains(i[0],i[2],e.x)&&e.y>=i[1]&&e.y<=i[3];const r=e.x,n=e.y;return r>i[0]&&r<i[2]&&n>i[1]&&n<i[3]}_shiftExtentToFitBounds(e,i,r){let n=0,s=0;e[0]<-i?n=e[0]+i:e[2]>i&&(n=i-e[2]),e[1]<-r?s=e[1]+r:e[3]>r&&(s=r-e[3]),kL(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(Qa)}}};function Yrt(t,e){const r=Or.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r&&Math.abs(e[3]-t[3])<=r}d([m()],Ba.prototype,"_spatialReference",void 0),d([m({readOnly:!0})],Ba.prototype,"running",null),d([m()],Ba.prototype,"_placementDirty",void 0),d([m()],Ba.prototype,"_contentUpdated",void 0),d([m()],Ba.prototype,"_isSpherical",null),d([m()],Ba.prototype,"_worldToPCSRatio",null),d([m({autoDestroy:!0})],Ba.prototype,"renderer",void 0),d([m({constructOnly:!0})],Ba.prototype,"view",void 0),d([m({constructOnly:!0})],Ba.prototype,"surface",void 0),d([m()],Ba.prototype,"suspended",null),d([m()],Ba.prototype,"updating",null),d([m({type:Boolean})],Ba.prototype,"hasHighlights",null),d([m({type:Boolean})],Ba.prototype,"rendersOccluded",null),Ba=d([J("esri.views.3d.terrain.OverlayManager")],Ba);const Sv=gi(),f$=I(),Rm={inner:li(),outer:li(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Jrt=li(),Krt=li(),Qrt=ho();var gf;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(gf||(gf={}));let hwe=class _V{constructor(e,i){this._factoryCallback=e,this._lengthCallback=i,this._pool=new Map}acquire(e){if(!_V.test.disabled){const i=this._pool.get(e);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(e)}catch(i){const r=window.performance&&window.performance.memory;let n="";throw r&&(n=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+i+n),i}}release(e){if(_V.test.disabled)return;const i=this._lengthCallback(e);let r=this._pool.get(i);r||(r=new ri({shrink:!0}),this._pool.set(i,r)),r.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};hwe.test={disabled:!1};let ent=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Gr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},ore=class{constructor(e,i,r,n,s){this.attributes=e,this.localOrigin=i,this.index0=r,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Fe(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,i){this.attributes.position.getVec(e,i)}getVertexPos(e,i){this._getVertexRaw(this.getAttributeIndex(i),e),xe(e,e,this.localOrigin)}getNormal(e,i){const{typedBuffer:r,typedBufferStride:n}=this.attributes.normalCompressed;IZe(e,r,this.getAttributeIndex(i),n)}_setNormal(e,i,r,n){const{typedBuffer:s,typedBufferStride:o}=this.attributes.normalCompressed;Mb(s,e,i,r,n,o)}_setUV(e,i,r){ap(this.attributes.uv0,e,i,r)}setNormalFromValues(e,i,r,n){this._setNormal(this.getAttributeIndex(e),i,r,n)}setVertexFromValuesRawPositionUV(e,i,r,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,i,r,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,i,r,n,s,o,a,l,c){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,i,r,n),this._setUV(u,s,o),this._setNormal(u,a,l,c)}};const tnt=ln().vec3f(M.POSITION).vec2i16(M.UV0).vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}),Wq=new hwe(t=>tnt.createBuffer(t),t=>t.count);function int(){Wq.clear()}function dwe(t){return Wq.acquire(t)}function rnt(t){Wq.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const are=16384;function ap(t,e,i,r){t.setValues(e,i*are,r*are)}function Dh(t,e,i,r){t<r[0]?r[0]=t:t>r[3]&&(r[3]=t),e<r[1]?r[1]=e:e>r[4]&&(r[4]=e),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}let nnt=class{constructor(){this.sinLonLUT=new Array(LE+1),this.cosLonLUT=new Array(LE+1),this.sinLatLUT=new Array(LE+1),this.cosLatLUT=new Array(LE+1)}update(e,i,r){const n=i[0],s=i[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=r(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},m$=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},snt=class{constructor(){this.cornerNeighborData=[new m$,new m$,new m$,new m$],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},ont=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new snt}},pwe=class nL{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Je(this._current),this._next=Je(this._next),this._waiting=Je(this._waiting),this._delayed=Je(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let e=nL.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,Sg.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const i=this._fadeDuration,r=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==Ss.FADING,s=e-this._fadeStart>=i;(r||n||s)&&(Je(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=nL.test.fadeMoment||performance.now(),i=Math.max(0,e-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return this._next!=null||this._delayed!=null}push(e,i=Sg.Immediate){this._delayed=Je(this._delayed),this._push(e,i)}_push(e,i){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const r=nL.test.fadeMoment||performance.now();return i!==Sg.Immediate?(this._delayed=e,void(this._delayedTime=r+i)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(r))):void(e!=null&&(Je(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const i=this._getFadeDuration();return e+i-e%i}get _isFadingEnabled(){return this._getFadeDuration()>0}};var Sg;pwe.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(Sg||(Sg={}));var JT;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(JT||(JT={}));let fwe=class{constructor(){this._queue=new ri,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var i;const e=(i=this._last)==null?void 0:i.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},ant=class{constructor(){this._q=new ri}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let i=0;i<this._q.length;++i){const r=this._q.data[i];r.isLeaf||this._q.pushArray(r.children)}}}next(){return this._q.pop()}};function hP(t,e,i){if(e==null||e.fullExtent==null)return!1;const r=e.fullExtent,n=t.extent;if(i){if(n[0]<r.xmin||n[1]<r.ymin||n[2]>r.xmax||n[3]>r.ymax)return!1}else if(r.xmin>n[2]||r.ymin>n[3]||r.xmax<n[0]||r.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function Cg(t,e){const i=t.lij,r=e.lij;return i[0]-r[0]||i[1]-r[1]||i[2]-r[2]}function mwe(t,e,i=null){i==null||i.length===0?t===JT.BACK_TO_FRONT?e.sort(lnt):e.sort(cnt):e.sort((r,n)=>unt(r,n,t,i))}function lnt(t,e){const i=e.screenDepth-t.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function cnt(t,e){const i=t.screenDepth-e.screenDepth;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function gwe(t,e,i){const r=t.screenDepth,n=e.screenDepth;return r<n?-i:r>n?i:Cg(t,e)}function unt(t,e,i,r){return lre(t,r)===lre(e,r)?gwe(t,e,i):t?i:-i}function lre(t,e){for(const i of e)if(t.intersectsExtent(i))return!0;return!1}function hnt(t,e){const i=t.distanceToPOI-e.distanceToPOI;if(i!==0)return i;const r=t.lij,n=e.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function dnt(t,e){const i=t.length;for(let r=0;r<i;++r)t.at(r).updateDistanceToPOI(e);t.sort(hnt)}function pnt(t,e,i){let r=1,n=0,s=0;for(;t!==e;)if(r*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(e,n,s,r)}function fnt(t){for(let e=0;e<t.length;e++){const i=t[e],r=i.parent;if(r)for(let n=0;n<4;n++){const s=r.children[n];if(s&&s!==i)return!0}}return!1}function _At(t,e){if(!t||!e||t[0]===e[0])return!1;const i=t[0]<e[0],r=i?t:e,n=i?e:t,s=1<<n[0]-r[0];return Math.floor(n[1]/s)===r[1]&&Math.floor(n[2]/s)===r[2]}let qq=class{get updating(){return!!this._tileRequested}init(e,i,r,n){this.tile=e,this._layerIdx=i,this._layerClass=r,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(i,r),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,i){this._setUpsampleTile(e,i),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,Ss.FADING,i):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(e,i),n=hV(r),{minLevel:s,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?hP:()=>!0;let u=this.tile;const p=u.level;let f;const y=this._tileLayerInfo.upsampleInfo,v=y!=null?y.tile.level:-1,b=y!=null&&v-p>=a,x=n==null?void 0:n.tilemapCache,S=r.type==="vector-tile-3d"?r.schemaHelper:null;for(;u&&c(u,n,!1)&&u.level>=s;){const P=u.level,C=p-P,R=u.layerInfo[i][e];if(R.data&&C>=a){(!b||P>v)&&this._setUpsampleTile(u),R.dataInvalidated&&(f=u);break}const N=(S==null?void 0:S.getLevelRowColumn(u.lij))??u.lij;if((x==null?void 0:x.getAvailability(N[0],N[1],u.lij[2]))!=="unavailable"&&P<=o&&!R.data&&!R.dataMissing&&((!f||u.level===s||P%Jpe==0||p-f.level<a)&&(f=u),C>=l))break;u=u.parent}if(f!=null&&p-f.level<a)if(y)f=null;else{const P=this._findAncestorWithData();P!=null&&(this._setUpsampleTile(P),f=P.layerInfo[i][e].dataInvalidated?P:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,i=this._desiredMinLevelDelta;let r;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=i)return n;r=n}return r}_setUpsampleTile(e,i){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,Ss.FADING,i)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},mnt=class extends qq{get _desiredMinLevelDelta(){throw cre}get _progressiveLevelModulo(){throw cre}dispose(){}};const cre=new Error("Abstract method called on TileAgent"),Xl=new mnt;let _we=class extends qq{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return Vz(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},ywe=class extends qq{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Jpe}};var J1,Ib;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(J1||(J1={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(Ib||(Ib={}));function gnt(t){t.fragment.uniforms.add(new vt("u_colormap",e=>e.u_colormap),new je("u_colormapOffset",e=>e.colormap.u_colormapOffset),new je("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new je("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(T`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function _nt(t){t.fragment.uniforms.add(new vt("u_transformGrid",e=>e.u_transformGrid),new Bi("u_transformSpacing",e=>e.common.u_transformSpacing),new Bi("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(T`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let vwe=class extends wr{constructor(){super(...arguments),this.scale=1,this.offset=fp}};function bwe(t){t.attributes.add(M.POSITION,"vec2"),t.attributes.add(M.UV0,"vec2"),t.vertex.uniforms.add(new je("scale",e=>e.scale)),t.vertex.uniforms.add(new Bi("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let ynt=class extends vwe{constructor(e,i,r){super(),this.common=e,this.u_image=i,this.u_transformGrid=r}};function vnt(t,e){t.include(_nt),t.fragment.uniforms.add(new vt("u_image",r=>r.u_image),new kf("u_flipY",r=>r.common.u_flipY),new kf("u_applyTransform",r=>r.common.u_applyTransform));const{requireBilinearWithNN:i}=e;i&&t.fragment.uniforms.add(new Bi("u_srcImageSize",r=>r.common.u_srcImageSize)),t.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),i?t.fragment.code.add(T`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(T`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var We;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(We||(We={}));const yV={normal:We.Normal,average:We.Average,lighten:We.Lighten,lighter:We.Lighter,screen:We.Screen,plus:We.Plus,"color-dodge":We.ColorDodge,darken:We.Darken,multiply:We.Multiply,"color-burn":We.ColorBurn,overlay:We.Overlay,"soft-light":We.SoftLight,"hard-light":We.HardLight,"vivid-light":We.VividLight,hue:We.Hue,saturation:We.Saturation,luminosity:We.Luminosity,color:We.Color,difference:We.Difference,exclusion:We.Exclusion,minus:We.Minus,invert:We.Invert,reflect:We.Reflect,"destination-over":We.DestinationOver,"destination-atop":We.DestinationAtop,"destination-in":We.DestinationIn,"destination-out":We.DestinationOut,"source-atop":We.SourceAtop,"source-in":We.SourceIn,"source-out":We.SourceOut,xor:We.Xor};function bnt(t){return t===We.DestinationOver||t===We.DestinationAtop||t===We.DestinationIn||t===We.DestinationOut||t===We.SourceAtop||t===We.SourceIn||t===We.SourceOut||t===We.Xor}function Zq(t){t.code.add(T`
    float lineFactorAtPosition(float value) {
      float pos = value * ${T.float(257)};
      if(pos < 0.5 || pos > ${T.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function wnt(t,e){const i=e.blendMode;i!==We.Normal&&(i===We.Reflect&&t.code.add(T`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==We.ColorDodge&&i!==We.VividLight||t.code.add(T`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==We.ColorBurn&&i!==We.VividLight||t.code.add(T`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===We.Overlay&&t.code.add(T`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===We.HardLight&&t.code.add(T`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===We.SoftLight&&t.code.add(T`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===We.VividLight&&t.code.add(T`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==We.Hue&&i!==We.Saturation&&i!==We.Color&&i!==We.Luminosity||(t.code.add(T`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==We.Hue&&i!==We.Saturation||t.code.add(T`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(T`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===We.Multiply?T`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Average?T`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Lighten?T`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Darken?T`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Lighter?T`return vec4(cl * ol + cb * ob, ol + ob);`:i===We.Plus?T`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===We.Minus?T`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===We.Screen?T`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Difference?T`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Invert?T`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===We.DestinationOver?T`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===We.DestinationAtop?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===We.DestinationOut?T`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===We.SourceAtop?T`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===We.SourceOut?T`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===We.Xor?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===We.DestinationIn?T`return vec4(cb * ob * ol, ol * ob);`:i===We.SourceIn?T`return vec4(cl * ol * ob, ol * ob);`:i===We.Hue?T`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Saturation?T`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Color?T`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Luminosity?T`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Exclusion?T`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Reflect?T`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.ColorDodge?T`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.ColorBurn?T`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.Overlay?T`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.SoftLight?T`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.HardLight?T`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===We.VividLight?T`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:T``}
    }
  `))}var Bs,ep,Bd;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Bs||(Bs={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(ep||(ep={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(Bd||(Bd={}));function wwe(t,e){const i=e.output===Bs.GridComposite,r=e.output===Bs.ColorComposite,n=e.output===Bs.GroupBackgroundComposite,s=e.output===Bs.Composite;i&&t.fragment.include(Zq),r&&t.fragment.uniforms.add(new ei("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===ep.Required;o&&t.fragment.uniforms.add(new je("baseOpacity",c=>c.baseOpacity)),s&&t.fragment.uniforms.add(new vt("fboColor",c=>c.fboTexture));const a=e.blendMode!==We.Normal,l=e.premultipliedSource===Bd.On;t.fragment.include(wnt,e),t.fragment.code.add(T`
    vec4 getBackground(vec2 uv) {
      return ${o?T`baseOpacity *`:""} ${n?T`vec4(0.0, 0.0, 0.0, 0.0)`:r?T`vec4(backgroundColor, 1.0)`:i?T`vec4(gridColor(uv), 1.0)`:T`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?T`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:T`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?T`colorLayer * opacity;`:T`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let Q4=class extends ynt{constructor(e,i,r,n,s,o){super(e,n,s),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=tl,this.fboTexture=null,this.baseOpacity=1}},xnt=class extends Q4{},Tnt=class extends Q4{};function Snt(t){const e=new Fi;return e.include(bwe),e.include(vnt,t),e.include(gnt,t),e.include(wwe,t),e.fragment.code.add(T`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===J1.Stretch?Ent(e,t):t.colorizerType===J1.Lut?Cnt(e):t.colorizerType===J1.Hillshade&&Ant(e,t),e}function Cnt(t){t.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Ent(t,e){t.fragment.uniforms.add(new uO("u_bandCount",r=>r.symbolizer.u_bandCount),new Ol("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Ol("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Ol("u_factor",r=>r.symbolizer.u_factor,3),new je("u_minOutput",r=>r.symbolizer.u_minOutput),new je("u_maxOutput",r=>r.symbolizer.u_maxOutput),new kf("u_useGamma",r=>r.symbolizer.u_useGamma),new Ol("u_gamma",r=>r.symbolizer.u_gamma,3),new Ol("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new je("u_opacity",r=>r.common.u_opacity)),t.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=e.applyColormap?T`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:T`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===Ib.Noop?T`
        fragColor = applyBackgroundBlend(currentPixel);`:T`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function Ant(t,e){const i=t.fragment;i.uniforms.add(new vt("u_image",n=>n.u_image),new uO("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new Ol("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new Ol("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new Ol("u_cosZs",n=>n.symbolizer.u_cosZs,6),new Ol("u_weights",n=>n.symbolizer.u_weights,6),new Bi("u_factor",n=>n.symbolizer.u_factor),new je("u_minValue",n=>n.symbolizer.u_minValue),new je("u_maxValue",n=>n.symbolizer.u_maxValue),new Bi("u_srcImageSize",n=>n.common.u_srcImageSize)),i.include(am),i.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),i.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=e.applyColormap?T`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:T`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Pnt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:Tnt,ColorizerStretchUniforms:xnt,ColorizerUniforms:Q4,build:Snt},Symbol.toStringTag,{value:"Module"}));function Ont(t,e,i="nearest",r=!1){var c;const n=!(r&&e.pixelType==="u8"),s=n?ss.FLOAT:ss.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new Di;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===xi.WEBGL2&&n?mt.RGBA32F:Gt.RGBA,l.samplingMode=!a||i!=="bilinear"&&i!=="cubic"?qt.NEAREST:qt.LINEAR,l.dataType=s,l.wrapMode=Jt.CLAMP_TO_EDGE,new Wt(t,l,o)}function Rnt(t,e){const{spacing:i,offsets:r,coefficients:n,size:[s,o]}=e,a=i[0]>1,l=new Di;l.width=a?4*s:s,l.height=o,l.internalFormat=t.type===xi.WEBGL2?mt.RGBA32F:Gt.RGBA,l.dataType=ss.FLOAT,l.samplingMode=qt.NEAREST,l.wrapMode=Jt.CLAMP_TO_EDGE;const c=new Float32Array(a?s*o*16:2*r.length);if(a&&n!=null)for(let u=0,p=0;u<n.length;u++)c[p++]=n[u],u%3==2&&(c[p++]=1);else for(let u=0;u<o;u++)for(let p=0;p<s;p++){const f=4*(u*s+p),y=2*(p*o+u);c[f]=r[y],c[f+1]=r[y+1],c[f+3]=r[y]===-1?0:1}return new Wt(t,l,c)}function ure(t,e){const i=new Di;return i.internalFormat=Gt.RGBA,i.width=e.length/4,i.height=1,i.samplingMode=qt.NEAREST,i.wrapMode=Jt.CLAMP_TO_EDGE,new Wt(t,i,e)}function Mnt(t,e,i,r=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:r,u_transformSpacing:t?t.spacing:fp,u_transformGridSize:t?t.size:fp,u_targetImageSize:e,u_srcImageSize:i}}function $nt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function Int(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function Lnt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const hre={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let Dnt=class{constructor(e,i,r=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=i,this.width=r||i.width,this.height=n||i.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=et(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...hre,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||hre}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((i,r)=>{var n;return!!((n=this._bandIds)!=null&&n[r])&&i===this._bandIds[r]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const i=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(i==="bilinear"?qt.LINEAR:qt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=et(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=Rnt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:i,width:r,height:n,opacity:s}=this,o=Mnt(i,[r,n],[this.source.width,this.source.height],s),a=$nt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?Int(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Lnt(this.symbolizerParameters):null;return new Q4(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(i=>i!=null?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=et(this._rasterTexture),this._transformGridTexture=et(this._transformGridTexture),this._colormapTexture=et(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=et(this._rasterTexture));const n=i==null&&this.bandIds==null||i!=null&&this.bandIds!=null&&i.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=et(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Ont(e,r,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((n,s)=>n!==i[s])?(this._colormapTexture=et(this._colormapTexture),this._colormapTexture=ure(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=ure(e,r),void(this._colormap=r)):(this._colormapTexture=et(this._colormapTexture),void(this._colormap=null))}},sL=class{constructor(){this.waitingAgents=new ri,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const i=SU.acquire();return i._init(e),i}release(){this.dispose(),oL.delete(this),SU.release(this)}dispose(){this.loadingAgent=et(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=eT(this._data)}static prune(){SU.prune(0)}_init(e){this.waitingAgents.clear(),this._data=eT(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=wu(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,i){if(e!==i&&i!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),pnt(e,i,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){eT(this._data),this._data=e}};const SU=new ea(sL,null,()=>{}),oL=new Map;function Nnt(){oL.size>0&&(console.log(`${oL.size} live TilePerLayerInfo allocations:`),oL.forEach(t=>console.log(t,`
`)))}let o2=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var Ut;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(Ut||(Ut={}));const Fnt=.1;let Xq=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=li(),this._elevationBounds=it(),this.layerInfo=[[],[]],this.extentInRadians=li(),this.centerAtSeaLevel=I(),this._center=[I(),kn(),I()],this.up=pG(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=I()}static prune(){Yq.prune(0),Jq.prune(0),sL.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[rs.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,i=(e==null?void 0:e.frustumVisibility)??_a.INTERSECTS;this._frustumVisibility=i===_a.INSIDE?_a.INSIDE:i===_a.OUTSIDE?_a.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const r=this._frustumVisibility!==_a.OUTSIDE&&this._intersectsClippingArea;r!==this._visible&&(this._visible=r,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,i,r){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=lr(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[rs.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,i&&i.elevationBounds?Is(this._elevationBounds,i.elevationBounds):bi(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const n of o1){const s=r.numLayers(n),o=this.layerInfo[n];for(const a of o)a.release();o.length=s;for(let a=0;a<s;a++)o[a]=sL.acquire(this._surface.upsampleInfoPool),n===mi.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,LE)}release(){vf(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of o1){for(const i of this.layerInfo[e])i.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[mi.MAP].reduce((e,i)=>e+(i instanceof TU?i.memoryUsed/i.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){var r;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:n}of this.layerInfo[mi.MAP])n instanceof TU?e+=this._getTerrainDataMemory(n):this._mapTileMemoryInternal+=this._getTerrainDataMemory(n);const i=this._cpuImageMemorySize;for(const n of this.layerInfo[mi.ELEVATION])this._usedMemory+=n.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((r=this.renderData.texture)==null?void 0:r.gpuMemoryUsage)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,i){const r=this.layerInfo[e][i];return r!=null&&r.data?e===mi.MAP?this._isCached?0:this._getTerrainDataMemory(r.data):e===mi.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof o2?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof X4?this._cpuImageMemorySize:e instanceof Dnt?e.memoryUsage:e instanceof TU?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const i=this._center[rs.MIDDLE],r=e,n=i[0],s=i[1],o=i[2],a=r[2]*n+r[6]*s+r[10]*o+r[14];this.screenDepth=a<0?0:a/(r[3]*n+r[7]*s+r[11]*o+r[15])}shouldSplit(e,i,r){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===_a.OUTSIDE))return Ut.NONE;const n=this.level;Ce(_$,this._center[rs.MIDDLE],i);let s=ba(_$),o=_$,a=rs.MIDDLE;Ce(CU,this._center[rs.TOP],i);const l=ba(CU);l<s&&(s=l,o=CU,a=rs.TOP),Ce(EU,this._center[rs.BOTTOM],i);const c=ba(EU);if(c<s&&(s=c,o=EU,a=rs.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return Ut.SPLIT;const u=r!=null?r-n:1/0,p=Math.sqrt(s),f=e.fovX*p*2,y=this._edgeLen/f,v=()=>{if(n<e.maxLod)return this.elevationLevel=n,Ut.NONE;const k=n+Math.ceil(-Math.log2(e.relativeWidthLimit/y));return k!==this.elevationLevel?(this.elevationLevel=k,Ut.ELEVATION):Ut.NONE};if(u<=.5)return v();const b=Re(this.up,_$),x=this._elevationBounds[1]-this._elevationBounds[0],S=x/this.edgeLen;if(e.aboveGround&&b>0&&S<.001&&b/p-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-S>0)return Ut.NONE;const P=r!=null?3-Math.min(u,2):1;if(y*P<e.relativeWidthLimit||n>=e.maxLod)return v();if(n<7)return Ut.SPLIT;pe(wo,this.up,b),Ce(wo,wo,o);const C=ba(wo);if(C<=this.radius*this.radius)return Ut.SPLIT;pe(wo,wo,this.radius/Math.sqrt(C)),xe(wo,wo,this._center[a]),Ce(wo,i,wo);const R=Math.min(1,(Math.abs(Re(wo,this.up))+.5*x+this._curvatureHeight)/ze(wo)),N=Fnt/e.angledSplitBias,$=e.fovY*p*2;return R*(this._edgeLen/$*P)<N*e.relativeHeightLimit?Ut.NONE:Ut.SPLIT}setChildren(e,i,r,n){vf(!!(e&&i&&r&&n),"Null child passed"),this._children[0]=e,this._children[1]=i,this._children[2]=r,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of o1)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const i of o1){const r=this.layerInfo[i];for(const n of r)n.loadingAgent&&n.loadingAgent!==Xl&&(g$(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(Ut.GEOMETRY),this.resetPendingUpdate(Ut.TEXTURE_NOFADING),this.resetPendingUpdate(Ut.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[mi.MAP];for(const i of e)i.loadingAgent&&i.loadingAgent!==Xl&&(g$(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(U1(e,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=r&&this._isWithinClippingArea,s=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(Ut.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,i){return this.layerInfo[i][e]}hasLayerData(e,i){const r=this.layerInfo[i][e];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of o1){const i=this.layerInfo[e];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==Xl&&r.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(Ut.SPLIT)||e!==mi.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===Ut.SPLIT||e===Ut.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,i,r){const n=this.layerInfo[i][e];if(n.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e),!0;if(n.waitingAgents.push(r),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,e);const a=n.data&&"type"in n.data&&n.data.type==="vector-tile";return r.dataArrived(this,a),!0}if(n.requestPromise)return!0;wu(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,i,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const i=this._children;return i[0]?i[0].findByLij(e)||i[1].findByLij(e)||i[2].findByLij(e)||i[3].findByLij(e):null}distanceToSquared(e){return ba(Ce(wo,this._center[rs.MIDDLE],e))}containsPoint(e){const i=this.extent;return e[0]>=i[0]&&e[1]>=i[1]&&e[0]<=i[2]&&e[1]<=i[3]}containsPointXY(e,i){const r=this.extent;return e>=r[0]&&i>=r[1]&&e<=r[2]&&i<=r[3]}unrequestLayerData(e,i,r){const n=this.layerInfo[i][e],s=n.waitingAgents,o=s.removeUnordered(r)!=null;vf(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,i,r){const n=r!=null&&"type"in r&&r.type==="vector-tile",s=this.layerInfo[i][e];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${e} error ${r}`);const n=this.layerInfo[i][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,i,r){switch(r&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,i)),e){case mi.MAP:return this._updateTexture(i);case mi.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===Ss.FADING?Ut.TEXTURE_NOFADING:Ut.TEXTURE_FADING),this.setPendingUpdate(e===Ss.FADING?Ut.TEXTURE_FADING:Ut.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Ut.GEOMETRY);for(const e of this.layerInfo[mi.ELEVATION])e.pendingUpdates|=Ut.GEOMETRY}invalidateLayerData(e,i){this.layerInfo[i][e].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const e=this._elevationBounds,i=e[0],r=e[1];bi(e,1/0,-1/0);const n=this.layerInfo[mi.ELEVATION];let s=!0;for(const o of n)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),i===e[0]&&r===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,i=.5*(e[0]+e[1]),r=this._center;pe(wo,this.up,i),xe(r[rs.MIDDLE],this.centerAtSeaLevel,wo),pe(wo,this.up,e[0]),xe(r[rs.TOP],this.centerAtSeaLevel,wo),pe(wo,this.up,e[1]),xe(r[rs.BOTTOM],this.centerAtSeaLevel,wo)}findElevationBoundsForLayer(e,i){const r=this.layerInfo[mi.ELEVATION][e],n=Vz(this.level),s=Math.max(this.elevationLevel-n,0),o=r.elevationBounds;if(o!=null&&o.level>=i&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,mi.ELEVATION),l=hV(a);if(!hP(this,l,!1))return;const c=Unt;let u=!1;const p=r.data;if(p&&p.level<=s){const f=r.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let f,y,v=0;for(let b=this._parent;b&&(!y||v<n)&&(v=this.elevationLevel-b.level,f=y||f,y=b.layerInfo[mi.ELEVATION][e].data,!(!y&&f&&b.level<=s));b=b.parent);y=y||f,y&&(y.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=y.level,u=!0))}u&&(r.elevationBounds==null&&(r.elevationBounds=new $2),r.elevationBounds.copyFrom(c))}modifyLayers(e,i,r){const n=this.layerInfo[r];for(const a of n)a.loadingAgent&&a.loadingAgent!==Xl&&(g$(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=i.length;n.length=o;for(let a=0;a<o;a++){const l=i[a];n[a]=l>-1?s[l]:sL.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,Ss.FADING))}updateAgents(e){if(this.renderData){const i=this.layerInfo[e];for(const r of i)r.loadingAgent===Xl&&(r.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of o1){const i=this._isSuspended(e);for(const r of this.layerInfo[e])r.loadingAgent&&r.loadingAgent!==Xl&&(r.loadingAgent.setSuspension(i),r.loadingAgent===Xl&&this.updateRenderData(e,Ss.FADING))}}removeLayerAgent(e,i){const r=this.layerInfo[i][e];r.loadingAgent&&r.loadingAgent!==Xl&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(e,i){const r=this.layerInfo[i][e];r.loadingAgent=Xl,r.data||r.upsampleInfo!=null||this._createOrUpdateAgents(e+1,i)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||ET(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,i,r){var n,s,o;for(let a=e;a<i;++a){const l=this._surface.layerViewByIndex(a,r);if(yN(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||ET((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,i){const r=this.layerInfo[i];if(r.length===0)return;const n=this._isSuspended(i);for(let s=e;s<r.length;++s){const o=r[s];let a=!1;const l=this._surface.layerViewByIndex(s,i),c=hV(l);if(o.loadingAgent?hP(this,c,!1)?(o.loadingAgent!==Xl&&o.loadingAgent.setSuspension(n),o.loadingAgent!==Xl&&(a=o.loadingAgent.update())):o.dispose():hP(this,c,!1)&&(o.loadingAgent=knt(this,s,i,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Xl&&this.setPendingUpdate(Ut.GEOMETRY):(g$(o.loadingAgent),o.loadingAgent=Xl)),o.loadingAgent===Xl&&this.updateRenderData(i,Ss.FADING),!this._hasBlendModes(e,r.length,i)&&a&&l.isOpaque)return}}_isWithinExtent(e){const i=this.extent;return i[0]>=e[0]&&e[2]>=i[2]&&i[1]>=e[1]&&e[3]>=i[3]}intersectsExtent(e){const i=this.extent;return i[2]>=e[0]&&e[2]>=i[0]&&i[3]>=e[1]&&e[3]>=i[1]}getElevationVerticesPerSide(e){const i=this.elevationLevel-this.level,r=Math.max(this.level-e,Vz(this.level)-i),n=$e(1+(this.maxTesselation>>r),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,i){if(!e)return null;const r=this.surface.rootTiles;if(r!=null){for(const n of r)if(znt(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!i(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return i(s)?s:null}}return null}findNeighborTile(e,i){const r=this.lij,n=this.getNeighborLIJ(r,e);return n?Bnt(r,n)?i(this)?this:null:this._findLIJ(n,i):null}findCorner(e,i){const r=e===Et.NORTH_EAST?1:e===Et.NORTH_WEST?0:e===Et.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!i||!i(n));)n=n.children[r];return n}findNeighborCornerTileExact(e,i){var r;return((r=this.findNeighborTile(e,n=>i(n)||n.level===this.level))==null?void 0:r.findCorner(vN(e),i))||null}forAllSubtreeOnSide(e,i){const r=e===Et.NORTH?[0,1]:e===Et.NORTH_EAST?[1]:e===Et.EAST?[1,3]:e===Et.SOUTH_EAST?[3]:e===Et.SOUTH?[2,3]:e===Et.SOUTH_WEST?[2]:e===Et.WEST?[0,2]:[0],n=s=>{const o=s.children;!i(s)&&o[0]&&r.forEach(a=>n(o[a]))};n(this)}forallNeighbors(e){h3.forEach(i=>this.findNeighborCornerTileExact(i,e)),Of.forEach(i=>{var r;return(r=this.findNeighborTile(i,n=>n.level===this.level||e(n)))==null?void 0:r.forAllSubtreeOnSide(bN(i),e)})}getNeighborEdgeStartVertexIndex(e,i){if(!i)return 0;const r=this.level-i.level;if(Fe(!Ps||r>=0),r===0)return 0;const n=2**r,s=(1&e)==1,o=s?0:1,a=i.lij[o+1]*n,l=this.lij[o+1],c=l-a,u=s?n-1-c:c;return Ps&&(Fe(a<=l&&l<a+n),Fe(0<=u&&u<n)),u}forEachLoadedNeighbor(e){const i=this.level,r=n=>n.level===i||n.isLoaded;Of.forEach(n=>{const s=this.findNeighborTile(n,r);s!=null&&s!==this&&s.forAllSubtreeOnSide(bN(n),o=>!!o.isLoaded&&(e(o,n),!0))}),h3.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,r))==null?void 0:o.findCorner(vN(n),a=>a.isLoaded);Fe(!s||vV(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,i){const r=Qie(i)?-1:Kie(i)?1:0,n=Yie(i)?-1:Jie(i)?1:0,s=[e[0],e[1]+r,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,i=(e==null?void 0:e[1])??null;return i!=null&&this.extent[1]+ol()>=i}checkGeometryWaterproofness(){var e;gN&&(Fe(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const i=this.extent,r=this.surface.rootTilesExtent,n=.25*(i[2]-i[0]);if(Qie(e)&&i[3]+n>=r[3]||Kie(e)&&i[1]-n<=r[1])return!1;const s=this.surface.isGlobal;return!(!s&&Yie(e)&&i[0]-n<=r[0])&&!(!s&&Jie(e)&&i[2]+n>=r[2])}updateDistanceToPOI(e){const i=this._lastPOI;if(this.distanceToPOI>=0&&i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2])return;fe(this._lastPOI,e);const r=this._center[rs.MIDDLE],n=e[0]-r[0],s=e[1]-r[1],o=e[2]-r[2];this.distanceToPOI=n*n+s*s+o*o}};function knt(t,e,i,r){const n=i===mi.ELEVATION?Jq.acquire():Yq.acquire();return n.init(t,e,i,r),n}function g$(t){t.dispose(),t instanceof _we?Jq.release(t):t instanceof ywe&&Yq.release(t)}const Yq=new ea(ywe),Jq=new ea(_we),Unt=new $2;var rs;function znt(t,e){const i=t.level,r=e[0];if(i>r)return!1;const n=r-i,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function Bnt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Vnt(t,e,i){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&i===Et.EAST||t.isWestEnd&&e.isEastEnd&&i===Et.WEST))return!0;const r=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(i){case Et.NORTH:return bh(t.extent[3],e.extent[1],r);case Et.SOUTH:return bh(t.extent[1],e.extent[3],r);case Et.EAST:return bh(t.extent[2],e.extent[0],r)||bh(t.extent[2],-e.extent[0],r);case Et.WEST:return bh(t.extent[0],e.extent[2],r)||bh(t.extent[0],-e.extent[2],r)}}function vV(t,e,i){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?dre(t,e,i):dre(e,t,vN(i)))}function dre(t,e,i){Fe(t.level>=e.level);const r=rrt(i),n=nrt(i),s=t.extent,o=e.extent,a=[r?s[0]:s[2],n?s[3]:s[1]],l=[r?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=bh(a[0],l[0],c)||t.surface.isGlobal&&bh(a[0],-l[0],c),p=bh(a[1],l[1],c);if(u&&p)return!0;if(t.level===e.level||!u&&!p)return Fe(!1),!1;const f=u?pre(o[1],o[3],s[1],s[3],c):pre(o[0],o[2],s[0],s[2],c);return Fe(f),f}function pre(t,e,i,r,n){return t-n<=i&&i<=r&&r<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(rs||(rs={}));const _$=I(),CU=I(),EU=I(),wo=I();let Gnt=class{constructor(){this._scales=Kt(-1,-1,-1,-1),this._offsets=Kt(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,i,r){this._scales[2*e]=i,this._scales[2*e+1]=r}setOffset(e,i,r){this._offsets[2*e]=i,this._offsets[2*e+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}};function jnt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let Kq=class extends Mve{constructor(){super(...arguments),this.slicePlaneLocalOrigin=I(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var _c;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(_c||(_c={}));let Hnt=class extends Kq{constructor(){super(...arguments),this.identifier=_c.Material,this.output=j.Color,this.transparent=!1,this.integratedMesh=!1}},Wnt=class extends Kq{constructor(){super(...arguments),this.identifier=_c.ShadowMap}},qnt=class extends Kq{constructor(){super(...arguments),this.identifier=_c.Highlight}},wN=class extends On{constructor(e,i){super(e,"vec4",vr.Draw,(r,n,s)=>r.setUniform4fv(e,i(n,s)))}};var Eg;function Znt(t,e){const{vertex:i,fragment:r}=t;i.uniforms.add(new wN("overlayTexOffset",(n,s)=>Xnt(n,s)),new wN("overlayTexScale",(n,s)=>Ynt(n,s))),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new vt("ovColorTex",(n,s)=>bV(n,s))),xwe(t,e)}function xwe(t,e){e.pbrMode!==Ct.Water&&e.pbrMode!==Ct.WaterOnIntegratedMesh&&e.pbrMode!==Ct.TerrainWithWater||t.include(Lve,e);const{vertex:i,fragment:r}=t;t.varyings.add("vtcOverlay","vec4"),i.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),r.code.add(T`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==Ct.Water&&e.pbrMode!==Ct.WaterOnIntegratedMesh&&e.pbrMode!==Ct.TerrainWithWater||(jg(r),om(r),r.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function bV(t,e){return e.overlays.length===0?null:t.identifier===_c.Material&&t.output===j.Color?e.overlays[Jr.INNER].getColorTextureNoRasterImage():t.identifier===_c.Material&&t.output===j.ObjectAndLayerIdColor?e.overlays[Jr.INNER].getColorTexture(Wa.ObjectAndLayerIdColor):t.identifier===_c.Highlight?e.overlays[Jr.INNER].getValidTexture(xn.Highlight):null}function Xnt(t,e){for(const i of e.overlays){const{index:r,extent:n}=i;kle(n)>0&&(tT[2*r]=t.toMapSpace[0]/lu(n)-n[0]/lu(n),tT[2*r+1]=t.toMapSpace[1]/up(n)-n[1]/up(n))}return tT}function Ynt(t,e){for(const i of e.overlays){const{index:r,extent:n}=i;kle(n)>0&&(tT[2*r]=t.toMapSpace[2]/lu(n),tT[2*r+1]=t.toMapSpace[3]/up(n))}return tT}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(Eg||(Eg={}));const tT=gi();var Rf;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(Rf||(Rf={}));let Jnt=class extends fq{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=Wa.None}};function ZC(t,e){t.vertex.uniforms.add(new xN("overlayTexOffset"),new xN("overlayTexScale")),t.fragment.uniforms.add(new je("overlayOpacity",i=>i.overlayOpacity),new vt("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[Jr.INNER].getColorTexture(i.overlaySource))),xwe(t,e)}function Knt(t,e){const{vertex:i,fragment:r,varyings:n}=t;n.add("vtc","vec2"),i.uniforms.add(new xN("texOffsetAndScale")),r.uniforms.add(new fre("tex")),r.uniforms.add(new AU("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(i.uniforms.add(new xN("nextTexOffsetAndScale")),n.add("nvtc","vec2"),r.uniforms.add(new fre("texNext")),r.uniforms.add(new AU("nextTexOpacities")),r.uniforms.add(new Qnt("fadeFactor")));const o=e.tileBlendInput===Rf.ColorComposite,a=e.tileBlendInput===Rf.GridComposite;a&&r.include(Zq),o&&r.uniforms.add(new AU("backgroundColor")),i.code.add(T`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),r.code.add(T`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?T`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?T`backgroundColor`:T`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:T`return color;`}
    }`),s?r.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):r.code.add(T`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Qnt=class extends On{constructor(e){super(e,"float")}},AU=class extends On{constructor(e){super(e,"vec3")}},xN=class extends On{constructor(e){super(e,"vec4")}},fre=class extends On{constructor(e){super(e,"sampler2D")}},Twe=class extends Jnt{};function est(t){const e=new Fi,{vertex:i,fragment:r,varyings:n}=e;e.include(q3),e.include(cO,t),e.include(Ff,t);const s=()=>{e.include(s3,t),i.code.add(T`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};Tc(i,t),e.include(Ml,t);const o=t.overlayMode!==Eg.Disabled,a=o&&t.invisible;switch(t.output){case j.Color:{e.include(Knt,t),e.include($b,t),o&&e.include(ZC,{...t,pbrMode:t.pbrMode===Ct.Terrain?Ct.TerrainWithWater:Ct.Water});const l=t.overlayMode===Eg.EnabledWithWater;l&&e.include(jnt,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&UT(i);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(vS,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),i.code.add(T`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?T`forwardVertexTangent(vnormal);`:T``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?T`setOverlayVTC(uv);`:""}
          ${t.tileBorders?T`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?T`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?T`forwardLinearDepth();`:""}

        }
      `),e.include(Nn,t),e.include($b,t),e.include(hO,t),e.include(Rb,t),gp(r,t),dO(r),PS(r),r.uniforms.add(i.uniforms.get("localOrigin"),new ei("viewDirection",(u,p)=>Me(mre,me(mre,p.camera.viewMatrix[12],p.camera.viewMatrix[13],p.camera.viewMatrix[14])))),l&&r.uniforms.add(new vt("ovWaterTex",(u,p)=>p.overlays.length===0?null:p.overlays[Jr.INNER].getNormalTexture(u.overlaySource)),new j0e("view",(u,p)=>Dl(tst,p.camera.viewMatrix,u.origin))),r.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),jg(r),om(r),r.code.add(T`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?T`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?T`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Ct.Terrain||t.pbrMode===Ct.TerrainWithWater?T`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:T`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?T`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?T`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?T`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:T`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?T`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case j.Depth:a&&e.include(ZC,t),e.include(Ug,t),gy(e),Tb(e),i.code.add(T`
              void main(void) {
                ${a?T`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),r.code.add(T`
              void main() {
                ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case j.Shadow:case j.ShadowHighlight:case j.ShadowExcludeHighlight:e.include(Ug,t),gy(e),Tb(e),i.code.add(T`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(T`void main() {
outputDepth(linearDepth);
}`);break;case j.Normal:a&&e.include(ZC,t),n.add("vnormal","vec3"),UT(i),s(),i.code.add(T`
            void main(void) {
              ${a?T`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),r.code.add(T`
            void main() {
              ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case j.Highlight:o&&e.include(ZC,t),i.code.add(T`
          void main() {
            ${o?T`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(Kg,t),r.code.add(T`
          void main() {
            ${o?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===j.ObjectAndLayerIdColor&&(e.include(ZC,{...t,pbrMode:Ct.Disabled}),i.code.add(T`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),r.code.add(T`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const tst=Ne(),mre=I(),ist=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Twe,build:est},Symbol.toStringTag,{value:"Module"}));let Swe=class Cwe extends qi{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,i){i.spherical=e.viewingMode===Ke.Global}initializeProgram(e){return new Gi(e.rctx,Cwe.shader.get().build(this.configuration),Ewe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return Zt({blending:i.renderOccluded?Ec(De.ONE,De.ONE_MINUS_SRC_ALPHA):null,culling:r?xH:null,depthTest:i.renderOccluded?null:{func:br.LESS},depthWrite:i.renderOccluded?null:Nl,colorWrite:ni,stencilTest:e?mqe(Il.IntegratedMeshMaskExcluded):null})}getPipelineState(e,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,i)}};Swe.shader=new Vi(ist,()=>Oe(()=>import("./Terrain.glsl-a5832a15.js"),[],import.meta.url));const Ewe=new Map([[M.POSITION,0],[M.UV0,1],[M.NORMALCOMPRESSED,2]]);let rst=class{constructor(){this.geometry=new ent,this.intersectionData=null,this.geometryState=null,this._textureRef=new pwe(()=>this.tile.surface.textureFadeDuration),this.overlay=new Gnt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const i=this.geometry;i.indices=null,i.vertexAttributes=null,Gr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new ont,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),Ps&&this.tile.intersectsClippingArea)for(let i=0;i<4;++i)Fe(this.geometry.outerEdges[i].count===this.geometryState.neighborData.edgeResolutions[i]+1)}_calculateEdgeResolution(e,i){var l;const r=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const c=r.surface.extent;if(c!=null&&(e===0&&r.extent[3]>c[3]||e===1&&r.extent[2]>c[2]||e===2&&r.extent[1]<c[1]||e===3&&r.extent[0]<c[0]))return n}const s=r.level,o=Of[e];if(!i)return Fe(((l=r.surface)==null?void 0:l.rootTiles)==null||r.surface.updatingRootTiles||!r.shouldHaveNeighbor(o)),n;if(i.isLoaded){const c=i,u=c.renderData.geometryState,p=s-c.level;if(Fe(p>=0),p===0){const v=u.numVerticesPerSide-1;return Math.max(v,n)}const f=2**p,y=u.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,y)}Fe(!i.isLeaf);let a=n;return i.forAllSubtreeOnSide(bN(o),c=>c===r||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):(Fe(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const i=e.renderData.geometryState.neighborData,r=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),n=i.edgePeerNeighbors,s=i.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(Of[l],r),u=x1(e,c),p=((a=u==null?void 0:u.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=n[l],y=u!==x1(e,f),v=s[l]!==p;n[l]=c,(y||v)&&(s[l]=p,this._markEdgeDirty(l));const b=i.edgeResolutions[l],x=this._calculateEdgeResolution(l,c);Fe(rb(x)),Fe(x>=1),i.edgeResolutions[l]=x,b!==x&&this._markEdgeResolutionDirty(l)}const o=i.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(h3[l],r);o[l]=c;const u=x1(e,n[l]),p=x1(e,n[(l+1)%4]),f=x1(e,c);md[l]=f,md[(l+1)%4]=p,md[(l+2)%4]=e,md[(l+3)%4]=u,Fe(md.some(x=>(x==null?void 0:x.isLoaded)||x===e));const y=md.reduce((x,S)=>Math.min(x,(S==null?void 0:S.level)??1/0),1/0);md.forEach((x,S)=>{x&&(x==null?void 0:x.level)>y&&(md[S]=null)}),Fe(md.some(x=>(x==null?void 0:x.isLoaded)||x===e));const v=i.cornerNeighborData[l].cornerTiles,b=i.cornerNeighborData[l].cornerTileSamplerVersions;for(let x=0;x<4;++x){const S=md[x],P=(S==null?void 0:S.renderData.geometryState.samplerDataVersion)??-1,C=v[x]!==S,R=!C&&b[x]!==P;(C||R)&&(v[x]=S,b[x]=P,this._markCornerDirty(l))}Fe(v.some(x=>(x==null?void 0:x.isLoaded)||x===e))}Ps&&Fe(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)md[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;Ps&&Fe(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const i=this.tile,r=this._vao,n=this.geometry.vertexAttributes,s=!r||!n||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?i.updateEdgeElevations():a?i.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,rnt(this.geometry),!0)}ensureTexture(e,i){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const i=1<<e;this._dirtyCorners|=i}_markEdgeDirty(e){const i=1<<e;this._dirtyEdges|=i,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const i=1<<e;this._dirtyEdgeResolutions|=i,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),i=this.tile,r=e.samplerData?i.getElevationVerticesPerSide(e.maxTileLevel):i.getDefaultVerticesPerSide(),n=Math.max(r,5);let s=i.clippingArea;i.intersectsClippingArea&&!i.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),Ag(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=i.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const i=this.geometry.vertexAttributes,r=this.geometry.indices,n=e.gl;this._vao=new vp(e,Ewe,{geometry:Pc(i.layout)},{geometry:Ki.createVertex(e,n.STATIC_DRAW,i.buffer)},Ki.createIndex(e,n.STATIC_DRAW,r)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,i=Sg.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,i=this.tile.layerInfo[mi.ELEVATION],r=i.length,n=new Array(r);let s=0,o=0,a=!1;for(let u=0;u<r;u++){const p=i[u];if(p.upsampleInfo!=null){const f=p.upsampleInfo.tile,y=f.layerInfo[mi.ELEVATION][u].data,v=y&&y.samplerData;e&&e[s]===v||(a=!0),n[s++]=v,o=Math.max(o,f.lij[0])}else if(p.data){const f=this.tile.surface.layerViewByIndex(u,mi.ELEVATION);if(hP(this.tile,f.layer,!1)){const y=p.data;e&&e[s]===y.samplerData||(a=!0),n[s++]=y.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var i,r,n;const e=((i=this.intersectionData)==null?void 0:i.estimatedMemoryUsage)??0;return(((r=this.geometry.indices)==null?void 0:r.byteLength)??0)+(((n=this.geometry.vertexAttributes)==null?void 0:n.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!Ps)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Fe(e==null?void 0:e.isLoaded);const i=e.surface.extent;if(i!=null&&!e.intersectsExtent(i))return;const r=Of.map((a,l)=>i!=null&&(l<2?-1:1)*(e.extent[3-l]-i[3-l])<0),n=e.level;Fe(this._dirtyCorners===0),Fe(this._dirtyEdges===0),Fe(this._dirtyEdgeResolutions===0),Fe(!this._numVerticesPerSideChanged),Fe(!this._samplerDataChanged),Fe(!this._clippingAreaChanged),Fe(!this._wireframeChanged);const s=h3.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];Fe(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}Of.forEach((a,l)=>{if(r[l])return;const c=e.findNeighborTile(a,H=>(H.level===n||(H==null?void 0:H.isLoaded))&&(H==null?void 0:H.intersectsClippingArea));if(!c){const H=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Fe(!H)}Fe(c.isLoaded||c.level===e.level),Fe(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const u=n-c.level;if(!c.isLoaded)return Fe(!c.isLeaf),void Fe(u===0);const p=c.renderData;Fe(Vnt(e,c,a)),Fe(u>=0);const f=2**u;if(u<0)return void Fe(!1);const y=e.renderData,v=y.geometry,b=v.outerEdges[l],x=v.numVerticesPerSide-1,S=p.geometry;if(!S)return void Fe(!1);const P=this.geometryState.neighborData.edgePeerNeighbors[l];if(P!=null&&P.isLoaded){const H=P.renderData;Fe(P==P),Fe(y.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===H.geometryState.samplerDataVersion),Fe(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===H.geometryState.samplerDataVersion)}const C=(l+2)%4,R=S.outerEdges[C],N=b.count-1,$=R.count-1;Fe(N*f===$,`Tile[${e.lij}]:e${l},res=${N} edgeRes mismatch with Neighbor[${c.lij}]:e${C},res=${$} (expected:${N*f})`);const k=e.extent,B=a===Et.NORTH||a===Et.SOUTH,W=R.count-1,Z=W/2**u,K=b.count-1;if(Z<1)return void Fe(K===1);Fe(Z===K),Fe(rb(Z));const X=S.numVerticesPerSide-1;Fe(u>0||Z===Math.max(X,x));const ae=e.getNeighborEdgeStartVertexIndex(l,c);Fe(0<=ae&&ae<f);const re=ae*Z;Fe(0<=re&&re<=W-Z);let ee=0,oe=re;b.getVertexPos(Gp,0),b.getVertexPos(jp,b.count-1);const U=Nr(Gp,jp),V=Math.max(nst,1e-4*U);for(let H=0;H<=Z;++H){b.getVertexPos(Gp,ee),R.getVertexPos(jp,oe);const Y=H/Z,ie=B?k[0]+Y*(k[2]-k[0]):a===Et.WEST?k[0]:k[2],le=B?a===Et.SOUTH?k[1]:k[3]:k[1]+Y*(k[3]-k[1]),ue=e.surface.extent;if(ue==null||l5(ue,ie,le)){const ve=O3(Gp,jp),Ie=ac(Gp)-vi.radius,Ve=ac(jp)-vi.radius,Mt=ve<V;if(!Mt){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${ee}/${b.count}] and [${c.lij}].edge${C}[${oe}/${R.count}]`),ue!=null&&console.warn("  surface extent= ",ue," x,y=",ie,",",le);const qe=I();Ce(qe,y.localOrigin,p.localOrigin),ac(qe)>0&&console.warn(`   localOrigins: ${y.localOrigin} vs ${p.localOrigin} d=${ac(qe)} [${qe}]`),(()=>{const Ee=Kn(Gp),at=Kn(jp);e.updateEdgeElevations(),c.updateEdgeElevations(),b.getVertexPos(Gp,ee),R.getVertexPos(jp,oe);const ht=I();uo(ht,Gp,Ee),ac(ht)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${Ee} vs ${Gp} d=${ac(ht)} [${ht}]`),uo(ht,jp,at),ac(ht)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${at} vs ${jp} d=${ac(ht)} [${ht}]`)})(),Fe(Mt,`Mismatch in tile [${e.lij}].edge[${l}][${ee}/${b.count}] vs neighbor [${c.lij}].edge[${C}][${oe}/${R.count}] ${Om(Gp)} vs ${Om(jp)}  dist=${ve} h(t|n|d)=${Ie}|${Ve}|${Ve-Ie}`)}b.getNormal(dx,ee),R.getNormal(px,oe),Me(gre,dx),Me(_re,px);const ot=Re(gre,_re),Pt=1-ot<.01||!1||e===c;if(!Pt){const qe=I();uo(qe,dx,px);const Ee=()=>`Mismatch in tile edge normal ${Xie(e.lij)} (${ee}/${b.count-1}) edge ${l} vs neighbor ${Xie(c.lij)}  (${oe}/${R.count-1}) nedge ${C} :${Om(dx)} vs ${Om(px)}  dot = ${ot} : ${Om(qe)}`;console.warn("Mismatch in tile edge normal: ",Ee());{e.updateEdgeElevations(),c.updateEdgeElevations();const at=I(),ht=I();b.getNormal(at,ee),R.getNormal(ht,oe),ny(dx,at)||console.warn("Missing update in tile normal: ",Om(dx)," => ",Om(at)),ny(px,ht)||console.warn("Missing update in neighbor normal: ",Om(px)," => ",Om(ht))}Fe(Pt,Ee())}}ee+=1,oe+=1}})}};const Gp=I(),jp=I(),dx=I(),px=I(),gre=I(),_re=I(),nst=1,md=[null,null,null,null];function x1(t,e){return e!=null&&e.isLoaded||e===t?e:null}const sst=65536;function ost(t,e){const i=t.tile,{extent:r,extentInRadians:n,surface:s}=i,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=a.numVerticesPerSide,u=c-1,p=(c-2)**2,f=l&&(e===yh.HAS_SOUTH_POLE||e===yh.HAS_BOTH_POLES),y=l&&(e===yh.HAS_NORTH_POLE||e===yh.HAS_BOTH_POLES),v=6,b=((f?1:0)+(y?1:0))*v*(u+1),x=a.neighborData,S=x.edgeResolutions.reduce((k,B)=>k+B+1,0),P=dwe(p+b+S),C=t.geometry;C.numVerticesPerSide=a.numVerticesPerSide,C.vertexAttributes=P;const R=C.boundingBox;Gr(R);const N=Qq(t);Po.update(u,n,N),ast(t),Nwe(t,p),Awe(t);const $=[];if((()=>{let k=p+S;const B=o[0],W=o[1],Z=o[2],K=i.ellipsoid.radius,X=r[1],ae=r[3],re=(ee,oe)=>{const U=oe*c;Dh(-B,-W,ee*K-Z,R),$.push({connectedRowOffset:U,connectedOuterEdgeOffset:ee===1?0:2,rowOffset:k,latitudeResolution:v});const V=Rwe(ee===-1?X:ae,K),H=ee*Math.PI/2-V,Y=.99*(ee===1?1:-1),ie=K+0,le=P.position,ue=P.uv0,{typedBuffer:ve,typedBufferStride:Ie}=P.normalCompressed;for(let Ve=1;Ve<=v;++Ve){const Mt=V+H*(Ve/v),ot=Math.cos(Mt),Pt=Math.sin(Mt);for(let qe=0;qe<=u;qe++){const Ee=qe/u,at=Po.sinLonLUT[qe],ht=Po.cosLonLUT[qe]*ot,Ue=at*ot,He=Pt,rt=ht*ie-B,wt=Ue*ie-W,_t=He*ie-Z;Dh(rt,wt,_t,R),le.setValues(k,rt,wt,_t),ap(ue,k,Ee,Y),Mb(ve,k,ht,Ue,He,Ie),++k}}};f&&re(-1,0),y&&re(1,u)})(),Dwe(C,a.numVerticesPerSide,$,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,Ps)for(let k=0;k<4;++k)Fe(C.outerEdges[k].count===x.edgeResolutions[k]+1)}function ast(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=t.geometryState,r=i.numVerticesPerSide,n=r-2,s=r-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:u,typedBufferStride:p}=a.normalCompressed,f=e.extent,y=f[0],v=f[2],b=f[1],x=f[3],S=e.ellipsoid.radius,P=i.samplerData,C=t.localOrigin,R=C[0],N=C[1],$=C[2],k=l.typedBuffer,B=l.typedBufferStride,W=1/s,Z=o.boundingBox;let K=0;if(1<=n){const X=W,ae=b*(1-X)+x*X,re=Po.sinLatLUT[1],ee=Po.cosLatLUT[1];for(let oe=1;oe<=n;oe++){const U=oe*W,V=y*(1-U)+v*U,H=Po.sinLonLUT[oe],Y=Po.cosLonLUT[oe],ie=S+pn(V,ae,P),le=ie*Y*ee-R,ue=ie*H*ee-N,ve=ie*re-$;Dh(le,ue,ve,Z);const Ie=(oe-1)*B;k[Ie]=le,k[Ie+1]=ue,k[Ie+2]=ve,ap(c,oe-1,U,X)}}for(let X=1;X<=n;X++){const ae=X*W,re=b*(1-ae)+x*ae,ee=Po.sinLatLUT[X],oe=Po.cosLatLUT[X],U=X+1,V=U*W,H=b*(1-V)+x*V,Y=Po.sinLatLUT[U],ie=Po.cosLatLUT[U],le=Po.sinLonLUT[0],ue=Po.cosLonLUT[0],ve=S+pn(y,re,P);let Ie=ue*oe*ve-R,Ve=le*oe*ve-N,Mt=ee*ve-$;const ot=K*B;let Pt=k[ot],qe=k[ot+1],Ee=k[ot+2];for(let at=1;at<=n;at++){const ht=at*W,Ue=y*(1-ht)+v*ht,He=Po.sinLonLUT[at],rt=Po.cosLonLUT[at];let wt=0,_t=0,lt=0;if(at<n){const _i=(K+1)*B;wt=k[_i],_t=k[_i+1],lt=k[_i+2]}else{const _i=Po.sinLonLUT[s],ir=Po.cosLonLUT[s],ur=S+pn(v,re,P);wt=ir*oe*ur-R,_t=_i*oe*ur-N,lt=ee*ur-$}const Xe=Ie,ct=Ve,ti=Mt;Ie=Pt,Ve=qe,Mt=Ee,Pt=wt,qe=_t,Ee=lt;const Ze=wt-Xe,tt=_t-ct,Ot=lt-ti;let kt=0,$t=0,cr=0;if(X>1){const _i=(K-n)*B;kt=k[_i],$t=k[_i+1],cr=k[_i+2]}else{const _i=Po.sinLatLUT[0],ir=Po.cosLatLUT[0],ur=S+pn(Ue,b,P);kt=rt*ir*ur-R,$t=He*ir*ur-N,cr=_i*ur-$}const ji=S+pn(Ue,H,P),er=rt*ie*ji-R,Vt=He*ie*ji-N,sr=Y*ji-$;if(X<n){const _i=K+n,ir=_i*B;k[ir]=er,k[ir+1]=Vt,k[ir+2]=sr,Dh(er,Vt,sr,Z),ap(c,_i,ht,V)}const Mi=kt-er,Hi=$t-Vt,Ei=cr-sr;let ki=rt*oe,Ai=He*oe,or=ee;or*or<.999&&(ki=Ot*Hi-tt*Ei,Ai=Ze*Ei-Ot*Mi,or=tt*Mi-Ze*Hi);const tr=1/Math.sqrt(ki*ki+Ai*Ai+or*or);Mb(u,K,ki*tr,Ai*tr,or*tr,p),++K}}}function lst(t){t.tile.intersectsClippingArea&&(Awe(t),eF(t))}function cst(t){t.tile.intersectsClippingArea&&(Owe(t),Pwe(t,!0),eF(t))}function Awe(t){t.tile.intersectsClippingArea&&(Owe(t),Pwe(t))}function Pwe(t,e=!1){const i=t.geometryState,r=t.geometry,n=i.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,u=c[0],p=c[2],f=c[1],y=c[3],v=i.samplerData,b=a[0],x=a[2],S=a[1],P=a[3],C=Qq(t),R=r.boundingBox,N=t.localOrigin,$=N[0],k=N[1],B=N[2],W=r.vertexAttributes,Z=W.position,K=Z.typedBuffer,X=Z.typedBufferStride,ae=W.uv0;for(let re=0;re<4;++re){const ee=re===1||re===3,oe=n.edgeResolutions[re];Fe(rb(oe));const U=oe+1,V=x1(s,n.edgePeerNeighbors[re]);if(Uwe(s,V,re)){Fwe(t,re,V);continue}const H=V!=null;Fe(!H||V.level===s.level),Fe(!H||Cg(s,V)<=0);const Y=V==null?void 0:V.renderData,ie=Y==null?void 0:Y.geometryState;if(Ps){const Ze=s.surface;if(!V&&Ze&&!Ze.updatingRootTiles){const tt=Of[re],Ot=s.findNeighborTile(tt,kt=>kt.isLoaded||kt.isLeaf||kt.level===s.level);Ot?Ot.intersectsClippingArea&&(Fe(!Ot.isLoaded),Fe(!Ot.isLeaf),Fe(Ot.level===o)):Fe((Ze==null?void 0:Ze.rootTiles)==null||!s.shouldHaveNeighbor(tt))}}const le=re===1?a[2]:a[0],ue=V==null?void 0:V.extent,ve=ue&&ee?re===1?ue[0]:ue[2]:le,Ie=re===0?a[3]:a[1],Ve=re===1?1:0,Mt=re===0?1:0,ot=re===1?p:u,Pt=re===0?y:f,qe=Math.sin(ot),Ee=Math.cos(ot),at=Math.sin(Pt),ht=Math.cos(Pt),Ue=ie==null?void 0:ie.samplerData,He=H?(Ze,tt,Ot)=>.5*(pn(Ze,tt,v)+pn(Ot,tt,Ue)):(Ze,tt,Ot)=>pn(Ze,tt,v),rt=r.outerEdges[re],wt=e&&U>3?U-3:1,_t=v!=null&&v.some(Ze=>Ze!=null),lt=Ue!=null&&Ue.some(Ze=>Ze!=null),Xe=_t||lt,ct=1/oe,ti=rt.index0;Fe(!ue||bh(ue[2]-ue[0],a[2]-a[0])),(()=>{const Ze=re===1?-1:re===3?1:0,tt=re===0?-1:re===2?1:0,Ot=(a[2]-a[0])*ct,kt=Ze*Ot,$t=tt*Ot,cr=ee?Ze*((p-u)*ct):0,ji=ee?0:tt*ct,er=Mt,Vt=ee?ot+cr:ot,sr=ee?Math.sin(Vt):qe,Mi=ee?Math.cos(Vt):Ee,Hi=ee?ot-cr:ot,Ei=ee?Math.sin(Hi):qe,ki=ee?Math.cos(Hi):Ee,Ai=ee?Pt:C(er+ji),or=ee?at:Math.sin(Ai),tr=ee?ht:Math.cos(Ai),_i=ee?Pt:C(er-ji),ir=ee?at:Math.sin(_i),ur=ee?ht:Math.cos(_i);let as=0,ls=0,yn=0;{const $i=0*ct,es=ee?le:b*(1-$i)+x*$i,_s=ee?ve:es,Zs=ee?S*(1-$i)+P*$i:Ie,de=ee?ot:u*(1-$i)+p*$i,Pi=ee?qe:Math.sin(de),Tt=ee?Ee:Math.cos(de),Un=ee?C($i):Pt,Ra=ee?Math.sin(Un):at,ut=ee?Math.cos(Un):ht,_o=l+He(es,Zs,_s);as=Tt*ut*_o,ls=Pi*ut*_o,yn=Ra*_o}let cs=0,kr=0,Rr=0;{const $i=1*ct,es=ee?le:b*(1-$i)+x*$i,_s=ee?ve:es,Zs=ee?S*(1-$i)+P*$i:Ie,de=ee?ot:u*(1-$i)+p*$i,Pi=ee?qe:Math.sin(de),Tt=ee?Ee:Math.cos(de),Un=ee?C($i):Pt,Ra=ee?Math.sin(Un):at,ut=ee?Math.cos(Un):ht,_o=l+He(es,Zs,_s);cs=Tt*ut*_o,kr=Pi*ut*_o,Rr=Ra*_o}for(let $i=1;$i<U-1;$i+=wt){let es=0,_s=0,Zs=0;{const us=($i+1)*ct,Uo=ee?le:b*(1-us)+x*us,zl=ee?ve:Uo,zn=ee?S*(1-us)+P*us:Ie,jr=ee?ot:u*(1-us)+p*us,Rc=ee?qe:Math.sin(jr),Mc=ee?Ee:Math.cos(jr),ll=ee?C(us):Pt,ed=ee?Math.sin(ll):at,$u=ee?Math.cos(ll):ht,$a=l+He(Uo,zn,zl);es=Mc*$u*$a,_s=Rc*$u*$a,Zs=ed*$a}const de=es,Pi=_s,Tt=Zs,Un=cs,Ra=kr,ut=Rr;cs=de,kr=Pi,Rr=Tt;{const us=ti+$i,Uo=us*X,zl=Un-$,zn=Ra-k,jr=ut-B;K[Uo]=zl,K[Uo+1]=zn,K[Uo+2]=jr,Dh(zl,zn,jr,R);const Rc=$i*ct;ap(ae,us,ee?Ve:Rc,ee?Rc:Mt)}const _o=as,Rn=ls,kl=yn;as=Un,ls=Ra,yn=ut;const Xs=Un,Ls=Ra,Ma=ut,ts=1/Math.sqrt(Xs*Xs+Ls*Ls+Ma*Ma),ii=Ma*ts;let Mu=0,Ul=0,Oc=0;if(Xe&&ii*ii<.999){let us=0,Uo=0,zl=0;{const zn=re===0?-1:1;us=zn*(de-_o),Uo=zn*(Pi-Rn),zl=zn*(Tt-kl)}{const zn=$i*ct,jr=ee?le:b*(1-zn)+x*zn,Rc=ee?ve:jr,Mc=ee?S*(1-zn)+P*zn:Ie,ll=ee?ot:u*(1-zn)+p*zn,ed=ee?qe:Math.sin(ll),$u=ee?Ee:Math.cos(ll),$a=ee?C(zn):Pt,Zi=ee?Math.sin($a):at,Ui=ee?Math.cos($a):ht;let $c=Xs,Bl=Ls,Q=Ma;if(H){const Se=l+pn(Rc-kt,Mc-$t,Ue),be=ee?Ui:ur;$c=(ee?ki:$u)*be*Se,Bl=(ee?Ei:ed)*be*Se,Q=(ee?Zi:ir)*Se}{const Se=l+pn(jr+kt,Mc+$t,v),be=ee?Ui:tr,yt=(ee?Mi:$u)*be*Se,Xr=(ee?sr:ed)*be*Se,Xi=(ee?Zi:or)*Se;H||($c=2*Xs-yt,Bl=2*Ls-Xr,Q=2*Ma-Xi);const Mr=re===3?-1:1,Iu=Mr*($c-yt),um=Mr*(Bl-Xr),Lu=Mr*(Q-Xi);Mu=zl*um-Uo*Lu,Ul=us*Lu-zl*Iu,Oc=Uo*Iu-us*um;const Mn=1/Math.sqrt(Mu*Mu+Ul*Ul+Oc*Oc);Mu*=Mn,Ul*=Mn,Oc*=Mn}}}else Mu=Xs*ts,Ul=Ls*ts,Oc=Ma*ts;rt.setNormalFromValues($i,Mu,Ul,Oc)}})()}}function Owe(t){kwe(t)}function Rwe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function ust(t,e,i,r){return Rwe(t*(1-r)+e*r,i)}function hst(t,e,i){return t*(1-i)+e*i}function Qq(t){const e=t.tile;if(e.surface.isWebMercator){const r=e.extent,n=e.ellipsoid.radius;return s=>ust(r[1],r[3],n,s)}const i=e.extentInRadians;return r=>hst(i[1],i[3],r)}function dst(t,e){const i=t.tile.extent,r=t.geometryState,n=i[0],s=i[1],o=i[2]-n,a=i[3]-s,l=r.clippingArea,c=l!=null?Math.max(0,(l[0]-n)/o):0,u=l!=null?Math.max(0,(l[1]-s)/a):0,p=l!=null?Math.min(1,(l[2]-n)/o):1,f=l!=null?Math.min(1,(l[3]-s)/a):1,y=r.numVerticesPerSide,v=(y-2)**2,b=r.neighborData.edgeResolutions.reduce((C,R)=>C+R+1,0),x=dwe(v+b),S=t.geometry,P=S.boundingBox;Gr(P),S.numVerticesPerSide=r.numVerticesPerSide,S.vertexAttributes=x,Br(S.uvRange,c,u,p,f),pst(t),Nwe(t,v),Mwe(t),Dwe(S,r.numVerticesPerSide,[],[0,y-1],[0,y-1],r.wireframe),t.intersectionData=null}function pst(t){const e=t.tile;if(!e.intersectsClippingArea)return;const i=e.surface,r=t.geometryState,n=r.samplerData,s=t.localOrigin,o=i.isWebMercatorOnPlateeCarree,a=r.clippingArea,l=a??eZ,c=e.extent,u=c[0],p=c[1],f=c[2],y=c[3],v=Math.max(u,l[0]),b=Math.min(f,l[2]),x=Math.max(p,l[1]),S=Math.min(y,l[3]),P=e.ellipsoid.radius,C=e.horizontalScale,R=r.numVerticesPerSide,N=R-1,$=R-2,k=t.geometry,B=k.vertexAttributes,W=B.position,Z=B.uv0,{typedBuffer:K,typedBufferStride:X}=B.normalCompressed,ae=k.uvRange,re=ae[0],ee=ae[1],oe=ae[2],U=ae[3],V=k.boundingBox,H=s[0],Y=s[1],ie=s[2],le=W.typedBuffer,ue=W.typedBufferStride;let ve=0;const Ie=$e(p,x,S),Ve=o?(Math.PI/2-2*Math.atan(Math.exp(-Ie/P)))*P:Ie*C,Mt=1/N,ot=$e(p*(1-Mt)+y*Mt,x,S);let Pt=Ve,qe=o?(Math.PI/2-2*Math.atan(Math.exp(-ot/P)))*P:ot*C;for(let Ee=1;Ee<=$;Ee++){const at=Ee/N,ht=$e(p*(1-at)+y*at,x,S),Ue=$e(at,ee,U),He=qe,rt=(Ee-1)/N,wt=$e(p*(1-rt)+y*rt,x,S),_t=Pt,lt=(Ee+1)/N,Xe=$e(p*(1-lt)+y*lt,x,S),ct=o?(Math.PI/2-2*Math.atan(Math.exp(-Xe/P)))*P:Xe*C,ti=$e(lt,ee,U);Pt=qe,qe=ct;const Ze=$e(u,v,b);let tt=Ze*C,Ot=pn(Ze,ht,n);const kt=1/N,$t=$e(kt,re,oe),cr=$e(u*(1-$t)+f*$t,v,b);let ji=$t,er=cr,Vt=cr*C,sr=pn(cr,ht,n);if(Ee===1){const Mi=Vt-H,Hi=Pt-Y,Ei=sr-ie,ki=0*ue;le[ki]=Mi,le[ki+1]=Hi,le[ki+2]=Ei,Dh(Mi,Hi,Ei,V);const Ai=$e(kt,re,oe);ap(Z,ve,Ai,Ue)}for(let Mi=1;Mi<=$;Mi++){const Hi=Vt,Ei=sr,ki=(Mi+1)/N,Ai=$e(ki,re,oe),or=$e(u*(1-ki)+f*ki,v,b),tr=er;er=or;{const kr=ve+1,Rr=kr*ue;if(Ee===1||Mi===$){const $i=or*C,es=pn(or,ht,n);if(Ee===1&&Mi<$){const _s=$i-H,Zs=He-Y,de=es-ie;le[Rr]=_s,le[Rr+1]=Zs,le[Rr+2]=de,Dh(_s,Zs,de,V),ap(Z,kr,Ai,Ue)}Vt=$i,sr=es}else Vt=le[Rr]+H,sr=le[Rr+2]+ie}const _i=Vt,ir=sr,ur=tt,as=Ot;tt=Hi,Ot=Ei;const ls=(ve-$)*ue,yn=Ee===1?pn(tr,wt,n):le[ls+2]+ie,cs=pn(tr,Xe,n);if(Ee<$){const kr=ve+$,Rr=kr*ue,$i=Hi-H,es=ct-Y,_s=cs-ie;le[Rr]=$i,le[Rr+1]=es,le[Rr+2]=_s,Dh($i,es,_s,V);const Zs=ji;ji=Ai,ap(Z,kr,Zs,ti)}{const kr=_i-ur,Rr=_t-ct,$i=Rr*(ir-as),es=kr*(yn-cs),_s=-Rr*kr,Zs=$i*$i+es*es+_s*_s;if(Zs===0)Mb(K,ve,0,0,1,X);else{const de=1/Math.sqrt(Zs);Mb(K,ve,$i*de,es*de,_s*de,X)}}++ve}}}function fst(t,e){t.tile.intersectsClippingArea&&(Iwe(t),$we(t,!0),eF(t))}function mst(t,e){t.tile.intersectsClippingArea&&(Mwe(t),eF(t))}function Mwe(t,e){t.tile.intersectsClippingArea&&(Iwe(t),$we(t,!1))}function $we(t,e){const i=t.geometryState,r=i.neighborData,n=t.tile,s=n.surface,o=n.extent,a=i.clippingArea,l=a??eZ,c=o[0],u=o[2],p=o[1],f=o[3],y=[f>l[3],u>l[2],p<l[1],c<l[0]],v=t.geometry,b=n.horizontalScale,x=Lwe(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,b),S=v.boundingBox,P=v.uvRange[0],C=v.uvRange[1],R=v.uvRange[2],N=v.uvRange[3],$=Math.max(c,l[0]),k=Math.min(u,l[2]),B=Math.max(p,l[1]),W=Math.min(f,l[3]),Z=t.localOrigin,K=Z[0],X=Z[1],ae=Z[2],re=i.samplerData;for(let ee=0;ee<4;++ee){const oe=ee===1||ee===3,U=r.edgeResolutions[ee];Fe(rb(U));const V=U+1,H=y[ee],Y=x1(n,r.edgePeerNeighbors[ee]);if(!H&&Uwe(n,Y,ee)){Fwe(t,ee,Y);continue}const ie=Y!=null&&!H,le=Y==null?void 0:Y.renderData,ue=le==null?void 0:le.geometryState;if(Ps&&(Fe(!ie||Y.level===n.level),Fe(!ie||Cg(n,Y)<=0),n&&!Y&&!s.updatingRootTiles)){const Ze=Of[ee],tt=n.findNeighborTile(Ze,Ot=>Ot.isLoaded||Ot.isLeaf||Ot.level===n.level);s.updatingRootTiles||(tt?tt.intersectsClippingArea&&(Fe(!tt.isLoaded),Fe(!tt.isLeaf),Fe(tt.level===n.level)):Fe((s==null?void 0:s.rootTiles)==null||!n.shouldHaveNeighbor(Ze)))}const ve=$e(ee===1?u:c,$,k),Ie=$e(ee===0?f:p,B,W),Ve=ue==null?void 0:ue.samplerData,Mt=v.outerEdges[ee],ot=e&&V>3?V-3:1,Pt=$e(ee===1?1:0,P,R),qe=$e(ee===0?1:0,C,N),Ee=ie?(Ze,tt)=>.5*(pn(Ze,tt,Ve)+pn(Ze,tt,re)):(Ze,tt)=>pn(Ze,tt,re),at=(u-c)/U,ht=oe?ee===1?at:-at:0,Ue=oe?0:ee===0?at:-at,He=-ht,rt=-Ue;let wt=0,_t=0,lt=0;{const Ze=0/U,tt=oe?ve:$e(c*(1-Ze)+u*Ze,$,k),Ot=oe?$e(p*(1-Ze)+f*Ze,B,W):Ie,kt=Ee(tt,Ot);wt=tt*b,_t=x(Ot),lt=kt}let Xe=0,ct=0,ti=0;{const Ze=1/U,tt=oe?ve:$e(c*(1-Ze)+u*Ze,$,k),Ot=oe?$e(p*(1-Ze)+f*Ze,B,W):Ie,kt=Ee(tt,Ot);Xe=tt*b,ct=x(Ot),ti=kt}for(let Ze=1;Ze<V-1;Ze+=ot){const tt=Ze/U,Ot=Xe,kt=ct,$t=ti;{const Ai=oe?Pt:$e(tt,P,R),or=oe?$e(tt,C,N):qe,tr=Ot-K,_i=kt-X,ir=$t-ae;Dh(Ot,_i,ir,S),Mt.setVertexFromValuesRawPositionUV(Ze,tr,_i,ir,Ai,or)}{const Ai=(Ze+1)/U,or=oe?ve:$e(c*(1-Ai)+u*Ai,$,k),tr=oe?$e(p*(1-Ai)+f*Ai,B,W):Ie,_i=Ee(or,tr);Xe=or*b,ct=x(tr),ti=_i}const cr=Xe,ji=ti,er=wt,Vt=_t,sr=lt;wt=Ot,_t=kt,lt=$t;let Mi=0,Hi=0,Ei=0;if(oe){const Ai=ct-kt,or=ji-$t,tr=Vt-kt,_i=sr-$t,ir=$e(p*(1-tt)+f*tt,B,W),ur=ve+He,as=ur*b-Ot,ls=pn(ur,ir,re)-$t,yn=ee===3?-1:1;if(Mi=yn*(-tr+Ai)*ls,Hi=yn*as*(-_i+or),Ei=-yn*as*(-tr+Ai),ie){const cs=ve+ht,kr=cs*b-Ot;Mi=(-tr+Ai)*(ls-(pn(cs,ir,Ve)-$t)),Hi=(as-kr)*(-_i+or),Ei=-(as-kr)*(-tr+Ai)}}else{const Ai=cr-Ot,or=ji-$t,tr=er-Ot,_i=sr-$t,ir=$e(c*(1-tt)+u*tt,$,k),ur=Ie+rt,as=pn(ir,ur,re)-$t,ls=x(ur)-kt,yn=ee===2?-1:1;if(Mi=yn*ls*(-_i+or),Hi=yn*(-tr+Ai)*as,Ei=-yn*ls*(-tr+Ai),ie){const cs=ir,kr=Ie+Ue,Rr=x(kr)-kt;Mi=(-ls+Rr)*(-_i+or),Hi=(-tr+Ai)*(-as+(pn(cs,kr,Ve)-$t)),Ei=-(-ls+Rr)*(-tr+Ai)}}const ki=1/Math.sqrt(Mi*Mi+Hi*Hi+Ei*Ei);Mt.setNormalFromValues(Ze,Mi*ki,Hi*ki,Ei*ki)}}}function Iwe(t,e){kwe(t)}function gst(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function _st(t,e){return t*e}function Lwe(t,e,i){return t?r=>gst(r,e):r=>_st(r,i)}function Dwe(t,e,i,r,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,r[1])-Math.max(1,r[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=Of.map((C,R)=>R===0&&n[1]<e-2||R===1&&r[1]<e-2||R===2&&n[0]>1||R===3&&r[0]>1),u=t.outerEdges.reduce((C,R,N)=>C+(c[N]?0:o-2+R.count-1),0),p=i.reduce((C,R)=>C+o*(2*(R.latitudeResolution-1)+1),0),f=s?2:1,y=3*(l+u+p)*f,v=a>=sst?new Uint32Array(y):new Uint16Array(y);let b=0;const x=e-2,S=o-2;Fe(S>=0);const P=(C,R,N,$,k,B)=>{const W=C*k,Z=B[W],K=B[W+1],X=B[W+2],ae=R*k,re=B[ae],ee=B[ae+1],oe=B[ae+2],U=N*k,V=B[U],H=B[U+1],Y=B[U+2],ie=$*k,le=B[ie],ue=B[ie+1],ve=B[ie+2];return(re-le)*(re-le)+(ee-ue)*(ee-ue)+(oe-ve)*(oe-ve)>(Z-V)*(Z-V)+(K-H)*(K-H)+(X-Y)*(X-Y)};if(s){const C=(N,$,k)=>{v[b++]=N,v[b++]=$,v[b++]=$,v[b++]=k,v[b++]=k,v[b++]=N,Ps&&(Fe(N<a),Fe($<a),Fe(k<a),Fe(b<=y))};(()=>{for(let N=Math.max(n[0],1)-1;N<Math.min(n[1],e-2)-1;++N){const $=N*x;for(let k=Math.max(r[0],1)-1;k<Math.min(r[1],e-2)-1;++k){const B=N*x+k,W=B+1,Z=W+x,K=Z-1,X=$+k,ae=X+1,re=ae+x,ee=re-1,oe=t.vertexAttributes.position.typedBuffer,U=t.vertexAttributes.position.typedBufferStride;P(X,ae,re,ee,U,oe)?(C(B,W,Z),C(Z,K,B)):(C(B,W,K),C(K,Z,W))}}})(),Fe(b===3*l*f),(()=>{for(let N=0;N<4;++N){const $=b;if(c[N])continue;const k=t.outerEdges[N],B=t.innerEdges[N];let W=0,Z=0;const K=k.count,X=B.count;Fe(X===o-1);let ae=0;const re=N===1||N===2?(ee,oe,U)=>C(ee,oe,U):(ee,oe,U)=>C(ee,U,oe);for(;W<K-1||Z<X-1;){const ee=B.getVertexIndex(Z),oe=k.getVertexIndex(W),U=W<K-1,V=Z<X-1;U&&(!V||(U?0+o*(W+.5)/(K-1):0)<=(V?1+S*(Z+.5)/(X-1):0))?(++W,Ps&&Fe(W<K),re(ee,oe,k.getVertexIndex(W)),ae++):(++Z,Ps&&Fe(Z<X),re(ee,oe,B.getVertexIndex(Z)),ae++)}Ps&&(Fe(W===K-1),Fe(Z===X-1),Fe(ae===K+X-2),Fe(ae===o-2+k.count-1),Fe(b===$+3*ae*f))}})(),Fe(b===3*(l+u)*f);const R=N=>{const $=t.outerEdges[N.connectedOuterEdgeOffset];let k=$.getVertexIndex(0),B=$.stride;for(let W=0;W<N.latitudeResolution;++W){const Z=W===0?N.rowOffset:k+e;for(let K=0;K<o;K++)C(k,k+1,Z+K),W<N.latitudeResolution-1&&C(k+1,Z+K+1,Z+K),k+=B;k=Z,B=1}};i.forEach(R)}else{(()=>{const R=Math.max(n[0],1)-1,N=Math.min(n[1],e-2)-1,$=Math.max(r[0],1)-1,k=Math.min(r[1],e-2)-1;for(let B=R;B<N;++B){const W=B*x;for(let Z=$;Z<k;++Z){const K=W+Z,X=K+1,ae=X+x,re=ae-1,ee=t.vertexAttributes.position.typedBuffer,oe=t.vertexAttributes.position.typedBufferStride;P(K,X,ae,re,oe,ee)?(v[b]=K,v[b+1]=X,v[b+2]=ae,v[b+3]=ae,v[b+4]=re,v[b+5]=K):(v[b]=K,v[b+1]=X,v[b+2]=re,v[b+3]=re,v[b+4]=X,v[b+5]=ae),b+=6}}})(),Fe(b===3*l*f),(()=>{for(let R=0;R<4;++R){if(c[R])continue;const N=t.outerEdges[R],$=t.innerEdges[R];let k=0,B=0;const W=N.count,Z=$.count;Fe(Z===o-1);const K=R===1||R===2,X=K?1:2,ae=K?2:1,re=N.index0,ee=N.stride,oe=$.index0,U=$.stride;for(;k<W-1||B<Z-1;){const V=oe+B*U,H=re+k*ee,Y=k<W-1,ie=B<Z-1,le=Y&&(!ie||(Y?0+o*(k+.5)/(W-1):0)<=(ie?1+S*(B+.5)/(Z-1):0));le?++k:++B;const ue=le?H+ee:V+U;v[b]=V,v[b+X]=H,v[b+ae]=ue,b+=3}}})(),Fe(b===3*(l+u)*f);const C=R=>{const N=t.outerEdges[R.connectedOuterEdgeOffset];let $=N.getVertexIndex(0),k=N.stride;for(let B=0;B<R.latitudeResolution;++B){const W=B===0?R.rowOffset:$+e;for(let Z=0;Z<o;Z++){const K=W+Z;v[b]=$,v[b+1]=$+1,v[b+2]=K,B<R.latitudeResolution-1?(v[b+3]=$+1,v[b+4]=K+1,v[b+5]=K,b+=6):b+=3,$+=k}$=W,k=1}};i.forEach(C)}Fe(b===y),t.indices=v,t.indexCount=y}function Nwe(t,e){const i=t.localOrigin,r=t.geometry,n=t.geometryState.neighborData.edgeResolutions,s=r.numVerticesPerSide-2,o=r.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?s-1:0)*s+(l===1?s-1:0),p=(c?0:1)*s+(c?1:0);r.innerEdges[l]=new ore(o,i,u,p,s)}{const c=a,u=n[l]+1;r.outerEdges[l]=new ore(o,i,c,1,u),a+=u}}}function Fwe(t,e,i){const r=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-i.level,l=e===1||e===3,c=o.edgeResolutions[e];Fe(rb(c));const u=c+1,p=t.geometry,f=p.boundingBox,y=p.outerEdges[e],v=p.uvRange[0],b=p.uvRange[1],x=p.uvRange[2],S=p.uvRange[3],P=$e(e===1?1:0,v,x),C=$e(e===0?1:0,b,S),R=i.renderData,N=R.geometryState,$=R.geometry.outerEdges[r],k=s.getNeighborEdgeStartVertexIndex(e,i)*c,B=c*2**a;Fe(N.neighborData.edgeResolutions[r]===B),Fe($.count-1===B);const W=R.localOrigin[0]-t.localOrigin[0],Z=R.localOrigin[1]-t.localOrigin[1],K=R.localOrigin[2]-t.localOrigin[2],X=y.attributes,ae=y.index0,re=y.stride,ee=X.position.typedBuffer,oe=X.position.typedBufferStride,U=X.normalCompressed.typedBuffer,V=X.normalCompressed.typedBufferStride,H=X.uv0,Y=$.attributes,ie=$.index0,le=$.stride,ue=Y.position.typedBuffer,ve=Y.position.typedBufferStride,Ie=Y.normalCompressed.typedBuffer,Ve=Y.normalCompressed.typedBufferStride;for(let Mt=1;Mt<u-1;++Mt){const ot=ae+re*Mt,Pt=ie+le*(k+Mt),qe=ot*oe,Ee=Pt*ve,at=ue[Ee]+W,ht=ue[Ee+1]+Z,Ue=ue[Ee+2]+K;ee[qe]=at,ee[qe+1]=ht,ee[qe+2]=Ue,Dh(at,ht,Ue,f);const He=ot*V,rt=Pt*Ve;U[He]=Ie[rt],U[He+1]=Ie[rt+1];const wt=Mt/c,_t=l?P:$e(wt,v,x),lt=l?$e(wt,b,S):C;ap(H,ot,_t,lt)}}function kwe(t){var qe;const e=t.geometryState,i=e.neighborData,r=t.localOrigin,n=i.cornerNeighborData,s=t.geometry,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=((qe=t.tile.surface.view)==null?void 0:qe.viewingMode)==="local",u=l.ellipsoid.radius,p=l.extentInRadians,f=l.horizontalScale;let y=0,v=0,b=0;const x=(Ee,at,ht)=>{const Ue=p[at===0?1:3],He=p[Ee===0?0:2],rt=Math.cos(Ue),wt=Math.sin(Ue),_t=Math.sin(He),lt=Math.cos(He),Xe=u+ht;y=lt*rt*Xe,v=_t*rt*Xe,b=wt*Xe},S=c?(()=>{const Ee=t.geometryState.clippingArea,at=l.extent,ht=Ee!=null&&(at[3]>Ee[3]||at[2]>Ee[2]||at[1]<Ee[1]||at[0]<Ee[0]),Ue=Lwe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(He,rt,wt)=>{const _t=He===0?ae[0]:ae[2],lt=rt===0?ae[1]:ae[3],Xe=ht?$e(_t,Ee[0],Ee[2]):_t,ct=ht?$e(lt,Ee[1],Ee[3]):lt,ti=wt;y=Xe*f,v=Ue(ct),b=ti}})():x;let P=0,C=0,R=0,N=0,$=0,k=0,B=0,W=0,Z=0;const K=c&&t.tile.surface.isWebMercatorOnPlateeCarree,X=(Ee,at,ht,Ue,He)=>{let rt=0,wt=0,_t=0;if(c){const lt=at*f,Xe=K?(Math.PI/2-2*Math.atan(Math.exp(-ht/u)))*u:ht*f;rt=lt-y,wt=Xe-v,_t=Ue-b}else{const lt=Qq(Ee),Xe=Ee.tile,ct=Xe.extent,ti=Xe.extentInRadians,Ze=(at-ct[0])/(ct[2]-ct[0]),tt=(ht-ct[1])/(ct[3]-ct[1]),Ot=ti[0]*(1-Ze)+ti[2]*Ze,kt=lt(tt),$t=Math.cos(kt),cr=Math.sin(kt),ji=Math.sin(Ot),er=Math.cos(Ot),Vt=u+Ue;rt=er*$t*Vt-y,wt=ji*$t*Vt-v,_t=cr*Vt-b}switch(He){case 0:B+=rt,W+=wt,Z+=_t;break;case 1:N-=rt,$-=wt,k-=_t;break;case 2:B-=rt,W-=wt,Z-=_t;break;case 3:N+=rt,$+=wt,k+=_t}},ae=l.extent,re=e.clippingArea,ee=re??eZ,oe=ae[0],U=ae[2],V=ae[1],H=ae[3],Y=[H>ee[3],U>ee[2],V<ee[1],oe<ee[0]],ie=Math.max(oe,ee[0]),le=Math.min(U,ee[2]),ue=Math.max(V,ee[1]),ve=Math.min(H,ee[3]),Ie=s.uvRange[0],Ve=s.uvRange[1],Mt=s.uvRange[2],ot=s.uvRange[3],Pt=Ee=>{var lt;const at=n[Ee].cornerTiles;P=0,C=0,R=1,N=0,$=0,k=0,B=0,W=0,Z=0;let ht=1/0;for(let Xe=0;Xe<4;++Xe)ht=Math.min(ht,((lt=at[Xe])==null?void 0:lt.level)??1/0);for(let Xe=0;Xe<4;++Xe){const ct=at[Xe];XC[Xe]=(ct==null?void 0:ct.level)===ht?ct:null}let Ue=1,He=0;for(let Xe=0;Xe<4;++Xe){const ct=XC[Xe];ct&&(Ue=Math.max(Ue,ct==null?void 0:ct.renderData.geometryState.numVerticesPerSide),He=ct.extent[2]-ct.extent[0])}const rt=He,wt=Ue;Fe(wt>1);const _t=rt/wt;for(let Xe=0;Xe<4;++Xe){const ct=XC[(Xe+3)%4],ti=XC[Xe%4];if(!ct&&!ti)continue;const Ze=Xe===0?1:Xe===1?2:Xe===2?3:0,tt=Xe===0?2:Xe===1?3:Xe===2?0:1;if(ct&&ti){const Ot=PU[Xe][0]*_t,kt=PU[Xe][1]*_t,$t=ct.extent,cr=$t[Ze===0||Ze===1?2:0]+Ot,ji=$t[Ze===0||Ze===3?3:1]+kt,er=ti.extent,Vt=er[tt===0||tt===1?2:0]+Ot,sr=er[tt===0||tt===3?3:1]+kt,Mi=ct.renderData,Hi=ti.renderData,Ei=pn(cr,ji,Mi.geometryState.samplerData),ki=pn(Vt,sr,Hi.geometryState.samplerData);X(Mi,cr,ji,.5*(Ei+ki),Xe)}else{const Ot=ct??ti,kt=ct?Ze:tt,$t=Ot.extent,cr=PU[Xe],ji=$t[kt===0||kt===1?2:0]+cr[0]*_t,er=$t[kt===0||kt===3?3:1]+cr[1]*_t,Vt=Ot.renderData,sr=pn(ji,er,Vt.geometryState.samplerData);X(Vt,ji,er,sr,Xe)}}if(!c){const Xe=Math.sqrt(y*y+v*v+b*b);P=y/Xe,C=v/Xe,R=b/Xe}if(c||R*R<.999){const Xe=Math.sqrt(N*N+$*$+k*k);N/=Xe,$/=Xe,k/=Xe;const ct=Math.sqrt(B*B+W*W+Z*Z);B/=ct,W/=ct,Z/=ct,P=k*W-$*Z,C=N*Z-k*B,R=$*B-N*W;const ti=1/Math.sqrt(P*P+C*C+R*R);P*=ti,C*=ti,R*=ti}};for(let Ee=0;Ee<4;++Ee){const at=Ee,ht=(Ee+1)%4,Ue=Ee===0||Ee===1?1:0,He=Ee===0||Ee===3?1:0,rt=$e(Ue,Ie,Mt),wt=$e(He,Ve,ot),_t=o[at],lt=Ee===0||Ee===3?_t.count-1:0,Xe=o[ht],ct=Ee===0||Ee===1?Xe.count-1:0,ti=n[Ee].cornerTiles;let Ze=-1;for(let kt=0;kt<4;++kt){const $t=ti[kt];$t&&(Ze===-1||Cg(ti[Ze],$t)>0)&&(Ze=kt)}const tt=Ze,Ot=ti[tt];if(Ot!==l){const kt=l.level-Ot.level,$t=2**kt,cr=[Ot.lij[0]+kt,Ot.lij[1]*$t,Ot.lij[2]*$t],ji=[cr[1]+$t===l.lij[1],Ee===0&&(tt===1||tt===0&&Ot!==ti[3])||Ee===1&&(tt===0||tt===1&&Ot!==ti[2]),cr[1]===l.lij[1]+1,Ee===2&&(tt===3||tt===2&&Ot!==ti[1])||Ee===3&&(tt===2||tt===3&&Ot!==ti[0])],er=ji.reduce((Ei,ki)=>Ei+(ki?1:0),0);Fe(er===1||er===2);let Vt=-1,sr=-1;const Mi=Ot.renderData;if(er===1){const Ei=ji.findIndex(Ai=>Ai);Fe(0<=Ei&&Ei<=3),Vt=(Ei+2)%4;const ki=t.geometryState.neighborData.edgeResolutions[Ei];sr=l.getNeighborEdgeStartVertexIndex(Ei,Ot)*ki+ki*(Ei===0&&Ee===0||Ei===1&&Ee===0||Ei===2&&Ee===1||Ei===3&&Ee===3?1:0)}else{Fe(ji[1]||ji[3]),Vt=ji[1]?3:1;const Ei=Mi.geometryState.neighborData.edgeResolutions[Vt];sr=Ee===0||Ee===3?0:Ei}const Hi=Mi.geometry.outerEdges[Vt];{const Ei=_t.index0+lt*_t.stride,ki=Xe.index0+ct*Xe.stride,Ai=Hi.index0+sr*Hi.stride;{const or=Hi.attributes.position,tr=or.typedBuffer,_i=Ai*or.typedBufferStride,ir=t.localOrigin,ur=Hi.localOrigin,as=tr[_i]+ur[0]-ir[0],ls=tr[_i+1]+ur[1]-ir[1],yn=tr[_i+2]+ur[2]-ir[2];Dh(as,ls,yn,a);{const cs=_t.attributes.position,kr=cs.typedBuffer,Rr=Ei*cs.typedBufferStride;kr[Rr]=as,kr[Rr+1]=ls,kr[Rr+2]=yn}{const cs=Xe.attributes.position,kr=cs.typedBuffer,Rr=ki*cs.typedBufferStride;kr[Rr]=as,kr[Rr+1]=ls,kr[Rr+2]=yn}}ap(_t.attributes.uv0,Ei,rt,wt),ap(Xe.attributes.uv0,ki,rt,wt);{const or=Hi.attributes.normalCompressed.typedBuffer,tr=Ai*Hi.attributes.normalCompressed.typedBufferStride;{const _i=_t.attributes.normalCompressed,ir=_i.typedBuffer,ur=Ei*_i.typedBufferStride;ir[ur]=or[tr],ir[ur+1]=or[tr+1]}{const _i=Xe.attributes.normalCompressed,ir=_i.typedBuffer,ur=ki*_i.typedBufferStride;ir[ur]=or[tr],ir[ur+1]=or[tr+1]}}}}else{const kt=Y[at],$t=Y[ht];let cr;if(kt||$t){const sr=$e(oe*(1-Ue)+U*Ue,ie,le),Mi=$e(V*(1-He)+H*He,ue,ve),Hi=e.samplerData;cr=pn(sr,Mi,Hi)}else cr=yst(ti);S(Ue,He,cr),Pt(Ee);const ji=y-r[0],er=v-r[1],Vt=b-r[2];Dh(ji,er,Vt,a),_t.setVertexFromValuesRawPositionUVNormal(lt,ji,er,Vt,rt,wt,P,C,R),Xe.setVertexFromValuesRawPositionUVNormal(ct,ji,er,Vt,rt,wt,P,C,R)}}for(let Ee=0;Ee<4;++Ee)XC[Ee]=null}function yst(t){var s,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);Ps&&(Fe(!t[0]||!t[2]||vV(t[0],t[2],Et.SOUTH_WEST)),Fe(!t[1]||!t[3]||vV(t[1],t[3],Et.NORTH_WEST)));let i=0,r=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,u=a===0||a===3,p=l.extent,f=p[c?0:2],y=p[u?1:3],v=(o=(s=l.renderData)==null?void 0:s.geometryState)==null?void 0:o.samplerData;r+=pn(f,y,v),i++}}const n=i?r/i:0;return Fe(n!=null),n}function eF(t){const e=t.vao,i=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(i,0,0,i.length)}const PU=[[0,1],[1,0],[0,-1],[-1,0]],Po=new nnt,eZ=$G(-1/0,-1/0,1/0,1/0),XC=[null,null,null,null];function Uwe(t,e,i){if(!e)return!1;const r=Cg(t,e);return r>0||r===0&&i>=2}let vst=class extends Xq{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,i,r){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=li(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const n=r.view.renderSpatialReference,s=r.spatialReference,o=n!=null&&SG(n)&&s!=null&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const u=Ge(c[0],c[1],0);Ws(u,jt.WebMercator,u,jt.PlateCarree);const p=Ge(c[2],c[3],0);Ws(p,jt.WebMercator,p,jt.PlateCarree),l[0]=u[0],l[1]=u[1],l[2]=p[0],l[3]=p[1]}else for(let u=0;u<4;++u)l[u]=c[u]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,i=.5*(e[2]-e[0]),r=.5*(e[3]-e[1]),n=Math.sqrt(i*i+r*r),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[rs.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const i=this._aabb(),r=i[0],n=i[1],s=i[2],o=i[3],a=i[4],l=i[5];let c=!0;for(let u=0;u<6;u++){const p=e[u],f=p[0],y=p[1],v=p[2],b=p[3];if(f*(f>0?r:o)+y*(y>0?n:a)+v*(v>0?s:l)+b>=0)return _a.OUTSIDE;c=c&&f*(f<0?r:o)+y*(y<0?n:a)+v*(v<0?s:l)+b<=0}return c?_a.INSIDE:_a.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return zRe(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,i,r,n){return y$[0]=1/i[0],y$[1]=1/i[1],y$[2]=1/i[2],$W(this._aabb(),e,y$,r,n)}createGeometry(){dst(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){fst(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){mst(this.renderData,this._horizontalScaleFactor)}};const y$=I();let bst=class{constructor(){this.extent=gi(),this.minLevel=0,this.maxLevel=0,this.callback=null}},aL=class extends ke{constructor(){super(...arguments),this._queries=new ri({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new ri({initialSize:30}),this._queryPool=new ea(bst)}queryVisibleLevelRange(e,i,r,n){const s=this._queryPool.acquire();Ah(s.extent,e),s.minLevel=i??-Number.MAX_VALUE,s.maxLevel=r??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const i=this._queries.data[e];this._queryPool.release(i),i.callback(e>=this._queriesInvPtr),i.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const i=e.level;let r=0;for(;r<this._queriesInvPtr;){const n=this._queries.data[r],s=n.extent;i>=n.minLevel&&i<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}};d([m()],aL.prototype,"updating",null),aL=d([J("esri.views.3d.terrain.ScaleRangeQueries")],aL);let wst=class extends Xq{get convexHull(){return this._convexHull}constructor(e,i,r){super(),this._convexHull=new Array(24),this._boundingSphere=kn(),e!==void 0&&this.init(e,i,r)}init(e,i,r){super.init(e,i,r);const n=this.ellipsoid.radius,s=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],u=Bt(o,l,.5),p=Bt(s,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-s)*Math.cos(f)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),Tde(this.centerAtSeaLevel,p,u,this.ellipsoid.radius),Me(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)me(e[rs.MIDDLE],0,0,0),me(e[rs.TOP],0,0,0),me(e[rs.BOTTOM],0,0,0),e[rs.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const i=e[rs.MIDDLE],r=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,xst(i,r,3*s));e[rs.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!j_(e,this._boundingSphere))return _a.OUTSIDE;if(this.lij[0]<10)return _a.INTERSECTS;const i=this.convexHull,r=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<yS;s++){const o=s===Lr.NEAR,a=e[s],l=a[0],c=a[1],u=a[2],p=a[3]-(o?r:0);let f=!1;for(let y=0;y<8;++y){const v=3*y;if(l*i[v]+c*i[v+1]+u*i[v+2]+p<0){if(f=!0,!n)break}else n=!1}if(!f)return _a.OUTSIDE}return n?_a.INSIDE:_a.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){ost(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),Ps&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,i=e,r=this.elevationBounds,n=this.ellipsoid.radius,s=r[1];if(this.level===0)me(i,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];Cv(bre,a,l,n),Cv(wre,a,c,n),xe(i,bre,wre);const u=.5*(r[0]+r[1]);pe(i,i,(n+u)/ac(i));const p=this.convexHull;let f=0;const y=(b,x)=>{const S=b[0]-p[3*x],P=b[1]-p[3*x+1],C=b[2]-p[3*x+2];return Math.sqrt(S*S+P*P+C*C)};for(let b=0;b<8;++b){const x=y(i,b);f=Math.max(f,x)}const v=f;e[3]=v+2}}_updateConvexHull(){const e=this.extentInRadians,i=this.ellipsoid.radius;if(this.level===0)return;const r=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===yh.HAS_NORTH_POLE,a=s&&n===yh.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],p=e[2],f=a?-c:e[1],y=o?c:e[3],v=.5*(u+p),b=r[0],x=i+(l?Math.min(0,b-1):b),S=(oe,U,V)=>Cv(oe,U,V,x),P=I(),C=I(),R=I(),N=I();S(P,u,f),S(C,u,y),S(R,p,y),S(N,p,f);const $=(oe,U)=>{for(let V=0;V<3;++V)this._convexHull[3*U+V]=oe[V]};$(P,0),$(C,1),$(R,2),$(N,3);const k=r[1],B=i+(l?Math.max(0,k+1):k),W=I(),Z=I(),K=I();Cv(Z,v,y,x),Cv(K,v,f,x),xe(W,Z,K),Me(W,W);const X=I(),ae=I(),re=(oe,U)=>{uo(ae,oe,U),Me(ae,ae);const V=-Re(oe,X)/Re(ae,X);Fe(V>=0),pe(ae,ae,V),xe(oe,oe,ae)};if(2**this.lij[0]>2*this.lij[1]){const oe=K,U=I();Rt(U,vre,oe),Me(U,U),Rt(X,oe,U),Me(X,X),Fe(bh(Re(X,oe)/ac(oe),0)),re(P,C),re(N,R),$(P,0),$(N,3)}else if(2**this.lij[0]!==2*this.lij[1]){const oe=Z,U=I();Rt(U,vre,oe),Me(U,U),Rt(X,U,oe),Me(X,X),re(C,P),re(R,N),$(C,1),$(R,2)}const ee=(oe,U)=>{const V=B/Re(U,W);for(let H=0;H<3;++H)this._convexHull[3*oe+H]=U[H]*V};ee(4,P),ee(5,C),ee(6,R),ee(7,N)}_getPatchType(){const e=this.lij[1],i=e===0,r=e===(1<<this.level)-1;return i?r?yh.HAS_BOTH_POLES:yh.HAS_NORTH_POLE:r?yh.HAS_SOUTH_POLE:yh.REGULAR}intersectsRay(e,i,r,n){const s=this._boundingSphere,o=s[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=s[0]-e[0],c=s[1]-e[1],u=s[2]-e[2],p=(l*i[0]+c*i[1]+u*i[2])/a,f=i[0]*p-l,y=i[1]*p-c,v=i[2]*p-u;return f*f+y*y+v*v<o*o}getDefaultVerticesPerSide(){return this.level<yre.length?yre[this.level]+1:2}updateCornerElevations(){cst(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){lst(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var ht;if(!Ps||this.level<=2)return;const e=this._boundingSphere,i=e[3],r=e,n=I(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,u=this._center[rs.MIDDLE][3],p=this.convexHull,f=(Ue,He)=>{for(let rt=0;rt<3;++rt)Ue[rt]=p[3*He+rt]};{const Ue=I(),He=I(),rt=I(),wt=I(),_t=I(),lt=(Xe,ct,ti,Ze)=>{f(He,Xe),f(rt,ct),f(wt,ti),uo(He,He,rt),uo(wt,wt,rt),Rt(Ue,He,wt),Me(Ue,Ue);const tt=Re(Ue,rt);f(_t,Ze);const Ot=Re(Ue,_t),kt=Math.abs(Ot-tt);Fe(bh(kt,0),`Non coplanar ${Xe},${ct},${ti},${Ze} diff = ${kt}`)};lt(0,1,2,3),lt(4,5,6,7),lt(0,1,4,5),lt(1,2,5,6),lt(2,3,6,7),lt(3,0,7,4)}const y=ia(24),v=(Ue,He,rt)=>{const wt=4*Ue;for(let _t=0;_t<3;++_t)y[wt+_t]=He[_t];y[wt+3]=rt},b=I(),x=I(),S=I(),P=I(),C=(Ue,He,rt,wt)=>{f(b,He),f(x,rt),f(S,wt),uo(b,b,x),Me(b,b),uo(S,S,x),Me(S,S),Rt(P,b,S),Me(P,P);const _t=Re(P,x);v(Ue,P,_t)};C(0,0,1,2),C(1,1,0,4),C(2,1,5,2),C(3,3,2,6),C(4,4,0,3),C(5,4,6,5);const R=1,N=(Ue,He,rt,wt)=>{const _t=4*Ue;return y[_t]*He+y[_t+1]*rt+y[_t+2]*wt-y[_t+3]},$=(Ue,He,rt,wt)=>N(Ue,He,rt,wt)>=-R,k=(Ue,He)=>$(Ue,He[0],He[1],He[2]),B=2**this.lij[0]>2*this.lij[1],W=(Ue,He,rt)=>Math.sqrt(zwe(Ue,He,rt,r[0],r[1],r[2]))<i,Z=Ue=>W(Ue[0],Ue[1],Ue[2]),K=(Ue,He)=>W(Ue[He],Ue[He+1],Ue[He+2]),X=this.extentInRadians,ae=.5*(X[0]+X[2]),re=X[1],ee=X[3],oe=I(),U=I();Cv(oe,ae,ee,a),Cv(U,ae,re,a);const V=B?"Upper":"Lower";let H=!0;for(let Ue=0;Ue<6;++Ue){for(let He=0;He<8;++He){const rt=3*He,wt=$(Ue,p[rt],p[rt+1],p[rt+2]);H&&(H=wt),Fe(wt,`Tile[${this.lij}] Convex hull point ${He} outside of plane ${Ue}`)}Fe(k(Ue,U),`Tile[${this.lij}] (${V}) bottom mid outside of plane ${Ue}`),Fe(k(Ue,oe),`Tile[${this.lij}] (${V}) top mid outside of plane ${Ue}`)}Fe(H,"Not all convex hull points are inside  convex hull polyhedron"),Fe(Z(U),`Tile[${this.lij}] (${V}) bottom mid outside of bounding sphere`),Fe(Z(oe),`Tile[${this.lij}] (${V}) top mid outside of bounding sphere`);for(let Ue=0;Ue<8;++Ue){const He=K(p,3*Ue);Fe(He,`Tile[${this.lij}] Convex hull point ${Ue} outside of bounding sphere`)}for(let Ue=0;Ue<6;++Ue)for(let He=0;He<8;++He){const rt=3*He;$(Ue,p[rt],p[rt+1],p[rt+2])||console.error(`Tile[${this.lij}] Convex hull point ${He} outside of plane ${Ue}`)}const Y=this.extentInRadians,ie=Math.max(Y[2]-Y[0],Y[3]-Y[1]),le=Math.round(ie*s),ue=this.renderData;if(!ue)return;const{geometry:ve,localOrigin:Ie}=ue,Ve=(ht=ve.vertexAttributes)==null?void 0:ht.position;if(!Ve)return;const Mt=Ve.count,ot=I(),Pt=ve.numVerticesPerSide-2,qe=Pt*Pt,Ee=ue.geometryState.neighborData,at=Ee.edgeResolutions.reduce((Ue,He)=>Ue+He+1,0);for(let Ue=0;Ue<Mt;++Ue){const He=Ue<qe,rt=!He&&Ue<qe+at;let wt=!1,_t=-1;if(rt){let Vt=qe;for(let sr=0;sr<4;++sr){const Mi=Ee.edgeResolutions[sr];if(Ue===Vt||Ue===Vt+Mi-1){wt=!0;break}if(Vt+=Mi,Ue<Vt){_t=sr;break}}}const lt=rt?Ee.edgePeerNeighbors[_t]:null,Xe=rt&&lt&&Cg(this,lt)>0;Ve.getVec(Ue,n),xe(ot,n,Ie);const ct=ac(ot)-s;let ti=0,Ze=!1;const tt=o[0]-ct,Ot=ct-o[1],kt=tt>l,$t=Ot>l,cr=kt||$t,ji=()=>{const Vt=He?"internal":rt&&!wt?"edge":wt?"corner":"pole";return`Tile[${this.lij}].vertex[${Ue}]:${Vt}`+(kt?"(below)":$t?"(above)":"")+(Xe?"(Neighbor)":"")},er=O3(ot,r);if(er>=i+c){const Vt=er-i;cr||(console.error(`${ji()} is out of the bounding sphere by ${Vt.toFixed(0)} / ${i.toFixed(0)}[tol=${c}] h=${ct.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(Vt/i).toFixed(0)})`),Ze=!0)}for(let Vt=0;Vt<6;++Vt)if(!$(Vt,ot[0],ot[1],ot[2])){const sr=N(Vt,ot[0],ot[1],ot[2]),Mi=Ue%Pt,Hi=(Ue-Mi)/Pt;Vt===0&&tt||Vt===5&&Ot||(console.error(`${ji()} (${Mi},${Hi})|${Pt}] is out of the bounding trapezoid plane ${Vt} h=${Math.round(ct)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(sr)} radii = ${Math.round(i)}/${Math.round(u)}} : maxL = ${le}`),++ti)}if(Ze||ti>0)break}}};const yre=[128,64,64,32,16,8,8,4];function xst(t,e,i){return zwe(t[0],t[1],t[2],e[i],e[i+1],e[i+2])}function zwe(t,e,i,r,n,s){const o=r-t,a=n-e,l=s-i;return o*o+a*a+l*l}const Cv=(t,e,i,r)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(i),a=Math.sin(i);t[0]=r*o*n,t[1]=r*o*s,t[2]=r*a},vre=[0,0,1],bre=I(),wre=I();let Rd=class extends ke{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([m()],Rd.prototype,"fovX",void 0),d([m()],Rd.prototype,"fovY",void 0),d([m()],Rd.prototype,"relativeWidthLimit",void 0),d([m()],Rd.prototype,"relativeHeightLimit",void 0),d([m()],Rd.prototype,"maxLod",void 0),d([m()],Rd.prototype,"angledSplitBias",void 0),d([m()],Rd.prototype,"aboveGround",void 0),d([m()],Rd.prototype,"frustum",void 0),Rd=d([J("esri.views.3d.terrain.SplitLimits")],Rd);let Bwe=class extends Oa{constructor(){super(...arguments),this.blendMode=We.Normal}};d([q({count:We.COUNT})],Bwe.prototype,"blendMode",void 0);let dP=class extends Bwe{constructor(){super(...arguments),this.output=Bs.Composite,this.baseOpacityMode=ep.NotRequired,this.premultipliedSource=Bd.Off}};d([q({count:Bs.COUNT})],dP.prototype,"output",void 0),d([q({count:ep.COUNT})],dP.prototype,"baseOpacityMode",void 0),d([q()],dP.prototype,"premultipliedSource",void 0);var Lb;function Tst(t){const e=new Fi;if(e.include(bwe),t.background===Lb.Only){const i=t.output===Bs.ColorComposite;return i?e.fragment.uniforms.add(new ei("backgroundColor",r=>r.backgroundColor)):e.fragment.include(Zq),e.fragment.code.add(T`
    void main() {
      fragColor = vec4(${i?T`backgroundColor`:T`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(wwe,t),e.fragment.uniforms.add(new vt("tex",i=>i.texture)),e.fragment.uniforms.add(new je("opacity",i=>i.opacity)),e.fragment.code.add(T`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(Lb||(Lb={}));const Sst=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return Lb},build:Tst},Symbol.toStringTag,{value:"Module"}));let Cst=class extends vwe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=tl}},Vwe=class Gwe extends qi{initializeProgram(e){return new Gi(e.rctx,Gwe.shader.get().build(this.configuration),Ni)}initializePipeline(){return Zt({blending:Ec(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni})}};Vwe.shader=new Vi(Sst,()=>Oe(()=>import("./BlendLayers.glsl-0f2a2f3c.js"),[],import.meta.url));let jwe=class extends dP{constructor(){super(...arguments),this.background=Lb.BelowLayer}};d([q()],jwe.prototype,"background",void 0);let OU=class{constructor(e,i,r,n,s,o){this.texture=e,this.type=i,e.retain(),this.offsetAndScale=Kt(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ge(n,s,o)}destroy(){this.texture.release()}};function Est(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Ast(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Pst(t,e,i,r,n,s,o){return t[0]=e,t[1]=i,t[2]=r,t[3]=n,t[4]=s,t[5]=o,t}function Hwe(t,e){const i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=i*s-r*n;return l?(l=1/l,t[0]=s*l,t[1]=-r*l,t[2]=-n*l,t[3]=i*l,t[4]=(n*a-s*o)*l,t[5]=(r*o-i*a)*l,t):null}function Ost(t){return t[0]*t[3]-t[1]*t[2]}function Wwe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1],p=i[2],f=i[3],y=i[4],v=i[5];return t[0]=r*c+s*u,t[1]=n*c+o*u,t[2]=r*p+s*f,t[3]=n*p+o*f,t[4]=r*y+s*v+a,t[5]=n*y+o*v+l,t}function tZ(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(i),u=Math.cos(i);return t[0]=r*u+s*c,t[1]=n*u+o*c,t[2]=r*-c+s*u,t[3]=n*-c+o*u,t[4]=a,t[5]=l,t}function qwe(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r*c,t[1]=n*c,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=l,t}function iZ(t,e,i){const r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=i[0],u=i[1];return t[0]=r,t[1]=n,t[2]=s,t[3]=o,t[4]=r*c+s*u+a,t[5]=n*c+o*u+l,t}function Rst(t,e){const i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=-i,t[3]=r,t[4]=0,t[5]=0,t}function Mst(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function rZ(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function $st(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Ist(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function Lst(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t}function Zwe(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}function Dst(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t}function Nst(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t[3]=e[3]+i[3]*r,t[4]=e[4]+i[4]*r,t[5]=e[5]+i[5]*r,t}function Fst(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function kst(t,e){const i=t[0],r=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],p=e[3],f=e[4],y=e[5],v=ol();return Math.abs(i-l)<=v*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=v*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-u)<=v*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-p)<=v*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(o-f)<=v*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-y)<=v*Math.max(1,Math.abs(a),Math.abs(y))}const Ust=Wwe,zst=Zwe;Object.freeze(Object.defineProperty({__proto__:null,add:Lst,copy:Est,determinant:Ost,equals:kst,exactEquals:Fst,frob:Ist,fromRotation:Rst,fromScaling:Mst,fromTranslation:rZ,identity:Ast,invert:Hwe,mul:Ust,multiply:Wwe,multiplyScalar:Dst,multiplyScalarAndAdd:Nst,rotate:tZ,scale:qwe,set:Pst,str:$st,sub:zst,subtract:Zwe,translate:iZ},Symbol.toStringTag,{value:"Module"}));function Xwe(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function Bst(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Vst(t,e,i,r,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=i,o[3]=r,o[4]=n,o[5]=s,o}function Gst(t,e){return new Float32Array(t,e,6)}function Ywe(t,e,i,r){const n=e[r],s=e[r+1];t[r]=i[0]*n+i[2]*s+i[4],t[r+1]=i[1]*n+i[3]*s+i[5]}function jst(t,e,i,r=0,n=0,s=2){const o=n||e.length/s;for(let a=r;a<o;a++)Ywe(t,e,i,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:Bst,create:Xwe,createView:Gst,fromValues:Vst,transform:Ywe,transformMany:jst},Symbol.toStringTag,{value:"Module"}));function lL(){return[1,0,0,1,0,0]}function Hst(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function Wst(t,e,i,r,n,s){return[t,e,i,r,n,s]}function qst(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:Hst,create:lL,createView:qst,fromValues:Wst},Symbol.toStringTag,{value:"Module"}));function Zst(t){return t instanceof Float32Array&&t.length>=2}function Xst(t){return Array.isArray(t)&&t.length>=2}function RU(t){return Zst(t)||Xst(t)}const Yst=96,Jst=39.37;function nZ(t,e){return e.type?bi(t,e.x,e.y):Is(t,e)}function Kst(t){return al(t)}function Qst(t,e){const i=t.targetGeometry,r=e.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const eot=function(){const t=it();return function(e,i,r){const n=i.targetGeometry;nZ(t,n);const s=.5*tF(i);return e.xmin=t[0]-s*r[0],e.ymin=t[1]-s*r[1],e.xmax=t[0]+s*r[0],e.ymax=t[1]+s*r[1],e.spatialReference=n.spatialReference,e}}();function tF(t){return t.scale*tot(t.targetGeometry)}function tot(t){return t!=null&&Ta(t.spatialReference)?1/(Kst(t.spatialReference)*Jst*Yst):1}function iot(t){return i5(t.rotation)||0}const sZ=function(){const t=it(),e=it(),i=it();return function(r,n,s,o,a,l){return bH(t,n),gc(e,s,.5*l),bi(i,1/o*l,-1/o*l),rZ(r,e),a&&tZ(r,r,a),qwe(r,r,i),iZ(r,r,t),r}}(),rot=function(){const t=it();return function(e,i,r,n){const s=tF(i),o=iot(i);return nZ(t,i.targetGeometry),sZ(e,t,r,s,o,n)}}(),not=function(){const t=it();return function(e,i,r,n){const s=tF(i);return nZ(t,i.targetGeometry),sZ(e,t,r,s,0,n)}}();function sot(t){const e=F1(t);return e?e.valid[1]-e.valid[0]:0}function oot(t,e){return Math.round(sot(t)/e)}var wV;const Mm=[0,0];let h_=wV=class extends Nt{constructor(t){super(t),this._viewpoint2D={center:it(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new Ar,this.id=0,this.inverseTransform=lL(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=lL(),this.transformNoRotation=lL(),this.displayMat3=Ll(),this.displayViewMat3=Ll(),this.viewMat3=Ll(),this.viewMat2d=Xwe(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,i=t.targetGeometry;e.center[0]=i.x,e.center[1]=i.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=i.spatialReference}this._update()}copy(t){const e=this.size,i=this.viewpoint;return i&&e?(this.viewpoint=Qst(i,t.viewpoint),this._set("size",Is(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new wV({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,i){return RU(e)?Zv(t,e,this.inverseTransform):(Mm[0]=e,Mm[1]=i,Zv(t,Mm,this.inverseTransform))}toScreen(t,e,i){return RU(e)?Zv(t,e,this.transform):(Mm[0]=e,Mm[1]=i,Zv(t,Mm,this.transform))}toScreenNoRotation(t,e,i){return RU(e)?Zv(t,e,this.transformNoRotation):(Mm[0]=e,Mm[1]=i,Zv(t,Mm,this.transformNoRotation))}getScreenTransform(t,e){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,n=this._get("size");return sZ(t,i,n,e,0,r),t}_update(){const{center:t,spatialReference:e,scale:i,rotation:r}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new pp({targetGeometry:new Ft(t[0],t[1],e),scale:i,rotation:r});if(this._set("viewpoint",o),!s||!e||!i)return;this.resolution=tF(o),this.rotation=r,this.scale=i,this.spatialReference=e,Is(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;$H(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=IH(this.viewMat3),u=vh(s[0]/2,s[1]/2),p=vh(-s[0]/2,-s[1]/2),f=i5(r);xD(c,c,u),LH(c,c,f),xD(c,c,p),IT(this.displayViewMat3,this.displayMat3,c);const y=rZ(this.viewMat2d,u);return tZ(y,y,f),iZ(y,y,p),eot(this.extent,o,s),rot(this.transform,o,s,n),Hwe(this.inverseTransform,this.transform),not(this.transformNoRotation,o,s,n),this.worldScreenWidth=oot(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};d([m({readOnly:!0})],h_.prototype,"id",void 0),d([m({value:1,json:{write:!0}})],h_.prototype,"pixelRatio",null),d([m({json:{write:!0}})],h_.prototype,"size",null),d([m()],h_.prototype,"spatialReference",void 0),d([m({type:pp,json:{write:!0}})],h_.prototype,"viewpoint",null),h_=wV=d([J("esri.views.2d.ViewState")],h_);const aot=h_;var xV,TV,xre,Tre,Sre,Cre,Ere,Are,Pre,Ore,Rre,Mre,$re,Ire,Lre,Dre,Nre,Fre,kre,Ure,zre,Bre,Vre,Gre,jre,Hre,Wre,qre,Zre,Xre,Yre,Jre,Kre,Qre,ene,tne,ine,rne,nne,sne,one,ane,lne,cne,une,hne,dne,pne,fne,mne,gne,_ne,yne,vne,bne,wne,xne,Tne,Sne,Cne,Ene;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(xV||(xV={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(TV||(TV={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(xre||(xre={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(Tre||(Tre={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(Sre||(Sre={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(Cre||(Cre={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(Ere||(Ere={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(Are||(Are={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(Pre||(Pre={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(Ore||(Ore={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(Rre||(Rre={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(Mre||(Mre={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}($re||($re={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(Ire||(Ire={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(Lre||(Lre={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(Dre||(Dre={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}(Nre||(Nre={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(Fre||(Fre={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(kre||(kre={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(Ure||(Ure={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(zre||(zre={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(Bre||(Bre={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(Vre||(Vre={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Gre||(Gre={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(jre||(jre={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(Hre||(Hre={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(Wre||(Wre={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(qre||(qre={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(Zre||(Zre={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(Xre||(Xre={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(Yre||(Yre={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(Jre||(Jre={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(Kre||(Kre={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(Qre||(Qre={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(ene||(ene={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(tne||(tne={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(ine||(ine={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(rne||(rne={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(nne||(nne={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(sne||(sne={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(one||(one={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(ane||(ane={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(lne||(lne={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(cne||(cne={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(une||(une={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(hne||(hne={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(dne||(dne={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(pne||(pne={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(fne||(fne={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(mne||(mne={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(gne||(gne={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(_ne||(_ne={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(yne||(yne={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(vne||(vne={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(bne||(bne={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(wne||(wne={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(xne||(xne={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(Tne||(Tne={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(Sne||(Sne={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(Cne||(Cne={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(Ene||(Ene={}));var SV,T1,CV,TN,EV,SN,AV,S1,PV;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(SV||(SV={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(T1||(T1={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(CV||(CV={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(TN||(TN={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(EV||(EV={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(SN||(SN={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(AV||(AV={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(S1||(S1={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(PV||(PV={}));let gd=class{};gd.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:T1.VISIBLE}},gd.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:T1.VISIBLE}},gd.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:T1.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:xV.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:TV.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},gd.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:T1.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:CV.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:SN.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:TN.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:SN.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:EV.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:TN.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:AV.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[PV.HORIZONTAL]}},gd.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:T1.VISIBLE}},gd.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},gd.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:S1.MAP}},gd.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:S1.MAP},"line-width":{type:"number",minimum:0,default:1}},gd.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:S1.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:S1.MAP}},gd.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},gd.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:S1.MAP}};const lot=.125;let cot=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new aot({viewpoint:new pp({targetGeometry:new Ft(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,i,r,n,s,o,a,l,c,u,p){this._render(e,i,r,n,s,o,a,l,c,u,p)}renderSymbols(e,i,r,n,s,o,a,l,c,u,p){this._render(e,i,r,n,s,o,a,l,c,u,p,SV.SYMBOL)}_render(e,i,r,n,s,o,a,l,c,u,p,f){const y=i[0]-o.getLevelShift(i[0]),v=this._renderParams;v.context=e,v.painter=n,v.glyphMosaic=n.glyphMosaic,v.spriteMosaic=n.spriteMosaic,v.pixelRatio=u*p,v.displayLevel=y,v.requiredLevel=y;const b=o.getScale(i[0]),[x,S]=o.getOffset(i,a*b),P=lot*a*b/c,C=r.transforms.dvs;C[0]=P,C[4]=-P,C[6]=-1-x-l[0]*a*2,C[7]=1+S+(1-l[1])*a*2-2,v.state.size[0]=c/p,v.state.size[1]=c/p,v.state.pixelRatio=p,r.stage||r.attachWithContext(e),r.triangleCount=0,n.drawTile(v,r,s,f)}},Jwe=class Kwe extends qi{initializeProgram(e){return new Gi(e.rctx,Kwe.shader.get().build(this.configuration),Ni)}initializePipeline(){return Zt({blending:Ec(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni})}};Jwe.shader=new Vi(Pnt,()=>Oe(()=>import("./RasterColorizer.glsl-06f195b3.js"),[],import.meta.url));let uA=class extends dP{constructor(){super(...arguments),this.colorizerType=J1.Stretch,this.stretchType=Ib.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([q({count:J1.COUNT})],uA.prototype,"colorizerType",void 0),d([q({count:Ib.COUNT})],uA.prototype,"stretchType",void 0),d([q()],uA.prototype,"applyColormap",void 0),d([q()],uA.prototype,"requireBilinearWithNN",void 0);let Ane=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const i=this._fbos.get(e);if(i)return i;const r=new Rs(this._rctx,new Di(e),new SD(hs.DEPTH_COMPONENT16,e));return this._fbos.set(e,r),r}};const uot=ye.getLogger("esri.views.3d.terrain");let hot=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._fbos=[],this._vectorTileHelper=new cot,this._bindParameters=new i4(null,null,null),this._blendLayersTechniqueConfig=new jwe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=Fl(this._rctx,H3)}dispose(){this._fbos.forEach(et),this._fbos=null,this._vtFBO=et(this._vtFBO),this._vaoQuad=et(this._vaoQuad),this._vectorTileHelper=et(this._vectorTileHelper),this._backgroundTechnique=nn(this._backgroundTechnique),this._applyOpacityTechnique=nn(this._applyOpacityTechnique),this._blendLayersTechnique=nn(this._blendLayersTechnique)}_getBlendLayersTechnique(e,i,r,n=Bd.Off,s=Lb.BelowLayer){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=r,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(Vwe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,i){const r=this._getBlendLayersTechnique(We.Normal,i?Bs.ColorComposite:Bs.GridComposite,ep.NotRequired,Bd.Off,Lb.Only),n=this._rctx.bindTechnique(r,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(this._vaoQuad,"geometry"))}drawGroup(e,i,r,n,s,o=Bd.On){i===Bs.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(r).colorTexture),e.texture=this.currentFBO(r).colorTexture,this.closeGroup(r);const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,i,r,n,s,o=Bd.Off){if(e.texture==null)return;e.fboTexture=i===Bs.GroupBackgroundComposite||n===We.Normal&&s===ep.NotRequired&&o===Bd.Off?null:this.switch(r).colorTexture;const a=this._getBlendLayersTechnique(n,i,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,i,r,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,mi.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===We.Normal&&s===ep.NotRequired?null:this.switch(r).colorTexture;const l=this._getRasterColorizerTechnique(a,i,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(e,i,r,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new uA,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=i,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?Ib.Noop:Ib.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(Jwe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,i,r,n,s,o,a,l,c){const u=this._rctx,p=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,mi.MAP),y=s===ep.Required||e.opacity<1||n!==We.Normal||i!==Bs.Composite,v=y?Bd.On:Bd.Off;this._getBlendLayersTechnique(n,i,s,v).bindPipelineState(u);let b=null,x=null;y?(x=this.currentFBO(r),this._vtFBO==null&&(this._vtFBO=new Ane(this._rctx)),b=this._vtFBO.get(r),u.bindFramebuffer(b),this._clearCurrentFBO()):c&&u.clearSafe(Vr.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(u,o.sourceLod,p,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),o.vtlNeighborInfos.forAll(S=>this._vectorTileHelper.renderSymbols(u,S.sourceLod,S.sourceLayerInfo.data,f.painter,f.layer.styleRepository,f.schemaHelper,1,S.offset,l,a,f.contentZoom))}catch(S){uot.warnOnce("A render call containing vector tiles did not resolve correctly.",S)}return b==null||(u.bindFramebuffer(x),e.texture=b.colorTexture,e.offset=fp,e.scale=1,this.drawRasterData(e,i,r,n,s,v),c)}copyFBOToTexture(e){const i=this._rctx,r=i.bindTexture(e.texture,Wt.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;i.gl.copyTexImage2D(Cn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),i.bindTexture(r,Wt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT)}_initFBO(e,i,r){this._rctx.bindFramebuffer(e),r&&(this._rctx.setViewport(0,0,i,i),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,i=0,r=!0){if(this._current=i,i>=this._fbos.length)for(let n=this._fbos.length;n<=i;n++)this._fbos.push(new Ane(this._rctx));this._initFBO(this._fbos[i].get(e),e,r)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const i=this.currentFBO(e),r=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),i}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const i=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},dot=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new ri({allocator:e=>e||new pot})}},pot=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},fot=class{constructor(e,i,r,n){this.start=e,this.end=i,this.blendMode=r,this.opacity=n}},mot=class{constructor(e,i,r){this._rctx=e,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new Cst,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new hot(this._rctx,this._techniqueRepository),this._blackTex=new o2(x6e(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=et(this._composition),this._backgroundTexture=nn(this._backgroundTexture),this._blackTex=nn(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,i){if(!e.renderData)return;const r=e.surface,n=r.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1;const c=r.view.state.contentPixelRatio;let u=!1;CN.clear(),fx.length=0;const p=e.layerInfo[mi.MAP];let f=p.length,y=0,v=null;for(;y<p.length;y++){const x=r.layerViewByIndex(y,mi.MAP),S=x.layer.opacity;Pne[y]=S;const P=x.fullOpacity;if(One[y]=P,Tpe(x.layer)&&f>=p.length&&(f=y),yN(x)){Rne[y]=x.layer.blendMode;let R=x.layer.blendMode!=="normal";if(ET(x.layer.parent)){const N=OV(x.layer.parent);N!=null&&N!==""&&(R=Qwe(x.layer.parent)||R)}R&&(u=R,l=!1)}if(S===0&&!u){p[y].pendingUpdates&=~(Ut.TEXTURE_NOFADING&Ut.TEXTURE_FADING);continue}++o;const C=MU(e,y);if(C){if(p[y].pendingUpdates&=~(Ut.TEXTURE_NOFADING&Ut.TEXTURE_FADING),ET(x.layer.parent)){const R=OV(x.layer.parent);R!=null&&R!==""&&exe(x.layer.parent,y)}c3(x)?a=Math.max(a,this.tileSize*c):n===1&&P===1&&(x.isOpaque||this._dataToTexture(C)&&C.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,v===null&&(v=y)}}const b=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),s!==0&&v!==null?s===1&&!u&&this._useLayerTexture(e,v,f,One[v])||this._composeMapLayers(e,i,y-1,f,Pne,Rne,a,b,!l||u,CN,u):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=fp,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,i){let r=Sg.Immediate;(e.surface.view.layerViewManager.updating||i>0)&&(r=Sg.Delayed);const n=e.renderData;this._backgroundTexture&&n.textureReference==null&&(r=Sg.Immediate),n.setTextureReference(this._backgroundTexture!=null?new OU(this._backgroundTexture,Ss.FADING,Mne,e.surface.baseOpacity,0,1):null,r)}_useLayerTexture(e,i,r,n){const s=i<r,o=s?1:e.surface.baseOpacity,a=s?e.surface.baseOpacity:1,l=MU(e,i);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new OU(l.sourceLayerInfo.data,Ss.FADING,l,o,a,n)),!0)}_composeMapLayers(e,i,r,n,s,o,a,l,c,u,p){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let y=!1,v=qt.LINEAR_MIPMAP_LINEAR,b=!1,x=0;for(let C=r;C>=0;C--){const R=MU(e,C);if(!R||s[C]===0&&!p)continue;const N=C<n&&f<1&&!y;this._passParameters.baseOpacity=N?f:1;const $=this._passParameters.baseOpacity<1?ep.Required:ep.NotRequired;N&&(y=!0);let k=!1;u.forEach(K=>{K.start===C&&(fx.push(K),this._composition.openGroup(a),k=!0)});const B=x===0,W=k?Bs.GroupBackgroundComposite:c&&B?this.backgroundIsGrid?Bs.GridComposite:Bs.ColorComposite:Bs.Composite,Z=yV[o[C]];for(iwe(R)?(this._passParameters.opacity=s[C],b=this._composition.drawVectorData(this._passParameters,W,a,Z,$,R,l,this.tileSize,b)):Jit(R)?(this._passParameters.opacity=s[C],this._composition.drawImageryTileData(this._passParameters,W,a,Z,$,R),this._hasNearestInterpolation(R)&&(v=qt.NEAREST)):this._dataToTexture(R)&&(this._passParameters.texture=R.sourceLayerInfo.data.texture,this._passParameters.offset=R.offset,this._passParameters.scale=R.scale,this._passParameters.opacity=s[C],this._composition.drawRasterData(this._passParameters,W,a,Z,$));fx.length>0&&fx[fx.length-1].end===C;){const K=fx.pop();this._passParameters.opacity=K.opacity,this._passParameters.offset=fp,this._passParameters.scale=1;const X=c&&B?this.backgroundIsGrid?Bs.GridComposite:Bs.ColorComposite:Bs.Composite;this._composition.drawGroup(this._passParameters,X,a,yV[K.blendMode],$)}x++}const S=e.renderData,P=S.ensureTexture(a,()=>this._buildTexture(a,v));this._composition.copyFBOToTexture(P),this._composition.unbind(),S.setTextureReference(new OU(P,i,Mne,y?1:f,0,1))}_hasNearestInterpolation(e){const i=e.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(e){if(Qit(e)){const i=e.sourceLayerInfo;i.data=this._buildTexture(i.data),e.tile.setMemoryDirty()}return Kit(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,i=qt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const r=new Di;r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=i,r.maxAnisotropy=this._maxAnisotropy,r.preMultiplyAlpha=!0,r.flipped=!0,r.hasMipmap=!0;const n=this._rctx;let s;if(typeof e=="number")r.width=r.height=e,s=new o2(new Wt(n,r));else if(e instanceof X4)r.isOpaque=e.isOpaque,s=new o2(new Wt(n,r,e.image)),e.release();else try{r.width=e.width,r.height=e.height,s=new o2(new Wt(n,r,e))}catch{s=new o2(rme(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=n.bindTexture(s.texture,Wt.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(o,Wt.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}};function MU(t,e){Da.layerIndex=e,Da.vtlNeighborInfos.clear();const i=t.layerInfo[mi.MAP][e];if(i.data)return bi(Da.offset,0,0),Da.tile=t,Da.scale=1,Da.sourceLod=t.lij,Da.sourceLayerInfo=i,iwe(Da)&&t.forEachLoadedNeighbor((n,s)=>{if(n.level!==t.level)return;const o=n.layerInfo[mi.MAP][e];if(!rwe(o)||i.data===o.data)return;const a=Da.vtlNeighborInfos.pushNew();a.offset=Ym[s],a.sourceLod=n.lij,a.sourceLayerInfo=o}),Da;const r=i.upsampleInfo;if(r){const n=r.tile.layerInfo[mi.MAP][e];return Da.tile=r.tile,Is(Da.offset,r.offset),Da.scale=r.scale,Da.sourceLod=r.tile.lij,Da.sourceLayerInfo=n,Da}return null}function OV(t){return t.get("uid")}function Qwe(t){let e=t.blendMode!=="normal";return ET(t.parent)&&(e=Qwe(t.parent)||e),e}function exe(t,e){ET(t.parent)&&exe(t.parent,e);const i=OV(t);if(i!=null&&i!==""){const r=CN.get(i);r?r.start=e:CN.set(i,new fot(e,e,t.blendMode,t.opacity))}}const Pne=new Array,One=new Array,Rne=new Array,CN=new Map,fx=new Array,Da=new dot,Mne={offset:[0,0],scale:1},Ym=new Array;Ym[Et.NORTH]=[0,-1],Ym[Et.NORTH_EAST]=[-1,-1],Ym[Et.EAST]=[-1,0],Ym[Et.SOUTH_EAST]=[-1,1],Ym[Et.SOUTH]=[0,1],Ym[Et.SOUTH_WEST]=[1,1],Ym[Et.WEST]=[1,0],Ym[Et.NORTH_WEST]=[1,-1];const txe=200,$U=40,got=.8,_ot=10,hA=1e-6;function yot(t,e,i){const r=e,n=i;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(r[a]<l){if(n[a]<=hA)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-hA){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(r[a]>l){if(n[a]>=-hA)return!1;const c=(l-r[a])/n[a];s=Math.max(s,c)}else if(n[a]>=hA){const c=(l-r[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let $ne=class{constructor(e,i,r,n,s){this.aabb=e,this.axis=i,this.d=r,this.midStartIndex=n,this.rightStartIndex=s}},oZ=class RV{constructor(e,i,r,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=i,this.positionAttribute=n,this._rayDirection=I(),this.bspNodeTree=new Array;const s=r-i,o=s<=ixe?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=Tot(e,i,r,n.data,n.stride),l=$e(Math.log2(s/$U),2,_ot),c=(u,p,f)=>{const y=wot(o,a,u,p),v=p-u;if(v<=$U){const R=new $ne(y,void 0,0,u,p);return this.bspNodeTree.push(R),R}const{axis:b,midValue:x}=xot(y),S=bot(o,a,u,p,b,x),P=(R,N)=>{if(f>l)return;const $=N-R;return $<$U||$>=got*v?void 0:c(R,N,f+1)},C=new $ne(y,b,x,S.next,S.mid);return this.bspNodeTree.push(C),C.leftNode=P(u,S.next),C.rightNode=P(S.mid,p),C};c(0,s,0),this.triangleVertexIndices=Sot(o,e,i,r)}}intersectRayTriangleRange(e,i){{if(e>=i)return;const r=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,p=u[0],f=u[1],y=u[2];for(let v=e,b=3*e;v<i;++v){let x=r[b++]*s;const S=n[x++],P=n[x++],C=n[x];x=r[b++]*s;const R=n[x++],N=n[x++],$=n[x];x=r[b++]*s;const k=R-S,B=N-P,W=$-C,Z=n[x++]-S,K=n[x++]-P,X=n[x]-C,ae=f*X-K*y,re=y*Z-X*p,ee=p*K-Z*f,oe=k*ae+B*re+W*ee;if(Math.abs(oe)<=Number.EPSILON)continue;const U=a-S,V=l-P,H=c-C,Y=U*ae+V*re+H*ee;if(oe>0){if(Y<0||Y>oe)continue}else if(Y>0||Y<oe)continue;const ie=V*W-B*H,le=H*k-W*U,ue=U*B-k*V,ve=p*ie+f*le+y*ue;if(oe>0){if(ve<0||Y+ve>oe)continue}else if(ve>0||Y+ve<oe)continue;const Ie=(Z*ie+K*le+X*ue)/oe;if(Ie>=0){const Ve=this.indices[v]+this.firstTriangleIndex,Mt=RW(k,B,W,Z,K,X,vot);this._callback(Ie,Mt,Ve,!1)}}}RV.numFacesTested+=i-e}intersectRay(e,i){RV.numFacesTested=0;const r=Ge(e.r0[0],e.r0[1],e.r0[2]),n=Ge(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-r[0],o=n[1]-r[1],a=n[2]-r[2];if(s*s+o*o+a*a<hA)return;this._rayOrigin=r;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=i;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(e,i,r){const n=this._rayOrigin,s=this._rayDirection;if(!yot(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=i,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=r;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};oZ.numFacesTested=0;const vot=I(),mx=[1/0,1/0,1/0],gx=[-1/0,-1/0,-1/0];function bot(t,e,i,r,n,s){let o=i,a=r;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=r;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function wot(t,e,i,r){if(r<=i)return ub(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[i];for(let s=0;s<3;++s)mx[s]=e[n+0+s],gx[s]=e[n+3+s]}for(let n=i+1;n<r;++n){const s=6*t[n];for(let o=0;o<3;++o)mx[o]=Math.min(mx[o],e[s+0+o]),gx[o]=Math.max(gx[o],e[s+3+o])}return ub(mx[0],mx[1],mx[2],gx[0],gx[1],gx[2])}function xot(t){const e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2],n=e>i?e>r?0:i>r?1:2:i>r?1:r>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function Tot(t,e,i,r,n){const s=i-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,u=t[l+1]*n,p=t[l+2]*n;for(let f=0;f<3;++f){const y=r[c+f],v=r[u+f],b=r[p+f];o[6*a+f]=Math.min(y,v,b),o[6*a+3+f]=Math.max(y,v,b)}}return o}function Sot(t,e,i,r){const n=r-i;let s=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=ixe?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+i);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const ixe=65535;let is=class extends Ko{constructor(){super(...arguments),this.output=j.Color,this.overlayMode=Eg.Disabled,this.tileBlendInput=Rf.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Ct.Terrain}};d([q({count:j.COUNT})],is.prototype,"output",void 0),d([q({count:Eg.COUNT})],is.prototype,"overlayMode",void 0),d([q({count:Rf.COUNT})],is.prototype,"tileBlendInput",void 0),d([q()],is.prototype,"spherical",void 0),d([q()],is.prototype,"doublePrecisionRequiresObfuscation",void 0),d([q()],is.prototype,"receiveShadows",void 0),d([q()],is.prototype,"hasSlicePlane",void 0),d([q()],is.prototype,"backfaceCullingEnabled",void 0),d([q()],is.prototype,"textureFadingEnabled",void 0),d([q()],is.prototype,"renderOccluded",void 0),d([q()],is.prototype,"hasScreenSpaceReflections",void 0),d([q()],is.prototype,"hasCloudsReflections",void 0),d([q()],is.prototype,"invisible",void 0),d([q()],is.prototype,"tileBorders",void 0),d([q()],is.prototype,"visualizeNormals",void 0),d([q()],is.prototype,"screenSizePerspective",void 0),d([q()],is.prototype,"receiveAmbientOcclusion",void 0),d([q({count:Ct.COUNT})],is.prototype,"pbrMode",void 0),d([q({constValue:Wi.Compressed})],is.prototype,"normalType",void 0),d([q({constValue:Yn.Compressed})],is.prototype,"textureCoordinateType",void 0),d([q({constValue:!1})],is.prototype,"highStepCount",void 0),d([q({constValue:!1})],is.prototype,"useCustomDTRExponentForWater",void 0),d([q({constValue:!1})],is.prototype,"useFillLights",void 0);const IU=7,Cot=10,LU=$s();var ks;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})(ks||(ks={}));let ec=class extends ke{get _isGlobal(){return this._stage.viewingMode===Ke.Global}constructor(e){super(e),this.type=sn.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new is,this._passParameters=new Twe,this._rctx=null,this._renderDataPool=new ea(rst),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new fwe,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=ks.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Kr.Occlude}initialize(){const e=[Te.OPAQUE_TERRAIN,Te.TRANSPARENT_TERRAIN,Te.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),int()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===ks.TransparentWithDraped||e===ks.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return C_}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?aN:Kr.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,Ut.TEXTURE_FADING)}updateTileTexture(e,i){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,i===Ut.TEXTURE_FADING?Ss.FADING:Ss.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(i))}updateTileGeometryState(e){for(const r of e.layerInfo[mi.ELEVATION])r.pendingUpdates&=~Ut.GEOMETRY;e.resetPendingUpdate(Ut.GEOMETRY);const i=e.renderData.updateGeometryState();return i&&this.setDirty(),i}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const i=e.renderData;i&&(i.releaseGeometry(),this._renderDataPool.release(i),i.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const i=Cot-IU,r=Math.max(0,Math.floor((e.level-i)/IU)*IU);if(this._isGlobal&&r===0)return tl;for(;e.parent&&e.level>r;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=Dn.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=Dn.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=Dn.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new mot(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=rme(this._rctx)}uninitializeRenderContext(){this._emptyTex=et(this._emptyTex),this._tileRenderer=et(this._tileRenderer)}intersect(e,i,r,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==ks.Opaque)return;const s=Eot,o=Aot;Ce(s,n,r),me(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===Do.MIN,p=!!e.results.ground.target,f=$9e(e.verticalOffset),y=e.tolerance;let v,b=u&&a.dist!=null?a.dist:1/0;const x=P=>{const C=P.renderData;if(!(C!=null&&C.vao))return;const R=C.geometry;v5(LU,R.boundingBox);const N=C.localOrigin;f!=null&&(f.localOrigin=N,f.applyToAabb(LU));const $=LU;if(_x[0]=r[0]-N[0],_x[1]=r[1]-N[1],_x[2]=r[2]-N[2],!$W($,_x,o,y,b))return;const k=(ee,oe,U)=>{ee.set(this.type,P,oe,U,Os),b=u&&a.dist!=null?a.dist:1/0},B=(ee,oe)=>{if(oe!=null&&ee>=0&&(e.options.backfacesTerrain||Re(oe,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||i==null||i(r,n,ee))){if((c.dist==null||ee<c.dist)&&k(c,ee,oe),e.options.isFiltered)return;e.options.store===Do.ALL&&(v==null?(v=nW(e.ray),k(v,ee,oe),e.results.all.push(v)):ee<v.dist&&k(v,ee,oe)),(a.dist==null||ee<a.dist)&&k(a,ee,oe),e.options.store!==Do.MIN&&(l.dist==null||ee>l.dist)&&k(l,ee,oe)}},W=Pot;Ce(W,n,N);const Z=R.indices,K=R.vertexAttributes,X=K.getField(M.POSITION,Ms),ae=new nt(X.typedBuffer,3,!1,K.stride/4),re=R.indexCount/3;if(!f&&re>txe){const ee=P.renderData;ee.intersectionData==null&&(ee.intersectionData=new oZ(Z,0,re,ae)),ee.intersectionData.intersectRay({r0:_x,r1:W},B)}else eO(_x,W,0,re,Z,ae,null,f,B)},S=this._rootTiles;S!=null&&(()=>{const P=this._tileIterator;P.reset(S);const C=e.options.invisibleTerrain;for(let R=P.next();R;R=P.next())!(R.visible||C&&R.intersectsClippingArea)||f==null&&!R.intersectsRay(r,s,y,b)||p&&this._useStencilForTile(R)?P.skipSubtree():x(R)})()}processScaleRangeQueries(e,i){var r;if(!i.done)for(this._updatePatchGroups();e.updating&&!i.done;){e.prepare();for(const n of this._patchGroups.values())for(const s of n)((r=s.renderData)==null?void 0:r.textureReference)!=null&&e.queriesForTile(s);e.process(),i.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===Te.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&aN))return null}else{const i=this.transparency===ks.Opaque?Te.OPAQUE_TERRAIN:Te.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==i)return null}switch(e.output){case j.Color:return this.transparency===ks.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?Eg.Disabled:this._overlayRenderer.hasWater?Eg.EnabledWithWater:Eg.Enabled,this._updateTechnique(j.Color,e.bindParameters.slot===Te.OCCLUDED_TERRAIN));case j.Shadow:case j.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Shadow,!1)):null;case j.Depth:return this.transparency===ks.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Depth,!1));case j.Normal:return this.transparency===ks.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Normal,!1));case j.ObjectAndLayerIdColor:return this.transparency===ks.Empty?null:this._updateTechnique(j.ObjectAndLayerIdColor,!1);case j.Highlight:return this.transparency!==ks.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(j.Highlight,!1)):null}return null}render(e,i){const r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),i.useStencil=!1,e.output){case j.Color:{const n=e.bindParameters.slot===Te.OCCLUDED_TERRAIN?Wa.Occluded:Wa.ColorAndWater;this.transparency===ks.Opaque?this._renderMaterialPass(e,i,n):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,i,n),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case j.Depth:case j.Normal:this._renderAuxiliaryPass(e,i,Wa.ColorAndWater);break;case j.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,i,Wa.Highlight);break;case j.Shadow:case j.ShadowExcludeHighlight:this._castShadows&&r&&this._renderAuxiliaryPass(e,i,Wa.None);break;case j.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,i,Wa.ObjectAndLayerIdColor)}}_renderMaterialPass(e,i,r){const{rctx:n}=e;this._passParameters.overlaySource=r,n.bindTechnique(i,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,i,r)}_renderAuxiliaryPass(e,i,r){const n=e.rctx;this._passParameters.overlaySource=r,n.bindTechnique(i,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,i,r)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const i=this._tileRenderer;let r=null;if(e!=null){const n=Lt.toUnitRGBA(e);r=Ge(n[0]||0,n[1]||0,n[2]||0)}i.setBackground(r),this._allTiles.forAll(n=>i.updateTileTexture(n,Ss.FADING)),this._techniqueConfiguration.tileBlendInput=i.backgroundIsGrid?Rf.GridComposite:i.backgroundColor!=null?Rf.ColorComposite:Rf.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==JT.NONE){const e=Array.from(this._patchGroups.values()),i=this._stencilEnabledLayerExtents;for(const r of e)mwe(this.renderOrder,r,i);e.sort((r,n)=>gwe(r[0],n[0],this.renderOrder)),this._patchGroups=new Map(e.map(r=>[r[0].renderData.localOrigin,r])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var i;const e=this._rootTiles;if(e!=null){(i=e[0])==null||i.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const r of e)this._rebuildPatchGroupsForRootTile(r)}}_rebuildPatchGroupsForRootTile(e){const i=this._tileIterator;for(i.resetOne(e);!i.done;){const r=i.next(),n=r.renderData;if(!n){this._numTilesCulled++;continue}if(!r.visible){this._numTilesCulled++,i.skipSubtree();continue}const s=n.localOrigin;let o=this._patchGroups.get(s);o||(o=new Array,this._patchGroups.set(s,o)),o.push(r),(!this._highestVisibleLODTile||r.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=r),i.skipSubtree()}}_useStencilForTile(e){for(const i of this._stencilEnabledLayerExtents)if(e.intersectsExtent(i))return!0;return!1}_renderPatchGroupsAuxiliary(e,i,r){const n=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const o=s[0].renderData.localOrigin;i.program.bindDraw(new X7(o),e.bindParameters,this._passParameters);for(let a=0;a<s.length;a++)this._renderPatch(e,i,s[a],Ht.TRIANGLES,n,r)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,i,r){const n=e.bindParameters.camera,s=i.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const p=N0e(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;p.update({distance:f,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=r===Wa.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",tl),s.setUniform4fv("texOffsetAndScale",Df));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:tl;this._techniqueConfiguration.tileBlendInput===Rf.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Ht.LINES:Ht.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const u=this._patchGroups;for(const p of u.values()){const f=p[0].renderData.localOrigin;i.program.bindDraw(new X7(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const y of p){const v=y.renderData,b=v.textureReference;if(b!=null){if(!a){s.setUniform4fv("texOffsetAndScale",b.offsetAndScale),s.bindTexture("tex",b.texture.texture);const x=v.textureFadeFactor,S=x<1?v.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&S!=null&&x<1?(s.setUniform1f("fadeFactor",x),s.setUniform4fv("nextTexOffsetAndScale",S.offsetAndScale),s.setUniform3fv("nextTexOpacities",S.opacities),s.bindTexture("texNext",S.texture.texture)):s.setUniform1f("fadeFactor",1),v.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",b.opacities)}this._renderPatch(e,i,y,c,o,r),y.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,i,r,n,s,o){const a=r.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(Ps&&console.error("Rendered tile with no indices: ",r.lij," : ",a));const u=i.program;o===Wa.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),s&&(i.useStencil=this._useStencilForTile(r),i.bindPipelineState(e.rctx,e.bindParameters.slot));const p=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,p,c.indexType,0)}_bindOverlayPatchData(e,i){e.setUniform4fv("overlayTexOffset",i.offsets),e.setUniform4fv("overlayTexScale",i.scales)}_updateTechnique(e,i){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=i,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(Swe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};d([m({constructOnly:!0})],ec.prototype,"_overlayRenderer",void 0),d([m({constructOnly:!0})],ec.prototype,"_stage",void 0),d([m({readOnly:!0})],ec.prototype,"_isGlobal",null),d([m({constructOnly:!0})],ec.prototype,"_allTiles",void 0),d([m({constructOnly:!0})],ec.prototype,"_ellipsoidRadius",void 0),d([m({value:!1})],ec.prototype,"renderingDisabled",null),d([m()],ec.prototype,"renderPatchBorders",null),d([m()],ec.prototype,"visualizeNormals",null),d([m()],ec.prototype,"cullBackFaces",null),d([m({value:JT.FRONT_TO_BACK})],ec.prototype,"renderOrder",null),d([m()],ec.prototype,"wireframe",null),ec=d([J("esri.views.3d.terrain.TerrainRenderer")],ec);const Eot=I(),Aot=I(),_x=I(),Pot=I();let Oot=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},hf=class extends ke{constructor(e){super(e),this._handles=new an}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(Pe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Je(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(i=>!(!kA(i)||i.isRejected())&&!(i.isFulfilled()&&!Rot(i,this.viewSpatialReference,this.viewingMode))&&(e=i,!((i==null?void 0:i.type)==="vector-tile"||_N(i)))),e)if(e.isResolved()){const i=J4(e,this.viewSpatialReference,this.viewingMode);if(i!=null){const r=new mc(i.tileInfo);this._lockTilingScheme(r)}}else this._updateWhen(e)}_updateWhen(e){const i=e.when().catch(()=>{}).then(()=>{i!==this._waitTask||this.destroyed||this._update()});this._waitTask=i}_lockTilingScheme(e){if(this.viewingMode===Ke.Global){const i=e.levels.length-1;e.spatialReference.isWebMercator?e=mc.makeWebMercatorAuxiliarySphere(i):dy(e.spatialReference)&&(e=mc.makeGCSWithTileSize(e.spatialReference,e.pixelSize,i))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(Pe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Ke.Global){const e=this.extentHelper.viewSpatialReference,i=dy(e)||tm(e)||im(e);e.isWebMercator?this.tilingScheme=mc.WebMercatorAuxiliarySphere:i&&(this.tilingScheme=mc.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||U1(e,this.extent)||(this.tilingScheme=mc.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function Rot(t,e,i){return J4(t,e,i)!=null}d([m()],hf.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],hf.prototype,"extent",void 0),d([m({value:!1})],hf.prototype,"tilingSchemeLocked",void 0),d([m({constructOnly:!0})],hf.prototype,"viewSpatialReference",void 0),d([m({constructOnly:!0})],hf.prototype,"layers",void 0),d([m({constructOnly:!0})],hf.prototype,"extentHelper",void 0),d([m({constructOnly:!0})],hf.prototype,"viewingMode",void 0),hf=d([J("esri.views.3d.terrain.TilingSchemeLogic")],hf);let Mot=class{constructor(){this.offset=it(),this.scale=0,this.tile=null}init(e,i,r,n){this.tile=e,this.offset[0]=i,this.offset[1]=r,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},ai=class extends os.EventedMixin(ke){constructor(e){var i,r;super(e),this._scaleRangeQueries=new aL,this._iteratorPool=new ea(fwe,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new ant,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new Oot,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=I(),this._eyePosSurfaceSR=I(),this._splitLimits=new Rd,this._frustum=HP(),this._viewProjectionMatrix=Ne(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new an,this._watchUpdatingTracking=new Lf,this._frameTask=OT,this._allTiles=new ri,this._upsampleInfoPool=new ea(Mot),this._rootTilesExtent=li(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=jt.WebMercator,this.visibleElevationBounds=new $2(1/0,-1/0),this.rootTileElevationBounds=new $2(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new Ba({...e,surface:this}),this._isGlobal=!((r=(i=e.view)==null?void 0:i.state)!=null&&r.isLocal)}initialize(){this._lercDecoder=$rt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new ea(vst):new ea(wst);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new Rrt(e.newCache("elevation-query")),this._handles.add([Pe(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),Pe(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),Pe(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new ec({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:lr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([Pe(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?Ss.UNFADED:Ss.IMMEDIATE)},qn),Pe(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?Ss.UNFADED:Ss.IMMEDIATE),qn),Pe(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},gr),Pe(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},qn),Pe(()=>this.snapLevel,()=>this._viewChanged=!0,gr),Pe(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),Pe(()=>Or.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?Oe(()=>import("./TerrainTileTree3DDebugger-2a23977b.js"),["./TerrainTileTree3DDebugger-2a23977b.js","./TileTreeDebugger-ca7b7b87.js"],import.meta.url).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&Or.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=Je(this._treeDebugger))},ar)]);const{spatialReference:i}=this.view;this._extentHelper=Zrt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:i});const r=new zP({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),n=new hf({layers:r,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:i});this._set("tilingSchemeLogic",n),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Ef.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Ef.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(Dt.TERRAIN_SURFACE,this),this._handles.add([Pe(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),ar),Pe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),gr),Pe(()=>this.extent,()=>this._updateRootTiles(),ar),this.view.on("resize",()=>this._viewChangeUpdate()),Pe(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),qn),Pe(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,ar),Pe(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?Ct.Terrain:Ct.Disabled,ar),Pe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),gr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=nn(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Je(this._upsampleMapCache),this._elevationQueryCache=Je(this._elevationQueryCache),this._set("tilingSchemeLogic",Je(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,i)=>this._unregisterTiledLayerView(i)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Je(this.overlayManager)),this._tilePool=Je(this._tilePool),Xq.prune(),this._treeDebugger=Je(this._treeDebugger),this._renderer=Je(this._renderer),this._iteratorPool=Je(this._iteratorPool),this._set("view",null),this._extentHelper=Je(this._extentHelper),this._upsampleInfoPool=Je(this._upsampleInfoPool),Grt(),Nnt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,i;if(this.lodSnapping===ZA.ON){const r=this.view,n=this.tilingScheme,s=(i=(e=r.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:i.scale;if(n&&s){const o=r.state.contentCamera;let a=b4(r,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=n.levelAtScale(s)-l,u=Math.min(c,this._splitLimits.maxLod||1/0);return u<=0?null:u}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?ZA.ON:ZA.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:i}=this.view;if(i==null||e==null)return null;const r=li(),n=Hbe(i,r,e)?r:null,s=this._get("extent");return U1(n,s)?s:n}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=B8(this.groundExtent,this._userClippingExtent,li()),i=this._get("extent");return U1(e,i)?i:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){var e,i;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(e=this._watchUpdatingTracking)!=null&&e.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(i=this.overlayManager)!=null&&i.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var e,i,r;return((r=(i=(e=this.view)==null?void 0:e.map)==null?void 0:i.ground)==null?void 0:r.opacity)??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}get wireframe(){var e;return(e=this._renderer)==null?void 0:e.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===ks.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,i,r,n){this._renderer.intersect(e,i,r,n)}getElevation(e,i,r,n){const s=this._rootTiles;if(s==null||!s.length||s[0].layerInfo[mi.ELEVATION].length===0)return null;const o=gl;return o[0]=e,o[1]=i,o[2]=r,Ws(o,n,o,this._spatialReference)?Lne(s,o[0],o[1]):(ye.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,i,r){const n=this._rootTiles,s=n?n[0].layerInfo[mi.ELEVATION].length:0;if(n!=null&&n.length&&s!==0)for(let o=0;o<i;++o){const a=3*o;r(o,Lne(n,e[a],e[a+1]))}else for(let o=0;o<i;++o)r(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!No(e,gl,this.spatialReference))return ye.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const i=this._rootTiles;if(i!=null){for(const r of i)if(r!=null&&r.containsPoint(gl)){let n=r;for(;n.children[0]&&!n.rendered;){const s=n.children[0].extent;let o=0;gl[0]>s[2]&&(o+=1),gl[1]<s[1]&&(o+=2),n=n.children[o]}return this._getLodBiasCorrectedScale(n.level)}}return 1/0}getSphereElevationBounds(e,i){var a;if(gl[0]=e[0],gl[1]=e[1],gl[2]=e[2],gl[3]=e[3],!Ws(gl,i,gl,(a=this.tilingScheme)==null?void 0:a.spatialReference))return ye.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let r=1/0,n=-1/0;const s=l=>{if(l&&pX(l.extent,gl))if(l.isLeaf||l.rendered)r=Math.min(r,l.elevationBounds[0]),n=Math.max(n,l.elevationBounds[1]);else for(const c of l.children)s(c)},o=this._rootTiles;if(o!=null)for(const l of o)s(l);return{min:r,max:n}}getSphereScale(e,i){if(!this.tilingScheme)return null;if(!No(e,gl,this.spatialReference))return ye.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;gl[3]=i;let r=null;const n=o=>{if(o&&pX(o.extent,gl)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)n(l);else{const l=this._getLodBiasCorrectedScale(o.level);r=r==null?l:Math.min(r,l)}}},s=this._rootTiles;if(s!=null)for(const o of s)n(o);return r}queryVisibleScaleRange(e,i,r,n){const s=i?this.tilingScheme.levelAtScale(i):0,o=r?this.tilingScheme.levelAtScale(r):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+a,o+a,n)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,i=this.overlayManager.renderer.isEmpty,r=this._renderer.transparency,n=this._allSurfaceLayersTransparent()?i?ks.Empty:ks.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?ks.Opaque:ks.Semitransparent,s=r!==n;return s&&(this._renderer.transparency=n,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var r,n,s;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;vf(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((n=(r=this.view)==null?void 0:r.state)!=null&&n.isLocal),this.tilingScheme&&this._removeAllTiles();const i=(e==null?void 0:e.spatialReference)??jt.WebMercator;this._spatialReference=i,this._isWebMercator=!!(i!=null&&i.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&SG((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,i,r,n){const s=this._tilePool.acquire();return v$[0]=e,v$[1]=i,v$[2]=r,s.init(v$,n,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:i}=this;if(!i)return;const r=Lot;let n=i.rootTilesInExtent(e,r,5*b2);if(this._rootTiles!=null){if(n.length>b2)return void ye.getLogger(this).warn(r5e);const s=this._rootTiles.map(a=>a.lij),o=WTe(s,n,Ine);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>Ine(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,n.length>b2&&(ye.getLogger(this).warn(n5e),n=i.rootTilesInExtent(e,r,b2)),this._setRootTiles(n.map(s=>this._newRootTile(s)));U1(r,this._rootTilesExtent)||(this._rootTilesExtent=li(r)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(i=>i.isLoaded&&i.intersectsClippingArea);e.forEach(i=>this._renderer.updateTileGeometryState(i)),e.forEach(i=>i.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(Cg);const i=this.renderer;e.forEach(r=>i.updateGeometryIfNeeded(r)),e.forEach(r=>this._pendingTilesForElevationUpdateEvent.add(r))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===Ut.SPLIT}_newRootTile(e){const i=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(i)&&i.setPendingUpdate(Ut.SPLIT),this._loadTile(i),this._markTileToUpdate(i),this._updateRootTileElevationBounds(),i}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const i=this._iteratorPool.acquire();for(i.reset(e);!i.done;)this._allTiles.push(i.next());i.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Ut.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const i=fnt(e),r=this.visibleElevationBounds;let n=i?r.min:1/0,s=i?r.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(Ut.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(Ut.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(n=Math.min(c.elevationBounds[0],n),s=Math.max(c.elevationBounds[1],s))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(n)&&isFinite(s)&&(r.min!==n||r.max!==s)&&(this.visibleElevationBounds=new $2(n,s))}_updateRootTileElevationBounds(){let e=1/0,i=-1/0;const r=this._rootTiles;r!=null&&r.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),i=Math.max(i,s[1])});const n=this.rootTileElevationBounds;n.min===e&&n.max===i||(this.rootTileElevationBounds=new $2(e,i))}_updateViewDependentParameters(){const{camera:e,contentCamera:i}=this.view.state,r=Math.tan(.5*i.fovX),n=Math.tan(.5*i.fovY),s=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=r,this._splitLimits.fovY=n,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=HP()),CD(this._splitLimits.frustum,i.frustum)):this._splitLimits.frustum=null,CD(this._frustum,e.frustum),Cr(this._viewProjectionMatrix,i.projectionMatrix,i.viewMatrix),fe(this._eyePosRenderSR,i.eye),Ws(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(rxe(e)?this._loadChildren(e):Iot(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const i=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}_updateTileTexture(e,i){const r=e.resetPendingUpdate(Ut.TEXTURE_FADING)?Ut.TEXTURE_FADING:!!e.resetPendingUpdate(Ut.TEXTURE_NOFADING)&&Ut.TEXTURE_NOFADING;r&&(this._renderer.updateTileTexture(e,r),this._usedMemory=null,i.madeProgress())}_emitElevationUpdateEventForTiles(){const e=NU.extent;kh(e),this._pendingTilesForElevationUpdateEvent.forEach(i=>X_(e,i.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),NU.spatialReference=this.spatialReference,this.emit("elevation-change",NU)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const i=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,i),this._updateElevation(e),this._updateTextures(e),i||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const i=this._iteratorPool.acquire();i.reset(this._rootTiles);const r=this.snapLevel,n=this._splitLimits,s=this._eyePosRenderSR;for(;!i.done;){const o=i.next(),a=o.shouldSplit(n,s,r);if(a!==Ut.SPLIT){if(o.resetPendingUpdate(Ut.SPLIT)&&o.updateAgentSuspension(),a===Ut.ELEVATION&&o.updateAgents(mi.ELEVATION),i.skipSubtree(),!o.isLeaf){o.setPendingUpdate(Ut.MERGE),o.resetPendingUpdate(Ut.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let u=l.next();!l.done;u=l.next())this._updateClippingStatus(u),u.updateVisibility(),u.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(Ut.MERGE),o.isLeaf&&(o.setPendingUpdate(Ut.SPLIT),i.skipSubtree()),o.rendered&&o.setPendingUpdate(Ut.RENDERDATA)}i.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(dnt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Fe(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const i=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),r=(s,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<s.level||e.has(o)||(e.add(o),i.push(o),o.renderData.updateNeighborData())};i.sort(Cg);const n=i.length;for(let s=0;s<n;++s){const o=i[s];Fe(o.isLoaded),Fe(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,u=p=>{var y;const f=h3[p];r(o,(y=c[p])==null?void 0:y.findCorner(vN(f),v=>v.isLoaded))};for(let p=0;p<4;++p)if(l&1<<p){const f=a.geometryState.neighborData.edgePeerNeighbors[p];f&&(f==null?void 0:f.level)>=o.level&&f.forAllSubtreeOnSide(bN(Of[p]),y=>!(!y.isLoaded||!y.intersectsClippingArea)&&(Fe(e.has(y)||Cg(o,y)<0),r(o,y),!0)),u((p+1)%4),u(p)}}e.clear(),this._updateTilesGeometries(i),Ps&&gN&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,i){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let r=!1;const n=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let o=!1;const a=!this._allTiles.some(l=>{var u;if(!r&&!n&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(Ut.MERGE)){if(!i)return l.setPendingUpdate(Ut.MERGE),e.done;for(;(u=c.parent)!=null&&u.resetPendingUpdate(Ut.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(Ut.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(Ut.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!r){r=!0;continue}if(!o)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(i=>(i.resetPendingUpdate(Ut.GEOMETRY)&&(this._updateTileGeometryState(i),this._updateTileTexture(i,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(i=>(this._updateTileTexture(i,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Dn.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*t5e}_getLodBiasCorrectedScale(e){const i=this.tilingScheme.levels,r=$e(e-this._lodBias,0,i.length-1),n=r-Math.floor(r);return i[Math.floor(r)].scale*(1-n)+i[Math.ceil(r)].scale*n}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let i=!1;for(let r=0;r<4;++r)i=this._purgeTile(e.children[r])||i;return e.unsetChildren(),i}_purgeTile(e){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),i}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){vf(e.isLeaf,"tile that is already split should not be split again!");const i=e.level+1,r=2*e.lij[1],n=2*e.lij[2];e.setChildren(this._createTile(i,r,n,e),this._createTile(i,r,n+1,e),this._createTile(i,r+1,n,e),this._createTile(i,r+1,n+1,e)),e.setPendingUpdate(Ut.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,i=e.level){b$.spatialReference=this.spatialReference,b$.extent=e.extent,b$.scale=this._getLodBiasCorrectedScale(i),this.emit("scale-change",b$)}_createTile(e,i,r,n){vf(!!n,"_createTile sanity check");const s=this._acquireTile(e,i,r,n);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(Ut.SPLIT),s}get shortBatches(){return this.view.state.mode!==Ji.IDLE}_mergeTile(e){vf(!e.hasPendingUpdate(Ut.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(vf(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){vf(e.rendered,"parent should be rendered"),this._unloadTile(e);const i=e.children;i.forEach(r=>this._loadTile(r)),i.forEach(r=>this._pendingTilesToUpdate.add(r)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const i=e.parent;this._unloadChildren(i),this._loadTile(i),this._markTileToUpdate(i),this._emitTileScaleChange(i,i.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const i=e.children;if(i[0])for(let r=0;r<4;++r){const n=i[r];this._unloadChildren(n),this._unloadTile(n)}}_loadTile(e){e.load(),e.setPendingUpdate(Ut.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,i,r){const n=new Wrt(e.lij,e.extent,r);e.dataArrived(i,mi.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(i,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=Qa){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let i=!1;const r=new Set;let n=-1;for(const s of this.view.allLayerViews.items)if(r.add(s.uid),u3(s)||HC(s))if(this._basemapLayerViewHandles.has(s.uid)&&!HC(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);a!=null&&((a<n||n==null)&&(i=!0),n=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(i=!0);this._basemapLayerViewHandles.forEach((s,o)=>{r.has(o)||(this._unregisterTiledLayerView(o),i=!0)}),i&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var i,r;let e=((r=(i=this.view.map)==null?void 0:i.ground)==null?void 0:r.opacity)===0;for(const n of this.view.allLayerViews.items)if(pV(n)&&!Tpe(n.layer)&&n.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((yN(e)||HC(e))&&bnt(yV[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return dV(e)?mi.ELEVATION:mi.MAP}_registerTiledLayerView(e){const i=[];if((yN(e)||HC(e))&&i.push(Pe(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ss.UNFADED)})),!HC(e)){const r=this._layerClassFromLayerView(e);i.push(Pe(()=>e.suspended,()=>this._updateTiledLayers())),i.push(Pe(()=>e.fullOpacity,()=>this._updateTileTextures(Ss.UNFADED))),i.push(Pe(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(r))),i.push(e.on("data-changed",()=>{const n=this._getLayerIdxByUID(r,e.uid);n!=null&&this._invalidateLayerData(n,r)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,i)}_unregisterTiledLayerView(e){const i=this._basemapLayerViewHandles.get(e);if(i){for(const r of i)r.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,i=[[],[]];let r=null;e.forEach(n=>{if(!n.layer||n.suspended||!u3(n)||!n.fullExtent)return;const s=this._layerClassFromLayerView(n);if(s===mi.MAP){const o=n.displayLevelRange.maxLevel;o!==1/0&&(r===null||o>r)&&(r=o)}i[s].push(n)});for(const n of o1){const s=this._layerViews[n],o=i[n];o.reverse();const a=o.length;let l=s.length!==a;const c=new Array(a),u=new Array(s.length);this._layerIndexByUid[n].clear();for(let p=0;p<a;p++){const f=o[p].uid;this._layerIndexByUid[n].set(f,p);const y=s.indexOf(o[p]);c[p]=y,p!==y&&(l=!0),y>-1&&(u[y]=p)}if(l){const p=this._postorderIterator;for(p.reset(this._rootTiles);!p.done;)p.next().modifyLayers(u,c,n);this._layerViews[n]=o,this._restartAllAgents(n),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(r)&&this._viewChangeUpdate()}_restartAllAgents(e){const i=this._postorderIterator;for(i.reset(this._rootTiles);!i.done;){const r=i.next();r.restartAgents(e),e===mi.ELEVATION&&r.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,i){return this._layerViews[i][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(i=>{i.updateAgents(mi.MAP),e===Ss.IMMEDIATE?this.renderer.updateTileTexture(i,Ut.TEXTURE_NOFADING):i.updateRenderData(mi.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,i){this._allTiles.forAll(r=>r.removeLayerAgent(e,i)),this._allTiles.forAll(r=>r.invalidateLayerData(e,i))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=Dn.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,i,r,n){const s=this.layerViewByIndex(i,r),o=s.layer;return!o.tilemapCache||c3(s)?this._requestTileData(e,r,s,n):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...n,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,Ti(n),ms(a)||this._dataMissing(e,r,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,r,s,n),n.signal)))}_requestTileData(e,i,r,n){return i===mi.ELEVATION?dV(r)?this._requestElevationTileData(e,r,n):Promise.reject():pV(r)?this._requestMapTileData(e,r,n):Promise.reject()}_requestElevationTileData(e,i,r){++this._asyncWorkItems;const n=a=>{if(Gs(r))return;const l=this._layerIndexByUid[mi.ELEVATION].get(i.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):ye.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",mi.ELEVATION,e.lij.toString())},s=a=>{ms(a)||(this._dataMissing(e,mi.ELEVATION,i,a),this.requestUpdate())};if(Zie(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:kP,signal:r.signal}).then(a=>{if(!Gs(r))return this._frameTask.schedule(()=>n(a),r.signal,s);ye.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const o=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",r).then(a=>this._lercDecoder.decode(a,{noDataValue:kP},r.signal)).then(a=>{a?n(new Mrt(a)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,i,r){++this._asyncWorkItems;const n=(u,p)=>{--this._asyncWorkItems,eT(p),Gs(r)||(this._dataMissing(e,mi.MAP,i,u),this.requestUpdate())},s=u=>p=>n(p,u),o=u=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),Gs(r)?eT(u):this._mapTileDataArrived(e,i,u)},r.signal,s(u)).catch(s(u)),a=(u,p=null)=>this._frameTask.schedule(()=>n(u,p));if(c3(i)){const u=i.schemaHelper.getLevelRowColumn(e.lij);return i.fetchTile(u[0],u[1],u[2],r).then(o,a)}if(Y4(i))return i.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(o,a);if(jq(i)&&Zie(i.layer))return i.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],r).then(u=>{if(Gs(r))return ye.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Qi());o(u)},a);let l=i.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);Ort(i.layer)&&i.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${i.layer.refreshTimestamp}`);const c=i.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,r).then(o,a)}_mapTileDataArrived(e,i,r){const n=this._getLayerIdxByUID(mi.MAP,i.uid);n!=null?e.dataArrived(n,mi.MAP,r):(eT(r),ye.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,i){return this._layerIndexByUid[e].get(i)}_dataMissing(e,i,r,n){const s=this._getLayerIdxByUID(i,r.uid);s!=null?e.dataMissing(s,i,n):ye.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(i=>{i.renderData&&this.overlayManager.setTileParameters(i)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(i=>{i.isLeaf&&e.numLeaves++;const r=i.level;i.renderData&&(e.numLoadedPerLevel[r]=(e.numLoadedPerLevel[r]||0)+1),i.visible&&(e.numVisible++,i.rendered&&(e.numRenderedPerLevel[r]=(e.numRenderedPerLevel[r]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,i)=>e+i.usedMemory,0):null}getUsedMemoryForLayerView(e){let i=this.overlayManager.gpuMemoryUsage;const r=this._layerClassFromLayerView(e),n=this._getLayerIdxByUID(r,e.uid);return n!=null&&this._allTiles.forAll(s=>i+=s.getUsedMemoryForLayer(r,n)),i}getTile(e){if(e==null||this._rootTiles==null)return null;const i=e.split("/").map(a=>+a);if(i[0]===0)return this._rootTiles.find(a=>a.lij[1]===i[1]&&a.lij[2]===i[2]);const r=2**i[0],n=Math.floor(i[1]/r),s=Math.floor(i[2]/r);let o;if(this._rootTiles.some(a=>a.lij[1]===n&&a.lij[2]===s&&(o=a,!0)),o){let a=1<<i[0]-1;for(;o.lij[0]<i[0];){let l=i[1]&a?2:0;if((i[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return vf(o.lij[0]===i[0]&&o.lij[1]===i[1]&&o.lij[2]===i[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){DU.clear(),e._allTiles.forAll(r=>{r.visible&&r.rendered&&DU.push(r)});const i=DU.toArray();return mwe(e.renderOrder,i),i},lockTilingScheme(i,r){e._extentHelper.defaultTiledLayersExtent=r,e.tilingSchemeLogic.test.lockTilingScheme(i)}}}checkAllTilesWaterproofness(){if(!gN)return;const e=this._rootTiles;if(e==null)return;const i=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometry)==null?void 0:l.indices)==null?void 0:c.length)>0},r=(o,a)=>{i(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},n=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometry)||(((l=o.renderData.geometry.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),i(o)){o.checkGeometryWaterproofness();for(const c of o.children)r(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)n(c)},s=o=>{var u;const a=((u=o.parent)==null?void 0:u.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const p of o.children)s(p)};for(const o of e)n(o),s(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const i=this.lijEastEnd(e[0]),r=e[2];if(0<=r&&r<i)return e;if(!this.isGlobal)return null;const n=(r+(r<0?i:0))%i;return[e[0],e[1],n]}enableInternalChecks(e){Yit(e)}enableWaterproofnessChecks(e){Xit(e)}};d([m()],ai.prototype,"_renderer",void 0),d([m({constructOnly:!0})],ai.prototype,"_scaleRangeQueries",void 0),d([m({constructOnly:!0})],ai.prototype,"view",void 0),d([m({constructOnly:!0})],ai.prototype,"overlayManager",void 0),d([m()],ai.prototype,"_hasPendingUpdates",void 0),d([m()],ai.prototype,"_asyncWorkItems",void 0),d([m()],ai.prototype,"_allTilesDirty",void 0),d([m()],ai.prototype,"_allTilesSorted",void 0),d([m()],ai.prototype,"_viewChanged",void 0),d([m()],ai.prototype,"_splitLimits",void 0),d([m({readOnly:!0})],ai.prototype,"_watchUpdatingTracking",void 0),d([m()],ai.prototype,"_frameTask",void 0),d([m({readOnly:!0})],ai.prototype,"snapLevel",null),d([m({readOnly:!0})],ai.prototype,"lodSnapping",null),d([m()],ai.prototype,"_userClippingExtent",null),d([m()],ai.prototype,"_rootTilesExtent",void 0),d([m({readOnly:!0})],ai.prototype,"extent",null),d([m({readOnly:!0})],ai.prototype,"groundExtent",null),d([m({readOnly:!0})],ai.prototype,"_tilingSchemeExtent",null),d([m({readOnly:!0})],ai.prototype,"updating",null),d([m({readOnly:!0})],ai.prototype,"running",null),d([m(jrt)],ai.prototype,"updatingProgress",void 0),d([m({readOnly:!0})],ai.prototype,"updatingProgressValue",null),d([m()],ai.prototype,"_maxNumUpdating",void 0),d([m()],ai.prototype,"baseOpacity",null),d([m()],ai.prototype,"hasCompositeBlendMode",void 0),d([m({readOnly:!0})],ai.prototype,"viewingMode",null),d([m()],ai.prototype,"maxTextureScale",void 0),d([m({readOnly:!0})],ai.prototype,"ready",null),d([m({value:JT.FRONT_TO_BACK})],ai.prototype,"renderOrder",null),d([m({readOnly:!0})],ai.prototype,"rootTiles",null),d([m()],ai.prototype,"_rootTiles",void 0),d([m({readOnly:!0})],ai.prototype,"spatialReference",null),d([m({type:Lt})],ai.prototype,"backgroundColor",null),d([m({value:!1})],ai.prototype,"slicePlaneEnabled",null),d([m({readOnly:!0})],ai.prototype,"tilingScheme",void 0),d([m({readOnly:!0})],ai.prototype,"tilingSchemeLocked",null),d([m({readOnly:!0})],ai.prototype,"tilingSchemeLogic",void 0),d([m()],ai.prototype,"wireframe",null),d([m({value:!1})],ai.prototype,"suspended",null),d([m()],ai.prototype,"textureFadeDuration",null),d([m()],ai.prototype,"visibleElevationBounds",void 0),d([m()],ai.prototype,"rootTileElevationBounds",void 0),d([m()],ai.prototype,"_layerViewsDirty",void 0),d([m()],ai.prototype,"renderPatchBorders",null),d([m()],ai.prototype,"visualizeNormals",null),d([m()],ai.prototype,"renderingDisabled",null),ai=d([J("esri.views.3d.terrain.TerrainSurface")],ai);const $ot=ai;function Ine(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function rxe(t){const e=t.children;if(!e[0])return!1;for(const i of e)if(i.shouldLoad)return!0;for(const i of e)if(rxe(i))return!0;return!1}function Iot(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const gl=gi(),Lot=li(),v$=[0,0,0],DU=new ri,NU={spatialReference:null,extent:li(),context:"ground"},b$={spatialReference:null,extent:null,scale:0};function Lne(t,e,i){var r;for(const n of t){if(!n.containsPointXY(e,i))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(i<s.extentMidY?2:0);s=s.children[a]}const o=((r=s==null?void 0:s.renderData)==null?void 0:r.geometryState.samplerData)??null;return pn(e,i,o)}return null}let Dot=class{constructor(e,i,r){this.operation=e,this.geometry=i,this.states=r}},dA=class extends ke{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,i){const r=this._dirtyGeomRecords.get(e);r&&(r.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},u)=>{let p=!1;if(l===hn.UPDATE){const f=o.get(u);if(f){if(c&zs.TRANSFORMATION){const y=this.model.getObject(s);this.model.updateRenderGeometryTransformation(y,a,f)&&(p=!0)}p||i.updates.push({renderGeometry:f,updateType:c})}else xt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===hn.REMOVE||p){const f=o.get(u);f?(i.removes.push(f),o.delete(u)):l===hn.REMOVE&&xt(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===hn.ADD||p){const f=this.model.getObject(s);if(f!=null){const y=this.model.getRenderGeometry(f,a);i.adds.push(y),o.set(u,y)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,i){const r=this._residentGeomRecords.get(e);r&&r.forEach(n=>n.forEach(s=>i.push(s)))}_objectStateChanged(e,i){for(const r of i.geometries)this._updateOrCreateDirtyRecord(i,r,null,hn.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(zs.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(zs.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(zs.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,hn.UPDATE,zs.GEOMETRY)}layerAdded(e){e.objects.forAll(i=>this._layerObjectAdded(e,i))}layerRemoved(e){e.objects.forAll(i=>this._layerObjectRemoved(e,i))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,i){const r=e.id;for(const n of i.geometries)this._objectGeometryAdded(i,n,r)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const i of e.objects)this._layerObjectAdded(e.layer,i)}layerObjectsRemoved(e){for(const i of e.objects)this._layerObjectRemoved(e.layer,i)}_layerObjectRemoved(e,i){const r=e.id;for(const n of i.geometries)this._objectGeometryRemoved(i,n,r)}shaderTransformationChanged(e){const i=this._residentGeomRecords.get(e.id);i&&i.forEach((r,n)=>{const s=this.model.getObject(n);s&&s.hasVolativeTransformation()&&r.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const i=this._getParentLayerId(e),r=e.id;this._ensureGeomRecord(i,r).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,i,hn.UPDATE,zs.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,hn.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,i,r=null){this._updateOrCreateDirtyRecord(e,i,r,hn.REMOVE)}_updateOrCreateDirtyRecord(e,i,r,n,s=zs.NONE){r=r??this._getParentLayerId(e);const o=e.id,a=i.id,l=this._ensureDirtyRecord(r,o),c=l.get(a);if(c){const u=c.operation;u===hn.REMOVE&&n===hn.ADD&&c.states!==zs.NONE?c.operation=hn.UPDATE:u===hn.REMOVE&&n===hn.ADD||u===hn.ADD&&n===hn.REMOVE?l.delete(a):u!==hn.UPDATE||n!==hn.REMOVE&&n!==hn.UPDATE?(xt((u===hn.REMOVE||u===hn.ADD)&&n===hn.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=s):(c.operation=n,c.states|=s)}else l.set(a,new Dot(n,i,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,i){let r=this._residentGeomRecords.get(e);r||(r=new Map,this._residentGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}get _hasDirtyGeometryRecords(){return Yo(this._dirtyGeomRecords,e=>Yo(e,i=>i&&i.size>0))}_ensureDirtyRecord(e,i){let r=this._dirtyGeomRecords.get(e);r||(r=new Map,this._dirtyGeomRecords.set(e,r));let n=r.get(i);return n||(n=new Map,r.set(i,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:XSe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let i="";return this._dirtyGeomRecords.forEach((r,n)=>{r.forEach((s,o)=>{i.length>0&&(i+=`
`),i+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){i+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)i+=a[l][c]+", "}})}),i}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((i,r)=>i+r.size,0)},commit:i=>e._dirtyGeomRecords.forEach((r,n)=>e.commitLayer(n,i))}}};d([m({constructOnly:!0})],dA.prototype,"model",void 0),d([m()],dA.prototype,"dirty",void 0),dA=d([J("esri.views.3d.webgl-engine.lib.ModelDirtySet")],dA);const Not=dA;let cL=class extends ke{constructor(){super(...arguments),this.dirtySet=new Not({model:this}),this._content=new Map,this._originFactory=new uq(null)}getObject(e){return this._content.get(e)}add(e){const i=e.id;xt(!this._content.has(i),"Model/Stage already contains object to be added"),this._content.set(i,e),rN(e)&&this.dirtySet.layerAdded(e)}remove(e){xt(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),rN(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const i of e)i!=null&&(xt(!this._content.has(i.id),"Model/Stage already contains object to be added"),this._content.set(i.id,i))}removeMany(e){for(const i of e)xt(this._content.has(i.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(i.id),i.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,i){this._content.forEach(r=>{r.type===e&&i(r)})}getRenderGeometry(e,i){const{shaderTransformer:r,localOrigin:n}=i,s=new XT(i,{shaderTransformer:r,castShadow:e.castShadow});return s.updateTransformation(o=>e.getCombinedStaticTransformation(i,o)),s.localOrigin=n??this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,i,r){if(e==null)return!1;r.updateTransformation(s=>e.getCombinedStaticTransformation(i,s));const n=this._originFactory.getOrigin(r.boundingSphere);return r.localOrigin!==n}getStats(){const e={},i=Array.from(this._content.values());for(let r=0;r<An.COUNT;++r)e[r]=i.filter(n=>n.type===r).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};d([m({constructOnly:!0})],cL.prototype,"dirtySet",void 0),cL=d([J("esri.views.3d.webgl-engine.parts.Model")],cL);function Fot(){const t=new Float32Array(4);return t[3]=1,t}function nxe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function kot(t,e,i,r){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=i,n[3]=r,n}function sxe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:nxe,create:Fot,createView:sxe,fromValues:kot},Symbol.toStringTag,{value:"Module"}));const KT=1e-6,YC=[0,0,0],w$=[0,0,0];function Uot(t,e){const{data:i,size:r}=t,n=i.length/r;if(n<=0)return;const s=new Zot(t);uL(YC,s.minProj,s.maxProj),C1(YC,YC,.5),wh(w$,s.maxProj,s.minProj);const o=MV(w$),a=new Xot;a.quality=o,n<14&&(t=new nt(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],p=[0,0,0],f=[0,0,0],y=[0,0,0],v=[0,0,0];switch(zot(s,t,v,l,c,u,p,f,y,a)){case 1:return void kne(YC,w$,e);case 2:return void qot(t,p,e)}Bot(t,v,l,c,u,p,f,y,a),oxe(t,a.b0,a.b1,a.b2,rT,nT);const b=[0,0,0];wh(b,nT,rT),a.quality=MV(b),a.quality<o?axe(a.b0,a.b1,a.b2,rT,nT,b,e):kne(YC,w$,e)}function zot(t,e,i,r,n,s,o,a,l,c){return Vot(t,r,n),$V(r,n)<KT?1:(wh(o,r,n),Ho(o,o),Got(e,r,o,s)<KT?2:(wh(a,n,s),Ho(a,a),wh(l,s,r),Ho(l,l),xh(i,a,o),Ho(i,i),a1(e,i,o,a,l,c),0))}const JC=[0,0,0],KC=[0,0,0],Hu=[0,0,0],Wu=[0,0,0],qu=[0,0,0],L0=[0,0,0],D0=[0,0,0],N0=[0,0,0];function Bot(t,e,i,r,n,s,o,a,l){jot(t,e,i,JC,KC),JC[0]!==void 0&&(wh(Hu,JC,i),Ho(Hu,Hu),wh(Wu,JC,r),Ho(Wu,Wu),wh(qu,JC,n),Ho(qu,qu),xh(L0,Wu,s),Ho(L0,L0),xh(D0,qu,o),Ho(D0,D0),xh(N0,Hu,a),Ho(N0,N0),a1(t,L0,s,Wu,Hu,l),a1(t,D0,o,qu,Wu,l),a1(t,N0,a,Hu,qu,l)),KC[0]!==void 0&&(wh(Hu,KC,i),Ho(Hu,Hu),wh(Wu,KC,r),Ho(Wu,Wu),wh(qu,KC,n),Ho(qu,qu),xh(L0,Wu,s),Ho(L0,L0),xh(D0,qu,o),Ho(D0,D0),xh(N0,Hu,a),Ho(N0,N0),a1(t,L0,s,Wu,Hu,l),a1(t,D0,o,qu,Wu,l),a1(t,N0,a,Hu,qu,l))}function Vot(t,e,i){let r=$V(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=$V(t.maxVert[s],t.minVert[s]);o>r&&(r=o,n=s)}wc(e,t.minVert[n]),wc(i,t.maxVert[n])}const Zu=[0,0,0];function Got(t,e,i,r){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){Zu[0]=n[l]-e[0],Zu[1]=n[l+1]-e[1],Zu[2]=n[l+2]-e[2];const c=i[0]*Zu[0]+i[1]*Zu[1]+i[2]*Zu[2],u=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=Zu[0]*Zu[0]+Zu[1]*Zu[1]+Zu[2]*Zu[2]-c*c/u;p>o&&(o=p,a=l)}return wc(r,n,a),o}const Us=[0,0];function jot(t,e,i,r,n){Wot(t,e,Us,n,r);const s=cxe(i,e);Us[1]-KT<=s&&(r[0]=void 0),Us[0]+KT>=s&&(n[0]=void 0)}const Dne=[0,0,0],Nne=[0,0,0],Fne=[0,0,0],yx=[0,0,0],vx=[0,0,0],x$=[0,0,0];function a1(t,e,i,r,n,s){if(lxe(e)<KT)return;xh(Dne,i,e),xh(Nne,r,e),xh(Fne,n,e),iT(t,e,Us),vx[1]=Us[0],yx[1]=Us[1],x$[1]=yx[1]-vx[1];const o=[i,r,n],a=[Dne,Nne,Fne];for(let l=0;l<3;++l){iT(t,o[l],Us),vx[0]=Us[0],yx[0]=Us[1],iT(t,a[l],Us),vx[2]=Us[0],yx[2]=Us[1],x$[0]=yx[0]-vx[0],x$[2]=yx[2]-vx[2];const c=MV(x$);c<s.quality&&(wc(s.b0,o[l]),wc(s.b1,e),wc(s.b2,a[l]),s.quality=c)}}const Hot=[0,0,0];function iT(t,e,i){const{data:r,size:n}=t;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<r.length;s+=n){const o=r[s]*e[0]+r[s+1]*e[1]+r[s+2]*e[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function Wot(t,e,i,r,n){const{data:s,size:o}=t;wc(r,s),wc(n,r),i[0]=cxe(Hot,e),i[1]=i[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<i[0]&&(i[0]=l,wc(r,s,a)),l>i[1]&&(i[1]=l,wc(n,s,a))}}function kne(t,e,i){wc(i.center,t),C1(i.halfSize,e,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const $m=[0,0,0],bx=[0,0,0],QC=[0,0,0],rT=[0,0,0],nT=[0,0,0],Une=[0,0,0];function qot(t,e,i){wc($m,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?$m[0]=0:Math.abs(e[1])>Math.abs(e[2])?$m[1]=0:$m[2]=0,lxe($m)<KT&&($m[0]=$m[1]=$m[2]=1),xh(bx,e,$m),Ho(bx,bx),xh(QC,e,bx),Ho(QC,QC),oxe(t,e,bx,QC,rT,nT),wh(Une,nT,rT),axe(e,bx,QC,rT,nT,Une,i)}function oxe(t,e,i,r,n,s){iT(t,e,Us),n[0]=Us[0],s[0]=Us[1],iT(t,i,Us),n[1]=Us[0],s[1]=Us[1],iT(t,r,Us),n[2]=Us[0],s[2]=Us[1]}const T$=[0,0,0],Hp=[1,0,0,0,1,0,0,0,1],wx=[0,0,0];function axe(t,e,i,r,n,s,o){Hp[0]=t[0],Hp[1]=t[1],Hp[2]=t[2],Hp[3]=e[0],Hp[4]=e[1],Hp[5]=e[2],Hp[6]=i[0],Hp[7]=i[1],Hp[8]=i[2],Yot(o.quaternion,Hp),uL(wx,r,n),C1(wx,wx,.5),C1(o.center,t,wx[0]),C1(T$,e,wx[1]),uL(o.center,o.center,T$),C1(T$,i,wx[2]),uL(o.center,o.center,T$),C1(o.halfSize,s,.5)}const Hc=7;let Zot=class{constructor(e){this.minVert=new Array(Hc),this.maxVert=new Array(Hc);const i=64*Hc;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,Hc),r+=8*Hc,this.maxProj=new Float64Array(this.buffer,r,Hc),r+=8*Hc;for(let l=0;l<Hc;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Hc;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<Hc;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(Hc),s=new Array(Hc),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<Hc;++l){let c=n[l];wc(this.minVert[l],o,c),c=s[l],wc(this.maxVert[l],o,c)}}},Xot=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function MV(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function uL(t,e,i){t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2]}function wh(t,e,i){t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2]}function C1(t,e,i){t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}function wc(t,e,i=0){t[0]=e[i],t[1]=e[i+1],t[2]=e[i+2]}function xh(t,e,i){const r=e[0],n=e[1],s=e[2],o=i[0],a=i[1],l=i[2];t[0]=n*l-s*a,t[1]=s*o-r*l,t[2]=r*a-n*o}function Ho(t,e){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){const r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function lxe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function $V(t,e){const i=e[0]-t[0],r=e[1]-t[1],n=e[2]-t[2];return i*i+r*r+n*n}function cxe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Yot(t,e){const i=e[0]+e[4]+e[8];if(i>0){let r=Math.sqrt(i+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);const n=(r+1)%3,s=(r+2)%3;let o=Math.sqrt(e[3*r+r]-e[3*n+n]-e[3*s+s]+1);t[r]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+r]+e[3*r+n])*o,t[s]=(e[3*s+r]+e[3*r+s])*o}}const K1=Xh(),Ha=I(),IV=I(),Jot=on();let wPt=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:dG(this.buffer,56*a+0),halfSize:dme(this.buffer,56*a+24),quaternion:sxe(this.buffer,56*a+36)}}};function uxe(t=[0,0,0],e=[-1,-1,-1],i=Xh()){return{center:Kn(t),halfSize:TD(e),quaternion:nxe(i)}}function zne(t){return uxe(t.center,t.halfSize,t.quaternion)}function TPt(t,e){fe(e.center,t.center),fe(e.halfSize,t.halfSize),QH(e.quaternion,t.quaternion)}function SPt(t,e){return e=e||uxe(),Uot(t,e),e}function l1(t,e){const i=Dr(e,t.center),r=iF(t,e);return i>r?1:i<-r?-1:0}function CPt(t,e){return Ha[0]=t.center[0]-e[0],Ha[1]=t.center[1]-e[1],Ha[2]=t.center[2]-e[2],yy(K1,t.quaternion),Mh(Ha,Ha,K1),$L(Ha,Ha),gG(IV,Ha,t.halfSize),n5(IV,Ha)<e[3]*e[3]}function EPt(t,e){e||(e=$s());const i=NH(Jot,t.quaternion),r=t.halfSize[0]*Math.abs(i[0])+t.halfSize[1]*Math.abs(i[3])+t.halfSize[2]*Math.abs(i[6]),n=t.halfSize[0]*Math.abs(i[1])+t.halfSize[1]*Math.abs(i[4])+t.halfSize[2]*Math.abs(i[7]),s=t.halfSize[0]*Math.abs(i[2])+t.halfSize[1]*Math.abs(i[5])+t.halfSize[2]*Math.abs(i[8]);return e[0]=t.center[0]-r,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+r,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function APt(t,e){return Dr(e,t.center)-iF(t,e)}function PPt(t,e){return Dr(e,t.center)+iF(t,e)}function OPt(t,e){return l1(t,e[0])<=0&&l1(t,e[1])<=0&&l1(t,e[2])<=0&&l1(t,e[3])<=0&&l1(t,e[4])<=0&&l1(t,e[5])<=0}function RPt(t,e,i,r=0){yy(K1,t.quaternion),Ce(Ha,e,t.center);const n=Mh(Ha,Ha,K1),s=Mh(IV,i,K1);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(r+t.halfSize[l]-n[l])/s[l],u=(-r-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(n[l]>t.halfSize[l]+r||n[l]<-t.halfSize[l]-r)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),t})();function iF(t,e){yy(K1,t.quaternion),Mh(Ha,e,K1);const i=t.halfSize;return Math.abs(Ha[0]*i[0])+Math.abs(Ha[1]*i[1])+Math.abs(Ha[2]*i[2])}function MPt(t,e){for(let i=0;i<8;++i){const r=e[i];r[0]=1&i?-t.halfSize[0]:t.halfSize[0],r[1]=2&i?-t.halfSize[1]:t.halfSize[1],r[2]=4&i?-t.halfSize[2]:t.halfSize[2],Mh(r,r,t.quaternion),xe(r,r,t.center)}}function Kot(t){return ac(t.halfSize)}function Qot(t,e,i,r,n){if(QH(n.quaternion,t.quaternion),r===Ke.Global){yy(S$,t.quaternion),Mh(F0,t.center,S$),$L(xx,F0),gG(Tx,xx,t.halfSize),uo(Tx,xx,Tx);const s=ze(Tx);xe(Tx,xx,t.halfSize);const o=ze(Tx);if(s<i)fe(n.center,t.center),me(F0,i,i,i),xe(n.halfSize,t.halfSize,F0);else{const a=o>0?1+e/o:1,l=s>0?1+i/s:1,c=(l+a)/2,u=(l-a)/2;pe(n.halfSize,xx,u),P1(n.halfSize,n.halfSize,t.halfSize,c),pe(n.center,xx,c),P1(n.center,n.center,t.halfSize,u),tle(F0,F0),r5(n.center,n.center,F0),Mh(n.center,n.center,n.quaternion)}}else{const s=me(F0,0,0,1);P1(n.center,t.center,s,(i+e)/2),yy(S$,t.quaternion),Mh(s,s,S$),$L(s,s),P1(n.halfSize,t.halfSize,s,(i-e)/2)}return n}const F0=I(),xx=I(),Tx=I(),S$=Xh();let eat=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let i=0;for(let r=0;r<e.length;r+=2)i+=e[r+1];return i}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=tat(e)}forEachComponent(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r],s=n+i[r+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const n=i[r];if(!e(n,n+i[r+1]))return!1}return!0}computeOffsetRanges(e){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let n=0;n<r.length;n+=2){const s=r[n],o=s+r[n+1],a=e[s],l=e[o];i[n]=a,i[n+1]=l-a}return i}};function tat(t){const e=new Array;if(t.length===0)return e;let i=t[0],r=1;for(let n=1;n<t.length;n++){const s=t[n];i+r===s?r+=1:(e.push(i),e.push(r),i=s,r=1)}return e.push(i),e.push(r),e}let iat=class{constructor(e,i){this.offsets=i,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const r=this.count;this.visibility=new eat(r),this.materialDataBuffer=e.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let n=0;n<r;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:i}=rat(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=i}}};function rat(t,e,i){const r=[],n=[];let s=i.length,o=i.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(r.length&&r.push(i[s+1]-r[r.length-1]),r.push(i[a])),s=a):(o!==a-1&&(n.length&&n.push(i[o+1]-n[n.length-1]),n.push(i[a])),o=a),!0)),r.length&&r.push(i[s+1]-r[r.length-1]),n.length&&n.push(i[o+1]-n[n.length-1]),{highlightRanges:r,defaultRanges:n}}let pA=class extends ke{constructor(){super(...arguments),this.visible=sT.Hidden}};var sT;d([m({autoDestroy:!0})],pA.prototype,"renderable",void 0),d([m({autoDestroy:!0})],pA.prototype,"components",void 0),pA=d([J("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],pA),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(sT||(sT={}));function nat(t,e,i,r){if(i>=e)return t;t==null&&(t=sat());const n=t.isVisibleBit;let s=t.data;const o=dxe(s),a=i/o|0,l=i-o*a,c=(e-1)/o|0,u=s,p=r===n;if(!(i<u.length*o)&&p){const f=a+1,y=Math.ceil(u.length*WN),v=c+1;let b=Math.max(f,y);b=Math.min(b,v),s=new Uint32Array(b),s.set(u)}return a<s.length&&(s[a]=aat(s[a],l,p)),t.data=s,t}function hxe(t,e){if(t==null)return!0;const{isVisibleBit:i,data:r}=t,n=dxe(r);return e<r.length*n?oat(i,r,e,n):!t.isVisibleBit}function sat(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function oat(t,e,i,r){const n=i/r|0,s=i-n*r;return lat(e[n],s)===t}function dxe(t){return t.BYTES_PER_ELEMENT*8}function aat(t,e,i){return t&~(1<<e)|(i?1:0)<<e}function lat(t,e){return(t&1<<e)!=0}let cat=class{constructor(e,i){this._components=i,this._indices=e.indices!=null?Uf(e.indices):DT(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(i.count)}getComponentAabb(e,i){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*e+r];return i}getComponentPositions(e,i){i.indices=this._indices,i.data=this._positions,i.stride=3,i.startIndex=this._components.offsets[e],i.endIndex=this._components.offsets[e+1]}intersect(e,i,r,n,s,o,a){const l=new nt(this._positions,3,!1,3),c=this._indices,u=this._components.offsets,p=K0e(e,i,uat),f=e[2],y=i[2];this._components.visibility.forEachComponent(v=>{if(!hxe(this._components.pickability,v))return!0;const b=this.getComponentAabb(v,hat);if(o!=null){const C=o[v];s!=null?s.componentOffset=C:(e[2]=f-C,i[2]=y-C)}if(s!=null&&s.applyToAabb(b),!MW(b,e,p,r))return!0;const x=u[v]/3,S=u[v+1]/3,P=(C,R,N)=>a(v,C,yc(R,R,n),N);return s==null&&S-x>txe?(this._componentIntersectionData[v]==null&&(this._componentIntersectionData[v]=new oZ(this._indices,x,S,l)),this._componentIntersectionData[v].intersectRay({r0:e,r1:i},P)):eO(e,i,x,S,c,l,void 0,s,P),!0})}_computePerComponentAabbs(){const e=this._components.count,i=mn(6*e),r=this._indices,n=this._positions,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let u=1/0,p=1/0,f=1/0,y=-1/0,v=-1/0,b=-1/0;for(let x=l;x<c;x++){const S=3*r[x],P=n[S],C=n[S+1],R=n[S+2];u=Math.min(u,P),p=Math.min(p,C),f=Math.min(f,R),y=Math.max(y,P),v=Math.max(v,C),b=Math.max(b,R)}i[o++]=u,i[o++]=p,i[o++]=f,i[o++]=y,i[o++]=v,i[o++]=b}return i}get positions(){return this._positions}get indices(){return this._indices}};const uat=I(),hat=$s();let dat=class{constructor(e,i,r){this.material=e,this.geometry=i,this.meta=r}destroy(){this.material.dispose(),this.geometry.dispose()}},pat=class{constructor(e,i,r,n){this.vao=e,this.primitiveType=i,this.parameters=r,this.indexed=n}dispose(){this.vao.dispose()}},fat=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function mat(t,e){return{near:t,far:e}}function mO(t){return t?p3(t,1/0,-1/0):mat(1/0,-1/0)}function p3(t,e,i){return t.near=e,t.far=i,t}function QT(t,e,i=t){return e!=null&&(i.near=Math.min(t.near,e.near),i.far=Math.max(t.far,e.far)),i}function C$(t,e){return t.near<=e&&e<=t.far}const LV={near:0,far:0};function gat(t,e){const i=mO(),{eye:r,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=Re(uo(Xc,a.center,r),s),c=iF(a,s);if(C$(i,l-c)&&C$(i,l+c))return;const u=wat(a,n);if(u===-1)return;if(u===0)return Im.far=l+c,Im.near=l-c,void QT(i,Im);const p=E$.pushNew();p.near=l-c,p.far=l+c,p.mask=u,p.object=o});for(let o=0;o<E$.length;o++){const a=E$.data[o];if(C$(i,a.near)&&C$(i,a.far))continue;Im.far=a.far,Im.near=1/0,bat(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,r,_at,c=>{let u=yat;for(let p=0;p<pxe&&c.length>0;p++){if(!(a.mask&1<<p))continue;vat(n[p],c,u);const f=c;c=u,u=f}for(let p=0;p<c.length;p+=3){me(Sl,c.data[p],c.data[p+1],c.data[p+2]);const f=Re(uo(Sl,Sl,r),s);Im.near=Math.min(Im.near,f)}})===0&&(Im.near=0),QT(i,Im)}return E$.length=0,i}const E$=new ri({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=eS(t.object),t)}),Im=mO(),Sl=I(),Ev=I(),_at=new ri({deallocator:null}),yat=new ri({deallocator:null});function vat(t,e,i){i.length=0;const r=e.length-3;FU(Sl,e,r);const n=Dr(t,Sl);n<=0&&(i.push(Sl[0]),i.push(Sl[1]),i.push(Sl[2]));let s=0,o=n;for(;s<r;s+=3){FU(Ev,e,s);const a=Dr(t,Ev);o*a<0&&(pr(Sl,Ev,Sl,a/(a-o)),Cl(i,Sl)),a<=0&&Cl(i,Ev),o=a,fe(Sl,Ev)}o*n<0&&(FU(Ev,e,r),pr(Sl,Ev,Sl,n/(n-o)),Cl(i,Sl))}function FU(t,e,i){return me(t,e.data[i],e.data[i+1],e.data[i+2])}function Cl(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function bat(t,e,i,r){yy(Vne,t.quaternion),uo(Xc,e,t.center),Mh(Xc,Xc,Vne);const n=8*((Xc[0]<-t.halfSize[0]?-1:Xc[0]>t.halfSize[0]?1:0)+3*(Xc[1]<-t.halfSize[1]?-1:Xc[1]>t.halfSize[1]?1:0)+9*(Xc[2]<-t.halfSize[2]?-1:Xc[2]>t.halfSize[2]?1:0)+13),s=Bne[n];if(s===0)return s;NH(A$,t.quaternion),DH(A$,A$,t.halfSize);const o=(a,l)=>{const c=Bne[n+l+1];return me(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),yc(a,a,A$),xe(a,t.center,a)};return i.length=0,Cl(i,o(kU,0)),Cl(i,o(Gne,1)),Cl(i,o(Xc,2)),Cl(i,o(jne,3)),r(i),s===1||(i.length=0,Cl(i,kU),Cl(i,jne),Cl(i,o(Xc,4)),Cl(i,o(Hne,5)),r(i),s===2||(i.length=0,Cl(i,kU),Cl(i,Hne),Cl(i,o(Xc,6)),Cl(i,Gne),r(i))),s}const Bne=(()=>{const t=new Array(216);let e=0;const i=r=>{for(let n=0;n<r.length;n++)t[e+n]=r[n];e+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),t})(),pxe=4;function wat(t,e){let i=0;for(let r=0;r<pxe;r++){const n=l1(t,e[r]);if(n>0)return-1;n===0&&(i|=1<<r)}return i}const A$=on(),Vne=Xh(),Xc=I(),kU=I(),Gne=I(),jne=I(),Hne=I();let xat=class{constructor(e){this._objects=e}submit(e,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(e,i,r))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?gat(e,this._objects.visibleObjects):null}};function Tat(t){const e=ln().vec3f(M.POSITION);return t.normals&&e.vec2i16(M.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===Yn.Default?e.vec2f(M.UV0):t.textureCoordinates===Yn.Atlas&&(e.vec2f(M.UV0),e.vec4u16(M.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(M.COLOR,{glNormalized:!0}),e}let Sat=class{constructor(){this.externalColor=gi(),this.externalColorMixMode=Es.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},Cat=class extends On{constructor(e,i){super(e,"int",vr.Draw,(r,n,s)=>r.setUniform1i(e,i(n,s)))}};var Vf;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(Vf||(Vf={}));const aZ=429496.7296;function fxe(t,e){QP(t/aZ*.5+.5,e)}function Eat(t,e){switch(e.componentData){case Vf.Varying:return Aat(t,e);case Vf.Uniform:return Pat(t);case Vf.COUNT:return;default:e.componentData}}function Aat(t,e){const{vertex:i,fragment:r}=t;i.include(Ac),i.uniforms.add(new $h("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(M.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===j.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(n1e),i.constants.add("elevationScale","float",2*aZ),i.constants.add("stride","float",ge("enable-feature:objectAndLayerId-rendering")?3:2),i.code.add(T`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),i.code.add(T`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?T`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:T`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),r.code.add(T`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?T`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function Pat(t){const{vertex:e,fragment:i}=t;e.uniforms.add(new wN("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new Cat("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(T`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(T`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Ch;function Oat(t,e){const i=t.vertex;switch(i.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Ch.None:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Ch.Opaque:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Ch.Transparent:i.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Ch||(Ch={}));var Gf;function VPt(t){return t&&tm(t)?Gf.Mars:t&&im(t)?Gf.Moon:Gf.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(Gf||(Gf={}));var au;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(au||(au={}));let Oi=class extends Oa{constructor(){super(...arguments),this.output=j.Color,this.textureCoordinateType=Yn.None,this.componentData=Vf.Uniform,this.cullFace=Fr.Back,this.vertexDiscardMode=Ch.None,this.doubleSidedMode=gn.WindingOrder,this.alphaDiscardMode=_r.Opaque,this.integratedMeshMode=au.None,this.transparencyPassType=At.NONE,this.ellipsoidMode=Gf.Earth,this.pbrMode=Ct.Disabled,this.normalType=Wi.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};d([q({count:j.COUNT})],Oi.prototype,"output",void 0),d([q({count:Yn.COUNT})],Oi.prototype,"textureCoordinateType",void 0),d([q({count:Vf.COUNT})],Oi.prototype,"componentData",void 0),d([q({count:Fr.COUNT})],Oi.prototype,"cullFace",void 0),d([q({count:Ch.COUNT})],Oi.prototype,"vertexDiscardMode",void 0),d([q({count:gn.COUNT})],Oi.prototype,"doubleSidedMode",void 0),d([q({count:_r.COUNT})],Oi.prototype,"alphaDiscardMode",void 0),d([q({count:au.COUNT})],Oi.prototype,"integratedMeshMode",void 0),d([q({count:At.COUNT})],Oi.prototype,"transparencyPassType",void 0),d([q({count:Gf.COUNT})],Oi.prototype,"ellipsoidMode",void 0),d([q({count:Ct.COUNT})],Oi.prototype,"pbrMode",void 0),d([q({count:Wi.COUNT})],Oi.prototype,"normalType",void 0),d([q()],Oi.prototype,"spherical",void 0),d([q()],Oi.prototype,"doublePrecisionRequiresObfuscation",void 0),d([q()],Oi.prototype,"hasVertexColors",void 0),d([q()],Oi.prototype,"hasNormals",void 0),d([q()],Oi.prototype,"hasSlicePlane",void 0),d([q()],Oi.prototype,"hasBaseColorTexture",void 0),d([q()],Oi.prototype,"receiveAmbientOcclusion",void 0),d([q()],Oi.prototype,"receiveShadows",void 0),d([q()],Oi.prototype,"blendingEnabled",void 0),d([q()],Oi.prototype,"hasScreenSpaceReflections",void 0),d([q()],Oi.prototype,"hasPolygonOffset",void 0),d([q()],Oi.prototype,"hasMetallicRoughnessTexture",void 0),d([q()],Oi.prototype,"hasEmissionTexture",void 0),d([q()],Oi.prototype,"hasOcclusionTexture",void 0),d([q()],Oi.prototype,"hasNormalTexture",void 0),d([q()],Oi.prototype,"hasOccludees",void 0),d([q()],Oi.prototype,"hasMultipassTerrain",void 0),d([q()],Oi.prototype,"cullAboveGround",void 0),d([q()],Oi.prototype,"hasCloudsReflections",void 0),d([q()],Oi.prototype,"snowCover",void 0),d([q()],Oi.prototype,"objectAndLayerIdColor",void 0),d([q({constValue:vr.Draw})],Oi.prototype,"pbrTextureBindType",void 0),d([q({constValue:!0})],Oi.prototype,"hasSliceHighlight",void 0),d([q({constValue:!1})],Oi.prototype,"hasSliceInVertexProgram",void 0),d([q({constValue:!1})],Oi.prototype,"useCustomDTRExponentForWater",void 0),d([q({constValue:!1})],Oi.prototype,"hasVertexTangents",void 0),d([q({constValue:!0})],Oi.prototype,"supportsTextureAtlas",void 0),d([q({constValue:!1})],Oi.prototype,"highStepCount",void 0),d([q({constValue:!1})],Oi.prototype,"instancedDoublePrecision",void 0),d([q({constValue:!0})],Oi.prototype,"useFillLights",void 0),d([q({constValue:!1})],Oi.prototype,"objectAndLayerIdColorInstanced",void 0);function Wne(t,e){t.include(ew,e),t.fragment.include(o3);const i=t.fragment;i.uniforms.add(new wN("baseColor",r=>r.baseColor)),i.uniforms.add(new Z1("objectOpacity",r=>r.objectOpacity)),e.hasVertexColors?i.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function qne(t,e){const i=t.fragment;switch(e.doubleSidedMode){case gn.None:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case gn.View:t.include(j2,e),i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case gn.WindingOrder:i.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case gn.COUNT:}switch(e.normalType){case Wi.Attribute:case Wi.Compressed:t.include(U4,e),i.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Wi.ScreenDerivative:t.include(j2,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Wi.Ground:e.spherical?(t.include(j2,e),i.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),i.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case Wi.COUNT:}}function Rat(t,e){const i=t.fragment;if(e.hasBaseColorTexture&&(e.output===j.Color||e.alphaDiscardMode!==_r.Opaque)){t.include(AH,e);const r=e.textureCoordinateType===Yn.Atlas;i.uniforms.add(new $h("baseColorTexture",n=>n.texture)),r?(t.include(sme),i.code.add(T`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):i.code.add(T`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else i.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function Mat(t){const e=new Fi;e.include(j2,t),e.include(U4,t),e.include(ew,t),e.include(Ff,t),e.include(vS,t),e.include(Eat,t),e.include(zZe,t),e.include(lGe,t),e.include(Rat,t),e.include(Oat,t);const{vertex:i,fragment:r}=e;t.pbrMode!==Ct.Normal&&t.pbrMode!==Ct.Schematic||(e.include(OH,t),t.hasNormalTexture&&e.include(l1e,t));const n=t.output===j.Shadow||t.output===j.ShadowHighlight||t.output===j.ShadowExcludeHighlight;n&&t.componentData===Vf.Varying?i.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(T`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===au.ColorOverlay||t.integratedMeshMode===au.ColorOverlayWithWater,o=s&&t.output===j.Color&&t.pbrMode===Ct.WaterOnIntegratedMesh;return s&&(e.include($b,t),e.include(Znt,t),t.spherical?i.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(t.ellipsoidMode===Gf.Earth?vi.radius:t.ellipsoidMode===Gf.Mars?$f.radius:Og.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),i.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===j.ObjectAndLayerIdColor?T`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${T.float(Mo)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===j.ObjectAndLayerIdColor?T`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?T`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?T`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===j.Alpha&&(r.include(Eu),e.include(Au,t),e.include(Wne,t),s&&r.uniforms.add(new vt("ovColorTex",(a,l)=>bV(a,l))),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===j.Color&&(r.include(Eu),e.include(Au,t),e.include(Wne,t),e.include(qne,t),e.include($b,t),t.receiveShadows?(e.include(z4,t),r.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(T`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new vt("ovColorTex",(a,l)=>bV(a,l))),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Ct.Normal||t.pbrMode===Ct.Schematic?(om(r),r.code.add(T`
        ${t.pbrMode===Ct.Normal?T`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?r.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(T`vec3 shadingNormal = normalVertex;`),r.code.add(T`${t.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(T`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?T`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?r.code.add(T`float shadow = evaluateShadow();`):t.spherical?(PS(r),r.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(T`float shadow = 0.0;`),o&&r.uniforms.add(new vt("ovNormalTex",(a,l)=>lZ(l))),t.snowCover&&r.code.add(T`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),r.code.add(T`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?T`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(T`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===At.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===j.Depth||n)&&(e.include(Ug,t),r.code.add(T`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===j.Normal&&(e.include(qne,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===Wi.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===j.ObjectAndLayerIdColor&&e.fragment.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===j.Highlight&&(e.include(Kg,t),r.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function lZ(t){return t.overlays.length===0?null:t.overlays[Jr.INNER].getValidTexture(xn.Water)}const $at=Object.freeze(Object.defineProperty({__proto__:null,build:Mat,getOverlayNormalTexture:lZ},Symbol.toStringTag,{value:"Module"}));let mxe=class gxe extends qi{initializeConfiguration(e,i){i.spherical=e.viewingMode===Ke.Global,i.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Gi(e.rctx,gxe.shader.get().build(this.configuration),_xe)}_setPipelineState(e){const i=this.configuration,r=i.integratedMeshMode!==au.None,n=e===At.NONE,s=e===At.FrontFace;return Zt({blending:i.output!==j.Color&&i.output!==j.Alpha||!i.blendingEnabled?null:n?vu:Qg(e),culling:e4(i.cullFace),depthTest:{func:Dy(e)},depthWrite:n||s?Nl:null,colorWrite:ni,stencilWrite:r||i.hasOccludees?Jf:null,stencilTest:r?gqe(Il.IntegratedMeshMaskExcluded):i.hasOccludees?Ny:null,polygonOffset:n||s?i.hasPolygonOffset?{factor:2,units:2}:null:P4})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};mxe.shader=new Vi($at,()=>Oe(()=>import("./ComponentShader.glsl-0b699836.js"),[],import.meta.url));const _xe=new Map([[M.POSITION,0],[M.NORMAL,1],[M.NORMALCOMPRESSED,1],[M.COLOR,2],[M.UV0,3],[M.UVREGION,4],[M.COMPONENTINDEX,5]]);let Iat=class extends wr{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},cZ=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function bn(t={}){return(e,i)=>{const r=e._parameterCount??0;if(e._parameterCount=r+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,i,{get(){return this[r]},set(s){const o=this[r];if(o==null)this[r]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,i,{get(){return this[r]},set(n){this[r]!==n&&(t.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function Zne(){return(t,e)=>{const i=t._parameterCount??0;t._parameterCount=i+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(i),Object.defineProperty(t,e,{get(){return this[i]},set(r){this[i]!==r&&(this[i]=r,this._setDirty())}})}}let rF=class{constructor(e){this._low=I(),this._high=I(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){fe(this._low,fe(Xne,e));const i=uo(Xne,e,this._low);fe(this._high,i)}get(e){return xe(e,this._low,this._high)}getLowScaled(e){return pe(e,this._low,1)}};const Xne=Tn();let to=class extends Iat{constructor(e,i){super(),this.toMapSpace=i,this.baseColor=Kt(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Za(V4),this.emissiveFactor=Ge(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new hL,this.componentParameters=new pP,this.textureAlphaCutoff=KD,this.alphaDiscardMode=_r.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=Gf.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Oi;const r=new rF(e.position),n=c1e(e.rotationScale);Xb(n,n),this.transformNormalGlobalFromModel=Mde(Hh(n,n)),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=nn(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,i,r,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=i.identifier===_c.Material&&r.transparencyPassType!=null?r.transparencyPassType:At.NONE,s.hasMultipassTerrain=i.identifier===_c.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,s.cullAboveGround=i.identifier===_c.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?gn.View:gn.None,s.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();s.blendingEnabled=o===Ga.Transparent||o===Ga.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?Dat(r)?lZ(r)?au.ColorOverlayWithWater:au.ColorOverlay:au.NoOverlay:au.None,s.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(s.pbrMode=s.integratedMeshMode===au.ColorOverlayWithWater?Ct.WaterOnIntegratedMesh:this.usePBR?a?Ct.Schematic:Ct.Normal:Ct.Disabled,s.normalType=s.integratedMeshMode===au.None?s.hasNormals?Wi.Compressed:Wi.ScreenDerivative:Wi.Ground,s.hasSlicePlane=r.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,i.identifier===_c.ShadowMap)s.output=j.Shadow,s.vertexDiscardMode=Ch.None;else if(i.identifier===_c.Highlight)s.output=j.Highlight,s.vertexDiscardMode=Ch.None;else{switch(this._computeWhichMaterialPass()===Ga.OpaqueAndTransparent?s.vertexDiscardMode=i.transparent?Ch.Opaque:Ch.Transparent:s.vertexDiscardMode=Ch.None,s.output=i.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,i.output){case j.Color:s.receiveAmbientOcclusion=r.ssaoHelper.active,s.hasOccludees=r.hasOccludees,s.receiveShadows=r.shadowMap.ready,s.hasScreenSpaceReflections=r.ssr.enabled,s.hasCloudsReflections=r.cloudsFade.data!=null;break;case j.Alpha:s.hasOccludees=r.hasOccludees;break;case j.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(r)}return this._technique=e.releaseAndAcquire(mxe,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,i,r){if(this.objectOpacity===0)return;const n=r.renderable.geometry,s=r.components,o=r.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Ga.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case Ga.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case Ga.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case Ga.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),Lat(i)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const u=this.componentParameters.castShadows!==Vs.None;u&&e.shadowMap.submitDraw(this,n,a,o),l!=null&&(e.highlight.submitDraw(this,n,l,o),u&&e.highlightShadowMap.submitDraw(this,n,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?Ga.IntegratedMesh:this.objectOpacity<1?Ga.Transparent:this.componentParameters.opaqueOverride===Vs.All?Ga.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===_r.Blend||this.alphaDiscardMode===_r.MaskBlend?Ga.Transparent:this.componentParameters.transparent===Vs.None?Ga.Opaque:this.componentParameters.transparent===Vs.All?Ga.Transparent:Ga.OpaqueAndTransparent}};var Ga,Vs;d([bn({vectorOps:cle})],to.prototype,"baseColor",void 0),d([bn()],to.prototype,"usePBR",void 0),d([bn()],to.prototype,"hasParametersFromSource",void 0),d([bn({vectorOps:eX})],to.prototype,"mrrFactors",void 0),d([bn({vectorOps:eX})],to.prototype,"emissiveFactor",void 0),d([bn({dispose:!0})],to.prototype,"baseColorTexture",void 0),d([bn({dispose:!0})],to.prototype,"metallicRoughnessTexture",void 0),d([bn({dispose:!0})],to.prototype,"emissionTexture",void 0),d([bn({dispose:!0})],to.prototype,"occlusionTexture",void 0),d([bn({dispose:!0})],to.prototype,"normalTexture",void 0),d([bn()],to.prototype,"objectOpacity",void 0),d([Zne()],to.prototype,"commonMaterialParameters",void 0),d([Zne()],to.prototype,"componentParameters",void 0),d([bn()],to.prototype,"textureAlphaCutoff",void 0),d([bn()],to.prototype,"alphaDiscardMode",void 0),d([bn()],to.prototype,"isIntegratedMesh",void 0),d([bn()],to.prototype,"polygonOffsetEnabled",void 0),d([bn()],to.prototype,"ellipsoidMode",void 0),d([bn()],to.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(Ga||(Ga={}));let hL=class extends cZ{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Fr.Back,this.hasSlicePlane=!0}};d([bn()],hL.prototype,"doubleSided",void 0),d([bn()],hL.prototype,"cullFace",void 0),d([bn()],hL.prototype,"hasSlicePlane",void 0);let pP=class extends cZ{constructor(){super(...arguments),this.externalColor=Kt(1,1,1,1),this.externalColorMixMode=Es.Multiply,this.castShadows=Vs.All}get transparent(){return this.externalColor[3]<1?Vs.All:Vs.None}get opaqueOverride(){return this.externalColorMixMode===Es.Replace&&this.externalColor[3]===1?Vs.All:Vs.None}get visible(){return this.externalColor[3]>0?Vs.All:Vs.None}get type(){return Vf.Uniform}};d([bn({vectorOps:cle})],pP.prototype,"externalColor",void 0),d([bn()],pP.prototype,"externalColorMixMode",void 0),d([bn()],pP.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(Vs||(Vs={}));let fA=class extends cZ{constructor(){super(...arguments),this.texture=null,this.transparent=Vs.None,this.opaqueOverride=Vs.None,this.castShadows=Vs.None}get type(){return Vf.Varying}};function Lat(t){return t.overlays.length!==0&&t.overlays[Jr.INNER].getValidTexture(xn.Highlight)!=null}function Dat(t){return t.overlays.length!==0&&t.overlays[Jr.INNER].getColorTextureNoRasterImage()!=null}d([bn()],fA.prototype,"texture",void 0),d([bn()],fA.prototype,"transparent",void 0),d([bn()],fA.prototype,"opaqueOverride",void 0),d([bn()],fA.prototype,"castShadows",void 0);const EN=ln().vec3f(M.POSITION).u16(M.COMPONENTINDEX).u16(M.U16PADDING),yxe=ln().vec2u8(M.SIDENESS),Nat=Pc(yxe),vxe=ln().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u8(M.VARIANTOFFSET,{glNormalized:!0}).u8(M.VARIANTSTROKE).u8(M.VARIANTEXTENSION,{glNormalized:!0}).u8(M.U8PADDING,{glPadding:!0}).u16(M.U16PADDING,{glPadding:!0}),DV=vxe.clone().vec3f(M.NORMAL),NV=vxe.clone().vec3f(M.NORMALA).vec3f(M.NORMALB),bxe=new Map([[M.POSITION0,0],[M.POSITION1,1],[M.COMPONENTINDEX,2],[M.VARIANTOFFSET,3],[M.VARIANTSTROKE,4],[M.VARIANTEXTENSION,5],[M.NORMAL,6],[M.NORMALA,6],[M.NORMALB,7],[M.SIDENESS,8]]);function Yne(t,e,i){const r=e/3,n=new Uint32Array(i+1),s=new Uint32Array(i+1),o=(S,P)=>{S<P?n[S+1]++:s[P+1]++};for(let S=0;S<r;S++){const P=t[3*S],C=t[3*S+1],R=t[3*S+2];o(P,C),o(C,R),o(R,P)}let a=0,l=0;for(let S=0;S<i;S++){const P=n[S+1],C=s[S+1];n[S+1]=a,s[S+1]=l,a+=P,l+=C}const c=new Uint32Array(6*r),u=n[i],p=(S,P,C)=>{if(S<P){const R=n[S+1]++;c[2*R]=P,c[2*R+1]=C}else{const R=s[P+1]++;c[2*u+2*R]=S,c[2*u+2*R+1]=C}};for(let S=0;S<r;S++){const P=t[3*S],C=t[3*S+1],R=t[3*S+2];p(P,C,S),p(C,R,S),p(R,P,S)}const f=(S,P)=>{const C=2*S,R=P-S;for(let N=1;N<R;N++){const $=c[C+2*N],k=c[C+2*N+1];let B=N-1;for(;B>=0&&c[C+2*B]>$;B--)c[C+2*B+2]=c[C+2*B],c[C+2*B+3]=c[C+2*B+1];c[C+2*B+2]=$,c[C+2*B+3]=k}};for(let S=0;S<i;S++)f(n[S],n[S+1]),f(u+s[S],u+s[S+1]);const y=new Int32Array(3*r),v=(S,P)=>S===t[3*P]?0:S===t[3*P+1]?1:S===t[3*P+2]?2:-1,b=(S,P)=>{const C=v(S,P);y[3*P+C]=-1},x=(S,P,C,R)=>{const N=v(S,P);y[3*P+N]=R;const $=v(C,R);y[3*R+$]=P};for(let S=0;S<i;S++){let P=n[S];const C=n[S+1];let R=s[S];const N=s[S+1];for(;P<C&&R<N;){const $=c[2*P],k=c[2*u+2*R];$===k?(x(S,c[2*P+1],k,c[2*u+2*R+1]),P++,R++):$<k?(b(S,c[2*P+1]),P++):(b(k,c[2*u+2*R+1]),R++)}for(;P<C;)b(S,c[2*P+1]),P++;for(;R<N;)b(c[2*u+2*R],c[2*u+2*R+1]),R++}return y}let wxe=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?kat:Fat}write(e,i,r){const n=this._edgeHashFunction(r);O$.seed=n;const s=O$.getIntRange(0,255),o=O$.getIntRange(0,this.settings.variants-1),a=.7,l=O$.getFloat(),c=255*(.5*Uat(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(i,r.position0),e.position1.setVec(i,r.position1),e.componentIndex.set(i,r.componentIndex),e.variantOffset.set(i,s),e.variantStroke.set(i,o),e.variantExtension.set(i,c)}trim(e,i){return e.slice(0,i)}};const uZ=new Float32Array(6),AN=new Uint32Array(uZ.buffer),q_=new Uint32Array(1);function Fat(t){const e=uZ;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],q_[0]=5381;for(let i=0;i<AN.length;i++)q_[0]=31*q_[0]+AN[i];return q_[0]}function kat(t){const e=uZ;e[0]=Sx(t.position0[0]),e[1]=Sx(t.position0[1]),e[2]=Sx(t.position0[2]),e[3]=Sx(t.position1[0]),e[4]=Sx(t.position1[1]),e[5]=Sx(t.position1[2]),q_[0]=5381;for(let i=0;i<AN.length;i++)q_[0]=31*q_[0]+AN[i];return q_[0]}const Jne=1e4;function Sx(t){return Math.round(t*Jne)/Jne}function Uat(t,e){const i=t<0?-1:1;return Math.abs(t)**e*i}let PN=class{constructor(){this._commonWriter=new wxe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return DV.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),xe(P$,r.faceNormal0,r.faceNormal1),Me(P$,P$),e.normal.setVec(i,P$)}trim(e,i){return this._commonWriter.trim(e,i)}};PN.Layout=DV,PN.glLayout=Pc(DV,1);let ON=class{constructor(){this._commonWriter=new wxe}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return NV.createBuffer(e)}write(e,i,r){this._commonWriter.write(e,i,r),e.normalA.setVec(i,r.faceNormal0),e.normalB.setVec(i,r.faceNormal1)}trim(e,i){return this._commonWriter.trim(e,i)}};ON.Layout=NV,ON.glLayout=Pc(NV,1);const P$=I(),O$=new wA,c1=-1;var RN;function zat(t,e,i,r=Wat){const n=t.vertices.position,s=t.vertices.componentIndex,o=Qt(r.anglePlanar),a=Qt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=FV.edge,p=u.position0,f=u.position1,y=u.faceNormal0,v=u.faceNormal1,b=Hat(t),x=jat(t),S=x.length/4,P=e.allocate(S);let C=0;const R=S,N=i.allocate(R);let $=0,k=0,B=0;const W=XTe(0,S),Z=new Float32Array(S);Z.forEach((ee,oe,U)=>{n.getVec(x[4*oe],p),n.getVec(x[4*oe+1],f),U[oe]=Nr(p,f)}),W.sort((ee,oe)=>Z[oe]-Z[ee]);const K=new Array,X=new Array;for(let ee=0;ee<S;ee++){const oe=W[ee],U=Z[oe],V=x[4*oe],H=x[4*oe+1],Y=x[4*oe+2],ie=x[4*oe+3],le=ie===c1;if(n.getVec(V,p),n.getVec(H,f),le)me(y,b[3*Y],b[3*Y+1],b[3*Y+2]),fe(v,y),u.componentIndex=s.get(V),u.cosAngle=Re(y,v);else{if(me(y,b[3*Y],b[3*Y+1],b[3*Y+2]),me(v,b[3*ie],b[3*ie+1],b[3*ie+2]),u.componentIndex=s.get(V),u.cosAngle=Re(y,v),Vat(u,c))continue;u.cosAngle<-.9999&&fe(v,y)}k+=U,B++,le||Bat(u,l)?(e.write(P,C++,u),K.push(U)):Gat(u,o)&&(i.write(N,$++,u),X.push(U))}const ae=new Float32Array(K.reverse()),re=new Float32Array(X.reverse());return{regular:{instancesData:e.trim(P,C),lodInfo:{lengths:ae}},silhouette:{instancesData:i.trim(N,$),lodInfo:{lengths:re}},averageEdgeLength:k/B}}function Bat(t,e){return t.cosAngle<e}function Vat(t,e){return t.cosAngle>e}function Gat(t,e){const i=qs(t.cosAngle),r=FV.fwd,n=FV.ortho;return zg(r,t.position1,t.position0),i*(Re(Rt(n,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}function jat(t){const e=t.faces.length/3,i=t.faces,r=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=r[3*a],c=r[3*a+1],u=r[3*a+2],p=i[3*a],f=i[3*a+1],y=i[3*a+2];n+=l===c1||p<f?1:0,n+=c===c1||f<y?1:0,n+=u===c1||y<p?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=r[3*a],c=r[3*a+1],u=r[3*a+2],p=i[3*a],f=i[3*a+1],y=i[3*a+2];(l===c1||p<f)&&(s[o++]=p,s[o++]=f,s[o++]=a,s[o++]=l),(c===c1||f<y)&&(s[o++]=f,s[o++]=y,s[o++]=a,s[o++]=c),(u===c1||y<p)&&(s[o++]=y,s[o++]=p,s[o++]=a,s[o++]=u)}return s}function Hat(t){const e=t.faces.length/3,i=t.vertices.position,r=t.faces,n=UU.v0,s=UU.v1,o=UU.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=r[3*l],u=r[3*l+1],p=r[3*l+2];i.getVec(c,n),i.getVec(u,s),i.getVec(p,o),Ce(s,s,n),Ce(o,o,n),Rt(n,s,o),Me(n,n),a[3*l]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(RN||(RN={}));const FV={edge:{position0:I(),position1:I(),faceNormal0:I(),faceNormal1:I(),componentIndex:0,cosAngle:0},ortho:I(),fwd:I()},UU={v0:I(),v1:I(),v2:I()},Wat={anglePlanar:4,angleSignificantEdge:35};function qat(t){const e=Zat(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return Kne.updateSettings(t.writerSettings),Qne.updateSettings(t.writerSettings),zat(e,Kne,Qne)}function Zat(t,e,i,r){if(e){const o=Yne(i,r,t.count);return new Xat(i,r,o,t)}const n=j7(t.buffer,t.stride/4,{originalIndices:i,originalIndicesLength:r}),s=Yne(n.indices,r,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:EN.createView(n.buffer)}}let Xat=class{constructor(e,i,r,n){this.faces=e,this.facesLength=i,this.neighbors=r,this.vertices=n}};const Kne=new PN,Qne=new ON,t3t=ln().vec3f(M.POSITION0).vec3f(M.POSITION1),Yat=ln().vec3f(M.POSITION0).vec3f(M.POSITION1).u16(M.COMPONENTINDEX).u16(M.U16PADDING,{glPadding:!0});let Jat=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},Kat=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this.textureWidth=4096,this._dirty=!0;const r=new Di;r.samplingMode=qt.NEAREST,r.wrapMode=Jt.CLAMP_TO_EDGE,r.width=this.textureWidth,r.height=1,this._texture=new Wt(this._rctx,r),this._data=new Aa(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,i,r,n,s,o){const a=e*this._fieldCount+i;this._dirty=!0,this._data.set(a,0,r),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,i,r,n){const s=e*this._fieldCount+i;this._dirty=!0,this._data.set(s,r,n)}getDataElement(e,i,r){const n=e*this._fieldCount+i;return this._dirty=!0,this._data.get(n,r)}resizeToFit(e){const i=(e+1)*this._fieldCount;if(i>this._data.count){const r=Math.ceil(i/this.textureWidth)*this.textureWidth,n=new Aa(new ArrayBuffer(4*r));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,i=this._texture.descriptor.height;this._data.count>e*i&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const xxe=65536;let Qat=class{constructor(e,i=1){this.textureBuffer=new Kat(e,i),this._indexManager=new Jat(xxe)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},Txe=class{constructor(e,i=1){this._rctx=e,this._fieldCount=i,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const r of this._buffers)if(r.availableCount>=e)return r;if(e>xxe)return null;const i=new Qat(this._rctx,this._fieldCount);return this._buffers.push(i),i}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const ese=ye.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class elt{constructor(e,i){this._renderManager=e,this._viewingMode=i,this._objects=[new ri,new ri],this._renderSubmit=new xat(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=ge("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new Txe(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){xt(this._objects[sT.Hidden].length===0&&this._objects[sT.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(i=>i.toArray());for(const i of e)i==null||i.destroy()}createObject(e){const i=new pA;return i.toMapSpace=e.toMapSpace,i.transform=e.transform,i.obb=zne(e.obb),i.components=new iat(this._componentBufferManager,Uf(e.geometry.componentOffsets)),i.renderable=this._createRenderable(e,i.components),i.intersectionGeometry=new cat(e.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(e){const i=e;this._objects[i.visible].removeUnordered(i),i.destroy(),this._notifyDirty()}setObjectVisibility(e,i){const r=e;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(e){const i=e.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Io(i,r.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,i){const r=e.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,i){const r=e;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,i){return e.components.visibility.forEachComponent(i)}getComponentCount(e){const i=e,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(e,i){const r=e,n=r.renderable.material,s=r.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new Sat,c=o.textureBuffer,u=new Uint8Array(4),p=new Uint32Array(u.buffer);let f=0,y=0,v=0,b=s.verticalOffsets,x=1/0,S=-1/0,P=!1,C=!1,R=0;for(let N=0;N<s.count;N++){i(N,l),f+=+(l.externalColor[3]<1),y+=+(l.externalColorMixMode===Es.Replace&&l.externalColor[3]===1),v+=+l.castShadows,r1e(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[N],0,u[0],u[1],u[2],u[3]),P||(P=N>0&&R!==p[0]),R=p[0],C||(C=l.elevationOffset!==0),C&&b==null&&(b=new Array(N).fill(0)),b!=null&&(b[N]=l.elevationOffset),x=Math.min(x,l.elevationOffset),S=Math.max(S,l.elevationOffset),fxe(l.elevationOffset,u),c.setData(a[N],1,u[0],u[1],u[2],u[3]);const $=l.objectAndLayerIdColor;$!=null&&c.setData(a[N],2,$[0],$[1],$[2],$[3]),l.pickable!==hxe(s.pickability,N)&&(s.pickability=nat(s.pickability,s.count,N,l.pickable))}s.verticalOffsets=C?b:null,r.offsetObb=C?Qot(r.obb,x,S,this._viewingMode,r.offsetObb!=null?r.offsetObb:zne(r.obb)):null,P||C||this._hasObjectAndLayerId?(n.componentParameters=new fA,n.componentParameters.castShadows=zU(v,s.count),n.componentParameters.transparent=zU(f,s.count),n.componentParameters.opaqueOverride=zU(y,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new pP,n.componentParameters.castShadows=l.castShadows?Vs.All:Vs.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,i,r,n=!1){e.intersectionGeometry.getComponentAabb(i,r);const s=e,o=s.components.verticalOffsets;if(n||o==null)return r;const a=o[i];if(this._viewingMode===Ke.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=M9e(a);return l.localOrigin=s.transform.position,l.applyToAabb(r)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,i,r){return e.intersectionGeometry.getComponentPositions(i,r)}intersect(e,i,r,n,s,o){const a=e;s!=null&&(s.localOrigin=a.transform.position);const l=Xb(tse,a.transform.rotationScale);uo(R$,i,a.transform.position),uo(M$,r,a.transform.position),yc(R$,R$,l),yc(M$,M$,l);const c=Hh(tse,l);return a.intersectionGeometry.intersect(R$,M$,n,c,s,a.components.verticalOffsets,o)}addEdges(e,i,r,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return i.addComponentObject(e,s.transform,{center:s.obb.center,radius:Kot(s.obb)},a,o,l,r,n)}async extractEdgeInformation(e,i,r){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:Yat.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=EN.createBuffer(a.length/3);fO(c.position.typedBuffer,a,c.position.typedBufferStride,3),Kye(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,p=this._computeVisibilityIndices(o,s,l,u);return{origin:Kn(n.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(e,i,r){let n=0;for(let s=0;s<r.length-1;s++){const o=r[s],a=r[s+1];for(let l=o;l<a;l++){const c=i?i[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,i,r,n){if(e&&i.allVisible())return e;let s=0;i.forEachComponentRange((l,c)=>(s+=r[c]-r[l],!0));const o=cp(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return i.forEachComponentRange((l,c)=>{const u=r[l],p=r[c];for(let f=u;f<p;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,i){const r=e.components;r.highlightCounts==null&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(e,i){const r=e.components;if(r.highlightCounts==null)return void ese.warn("Removing non-existing highlight.");const n=r.highlightCounts[i],s=r.highlightCounts[r.count];if(n!==0){if(n>1)return r.highlightCounts[i]=n-1,void(r.highlightCounts[r.count]=s-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),s===1?r.highlightCounts=null:r.highlightCounts[r.count]=s-1}else ese.warn("Removing non-existing highlight.")}clearHighlights(e){const i=e.components;i.highlightCounts!=null&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[sT.Visible]}_createRenderable(e,i){const r=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=Ki.createVertex(r,zi.STATIC_DRAW,n.vertices.data),a=Eh(n.indices,b=>Ki.createIndex(r,zi.STATIC_DRAW,b)),l=Pc(Tat(s)),c=new Uint16Array(n.vertices.count);for(let b=0;b<i.count;b++){const x=i.offsets[b],S=i.offsets[b+1],P=i.materialDataIndices[b];if(n.indices!=null)for(let C=x;C<S;C++)c[n.indices[C]]=P;else for(let C=x;C<S;C++)c[C]=P}const u=Ki.createVertex(r,zi.STATIC_DRAW,c.buffer),p=new to(e.transform,e.toMapSpace),f=new Gh(r,_xe,{data:l,componentIndices:tlt},{data:o,componentIndices:u},a),y=new pat(f,Ht.TRIANGLES,s,a!=null),v={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+u.byteLength+(a!=null?a.byteLength:0)};return new dat(p,y,v)}_notifyDirty(){this._renderManager.notifyDirty()}}const tlt=Pc(ln().u16(M.COMPONENTINDEX));function zU(t,e){return t===e?Vs.All:t===0?Vs.None:Vs.Some}const tse=Ll(),R$=I(),M$=I();let Sxe=class extends wr{constructor(){super(...arguments),this.scale=it()}};function ilt(t){const e=new Fi;e.attributes.add(M.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new Bi("scale",r=>r.scale)),e.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new vt("tex",r=>r.texture),new vt("depthTexture",r=>r.depthTexture),new Bi("scale",r=>r.scale),new Bi("clampUV",r=>rlt(r)));const i=t.haze;return e.fragment.code.add(T`
    void main() {
      ${i?T`vec4`:T`float`} depthSample = texture(depthTexture, uv0) ${i?"":T`.r`};
      if (depthSample ${i?T`== vec4(0)`:T`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function rlt(t){if(!t.texture)return ise;const e=bi(ise,t.texture.descriptor.width,t.texture.descriptor.height),i=yH(e,e,t.scale),r=Ife(i,i);return Ffe(r,t.scale,r)}const ise=it(),nlt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:Sxe,build:ilt},Symbol.toStringTag,{value:"Module"}));let Cxe=class Exe extends qi{initializeProgram(e){return new Gi(e.rctx,Exe.shader.get().build(this.configuration),Ni)}initializePipeline(){return this.configuration.haze?Zt({blending:Fo(De.ONE,De.ZERO,De.ONE_MINUS_SRC_COLOR,De.ONE),depthTest:{func:br.ALWAYS},colorWrite:ni}):Zt({blending:Ec(De.SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:br.ALWAYS},colorWrite:ni})}};Cxe.shader=new Vi(nlt,()=>Oe(()=>import("./AtmosphereCompositing.glsl-9c727d1e.js"),[],import.meta.url));let Axe=class extends wr{constructor(){super(...arguments),this.opacity=1}};function slt(t){const e=new Fi;return e.include(Yh),e.fragment.uniforms.add(new vt("tex",i=>i.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new je("opacity",i=>i.opacity)),e.fragment.code.add(T`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const olt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:Axe,build:slt},Symbol.toStringTag,{value:"Module"}));var wa;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(wa||(wa={}));let kV=class extends Oa{constructor(){super(...arguments),this.alphaMode=wa.None,this.hasOpacityFactor=!1}};d([q({count:wa.COUNT})],kV.prototype,"alphaMode",void 0),d([q()],kV.prototype,"hasOpacityFactor",void 0);let Pxe=class Oxe extends qi{initializeProgram(e){return new Gi(e.rctx,Oxe.shader.get().build(this.configuration),Ni)}initializePipeline(){switch(this.configuration.alphaMode){case wa.None:return Zt({colorWrite:ni});case wa.Alpha:return Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni});case wa.PremultipliedAlpha:case wa.COUNT:return Zt({blending:Ec(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni})}}};Pxe.shader=new Vi(olt,()=>Oe(()=>import("./Compositing.glsl-4236ee0e.js"),[],import.meta.url));let Rxe=class extends wr{};function alt(){const t=new Fi;return t.include(Yh),t.fragment.uniforms.add(new vt("tex",e=>e.texture)),t.fragment.code.add(T`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const llt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:Rxe,build:alt},Symbol.toStringTag,{value:"Module"}));let Mxe=class $xe extends qi{initializeProgram(e){return new Gi(e.rctx,$xe.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};Mxe.shader=new Vi(llt,()=>Oe(()=>import("./HUDCompositing.glsl-1b480c35.js"),[],import.meta.url));let Ixe=class extends wr{};function clt(){const t=new Fi;return t.include(Yh),t.fragment.uniforms.add(new vt("colorTexture",e=>e.colorTexture),new vt("alphaTexture",e=>e.alphaTexture),new vt("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(T`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const ult=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:Ixe,build:clt},Symbol.toStringTag,{value:"Module"}));let Lxe=class Dxe extends qi{initializeProgram(e){return new Gi(e.rctx,Dxe.shader.get().build(),Ni)}initializePipeline(){return Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni})}};Lxe.shader=new Vi(ult,()=>Oe(()=>import("./OITCompositing.glsl-8c62191f.js"),[],import.meta.url));let Nxe=class extends wr{constructor(){super(...arguments),this.overlayIndex=Jr.INNER,this.opacity=1}};function hlt(){const t=new Fi;return t.include(Yh),t.fragment.uniforms.add(new vt("tex",e=>e.texture)),t.fragment.uniforms.add(new uO("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new je("opacity",e=>e.opacity)),t.fragment.code.add(T`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const dlt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:Nxe,build:hlt},Symbol.toStringTag,{value:"Module"}));let Fxe=class kxe extends qi{initializeProgram(e){return new Gi(e.rctx,kxe.shader.get().build(),Ni)}initializePipeline(){return Zt({blending:Ec(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni})}};Fxe.shader=new Vi(dlt,()=>Oe(()=>import("./OverlayCompositing.glsl-2b53c301.js"),[],import.meta.url));let plt=class{constructor(e,i){this._rctx=e,this._techniqueRepository=i,this._configuration=new kV,this._atmosphereConfiguration=new wD,this._passParameters=new Axe,this._atmosphereParameters=new Sxe,this._oitParameters=new Ixe,this._hudParameters=new Rxe,this._overlayParameters=new Nxe}destroy(){this._vao=et(this._vao)}compositeOIT(e,i,r,n){this._oitParameters.colorTexture=i,this._oitParameters.alphaTexture=r,this._oitParameters.frontFaceTexture=n;const s=this._rctx,o=this._techniqueRepository.acquire(Lxe);s.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(a,"geometry")),o.release()}compositeHUD(e,i){this._hudParameters.texture=i;const r=this._rctx,n=this._techniqueRepository.acquire(Mxe);r.bindTechnique(n,this._hudParameters,e);const s=this._ensureVAO();r.bindVAO(s),r.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(s,"geometry")),n.release()}compositeOverlay(e,i,r,n){this._overlayParameters.texture=i,this._overlayParameters.opacity=r,this._overlayParameters.overlayIndex=n;const s=this._rctx,o=this._techniqueRepository.acquire(Fxe);s.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(a,"geometry")),o.release()}compositeAtmosphere(e,i,r,n,s){const o=this._rctx;this._atmosphereParameters.texture=i,this._atmosphereParameters.depthTexture=r,this._atmosphereParameters.scale=n,this._atmosphereConfiguration.haze=s;const a=this._techniqueRepository.acquire(Cxe,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(l,"geometry")),a.release()}composite(e,i,r=wa.None,n=1){const s=this._rctx;this._configuration.alphaMode=r,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=i,this._passParameters.opacity=n;const o=this._techniqueRepository.acquire(Pxe,this._configuration);s.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=Fl(this._rctx)),this._vao}};const flt=1e4,UV=100,mlt=500,glt=500,_lt=.1;function ylt(t,e,i){return NW(e,t)*(i[1]-i[0])+i[0]}function vlt(t,e,i){let r=0;if(!e.some(s=>(r+=s.numGeometries,r>=flt)))return Alt.compute(t,e);const n=mO();return i.forAll(s=>{s.visible&&QT(n,blt(t,s))}),n}function blt(t,e){if(!e.visible)return;const i=mO(),r=e.getSpatialQueryAccelerator();return r!=null?wlt(i,t,r):xlt(i,t,e.objects),i}function wlt(t,e,i){const r=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=i.objectCount;if(a<mlt)p3(fh,e.near,Math.min(t.near,e.far)),i.forEachInDepthRange(r,n,Kd.DepthOrder.FRONT_TO_BACK,fh,(l,c)=>{zV(t,e,l),fh.far=t.near,c.setRange(fh)},s,o),p3(fh,Math.max(t.far,e.near),e.far),i.forEachInDepthRange(r,n,Kd.DepthOrder.BACK_TO_FRONT,fh,(l,c)=>{zV(t,e,l),fh.near=t.far,c.setRange(fh)},s,o);else{const l=Math.max(Math.min(a,glt),Math.ceil(a*_lt)),c=i.findClosest(n,Kd.DepthOrder.FRONT_TO_BACK,s,o,l),u=i.findClosest(n,Kd.DepthOrder.BACK_TO_FRONT,s,o,l);c&&u&&(rse(t,e,c.boundingVolumeWorldSpace.bounds),rse(t,e,u.boundingVolumeWorldSpace.bounds))}}function xlt(t,e,i){Cx.clear(),i.forAll(r=>{r.visible&&r.geometries.length!==0&&Cx.add(r)}),Cx.empty||(Cx.sort(e),p3(fh,e.near,Math.min(t.near,e.far)),Cx.forEachInDepthRange(fh,Kd.DepthOrder.FRONT_TO_BACK,(r,n)=>{n<t.near&&zV(t,e,r)}),p3(fh,Math.max(t.far,e.near),e.far),Cx.forEachInDepthRange(fh,Kd.DepthOrder.BACK_TO_FRONT,(r,n,s)=>{t.far=Math.max(t.far,s)}))}function zV(t,e,i){if(!i.visible||!j_(e.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,n=Elt;i.geometries.forEach(s=>{Cr(n,r,s.shaderTransformation);const o=CT(n);Uxe(t,e,s.boundingInfo,n,o)})}function Uxe(t,e,i,r,n){if(i==null)return;st(qa,i.center,r);const{eye:s,viewForward:o}=e,a=o[0]*(qa[0]-s[0])+o[1]*(qa[1]-s[1])+o[2]*(qa[2]-s[2]);if(qa[3]=i.radius*n,!(a-qa[3]>t.near&&a+qa[3]<t.far)&&j_(e.frustum,qa))if(i.radius>UV&&i.getChildren())for(const l of i.getChildren())Uxe(t,e,l,r,n);else BV.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function rse(t,e,i){const r=e.eye,n=e.viewForward,s=(i[0]-r[0])*n[0]+(i[1]-r[1])*n[1]+(i[2]-r[2])*n[2];t.near=Math.min(t.near,s-i[3]),t.far=Math.max(t.far,s+i[3])}let Tlt=class{constructor(){this._items=new ri({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const i=e.eye,r=e.viewForward;this._items.forAll(n=>{const s=n.obj.boundingVolumeWorldSpace.bounds,o=(s[0]-i[0])*r[0]+(s[1]-i[1])*r[1]+(s[2]-i[2])*r[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,i,r){if(i===Kd.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.obj,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||r(s.obj,s.near,s.far)}}},Slt=class{constructor(){this._view=Ne(),this._viewProj=Ne(),this._frustum=HP(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,i){this._reset(),Qn(this._view,e.viewMatrix),Cr(this._viewProj,e.projectionMatrix,this._view),CD(this._frustum,e.frustum);const r=this._view,n=r[2],s=r[6],o=r[10],a=r[14];i.forAll(f=>f.forEachGeometry(y=>{if(!y.visible||!y.castShadow)return;const v=y.boundingSphere,b=n*v[0]+s*v[1]+o*v[2]+a,x=b-v[3],S=b+v[3];this._geometries.push(y),this._near.push(-S),this._far.push(-x)}));const l=new fat;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,p=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[u++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[p++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,y)=>this._near[f]<this._near[y]?-1:this._near[f]>this._near[y]?1:0),this._farCandidates.sort((f,y)=>this._far[f]<this._far[y]?1:this._far[f]>this._far[y]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const y=this._nearCandidates[f];if(this._near[y]<l.near){const v=this._geometries[y],b=v.boundingInfo;this._includeNearBoundingInfoRec(b,v.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const y=this._farCandidates[f];if(this._far[y]>l.far){const v=this._geometries[y],b=v.boundingInfo;this._includeFarBoundingInfoRec(b,v.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,i,r){if(e==null)return;const n=e.center;st(qa,n,i);const s=CT(i),o=qa[0],a=qa[1],l=qa[2],c=e.radius*s,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const p=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=p+c;if(!(-(p-c)<2||-f>=r.near))if(-f>this._looseRange.near)r.near=-f;else{if(c>UV){const y=e.getChildren();if(y!==void 0){for(const v of y)this._includeNearBoundingInfoRec(v,i,r);return}}BV.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,i,r){if(e==null)return;let n=e.radius;const s=e.center;st(qa,s,i);const o=CT(i),a=qa[0],l=qa[1],c=qa[2];n*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>n||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>n||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>n||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>n)return;const p=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-p<=r.far))if(-p<this._looseRange.far)r.far=-p;else{if(n>UV){const f=e.getChildren();if(f!==void 0){for(const y of f)this._includeFarBoundingInfoRec(y,i,r);return}}BV.unionDepthRangeWithAABB(r,this._viewProj,i,e.bbMin,e.bbMax)}}},Clt=class{constructor(){this._modelViewProj=Ne(),this._clipPosition=[gi(),gi(),gi(),gi(),gi(),gi(),gi(),gi()]}unionDepthRangeWithAABB(e,i,r,n,s){const o=this._modelViewProj;Cr(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],p=l===0||l===1||l===4||l===5?n[1]:s[1],f=l<4?n[2]:s[2];c[0]=o[0]*u+o[4]*p+o[8]*f+o[12],c[1]=o[1]*u+o[5]*p+o[9]*f+o[13],c[2]=o[2]*u+o[6]*p+o[10]*f+o[14],c[3]=o[3]*u+o[7]*p+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[BU[l][0]],u=this._clipPosition[BU[l][1]],p=this._clipPosition[BU[l][2]],f=this._clipTriangle(c,u,p);let y=!0;for(let v=0;v<f.length;++v)if(f[v][3]>=2){y=!1;break}if(!y){a=!0;for(let v=0;v<f.length;++v){const b=f[v][3];Number.isFinite(b)&&(e.near=Math.min(b,e.near),e.far=Math.max(b,e.far))}}}return a}_inside(e,i){return i===0?e[0]>=-e[3]:i===1?e[1]>=-e[3]:i===2?e[0]<=e[3]:i===3?e[1]<=e[3]:void xt(!1)}_intersect(e,i,r){let n=0;return r===0?n=(-e[3]-e[0])/(i[0]-e[0]+i[3]-e[3]):r===1?n=(-e[3]-e[1])/(i[1]-e[1]+i[3]-e[3]):r===2?n=(e[3]-e[0])/(i[0]-e[0]-i[3]+e[3]):r===3&&(n=(e[3]-e[1])/(i[1]-e[1]-i[3]+e[3])),bG(gi(),e,i,n)}_clipTriangle(e,i,r){let n=[e,i,r];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const BU=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],qa=kn(),Elt=Ne(),fh=mO(),Cx=new Tlt,Alt=new Slt,BV=new Clt;let Plt=class{},Olt=class extends wr{constructor(){super(...arguments),this.textures=new Plt}};function Rlt(){const t=new Fi;return t.attributes.add(M.POSITION,"vec2"),t.vertex.uniforms.add(new yi("drawPosition",(e,i)=>Mlt(e,i))),t.varyings.add("vUV","vec2"),t.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new vt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new vt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new vt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new kf("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new kf("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function Mlt(t,e){const i=e.camera.pixelRatio,r=t.magnifier.offset.x*i,n=t.magnifier.offset.y*i;bf(t.magnifier.position,nse);const s=e.camera.screenToRender(nse,$lt),o=Math.ceil(i*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Br(Ilt,(s[0]+r)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const nse=fn(),$lt=Oue(),Ilt=gi();async function Llt(t){const e=Oe(()=>import("./mask-svg-023bbc42.js"),[],import.meta.url),i=Oe(()=>import("./overlay-svg-d62383f3.js"),[],import.meta.url),r=kg((await e).default,{signal:t}),n=kg((await i).default,{signal:t}),s={mask:await r,overlay:await n};return Ti(t),s}let a2=class extends ke{constructor(){super(...arguments),this._handles=new an,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new Olt,this.events=new os,this.attributeLocations=new Map([[M.POSITION,0]]),this._tmpScreenPoint=fn(),this._tmpRenderPoint=Oue()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const i=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(Pe(()=>Eh(this._magnifier,r=>r.version),i)),i()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,i){const r=this._validMagnifier;if(r==null)return;const n=i.camera.pixelRatio,s=Math.ceil(n*r.size);if(this._updateResources(e,s),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),bf(r.position,this._tmpScreenPoint);const l=i.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=i.camera.fullWidth,u=i.camera.fullHeight,p=.5*a,f=.5*a;l[0]=$e(l[0],p,c-p-1),l[1]=$e(l[1],f,u-f-1);const y=Math.floor(l[0]-p),v=Math.floor(l[1]-f),b=this._resources.program;b.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,y,v,a,a,0),this._passParameters.magnifier=r,e.useProgram(b),b.bindPass(this._passParameters,i),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Ht.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const i=e.maskUrl,r=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===i&&this._imageLoadTask.overlayUrl===r||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:i,overlayUrl:r,task:_S(async n=>{const s=i==null||r==null?Llt(n):null,o=i!=null?kg(i,{signal:n}):s.then(l=>l.mask),a=r!=null?kg(r,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,i){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==i){const n=this._createTextureResources(e,i);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const r=this._createTextureResources(e,i);r!=null&&(this._resources={program:this._createProgram(e),vao:Fl(e,TH,this.attributeLocations,0,1),pipelineState:Zt({blending:Ec(De.ONE,De.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ni})},this._passParameters.textures=r)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,i){if(this._imageSources==null)return null;this._imageSources.overlay.width=i,this._imageSources.overlay.height=i,this._imageSources.mask.width=i,this._imageSources.mask.height=i;const r=new Di;r.internalFormat=Gt.RGBA,r.wrapMode=Jt.CLAMP_TO_EDGE,r.flipped=!0,r.preMultiplyAlpha=!the(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new Wt(e,r,this._imageSources.overlay);r.pixelFormat=r.internalFormat=Gt.ALPHA,r.preMultiplyAlpha=!1;const s=new Wt(e,r,this._imageSources.mask);return r.pixelFormat=r.internalFormat=Gt.RGBA,r.flipped=!1,{input:new Wt(e,r),mask:s,overlay:n,size:i}}_createProgram(e){return new Gi(e,Rlt(),this.attributeLocations)}};d([m()],a2.prototype,"_imageSources",void 0),d([m()],a2.prototype,"_imageLoadTask",void 0),d([m({readOnly:!0})],a2.prototype,"updating",null),a2=d([J("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a2);let Dlt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new Aa(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,i,r,n,s,o=null,a=null,l=null){if(!(e&&i&&r&&n)||(this._layerUidToId.set(n,r),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(i,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const i=this.getObjectAndLayerIdColorArray(e);return Kt(i.get(0,1),i.get(0,2),i.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const i=this._layerUidToPopupEnabled.get(e.layerUid);if(i===void 0)return ye.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(i===!1)return this.colorZero;let r=this._uidToRenderColor.get(e.layerUid);r||(r=new Map,this._uidToRenderColor.set(e.layerUid,r));let n=r.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");r.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new Aa(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[i,r]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(r.layerUid);let s=null;n?(s=n.get(r.graphicUid),s||ye.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+r.graphicUid)):ye.getLogger(this).warn("getColorMapping: no entry found for layerUid "+r.layerUid);const o=this._layerUidToId.get(r.layerUid);o||ye.getLogger(this).warn("no layerId found for uid "+r.layerUid),s&&o&&e.set(i,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var f3;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(f3||(f3={}));let k0=class{constructor(e,i,r=f3.FrontToBack){this._rctx=e,this._techniqueRepository=i,this._sorting=r,this._draws=new ri({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,i,r,n){const s=this._draws.pushNew();s.geometry=i,s.geometryRanges=r,s.material=e,s.depthSquaredHint=n,s.indexType=(i.indexed?i.vao.indexBuffer.indexType:null)??0}prepare(e,i){return this._draws.map(r=>r.material.prepareTechnique(this._techniqueRepository,e,i,r.geometry.parameters))}dispatch(e,i,r){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=r[a];l===s&&l.configuration.transparencyPassType===At.NONE||(n.bindTechnique(l,e,i),s=l);const c=this._draws.data[a],u=c.geometry;n.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,i,e),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,f=p.length;if(c.indexType!==0){const y=dL.get(c.indexType);for(let v=0;v<f;v+=2){const b=p[v],x=p[v+1];n.drawElements(u.primitiveType,x,c.indexType,b*y)}}else for(let y=0;y<f;y+=2){const v=p[y],b=p[y+1];n.drawArrays(u.primitiveType,v,b)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===f3.FrontToBack?1:-1;this._draws.sort((i,r)=>{const n=e*(i.depthSquaredHint-r.depthSquaredHint);return n!==0?n:i.geometry.vao.byteSize-r.geometry.vao.byteSize})}get count(){return this._draws.length}};const dL=new Map;dL.set(bt.UNSIGNED_BYTE,1),dL.set(bt.UNSIGNED_SHORT,2),dL.set(bt.UNSIGNED_INT,4);let Nlt=class{constructor(e,i){this.rctx=e,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new Hnt,this._shadowPassParameters=new Wnt,this._highlightPassParameters=new qnt,this._systems=new Set,this._passes={materialOpaque:new k0(e,i),materialTransparent:new k0(e,i,f3.BackToFront),materialIntegratedMesh:new k0(e,i),shadowMap:new k0(e,i),highlight:new k0(e,i),highlightIntegratedMesh:new k0(e,i),highlightShadowMap:new k0(e,i),defaultShadowMap:new k0(e,i)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,e.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(i,r)=>i.prepare(r,e.bindParameters)))}render(e,i){this._invoke(e,(r,n)=>r.dispatch(n,e.bindParameters,i))}_invoke(e,i){switch(e.bindParameters.slot){case Te.OPAQUE_MATERIAL:switch(e.output){case j.Color:case j.Depth:case j.Normal:case j.ObjectAndLayerIdColor:return i(this._passes.materialOpaque,this._materialPassParameters);case j.Highlight:return i(this._passes.highlight,this._highlightPassParameters);case j.Shadow:return i(this._passes.shadowMap,this._shadowPassParameters);case j.ShadowHighlight:return i(this._passes.highlightShadowMap,this._shadowPassParameters);case j.ShadowExcludeHighlight:return i(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case Te.TRANSPARENT_MATERIAL:switch(e.output){case j.Color:case j.Alpha:case j.Depth:case j.Normal:case j.ObjectAndLayerIdColor:return i(this._passes.materialTransparent,this._materialPassParameters)}break;case Te.INTEGRATED_MESH:switch(e.output){case j.Color:case j.Depth:case j.Normal:case j.ObjectAndLayerIdColor:return i(this._passes.materialIntegratedMesh,this._materialPassParameters);case j.Highlight:return i(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[Te.OPAQUE_MATERIAL,Te.TRANSPARENT_MATERIAL,Te.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const n=r.queryShadowCasterDepthRange(e);n!=null&&QT(i,n,i)}),i}_configure(e){const i=e.output===j.Shadow||e.output===j.ShadowHighlight||e.output===j.ShadowExcludeHighlight?this._shadowPassParameters:e.output===j.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,i)}_updateParameters(e,i){const r=e.bindParameters.camera,n=r.viewInverseTransposeMatrix;me(VU,n[3],n[7],n[11]),GU.set(VU),fe(i.transformWorldFromViewTH,GU.high),fe(i.transformWorldFromViewTL,GU.low),fe(i.slicePlaneLocalOrigin,VU),jh(i.transformViewFromCameraRelativeRS,r.viewMatrix),Qn(i.transformProjFromView,r.projectionMatrix),i.identifier===_c.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===Te.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===Te.INTEGRATED_MESH,Hh(sse,i.transformViewFromCameraRelativeRS),Xb(i.transformNormalViewFromGlobal,sse))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const VU=I(),sse=on(),GU=new rF;let Flt=class{constructor(){this._step=lse,this._dilation=1,this._firstIdleTime=0}frame(e,i){if(i?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,ge("disable-feature:high-quality-idle"))this._dilation=1;else{const n=i?performance.now()-this._firstIdleTime:0;if(n>=ose+Ult)return this._step=1/0,void(this._dilation=1);this._dilation=n>=ose?zlt:1}const r=$e(e/klt,lse,Vlt);this._step===1/0?this._step=r:this._step=this._step*ase+r*(1-ase)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const klt=.5,ose=12e4,Ult=1e4,zlt=10,ase=.9,Blt=30,lse=1e3/1,Vlt=1e3/Blt,Glt=8.6,jlt=.4;function Hlt(){const t=new Fi,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(M.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(M.UV0,"vec2"),e.uniforms.add(new vt("coverageTex",s=>s.coverageTexture)),r.add(T`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new vt("tex",s=>s.blurColorTexture),new vt("origin",s=>s.highlightColorTexture),new yi("uColor",s=>s.color),new yi("haloColor",s=>s.haloColor),new yi("opacities",s=>Br(Wlt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),i.constants.add("outlineSize","float",Glt),i.constants.add("blurSize","float",jlt),n.add(T`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Wlt=gi(),qlt=Object.freeze(Object.defineProperty({__proto__:null,build:Hlt},Symbol.toStringTag,{value:"Module"}));let zxe=class Bxe extends qi{initializeProgram(e){return new Gi(e.rctx,Bxe.shader.get().build(),Ni)}initializePipeline(){return Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni})}};zxe.shader=new Vi(qlt,()=>Oe(()=>import("./HighlightApply.glsl-80d1425d.js"),[],import.meta.url));let Vxe=class extends wr{constructor(){super(...arguments),this.blurSize=it()}};function Zlt(){const t=new Fi,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(M.POSITION,"vec2"),t.attributes.add(M.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new vt("coverageTex",s=>s.coverageTexture)),i.uniforms.add(new _q("blurSize",s=>s.blurSize)),r.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new $h("tex",s=>s.blurInputTexture)),n.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const Xlt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:Vxe,build:Zlt},Symbol.toStringTag,{value:"Module"}));let Gxe=class jxe extends qi{initializeProgram(e){return new Gi(e.rctx,jxe.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:ni})}};Gxe.shader=new Vi(Xlt,()=>Oe(()=>import("./HighlightBlur.glsl-47de5b2c.js"),[],import.meta.url));let Hxe=class extends wr{constructor(){super(...arguments),this.invFramebufferDim=it()}};function Ylt(){const t=new Fi,{vertex:e,fragment:i}=t,r=e.code,n=i.code;return t.attributes.add(M.POSITION,"vec2"),r.add(T`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new $h("tex",s=>s.inputTexture)),i.uniforms.add(new _q("invFramebufferDim",s=>s.invFramebufferDim)),n.add(T`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const Jlt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:Hxe,build:Ylt},Symbol.toStringTag,{value:"Module"}));let Wxe=class qxe extends qi{initializeProgram(e){return new Gi(e.rctx,qxe.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:ni})}};Wxe.shader=new Vi(Jlt,()=>Oe(()=>import("./HighlightDownsample.glsl-1a56b722.js"),[],import.meta.url));let cse=class extends wr{constructor(){super(...arguments),this.color=Qf(1,0,1,1),this.haloColor=Qf(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=Kt(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const Klt=32;let Qlt=class{constructor(e,i){this._techniqueRep=e,this._rctx=i,this._viewportToRestore=gi(),this._passParameters=new cse,this._downsampleDrawParameters=new Hxe,this._blurDrawParameters=new Vxe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=Fl(this._rctx);const e=new Di;e.wrapMode=Jt.CLAMP_TO_EDGE,this._blur0Fbo=new Rs(this._rctx,e),this._blur1Fbo=new Rs(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(Gxe),this._downsampleTechnique=this._techniqueRep.acquire(Wxe),this._applyTechnique=this._techniqueRep.acquire(zxe)}dispose(){if(this._blurTechnique=nn(this._blurTechnique),this._downsampleTechnique=nn(this._downsampleTechnique),this._applyTechnique=nn(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=et(this._blur0Fbo),this._blur1Fbo=et(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new cse,...e}}render(e,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const n=e.camera;Ah(this._viewportToRestore,n.fullViewport);const s=n.fullWidth,o=n.fullHeight,a=n.pixelRatio,l=Math.ceil(s/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const u=this._rctx;u.bindVAO(this._quadVAO);let p=null;this._gridUpdateResources(i,Klt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const f=u.bindTechnique(this._blurTechnique,this._passParameters,e);u.bindVAO(p),u.bindFramebuffer(this._blur0Fbo),u.setViewport(0,0,l,c),u.setClearColor(0,0,0,0),u.clear(Vr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,bi(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,Jo(p,"geometry")),u.bindFramebuffer(this._blur1Fbo),u.clear(Vr.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,bi(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,Jo(p,"geometry")),u.bindFramebuffer(r),u.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,u.bindTechnique(this._applyTechnique,this._passParameters,e),u.drawArrays(this._applyTechnique.primitiveType,0,Jo(p,"geometry")),u.bindVAO(null)}_gridUpdateResources(e,i){const r=this._rctx,n=this._grid;let s=!1;if(n.coverageMipmap===null&&(n.coverageMipmap=[e],s=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(s=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==i&&(n.cellPixelSize=i,s=!0),s){for(let l=1;l<n.coverageMipmap.length;l++)n.coverageMipmap[l].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(let l=0;l<n.mipmapLevels;l++){const c=n.coverageMipmap[l],u=new Di(Math.ceil(c.width/2),Math.ceil(c.height/2));u.pixelFormat=Gt.RGB,u.dataType=ss.UNSIGNED_SHORT_5_6_5,u.wrapMode=Jt.CLAMP_TO_EDGE,n.coverageMipmap[l+1]=new Rs(r,u)}}const o=Math.ceil(e.height/n.cellPixelSize),a=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==o||n.horizontalCellCount!==a){n.verticalCellCount=o,n.horizontalCellCount=a;const l=o+1,c=a+1,u=1/o,p=1/a,f=6,y=4,v=new Float32Array(f*y*l*c);let b=0;for(let x=0;x<l;x++)for(let S=0;S<c;S++)v[b]=(S-.5)*p*2-1,v[b+1]=(x-.5)*u*2-1,v[b+2]=S*p,v[b+3]=x*u,v[b+4]=(S+.5)*p*2-1,v[b+5]=(x-.5)*u*2-1,v[b+6]=S*p,v[b+7]=x*u,v[b+8]=(S-.5)*p*2-1,v[b+9]=(x+.5)*u*2-1,v[b+10]=S*p,v[b+11]=x*u,v[b+12]=(S-.5)*p*2-1,v[b+13]=(x+.5)*u*2-1,v[b+14]=S*p,v[b+15]=x*u,v[b+16]=(S+.5)*p*2-1,v[b+17]=(x-.5)*u*2-1,v[b+18]=S*p,v[b+19]=x*u,v[b+20]=(S+.5)*p*2-1,v[b+21]=(x+.5)*u*2-1,v[b+22]=S*p,v[b+23]=x*u,b+=f*y;n.vao&&n.vao.dispose(),n.vao=new vp(r,Ni,{geometry:H3},{geometry:Ki.createVertex(r,zi.STATIC_DRAW,v)})}}_gridComputeMipmap(e){const i=this._rctx,r=this._grid,n=i.bindTechnique(this._downsampleTechnique,this._passParameters,e);i.bindVAO(this._quadVAO);for(let s=0;s<r.mipmapLevels;s++){i.bindFramebuffer(r.coverageMipmap[s+1]);const o=r.coverageMipmap[s+1].width,a=r.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[s].colorTexture,bi(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),n.bindDraw(this._downsampleDrawParameters,e,this._passParameters),i.setViewport(0,0,o,a),i.drawArrays(Ht.TRIANGLE_STRIP,0,Jo(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)e+=i.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const ect={dataType:ss.UNSIGNED_BYTE,internalFormat:Gt.RGBA},tct={};let ict=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const i=e.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(e,i){const r=e.get(i);r&&(this._fbos.forEach((n,s)=>{n.colorTexture!==r&&n.depthStencilAttachment!==r||(n.detachColorTexture(),n.detachDepthStencilTexture(),n.dispose(),this._fbos.delete(s))}),r.dispose(),e.delete(i))}_getDepthTexture(e,i,r){let n=this._depthTextures.get(e.id);if(!n||n.descriptor.width===i&&n.descriptor.height===r||(n.dispose(),n=null),!n){const s=new Di(i,r);s.pixelFormat=Gt.DEPTH_STENCIL,s.dataType=ss.UNSIGNED_INT_24_8,s.samplingMode=qt.NEAREST,s.wrapMode=Jt.CLAMP_TO_EDGE,n=new Wt(this._rctx,s),this._depthTextures.set(e.id,n),this._activeTargets.add(e.id)}return n}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,i,r){let n=this._colorTextures.get(e.id);if(n&&(n.descriptor.width===i&&n.descriptor.height===r||(n.dispose(),n=eS())),!n){const s=new Di(i,r);s.internalFormat=e.internalFormat,s.dataType=e.dataType,s.samplingMode=e.samplingMode!=null?e.samplingMode:qt.LINEAR,s.wrapMode=Jt.CLAMP_TO_EDGE,n=new Wt(this._rctx,s),this._colorTextures.set(e.id,n),this._activeTargets.add(e.id)}return n}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:xc(),...tct,...e}}registerColorTarget(e={}){return{id:xc(),...ect,...e}}getFramebuffer(e,i,r,n){const s=this._getKey(r,n);let o=this._fbos.get(s);const a=this.getColorTexture(r,e,i),l=n?this._getDepthTexture(n,e,i):void 0;return o?((o.width!==e||o.height!==i||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,i),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new Rs(this._rctx,a,l),this._fbos.set(s,o),o)}_getKey(e,i){return`${e.id}_${i?i.id:"X"}_${e.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let e=0;const i=new Set,r=n=>{i.has(n)||(i.add(n),e+=n.gpuMemoryUsage)};return this._colorTextures.forEach(r),this._depthTextures.forEach(r),e}},rct=class{constructor(e,i){this._rctx=e,this._compositingHelper=i,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new ict(e);const r=this._renderTargetHelper;this._mainColorTargets=[r.registerColorTarget({name:"mainColorTarget0"}),r.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=r.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=r.registerColorTarget({name:"colorFloatTarget",dataType:ss.HALF_FLOAT,internalFormat:mt.RGBA16F,samplingMode:qt.NEAREST}),this.alphaFloatTarget=r.registerColorTarget({name:"alphaFloatTarget",dataType:ss.HALF_FLOAT,internalFormat:mt.R16F,samplingMode:qt.NEAREST}),this.mainDepth=r.registerDepthTarget({name:"mainDepth"}),this.linearDepth=r.registerColorTarget({name:"linearDepth",samplingMode:qt.NEAREST}),this.terrainLinearDepth=r.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=r.registerColorTarget({name:"geometryLinearDepth"}),this.normal=r.registerColorTarget({name:"normal"}),this.highlight=r.registerColorTarget({name:"highlight",internalFormat:mt.RGBA4,dataType:ss.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=r.registerColorTarget({name:"hudVisibility",internalFormat:mt.RGBA4,dataType:ss.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=r.registerColorTarget({name:"tmpColor"}),this.tmpDepth=r.registerDepthTarget({name:"tmpDepth"}),this.hudColor=r.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,i){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const i=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,I1(this,i.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT|Vr.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,wa.None)}renderTmpAndCompositeToMain(e,i,r,n=!1){this.renderToTargets(e,this.tmpColor,n?this.tmpDepth:this.mainDepth,nct),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}compositeAtmosphereToMain(e,i,r,n){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),r,n,i),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,i=!1){this.renderToTargets(e,this.hudVisibility,i?this.tmpDepth:this.mainDepth,sct)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,i,r){let n,s;switch(i){case At.Color:n=this.colorFloatTarget,s=[0,0,0,0];break;case At.Alpha:n=this.alphaFloatTarget,s=[1,1,1,1];break;case At.FrontFace:n=this.frontFaceTarget,s=[0,0,0,0];break;case At.NONE:case At.COUNT:return}r?this.renderToTargets(e,n,this.tmpDepth,s,!0,!0):this.renderToTargets(e,n,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),wa.PremultipliedAlpha)}compositeOccludedOntoMain(e,i){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),wa.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(e,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Vr.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,i,r=!1,n=!1){const s=this._rctx;let o=0;if(i){const l=Math.max(1e-13,i[3]);s.setClearColor(i[0],i[1],i[2],l),o|=Vr.COLOR_BUFFER_BIT}r&&(o|=Vr.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=Vr.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,i,r,n,s=!1,o=!1){const a=this.bindTarget(i,r);return this.renderToFBO(e,n,s,o),a}bindTarget(e,i){const r=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const nct=[0,0,0,0],sct=[0,1,0,1];let mA=class extends ke{constructor(e){super({}),this._context=e,this._renderPlugins=new ri,this._slots=[];for(let i=0;i<Te.MAX_SLOTS;++i)this._slots[i]=[]}normalizeCtorArgs(){return{}}add(e,i,r){const n=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),Qi();this._renderPlugins.push(i);for(const o of e)this._slots[o].push(i);this._context.requestRender()},s=i.initializeRenderContext(this._context,r);if(Pu(s))return s.then(n);n(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let i=0;i<this._slots.length;++i)this._slots[i]=this._slots[i].filter(r=>r!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(e)||i)}),i}prepareSlots(e){for(const i of e)this._context.renderContext.bindParameters.slot=i,this._slots[i].filter(r=>{r.canRender&&(use(r)&&r.prepareTechnique(this._context.renderContext),hse(r)&&r.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],i=new Array;e.filter(r=>{if(!r.canRender)return!1;if(use(r)){const n=r.prepareTechnique(this._context.renderContext);return n!=null&&(i.push(n),!0)}if(hse(r)){const n=r.prepareTechniques(this._context.renderContext);return n!=null&&(i.push(n),!0)}return i.push(null),!0}).forEach((r,n)=>r.render(this._context.renderContext,i[n]))}queryDepthRange(e){const i=oct;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const n=r.queryDepthRange(e);n&&QT(i,n,i)}}),i}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[Te.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,i)=>e|i.renderOccludedFlags,Kr.None)}};function use(t){return"prepareTechnique"in t}function hse(t){return"prepareTechniques"in t}d([m()],mA.prototype,"_renderPlugins",void 0),d([m({readOnly:!0})],mA.prototype,"updating",null),mA=d([J("esri.views.3d.webgl-engine.lib.RenderPluginManager")],mA);const oct={near:0,far:0};let Zxe=class extends fq{};const nF=255,act=1/nF;function lct(t){const e=new Fi,i=e.fragment;return i.include(Ac),i.include(Eu),e.include(B4),e.include(Yh),e.include(z4,t),i.uniforms.add(new vt("depthMap",r=>r.linearDepthTexture),new en("inverseViewMatrix",(r,n)=>fo(dse,Dl(dse,n.camera.viewMatrix,n.camera.center))),new Bi("nearFar",(r,n)=>n.camera.nearFar)),i.constants.add("sampleValue","float",act),i.code.add(T`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const dse=Ne(),cct=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:Zxe,ShadowCastMaxSamples:nF,build:lct},Symbol.toStringTag,{value:"Module"}));var Db;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(Db||(Db={}));let VV=class extends Oa{constructor(){super(...arguments),this.visualization=Db.Gradient,this.bandsEnabled=!1}};d([q({count:Db.COUNT})],VV.prototype,"visualization",void 0),d([q()],VV.prototype,"bandsEnabled",void 0);let Xxe=class extends wr{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=G3(uct),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const uct=Kt(.01,0,.25,1);function hct(t){const e=new Fi,i=e.fragment;i.include(Ac),i.include(Eu),e.include(B4),e.include(Yh);const{visualization:r,bandsEnabled:n}=t;i.constants.add("inverseSampleValue","float",nF),i.uniforms.add(new vt("shadowCastMap",a=>a.shadowCastMap),new je("sampleScale",a=>a.sampleScale),new je("opacityFromElevation",a=>a.opacityFromElevation),new yi("uColor",a=>a.color));const s=r===Db.Gradient,o=r===Db.Threshold;return s&&n?i.uniforms.add(new je("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new je("threshold",a=>a.threshold)),i.code.add(T`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?T`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?T`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?T`* strength`:""});
      }
    `),e}const dct=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:Xxe,build:hct},Symbol.toStringTag,{value:"Module"}));let Yxe=class Jxe extends qi{constructor(e,i){super(e,i,()=>this.destroy())}initializeProgram(e){return new Gi(e.rctx,Jxe.shader.get().build(this.configuration),Ni)}initializePipeline(){return Zt({blending:vu,colorWrite:ni,depthTest:null,depthWrite:null})}get primitiveType(){return Ht.TRIANGLE_STRIP}};Yxe.shader=new Vi(dct,()=>Oe(()=>import("./ShadowCastVisualize.glsl-568d1219.js"),[],import.meta.url));const pct=4e4,fct=5e4,Kxe=1/512;let pL=class extends ke{constructor(e,i,r,n){super({}),this._techniqueRepository=e,this._rctx=i,this._data=r,this._requestRender=n,this._passParameters=new Xxe(this._data),this._techniqueConfig=new VV,this._enabled=!1,this._vao=Fl(i),this._techniqueConfig.visualization=Db.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=et(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(Yxe,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const i=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(i,this._passParameters,e),this._rctx.drawArrays(i.primitiveType,0,Jo(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>Kxe}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const i=this._passParameters.color;k2(e,i)||(Ah(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([m()],pL.prototype,"opacityFromElevation",null),pL=d([J("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],pL);let hZ=class extends Oa{constructor(){super(...arguments),this.receiveShadows=!0}};d([q()],hZ.prototype,"receiveShadows",void 0);let Qxe=class e2e extends qi{constructor(e){super(e,new hZ,()=>this.destroy())}initializeProgram(e){return new Gi(e.rctx,e2e.shader.get().build(this.configuration),Ni)}initializePipeline(){return Zt({blending:Fo(De.ONE,De.ONE,De.ONE,De.ONE),colorWrite:ni,depthTest:null,depthWrite:null})}get primitiveType(){return Ht.TRIANGLE_STRIP}};Qxe.shader=new Vi(cct,()=>Oe(()=>import("./ShadowCastAccumulate.glsl-186b9ea4.js"),[],import.meta.url));let xl=class extends ke{constructor(e,i,r,n,s,o){super({}),this._rctx=e,this._stage=r,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new Zxe,this._cachedLightDirections=[],this._depthRange=LV,this._previewing=!1,this._handles=new an,this._cameraForcedForScreenshot=!1,this._bindParameters=new i4(new dq(e,r.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=Fl(e),this._accumulationRenderer=new pL(i,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(Dt.SHADOW_ACCUMULATOR,this),Pe(()=>r.renderView,l=>{this._handles.remove(pse),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),pse)},qn),Pe(()=>this._previewing,()=>this._requestRenderIfEnabled(),gr)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=et(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=et(this._fbo),this._vao=et(this._vao),this._accumulationTechniqueCached=nn(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new Qxe(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==LV&&this._opacityFromElevation>Kxe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const i=this._cachedLightDirections;if(Ag(i,e,ny))return;const r=Math.min(nF,e.length);i.length=r,this._sampleCount=r;for(let n=0;n<r;++n)i[n]=fe(i[n]??I(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,i,r,n){if(this._depthRange=i,this._updateCamera(r),this._bindParameters.contentCamera=n,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(mct,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const i=this._fbo!=null;e.enabled!==i&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,i){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||i<0||i>=this._fbo.height?0:(this._fbo.readPixels(e,i,1,1,Gt.RGBA,ss.UNSIGNED_BYTE,fse),fse[0]/this._progress)}_enable(){this._progress=0;const e=new Di;e.wrapMode=Jt.CLAMP_TO_EDGE,this._fbo=new Rs(this._rctx,e)}_disable(){this._fbo=et(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Vr.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,Jo(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*gct%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-wP(pct,fct,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};d([m()],xl.prototype,"_progress",void 0),d([m()],xl.prototype,"_sampleCount",void 0),d([m()],xl.prototype,"_fbo",void 0),d([m()],xl.prototype,"_depthRange",void 0),d([m()],xl.prototype,"_previewing",void 0),d([m()],xl.prototype,"_accumulationRenderer",void 0),d([m()],xl.prototype,"_isRefining",null),d([m()],xl.prototype,"_isActive",null),d([m()],xl.prototype,"canAccumulate",null),d([m()],xl.prototype,"_isDoneAccumulating",null),d([m()],xl.prototype,"_opacityFromElevation",null),d([m()],xl.prototype,"running",null),xl=d([J("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],xl);const mct=6,pse="renderView",gct=104729,fse=new Uint8Array(4),mse={highlightedThreshold:.99999,selfShadowThreshold:.025};function _ct(t){const e=new Fi;e.include(Rb,t);const i=e.fragment;return i.include(Ac),i.include(Eu),e.include(B4),e.include(Yh),i.uniforms.add(new vt("defaultDepthTex",(r,n)=>n.shadowMap.getSnapshot(ZT.Default)),new vt("highlightDepthTex",(r,n)=>n.shadowMap.getSnapshot(ZT.Highlight)),new vt("depthMap",(r,n)=>n.linearDepthTexture),new vt("highlightMap",(r,n)=>n.highlightColorTexture),new yi("uColor",r=>r.shadowColor),new Bi("nearFar",(r,n)=>n.camera.nearFar),new je("opacity",r=>r.shadowOpacity),new je("occludedOpacity",r=>r.occludedShadowOpacity),new je("terminationFactor",r=>r.opacityElevation*r.dayNightTerminator),new ei("lightingMainDirectionView",(r,n)=>Me(_se,st(_se,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new Bi("texelSize",(r,n)=>n.linearDepthTexture!=null?bi(yct,1/n.linearDepthTexture.descriptor.width,1/n.linearDepthTexture.descriptor.height):fp),new en("inverseViewMatrix",(r,n)=>fo(gse,Dl(gse,n.camera.viewMatrix,n.camera.center)))),i.constants.add("unoccludedHighlightFlag","vec4",C_e).add("highlightedThreshold","float",mse.highlightedThreshold).add("selfShadowThreshold","float",mse.selfShadowThreshold),i.code.add(T`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),i.code.add(T`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const gse=Ne(),_se=I(),yct=it(),vct=Object.freeze(Object.defineProperty({__proto__:null,build:_ct},Symbol.toStringTag,{value:"Module"}));let bct=class extends fq{constructor(){super(...arguments),this.shadowColor=Kt(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},t2e=class i2e extends qi{constructor(e){super(e,new hZ,()=>this.destroy())}initializeProgram(e){return new Gi(e.rctx,i2e.shader.get().build(this.configuration),Ni)}initializePipeline(){return Zt({blending:Fo(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:ni,depthTest:null,depthWrite:null})}get primitiveType(){return Ht.TRIANGLE_STRIP}};t2e.shader=new Vi(vct,()=>Oe(()=>import("./ShadowHighlight.glsl-b58406e2.js"),[],import.meta.url));const wct=.001953125,xct=4e4,Tct=5e4;let Sct=class{constructor(e,i){this._rctx=e,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new bct,this._drawParameters=new Wqe,this._vao=Fl(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new t2e({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,i){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const r=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,Jo(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.memoryEstimate)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,i){this._passParameters.opacityElevation=1-wP(xct,Tct,e.relativeElevation);const r=this._viewingMode===Ke.Global?Me(yse,e.center):me(yse,0,0,1),n=Re(r,i);this._passParameters.dayNightTerminator=wP(0,1,$e(30*n,0,1))}dispose(){this._vao=et(this._vao),this._techniqueCached=nn(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*e*i>=wct}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const yse=I(),vse=Gg();let Cct=class{constructor(){this._plane=Gg()}get isEnabled(){return!gpe(this.plane,vse)}get plane(){return this._plane}set plane(e){qb(e||vse,this._plane)}},Ect=class extends wr{};function m3(t){t.uniforms.add(new yi("resolution",e=>{const{descriptor:i}=e.colorTexture,r=i.width,n=i.height;return Br(Act,1/r,1/n,r,n)}))}const Act=gi(),Ex={maxSearchSteps:8,maxDistanceAreaTex:16};function Pct(){const t=new Fi,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(M.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),i.add("maxOffset","vec4"),i.add("pixelCoord","vec2"),m3(r),r.code.add(T`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(Ex.maxSearchSteps)} );
      }
    `),n.uniforms.add(new vt("edgesTexture",s=>s.edges.colorTexture)),n.uniforms.add(new vt("areaTexture",s=>s.areaTexture)),n.uniforms.add(new vt("searchTexture",s=>s.searchTexture)),m3(n),n.code.add(T`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(Ex.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(Ex.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(Ex.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(Ex.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${T.int(Ex.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const Oct=Object.freeze(Object.defineProperty({__proto__:null,build:Pct},Symbol.toStringTag,{value:"Module"}));let r2e=class n2e extends qi{initializeProgram(e){return new Gi(e.rctx,n2e.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:ni})}};r2e.shader=new Vi(Oct,()=>Oe(()=>import("./BlendWeights.glsl-28a1e5e1.js"),[],import.meta.url));function Rct(){const t=new Fi,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(M.POSITION,"vec2"),i.add("uv","vec2"),i.add("offsets[2]","vec4"),m3(r),r.code.add(T`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),n.uniforms.add(new vt("blendWeightsTexture",s=>s.blend.colorTexture),new vt("colorTexture",s=>s.colorTexture)),m3(n),n.code.add(T`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const Mct=Object.freeze(Object.defineProperty({__proto__:null,build:Rct},Symbol.toStringTag,{value:"Module"}));let s2e=class o2e extends qi{initializeProgram(e){return new Gi(e.rctx,o2e.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:ni})}};s2e.shader=new Vi(Mct,()=>Oe(()=>import("./Blur.glsl-0bd05c64.js"),[],import.meta.url));const bse={threshold:.05,localConstrastAdaption:2};function $ct(){const t=new Fi,{attributes:e,varyings:i,vertex:r,fragment:n}=t;return e.add(M.POSITION,"vec2"),m3(r),i.add("uv","vec2"),i.add("offsets[3]","vec4"),r.code.add(T`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),n.uniforms.add(new vt("colorTexture",s=>s.colorTexture)),n.code.add(T`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${T.float(bse.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${T.float(bse.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const Ict=Object.freeze(Object.defineProperty({__proto__:null,build:$ct},Symbol.toStringTag,{value:"Module"}));let a2e=class l2e extends qi{initializeProgram(e){return new Gi(e.rctx,l2e.shader.get().build(),Ni)}initializePipeline(){return Zt({colorWrite:ni})}};a2e.shader=new Vi(Ict,()=>Oe(()=>import("./EdgeDetect.glsl-b9551cb8.js"),[],import.meta.url));let gA=class extends ke{constructor(e,i){super({}),this._rctx=e,this._techniqueRep=i,this._passParameters=new Ect,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=wu(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const i=this._abortController.signal;return Oe(()=>import("./SmaaRenderPassData-660b7d34.js"),[],import.meta.url).then(r=>this._loadTextures(r,i)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,i){return Ti(i),Promise.all([this._loadTextureFromBase64(e.areaTexture,qt.LINEAR,Gt.RGB),this._loadTextureFromBase64(e.searchTexure,qt.NEAREST,Gt.LUMINANCE)]).then(([r,n])=>{Gs(i)?(r.dispose(),n.dispose(),Ti(i)):(this._passParameters.areaTexture=r,this._passParameters.searchTexture=n)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const n=new Oa;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(a2e,n,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(r2e,n,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(s2e,n,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=w6e(this._rctx);const i=new Di(4,4);i.pixelFormat=Gt.RG,i.internalFormat=mt.RG8,i.wrapMode=Jt.CLAMP_TO_EDGE,this._passParameters.edges=new Rs(this._rctx,i);const r=new Di(4,4);return r.pixelFormat=Gt.RGBA,r.wrapMode=Jt.CLAMP_TO_EDGE,this._passParameters.blend=new Rs(this._rctx,r),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=et(this._vao),this._passParameters.areaTexture=et(this._passParameters.areaTexture),this._passParameters.searchTexture=et(this._passParameters.searchTexture),this._passParameters.blend=et(this._passParameters.blend),this._passParameters.edges=et(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const i=this._validPassParameters;if(i==null)return;i.colorTexture=e;const r=this._rctx,n=r.getBoundFramebufferObject(),s=e.descriptor.width,o=e.descriptor.height;r.bindVAO(this._vao),r.setViewport(0,0,s,o),i.edges.resize(s,o),r.bindFramebuffer(i.edges),r.setClearColor(0,0,0,1),r.clear(Vr.COLOR_BUFFER_BIT),r.bindTechnique(this._edgeDetectTechnique,i,null),r.drawArrays(Ht.TRIANGLES,0,3),i.blend.resize(s,o),r.bindFramebuffer(i.blend),r.setClearColor(0,0,1,1),r.clear(Vr.COLOR_BUFFER_BIT),r.bindTechnique(this._blendWeightsTechnique,i,null),r.drawArrays(Ht.TRIANGLES,0,3),r.bindFramebuffer(n),r.setClearColor(0,1,0,1),r.clear(Vr.COLOR_BUFFER_BIT),r.bindTechnique(this._blurTechnique,i,null),r.drawArrays(Ht.TRIANGLES,0,3)}_loadTextureFromBase64(e,i,r){return kg(e).then(n=>{const s=new Di;return s.pixelFormat=r,s.wrapMode=Jt.CLAMP_TO_EDGE,s.width=n.width,s.height=n.height,s.samplingMode=i,new Wt(this._rctx,s,n)})}};d([m()],gA.prototype,"_abortController",void 0),d([m({readOnly:!0})],gA.prototype,"updating",null),gA=d([J("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],gA);function Lct(t,e){const i=-t[0],r=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*i,e[1]+=s*r,e[2]+=s*n,e[4]+=o*i,e[5]+=o*r,e[6]+=o*n,e[8]+=a*i,e[9]+=a*r,e[10]+=a*n,e[12]+=l*i,e[13]+=l*r,e[14]+=l*n}function Dct(t,e){const i=t[0],r=t[1],n=t[2];e[12]+=i*e[0]+r*e[4]+n*e[8],e[13]+=i*e[1]+r*e[5]+n*e[9],e[14]+=i*e[2]+r*e[6]+n*e[10],e[14]+=i*e[3]+r*e[7]+n*e[11]}let Nct=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const i=this._originData.get(e.id)||new Fct(e);return i.refCount++,this._originData.has(i.origin.id)||this._originData.set(i.origin.id,i),i}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(i=>{Qn(i.viewMatrix,e),Dct(i.origin.vec3,i.viewMatrix)})}},Fct=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=Ne()}},kct=class extends Ume{constructor(e,i){super(),this.distanceFalloffFactor=e,this.transparency=i,this.transformNormalViewFromGlobal=on()}},Uct=class extends zme{constructor(){super(...arguments),this.transformNormalViewFromGlobal=on(),this.slicePlaneLocalOrigin=I(),this.transformNormalGlobalFromModel=on()}};function zct(t){const e=T`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const Bct=Ri(.5,-4e-4);function Vct(t,e){const i=t.vertex;i.include(zct),i.constants.add("depthBias","vec2",Bct),i.uniforms.add(new Bi("inverseViewport",(r,n)=>n.inverseViewport)),e.legacy?(i.uniforms.add(new en("proj",(r,n)=>n.camera.projectionMatrix)),i.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new Jh("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal),new en("transformProjFromView",r=>r.transformProjFromView)),i.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(T`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function Gct(t,e){const i=t.fragment;i.constants.add("coverageTestThreshold","float",.01),e.antialiasing?i.code.add(T`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(T`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function jct(t,e){const i=t.vertex;e.silhouette?(i.code.add(T`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function Hct(t,e){const i=t.vertex;i.include(Ac),i.uniforms.add(new je("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new $h("componentDataTex",r=>r.componentDataTexture)),t.attributes.add(M.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("verticalOffsetScale","float",2*aZ),i.code.add(T`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new jP("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(M.NORMALA,"vec3"),t.attributes.add(M.NORMALB,"vec3"),i.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(M.NORMAL,"vec3"),i.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?i.code.add(T`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(AD,e),i.include(AD,e),i.uniforms.add(new Jh("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new jP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new yu("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new yu("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new ei("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new ei("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)),i.code.add(T`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?T`normalize(transformWorldFromModelTL + rotatedModelPosition);`:T`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new en("transformProjFromView",(r,n)=>n.camera.projectionMatrix)),i.code.add(T`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function Wct(t){return t.mode===As.SKETCH||t.mode===As.MIXED}var As,E1;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(As||(As={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(E1||(E1={}));function dZ(t,e){const i=t.vertex;switch(t.attributes.add(M.SIDENESS,"vec2"),e.mode===As.MIXED?i.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case As.MIXED:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case As.SKETCH:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case As.SOLID:i.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case As.COUNT:break;default:e.mode}}function qct(t,e){const i=t.vertex;switch(t.include(dZ,e),e.mode){case As.SOLID:i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case As.SKETCH:i.uniforms.add(new Z1("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case As.MIXED:i.uniforms.add(new Z1("strokesAmplitude",r=>r.strokesTexture.amplitude)),i.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function Zct(t,e){t.include(dZ,e);const{vertex:i,fragment:r}=t;switch(Wct(e)&&(i.uniforms.add(new $h("strokesTexture",n=>n.strokesTexture.texture)),i.uniforms.add(new Z1("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new Z1("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new $h("strokesTexture",n=>n.strokesTexture.texture),new Z1("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),i.code.add(T`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Ac),r.code.add(T`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case As.SOLID:i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(T`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case As.SKETCH:i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(T`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case As.MIXED:t.varyings.add("vType","float"),i.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(T`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function Xct(t){const e=new Fi,{vertex:i,fragment:r}=e;return t.legacy&&i.uniforms.add(new wse("model"),new wse("localView")),e.include(Vct,t),e.include(Hct,t),e.include(qct,t),e.include(dZ,t),e.include(Zct,t),e.include(Nn,t),e.include(jct,t),e.include(Gct,t),e.include(Au,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new Bi("pixelToNDC",(n,s)=>bi(Yct,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new yi("viewport",(n,s)=>s.camera.fullViewport),new je("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(M.POSITION0,"vec3"),e.attributes.add(M.POSITION1,"vec3"),e.attributes.add(M.VARIANTOFFSET,"float"),e.attributes.add(M.VARIANTSTROKE,"float"),e.attributes.add(M.VARIANTEXTENSION,"float"),i.code.add(T`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?T`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:T`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===As.SKETCH?T`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===As.MIXED?T`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),r.code.add(T`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const Yct=it();let wse=class extends On{constructor(e){super(e,"mat4")}};const Jct=Object.freeze(Object.defineProperty({__proto__:null,build:Xct},Symbol.toStringTag,{value:"Module"}));let c2e=class u2e extends qi{initializeProgram(e){return new Gi(e.rctx,u2e.shader.get().build(this.configuration),bxe)}initializePipeline(e){return e.blendMinMax?Zt({blending:Fo(De.ONE,De.ONE,De.ZERO,De.ONE,Zf.ADD,e.blendMinMax.MAX),depthTest:{func:br.LEQUAL},colorWrite:ni}):Zt({depthTest:{func:br.LEQUAL},depthWrite:Nl,colorWrite:ni})}};c2e.shader=new Vi(Jct,()=>Oe(()=>import("./EdgeShader.glsl-ae567e81.js"),[],import.meta.url));let df=class extends Ko{constructor(){super(...arguments),this.mode=As.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};d([q({count:As.COUNT})],df.prototype,"mode",void 0),d([q()],df.prototype,"hasSlicePlane",void 0),d([q()],df.prototype,"silhouette",void 0),d([q()],df.prototype,"legacy",void 0),d([q()],df.prototype,"antialiasing",void 0),d([q()],df.prototype,"doublePrecisionRequiresObfuscation",void 0),d([q()],df.prototype,"hasMultipassTerrain",void 0),d([q()],df.prototype,"cullAboveGround",void 0),d([q()],df.prototype,"spherical",void 0);const Kct=8,jU=128,Qct={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},eut={solid:As.SOLID,sketch:As.SKETCH,uber:As.MIXED};let HU=class h2e{constructor(e,i,r){this._rctx=e,this._shaderTechniqueRepository=i,this._configuration=new df,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[oi.TRANSPARENT]:{[oi.TRANSPARENT]:new ri,[oi.OPAQUE]:new ri},[oi.OPAQUE]:{[oi.TRANSPARENT]:new ri,[oi.OPAQUE]:new ri}},this._renderablesDirty=!1,this._drawParameters=new Uct,this._settings={...Qct,...r},this.key=h2e.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:Or.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=eut[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=r.spherical}dispose(){this._technique=nn(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,i){if(this._renderablesDirty&&this._sortRenderables(),i!==oi.INVISIBLE){const r=this._sortedRenderables[i];r[oi.TRANSPARENT].forAll(e),r[oi.OPAQUE].forAll(e)}}updateTechnique(e,i){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(c2e,this._configuration,this._technique),this._technique}bindRegularEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!1),e,i)}bindSilhouetteEdges(e,i){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(i,!0),e,i)}renderRegularEdges(e,i,r,n,s){this._render(e,i,i.regular.vao,r,n,s)}renderSilhouetteEdges(e,i,r,n,s){this._render(e,i,i.silhouette.vao,r,n,s)}_render(e,i,r,n,s,o){o>0&&(this._bindDraw(e,i,n,s),this._rctx.bindVAO(r),this._rctx.capabilities.instancing.drawArraysInstanced(Ht.TRIANGLE_FAN,0,4,o))}_bindDraw(e,i,r,n){if(this._drawParameters.componentDataTexture=i.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in i.transform)this._lastOriginId!==i.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",i.transform.origin.viewMatrix),this._lastOriginId=i.transform.origin.origin.id),e.setUniformMatrix4fv("model",i.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=i.transform.origin.origin.vec3;else{const s=new rF(i.transform.position),o=Hh(xse,Xb(xse,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;me(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,r)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[oi.TRANSPARENT][oi.TRANSPARENT].clear(),this._sortedRenderables[oi.TRANSPARENT][oi.OPAQUE].clear(),this._sortedRenderables[oi.OPAQUE][oi.TRANSPARENT].clear(),this._sortedRenderables[oi.OPAQUE][oi.OPAQUE].clear(),this._renderables.forEach(i=>{i.objectTransparency!==oi.INVISIBLE&&i.edgeTransparency!==oi.INVISIBLE&&this._sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const e=(i,r)=>"origin"in i.transform?"origin"in r.transform?i.transform.origin.origin.id<r.transform.origin.origin.id?-1:i.transform.origin.origin.id>r.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[oi.TRANSPARENT][oi.TRANSPARENT].sort(e),this._sortedRenderables[oi.TRANSPARENT][oi.OPAQUE].sort(e),this._sortedRenderables[oi.OPAQUE][oi.TRANSPARENT].sort(e),this._sortedRenderables[oi.OPAQUE][oi.OPAQUE].sort(e)}static getKey(e,i,r){return`edges-t:${e}:${i}:${r}`}};const xse=Ll();function q3t(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new Kke(t.layout)}}function $$(t){return new ige(t.layout).createView(t.buffer)}let tut=class extends owe{constructor(e){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},e)}async process(e,i,r){if(r)return qat(e);const n=await this.invoke(new WU(e),i);return this._unpackOutput(n)}async extractEdgeLocations(e,i){const r=await this.invokeMethod("extractEdgeLocations",new WU(e),i);return $$(r)}async extractComponentsEdgeLocations(e,i){const r=await this.invokeMethod("extractComponentsEdgeLocations",new WU(e),i);return $$(r)}_unpackOutput(e){return{regular:{instancesData:$$(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:$$(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},WU=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=cp(e.indices)?e.indices:e.indices.buffer,this.indicesType=cp(e.indices)?"Array":XN(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function iut(t){const i=eE.resolution,r=i/2,n=new Uint8Array(4*i*i),s=4*i*r,o=eE.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,u=eE.strokes.length;let p=(c-1)*u*l;for(const{distance:v,pressure:b}of eE.strokes){let x=v,S=b,P=p;for(let C=0;C<c;C++){C!==0&&(x=Tse(x,g3.DISTANCE),S=Tse(S,g3.PRESSURE));for(let R=0;R<eE.resolution;R++){const N=.5+(x?x[R%x.length]/a:0),$=S?S[R%S.length]:1;QP(N,n,P),QP($,n,P+s),P+=4}P-=l*(u+1)}p+=l}const f=new Di;f.width=f.height=i;const y=new Wt(t,f,n);return new nut(i,a,o,u,y)}function Tse(t,e){if(!t)return null;const i=t.length/2,r=rut*i,n=new Array(i);let s=0;const o=e===g3.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(r,1-(1-l)*Sse):Math.min(r,l*Sse)}return n}var g3;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(g3||(g3={}));const rut=.1,Sse=.5;let nut=class{constructor(e,i,r,n,s){this.resolution=e,this.normalizationScale=i,this.amplitude=r,this.variants=n,this.texture=s}dispose(){this.texture=et(this.texture)}};const eE={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function Cse(t){let e=null;for(const i of t){const r=i.type;if(sut(i)){if(e==null)e=r;else if(e!==r)return"uber"}}return e??"uber"}function Ese(t){let e=oi.INVISIBLE;for(const{material:i}of t)if(d2e(i)){if(i.color[3]*i.opacity<1)return oi.TRANSPARENT;e=oi.OPAQUE}return e}function Ase(t){let e=oi.INVISIBLE;for(const{material:i}of t)if(d2e(i)){switch(i.objectTransparency){case oi.TRANSPARENT:case oi.INVISIBLE:return oi.TRANSPARENT;case oi.OPAQUE:if(i.opacity<1)return oi.TRANSPARENT}e=oi.OPAQUE}return e}function d2e(t){return t.size*t.color[3]*t.opacity>0}function sut(t){return t.size*t.color[3]>0}function Pse(t,e,i,r){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,s)}else for(let l=o;l<a;l++)i.set(l,s)}}let Md=class extends ke{constructor(t){super(t),this._updatingHandles=new Lf,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=I(),this._localOrigins=new Nct(new uq(t.renderSR))}initialize(){this._worker=new tut(this.schedule),this._componentColorManager=new Txe(this.rctx,3);const t=yxe.createBuffer(4);for(let e=0;e<4;e++)t.sideness.set(e,0,e===0||e===3?0:1),t.sideness.set(e,1,e===0||e===1?0:1);this._verticesBufferObject=Ki.createVertex(this.rctx,zi.STATIC_DRAW,t.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(t=>this._discardObjectEntry(t)),this._perObjectData.clear(),this._strokesTexture=et(this._strokesTexture),this._componentColorManager=Je(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=et(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",hut))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(t,e,i,r,n,s,o,a){if(this.hasObject(t))return this.getObjectMemoryUsage(t);let l;const c=new Rse(new Promise(p=>l=p),i.center,i.radius);this._perObjectData.set(t,c);const u=await this._updatingHandles.addPromise(this._addComponentGeometry(e,c,r,n,s,o,a));return this.setNeedsRender(),l(),u}async addOrUpdateObject3D(t,e,i,r){if(this.destroyed)return void ye.getLogger(this).warn("Attempt to add an object to a destroyed instance");const n=this._perObjectData.get(t);let s;(n==null?void 0:n.renderables.length)>0&&this._perObjectDataEvictionCache.add(n);const o=t.boundingVolumeWorldSpace.bounds,a=new Rse(new Promise(c=>s=c),o,gg(o));this._perObjectData.set(t,a);const l=new Array;if(i.mergeGeometries&&t.geometries.length>1&&out(t))l.push(this._addObjectMergedGeometries(t,a,e,i,r));else for(let c=0;c<t.geometries.length;c++){const u=t.geometries[c];u.material.supportsEdges&&l.push(this._addGeometry(t,a,u,e[0],i,r))}await this._updatingHandles.addPromise(Promise.all(l)),this._perObjectDataEvictionCache.delete(a),this._discardObjectEntry(n),this.setNeedsRender(),s()}_discardObjectEntry(t){t&&(t.renderables.length&&(t.renderables.forEach(e=>this._removeRenderable(e)),this.setNeedsRender()),t.loaded=null)}hasObject(t){return this._perObjectData.has(t)}async updateAllComponentOpacities(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));if(i==null)return;const r=e instanceof Array?n=>e[n]:()=>e;i.renderables.forEach(n=>{const s=n.components.meta.length;for(let o=0;o<s;o++){const a=r(o),l=n.components.meta[o],c=l.index;l.material.opacity=a,n.components.buffer.textureBuffer.setDataElement(c,1,3,255*a)}this._updateTransparency(n)}),this.setNeedsRender()}async getObjectMemoryUsage(t){const e=await this._getObjectEntry(t);return e!=null?e.renderables.reduce((i,r)=>i+r.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(t,e,i,r){const n=t instanceof e0,s=!!i.hasSlicePlane,o=Cse(e),a=HU.getKey(o,s,n),l=await this._updatingHandles.addPromise(this._getObjectEntry(t));l!=null&&(l.renderables.forEach(c=>{if(a!==c.rendererKey){const u=this._renderers.get(c.rendererKey),p=this._acquireRenderer(o,s,n);u.removeRenderable(c),--u.refCount,c.rendererKey=a,p.addRenderable(c)}for(let u=0;u<e.length;u++)c.components.meta[u].material=e[u];r&&this._updateComponentBuffer(c.components),this._updateTransparency(c)}),this.setNeedsRender())}async updateAllVerticalOffsets(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>{const n=r.components.meta;for(let s=0;s<n.length;s++)r.components.meta[s].verticalOffset=(e==null?void 0:e[s])??0;this._updateComponentBuffer(r.components)}),this.setNeedsRender())}async updateObjectVisibility(t,e){const i=await this._updatingHandles.addPromise(this._getObjectEntry(t));i!=null&&(i.renderables.forEach(r=>r.visible=e),this.setNeedsRender())}removeObject(t){const e=this._perObjectData.get(t);e&&(this._perObjectData.delete(t),this._discardObjectEntry(e))}async _getObjectEntry(t){const e=this._perObjectData.get(t);if(!e)throw new Error("no object");return await e.loaded,e.loaded==null?null:e}render(t,e){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(t.camera.viewMatrix);const i=t.camera.viewInverseTransposeMatrix,r=I(),n=new rF;let s=0,o=0;if(this._renderers.forEach(l=>{if(l.refCount===0)this._renderers.delete(l.key),l.dispose();else{let c=!0,u=!0;l.forEachRenderable(p=>{p.visible&&(s+=p.statistics.averageEdgeLength,o++,c&&p.regular&&(l.updateTechnique(t,!1),c=!1),u&&p.silhouette&&(l.updateTechnique(t,!0),u=!1))},e)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),o===0)return;const a=new kct(40*s/o,e);me(r,i[3],i[7],i[11]),n.set(r),fe(a.transformWorldFromViewTH,n.high),fe(a.transformWorldFromViewTL,n.low),jh(a.transformViewFromCameraRelativeRS,t.camera.viewMatrix),Hh(Lse,a.transformViewFromCameraRelativeRS),Xb(a.transformNormalViewFromGlobal,Lse),a.transformProjFromView=t.camera.projectionMatrix,this._updateObjectCameraDistances(t),this._renderers.forEach(l=>{this._renderRegularEdges(l,t,a),this._renderSilhouetteEdges(l,t,a)})}_updateTransparency(t){const e=Ese(t.components.meta),i=Ase(t.components.meta);e===t.edgeTransparency&&i===t.objectTransparency||(t.edgeTransparency=e,t.objectTransparency=i,this._renderers.get(t.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(t,e,i){t.getCombinedShaderTransformation(e,i);const r=e.localOrigin!=null?this._localOrigins.register(e.localOrigin):this._localOrigins.acquire(me(this._tmpModelPosition,i[12],i[13],i[14]));return e.localOrigin=r.origin,Lct(r.origin.vec3,i),r}_updateComponentBuffer(t){const{meta:e,buffer:i}=t,r=new Uint8Array(4);for(let n=0;n<e.length;n++){const s=e[n].material,o=e[n].index,a=$e(Math.round(s.size*Kct),0,255),l=$e(s.extensionLength,-jU,255-jU)+jU,c=s.type==="solid"?RN.SOLID:RN.SKETCH,u=255*s.opacity,p=s.color,f=255*p[0],y=255*p[1],v=255*p[2],b=255*p[3];i.textureBuffer.setData(o,0,f,y,v,b),i.textureBuffer.setData(o,1,a,l,c,u),fxe(e[n].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(t){if(this._componentColorManager==null)return null;const e=new Array,i=this._componentColorManager.getBuffer(t.length);for(let n=0;n<t.length;n++){const s=t[n],o=i.acquireIndex();e.push({index:o,verticalOffset:0,material:s})}const r=new aut(i,e);return this._updateComponentBuffer(r),r}_extractEdges(t,e,i,r,n,s=n.length){return this._worker.process({data:e,indices:n,indicesLength:s,writerSettings:t,skipDeduplicate:i},this._workerAbort.signal,r)}_createRenderable(t,e,i,r,n){const s=c=>this._verticesBufferObject!=null?new lut(new vp(this.rctx,bxe,{vertices:Nat,instances:c===E1.REGULAR?PN.glLayout:ON.glLayout},{vertices:this._verticesBufferObject,instances:Ki.createVertex(this.rctx,zi.STATIC_DRAW,c===E1.REGULAR?t.regular.instancesData.buffer:t.silhouette.instancesData.buffer)}),c===E1.REGULAR?t.regular.lodInfo:t.silhouette.lodInfo):null,o=t.regular.lodInfo.lengths.length>0?s(E1.REGULAR):null,a=t.silhouette.lodInfo.lengths.length>0?s(E1.SILHOUETTE):null,l=((o==null?void 0:o.vao.memoryEstimate)??0)+((a==null?void 0:a.vao.memoryEstimate)??0);return new uut(o,a,{gpuMemoryUsage:l,externalMemoryUsage:n,averageEdgeLength:t.averageEdgeLength},i,Ese(e.meta),Ase(e.meta),e,r)}async _addGeometry(t,e,i,r,n,s){const o=i.vertexAttributes.get(M.POSITION),a=i.indices.get(M.POSITION),l=Ne(),c=this._computeModelTransformWithLocalOrigin(t,i,l),u=new Ise(o,a,l,c);return this._addPositionData(e,u,i.edgeIndicesLength,r,n,s)}async _addPositionData(t,e,i,r,n,s=!1){if(t.loaded==null)return;const o=this._createComponentBuffers([r]);if(o==null||i<=0)return;const a=this._acquireRenderer(r.type,!!n.hasSlicePlane,!0),{modelTransform:l,origin:c}=e,u=e.indices,p=e.position,f=p.data.length/p.size,y=EN.createBuffer(f);for(let x=0;x<f;x++)y.position.set(x,0,p.data[x*p.size]),y.position.set(x,1,p.data[x*p.size+1]),y.position.set(x,2,p.data[x*p.size+2]);Pse(o.meta,[0,y.componentIndex.count],y.componentIndex);const v=await this._updatingHandles.addPromise(this._extractEdges(a.writerSettings,y,!1,s,u,i));if(t.loaded==null)return;const b=this._createRenderable(v,o,new cut(l,c),a.key,!1);t.renderables.push(b),a.addRenderable(b),this._gpuMemoryUsage+=b.statistics.gpuMemoryUsage}async _addComponentGeometry(t,e,i,r,n,s,o){if(e.loaded==null)return 0;const a=this._createComponentBuffers(s);if(a==null)return 0;const l=Cse(s),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),u=EN.createBuffer(i.length/3);fO(u.position.typedBuffer,i,u.position.typedBufferStride,3),Pse(a.meta,n,u.componentIndex,r);const p=!0,f=c.writerSettings,y=await this._updatingHandles.addPromise(this._extractEdges(f,u,p,!1,r));if(e.loaded==null)return 0;const v=this._createRenderable(y,a,t,c.key,!0);return e.renderables.push(v),c.addRenderable(v),v.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(t,e,i,r,n){const s=new Map;let o=0,a=null,l=0;for(let S=0;S<t.geometries.length;S++){const P=t.geometries[S];if(!P.material.supportsEdges)continue;!a&&P.localOrigin&&(a=P);const C=P.vertexAttributes.get(M.POSITION);l+=C.data.length/C.size,o+=P.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,u=o?new c(o):null,p=[];let f=0;for(let S=0;S<t.geometries.length;S++){const P=t.geometries[S];if(!P.material.supportsEdges)continue;const C=P.vertexAttributes.get(M.POSITION),R=P.indices.get(M.POSITION);let N=s.get(C.data);if(N==null){N=p.length/3;for(let $=0;$<C.data.length;$+=C.size)p.push(C.data[$]),p.push(C.data[$+1]),p.push(C.data[$+2]);s.set(C.data,N)}if(R)for(let $=0;$<P.edgeIndicesLength;$++)u[f++]=N+R[$]}const y=a||t.geometries[0],v=Ne(),b=this._computeModelTransformWithLocalOrigin(t,y,v);for(let S=0;S<t.geometries.length;S++)t.geometries[S].localOrigin=b.origin;const x=new Ise({data:p,size:3},u,v,b);await this._updatingHandles.addPromise(this._addPositionData(e,x,u.length,i[0],r,n))}_acquireRenderer(t,e,i){const r=HU.getKey(t,e,i);let n=this._renderers.get(r);return this._strokesTexture==null&&(this._strokesTexture=iut(this.rctx)),n||(n=new HU(this.rctx,this.techniqueRepository,{type:t,hasSlicePlane:e,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===Ke.Global}),this._renderers.set(r,n)),++n.refCount,n}_removeRenderable(t){Ose(t.regular),Ose(t.silhouette);const e=this._renderers.get(t.rendererKey);if(e){e.removeRenderable(t),--e.refCount,"origin"in t.transform&&this._localOrigins.release(t.transform.origin),this._gpuMemoryUsage-=t.statistics.externalMemoryUsage?0:t.statistics.gpuMemoryUsage;for(const i of t.components.meta)t.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(t){const e=t.camera.eye,i=t.camera.viewForward,r=I(),n=s=>{uo(r,s.center,e);const o=Re(r,i),a=s.radius,l=o<-a?1/0:o<a?0:o-a;s.renderables.forEach(c=>c.distanceToCamera=l)};this._perObjectData.forEach(n),this._perObjectDataEvictionCache.forEach(n)}_renderRegularEdges(t,e,i){const r=t.bindRegularEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!Mse(o)||!o.visible)return;const a=I$(o.regular.lod.lengths,o.distanceToCamera,s);t.renderRegularEdges(r,o,i,e,a)},n)}_renderSilhouetteEdges(t,e,i){const r=t.bindSilhouetteEdges(i,e),n=i.transparency,s=e.camera.perScreenPixelRatio;t.forEachRenderable(o=>{if(!$se(o)||!o.visible)return;const a=I$(o.silhouette.lod.lengths,o.distanceToCamera,s);t.renderSilhouetteEdges(r,o,i,e,a)},n)}get test(){return{hasRenderedPrimitives:t=>{let e=!1;const i=t.perScreenPixelRatio,r=(n,s)=>n.forEachRenderable(o=>{o.visible&&!e&&(Mse(o)&&(e=I$(o.regular.lod.lengths,o.distanceToCamera,i)>0),!e&&$se(o)&&(e=I$(o.silhouette.lod.lengths,o.distanceToCamera,i)>0))},s);return this._renderers.forEach(n=>{e||(r(n,oi.OPAQUE),r(n,oi.TRANSPARENT))}),e}}}};function Ose(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function out(t){let e=null,i=null;for(let r=0;r<t.geometries.length;r++){const n=t.geometries[r];if(n.material.supportsEdges){if(e){if(!Ag(e,n.transformation))return!1}else e=n.transformation;if(i||n.localOrigin==null){if(i&&i.localOrigin!=null&&n.localOrigin!=null&&i.localOrigin.id!==n.localOrigin.id)return!1}else i=n}}return!0}d([m({constructOnly:!0})],Md.prototype,"rctx",void 0),d([m({constructOnly:!0})],Md.prototype,"renderSR",void 0),d([m({constructOnly:!0})],Md.prototype,"viewingMode",void 0),d([m({constructOnly:!0})],Md.prototype,"techniqueRepository",void 0),d([m({constructOnly:!0})],Md.prototype,"setNeedsRender",void 0),d([m({constructOnly:!0})],Md.prototype,"schedule",void 0),d([m({readOnly:!0})],Md.prototype,"_updatingHandles",void 0),d([m({readOnly:!0})],Md.prototype,"updating",null),Md=d([J("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],Md);class Rse{constructor(e,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}let aut=class{constructor(e,i){this.buffer=e,this.meta=i}};class lut{constructor(e,i){this.vao=e,this.lod=i}}class cut{constructor(e,i){this.modelMatrix=e,this.origin=i}}let uut=class{constructor(e,i,r,n,s,o,a,l){this.regular=e,this.silhouette=i,this.statistics=r,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function Mse(t){return t.regular!=null}function $se(t){return t.silhouette!=null}function I$(t,e,i){const r=e*i,n=YTe(t,r,!0);return n===-1?r<t[0]?t.length:0:t.length-n}class Ise{constructor(e,i,r,n){this.position=e,this.indices=i,this.modelTransform=r,this.origin=n}}const Lse=on(),hut=()=>Promise.reject();function xp(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let Dse=class{constructor(e,i,r,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=i,this.resultAvailable=r,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},Jm=!1;function dut(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&xp(t)?new Dse(()=>t.createQuery(),r=>{t.deleteQuery(r),Jm=!1},r=>t.getQueryParameter(r,t.QUERY_RESULT_AVAILABLE),r=>t.getQueryParameter(r,t.QUERY_RESULT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Jm||(Jm=!0,t.beginQuery(i.TIME_ELAPSED_EXT,r))},()=>{t.endQuery(i.TIME_ELAPSED_EXT),Jm=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=t.getExtension("EXT_disjoint_timer_query"),i?new Dse(()=>i.createQueryEXT(),r=>{i.deleteQueryEXT(r),Jm=!1},r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>t.getParameter(i.GPU_DISJOINT_EXT),r=>{Jm||(Jm=!0,i.beginQueryEXT(i.TIME_ELAPSED_EXT,r))},()=>{i.endQueryEXT(i.TIME_ELAPSED_EXT),Jm=!1},r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function put(t,e){const i=t.capabilities.disjointTimerQuery;return i==null?null:new fut(i,e)}let fut=class{constructor(e,i){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,i.forEach(r=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(r,null)})}start(){Jm||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const i=this._queryResults.get(e);if(i==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(i))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const r=this._timer.getResult(i)/1e6;return this._queryPool.unshift(i),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,r}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var zr;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(zr||(zr={}));const Nse="Total";let mut=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new cg(Nse),this._cpuTimeSamplers=new Map(Object.values(zr).map(i=>[i,new cg(i)])),this._enableGPUTimer=0,this._totalGPUTime=new cg("GPU"),this._gpuTimeSamplers=new Map(Object.values(zr).map(i=>[i,new cg(i)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(zr),Nse];this._gpuTimerPool=put(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:nG(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=et(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const i=performance.now();if(this._cpuTimeSamplers.get(e).record(i-this._lastTimeStampCPU),this._lastTimeStampCPU=i,this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(r),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(zr.FINISH);this._gpuTimeSamplers.get(zr.FINISH).record(i)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((i,r)=>i+(r.last||0),0)),++this._totalFrameCount}},tc=class extends ke{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(t=null,e=!ge("disable-feature:high-quality-idle")){this._renderStateFeatures=PK(e,t),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(t,e=this._state){var i;return((i=this._renderStateFeatures)==null?void 0:i.get(e,t))??!1}setFeatureEnabled(t,e,i){var r;(r=this._renderStateFeatures)==null||r.set(e,t,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(ds.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(ds.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(ds.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(t,e,i,r,n,s,o,a){super({}),this._stage=t,this._materialRepository=e,this._techniqueRepository=r,this._rctx=n,this._compositingHelper=s,this._magnifierHelper=o,this._requestRender=a,this._materialRenderers=new ri,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=l=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new Cct,this._state=Ji.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=ks.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new Flt,this._handles=new an,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(t.view.qualityProfile),this._smaaPass=new gA(this._rctx,r),a(),this._offscreen=new rct(this._rctx,this._compositingHelper),this.performanceInfo=new mut(this._rctx),this._shadowMap=new dq(this._rctx,t.viewingMode),this._ssaoHelper=new qve(t.view,r,this._rctx,a),this._highlight=new Qlt(r,this._rctx),this._shadowHighlight=new Sct(this._rctx,t.viewingMode),this._shadowAccumulator=new xl(this._rctx,r,t,l=>{const c=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(l.camera,l.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=c},(l,c,u)=>{l.shadowMap.start(l.camera,c,u,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(j.Shadow,l.shadowMap),l.camera.setGLViewport(this._rctx),this._prepare(l.camera,l.contentCamera)},a),this._renderContext=new Eqe(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new mA({renderContext:this._renderContext,techniqueRepository:r,textureRepository:i,materialRepository:this._materialRepository,requestRender:a,controller:t}),this.renderPassManager=new Nlt(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([Pe(()=>this._stage.view.state.camera,()=>a(),qn),Pe(()=>Or.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,l=>{this._renderHiddenTransparentEdges=l?()=>this._renderEdges(oi.TRANSPARENT):()=>{},a()},ar),Pe(()=>this._ssaoEnabled||this.isFeatureEnabled(ds.SSAO),l=>this._ssaoHelper.enabled=l,qn)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=Qr(this._gpuTimerHandle),this._materialRenderers.forAll(t=>t.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=et(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=Je(this._edgeView),this.renderPassManager.destroy(),lge.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const t=this._stage.view.resourceController;this._edgeView=new Md({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:gut(t)}),this._handles.add(Pe(()=>Eh(this._edgeView,e=>e.updating),()=>this._requestRender(),gr)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return Fj(this._bindParameters.ssr.reprojectionMatrix,Os)}set _reprojectionMatrix(t){KV(this._bindParameters.ssr.reprojectionMatrix,t)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var t;return!!((t=this._shadowMap)!=null&&t.enabled)}setParameters(t){var r,n;const{_shadowMap:e,_bindParameters:i}=this;if(((r=t.qualitySettings)==null?void 0:r.reflections)!==void 0&&this._ssrEnabled!==t.qualitySettings.reflections&&(this._ssrEnabled=t.qualitySettings.reflections,this._requestRender()),((n=t.qualitySettings)==null?void 0:n.ambientOcclusion)!==void 0&&this._ssaoEnabled!==t.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=t.qualitySettings.ambientOcclusion,this._requestRender()),t.shadowMap!==void 0&&this._shadowMap.enabled!==t.shadowMap&&(this._shadowMap.enabled=t.shadowMap,this._requestRender()),t.shadowMapMaxCascades!==void 0&&e.maxCascades!==t.shadowMapMaxCascades&&(e.maxCascades=t.shadowMapMaxCascades,this._requestRender()),t.environment!=null){t.environment.weather!=null&&(this._bindParameters.weather=t.environment.weather,this._bindParameters.weatherVisible=!!t.weatherVisible);const s=t.environment.lighting.type!=="virtual";i.enableFillLights!==s&&(i.enableFillLights=s,this._requestRender())}t.background&&this._offscreen.background!==t.background&&(this._offscreen.background=t.background,this._requestRender()),t.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==t.antialiasingEnabled&&(this._antialiasingEnabled=t.antialiasingEnabled,this._requestRender()),t.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==t.highQualityTransparency&&(this._highQualityTransparencyEnabled=t.highQualityTransparency,this._requestRender()),t.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(t.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(t.defaultHighlightOptions),this._requestRender()),t.overlays!==void 0&&this._bindParameters.overlays!==t.overlays&&(this._bindParameters.overlays=t.overlays,this._requestRender()),t.hasOverlayWater!==void 0&&this._hasOverlayWater!==t.hasOverlayWater&&(this._hasOverlayWater=t.hasOverlayWater,this._requestRender()),t.renderOverlay!==void 0&&this._renderOverlay!==t.renderOverlay&&(this._renderOverlay=t.renderOverlay,this._requestRender()),t.slicePlane!==void 0&&this._sliceHelper.plane!==t.slicePlane&&(this._sliceHelper.plane=t.slicePlane,this._requestRender()),t.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==t.terrainRenderingEnabled&&(this._terrainRenderingEnabled=t.terrainRenderingEnabled,this._requestRender()),t.terrainTransparency!==void 0&&this._terrainTransparency!==t.terrainTransparency&&(this._terrainTransparency=t.terrainTransparency,this._requestRender()),t.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(t.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(t,e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:r,updates:n}=t;if(i.length===0&&r.length===0&&n.length===0)return;const s=Ove(t);let o=!1;s.forEach((a,l)=>{if(e.done)return;let c=this._materialRenderers.find(u=>u.material===l);c==null&&a.adds.length>0&&(c=new zve(this._rctx,this._materialRepository,l),this._materialRenderers.push(c)),c&&(c.modify(a),c.isEmpty&&(o=!0)),a.removes.forEach(u=>t.removes.removeUnordered(u)),a.adds.forEach(u=>t.adds.removeUnordered(u)),a.updates.forEach(u=>t.updates.removeUnordered(u)),e.madeProgress()}),o&&this._materialRenderers.filterInPlace(a=>!a.isEmpty||(a.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(a=>a.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(a=>a.hasOccludees),this._hasWater=this._materialRenderers.some(a=>a.hasWater),this._hasHUDElements=this._materialRenderers.some(a=>a.requiresSlot(Te.LINE_CALLOUTS_HUD_DEPTH,j.Color)||a.requiresSlot(Te.HUD_MATERIAL,j.Color)||a.requiresSlot(Te.LABEL_MATERIAL,j.Color)),this._requestRender()}updateAnimation(t){const e=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(t)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(t)||this._hasAnimations,this._hasAnimations!==e&&(this._gpuTimerHandle=e?Qr(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(t,e,i,r,n){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:s,contentCamera:o,mode:a,alignPixelEnabled:l}=i;this._state=a,this._renderOverlay(n),this.performanceInfo.advance(zr.OVERLAY),this._renderContext.time=n,this._bindParameters.transparencyPassType=At.NONE,this._bindParameters.alignPixelEnabled=l;const c=this._offscreen;c.setupRenderTarget(this.hasReflections);const u=Gg(this._sliceHelper.plane);r===wb.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(t),s.setGLViewport(this._rctx),this._prepare(s,o),this._renderPlugins.prepareRender(),this.performanceInfo.advance(zr.PREPARE);const p=this._computeDepthRange(s);this._renderShadowMap(t,s,this._bindParameters.lighting.mainLight.direction,p),this.performanceInfo.advance(zr.SHADOW_MAP),c.initializeFrame(s),this._ensureBindParameters(s,o);const f=this._terrainRenderingEnabled&&(this._terrainTransparency===ks.Semitransparent||this._terrainTransparency===ks.TransparentWithDraped),y=this._highQualityTransparency&&f,v=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(y,v),this._renderLinearDepth(),this.performanceInfo.advance(zr.LINEAR_DEPTH),this._accumulateShadows(p,s,o),this.performanceInfo.advance(zr.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(zr.NORMALS),this._ensureBindParametersSSR(n),this._renderSSAO(n),this.performanceInfo.advance(zr.SSAO),this._renderContext.output=j.Color,c.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(zr.OPAQUE),this._renderTerrainLinearDepth(y),this._setMultipassTerrain(y),this._renderEdges(oi.OPAQUE),this.performanceInfo.advance(zr.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(Te.VOXEL),this.performanceInfo.advance(zr.VOXEL),this._renderHiddenTransparentEdges(),v&&(this._oitEnabled?this._renderOITPass(I2.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(zr.TRANSPARENT),this._renderGeometryLinearDepth(y);const b=this._renderHUDVisibility(y);y||this._renderInternalSlot(Te.LINE_CALLOUTS),this.performanceInfo.advance(zr.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(e),this.performanceInfo.advance(zr.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(oi.TRANSPARENT,y),this.performanceInfo.advance(zr.TRANSPARENT_EDGES),this._renderTransparentTerrain(),f&&b&&(y?this._renderLineCallouts(oc.Occluded):c.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(oc.Occluded,c.framebuffer),this.performanceInfo.advance(zr.HUD_OCCLUDED)),this.performanceInfo.advance(zr.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),f&&(c.compositeTransparentTerrainOntoMain(this._bindParameters),y&&(this._renderEdges(oi.OPAQUE),this.performanceInfo.advance(zr.OPAQUE_EDGES),v&&(this._oitEnabled?this._renderOITPass(I2.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(zr.TRANSPARENT),this._renderEdges(oi.TRANSPARENT),this.performanceInfo.advance(zr.TRANSPARENT_EDGES))),y&&this._renderLineCallouts(oc.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),c.renderToTargets(()=>{this._renderInternalSlot(Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Te.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Te.LASERLINES)},c.currentColorTarget,c.mainDepth),this.performanceInfo.advance(zr.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&c.renderTmpAndCompositeToMain(()=>this._renderSlot(Te.LASERLINES_CONTRAST_CONTROL),this._bindParameters,wa.PremultipliedAlpha),this.performanceInfo.advance(zr.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(zr.OCCLUDED);const x=r===wb.ON&&this._magnifierHelper.enabled,S=x&&t==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):t;this._rctx.bindFramebuffer(S);const P=this._offscreen.colorTexture;this._renderAntiAliasing(P)||P==null||this._compositingHelper.composite(this._bindParameters,P,wa.None),this.performanceInfo.advance(zr.ANTIALIASING),this._renderHUD(oc.NotOccluded,S),this.performanceInfo.advance(zr.HUD),this._renderHighlights(S,this._bindParameters),this.performanceInfo.advance(zr.HIGHLIGHTS),x&&this._magnifierHelper.render(this._rctx,this._bindParameters),S!==t&&(this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,wa.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=u,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(t,e){this._renderContext.output=j.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(t),this._prepareSlots(Te.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),t||this._prepareInternalSlots(this._materialRenderers,Te.LINE_CALLOUTS),e&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(Te.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,Te.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(t){if(t!=null&&ge("enable-feature:objectAndLayerId-rendering")){const e=this._renderContext.output;this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(j.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(t),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=oc.NotOccluded,this._renderInternalSlot(Te.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=e}}finish(t){this._hasAnimations||this._animationTimestep.clear();const e=this.performanceInfo.gpuSamplingEnabled,i=t===Dn.BACKGROUND;if(i||e){const r=i?this.performanceInfo.elapsedTime:0,n=e?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),s=Math.max(r,n);this._animationTimestep.frame(s,i)}}readDepthPixels(t,e,i){const r=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(t,t),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const n=Vr.COLOR_BUFFER_BIT|Vr.DEPTH_BUFFER_BIT|Vr.STENCIL_BUFFER_BIT;this._rctx.clearSafe(n),this._renderGeometryAndTransparentTerrainPass(j.Depth)}r.readPixels(e[0],e[1],e[2],e[3],Gt.RGBA,ss.UNSIGNED_BYTE,i)}readHUDVisibility(t,e,i,r,n){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(t,e,i,r,Gt.RGBA,ss.UNSIGNED_BYTE,n)}readAccumulatedShadow(t){return this._shadowAccumulator.readAccumulatedShadow(t[0],t[1])}_setMultipassTerrain(t){this._setMultipassEnabled(t),this._setTerrainCulling(t)}_setMultipassEnabled(t){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=t}_setTerrainCulling(t){this._bindParameters.multipassTerrain.cullAboveGround=t}_prepareSlots(...t){this._renderPlugins.prepareSlots(t)}_renderSlot(t){this._bindParameters.slot=t,this._renderPlugins.render()}_renderEdges(t,e=!1){const i=this._edgeView;i!=null&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,t),this._bindParameters,wa.Alpha,e)}_renderShadowMap(t,e,i,r){const n=this._shadowMap;n.enabled&&(n.start(e,i,r,this.isFeatureEnabled(ds.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(e,i),this._needsShadowHighlight?(this._renderShadowCascades(j.ShadowHighlight,this._shadowMap,s=>n.takeCascadeSnapshotTo(s,ZT.Highlight)),n.clear(),this._renderShadowCascades(j.ShadowExcludeHighlight,this._shadowMap,s=>{n.takeCascadeSnapshotTo(s,ZT.Default),this._renderGeometryAndTransparentTerrainPass(j.ShadowHighlight)})):this._renderShadowCascades(j.Shadow),n.finish(t),e.setGLViewport(this._rctx))}_renderShadowCascades(t,e=this._shadowMap,i=r=>{}){for(const r of e.cascades)r.camera.setGLViewport(this._rctx),this._prepare(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(t),i(r)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(j.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(t){if(t){const e=this._renderContext.output;this._renderContext.output=j.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(t){if(t){const e=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(j.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=e}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(j.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(t){if(!this._needsDepthRange)return LV;const e=vlt(t,this._materialRenderers,this._stage.layers);return QT(e,this.renderPlugins.queryDepthRange(t)),e.near=Math.max(t.near,e.near),e.far=Math.min(t.far,e.far),e}_renderGeometryAndTransparentTerrainPass(t){this._renderContext.output=t,this._prepareSlots(Te.TRANSPARENT_TERRAIN),this._renderGeometryPass(t),this._renderTransparentTerrain()}_renderGeometryPass(t){this._renderContext.output=t,this._prepareSlots(Te.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(t){this._ssaoHelper.render(this._bindParameters,t,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(Te.INTEGRATED_MESH,Te.OPAQUE_TERRAIN,Te.OPAQUE_MATERIAL,Te.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,Te.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(Te.INTEGRATED_MESH),this._renderSlot(Te.OPAQUE_TERRAIN),this._renderInternalSlot(Te.OPAQUE_MATERIAL),this._renderSlot(Te.OPAQUE_MATERIAL),this._renderSlot(Te.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Te.TRANSPARENT_MATERIAL),this._renderSlot(Te.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Te.TRANSPARENT_TERRAIN)}_renderHUDVisibility(t){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Te.OCCLUSION_PIXELS)},t),e}_renderLineCallouts(t){this._bindParameters.renderTransparentlyOccludedHUD=t,t===oc.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(Te.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Te.LINE_CALLOUTS)}_renderHUD(t,e){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(I2.HUD,t),this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,wa.PremultipliedAlpha)):t===oc.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(oc.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(t))}_renderHUDElements(t){this._bindParameters.renderTransparentlyOccludedHUD=t,this._prepareInternalSlots(this._materialRenderers,Te.LINE_CALLOUTS_HUD_DEPTH,Te.HUD_MATERIAL,Te.LABEL_MATERIAL),this._renderInternalSlot(Te.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Te.HUD_MATERIAL),this._renderInternalSlot(Te.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(t,e){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,r=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(j.Highlight),this._rctx.clearSafe(Vr.DEPTH_BUFFER_BIT),this._renderHUDElements(oc.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(e,t),i.render(this._bindParameters,r,t)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(t,e,i){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,t,e,i)}_prepareTransparencySlots(){this._renderContext.output=j.Alpha,this._bindParameters.transparencyPassType=At.Alpha,this._prepareInternalSlots(this._materialRenderers,Te.TRANSPARENT_MATERIAL),this._prepareSlots(Te.TRANSPARENT_MATERIAL),this._renderContext.output=j.Color,this._bindParameters.transparencyPassType=At.Color,this._prepareInternalSlots(this._materialRenderers,Te.TRANSPARENT_MATERIAL),this._prepareSlots(Te.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=At.FrontFace,this._prepareInternalSlots(this._materialRenderers,Te.TRANSPARENT_MATERIAL),this._prepareSlots(Te.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=At.NONE}_renderOITPass(t,e=oc.Both){const i=t===I2.HUD,r=i?()=>this._renderHUDElements(e):()=>this._renderTransparentGeometry(),n=o=>{this._bindParameters.transparencyPassType=o,this._offscreen.renderOITPass(r,o,i)},s=this._renderContext.output;this._renderContext.output=j.Alpha,n(At.Alpha),this._renderContext.output=j.Color,n(At.Color),n(At.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,i),this._bindParameters.transparencyPassType=At.NONE,this._renderContext.output=s,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let t=0;Wc.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&s.material.renderOccluded===Kr.OccludeAndTransparentStencil&&(t|=s.material.renderOccluded,Wc.push(s))});const e=this._offscreen,i=(s,o,a,l,c)=>{t&o&&(e.renderToTargets(a,e.tmpColor,e.mainDepth,[0,0,0,0],l,c),e.compositeOccludedOntoMain(this._bindParameters,s))};Wc.length!==0&&(this._prepareInternalSlots(Wc,Te.OCCLUDER_MATERIAL,Te.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(Te.OCCLUDER_MATERIAL,Wc),i(.5,Kr.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Te.TRANSPARENT_OCCLUDER_MATERIAL,Wc),!1,!1)),Wc.clear(),this._materialRenderers.forAll(s=>{s.material&&s.material.isVisible()&&(s.material.renderOccluded===Kr.OccludeAndTransparent||s.material.renderOccluded===Kr.Transparent||s.material.renderOccluded===Kr.Opaque)&&(t|=s.material.renderOccluded,Wc.push(s))});const r=this._renderPlugins.renderOccludedFlags;if(t|=r,!t)return;const n=s=>{this._renderContext.renderOccludedMask=s,this._prepareInternalSlots(Wc,Te.OPAQUE_MATERIAL,Te.TRANSPARENT_MATERIAL,Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),r>Kr.Occlude&&this._renderSlot(Te.OCCLUDED_TERRAIN),this._renderInternalSlot(Te.OPAQUE_MATERIAL,Wc),this._renderInternalSlot(Te.TRANSPARENT_MATERIAL,Wc),this._renderInternalSlot(Te.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Wc),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=j.Color,i(.5,Kr.OccludeAndTransparent,()=>n(Kr.OccludeAndTransparent),!0,Il.OutlineVisualElementMask),i(.5,Kr.Transparent,()=>n(Kr.Transparent),!0,Il.OutlineVisualElementMask),i(1,Kr.Opaque,()=>n(Kr.Opaque),!0,Il.OutlineVisualElementMask),Wc.clear()}_renderAntiAliasing(t){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&t!=null)return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_prepare(t,e){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(Te.TRANSPARENT_MATERIAL,j.Color)),this._bindParameters.camera=t,this._bindParameters.contentCamera=e}_ensureBindParameters(t,e){this._bindParameters.camera=t,this._bindParameters.contentCamera=e;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(t){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=t),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Os:(fo(kse,this._bindParameters.camera.viewMatrix),fo(Fse,this._bindParameters.camera.projectionMatrix),Cr(Ax,kse,Fse),Cr(Ax,this._renderContext.lastFrameCamera.viewMatrix,Ax),Cr(Ax,this._renderContext.lastFrameCamera.projectionMatrix,Ax),this._reprojectionMatrix=Ax),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const e=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=e>0?Math.min(e,t-this._ssrEnableTime)/e:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=Os,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(t,...e){for(const i of e)this._bindParameters.slot=i,t.forAll(r=>{r.material.shouldRender(this._renderContext)&&r.prepareTechnique(this._renderContext)})}_renderInternalSlot(t,e=this._materialRenderers){let i=!1;return this._bindParameters.slot=t,e.forAll(r=>{if(r.material.shouldRender(this._renderContext)){const n=r.prepareTechnique(this._renderContext);n!=null&&(r.render(this._renderContext,n),i=!0)}}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=nme(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var t,e,i,r,n;return{offscreen:((t=this._offscreen)==null?void 0:t.gpuMemoryUsage)??0,highlights:(((e=this._highlight)==null?void 0:e.gpuMemoryUsage)??0)+(((i=this._shadowHighlight)==null?void 0:i.gpuMemoryUsage)??0),shadows:((r=this._shadowMap)==null?void 0:r.gpuMemoryUsage)??0,ssao:((n=this._ssaoHelper)==null?void 0:n.gpuMemoryUsage)??0}}get test(){const t=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{t._renderStateFeatures=PK()},getFramebufferTexture:e=>{switch(e){case w_.Color:return t._offscreen.colorTexture;case w_.LinearDepth:return t._offscreen.linearDepthTexture;case w_.Normals:return t._offscreen.normalTexture;case w_.ShadowMap:return t._shadowMap.depthTexture;case w_.HudVisibility:return t._offscreen.hudVisibilityTexture;case w_.Highlight:return t._offscreen.highlightTexture}}}}};var I2,w_;d([m()],tc.prototype,"_renderPlugins",void 0),d([m()],tc.prototype,"_shadowAccumulator",void 0),d([m()],tc.prototype,"_state",void 0),d([m()],tc.prototype,"_renderStateFeatures",void 0),d([m()],tc.prototype,"_antialiasingEnabled",void 0),d([m({readOnly:!0})],tc.prototype,"_antialiasing",null),d([m()],tc.prototype,"_ssaoEnabled",void 0),d([m()],tc.prototype,"_smaaPass",void 0),d([m({autoDestroy:!0})],tc.prototype,"_edgeView",void 0),d([m()],tc.prototype,"updating",null),d([m()],tc.prototype,"isCameraFinal",null),tc=d([J("esri.views.3d.webgl-engine.lib.Renderer")],tc),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(I2||(I2={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(w_||(w_={}));const Wc=new ri,Fse=Ne(),kse=Ne(),Ax=Ne();function gut(t){return e=>t.immediate.schedule(e)}let p2e=class f2e{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=f2e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return Ki.createIndex(this._rctx,zi.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,zt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Ht.POINTS,1,bt.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},Use=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:De.ONE,dstRGB:De.ZERO,srcAlpha:De.ONE,dstAlpha:De.ZERO},this.blendEquation={mode:Zf.ADD,modeAlpha:Zf.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Jd.BACK,this.frontFace=MT.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=br.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Jd.FRONT_AND_BACK,func:br.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Jd.FRONT_AND_BACK,fail:Fn.KEEP,zFail:Fn.KEEP,zPass:Fn.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},_ut=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const i=new Map;this._allocations.forEach(r=>{i.set(r,(i.get(r)??0)+1)}),i.forEach((r,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${r}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const yut={RECORD_ALLOCATIONS:!1};let vut=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new _ut(yut.RECORD_ALLOCATIONS);this._current.length<Hs.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,i){const r=++this._current[e];this._max[e]=Math.max(r,this._max[e]),this._allocations.add(i)}decrement(e,i){--this._current[e],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,i)=>e+i,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let i=0;i<Hs.COUNT;++i){const r=this._current[i];r>0&&(e+=`${Hs[i]}: ${r}
`)}}return e+=this._allocations.information,e}},but=class{constructor(e,i,r){const n=i.textureFilterAnisotropic,s=r.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),xp(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const wut=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var zse,m2e={exports:{}};(zse=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(m2e.exports=zse);const xut=J3(m2e.exports);var Bse,GV={exports:{}};GV.exports,Bse=GV,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(Bse.exports=e)}();const Vse=J3(GV.exports);var g2e={exports:{}};(function(t){(function(e){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();i!==void 0&&(t.exports=i)})()})(g2e);const Tut=J3(g2e.exports);var _d=999,Gse=9999,qU=0,ZU=1,jse=2,Hse=3,Wse=4,L$=5,Sut=6,Cut=7,Eut=8,qse=9,Aut=10,Zse=11,Put=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Out(){var t,e,i,r=0,n=0,s=_d,o=[],a=[],l=1,c=0,u=0,p=!1,f=!1,y="";return function(X){return a=[],X!==null?b(X.replace?X.replace(/\r\n/g,`
`):X):x()};function v(X){X.length&&a.push({type:Put[s],data:X,position:u,line:l,column:c})}function b(X){var ae;for(r=0,i=(y+=X).length;t=y[r],r<i;){switch(ae=r,s){case qU:r=N();break;case ZU:r=R();break;case jse:r=C();break;case Hse:r=$();break;case Wse:r=W();break;case Zse:r=B();break;case L$:r=Z();break;case Gse:r=K();break;case qse:r=P();break;case _d:r=S()}ae!==r&&(y[ae]===`
`?(c=0,++l):++c)}return n+=r,y=y.slice(r),a}function x(X){return o.length&&v(o.join("")),s=Aut,v("(eof)"),a}function S(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=n+r-1,s=qU,e=t,r+1):e==="/"&&t==="/"?(u=n+r-1,s=ZU,e=t,r+1):t==="#"?(s=jse,u=n+r,r):/\s/.test(t)?(s=qse,u=n+r,r):(p=/\d/.test(t),f=/[^\w_]/.test(t),u=n+r,s=p?Wse:f?Hse:Gse,r)}function P(){return/[^\s]/g.test(t)?(v(o.join("")),s=_d,r):(o.push(t),e=t,r+1)}function C(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,r+1):(v(o.join("")),s=_d,r)}function R(){return C()}function N(){return t==="/"&&e==="*"?(o.push(t),v(o.join("")),s=_d,r+1):(o.push(t),e=t,r+1)}function $(){if(e==="."&&/\d/.test(t))return s=L$,r;if(e==="/"&&t==="*")return s=qU,r;if(e==="/"&&t==="/")return s=ZU,r;if(t==="."&&o.length){for(;k(o););return s=L$,r}if(t===";"||t===")"||t==="("){if(o.length)for(;k(o););return v(t),s=_d,r+1}var X=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||X){for(;k(o););return s=_d,r}return o.push(t),e=t,r+1}function k(X){for(var ae,re,ee=0;;){if(ae=Vse.indexOf(X.slice(0,X.length+ee).join("")),re=Vse[ae],ae===-1){if(ee--+X.length>0)continue;re=X.slice(0,1).join("")}return v(re),u+=re.length,(o=o.slice(re.length)).length}}function B(){return/[^a-fA-F0-9]/.test(t)?(v(o.join("")),s=_d,r):(o.push(t),e=t,r+1)}function W(){return t==="."||/[eE]/.test(t)?(o.push(t),s=L$,e=t,r+1):t==="x"&&o.length===1&&o[0]==="0"?(s=Zse,o.push(t),e=t,r+1):/[^\d]/.test(t)?(v(o.join("")),s=_d,r):(o.push(t),e=t,r+1)}function Z(){return t==="f"&&(o.push(t),e=t,r+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,r+1):/[^\d]/.test(t)?(v(o.join("")),s=_d,r):(o.push(t),e=t,r+1)}function K(){if(/[^\d\w_]/.test(t)){var X=o.join("");return s=xut.indexOf(X)>-1?Eut:Tut.indexOf(X)>-1?Cut:Sut,v(o.join("")),s=_d,r}return o.push(t),e=t,r+1}}function Rut(t){var e=Out(),i=[];return i=(i=i.concat(e(t))).concat(e(null))}function Mut(t){return Rut(t)}function $ut(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const XU=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Iut(t,e="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=r.exec(n.data);if(s){const o=s[1].replaceAll(/\s\s+/g," ");if(o===i)return o;if(o===e)return n.data="#version "+i,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function Lut(t,e){for(let i=e-1;i>=0;i--){const r=t[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function _A(t,e,i,r){r=r||i;for(const n of t)if(n.type==="ident"&&n.data===i)return r in e?e[r]++:e[r]=0,_A(t,e,r+"_"+e[r],r);return i}function _2e(t,e,i="afterVersion"){function r(l,c){for(let u=c;u<l.length;u++){const p=l[u];if(p.type==="operator"&&p.data===";")return u}return null}function n(l){let c=-1,u=0,p=-1;for(let f=0;f<l.length;f++){const y=l[f];if(y.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(y.data)?++u:/\#endif\s*.*/.test(y.data)&&--u),i!=="afterVersion"&&i!=="afterPrecision"||y.type==="preprocessor"&&/^#version/.test(y.data)&&(p=Math.max(p,f)),i==="afterPrecision"&&y.type==="keyword"&&y.data==="precision"){const v=r(l,f);if(v===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,v)}c<p&&u===0&&(c=f)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function Dut(t,e,i,r="lowp"){_2e(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Nut(t,e,i,r,n="lowp"){_2e(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function Fut(t,e){let i,r,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(i=s),o.data==="]")){r=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return i&&r&&t.splice(i,r-i+1),n}function Xse(t,e){if(t.startsWith("#version 300"))return t;const i=Mut(t);if(Iut(i,"100","300 es")==="300 es")return t;let r=null,n=null;const s={},o={};for(let a=0;a<i.length;++a){const l=i[a];switch(l.type){case"keyword":e===ou.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===ou.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===ou.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(r||(r=_A(i,s,"fragColor"),Dut(i,r,"vec4")),l.data=r),e===ou.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=Fut(i,a+1),u=_A(i,s,"fragData");Nut(i,u,"vec4",c,"mediump"),l.data=u}else e===ou.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=_A(i,s,"gl_FragDepth")),l.data=n);break;case"ident":if(wut.includes(l.data)){if(e===ou.VERTEX_SHADER&&Lut(i,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=_A(i,s,l.data)),l.data=o[l.data]}}}for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&XU.includes(c[1].trim())){const f=i[a+1];i.splice(a,f&&f.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&XU.includes(u[1].trim())&&(l.data="#if 1");const p=l.data.match(/\#ifndef\s+(.*)/);p&&p[1]&&XU.includes(p[1].trim())&&(l.data="#if 0")}}return kut(t,$ut(i))}function kut(t,e){return e}const Uut=4294967295;let zut=class{constructor(e,i,r,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===xi.WEBGL2&&(i=Xse(i,ou.VERTEX_SHADER),r=Xse(r,ou.FRAGMENT_SHADER)),this._vShader=Yse(this._context,ou.VERTEX_SHADER,i),this._fShader=Yse(this._context,ou.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Hs.Shader,this),dB()&&(this.vertexShader=i,this.fragmentShader=r);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),dB()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===xi.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const p=l.getUniformBlockIndex(a,c);p<Uut&&l.uniformBlockBinding(a,p,u)}}this._glName=a,this._context.instanceCounter.increment(Hs.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Hs.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Hs.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1iv(e,i){Wp(this._nameToUniform1v,e,i)&&this._context.gl.uniform1iv(this._getUniformLocation(e),i)}setUniform2iv(e,i){Wp(this._nameToUniform2,e,i)&&this._context.gl.uniform2iv(this._getUniformLocation(e),i)}setUniform3iv(e,i){Wp(this._nameToUniform3,e,i)&&this._context.gl.uniform3iv(this._getUniformLocation(e),i)}setUniform4iv(e,i){Wp(this._nameToUniform4,e,i)&&this._context.gl.uniform4iv(this._getUniformLocation(e),i)}setUniform1f(e,i){const r=this._nameToUniform1[e];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(e),i),this._nameToUniform1[e]=i)}setUniform1fv(e,i){Wp(this._nameToUniform1v,e,i)&&this._context.gl.uniform1fv(this._getUniformLocation(e),i)}setUniform2f(e,i,r){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),this._nameToUniform2.set(e,[i,r])):i===n[0]&&r===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),i,r),n[0]=i,n[1]=r)}setUniform2fv(e,i){Wp(this._nameToUniform2,e,i)&&this._context.gl.uniform2fv(this._getUniformLocation(e),i)}setUniform3f(e,i,r,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),this._nameToUniform3.set(e,[i,r,n])):i===s[0]&&r===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),i,r,n),s[0]=i,s[1]=r,s[2]=n)}setUniform3fv(e,i){Wp(this._nameToUniform3,e,i)&&this._context.gl.uniform3fv(this._getUniformLocation(e),i)}setUniform4f(e,i,r,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),this._nameToUniform4.set(e,[i,r,n,s])):o!==void 0&&i===o[0]&&r===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),i,r,n,s),o[0]=i,o[1]=r,o[2]=n,o[3]=s)}setUniform4fv(e,i){Wp(this._nameToUniform4,e,i)&&this._context.gl.uniform4fv(this._getUniformLocation(e),i)}setUniformMatrix3fv(e,i,r=!1){Wp(this._nameToUniformMatrix3,e,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),r,i)}setUniformMatrix4fv(e,i,r=!1){Wp(this._nameToUniformMatrix4,e,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),r,i)}stop(){}};function Yse(t,e,i){const r=t.gl,n=r.createShader(e);return r.shaderSource(n,i),r.compileShader(n),dB()&&!r.getShaderParameter(n,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===ou.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(n)),console.error(But(i))),n}function But(t){let e=2;return t.replaceAll(`
`,()=>`
`+Vut(e++)+":")}function Vut(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Wp(t,e,i){const r=t.get(e);return r?KV(r,i):(t.set(e,Array.from(i)),!0)}let Gut=class{constructor(e){this._rctx=e,this._store=new wS}dispose(){this._store.forEach(e=>e.forEach(i=>i.dispose())),this._store.clear()}acquire(e,i,r,n){const s=this._store.get(e,i);if(s!=null)return s.ref(),s;const o=new zut(this._rctx,e,i,r,n);return o.ref(),this._store.set(e,i,o),o}get test(){let e=0;return this._store.forEach(i=>i.forEach(r=>e+=r.hasGLName?2:1)),{cachedWebGLObjects:e}}},gO=class{constructor(){this._result=!1}dispose(){this._program=et(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},jut=class extends gO{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===xi.WEBGL2&&ge("mac")&&ge("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const i=this._rctx;i.resetState();const r=new Di(1);r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=qt.NEAREST;const n=new Rs(i,r),s=Ki.createIndex(this._rctx,zi.STATIC_DRAW,new Uint8Array([0]));i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.useProgram(this._helperProgram),i.bindBuffer(s,zt.ELEMENT_ARRAY_BUFFER),i.drawElements(Ht.POINTS,1,bt.UNSIGNED_BYTE,0),i.useProgram(e),i.bindVAO(null),i.drawArrays(Ht.TRIANGLES,0,258);const o=new Uint8Array(4);return n.readPixels(0,0,1,1,Gt.RGBA,ss.UNSIGNED_BYTE,o),n.dispose(),s.dispose(),o[0]===255}_prepareProgram(){const i=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${T.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,r=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${T.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(i,r,new Map([]))}_prepareHelperProgram(){const e=p2e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},Hut=class extends gO{constructor(e){super(),this._rctx=e,this._program=Jse(this._rctx,!1),this._obfuscated=Jse(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=et(this._obfuscated)}_test(e){if(ge("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const i=this._runProgram(e),r=this._runProgram(this._obfuscated);return i!==0&&(r===0||i/r>5)}_runProgram(e){const i=this._rctx;i.resetState();const r=new Di(1);r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=qt.NEAREST;const n=new Rs(i,r),s=Ki.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Gh(i,new Map([["position",0]]),{geometry:[new Lo("position",2,bt.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=Ge(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ge(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);e7(a,c,3);const u=new Float32Array(6);e7(l,u,3),i.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Ht.TRIANGLE_STRIP,0,4);const p=new Uint8Array(4);n.readPixels(0,0,1,1,Gt.RGBA,ss.UNSIGNED_BYTE,p),o.dispose(),n.dispose();const f=(a[2]-l[2])/25,y=NW(p);return Math.abs(f-y)}};function Jse(t,e){const i=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,r=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(i,r,new Map([["position",0]]))}let Wut=class extends gO{constructor(e){var n,s,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===xi.WEBGL1)return void(this._result=!(!((n=e.capabilities.textureFloat)!=null&&n.textureFloat)||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const i=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Di(1);r.wrapMode=Jt.CLAMP_TO_EDGE,r.dataType=ss.FLOAT,r.internalFormat=mt.RGBA32F,r.samplingMode=qt.NEAREST;const n=new Rs(i,r),s=Ki.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Gh(i,new Map([["a_pos",0]]),{geometry:[new Lo("a_pos",2,bt.UNSIGNED_SHORT,0,4)]},{geometry:s});i.useProgram(e);const a=i.getBoundFramebufferObject(),{x:l,y:c,width:u,height:p}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.bindVAO(o),i.drawArrays(Ht.TRIANGLE_STRIP,0,4);const f=Zt({blending:M_e});i.setPipelineState(f),i.drawArrays(Ht.TRIANGLE_STRIP,0,4);const y=i.gl.getError();return i.setViewport(l,c,u,p),i.bindFramebuffer(a),o.dispose(),n.dispose(),y!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},qut=class extends gO{constructor(e){super(),this._rctx=e;const i=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,r=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}_test(e){const i=this._rctx,r=new Di(1);r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=qt.NEAREST;const n=new Rs(i,r),s=new Uint8Array(4),o=Ki.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Gh(i,new Map([["a_position",0]]),{geometry:[new Lo("a_position",2,bt.SHORT,0,4)]},{geometry:o});i.useProgram(e);const l=new Wt(i,r,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),i.bindTexture(l,0);const c=i.getBoundFramebufferObject();i.bindFramebuffer(n),i.useProgram(e);const{x:u,y:p,width:f,height:y}=i.getViewport();i.setViewport(0,0,1,1),i.bindVAO(a),i.drawArrays(Ht.TRIANGLE_STRIP,0,4),i.setViewport(u,p,f,y),n.readPixels(0,0,1,1,Gt.RGBA,ss.UNSIGNED_BYTE,s),a.dispose(),n.dispose();const v=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return v&&ye.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),i.bindFramebuffer(c),v}};new Lo("a_pos",2,bt.BYTE,0,2);new Lo("a_pos",2,bt.BYTE,0,4),new Lo("a_tex",2,bt.BYTE,2,4);const Zut={geometry:[new Lo("a_pos",2,bt.UNSIGNED_SHORT,0,4)]};let Xut=class extends gO{constructor(e){super(),this._rctx=e;const i=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,r=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(i,r,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const i=this._rctx;if(!i.gl)return e.dispose(),!0;const r=new Di(1);r.wrapMode=Jt.CLAMP_TO_EDGE,r.samplingMode=qt.NEAREST;const n=new Rs(i,r),s=Ki.createVertex(i,zi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new Gh(i,new Map([["a_pos",0]]),Zut,{geometry:s}),a=new Di;a.samplingMode=qt.LINEAR,a.wrapMode=Jt.CLAMP_TO_EDGE;const l=new Wt(i,a,yA);i.useProgram(e),i.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=i.getBoundFramebufferObject(),{x:u,y:p,width:f,height:y}=i.getViewport();i.bindFramebuffer(n),i.setViewport(0,0,1,1),i.setClearColor(0,0,0,0),i.setBlendingEnabled(!1),i.clearSafe(Vr.COLOR_BUFFER_BIT),i.bindVAO(o),i.drawArrays(Ht.TRIANGLE_STRIP,0,4);const v=new Uint8Array(4);return n.readPixels(0,0,1,1,Gt.RGBA,ss.UNSIGNED_BYTE,v),o.dispose(),n.dispose(),l.dispose(),i.setViewport(u,p,f,y),i.bindFramebuffer(c),v[0]!==255}};const yA=new Image;yA.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",yA.width=5,yA.height=5,yA.decode();let Yut=class{constructor(e){this.rctx=e,this.floatBufferBlend=new Wut(e),this.svgPremultipliesAlpha=new Xut(e),this.doublePrecisionRequiresObfuscation=new Hut(e),this.ignoresSamplerPrecision=new qut(e),this.drawArraysRequiresIndicesTypeReset=new jut(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function Jut(t,e){if(e.disjointTimerQuery)return null;if(xp(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Kut(t){if(xp(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function Qut(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function eht(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function tht(t,e){if(xp(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const i=t.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function iht(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function rht(t,e){if(xp(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function nht(t,e){if(xp(t)){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),r=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function Kse(t,e,i,r,n){if(r&&xp(t))return!0;if(e[i])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function sht(t,e){if(!xp(t)||e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function oht(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function aht(t,e){if(xp(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}let lht=class{constructor(e,i){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=Jut(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Kut(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=aht(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=Qut(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=eht(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=iht(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=dut(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=rht(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=nht(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=tht(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=Kse(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=oht(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=sht(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=Kse(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},cht=class{constructor(e,i){this.gl=e,this.instanceCounter=new vut,this.programCache=new Gut(this),this._state=new Use,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=xp(e)?xi.WEBGL2:xi.WEBGL1,this._loadExtensions(),this.configure(i)}get gl2(){return this.type===xi.WEBGL1?null:this.gl}configure(e){this._capabilities=new lht(this.gl,e),this._parameters=new but(this.gl,this._capabilities,e),Wt.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Use,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new c6e({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const n=r.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const n=r.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=r.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),et(this._driverTest),this._driverTest=new Yut(this)}dispose(){et(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(zt.ARRAY_BUFFER),this.unbindBuffer(zt.ELEMENT_ARRAY_BUFFER),this.type===xi.WEBGL2&&(this.unbindBuffer(zt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(zt.PIXEL_PACK_BUFFER),this.unbindBuffer(zt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(zt.COPY_READ_BUFFER),this.unbindBuffer(zt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,hh()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,i){for(let r=0;r<e.length;++r)this._state.textureUnitMap[e[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,i,r,n){e===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,i,r,n),this._state.blendColor.r=e,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,i){e===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,i),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,i,r,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,i,r,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,i){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(e,i),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(e,i,r,n){this._state.colorMask.r===e&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===n||(this.gl.colorMask(e,i,r,n),this._state.colorMask.r=e,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,i,r,n){this._state.clearColor.r===e&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===n||(this.gl.clearColor(e,i,r,n),this._state.clearColor.r=e,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,i){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=i,this.gl.polygonOffset(e,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,i,r,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===n||(this.gl.scissor(e,i,r,n),this._state.scissorRect.x=e,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,i){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===i||(this.gl.depthRange(e,i),this._state.depthRange.zNear=e,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,i,r){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(e,i,r),this._state.stencilFunction.face=Jd.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,i,r,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,i,r,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,i,r){this._state.stencilOperation.face===Jd.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(e,i,r),this._state.stencilOperation.face=Jd.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,i,r,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,i,r,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,i=!1){const r=this._state.activeTexture;return e>=0&&(i||e!==this._state.activeTexture)&&(this.gl.activeTexture(S6+e),this._state.activeTexture=e),r}clear(e){e&&this.gl.clear(e)}clearSafe(e,i=255){e&&(e&Vr.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Vr.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Vr.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(e))}drawArrays(e,i,r){if(hh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Qse(e,r)),this.gl.drawArrays(e,i,r),hh()){const n=BJ(this);n&&console.error("drawArrays:",n)}}drawElements(e,i,r,n){if(hh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Qse(e,i)),this.gl.drawElements(e,i,r,n),hh()){const s=BJ(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:i,type:r,offset:n},p=(a==null?void 0:a.size)??0,f=n+i,y=p<f?`. Buffer is too small. Attempted to draw index ${f} of ${p}`:"";console.error(`drawElements: ${s}${y}`,{args:u,vao:c})}}}logInfo(){hh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){hh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,i,r,n){r=Math.max(Math.round(r),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===i&&s.width===r&&s.height===n||(s.x=e,s.y=i,s.width=r,s.height=n,this.gl.viewport(e,i,r,n))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var i;this._state.program!==e&&((i=this._state.program)==null||i.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[i];return e==null||e.glName==null?(n!=null&&(this.setActiveTexture(i,r),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[i]=null,n):r||n!==e?(this.setActiveTexture(i,r),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[i]=e,n):(e.isDirty&&(this.setActiveTexture(i,r),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===e&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(e,i=!1){if(i||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(Oo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Oo.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,i,r=!1){const n=i===Oo.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(r||s!==e)&&(e==null?this.gl.bindFramebuffer(i,null):e.initializeAndBind(i),n?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,i,r=0,n=0,s=e.width,o=e.height,a=0,l=0,c=i.width,u=i.height,p=Vr.COLOR_BUFFER_BIT,f=qt.NEAREST){this.bindFramebufferSeparate(e,Oo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,Oo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,n,s,o,a,l,c,u,p,f)}bindBuffer(e,i){if(e)switch(i??(i=e.bufferType),i){case zt.ARRAY_BUFFER:this._state.vertexBuffer=Yl(this.gl,e,i,this._state.vertexBuffer);break;case zt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Yl(this.gl,e,i,this._state.indexBuffer);break;case zt.UNIFORM_BUFFER:this._state.uniformBuffer=Yl(this.gl,e,i,this._state.uniformBuffer);break;case zt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Yl(this.gl,e,i,this._state.pixelPackBuffer);break;case zt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Yl(this.gl,e,i,this._state.pixelUnpackBuffer);break;case zt.COPY_READ_BUFFER:this._state.copyReadBuffer=Yl(this.gl,e,i,this._state.copyReadBuffer);break;case zt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Yl(this.gl,e,i,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const i=this.gl;e||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(i.bindRenderbuffer(i.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let n=r[i];return n==null&&(n={buffer:null,offset:0,size:0},r[i]=n),n}bindBufferBase(e,i,r){const n=this._getBufferBinding(e,i);n!=null&&(n.buffer===r&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,i,r?r.glName:null),n.buffer=r,n.offset=0,n.size=0))}bindBufferRange(e,i,r,n,s){const o=this._getBufferBinding(e,i);if(o!=null&&!(o.buffer===r&&o.offset===n&&o.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,i,r.glName,n,s),o.buffer=r,o.offset=n,o.size=s}}bindUBO(e,i,r,n){i!=null?(hh()&&(n??i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&n!==void 0?this.bindBufferRange(zt.UNIFORM_BUFFER,e,i.buffer,r,n):this.bindBufferBase(zt.UNIFORM_BUFFER,e,i.buffer)):this.bindBufferBase(zt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const n=this._state.uniformBufferBindingPoints[i];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(zt.UNIFORM_BUFFER,i,null)}}unbindBuffer(e){switch(e){case zt.ARRAY_BUFFER:this._state.vertexBuffer=Yl(this.gl,null,e,this._state.vertexBuffer);break;case zt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Yl(this.gl,null,e,this._state.indexBuffer);break;case zt.UNIFORM_BUFFER:this._state.uniformBuffer=Yl(this.gl,null,e,this._state.uniformBuffer);break;case zt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Yl(this.gl,null,e,this._state.pixelPackBuffer);break;case zt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Yl(this.gl,null,e,this._state.pixelUnpackBuffer);break;case zt.COPY_READ_BUFFER:this._state.copyReadBuffer=Yl(this.gl,null,e,this._state.copyReadBuffer);break;case zt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Yl(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const i=this.gl,r=i.fenceSync(hB.SYNC_GPU_COMMANDS_COMPLETE,0);if(!r)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(Hs.Sync,r),i.flush();do await _P(e),n=i.clientWaitSync(r,0,0);while(n===bD.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Hs.Sync,r),i.deleteSync(r),n===bD.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Oo.FRAMEBUFFER){return e===Oo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(zt.ARRAY_BUFFER),this.unbindBuffer(zt.ELEMENT_ARRAY_BUFFER),this.type===xi.WEBGL2&&(this.unbindBuffer(zt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(zt.PIXEL_PACK_BUFFER),this.unbindBuffer(zt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(zt.COPY_READ_BUFFER),this.unbindBuffer(zt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(De.ONE,De.ZERO),this.setBlendEquation(Zf.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Jd.BACK),this.setFrontFace(MT.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(br.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(br.ALWAYS,0,0),this.setStencilOp(Fn.KEEP,Fn.KEEP,Fn.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:i,gl2:r}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)i.disableVertexAttribArray(l);if(this._state.vertexBuffer?i.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):i.bindBuffer(zt.ARRAY_BUFFER,null),this._state.indexBuffer?i.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):i.bindBuffer(zt.ELEMENT_ARRAY_BUFFER,null),r!=null){this._state.uniformBuffer?r.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):r.bindBuffer(zt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(c!=null){const{buffer:u,offset:p,size:f}=c;u!==null?p===0&&f===0?r.bindBufferBase(zt.UNIFORM_BUFFER,l,u.glName):r.bindBufferRange(zt.UNIFORM_BUFFER,l,u.glName,p,f):r.bindBufferBase(zt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?r.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):r.bindBuffer(zt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?r.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):r.bindBuffer(zt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?r.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):r.bindBuffer(zt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?r.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):r.bindBuffer(zt.COPY_WRITE_BUFFER,null),r.bindFramebuffer(Oo.READ_FRAMEBUFFER,null),r.readBuffer(r.BACK),this._state.readFramebuffer&&(r.bindFramebuffer(Oo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),r.readBuffer(Qc.COLOR_ATTACHMENT0)),r.bindFramebuffer(Oo.DRAW_FRAMEBUFFER,((s=this._state.drawFramebuffer)==null?void 0:s.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,i.bindFramebuffer(Oo.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}i.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),i.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),i.bindRenderbuffer(i.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?i.enable(this.gl.BLEND):i.disable(this.gl.BLEND),i.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),i.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),i.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),i.clearDepth(this._state.clearDepth),i.clearStencil(this._state.clearStencil),i.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),i.cullFace(this._state.cullFace),i.depthFunc(this._state.depthFunction),i.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),i.depthMask(this._state.depthWrite),i.frontFace(this._state.frontFace),i.lineWidth(1),this._state.faceCulling===!0?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),i.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),i.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),i.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),i.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){i.activeTexture(S6+l),i.bindTexture(Cn.TEXTURE_2D,null),i.bindTexture(Cn.TEXTURE_CUBE_MAP,null),this.type===xi.WEBGL2&&(i.bindTexture(Cn.TEXTURE_3D,null),i.bindTexture(Cn.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];c!=null&&i.bindTexture(c.descriptor.target,c.glName)}i.activeTexture(S6+this._state.activeTexture);const n=this._state.viewport;i.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===xi.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function Yl(t,e,i,r){return e?r!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function Qse(t,e){switch(t){case Ht.POINTS:return 2*e;case Ht.TRIANGLES:return e/3;case Ht.TRIANGLE_STRIP:case Ht.TRIANGLE_FAN:return e-2;default:return 0}}let uht=class extends cht{constructor(e,i,r){super(e,i),this.newCache=r,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}bindTechnique(e,i,r,n){return this.useProgram(e.program),e.bindPipelineState(this,r==null?void 0:r.slot,!!n),e.program.bindPass(i,r),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new p2e(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},l2=class extends ke{constructor(e,i,r){super({}),this._stage=e,this._techniqueRepository=i,this._rctx=r,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new os,this._frameTask=e.view.resourceController.scheduler.registerTask(Dt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(An.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(vq,new bq)),this._textureTechnique}acquire(e){const i=this._textures.get(e);return i?(i.ref(),i.loadingPromise??i):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(i=>{const r=i.texture.frameUpdate(i.previousToken);r>=0&&r!==i.previousToken&&(i.previousToken=r,e=!0)}),e&&this.events.emit("changed",Dn.BACKGROUND)}_createNewRef(e){const i=this._stage.getObject(e);if(i==null)return xt(i!==void 0),null;const r=i.events.on("unloaded",()=>{r.remove(),this._onTextureUnloaded(e)}),n=new hht(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&i.unload()})});return this._textures.set(e,n),n.ref(),i.glTexture!=null?(this._updateGLTexture(n,i.glTexture),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=i.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),i.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:i,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,ms(l)||ye.getLogger(this).error(l),null);return Pu(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,i){e.glTexture=i,this.events.emit("changed",Dn.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([m()],l2.prototype,"_loadingCount",void 0),d([m()],l2.prototype,"_frameTask",void 0),d([m()],l2.prototype,"updating",null),l2=d([J("esri.views.3d.webgl-engine.lib.TextureRepository")],l2);let hht=class{constructor(e,i){this.id=e,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(ye.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function dht(t,e){return new dve(i=>dqe(i,t),i=>i,e)}let vA=class extends ke{constructor(){super(...arguments),this._passParameters=new pht,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=et(this._passParameters.waveNormal),this._passParameters.wavePertubation=et(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return _g.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return _g.LOADED;const i=new Di;return i.samplingMode=qt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=!0,i.maxAnisotropy=8,++this._loading,kg(dr("esri/images/materials/water/normals.jpg")).then(r=>this._passParameters.waveNormal=new Wt(e,{...i,width:r.width,height:r.height},r)).catch(r=>ye.getLogger(this).error("Failed to load water material normal texture.",r)).finally(()=>--this._loading),++this._loading,kg(dr("esri/images/materials/water/perturbation.jpg")).then(r=>this._passParameters.wavePertubation=new Wt(e,{...i,width:r.width,height:r.height},r)).catch(r=>ye.getLogger(this).error("Failed to load water material pertubation texture.",r)).finally(()=>--this._loading),_g.LOADING}};d([m()],vA.prototype,"_loading",void 0),d([m({type:Boolean,readOnly:!0})],vA.prototype,"updating",null),vA=d([J("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],vA);let pht=class extends wr{};const eoe=2048,fht=1.5,mht=8;function ght(t,e){const{format:i,quality:r,rotation:n,disableDecorations:s}=t||{},o=pZ(t,e.padding),a=Tht(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=xht(t,a),u=Eht(i),p=Mht[u];return{format:u,quality:$e(r??p,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function _ht(t,e){const i=ght(t,e),r=i.area,n=i.width/r.width,s=pZ(i,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*n+o),p=Math.floor(c*n+a),f=t&&t.layers?t.layers:[],y=i.ignoreBackground,v=i.ignorePadding;return{framebufferWidth:u,framebufferHeight:p,region:{x:Math.floor(r.x*n)+s.left,y:Math.floor(r.y*n)+s.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:n,layers:f,disableDecorations:i.disableDecorations,ignoreBackground:y,ignorePadding:v,objectAndLayerIdColor:!1}}function YU(t,e,i){const{ctx:r,canvas:n}=y2e(t,i),s=r.getImageData(0,0,t.width,t.height),o=vht(n,e);return v2e(n),{dataUrl:o,data:s}}function JU(t,e){const{ctx:i,canvas:r}=y2e(t,e),n=i.getImageData(0,0,t.width,t.height);return v2e(r),n}function y2e(t,e){const i=yht();e.premultipliedAlpha&&Pht(t),i.width=t.width,i.height=t.height;const r=i.getContext("2d",{willReadFrequently:!0});return r.putImageData(t,0,0),e.flipY&&Aht(r),{ctx:r,canvas:i}}function v2e(t){t.width=0,t.height=0}function yht(){return KU==null&&(KU=document.createElement("canvas")),KU}let KU=null;function vht(t,e){const i=Oht[e.format],r=e.quality/100;return t.toDataURL(i,r)}function bht(t,e,i,r=0,n=0,s=t.width-r,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:u,data:p}=e,f=s/c,y=o/u,v=Math.ceil(f/2),b=Math.ceil(y/2),x=t.width;for(let S=0;S<u;S++)for(let P=0;P<c;P++){const C=4*(P+(a?u-S-1:S)*c);let R=0,N=0,$=0,k=0,B=0,W=0;const Z=(S+.5)*y;for(let K=Math.floor(S*y);K<(S+1)*y;K++){const X=Math.abs(Z-(K+.5))/b,ae=(P+.5)*f,re=X*X;for(let ee=Math.floor(P*f);ee<(P+1)*f;ee++){const oe=Math.abs(ae-(ee+.5))/v,U=Math.sqrt(re+oe*oe);if(U>=1)continue;let V=2*U*U*U-3*U*U+1;const H=4*(r+ee+(n+K)*x);W+=V*l[H+3],N+=V,!i&&l[H+3]<255&&(V=V*l[H+3]/255),$+=V*l[H],k+=V*l[H+1],B+=V*l[H+2],R+=V}}p[C]=$/R,p[C+1]=k/R,p[C+2]=B/R,p[C+3]=W/N}return e}function wht(t,e,i){if(!e)return t;const{framebufferWidth:r,framebufferHeight:n,pixelRatio:s,region:o}=t,a=pZ(t,i),l=a.left+a.right,c=a.top+a.bottom,u=r-l,p=n-c,f=Math.min(mht,Math.min((eoe-l)/u,(eoe-c)/p));return f<fht?t:{...t,framebufferWidth:Math.round(u*f)+l,framebufferHeight:Math.round(p*f)+c,pixelRatio:s*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:r,height:n}}}function xht(t,e){if(!t)return e;const i=t.width,r=t.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return e;const n=e.width/e.height;return r==null?{width:Math.floor(i),height:Math.floor(i/n)}:{width:Math.floor(r*n),height:Math.floor(r)}}function Tht(t,e){const i={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(i.x=Math.floor(t.area.x)),t.area.y!=null&&(i.y=Math.floor(t.area.y));const r=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(i.width=e.width-i.x,i.height=e.height-i.y,r!=null&&n!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,n);else if(r==null&&n!=null){const s=Math.min(i.width,r);i.height=s/i.width*i.height,i.width=s}else if(r!=null&&n==null){const s=Math.min(i.height,n);i.width=s/i.height*i.width,i.height=s}}return Sht(Cht(i,t),e)}function Sht(t,e){const i=Math.floor(Math.max(t.x,0)),r=Math.floor(Math.max(t.y,0)),n={x:i,y:r,width:Math.floor(Math.min(t.width,e.width-i)),height:Math.floor(Math.min(t.height,e.height-r))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function Cht(t,e){if(!e||e.width==null||e.height==null)return t;const i=e.width/e.height,r=t.width/t.height;if(r===i)return t;if(r<i){const s=Math.floor(t.height*i);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/i);return t.y-=(n-t.height)/2,t.height=n,t}function pZ(t,e){return!e||t&&t.ignorePadding?$ht:e}function Eht(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return Rht}}function Aht(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function Pht(t){const e=t.data,i=e.length;for(let r=0;r<i;r+=4){const n=e[r+3];if(n!==255&&n>0){const s=255/n;e[r]=e[r]*s,e[r+1]=e[r+1]*s,e[r+2]=e[r+2]*s}}}const Oht={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},toe=98,Rht="png",Mht={png:100,jpg:toe,jpeg:toe},$ht={top:0,right:0,bottom:0,left:0};let Iht=class{constructor(e,i){this.parameters=e,this.frameHasDecorations=i}},Lht=class{constructor(e,i,r,n){this._rctx=e,this._renderFunctions=i,this._forceCameraHook=r,this._disposeOffscreenBuffers=n,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(Dn.BACKGROUND);const i=sa();return this._screenshotQueue.push({settings:e,resolver:i}),i.promise}update(e,i){for(const r of this._screenshotQueue){if(this._rctx==null){r.resolver.reject();continue}const n={...r.settings,pixelRatio:r.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,i);r.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,i,r){e.width=i.width,e.height=i.height;const n=e.getContext("2d"),s=r.pixelRatio;return n.save(),n.translate(0,i.height),n.scale(1,-1),r.region&&n.translate(-r.region.x,-r.region.y),n.scale(s,s),i=this._renderFunctions.renderOverlay(e,i),n.restore(),i}_readbackScreenshot(e,i){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},i):this._readbackScreenshotImmediate(e,i)}_readbackScreenshotResampled(e,i){const{framebufferWidth:r,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=Xk(r,n,a);this._rctx.gl.readPixels(0,0,r,n,Gt.RGBA,bt.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=Xk(s.width,s.height,a);return bht(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,i){const{framebufferHeight:r,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=Xk(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,r-(n.y+n.height),n.width,n.height,Gt.RGBA,bt.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,i,r){let n=null;const s=e.parameters.camera,o={width:i.framebufferWidth,height:i.framebufferHeight};I1(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=i.disableDecorations&&e.frameHasDecorations,c=o.width!==s.fullWidth||o.height!==s.fullHeight,u=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||u||i.objectAndLayerIdColor,f=i.objectAndLayerIdColor?new Rs(this._rctx,new Di(o.width,o.height),new SD(hs.DEPTH_STENCIL,o.width,o.height)):null;if(p){const x=s.clone();if(i.ignorePadding){const N=G3(x.padding);for(let $=0;$<4;$++)N[$]=Math.round(N[$]/x.pixelRatio*i.pixelRatio);x.padding=N}x.fullWidth=o.width,x.fullHeight=o.height,x.pixelRatio=i.pixelRatio;const S=s.fovX-x.fovX,P=s.fovY-x.fovY;S<0&&S<P?x.fovX=s.fovX:P<0&&P<S&&(x.fovY=s.fovY);const C={camera:x,contentCamera:x,mode:Ji.IDLE,alignPixelEnabled:!0,contentPixelRatio:x.pixelRatio};this._forceCameraHook(C),a=!0,n=new Rs(this._rctx,new Di(o.width,o.height),new SD(hs.DEPTH_STENCIL,o.width,o.height));const R=i.disableDecorations?wb.OFF:wb.ON;this._renderFunctions.renderScene(n,f,C,R,r),this._disposeOffscreenBuffers()}const y=()=>{this._rctx.bindFramebuffer(null),et(n)},v=this._readbackScreenshot(i,y);y();let b=null;if(i.objectAndLayerIdColor){const x=()=>{this._rctx.bindFramebuffer(null),et(f)};this._rctx.bindFramebuffer(f),b=this._readbackScreenshot(i,x),this._rctx.bindFramebuffer(null),x()}if(p&&!this._rctx.contextAttributes.alpha)for(let x=3;x<v.data.length;x+=4)v.data[x]=255;if(b&&!this._rctx.contextAttributes.alpha)for(let x=3;x<b.data.length;x+=4)b.data[x]=255;return a&&this._forceCameraHook(e.parameters),[v,b]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},io=class extends ke{constructor(e){super({}),this.events=new os,this.waterTextureRepository=new vA,this._magnifierHelper=new a2,this.objectAndLayerIdRenderHelper=ge("enable-feature:objectAndLayerId-rendering")?new Dlt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([Pe(()=>{var n;return(n=this.waterTextureRepository)==null?void 0:n.updating},()=>this.requestRender(),ar),Pe(()=>e.view.qualityProfile,n=>{var s;return(s=this.renderer)==null?void 0:s.updateRenderFeature(n)},qn),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:i}=e.view.resourceController;this.stippleTextureRepository=iqe(this._rctx,i),this.markerTextureRepository=dht(this._rctx,i),this._shaderTechniqueRepository=new ove({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new l2(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",n=>this.requestRender(n))),this._materialRepository=new ave(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new plt(this._rctx,this._shaderTechniqueRepository),this.renderer=new tc(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,n=>this.requestRender(n));const r={renderScene:(n,s,o,a,l)=>this.renderer.render(n,s,o,a,l),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s)=>e.options.screenshot.renderOverlay(n,s)};this._screenshotManager=new Lht(this._rctx,r,n=>this.events.emit("force-camera-for-screenshot",n),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Qr(this._frameTask),this._shaderTechniqueRepository=Je(this._shaderTechniqueRepository)}requestRender(e=Dn.UPDATE){this._needsRender=!0,e===Dn.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(i=>i[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,i,r,n,s,o=s){const a=n.constrainWindowSize(i,r,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const p=ylt(4*u,l,n.nearFar);c>p&&p!==n.nearFar[0]&&p!==n.nearFar[1]&&(c=p)}if(e!=null){const u=e.pickDepth(i*n.pixelRatio,r*n.pixelRatio,n);u!=null&&c>u&&u!==n.nearFar[0]&&u!==n.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const i=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<i)&&(this._tmpDepthBuffer=new Uint8Array(i)),this._tmpDepthBuffer}async reloadShaders(){uwe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const i=e.view.state;let r=!1,n=Dn.BACKGROUND,s=!1;const o={preRender:({time:a})=>{r=this.updating,n=this._needsUpdate?Dn.UPDATE:Dn.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||i.forcedAnimationTime!=null||r||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new i_e(i.camera,c,i.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(Dn.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&i.camera.fullWidth>0&&i.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,i,wb.ON,a),s=!0,l&&this.renderer.hasReflections&&(this.requestRender(Dn.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new Iht(i,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{s&&(this.renderer.finish(i.mode===Ji.IDLE?n:Dn.UPDATE),s=!1)}};this._frameTask=cT(o)}_initializeContext(e){const i=e.options;this._canvas=i.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const r={alpha:i.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:i.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:i.preserveDrawingBuffer??!1},n=d6e("3d",this._canvas,r);n!=null?(this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!i.alpha&&this._rctx.contextAttributes.alpha&&ye.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&ge("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):ye.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,i){const r={disabledExtensions:i.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:i.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>i.view.resourceController.memoryController.newCache(s,o);return new uht(e,r,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new elt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};d([m({type:Boolean,readOnly:!0})],io.prototype,"updating",null),d([m({autoDestroy:!0})],io.prototype,"_rctx",void 0),d([m({autoDestroy:!0})],io.prototype,"_container",void 0),d([m({autoDestroy:!0})],io.prototype,"_canvas",void 0),d([m({autoDestroy:!0})],io.prototype,"stippleTextureRepository",void 0),d([m({autoDestroy:!0})],io.prototype,"markerTextureRepository",void 0),d([m({autoDestroy:!0})],io.prototype,"waterTextureRepository",void 0),d([m({autoDestroy:!0})],io.prototype,"_magnifierHelper",void 0),d([m({readOnly:!0})],io.prototype,"objectAndLayerIdRenderHelper",void 0),d([m({autoDestroy:!0})],io.prototype,"_textureRepository",void 0),d([m({autoDestroy:!0})],io.prototype,"_compositingHelper",void 0),d([m({autoDestroy:!0,readOnly:!0})],io.prototype,"renderer",void 0),d([m({autoDestroy:!0})],io.prototype,"_screenshotManager",void 0),d([m()],io.prototype,"componentObjectCollection",null),d([m({autoDestroy:!0})],io.prototype,"_componentObjectCollection",void 0),d([m()],io.prototype,"_needsUpdate",void 0),d([m()],io.prototype,"_needsWaterReflectionUpdate",void 0),io=d([J("esri.views.3d.webgl-engine.parts.RenderView")],io);let Yc=class extends ke{constructor(e){super(e),this._model=new cL,this._layers=new ri,this._asyncChangeSet=new Z7,this._syncChangeSet=new Z7,this._layerSyncSet=new Set}initialize(){this._set("renderView",new io(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Dt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),rN(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),rN(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var i,r;e!=null&&((i=this._model)==null||i.removeMany(e),(r=this.renderView)==null||r.requestRender())}async load(e,i){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(r=>r.glTexture==null).map(r=>this.schedule(()=>this._model.has(r)?r.load(this.renderView.renderingContext):null),i)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,i){this._model.forEachOfType(e,i)}handleEvent(e,i){this.destroyed||(this._model.dirtySet[e](i),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const i=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{if(e.done)return;const n=this._layerSyncSet.has(r.id)||r.updatePolicy===Q_.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;i.commitLayer(r.id,s),this._layerSyncSet.delete(r.id),s.empty||(this.renderer.modify(s,n?Qa:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Qa),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(r=>{e.done||this._layerSyncSet.has(r.id)||r.updatePolicy!==Q_.ASYNC||(i.commitLayer(r.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(i=>{(this._layerSyncSet.has(i.id)||i.updatePolicy===Q_.SYNC)&&(e.commitLayer(i.id,this._syncChangeSet),this._layerSyncSet.delete(i.id))});for(const i of this._layerSyncSet)e.commitLayer(i,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Qa),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,Qa),this.renderView.requestRender())}schedule(e,i){return this._frameTask.schedule(e,i)}reschedule(e,i){return this._frameTask.reschedule(e,i)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,Qa))}addRenderPlugin(e,i,r){const n=this.renderer.renderPlugins.add(e,i,r),s=()=>{kie(i)&&this.view.sceneIntersectionHelper.addIntersectionHandler(i)};if(Pu(n))return n.then(s);s()}removeRenderPlugin(e){this.destroyed||(kie(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:i=>e._model.test.content.filter(r=>r.type===i).length,model:e._model}}};Yc.DebugSettings={endFrameContentValidation:!1},d([m({constructOnly:!0})],Yc.prototype,"view",void 0),d([m({constructOnly:!0})],Yc.prototype,"options",void 0),d([m({readOnly:!0})],Yc.prototype,"viewingMode",null),d([m({constructOnly:!0})],Yc.prototype,"container",void 0),d([m({readOnly:!0})],Yc.prototype,"updating",null),d([m({constructOnly:!0})],Yc.prototype,"_model",void 0),d([m({autoDestroy:!0})],Yc.prototype,"renderView",void 0),d([m({readOnly:!0})],Yc.prototype,"renderer",null),d([m({readOnly:!0})],Yc.prototype,"running",null),Yc=d([J("esri.views.3d.webgl-engine.Stage")],Yc);let EOt=class extends d4{constructor(e,i,r,n){super(i,r),this.point=e,this.createGraphic=n}};function b2e(t){return bp(t)&&t.intersector===sn.PCL&&!!t.target}let POt=class extends Cge{constructor(e,i,r,n,s){super(e),this.layerUid=e,this.sublayerUid=i,this.nodeIndex=r,this.componentIndex=n,this.triangleNr=s}},ROt=class extends d4{constructor(e,i,r){super(i,null),this.point=e,this.createVoxelGraphic=r}};function sF(t){return bp(t)&&t.intersector===sn.I3S&&!!t.target}function w2e(t){return bp(t)&&t.intersector===sn.VOXEL&&!!t.target}function ioe(t,e){var i,r;return p4(t)||f4(t)?_3((i=t.target)==null?void 0:i.object,e):Iqe(t)?(r=e.map)==null?void 0:r.ground:b2e(t)||sF(t)||Pve(t)||w2e(t)?_3(t.target,e):null}function $Ot(t,e){const i=jV(t,e);return i!=null&&i.type==="graphic"?i.graphic:null}function jV(t,e){var i;if(t==null)return null;if(p4(t)||f4(t))return roe((i=t.target)==null?void 0:i.object,e);if(b2e(t)){const r=t.target.createGraphic();return{type:"graphic",graphic:r,layer:r.layer}}if(w2e(t)){const r=t.target.createVoxelGraphic();return{type:"graphic",graphic:r,layer:r.layer}}return Pve(t)||Nq(t)?roe(t.target,e):sF(t)?Dht(t.target,e):null}function roe(t,e){if(t==null||t.graphicUid==null)return null;const i=_3(t,e);if(i==null)return null;if(i===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const r=e.allLayerViews.find(n=>n.layer===i);return!r||r.suspended||t.graphicUid==null?null:"getHit"in r?r.getHit(t.graphicUid):null}function Dht(t,e){const i=_3(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?Fht(r.getGraphicFromIntersectorTarget(t)):null}function Nht(t,e){const i=_3(t,e);if(i==null)return null;const r=e.allLayerViews.find(n=>n.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(t):null}function Fht(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function _3(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function IOt(t,e){if(p4(t)||f4(t))return gg(t.target.object.boundingVolumeWorldSpace.bounds);if(Nq(t)){Yhe(D$,t.transformation);const i=Math.max(D$[0],D$[1],D$[2]);return t.target.baseBoundingSphere.radius*i}return sF(t)?Eh(Nht(t.target,e),i=>.5*zue(i)):null}function LOt(t){return!p4(t)&&!f4(t)&&(Nq(t)?t.target.numLodLevels>1:!!sF(t))}const D$=I();async function kht(t,e){if(t.type==="2d")return t.hitTest(e);const i=await t.hitTest(e);if(i.results.length===0)return i;const r=(i.results[0].distance??0)*(1+Uht),n=i.results.findIndex(s=>(s.distance??0)>r);return n!==-1&&(i.results=i.results.slice(0,n)),i}const Uht=.05;function DOt(t){return t&&typeof t.highlight=="function"}function zht(t){return t&&typeof t.maskOccludee=="function"}function NOt(t,e,i){return t==null||t>i&&(e===0||t<e)}function FOt(t,e){return t!=null&&t>0||e!=null&&e>0}function kOt(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let QU,e8;function Bht(t){const e=eme(t);for(;e.length>1;){const i=noe(e.shift());if(i.available)return i}return noe(e.shift())}function noe(t){switch(t){case xi.WEBGL1:return Vht();case xi.WEBGL2:return Ght()}}function Vht(){return QU||(QU=Wht()),QU}function Ght(){return e8||(e8=qht()),e8}let x2e=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},jht=class extends x2e{constructor(){super(...arguments),this.type=xi.WEBGL1}},Hht=class extends x2e{constructor(){super(...arguments),this.type=xi.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function T2e(t,e){if(t===xi.WEBGL1&&typeof WebGLRenderingContext>"u"||t===xi.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const i=document.createElement("canvas");if(!i)return null;let r=pB(i,t,{failIfMajorPerformanceCaveat:!0});if(r==null&&(r=pB(i,t),r!=null&&(e.majorPerformanceCaveat=!0)),r==null)return r;if(t===xi.WEBGL1){const s=r.getParameter(r.VERSION),o=s==null?void 0:s.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),r}function Wht(){const t=new jht,e=T2e(xi.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function qht(){const t=new Hht,e=T2e(xi.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function Zht(t){const e=Bht(t);if(!e.available)return new ce("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new ce("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new ce("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new ce("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===xi.WEBGL1){if(!e.supportsElementIndexUint)return new ce("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new ce("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new ce("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function Xht(t){return t&&"nodeType"in t}function Yht(t){return t&&typeof t.render=="function"}const soe={component:"esri-component"};let u1=class extends ke{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const i=this._get("node");e!==i&&(e&&e.classList.add(soe.component),i&&i.classList.remove(soe.component),this._set("node",e))}castNode(e){var i;return(i=this.widget)==null||i.destroy(),e?typeof e=="string"||Xht(e)?(this._set("widget",null),R5(e)):(Yht(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([m({dependsOn:[]})],u1.prototype,"id",null),d([m()],u1.prototype,"node",null),d([Sn("node")],u1.prototype,"castNode",null),d([m({readOnly:!0})],u1.prototype,"widget",void 0),u1=d([J("esri.views.ui.Component")],u1);const fL=u1,S2e="calcite-mode-";function Jht(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function Kht(){return Jht().startsWith("dark")}function Qht(){return`${S2e}${Kht()?"dark":"light"}`}function edt(t){tdt(t),t.classList.add(Qht())}function tdt(t){Array.from(t.classList).forEach(e=>{e.startsWith(S2e)&&t.classList.remove(e)})}const idt={left:0,top:0,bottom:0,right:0},C2e={bottom:30,top:15,right:15,left:15},Lm="esri-ui",Jl={ui:Lm,corner:`${Lm}-corner`,innerContainer:`${Lm}-inner-container`,manualContainer:`${Lm}-manual-container`,cornerContainer:`${Lm}-corner-container`,topLeft:`${Lm}-top-left`,topRight:`${Lm}-top-right`,bottomLeft:`${Lm}-bottom-left`,bottomRight:`${Lm}-bottom-right`};function rdt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function N$(t){return t===0?"0":`${t}px`}function t8(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function i8(t,{top:e,bottom:i,left:r,right:n}){t.style.top=e,t.style.bottom=i,t.style.left=r,t.style.right=n}let pf=class extends os.EventedAccessor{constructor(t){super(t),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=ip(),this.view=null,this._applyViewPadding=()=>{const e=this.container;e&&i8(e,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const e=this._innerContainer;e&&i8(e,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([Pe(()=>{var t;return[(t=this.view)==null?void 0:t.padding,this.container]},this._applyViewPadding,ar),Pe(()=>this.padding,this._applyUIPadding,ar),Pe(()=>[this.container,this._locale],([t,e])=>{t&&t.setAttribute("lang",e)},ar),fce(t=>{this._locale=t})])}destroy(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0,this._componentMap.clear()}set container(t){const e=this._get("container");t!==e&&(t&&(t.classList.add(Jl.ui),edt(t),this._attachContainers(t)),e&&(e.classList.remove(Jl.ui),i8(e,{top:"",bottom:"",left:"",right:""}),Fhe(e)),this._set("container",t))}get height(){var n;const t=((n=this.view)==null?void 0:n.height)??0;if(t===0)return t;const e=this._getViewPadding(),{top:i,bottom:r}=e;return Math.max(t-i-r,0)}get padding(){return this._get("padding")}set padding(t){this._overrideIfSome("padding",t)}castPadding(t){return typeof t=="number"?{bottom:t,top:t,right:t,left:t}:{...C2e,...t}}get width(){var n;const t=((n=this.view)==null?void 0:n.width)??0;if(t===0)return t;const e=this._getViewPadding(),{left:i,right:r}=e;return Math.max(t-i-r,0)}add(t,e){let i,r,n;if(Array.isArray(t))return void t.forEach(o=>this.add(o,e));const s=t8(t);s&&({index:i,position:e,component:t,key:r}=s),e&&typeof e=="object"&&({index:i,key:r,position:e,internal:n}=e),!t||e&&!this._isValidPosition(e)||this._add(t,e,i,r,n)}remove(t,e){var r;if(!t)return;if(Array.isArray(t))return t.map(n=>this.remove(n,e));const i=this._find(t);if(i){if(this._componentMap.has(t)&&((r=this._componentMap.get(t))==null?void 0:r.key)!==e)return;const n=this._components.indexOf(i),s=i.node.parentNode;return s==null||s.removeChild(i.node),this._componentMap.delete(t),this._components.splice(n,1)[0]}}empty(t,e={removeInternal:!1}){if(Array.isArray(t)){for(const n of t)this.empty(n,e);return}const i=this._positionNameToContainerLookup[t??"manual"],r=Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(n=>{var s;return n==null?!1:!(((s=this._componentMap.get(n))==null?void 0:s.internal)??!1)||e.removeInternal});for(const n of r)this.remove(n)}move(t,e){if(Array.isArray(t)&&t.forEach(s=>this.move(s,e)),!t)return;let i;const r=t8(t)||t8(e);if(r&&(i=r.index,e=r.position,t=r.component||t),e&&!this._isValidPosition(e))return;const n=this.remove(t);n&&this.add(n,{position:e,index:i})}find(t){if(!t)return null;const e=this._findById(t);return e&&(e.widget||e.node)}getComponents(t,e={includeInternal:!1}){return t?Array.isArray(t)?t.map(i=>this._getComponentsAtPosition(i,e)).flat():this._getComponentsAtPosition(t,e):this._components.filter(i=>{var r;return e.includeInternal||!((r=this._componentMap.get(i))!=null&&r.internal)}).map(({widget:i,node:r})=>i??r)}getPosition(t){for(const e in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[e].contains(t))return e;return null}_add(t,e,i,r,n){t instanceof fL||(t=new fL({node:t})),this._place({component:t,position:e,index:i}),this._components.push(t),this._componentMap.set(t,{key:r,internal:n})}_find(t){return t?t instanceof fL?this._findByComponent(t):typeof t=="string"?this._findById(t):this._findByNode(t.domNode||t):null}_getViewPadding(){var t;return((t=this.view)==null?void 0:t.padding)??idt}_attachContainers(t){t.appendChild(this._innerContainer),t.appendChild(this._manualContainer)}_initContainers(){const t=document.createElement("div");t.classList.add(Jl.innerContainer,Jl.cornerContainer);const e=document.createElement("div");e.classList.add(Jl.innerContainer,Jl.manualContainer);const i=document.createElement("div");i.classList.add(Jl.topLeft,Jl.corner),t.appendChild(i);const r=document.createElement("div");r.classList.add(Jl.topRight,Jl.corner),t.appendChild(r);const n=document.createElement("div");n.classList.add(Jl.bottomLeft,Jl.corner),t.appendChild(n);const s=document.createElement("div");s.classList.add(Jl.bottomRight,Jl.corner),t.appendChild(s),this._innerContainer=t,this._manualContainer=e;const o=PNe();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":n,"bottom-right":s,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?s:n,"bottom-trailing":o?n:s},this._positionNameToContainerLookup={manual:e,...this._cornerNameToContainerLookup}}_isValidPosition(t){return!!this._positionNameToContainerLookup[t]}_place(t){const e=t.position??"manual",{component:i,index:r}=t,n=this._positionNameToContainerLookup[e],s=r!=null&&r>-1;if(rdt(i.widget)&&i.widget.startup(),!s)return void n.appendChild(i.node);const o=Array.from(n.children);if(r===0)return void(n.firstChild?sY(i.node,n.firstChild):n.appendChild(i.node));r>=o.length?n.appendChild(i.node):sY(i.node,o[r])}_toPixelPosition(t){return{top:N$(t.top),left:N$(t.left),right:N$(t.right),bottom:N$(t.bottom)}}_findByComponent(t){return this._components.find(e=>e===t)??null}_findById(t){return this._components.find(({id:e})=>e===t)??null}_findByNode(t){return this._components.find(({node:e})=>e===t)??null}_getComponentsAtPosition(t,e){const i=this._positionNameToContainerLookup[t];return Array.prototype.slice.call(i.children).map(r=>this._findByNode(r)).filter(w3).filter(r=>{var n;return e.includeInternal||!((n=this._componentMap.get(r))!=null&&n.internal)}).map(({widget:r,node:n})=>r??n)}};d([m()],pf.prototype,"_locale",void 0),d([m()],pf.prototype,"container",null),d([m()],pf.prototype,"height",null),d([m({value:C2e})],pf.prototype,"padding",null),d([Sn("padding")],pf.prototype,"castPadding",null),d([m()],pf.prototype,"view",void 0),d([m()],pf.prototype,"width",null),pf=d([J("esri.views.ui.UI")],pf);const ndt=pf,sdt="randomUUID"in crypto;function E2e(){if(sdt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=i=>t[i].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function GOt(){return`{${E2e()}}`}const odt={handleInterceptedEvent:(t,e,i,r)=>(t.scheduleRender(),e.properties[`on${r.type}`].apply(e.properties.bind||i,[r]))},adt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,i)=>{t.style[e]=i}},ldt=t=>({...adt,...t}),cdt=(t,e)=>{const i=[];for(;t&&t!==e;)i.push(t),t=t.parentNode;return i},udt=(t,e)=>t.find(e),ooe=(t,e,i=!1)=>{let r=t;return e.forEach((n,s)=>{const o=r!=null&&r.children?udt(r.children,a=>a.domNode===n):void 0;i&&!o&&s!==e.length-1||(r=o)}),r},hdt=t=>{let e;const i={...odt,...t},r=ldt(i),n=r.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(f,y,v)=>{var S;let b;r.eventHandlerInterceptor=(P,C,R,N)=>function($){let k;n("domEvent",$);const B=cdt($.currentTarget,b.domNode),W=B.some(K=>{var X;return customElements.get((X=K==null?void 0:K.tagName)==null?void 0:X.toLowerCase())});if($.eventPhase===Event.CAPTURING_PHASE||!W)B.reverse(),k=ooe(b.getLastRender(),B);else{const K=$.composedPath(),X=K.slice(K.indexOf($.currentTarget),K.indexOf(b.domNode)).filter(ae=>ae.getRootNode()===ae.ownerDocument).reverse();k=ooe(b.getLastRender(),X,!0)}let Z;return k&&(Z=i.handleInterceptedEvent(e,k,this,$)),n("domEventProcessed",$),Z},(S=i.postProcessProjectionOptions)==null||S.call(i,r);const x=v();b=f(y,x,r),l.push(b),c.push(v),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(b,x)};let p=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let f=0;f<l.length;f++){const y=c[f]();n("rendered",void 0),l[f].update(y),n("patched",void 0)}n("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),e={renderNow:p,scheduleRender:()=>{s||a||(s=requestAnimationFrame(p))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,y)=>{u(V_.append,f,y)},insertBefore:(f,y)=>{u(V_.insertBefore,f,y)},merge:(f,y)=>{u(V_.merge,f,y)},replace:(f,y)=>{u(V_.replace,f,y)},detach:f=>{for(let y=0;y<c.length;y++)if(c[y]===f)return c.splice(y,1),l.splice(y,1)[0];throw new Error("renderFunction was not found")}},e},c2={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let u2,A2e,oF,P2e=!1,MN=!1,fZ=!1,nu=!1,aoe=null,HV=!1;const ddt=t=>{const e=new URL(t,oa.$resourcesUrl$);return e.origin!==vO.location.origin?e.href:e.pathname},pdt=t=>oa.$resourcesUrl$=t,Nb=(t,e="")=>()=>{},loe="http://www.w3.org/1999/xlink",coe={},fdt="http://www.w3.org/2000/svg",mdt="http://www.w3.org/1999/xhtml",gdt=t=>t!=null,mZ=t=>(t=typeof t,t==="object"||t==="function");function _dt(t){var e,i,r;return(r=(i=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||i===void 0?void 0:i.getAttribute("content"))!==null&&r!==void 0?r:void 0}const O2e=(t,e,...i)=>{let r=null,n=null,s=null,o=!1,a=!1;const l=[],c=p=>{for(let f=0;f<p.length;f++)r=p[f],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof t!="function"&&!mZ(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?$N(null,r):r),a=o)};if(c(i),e){e.key&&(n=e.key),e.name&&(s=e.name);{const p=e.className||e.class;p&&(e.class=typeof p!="object"?p:Object.keys(p).filter(f=>p[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,bdt);const u=$N(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=n,u.$name$=s,u},$N=(t,e)=>{const i={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return i.$attrs$=null,i.$key$=null,i.$name$=null,i},ydt={},vdt=t=>t&&t.$tag$===ydt,bdt={forEach:(t,e)=>t.map(uoe).forEach(e),map:(t,e)=>t.map(uoe).map(e).map(wdt)},uoe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),wdt=t=>{if(typeof t.vtag=="function"){const i=Object.assign({},t.vattrs);return t.vkey&&(i.key=t.vkey),t.vname&&(i.name=t.vname),O2e(t.vtag,i,...t.vchildren||[])}const e=$N(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},xdt=t=>Xdt.map(e=>e(t)).find(e=>!!e),Tdt=(t,e)=>t!=null&&!mZ(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,Sdt=t=>t,jOt=(t,e,i)=>{const r=Sdt(t);return{emit:n=>Cdt(r,e,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:n})}},Cdt=(t,e,i)=>{const r=oa.ce(e,i);return t.dispatchEvent(r),r},hoe=new WeakMap,Edt=(t,e,i)=>{let r=LN.get(t);Kdt&&i?(r=r||new CSSStyleSheet,typeof r=="string"?r=e:r.replaceSync(e)):r=e,LN.set(t,r)},Adt=(t,e,i,r)=>{var n;let s=R2e(e,i);const o=LN.get(s);if(t=t.nodeType===11?t:lp,o)if(typeof o=="string"){t=t.head||t;let a=hoe.get(t),l;if(a||hoe.set(t,a=new Set),!a.has(s)){{l=lp.createElement("style"),l.innerHTML=o;const c=(n=oa.$nonce$)!==null&&n!==void 0?n:_dt(lp);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(s)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return s},Pdt=t=>{const e=t.$cmpMeta$,i=t.$hostElement$,r=e.$flags$,n=Nb("attachStyles",e.$tagName$),s=Adt(i.shadowRoot?i.shadowRoot:i.getRootNode(),e,t.$modeName$);r&10&&(i["s-sc"]=s,i.classList.add(s+"-h"),r&2&&i.classList.add(s+"-s")),n()},R2e=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),doe=(t,e,i,r,n,s)=>{if(i!==r){let o=goe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=poe(i),u=poe(r);l.remove(...c.filter(p=>p&&!u.includes(p))),l.add(...u.filter(p=>p&&!c.includes(p)))}else if(e==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?t.style.setProperty(l,r[l]):t.style[l]=r[l])}else if(e!=="key")if(e==="ref")r&&r(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):goe(vO,a)?e=a.slice(2):e=a[2]+e.slice(3),i&&oa.rel(t,e,i,!1),r&&oa.ael(t,e,r,!1);else{const l=mZ(r);if((o||l&&r!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=r;else{const u=r??"";e==="list"?o=!1:(i==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),r==null||r===!1?(r!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(loe,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(r=r===!0?"":r,c?t.setAttributeNS(loe,e,r):t.setAttribute(e,r))}}},Odt=/\s/,poe=t=>t?t.split(Odt):[],M2e=(t,e,i,r)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||coe,o=e.$attrs$||coe;for(r in s)r in o||doe(n,r,s[r],void 0,i,e.$flags$);for(r in o)doe(n,r,s[r],o[r],i,e.$flags$)},IN=(t,e,i,r)=>{const n=e.$children$[i];let s=0,o,a,l;if(P2e||(fZ=!0,n.$tag$==="slot"&&(u2&&r.classList.add(u2+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=lp.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=lp.createTextNode("");else{if(nu||(nu=n.$tag$==="svg"),o=n.$elm$=lp.createElementNS(nu?fdt:mdt,n.$flags$&2?"slot-fb":n.$tag$),nu&&n.$tag$==="foreignObject"&&(nu=!1),M2e(null,n,nu),gdt(u2)&&o["s-si"]!==u2&&o.classList.add(o["s-si"]=u2),n.$children$)for(s=0;s<n.$children$.length;++s)a=IN(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?nu=!1:o.tagName==="foreignObject"&&(nu=!0)}return o["s-hn"]=oF,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=A2e,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[i],l&&l.$tag$===n.$tag$&&t.$elm$&&y3(t.$elm$,!1)),o},y3=(t,e)=>{oa.$flags$|=1;const i=t.childNodes;for(let r=i.length-1;r>=0;r--){const n=i[r];n["s-hn"]!==oF&&n["s-ol"]&&(L2e(n).insertBefore(n,gZ(n)),n["s-ol"].remove(),n["s-ol"]=void 0,fZ=!0),e&&y3(n,e)}oa.$flags$&=-2},$2e=(t,e,i,r,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===oF&&(o=o.shadowRoot);n<=s;++n)r[n]&&(a=IN(null,i,n,t),a&&(r[n].$elm$=a,o.insertBefore(a,gZ(e))))},I2e=(t,e,i,r,n)=>{for(;e<=i;++e)(r=t[e])&&(n=r.$elm$,F2e(r),MN=!0,n["s-ol"]?n["s-ol"].remove():y3(n,!0),n.remove())},Rdt=(t,e,i,r)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],u=e[l],p=r.length-1,f=r[0],y=r[p],v,b;for(;n<=l&&s<=p;)if(c==null)c=e[++n];else if(u==null)u=e[--l];else if(f==null)f=r[++s];else if(y==null)y=r[--p];else if(F$(c,f))h2(c,f),c=e[++n],f=r[++s];else if(F$(u,y))h2(u,y),u=e[--l],y=r[--p];else if(F$(c,y))(c.$tag$==="slot"||y.$tag$==="slot")&&y3(c.$elm$.parentNode,!1),h2(c,y),t.insertBefore(c.$elm$,u.$elm$.nextSibling),c=e[++n],y=r[--p];else if(F$(u,f))(c.$tag$==="slot"||y.$tag$==="slot")&&y3(u.$elm$.parentNode,!1),h2(u,f),t.insertBefore(u.$elm$,c.$elm$),u=e[--l],f=r[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(b=e[o],b.$tag$!==f.$tag$?v=IN(e&&e[s],i,o,t):(h2(b,f),e[o]=void 0,v=b.$elm$),f=r[++s]):(v=IN(e&&e[s],i,s,t),f=r[++s]),v&&L2e(c.$elm$).insertBefore(v,gZ(c.$elm$))}n>l?$2e(t,r[p+1]==null?null:r[p+1].$elm$,i,r,s,p):s>p&&I2e(e,n,l)},F$=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,gZ=t=>t&&t["s-ol"]||t,L2e=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,h2=(t,e)=>{const i=e.$elm$=t.$elm$,r=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(nu=s==="svg"?!0:s==="foreignObject"?!1:nu,s==="slot"||M2e(t,e,nu),r!==null&&n!==null?Rdt(i,r,e,n):n!==null?(t.$text$!==null&&(i.textContent=""),$2e(i,null,e,n,0,n.length-1)):r!==null&&I2e(r,0,r.length-1),nu&&s==="svg"&&(nu=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(i.data=o)},D2e=t=>{const e=t.childNodes;let i,r,n,s,o,a;for(r=0,n=e.length;r<n;r++)if(i=e[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){i.hidden=!0;break}}D2e(i)}},Wd=[],N2e=t=>{let e,i,r,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(i=e["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,n=e["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==e["s-hn"]&&(foe(i,n)?(s=Wd.find(u=>u.$nodeToRelocate$===i),MN=!0,i["s-sn"]=i["s-sn"]||n,s?s.$slotRefNode$=e:Wd.push({$slotRefNode$:e,$nodeToRelocate$:i}),i["s-sr"]&&Wd.map(u=>{foe(u.$nodeToRelocate$,i["s-sn"])&&(s=Wd.find(p=>p.$nodeToRelocate$===i),s&&!u.$slotRefNode$&&(u.$slotRefNode$=s.$slotRefNode$))})):Wd.some(u=>u.$nodeToRelocate$===i)||Wd.push({$nodeToRelocate$:i}));e.nodeType===1&&N2e(e)}},foe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",F2e=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(F2e)},Mdt=(t,e)=>{const i=t.$hostElement$,r=t.$cmpMeta$,n=t.$vnode$||$N(null,null),s=vdt(e)?e:O2e(null,null,e);oF=i.tagName,r.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=i[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=i.shadowRoot||i,u2=i["s-sc"],A2e=i["s-cr"],P2e=(r.$flags$&1)!==0,MN=!1,h2(n,s);{if(oa.$flags$|=1,fZ){N2e(s.$elm$);let o,a,l,c,u,p,f=0;for(;f<Wd.length;f++)o=Wd[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=lp.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Wd.length;f++)if(o=Wd[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){u=p;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}MN&&D2e(s.$elm$),oa.$flags$&=-2,Wd.length=0}},$dt=(t,e)=>{},_Z=(t,e)=>(t.$flags$|=16,$dt(t,t.$ancestorComponent$),tpt(()=>Idt(t,e))),Idt=(t,e)=>{const i=t.$hostElement$,r=Nb("scheduleUpdate",t.$cmpMeta$.$tagName$),n=i;let s;return e?s=oT(n,"componentWillLoad"):s=oT(n,"componentWillUpdate"),s=moe(s,()=>oT(n,"componentWillRender")),r(),moe(s,()=>Ldt(t,n,e))},Ldt=async(t,e,i)=>{const r=t.$hostElement$,n=Nb("update",t.$cmpMeta$.$tagName$);r["s-rc"],i&&Pdt(t);const s=Nb("render",t.$cmpMeta$.$tagName$);Ddt(t,e,r),s(),n(),Ndt(t)},Ddt=(t,e,i)=>{try{aoe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(c2.hasRenderFn||c2.reflect)&&(c2.vdomRender||c2.reflect)&&(c2.hydrateServerSide||Mdt(t,e))}catch(a){yO(a,t.$hostElement$)}return aoe=null,null},Ndt=t=>{const e=t.$cmpMeta$.$tagName$,i=t.$hostElement$,r=Nb("postUpdate",e),n=i;t.$ancestorComponent$,oT(n,"componentDidRender"),t.$flags$&64?(oT(n,"componentDidUpdate"),r()):(t.$flags$|=64,oT(n,"componentDidLoad"),r())},HOt=t=>{{const e=_O(t),i=e.$hostElement$.isConnected;return i&&(e.$flags$&18)===2&&_Z(e,!1),i}},oT=(t,e,i)=>{if(t&&t[e])try{return t[e](i)}catch(r){yO(r)}},moe=(t,e)=>t&&t.then?t.then(e):e(),Fdt=(t,e)=>_O(t).$instanceValues$.get(e),kdt=(t,e,i,r)=>{const n=_O(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;i=Tdt(i,r.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){n.$instanceValues$.set(e,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[e];p&&p.map(f=>{try{l[f](i,o,e)}catch(y){yO(y,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,e)===!1)return;_Z(n,!1)}}}},Udt=(t,e,i)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const r=Object.entries(e.$members$),n=t.prototype;r.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return Fdt(this,s)},set(a){kdt(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){oa.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},zdt=async(t,e,i,r,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=xdt(t)]);const a=R2e(i,e.$modeName$);if(!LN.has(a)){const l=Nb("registerStyles",i.$tagName$);Edt(a,o,!!(i.$flags$&1)),l()}}e.$ancestorComponent$,(()=>_Z(e,!0))()},Bdt=t=>{},Vdt=t=>{if(!(oa.$flags$&1)){const e=_O(t),i=e.$cmpMeta$,r=Nb("connectedCallback",i.$tagName$);e.$flags$&1?(k2e(t,e,i.$listeners$),Bdt(e.$lazyInstance$)):(e.$flags$|=1,i.$flags$&12&&Gdt(t),i.$members$&&Object.entries(i.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),zdt(t,e,i)),r()}},Gdt=t=>{const e=t["s-cr"]=lp.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},jdt=t=>{if(!(oa.$flags$&1)){const e=_O(t);e.$rmListeners$&&(e.$rmListeners$.map(i=>i()),e.$rmListeners$=void 0)}},WOt=(t,e)=>{const i={$flags$:e[0],$tagName$:e[1]};i.$members$=e[2],i.$listeners$=e[3],i.$watchers$=t.$watchers$,i.$attrsToReflect$=[];const r=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){Zdt(this,i)},connectedCallback(){Vdt(this),r&&r.call(this)},disconnectedCallback(){jdt(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)})}}),t.is=i.$tagName$,Udt(t,i)},qOt=(t,e)=>e,k2e=(t,e,i,r)=>{i&&i.map(([n,s,o])=>{const a=Wdt(t,n),l=Hdt(e,o),c=qdt(n);oa.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>oa.rel(a,s,l,c))})},Hdt=(t,e)=>i=>{try{c2.lazyLoad||t.$hostElement$[e](i)}catch(r){yO(r)}},Wdt=(t,e)=>e&4?lp:e&8?vO:e&16?lp.body:t,qdt=t=>Ydt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,U2e=new WeakMap,_O=t=>U2e.get(t),Zdt=(t,e)=>{const i={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return k2e(t,i,e.$listeners$),U2e.set(t,i)},goe=(t,e)=>e in t,yO=(t,e)=>(0,console.error)(t,e),LN=new Map,Xdt=[],vO=typeof window<"u"?window:{},lp=vO.document||{head:{}},ZOt=vO.HTMLElement||class{},oa={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,i,r)=>t.addEventListener(e,i,r),rel:(t,e,i,r)=>t.removeEventListener(e,i,r),ce:(t,e)=>new CustomEvent(t,e)},Ydt=(()=>{let t=!1;try{lp.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),Jdt=t=>Promise.resolve(t),Kdt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),_oe=[],z2e=[],Qdt=(t,e)=>i=>{t.push(i),HV||(HV=!0,e&&oa.$flags$&4?ept(WV):oa.raf(WV))},yoe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(i){yO(i)}t.length=0},WV=()=>{yoe(_oe),yoe(z2e),(HV=_oe.length>0)&&oa.raf(WV)},ept=t=>Jdt().then(t),tpt=Qdt(z2e,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */const B2e="calcite-mode-auto",V2e="calcite-mode-dark",ipt="calcite-mode-light",XOt={autoMode:B2e,darkMode:V2e,lightMode:ipt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var G2e=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],DN=G2e.join(","),j2e=typeof Element>"u",Fb=j2e?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,NN=!j2e&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},FN=function t(e,i){var r;i===void 0&&(i=!0);var n=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"inert"),s=n===""||n==="true",o=s||i&&e&&t(e.parentNode);return o},rpt=function(e){var i,r=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return r===""||r==="true"},H2e=function(e,i,r){if(FN(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll(DN));return i&&Fb.call(e,DN)&&n.unshift(e),n=n.filter(r),n},W2e=function t(e,i,r){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(!FN(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,r);r.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var u=Fb.call(o,DN);u&&r.filter(o)&&(i||!e.includes(o))&&n.push(o);var p=o.shadowRoot||typeof r.getShadowRoot=="function"&&r.getShadowRoot(o),f=!FN(p,!1)&&(!r.shadowRootFilter||r.shadowRootFilter(o));if(p&&f){var y=t(p===!0?o.children:p.children,!0,r);r.flatten?n.push.apply(n,y):n.push({scopeParent:o,candidates:y})}else s.unshift.apply(s,o.children)}}return n},q2e=function(e,i){return e.tabIndex<0&&(i||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||rpt(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},npt=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},Z2e=function(e){return e.tagName==="INPUT"},spt=function(e){return Z2e(e)&&e.type==="hidden"},opt=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(r){return r.tagName==="SUMMARY"});return i},apt=function(e,i){for(var r=0;r<e.length;r++)if(e[r].checked&&e[r].form===i)return e[r]},lpt=function(e){if(!e.name)return!0;var i=e.form||NN(e),r=function(a){return i.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=r(window.CSS.escape(e.name));else try{n=r(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=apt(n,e.form);return!s||s===e},cpt=function(e){return Z2e(e)&&e.type==="radio"},upt=function(e){return cpt(e)&&!lpt(e)},hpt=function(e){var i,r=e&&NN(e),n=(i=r)===null||i===void 0?void 0:i.host,s=!1;if(r&&r!==e){var o,a,l;for(s=!!((o=n)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&n;){var c,u,p;r=NN(n),n=(c=r)===null||c===void 0?void 0:c.host,s=!!((u=n)!==null&&u!==void 0&&(p=u.ownerDocument)!==null&&p!==void 0&&p.contains(n))}}return s},voe=function(e){var i=e.getBoundingClientRect(),r=i.width,n=i.height;return r===0&&n===0},dpt=function(e,i){var r=i.displayCheck,n=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=Fb.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(Fb.call(o,"details:not([open]) *"))return!0;if(!r||r==="full"||r==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=NN(e);if(l&&!l.shadowRoot&&n(l)===!0)return voe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(hpt(e))return!e.getClientRects().length;if(r!=="legacy-full")return!0}else if(r==="non-zero-area")return voe(e);return!1},ppt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var r=0;r<i.children.length;r++){var n=i.children.item(r);if(n.tagName==="LEGEND")return Fb.call(i,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}i=i.parentElement}return!1},kN=function(e,i){return!(i.disabled||FN(i)||spt(i)||dpt(i,e)||opt(i)||ppt(i))},qV=function(e,i){return!(upt(i)||q2e(i)<0||!kN(e,i))},fpt=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},mpt=function t(e){var i=[],r=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=q2e(a,o),c=o?t(n.candidates):a;l===0?o?i.push.apply(i,c):i.push(a):r.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),r.sort(npt).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(i)},gpt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=W2e([e],i.includeContainer,{filter:qV.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:fpt}):r=H2e(e,i.includeContainer,qV.bind(null,i)),mpt(r)},YOt=function(e,i){i=i||{};var r;return i.getShadowRoot?r=W2e([e],i.includeContainer,{filter:kN.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):r=H2e(e,i.includeContainer,kN.bind(null,i)),r},JOt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Fb.call(e,DN)===!1?!1:qV(i,e)},_pt=G2e.concat("iframe").join(","),KOt=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Fb.call(e,_pt)===!1?!1:kN(i,e)};const ypt={getShadowRoot:!0};function QOt(t){const e="dir",i=`[${e}]`,r=vpt(t,i);return r?r.getAttribute(e):"ltr"}function yZ(t){return t.getRootNode()}function eRt(t){const e=yZ(t);return"host"in e?e:null}function X2e(t){return t.host||null}function tRt(t,{selector:e,id:i}){function r(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=yZ(n),o=i?"getElementById"in s?s.getElementById(i):null:e?s.querySelector(e):null,a=X2e(s);return o||(a?r(a):null)}return r(t)}function vpt(t,e){function i(r){return r?r.closest(e)||i(X2e(yZ(r))):null}return i(t)}function bpt(t,e){return Y2e(t,e)}function Y2e(t,e){if(!t)return;const i=e(t);if(i!==void 0)return i;const{parentNode:r}=t;return Y2e(r instanceof ShadowRoot?r.host:r,e)}function iRt(t,e){return!!bpt(e,i=>i===t?!0:void 0)}function wpt(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function rRt(t){if(t)return wpt(t)?t.setFocus():t.focus()}function nRt(t){t&&(gpt(t,ypt)[0]||t).focus()}const v3=":not([slot])";function sRt(t,e,i){e&&!Array.isArray(e)&&typeof e!="string"&&(i=e,e=null);const r=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:v3;return i!=null&&i.all?xpt(t,r,i):Tpt(t,r,i)}function J2e(t,e){return t?Array.from(t.children||[]).filter(i=>i==null?void 0:i.matches(e)):[]}function xpt(t,e,i){let r=e===v3?J2e(t,v3):Array.from(t.querySelectorAll(e));r=i&&i.direct===!1?r:r.filter(s=>s.parentElement===t),r=i!=null&&i.matches?r.filter(s=>s==null?void 0:s.matches(i.matches)):r;const n=i==null?void 0:i.selector;return n?r.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):r}function Tpt(t,e,i){let r=e===v3?J2e(t,v3)[0]||null:t.querySelector(e);r=i&&i.direct===!1||(r==null?void 0:r.parentElement)===t?r:null,r=i!=null&&i.matches?r!=null&&r.matches(i.matches)?r:null:r;const n=i==null?void 0:i.selector;return n?r==null?void 0:r.querySelector(n):r}function oRt(t,e,i){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[i]}function aRt(t){return(!!t).toString()}function lRt(t){return!!Spt(t).length}function Spt(t){return t.target.assignedElements({flatten:!0})}function cRt(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */function boe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,i=()=>t.contains(V2e)||t.contains(B2e)&&e?"dark":"light",r=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&r(o),s=o};let s=i();r(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(i())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function Cpt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?boe():document.addEventListener("DOMContentLoaded",()=>boe(),{once:!0}))}const Ept=Cpt;Ept();let K2e;function Apt(){try{ddt(".")}catch{pdt(cu(dr(K2e)))}}function uRt(t){var i;const e=[];for(const r of Object.keys(t))customElements.get(`calcite-${r}`)||e.push((i=t[r])==null?void 0:i.call(t));return Promise.all(e)}K2e="components/assets";const Q2e=Symbol("widget"),Ppt=Symbol("widget-test-data"),Opt=[],Rpt={},UN=new WeakMap;function eTe(t,e){let i=e.children;if(i&&i.length)for(let n=0;n<i.length;++n)i[n]=eTe(t,i[n]);else i=Opt;const r=e.vnodeSelector;if(vZ(r)){const n=e.properties||Rpt,s=n.key||r;return{vnodeSelector:"div",properties:{key:s,afterCreate:Mpt,afterUpdate:$pt,afterRemoved:tTe,parentWidget:t,widgetConstructor:r,widgetProperties:{...n,key:s,children:i}},children:void 0,text:void 0,domNode:null}}return e}function Mpt(t,e,i,{parentWidget:r,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,UN.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),r._internalHandles.add(il(()=>tTe(t)))}function $pt(t,e,i,{widgetProperties:r}){var s;const n=UN.get(t);n&&(n.set(r),(s=n.afterUpdate)==null||s.call(n,n,t))}function tTe(t){var i;const e=UN.get(t);e&&((i=e.afterRemoved)==null||i.call(e,e,t),e.destroy(),UN.delete(t))}function vZ(t){return typeof t=="function"&&t[Q2e]}const woe=new Set;function Ipt(t){woe.add(t),t.finally(()=>woe.delete(t))}var iTe;const Lpt="esri.widgets.Widget";let Dpt=0;const Npt={widgetIcon:"esri-icon-checkbox-unchecked"};function rTe(t,e){for(const i in e)t[i]!=null&&(typeof t[i]=="object"&&typeof e[i]=="object"?rTe(t[i],e==null?void 0:e[i]):t[i]=e[i]);return t}const Fpt=hdt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,i=/capture$/i;t.eventHandlerInterceptor=(r,n,s,o)=>{const a=e==null?void 0:e(r,n,s,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in s)||l){const c=r[2].toLowerCase()+r.slice(3),u=y=>a==null?void 0:a.call(s,y);s.addEventListener(c,u,l);const p=()=>s.removeEventListener(c,u,l),f=o.afterRemoved;o.afterRemoved=y=>{f==null||f(y),p()}}return a}},handleInterceptedEvent(t,e,i,r){const{eventPhase:n,type:s}=r,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(kpe(),t.scheduleRender(),l[a].call(l.bind||i,r))}});let r8=!1,ro=class extends Ej(os.EventedAccessor){constructor(t,e){super(t,e),this._attached=!1,this._internalHandles=new an,this._projector=Fpt,this._readyForTrueRender=!1,this.iconClass=Npt.widgetIcon,this.icon=null,this.key=this,this._loadLocale=yae(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const s=await Ay(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{if(this.destroyed)return;let l=await Vhe(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=rTe(Le(l),this.uiStrings)),this[a]=l}));if(this.destroyed)return;for(const o of s)o.error&&ye.getLogger(this).error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),Apt();const i="esri-widget-uid-"+E2e(),r=this.render.bind(this);this._trackingTarget=new e5(()=>this.scheduleRender());const n=()=>{var c;if(!this._readyForTrueRender||this.destroyed)return null;const s=r();let{properties:o}=s;o||(s.properties=o={});const{key:a}=o;a||(o.key=i),this.visible?o.styles||(o.styles={}):(o.class="",o.styles={display:"none"}),o.styles.display||(o.styles.display="");let l=0;return(c=s.children)==null||c.forEach(u=>{if(vZ(u.vnodeSelector))return;let{properties:p}=u;p||(u.properties=p={}),p.key||(p.key=`${this.id}--${l++}`)}),eTe(this,s)};this.render=()=>{if(r8)return n();let s=wNe(this)??null;if(s)return s;this._trackingTarget.clear(),r8=!0;try{s=Pg(this._trackingTarget,n)}catch(o){throw console.error(o),o}finally{r8=!1}return s&&xNe(this,s),s},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),Ipt(this._resourcesFetch)}normalizeCtorArgs(t,e){const i={...t};return e&&(i.container=e),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(BZ)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Je(this._trackingTarget),Je(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,d6(this))}set container(t){this._get("container")||this._set("container",t)}castContainer(t){return R5(t)}get domNode(){return this.container}set domNode(t){this.container=t}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+Dpt++}set id(t){t&&this._set("id",t)}get label(){return this.declaredClass.split(".").pop()}set label(t){this._overrideIfSome("label",t)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(t){this._set("visible",t)}get[(iTe=Q2e,Ppt)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(d6(this),this._projector.scheduleRender())}classes(...t){return ANe.apply(this,t)}renderNow(){d6(this),this._projector.renderNow()}_postInitialize(){var e;if(this.destroyed)return;this.scheduleRender(),(e=this._delegatedEventNames)!=null&&e.length&&this._internalHandles.add(Pe(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&KN(i)&&this._internalHandles.add(this._delegatedEventNames.map(n=>E3(i,n,s=>{this.emit(n,s)})),"delegated-events")},ar)),this.postInitialize();const t=async()=>{await this._loadLocale().catch(BZ),this.scheduleRender()};this._internalHandles.add([fce(t),Pe(()=>this.uiStrings,t),Bh(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(t){t&&(this._projector.merge(t,this.render),this._attached=!0)}_detach(t){var e;this._attached&&(this._projector.detach(this.render),this._attached=!1),(e=t==null?void 0:t.parentNode)==null||e.removeChild(t)}};ro[iTe]=!0,d([m()],ro.prototype,"_readyForTrueRender",void 0),d([m({value:null})],ro.prototype,"container",null),d([Sn("container")],ro.prototype,"castContainer",null),d([m()],ro.prototype,"iconClass",void 0),d([m()],ro.prototype,"icon",void 0),d([m()],ro.prototype,"id",null),d([m()],ro.prototype,"label",null),d([m()],ro.prototype,"renderable",null),d([m()],ro.prototype,"uiStrings",void 0),d([m()],ro.prototype,"viewModel",void 0),d([m({value:!0})],ro.prototype,"visible",null),d([m()],ro.prototype,"key",void 0),d([m()],ro.prototype,"children",void 0),d([m()],ro.prototype,"afterCreate",void 0),d([m()],ro.prototype,"afterUpdate",void 0),d([m()],ro.prototype,"afterRemoved",void 0),ro=d([J(Lpt)],ro);const RS=ro;function xoe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function kpt(t,e){return t.length!==e.length||t.some((i,r)=>i.text!==e[r].text)}function k$(t,e,i){!i||!e||t.find(r=>r.layerView===e&&r.text===i)||t.push({text:i,layerView:e})}function Upt(t){return t.type==="bing-maps"}const U0=[];let d2=class extends LP{constructor(t){super(t),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Ci,this.view=null,this._allLayerViewsChange=e=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>Pe(()=>{var n;return[r.suspended,(n=r.layer)==null?void 0:n.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),e&&e.removed&&e.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([$l(()=>{var e;return(e=this.view)==null?void 0:e.allLayerViews},"change",e=>this._allLayerViewsChange(e),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Bh(()=>{var e;return((e=this.view)==null?void 0:e.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const t=this.view,e=t==null?void 0:t.allLayerViews;U0.length=0,t&&e?(e.forEach(i=>{var s;if(i.suspended||!((s=i.layer)!=null&&s.attributionVisible))return;const r=i.layer;if(xoe(r,"user"))return void k$(U0,i,r.copyright);if(r.hasAttributionData){if(this._fetchedAttributionData.has(i)){const o=this._fetchedAttributionData.get(i);return void(o?k$(U0,i,this._getDynamicAttribution(o,t,r)):xoe(r)&&k$(U0,i,r.copyright))}return void this._fetchAttributionData(i)}const n=r.get("portalItem.accessInformation");k$(U0,i,n||r.copyright)}),kpt(this.items,U0)&&(this.items.removeAll(),this.items.addMany(U0)),U0.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(t){if(this._pendingAttributions.has(t))return;this._pendingAttributions.add(t);const e=await Lg(t.layer.fetchAttributionData());if(this._pendingAttributions.has(t)){const i=e.ok?this._createContributionIndex(e.value,Upt(t.layer)):null;this._pendingAttributions.delete(t),this._fetchedAttributionData.set(t,i)}this._updateAttributionItems()}_createContributionIndex(t,e){const i=t.contributors,r={};if(!i)return r;for(let n=0;n<i.length;n++){const s=i[n],o=s.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(e&&a.zoomMin?1:0),u=a.zoomMax-(e&&a.zoomMax?1:0),p=new Ar({xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:jt.WGS84}),f={extent:CA(p),attribution:s.attribution||"",score:a.score!=null?a.score:100,id:n};for(let y=c;y<=u;y++)r[y]??(r[y]=[]),r[y].push(f)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(t,e,i){var c;const{extent:r,scale:n}=e;let s=((c=i.tileInfo)==null?void 0:c.scaleToZoom(n))??0;if(s=Math.min(t.maxKey??0,Math.round(s)),!r||s==null||s<=-1)return"";const o=t[s],a=Ub(r.center.clone().normalize(),e.spatialReference),l=new Set;return o?o.filter(u=>{const p=u.id,f=!l.has(p)&&a&&u.extent&&MG(u.extent,a);return f&&l.add(p),f}).sort((u,p)=>p.score-u.score||u.objectId-p.objectId).map(u=>u.attribution).join(", "):""}};d([m({readOnly:!0,type:Ci})],d2.prototype,"items",void 0),d([m({readOnly:!0})],d2.prototype,"state",null),d([m()],d2.prototype,"view",void 0),d2=d([J("esri.widgets.Attribution.AttributionViewModel")],d2);const nTe=d2;function bO(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:Bpt(t[e])}}}function zpt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function Bpt(t){return function(e,...i){zpt(e)?$Ne(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...i)}}function wO(t){return(e,i)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:i})}}var Vpt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},sTe=function(t,e){for(var i=0,r=t.length;i<r;i++){var n=t[i];Array.isArray(n)?sTe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=Vpt(n)),e.push(n))}},Gpt=function(t,e){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:i[0],domNode:null};var n=[];return sTe(i,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function $o(t,e,...i){return typeof t!="function"||vZ(t)?Gpt(t,e,...i):t(e,...i)}const Px="esri-attribution",z0={base:`${Px} esri-widget`,poweredBy:`${Px}__powered-by`,sources:`${Px}__sources`,open:`${Px}--open`,sourcesOpen:`${Px}__sources--open`,link:`${Px}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Va=class extends RS{constructor(e,i){super(e,i),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(r=>r.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=z0.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new nTe}initialize(){this.addHandles($l(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,i)=>(e.includes(i.text)||e.push(i.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[z0.open]:this._isOpen};return $o("div",{bind:this,class:this.classes(z0.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return $o("div",{class:z0.poweredBy},"Powered by"," ",$o("a",{class:z0.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,i=this._isInteractive,r=i?"0":"",{attributionText:n}=this,s={[z0.sourcesOpen]:e,[z0.interactive]:i};return $o("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(z0.sources,s),innerHTML:n,tabindex:r})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let i=!1;const{clientHeight:r,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(i=!0),this._isOpen){const l=r<this._prevSourceNodeHeight;this._prevSourceNodeHeight=r,l&&(this._isOpen=!1,i=!0)}i&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([m()],Va.prototype,"_isOpen",void 0),d([m()],Va.prototype,"_isInteractive",null),d([m()],Va.prototype,"_attributionTextOverflowed",void 0),d([m()],Va.prototype,"_prevSourceNodeHeight",void 0),d([m({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Va.prototype,"attributionText",null),d([m()],Va.prototype,"iconClass",void 0),d([m()],Va.prototype,"icon",void 0),d([m()],Va.prototype,"itemDelimiter",void 0),d([m()],Va.prototype,"label",null),d([m(),wO("esri/widgets/Attribution/t9n/Attribution")],Va.prototype,"messages",void 0),d([m()],Va.prototype,"view",null),d([m({type:nTe})],Va.prototype,"viewModel",void 0),d([bO()],Va.prototype,"_toggleState",null),Va=d([J("esri.widgets.Attribution")],Va);const jpt=Va,Hpt=t=>{let e=class extends t{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return HN(r),this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return d([m()],e.prototype,"goToOverride",void 0),d([m()],e.prototype,"view",void 0),e=d([J("esri.widgets.support.GoTo")],e),e},Wpt="esri.widgets.CompassViewModel";let h1=class extends Hpt(ke){constructor(e){super(e),this._handles=new an,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(Pe(()=>this.view,this._updateRotationWatcher,ar))}destroy(){Qr(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var i;if(!this.get("view.ready"))return;const e={};((i=this.view)==null?void 0:i.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const i=-e.heading;this.orientation={x:0,y:0,z:i}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?Pe(()=>e==null?void 0:e.rotation,this._updateForRotation,ar):Pe(()=>e==null?void 0:e.camera,this._updateForCamera,ar))}};d([m({readOnly:!0})],h1.prototype,"canShowNorth",null),d([m()],h1.prototype,"orientation",void 0),d([m({readOnly:!0})],h1.prototype,"state",null),d([m()],h1.prototype,"view",void 0),h1=d([J(Wpt)],h1);const oTe=h1,B0={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let $d=class extends RS{constructor(e,i){super(e,i),this.iconClass=B0.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new oTe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:i}=this.viewModel,r=i==="disabled",n=(i==="rotation"?"rotation":"compass")=="compass",s=r?-1:0,o={[B0.disabled]:r,[B0.interactive]:!r},a={[B0.northIcon]:n,[B0.rotationIcon]:!n},{messages:l}=this;return $o("div",{bind:this,class:this.classes(B0.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":l.reset,title:l.reset},$o("span",{"aria-hidden":"true",class:this.classes(B0.icon,a),styles:this._toRotationTransform(e)}),$o("span",{class:B0.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};d([m()],$d.prototype,"goToOverride",null),d([m()],$d.prototype,"iconClass",void 0),d([m()],$d.prototype,"icon",void 0),d([m()],$d.prototype,"label",null),d([m(),wO("esri/widgets/Compass/t9n/Compass")],$d.prototype,"messages",void 0),d([m()],$d.prototype,"view",null),d([m({type:oTe})],$d.prototype,"viewModel",void 0),d([bO()],$d.prototype,"_reset",null),$d=d([J("esri.widgets.Compass")],$d);const qpt=$d,Ox="esri-navigation-toggle",Xu={base:`${Ox} esri-widget`,button:`${Ox}__button esri-widget--button`,activeButton:`${Ox}__button--active`,panButton:`${Ox}__button--pan`,rotateButton:`${Ox}__button--rotate`,isLayoutHorizontal:`${Ox}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let p2=class extends ke{constructor(t){super(t),this.navigationMode="pan",this.view=null}initialize(){this.own(Bh(()=>{var t;return(t=this.view)==null?void 0:t.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var t;return this.get("view.ready")&&((t=this.view)==null?void 0:t.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};d([m({readOnly:!0})],p2.prototype,"state",null),d([m()],p2.prototype,"navigationMode",void 0),d([m()],p2.prototype,"view",void 0),p2=d([J("esri.widgets.NavigationToggleViewModel")],p2);const aTe=p2;let Id=class extends RS{constructor(e,i){super(e,i),this.iconClass=Xu.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new aTe}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",i=this.get("viewModel.navigationMode")==="pan",r={[Xu.disabled]:e,[Xu.isLayoutHorizontal]:this.layout==="horizontal"},n={[Xu.activeButton]:i},s={[Xu.activeButton]:!i},o=e?-1:0,a=this.messages.toggle;return $o("div",{bind:this,class:this.classes(Xu.base,r),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},$o("div",{class:this.classes(Xu.button,Xu.panButton,n)},$o("span",{class:Xu.panIcon})),$o("div",{class:this.classes(Xu.button,Xu.rotateButton,s)},$o("span",{class:Xu.rotationIcon})))}_toggle(){this.toggle()}};d([m()],Id.prototype,"iconClass",void 0),d([m()],Id.prototype,"icon",void 0),d([m()],Id.prototype,"label",null),d([m({value:"vertical"})],Id.prototype,"layout",null),d([m(),wO("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Id.prototype,"messages",void 0),d([m()],Id.prototype,"view",null),d([m({type:aTe})],Id.prototype,"viewModel",void 0),d([bO()],Id.prototype,"_toggle",null),Id=d([J("esri.widgets.NavigationToggle")],Id);const Zpt=Id,tE={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Km=class extends RS{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const t=this.enabled?0:-1,e={[tE.disabled]:!this.enabled,[tE.interactive]:this.enabled};return $o("div",{bind:this,class:this.classes(tE.button,e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:t,title:this.title},$o("span",{"aria-hidden":"true",role:"presentation",class:this.classes(tE.icon,this.iconClass??"")}),$o("span",{class:tE.iconText},this.title))}_triggerAction(){this.action.call(this)}};d([m()],Km.prototype,"action",void 0),d([m()],Km.prototype,"enabled",void 0),d([m()],Km.prototype,"iconClass",void 0),d([m()],Km.prototype,"icon",void 0),d([m()],Km.prototype,"title",void 0),d([bO()],Km.prototype,"_triggerAction",null),Km=d([J("esri.widgets.IconButton")],Km);const Toe=Km;let f2=class extends ke{get canZoomIn(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return e===0||t>e}get canZoomOut(){if(!this.get("view.ready"))return!1;const t=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");return e===0||t<e}};d([m({readOnly:!0})],f2.prototype,"canZoomIn",null),d([m({readOnly:!0})],f2.prototype,"canZoomOut",null),d([m()],f2.prototype,"view",void 0),f2=d([J("esri.widgets.Zoom.ZoomConditions2D")],f2);const Xpt=f2;let m2=class extends ke{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([m({readOnly:!0})],m2.prototype,"canZoomIn",null),d([m({readOnly:!0})],m2.prototype,"canZoomOut",null),d([m()],m2.prototype,"view",void 0),m2=d([J("esri.widgets.Zoom.ZoomConditions3D")],m2);const Ypt=m2;let d_=class extends ke{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new Xpt({view:e}):e.type==="3d"&&(this._zoomConditions=new Ypt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():m8(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():m8(e.goTo({zoomFactor:.5}))}};d([m()],d_.prototype,"_zoomConditions",void 0),d([m()],d_.prototype,"canZoomIn",null),d([m()],d_.prototype,"canZoomOut",null),d([m({readOnly:!0})],d_.prototype,"state",null),d([m()],d_.prototype,"view",null),d_=d([J("esri.widgets.Zoom.ZoomViewModel")],d_);const lTe=d_,iE={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let ff=class extends RS{constructor(e,i){super(e,i),this.iconClass=iE.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new lTe}initialize(){this._zoomInButton=new Toe({action:this.zoomIn.bind(this),iconClass:iE.zoomInIcon}),this._zoomOutButton=new Toe({action:this.zoomOut.bind(this),iconClass:iE.zoomOutIcon})}destroy(){this._zoomInButton=Je(this._zoomInButton),this._zoomOutButton=Je(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,i={[iE.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:r,canZoomOut:n}=e;this._zoomInButton.enabled=r,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,$o("div",{class:this.classes(iE.base,i)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};d([m()],ff.prototype,"iconClass",void 0),d([m()],ff.prototype,"icon",void 0),d([m()],ff.prototype,"label",null),d([m({value:"vertical"})],ff.prototype,"layout",null),d([m(),wO("esri/widgets/Zoom/t9n/Zoom")],ff.prototype,"messages",void 0),d([m()],ff.prototype,"view",null),d([m({type:lTe})],ff.prototype,"viewModel",void 0),ff=d([J("esri.widgets.Zoom")],ff);const Jpt=ff;function Kpt(t){return(t==null?void 0:t.view)!==void 0}let mL=class extends ndt{constructor(t){super(t),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=e=>{this.components.forEach(i=>{const r=this._find(i),n=r==null?void 0:r.widget;Kpt(n)&&(n.view=e)})},this._componentsWatcher=(e,i)=>{this._removeComponents(i),this._addComponents(e),this._adjustPadding(e)}}initialize(){this.addHandles([Pe(()=>this.components,this._componentsWatcher,ar),Pe(()=>this.view,this._updateViewAwareWidgets,ar)])}_add(t,e,i,r,n){let s=t;if(typeof t=="string"&&this._defaultPositionLookup[t]){if(this._find(t))return;s=this._createComponent(t)}super._add(s,e,i,r,n)}_removeComponents(t){t.forEach(e=>{const i=this._find(e);i&&(this.remove(i),i.destroy())})}_adjustPadding(t){if(!t.includes("attribution")&&!this._isOverridden("padding")){const{top:e}=this.padding;this.padding=e}}_addComponents(t){this.constructed&&t.forEach(e=>this.add(this._createComponent(e),this._defaultPositionLookup[e]))}_createComponent(t){const e=this._createWidget(t);return new fL({id:t,node:e})}_createWidget(t){const{view:e}=this;switch(t){case"attribution":return new jpt({view:e});case"compass":return new qpt({view:e});case"navigation-toggle":return new Zpt({view:e});case"zoom":return new Jpt({view:e})}}};d([m()],mL.prototype,"components",void 0),mL=d([J("esri.views.ui.DefaultUI")],mL);const cTe=mL;let gL=class extends cTe{constructor(t){super(t),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([m()],gL.prototype,"components",void 0),gL=d([J("esri.views.ui.3d.DefaultUI3D")],gL);const uTe=gL;let ft=class extends PDe(C5e(qNe(H4e))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new Dg({slicePlane:cpe},this),this._resourceController=Dit(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new I7({view:this}),this.labeler=new r1({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new AT,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new v1,this.environmentManager=new Cd,this.floors=new Ci,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Z4e({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Jtt,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new uTe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new cV,this.voxelWasm=null,this.voxelWasmPromise=null,rIe(),t&&t.environment||(this._defaults.environment=new Xx,this.environment=this._defaults.environment);const e=(i=null)=>{i!=null&&i.type===xr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.addHandles([$l(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>e(i),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),Pe(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new tVe({view:this}),this.stateManager=new Ns({view:this})}initialize(){this.groundView=new l5e({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles($l(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},ar),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},ar),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>jSe(e>0?1e3/Math.ceil(e):0),ar),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,qn),this.updatingHandles.add(()=>{var e,i;return(i=(e=this.map)==null?void 0:e.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),qn),this.addHandles(Pe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),gr))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Je(this.sharedSymbolResources),this._set("labeler",Je(this.labeler)),this._set("deconflictor",Je(this.deconflictor)),this._resourceController=Je(this._resourceController),this._set("stateManager",Je(this.stateManager)),this._set("inputManager",Je(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",Je(this.environmentManager)),this.groundView=Je(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof Ar?this.spatialReference&&(t=U$(t,this.spatialReference),t==null)?(ye.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(ye.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?ye.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===Ke.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:U$(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||jt.WGS84,i=U$(this.clippingArea,e);i!=null&&(t=t!=null?t.intersection(i):i);const r=this._get("dataExtent");return t!=null&&t.equals(r)?r:t}get _groundAndLayersExtent(){const t=this.spatialReference||jt.WGS84;let e;const i=s=>{const o=U$(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const s=r.groundExtent;i(new Ar({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof Xx?t:t instanceof Rfe?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):Xx.fromWebsceneEnvironment(t):rl(Xx,t):new Xx}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){tL.isValidProfile(t)&&(tL.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||tL.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");qb(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?yDe(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?z3.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,i=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||u3(a))return;++i,t+=a.updatingProgress}}else++i});for(const a of this._updatingObjects)a!=null&&a.updating&&(i+=.1,t+=.5*.1);for(const a of this._updatingObjectsWithProgress)a!=null&&a.updating&&(++i,t+=a.updatingProgress);const r=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||r||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(i,this._numUpdating),t+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var i;const t=this._predeterminedViewingMode;if(t!=null)return v6(t);const e=this.spatialReference;return e?((i=this.defaultsFromMap)==null?void 0:i.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?v6(this.defaultsFromMap.viewingMode):v7(e,Ke.Global)?"global":"local":"global"}set viewingMode(t){this.ready?ye.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new art(this)}on(t,e,i,r){return this.viewEvents.on(t,e,i,r)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return ye.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const i=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,r=i.graphics!=null&&(i.graphics.include!=null||i.graphics.exclude!=null),n=vJ(t)?yJ(this,t):t,s=bf(n);i.enableDraped=i.include&&!i.include.has(C_)||i.exclude&&i.exclude.has(C_);const o=this.sceneIntersectionHelper,a=qh(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Do.ALL:Do.MIN,o.intersectIntersectorScreen(s,a,i),r){for(const l of a.results.all){const c=jV(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return ye.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Af(this.elevationProvider,t):null)??0;return No(t,Rx,this.renderSpatialReference,e),this.state.camera.projectToScreen(Rx,n8),Uh(n8[0],n8[1])}pixelSizeAt(t){return this.ready?t?(No(t,Rx,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(Rx)):0:(ye.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return ye.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=vJ(t)?yJ(this,t):t,r=fn(i.x,i.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=qh(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=Do.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=ioe(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:bp(a)?a.distanceInRenderSpace:0,layer:c}};return Or.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=s),Promise.resolve(u)}async popupHitTest(t){const{results:e,ground:i}=await kht(this,t);let r=null;return!(e.length===0||Math.abs((e[0].distance??0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:e,screenPoint:t,mapPoint:r}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new ce("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return YU(i,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(e);return JU(i,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e);return[JU(i[0],this._pixelFormat()),JU(i[1],this._pixelFormat())]}_completeSettings(t){const e=_ht(t,this);return e.pixelRatio/=this.state.pixelRatio,wht(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!ge("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const i=await this._stage.renderView.takeScreenshotWithOID(e),r=YU(i[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[r,YU(i[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return AJ.importLayerView(t)}hasLayerViewModule(t){return AJ.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,i,r;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=Zht(this.type);const e=ge("safari");if(e&&e<9&&(t=new ce("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw ye.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?SJ(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const i=this._predeterminedViewingMode;if(i!=null)return this._validateSpatialReferenceForViewingMode(t,e,i)?{constraints:this._makeSpatialReferenceConstraints(t,e,i)}:null;const r=this._validateSpatialReferenceForViewingMode(t,e,Ke.Local),n=this._validateSpatialReferenceForViewingMode(t,e,Ke.Global);return r||n?r&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:r?{constraints:this._makeSpatialReferenceConstraints(t,e,Ke.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,Ke.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,i){return!!v7(t,i)&&(e==null||!!NY(e)||(!kA(e)||J4(e,t,i)!=null)&&(!DY(e)||i!==Ke.Global))}_makeSpatialReferenceConstraints(t,e,i){if(e==null)return[{spatialReference:t,viewingMode:i}];const r=t.isWebMercator,n=t.isWGS84;return NY(e)&&(r||n)?!n||i===Ke.Local||Hq(e.tileInfo,e.fullExtent,t,Ke.Global)===null?[{spatialReference:t,viewingMode:i},{spatialReference:jt.WebMercator,viewingMode:i}]:[{spatialReference:r?jt.WGS84:jt.WebMercator,viewingMode:i}]:kA(e)||DY(e)||!r&&!n?kA(e)&&r&&i!==Ke.Global?[{spatialReference:t,viewingMode:i},{spatialReference:jt.WGS84,viewingMode:Ke.Local}]:[{spatialReference:t,viewingMode:i}]:[{spatialReference:t,viewingMode:i},{spatialReference:r?jt.WGS84:jt.WebMercator,viewingMode:i}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,i=this._predeterminedViewingMode;return e||(i!=null?ye.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${v6(i)} viewing mode.`):t.isGeographic&&ye.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let i=this.spatialReference||jt.WGS84;return Ws(t,this.renderSpatialReference,t,i)||(i=jt.WGS84,Ws(t,this.renderSpatialReference,t,i)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=i):e=new Ft(t,i),e}trackGraphicState(t){if(!t.graphic)return ye.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let i=null,r=!1;const n=s=>{var o;!r&&s!=null&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(i=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{r=!0,i!=null&&(i.remove(),i=null)}}}highlight(t){if(Array.isArray(t))return aT(t.map(i=>this.highlight(i)));if(Ci.isCollection(t))return aT(t.toArray().map(i=>this.highlight(i)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):il()}maskOccludee(t){if(!t)return ye.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let i=null,r=!1;const n=s=>{!r&&s!=null&&zht(s)&&(i=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{r=!0,i!=null&&(i.remove(),i=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await MP(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new ce("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((i,r)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(i,r))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,fP.INCLUDE),i=this._externalToInternalRenderItems(t.exclude,fP.EXCLUDE);return{include:e.layerUids,exclude:i.layerUids,graphics:{include:e.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(Rx)?(e=this.computeMapPointFromVec3d(Rx,e),t.intersector===sn.TERRAIN&&this.basemapTerrain&&(e.z=Af(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const i=new Array;let r=null;for(let n=0;n<t.length;n++){const s=t[n],o=ioe(s,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=jV(s,this);if(a==null)continue;if(a.type==="graphic"){if(r==null&&n!==t.length-1&&(r=new Set),r!=null){const u=this._getGraphicFilterUid(a.graphic);if(r.has(u))continue;r.add(u)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(t){var n;const e=t.sourceLayer,i=t.layer,r=e&&"objectIdField"in e?e:i&&"objectIdField"in i?i:e;if(r){const s=r.objectIdField??bDe,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${r.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const i=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(i))&&(t.exclude==null||!t.exclude.has(i))}_externalToInternalRenderItems(t,e,i={layerUids:void 0,graphicUids:void 0}){if(!t)return i;if(t instanceof gb)Qpt(i,this._getGraphicFilterUid(t)),e===fP.INCLUDE&&(this.graphicsView!=null&&t.layer===this?rE(i,this.graphicsView.processor.layer.id):t.layer&&rE(i,t.layer.uid));else if(l8(t))for(const r of t)r===this.graphics&&this.graphicsView!=null?rE(i,this.graphicsView.processor.layer.id):r===this.map.ground?rE(i,C_):this._externalToInternalRenderItems(r,e,i);else"uid"in t&&rE(i,t.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new $ot({view:this})),this._set("elevationProvider",new lA({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Tl({view:this})),this._set("featureTiles",new Ao({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var i;const e=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const r=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?pS(a5(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Or.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(Oe(()=>import("./FeatureTileTree3DDebugger-af2b7caa.js"),["./FeatureTileTree3DDebugger-af2b7caa.js","./TileTreeDebugger-ca7b7b87.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this._featureTreeDebugger&&Or.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new i({view:this}))}):e||!this._featureTreeDebugger||Or.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},qn),this.updatingHandles.add(()=>this.clippingArea,t,qn),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,qn)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new _it(this.map,t));const e=this.state.isGlobal,i=_De(e,t);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",wit.create(this.state.viewingMode,i)),e||this.addHandles(Pe(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const n=this.renderCoordsHelper.spatialReference;r==null||r[0]===0&&r[1]===0&&r[2]===0&&r[3]===0||!V3(r,this.basemapTerrain.spatialReference,Soe,n)||(this.renderCoordsHelper.extent=Soe)},gr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(NT/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===xr.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(Pe(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),gr),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const i=t.getContext("2d");return i.putImageData(e,0,0),this.overlay.renderCanvas(t),i.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(n,s)=>this._renderScreenshotOverlay(n,s)}},e=new Ktt(this.state.viewingMode,n=>this._stage.layers.forAll(n),this);this._set("sceneIntersectionHelper",e);const i=R5(this.surface);this._stage=new Yc({view:this,options:t,container:i}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),ar),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,n=>this._stage.renderer.setParameters({highQualityTransparency:n}),ar),Pe(()=>this.magnifier,n=>this._stage.renderView.magnifier=n,qn),this.on("pointer-move",()=>{var n;return(n=this._stage)==null?void 0:n.renderer.resetAnimation()}),E3(this._stage.renderView.canvas,"webglcontextlost",n=>this.fatalError=new ce("webgl-context-lost",n.statusMessage))],"stage");const r=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:cV.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],r),"stage"),r(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(NT/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=Je(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new urt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await Oe(()=>import("./GraphicsView3D-24067047.js"),["./GraphicsView3D-24067047.js","./GraphicsProcessor-c1075744.js","./diffUtils-3c37f4e6.js","./Query-cdee9722.js","./Graphics3DObjectStates-a2a2a068.js","./UniqueValueRenderer-ad13318a.js","./ColorStop-0686847d.js","./colorRamps-54548a9c.js","./jsonUtils-dc7d3627.js","./DictionaryLoader-b0bde137.js","./FieldsIndex-06c42f48.js","./heatmapUtils-fe1f2bfa.js","./defaults-d003668a.js","./defaultsJSON-59981e75.js","./optimizedFeatureQueryEngineAdapter-bdd5f5a9.js","./centroid-8e8cfa47.js","./PooledRBush-15700b03.js","./quickselect-70c375a5.js","./popupUtils-81d67c22.js"],import.meta.url)).default;Ti(t),await MP(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=SJ(this.viewingMode);if(t===Ke.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles($l(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(C_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(C_);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=Oe(()=>import("./VoxelWasmPerSceneView-0026917e.js"),[],import.meta.url).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function rE(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function Qpt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function U$(t,e){return t!=null&&hy(t.spatialReference,e)?pS(t,e):null}var fP;ft.type="3d",d([m()],ft.prototype,"_userClippingArea",void 0),d([m()],ft.prototype,"_resourceController",void 0),d([m()],ft.prototype,"_stage",void 0),d([m({readOnly:!0})],ft.prototype,"deconflictor",void 0),d([m({readOnly:!0})],ft.prototype,"labeler",void 0),d([m(mz(AT,"analyses"))],ft.prototype,"analyses",void 0),d([m({type:RT,readOnly:!0})],ft.prototype,"animation",null),d([m({readOnly:!0})],ft.prototype,"basemapTerrain",void 0),d([m({readOnly:!0})],ft.prototype,"elevationProvider",void 0),d([m()],ft.prototype,"camera",null),d([m({type:Fh})],ft.prototype,"contentCamera",null),d([m({readOnly:!0})],ft.prototype,"canvas",void 0),d([m({type:Ft})],ft.prototype,"center",null),d([m({type:Ar})],ft.prototype,"clippingArea",null),d([m({type:v1})],ft.prototype,"constraints",void 0),d([m({type:Ar,readOnly:!0})],ft.prototype,"renderDataExtent",null),d([m({type:Ar,readOnly:!0})],ft.prototype,"dataExtent",null),d([m({type:Ar,readOnly:!0})],ft.prototype,"_groundAndLayersExtent",null),d([m({value:null,type:Xx})],ft.prototype,"environment",null),d([Sn("environment")],ft.prototype,"castEnvironment",null),d([m({readOnly:!0})],ft.prototype,"environmentManager",void 0),d([m({type:Ar})],ft.prototype,"extent",null),d([m()],ft.prototype,"floors",void 0),d([m()],ft.prototype,"screenCenter",null),d([m()],ft.prototype,"frustum",null),d([m({type:Number,readOnly:!0})],ft.prototype,"fullOpacity",void 0),d([m({readOnly:!0})],ft.prototype,"graphicsView",void 0),d([m({readOnly:!0})],ft.prototype,"analysisViewManager",void 0),d([m()],ft.prototype,"groundView",void 0),d([m({type:Boolean})],ft.prototype,"initialExtentRequired",null),d([m()],ft.prototype,"_defaultsFromMapSettings",null),d([m()],ft.prototype,"interacting",null),d([m()],ft.prototype,"stationary",null),d([m()],ft.prototype,"navigating",null),d([m()],ft.prototype,"map",void 0),d([m({readOnly:!0})],ft.prototype,"mapCoordsHelper",void 0),d([m()],ft.prototype,"padding",null),d([m({type:Tl,readOnly:!0})],ft.prototype,"pointsOfInterest",void 0),d([m({type:Ao,readOnly:!0})],ft.prototype,"featureTiles",void 0),d([m()],ft.prototype,"_featureTreeDebugger",void 0),d([m({type:Boolean})],ft.prototype,"screenSizePerspectiveEnabled",void 0),d([m({constructOnly:!0})],ft.prototype,"deactivatedWebGLExtensions",void 0),d([m({constructOnly:!0})],ft.prototype,"debugWebGLExtensions",void 0),d([m({constructOnly:!0})],ft.prototype,"renderCanvas",void 0),d([m({constructOnly:!0})],ft.prototype,"state",void 0),d([m({readOnly:!0})],ft.prototype,"inputManager",void 0),d([m({readOnly:!0})],ft.prototype,"stateManager",void 0),d([m({type:["low","medium","high"]})],ft.prototype,"qualityProfile",null),d([m({type:Wie,get(){let t=this._get("qualitySettings");return t||(t=new Wie,tL.apply(this.qualityProfile,t)),t}})],ft.prototype,"qualitySettings",void 0),d([m()],ft.prototype,"slicePlane",null),d([m({readOnly:!0})],ft.prototype,"typeSpecificPreconditionsReady",null),d([m({readOnly:!0})],ft.prototype,"renderCoordsHelper",void 0),d([m({readOnly:!0})],ft.prototype,"sceneIntersectionHelper",void 0),d([m({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],ft.prototype,"resolution",null),d([m({type:Number})],ft.prototype,"scale",null),d([m()],ft.prototype,"heightModelInfo",null),d([m()],ft.prototype,"spatialReference",void 0),d([m({type:Boolean,constructOnly:!0})],ft.prototype,"alphaCompositingEnabled",void 0),d([m({constructOnly:!0})],ft.prototype,"preserveDrawingBufferEnabled",void 0),d([m({type:Boolean})],ft.prototype,"supersampleScreenshotsEnabled",void 0),d([m({readOnly:!0})],ft.prototype,"type",void 0),d([m(),Sn(t=>t instanceof cTe?t:uT(uTe,t))],ft.prototype,"ui",void 0),d([m({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],ft.prototype,"updating",null),d([m()],ft.prototype,"_updatingObjects",null),d([m()],ft.prototype,"_updatingObjectsWithProgress",null),d([m({type:Number,readOnly:!0,dependsOn:["updating"]})],ft.prototype,"updatingProgress",void 0),d([m({type:["global","local"]})],ft.prototype,"viewingMode",null),d([m({type:pp})],ft.prototype,"viewpoint",null),d([m({type:Number})],ft.prototype,"zoom",null),d([m({type:cV})],ft.prototype,"highlightOptions",void 0),ft=d([J("esri.views.SceneView")],ft),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(fP||(fP={}));const Rx=I(),n8=fn(),Soe=li(),eft=ft;let Qm=class extends ke{constructor(t){super(t),this._vendorInfo=null,this._fullscreenStyle="width: 100%; height: 100%;",this.view=null,this._errorHandler=this._errorHandler.bind(this),this._stateHandler=this._stateHandler.bind(this)}destroy(){this._removeFullscreenListeners(),this.view=null}get element(){var t;return((t=this.view)==null?void 0:t.container)??null}set element(t){this._override("element",t)}get state(){return this.element?this._isSupported()?this._isActive()?"active":"ready":"feature-unsupported":"disabled"}enter(){this._enterFullscreen()}exit(){this._exitFullscreen()}toggle(){this._isActive()?this._exitFullscreen():this._enterFullscreen()}_isSupported(){this._removeFullscreenListeners();const t=this._getVendorInfo(this.element);return this._addFullscreenListeners(t),this._vendorInfo=t,!!t}_isActive(){return!!this._vendorInfo&&!!document[this._vendorInfo.propertyName]}_stateHandler(){this.notifyChange("state"),this.state==="active"?this._addStyle():this._removeStyle()}_errorHandler(t){ye.getLogger(this).error("fullscreen request failed",t)}_getVendorInfo(t){if(t)return t.requestFullscreen?{enterName:"requestFullscreen",exitName:"exitFullscreen",errorEventName:"fullscreenerror",changeEventName:"fullscreenchange",propertyName:"fullscreen"}:t.webkitRequestFullScreen?{enterName:"webkitRequestFullscreen",exitName:"webkitCancelFullScreen",errorEventName:"webkitfullscreenerror",changeEventName:"webkitfullscreenchange",propertyName:"webkitIsFullScreen"}:t.mozRequestFullScreen?{enterName:"mozRequestFullScreen",exitName:"mozCancelFullScreen",errorEventName:"mozfullscreenerror",changeEventName:"mozfullscreenchange",propertyName:"mozFullScreen"}:void 0}_enterFullscreen(){if(this.state==="feature-unsupported")return void ye.getLogger(this).warn("The fullscreen API is not supported in this browser.");const{element:t}=this;t&&(this._vendorInfo&&t[this._vendorInfo.enterName].call(t),this.notifyChange("state"))}_addStyle(){const{element:t}=this;t&&t.setAttribute("style",this._fullscreenStyle)}_removeStyle(){const{element:t}=this;t&&t.removeAttribute("style")}_exitFullscreen(){if(this.state==="feature-unsupported")return;const{element:t}=this;t&&(this._vendorInfo&&document[this._vendorInfo.exitName].call(document),this.notifyChange("state"))}_addFullscreenListeners(t){t&&(document.addEventListener(t.changeEventName,this._stateHandler),document.addEventListener(t.errorEventName,this._errorHandler))}_removeFullscreenListeners(){const{_vendorInfo:t}=this;t&&(document.removeEventListener(t.changeEventName,this._stateHandler),document.removeEventListener(t.errorEventName,this._errorHandler))}};d([m()],Qm.prototype,"element",null),d([m({readOnly:!0})],Qm.prototype,"state",null),d([m()],Qm.prototype,"view",void 0),d([m()],Qm.prototype,"enter",null),d([m()],Qm.prototype,"exit",null),d([m()],Qm.prototype,"toggle",null),Qm=d([J("esri.widgets.Fullscreen.FullscreenViewModel")],Qm);const hTe=Qm,Mx={base:"esri-fullscreen esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-icon",enter:"esri-icon-zoom-out-fixed",exit:"esri-icon-zoom-in-fixed",disabled:"esri-disabled"};let mf=class extends RS{constructor(t,e){super(t,e),this.messages=null,this.viewModel=new hTe}get element(){return this.viewModel.element}set element(t){this.viewModel.element=t}get fullscreenTitle(){var e;const t=(e=this.viewModel)==null?void 0:e.state;return t==="active"?this.messages.exit:t==="ready"?this.messages.enter:""}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){var r;const t=(r=this.viewModel)==null?void 0:r.state,{fullscreenTitle:e}=this,i={[Mx.disabled]:t==="disabled"||t==="feature-unsupported"};return $o("div",{bind:this,class:this.classes(Mx.base,i),role:"button",tabIndex:0,onclick:this._toggle,onkeydown:this._toggle,"aria-label":e,title:e},this.renderIcon(),this.renderTitle())}renderIcon(){var i;const t=(i=this.viewModel)==null?void 0:i.state,e={[Mx.enter]:t==="ready"||t==="disabled"||t==="feature-unsupported",[Mx.exit]:t==="active"};return $o("span",{class:this.classes(Mx.icon,e),"aria-hidden":"true"})}renderTitle(){return $o("span",{class:Mx.text},this.fullscreenTitle)}_toggle(){this.viewModel.toggle()}};d([m()],mf.prototype,"element",null),d([m({readOnly:!0})],mf.prototype,"fullscreenTitle",null),d([m()],mf.prototype,"label",null),d([m(),wO("esri/widgets/Fullscreen/t9n/Fullscreen")],mf.prototype,"messages",void 0),d([m()],mf.prototype,"view",null),d([m({type:hTe})],mf.prototype,"viewModel",void 0),d([bO()],mf.prototype,"_toggle",null),mf=d([J("esri.widgets.Fullscreen")],mf);const tft=mf;function Coe(t){let e,i;return{c(){e=Ya("div"),i=L2(t[0]),pu(e,"class","title svelte-z0arw1")},m(r,n){Mf(r,e,n),Zo(e,i)},p(r,n){n&1&&YV(i,r[0])},d(r){r&&tp(e)}}}function ift(t){let e,i,r,n,s,o=t[0]&&Coe(t);return{c(){e=Ya("div"),i=Ya("div"),r=N1(),o&&o.c(),pu(i,"class","map svelte-z0arw1"),pu(e,"class","wrapper svelte-z0arw1")},m(a,l){Mf(a,e,l),Zo(e,i),Zo(e,r),o&&o.m(e,null),n||(s=STe(t[1].call(null,i)),n=!0)},p(a,[l]){a[0]?o?o.p(a,l):(o=Coe(a),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i:ty,o:ty,d(a){a&&tp(e),o&&o.d(),n=!1,s()}}}function rft(t,e,i){let{basemap:r="streets"}=e,{center:n=[0,0]}=e,{zoom:s=1}=e,{title:o=""}=e,{locations:a}=e,l=-1,c,u,p=window.innerWidth;const f=x=>{if(u.interacting)return Promise.resolve();{const S=a[x];S&&o!==""&&i(0,o=`${o} -> ${S.title}`),S||console.error("Error!",S,x,a);const P=c.basemap.baseLayers.getItemAt(0).tileInfo.zoomToScale(S.zoom);return u.goTo({center:[S.center[0],S.center[1]],scale:P,rotation:0,tilt:0}).then(()=>{i(0,o=S.title)},C=>(console.error("goto error",C),i(0,o=""),Promise.reject()))}},y=()=>{setTimeout(()=>{requestAnimationFrame(()=>{v()})},1e4)},v=()=>{l=l+1,f(l).then(()=>{zTe(u,c.ground.layers.getItemAt(0)).then(x=>{console.log("totalElevationDifference",x),y()},x=>{console.error("could not find elevation difference"),console.error(x)})},x=>{console.log("error",x),y()})},b=x=>{c=new nfe({basemap:r,ground:"world-elevation"});const S=new eft({container:x,map:c,center:n,zoom:s});if(p>768){const P=new tft({view:S});S.ui.add(P,"top-left")}S.when(()=>{i(6,u=S)})};return t.$$set=x=>{"basemap"in x&&i(2,r=x.basemap),"center"in x&&i(3,n=x.center),"zoom"in x&&i(4,s=x.zoom),"title"in x&&i(0,o=x.title),"locations"in x&&i(5,a=x.locations)},t.$$.update=()=>{t.$$.dirty&96&&u&&a&&a.length>0&&v()},[o,b,r,n,s,a,u]}class nft extends jN{constructor(e){super(),GN(this,e,rft,ift,zN,{basemap:2,center:3,zoom:4,title:0,locations:5})}}var ZV={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(i,r){r(e)})(Dm,function(i){var r="1.9.4";function n(h){var _,w,E,D;for(w=1,E=arguments.length;w<E;w++){D=arguments[w];for(_ in D)h[_]=D[_]}return h}var s=Object.create||function(){function h(){}return function(_){return h.prototype=_,new h}}();function o(h,_){var w=Array.prototype.slice;if(h.bind)return h.bind.apply(h,w.call(arguments,1));var E=w.call(arguments,2);return function(){return h.apply(_,E.length?E.concat(w.call(arguments)):arguments)}}var a=0;function l(h){return"_leaflet_id"in h||(h._leaflet_id=++a),h._leaflet_id}function c(h,_,w){var E,D,G,se;return se=function(){E=!1,D&&(G.apply(w,D),D=!1)},G=function(){E?D=arguments:(h.apply(w,arguments),setTimeout(se,_),E=!0)},G}function u(h,_,w){var E=_[1],D=_[0],G=E-D;return h===E&&w?h:((h-D)%G+G)%G+D}function p(){return!1}function f(h,_){if(_===!1)return h;var w=Math.pow(10,_===void 0?6:_);return Math.round(h*w)/w}function y(h){return h.trim?h.trim():h.replace(/^\s+|\s+$/g,"")}function v(h){return y(h).split(/\s+/)}function b(h,_){Object.prototype.hasOwnProperty.call(h,"options")||(h.options=h.options?s(h.options):{});for(var w in _)h.options[w]=_[w];return h.options}function x(h,_,w){var E=[];for(var D in h)E.push(encodeURIComponent(w?D.toUpperCase():D)+"="+encodeURIComponent(h[D]));return(!_||_.indexOf("?")===-1?"?":"&")+E.join("&")}var S=/\{ *([\w_ -]+) *\}/g;function P(h,_){return h.replace(S,function(w,E){var D=_[E];if(D===void 0)throw new Error("No value provided for variable "+w);return typeof D=="function"&&(D=D(_)),D})}var C=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"};function R(h,_){for(var w=0;w<h.length;w++)if(h[w]===_)return w;return-1}var N="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function $(h){return window["webkit"+h]||window["moz"+h]||window["ms"+h]}var k=0;function B(h){var _=+new Date,w=Math.max(0,16-(_-k));return k=_+w,window.setTimeout(h,w)}var W=window.requestAnimationFrame||$("RequestAnimationFrame")||B,Z=window.cancelAnimationFrame||$("CancelAnimationFrame")||$("CancelRequestAnimationFrame")||function(h){window.clearTimeout(h)};function K(h,_,w){if(w&&W===B)h.call(_);else return W.call(window,o(h,_))}function X(h){h&&Z.call(window,h)}var ae={__proto__:null,extend:n,create:s,bind:o,get lastId(){return a},stamp:l,throttle:c,wrapNum:u,falseFn:p,formatNum:f,trim:y,splitWords:v,setOptions:b,getParamString:x,template:P,isArray:C,indexOf:R,emptyImageUrl:N,requestFn:W,cancelFn:Z,requestAnimFrame:K,cancelAnimFrame:X};function re(){}re.extend=function(h){var _=function(){b(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},w=_.__super__=this.prototype,E=s(w);E.constructor=_,_.prototype=E;for(var D in this)Object.prototype.hasOwnProperty.call(this,D)&&D!=="prototype"&&D!=="__super__"&&(_[D]=this[D]);return h.statics&&n(_,h.statics),h.includes&&(ee(h.includes),n.apply(null,[E].concat(h.includes))),n(E,h),delete E.statics,delete E.includes,E.options&&(E.options=w.options?s(w.options):{},n(E.options,h.options)),E._initHooks=[],E.callInitHooks=function(){if(!this._initHooksCalled){w.callInitHooks&&w.callInitHooks.call(this),this._initHooksCalled=!0;for(var G=0,se=E._initHooks.length;G<se;G++)E._initHooks[G].call(this)}},_},re.include=function(h){var _=this.prototype.options;return n(this.prototype,h),h.options&&(this.prototype.options=_,this.mergeOptions(h.options)),this},re.mergeOptions=function(h){return n(this.prototype.options,h),this},re.addInitHook=function(h){var _=Array.prototype.slice.call(arguments,1),w=typeof h=="function"?h:function(){this[h].apply(this,_)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(w),this};function ee(h){if(!(typeof L>"u"||!L||!L.Mixin)){h=C(h)?h:[h];for(var _=0;_<h.length;_++)h[_]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var oe={on:function(h,_,w){if(typeof h=="object")for(var E in h)this._on(E,h[E],_);else{h=v(h);for(var D=0,G=h.length;D<G;D++)this._on(h[D],_,w)}return this},off:function(h,_,w){if(!arguments.length)delete this._events;else if(typeof h=="object")for(var E in h)this._off(E,h[E],_);else{h=v(h);for(var D=arguments.length===1,G=0,se=h.length;G<se;G++)D?this._off(h[G]):this._off(h[G],_,w)}return this},_on:function(h,_,w,E){if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}if(this._listens(h,_,w)===!1){w===this&&(w=void 0);var D={fn:_,ctx:w};E&&(D.once=!0),this._events=this._events||{},this._events[h]=this._events[h]||[],this._events[h].push(D)}},_off:function(h,_,w){var E,D,G;if(this._events&&(E=this._events[h],!!E)){if(arguments.length===1){if(this._firingCount)for(D=0,G=E.length;D<G;D++)E[D].fn=p;delete this._events[h];return}if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}var se=this._listens(h,_,w);if(se!==!1){var _e=E[se];this._firingCount&&(_e.fn=p,this._events[h]=E=E.slice()),E.splice(se,1)}}},fire:function(h,_,w){if(!this.listens(h,w))return this;var E=n({},_,{type:h,target:this,sourceTarget:_&&_.sourceTarget||this});if(this._events){var D=this._events[h];if(D){this._firingCount=this._firingCount+1||1;for(var G=0,se=D.length;G<se;G++){var _e=D[G],we=_e.fn;_e.once&&this.off(h,we,_e.ctx),we.call(_e.ctx||this,E)}this._firingCount--}}return w&&this._propagateEvent(E),this},listens:function(h,_,w,E){typeof h!="string"&&console.warn('"string" type argument expected');var D=_;typeof _!="function"&&(E=!!_,D=void 0,w=void 0);var G=this._events&&this._events[h];if(G&&G.length&&this._listens(h,D,w)!==!1)return!0;if(E){for(var se in this._eventParents)if(this._eventParents[se].listens(h,_,w,E))return!0}return!1},_listens:function(h,_,w){if(!this._events)return!1;var E=this._events[h]||[];if(!_)return!!E.length;w===this&&(w=void 0);for(var D=0,G=E.length;D<G;D++)if(E[D].fn===_&&E[D].ctx===w)return D;return!1},once:function(h,_,w){if(typeof h=="object")for(var E in h)this._on(E,h[E],_,!0);else{h=v(h);for(var D=0,G=h.length;D<G;D++)this._on(h[D],_,w,!0)}return this},addEventParent:function(h){return this._eventParents=this._eventParents||{},this._eventParents[l(h)]=h,this},removeEventParent:function(h){return this._eventParents&&delete this._eventParents[l(h)],this},_propagateEvent:function(h){for(var _ in this._eventParents)this._eventParents[_].fire(h.type,n({layer:h.target,propagatedFrom:h.target},h),!0)}};oe.addEventListener=oe.on,oe.removeEventListener=oe.clearAllEventListeners=oe.off,oe.addOneTimeEventListener=oe.once,oe.fireEvent=oe.fire,oe.hasEventListeners=oe.listens;var U=re.extend(oe);function V(h,_,w){this.x=w?Math.round(h):h,this.y=w?Math.round(_):_}var H=Math.trunc||function(h){return h>0?Math.floor(h):Math.ceil(h)};V.prototype={clone:function(){return new V(this.x,this.y)},add:function(h){return this.clone()._add(Y(h))},_add:function(h){return this.x+=h.x,this.y+=h.y,this},subtract:function(h){return this.clone()._subtract(Y(h))},_subtract:function(h){return this.x-=h.x,this.y-=h.y,this},divideBy:function(h){return this.clone()._divideBy(h)},_divideBy:function(h){return this.x/=h,this.y/=h,this},multiplyBy:function(h){return this.clone()._multiplyBy(h)},_multiplyBy:function(h){return this.x*=h,this.y*=h,this},scaleBy:function(h){return new V(this.x*h.x,this.y*h.y)},unscaleBy:function(h){return new V(this.x/h.x,this.y/h.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=H(this.x),this.y=H(this.y),this},distanceTo:function(h){h=Y(h);var _=h.x-this.x,w=h.y-this.y;return Math.sqrt(_*_+w*w)},equals:function(h){return h=Y(h),h.x===this.x&&h.y===this.y},contains:function(h){return h=Y(h),Math.abs(h.x)<=Math.abs(this.x)&&Math.abs(h.y)<=Math.abs(this.y)},toString:function(){return"Point("+f(this.x)+", "+f(this.y)+")"}};function Y(h,_,w){return h instanceof V?h:C(h)?new V(h[0],h[1]):h==null?h:typeof h=="object"&&"x"in h&&"y"in h?new V(h.x,h.y):new V(h,_,w)}function ie(h,_){if(h)for(var w=_?[h,_]:h,E=0,D=w.length;E<D;E++)this.extend(w[E])}ie.prototype={extend:function(h){var _,w;if(!h)return this;if(h instanceof V||typeof h[0]=="number"||"x"in h)_=w=Y(h);else if(h=le(h),_=h.min,w=h.max,!_||!w)return this;return!this.min&&!this.max?(this.min=_.clone(),this.max=w.clone()):(this.min.x=Math.min(_.x,this.min.x),this.max.x=Math.max(w.x,this.max.x),this.min.y=Math.min(_.y,this.min.y),this.max.y=Math.max(w.y,this.max.y)),this},getCenter:function(h){return Y((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,h)},getBottomLeft:function(){return Y(this.min.x,this.max.y)},getTopRight:function(){return Y(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(h){var _,w;return typeof h[0]=="number"||h instanceof V?h=Y(h):h=le(h),h instanceof ie?(_=h.min,w=h.max):_=w=h,_.x>=this.min.x&&w.x<=this.max.x&&_.y>=this.min.y&&w.y<=this.max.y},intersects:function(h){h=le(h);var _=this.min,w=this.max,E=h.min,D=h.max,G=D.x>=_.x&&E.x<=w.x,se=D.y>=_.y&&E.y<=w.y;return G&&se},overlaps:function(h){h=le(h);var _=this.min,w=this.max,E=h.min,D=h.max,G=D.x>_.x&&E.x<w.x,se=D.y>_.y&&E.y<w.y;return G&&se},isValid:function(){return!!(this.min&&this.max)},pad:function(h){var _=this.min,w=this.max,E=Math.abs(_.x-w.x)*h,D=Math.abs(_.y-w.y)*h;return le(Y(_.x-E,_.y-D),Y(w.x+E,w.y+D))},equals:function(h){return h?(h=le(h),this.min.equals(h.getTopLeft())&&this.max.equals(h.getBottomRight())):!1}};function le(h,_){return!h||h instanceof ie?h:new ie(h,_)}function ue(h,_){if(h)for(var w=_?[h,_]:h,E=0,D=w.length;E<D;E++)this.extend(w[E])}ue.prototype={extend:function(h){var _=this._southWest,w=this._northEast,E,D;if(h instanceof Ie)E=h,D=h;else if(h instanceof ue){if(E=h._southWest,D=h._northEast,!E||!D)return this}else return h?this.extend(Ve(h)||ve(h)):this;return!_&&!w?(this._southWest=new Ie(E.lat,E.lng),this._northEast=new Ie(D.lat,D.lng)):(_.lat=Math.min(E.lat,_.lat),_.lng=Math.min(E.lng,_.lng),w.lat=Math.max(D.lat,w.lat),w.lng=Math.max(D.lng,w.lng)),this},pad:function(h){var _=this._southWest,w=this._northEast,E=Math.abs(_.lat-w.lat)*h,D=Math.abs(_.lng-w.lng)*h;return new ue(new Ie(_.lat-E,_.lng-D),new Ie(w.lat+E,w.lng+D))},getCenter:function(){return new Ie((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ie(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ie(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(h){typeof h[0]=="number"||h instanceof Ie||"lat"in h?h=Ve(h):h=ve(h);var _=this._southWest,w=this._northEast,E,D;return h instanceof ue?(E=h.getSouthWest(),D=h.getNorthEast()):E=D=h,E.lat>=_.lat&&D.lat<=w.lat&&E.lng>=_.lng&&D.lng<=w.lng},intersects:function(h){h=ve(h);var _=this._southWest,w=this._northEast,E=h.getSouthWest(),D=h.getNorthEast(),G=D.lat>=_.lat&&E.lat<=w.lat,se=D.lng>=_.lng&&E.lng<=w.lng;return G&&se},overlaps:function(h){h=ve(h);var _=this._southWest,w=this._northEast,E=h.getSouthWest(),D=h.getNorthEast(),G=D.lat>_.lat&&E.lat<w.lat,se=D.lng>_.lng&&E.lng<w.lng;return G&&se},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(h,_){return h?(h=ve(h),this._southWest.equals(h.getSouthWest(),_)&&this._northEast.equals(h.getNorthEast(),_)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ve(h,_){return h instanceof ue?h:new ue(h,_)}function Ie(h,_,w){if(isNaN(h)||isNaN(_))throw new Error("Invalid LatLng object: ("+h+", "+_+")");this.lat=+h,this.lng=+_,w!==void 0&&(this.alt=+w)}Ie.prototype={equals:function(h,_){if(!h)return!1;h=Ve(h);var w=Math.max(Math.abs(this.lat-h.lat),Math.abs(this.lng-h.lng));return w<=(_===void 0?1e-9:_)},toString:function(h){return"LatLng("+f(this.lat,h)+", "+f(this.lng,h)+")"},distanceTo:function(h){return ot.distance(this,Ve(h))},wrap:function(){return ot.wrapLatLng(this)},toBounds:function(h){var _=180*h/40075017,w=_/Math.cos(Math.PI/180*this.lat);return ve([this.lat-_,this.lng-w],[this.lat+_,this.lng+w])},clone:function(){return new Ie(this.lat,this.lng,this.alt)}};function Ve(h,_,w){return h instanceof Ie?h:C(h)&&typeof h[0]!="object"?h.length===3?new Ie(h[0],h[1],h[2]):h.length===2?new Ie(h[0],h[1]):null:h==null?h:typeof h=="object"&&"lat"in h?new Ie(h.lat,"lng"in h?h.lng:h.lon,h.alt):_===void 0?null:new Ie(h,_,w)}var Mt={latLngToPoint:function(h,_){var w=this.projection.project(h),E=this.scale(_);return this.transformation._transform(w,E)},pointToLatLng:function(h,_){var w=this.scale(_),E=this.transformation.untransform(h,w);return this.projection.unproject(E)},project:function(h){return this.projection.project(h)},unproject:function(h){return this.projection.unproject(h)},scale:function(h){return 256*Math.pow(2,h)},zoom:function(h){return Math.log(h/256)/Math.LN2},getProjectedBounds:function(h){if(this.infinite)return null;var _=this.projection.bounds,w=this.scale(h),E=this.transformation.transform(_.min,w),D=this.transformation.transform(_.max,w);return new ie(E,D)},infinite:!1,wrapLatLng:function(h){var _=this.wrapLng?u(h.lng,this.wrapLng,!0):h.lng,w=this.wrapLat?u(h.lat,this.wrapLat,!0):h.lat,E=h.alt;return new Ie(w,_,E)},wrapLatLngBounds:function(h){var _=h.getCenter(),w=this.wrapLatLng(_),E=_.lat-w.lat,D=_.lng-w.lng;if(E===0&&D===0)return h;var G=h.getSouthWest(),se=h.getNorthEast(),_e=new Ie(G.lat-E,G.lng-D),we=new Ie(se.lat-E,se.lng-D);return new ue(_e,we)}},ot=n({},Mt,{wrapLng:[-180,180],R:6371e3,distance:function(h,_){var w=Math.PI/180,E=h.lat*w,D=_.lat*w,G=Math.sin((_.lat-h.lat)*w/2),se=Math.sin((_.lng-h.lng)*w/2),_e=G*G+Math.cos(E)*Math.cos(D)*se*se,we=2*Math.atan2(Math.sqrt(_e),Math.sqrt(1-_e));return this.R*we}}),Pt=6378137,qe={R:Pt,MAX_LATITUDE:85.0511287798,project:function(h){var _=Math.PI/180,w=this.MAX_LATITUDE,E=Math.max(Math.min(w,h.lat),-w),D=Math.sin(E*_);return new V(this.R*h.lng*_,this.R*Math.log((1+D)/(1-D))/2)},unproject:function(h){var _=180/Math.PI;return new Ie((2*Math.atan(Math.exp(h.y/this.R))-Math.PI/2)*_,h.x*_/this.R)},bounds:function(){var h=Pt*Math.PI;return new ie([-h,-h],[h,h])}()};function Ee(h,_,w,E){if(C(h)){this._a=h[0],this._b=h[1],this._c=h[2],this._d=h[3];return}this._a=h,this._b=_,this._c=w,this._d=E}Ee.prototype={transform:function(h,_){return this._transform(h.clone(),_)},_transform:function(h,_){return _=_||1,h.x=_*(this._a*h.x+this._b),h.y=_*(this._c*h.y+this._d),h},untransform:function(h,_){return _=_||1,new V((h.x/_-this._b)/this._a,(h.y/_-this._d)/this._c)}};function at(h,_,w,E){return new Ee(h,_,w,E)}var ht=n({},ot,{code:"EPSG:3857",projection:qe,transformation:function(){var h=.5/(Math.PI*qe.R);return at(h,.5,-h,.5)}()}),Ue=n({},ht,{code:"EPSG:900913"});function He(h){return document.createElementNS("http://www.w3.org/2000/svg",h)}function rt(h,_){var w="",E,D,G,se,_e,we;for(E=0,G=h.length;E<G;E++){for(_e=h[E],D=0,se=_e.length;D<se;D++)we=_e[D],w+=(D?"L":"M")+we.x+" "+we.y;w+=_?Tt.svg?"z":"x":""}return w||"M0 0"}var wt=document.documentElement.style,_t="ActiveXObject"in window,lt=_t&&!document.addEventListener,Xe="msLaunchUri"in navigator&&!("documentMode"in document),ct=Pi("webkit"),ti=Pi("android"),Ze=Pi("android 2")||Pi("android 3"),tt=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ot=ti&&Pi("Google")&&tt<537&&!("AudioNode"in window),kt=!!window.opera,$t=!Xe&&Pi("chrome"),cr=Pi("gecko")&&!ct&&!kt&&!_t,ji=!$t&&Pi("safari"),er=Pi("phantom"),Vt="OTransition"in wt,sr=navigator.platform.indexOf("Win")===0,Mi=_t&&"transition"in wt,Hi="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Ze,Ei="MozPerspective"in wt,ki=!window.L_DISABLE_3D&&(Mi||Hi||Ei)&&!Vt&&!er,Ai=typeof orientation<"u"||Pi("mobile"),or=Ai&&ct,tr=Ai&&Hi,_i=!window.PointerEvent&&window.MSPointerEvent,ir=!!(window.PointerEvent||_i),ur="ontouchstart"in window||!!window.TouchEvent,as=!window.L_NO_TOUCH&&(ur||ir),ls=Ai&&kt,yn=Ai&&cr,cs=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,kr=function(){var h=!1;try{var _=Object.defineProperty({},"passive",{get:function(){h=!0}});window.addEventListener("testPassiveEventSupport",p,_),window.removeEventListener("testPassiveEventSupport",p,_)}catch{}return h}(),Rr=function(){return!!document.createElement("canvas").getContext}(),$i=!!(document.createElementNS&&He("svg").createSVGRect),es=!!$i&&function(){var h=document.createElement("div");return h.innerHTML="<svg/>",(h.firstChild&&h.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),_s=!$i&&function(){try{var h=document.createElement("div");h.innerHTML='<v:shape adj="1"/>';var _=h.firstChild;return _.style.behavior="url(#default#VML)",_&&typeof _.adj=="object"}catch{return!1}}(),Zs=navigator.platform.indexOf("Mac")===0,de=navigator.platform.indexOf("Linux")===0;function Pi(h){return navigator.userAgent.toLowerCase().indexOf(h)>=0}var Tt={ie:_t,ielt9:lt,edge:Xe,webkit:ct,android:ti,android23:Ze,androidStock:Ot,opera:kt,chrome:$t,gecko:cr,safari:ji,phantom:er,opera12:Vt,win:sr,ie3d:Mi,webkit3d:Hi,gecko3d:Ei,any3d:ki,mobile:Ai,mobileWebkit:or,mobileWebkit3d:tr,msPointer:_i,pointer:ir,touch:as,touchNative:ur,mobileOpera:ls,mobileGecko:yn,retina:cs,passiveEvents:kr,canvas:Rr,svg:$i,vml:_s,inlineSvg:es,mac:Zs,linux:de},Un=Tt.msPointer?"MSPointerDown":"pointerdown",Ra=Tt.msPointer?"MSPointerMove":"pointermove",ut=Tt.msPointer?"MSPointerUp":"pointerup",_o=Tt.msPointer?"MSPointerCancel":"pointercancel",Rn={touchstart:Un,touchmove:Ra,touchend:ut,touchcancel:_o},kl={touchstart:Uo,touchmove:us,touchend:us,touchcancel:us},Xs={},Ls=!1;function Ma(h,_,w){return _==="touchstart"&&Oc(),kl[_]?(w=kl[_].bind(this,w),h.addEventListener(Rn[_],w,!1),w):(console.warn("wrong event specified:",_),p)}function ts(h,_,w){if(!Rn[_]){console.warn("wrong event specified:",_);return}h.removeEventListener(Rn[_],w,!1)}function ii(h){Xs[h.pointerId]=h}function Mu(h){Xs[h.pointerId]&&(Xs[h.pointerId]=h)}function Ul(h){delete Xs[h.pointerId]}function Oc(){Ls||(document.addEventListener(Un,ii,!0),document.addEventListener(Ra,Mu,!0),document.addEventListener(ut,Ul,!0),document.addEventListener(_o,Ul,!0),Ls=!0)}function us(h,_){if(_.pointerType!==(_.MSPOINTER_TYPE_MOUSE||"mouse")){_.touches=[];for(var w in Xs)_.touches.push(Xs[w]);_.changedTouches=[_],h(_)}}function Uo(h,_){_.MSPOINTER_TYPE_TOUCH&&_.pointerType===_.MSPOINTER_TYPE_TOUCH&&yo(_),us(h,_)}function zl(h){var _={},w,E;for(E in h)w=h[E],_[E]=w&&w.bind?w.bind(h):w;return h=_,_.type="dblclick",_.detail=2,_.isTrusted=!1,_._simulated=!0,_}var zn=200;function jr(h,_){h.addEventListener("dblclick",_);var w=0,E;function D(G){if(G.detail!==1){E=G.detail;return}if(!(G.pointerType==="mouse"||G.sourceCapabilities&&!G.sourceCapabilities.firesTouchEvents)){var se=kS(G);if(!(se.some(function(we){return we instanceof HTMLLabelElement&&we.attributes.for})&&!se.some(function(we){return we instanceof HTMLInputElement||we instanceof HTMLSelectElement}))){var _e=Date.now();_e-w<=zn?(E++,E===2&&_(zl(G))):E=1,w=_e}}}return h.addEventListener("click",D),{dblclick:_,simDblclick:D}}function Rc(h,_){h.removeEventListener("dblclick",_.dblclick),h.removeEventListener("click",_.simDblclick)}var Mc=um(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),ll=um(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),ed=ll==="webkitTransition"||ll==="OTransition"?ll+"End":"transitionend";function $u(h){return typeof h=="string"?document.getElementById(h):h}function $a(h,_){var w=h.style[_]||h.currentStyle&&h.currentStyle[_];if((!w||w==="auto")&&document.defaultView){var E=document.defaultView.getComputedStyle(h,null);w=E?E[_]:null}return w==="auto"?null:w}function Zi(h,_,w){var E=document.createElement(h);return E.className=_||"",w&&w.appendChild(E),E}function Ui(h){var _=h.parentNode;_&&_.removeChild(h)}function $c(h){for(;h.firstChild;)h.removeChild(h.firstChild)}function Bl(h){var _=h.parentNode;_&&_.lastChild!==h&&_.appendChild(h)}function Q(h){var _=h.parentNode;_&&_.firstChild!==h&&_.insertBefore(h,_.firstChild)}function Se(h,_){if(h.classList!==void 0)return h.classList.contains(_);var w=Xi(h);return w.length>0&&new RegExp("(^|\\s)"+_+"(\\s|$)").test(w)}function be(h,_){if(h.classList!==void 0)for(var w=v(_),E=0,D=w.length;E<D;E++)h.classList.add(w[E]);else if(!Se(h,_)){var G=Xi(h);Xr(h,(G?G+" ":"")+_)}}function yt(h,_){h.classList!==void 0?h.classList.remove(_):Xr(h,y((" "+Xi(h)+" ").replace(" "+_+" "," ")))}function Xr(h,_){h.className.baseVal===void 0?h.className=_:h.className.baseVal=_}function Xi(h){return h.correspondingElement&&(h=h.correspondingElement),h.className.baseVal===void 0?h.className:h.className.baseVal}function Mr(h,_){"opacity"in h.style?h.style.opacity=_:"filter"in h.style&&Iu(h,_)}function Iu(h,_){var w=!1,E="DXImageTransform.Microsoft.Alpha";try{w=h.filters.item(E)}catch{if(_===1)return}_=Math.round(_*100),w?(w.Enabled=_!==100,w.Opacity=_):h.style.filter+=" progid:"+E+"(opacity="+_+")"}function um(h){for(var _=document.documentElement.style,w=0;w<h.length;w++)if(h[w]in _)return h[w];return!1}function Lu(h,_,w){var E=_||new V(0,0);h.style[Mc]=(Tt.ie3d?"translate("+E.x+"px,"+E.y+"px)":"translate3d("+E.x+"px,"+E.y+"px,0)")+(w?" scale("+w+")":"")}function Mn(h,_){h._leaflet_pos=_,Tt.any3d?Lu(h,_):(h.style.left=_.x+"px",h.style.top=_.y+"px")}function hm(h){return h._leaflet_pos||new V(0,0)}var Fy,ky,dm;if("onselectstart"in document)Fy=function(){ci(window,"selectstart",yo)},ky=function(){cn(window,"selectstart",yo)};else{var Uy=um(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Fy=function(){if(Uy){var h=document.documentElement.style;dm=h[Uy],h[Uy]="none"}},ky=function(){Uy&&(document.documentElement.style[Uy]=dm,dm=void 0)}}function tw(){ci(window,"dragstart",yo)}function MS(){cn(window,"dragstart",yo)}var iw,$S;function IS(h){for(;h.tabIndex===-1;)h=h.parentNode;h.style&&(rw(),iw=h,$S=h.style.outlineStyle,h.style.outlineStyle="none",ci(window,"keydown",rw))}function rw(){iw&&(iw.style.outlineStyle=$S,iw=void 0,$S=void 0,cn(window,"keydown",rw))}function xO(h){do h=h.parentNode;while((!h.offsetWidth||!h.offsetHeight)&&h!==document.body);return h}function LS(h){var _=h.getBoundingClientRect();return{x:_.width/h.offsetWidth||1,y:_.height/h.offsetHeight||1,boundingClientRect:_}}var aF={__proto__:null,TRANSFORM:Mc,TRANSITION:ll,TRANSITION_END:ed,get:$u,getStyle:$a,create:Zi,remove:Ui,empty:$c,toFront:Bl,toBack:Q,hasClass:Se,addClass:be,removeClass:yt,setClass:Xr,getClass:Xi,setOpacity:Mr,testProp:um,setTransform:Lu,setPosition:Mn,getPosition:hm,get disableTextSelection(){return Fy},get enableTextSelection(){return ky},disableImageDrag:tw,enableImageDrag:MS,preventOutline:IS,restoreOutline:rw,getSizedParentNode:xO,getScale:LS};function ci(h,_,w,E){if(_&&typeof _=="object")for(var D in _)Nu(h,D,_[D],w);else{_=v(_);for(var G=0,se=_.length;G<se;G++)Nu(h,_[G],w,E)}return this}var Du="_leaflet_events";function cn(h,_,w,E){if(arguments.length===1)DS(h),delete h[Du];else if(_&&typeof _=="object")for(var D in _)FS(h,D,_[D],w);else if(_=v(_),arguments.length===2)DS(h,function(_e){return R(_,_e)!==-1});else for(var G=0,se=_.length;G<se;G++)FS(h,_[G],w,E);return this}function DS(h,_){for(var w in h[Du]){var E=w.split(/\d/)[0];(!_||_(E))&&FS(h,E,null,null,w)}}var NS={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Nu(h,_,w,E){var D=_+l(w)+(E?"_"+l(E):"");if(h[Du]&&h[Du][D])return this;var G=function(_e){return w.call(E||h,_e||window.event)},se=G;!Tt.touchNative&&Tt.pointer&&_.indexOf("touch")===0?G=Ma(h,_,G):Tt.touch&&_==="dblclick"?G=jr(h,G):"addEventListener"in h?_==="touchstart"||_==="touchmove"||_==="wheel"||_==="mousewheel"?h.addEventListener(NS[_]||_,G,Tt.passiveEvents?{passive:!1}:!1):_==="mouseenter"||_==="mouseleave"?(G=function(_e){_e=_e||window.event,US(h,_e)&&se(_e)},h.addEventListener(NS[_],G,!1)):h.addEventListener(_,se,!1):h.attachEvent("on"+_,G),h[Du]=h[Du]||{},h[Du][D]=G}function FS(h,_,w,E,D){D=D||_+l(w)+(E?"_"+l(E):"");var G=h[Du]&&h[Du][D];if(!G)return this;!Tt.touchNative&&Tt.pointer&&_.indexOf("touch")===0?ts(h,_,G):Tt.touch&&_==="dblclick"?Rc(h,G):"removeEventListener"in h?h.removeEventListener(NS[_]||_,G,!1):h.detachEvent("on"+_,G),h[Du][D]=null}function Tp(h){return h.stopPropagation?h.stopPropagation():h.originalEvent?h.originalEvent._stopped=!0:h.cancelBubble=!0,this}function pm(h){return Nu(h,"wheel",Tp),this}function zy(h){return ci(h,"mousedown touchstart dblclick contextmenu",Tp),h._leaflet_disable_click=!0,this}function yo(h){return h.preventDefault?h.preventDefault():h.returnValue=!1,this}function fm(h){return yo(h),Tp(h),this}function kS(h){if(h.composedPath)return h.composedPath();for(var _=[],w=h.target;w;)_.push(w),w=w.parentNode;return _}function mm(h,_){if(!_)return new V(h.clientX,h.clientY);var w=LS(_),E=w.boundingClientRect;return new V((h.clientX-E.left)/w.x-_.clientLeft,(h.clientY-E.top)/w.y-_.clientTop)}var lF=Tt.linux&&Tt.chrome?window.devicePixelRatio:Tt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function TO(h){return Tt.edge?h.wheelDeltaY/2:h.deltaY&&h.deltaMode===0?-h.deltaY/lF:h.deltaY&&h.deltaMode===1?-h.deltaY*20:h.deltaY&&h.deltaMode===2?-h.deltaY*60:h.deltaX||h.deltaZ?0:h.wheelDelta?(h.wheelDeltaY||h.wheelDelta)/2:h.detail&&Math.abs(h.detail)<32765?-h.detail*20:h.detail?h.detail/-32765*60:0}function US(h,_){var w=_.relatedTarget;if(!w)return!0;try{for(;w&&w!==h;)w=w.parentNode}catch{return!1}return w!==h}var cF={__proto__:null,on:ci,off:cn,stopPropagation:Tp,disableScrollPropagation:pm,disableClickPropagation:zy,preventDefault:yo,stop:fm,getPropagationPath:kS,getMousePosition:mm,getWheelDelta:TO,isExternalTarget:US,addListener:ci,removeListener:cn},SO=U.extend({run:function(h,_,w,E){this.stop(),this._el=h,this._inProgress=!0,this._duration=w||.25,this._easeOutPower=1/Math.max(E||.5,.2),this._startPos=hm(h),this._offset=_.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=K(this._animate,this),this._step()},_step:function(h){var _=+new Date-this._startTime,w=this._duration*1e3;_<w?this._runFrame(this._easeOut(_/w),h):(this._runFrame(1),this._complete())},_runFrame:function(h,_){var w=this._startPos.add(this._offset.multiplyBy(h));_&&w._round(),Mn(this._el,w),this.fire("step")},_complete:function(){X(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(h){return 1-Math.pow(1-h,this._easeOutPower)}}),hr=U.extend({options:{crs:ht,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(h,_){_=b(this,_),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(h),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),_.maxBounds&&this.setMaxBounds(_.maxBounds),_.zoom!==void 0&&(this._zoom=this._limitZoom(_.zoom)),_.center&&_.zoom!==void 0&&this.setView(Ve(_.center),_.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=ll&&Tt.any3d&&!Tt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ci(this._proxy,ed,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(h,_,w){if(_=_===void 0?this._zoom:this._limitZoom(_),h=this._limitCenter(Ve(h),_,this.options.maxBounds),w=w||{},this._stop(),this._loaded&&!w.reset&&w!==!0){w.animate!==void 0&&(w.zoom=n({animate:w.animate},w.zoom),w.pan=n({animate:w.animate,duration:w.duration},w.pan));var E=this._zoom!==_?this._tryAnimatedZoom&&this._tryAnimatedZoom(h,_,w.zoom):this._tryAnimatedPan(h,w.pan);if(E)return clearTimeout(this._sizeTimer),this}return this._resetView(h,_,w.pan&&w.pan.noMoveStart),this},setZoom:function(h,_){return this._loaded?this.setView(this.getCenter(),h,{zoom:_}):(this._zoom=h,this)},zoomIn:function(h,_){return h=h||(Tt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+h,_)},zoomOut:function(h,_){return h=h||(Tt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-h,_)},setZoomAround:function(h,_,w){var E=this.getZoomScale(_),D=this.getSize().divideBy(2),G=h instanceof V?h:this.latLngToContainerPoint(h),se=G.subtract(D).multiplyBy(1-1/E),_e=this.containerPointToLatLng(D.add(se));return this.setView(_e,_,{zoom:w})},_getBoundsCenterZoom:function(h,_){_=_||{},h=h.getBounds?h.getBounds():ve(h);var w=Y(_.paddingTopLeft||_.padding||[0,0]),E=Y(_.paddingBottomRight||_.padding||[0,0]),D=this.getBoundsZoom(h,!1,w.add(E));if(D=typeof _.maxZoom=="number"?Math.min(_.maxZoom,D):D,D===1/0)return{center:h.getCenter(),zoom:D};var G=E.subtract(w).divideBy(2),se=this.project(h.getSouthWest(),D),_e=this.project(h.getNorthEast(),D),we=this.unproject(se.add(_e).divideBy(2).add(G),D);return{center:we,zoom:D}},fitBounds:function(h,_){if(h=ve(h),!h.isValid())throw new Error("Bounds are not valid.");var w=this._getBoundsCenterZoom(h,_);return this.setView(w.center,w.zoom,_)},fitWorld:function(h){return this.fitBounds([[-90,-180],[90,180]],h)},panTo:function(h,_){return this.setView(h,this._zoom,{pan:_})},panBy:function(h,_){if(h=Y(h).round(),_=_||{},!h.x&&!h.y)return this.fire("moveend");if(_.animate!==!0&&!this.getSize().contains(h))return this._resetView(this.unproject(this.project(this.getCenter()).add(h)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new SO,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),_.noMoveStart||this.fire("movestart"),_.animate!==!1){be(this._mapPane,"leaflet-pan-anim");var w=this._getMapPanePos().subtract(h).round();this._panAnim.run(this._mapPane,w,_.duration||.25,_.easeLinearity)}else this._rawPanBy(h),this.fire("move").fire("moveend");return this},flyTo:function(h,_,w){if(w=w||{},w.animate===!1||!Tt.any3d)return this.setView(h,_,w);this._stop();var E=this.project(this.getCenter()),D=this.project(h),G=this.getSize(),se=this._zoom;h=Ve(h),_=_===void 0?se:_;var _e=Math.max(G.x,G.y),we=_e*this.getZoomScale(se,_),Be=D.distanceTo(E)||1,St=1.42,ui=St*St;function rr(Js){var YO=Js?-1:1,_Te=Js?we:_e,yTe=we*we-_e*_e+YO*ui*ui*Be*Be,vTe=2*_Te*ui*Be,EF=yTe/vTe,SZ=Math.sqrt(EF*EF+1)-EF,bTe=SZ<1e-9?-18:Math.log(SZ);return bTe}function cl(Js){return(Math.exp(Js)-Math.exp(-Js))/2}function zo(Js){return(Math.exp(Js)+Math.exp(-Js))/2}function Fu(Js){return cl(Js)/zo(Js)}var Gl=rr(0);function ww(Js){return _e*(zo(Gl)/zo(Gl+St*Js))}function pTe(Js){return _e*(zo(Gl)*Fu(Gl+St*Js)-cl(Gl))/ui}function fTe(Js){return 1-Math.pow(1-Js,1.5)}var mTe=Date.now(),xZ=(rr(1)-Gl)/St,gTe=w.duration?1e3*w.duration:1e3*xZ*.8;function TZ(){var Js=(Date.now()-mTe)/gTe,YO=fTe(Js)*xZ;Js<=1?(this._flyToFrame=K(TZ,this),this._move(this.unproject(E.add(D.subtract(E).multiplyBy(pTe(YO)/Be)),se),this.getScaleZoom(_e/ww(YO),se),{flyTo:!0})):this._move(h,_)._moveEnd(!0)}return this._moveStart(!0,w.noMoveStart),TZ.call(this),this},flyToBounds:function(h,_){var w=this._getBoundsCenterZoom(h,_);return this.flyTo(w.center,w.zoom,_)},setMaxBounds:function(h){return h=ve(h),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),h.isValid()?(this.options.maxBounds=h,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(h){var _=this.options.minZoom;return this.options.minZoom=h,this._loaded&&_!==h&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(h):this},setMaxZoom:function(h){var _=this.options.maxZoom;return this.options.maxZoom=h,this._loaded&&_!==h&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(h):this},panInsideBounds:function(h,_){this._enforcingBounds=!0;var w=this.getCenter(),E=this._limitCenter(w,this._zoom,ve(h));return w.equals(E)||this.panTo(E,_),this._enforcingBounds=!1,this},panInside:function(h,_){_=_||{};var w=Y(_.paddingTopLeft||_.padding||[0,0]),E=Y(_.paddingBottomRight||_.padding||[0,0]),D=this.project(this.getCenter()),G=this.project(h),se=this.getPixelBounds(),_e=le([se.min.add(w),se.max.subtract(E)]),we=_e.getSize();if(!_e.contains(G)){this._enforcingBounds=!0;var Be=G.subtract(_e.getCenter()),St=_e.extend(G).getSize().subtract(we);D.x+=Be.x<0?-St.x:St.x,D.y+=Be.y<0?-St.y:St.y,this.panTo(this.unproject(D),_),this._enforcingBounds=!1}return this},invalidateSize:function(h){if(!this._loaded)return this;h=n({animate:!1,pan:!0},h===!0?{animate:!0}:h);var _=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var w=this.getSize(),E=_.divideBy(2).round(),D=w.divideBy(2).round(),G=E.subtract(D);return!G.x&&!G.y?this:(h.animate&&h.pan?this.panBy(G):(h.pan&&this._rawPanBy(G),this.fire("move"),h.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:_,newSize:w}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(h){if(h=this._locateOptions=n({timeout:1e4,watch:!1},h),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var _=o(this._handleGeolocationResponse,this),w=o(this._handleGeolocationError,this);return h.watch?this._locationWatchId=navigator.geolocation.watchPosition(_,w,h):navigator.geolocation.getCurrentPosition(_,w,h),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(h){if(this._container._leaflet_id){var _=h.code,w=h.message||(_===1?"permission denied":_===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:_,message:"Geolocation error: "+w+"."})}},_handleGeolocationResponse:function(h){if(this._container._leaflet_id){var _=h.coords.latitude,w=h.coords.longitude,E=new Ie(_,w),D=E.toBounds(h.coords.accuracy*2),G=this._locateOptions;if(G.setView){var se=this.getBoundsZoom(D);this.setView(E,G.maxZoom?Math.min(se,G.maxZoom):se)}var _e={latlng:E,bounds:D,timestamp:h.timestamp};for(var we in h.coords)typeof h.coords[we]=="number"&&(_e[we]=h.coords[we]);this.fire("locationfound",_e)}},addHandler:function(h,_){if(!_)return this;var w=this[h]=new _(this);return this._handlers.push(w),this.options[h]&&w.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Ui(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(X(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var h;for(h in this._layers)this._layers[h].remove();for(h in this._panes)Ui(this._panes[h]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(h,_){var w="leaflet-pane"+(h?" leaflet-"+h.replace("Pane","")+"-pane":""),E=Zi("div",w,_||this._mapPane);return h&&(this._panes[h]=E),E},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var h=this.getPixelBounds(),_=this.unproject(h.getBottomLeft()),w=this.unproject(h.getTopRight());return new ue(_,w)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(h,_,w){h=ve(h),w=Y(w||[0,0]);var E=this.getZoom()||0,D=this.getMinZoom(),G=this.getMaxZoom(),se=h.getNorthWest(),_e=h.getSouthEast(),we=this.getSize().subtract(w),Be=le(this.project(_e,E),this.project(se,E)).getSize(),St=Tt.any3d?this.options.zoomSnap:1,ui=we.x/Be.x,rr=we.y/Be.y,cl=_?Math.max(ui,rr):Math.min(ui,rr);return E=this.getScaleZoom(cl,E),St&&(E=Math.round(E/(St/100))*(St/100),E=_?Math.ceil(E/St)*St:Math.floor(E/St)*St),Math.max(D,Math.min(G,E))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new V(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(h,_){var w=this._getTopLeftPoint(h,_);return new ie(w,w.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(h){return this.options.crs.getProjectedBounds(h===void 0?this.getZoom():h)},getPane:function(h){return typeof h=="string"?this._panes[h]:h},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(h,_){var w=this.options.crs;return _=_===void 0?this._zoom:_,w.scale(h)/w.scale(_)},getScaleZoom:function(h,_){var w=this.options.crs;_=_===void 0?this._zoom:_;var E=w.zoom(h*w.scale(_));return isNaN(E)?1/0:E},project:function(h,_){return _=_===void 0?this._zoom:_,this.options.crs.latLngToPoint(Ve(h),_)},unproject:function(h,_){return _=_===void 0?this._zoom:_,this.options.crs.pointToLatLng(Y(h),_)},layerPointToLatLng:function(h){var _=Y(h).add(this.getPixelOrigin());return this.unproject(_)},latLngToLayerPoint:function(h){var _=this.project(Ve(h))._round();return _._subtract(this.getPixelOrigin())},wrapLatLng:function(h){return this.options.crs.wrapLatLng(Ve(h))},wrapLatLngBounds:function(h){return this.options.crs.wrapLatLngBounds(ve(h))},distance:function(h,_){return this.options.crs.distance(Ve(h),Ve(_))},containerPointToLayerPoint:function(h){return Y(h).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(h){return Y(h).add(this._getMapPanePos())},containerPointToLatLng:function(h){var _=this.containerPointToLayerPoint(Y(h));return this.layerPointToLatLng(_)},latLngToContainerPoint:function(h){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Ve(h)))},mouseEventToContainerPoint:function(h){return mm(h,this._container)},mouseEventToLayerPoint:function(h){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(h))},mouseEventToLatLng:function(h){return this.layerPointToLatLng(this.mouseEventToLayerPoint(h))},_initContainer:function(h){var _=this._container=$u(h);if(_){if(_._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ci(_,"scroll",this._onScroll,this),this._containerId=l(_)},_initLayout:function(){var h=this._container;this._fadeAnimated=this.options.fadeAnimation&&Tt.any3d,be(h,"leaflet-container"+(Tt.touch?" leaflet-touch":"")+(Tt.retina?" leaflet-retina":"")+(Tt.ielt9?" leaflet-oldie":"")+(Tt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var _=$a(h,"position");_!=="absolute"&&_!=="relative"&&_!=="fixed"&&_!=="sticky"&&(h.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var h=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Mn(this._mapPane,new V(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(be(h.markerPane,"leaflet-zoom-hide"),be(h.shadowPane,"leaflet-zoom-hide"))},_resetView:function(h,_,w){Mn(this._mapPane,new V(0,0));var E=!this._loaded;this._loaded=!0,_=this._limitZoom(_),this.fire("viewprereset");var D=this._zoom!==_;this._moveStart(D,w)._move(h,_)._moveEnd(D),this.fire("viewreset"),E&&this.fire("load")},_moveStart:function(h,_){return h&&this.fire("zoomstart"),_||this.fire("movestart"),this},_move:function(h,_,w,E){_===void 0&&(_=this._zoom);var D=this._zoom!==_;return this._zoom=_,this._lastCenter=h,this._pixelOrigin=this._getNewPixelOrigin(h),E?w&&w.pinch&&this.fire("zoom",w):((D||w&&w.pinch)&&this.fire("zoom",w),this.fire("move",w)),this},_moveEnd:function(h){return h&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return X(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(h){Mn(this._mapPane,this._getMapPanePos().subtract(h))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(h){this._targets={},this._targets[l(this._container)]=this;var _=h?cn:ci;_(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&_(window,"resize",this._onResize,this),Tt.any3d&&this.options.transform3DLimit&&(h?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){X(this._resizeRequest),this._resizeRequest=K(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var h=this._getMapPanePos();Math.max(Math.abs(h.x),Math.abs(h.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(h,_){for(var w=[],E,D=_==="mouseout"||_==="mouseover",G=h.target||h.srcElement,se=!1;G;){if(E=this._targets[l(G)],E&&(_==="click"||_==="preclick")&&this._draggableMoved(E)){se=!0;break}if(E&&E.listens(_,!0)&&(D&&!US(G,h)||(w.push(E),D))||G===this._container)break;G=G.parentNode}return!w.length&&!se&&!D&&this.listens(_,!0)&&(w=[this]),w},_isClickDisabled:function(h){for(;h&&h!==this._container;){if(h._leaflet_disable_click)return!0;h=h.parentNode}},_handleDOMEvent:function(h){var _=h.target||h.srcElement;if(!(!this._loaded||_._leaflet_disable_events||h.type==="click"&&this._isClickDisabled(_))){var w=h.type;w==="mousedown"&&IS(_),this._fireDOMEvent(h,w)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(h,_,w){if(h.type==="click"){var E=n({},h);E.type="preclick",this._fireDOMEvent(E,E.type,w)}var D=this._findEventTargets(h,_);if(w){for(var G=[],se=0;se<w.length;se++)w[se].listens(_,!0)&&G.push(w[se]);D=G.concat(D)}if(D.length){_==="contextmenu"&&yo(h);var _e=D[0],we={originalEvent:h};if(h.type!=="keypress"&&h.type!=="keydown"&&h.type!=="keyup"){var Be=_e.getLatLng&&(!_e._radius||_e._radius<=10);we.containerPoint=Be?this.latLngToContainerPoint(_e.getLatLng()):this.mouseEventToContainerPoint(h),we.layerPoint=this.containerPointToLayerPoint(we.containerPoint),we.latlng=Be?_e.getLatLng():this.layerPointToLatLng(we.layerPoint)}for(se=0;se<D.length;se++)if(D[se].fire(_,we,!0),we.originalEvent._stopped||D[se].options.bubblingMouseEvents===!1&&R(this._mouseEvents,_)!==-1)return}},_draggableMoved:function(h){return h=h.dragging&&h.dragging.enabled()?h:this,h.dragging&&h.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var h=0,_=this._handlers.length;h<_;h++)this._handlers[h].disable()},whenReady:function(h,_){return this._loaded?h.call(_||this,{target:this}):this.on("load",h,_),this},_getMapPanePos:function(){return hm(this._mapPane)||new V(0,0)},_moved:function(){var h=this._getMapPanePos();return h&&!h.equals([0,0])},_getTopLeftPoint:function(h,_){var w=h&&_!==void 0?this._getNewPixelOrigin(h,_):this.getPixelOrigin();return w.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(h,_){var w=this.getSize()._divideBy(2);return this.project(h,_)._subtract(w)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(h,_,w){var E=this._getNewPixelOrigin(w,_);return this.project(h,_)._subtract(E)},_latLngBoundsToNewLayerBounds:function(h,_,w){var E=this._getNewPixelOrigin(w,_);return le([this.project(h.getSouthWest(),_)._subtract(E),this.project(h.getNorthWest(),_)._subtract(E),this.project(h.getSouthEast(),_)._subtract(E),this.project(h.getNorthEast(),_)._subtract(E)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(h){return this.latLngToLayerPoint(h).subtract(this._getCenterLayerPoint())},_limitCenter:function(h,_,w){if(!w)return h;var E=this.project(h,_),D=this.getSize().divideBy(2),G=new ie(E.subtract(D),E.add(D)),se=this._getBoundsOffset(G,w,_);return Math.abs(se.x)<=1&&Math.abs(se.y)<=1?h:this.unproject(E.add(se),_)},_limitOffset:function(h,_){if(!_)return h;var w=this.getPixelBounds(),E=new ie(w.min.add(h),w.max.add(h));return h.add(this._getBoundsOffset(E,_))},_getBoundsOffset:function(h,_,w){var E=le(this.project(_.getNorthEast(),w),this.project(_.getSouthWest(),w)),D=E.min.subtract(h.min),G=E.max.subtract(h.max),se=this._rebound(D.x,-G.x),_e=this._rebound(D.y,-G.y);return new V(se,_e)},_rebound:function(h,_){return h+_>0?Math.round(h-_)/2:Math.max(0,Math.ceil(h))-Math.max(0,Math.floor(_))},_limitZoom:function(h){var _=this.getMinZoom(),w=this.getMaxZoom(),E=Tt.any3d?this.options.zoomSnap:1;return E&&(h=Math.round(h/E)*E),Math.max(_,Math.min(w,h))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){yt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(h,_){var w=this._getCenterOffset(h)._trunc();return(_&&_.animate)!==!0&&!this.getSize().contains(w)?!1:(this.panBy(w,_),!0)},_createAnimProxy:function(){var h=this._proxy=Zi("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(h),this.on("zoomanim",function(_){var w=Mc,E=this._proxy.style[w];Lu(this._proxy,this.project(_.center,_.zoom),this.getZoomScale(_.zoom,1)),E===this._proxy.style[w]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Ui(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var h=this.getCenter(),_=this.getZoom();Lu(this._proxy,this.project(h,_),this.getZoomScale(_,1))},_catchTransitionEnd:function(h){this._animatingZoom&&h.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(h,_,w){if(this._animatingZoom)return!0;if(w=w||{},!this._zoomAnimated||w.animate===!1||this._nothingToAnimate()||Math.abs(_-this._zoom)>this.options.zoomAnimationThreshold)return!1;var E=this.getZoomScale(_),D=this._getCenterOffset(h)._divideBy(1-1/E);return w.animate!==!0&&!this.getSize().contains(D)?!1:(K(function(){this._moveStart(!0,w.noMoveStart||!1)._animateZoom(h,_,!0)},this),!0)},_animateZoom:function(h,_,w,E){this._mapPane&&(w&&(this._animatingZoom=!0,this._animateToCenter=h,this._animateToZoom=_,be(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:h,zoom:_,noUpdate:E}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&yt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function uF(h,_){return new hr(h,_)}var Ic=re.extend({options:{position:"topright"},initialize:function(h){b(this,h)},getPosition:function(){return this.options.position},setPosition:function(h){var _=this._map;return _&&_.removeControl(this),this.options.position=h,_&&_.addControl(this),this},getContainer:function(){return this._container},addTo:function(h){this.remove(),this._map=h;var _=this._container=this.onAdd(h),w=this.getPosition(),E=h._controlCorners[w];return be(_,"leaflet-control"),w.indexOf("bottom")!==-1?E.insertBefore(_,E.firstChild):E.appendChild(_),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Ui(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(h){this._map&&h&&h.screenX>0&&h.screenY>0&&this._map.getContainer().focus()}}),By=function(h){return new Ic(h)};hr.include({addControl:function(h){return h.addTo(this),this},removeControl:function(h){return h.remove(),this},_initControlPos:function(){var h=this._controlCorners={},_="leaflet-",w=this._controlContainer=Zi("div",_+"control-container",this._container);function E(D,G){var se=_+D+" "+_+G;h[D+G]=Zi("div",se,w)}E("top","left"),E("top","right"),E("bottom","left"),E("bottom","right")},_clearControlPos:function(){for(var h in this._controlCorners)Ui(this._controlCorners[h]);Ui(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var nw=Ic.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(h,_,w,E){return w<E?-1:E<w?1:0}},initialize:function(h,_,w){b(this,w),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var E in h)this._addLayer(h[E],E);for(E in _)this._addLayer(_[E],E,!0)},onAdd:function(h){this._initLayout(),this._update(),this._map=h,h.on("zoomend",this._checkDisabledLayers,this);for(var _=0;_<this._layers.length;_++)this._layers[_].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(h){return Ic.prototype.addTo.call(this,h),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var h=0;h<this._layers.length;h++)this._layers[h].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(h,_){return this._addLayer(h,_),this._map?this._update():this},addOverlay:function(h,_){return this._addLayer(h,_,!0),this._map?this._update():this},removeLayer:function(h){h.off("add remove",this._onLayerChange,this);var _=this._getLayer(l(h));return _&&this._layers.splice(this._layers.indexOf(_),1),this._map?this._update():this},expand:function(){be(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var h=this._map.getSize().y-(this._container.offsetTop+50);return h<this._section.clientHeight?(be(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=h+"px"):yt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return yt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var h="leaflet-control-layers",_=this._container=Zi("div",h),w=this.options.collapsed;_.setAttribute("aria-haspopup",!0),zy(_),pm(_);var E=this._section=Zi("section",h+"-list");w&&(this._map.on("click",this.collapse,this),ci(_,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var D=this._layersLink=Zi("a",h+"-toggle",_);D.href="#",D.title="Layers",D.setAttribute("role","button"),ci(D,{keydown:function(G){G.keyCode===13&&this._expandSafely()},click:function(G){yo(G),this._expandSafely()}},this),w||this.expand(),this._baseLayersList=Zi("div",h+"-base",E),this._separator=Zi("div",h+"-separator",E),this._overlaysList=Zi("div",h+"-overlays",E),_.appendChild(E)},_getLayer:function(h){for(var _=0;_<this._layers.length;_++)if(this._layers[_]&&l(this._layers[_].layer)===h)return this._layers[_]},_addLayer:function(h,_,w){this._map&&h.on("add remove",this._onLayerChange,this),this._layers.push({layer:h,name:_,overlay:w}),this.options.sortLayers&&this._layers.sort(o(function(E,D){return this.options.sortFunction(E.layer,D.layer,E.name,D.name)},this)),this.options.autoZIndex&&h.setZIndex&&(this._lastZIndex++,h.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;$c(this._baseLayersList),$c(this._overlaysList),this._layerControlInputs=[];var h,_,w,E,D=0;for(w=0;w<this._layers.length;w++)E=this._layers[w],this._addItem(E),_=_||E.overlay,h=h||!E.overlay,D+=E.overlay?0:1;return this.options.hideSingleBase&&(h=h&&D>1,this._baseLayersList.style.display=h?"":"none"),this._separator.style.display=_&&h?"":"none",this},_onLayerChange:function(h){this._handlingClick||this._update();var _=this._getLayer(l(h.target)),w=_.overlay?h.type==="add"?"overlayadd":"overlayremove":h.type==="add"?"baselayerchange":null;w&&this._map.fire(w,_)},_createRadioElement:function(h,_){var w='<input type="radio" class="leaflet-control-layers-selector" name="'+h+'"'+(_?' checked="checked"':"")+"/>",E=document.createElement("div");return E.innerHTML=w,E.firstChild},_addItem:function(h){var _=document.createElement("label"),w=this._map.hasLayer(h.layer),E;h.overlay?(E=document.createElement("input"),E.type="checkbox",E.className="leaflet-control-layers-selector",E.defaultChecked=w):E=this._createRadioElement("leaflet-base-layers_"+l(this),w),this._layerControlInputs.push(E),E.layerId=l(h.layer),ci(E,"click",this._onInputClick,this);var D=document.createElement("span");D.innerHTML=" "+h.name;var G=document.createElement("span");_.appendChild(G),G.appendChild(E),G.appendChild(D);var se=h.overlay?this._overlaysList:this._baseLayersList;return se.appendChild(_),this._checkDisabledLayers(),_},_onInputClick:function(){if(!this._preventClick){var h=this._layerControlInputs,_,w,E=[],D=[];this._handlingClick=!0;for(var G=h.length-1;G>=0;G--)_=h[G],w=this._getLayer(_.layerId).layer,_.checked?E.push(w):_.checked||D.push(w);for(G=0;G<D.length;G++)this._map.hasLayer(D[G])&&this._map.removeLayer(D[G]);for(G=0;G<E.length;G++)this._map.hasLayer(E[G])||this._map.addLayer(E[G]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var h=this._layerControlInputs,_,w,E=this._map.getZoom(),D=h.length-1;D>=0;D--)_=h[D],w=this._getLayer(_.layerId).layer,_.disabled=w.options.minZoom!==void 0&&E<w.options.minZoom||w.options.maxZoom!==void 0&&E>w.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var h=this._section;this._preventClick=!0,ci(h,"click",yo),this.expand();var _=this;setTimeout(function(){cn(h,"click",yo),_._preventClick=!1})}}),CO=function(h,_,w){return new nw(h,_,w)},zS=Ic.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(h){var _="leaflet-control-zoom",w=Zi("div",_+" leaflet-bar"),E=this.options;return this._zoomInButton=this._createButton(E.zoomInText,E.zoomInTitle,_+"-in",w,this._zoomIn),this._zoomOutButton=this._createButton(E.zoomOutText,E.zoomOutTitle,_+"-out",w,this._zoomOut),this._updateDisabled(),h.on("zoomend zoomlevelschange",this._updateDisabled,this),w},onRemove:function(h){h.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(h){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(h.shiftKey?3:1))},_zoomOut:function(h){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(h.shiftKey?3:1))},_createButton:function(h,_,w,E,D){var G=Zi("a",w,E);return G.innerHTML=h,G.href="#",G.title=_,G.setAttribute("role","button"),G.setAttribute("aria-label",_),zy(G),ci(G,"click",fm),ci(G,"click",D,this),ci(G,"click",this._refocusOnMap,this),G},_updateDisabled:function(){var h=this._map,_="leaflet-disabled";yt(this._zoomInButton,_),yt(this._zoomOutButton,_),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||h._zoom===h.getMinZoom())&&(be(this._zoomOutButton,_),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||h._zoom===h.getMaxZoom())&&(be(this._zoomInButton,_),this._zoomInButton.setAttribute("aria-disabled","true"))}});hr.mergeOptions({zoomControl:!0}),hr.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new zS,this.addControl(this.zoomControl))});var hF=function(h){return new zS(h)},EO=Ic.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(h){var _="leaflet-control-scale",w=Zi("div",_),E=this.options;return this._addScales(E,_+"-line",w),h.on(E.updateWhenIdle?"moveend":"move",this._update,this),h.whenReady(this._update,this),w},onRemove:function(h){h.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(h,_,w){h.metric&&(this._mScale=Zi("div",_,w)),h.imperial&&(this._iScale=Zi("div",_,w))},_update:function(){var h=this._map,_=h.getSize().y/2,w=h.distance(h.containerPointToLatLng([0,_]),h.containerPointToLatLng([this.options.maxWidth,_]));this._updateScales(w)},_updateScales:function(h){this.options.metric&&h&&this._updateMetric(h),this.options.imperial&&h&&this._updateImperial(h)},_updateMetric:function(h){var _=this._getRoundNum(h),w=_<1e3?_+" m":_/1e3+" km";this._updateScale(this._mScale,w,_/h)},_updateImperial:function(h){var _=h*3.2808399,w,E,D;_>5280?(w=_/5280,E=this._getRoundNum(w),this._updateScale(this._iScale,E+" mi",E/w)):(D=this._getRoundNum(_),this._updateScale(this._iScale,D+" ft",D/_))},_updateScale:function(h,_,w){h.style.width=Math.round(this.options.maxWidth*w)+"px",h.innerHTML=_},_getRoundNum:function(h){var _=Math.pow(10,(Math.floor(h)+"").length-1),w=h/_;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:1,_*w}}),AO=function(h){return new EO(h)},dF='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Vy=Ic.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Tt.inlineSvg?dF+" ":"")+"Leaflet</a>"},initialize:function(h){b(this,h),this._attributions={}},onAdd:function(h){h.attributionControl=this,this._container=Zi("div","leaflet-control-attribution"),zy(this._container);for(var _ in h._layers)h._layers[_].getAttribution&&this.addAttribution(h._layers[_].getAttribution());return this._update(),h.on("layeradd",this._addAttribution,this),this._container},onRemove:function(h){h.off("layeradd",this._addAttribution,this)},_addAttribution:function(h){h.layer.getAttribution&&(this.addAttribution(h.layer.getAttribution()),h.layer.once("remove",function(){this.removeAttribution(h.layer.getAttribution())},this))},setPrefix:function(h){return this.options.prefix=h,this._update(),this},addAttribution:function(h){return h?(this._attributions[h]||(this._attributions[h]=0),this._attributions[h]++,this._update(),this):this},removeAttribution:function(h){return h?(this._attributions[h]&&(this._attributions[h]--,this._update()),this):this},_update:function(){if(this._map){var h=[];for(var _ in this._attributions)this._attributions[_]&&h.push(_);var w=[];this.options.prefix&&w.push(this.options.prefix),h.length&&w.push(h.join(", ")),this._container.innerHTML=w.join(' <span aria-hidden="true">|</span> ')}}});hr.mergeOptions({attributionControl:!0}),hr.addInitHook(function(){this.options.attributionControl&&new Vy().addTo(this)});var PO=function(h){return new Vy(h)};Ic.Layers=nw,Ic.Zoom=zS,Ic.Scale=EO,Ic.Attribution=Vy,By.layers=CO,By.zoom=hF,By.scale=AO,By.attribution=PO;var Lc=re.extend({initialize:function(h){this._map=h},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Lc.addTo=function(h,_){return h.addHandler(_,this),this};var BS={Events:oe},Gy=Tt.touch?"touchstart mousedown":"mousedown",Sp=U.extend({options:{clickTolerance:3},initialize:function(h,_,w,E){b(this,E),this._element=h,this._dragStartTarget=_||h,this._preventOutline=w},enable:function(){this._enabled||(ci(this._dragStartTarget,Gy,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Sp._dragging===this&&this.finishDrag(!0),cn(this._dragStartTarget,Gy,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(h){if(this._enabled&&(this._moved=!1,!Se(this._element,"leaflet-zoom-anim"))){if(h.touches&&h.touches.length!==1){Sp._dragging===this&&this.finishDrag();return}if(!(Sp._dragging||h.shiftKey||h.which!==1&&h.button!==1&&!h.touches)&&(Sp._dragging=this,this._preventOutline&&IS(this._element),tw(),Fy(),!this._moving)){this.fire("down");var _=h.touches?h.touches[0]:h,w=xO(this._element);this._startPoint=new V(_.clientX,_.clientY),this._startPos=hm(this._element),this._parentScale=LS(w);var E=h.type==="mousedown";ci(document,E?"mousemove":"touchmove",this._onMove,this),ci(document,E?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(h){if(this._enabled){if(h.touches&&h.touches.length>1){this._moved=!0;return}var _=h.touches&&h.touches.length===1?h.touches[0]:h,w=new V(_.clientX,_.clientY)._subtract(this._startPoint);!w.x&&!w.y||Math.abs(w.x)+Math.abs(w.y)<this.options.clickTolerance||(w.x/=this._parentScale.x,w.y/=this._parentScale.y,yo(h),this._moved||(this.fire("dragstart"),this._moved=!0,be(document.body,"leaflet-dragging"),this._lastTarget=h.target||h.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),be(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(w),this._moving=!0,this._lastEvent=h,this._updatePosition())}},_updatePosition:function(){var h={originalEvent:this._lastEvent};this.fire("predrag",h),Mn(this._element,this._newPos),this.fire("drag",h)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(h){yt(document.body,"leaflet-dragging"),this._lastTarget&&(yt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),cn(document,"mousemove touchmove",this._onMove,this),cn(document,"mouseup touchend touchcancel",this._onUp,this),MS(),ky();var _=this._moved&&this._moving;this._moving=!1,Sp._dragging=!1,_&&this.fire("dragend",{noInertia:h,distance:this._newPos.distanceTo(this._startPos)})}});function VS(h,_,w){var E,D=[1,4,2,8],G,se,_e,we,Be,St,ui,rr;for(G=0,St=h.length;G<St;G++)h[G]._code=Cp(h[G],_);for(_e=0;_e<4;_e++){for(ui=D[_e],E=[],G=0,St=h.length,se=St-1;G<St;se=G++)we=h[G],Be=h[se],we._code&ui?Be._code&ui||(rr=aw(Be,we,ui,_,w),rr._code=Cp(rr,_),E.push(rr)):(Be._code&ui&&(rr=aw(Be,we,ui,_,w),rr._code=Cp(rr,_),E.push(rr)),E.push(we));h=E}return h}function GS(h,_){var w,E,D,G,se,_e,we,Be,St;if(!h||h.length===0)throw new Error("latlngs not passed");Vl(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var ui=Ve([0,0]),rr=ve(h),cl=rr.getNorthWest().distanceTo(rr.getSouthWest())*rr.getNorthEast().distanceTo(rr.getNorthWest());cl<1700&&(ui=sw(h));var zo=h.length,Fu=[];for(w=0;w<zo;w++){var Gl=Ve(h[w]);Fu.push(_.project(Ve([Gl.lat-ui.lat,Gl.lng-ui.lng])))}for(_e=we=Be=0,w=0,E=zo-1;w<zo;E=w++)D=Fu[w],G=Fu[E],se=D.y*G.x-G.y*D.x,we+=(D.x+G.x)*se,Be+=(D.y+G.y)*se,_e+=se*3;_e===0?St=Fu[0]:St=[we/_e,Be/_e];var ww=_.unproject(Y(St));return Ve([ww.lat+ui.lat,ww.lng+ui.lng])}function sw(h){for(var _=0,w=0,E=0,D=0;D<h.length;D++){var G=Ve(h[D]);_+=G.lat,w+=G.lng,E++}return Ve([_/E,w/E])}var OO={__proto__:null,clipPolygon:VS,polygonCenter:GS,centroid:sw};function jS(h,_){if(!_||!h.length)return h.slice();var w=_*_;return h=t0(h,w),h=MO(h,w),h}function HS(h,_,w){return Math.sqrt(i0(h,_,w,!0))}function RO(h,_,w){return i0(h,_,w)}function MO(h,_){var w=h.length,E=typeof Uint8Array!=void 0+""?Uint8Array:Array,D=new E(w);D[0]=D[w-1]=1,ow(h,D,_,0,w-1);var G,se=[];for(G=0;G<w;G++)D[G]&&se.push(h[G]);return se}function ow(h,_,w,E,D){var G=0,se,_e,we;for(_e=E+1;_e<=D-1;_e++)we=i0(h[_e],h[E],h[D],!0),we>G&&(se=_e,G=we);G>w&&(_[se]=1,ow(h,_,w,E,se),ow(h,_,w,se,D))}function t0(h,_){for(var w=[h[0]],E=1,D=0,G=h.length;E<G;E++)LO(h[E],h[D])>_&&(w.push(h[E]),D=E);return D<G-1&&w.push(h[G-1]),w}var $O;function IO(h,_,w,E,D){var G=E?$O:Cp(h,w),se=Cp(_,w),_e,we,Be;for($O=se;;){if(!(G|se))return[h,_];if(G&se)return!1;_e=G||se,we=aw(h,_,_e,w,D),Be=Cp(we,w),_e===G?(h=we,G=Be):(_=we,se=Be)}}function aw(h,_,w,E,D){var G=_.x-h.x,se=_.y-h.y,_e=E.min,we=E.max,Be,St;return w&8?(Be=h.x+G*(we.y-h.y)/se,St=we.y):w&4?(Be=h.x+G*(_e.y-h.y)/se,St=_e.y):w&2?(Be=we.x,St=h.y+se*(we.x-h.x)/G):w&1&&(Be=_e.x,St=h.y+se*(_e.x-h.x)/G),new V(Be,St,D)}function Cp(h,_){var w=0;return h.x<_.min.x?w|=1:h.x>_.max.x&&(w|=2),h.y<_.min.y?w|=4:h.y>_.max.y&&(w|=8),w}function LO(h,_){var w=_.x-h.x,E=_.y-h.y;return w*w+E*E}function i0(h,_,w,E){var D=_.x,G=_.y,se=w.x-D,_e=w.y-G,we=se*se+_e*_e,Be;return we>0&&(Be=((h.x-D)*se+(h.y-G)*_e)/we,Be>1?(D=w.x,G=w.y):Be>0&&(D+=se*Be,G+=_e*Be)),se=h.x-D,_e=h.y-G,E?se*se+_e*_e:new V(D,G)}function Vl(h){return!C(h[0])||typeof h[0][0]!="object"&&typeof h[0][0]<"u"}function DO(h){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Vl(h)}function NO(h,_){var w,E,D,G,se,_e,we,Be;if(!h||h.length===0)throw new Error("latlngs not passed");Vl(h)||(console.warn("latlngs are not flat! Only the first ring will be used"),h=h[0]);var St=Ve([0,0]),ui=ve(h),rr=ui.getNorthWest().distanceTo(ui.getSouthWest())*ui.getNorthEast().distanceTo(ui.getNorthWest());rr<1700&&(St=sw(h));var cl=h.length,zo=[];for(w=0;w<cl;w++){var Fu=Ve(h[w]);zo.push(_.project(Ve([Fu.lat-St.lat,Fu.lng-St.lng])))}for(w=0,E=0;w<cl-1;w++)E+=zo[w].distanceTo(zo[w+1])/2;if(E===0)Be=zo[0];else for(w=0,G=0;w<cl-1;w++)if(se=zo[w],_e=zo[w+1],D=se.distanceTo(_e),G+=D,G>E){we=(G-E)/D,Be=[_e.x-we*(_e.x-se.x),_e.y-we*(_e.y-se.y)];break}var Gl=_.unproject(Y(Be));return Ve([Gl.lat+St.lat,Gl.lng+St.lng])}var pF={__proto__:null,simplify:jS,pointToSegmentDistance:HS,closestPointOnSegment:RO,clipSegment:IO,_getEdgeIntersection:aw,_getBitCode:Cp,_sqClosestPointOnSegment:i0,isFlat:Vl,_flat:DO,polylineCenter:NO},lw={project:function(h){return new V(h.lng,h.lat)},unproject:function(h){return new Ie(h.y,h.x)},bounds:new ie([-180,-90],[180,90])},WS={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ie([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(h){var _=Math.PI/180,w=this.R,E=h.lat*_,D=this.R_MINOR/w,G=Math.sqrt(1-D*D),se=G*Math.sin(E),_e=Math.tan(Math.PI/4-E/2)/Math.pow((1-se)/(1+se),G/2);return E=-w*Math.log(Math.max(_e,1e-10)),new V(h.lng*_*w,E)},unproject:function(h){for(var _=180/Math.PI,w=this.R,E=this.R_MINOR/w,D=Math.sqrt(1-E*E),G=Math.exp(-h.y/w),se=Math.PI/2-2*Math.atan(G),_e=0,we=.1,Be;_e<15&&Math.abs(we)>1e-7;_e++)Be=D*Math.sin(se),Be=Math.pow((1-Be)/(1+Be),D/2),we=Math.PI/2-2*Math.atan(G*Be)-se,se+=we;return new Ie(se*_,h.x*_/w)}},FO={__proto__:null,LonLat:lw,Mercator:WS,SphericalMercator:qe},fF=n({},ot,{code:"EPSG:3395",projection:WS,transformation:function(){var h=.5/(Math.PI*WS.R);return at(h,.5,-h,.5)}()}),qS=n({},ot,{code:"EPSG:4326",projection:lw,transformation:at(1/180,1,-1/180,.5)}),ZS=n({},Mt,{projection:lw,transformation:at(1,0,-1,0),scale:function(h){return Math.pow(2,h)},zoom:function(h){return Math.log(h)/Math.LN2},distance:function(h,_){var w=_.lng-h.lng,E=_.lat-h.lat;return Math.sqrt(w*w+E*E)},infinite:!0});Mt.Earth=ot,Mt.EPSG3395=fF,Mt.EPSG3857=ht,Mt.EPSG900913=Ue,Mt.EPSG4326=qS,Mt.Simple=ZS;var Dc=U.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(h){return h.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(h){return h&&h.removeLayer(this),this},getPane:function(h){return this._map.getPane(h?this.options[h]||h:this.options.pane)},addInteractiveTarget:function(h){return this._map._targets[l(h)]=this,this},removeInteractiveTarget:function(h){return delete this._map._targets[l(h)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(h){var _=h.target;if(_.hasLayer(this)){if(this._map=_,this._zoomAnimated=_._zoomAnimated,this.getEvents){var w=this.getEvents();_.on(w,this),this.once("remove",function(){_.off(w,this)},this)}this.onAdd(_),this.fire("add"),_.fire("layeradd",{layer:this})}}});hr.include({addLayer:function(h){if(!h._layerAdd)throw new Error("The provided object is not a Layer.");var _=l(h);return this._layers[_]?this:(this._layers[_]=h,h._mapToAdd=this,h.beforeAdd&&h.beforeAdd(this),this.whenReady(h._layerAdd,h),this)},removeLayer:function(h){var _=l(h);return this._layers[_]?(this._loaded&&h.onRemove(this),delete this._layers[_],this._loaded&&(this.fire("layerremove",{layer:h}),h.fire("remove")),h._map=h._mapToAdd=null,this):this},hasLayer:function(h){return l(h)in this._layers},eachLayer:function(h,_){for(var w in this._layers)h.call(_,this._layers[w]);return this},_addLayers:function(h){h=h?C(h)?h:[h]:[];for(var _=0,w=h.length;_<w;_++)this.addLayer(h[_])},_addZoomLimit:function(h){(!isNaN(h.options.maxZoom)||!isNaN(h.options.minZoom))&&(this._zoomBoundLayers[l(h)]=h,this._updateZoomLevels())},_removeZoomLimit:function(h){var _=l(h);this._zoomBoundLayers[_]&&(delete this._zoomBoundLayers[_],this._updateZoomLevels())},_updateZoomLevels:function(){var h=1/0,_=-1/0,w=this._getZoomSpan();for(var E in this._zoomBoundLayers){var D=this._zoomBoundLayers[E].options;h=D.minZoom===void 0?h:Math.min(h,D.minZoom),_=D.maxZoom===void 0?_:Math.max(_,D.maxZoom)}this._layersMaxZoom=_===-1/0?void 0:_,this._layersMinZoom=h===1/0?void 0:h,w!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var r0=Dc.extend({initialize:function(h,_){b(this,_),this._layers={};var w,E;if(h)for(w=0,E=h.length;w<E;w++)this.addLayer(h[w])},addLayer:function(h){var _=this.getLayerId(h);return this._layers[_]=h,this._map&&this._map.addLayer(h),this},removeLayer:function(h){var _=h in this._layers?h:this.getLayerId(h);return this._map&&this._layers[_]&&this._map.removeLayer(this._layers[_]),delete this._layers[_],this},hasLayer:function(h){var _=typeof h=="number"?h:this.getLayerId(h);return _ in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(h){var _=Array.prototype.slice.call(arguments,1),w,E;for(w in this._layers)E=this._layers[w],E[h]&&E[h].apply(E,_);return this},onAdd:function(h){this.eachLayer(h.addLayer,h)},onRemove:function(h){this.eachLayer(h.removeLayer,h)},eachLayer:function(h,_){for(var w in this._layers)h.call(_,this._layers[w]);return this},getLayer:function(h){return this._layers[h]},getLayers:function(){var h=[];return this.eachLayer(h.push,h),h},setZIndex:function(h){return this.invoke("setZIndex",h)},getLayerId:function(h){return l(h)}}),mF=function(h,_){return new r0(h,_)},td=r0.extend({addLayer:function(h){return this.hasLayer(h)?this:(h.addEventParent(this),r0.prototype.addLayer.call(this,h),this.fire("layeradd",{layer:h}))},removeLayer:function(h){return this.hasLayer(h)?(h in this._layers&&(h=this._layers[h]),h.removeEventParent(this),r0.prototype.removeLayer.call(this,h),this.fire("layerremove",{layer:h})):this},setStyle:function(h){return this.invoke("setStyle",h)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var h=new ue;for(var _ in this._layers){var w=this._layers[_];h.extend(w.getBounds?w.getBounds():w.getLatLng())}return h}}),cw=function(h,_){return new td(h,_)},n0=re.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(h){b(this,h)},createIcon:function(h){return this._createIcon("icon",h)},createShadow:function(h){return this._createIcon("shadow",h)},_createIcon:function(h,_){var w=this._getIconUrl(h);if(!w){if(h==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var E=this._createImg(w,_&&_.tagName==="IMG"?_:null);return this._setIconStyles(E,h),(this.options.crossOrigin||this.options.crossOrigin==="")&&(E.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),E},_setIconStyles:function(h,_){var w=this.options,E=w[_+"Size"];typeof E=="number"&&(E=[E,E]);var D=Y(E),G=Y(_==="shadow"&&w.shadowAnchor||w.iconAnchor||D&&D.divideBy(2,!0));h.className="leaflet-marker-"+_+" "+(w.className||""),G&&(h.style.marginLeft=-G.x+"px",h.style.marginTop=-G.y+"px"),D&&(h.style.width=D.x+"px",h.style.height=D.y+"px")},_createImg:function(h,_){return _=_||document.createElement("img"),_.src=h,_},_getIconUrl:function(h){return Tt.retina&&this.options[h+"RetinaUrl"]||this.options[h+"Url"]}});function gF(h){return new n0(h)}var jy=n0.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(h){return typeof jy.imagePath!="string"&&(jy.imagePath=this._detectIconPath()),(this.options.imagePath||jy.imagePath)+n0.prototype._getIconUrl.call(this,h)},_stripUrl:function(h){var _=function(w,E,D){var G=E.exec(w);return G&&G[D]};return h=_(h,/^url\((['"])?(.+)\1\)$/,2),h&&_(h,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var h=Zi("div","leaflet-default-icon-path",document.body),_=$a(h,"background-image")||$a(h,"backgroundImage");if(document.body.removeChild(h),_=this._stripUrl(_),_)return _;var w=document.querySelector('link[href$="leaflet.css"]');return w?w.href.substring(0,w.href.length-11-1):""}}),kO=Lc.extend({initialize:function(h){this._marker=h},addHooks:function(){var h=this._marker._icon;this._draggable||(this._draggable=new Sp(h,h,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),be(h,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&yt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(h){var _=this._marker,w=_._map,E=this._marker.options.autoPanSpeed,D=this._marker.options.autoPanPadding,G=hm(_._icon),se=w.getPixelBounds(),_e=w.getPixelOrigin(),we=le(se.min._subtract(_e).add(D),se.max._subtract(_e).subtract(D));if(!we.contains(G)){var Be=Y((Math.max(we.max.x,G.x)-we.max.x)/(se.max.x-we.max.x)-(Math.min(we.min.x,G.x)-we.min.x)/(se.min.x-we.min.x),(Math.max(we.max.y,G.y)-we.max.y)/(se.max.y-we.max.y)-(Math.min(we.min.y,G.y)-we.min.y)/(se.min.y-we.min.y)).multiplyBy(E);w.panBy(Be,{animate:!1}),this._draggable._newPos._add(Be),this._draggable._startPos._add(Be),Mn(_._icon,this._draggable._newPos),this._onDrag(h),this._panRequest=K(this._adjustPan.bind(this,h))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(h){this._marker.options.autoPan&&(X(this._panRequest),this._panRequest=K(this._adjustPan.bind(this,h)))},_onDrag:function(h){var _=this._marker,w=_._shadow,E=hm(_._icon),D=_._map.layerPointToLatLng(E);w&&Mn(w,E),_._latlng=D,h.latlng=D,h.oldLatLng=this._oldLatLng,_.fire("move",h).fire("drag",h)},_onDragEnd:function(h){X(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",h)}}),Hy=Dc.extend({options:{icon:new jy,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(h,_){b(this,_),this._latlng=Ve(h)},onAdd:function(h){this._zoomAnimated=this._zoomAnimated&&h.options.markerZoomAnimation,this._zoomAnimated&&h.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(h){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&h.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(h){var _=this._latlng;return this._latlng=Ve(h),this.update(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},setZIndexOffset:function(h){return this.options.zIndexOffset=h,this.update()},getIcon:function(){return this.options.icon},setIcon:function(h){return this.options.icon=h,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var h=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(h)}return this},_initIcon:function(){var h=this.options,_="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),w=h.icon.createIcon(this._icon),E=!1;w!==this._icon&&(this._icon&&this._removeIcon(),E=!0,h.title&&(w.title=h.title),w.tagName==="IMG"&&(w.alt=h.alt||"")),be(w,_),h.keyboard&&(w.tabIndex="0",w.setAttribute("role","button")),this._icon=w,h.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ci(w,"focus",this._panOnFocus,this);var D=h.icon.createShadow(this._shadow),G=!1;D!==this._shadow&&(this._removeShadow(),G=!0),D&&(be(D,_),D.alt=""),this._shadow=D,h.opacity<1&&this._updateOpacity(),E&&this.getPane().appendChild(this._icon),this._initInteraction(),D&&G&&this.getPane(h.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&cn(this._icon,"focus",this._panOnFocus,this),Ui(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Ui(this._shadow),this._shadow=null},_setPos:function(h){this._icon&&Mn(this._icon,h),this._shadow&&Mn(this._shadow,h),this._zIndex=h.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(h){this._icon&&(this._icon.style.zIndex=this._zIndex+h)},_animateZoom:function(h){var _=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center).round();this._setPos(_)},_initInteraction:function(){if(this.options.interactive&&(be(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),kO)){var h=this.options.draggable;this.dragging&&(h=this.dragging.enabled(),this.dragging.disable()),this.dragging=new kO(this),h&&this.dragging.enable()}},setOpacity:function(h){return this.options.opacity=h,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var h=this.options.opacity;this._icon&&Mr(this._icon,h),this._shadow&&Mr(this._shadow,h)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var h=this._map;if(h){var _=this.options.icon.options,w=_.iconSize?Y(_.iconSize):Y(0,0),E=_.iconAnchor?Y(_.iconAnchor):Y(0,0);h.panInside(this._latlng,{paddingTopLeft:E,paddingBottomRight:w.subtract(E)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function _F(h,_){return new Hy(h,_)}var Ep=Dc.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(h){this._renderer=h.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(h){return b(this,h),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&h&&Object.prototype.hasOwnProperty.call(h,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),uw=Ep.extend({options:{fill:!0,radius:10},initialize:function(h,_){b(this,_),this._latlng=Ve(h),this._radius=this.options.radius},setLatLng:function(h){var _=this._latlng;return this._latlng=Ve(h),this.redraw(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(h){return this.options.radius=this._radius=h,this.redraw()},getRadius:function(){return this._radius},setStyle:function(h){var _=h&&h.radius||this._radius;return Ep.prototype.setStyle.call(this,h),this.setRadius(_),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var h=this._radius,_=this._radiusY||h,w=this._clickTolerance(),E=[h+w,_+w];this._pxBounds=new ie(this._point.subtract(E),this._point.add(E))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(h){return h.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function yF(h,_){return new uw(h,_)}var hw=uw.extend({initialize:function(h,_,w){if(typeof _=="number"&&(_=n({},w,{radius:_})),b(this,_),this._latlng=Ve(h),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(h){return this._mRadius=h,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var h=[this._radius,this._radiusY||this._radius];return new ue(this._map.layerPointToLatLng(this._point.subtract(h)),this._map.layerPointToLatLng(this._point.add(h)))},setStyle:Ep.prototype.setStyle,_project:function(){var h=this._latlng.lng,_=this._latlng.lat,w=this._map,E=w.options.crs;if(E.distance===ot.distance){var D=Math.PI/180,G=this._mRadius/ot.R/D,se=w.project([_+G,h]),_e=w.project([_-G,h]),we=se.add(_e).divideBy(2),Be=w.unproject(we).lat,St=Math.acos((Math.cos(G*D)-Math.sin(_*D)*Math.sin(Be*D))/(Math.cos(_*D)*Math.cos(Be*D)))/D;(isNaN(St)||St===0)&&(St=G/Math.cos(Math.PI/180*_)),this._point=we.subtract(w.getPixelOrigin()),this._radius=isNaN(St)?0:we.x-w.project([Be,h-St]).x,this._radiusY=we.y-se.y}else{var ui=E.unproject(E.project(this._latlng).subtract([this._mRadius,0]));this._point=w.latLngToLayerPoint(this._latlng),this._radius=this._point.x-w.latLngToLayerPoint(ui).x}this._updateBounds()}});function UO(h,_,w){return new hw(h,_,w)}var id=Ep.extend({options:{smoothFactor:1,noClip:!1},initialize:function(h,_){b(this,_),this._setLatLngs(h)},getLatLngs:function(){return this._latlngs},setLatLngs:function(h){return this._setLatLngs(h),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(h){for(var _=1/0,w=null,E=i0,D,G,se=0,_e=this._parts.length;se<_e;se++)for(var we=this._parts[se],Be=1,St=we.length;Be<St;Be++){D=we[Be-1],G=we[Be];var ui=E(h,D,G,!0);ui<_&&(_=ui,w=E(h,D,G))}return w&&(w.distance=Math.sqrt(_)),w},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return NO(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(h,_){return _=_||this._defaultShape(),h=Ve(h),_.push(h),this._bounds.extend(h),this.redraw()},_setLatLngs:function(h){this._bounds=new ue,this._latlngs=this._convertLatLngs(h)},_defaultShape:function(){return Vl(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(h){for(var _=[],w=Vl(h),E=0,D=h.length;E<D;E++)w?(_[E]=Ve(h[E]),this._bounds.extend(_[E])):_[E]=this._convertLatLngs(h[E]);return _},_project:function(){var h=new ie;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,h),this._bounds.isValid()&&h.isValid()&&(this._rawPxBounds=h,this._updateBounds())},_updateBounds:function(){var h=this._clickTolerance(),_=new V(h,h);this._rawPxBounds&&(this._pxBounds=new ie([this._rawPxBounds.min.subtract(_),this._rawPxBounds.max.add(_)]))},_projectLatlngs:function(h,_,w){var E=h[0]instanceof Ie,D=h.length,G,se;if(E){for(se=[],G=0;G<D;G++)se[G]=this._map.latLngToLayerPoint(h[G]),w.extend(se[G]);_.push(se)}else for(G=0;G<D;G++)this._projectLatlngs(h[G],_,w)},_clipPoints:function(){var h=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}var _=this._parts,w,E,D,G,se,_e,we;for(w=0,D=0,G=this._rings.length;w<G;w++)for(we=this._rings[w],E=0,se=we.length;E<se-1;E++)_e=IO(we[E],we[E+1],h,E,!0),_e&&(_[D]=_[D]||[],_[D].push(_e[0]),(_e[1]!==we[E+1]||E===se-2)&&(_[D].push(_e[1]),D++))}},_simplifyPoints:function(){for(var h=this._parts,_=this.options.smoothFactor,w=0,E=h.length;w<E;w++)h[w]=jS(h[w],_)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(h,_){var w,E,D,G,se,_e,we=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(w=0,G=this._parts.length;w<G;w++)for(_e=this._parts[w],E=0,se=_e.length,D=se-1;E<se;D=E++)if(!(!_&&E===0)&&HS(h,_e[D],_e[E])<=we)return!0;return!1}});function vF(h,_){return new id(h,_)}id._flat=DO;var s0=id.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return GS(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(h){var _=id.prototype._convertLatLngs.call(this,h),w=_.length;return w>=2&&_[0]instanceof Ie&&_[0].equals(_[w-1])&&_.pop(),_},_setLatLngs:function(h){id.prototype._setLatLngs.call(this,h),Vl(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Vl(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var h=this._renderer._bounds,_=this.options.weight,w=new V(_,_);if(h=new ie(h.min.subtract(w),h.max.add(w)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(h))){if(this.options.noClip){this._parts=this._rings;return}for(var E=0,D=this._rings.length,G;E<D;E++)G=VS(this._rings[E],h,!0),G.length&&this._parts.push(G)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(h){var _=!1,w,E,D,G,se,_e,we,Be;if(!this._pxBounds||!this._pxBounds.contains(h))return!1;for(G=0,we=this._parts.length;G<we;G++)for(w=this._parts[G],se=0,Be=w.length,_e=Be-1;se<Be;_e=se++)E=w[se],D=w[_e],E.y>h.y!=D.y>h.y&&h.x<(D.x-E.x)*(h.y-E.y)/(D.y-E.y)+E.x&&(_=!_);return _||id.prototype._containsPoint.call(this,h,!0)}});function zO(h,_){return new s0(h,_)}var Nc=td.extend({initialize:function(h,_){b(this,_),this._layers={},h&&this.addData(h)},addData:function(h){var _=C(h)?h:h.features,w,E,D;if(_){for(w=0,E=_.length;w<E;w++)D=_[w],(D.geometries||D.geometry||D.features||D.coordinates)&&this.addData(D);return this}var G=this.options;if(G.filter&&!G.filter(h))return this;var se=dw(h,G);return se?(se.feature=gw(h),se.defaultOptions=se.options,this.resetStyle(se),G.onEachFeature&&G.onEachFeature(h,se),this.addLayer(se)):this},resetStyle:function(h){return h===void 0?this.eachLayer(this.resetStyle,this):(h.options=n({},h.defaultOptions),this._setLayerStyle(h,this.options.style),this)},setStyle:function(h){return this.eachLayer(function(_){this._setLayerStyle(_,h)},this)},_setLayerStyle:function(h,_){h.setStyle&&(typeof _=="function"&&(_=_(h.feature)),h.setStyle(_))}});function dw(h,_){var w=h.type==="Feature"?h.geometry:h,E=w?w.coordinates:null,D=[],G=_&&_.pointToLayer,se=_&&_.coordsToLatLng||XS,_e,we,Be,St;if(!E&&!w)return null;switch(w.type){case"Point":return _e=se(E),BO(G,h,_e,_);case"MultiPoint":for(Be=0,St=E.length;Be<St;Be++)_e=se(E[Be]),D.push(BO(G,h,_e,_));return new td(D);case"LineString":case"MultiLineString":return we=pw(E,w.type==="LineString"?0:1,se),new id(we,_);case"Polygon":case"MultiPolygon":return we=pw(E,w.type==="Polygon"?1:2,se),new s0(we,_);case"GeometryCollection":for(Be=0,St=w.geometries.length;Be<St;Be++){var ui=dw({geometry:w.geometries[Be],type:"Feature",properties:h.properties},_);ui&&D.push(ui)}return new td(D);case"FeatureCollection":for(Be=0,St=w.features.length;Be<St;Be++){var rr=dw(w.features[Be],_);rr&&D.push(rr)}return new td(D);default:throw new Error("Invalid GeoJSON object.")}}function BO(h,_,w,E){return h?h(_,w):new Hy(w,E&&E.markersInheritOptions&&E)}function XS(h){return new Ie(h[1],h[0],h[2])}function pw(h,_,w){for(var E=[],D=0,G=h.length,se;D<G;D++)se=_?pw(h[D],_-1,w):(w||XS)(h[D]),E.push(se);return E}function fw(h,_){return h=Ve(h),h.alt!==void 0?[f(h.lng,_),f(h.lat,_),f(h.alt,_)]:[f(h.lng,_),f(h.lat,_)]}function mw(h,_,w,E){for(var D=[],G=0,se=h.length;G<se;G++)D.push(_?mw(h[G],Vl(h[G])?0:_-1,w,E):fw(h[G],E));return!_&&w&&D.length>0&&D.push(D[0].slice()),D}function o0(h,_){return h.feature?n({},h.feature,{geometry:_}):gw(_)}function gw(h){return h.type==="Feature"||h.type==="FeatureCollection"?h:{type:"Feature",properties:{},geometry:h}}var YS={toGeoJSON:function(h){return o0(this,{type:"Point",coordinates:fw(this.getLatLng(),h)})}};Hy.include(YS),hw.include(YS),uw.include(YS),id.include({toGeoJSON:function(h){var _=!Vl(this._latlngs),w=mw(this._latlngs,_?1:0,!1,h);return o0(this,{type:(_?"Multi":"")+"LineString",coordinates:w})}}),s0.include({toGeoJSON:function(h){var _=!Vl(this._latlngs),w=_&&!Vl(this._latlngs[0]),E=mw(this._latlngs,w?2:_?1:0,!0,h);return _||(E=[E]),o0(this,{type:(w?"Multi":"")+"Polygon",coordinates:E})}}),r0.include({toMultiPoint:function(h){var _=[];return this.eachLayer(function(w){_.push(w.toGeoJSON(h).geometry.coordinates)}),o0(this,{type:"MultiPoint",coordinates:_})},toGeoJSON:function(h){var _=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(_==="MultiPoint")return this.toMultiPoint(h);var w=_==="GeometryCollection",E=[];return this.eachLayer(function(D){if(D.toGeoJSON){var G=D.toGeoJSON(h);if(w)E.push(G.geometry);else{var se=gw(G);se.type==="FeatureCollection"?E.push.apply(E,se.features):E.push(se)}}}),w?o0(this,{geometries:E,type:"GeometryCollection"}):{type:"FeatureCollection",features:E}}});function VO(h,_){return new Nc(h,_)}var bF=VO,_w=Dc.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(h,_,w){this._url=h,this._bounds=ve(_),b(this,w)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(be(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Ui(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(h){return this.options.opacity=h,this._image&&this._updateOpacity(),this},setStyle:function(h){return h.opacity&&this.setOpacity(h.opacity),this},bringToFront:function(){return this._map&&Bl(this._image),this},bringToBack:function(){return this._map&&Q(this._image),this},setUrl:function(h){return this._url=h,this._image&&(this._image.src=h),this},setBounds:function(h){return this._bounds=ve(h),this._map&&this._reset(),this},getEvents:function(){var h={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var h=this._url.tagName==="IMG",_=this._image=h?this._url:Zi("img");if(be(_,"leaflet-image-layer"),this._zoomAnimated&&be(_,"leaflet-zoom-animated"),this.options.className&&be(_,this.options.className),_.onselectstart=p,_.onmousemove=p,_.onload=o(this.fire,this,"load"),_.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),h){this._url=_.src;return}_.src=this._url,_.alt=this.options.alt},_animateZoom:function(h){var _=this._map.getZoomScale(h.zoom),w=this._map._latLngBoundsToNewLayerBounds(this._bounds,h.zoom,h.center).min;Lu(this._image,w,_)},_reset:function(){var h=this._image,_=new ie(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),w=_.getSize();Mn(h,_.min),h.style.width=w.x+"px",h.style.height=w.y+"px"},_updateOpacity:function(){Mr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var h=this.options.errorOverlayUrl;h&&this._url!==h&&(this._url=h,this._image.src=h)},getCenter:function(){return this._bounds.getCenter()}}),wF=function(h,_,w){return new _w(h,_,w)},GO=_w.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var h=this._url.tagName==="VIDEO",_=this._image=h?this._url:Zi("video");if(be(_,"leaflet-image-layer"),this._zoomAnimated&&be(_,"leaflet-zoom-animated"),this.options.className&&be(_,this.options.className),_.onselectstart=p,_.onmousemove=p,_.onloadeddata=o(this.fire,this,"load"),h){for(var w=_.getElementsByTagName("source"),E=[],D=0;D<w.length;D++)E.push(w[D].src);this._url=w.length>0?E:[_.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(_.style,"objectFit")&&(_.style.objectFit="fill"),_.autoplay=!!this.options.autoplay,_.loop=!!this.options.loop,_.muted=!!this.options.muted,_.playsInline=!!this.options.playsInline;for(var G=0;G<this._url.length;G++){var se=Zi("source");se.src=this._url[G],_.appendChild(se)}}});function gm(h,_,w){return new GO(h,_,w)}var JS=_w.extend({_initImage:function(){var h=this._image=this._url;be(h,"leaflet-image-layer"),this._zoomAnimated&&be(h,"leaflet-zoom-animated"),this.options.className&&be(h,this.options.className),h.onselectstart=p,h.onmousemove=p}});function xF(h,_,w){return new JS(h,_,w)}var Fc=Dc.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(h,_){h&&(h instanceof Ie||C(h))?(this._latlng=Ve(h),b(this,_)):(b(this,h),this._source=_),this.options.content&&(this._content=this.options.content)},openOn:function(h){return h=arguments.length?h:this._source._map,h.hasLayer(this)||h.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(h){return this._map?this.close():(arguments.length?this._source=h:h=this._source,this._prepareOpen(),this.openOn(h._map)),this},onAdd:function(h){this._zoomAnimated=h._zoomAnimated,this._container||this._initLayout(),h._fadeAnimated&&Mr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),h._fadeAnimated&&Mr(this._container,1),this.bringToFront(),this.options.interactive&&(be(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(h){h._fadeAnimated?(Mr(this._container,0),this._removeTimeout=setTimeout(o(Ui,void 0,this._container),200)):Ui(this._container),this.options.interactive&&(yt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(h){return this._latlng=Ve(h),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(h){return this._content=h,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var h={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Bl(this._container),this},bringToBack:function(){return this._map&&Q(this._container),this},_prepareOpen:function(h){var _=this._source;if(!_._map)return!1;if(_ instanceof td){_=null;var w=this._source._layers;for(var E in w)if(w[E]._map){_=w[E];break}if(!_)return!1;this._source=_}if(!h)if(_.getCenter)h=_.getCenter();else if(_.getLatLng)h=_.getLatLng();else if(_.getBounds)h=_.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(h),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var h=this._contentNode,_=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof _=="string")h.innerHTML=_;else{for(;h.hasChildNodes();)h.removeChild(h.firstChild);h.appendChild(_)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var h=this._map.latLngToLayerPoint(this._latlng),_=Y(this.options.offset),w=this._getAnchor();this._zoomAnimated?Mn(this._container,h.add(w)):_=_.add(h).add(w);var E=this._containerBottom=-_.y,D=this._containerLeft=-Math.round(this._containerWidth/2)+_.x;this._container.style.bottom=E+"px",this._container.style.left=D+"px"}},_getAnchor:function(){return[0,0]}});hr.include({_initOverlay:function(h,_,w,E){var D=_;return D instanceof h||(D=new h(E).setContent(_)),w&&D.setLatLng(w),D}}),Dc.include({_initOverlay:function(h,_,w,E){var D=w;return D instanceof h?(b(D,E),D._source=this):(D=_&&!E?_:new h(E,this),D.setContent(w)),D}});var yw=Fc.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(h){return h=arguments.length?h:this._source._map,!h.hasLayer(this)&&h._popup&&h._popup.options.autoClose&&h.removeLayer(h._popup),h._popup=this,Fc.prototype.openOn.call(this,h)},onAdd:function(h){Fc.prototype.onAdd.call(this,h),h.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Ep||this._source.on("preclick",Tp))},onRemove:function(h){Fc.prototype.onRemove.call(this,h),h.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Ep||this._source.off("preclick",Tp))},getEvents:function(){var h=Fc.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(h.preclick=this.close),this.options.keepInView&&(h.moveend=this._adjustPan),h},_initLayout:function(){var h="leaflet-popup",_=this._container=Zi("div",h+" "+(this.options.className||"")+" leaflet-zoom-animated"),w=this._wrapper=Zi("div",h+"-content-wrapper",_);if(this._contentNode=Zi("div",h+"-content",w),zy(_),pm(this._contentNode),ci(_,"contextmenu",Tp),this._tipContainer=Zi("div",h+"-tip-container",_),this._tip=Zi("div",h+"-tip",this._tipContainer),this.options.closeButton){var E=this._closeButton=Zi("a",h+"-close-button",_);E.setAttribute("role","button"),E.setAttribute("aria-label","Close popup"),E.href="#close",E.innerHTML='<span aria-hidden="true">&#215;</span>',ci(E,"click",function(D){yo(D),this.close()},this)}},_updateLayout:function(){var h=this._contentNode,_=h.style;_.width="",_.whiteSpace="nowrap";var w=h.offsetWidth;w=Math.min(w,this.options.maxWidth),w=Math.max(w,this.options.minWidth),_.width=w+1+"px",_.whiteSpace="",_.height="";var E=h.offsetHeight,D=this.options.maxHeight,G="leaflet-popup-scrolled";D&&E>D?(_.height=D+"px",be(h,G)):yt(h,G),this._containerWidth=this._container.offsetWidth},_animateZoom:function(h){var _=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center),w=this._getAnchor();Mn(this._container,_.add(w))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var h=this._map,_=parseInt($a(this._container,"marginBottom"),10)||0,w=this._container.offsetHeight+_,E=this._containerWidth,D=new V(this._containerLeft,-w-this._containerBottom);D._add(hm(this._container));var G=h.layerPointToContainerPoint(D),se=Y(this.options.autoPanPadding),_e=Y(this.options.autoPanPaddingTopLeft||se),we=Y(this.options.autoPanPaddingBottomRight||se),Be=h.getSize(),St=0,ui=0;G.x+E+we.x>Be.x&&(St=G.x+E-Be.x+we.x),G.x-St-_e.x<0&&(St=G.x-_e.x),G.y+w+we.y>Be.y&&(ui=G.y+w-Be.y+we.y),G.y-ui-_e.y<0&&(ui=G.y-_e.y),(St||ui)&&(this.options.keepInView&&(this._autopanning=!0),h.fire("autopanstart").panBy([St,ui]))}},_getAnchor:function(){return Y(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),TF=function(h,_){return new yw(h,_)};hr.mergeOptions({closePopupOnClick:!0}),hr.include({openPopup:function(h,_,w){return this._initOverlay(yw,h,_,w).openOn(this),this},closePopup:function(h){return h=arguments.length?h:this._popup,h&&h.close(),this}}),Dc.include({bindPopup:function(h,_){return this._popup=this._initOverlay(yw,this._popup,h,_),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(h){return this._popup&&(this instanceof td||(this._popup._source=this),this._popup._prepareOpen(h||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(h){return this._popup&&this._popup.setContent(h),this},getPopup:function(){return this._popup},_openPopup:function(h){if(!(!this._popup||!this._map)){fm(h);var _=h.layer||h.target;if(this._popup._source===_&&!(_ instanceof Ep)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(h.latlng);return}this._popup._source=_,this.openPopup(h.latlng)}},_movePopup:function(h){this._popup.setLatLng(h.latlng)},_onKeyPress:function(h){h.originalEvent.keyCode===13&&this._openPopup(h)}});var vw=Fc.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(h){Fc.prototype.onAdd.call(this,h),this.setOpacity(this.options.opacity),h.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(h){Fc.prototype.onRemove.call(this,h),h.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var h=Fc.prototype.getEvents.call(this);return this.options.permanent||(h.preclick=this.close),h},_initLayout:function(){var h="leaflet-tooltip",_=h+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Zi("div",_),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(h){var _,w,E=this._map,D=this._container,G=E.latLngToContainerPoint(E.getCenter()),se=E.layerPointToContainerPoint(h),_e=this.options.direction,we=D.offsetWidth,Be=D.offsetHeight,St=Y(this.options.offset),ui=this._getAnchor();_e==="top"?(_=we/2,w=Be):_e==="bottom"?(_=we/2,w=0):_e==="center"?(_=we/2,w=Be/2):_e==="right"?(_=0,w=Be/2):_e==="left"?(_=we,w=Be/2):se.x<G.x?(_e="right",_=0,w=Be/2):(_e="left",_=we+(St.x+ui.x)*2,w=Be/2),h=h.subtract(Y(_,w,!0)).add(St).add(ui),yt(D,"leaflet-tooltip-right"),yt(D,"leaflet-tooltip-left"),yt(D,"leaflet-tooltip-top"),yt(D,"leaflet-tooltip-bottom"),be(D,"leaflet-tooltip-"+_e),Mn(D,h)},_updatePosition:function(){var h=this._map.latLngToLayerPoint(this._latlng);this._setPosition(h)},setOpacity:function(h){this.options.opacity=h,this._container&&Mr(this._container,h)},_animateZoom:function(h){var _=this._map._latLngToNewLayerPoint(this._latlng,h.zoom,h.center);this._setPosition(_)},_getAnchor:function(){return Y(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),jO=function(h,_){return new vw(h,_)};hr.include({openTooltip:function(h,_,w){return this._initOverlay(vw,h,_,w).openOn(this),this},closeTooltip:function(h){return h.close(),this}}),Dc.include({bindTooltip:function(h,_){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(vw,this._tooltip,h,_),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(h){if(!(!h&&this._tooltipHandlersAdded)){var _=h?"off":"on",w={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?w.add=this._openTooltip:(w.mouseover=this._openTooltip,w.mouseout=this.closeTooltip,w.click=this._openTooltip,this._map?this._addFocusListeners():w.add=this._addFocusListeners),this._tooltip.options.sticky&&(w.mousemove=this._moveTooltip),this[_](w),this._tooltipHandlersAdded=!h}},openTooltip:function(h){return this._tooltip&&(this instanceof td||(this._tooltip._source=this),this._tooltip._prepareOpen(h)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(h){return this._tooltip&&this._tooltip.setContent(h),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(h){var _=typeof h.getElement=="function"&&h.getElement();_&&(ci(_,"focus",function(){this._tooltip._source=h,this.openTooltip()},this),ci(_,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(h){var _=typeof h.getElement=="function"&&h.getElement();_&&_.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(h){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var _=this;this._map.once("moveend",function(){_._openOnceFlag=!1,_._openTooltip(h)});return}this._tooltip._source=h.layer||h.target,this.openTooltip(this._tooltip.options.sticky?h.latlng:void 0)}},_moveTooltip:function(h){var _=h.latlng,w,E;this._tooltip.options.sticky&&h.originalEvent&&(w=this._map.mouseEventToContainerPoint(h.originalEvent),E=this._map.containerPointToLayerPoint(w),_=this._map.layerPointToLatLng(E)),this._tooltip.setLatLng(_)}});var HO=n0.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(h){var _=h&&h.tagName==="DIV"?h:document.createElement("div"),w=this.options;if(w.html instanceof Element?($c(_),_.appendChild(w.html)):_.innerHTML=w.html!==!1?w.html:"",w.bgPos){var E=Y(w.bgPos);_.style.backgroundPosition=-E.x+"px "+-E.y+"px"}return this._setIconStyles(_,"icon"),_},createShadow:function(){return null}});function SF(h){return new HO(h)}n0.Default=jy;var Wy=Dc.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Tt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(h){b(this,h)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(h){h._addZoomLimit(this)},onRemove:function(h){this._removeAllTiles(),Ui(this._container),h._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Bl(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Q(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(h){return this.options.opacity=h,this._updateOpacity(),this},setZIndex:function(h){return this.options.zIndex=h,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var h=this._clampZoom(this._map.getZoom());h!==this._tileZoom&&(this._tileZoom=h,this._updateLevels()),this._update()}return this},getEvents:function(){var h={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),h.move=this._onMove),this._zoomAnimated&&(h.zoomanim=this._animateZoom),h},createTile:function(){return document.createElement("div")},getTileSize:function(){var h=this.options.tileSize;return h instanceof V?h:new V(h,h)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(h){for(var _=this.getPane().children,w=-h(-1/0,1/0),E=0,D=_.length,G;E<D;E++)G=_[E].style.zIndex,_[E]!==this._container&&G&&(w=h(w,+G));isFinite(w)&&(this.options.zIndex=w+h(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Tt.ielt9){Mr(this._container,this.options.opacity);var h=+new Date,_=!1,w=!1;for(var E in this._tiles){var D=this._tiles[E];if(!(!D.current||!D.loaded)){var G=Math.min(1,(h-D.loaded)/200);Mr(D.el,G),G<1?_=!0:(D.active?w=!0:this._onOpaqueTile(D),D.active=!0)}}w&&!this._noPrune&&this._pruneTiles(),_&&(X(this._fadeFrame),this._fadeFrame=K(this._updateOpacity,this))}},_onOpaqueTile:p,_initContainer:function(){this._container||(this._container=Zi("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var h=this._tileZoom,_=this.options.maxZoom;if(h!==void 0){for(var w in this._levels)w=Number(w),this._levels[w].el.children.length||w===h?(this._levels[w].el.style.zIndex=_-Math.abs(h-w),this._onUpdateLevel(w)):(Ui(this._levels[w].el),this._removeTilesAtZoom(w),this._onRemoveLevel(w),delete this._levels[w]);var E=this._levels[h],D=this._map;return E||(E=this._levels[h]={},E.el=Zi("div","leaflet-tile-container leaflet-zoom-animated",this._container),E.el.style.zIndex=_,E.origin=D.project(D.unproject(D.getPixelOrigin()),h).round(),E.zoom=h,this._setZoomTransform(E,D.getCenter(),D.getZoom()),p(E.el.offsetWidth),this._onCreateLevel(E)),this._level=E,E}},_onUpdateLevel:p,_onRemoveLevel:p,_onCreateLevel:p,_pruneTiles:function(){if(this._map){var h,_,w=this._map.getZoom();if(w>this.options.maxZoom||w<this.options.minZoom){this._removeAllTiles();return}for(h in this._tiles)_=this._tiles[h],_.retain=_.current;for(h in this._tiles)if(_=this._tiles[h],_.current&&!_.active){var E=_.coords;this._retainParent(E.x,E.y,E.z,E.z-5)||this._retainChildren(E.x,E.y,E.z,E.z+2)}for(h in this._tiles)this._tiles[h].retain||this._removeTile(h)}},_removeTilesAtZoom:function(h){for(var _ in this._tiles)this._tiles[_].coords.z===h&&this._removeTile(_)},_removeAllTiles:function(){for(var h in this._tiles)this._removeTile(h)},_invalidateAll:function(){for(var h in this._levels)Ui(this._levels[h].el),this._onRemoveLevel(Number(h)),delete this._levels[h];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(h,_,w,E){var D=Math.floor(h/2),G=Math.floor(_/2),se=w-1,_e=new V(+D,+G);_e.z=+se;var we=this._tileCoordsToKey(_e),Be=this._tiles[we];return Be&&Be.active?(Be.retain=!0,!0):(Be&&Be.loaded&&(Be.retain=!0),se>E?this._retainParent(D,G,se,E):!1)},_retainChildren:function(h,_,w,E){for(var D=2*h;D<2*h+2;D++)for(var G=2*_;G<2*_+2;G++){var se=new V(D,G);se.z=w+1;var _e=this._tileCoordsToKey(se),we=this._tiles[_e];if(we&&we.active){we.retain=!0;continue}else we&&we.loaded&&(we.retain=!0);w+1<E&&this._retainChildren(D,G,w+1,E)}},_resetView:function(h){var _=h&&(h.pinch||h.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),_,_)},_animateZoom:function(h){this._setView(h.center,h.zoom,!0,h.noUpdate)},_clampZoom:function(h){var _=this.options;return _.minNativeZoom!==void 0&&h<_.minNativeZoom?_.minNativeZoom:_.maxNativeZoom!==void 0&&_.maxNativeZoom<h?_.maxNativeZoom:h},_setView:function(h,_,w,E){var D=Math.round(_);this.options.maxZoom!==void 0&&D>this.options.maxZoom||this.options.minZoom!==void 0&&D<this.options.minZoom?D=void 0:D=this._clampZoom(D);var G=this.options.updateWhenZooming&&D!==this._tileZoom;(!E||G)&&(this._tileZoom=D,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),D!==void 0&&this._update(h),w||this._pruneTiles(),this._noPrune=!!w),this._setZoomTransforms(h,_)},_setZoomTransforms:function(h,_){for(var w in this._levels)this._setZoomTransform(this._levels[w],h,_)},_setZoomTransform:function(h,_,w){var E=this._map.getZoomScale(w,h.zoom),D=h.origin.multiplyBy(E).subtract(this._map._getNewPixelOrigin(_,w)).round();Tt.any3d?Lu(h.el,D,E):Mn(h.el,D)},_resetGrid:function(){var h=this._map,_=h.options.crs,w=this._tileSize=this.getTileSize(),E=this._tileZoom,D=this._map.getPixelWorldBounds(this._tileZoom);D&&(this._globalTileRange=this._pxBoundsToTileRange(D)),this._wrapX=_.wrapLng&&!this.options.noWrap&&[Math.floor(h.project([0,_.wrapLng[0]],E).x/w.x),Math.ceil(h.project([0,_.wrapLng[1]],E).x/w.y)],this._wrapY=_.wrapLat&&!this.options.noWrap&&[Math.floor(h.project([_.wrapLat[0],0],E).y/w.x),Math.ceil(h.project([_.wrapLat[1],0],E).y/w.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(h){var _=this._map,w=_._animatingZoom?Math.max(_._animateToZoom,_.getZoom()):_.getZoom(),E=_.getZoomScale(w,this._tileZoom),D=_.project(h,this._tileZoom).floor(),G=_.getSize().divideBy(E*2);return new ie(D.subtract(G),D.add(G))},_update:function(h){var _=this._map;if(_){var w=this._clampZoom(_.getZoom());if(h===void 0&&(h=_.getCenter()),this._tileZoom!==void 0){var E=this._getTiledPixelBounds(h),D=this._pxBoundsToTileRange(E),G=D.getCenter(),se=[],_e=this.options.keepBuffer,we=new ie(D.getBottomLeft().subtract([_e,-_e]),D.getTopRight().add([_e,-_e]));if(!(isFinite(D.min.x)&&isFinite(D.min.y)&&isFinite(D.max.x)&&isFinite(D.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Be in this._tiles){var St=this._tiles[Be].coords;(St.z!==this._tileZoom||!we.contains(new V(St.x,St.y)))&&(this._tiles[Be].current=!1)}if(Math.abs(w-this._tileZoom)>1){this._setView(h,w);return}for(var ui=D.min.y;ui<=D.max.y;ui++)for(var rr=D.min.x;rr<=D.max.x;rr++){var cl=new V(rr,ui);if(cl.z=this._tileZoom,!!this._isValidTile(cl)){var zo=this._tiles[this._tileCoordsToKey(cl)];zo?zo.current=!0:se.push(cl)}}if(se.sort(function(Gl,ww){return Gl.distanceTo(G)-ww.distanceTo(G)}),se.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Fu=document.createDocumentFragment();for(rr=0;rr<se.length;rr++)this._addTile(se[rr],Fu);this._level.el.appendChild(Fu)}}}},_isValidTile:function(h){var _=this._map.options.crs;if(!_.infinite){var w=this._globalTileRange;if(!_.wrapLng&&(h.x<w.min.x||h.x>w.max.x)||!_.wrapLat&&(h.y<w.min.y||h.y>w.max.y))return!1}if(!this.options.bounds)return!0;var E=this._tileCoordsToBounds(h);return ve(this.options.bounds).overlaps(E)},_keyToBounds:function(h){return this._tileCoordsToBounds(this._keyToTileCoords(h))},_tileCoordsToNwSe:function(h){var _=this._map,w=this.getTileSize(),E=h.scaleBy(w),D=E.add(w),G=_.unproject(E,h.z),se=_.unproject(D,h.z);return[G,se]},_tileCoordsToBounds:function(h){var _=this._tileCoordsToNwSe(h),w=new ue(_[0],_[1]);return this.options.noWrap||(w=this._map.wrapLatLngBounds(w)),w},_tileCoordsToKey:function(h){return h.x+":"+h.y+":"+h.z},_keyToTileCoords:function(h){var _=h.split(":"),w=new V(+_[0],+_[1]);return w.z=+_[2],w},_removeTile:function(h){var _=this._tiles[h];_&&(Ui(_.el),delete this._tiles[h],this.fire("tileunload",{tile:_.el,coords:this._keyToTileCoords(h)}))},_initTile:function(h){be(h,"leaflet-tile");var _=this.getTileSize();h.style.width=_.x+"px",h.style.height=_.y+"px",h.onselectstart=p,h.onmousemove=p,Tt.ielt9&&this.options.opacity<1&&Mr(h,this.options.opacity)},_addTile:function(h,_){var w=this._getTilePos(h),E=this._tileCoordsToKey(h),D=this.createTile(this._wrapCoords(h),o(this._tileReady,this,h));this._initTile(D),this.createTile.length<2&&K(o(this._tileReady,this,h,null,D)),Mn(D,w),this._tiles[E]={el:D,coords:h,current:!0},_.appendChild(D),this.fire("tileloadstart",{tile:D,coords:h})},_tileReady:function(h,_,w){_&&this.fire("tileerror",{error:_,tile:w,coords:h});var E=this._tileCoordsToKey(h);w=this._tiles[E],w&&(w.loaded=+new Date,this._map._fadeAnimated?(Mr(w.el,0),X(this._fadeFrame),this._fadeFrame=K(this._updateOpacity,this)):(w.active=!0,this._pruneTiles()),_||(be(w.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:w.el,coords:h})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Tt.ielt9||!this._map._fadeAnimated?K(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(h){return h.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(h){var _=new V(this._wrapX?u(h.x,this._wrapX):h.x,this._wrapY?u(h.y,this._wrapY):h.y);return _.z=h.z,_},_pxBoundsToTileRange:function(h){var _=this.getTileSize();return new ie(h.min.unscaleBy(_).floor(),h.max.unscaleBy(_).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var h in this._tiles)if(!this._tiles[h].loaded)return!1;return!0}});function kc(h){return new Wy(h)}var un=Wy.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(h,_){this._url=h,_=b(this,_),_.detectRetina&&Tt.retina&&_.maxZoom>0?(_.tileSize=Math.floor(_.tileSize/2),_.zoomReverse?(_.zoomOffset--,_.minZoom=Math.min(_.maxZoom,_.minZoom+1)):(_.zoomOffset++,_.maxZoom=Math.max(_.minZoom,_.maxZoom-1)),_.minZoom=Math.max(0,_.minZoom)):_.zoomReverse?_.minZoom=Math.min(_.maxZoom,_.minZoom):_.maxZoom=Math.max(_.minZoom,_.maxZoom),typeof _.subdomains=="string"&&(_.subdomains=_.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(h,_){return this._url===h&&_===void 0&&(_=!0),this._url=h,_||this.redraw(),this},createTile:function(h,_){var w=document.createElement("img");return ci(w,"load",o(this._tileOnLoad,this,_,w)),ci(w,"error",o(this._tileOnError,this,_,w)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(w.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(w.referrerPolicy=this.options.referrerPolicy),w.alt="",w.src=this.getTileUrl(h),w},getTileUrl:function(h){var _={r:Tt.retina?"@2x":"",s:this._getSubdomain(h),x:h.x,y:h.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var w=this._globalTileRange.max.y-h.y;this.options.tms&&(_.y=w),_["-y"]=w}return P(this._url,n(_,this.options))},_tileOnLoad:function(h,_){Tt.ielt9?setTimeout(o(h,this,null,_),0):h(null,_)},_tileOnError:function(h,_,w){var E=this.options.errorTileUrl;E&&_.getAttribute("src")!==E&&(_.src=E),h(w,_)},_onTileRemove:function(h){h.tile.onload=null},_getZoomForUrl:function(){var h=this._tileZoom,_=this.options.maxZoom,w=this.options.zoomReverse,E=this.options.zoomOffset;return w&&(h=_-h),h+E},_getSubdomain:function(h){var _=Math.abs(h.x+h.y)%this.options.subdomains.length;return this.options.subdomains[_]},_abortLoading:function(){var h,_;for(h in this._tiles)if(this._tiles[h].coords.z!==this._tileZoom&&(_=this._tiles[h].el,_.onload=p,_.onerror=p,!_.complete)){_.src=N;var w=this._tiles[h].coords;Ui(_),delete this._tiles[h],this.fire("tileabort",{tile:_,coords:w})}},_removeTile:function(h){var _=this._tiles[h];if(_)return _.el.setAttribute("src",N),Wy.prototype._removeTile.call(this,h)},_tileReady:function(h,_,w){if(!(!this._map||w&&w.getAttribute("src")===N))return Wy.prototype._tileReady.call(this,h,_,w)}});function WO(h,_){return new un(h,_)}var qO=un.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(h,_){this._url=h;var w=n({},this.defaultWmsParams);for(var E in _)E in this.options||(w[E]=_[E]);_=b(this,_);var D=_.detectRetina&&Tt.retina?2:1,G=this.getTileSize();w.width=G.x*D,w.height=G.y*D,this.wmsParams=w},onAdd:function(h){this._crs=this.options.crs||h.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var _=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[_]=this._crs.code,un.prototype.onAdd.call(this,h)},getTileUrl:function(h){var _=this._tileCoordsToNwSe(h),w=this._crs,E=le(w.project(_[0]),w.project(_[1])),D=E.min,G=E.max,se=(this._wmsVersion>=1.3&&this._crs===qS?[D.y,D.x,G.y,G.x]:[D.x,D.y,G.x,G.y]).join(","),_e=un.prototype.getTileUrl.call(this,h);return _e+x(this.wmsParams,_e,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+se},setParams:function(h,_){return n(this.wmsParams,h),_||this.redraw(),this}});function CF(h,_){return new qO(h,_)}un.WMS=qO,WO.wms=CF;var rd=Dc.extend({options:{padding:.1},initialize:function(h){b(this,h),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),be(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var h={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(h.zoomanim=this._onAnimZoom),h},_onAnimZoom:function(h){this._updateTransform(h.center,h.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(h,_){var w=this._map.getZoomScale(_,this._zoom),E=this._map.getSize().multiplyBy(.5+this.options.padding),D=this._map.project(this._center,_),G=E.multiplyBy(-w).add(D).subtract(this._map._getNewPixelOrigin(h,_));Tt.any3d?Lu(this._container,G,w):Mn(this._container,G)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var h in this._layers)this._layers[h]._reset()},_onZoomEnd:function(){for(var h in this._layers)this._layers[h]._project()},_updatePaths:function(){for(var h in this._layers)this._layers[h]._update()},_update:function(){var h=this.options.padding,_=this._map.getSize(),w=this._map.containerPointToLayerPoint(_.multiplyBy(-h)).round();this._bounds=new ie(w,w.add(_.multiplyBy(1+h*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),ZO=rd.extend({options:{tolerance:0},getEvents:function(){var h=rd.prototype.getEvents.call(this);return h.viewprereset=this._onViewPreReset,h},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){rd.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var h=this._container=document.createElement("canvas");ci(h,"mousemove",this._onMouseMove,this),ci(h,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ci(h,"mouseout",this._handleMouseOut,this),h._leaflet_disable_events=!0,this._ctx=h.getContext("2d")},_destroyContainer:function(){X(this._redrawRequest),delete this._ctx,Ui(this._container),cn(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var h;this._redrawBounds=null;for(var _ in this._layers)h=this._layers[_],h._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){rd.prototype._update.call(this);var h=this._bounds,_=this._container,w=h.getSize(),E=Tt.retina?2:1;Mn(_,h.min),_.width=E*w.x,_.height=E*w.y,_.style.width=w.x+"px",_.style.height=w.y+"px",Tt.retina&&this._ctx.scale(2,2),this._ctx.translate(-h.min.x,-h.min.y),this.fire("update")}},_reset:function(){rd.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(h){this._updateDashArray(h),this._layers[l(h)]=h;var _=h._order={layer:h,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=_),this._drawLast=_,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(h){this._requestRedraw(h)},_removePath:function(h){var _=h._order,w=_.next,E=_.prev;w?w.prev=E:this._drawLast=E,E?E.next=w:this._drawFirst=w,delete h._order,delete this._layers[l(h)],this._requestRedraw(h)},_updatePath:function(h){this._extendRedrawBounds(h),h._project(),h._update(),this._requestRedraw(h)},_updateStyle:function(h){this._updateDashArray(h),this._requestRedraw(h)},_updateDashArray:function(h){if(typeof h.options.dashArray=="string"){var _=h.options.dashArray.split(/[, ]+/),w=[],E,D;for(D=0;D<_.length;D++){if(E=Number(_[D]),isNaN(E))return;w.push(E)}h.options._dashArray=w}else h.options._dashArray=h.options.dashArray},_requestRedraw:function(h){this._map&&(this._extendRedrawBounds(h),this._redrawRequest=this._redrawRequest||K(this._redraw,this))},_extendRedrawBounds:function(h){if(h._pxBounds){var _=(h.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ie,this._redrawBounds.extend(h._pxBounds.min.subtract([_,_])),this._redrawBounds.extend(h._pxBounds.max.add([_,_]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var h=this._redrawBounds;if(h){var _=h.getSize();this._ctx.clearRect(h.min.x,h.min.y,_.x,_.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var h,_=this._redrawBounds;if(this._ctx.save(),_){var w=_.getSize();this._ctx.beginPath(),this._ctx.rect(_.min.x,_.min.y,w.x,w.y),this._ctx.clip()}this._drawing=!0;for(var E=this._drawFirst;E;E=E.next)h=E.layer,(!_||h._pxBounds&&h._pxBounds.intersects(_))&&h._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(h,_){if(this._drawing){var w,E,D,G,se=h._parts,_e=se.length,we=this._ctx;if(_e){for(we.beginPath(),w=0;w<_e;w++){for(E=0,D=se[w].length;E<D;E++)G=se[w][E],we[E?"lineTo":"moveTo"](G.x,G.y);_&&we.closePath()}this._fillStroke(we,h)}}},_updateCircle:function(h){if(!(!this._drawing||h._empty())){var _=h._point,w=this._ctx,E=Math.max(Math.round(h._radius),1),D=(Math.max(Math.round(h._radiusY),1)||E)/E;D!==1&&(w.save(),w.scale(1,D)),w.beginPath(),w.arc(_.x,_.y/D,E,0,Math.PI*2,!1),D!==1&&w.restore(),this._fillStroke(w,h)}},_fillStroke:function(h,_){var w=_.options;w.fill&&(h.globalAlpha=w.fillOpacity,h.fillStyle=w.fillColor||w.color,h.fill(w.fillRule||"evenodd")),w.stroke&&w.weight!==0&&(h.setLineDash&&h.setLineDash(_.options&&_.options._dashArray||[]),h.globalAlpha=w.opacity,h.lineWidth=w.weight,h.strokeStyle=w.color,h.lineCap=w.lineCap,h.lineJoin=w.lineJoin,h.stroke())},_onClick:function(h){for(var _=this._map.mouseEventToLayerPoint(h),w,E,D=this._drawFirst;D;D=D.next)w=D.layer,w.options.interactive&&w._containsPoint(_)&&(!(h.type==="click"||h.type==="preclick")||!this._map._draggableMoved(w))&&(E=w);this._fireEvent(E?[E]:!1,h)},_onMouseMove:function(h){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var _=this._map.mouseEventToLayerPoint(h);this._handleMouseHover(h,_)}},_handleMouseOut:function(h){var _=this._hoveredLayer;_&&(yt(this._container,"leaflet-interactive"),this._fireEvent([_],h,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(h,_){if(!this._mouseHoverThrottled){for(var w,E,D=this._drawFirst;D;D=D.next)w=D.layer,w.options.interactive&&w._containsPoint(_)&&(E=w);E!==this._hoveredLayer&&(this._handleMouseOut(h),E&&(be(this._container,"leaflet-interactive"),this._fireEvent([E],h,"mouseover"),this._hoveredLayer=E)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,h),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(h,_,w){this._map._fireDOMEvent(_,w||_.type,h)},_bringToFront:function(h){var _=h._order;if(_){var w=_.next,E=_.prev;if(w)w.prev=E;else return;E?E.next=w:w&&(this._drawFirst=w),_.prev=this._drawLast,this._drawLast.next=_,_.next=null,this._drawLast=_,this._requestRedraw(h)}},_bringToBack:function(h){var _=h._order;if(_){var w=_.next,E=_.prev;if(E)E.next=w;else return;w?w.prev=E:E&&(this._drawLast=E),_.prev=null,_.next=this._drawFirst,this._drawFirst.prev=_,this._drawFirst=_,this._requestRedraw(h)}}});function XO(h){return Tt.canvas?new ZO(h):null}var qy=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(h){return document.createElement("<lvml:"+h+' class="lvml">')}}catch{}return function(h){return document.createElement("<"+h+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),bw={_initContainer:function(){this._container=Zi("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(rd.prototype._update.call(this),this.fire("update"))},_initPath:function(h){var _=h._container=qy("shape");be(_,"leaflet-vml-shape "+(this.options.className||"")),_.coordsize="1 1",h._path=qy("path"),_.appendChild(h._path),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){var _=h._container;this._container.appendChild(_),h.options.interactive&&h.addInteractiveTarget(_)},_removePath:function(h){var _=h._container;Ui(_),h.removeInteractiveTarget(_),delete this._layers[l(h)]},_updateStyle:function(h){var _=h._stroke,w=h._fill,E=h.options,D=h._container;D.stroked=!!E.stroke,D.filled=!!E.fill,E.stroke?(_||(_=h._stroke=qy("stroke")),D.appendChild(_),_.weight=E.weight+"px",_.color=E.color,_.opacity=E.opacity,E.dashArray?_.dashStyle=C(E.dashArray)?E.dashArray.join(" "):E.dashArray.replace(/( *, *)/g," "):_.dashStyle="",_.endcap=E.lineCap.replace("butt","flat"),_.joinstyle=E.lineJoin):_&&(D.removeChild(_),h._stroke=null),E.fill?(w||(w=h._fill=qy("fill")),D.appendChild(w),w.color=E.fillColor||E.color,w.opacity=E.fillOpacity):w&&(D.removeChild(w),h._fill=null)},_updateCircle:function(h){var _=h._point.round(),w=Math.round(h._radius),E=Math.round(h._radiusY||w);this._setPath(h,h._empty()?"M0 0":"AL "+_.x+","+_.y+" "+w+","+E+" 0,"+65535*360)},_setPath:function(h,_){h._path.v=_},_bringToFront:function(h){Bl(h._container)},_bringToBack:function(h){Q(h._container)}},A=Tt.vml?qy:He,O=rd.extend({_initContainer:function(){this._container=A("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=A("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Ui(this._container),cn(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){rd.prototype._update.call(this);var h=this._bounds,_=h.getSize(),w=this._container;(!this._svgSize||!this._svgSize.equals(_))&&(this._svgSize=_,w.setAttribute("width",_.x),w.setAttribute("height",_.y)),Mn(w,h.min),w.setAttribute("viewBox",[h.min.x,h.min.y,_.x,_.y].join(" ")),this.fire("update")}},_initPath:function(h){var _=h._path=A("path");h.options.className&&be(_,h.options.className),h.options.interactive&&be(_,"leaflet-interactive"),this._updateStyle(h),this._layers[l(h)]=h},_addPath:function(h){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(h._path),h.addInteractiveTarget(h._path)},_removePath:function(h){Ui(h._path),h.removeInteractiveTarget(h._path),delete this._layers[l(h)]},_updatePath:function(h){h._project(),h._update()},_updateStyle:function(h){var _=h._path,w=h.options;_&&(w.stroke?(_.setAttribute("stroke",w.color),_.setAttribute("stroke-opacity",w.opacity),_.setAttribute("stroke-width",w.weight),_.setAttribute("stroke-linecap",w.lineCap),_.setAttribute("stroke-linejoin",w.lineJoin),w.dashArray?_.setAttribute("stroke-dasharray",w.dashArray):_.removeAttribute("stroke-dasharray"),w.dashOffset?_.setAttribute("stroke-dashoffset",w.dashOffset):_.removeAttribute("stroke-dashoffset")):_.setAttribute("stroke","none"),w.fill?(_.setAttribute("fill",w.fillColor||w.color),_.setAttribute("fill-opacity",w.fillOpacity),_.setAttribute("fill-rule",w.fillRule||"evenodd")):_.setAttribute("fill","none"))},_updatePoly:function(h,_){this._setPath(h,rt(h._parts,_))},_updateCircle:function(h){var _=h._point,w=Math.max(Math.round(h._radius),1),E=Math.max(Math.round(h._radiusY),1)||w,D="a"+w+","+E+" 0 1,0 ",G=h._empty()?"M0 0":"M"+(_.x-w)+","+_.y+D+w*2+",0 "+D+-w*2+",0 ";this._setPath(h,G)},_setPath:function(h,_){h._path.setAttribute("d",_)},_bringToFront:function(h){Bl(h._path)},_bringToBack:function(h){Q(h._path)}});Tt.vml&&O.include(bw);function F(h){return Tt.svg||Tt.vml?new O(h):null}hr.include({getRenderer:function(h){var _=h.options.renderer||this._getPaneRenderer(h.options.pane)||this.options.renderer||this._renderer;return _||(_=this._renderer=this._createRenderer()),this.hasLayer(_)||this.addLayer(_),_},_getPaneRenderer:function(h){if(h==="overlayPane"||h===void 0)return!1;var _=this._paneRenderers[h];return _===void 0&&(_=this._createRenderer({pane:h}),this._paneRenderers[h]=_),_},_createRenderer:function(h){return this.options.preferCanvas&&XO(h)||F(h)}});var te=s0.extend({initialize:function(h,_){s0.prototype.initialize.call(this,this._boundsToLatLngs(h),_)},setBounds:function(h){return this.setLatLngs(this._boundsToLatLngs(h))},_boundsToLatLngs:function(h){return h=ve(h),[h.getSouthWest(),h.getNorthWest(),h.getNorthEast(),h.getSouthEast()]}});function Ae(h,_){return new te(h,_)}O.create=A,O.pointsToPath=rt,Nc.geometryToLayer=dw,Nc.coordsToLatLng=XS,Nc.coordsToLatLngs=pw,Nc.latLngToCoords=fw,Nc.latLngsToCoords=mw,Nc.getFeature=o0,Nc.asFeature=gw,hr.mergeOptions({boxZoom:!0});var Yt=Lc.extend({initialize:function(h){this._map=h,this._container=h._container,this._pane=h._panes.overlayPane,this._resetStateTimeout=0,h.on("unload",this._destroy,this)},addHooks:function(){ci(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){cn(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Ui(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(h){if(!h.shiftKey||h.which!==1&&h.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Fy(),tw(),this._startPoint=this._map.mouseEventToContainerPoint(h),ci(document,{contextmenu:fm,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(h){this._moved||(this._moved=!0,this._box=Zi("div","leaflet-zoom-box",this._container),be(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(h);var _=new ie(this._point,this._startPoint),w=_.getSize();Mn(this._box,_.min),this._box.style.width=w.x+"px",this._box.style.height=w.y+"px"},_finish:function(){this._moved&&(Ui(this._box),yt(this._container,"leaflet-crosshair")),ky(),MS(),cn(document,{contextmenu:fm,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(h){if(!(h.which!==1&&h.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var _=new ue(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(_).fire("boxzoomend",{boxZoomBounds:_})}},_onKeyDown:function(h){h.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});hr.addInitHook("addHandler","boxZoom",Yt),hr.mergeOptions({doubleClickZoom:!0});var $r=Lc.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(h){var _=this._map,w=_.getZoom(),E=_.options.zoomDelta,D=h.originalEvent.shiftKey?w-E:w+E;_.options.doubleClickZoom==="center"?_.setZoom(D):_.setZoomAround(h.containerPoint,D)}});hr.addInitHook("addHandler","doubleClickZoom",$r),hr.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ys=Lc.extend({addHooks:function(){if(!this._draggable){var h=this._map;this._draggable=new Sp(h._mapPane,h._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),h.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),h.on("zoomend",this._onZoomEnd,this),h.whenReady(this._onZoomEnd,this))}be(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){yt(this._map._container,"leaflet-grab"),yt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var h=this._map;if(h._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var _=ve(this._map.options.maxBounds);this._offsetLimit=le(this._map.latLngToContainerPoint(_.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(_.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;h.fire("movestart").fire("dragstart"),h.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(h){if(this._map.options.inertia){var _=this._lastTime=+new Date,w=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(w),this._times.push(_),this._prunePositions(_)}this._map.fire("move",h).fire("drag",h)},_prunePositions:function(h){for(;this._positions.length>1&&h-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var h=this._map.getSize().divideBy(2),_=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=_.subtract(h).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(h,_){return h-(h-_)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var h=this._draggable._newPos.subtract(this._draggable._startPos),_=this._offsetLimit;h.x<_.min.x&&(h.x=this._viscousLimit(h.x,_.min.x)),h.y<_.min.y&&(h.y=this._viscousLimit(h.y,_.min.y)),h.x>_.max.x&&(h.x=this._viscousLimit(h.x,_.max.x)),h.y>_.max.y&&(h.y=this._viscousLimit(h.y,_.max.y)),this._draggable._newPos=this._draggable._startPos.add(h)}},_onPreDragWrap:function(){var h=this._worldWidth,_=Math.round(h/2),w=this._initialWorldOffset,E=this._draggable._newPos.x,D=(E-_+w)%h+_-w,G=(E+_+w)%h-_-w,se=Math.abs(D+w)<Math.abs(G+w)?D:G;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=se},_onDragEnd:function(h){var _=this._map,w=_.options,E=!w.inertia||h.noInertia||this._times.length<2;if(_.fire("dragend",h),E)_.fire("moveend");else{this._prunePositions(+new Date);var D=this._lastPos.subtract(this._positions[0]),G=(this._lastTime-this._times[0])/1e3,se=w.easeLinearity,_e=D.multiplyBy(se/G),we=_e.distanceTo([0,0]),Be=Math.min(w.inertiaMaxSpeed,we),St=_e.multiplyBy(Be/we),ui=Be/(w.inertiaDeceleration*se),rr=St.multiplyBy(-ui/2).round();!rr.x&&!rr.y?_.fire("moveend"):(rr=_._limitOffset(rr,_.options.maxBounds),K(function(){_.panBy(rr,{duration:ui,easeLinearity:se,noMoveStart:!0,animate:!0})}))}}});hr.addInitHook("addHandler","dragging",ys),hr.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Ys=Lc.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(h){this._map=h,this._setPanDelta(h.options.keyboardPanDelta),this._setZoomDelta(h.options.zoomDelta)},addHooks:function(){var h=this._map._container;h.tabIndex<=0&&(h.tabIndex="0"),ci(h,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),cn(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var h=document.body,_=document.documentElement,w=h.scrollTop||_.scrollTop,E=h.scrollLeft||_.scrollLeft;this._map._container.focus(),window.scrollTo(E,w)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(h){var _=this._panKeys={},w=this.keyCodes,E,D;for(E=0,D=w.left.length;E<D;E++)_[w.left[E]]=[-1*h,0];for(E=0,D=w.right.length;E<D;E++)_[w.right[E]]=[h,0];for(E=0,D=w.down.length;E<D;E++)_[w.down[E]]=[0,h];for(E=0,D=w.up.length;E<D;E++)_[w.up[E]]=[0,-1*h]},_setZoomDelta:function(h){var _=this._zoomKeys={},w=this.keyCodes,E,D;for(E=0,D=w.zoomIn.length;E<D;E++)_[w.zoomIn[E]]=h;for(E=0,D=w.zoomOut.length;E<D;E++)_[w.zoomOut[E]]=-h},_addHooks:function(){ci(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){cn(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(h){if(!(h.altKey||h.ctrlKey||h.metaKey)){var _=h.keyCode,w=this._map,E;if(_ in this._panKeys){if(!w._panAnim||!w._panAnim._inProgress)if(E=this._panKeys[_],h.shiftKey&&(E=Y(E).multiplyBy(3)),w.options.maxBounds&&(E=w._limitOffset(Y(E),w.options.maxBounds)),w.options.worldCopyJump){var D=w.wrapLatLng(w.unproject(w.project(w.getCenter()).add(E)));w.panTo(D)}else w.panBy(E)}else if(_ in this._zoomKeys)w.setZoom(w.getZoom()+(h.shiftKey?3:1)*this._zoomKeys[_]);else if(_===27&&w._popup&&w._popup.options.closeOnEscapeKey)w.closePopup();else return;fm(h)}}});hr.addInitHook("addHandler","keyboard",Ys),hr.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var _m=Lc.extend({addHooks:function(){ci(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){cn(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(h){var _=TO(h),w=this._map.options.wheelDebounceTime;this._delta+=_,this._lastMousePos=this._map.mouseEventToContainerPoint(h),this._startTime||(this._startTime=+new Date);var E=Math.max(w-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),E),fm(h)},_performZoom:function(){var h=this._map,_=h.getZoom(),w=this._map.options.zoomSnap||0;h._stop();var E=this._delta/(this._map.options.wheelPxPerZoomLevel*4),D=4*Math.log(2/(1+Math.exp(-Math.abs(E))))/Math.LN2,G=w?Math.ceil(D/w)*w:D,se=h._limitZoom(_+(this._delta>0?G:-G))-_;this._delta=0,this._startTime=null,se&&(h.options.scrollWheelZoom==="center"?h.setZoom(_+se):h.setZoomAround(this._lastMousePos,_+se))}});hr.addInitHook("addHandler","scrollWheelZoom",_m);var KS=600;hr.mergeOptions({tapHold:Tt.touchNative&&Tt.safari&&Tt.mobile,tapTolerance:15});var bZ=Lc.extend({addHooks:function(){ci(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){cn(this._map._container,"touchstart",this._onDown,this)},_onDown:function(h){if(clearTimeout(this._holdTimeout),h.touches.length===1){var _=h.touches[0];this._startPos=this._newPos=new V(_.clientX,_.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(ci(document,"touchend",yo),ci(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",_))},this),KS),ci(document,"touchend touchcancel contextmenu",this._cancel,this),ci(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function h(){cn(document,"touchend",yo),cn(document,"touchend touchcancel",h)},_cancel:function(){clearTimeout(this._holdTimeout),cn(document,"touchend touchcancel contextmenu",this._cancel,this),cn(document,"touchmove",this._onMove,this)},_onMove:function(h){var _=h.touches[0];this._newPos=new V(_.clientX,_.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(h,_){var w=new MouseEvent(h,{bubbles:!0,cancelable:!0,view:window,screenX:_.screenX,screenY:_.screenY,clientX:_.clientX,clientY:_.clientY});w._simulated=!0,_.target.dispatchEvent(w)}});hr.addInitHook("addHandler","tapHold",bZ),hr.mergeOptions({touchZoom:Tt.touch,bounceAtZoomLimits:!0});var wZ=Lc.extend({addHooks:function(){be(this._map._container,"leaflet-touch-zoom"),ci(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){yt(this._map._container,"leaflet-touch-zoom"),cn(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(h){var _=this._map;if(!(!h.touches||h.touches.length!==2||_._animatingZoom||this._zooming)){var w=_.mouseEventToContainerPoint(h.touches[0]),E=_.mouseEventToContainerPoint(h.touches[1]);this._centerPoint=_.getSize()._divideBy(2),this._startLatLng=_.containerPointToLatLng(this._centerPoint),_.options.touchZoom!=="center"&&(this._pinchStartLatLng=_.containerPointToLatLng(w.add(E)._divideBy(2))),this._startDist=w.distanceTo(E),this._startZoom=_.getZoom(),this._moved=!1,this._zooming=!0,_._stop(),ci(document,"touchmove",this._onTouchMove,this),ci(document,"touchend touchcancel",this._onTouchEnd,this),yo(h)}},_onTouchMove:function(h){if(!(!h.touches||h.touches.length!==2||!this._zooming)){var _=this._map,w=_.mouseEventToContainerPoint(h.touches[0]),E=_.mouseEventToContainerPoint(h.touches[1]),D=w.distanceTo(E)/this._startDist;if(this._zoom=_.getScaleZoom(D,this._startZoom),!_.options.bounceAtZoomLimits&&(this._zoom<_.getMinZoom()&&D<1||this._zoom>_.getMaxZoom()&&D>1)&&(this._zoom=_._limitZoom(this._zoom)),_.options.touchZoom==="center"){if(this._center=this._startLatLng,D===1)return}else{var G=w._add(E)._divideBy(2)._subtract(this._centerPoint);if(D===1&&G.x===0&&G.y===0)return;this._center=_.unproject(_.project(this._pinchStartLatLng,this._zoom).subtract(G),this._zoom)}this._moved||(_._moveStart(!0,!1),this._moved=!0),X(this._animRequest);var se=o(_._move,_,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=K(se,this,!0),yo(h)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,X(this._animRequest),cn(document,"touchmove",this._onTouchMove,this),cn(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});hr.addInitHook("addHandler","touchZoom",wZ),hr.BoxZoom=Yt,hr.DoubleClickZoom=$r,hr.Drag=ys,hr.Keyboard=Ys,hr.ScrollWheelZoom=_m,hr.TapHold=bZ,hr.TouchZoom=wZ,i.Bounds=ie,i.Browser=Tt,i.CRS=Mt,i.Canvas=ZO,i.Circle=hw,i.CircleMarker=uw,i.Class=re,i.Control=Ic,i.DivIcon=HO,i.DivOverlay=Fc,i.DomEvent=cF,i.DomUtil=aF,i.Draggable=Sp,i.Evented=U,i.FeatureGroup=td,i.GeoJSON=Nc,i.GridLayer=Wy,i.Handler=Lc,i.Icon=n0,i.ImageOverlay=_w,i.LatLng=Ie,i.LatLngBounds=ue,i.Layer=Dc,i.LayerGroup=r0,i.LineUtil=pF,i.Map=hr,i.Marker=Hy,i.Mixin=BS,i.Path=Ep,i.Point=V,i.PolyUtil=OO,i.Polygon=s0,i.Polyline=id,i.Popup=yw,i.PosAnimation=SO,i.Projection=FO,i.Rectangle=te,i.Renderer=rd,i.SVG=O,i.SVGOverlay=JS,i.TileLayer=un,i.Tooltip=vw,i.Transformation=Ee,i.Util=ae,i.VideoOverlay=GO,i.bind=o,i.bounds=le,i.canvas=XO,i.circle=UO,i.circleMarker=yF,i.control=By,i.divIcon=SF,i.extend=n,i.featureGroup=cw,i.geoJSON=VO,i.geoJson=bF,i.gridLayer=kc,i.icon=gF,i.imageOverlay=wF,i.latLng=Ve,i.latLngBounds=ve,i.layerGroup=mF,i.map=uF,i.marker=_F,i.point=Y,i.polygon=zO,i.polyline=vF,i.popup=TF,i.rectangle=Ae,i.setOptions=b,i.stamp=l,i.svg=F,i.svgOverlay=xF,i.tileLayer=WO,i.tooltip=jO,i.transformation=at,i.version=r,i.videoOverlay=gm;var dTe=window.L;i.noConflict=function(){return window.L=dTe,this},window.L=i})})(ZV,ZV.exports);var Eoe=ZV.exports;function sft(t){let e,i,r,n,s;return{c(){e=Ya("div"),i=Ya("div"),r=N1(),n=Ya("div"),s=L2(t[0]),pu(i,"class","map svelte-pt0pam"),pu(n,"class","title svelte-pt0pam"),pu(e,"class","leafletMapWrapper svelte-pt0pam")},m(o,a){Mf(o,e,a),Zo(e,i),t[4](i),Zo(e,r),Zo(e,n),Zo(n,s)},p(o,[a]){a&1&&YV(s,o[0])},i:ty,o:ty,d(o){o&&tp(e),t[4](null)}}}function oft(t,e,i){let{center:r=[0,0]}=e,{zoom:n=1}=e,{title:s=""}=e,o;Uoe(()=>{var l=Eoe.map(o).setView([r[1],r[0]],n);l.scrollWheelZoom.disable(),l.attributionControl.setPrefix(!1),Eoe.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}").addTo(l)});function a(l){s8[l?"unshift":"push"](()=>{o=l,i(1,o)})}return t.$$set=l=>{"center"in l&&i(2,r=l.center),"zoom"in l&&i(3,n=l.zoom),"title"in l&&i(0,s=l.title)},[s,o,r,n,a]}class aft extends jN{constructor(e){super(),GN(this,e,oft,sft,zN,{center:2,zoom:3,title:0})}}function Aoe(t,e,i){const r=t.slice();return r[1]=e[i],r[3]=i,r}function Poe(t){let e,i,r,n;return i=new aft({props:{center:t[1].center,zoom:t[1].zoom,title:t[1].title}}),{c(){e=Ya("div"),JV(i.$$.fragment),r=N1(),pu(e,"class","mapWrapper svelte-1wd8xyn")},m(s,o){Mf(s,e,o),BN(i,e,null),Zo(e,r),n=!0},p(s,o){const a={};o&1&&(a.center=s[1].center),o&1&&(a.zoom=s[1].zoom),o&1&&(a.title=s[1].title),i.$set(a)},i(s){n||(pg(i.$$.fragment,s),n=!0)},o(s){Q1(i.$$.fragment,s),n=!1},d(s){s&&tp(e),VN(i)}}}function lft(t){let e,i,r,n,s=PZ(t[0]),o=[];for(let l=0;l<s.length;l+=1)o[l]=Poe(Aoe(t,s,l));const a=l=>Q1(o[l],1,1,()=>{o[l]=null});return{c(){e=Ya("div");for(let l=0;l<o.length;l+=1)o[l].c();i=N1(),r=Ya("div"),r.textContent=`All maps: Tiles  Esri  Source: Esri, i-cubed, USDA, USGS, AEX,
  GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community.`,pu(e,"class","mapGridWrapper svelte-1wd8xyn"),pu(r,"class","attribution svelte-1wd8xyn")},m(l,c){Mf(l,e,c);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);Mf(l,i,c),Mf(l,r,c),n=!0},p(l,[c]){if(c&1){s=PZ(l[0]);let u;for(u=0;u<s.length;u+=1){const p=Aoe(l,s,u);o[u]?(o[u].p(p,c),pg(o[u],1)):(o[u]=Poe(p),o[u].c(),pg(o[u],1),o[u].m(e,null))}for(Boe(),u=s.length;u<o.length;u+=1)a(u);Voe()}},i(l){if(!n){for(let c=0;c<s.length;c+=1)pg(o[c]);n=!0}},o(l){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)Q1(o[c]);n=!1},d(l){l&&(tp(e),tp(i),tp(r)),CTe(o,l)}}}function cft(t,e,i){let{locations:r}=e;return t.$$set=n=>{"locations"in n&&i(0,r=n.locations)},[r]}class uft extends jN{constructor(e){super(),GN(this,e,cft,lft,zN,{locations:0})}}function hft(t){let e,i,r=t[1]!==!0?"Grid":"Hopper",n,s,o,a;return{c(){e=Ya("a"),i=L2(`View
            `),n=L2(r),s=L2(`
          -`),pu(e,"href","#")},m(l,c){Mf(l,e,c),Zo(e,i),Zo(e,n),Mf(l,s,c),o||(a=koe(e,"click",t[3]),o=!0)},p(l,c){c&2&&r!==(r=l[1]!==!0?"Grid":"Hopper")&&YV(n,r)},d(l){l&&(tp(e),tp(s)),o=!1,a()}}}function dft(t){let e,i;return e=new nft({props:{locations:t[0],basemap:"satellite"}}),{c(){JV(e.$$.fragment)},m(r,n){BN(e,r,n),i=!0},p(r,n){const s={};n&1&&(s.locations=r[0]),e.$set(s)},i(r){i||(pg(e.$$.fragment,r),i=!0)},o(r){Q1(e.$$.fragment,r),i=!1},d(r){VN(e,r)}}}function pft(t){let e,i;return e=new uft({props:{locations:t[0]}}),{c(){JV(e.$$.fragment)},m(r,n){BN(e,r,n),i=!0},p(r,n){const s={};n&1&&(s.locations=r[0]),e.$set(s)},i(r){i||(pg(e.$$.fragment,r),i=!0)},o(r){Q1(e.$$.fragment,r),i=!1},d(r){VN(e,r)}}}function fft(t){let e,i,r,n,s,o,a,l,c,u,p,f,y,v,b=t[2]>768&&hft(t);const x=[pft,dft],S=[];function P(C,R){return C[1]===!0?0:1}return u=P(t),p=S[u]=x[u](t),{c(){e=Ya("main"),i=Ya("div"),r=Ya("div"),r.innerHTML=`<h1 class="svelte-nox2xa">Interesting Earth</h1> <p class="subtitle svelte-nox2xa">Showing the Earth&#39;s most interesting locations from the
        <a href="https://chrome.google.com/webstore/detail/worldview/aflbpeobpgdpibcfhkkjhaonbbpkmefg" target="_blank">worldview chrome extension</a>.</p>`,n=N1(),s=Ya("div"),o=Ya("div"),b&&b.c(),a=N1(),l=Ya("a"),l.textContent="About",c=N1(),p.c(),pu(l,"href","#"),EZ(s,"flex-grow","1"),EZ(s,"text-align","right"),pu(i,"class","topWrapper svelte-nox2xa"),pu(e,"class","svelte-nox2xa")},m(C,R){Mf(C,e,R),Zo(e,i),Zo(i,r),Zo(i,n),Zo(i,s),Zo(s,o),b&&b.m(o,null),Zo(o,a),Zo(o,l),Zo(e,c),S[u].m(e,null),f=!0,y||(v=koe(l,"click",t[4]),y=!0)},p(C,[R]){C[2]>768&&b.p(C,R);let N=u;u=P(C),u===N?S[u].p(C,R):(Boe(),Q1(S[N],1,1,()=>{S[N]=null}),Voe(),p=S[u],p?p.p(C,R):(p=S[u]=x[u](C),p.c()),pg(p,1),p.m(e,null))},i(C){f||(pg(p),f=!0)},o(C){Q1(p),f=!1},d(C){C&&tp(e),b&&b.d(),S[u].d(),y=!1,v()}}}function mft(t,e,i){let r=[],n=!1,s=window.innerWidth;return Uoe(()=>{fetch("https://services.arcgis.com/WQ9KVmV6xGGMnCiQ/arcgis/rest/services/WorldviewMaster/FeatureServer/0/query?geometryType=esriGeometryPoint&spatialRel=esriSpatialRelIntersects&units=esriSRUnit_Meter&outFields=*&outSR=4326&returnGeometry=true&f=json&where=Status=%27Approved%27").then(l=>l.json()).then(l=>{const c=[...l.features];c.push({attributes:{Location_Name:"Tangalooma Wrecks",OBJECTID:c.length+1,Reported:0,Status:"Approved",Zoom_Level:19},geometry:{x:153.3684,y:-27.163}}),LTe(c),i(0,r=c.map((u,p)=>({id:u.attributes.OBJECTID,center:[u.geometry.x,u.geometry.y],zoom:u.attributes.Zoom_Level-1,title:u.attributes.Location_Name,basemap:"hybrid"})))})}),[r,n,s,()=>{i(1,n=!n)},()=>{FTe.fire({title:"About Interesting Earth",html:'Randomly cycling through the most interesting locations in the world (featured in the <a href="https://chrome.google.com/webstore/detail/worldview/aflbpeobpgdpibcfhkkjhaonbbpkmefg" target="_blank">Worldview Chrome extension</a>). Check out both the grid and hopper mode!<br /><br />Built by <a href="https://gavinr.com" target="_blank">Gavin Rehkemper</a>.<br /><br /><strong>If you appreciate this page, please <a class="github-button" href="https://github.com/gavinr/interesting-earth" aria-label="Star gavinr/interesting-earth on GitHub">star this project on GitHub</a>.</strong>',confirmButtonText:"OK",backdrop:!1})}]}class gft extends jN{constructor(e){super(),GN(this,e,mft,fft,zN,{})}}new gft({target:document.getElementById("app")});export{EGe as $,Nxe as A,hlt as B,wme as C,QD as D,ske as E,KZe as F,gZe as G,bZe as H,lZ as I,yq as J,Tnt as K,xnt as L,Q4 as M,Snt as N,nN as O,pqe as P,Hlt as Q,Vxe as R,zFe as S,Zlt as T,Hxe as U,Mat as V,Ylt as W,Zxe as X,qZe as Y,nF as Z,Twe as _,yme as a,Hf as a$,lct as a0,_ct as a1,Pct as a2,Rct as a3,$ct as a4,Kqe as a5,Xxe as a6,hct as a7,Xct as a8,QYe as a9,jrt as aA,qn as aB,_S as aC,wu as aD,Gs as aE,Oe as aF,eP as aG,yae as aH,il as aI,$l as aJ,a5 as aK,hn as aL,aT as aM,Sft as aN,Pu as aO,fs as aP,M as aQ,nt as aR,XT as aS,zs as aT,wq as aU,Kb as aV,Jt as aW,go as aX,Gr as aY,Ws as aZ,jt as a_,RJe as aa,pet as ab,Let as ac,Pet as ad,Lf as ae,an as af,ar as ag,Je as ah,d as ai,m as aj,zb as ak,J as al,nj as am,VX as an,ke as ao,hy as ap,ce as aq,Bh as ar,Q_ as as,lhe as at,Ci as au,Pe as av,gr as aw,fb as ax,H7 as ay,gb as az,Bme as b,gT as b$,Rt as b0,Me as b1,me as b2,ye as b3,I as b4,zP as b5,LP as b6,ms as b7,Gxt as b8,jxt as b9,oae as bA,ps as bB,jG as bC,YT as bD,Xmt as bE,N3 as bF,dp as bG,Sa as bH,bG as bI,gi as bJ,$e as bK,P5 as bL,Vb as bM,Ab as bN,Sy as bO,ri as bP,Tft as bQ,u8 as bR,Hoe as bS,hce as bT,cgt as bU,Ymt as bV,J3 as bW,Ft as bX,u5 as bY,M3 as bZ,lD as b_,o4e as ba,Tje as bb,Ng as bc,Jwt as bd,WTt as be,PSt as bf,Dt as bg,ESt as bh,SDe as bi,Qmt as bj,BPe as bk,Ar as bl,al as bm,os as bn,xr as bo,j$ as bp,Mj as bq,Lt as br,N_ as bs,Hb as bt,U3 as bu,Bt as bv,iy as bw,sgt as bx,nce as by,oYe as bz,qke as c,Sr as c$,JN as c0,iAe as c1,Wo as c2,rAe as c3,nAe as c4,sAe as c5,Pr as c6,rl as c7,Nt as c8,Le as c9,pje as cA,oyt as cB,tb as cC,_Re as cD,_ue as cE,ogt as cF,ggt as cG,iRe as cH,WL as cI,BL as cJ,egt as cK,agt as cL,PIe as cM,rS as cN,wTt as cO,bTt as cP,nR as cQ,kIe as cR,pS as cS,d4e as cT,B4e as cU,MP as cV,hyt as cW,tAt as cX,Hq as cY,Nj as cZ,Ej as c_,hit as ca,ge as cb,ea as cc,Tu as cd,yr as ce,gje as cf,GG as cg,CP as ch,BG as ci,_H as cj,ayt as ck,efe as cl,Ti as cm,kb as cn,Er as co,Q0t as cp,Hgt as cq,En as cr,zh as cs,mg as ct,Lg as cu,_he as cv,fMe as cw,Fae as cx,f0t as cy,em as cz,NUe as d,z3 as d$,Ub as d0,mit as d1,E5e as d2,Si as d3,jIe as d4,epe as d5,Dae as d6,YN as d7,Tj as d8,vT as d9,kG as dA,Qle as dB,zG as dC,Vmt as dD,Lmt as dE,D5 as dF,DP as dG,w3 as dH,yz as dI,jn as dJ,_z as dK,bz as dL,oD as dM,lde as dN,omt as dO,QP as dP,xDe as dQ,An as dR,uve as dS,e0 as dT,J0t as dU,nyt as dV,sl as dW,$rt as dX,nn as dY,Mrt as dZ,AP as d_,OP as da,lae as db,gu as dc,OMe as dd,PP as de,RMe as df,E2e as dg,x5 as dh,Ygt as di,Kgt as dj,Ge as dk,Ag as dl,W5e as dm,H5e as dn,rHe as dp,$s as dq,kgt as dr,Lxt as ds,li as dt,kh as du,Fle as dv,LIe as dw,F1 as dx,nb as dy,UG as dz,WUe as e,kSe as e$,SI as e0,VZ as e1,k4e as e2,Xgt as e3,ip as e4,Rft as e5,qat as e6,Zat as e7,zat as e8,q3t as e9,aD as eA,nm as eB,hb as eC,w1t as eD,pR as eE,HRe as eF,WOt as eG,ZOt as eH,HOt as eI,O2e as eJ,aRt as eK,ydt as eL,QOt as eM,ddt as eN,yft as eO,jOt as eP,lRt as eQ,sa as eR,EDe as eS,oH as eT,WTe as eU,Ay as eV,K0t as eW,mIe as eX,fe as eY,st as eZ,Ne as e_,EN as ea,t3t as eb,Yat as ec,WEe as ed,fje as ee,sWe as ef,oWe as eg,VG as eh,Yye as ei,Pxt as ej,Axt as ek,pgt as el,fgt as em,ugt as en,dgt as eo,Ta as ep,CEe as eq,Oxt as er,GHe as es,Fot as et,nE as eu,_n as ev,mr as ew,yy as ex,Mh as ey,Tn as ez,MHe as f,Jr as f$,g8 as f0,jTt as f1,iPe as f2,gP as f3,R3 as f4,LEt as f5,TP as f6,Ru as f7,E5 as f8,X0t as f9,pb as fA,$je as fB,ns as fC,m0t as fD,_0t as fE,RSt as fF,wDe as fG,Wwt as fH,sye as fI,jW as fJ,qwt as fK,Zwt as fL,cb as fM,Ou as fN,ext as fO,bft as fP,lu as fQ,up as fR,n1t as fS,c5 as fT,ia as fU,mn as fV,U1 as fW,Y5 as fX,Or as fY,Ca as fZ,Rg as f_,Qpe as fa,sfe as fb,js as fc,Gd as fd,cu as fe,Sn as ff,A3 as fg,Eh as fh,Py as fi,NMe as fj,nIe as fk,jgt as fl,e0t as fm,Qi as fn,Dnt as fo,Bht as fp,Qb as fq,rxt as fr,ixt as fs,xy as ft,wp as fu,oO as fv,fmt as fw,pmt as fx,_6 as fy,Mue as fz,BH as g,GTe as g$,FOt as g0,B8 as g1,_u as g2,lr as g3,yHe as g4,uxe as g5,tG as g6,iG as g7,YTe as g8,Cft as g9,Iwt as gA,g2 as gB,Cz as gC,kwt as gD,wee as gE,P_t as gF,Dwt as gG,xc as gH,Mg as gI,Li as gJ,$3 as gK,el as gL,p4e as gM,P1 as gN,Nr as gO,kn as gP,xLe as gQ,Kd as gR,yp as gS,G1 as gT,F0t as gU,OLe as gV,Kn as gW,vft as gX,yMe as gY,yT as gZ,wj as g_,W5 as ga,SG as gb,QH as gc,NH as gd,SPt as ge,MPt as gf,KH as gg,uo as gh,pe as gi,xe as gj,NZe as gk,Es as gl,_He as gm,on as gn,fo as go,IG as gp,ly as gq,xG as gr,Vd as gs,QZ as gt,Hrt as gu,a_t as gv,HN as gw,QNe as gx,fX as gy,HEe as gz,Bke as h,N8 as h$,dr as h0,xV as h1,TV as h2,B3 as h3,qT as h4,_P as h5,sX as h6,Jgt as h7,GOt as h8,M_t as h9,Lr as hA,wit as hB,Ke as hC,_De as hD,A_ as hE,ds as hF,Qr as hG,Do as hH,nW as hI,ROt as hJ,owe as hK,Yo as hL,$_t as hM,oge as hN,yAe as hO,hT as hP,Bwt as hQ,$_ as hR,bDe as hS,eEt as hT,pit as hU,CA as hV,Dft as hW,OEe as hX,LEe as hY,p8 as hZ,FEe as h_,uc as ha,Jmt as hb,Kmt as hc,l4e as hd,a4e as he,i4e as hf,QY as hg,db as hh,ub as hi,Dgt as hj,UA as hk,mz as hl,X_ as hm,G8 as hn,Wmt as ho,B2 as hp,Wf as hq,R_t as hr,j as hs,Te as ht,sn as hu,xi as hv,br as hw,Jd as hx,Fn as hy,gt as hz,sve as i,M5 as i$,xxt as i0,Fi as i1,Tc as i2,Ml as i3,T as i4,Nn as i5,Au as i6,vt as i7,je as i8,KD as i9,AS as iA,kqe as iB,PH as iC,IW as iD,Kvt as iE,Pb as iF,D4 as iG,Za as iH,C8e as iI,z6 as iJ,_1t as iK,y1t as iL,ID as iM,xK as iN,pIe as iO,tde as iP,Xh as iQ,tl as iR,Os as iS,Fj as iT,Jvt as iU,xa as iV,Cr as iW,my as iX,aSt as iY,sSt as iZ,lSt as i_,am as ia,At as ib,Vi as ic,Ec as id,De as ie,q as ig,Fr as ih,qi as ii,Gi as ij,Ni as ik,Zt as il,Qg as im,e4 as io,Dy as ip,Nl as iq,E4 as ir,ni as is,Jf as it,Ey as iu,Ny as iv,O4 as iw,Ko as ix,pq as iy,A4 as iz,Lb as j,tKe as j$,oSt as j0,yJe as j1,wJe as j2,vJe as j3,bJe as j4,iN as j5,Kr as j6,Kt as j7,Ah as j8,Ce as j9,uyt as jA,ZIe as jB,s5 as jC,$G as jD,DF as jE,vi as jF,yc as jG,uj as jH,D_t as jI,iRt as jJ,vpt as jK,tRt as jL,cRt as jM,eRt as jN,eK as jO,Q1e as jP,tbe as jQ,Vu as jR,nP as jS,Y1 as jT,V1e as jU,CKe as jV,_Je as jW,fWe as jX,Kye as jY,umt as jZ,gWe as j_,gie as ja,O2 as jb,o1t as jc,Qe as jd,Qn as je,xu as jf,Eft as jg,Jft as jh,Oae as ji,oRt as jj,sRt as jk,tut as jl,syt as jm,_fe as jn,lyt as jo,cyt as jp,ade as jq,QF as jr,HX as js,jmt as jt,_T as ju,Ugt as jv,Mft as jw,lG as jx,mb as jy,uT as jz,est as k,Rxt as k$,XJe as k0,YJe as k1,rKe as k2,KJe as k3,QJe as k4,mp as k5,JJe as k6,Aa as k7,iKe as k8,Z3 as k9,fV as kA,O0t as kB,gle as kC,M0t as kD,R0t as kE,Tf as kF,GP as kG,ta as kH,ho as kI,bf as kJ,Ogt as kK,L0t as kL,Fge as kM,Wb as kN,qh as kO,C_ as kP,fn as kQ,z as kR,ymt as kS,S3 as kT,G3 as kU,Oft as kV,dit as kW,uit as kX,yDe as kY,d_t as kZ,Mxt as k_,a4 as ka,Ms as kb,mWe as kc,eKe as kd,c4 as ke,Wh as kf,Iy as kg,Q2 as kh,nl as ki,nx as kj,e5 as kk,Pg as kl,lgt as km,rgt as kn,BZ as ko,zwt as kp,tgt as kq,igt as kr,ngt as ks,EP as kt,d5 as ku,mgt as kv,iye as kw,tce as kx,$j as ky,Rue as kz,GWe as l,pr as l$,U_e as l0,Mwt as l1,kle as l2,cde as l3,Af as l4,KTt as l5,iV as l6,qft as l7,Jet as l8,tMe as l9,gde as lA,sDe as lB,Z0t as lC,yi as lD,vu as lE,Ht as lF,ln as lG,Ly as lH,$y as lI,cmt as lJ,rSt as lK,fce as lL,amt as lM,Vhe as lN,ws as lO,Qt as lP,Oue as lQ,aRe as lR,ry as lS,Smt as lT,D8 as lU,Uh as lV,Ud as lW,bi as lX,gc as lY,bH as lZ,vH as l_,CTt as la,kTt as lb,STt as lc,xTt as ld,_2 as le,iYe as lf,TTt as lg,rRt as lh,ypt as li,KOt as lj,gpt as lk,YOt as ll,JOt as lm,nRt as ln,qOt as lo,Spt as lp,XOt as lq,Gg as lr,hpe as ls,XLe as lt,NOt as lu,ma as lv,m8 as lw,w4e as lx,UP as ly,No as lz,Tst as m,bt as m$,G0t as m0,ILe as m1,wO as m2,RS as m3,$o as m4,x0t as m5,i_t as m6,Xoe as m7,mj as m8,Wgt as m9,Ri as mA,i5 as mB,xgt as mC,qgt as mD,EAe as mE,Re as mF,TPt as mG,EPt as mH,Ngt as mI,kRe as mJ,l1 as mK,wPt as mL,MD as mM,wr as mN,zgt as mO,hwt as mP,j0e as mQ,en as mR,_q as mS,Bi as mT,yu as mU,L8 as mV,Tb as mW,r4 as mX,Ac as mY,Kg as mZ,Lo as m_,E3 as ma,eMe as mb,w5 as mc,Qgt as md,qoe as me,ehe as mf,xj as mg,Ggt as mh,WX as mi,ohe as mj,yj as mk,jh as ml,Jg as mm,wK as mn,Su as mo,g1t as mp,Wxt as mq,Hh as mr,IT as ms,M6e as mt,$H as mu,rLe as mv,Xb as mw,yFe as mx,_h as my,it as mz,Sxe as n,t4 as n$,Yi as n0,ze as n1,Ea as n2,Br as n3,Bue as n4,APt as n5,PPt as n6,RPt as n7,cj as n8,ba as n9,Wye as nA,Zye as nB,jye as nC,Eee as nD,yWe as nE,$wt as nF,Jle as nG,NAe as nH,Nmt as nI,TAe as nJ,RAe as nK,Xye as nL,MG as nM,Rmt as nN,Uve as nO,aZe as nP,Qa as nQ,Eu as nR,B4 as nS,ei as nT,Dl as nU,Pc as nV,Oa as nW,Yh as nX,hu as nY,k0t as nZ,j3 as n_,gLe as na,v5 as nb,et as nc,vp as nd,Ki as ne,zi as nf,EOt as ng,b4e as nh,GCt as ni,Ef as nj,V3 as nk,Ule as nl,K_e as nm,KE as nn,ope as no,kOt as np,TD as nq,p0t as nr,vWe as ns,SA as nt,Z_ as nu,Ixt as nv,bee as nw,Dxt as nx,Hmt as ny,Cxt as nz,ilt as o,X0e as o$,e_e as o0,N0t as o1,wVe as o2,Fl as o3,gke as o4,Cu as o5,Svt as o6,xvt as o7,Tvt as o8,fLe as o9,Uf as oA,nK as oB,Fo as oC,Is as oD,gz as oE,xmt as oF,wmt as oG,It as oH,_J as oI,nG as oJ,Eje as oK,Hwt as oL,Yj as oM,Agt as oN,U0t as oO,yD as oP,ude as oQ,zmt as oR,gJ as oS,sm as oT,k5 as oU,Bj as oV,Vh as oW,gp as oX,UT as oY,Mo as oZ,P4 as o_,k2 as oa,eGe as ob,jT as oc,wEe as od,du as oe,Gje as of,r7 as og,kW as oh,g8e as oi,oLe as oj,nLe as ok,ug as ol,QV as om,o8e as on,Zgt as oo,Io as op,j0t as oq,_de as or,WT as os,dy as ot,bc as ou,qIe as ov,B0t as ow,V0t as ox,vb as oy,k8 as oz,Axe as p,Qvt as p$,a_e as p0,xt as p1,LW as p2,Zd as p3,Fgt as p4,Xj as p5,kte as p6,r1t as p7,BP as p8,$ue as p9,Ig as pA,j5 as pB,y8e as pC,D0t as pD,oK as pE,s1t as pF,C3 as pG,qb as pH,Dr as pI,W0t as pJ,cT as pK,lIe as pL,Df as pM,jue as pN,Qoe as pO,KTe as pP,lmt as pQ,M9e as pR,POt as pS,n$ as pT,c_e as pU,Tat as pV,sLe as pW,CPt as pX,UIe as pY,zne as pZ,sT as p_,uCe as pa,G_ as pb,ny as pc,z0t as pd,sF as pe,uD as pf,Iqe as pg,$Ot as ph,jwt as pi,OT as pj,LOt as pk,IOt as pl,O3 as pm,Umt as pn,mJ as po,sf as pp,NP as pq,Kj as pr,wT as ps,Pgt as pt,Zze as pu,Qj as pv,Zhe as pw,bT as px,Jde as py,QLe as pz,slt as q,Fwt as q$,TT as q0,XIe as q1,Yn as q2,Hbe as q3,uS as q4,oi as q5,Qye as q6,eve as q7,Kwt as q8,e1e as q9,hi as qA,F_e as qB,k_e as qC,t0t as qD,QKe as qE,kC as qF,S5 as qG,A5 as qH,C5 as qI,F3 as qJ,ERe as qK,_tt as qL,BHe as qM,UHe as qN,hxt as qO,uxt as qP,Dg as qQ,kxt as qR,co as qS,Qo as qT,XCt as qU,uq as qV,na as qW,tmt as qX,su as qY,Gwt as qZ,Ez as q_,W1e as qa,dhe as qb,Qde as qc,XI as qd,ASt as qe,ST as qf,RLe as qg,yg as qh,Sq as qi,V4 as qj,_r as qk,VPt as ql,p_t as qm,oG as qn,Wft as qo,HP as qp,txt as qq,Eme as qr,Qot as qs,OPt as qt,j_ as qu,bLe as qv,SJ as qw,pX as qx,Tit as qy,h5 as qz,alt as r,r5 as r$,cHe as r0,T5 as r1,hS as r2,ytt as r3,HW as r4,Jn as r5,Ftt as r6,rre as r7,SV as r8,gd as r9,_At as rA,kmt as rB,Vwt as rC,mc as rD,Hft as rE,UZe as rF,Jc as rG,Di as rH,Rs as rI,ss as rJ,Wt as rK,Vr as rL,Jo as rM,OW as rN,Zf as rO,cwt as rP,qt as rQ,Gt as rR,mt as rS,Ext as rT,VTt as rU,MWe as rV,GTt as rW,tve as rX,rmt as rY,VCe as rZ,ML as r_,TN as ra,JEt as rb,SN as rc,pc as rd,fc as re,AV as rf,CV as rg,PV as rh,EV as ri,nre as rj,Lde as rk,Nfe as rl,qj as rm,LL as rn,pFe as ro,$fe as rp,zg as rq,U5 as rr,FA as rs,V5 as rt,lpe as ru,H0t as rv,wFe as rw,bje as rx,Bmt as ry,Pft as rz,Ixe as s,WJe as s$,wWe as s0,bWe as s1,Bxt as s2,ga as s3,OSt as s4,g0t as s5,y0t as s6,lbe as s7,dSe as s8,dje as s9,Nxt as sA,$xt as sB,M$e as sC,pz as sD,Ek as sE,Ak as sF,wft as sG,xft as sH,Txt as sI,cy as sJ,Ile as sK,Xwe as sL,Rst as sM,Wwe as sN,jst as sO,Zv as sP,iZ as sQ,tZ as sR,xre as sS,Ast as sT,Sre as sU,ZXe as sV,KKe as sW,Iq as sX,cbe as sY,Lq as sZ,ube as s_,Sue as sa,Cmt as sb,Emt as sc,Amt as sd,vCe as se,GEt as sf,KEt as sg,c1e as sh,S1 as si,sre as sj,VEt as sk,HEt as sl,T1 as sm,zEt as sn,TU as so,JI as sp,Qf as sq,Ll as sr,Gh as ss,Pye as st,vh as su,trt as sv,irt as sw,wA as sx,dPe as sy,URe as sz,Rxe as t,YOe as t$,sV as t0,bYe as t1,Mmt as t2,jre as t3,Ure as t4,IAe as t5,zre as t6,ine as t7,Bre as t8,Gmt as t9,RTt as tA,MTt as tB,Dre as tC,Ere as tD,Are as tE,Pre as tF,Zre as tG,wne as tH,Sne as tI,Nre as tJ,xne as tK,b5 as tL,E1e as tM,NTt as tN,YXe as tO,JXe as tP,PTt as tQ,OTt as tR,C1e as tS,ATt as tT,Qet as tU,KXe as tV,HG as tW,ay as tX,cE as tY,KOe as tZ,JOe as t_,qre as ta,une as tb,hne as tc,dne as td,Dmt as te,DG as tf,Nle as tg,$mt as th,qAe as ti,kAe as tj,Imt as tk,pne as tl,Fmt as tm,Bgt as tn,ETt as to,FTt as tp,tne as tq,sne as tr,ITt as ts,$Tt as tt,Xet as tu,LTt as tv,DTt as tw,xte as tx,Ste as ty,Tte as tz,Nme as u,Y0t as u0,tRe as u1,uRt as u2,t_t as u3,PNe as u4,ANe as u5,zTt as u6,qN as u7,rRe as u8,Kht as u9,U2 as uA,M8 as uB,ol as uC,lT as uD,rG as uE,Y_t as uF,tJe as uG,Ob as uH,e$e as uI,$0t as uJ,Xwt as uK,Vxt as uL,CSt as uM,FSe as ua,qL as ub,XL as uc,GPe as ud,$ft as ue,hgt as uf,uRe as ug,hRe as uh,HY as ui,HTt as uj,BTt as uk,sj as ul,Hpt as um,DOt as un,r_t as uo,bO as up,Tmt as uq,bmt as ur,vmt as us,n5 as ut,uqe as uu,iit as uv,Y_ as uw,uye as ux,Ffe as uy,$E as uz,E6e as v,_me as w,ike as x,BA as y,clt as z};
