import{lU as j,io as R,b as _,r,e,d as s,n as c,y as z,F as b,he as S,x as m,G as x,t as y,hf as A,cL as h,aX as F,rQ as P,ht as q,ah as M,rR as T,nU as C,nW as N,B as U}from"./index.a8738f47.js";import{f as w,u as O}from"./LineOfSightAnalysisTarget.091ad9e1.js";import{s as k}from"./elevationInfoUtils.fe889101.js";import"./persistable.6d7b5a7d.js";import"./multiOriginJSONSupportUtils.8128aa52.js";let B=0,o=class extends j(R(_(z))){constructor(t){super(t),this.id=`${Date.now().toString(16)}-analysis-${B++}`,this.title=null}get parent(){return this._get("parent")}set parent(t){const i=this.parent;if(r(i))switch(i.type){case"line-of-sight":i.removeAnalysis(this);break;case"2d":case"3d":i.analyses.includes(this)&&i.analyses.remove(this)}this._set("parent",t)}get isEditable(){return this.requiredPropertiesForEditing.every(r)}};e([s({type:String,constructOnly:!0,clonable:!1})],o.prototype,"id",void 0),e([s({type:String})],o.prototype,"title",void 0),e([s({constructOnly:!0})],o.prototype,"type",void 0),e([s({clonable:!1,value:null})],o.prototype,"parent",null),e([s({readOnly:!0})],o.prototype,"extent",void 0),e([s({readOnly:!0})],o.prototype,"isEditable",null),e([s({readOnly:!0})],o.prototype,"requiredPropertiesForEditing",void 0),e([s({readOnly:!0})],o.prototype,"nonEditableMessage",void 0),o=e([c("esri.analysis.Analysis")],o);const D=o,g=b.ofType(w);let a=class extends D{constructor(t){super(t),this.type="line-of-sight",this.observer=null,this.extent=null,this.nonEditableMessage="Assign an observer location to the analysis to allow editing."}initialize(){this.own(m(()=>this._computeExtent(),t=>{(y(t)||y(t.pending))&&this._set("extent",r(t)?t.extent:null)},x))}get targets(){return this._get("targets")||new g}set targets(t){this._set("targets",A(t,this.targets,g))}get spatialReference(){return r(this.observer)&&r(this.observer.position)?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[h(this.observer,t=>t.position)]}async waitComputeExtent(){const t=this._computeExtent();return r(t)?F(t.pending):null}_computeExtent(){const t=this.spatialReference;if(y(this.observer)||y(this.observer.position)||y(t))return null;const i=p=>k(p.position,p.elevationInfo)==="absolute-height",l=this.observer.position,v=P(l.x,l.y,l.z,l.x,l.y,l.z);for(const p of this.targets)if(r(p.position)){const d=q(p.position,t);if(r(d.pending))return{pending:d.pending,extent:null};if(r(d.geometry)){const{x:E,y:$,z:L}=d.geometry;M(v,[E,$,L])}}const u=T(v,t);return i(this.observer)&&this.targets.every(i)||(u.zmin=null,u.zmax=null),{pending:null,extent:u}}clear(){this.observer=null,this.targets.removeAll()}};e([s({type:["line-of-sight"]})],a.prototype,"type",void 0),e([s({type:O,json:{read:!0,write:!0}})],a.prototype,"observer",void 0),e([s({cast:S,type:g,nonNullable:!0,json:{read:!0,write:!0}})],a.prototype,"targets",null),e([s({value:null,readOnly:!0})],a.prototype,"extent",void 0),e([s({readOnly:!0})],a.prototype,"spatialReference",null),e([s({readOnly:!0})],a.prototype,"requiredPropertiesForEditing",null),e([s({readOnly:!0})],a.prototype,"nonEditableMessage",void 0),a=e([c("esri.analysis.LineOfSightAnalysis")],a);const f=a,G=b.ofType(w);let n=class extends C(N(U)){constructor(t){super(t),this.type="line-of-sight",this.operationalLayerType="LineOfSightLayer",this.analysis=new f,this.opacity=1}initialize(){this.own(m(()=>this.analysis,(t,i)=>{r(i)&&i.parent===this&&(i.parent=null),r(t)&&(t.parent=this)},x))}async load(){return r(this.analysis)&&this.addResolvingPromise(this.analysis.waitComputeExtent()),this}get observer(){return h(this.analysis,t=>t.observer)}set observer(t){h(this.analysis,i=>i.observer=t)}get targets(){return r(this.analysis)?this.analysis.targets:null}set targets(t){h(this.analysis,i=>i.targets=t)}get fullExtent(){return r(this.analysis)?this.analysis.extent:null}get spatialReference(){return r(this.analysis)?this.analysis.spatialReference:null}removeAnalysis(t){this.analysis===t&&(this.analysis=new f)}};e([s({json:{read:!1},readOnly:!0})],n.prototype,"type",void 0),e([s({type:["LineOfSightLayer"]})],n.prototype,"operationalLayerType",void 0),e([s({type:O,json:{read:!0,write:{ignoreOrigin:!0}}})],n.prototype,"observer",null),e([s({type:G,json:{read:!0,write:{ignoreOrigin:!0}}})],n.prototype,"targets",null),e([s({nonNullable:!0,json:{read:!1,write:!1}})],n.prototype,"analysis",void 0),e([s({readOnly:!0})],n.prototype,"fullExtent",null),e([s({readOnly:!0})],n.prototype,"spatialReference",null),e([s({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],n.prototype,"opacity",void 0),e([s({type:["show","hide"]})],n.prototype,"listMode",void 0),n=e([c("esri.layers.LineOfSightLayer")],n);const J=n;export{J as default};
