(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();function vx(){}function Kue(e){return e()}function CK(){return Object.create(null)}function L3(e){e.forEach(Kue)}function ehe(e){return typeof e=="function"}function xk(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function FEe(e){return Object.keys(e).length===0}function kEe(e){return e&&ehe(e.destroy)?e.destroy:vx}function ia(e,t){e.appendChild(t)}function gm(e,t,i){e.insertBefore(t,i||null)}function Np(e){e.parentNode.removeChild(e)}function UEe(e,t){for(let i=0;i<e.length;i+=1)e[i]&&e[i].d(t)}function tl(e){return document.createElement(e)}function J2(e){return document.createTextNode(e)}function rx(){return J2(" ")}function the(e,t,i,r){return e.addEventListener(t,i,r),()=>e.removeEventListener(t,i,r)}function Gu(e,t,i){i==null?e.removeAttribute(t):e.getAttribute(t)!==i&&e.setAttribute(t,i)}function zEe(e){return Array.from(e.childNodes)}function JW(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function AK(e,t,i,r){i===null?e.style.removeProperty(t):e.style.setProperty(t,i,r?"important":"")}let nP;function dM(e){nP=e}function BEe(){if(!nP)throw new Error("Function called outside component initialization");return nP}function ihe(e){BEe().$$.on_mount.push(e)}const XO=[],J9=[],rN=[],OK=[],VEe=Promise.resolve();let K9=!1;function GEe(){K9||(K9=!0,VEe.then(rhe))}function eG(e){rN.push(e)}const QB=new Set;let nL=0;function rhe(){const e=nP;do{for(;nL<XO.length;){const t=XO[nL];nL++,dM(t),jEe(t.$$)}for(dM(null),XO.length=0,nL=0;J9.length;)J9.pop()();for(let t=0;t<rN.length;t+=1){const i=rN[t];QB.has(i)||(QB.add(i),i())}rN.length=0}while(XO.length);for(;OK.length;)OK.pop()();K9=!1,QB.clear(),dM(e)}function jEe(e){if(e.fragment!==null){e.update(),L3(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(eG)}}const sN=new Set;let Fw;function she(){Fw={r:0,c:[],p:Fw}}function nhe(){Fw.r||L3(Fw.c),Fw=Fw.p}function Ey(e,t){e&&e.i&&(sN.delete(e),e.i(t))}function bx(e,t,i,r){if(e&&e.o){if(sN.has(e))return;sN.add(e),Fw.c.push(()=>{sN.delete(e),r&&(i&&e.d(1),r())}),e.o(t)}else r&&r()}function KW(e){e&&e.c()}function Tk(e,t,i,r){const{fragment:s,on_mount:n,on_destroy:o,after_update:a}=e.$$;s&&s.m(t,i),r||eG(()=>{const l=n.map(Kue).filter(ehe);o?o.push(...l):L3(l),e.$$.on_mount=[]}),a.forEach(eG)}function Sk(e,t){const i=e.$$;i.fragment!==null&&(L3(i.on_destroy),i.fragment&&i.fragment.d(t),i.on_destroy=i.fragment=null,i.ctx=[])}function HEe(e,t){e.$$.dirty[0]===-1&&(XO.push(e),GEe(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Ek(e,t,i,r,s,n,o,a=[-1]){const l=nP;dM(e);const c=e.$$={fragment:null,ctx:null,props:n,update:vx,not_equal:s,bound:CK(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:CK(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(c.root);let h=!1;if(c.ctx=i?i(e,t.props||{},(p,m,...g)=>{const v=g.length?g[0]:m;return c.ctx&&s(c.ctx[p],c.ctx[p]=v)&&(!c.skip_bound&&c.bound[p]&&c.bound[p](v),h&&HEe(e,p)),m}):[],c.update(),h=!0,L3(c.before_update),c.fragment=r?r(c.ctx):!1,t.target){if(t.hydrate){const p=zEe(t.target);c.fragment&&c.fragment.l(p),p.forEach(Np)}else c.fragment&&c.fragment.c();t.intro&&Ey(e.$$.fragment),Tk(e,t.target,t.anchor,t.customElement),rhe()}dM(l)}class Ck{$destroy(){Sk(this,1),this.$destroy=vx}$on(t,i){const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(i),()=>{const s=r.indexOf(i);s!==-1&&r.splice(s,1)}}$set(t){this.$$set&&!FEe(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const qEe=e=>{for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}};var Pg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ohe={exports:{}};/*!
* sweetalert2 v11.4.33
* Released under the MIT License.
*/(function(e,t){(function(i,r){e.exports=r()})(Pg,function(){var i={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const r="swal2-",s=R=>{const P={};for(const V in R)P[R[V]]=r+R[V];return P},n=s(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","no-war"]),o=s(["success","warning","info","question","error"]),a="SweetAlert2:",l=R=>{const P=[];for(let V=0;V<R.length;V++)P.indexOf(R[V])===-1&&P.push(R[V]);return P},c=R=>R.charAt(0).toUpperCase()+R.slice(1),h=R=>{console.warn("".concat(a," ").concat(typeof R=="object"?R.join(" "):R))},p=R=>{console.error("".concat(a," ").concat(R))},m=[],g=R=>{m.includes(R)||(m.push(R),h(R))},v=(R,P)=>{g('"'.concat(R,'" is deprecated and will be removed in the next major release. Please use "').concat(P,'" instead.'))},b=R=>typeof R=="function"?R():R,S=R=>R&&typeof R.toPromise=="function",T=R=>S(R)?R.toPromise():Promise.resolve(R),O=R=>R&&Promise.resolve(R)===R,C=R=>R[Math.floor(Math.random()*R.length)],M=()=>document.body.querySelector(".".concat(n.container)),I=R=>{const P=M();return P?P.querySelector(R):null},$=R=>I(".".concat(R)),U=()=>$(n.popup),q=()=>$(n.icon),G=()=>$(n.title),Y=()=>$(n["html-container"]),J=()=>$(n.image),X=()=>$(n["progress-steps"]),ne=()=>$(n["validation-message"]),re=()=>I(".".concat(n.actions," .").concat(n.confirm)),ye=()=>I(".".concat(n.actions," .").concat(n.deny)),pe=()=>$(n["input-label"]),z=()=>I(".".concat(n.loader)),j=()=>I(".".concat(n.actions," .").concat(n.cancel)),Q=()=>$(n.actions),Z=()=>$(n.footer),ie=()=>$(n["timer-progress-bar"]),le=()=>$(n.close),K=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,ae=()=>{const R=Array.from(U().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((V,oe)=>{const Ne=parseInt(V.getAttribute("tabindex")),Et=parseInt(oe.getAttribute("tabindex"));return Ne>Et?1:Ne<Et?-1:0}),P=Array.from(U().querySelectorAll(K)).filter(V=>V.getAttribute("tabindex")!=="-1");return l(R.concat(P)).filter(V=>Dr(V))},we=()=>$e(document.body,n.shown)&&!$e(document.body,n["toast-shown"])&&!$e(document.body,n["no-backdrop"]),Re=()=>U()&&$e(U(),n.toast),Ge=()=>U().hasAttribute("data-loading"),Pe={previousBodyPadding:null},Se=(R,P)=>{if(R.textContent="",P){const oe=new DOMParser().parseFromString(P,"text/html");Array.from(oe.querySelector("head").childNodes).forEach(Ne=>{R.appendChild(Ne)}),Array.from(oe.querySelector("body").childNodes).forEach(Ne=>{R.appendChild(Ne)})}},$e=(R,P)=>{if(!P)return!1;const V=P.split(/\s+/);for(let oe=0;oe<V.length;oe++)if(!R.classList.contains(V[oe]))return!1;return!0},qe=(R,P)=>{Array.from(R.classList).forEach(V=>{!Object.values(n).includes(V)&&!Object.values(o).includes(V)&&!Object.values(P.showClass).includes(V)&&R.classList.remove(V)})},jt=(R,P,V)=>{if(qe(R,P),P.customClass&&P.customClass[V]){if(typeof P.customClass[V]!="string"&&!P.customClass[V].forEach)return h("Invalid type of customClass.".concat(V,'! Expected string or iterable object, got "').concat(typeof P.customClass[V],'"'));ct(R,P.customClass[V])}},Ti=(R,P)=>{if(!P)return null;switch(P){case"select":case"textarea":case"file":return R.querySelector(".".concat(n.popup," > .").concat(n[P]));case"checkbox":return R.querySelector(".".concat(n.popup," > .").concat(n.checkbox," input"));case"radio":return R.querySelector(".".concat(n.popup," > .").concat(n.radio," input:checked"))||R.querySelector(".".concat(n.popup," > .").concat(n.radio," input:first-child"));case"range":return R.querySelector(".".concat(n.popup," > .").concat(n.range," input"));default:return R.querySelector(".".concat(n.popup," > .").concat(n.input))}},li=R=>{if(R.focus(),R.type!=="file"){const P=R.value;R.value="",R.value=P}},Pi=(R,P,V)=>{!R||!P||(typeof P=="string"&&(P=P.split(/\s+/).filter(Boolean)),P.forEach(oe=>{Array.isArray(R)?R.forEach(Ne=>{V?Ne.classList.add(oe):Ne.classList.remove(oe)}):V?R.classList.add(oe):R.classList.remove(oe)}))},ct=(R,P)=>{Pi(R,P,!0)},Kt=(R,P)=>{Pi(R,P,!1)},Fi=(R,P)=>{const V=Array.from(R.children);for(let oe=0;oe<V.length;oe++){const Ne=V[oe];if(Ne instanceof HTMLElement&&$e(Ne,P))return Ne}},pr=(R,P,V)=>{V==="".concat(parseInt(V))&&(V=parseInt(V)),V||parseInt(V)===0?R.style[P]=typeof V=="number"?"".concat(V,"px"):V:R.style.removeProperty(P)},Je=function(R){let P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"flex";R.style.display=P},ti=R=>{R.style.display="none"},Os=(R,P,V,oe)=>{const Ne=R.querySelector(P);Ne&&(Ne.style[V]=oe)},Zs=function(R,P){let V=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"flex";P?Je(R,V):ti(R)},Dr=R=>!!(R&&(R.offsetWidth||R.offsetHeight||R.getClientRects().length)),ml=()=>!Dr(re())&&!Dr(ye())&&!Dr(j()),Vo=R=>R.scrollHeight>R.clientHeight,gn=R=>{const P=window.getComputedStyle(R),V=parseFloat(P.getPropertyValue("animation-duration")||"0"),oe=parseFloat(P.getPropertyValue("transition-duration")||"0");return V>0||oe>0},ic=function(R){let P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const V=ie();Dr(V)&&(P&&(V.style.transition="none",V.style.width="100%"),setTimeout(()=>{V.style.transition="width ".concat(R/1e3,"s linear"),V.style.width="0%"},10))},R1=()=>{const R=ie(),P=parseInt(window.getComputedStyle(R).width);R.style.removeProperty("transition"),R.style.width="100%";const V=parseInt(window.getComputedStyle(R).width),oe=P/V*100;R.style.removeProperty("transition"),R.style.width="".concat(oe,"%")},g0=100,gi={},y0=()=>{gi.previousActiveElement instanceof HTMLElement?(gi.previousActiveElement.focus(),gi.previousActiveElement=null):document.body&&document.body.focus()},Jm=R=>new Promise(P=>{if(!R)return P();const V=window.scrollX,oe=window.scrollY;gi.restoreFocusTimeout=setTimeout(()=>{y0(),P()},g0),window.scrollTo(V,oe)}),Ad=()=>typeof window>"u"||typeof document>"u",_0=`
 <div aria-labelledby="`.concat(n.title,'" aria-describedby="').concat(n["html-container"],'" class="').concat(n.popup,`" tabindex="-1">
   <button type="button" class="`).concat(n.close,`"></button>
   <ul class="`).concat(n["progress-steps"],`"></ul>
   <div class="`).concat(n.icon,`"></div>
   <img class="`).concat(n.image,`" />
   <h2 class="`).concat(n.title,'" id="').concat(n.title,`"></h2>
   <div class="`).concat(n["html-container"],'" id="').concat(n["html-container"],`"></div>
   <input class="`).concat(n.input,`" />
   <input type="file" class="`).concat(n.file,`" />
   <div class="`).concat(n.range,`">
     <input type="range" />
     <output></output>
   </div>
   <select class="`).concat(n.select,`"></select>
   <div class="`).concat(n.radio,`"></div>
   <label for="`).concat(n.checkbox,'" class="').concat(n.checkbox,`">
     <input type="checkbox" />
     <span class="`).concat(n.label,`"></span>
   </label>
   <textarea class="`).concat(n.textarea,`"></textarea>
   <div class="`).concat(n["validation-message"],'" id="').concat(n["validation-message"],`"></div>
   <div class="`).concat(n.actions,`">
     <div class="`).concat(n.loader,`"></div>
     <button type="button" class="`).concat(n.confirm,`"></button>
     <button type="button" class="`).concat(n.deny,`"></button>
     <button type="button" class="`).concat(n.cancel,`"></button>
   </div>
   <div class="`).concat(n.footer,`"></div>
   <div class="`).concat(n["timer-progress-bar-container"],`">
     <div class="`).concat(n["timer-progress-bar"],`"></div>
   </div>
 </div>
`).replace(/(^|\n)\s*/g,""),M1=()=>{const R=M();return R?(R.remove(),Kt([document.documentElement,document.body],[n["no-backdrop"],n["toast-shown"],n["has-column"]]),!0):!1},ha=()=>{gi.currentInstance.resetValidationMessage()},P1=()=>{const R=U(),P=Fi(R,n.input),V=Fi(R,n.file),oe=R.querySelector(".".concat(n.range," input")),Ne=R.querySelector(".".concat(n.range," output")),Et=Fi(R,n.select),Ys=R.querySelector(".".concat(n.checkbox," input")),d=Fi(R,n.textarea);P.oninput=ha,V.onchange=ha,Et.onchange=ha,Ys.onchange=ha,d.oninput=ha,oe.oninput=()=>{ha(),Ne.value=oe.value},oe.onchange=()=>{ha(),Ne.value=oe.value}},Km=R=>typeof R=="string"?document.querySelector(R):R,eg=R=>{const P=U();P.setAttribute("role",R.toast?"alert":"dialog"),P.setAttribute("aria-live",R.toast?"polite":"assertive"),R.toast||P.setAttribute("aria-modal","true")},tg=R=>{window.getComputedStyle(R).direction==="rtl"&&ct(M(),n.rtl)},ig=R=>{const P=M1();if(Ad()){p("SweetAlert2 requires document to initialize");return}const V=document.createElement("div");V.className=n.container,P&&ct(V,n["no-transition"]),Se(V,_0);const oe=Km(R.target);oe.appendChild(V),eg(R),tg(oe),P1()},Si=(R,P)=>{R instanceof HTMLElement?P.appendChild(R):typeof R=="object"?kn(R,P):R&&Se(P,R)},kn=(R,P)=>{R.jquery?yn(P,R):Se(P,R.toString())},yn=(R,P)=>{if(R.textContent="",0 in P)for(let V=0;V in P;V++)R.appendChild(P[V].cloneNode(!0));else R.appendChild(P.cloneNode(!0))},_n=(()=>{if(Ad())return!1;const R=document.createElement("div"),P={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const V in P)if(Object.prototype.hasOwnProperty.call(P,V)&&typeof R.style[V]<"u")return P[V];return!1})(),Od=()=>{const R=document.createElement("div");R.className=n["scrollbar-measure"],document.body.appendChild(R);const P=R.getBoundingClientRect().width-R.clientWidth;return document.body.removeChild(R),P},v0=(R,P)=>{const V=Q(),oe=z();!P.showConfirmButton&&!P.showDenyButton&&!P.showCancelButton?ti(V):Je(V),jt(V,P,"actions"),ef(V,oe,P),Se(oe,P.loaderHtml),jt(oe,P,"loader")};function ef(R,P,V){const oe=re(),Ne=ye(),Et=j();tf(oe,"confirm",V),tf(Ne,"deny",V),tf(Et,"cancel",V),b0(oe,Ne,Et,V),V.reverseButtons&&(V.toast?(R.insertBefore(Et,oe),R.insertBefore(Ne,oe)):(R.insertBefore(Et,P),R.insertBefore(Ne,P),R.insertBefore(oe,P)))}function b0(R,P,V,oe){if(!oe.buttonsStyling)return Kt([R,P,V],n.styled);ct([R,P,V],n.styled),oe.confirmButtonColor&&(R.style.backgroundColor=oe.confirmButtonColor,ct(R,n["default-outline"])),oe.denyButtonColor&&(P.style.backgroundColor=oe.denyButtonColor,ct(P,n["default-outline"])),oe.cancelButtonColor&&(V.style.backgroundColor=oe.cancelButtonColor,ct(V,n["default-outline"]))}function tf(R,P,V){Zs(R,V["show".concat(c(P),"Button")],"inline-block"),Se(R,V["".concat(P,"ButtonText")]),R.setAttribute("aria-label",V["".concat(P,"ButtonAriaLabel")]),R.className=n[P],jt(R,V,"".concat(P,"Button")),ct(R,V["".concat(P,"ButtonClass")])}const Xs=(R,P)=>{const V=le();Se(V,P.closeButtonHtml),jt(V,P,"closeButton"),Zs(V,P.showCloseButton),V.setAttribute("aria-label",P.closeButtonAriaLabel)},de=(R,P)=>{const V=M();!V||(fr(V,P.backdrop),Rd(V,P.position),da(V,P.grow),jt(V,P,"container"))};function fr(R,P){typeof P=="string"?R.style.background=P:P||ct([document.documentElement,document.body],n["no-backdrop"])}function Rd(R,P){P in n?ct(R,n[P]):(h('The "position" parameter is not valid, defaulting to "center"'),ct(R,n.center))}function da(R,P){if(P&&typeof P=="string"){const V="grow-".concat(P);V in n&&ct(R,n[V])}}const ch=["input","file","range","select","radio","checkbox","textarea"],vt=(R,P)=>{const V=U(),oe=i.innerParams.get(R),Ne=!oe||P.input!==oe.input;ch.forEach(Et=>{const Ys=Fi(V,n[Et]);hh(Et,P.inputAttributes),Ys.className=n[Et],Ne&&ti(Ys)}),P.input&&(Ne&&uh(P),w0(P))},uh=R=>{if(!Go[R.input])return p('Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "'.concat(R.input,'"'));const P=rg(R.input),V=Go[R.input](P,R);Je(P),setTimeout(()=>{li(V)})},Jr=R=>{for(let P=0;P<R.attributes.length;P++){const V=R.attributes[P].name;["type","value","style"].includes(V)||R.removeAttribute(V)}},hh=(R,P)=>{const V=Ti(U(),R);if(!!V){Jr(V);for(const oe in P)V.setAttribute(oe,P[oe])}},w0=R=>{const P=rg(R.input);typeof R.customClass=="object"&&ct(P,R.customClass.input)},pa=(R,P)=>{(!R.placeholder||P.inputPlaceholder)&&(R.placeholder=P.inputPlaceholder)},Qc=(R,P,V)=>{if(V.inputLabel){R.id=n.input;const oe=document.createElement("label"),Ne=n["input-label"];oe.setAttribute("for",R.id),oe.className=Ne,typeof V.customClass=="object"&&ct(oe,V.customClass.inputLabel),oe.innerText=V.inputLabel,P.insertAdjacentElement("beforebegin",oe)}},rg=R=>Fi(U(),n[R]||n.input),Zt=(R,P)=>{["string","number"].includes(typeof P)?R.value="".concat(P):O(P)||h('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(typeof P,'"'))},Go={};Go.text=Go.email=Go.password=Go.number=Go.tel=Go.url=(R,P)=>(Zt(R,P.inputValue),Qc(R,R,P),pa(R,P),R.type=P.input,R),Go.file=(R,P)=>(Qc(R,R,P),pa(R,P),R),Go.range=(R,P)=>{const V=R.querySelector("input"),oe=R.querySelector("output");return Zt(V,P.inputValue),V.type=P.input,Zt(oe,P.inputValue),Qc(V,R,P),R},Go.select=(R,P)=>{if(R.textContent="",P.inputPlaceholder){const V=document.createElement("option");Se(V,P.inputPlaceholder),V.value="",V.disabled=!0,V.selected=!0,R.appendChild(V)}return Qc(R,R,P),R},Go.radio=R=>(R.textContent="",R),Go.checkbox=(R,P)=>{const V=Ti(U(),"checkbox");V.value="1",V.id=n.checkbox,V.checked=Boolean(P.inputValue);const oe=R.querySelector("span");return Se(oe,P.inputPlaceholder),V},Go.textarea=(R,P)=>{Zt(R,P.inputValue),pa(R,P),Qc(R,R,P);const V=oe=>parseInt(window.getComputedStyle(oe).marginLeft)+parseInt(window.getComputedStyle(oe).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const oe=parseInt(window.getComputedStyle(U()).width),Ne=()=>{const Et=R.offsetWidth+V(R);Et>oe?U().style.width="".concat(Et,"px"):U().style.width=null};new MutationObserver(Ne).observe(R,{attributes:!0,attributeFilter:["style"]})}}),R};const sg=(R,P)=>{const V=Y();jt(V,P,"htmlContainer"),P.html?(Si(P.html,V),Je(V,"block")):P.text?(V.textContent=P.text,Je(V,"block")):ti(V),vt(R,P)},uA=(R,P)=>{const V=Z();Zs(V,P.footer),P.footer&&Si(P.footer,V),jt(V,P,"footer")},hA=(R,P)=>{const V=i.innerParams.get(R),oe=q();if(V&&P.icon===V.icon){rf(oe,P),x0(oe,P);return}if(!P.icon&&!P.iconHtml){ti(oe);return}if(P.icon&&Object.keys(o).indexOf(P.icon)===-1){p('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(P.icon,'"')),ti(oe);return}Je(oe),rf(oe,P),x0(oe,P),ct(oe,P.showClass.icon)},x0=(R,P)=>{for(const V in o)P.icon!==V&&Kt(R,o[V]);ct(R,o[P.icon]),L1(R,P),dA(),jt(R,P,"icon")},dA=()=>{const R=U(),P=window.getComputedStyle(R).getPropertyValue("background-color"),V=R.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let oe=0;oe<V.length;oe++)V[oe].style.backgroundColor=P},I1=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,Us=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,rf=(R,P)=>{let V=R.innerHTML,oe;P.iconHtml?oe=$1(P.iconHtml):P.icon==="success"?(oe=I1,V=V.replace(/ style=".*?"/g,"")):P.icon==="error"?oe=Us:oe=$1({question:"?",warning:"!",info:"i"}[P.icon]),V.trim()!==oe.trim()&&Se(R,oe)},L1=(R,P)=>{if(!!P.iconColor){R.style.color=P.iconColor,R.style.borderColor=P.iconColor;for(const V of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Os(R,V,"backgroundColor",P.iconColor);Os(R,".swal2-success-ring","borderColor",P.iconColor)}},$1=R=>'<div class="'.concat(n["icon-content"],'">').concat(R,"</div>"),ng=(R,P)=>{const V=J();if(!P.imageUrl)return ti(V);Je(V,""),V.setAttribute("src",P.imageUrl),V.setAttribute("alt",P.imageAlt),pr(V,"width",P.imageWidth),pr(V,"height",P.imageHeight),V.className=n.image,jt(V,P,"image")},ar=(R,P)=>{const V=M(),oe=U();P.toast?(pr(V,"width",P.width),oe.style.width="100%",oe.insertBefore(z(),q())):pr(oe,"width",P.width),pr(oe,"padding",P.padding),P.color&&(oe.style.color=P.color),P.background&&(oe.style.background=P.background),ti(ne()),ds(oe,P)},ds=(R,P)=>{R.className="".concat(n.popup," ").concat(Dr(R)?P.showClass.popup:""),P.toast?(ct([document.documentElement,document.body],n["toast-shown"]),ct(R,n.toast)):ct(R,n.modal),jt(R,P,"popup"),typeof P.customClass=="string"&&ct(R,P.customClass),P.icon&&ct(R,n["icon-".concat(P.icon)])},T0=(R,P)=>{const V=X();if(!P.progressSteps||P.progressSteps.length===0)return ti(V);Je(V),V.textContent="",P.currentProgressStep>=P.progressSteps.length&&h("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),P.progressSteps.forEach((oe,Ne)=>{const Et=Un(oe);if(V.appendChild(Et),Ne===P.currentProgressStep&&ct(Et,n["active-progress-step"]),Ne!==P.progressSteps.length-1){const Ys=sf(P);V.appendChild(Ys)}})},Un=R=>{const P=document.createElement("li");return ct(P,n["progress-step"]),Se(P,R),P},sf=R=>{const P=document.createElement("li");return ct(P,n["progress-step-line"]),R.progressStepsDistance&&pr(P,"width",R.progressStepsDistance),P},D1=(R,P)=>{const V=G();Zs(V,P.title||P.titleText,"block"),P.title&&Si(P.title,V),P.titleText&&(V.innerText=P.titleText),jt(V,P,"title")},te=(R,P)=>{ar(R,P),de(R,P),T0(R,P),hA(R,P),ng(R,P),D1(R,P),Xs(R,P),sg(R,P),v0(R,P),uA(R,P),typeof P.didRender=="function"&&P.didRender(U())};function Ae(){const R=i.innerParams.get(this);if(!R)return;const P=i.domCache.get(this);ti(P.loader),Re()?R.icon&&Je(q()):Ve(P),Kt([P.popup,P.actions],n.loading),P.popup.removeAttribute("aria-busy"),P.popup.removeAttribute("data-loading"),P.confirmButton.disabled=!1,P.denyButton.disabled=!1,P.cancelButton.disabled=!1}const Ve=R=>{const P=R.popup.getElementsByClassName(R.loader.getAttribute("data-button-to-replace"));P.length?Je(P[0],"inline-block"):ml()&&ti(R.actions)};function ci(R){const P=i.innerParams.get(R||this),V=i.domCache.get(R||this);return V?Ti(V.popup,P.input):null}const Nr=()=>Dr(U()),is=()=>re()&&re().click(),mo=()=>ye()&&ye().click(),rc=()=>j()&&j().click(),ps=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),nf=R=>{R.keydownTarget&&R.keydownHandlerAdded&&(R.keydownTarget.removeEventListener("keydown",R.keydownHandler,{capture:R.keydownListenerCapture}),R.keydownHandlerAdded=!1)},N1=(R,P,V,oe)=>{nf(P),V.toast||(P.keydownHandler=Ne=>pA(R,Ne,oe),P.keydownTarget=V.keydownListenerCapture?window:U(),P.keydownListenerCapture=V.keydownListenerCapture,P.keydownTarget.addEventListener("keydown",P.keydownHandler,{capture:P.keydownListenerCapture}),P.keydownHandlerAdded=!0)},og=(R,P,V)=>{const oe=ae();if(oe.length)return P=P+V,P===oe.length?P=0:P===-1&&(P=oe.length-1),oe[P].focus();U().focus()},ST=["ArrowRight","ArrowDown"],F1=["ArrowLeft","ArrowUp"],pA=(R,P,V)=>{const oe=i.innerParams.get(R);!oe||P.isComposing||P.keyCode===229||(oe.stopKeydownPropagation&&P.stopPropagation(),P.key==="Enter"?fA(R,P,oe):P.key==="Tab"?ET(P,oe):[...ST,...F1].includes(P.key)?mA(P.key):P.key==="Escape"&&gA(P,oe,V))},fA=(R,P,V)=>{if(!!b(V.allowEnterKey)&&P.target&&R.getInput()&&P.target instanceof HTMLElement&&P.target.outerHTML===R.getInput().outerHTML){if(["textarea","file"].includes(V.input))return;is(),P.preventDefault()}},ET=(R,P)=>{const V=R.target,oe=ae();let Ne=-1;for(let Et=0;Et<oe.length;Et++)if(V===oe[Et]){Ne=Et;break}R.shiftKey?og(P,Ne,-1):og(P,Ne,1),R.stopPropagation(),R.preventDefault()},mA=R=>{const P=re(),V=ye(),oe=j();if(document.activeElement instanceof HTMLElement&&![P,V,oe].includes(document.activeElement))return;const Ne=ST.includes(R)?"nextElementSibling":"previousElementSibling";let Et=document.activeElement;for(let Ys=0;Ys<Q().children.length;Ys++){if(Et=Et[Ne],!Et)return;if(Et instanceof HTMLButtonElement&&Dr(Et))break}Et instanceof HTMLButtonElement&&Et.focus()},gA=(R,P,V)=>{b(P.allowEscapeKey)&&(R.preventDefault(),V(ps.esc))};var of={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const MI=()=>{Array.from(document.body.children).forEach(P=>{P===M()||P.contains(M())||(P.hasAttribute("aria-hidden")&&P.setAttribute("data-previous-aria-hidden",P.getAttribute("aria-hidden")),P.setAttribute("aria-hidden","true"))})},CT=()=>{Array.from(document.body.children).forEach(P=>{P.hasAttribute("data-previous-aria-hidden")?(P.setAttribute("aria-hidden",P.getAttribute("data-previous-aria-hidden")),P.removeAttribute("data-previous-aria-hidden")):P.removeAttribute("aria-hidden")})},bB=()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!$e(document.body,n.iosfix)){const P=document.body.scrollTop;document.body.style.top="".concat(P*-1,"px"),ct(document.body,n.iosfix),dh(),Oi()}},Oi=()=>{const R=navigator.userAgent,P=!!R.match(/iPad/i)||!!R.match(/iPhone/i),V=!!R.match(/WebKit/i);P&&V&&!R.match(/CriOS/i)&&U().scrollHeight>window.innerHeight-44&&(M().style.paddingBottom="".concat(44,"px"))},dh=()=>{const R=M();let P;R.ontouchstart=V=>{P=rs(V)},R.ontouchmove=V=>{P&&(V.preventDefault(),V.stopPropagation())}},rs=R=>{const P=R.target,V=M();return PI(R)||yA(R)?!1:P===V||!Vo(V)&&P instanceof HTMLElement&&P.tagName!=="INPUT"&&P.tagName!=="TEXTAREA"&&!(Vo(Y())&&Y().contains(P))},PI=R=>R.touches&&R.touches.length&&R.touches[0].touchType==="stylus",yA=R=>R.touches&&R.touches.length>1,_A=()=>{if($e(document.body,n.iosfix)){const R=parseInt(document.body.style.top,10);Kt(document.body,n.iosfix),document.body.style.top="",document.body.scrollTop=R*-1}},vA=()=>{Pe.previousBodyPadding===null&&document.body.scrollHeight>window.innerHeight&&(Pe.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(Pe.previousBodyPadding+Od(),"px"))},ag=()=>{Pe.previousBodyPadding!==null&&(document.body.style.paddingRight="".concat(Pe.previousBodyPadding,"px"),Pe.previousBodyPadding=null)};function AT(R,P,V,oe){Re()?er(R,oe):(Jm(V).then(()=>er(R,oe)),nf(gi)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(P.setAttribute("style","display:none !important"),P.removeAttribute("class"),P.innerHTML=""):P.remove(),we()&&(ag(),_A(),CT()),k1()}function k1(){Kt([document.documentElement,document.body],[n.shown,n["height-auto"],n["no-backdrop"],n["toast-shown"]])}function zn(R){R=bA(R);const P=of.swalPromiseResolve.get(this),V=II(this);this.isAwaitingPromise()?R.isDismissed||(S0(this),P(R)):V&&P(R)}function lg(){return!!i.awaitingPromise.get(this)}const II=R=>{const P=U();if(!P)return!1;const V=i.innerParams.get(R);if(!V||$e(P,V.hideClass.popup))return!1;Kt(P,V.showClass.popup),ct(P,V.hideClass.popup);const oe=M();return Kt(oe,V.showClass.backdrop),ct(oe,V.hideClass.backdrop),xB(R,P,V),!0};function wB(R){const P=of.swalPromiseReject.get(this);S0(this),P&&P(R)}const S0=R=>{R.isAwaitingPromise()&&(i.awaitingPromise.delete(R),i.innerParams.get(R)||R._destroy())},bA=R=>typeof R>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},R),xB=(R,P,V)=>{const oe=M(),Ne=_n&&gn(P);typeof V.willClose=="function"&&V.willClose(P),Ne?LI(R,P,oe,V.returnFocus,V.didClose):AT(R,oe,V.returnFocus,V.didClose)},LI=(R,P,V,oe,Ne)=>{gi.swalCloseEventFinishedCallback=AT.bind(null,R,V,oe,Ne),P.addEventListener(_n,function(Et){Et.target===P&&(gi.swalCloseEventFinishedCallback(),delete gi.swalCloseEventFinishedCallback)})},er=(R,P)=>{setTimeout(()=>{typeof P=="function"&&P.bind(R.params)(),R._destroy()})};function $I(R,P,V){const oe=i.domCache.get(R);P.forEach(Ne=>{oe[Ne].disabled=V})}function sc(R,P){if(!!R)if(R.type==="radio"){const oe=R.parentNode.parentNode.querySelectorAll("input");for(let Ne=0;Ne<oe.length;Ne++)oe[Ne].disabled=P}else R.disabled=P}function U1(){$I(this,["confirmButton","denyButton","cancelButton"],!1)}function DI(){$I(this,["confirmButton","denyButton","cancelButton"],!0)}function TB(){sc(this.getInput(),!1)}function wA(){sc(this.getInput(),!0)}function SB(R){const P=i.domCache.get(this),V=i.innerParams.get(this);Se(P.validationMessage,R),P.validationMessage.className=n["validation-message"],V.customClass&&V.customClass.validationMessage&&ct(P.validationMessage,V.customClass.validationMessage),Je(P.validationMessage);const oe=this.getInput();oe&&(oe.setAttribute("aria-invalid",!0),oe.setAttribute("aria-describedby",n["validation-message"]),li(oe),ct(oe,n.inputerror))}function NI(){const R=i.domCache.get(this);R.validationMessage&&ti(R.validationMessage);const P=this.getInput();P&&(P.removeAttribute("aria-invalid"),P.removeAttribute("aria-describedby"),Kt(P,n.inputerror))}function EB(){return i.domCache.get(this).progressSteps}const E0={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},xA=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],CB={},ph=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],FI=R=>Object.prototype.hasOwnProperty.call(E0,R),TA=R=>xA.indexOf(R)!==-1,fh=R=>CB[R],kI=R=>{FI(R)||h('Unknown parameter "'.concat(R,'"'))},UI=R=>{ph.includes(R)&&h('The parameter "'.concat(R,'" is incompatible with toasts'))},AB=R=>{fh(R)&&v(R,fh(R))},OB=R=>{!R.backdrop&&R.allowOutsideClick&&h('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const P in R)kI(P),R.toast&&UI(P),AB(P)};function SA(R){const P=U(),V=i.innerParams.get(this);if(!P||$e(P,V.hideClass.popup))return h("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const oe=RB(R),Ne=Object.assign({},V,oe);te(this,Ne),i.innerParams.set(this,Ne),Object.defineProperties(this,{params:{value:Object.assign({},this.params,R),writable:!1,enumerable:!0}})}const RB=R=>{const P={};return Object.keys(R).forEach(V=>{TA(V)?P[V]=R[V]:h("Invalid parameter to update: ".concat(V))}),P};function zI(){const R=i.domCache.get(this),P=i.innerParams.get(this);if(!P){z1(this);return}R.popup&&gi.swalCloseEventFinishedCallback&&(gi.swalCloseEventFinishedCallback(),delete gi.swalCloseEventFinishedCallback),typeof P.didDestroy=="function"&&P.didDestroy(),BI(this)}const BI=R=>{z1(R),delete R.params,delete gi.keydownHandler,delete gi.keydownTarget,delete gi.currentInstance},z1=R=>{R.isAwaitingPromise()?(Md(i,R),i.awaitingPromise.set(R,!0)):(Md(of,R),Md(i,R))},Md=(R,P)=>{for(const V in R)R[V].delete(P)};var VI=Object.freeze({hideLoading:Ae,disableLoading:Ae,getInput:ci,close:zn,isAwaitingPromise:lg,rejectPromise:wB,handleAwaitingPromise:S0,closePopup:zn,closeModal:zn,closeToast:zn,enableButtons:U1,disableButtons:DI,enableInput:TB,disableInput:wA,showValidationMessage:SB,resetValidationMessage:NI,getProgressSteps:EB,update:SA,_destroy:zI});const mh=R=>{let P=U();P||new V1,P=U();const V=z();Re()?ti(q()):Pd(P,R),Je(V),P.setAttribute("data-loading","true"),P.setAttribute("aria-busy","true"),P.focus()},Pd=(R,P)=>{const V=Q(),oe=z();!P&&Dr(re())&&(P=re()),Je(V),P&&(ti(P),oe.setAttribute("data-button-to-replace",P.className)),oe.parentNode.insertBefore(oe,P),ct([R,V],n.loading)},GI=(R,P)=>{P.input==="select"||P.input==="radio"?CA(R,P):["text","email","number","tel","textarea"].includes(P.input)&&(S(P.inputValue)||O(P.inputValue))&&(mh(re()),IB(R,P))},MB=(R,P)=>{const V=R.getInput();if(!V)return null;switch(P.input){case"checkbox":return jI(V);case"radio":return PB(V);case"file":return EA(V);default:return P.inputAutoTrim?V.value.trim():V.value}},jI=R=>R.checked?1:0,PB=R=>R.checked?R.value:null,EA=R=>R.files.length?R.getAttribute("multiple")!==null?R.files:R.files[0]:null,CA=(R,P)=>{const V=U(),oe=Ne=>LB[P.input](V,OT(Ne),P);S(P.inputOptions)||O(P.inputOptions)?(mh(re()),T(P.inputOptions).then(Ne=>{R.hideLoading(),oe(Ne)})):typeof P.inputOptions=="object"?oe(P.inputOptions):p("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(typeof P.inputOptions))},IB=(R,P)=>{const V=R.getInput();ti(V),T(P.inputValue).then(oe=>{V.value=P.input==="number"?parseFloat(oe)||0:"".concat(oe),Je(V),V.focus(),R.hideLoading()}).catch(oe=>{p("Error in inputValue promise: ".concat(oe)),V.value="",Je(V),V.focus(),R.hideLoading()})},LB={select:(R,P,V)=>{const oe=Fi(R,n.select),Ne=(Et,Ys,d)=>{const y=document.createElement("option");y.value=d,Se(y,Ys),y.selected=HI(d,V.inputValue),Et.appendChild(y)};P.forEach(Et=>{const Ys=Et[0],d=Et[1];if(Array.isArray(d)){const y=document.createElement("optgroup");y.label=Ys,y.disabled=!1,oe.appendChild(y),d.forEach(x=>Ne(y,x[1],x[0]))}else Ne(oe,d,Ys)}),oe.focus()},radio:(R,P,V)=>{const oe=Fi(R,n.radio);P.forEach(Et=>{const Ys=Et[0],d=Et[1],y=document.createElement("input"),x=document.createElement("label");y.type="radio",y.name=n.radio,y.value=Ys,HI(Ys,V.inputValue)&&(y.checked=!0);const A=document.createElement("span");Se(A,d),A.className=n.label,x.appendChild(y),x.appendChild(A),oe.appendChild(x)});const Ne=oe.querySelectorAll("input");Ne.length&&Ne[0].focus()}},OT=R=>{const P=[];return typeof Map<"u"&&R instanceof Map?R.forEach((V,oe)=>{let Ne=V;typeof Ne=="object"&&(Ne=OT(Ne)),P.push([oe,Ne])}):Object.keys(R).forEach(V=>{let oe=R[V];typeof oe=="object"&&(oe=OT(oe)),P.push([V,oe])}),P},HI=(R,P)=>P&&P.toString()===R.toString(),Jc=R=>{const P=i.innerParams.get(R);R.disableButtons(),P.input?cg(R,"confirm"):RT(R,!0)},C0=R=>{const P=i.innerParams.get(R);R.disableButtons(),P.returnInputValueOnDeny?cg(R,"deny"):af(R,!1)},$B=(R,P)=>{R.disableButtons(),P(ps.cancel)},cg=(R,P)=>{const V=i.innerParams.get(R);if(!V.input){p('The "input" parameter is needed to be set when using returnInputValueOn'.concat(c(P)));return}const oe=MB(R,V);V.inputValidator?DB(R,oe,P):R.getInput().checkValidity()?P==="deny"?af(R,oe):RT(R,oe):(R.enableButtons(),R.showValidationMessage(V.validationMessage))},DB=(R,P,V)=>{const oe=i.innerParams.get(R);R.disableInput(),Promise.resolve().then(()=>T(oe.inputValidator(P,oe.validationMessage))).then(Et=>{R.enableButtons(),R.enableInput(),Et?R.showValidationMessage(Et):V==="deny"?af(R,P):RT(R,P)})},af=(R,P)=>{const V=i.innerParams.get(R||void 0);V.showLoaderOnDeny&&mh(ye()),V.preDeny?(i.awaitingPromise.set(R||void 0,!0),Promise.resolve().then(()=>T(V.preDeny(P,V.validationMessage))).then(Ne=>{Ne===!1?(R.hideLoading(),S0(R)):R.close({isDenied:!0,value:typeof Ne>"u"?P:Ne})}).catch(Ne=>A0(R||void 0,Ne))):R.close({isDenied:!0,value:P})},qI=(R,P)=>{R.close({isConfirmed:!0,value:P})},A0=(R,P)=>{R.rejectPromise(P)},RT=(R,P)=>{const V=i.innerParams.get(R||void 0);V.showLoaderOnConfirm&&mh(),V.preConfirm?(R.resetValidationMessage(),i.awaitingPromise.set(R||void 0,!0),Promise.resolve().then(()=>T(V.preConfirm(P,V.validationMessage))).then(Ne=>{Dr(ne())||Ne===!1?(R.hideLoading(),S0(R)):qI(R,typeof Ne>"u"?P:Ne)}).catch(Ne=>A0(R||void 0,Ne))):qI(R,P)},MT=(R,P,V)=>{i.innerParams.get(R).toast?NB(R,P,V):(FB(P),AA(P),kB(R,P,V))},NB=(R,P,V)=>{P.popup.onclick=()=>{const oe=i.innerParams.get(R);oe&&(lf(oe)||oe.timer||oe.input)||V(ps.close)}},lf=R=>R.showConfirmButton||R.showDenyButton||R.showCancelButton||R.showCloseButton;let ug=!1;const FB=R=>{R.popup.onmousedown=()=>{R.container.onmouseup=function(P){R.container.onmouseup=void 0,P.target===R.container&&(ug=!0)}}},AA=R=>{R.container.onmousedown=()=>{R.popup.onmouseup=function(P){R.popup.onmouseup=void 0,(P.target===R.popup||R.popup.contains(P.target))&&(ug=!0)}}},kB=(R,P,V)=>{P.container.onclick=oe=>{const Ne=i.innerParams.get(R);if(ug){ug=!1;return}oe.target===P.container&&b(Ne.allowOutsideClick)&&V(ps.backdrop)}},Id=R=>typeof R=="object"&&R.jquery,WI=R=>R instanceof Element||Id(R),O0=R=>{const P={};return typeof R[0]=="object"&&!WI(R[0])?Object.assign(P,R[0]):["title","html","icon"].forEach((V,oe)=>{const Ne=R[oe];typeof Ne=="string"||WI(Ne)?P[V]=Ne:Ne!==void 0&&p("Unexpected type of ".concat(V,'! Expected "string" or "Element", got ').concat(typeof Ne))}),P};function UB(){const R=this;for(var P=arguments.length,V=new Array(P),oe=0;oe<P;oe++)V[oe]=arguments[oe];return new R(...V)}function Ld(R){class P extends this{_main(oe,Ne){return super._main(oe,Object.assign({},R,Ne))}}return P}const OA=()=>gi.timeout&&gi.timeout.getTimerLeft(),RA=()=>{if(gi.timeout)return R1(),gi.timeout.stop()},PT=()=>{if(gi.timeout){const R=gi.timeout.start();return ic(R),R}},IT=()=>{const R=gi.timeout;return R&&(R.running?RA():PT())},MA=R=>{if(gi.timeout){const P=gi.timeout.increase(R);return ic(P,!0),P}},LT=()=>gi.timeout&&gi.timeout.isRunning();let hg=!1;const R0={};function PA(){let R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"data-swal-template";R0[R]=this,hg||(document.body.addEventListener("click",ZI),hg=!0)}const ZI=R=>{for(let P=R.target;P&&P!==document;P=P.parentNode)for(const V in R0){const oe=P.getAttribute(V);if(oe){R0[V].fire({template:oe});return}}};var zB=Object.freeze({isValidParameter:FI,isUpdatableParameter:TA,isDeprecatedParameter:fh,argsToParams:O0,isVisible:Nr,clickConfirm:is,clickDeny:mo,clickCancel:rc,getContainer:M,getPopup:U,getTitle:G,getHtmlContainer:Y,getImage:J,getIcon:q,getInputLabel:pe,getCloseButton:le,getActions:Q,getConfirmButton:re,getDenyButton:ye,getCancelButton:j,getLoader:z,getFooter:Z,getTimerProgressBar:ie,getFocusableElements:ae,getValidationMessage:ne,isLoading:Ge,fire:UB,mixin:Ld,showLoading:mh,enableLoading:mh,getTimerLeft:OA,stopTimer:RA,resumeTimer:PT,toggleTimer:IT,increaseTimer:MA,isTimerRunning:LT,bindClickHandler:PA});class $T{constructor(P,V){this.callback=P,this.remaining=V,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(P){const V=this.running;return V&&this.stop(),this.remaining+=P,V&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const XI=["swal-title","swal-html","swal-footer"],YI=R=>{const P=typeof R.template=="string"?document.querySelector(R.template):R.template;if(!P)return{};const V=P.content;return NT(V),Object.assign(BB(V),QI(V),VB(V),gh(V),DT(V),GB(V,XI))},BB=R=>{const P={};return Array.from(R.querySelectorAll("swal-param")).forEach(oe=>{dg(oe,["name","value"]);const Ne=oe.getAttribute("name"),Et=oe.getAttribute("value");typeof E0[Ne]=="boolean"&&Et==="false"&&(P[Ne]=!1),typeof E0[Ne]=="object"&&(P[Ne]=JSON.parse(Et))}),P},QI=R=>{const P={};return Array.from(R.querySelectorAll("swal-button")).forEach(oe=>{dg(oe,["type","color","aria-label"]);const Ne=oe.getAttribute("type");P["".concat(Ne,"ButtonText")]=oe.innerHTML,P["show".concat(c(Ne),"Button")]=!0,oe.hasAttribute("color")&&(P["".concat(Ne,"ButtonColor")]=oe.getAttribute("color")),oe.hasAttribute("aria-label")&&(P["".concat(Ne,"ButtonAriaLabel")]=oe.getAttribute("aria-label"))}),P},VB=R=>{const P={},V=R.querySelector("swal-image");return V&&(dg(V,["src","width","height","alt"]),V.hasAttribute("src")&&(P.imageUrl=V.getAttribute("src")),V.hasAttribute("width")&&(P.imageWidth=V.getAttribute("width")),V.hasAttribute("height")&&(P.imageHeight=V.getAttribute("height")),V.hasAttribute("alt")&&(P.imageAlt=V.getAttribute("alt"))),P},gh=R=>{const P={},V=R.querySelector("swal-icon");return V&&(dg(V,["type","color"]),V.hasAttribute("type")&&(P.icon=V.getAttribute("type")),V.hasAttribute("color")&&(P.iconColor=V.getAttribute("color")),P.iconHtml=V.innerHTML),P},DT=R=>{const P={},V=R.querySelector("swal-input");V&&(dg(V,["type","label","placeholder","value"]),P.input=V.getAttribute("type")||"text",V.hasAttribute("label")&&(P.inputLabel=V.getAttribute("label")),V.hasAttribute("placeholder")&&(P.inputPlaceholder=V.getAttribute("placeholder")),V.hasAttribute("value")&&(P.inputValue=V.getAttribute("value")));const oe=Array.from(R.querySelectorAll("swal-input-option"));return oe.length&&(P.inputOptions={},oe.forEach(Ne=>{dg(Ne,["value"]);const Et=Ne.getAttribute("value"),Ys=Ne.innerHTML;P.inputOptions[Et]=Ys})),P},GB=(R,P)=>{const V={};for(const oe in P){const Ne=P[oe],Et=R.querySelector(Ne);Et&&(dg(Et,[]),V[Ne.replace(/^swal-/,"")]=Et.innerHTML.trim())}return V},NT=R=>{const P=XI.concat(["swal-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(R.children).forEach(V=>{const oe=V.tagName.toLowerCase();P.includes(oe)||h("Unrecognized element <".concat(oe,">"))})},dg=(R,P)=>{Array.from(R.attributes).forEach(V=>{P.indexOf(V.name)===-1&&h(['Unrecognized attribute "'.concat(V.name,'" on <').concat(R.tagName.toLowerCase(),">."),"".concat(P.length?"Allowed attributes are: ".concat(P.join(", ")):"To set the value, use HTML within the element.")])})},IA=10,jB=R=>{const P=M(),V=U();typeof R.willOpen=="function"&&R.willOpen(V);const Ne=window.getComputedStyle(document.body).overflowY;JI(P,V,R),setTimeout(()=>{HB(P,V)},IA),we()&&(P0(P,R.scrollbarPadding,Ne),MI()),!Re()&&!gi.previousActiveElement&&(gi.previousActiveElement=document.activeElement),typeof R.didOpen=="function"&&setTimeout(()=>R.didOpen(V)),Kt(P,n["no-transition"])},M0=R=>{const P=U();if(R.target!==P)return;const V=M();P.removeEventListener(_n,M0),V.style.overflowY="auto"},HB=(R,P)=>{_n&&gn(P)?(R.style.overflowY="hidden",P.addEventListener(_n,M0)):R.style.overflowY="auto"},P0=(R,P,V)=>{bB(),P&&V!=="hidden"&&vA(),setTimeout(()=>{R.scrollTop=0})},JI=(R,P,V)=>{ct(R,V.showClass.backdrop),P.style.setProperty("opacity","0","important"),Je(P,"grid"),setTimeout(()=>{ct(P,V.showClass.popup),P.style.removeProperty("opacity")},IA),ct([document.documentElement,document.body],n.shown),V.heightAuto&&V.backdrop&&!V.toast&&ct([document.documentElement,document.body],n["height-auto"])};var LA={email:(R,P)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(R)?Promise.resolve():Promise.resolve(P||"Invalid email address"),url:(R,P)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(R)?Promise.resolve():Promise.resolve(P||"Invalid URL")};function qB(R){R.inputValidator||Object.keys(LA).forEach(P=>{R.input===P&&(R.inputValidator=LA[P])})}function $d(R){(!R.target||typeof R.target=="string"&&!document.querySelector(R.target)||typeof R.target!="string"&&!R.target.appendChild)&&(h('Target parameter is not valid, defaulting to "body"'),R.target="body")}function KI(R){qB(R),R.showLoaderOnConfirm&&!R.preConfirm&&h(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),$d(R),typeof R.title=="string"&&(R.title=R.title.split(`
`).join("<br />")),ig(R)}let Kc;class yh{constructor(){if(typeof window>"u")return;Kc=this;for(var P=arguments.length,V=new Array(P),oe=0;oe<P;oe++)V[oe]=arguments[oe];const Ne=Object.freeze(this.constructor.argsToParams(V));Object.defineProperties(this,{params:{value:Ne,writable:!1,enumerable:!0,configurable:!0}});const Et=Kc._main(Kc.params);i.promise.set(this,Et)}_main(P){let V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};OB(Object.assign({},V,P)),gi.currentInstance&&(gi.currentInstance._destroy(),we()&&CT()),gi.currentInstance=Kc;const oe=FT(P,V);KI(oe),Object.freeze(oe),gi.timeout&&(gi.timeout.stop(),delete gi.timeout),clearTimeout(gi.restoreFocusTimeout);const Ne=B1(Kc);return te(Kc,oe),i.innerParams.set(Kc,oe),WB(Kc,Ne,oe)}then(P){return i.promise.get(this).then(P)}finally(P){return i.promise.get(this).finally(P)}}const WB=(R,P,V)=>new Promise((oe,Ne)=>{const Et=Ys=>{R.close({isDismissed:!0,dismiss:Ys})};of.swalPromiseResolve.set(R,oe),of.swalPromiseReject.set(R,Ne),P.confirmButton.onclick=()=>{Jc(R)},P.denyButton.onclick=()=>{C0(R)},P.cancelButton.onclick=()=>{$B(R,Et)},P.closeButton.onclick=()=>{Et(ps.close)},MT(R,P,Et),N1(R,gi,V,Et),GI(R,V),jB(V),eL(gi,V,Et),tL(P,V),setTimeout(()=>{P.container.scrollTop=0})}),FT=(R,P)=>{const V=YI(R),oe=Object.assign({},E0,P,V,R);return oe.showClass=Object.assign({},E0.showClass,oe.showClass),oe.hideClass=Object.assign({},E0.hideClass,oe.hideClass),oe},B1=R=>{const P={popup:U(),container:M(),actions:Q(),confirmButton:re(),denyButton:ye(),cancelButton:j(),loader:z(),closeButton:le(),validationMessage:ne(),progressSteps:X()};return i.domCache.set(R,P),P},eL=(R,P,V)=>{const oe=ie();ti(oe),P.timer&&(R.timeout=new $T(()=>{V("timer"),delete R.timeout},P.timer),P.timerProgressBar&&(Je(oe),jt(oe,P,"timerProgressBar"),setTimeout(()=>{R.timeout&&R.timeout.running&&ic(P.timer)})))},tL=(R,P)=>{if(!P.toast){if(!b(P.allowEnterKey)){iL();return}ZB(R,P)||og(P,-1,1)}},ZB=(R,P)=>P.focusDeny&&Dr(R.denyButton)?(R.denyButton.focus(),!0):P.focusCancel&&Dr(R.cancelButton)?(R.cancelButton.focus(),!0):P.focusConfirm&&Dr(R.confirmButton)?(R.confirmButton.focus(),!0):!1,iL=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|xn--p1ai)$/)&&Math.random()<.1){const R=document.createElement("div");R.className="leave-russia-now-and-apply-your-skills-to-the-world";const P=C([{text:`\u0412 \u043D\u0438\u0436\u0435\u043F\u0440\u0438\u0432\u0435\u0434\u0451\u043D\u043D\u043E\u043C \u0432\u0438\u0434\u0435\u043E \u043E\u0431\u044A\u044F\u0441\u043D\u044F\u0435\u0442\u0441\u044F \u043A\u0430\u043A \u043A\u0430\u0436\u0434\u044B\u0439 \u0438\u0437 \u043D\u0430\u0441 \u043C\u043E\u0436\u0435\u0442 \u043F\u043E\u043C\u043E\u0447\u044C \u0432 \u0442\u043E\u043C,
        <strong>\u0447\u0442\u043E\u0431\u044B \u044D\u0442\u0430 \u0431\u0435\u0441\u0441\u043C\u044B\u0441\u043B\u0435\u043D\u043D\u0430\u044F \u0438 \u0431\u0435\u0441\u0447\u0435\u043B\u043E\u0432\u0435\u0447\u043D\u0430\u044F \u0432\u043E\u0439\u043D\u0430 \u043E\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u043B\u0430\u0441\u044C</strong>:`,id:"4CfDhaRkw7I"},{text:"\u042D\u043C\u043F\u0430\u0442\u0438\u044F - \u0433\u043B\u0430\u0432\u043D\u043E\u0435 <strong>\u0447\u0435\u043B\u043E\u0432\u0435\u0447\u0435\u0441\u043A\u043E\u0435</strong> \u0447\u0443\u0432\u0441\u0442\u0432\u043E. \u0421\u043F\u043E\u0441\u043E\u0431\u043D\u043E\u0441\u0442\u044C \u0441\u043E\u043F\u0435\u0440\u0435\u0436\u0438\u0432\u0430\u0442\u044C. <strong>\u0421\u043F\u043E\u0441\u043E\u0431\u043D\u043E\u0441\u0442\u044C \u043F\u043E\u0441\u0442\u0430\u0432\u0438\u0442\u044C \u0441\u0435\u0431\u044F \u043D\u0430 \u043C\u0435\u0441\u0442\u043E \u0434\u0440\u0443\u0433\u043E\u0433\u043E.</strong>",id:"s-GLAIY4DXA"}]);Se(R,`
      <div>
        \u0415\u0441\u043B\u0438 \u043C\u044B \u043D\u0435 \u043E\u0441\u0442\u0430\u043D\u043E\u0432\u0438\u043C \u0432\u043E\u0439\u043D\u0443, \u043E\u043D\u0430 \u043F\u0440\u0438\u0434\u0435\u0442 \u0432 \u0434\u043E\u043C <strong>\u043A\u0430\u0436\u0434\u043E\u0433\u043E \u0438\u0437 \u043D\u0430\u0441</strong> \u0438 \u0435\u0451 \u043F\u043E\u0441\u043B\u0435\u0434\u0441\u0442\u0432\u0438\u044F \u0431\u0443\u0434\u0443\u0442 <strong>\u0443\u0436\u0430\u0441\u0430\u044E\u0449\u0438\u043C\u0438</strong>.
      </div>
      <div>
        \u041F\u0443\u0442\u0438\u043D\u0441\u043A\u0438\u0439 \u0440\u0435\u0436\u0438\u043C \u0437\u0430 20 \u0441 \u043B\u0438\u0448\u043D\u0438\u043C \u043B\u0435\u0442 \u0441\u0432\u043E\u0435\u0433\u043E \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u043E\u0432\u0430\u043D\u0438\u044F \u0432\u0434\u043E\u043B\u0431\u0438\u043B \u043D\u0430\u043C, \u0447\u0442\u043E \u043C\u044B \u0431\u0435\u0441\u0441\u0438\u043B\u044C\u043D\u044B \u0438 \u043E\u0434\u0438\u043D \u0447\u0435\u043B\u043E\u0432\u0435\u043A \u043D\u0435 \u043C\u043E\u0436\u0435\u0442 \u043D\u0438\u0447\u0435\u0433\u043E \u0441\u0434\u0435\u043B\u0430\u0442\u044C. <strong>\u042D\u0442\u043E \u043D\u0435 \u0442\u0430\u043A!</strong>
      </div>
      <div>
        `.concat(P.text,`
      </div>
      <iframe width="560" height="315" src="https://www.youtube.com/embed/`).concat(P.id,`" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      <div>
        \u041D\u0435\u0442 \u0432\u043E\u0439\u043D\u0435!
      </div>
      `));const V=document.createElement("button");V.innerHTML="&times;",V.onclick=()=>R.remove(),R.appendChild(V),window.addEventListener("load",()=>{setTimeout(()=>{document.body.appendChild(R)},1e3)})}Object.assign(yh.prototype,VI),Object.assign(yh,zB),Object.keys(VI).forEach(R=>{yh[R]=function(){if(Kc)return Kc[R](...arguments)}}),yh.DismissReason=ps,yh.version="11.4.33";const V1=yh;return V1.default=V1,V1}),typeof Pg<"u"&&Pg.Sweetalert2&&(Pg.swal=Pg.sweetAlert=Pg.Swal=Pg.SweetAlert=Pg.Sweetalert2),typeof document<"u"&&function(i,r){var s=i.createElement("style");if(i.getElementsByTagName("head")[0].appendChild(s),s.styleSheet)s.styleSheet.disabled||(s.styleSheet.cssText=r);else try{s.innerHTML=r}catch{s.innerText=r}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4!important;grid-row:1/4!important;grid-template-columns:1fr 99fr 1fr;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px hsla(0deg,0%,0%,.075),0 1px 2px hsla(0deg,0%,0%,.075),1px 2px 4px hsla(0deg,0%,0%,.075),1px 3px 8px hsla(0deg,0%,0%,.075),2px 4px 16px hsla(0deg,0%,0%,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:700}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.8em;left:-.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-toast-animate-success-line-tip .75s;animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-toast-animate-success-line-long .75s;animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{-webkit-animation:swal2-toast-show .5s;animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{-webkit-animation:swal2-toast-hide .1s forwards;animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;top:0;right:0;bottom:0;left:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto);grid-template-rows:minmax(min-content,auto) minmax(min-content,auto) minmax(min-content,auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:0 0!important}.swal2-container.swal2-bottom-start,.swal2-container.swal2-center-start,.swal2-container.swal2-top-start{grid-template-columns:minmax(0,1fr) auto auto}.swal2-container.swal2-bottom,.swal2-container.swal2-center,.swal2-container.swal2-top{grid-template-columns:auto minmax(0,1fr) auto}.swal2-container.swal2-bottom-end,.swal2-container.swal2-center-end,.swal2-container.swal2-top-end{grid-template-columns:auto auto minmax(0,1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-left>.swal2-popup,.swal2-container.swal2-center-start>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-left>.swal2-popup,.swal2-container.swal2-bottom-start>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-fullscreen>.swal2-popup,.swal2-container.swal2-grow-row>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none!important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0,100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:0}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0,0,0,.1),rgba(0,0,0,.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;-webkit-animation:swal2-rotate-loading 1.5s linear 0s infinite normal;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 transparent #2778c4 transparent}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px transparent;font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:0}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto!important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:0 0;color:#ccc;font-family:serif;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:0 0;color:#f27474}.swal2-close:focus{outline:0;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:400;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-checkbox,.swal2-file,.swal2-input,.swal2-radio,.swal2-select,.swal2-textarea{margin:1em 2em 3px}.swal2-file,.swal2-input,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:0 0;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px transparent;color:inherit;font-size:1.125em}.swal2-file.swal2-inputerror,.swal2-input.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474!important;box-shadow:0 0 2px #f27474!important}.swal2-file:focus,.swal2-input:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-file::-moz-placeholder,.swal2-input::-moz-placeholder,.swal2-textarea::-moz-placeholder{color:#ccc}.swal2-file::placeholder,.swal2-input::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 3px;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:0 0;font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:0 0;color:inherit;font-size:1.125em}.swal2-checkbox,.swal2-radio{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-checkbox label,.swal2-radio label{margin:0 .6em;font-size:1.125em}.swal2-checkbox input,.swal2-radio input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid transparent;border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;-webkit-user-select:none;-moz-user-select:none;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{-webkit-animation:swal2-animate-error-x-mark .5s;animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-warning.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-warning.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-i-mark .5s;animation:swal2-animate-i-mark .5s}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-info.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-info.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-i-mark .8s;animation:swal2-animate-i-mark .8s}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-question.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-question.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-question-mark .8s;animation:swal2-animate-question-mark .8s}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-.25em;left:-.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-animate-success-line-tip .75s;animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-animate-success-line-long .75s;animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{-webkit-animation:swal2-rotate-success-circular-line 4.25s ease-in;animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:0 0;font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:transparent}.swal2-show{-webkit-animation:swal2-show .3s;animation:swal2-show .3s}.swal2-hide{-webkit-animation:swal2-hide .15s forwards;animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.leave-russia-now-and-apply-your-skills-to-the-world{display:flex;position:fixed;z-index:1939;top:0;right:0;bottom:0;left:0;flex-direction:column;align-items:center;justify-content:center;padding:25px 0 20px;background:#20232a;color:#fff;text-align:center}.leave-russia-now-and-apply-your-skills-to-the-world div{max-width:560px;margin:10px;line-height:146%}.leave-russia-now-and-apply-your-skills-to-the-world iframe{max-width:100%;max-height:55.5555555556vmin;margin:16px auto}.leave-russia-now-and-apply-your-skills-to-the-world strong{border-bottom:2px dashed #fff}.leave-russia-now-and-apply-your-skills-to-the-world button{display:flex;position:fixed;z-index:1940;top:0;right:0;align-items:center;justify-content:center;width:48px;height:48px;margin-right:10px;margin-bottom:-10px;border:none;background:0 0;color:#aaa;font-size:48px;font-weight:700;cursor:pointer}.leave-russia-now-and-apply-your-skills-to-the-world button:hover{color:#fff}@-webkit-keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@-webkit-keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@-webkit-keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@-webkit-keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@-webkit-keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@-webkit-keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@-webkit-keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@-webkit-keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@-webkit-keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@-webkit-keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@-webkit-keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@-webkit-keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@-webkit-keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@-webkit-keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto!important}body.swal2-no-backdrop .swal2-container{background-color:transparent!important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll!important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static!important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:transparent;pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{top:0;right:auto;bottom:auto;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{top:0;right:0;bottom:auto;left:auto}body.swal2-toast-shown .swal2-container.swal2-top-left,body.swal2-toast-shown .swal2-container.swal2-top-start{top:0;right:auto;bottom:auto;left:0}body.swal2-toast-shown .swal2-container.swal2-center-left,body.swal2-toast-shown .swal2-container.swal2-center-start{top:50%;right:auto;bottom:auto;left:0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{top:50%;right:auto;bottom:auto;left:50%;transform:translate(-50%,-50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{top:50%;right:0;bottom:auto;left:auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-left,body.swal2-toast-shown .swal2-container.swal2-bottom-start{top:auto;right:auto;bottom:0;left:0}body.swal2-toast-shown .swal2-container.swal2-bottom{top:auto;right:auto;bottom:0;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{top:auto;right:0;bottom:0;left:auto}')})(ohe);const WEe=ohe.exports,ZEe=(e,t)=>new Array(t).fill("foo").map(()=>{const i=Math.random()*(e.xmax-e.xmin)+e.xmin,r=Math.random()*(e.ymax-e.ymin)+e.ymin;return{type:"point",x:i,y:r,spatialReference:e.spatialReference}}),XEe=(e,t)=>{const i=e.map(r=>t.queryElevation(r));return Promise.all(i)},YEe=(e,t)=>new Promise((i,r)=>{const s=e.extent,n=ZEe(s,10);n.push(e.center),XEe(n,t).then(o=>{const a=o.map(c=>c.geometry.z);a.sort(function(c,h){return c-h});const l=a[a.length-1]-a[0];i(l)})}),QEe="modulepreload",JEe=function(e,t){return new URL(e,t).href},RK={},_e=function(t,i,r){return!i||i.length===0?t():Promise.all(i.map(s=>{if(s=JEe(s,r),s in RK)return;RK[s]=!0;const n=s.endsWith(".css"),o=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${o}`))return;const a=document.createElement("link");if(a.rel=n?"stylesheet":QEe,n||(a.as="script",a.crossOrigin=""),a.href=s,document.head.appendChild(a),n)return new Promise((l,c)=>{a.addEventListener("load",l),a.addEventListener("error",()=>c(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function u(e,t,i,r){var s,n=arguments.length,o=n<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(e,t,i,r);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(n<3?s(o):n>3?s(t,i,o):s(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function x_t(e){const t=[];return function*(){yield*t;for(const i of e)t.push(i),yield i}}function T_t(e,t){for(const i of e)if(i!=null&&t(i))return i}function ahe(e){return e!=null&&typeof e[Symbol.iterator]=="function"}const Cb=null;function w(e){return e!=null}function N(e){return e==null}function Cn(e,t){return w(e)?t(e):Cb}function S_t(e){return e}function KEe(e,t){if(N(e))throw new Error(t);return e}function $t(e,t){return w(e)?e:typeof t=="function"?t():t}function E_t(e,t){return w(e)?e:t}function Tt(e){return w(e)&&e.destroy(),null}function ht(e){return w(e)&&e.dispose(),null}function Ln(e){return w(e)&&e.remove(),null}function fd(e){return w(e)&&e.abort(),null}function vr(e){return w(e)&&e.release(),null}function eCe(e,t,i){return w(e)&&w(t)?w(i)?i(e,t):e.equals(t):e===t}function tCe(e){return null}function C_t(e,t){const i=new Array;return e.forEach(r=>{const s=t(r);w(s)&&i.push(s)}),i}function A_t(e,t){const i=new Array;for(const r of e)i.push(Iu(r,null,t));return i}function O_t(e,t){for(const i of e)Cn(i,t)}function Iu(e,t,i){return w(e)?i(e):t}function R_t(e){return e.filter(t=>w(t))}function Mn(e,...t){let i=e;for(let r=0;r<t.length&&i;++r)i=i[t[r]];return i}function M_t(e){return e}function EE(e){return md(()=>e.forEach(t=>w(t)&&t.remove()))}function md(e){return{remove:()=>{e&&(e(),e=void 0)}}}function P_t(e){return md(w(e)?()=>e.destroy():void 0)}function iCe(e,t){const i=setTimeout(e,t);return md(()=>clearTimeout(i))}class Jh{constructor(t=1){this._seed=t}set seed(t){this._seed=t==null?Math.random()*Jh._m:t}getInt(){return this._seed=(Jh._a*this._seed+Jh._c)%Jh._m,this._seed}getFloat(){return this.getInt()/(Jh._m-1)}getIntRange(t,i){return Math.round(this.getFloatRange(t,i))}getFloatRange(t,i){const r=i-t;return t+this.getInt()/Jh._m*r}}Jh._m=2147483647,Jh._a=48271,Jh._c=0;function $3(e,t){return t?e.filter((i,r,s)=>s.findIndex(t.bind(null,i))===r):e.filter((i,r,s)=>s.indexOf(i)===r)}function Yv(e,t,i){if(N(e)&&N(t))return!0;if(N(e)||N(t)||e.length!==t.length)return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function eZ(e,t){let i=e.length!==t.length;e.length=t.length;for(let r=0;r<t.length;++r)e[r]!==t[r]&&(e[r]=t[r],i=!0);return i}function rCe(e,t,i){let r,s;return i?(r=t.filter(n=>!e.some(o=>i(o,n))),s=e.filter(n=>!t.some(o=>i(o,n)))):(r=t.filter(n=>!e.includes(n)),s=e.filter(n=>!t.includes(n))),{added:r,removed:s}}function sCe(e){return e&&typeof e.length=="number"}function nCe(e,t){const i=e.length;if(i===0)return[];const r=[];for(let s=0;s<i;s+=t)r.push(e.slice(s,s+t));return r}const oCe=!!Array.prototype.fill;function I_t(e,t){if(oCe)return new Array(e).fill(t);const i=new Array(e);for(let r=0;r<e;r++)i[r]=t;return i}function aCe(e,t){t===void 0&&(t=e,e=0);const i=new Array(t-e);for(let r=e;r<t;r++)i[r-e]=r;return i}function lhe(e,t,i){const r=e.length;let s=0,n=r-1;for(;s<n;){const a=s+Math.floor((n-s)/2);t>e[a]?s=a+1:n=a}const o=e[s];return i?t>=e[r-1]?-1:o===t?s:s-1:o===t?s:-1}function che(e){return e.reduce((t,i)=>t.concat(i||[]),[])}class uhe{constructor(){this.last=0}}const hhe=new uhe;function dhe(e,t,i,r){r=r||hhe;const s=Math.max(0,r.last-10);for(let o=s;o<i;++o)if(e[o]===t)return r.last=o,o;const n=Math.min(s,i);for(let o=0;o<n;++o)if(e[o]===t)return r.last=o,o;return-1}function Ak(e,t,i,r){const s=i==null?e.length:i,n=dhe(e,t,s,r);if(n!==-1)return e[n]=e[s-1],i==null&&e.pop(),t}const Dd=new Set;function lCe(e,t,i=e.length,r=t.length,s,n){if(r===0||i===0)return i;Dd.clear();for(let a=0;a<r;++a)Dd.add(t[a]);s=s||hhe;const o=Math.max(0,s.last-10);for(let a=o;a<i;++a)if(Dd.has(e[a])&&(n&&n.push(e[a]),Dd.delete(e[a]),e[a]=e[i-1],--i,--a,Dd.size===0||i===0))return Dd.clear(),i;for(let a=0;a<o;++a)if(Dd.has(e[a])&&(n&&n.push(e[a]),Dd.delete(e[a]),e[a]=e[i-1],--i,--a,Dd.size===0||i===0))return Dd.clear(),i;return Dd.clear(),i}function cCe(e){return e?(MK.seed=e,()=>MK.getFloat()):Math.random}function L_t(e,t){const i=cCe(t);for(let r=e.length-1;r>0;r--){const s=Math.floor(i()*(r+1)),n=e[r];e[r]=e[s],e[s]=n}return e}const MK=new Jh;function tZ(e,t){const i=e.indexOf(t);return i!==-1?(e.splice(i,1),t):null}let gv;function Ce(e){return typeof gv[e]=="function"?gv[e]=gv[e](globalThis):gv[e]}var jue,Hue,que,Wue;gv=((jue=globalThis.dojoConfig)==null?void 0:jue.has)||((Hue=globalThis.esriConfig)==null?void 0:Hue.has)?{...(que=globalThis.dojoConfig)==null?void 0:que.has,...(Wue=globalThis.esriConfig)==null?void 0:Wue.has}:{},Ce.add=(e,t,i,r)=>((r||gv[e]===void 0)&&(gv[e]=t),i&&Ce(e)),Ce.cache=gv,Ce.add("esri-deprecation-warnings",!0),(()=>{var t;Ce.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const e=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(Ce.add("host-browser",e),Ce.add("host-node",typeof globalThis.process=="object"&&((t=globalThis.process.versions)==null?void 0:t.node)&&globalThis.process.versions.v8),Ce.add("dom",e),Ce("host-browser")){const i=navigator,r=i.userAgent,s=i.appVersion,n=parseFloat(s);if(Ce.add("wp",parseFloat(r.split("Windows Phone")[1])||void 0),Ce.add("msapp",parseFloat(r.split("MSAppHost/")[1])||void 0),Ce.add("khtml",s.includes("Konqueror")?n:void 0),Ce.add("edge",parseFloat(r.split("Edge/")[1])||void 0),Ce.add("opr",parseFloat(r.split("OPR/")[1])||void 0),Ce.add("webkit",!Ce("wp")&&!Ce("edge")&&parseFloat(r.split("WebKit/")[1])||void 0),Ce.add("chrome",!Ce("edge")&&!Ce("opr")&&parseFloat(r.split("Chrome/")[1])||void 0),Ce.add("android",!Ce("wp")&&parseFloat(r.split("Android ")[1])||void 0),Ce.add("safari",!s.includes("Safari")||Ce("wp")||Ce("chrome")||Ce("android")||Ce("edge")||Ce("opr")?void 0:parseFloat(s.split("Version/")[1])),Ce.add("mac",s.includes("Macintosh")),!Ce("wp")&&r.match(/(iPhone|iPod|iPad)/)){const o=RegExp.$1.replace(/P/,"p"),a=r.match(/OS ([\d_]+)/)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replace(/_/g,""));Ce.add(o,l),Ce.add("ios",l)}Ce.add("trident",parseFloat(s.split("Trident/")[1])||void 0),Ce("webkit")||(!r.includes("Gecko")||Ce("wp")||Ce("khtml")||Ce("trident")||Ce("edge")||Ce.add("mozilla",n),Ce("mozilla")&&Ce.add("ff",parseFloat(r.split("Firefox/")[1]||r.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const e=navigator.userAgent,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(e),i=/iPhone/i.test(e);t&&Ce.add("esri-mobile",t),i&&Ce.add("esri-iPhone",i),Ce.add("esri-geolocation",!!navigator.geolocation)}Ce.add("esri-canvas-svg-support",!Ce("trident")),Ce.add("esri-wasm","WebAssembly"in globalThis),Ce.add("esri-shared-array-buffer",()=>{const e="SharedArrayBuffer"in globalThis,t=globalThis.crossOriginIsolated===!1;return e&&!t}),Ce.add("wasm-simd",()=>{const e=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(e))}),Ce.add("esri-atomics","Atomics"in globalThis),Ce.add("esri-workers","Worker"in globalThis),Ce.add("web-feat:cache","caches"in globalThis),Ce.add("esri-workers-arraybuffer-transfer",!Ce("safari")||Number(Ce("safari"))>=12),Ce.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),Ce.add("featurelayer-simplify-payload-size-factors",[1,1,4]),Ce.add("featurelayer-snapshot-enabled",!0),Ce.add("featurelayer-snapshot-point-min-threshold",8e4),Ce.add("featurelayer-snapshot-point-max-threshold",4e5),Ce.add("featurelayer-snapshot-point-coverage",.1),Ce.add("featurelayer-advanced-symbols",!1),Ce.add("featurelayer-pbf",!0),Ce.add("featurelayer-pbf-statistics",!1),Ce.add("feature-layers-workers",!0),Ce.add("feature-polyline-generalization-factor",1),Ce.add("mapview-transitions-duration",200),Ce.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),Ce.add("mapserver-pbf-enabled",!1),Ce.add("mapimagelayer-popup-identify-max-tolerance",20),Ce.add("heatmap-allow-raster-fallback",!0),Ce.add("heatmap-force-raster",!1),Ce("host-webworker")||Ce("host-browser")&&(Ce.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),Ce.add("esri-image-decode",()=>{if("decode"in new Image){const e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void e.decode().then(()=>{Ce.add("esri-image-decode",!0,!0,!0)}).catch(()=>{Ce.add("esri-image-decode",!1,!0,!0)})}return!1}),Ce.add("esri-url-encodes-apostrophe",()=>{const e=window.document.createElement("a");return e.href="?'",e.href.includes("?%27")}))})();function uCe(e,t){if(e.forEach)e.forEach(t);else for(let i=0;i<e.length;i++)t(e[i],i,e)}function iZ(e,t,i){if(e.slice)return e.slice(t,i);t===void 0?t=0:(t<0&&(t+=e.length),t=Math.min(e.length,Math.max(0,t))),i===void 0?i=e.length:(i<0&&(i+=e.length),i=Math.min(e.length,Math.max(0,i)));const r=Math.max(0,i-t),s=new e.constructor(r);for(let n=0;n<r;n++)s[n]=e[t+n];return s}function $A(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}function hCe(e){return e instanceof Int8Array||e&&e.constructor&&e.constructor.name==="Int8Array"}function vw(e){return e instanceof Uint8Array||e&&e.constructor&&e.constructor.name==="Uint8Array"}function dCe(e){return e instanceof Uint8ClampedArray||e&&e.constructor&&e.constructor.name==="Uint8ClampedArray"}function phe(e){return e instanceof Int16Array||e&&e.constructor&&e.constructor.name==="Int16Array"}function n4(e){return e instanceof Uint16Array||e&&e.constructor&&e.constructor.name==="Uint16Array"}function fhe(e){return e instanceof Int32Array||e&&e.constructor&&e.constructor.name==="Int32Array"}function o4(e){return e instanceof Uint32Array||e&&e.constructor&&e.constructor.name==="Uint32Array"}function mhe(e){return e instanceof Float32Array||e&&e.constructor&&e.constructor.name==="Float32Array"}function ghe(e){return e instanceof Float64Array||e&&e.constructor&&e.constructor.name==="Float64Array"}function pCe(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}function oL(e){return N(e)?0:128+e.buffer.byteLength+64}function yhe(e,t){let i;if(t)for(i in e)e.hasOwnProperty(i)&&(e[i]===void 0?delete e[i]:e[i]instanceof Object&&yhe(e[i],!0));else for(i in e)e.hasOwnProperty(i)&&e[i]===void 0&&delete e[i];return e}function me(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=whe(e);if(w(t))return t;if(_he(e))return e.clone();if(vhe(e))return e.map(me);if(bhe(e))return e.clone();const i={};for(const r of Object.getOwnPropertyNames(e))i[r]=me(e[r]);return i}function tG(e){if(!e||typeof e!="object"||typeof e=="function")return e;const t=whe(e);if(w(t))return t;if(vhe(e)){let i=!0;const r=e.map(s=>{const n=tG(s);return s!=null&&n==null&&(i=!1),n});return i?r:null}if(_he(e))return e.clone();if(!bhe(e)){const i=new(Object.getPrototypeOf(e)).constructor;for(const r of Object.getOwnPropertyNames(e)){const s=e[r],n=tG(s);if(s!=null&&n==null)return null;i[r]=n}return i}return null}function _he(e){return typeof e.clone=="function"}function vhe(e){return typeof e.map=="function"&&typeof e.forEach=="function"}function bhe(e){return typeof e.notifyChange=="function"&&typeof e.watch=="function"}function PK(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;const t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}function whe(e){if(hCe(e)||vw(e)||dCe(e)||phe(e)||n4(e)||fhe(e)||o4(e)||mhe(e)||ghe(e))return iZ(e);if(e instanceof Date)return new Date(e.getTime());if(e instanceof ArrayBuffer)return e.slice(0,e.byteLength);if(e instanceof Map){const t=new Map;return e.forEach((i,r)=>{t.set(r,me(i))}),t}if(e instanceof Set){const t=new Set;return e.forEach(i=>{t.add(me(i))}),t}return null}function rZ(e,t){return e===t||typeof e=="number"&&isNaN(e)&&typeof t=="number"&&isNaN(t)||typeof(e||{}).getTime=="function"&&typeof(t||{}).getTime=="function"&&e.getTime()===t.getTime()||!1}function fCe(e,t){return e===t||(e==null||typeof e=="string"?e===t:typeof e=="number"?e===t||typeof t=="number"&&isNaN(e)&&isNaN(t):e instanceof Date?t instanceof Date&&e.getTime()===t.getTime():Array.isArray(e)?Array.isArray(t)&&Yv(e,t):e instanceof Set?t instanceof Set&&gCe(e,t):e instanceof Map?t instanceof Map&&yCe(e,t):!!PK(e)&&PK(t)&&mCe(e,t))}function mCe(e,t){if(e===null||t===null)return!1;const i=Object.keys(e);if(t===null||Object.keys(t).length!==i.length)return!1;for(const r of i)if(e[r]!==t[r]||!Object.prototype.hasOwnProperty.call(t,r))return!1;return!0}function gCe(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}function yCe(e,t){if(e.size!==t.size)return!1;for(const[i,r]of e){const s=t.get(i);if(s!==r||s===void 0&&!t.has(i))return!1}return!0}function ll(e){return e?e.__accessor__?e.__accessor__:e.propertyInvalidated?e:null:null}function _Ce(e,t){return e!=null&&e.metadatas&&e.metadatas[t]!=null}function nN(e,t,i){return i?a4(e,t,{policy:i,path:""}):a4(e,t,null)}function a4(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=null,o="merge";if(i&&(n=i.path?`${i.path}.${s}`:s,o=i.policy(n)),o==="replace")return r[s]=t[s],r;if(r[s]===void 0)return r[s]=me(t[s]),r;let a=r[s],l=t[s];if(a===l)return r;if(Array.isArray(l)||Array.isArray(r))a=a?Array.isArray(a)?r[s]=a.concat():r[s]=[a]:r[s]=[],l&&(Array.isArray(l)||(l=[l]),l.forEach(c=>{a.includes(c)||a.push(c)}));else if(l&&typeof l=="object")if(i){const c=i.path;i.path=n,r[s]=a4(a,l,i),i.path=c}else r[s]=a4(a,l,null);else r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=l);return r},e||{}):e}function xhe(e){return Array.isArray(e)?e:e.split(".")}function IK(e){return e.includes(",")?e.split(",").map(t=>t.trim()):[e.trim()]}function vCe(e){if(Array.isArray(e)){const t=[];for(const i of e)t.push(...IK(i));return t}return IK(e)}function The(e,t,i,r){const s=vCe(t);if(s.length!==1){const n=s.map(o=>r(e,o,i));return EE(n)}return r(e,s[0],i)}function sZ(e){let t=!1;return()=>{t||(t=!0,e())}}function She(e,t){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.getItemAt(s)}const r=ll(t);return _Ce(r,i)?r.get(i):t[i]}function Ehe(e,t,i){if(e==null)return e;const r=She(t[i],e);return!r&&i<t.length-1?void 0:i===t.length-1?r:Ehe(r,t,i+1)}function D3(e,t,i=0){return typeof t!="string"||t.includes(".")?Ehe(e,xhe(t),i):She(t,e)}function l4(e,t){return D3(e,t)}function LK(e,t){return D3(t,e)!==void 0}var lm;(function(e){e[e.INITIALIZING=0]="INITIALIZING",e[e.CONSTRUCTING=1]="CONSTRUCTING",e[e.CONSTRUCTED=2]="CONSTRUCTED"})(lm||(lm={}));class $K{constructor(t){this.autoDestroy=!1,this.properties=t}}function N3(e){let t=e.constructor.__accessorMetadata__;const i=Object.prototype.hasOwnProperty.call(e.constructor,"__accessorMetadata__");if(t){if(!i){const r=Object.create(t.properties),s=t.autoDestroy;for(const n in r)r[n]=me(r[n]);t=new $K(r),t.autoDestroy=s,Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0})}}else t=new $K({}),Object.defineProperty(e.constructor,"__accessorMetadata__",{value:t,enumerable:!1,configurable:!0,writable:!0});return e.constructor.__accessorMetadata__}function bCe(e){return N3(e).properties}function Ok(e,t){const i=bCe(e);let r=i[t];return r||(r=i[t]={}),r}function wCe(e,t){return nN(e,t,TCe)}const xCe=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function TCe(e){return xCe.test(e)?"replace":"merge"}function Che(e,t,i=!1){return Ohe(e,t,i)}function $C(e,t){if(t!=null)return t[e]||Ahe(e.split("."),!1,t)}function zc(e,t,i){const r=e.split("."),s=r.pop(),n=Ahe(r,!0,i);n&&s&&(n[s]=t)}function Ahe(e,t,i){let r=i;for(const s of e){if(r==null)return;if(!(s in r)){if(!t)return;r[s]={}}r=r[s]}return r}function Ohe(e,t,i){return t?Object.keys(t).reduce((r,s)=>{let n=r[s],o=t[s];return n===o?r:n===void 0?(r[s]=me(o),r):(Array.isArray(o)||Array.isArray(r)?(n=n?Array.isArray(n)?r[s]=n.concat():r[s]=[n]:r[s]=[],o&&(Array.isArray(o)||(o=[o]),i?o.forEach(a=>{n.includes(a)||n.push(a)}):r[s]=o.concat())):o&&typeof o=="object"?r[s]=Ohe(n,o,i):r.hasOwnProperty(s)&&!t.hasOwnProperty(s)||(r[s]=o),r)},e||{}):e}var Zue;const sr={apiKey:void 0,applicationUrl:(Zue=globalThis.location)==null?void 0:Zue.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(Che(sr,globalThis.esriConfig,!0),delete sr.has),!sr.assetsPath){const e="4.24.7";sr.assetsPath=`https://js.arcgis.com/${e.slice(0,-2)}/@arcgis/core/assets`}sr.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(sr,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),sr.request.corsEnabledServers=[],sr.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0};const SCe=/\{([^\}]+)\}/g;function DK(e){return e==null?"":e}function Sm(e,t){return e.replace(SCe,typeof t=="object"?(i,r)=>DK($C(r,t)):(i,r)=>DK(t(r)))}function Rhe(e,t){return e.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,i=>t&&t.includes(i)?i:`\\${i}`)}function nZ(e){let t=0;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function $_t(e){return new DOMParser().parseFromString(e||"","text/html").body.innerText||""}const NK={info:0,warn:1,error:2,none:3};class Ie{constructor(t){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},t.level!=null&&(this.level=t.level),t.writer!=null&&(this.writer=t.writer),this._module=t.module,Ie._loggers[this.module]=this;const i=this.module.lastIndexOf(".");i!==-1&&(this._parent=Ie.getLogger(this.module.slice(0,i)))}get module(){return this._module}get parent(){return this._parent}error(...t){this._log("error","always",...t)}warn(...t){this._log("warn","always",...t)}info(...t){this._log("info","always",...t)}errorOnce(...t){this._log("error","once",...t)}warnOnce(...t){this._log("warn","once",...t)}infoOnce(...t){this._log("info","once",...t)}errorOncePerTick(...t){this._log("error","oncePerTick",...t)}warnOncePerTick(...t){this._log("warn","oncePerTick",...t)}infoOncePerTick(...t){this._log("info","oncePerTick",...t)}get test(){const t=this;return{loggedMessages:t._loggedMessages,clearLoggedWarnings:()=>t._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(t={}){const i=Ie._loggers;return Ie._loggers=t,i},set throttlingDisabled(t){Ie._throttlingDisabled=t}}}static getLogger(t){let i=Ie._loggers[t];return i||(i=new Ie({module:t})),i}_log(t,i,...r){if(!!this._matchLevel(t)){if(i!=="always"&&!Ie._throttlingDisabled){const s=this._argsToKey(r),n=this._loggedMessages[t].get(s);if(i==="once"&&n!=null||i==="oncePerTick"&&n&&n>=Ie._tickCounter)return;this._loggedMessages[t].set(s,Ie._tickCounter),Ie._scheduleTickCounterIncrement()}for(const s of sr.log.interceptors)if(s(t,this.module,...r))return;this._inheritedWriter()(t,this.module,...r)}}_parentWithMember(t,i){let r=this;for(;w(r);){const s=r[t];if(w(s))return s;r=r.parent}return i}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(t,i,...r){console[t](`[${i}]`,...r)}_matchLevel(t){const i=sr.log.level?sr.log.level:"warn";return NK[this._parentWithMember("level",i)]<=NK[t]}_argsToKey(...t){const i=(r,s)=>typeof s!="object"||Array.isArray(s)?s:"[Object]";return nZ(JSON.stringify(t,i))}static _scheduleTickCounterIncrement(){Ie._tickCounterScheduled||(Ie._tickCounterScheduled=!0,Promise.resolve().then(()=>{Ie._tickCounter++,Ie._tickCounterScheduled=!1}))}}Ie._loggers={},Ie._tickCounter=0,Ie._tickCounterScheduled=!1,Ie._throttlingDisabled=!1;function ECe(e){return e&&e.release&&typeof e.release=="function"}function CCe(e){return e&&e.acquire&&typeof e.acquire=="function"}class qs{constructor(t,i,r,s=1,n=0){if(this.ctor=t,this.acquireFunction=i,this.releaseFunction=r,this.allocationSize=s,this._pool=new Array(n),this._initialSize=n,this.ctor)for(let o=0;o<n;o++)this._pool[o]=new this.ctor;this.allocationSize=Math.max(s,1)}destroy(){this.prune(0)}acquire(...t){let i;if(qs.test.disabled)i=new this.ctor;else{if(this._pool.length===0){const r=this.allocationSize;for(let s=0;s<r;s++)this._pool[s]=new this.ctor}i=this._pool.pop()}return this.acquireFunction?this.acquireFunction(i,...t):CCe(i)&&i.acquire(...t),i}release(t){t&&!qs.test.disabled&&(this.releaseFunction?this.releaseFunction(t):ECe(t)&&t.release(),this._pool.push(t))}prune(t=this._initialSize){if(!(t>=this._pool.length)){for(let i=t;i<this._pool.length;++i){const r=this._pool[i];this._dispose(r)}this._pool.length=t}}_dispose(t){t.dispose&&typeof t.dispose=="function"&&t.dispose()}}qs.test={disabled:!1};var Yi;(function(e){e[e.DEFAULTS=0]="DEFAULTS",e[e.COMPUTED=1]="COMPUTED",e[e.SERVICE=2]="SERVICE",e[e.PORTAL_ITEM=3]="PORTAL_ITEM",e[e.WEB_SCENE=4]="WEB_SCENE",e[e.WEB_MAP=5]="WEB_MAP",e[e.USER=6]="USER"})(Yi||(Yi={}));const iG=Yi.USER+1;function yv(e){switch(e){case"defaults":return Yi.DEFAULTS;case"service":return Yi.SERVICE;case"portal-item":return Yi.PORTAL_ITEM;case"web-scene":return Yi.WEB_SCENE;case"web-map":return Yi.WEB_MAP;case"user":return Yi.USER}}function c4(e){switch(e){case Yi.DEFAULTS:return"defaults";case Yi.SERVICE:return"service";case Yi.PORTAL_ITEM:return"portal-item";case Yi.WEB_SCENE:return"web-scene";case Yi.WEB_MAP:return"web-map";case Yi.USER:return"user"}return void 0}function ACe(e){return c4(e)}var Br;(function(e){e[e.Dirty=1]="Dirty",e[e.Overriden=2]="Overriden",e[e.Computing=4]="Computing",e[e.NonNullable=8]="NonNullable",e[e.HasDefaultValue=16]="HasDefaultValue",e[e.DepTrackingInitialized=32]="DepTrackingInitialized",e[e.AutoTracked=64]="AutoTracked",e[e.ExplicitlyTracking=128]="ExplicitlyTracking"})(Br||(Br={}));let u4,YO=[];const OCe=Ie.getLogger("esri.core.Accessor");function _i(e){u4!==void 0&&u4.onObservableAccessed(e)}let oN=!1,aN=!1;function zy(e,t,i){if(oN)return oZ(e,t,i);Mhe(e);const r=t.call(i);return Phe(),r}function RCe(e,t){return zy(void 0,e,t)}function oZ(e,t,i){const r=oN;oN=!0,Mhe(e);let s=null;try{s=t.call(i)}catch(n){aN&&OCe.error(n)}return Phe(),oN=r,s}function Mhe(e){u4=e,YO.push(e)}function Phe(){const e=YO.pop();u4=YO.length>0?YO[YO.length-1]:void 0,e!==void 0&&e.onTrackingEnd()}function Ihe(e,t){if(t.flags&Br.DepTrackingInitialized)return;const i=aN;aN=!1,t.flags&Br.AutoTracked?oZ(t,t.metadata.get,e):Lhe(e,t),aN=i}const MCe=[];function Lhe(e,t){t.flags&Br.ExplicitlyTracking||(t.flags|=Br.ExplicitlyTracking,oZ(t,()=>{const i=t.metadata.dependsOn||MCe;for(const r of i)if(typeof r!="string"||r.includes(".")){const s=xhe(r);for(let n=0,o=e;n<s.length&&o!=null&&typeof o=="object";++n)o=FK(o,s[n],n!==s.length-1)}else FK(e,r,!1)}),t.flags&=~Br.ExplicitlyTracking)}function FK(e,t,i){var n;const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const o=parseInt(r,10);if(!isNaN(o))return Array.isArray(e)?e[o]:e.getItemAt(o)}const s=(n=ll(e))==null?void 0:n.properties.get(r);return s&&(_i(s),Ihe(e,s)),i?e[r]:void 0}class $he{constructor(t,i){this._observers=t,this._observer=i}remove(){tZ(this._observers,this._observer)}}class kK{constructor(t,i,r){this.properties=t,this.propertyName=i,this.metadata=r,this._observers=null,this._accessed=null,this._handles=null,this.flags=Br.Dirty|(r.nonNullable?Br.NonNullable:0)|(r.hasOwnProperty("value")?Br.HasDefaultValue:0)|(r.get===void 0?Br.DepTrackingInitialized:0)|(r.dependsOn===void 0?Br.AutoTracked:0)}destroy(){if(this.flags&Br.Dirty&&this._observers){const t=this._observers.slice();for(const i of t)i.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){_i(this);const t=this.properties.store,i=this.propertyName,r=this.flags,s=t.get(i);if(r&Br.Computing||~r&Br.Dirty&&t.has(i))return s;this.flags|=Br.Computing;const n=this.properties.host;let o;r&Br.AutoTracked?o=zy(this,this.metadata.get,n):(Lhe(n,this),o=this.metadata.get.call(n)),t.set(i,o,Yi.COMPUTED);const a=t.get(i);return a===s?this.flags&=~Br.Dirty:RCe(this.commit,this),this.flags&=~Br.Computing,a}onObservableAccessed(t){t!==this&&(this._accessed===null&&(this._accessed=[]),this._accessed.includes(t)||this._accessed.push(t))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=Br.DepTrackingInitialized;const t=this._accessed;if(t===null)return;let i=this._handles;i===null&&(i=this._handles=[]);for(let r=0;r<t.length;++r)i.push(t[r].observe(this));t.length=0}observe(t){return this._observers===null&&(this._observers=[]),this._observers.includes(t)||this._observers.push(t),new $he(this._observers,t)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&Br.Overriden&&(this.flags|=Br.Dirty);const t=this._observers;if(t!==null)for(let i=0;i<t.length;++i)t[i].onInvalidated()}commit(){this.flags&=~Br.Dirty,this.onCommitted()}onCommitted(){if(this._observers===null)return;const t=this._observers.slice();for(let i=0;i<t.length;++i)t[i].onCommitted()}_clearObservationHandles(){const t=this._handles;if(t!==null){for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}}class aZ{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new aZ;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,me(r))}),i}get(t){return this._values.get(t)}originOf(){return Yi.USER}keys(){return[...this._values.keys()]}set(t,i){this._values.set(t,i)}delete(t){this._values.delete(t)}has(t){return this._values.has(t)}forEach(t){this._values.forEach(t)}}function aL(e,t,i){return e!==void 0}function UK(e,t,i,r){return e!==void 0&&(!(i==null&&e.flags&Br.NonNullable)||(r.lifecycle,lm.INITIALIZING,!1))}function PCe(e){return e&&typeof e.destroy=="function"}Ie.getLogger("esri.core.accessorSupport.Properties");class ICe{constructor(t){this.host=t,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=lm.INITIALIZING,this.store=new aZ,this._origin=Yi.USER;const i=this.host.constructor.__accessorMetadata__,r=i.properties;for(const s in r){const n=new kK(this,s,r[s]);this.properties.set(s,n)}this.metadatas=r,this._autoDestroy=i.autoDestroy}initialize(){this.lifecycle=lm.CONSTRUCTING}constructed(){this.lifecycle=lm.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[t,i]of this.properties){const r=this.internalGet(t);r&&PCe(r)&&(r.destroy(),~i.flags&Br.NonNullable&&this._internalSet(i,null)),i.destroy()}else for(const[t,i]of this.properties)i.destroy()}get initialized(){return this.lifecycle!==lm.INITIALIZING}get(t){const i=this.properties.get(t);if(i.metadata.get)return i.getComputed();_i(i);const r=this.store;return r.has(t)?r.get(t):i.metadata.value}originOf(t){const i=this.store.originOf(t);if(i===void 0){const r=this.properties.get(t);if(r!==void 0&&r.flags&Br.HasDefaultValue)return"defaults"}return c4(i)}has(t){return!!this.properties.has(t)&&this.store.has(t)}keys(){return[...this.properties.keys()]}internalGet(t){const i=this.properties.get(t);if(aL(i))return this.store.has(t)?this.store.get(t):i.metadata.value}internalSet(t,i){const r=this.properties.get(t);aL(r)&&this._internalSet(r,i)}getDependsInfo(t,i,r){const s=this.properties.get(i);if(!aL(s))return"";const n=new Set,o=zy({onObservableAccessed:l=>n.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=s.metadata.get)==null?void 0:l.call(t)});let a=`${r}${t.declaredClass.split(".").pop()}.${i}: ${o}
`;if(n.size===0)return a;r+="  ";for(const l of n){if(!(l instanceof kK))continue;const c=l.properties.host,h=l.propertyName,p=ll(c);a+=p?p.getDependsInfo(c,h,r):`${r}${h}: undefined
`}return a}setAtOrigin(t,i,r){const s=this.properties.get(t);if(aL(s))return this._setAtOrigin(s,i,r)}isOverridden(t){const i=this.properties.get(t);return i!==void 0&&!!(i.flags&Br.Overriden)}clearOverride(t){const i=this.properties.get(t);i!==void 0&&i.flags&Br.Overriden&&(i.flags&=~Br.Overriden,i.notifyChange())}override(t,i){const r=this.properties.get(t);if(!UK(r,t,i,this))return;const s=r.metadata.cast;if(s){const n=this._cast(s,i),{valid:o,value:a}=n;if(JB.release(n),!o)return;i=a}r.flags|=Br.Overriden,this._internalSet(r,i)}set(t,i){const r=this.properties.get(t);if(!UK(r,t,i,this))return;const s=r.metadata.cast;if(s){const o=this._cast(s,i),{valid:a,value:l}=o;if(JB.release(o),!a)return;i=l}const n=r.metadata.set;n?n.call(this.host,i):this._internalSet(r,i)}setDefaultOrigin(t){this._origin=yv(t)}getDefaultOrigin(){return c4(this._origin)}notifyChange(t){const i=this.properties.get(t);i!==void 0&&i.notifyChange()}invalidate(t){const i=this.properties.get(t);i!==void 0&&i.invalidate()}commit(t){const i=this.properties.get(t);i!==void 0&&i.commit()}_internalSet(t,i){const r=this.lifecycle!==lm.INITIALIZING?this._origin:Yi.DEFAULTS;this._setAtOrigin(t,i,r)}_setAtOrigin(t,i,r){const s=this.store,n=t.propertyName;s.has(n,r)&&rZ(i,s.get(n))&&~t.flags&Br.Overriden&&r===s.originOf(n)||(t.invalidate(),s.set(n,i,r),t.commit(),Ihe(this.host,t))}_cast(t,i){const r=JB.acquire();return r.valid=!0,r.value=i,t&&(r.value=t.call(this.host,i,r)),r}}class LCe{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}}const JB=new qs(LCe);function $Ce(e,t){return e.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(i,r)=>{if(r==="")return"$";const s=$C(r,t),n=s==null?"":s;if(n===void 0)throw new Error(`could not find key "${r}" in template`);return n.toString()})}class Rk{constructor(t,i,r){this.name=t,this.details=r,this.message=void 0,this instanceof Rk&&(this.message=i&&$Ce(i,r)||"")}toString(){return"["+this.name+"]: "+this.message}}class se extends Rk{constructor(t,i,r){if(super(t,i,r),!(this instanceof se))return new se(t,i,r)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(t,i)=>{if(i&&typeof i=="object"&&typeof i.toJSON=="function")return i;try{return me(i)}catch{return"[object]"}}))}}catch(t){throw Ie.getLogger("esri.core.Error").error(t),t}return{name:this.name,message:this.message,details:this.details}}static fromJSON(t){return new se(t.name,t.message,t.details)}}se.prototype.type="error";function h4(e,t,i){if(e&&t)if(typeof t=="object")for(const r of Object.getOwnPropertyNames(t))h4(e,r,t[r]);else{if(t.includes(".")){const s=t.split("."),n=s.splice(s.length-1,1)[0];return void h4(l4(e,s),n,i)}const r=e.__accessor__;r!=null&&DCe(t,r),e[t]=i}}function DCe(e,t){if(Ce("esri-unknown-property-errors")&&!NCe(e,t))throw new se("set:unknown-property",FCe(e,t))}function NCe(e,t){return t.metadatas[e]!=null}function FCe(e,t){return"setting unknown property '"+e+"' on instance of "+t.host.declaredClass}Ie.getLogger("esri.core.accessorSupport.set");function kCe(e){e.length=0}class Rc{constructor(t=50,i=50){this._pool=new qs(Array,void 0,kCe,i,t)}acquire(){return this._pool.acquire()}release(t){this._pool.release(t)}prune(){this._pool.prune(0)}static acquire(){return KB.acquire()}static release(t){return KB.release(t)}static prune(){KB.prune()}}const KB=new Rc(100);class Dhe extends qs{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=tCe(this._set)}acquire(...t){const i=super.acquire(...t);return this._set.delete(i),i}release(t){t&&!this._set.has(t)&&(super.release(t),this._set.add(t))}_dispose(t){this._set.delete(t),super._dispose(t)}}const lL=[];function CE(e){lL.push(e),lL.length===1&&queueMicrotask(()=>{const t=lL.slice();lL.length=0;for(const i of t)i()})}const UCe=29;class Fv{constructor(t,i=UCe){this.name=t,this._counter=0,this._items=new Array(i)}record(t){this._items[++this._counter%this._items.length]=t}get median(){return this._items.slice().sort((t,i)=>t-i)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((t,i)=>t+i,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}var rG;(function(e){const t=(n,o,a,l)=>{let c=o,h=o;const p=a>>>1,m=n[c-1];for(;h<=p;){h=c<<1,h<a&&l(n[h-1],n[h])<0&&++h;const g=n[h-1];if(l(g,m)<=0)break;n[c-1]=g,c=h}n[c-1]=m},i=(n,o)=>n<o?-1:n>o?1:0;function r(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l);const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l)}}function*s(n,o,a,l){o===void 0&&(o=0),a===void 0&&(a=n.length),l===void 0&&(l=i);for(let h=a>>>1;h>o;h--)t(n,h,a,l),yield;const c=o+1;for(let h=a-1;h>o;h--){const p=n[o];n[o]=n[h],n[h]=p,t(n,c,h,l),yield}}e.sort=r,e.iterableSort=s})(rG||(rG={}));const zK=rG,zCe=1.5,BCe=1.1;class hi{constructor(t){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new uhe,t&&(t.initialSize&&(this.data=new Array(t.initialSize)),t.allocator&&(this._allocator=t.allocator),t.deallocator!==void 0&&(this._deallocator=t.deallocator),t.shrink&&(this._shrink=()=>BK(this)))}toArray(){return this.data.slice(0,this.length)}filter(t){const i=new Array;for(let r=0;r<this._length;r++){const s=this.data[r];t(s)&&i.push(s)}return i}getItemAt(t){if(!(t<0||t>=this._length))return this.data[t]}includes(t,i){const r=this.data.indexOf(t,i);return r!==-1&&r<this.length}get length(){return this._length}set length(t){if(t>this._length){if(this._allocator){for(;this._length<t;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=t}else{if(this._deallocator)for(let i=t;i<this._length;++i)this.data[i]=this._deallocator(this.data[i]);this._length=t,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(t){this.data[this._length++]=t}pushArray(t,i=t.length){for(let r=0;r<i;r++)this.data[this._length++]=t[r]}fill(t,i){for(let r=0;r<i;r++)this.data[this._length++]=t}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const t=this.data[this._length];return++this._length,t}unshift(t){this.data.unshift(t),this._length++,BK(this)}pop(){if(this.length===0)return;const t=this.data[this.length-1];return this.length=this.length-1,this._shrink(),t}remove(t){const i=dhe(this.data,t,this.length,this._hint);if(i!==-1)return this.data.splice(i,1),this.length=this.length-1,t}removeUnordered(t){const i=Ak(this.data,t,this.length,this._hint);return i!==void 0&&(this.length=this.length-1),this._shrink(),i}removeUnorderedIndex(t){if(!(t>=this.length||t<0))return this.swapElements(t,this.length-1),this.pop()}removeUnorderedMany(t,i=t.length,r){this.length=lCe(this.data,t,this.length,i,this._hint,r),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(t,i){t>=this.length||i>=this.length||t===i||([this.data[t],this.data[i]]=[this.data[i],this.data[t]])}sort(t){zK.sort(this.data,0,this.length,t)}iterableSort(t){return zK.iterableSort(this.data,0,this.length,t)}some(t,i){for(let r=0;r<this.length;++r)if(t.call(i,this.data[r],r,this.data))return!0;return!1}filterInPlace(t,i){let r=0;for(let s=0;s<this._length;++s){const n=this.data[s];t.call(i,n,s,this.data)&&(this.data[s]=this.data[r],this.data[r]=n,r++)}if(this._deallocator)for(let s=r;s<this._length;s++)this.data[s]=this._deallocator(this.data[s]);return this._length=r,this._shrink(),this}forAll(t,i){const r=this.length,s=this.data;for(let n=0;n<r;++n)t.call(i,s[n],n,s)}forEach(t,i){for(let r=0;r<this.length;++r)t.call(i,this.data[r],r,this.data)}map(t,i){const r=new Array(this.length);for(let s=0;s<this.length;++s)r[s]=t.call(i,this.data[s],s,this.data);return r}reduce(t,i){let r=i;for(let s=0;s<this.length;++s)r=t(r,this.data[s],s,this.data);return r}has(t){const i=this.length,r=this.data;for(let s=0;s<i;++s)if(r[s]===t)return!0;return!1}}function BK(e){e.data.length>zCe*e.length&&(e.data.length=Math.floor(e.length*BCe))}function VCe(e){return{setTimeout:(t,i)=>{const r=e.setTimeout(t,i);return{remove:()=>e.clearTimeout(r)}}}}const Mk=VCe(globalThis),VK=new Set;function GCe(e,t,i=!1){i&&VK.has(t)||(i&&VK.add(t),e.warn(`\u{1F6D1} DEPRECATED - ${t}`))}function jCe(e,t,i={}){if(Ce("esri-deprecation-warnings")){const{moduleName:r}=i;Nhe(e,`Property: ${(r?r+"::":"")+t}`,i)}}function Nhe(e,t,i={}){if(Ce("esri-deprecation-warnings")){const{replacement:r,version:s,see:n,warnOnce:o}=i;let a=t;r&&(a+=`
	\u{1F6E0}\uFE0F Replacement: ${r}`),s&&(a+=`
	\u2699\uFE0F Version: ${s}`),n&&(a+=`
	\u{1F517} See ${n} for more details.`),GCe(e,a,o)}}function Pk(e){return e&&(typeof e.on=="function"||typeof e.addEventListener=="function")}function F3(e,t,i){if(!Pk(e))throw new TypeError("target is not a Evented or EventTarget object");if("on"in e)return e.on(t,i);if(Array.isArray(t)){const r=t.slice();for(const s of r)e.addEventListener(s,i);return{remove(){for(const s of r)e.removeEventListener(s,i)}}}return e.addEventListener(t,i),{remove(){e.removeEventListener(t,i)}}}function Fhe(e,t,i){if(!Pk(e))throw new TypeError("target is not a Evented or EventTarget object");if("once"in e)return e.once(t,i);const r=F3(e,t,s=>{r.remove(),i.call(e,s)});return{remove(){r.remove()}}}const HCe={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function bw({key:e}){return HCe[e]||e}function $i(e="Aborted"){return new se("AbortError",e)}function Ui(e,t="Aborted"){if(An(e))throw $i(t)}function Ik(e){return w(e)?"aborted"in e?e:e.signal:e}function An(e){const t=Ik(e);return w(t)&&t.aborted}function e0(e){if(Cs(e))throw e}function sG(e){if(!Cs(e))throw e}function Ma(e,t){const i=Ik(e);if(!N(i)){if(!i.aborted)return Fhe(i,"abort",()=>t());t()}}function lZ(e,t){const i=Ik(e);if(!N(i))return Ui(i),Fhe(i,"abort",()=>t($i()))}function qCe(e,t){const i=Ik(t);return N(i)?e:new Promise((r,s)=>{let n=Ma(t,()=>s($i()));const o=()=>n=Ln(n);e.then(o,o),e.then(r,s)})}function Cs(e){return e&&e.name==="AbortError"}async function nG(e){try{return await e}catch(t){if(!Cs(t))throw t}}async function D_t(e,t=Ie.getLogger("esri")){try{return await e}catch(i){Cs(i)||t.error(i)}}function Qv(){let e=null;const t=new Promise((i,r)=>{e={promise:void 0,resolve:i,reject:r}});return e.promise=t,e}async function cl(e){if(!e)return;if(typeof e.forEach!="function"){const i=Object.keys(e),r=i.map(o=>e[o]),s=await cl(r),n={};return i.map((o,a)=>n[o]=s[a]),n}const t=e;return new Promise(i=>{const r=[];let s=t.length;s===0&&i(r),t.forEach(n=>{const o={promise:n||Promise.resolve(n)};r.push(o),o.promise.then(a=>{o.value=a}).catch(a=>{o.error=a}).then(()=>{--s,s===0&&i(r)})})})}async function WCe(e){return(await cl(e)).filter(t=>!!t.value).map(t=>t.value)}function AE(e,t,i){const r=new AbortController;return Ma(i,()=>r.abort()),new Promise((s,n)=>{let o=setTimeout(()=>{o=0,s(t)},e);Ma(r,()=>{o&&(clearTimeout(o),n($i()))})})}function ah(e){return e&&typeof e.then=="function"}function oG(e){return ah(e)?e:Promise.resolve(e)}function khe(e,t=-1){let i,r,s,n,o=null;const a=(...l)=>{if(i){r=l,n&&n.reject($i()),n=Qv();const m=n.promise;if(o){const g=o;o=null,g.abort()}return m}if(s=n||Qv(),n=null,t>0){const m=new AbortController;i=oG(e(...l,m.signal));const g=i;AE(t).then(()=>{i===g&&(n?m.abort():o=m)})}else i=1,i=oG(e(...l));const c=()=>{const m=r;r=s=i=o=null,m!=null&&a(...m)},h=i,p=s;return h.then(c,c),h.then(p.resolve,p.reject),p.promise};return a}function Gp(){let e,t;const i=new Promise((s,n)=>{e=s,t=n}),r=s=>{e(s)};return r.resolve=s=>e(s),r.reject=s=>t(s),r.timeout=(s,n)=>Mk.setTimeout(()=>r.reject(n),s),r.promise=i,r}function N_t(e,t){return e.then(t,t)}function k3(e,t){let i,r=new AbortController;const s=e(r.signal);let n={promise:s,finished:!1,abort:()=>{r&&(r.abort(),r=null)}};const o=()=>{n&&(n.finished=!0,n=null),w(i)&&(i.remove(),i=null),r=null};return s.then(o,o),i=Ma(t,()=>{w(n)&&n.abort()}),n}async function GK(e){await Promise.resolve(),Ui(e)}function Uhe(e){return 1e3*e}function cZ(e){return .001*e}class ZCe{constructor(t){this.phases=t,this.paused=!1,this.ticks=-1,this.removed=!1}}class XCe{constructor(t){this.callback=t,this.isActive=!0}remove(){this.isActive=!1}}let aG=0,lG=0;const DA={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},cG=["prepare","preRender","render","postRender","update","finish"],uG=[],wx=new hi;class YCe{constructor(t){this._task=t}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const d4={frameTasks:wx,willDispatch:!1,clearFrameTasks:QCe,dispatch:Vhe,executeFrameTasks:KCe};function DC(e){const t=new XCe(e);return uG.push(t),d4.willDispatch||(d4.willDispatch=!0,CE(Vhe)),t}function xx(e){const t=new ZCe(e);return wx.push(t),p4==null&&(aG=performance.now(),p4=requestAnimationFrame(zhe)),new YCe(t)}let p4=null;function QCe(e=!1){wx.forAll(t=>{t.removed=!0}),e&&Bhe()}function JCe(e){lG=Math.max(0,e)}function zhe(){const e=performance.now();p4=null,p4=wx.length>0?requestAnimationFrame(zhe):null,d4.executeFrameTasks(e)}function KCe(e){const t=e-aG;aG=e;const i=lG>0?lG:1e3/60,r=Math.max(0,t-i);for(let s=0;s<cG.length;s++){const n=performance.now(),o=cG[s];wx.forAll(a=>{var l;a.paused||a.removed||(s===0&&a.ticks++,a.phases[o]&&(DA.time=e,DA.deltaTime=a.ticks===0?0:t,DA.elapsedFrameTime=performance.now()-e,DA.frameDuration=i-r,(l=a.phases[o])==null||l.call(a,DA)))}),eAe[s].record(performance.now()-n)}Bhe(),tAe.record(performance.now()-e)}const cL=new hi;function Bhe(){wx.forAll(e=>{e.removed&&cL.push(e)}),wx.removeUnorderedMany(cL.data,cL.length),cL.clear()}function Vhe(){for(;uG.length;){const e=uG.shift();e.isActive&&e.callback()}d4.willDispatch=!1}function F_t(e=1,t){const i=Gp(),r=()=>{An(t)?i.reject($i()):e===0?i():(--e,CE(()=>r()))};return r(),i.promise}const eAe=cG.map(e=>new Fv(e)),tAe=new Fv("total");function lN(e,t){for(const i of e.entries())if(t(i[0]))return!0;return!1}let iAe=0;const rAe=0;function Gl(){return++iAe}class Lk{constructor(t){this._notify=t,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const t=this._invalidCount;if(t===1)return this._invalidCount=0,void this._notify();this._invalidCount=t>0?t-1:0}onObservableAccessed(t){this._accessed.includes(t)||this._accessed.push(t)}onTrackingEnd(){const t=this._handles,i=this._accessed;for(let r=0;r<i.length;++r)t.push(i[r].observe(this));i.length=0}clear(){const t=this._handles;for(let i=0;i<t.length;++i)t[i].remove();t.length=0}}let K2=!1;const f4=[];function Ghe(e,t){let i=new Lk(n),r=null,s=!1;function n(){if(!i||s)return;if(K2)return void qhe(n);const a=r;i.clear(),K2=!0,s=!0,r=zy(i,e),s=!1,K2=!1,t(r,a),Whe()}function o(){i&&(i.destroy(),i=null,r=null)}return s=!0,r=zy(i,e),s=!1,{remove:o}}function jhe(e,t){let i=new Lk(s),r=null;function s(){t(r,o)}function n(){i&&(i.destroy(),i=null),r=null}function o(){return i?(i.clear(),r=zy(i,e),r):null}return o(),{remove:n}}function Hhe(e){let t=new Lk(r),i=!1;function r(){t&&!i&&(K2?qhe(r):(t.clear(),K2=!0,i=!0,zy(t,e),i=!1,K2=!1,Whe()))}function s(){t&&(t.destroy(),t=null)}return i=!0,zy(t,e),i=!1,{remove:s}}function qhe(e){f4.includes(e)||f4.unshift(e)}function Whe(){for(;f4.length;)f4.pop()()}var pM;(function(e){e[e.Untracked=0]="Untracked",e[e.Tracked=1]="Tracked"})(pM||(pM={}));class oP{constructor(){this.uid=Gl(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(t,i,r,s,n){return this.pool.acquire(pM.Untracked,t,i,r,s,n,rZ)}static acquireTracked(t,i,r,s){return this.pool.acquire(pM.Tracked,t,i,r,null,null,s)}notify(t,i){this.type===pM.Untracked?this.callback.call(this.target,t,i,this.path,this.target):this.callback.call(null,t,i)}acquire(t,i,r,s,n,o,a){this.uid=Gl(),this.removed=!1,this.type=t,this.oldValue=i,this.callback=r,this.getValue=s,this.target=n,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=Gl(),this.removed=!0}}oP.pool=new Dhe(oP);const cN=new Rc,Cy=new Set;let m4;function g4(e){Cy.delete(e),Cy.add(e),m4||(m4=DC(oAe))}function sAe(e){if(e.removed)return;const t=e.oldValue,i=e.getValue();e.equals(t,i)||(e.oldValue=i,e.notify(i,t))}function nAe(e){for(const t of Cy.values())t.target===e&&(t.removed=!0)}function oAe(){let e=10;for(;m4&&e--;){m4=null;const t=aAe(),i=cN.acquire();for(const r of t){const s=r.uid;sAe(r),s===r.uid&&r.removed&&i.push(r)}for(const r of Cy)r.removed&&(i.push(r),Cy.delete(r));for(const r of i)oP.pool.release(r);cN.release(i),cN.release(t),hG.forEach(r=>r())}}function aAe(){const e=cN.acquire();e.length=Cy.size;let t=0;for(const i of Cy)e[t]=i,++t;return Cy.clear(),e}const hG=new Set;function Zhe(e){return hG.add(e),{remove(){hG.delete(e)}}}function lAe(e,t,i){let r=The(e,t,i,(s,n,o)=>{let a,l,c=jhe(()=>D3(s,n),(h,p)=>{s.__accessor__.destroyed||a&&a.uid!==l?r.remove():(a||(a=oP.acquireUntracked(h,o,p,s,n),l=a.uid),g4(a))});return{remove:sZ(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,g4(a)),a=null),r=c=null})}});return r}function cAe(e,t,i){const r=The(e,t,i,(s,n,o)=>{let a=!1;return Ghe(()=>D3(s,n),(l,c)=>{s.__accessor__.destroyed?r.remove():a||(a=!0,rZ(c,l)||o.call(s,l,c,n,s),a=!1)})});return r}function uAe(e,t,i,r=!1){return!e.__accessor__||e.__accessor__.destroyed?{remove(){}}:r?cAe(e,t,i):lAe(e,t,i)}function hAe(e,t,i){let r,s,n=jhe(e,(o,a)=>{r&&r.uid!==s?n.remove():(r||(r=oP.acquireTracked(o,t,a,i),s=r.uid),g4(r))});return{remove:sZ(()=>{n.remove(),r&&(r.uid!==s||r.removed||(r.removed=!0,g4(r)),r=null),n=null})}}function dAe(e,t,i){let r=!1;return Ghe(e,(s,n)=>{r||(r=!0,i(n,s)||t(s,n),r=!1)})}function pAe(e,t,i=!1,r=fCe){return i?dAe(e,t,r):hAe(e,t,r)}function jK(e){return lN(Cy,t=>t.oldValue===e)}function On(e,t){for(const[i,r]of e)if(t(r,i))return!0;return!1}function k_t(e,t){for(const[i,r]of e)if(t(r,i))return r;return null}function uZ(e,t,i){const r=e.get(t);if(r!==void 0)return r;const s=i();return e.set(t,s),s}const eE=Ie.getLogger("esri.core.Accessor");function fAe(e){return e==null?e:new Date(e)}function mAe(e){return e==null?e:!!e}function U3(e){return e==null?e:e.toString()}function Kh(e){return e==null?e:(e=parseFloat(e),isNaN(e)?0:e)}function hZ(e){return e==null?e:Math.round(parseFloat(e))}function Xhe(e){return e&&e.constructor&&e.constructor.__accessorMetadata__!==void 0}function y4(e,t){return t!=null&&e&&!(t instanceof e)}function Yhe(e){return e&&"isCollection"in e}function HK(e){return e&&e.Type?typeof e.Type=="function"?e.Type:e.Type.base:null}function gAe(e,t){if(!t||!t.constructor||!Yhe(t.constructor))return dG(e,t)?t:new e(t);const i=HK(e.prototype.itemType),r=HK(t.constructor.prototype.itemType);return i?r?i===r?t:i.prototype.isPrototypeOf(r.prototype)?new e(t):(dG(e,t),t):new e(t):t}function dG(e,t){return!!Xhe(t)&&(eE.error("Accessor#set","Assigning an instance of '"+(t.declaredClass||"unknown")+"' which is not a subclass of '"+$k(e)+"'"),!0)}function OE(e,t){return t==null?t:Yhe(e)?gAe(e,t):y4(e,t)?dG(e,t)?t:new e(t):t}function $k(e){return e&&e.prototype&&e.prototype.declaredClass||"unknown"}const yAe=new WeakMap;function _Ae(e){switch(e){case Number:return Kh;case cs:return hZ;case Boolean:return mAe;case String:return U3;case Date:return fAe;default:return uZ(yAe,e,()=>OE.bind(null,e))}}function hn(e,t){const i=_Ae(e);return arguments.length===1?i:i(t)}function aP(e,t,i){return arguments.length===1?aP.bind(null,e):t&&(Array.isArray(t)?t.map(r=>e(r,i)):[e(t,i)])}function vAe(e,t){return arguments.length===1?aP(hn.bind(null,e)):aP(hn.bind(null,e),t)}function Qhe(e,t,i){return t!==0&&Array.isArray(i)?i.map(r=>Qhe(e,t-1,r)):e(i)}function _4(e,t,i){if(arguments.length===2)return _4.bind(null,e,t);if(!i)return i;let r=t,s=i=Qhe(e,t,i);for(;r>0&&Array.isArray(s);)r--,s=s[0];if(s!==void 0)for(let n=0;n<r;n++)i=[i];return i}function bAe(e,t,i){return arguments.length===2?_4(hn.bind(null,e),t):_4(hn.bind(null,e),t,i)}function Jhe(e){return!!Array.isArray(e)&&!e.some(t=>{const i=typeof t;return!(i==="string"||i==="number"||i==="function"&&e.length>1)})}function pG(e,t){if(arguments.length===2)return pG(e).call(null,t);const i=new Set,r=e.filter(a=>typeof a!="function"),s=e.filter(a=>typeof a=="function");for(const a of e)typeof a!="string"&&typeof a!="number"||i.add(a);let n=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,h=c==="string"||c==="number";return h&&(i.has(a)||s.some(p=>c==="string"&&p===String||c==="number"&&p===Number))||c==="object"&&s.some(p=>!y4(a,p))?a:(h&&r.length?(n||(n=r.map(p=>typeof p=="string"?`'${p}'`:`${p}`).join(", ")),eE.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${n}`)):typeof a=="object"&&s.length?(o||(o=s.map(p=>$k(p)).join(", ")),eE.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):eE.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function jp(e,t){if(arguments.length===2)return jp(e).call(null,t);const i={},r=[],s=[];for(const l in e.typeMap){const c=e.typeMap[l];i[l]=hn(c),r.push($k(c)),s.push(l)}const n=()=>`'${r.join("', '")}'`,o=()=>`'${s.join("', '")}'`,a=typeof e.key=="string"?l=>l[e.key]:e.key;return l=>{if(e.base&&!y4(e.base,l)||l==null)return l;const c=a(l)||e.defaultKeyValue,h=i[c];if(!h)return eE.error("Accessor#set",`Invalid property value, value needs to be one of ${n()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!y4(e.typeMap[c],l))return l;if(typeof e.key=="string"&&!Xhe(l)){const p={};for(const m in l)m!==e.key&&(p[m]=l[m]);return h(p)}return h(l)}}class cs{}const U_t={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})};function wAe(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1}function Khe(e){switch(e.type){case"native":return hn(e.value);case"array":return aP(Khe(e.value));case"one-of":return xAe(e);default:return null}}function xAe(e){let t=null;return(i,r)=>mG(i,e)?i:(t==null&&(t=fG(e)),eE.error("Accessor#set",`Invalid property value, value needs to be of type ${t}`),r&&(r.valid=!1),null)}function fG(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case cs:return"integer";case Date:return"date";default:return $k(e.value)}case"array":return`array of ${fG(e.value)}`;case"one-of":{const t=e.values.map(i=>fG(i));return`one of ${t.slice(0,t.length-1)} or ${t[t.length-1]}`}}return"unknown"}function mG(e,t){if(e==null)return!0;switch(t.type){case"native":switch(t.value){case Number:case cs:return typeof e=="number";case Boolean:return typeof e=="boolean";case String:return typeof e=="string"}return e instanceof t.value;case"array":return!!Array.isArray(e)&&!e.some(i=>!mG(i,t.value));case"one-of":return t.values.some(i=>mG(e,i))}}function f(e={}){return(t,i)=>{if(t===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${t.name}.${i}. Accessor does not support static properties.`);const r=Object.getOwnPropertyDescriptor(t,i),s=Ok(t,i);r&&(r.get||r.set?(s.get=r.get||s.get,s.set=r.set||s.set):"value"in r&&("value"in e&&Ie.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${i}" on "${t.constructor.name}" already defined in the metadata`,e),s.value=e.value=r.value)),e.readOnly!=null&&(s.readOnly=e.readOnly);const n=e.aliasOf;if(n){const l=typeof n=="string"?n:n.source,c=typeof n=="string"?null:n.overridable===!0;let h;s.dependsOn=[l],s.get=function(){let p=l4(this,l);if(typeof p=="function"){h||(h=l.split(".").slice(0,-1).join("."));const m=l4(this,h);m&&(p=p.bind(m))}return p},s.readOnly||(s.set=c?function(p){p!==void 0?this._override(i,p):this._clearOverride(i)}:function(p){h4(this,l,p)})}const o=e.type,a=e.types;s.cast||(o?s.cast=TAe(o):a&&(Array.isArray(a)?s.cast=aP(jp(a[0])):s.cast=jp(a))),e.range&&(s.cast=SAe(s.cast,e.range)),wCe(s,e)}}function ede(e,t,i){const r=Ok(e,i);r.json||(r.json={});let s=r.json;return t!==void 0&&(s.origins||(s.origins={}),s.origins[t]||(s.origins[t]={}),s=s.origins[t]),s}function TAe(e){let t=0,i=e;if(wAe(e))return Khe(e);for(;Array.isArray(i)&&i.length===1&&typeof i[0]!="string"&&typeof i[0]!="number";)i=i[0],t++;const r=i;if(Jhe(r))return t===0?pG(r):_4(pG(r),t);if(t===1)return vAe(r);if(t>1)return bAe(r,t);const s=e;return s.from?s.from:hn(s)}function SAe(e,t){return i=>{let r=+e(i);return t.step!=null&&(r=Math.round(r/t.step)*t.step),t.min!=null&&(r=Math.max(t.min,r)),t.max!=null&&(r=Math.min(t.max,r)),r}}function EAe(e){if(e.json&&e.json.origins){const t=e.json.origins,i={"web-document":["web-scene","web-map"]};for(const r in i)if(t[r]){const s=t[r];i[r].forEach(n=>{t[n]=s}),delete t[r]}}}class Ju extends Rk{constructor(t,i,r){if(super(t,i,r),!(this instanceof Ju))return new Ju(t,i,r)}}Ju.prototype.type="warning";function tde(e){return!!e&&e.prototype&&e.prototype.declaredClass&&e.prototype.declaredClass.indexOf("esri.core.Collection")===0}const gG=Ie.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function qK(e,t,i){var r,s;e&&(!i&&!t.read||((r=t.read)==null?void 0:r.reader)||((s=t.read)==null?void 0:s.enabled)===!1||OAe(e)&&zc("read.reader",NC(e),t))}function NC(e){var i,r,s;const t=(i=e.ndimArray)!=null?i:0;if(t>1)return AAe(e);if(t===1)return WK(e);if("type"in e&&rde(e.type)){const n=(s=(r=e.type.prototype)==null?void 0:r.itemType)==null?void 0:s.Type,o=WK(typeof n=="function"?{type:n}:{types:n});return(a,l,c)=>{const h=o(a,l,c);return h&&new e.type(h)}}return dZ(e)}function dZ(e){return"type"in e?CAe(e.type):RAe(e.types)}function CAe(e){return e.prototype.read?(t,i,r)=>{if(t==null)return t;const s=typeof t;if(s!=="object")return void gG.error(`Expected JSON value of type 'object' to deserialize type '${e.prototype.declaredClass}', but got '${s}'`);const n=new e;return n.read(t,r),n}:e.fromJSON}function ide(e,t,i,r){return r!==0&&Array.isArray(t)?t.map(s=>ide(e,s,i,r-1)):e(t,void 0,i)}function AAe(e){var s;const t=dZ(e),i=ide.bind(null,t),r=(s=e.ndimArray)!=null?s:0;return(n,o,a)=>{if(n==null)return n;n=i(n,a,r);let l=r,c=n;for(;l>0&&Array.isArray(c);)l--,c=c[0];if(c!==void 0)for(let h=0;h<l;h++)n=[n];return n}}function WK(e){const t=dZ(e);return(i,r,s)=>{if(i==null)return i;if(Array.isArray(i)){const o=[];for(const a of i){const l=t(a,void 0,s);l!==void 0&&o.push(l)}return o}const n=t(i,void 0,s);return n!==void 0?[n]:void 0}}function rde(e){if(!tde(e))return!1;const t=e.prototype.itemType;return!(!t||!t.Type)&&(typeof t.Type=="function"?pZ(t.Type):sde(t.Type))}function OAe(e){return"types"in e?sde(e.types):pZ(e.type)}function pZ(e){return!Array.isArray(e)&&!!e&&e.prototype&&("read"in e.prototype||"fromJSON"in e||rde(e))}function sde(e){for(const t in e.typeMap)if(!pZ(e.typeMap[t]))return!1;return!0}function RAe(e){var r;let t=null;const i=(r=e.errorContext)!=null?r:"type";return(s,n,o)=>{if(s==null)return s;const a=typeof s;if(a!=="object")return void gG.error(`Expected JSON value of type 'object' to deserialize, but got '${a}'`);t||(t=MAe(e));const l=e.key;if(typeof l!="string")return;const c=s[l],h=c?t[c]:e.defaultKeyValue?e.typeMap[e.defaultKeyValue]:void 0;if(!h){const m=`Type '${c||"unknown"}' is not supported`;return o&&o.messages&&s&&o.messages.push(new Ju(`${i}:unsupported`,m,{definition:s,context:o})),void gG.error(m)}const p=new h;return p.read(s,o),p}}function MAe(e){var i,r;const t={};for(const s in e.typeMap){const n=e.typeMap[s],o=N3(n.prototype);if(typeof e.key=="function")continue;const a=o.properties[e.key];if(!a)continue;((i=a.json)==null?void 0:i.type)&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(t[a.json.type[0]]=n);const l=(r=a.json)==null?void 0:r.write;if(!l||!l.writer){t[s]=n;continue}const c=l.target,h=typeof c=="string"?c:e.key,p={};l.writer(s,p,h),p[h]&&(t[p[h]]=n)}return t}function PAe(e){if(e.json||(e.json={}),XK(e.json),YK(e.json),ZK(e.json),e.json.origins)for(const t in e.json.origins)XK(e.json.origins[t]),YK(e.json.origins[t]),ZK(e.json.origins[t]);return!0}function ZK(e){e.name&&(e.read&&typeof e.read=="object"?e.read.source===void 0&&(e.read.source=e.name):e.read={source:e.name},e.write&&typeof e.write=="object"?e.write.target===void 0&&(e.write.target=e.name):e.write={target:e.name})}function XK(e){typeof e.read=="boolean"?e.read={enabled:e.read}:typeof e.read=="function"?e.read={enabled:!0,reader:e.read}:e.read&&typeof e.read=="object"&&e.read.enabled===void 0&&(e.read.enabled=!0)}function YK(e){typeof e.write=="boolean"?e.write={enabled:e.write}:typeof e.write=="function"?e.write={enabled:!0,writer:e.write}:e.write&&typeof e.write=="object"&&e.write.enabled===void 0&&(e.write.enabled=!0)}const IAe=Ie.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function QK(e,t){var r;if(!t.write||t.write.writer||t.write.enabled===!1&&!t.write.overridePolicy)return;const i=(r=e==null?void 0:e.ndimArray)!=null?r:0;e&&(i===1||"type"in e&&tde(e.type))?t.write.writer=DAe:i>1?t.write.writer=NAe(i):t.types?Array.isArray(t.types)?t.write.writer=$Ae(t.types[0]):t.write.writer=LAe(t.types):t.write.writer=lP}function LAe(e){return(t,i,r,s)=>t?nde(t,e,s)?lP(t,i,r,s):void 0:lP(t,i,r,s)}function nde(e,t,i){var r,s;for(const n in t.typeMap)if(e instanceof t.typeMap[n])return!0;if(i!=null&&i.messages){const n=(r=t.errorContext)!=null?r:"type",o=`Values of type '${(s=typeof t.key!="function"?e[t.key]:e.declaredClass)!=null?s:"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new se(`${n}:unsupported`,o,{definition:e,context:i})),IAe.error(o)}return!1}function $Ae(e){return(t,i,r,s)=>!t||!Array.isArray(t)?lP(t,i,r,s):lP(t.filter(n=>nde(n,e,s)),i,r,s)}function lP(e,t,i,r){zc(i,v4(e,r),t)}function v4(e,t){return e&&typeof e.write=="function"?e.write({},t):e&&typeof e.toJSON=="function"?e.toJSON():typeof e=="number"?b4(e):e}function b4(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function DAe(e,t,i,r){let s;e===null?s=null:e&&typeof e.map=="function"?(s=e.map(n=>v4(n,r)),typeof s.toArray=="function"&&(s=s.toArray())):s=[v4(e,r)],zc(i,s,t)}function ode(e,t,i){return i!==0&&Array.isArray(e)?e.map(r=>ode(r,t,i-1)):v4(e,t)}function NAe(e){return(t,i,r,s)=>{let n;if(t===null)n=null;else{n=ode(t,s,e);let o=e,a=n;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)n=[n]}zc(r,n,i)}}function yG(e,t){return fZ(e,"read",t)}function ade(e,t){return fZ(e,"write",t)}function fZ(e,t,i){let r=e&&e.json;if(e&&e.json&&e.json.origins&&i){const s=e.json.origins[i.origin];s&&(t==="any"||t in s)&&(r=s)}return r}function FAe(e){const t=kAe(e);if(e.json.origins)for(const i in e.json.origins){const r=e.json.origins[i],s=r.types?UAe(r):t;qK(s,r,!1),r.types&&!r.write&&e.json.write&&e.json.write.enabled&&(r.write={...e.json.write}),QK(s,r)}qK(t,e.json,!0),QK(t,e.json)}function kAe(e){return e.json.types?_G(e.json):e.type?lde(e):_G(e)}function UAe(e){return e.type?lde(e):_G(e)}function lde(e){if(!e.type)return;let t=0,i=e.type;for(;Array.isArray(i)&&!Jhe(i);)i=i[0],t++;return{type:i,ndimArray:t}}function _G(e){if(!e.types)return;let t=0,i=e.types;for(;Array.isArray(i);)i=i[0],t++;return{types:i,ndimArray:t}}function zAe(e){PAe(e)&&(EAe(e),FAe(e))}const eV=new Set,tV=new Set;function B(e){return t=>{t.prototype.declaredClass=e,VAe(t);const i=[],r=[];let s=t.prototype;for(;s;)s.hasOwnProperty("initialize")&&!eV.has(s.initialize)&&(eV.add(s.initialize),i.push(s.initialize)),s.hasOwnProperty("destroy")&&!tV.has(s.destroy)&&(tV.add(s.destroy),r.push(s.destroy)),s=Object.getPrototypeOf(s);eV.clear(),tV.clear();class n extends t{constructor(...a){if(super(...a),this.constructor===n&&typeof this.postscript=="function"){if(i.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=i.length-1;l>=0;l--)i[l].call(this)}}),r.length){let l=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0;for(let c=0;c<r.length;c++)r[c].call(this)}}})}this.postscript(...a)}}}return n.__accessorMetadata__=N3(t.prototype),n.prototype.declaredClass=e,n}}function BAe(e,t){return t.get==null?function(){const i=this.__accessor__.properties.get(e);if(i===void 0)return;_i(i);const r=this.__accessor__.store;return r.has(e)?r.get(e):i.metadata.value}:function(){const i=this.__accessor__.properties.get(e);if(i!==void 0)return i.getComputed()}}function VAe(e){const t=e.prototype,i=N3(t).properties,r={};for(const s of Object.getOwnPropertyNames(i)){const n=i[s];zAe(n),r[s]={enumerable:!0,configurable:!0,get:BAe(s,n),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&n.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${s}' of ${this.declaredClass}`);if(a.lifecycle===lm.CONSTRUCTED&&n.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${s}' of ${this.declaredClass}`);a.set(s,o)}}else Object.defineProperty(this,s,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(e.prototype,r)}var cde;function GAe(e){var t;if(e==null)return{value:e};if(Array.isArray(e))return{type:[e[0]],value:null};switch(typeof e){case"object":return((t=e.constructor)==null?void 0:t.__accessorMetadata__)||e instanceof Date?{type:e.constructor,value:e}:e;case"boolean":return{type:Boolean,value:e};case"string":return{type:String,value:e};case"number":return{type:Number,value:e};case"function":return{type:e,value:null};default:return}}const QO=Symbol("Accessor-Handles");class ze{constructor(...t){if(this[cde]=null,this.constructor===ze)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new ICe(this)}),t.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,t))}static createSubclass(t={}){if(Array.isArray(t))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:i,declaredClass:r,constructor:s}=t;delete t.declaredClass,delete t.properties,delete t.constructor;const n=this;class o extends n{constructor(...l){super(...l),this.inherited=null,s&&s.apply(this,l)}}N3(o.prototype);for(const a in t){const l=t[a];o.prototype[a]=typeof l=="function"?function(...c){const h=this.inherited;let p;this.inherited=function(...m){if(n.prototype[a])return n.prototype[a].apply(this,m)};try{p=l.apply(this,c)}catch(m){throw this.inherited=h,m}return this.inherited=h,p}:t[a]}for(const a in i){const l=GAe(i[a]);f(l)(o.prototype,a)}return B(r)(o)}postscript(t){const i=this.__accessor__,r=i.ctorArgs||t;i.initialize(),r&&(this.set(r),i.ctorArgs=null),i.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||(Cn(this[QO],t=>{t.forEach(i=>i.remove())}),this[QO]=null,nAe(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===lm.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(t){this.get(t)}get(t){return l4(this,t)}hasOwnProperty(t){return this.__accessor__?this.__accessor__.has(t):Object.prototype.hasOwnProperty.call(this,t)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(t,i){return h4(this,t,i),this}watch(t,i,r){return uAe(this,t,i,r)}own(t){let i=this[QO];if(N(i)&&(i=this[QO]=new Set),ahe(t))for(const r of t)i.add(r);else i.add(t)}_clearOverride(t){return this.__accessor__.clearOverride(t)}_override(t,i){return this.__accessor__.override(t,i)}_isOverridden(t){return this.__accessor__.isOverridden(t)}notifyChange(t){this.__accessor__.notifyChange(t)}_get(t){return this.__accessor__.internalGet(t)}_set(t,i){return this.__accessor__.internalSet(t,i),this}}cde=QO;Ie.getLogger("esri.core.Clonable");const Hc=e=>{let t=class extends e{clone(){var l;const i=KEe(ll(this),"unable to clone instance of non-accessor class"),r=i.metadatas,s=i.store,n={},o=new Map;for(const c in r){const h=r[c],p=s==null?void 0:s.originOf(c),m=h.clonable;if(h.readOnly||m===!1||p!==Yi.USER&&p!==Yi.DEFAULTS&&p!==Yi.WEB_MAP&&p!==Yi.WEB_SCENE)continue;const g=this[c];let v=null;v=typeof m=="function"?m(g):m==="reference"?g:tG(g),g!=null&&v==null||(p===Yi.DEFAULTS?o.set(c,v):n[c]=v)}const a=new(Object.getPrototypeOf(this)).constructor(n);if(o.size){const c=(l=ll(a))==null?void 0:l.store;if(c)for(const[h,p]of o)c.set(h,p,Yi.DEFAULTS)}return a}};return t=u([B("esri.core.Clonable")],t),t};let JK=class extends Hc(ze){};JK=u([B("esri.core.Clonable")],JK);function F(){return[0,0,0]}function un(e){return[e[0],e[1],e[2]]}function Ke(e,t,i){return[e,t,i]}function $l(e){const t=F(),i=Math.min(3,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function mZ(e,t){return new Float64Array(e,t,3)}function ude(){return F()}function hde(){return Ke(1,1,1)}function dde(){return Ke(1,0,0)}function pde(){return Ke(0,1,0)}function gZ(){return Ke(0,0,1)}const ol=ude(),pm=hde(),jAe=dde(),HAe=pde(),fde=gZ();Object.freeze(Object.defineProperty({__proto__:null,create:F,clone:un,fromValues:Ke,fromArray:$l,createView:mZ,zeros:ude,ones:hde,unitX:dde,unitY:pde,unitZ:gZ,ZEROS:ol,ONES:pm,UNIT_X:jAe,UNIT_Y:HAe,UNIT_Z:fde},Symbol.toStringTag,{value:"Module"}));const Gt=1e-6,Cp=Math.random,qAe=Math.PI/180,WAe=180/Math.PI;function Dk(e){return e*qAe}function ZAe(e){return e*WAe}function XAe(e,t){return Math.abs(e-t)<=Gt*Math.max(1,Math.abs(e),Math.abs(t))}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:Gt,RANDOM:Cp,toRadian:Dk,toDegree:ZAe,equals:XAe},Symbol.toStringTag,{value:"Module"}));function He(e){const t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function ve(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function fe(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function Oe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function Me(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function Nk(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function w4(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function YAe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function QAe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function vG(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function mde(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function gde(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function JAe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function KAe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function be(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function kw(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function Pr(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(i*i+r*r+s*s)}function Yn(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function rl(e){const t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function Ra(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function eOe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function De(e,t){const i=t[0],r=t[1],s=t[2];let n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n),e}function ke(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function St(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];return e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o,e}function Nn(e,t,i,r){const s=t[0],n=t[1],o=t[2];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e}function tOe(e,t,i,r,s,n){const o=n*n,a=o*(2*n-3)+1,l=o*(n-2)+n,c=o*(n-1),h=o*(3-2*n);return e[0]=t[0]*a+i[0]*l+r[0]*c+s[0]*h,e[1]=t[1]*a+i[1]*l+r[1]*c+s[1]*h,e[2]=t[2]*a+i[2]*l+r[2]*c+s[2]*h,e}function iOe(e,t,i,r,s,n){const o=1-n,a=o*o,l=n*n,c=a*o,h=3*n*a,p=3*l*o,m=l*n;return e[0]=t[0]*c+i[0]*h+r[0]*p+s[0]*m,e[1]=t[1]*c+i[1]*h+r[1]*p+s[1]*m,e[2]=t[2]*c+i[2]*h+r[2]*p+s[2]*m,e}function rOe(e,t){t=t||1;const i=2*Cp()*Math.PI,r=2*Cp()-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e[2]=r*t,e}function et(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12],e[1]=i[1]*r+i[5]*s+i[9]*n+i[13],e[2]=i[2]*r+i[6]*s+i[10]*n+i[14],e}function $c(e,t,i){const r=t[0],s=t[1],n=t[2];return e[0]=r*i[0]+s*i[3]+n*i[6],e[1]=r*i[1]+s*i[4]+n*i[7],e[2]=r*i[2]+s*i[5]+n*i[8],e}function ju(e,t,i){const r=i[0],s=i[1],n=i[2],o=i[3],a=t[0],l=t[1],c=t[2];let h=s*c-n*l,p=n*a-r*c,m=r*l-s*a,g=s*m-n*p,v=n*h-r*m,b=r*p-s*h;const S=2*o;return h*=S,p*=S,m*=S,g*=2,v*=2,b*=2,e[0]=a+h+g,e[1]=l+p+v,e[2]=c+m+b,e}function sOe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0],n[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),n[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function nOe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),n[1]=s[1],n[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function oOe(e,t,i,r){const s=[],n=[];return s[0]=t[0]-i[0],s[1]=t[1]-i[1],s[2]=t[2]-i[2],n[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),n[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),n[2]=s[2],e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function aOe(e,t){ve(uL,e),ve(hL,t),De(uL,uL),De(hL,hL);const i=ke(uL,hL);return i>1?0:i<-1?Math.PI:Math.acos(i)}const uL=F(),hL=F();function lOe(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function zl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Tx(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=t[0],o=t[1],a=t[2];return Math.abs(i-n)<=Gt*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=Gt*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=Gt*Math.max(1,Math.abs(s),Math.abs(a))}function t0(e,t,i){const r=i[0]-t[0],s=i[1]-t[1],n=i[2]-t[2];let o=r*r+s*s+n*n;return o>0?(o=1/Math.sqrt(o),e[0]=r*o,e[1]=s*o,e[2]=n*o,e):(e[0]=0,e[1]=0,e[2]=0,e)}const Bc=Me,cOe=Nk,uOe=w4,yZ=Pr,_Z=Yn,vZ=He,bG=rl,KK=Object.freeze(Object.defineProperty({__proto__:null,length:He,copy:ve,set:fe,add:Oe,subtract:Me,multiply:Nk,divide:w4,ceil:YAe,floor:QAe,abs:vG,sign:mde,min:gde,max:JAe,round:KAe,scale:be,scaleAndAdd:kw,distance:Pr,squaredDistance:Yn,squaredLength:rl,negate:Ra,inverse:eOe,normalize:De,dot:ke,cross:St,lerp:Nn,hermite:tOe,bezier:iOe,random:rOe,transformMat4:et,transformMat3:$c,transformQuat:ju,rotateX:sOe,rotateY:nOe,rotateZ:oOe,angle:aOe,str:lOe,exactEquals:zl,equals:Tx,direction:t0,sub:Bc,mul:cOe,div:uOe,dist:yZ,sqrDist:_Z,len:vZ,sqrLen:bG},Symbol.toStringTag,{value:"Module"}));function Ap(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function _r(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function bZ(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function yde(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function _de(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function vde(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function hOe(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function dOe(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function pOe(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function fOe(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function mOe(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function z3(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function gOe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function bde(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return Math.sqrt(i*i+r*r+s*s+n*n)}function x4(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],n=t[3]-e[3];return i*i+r*r+s*s+n*n}function wZ(e){const t=e[0],i=e[1],r=e[2],s=e[3];return Math.sqrt(t*t+i*i+r*r+s*s)}function xZ(e){const t=e[0],i=e[1],r=e[2],s=e[3];return t*t+i*i+r*r+s*s}function yOe(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function _Oe(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function wde(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*i+r*r+s*s+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=i*o,e[1]=r*o,e[2]=s*o,e[3]=n*o),e}function xde(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Fk(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e[2]=o+r*(i[2]-o),e[3]=a+r*(i[3]-a),e}function vOe(e,t){let i,r,s,n,o,a;t=t||1;do i=2*Cp()-1,r=2*Cp()-1,o=i*i+r*r;while(o>=1);do s=2*Cp()-1,n=2*Cp()-1,a=s*s+n*n;while(a>=1);const l=Math.sqrt((1-o)/a);return e[0]=t*i,e[1]=t*r,e[2]=t*s*l,e[3]=t*n*l,e}function zu(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3];return e[0]=i[0]*r+i[4]*s+i[8]*n+i[12]*o,e[1]=i[1]*r+i[5]*s+i[9]*n+i[13]*o,e[2]=i[2]*r+i[6]*s+i[10]*n+i[14]*o,e[3]=i[3]*r+i[7]*s+i[11]*n+i[15]*o,e}function bOe(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2],c=i[3],h=c*r+a*n-l*s,p=c*s+l*r-o*n,m=c*n+o*s-a*r,g=-o*r-a*s-l*n;return e[0]=h*c+g*-o+p*-l-m*-a,e[1]=p*c+g*-a+m*-o-h*-l,e[2]=m*c+g*-l+h*-a-p*-o,e[3]=t[3],e}function wOe(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function cP(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Tde(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Gt*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Gt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Gt*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Gt*Math.max(1,Math.abs(n),Math.abs(c))}const xOe=yde,TOe=_de,SOe=vde,EOe=bde,COe=x4,AOe=wZ,OOe=xZ,Sde=Object.freeze(Object.defineProperty({__proto__:null,copy:Ap,set:_r,add:bZ,subtract:yde,multiply:_de,divide:vde,ceil:hOe,floor:dOe,min:pOe,max:fOe,round:mOe,scale:z3,scaleAndAdd:gOe,distance:bde,squaredDistance:x4,length:wZ,squaredLength:xZ,negate:yOe,inverse:_Oe,normalize:wde,dot:xde,lerp:Fk,random:vOe,transformMat4:zu,transformQuat:bOe,str:wOe,exactEquals:cP,equals:Tde,sub:xOe,mul:TOe,div:SOe,dist:EOe,sqrDist:COe,len:AOe,sqrLen:OOe},Symbol.toStringTag,{value:"Module"})),eee=new Float32Array(1);function RE(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}function Xe(e,t,i){return Math.min(Math.max(e,t),i)}function ME(e){return(e&e-1)==0}function z_t(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e}function B_t(e){return 10**Math.ceil(Math.LOG10E*Math.log(e))}function fi(e,t,i){return e+(t-e)*i}function Jt(e){return e*Math.PI/180}function Vc(e){return 180*e/Math.PI}function wG(e,t=1e-6){return(e<0?-1:1)/Math.max(Math.abs(e),t)}function Fn(e){return Math.acos(Xe(e,-1,1))}function Hp(e){return Math.asin(Xe(e,-1,1))}function ROe(e,t,i=1e-6){if(isNaN(e)||isNaN(t))return!1;if(e===t)return!0;const r=Math.abs(e-t),s=Math.abs(e),n=Math.abs(t);if(e===0||t===0||s<1e-12&&n<1e-12){if(r>.01*i)return!1}else if(r/(s+n)>i)return!1;return!0}function tE(e,t,i=1e-6){return isNaN(e)||isNaN(t)?!1:(e>t?e-t:t-e)<=i}function MOe(e){return Ede(Math.max(-xG,Math.min(e,xG)))}function Ede(e){return eee[0]=e,eee[0]}function PE(e,t,i){const r=Xe((i-e)/(t-e),0,1);return r*r*(3-2*r)}function tee(e,t){const i=He(e),r=Hp(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return fe(t,i,r,s),t}function V_t(e,t,i){return _r(e,t[0],t[1],t[2],t[3]*i)}function G_t(e){const t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[3]*e[3]+e[4]*e[4]+e[5]*e[5],r=e[6]*e[6]+e[7]*e[7]+e[8]*e[8];return!(tE(t,1)&&tE(i,1)&&tE(r,1))}const xG=Ede(34028234663852886e22);class Jv{constructor(t,i){this.min=t,this.max=i,this.range=i-t}ndiff(t,i=0){return Math.ceil((t-i)/this.range)*this.range+i}_normalize(t,i,r,s=0,n=!1){return(r-=s)<t?r+=this.ndiff(t-r):r>i&&(r-=this.ndiff(r-i)),n&&r===i&&(r=t),r+s}normalize(t,i=0,r=!1){return this._normalize(this.min,this.max,t,i,r)}clamp(t,i=0){return Xe(t-i,this.min,this.max)+i}monotonic(t,i,r){return t<i?i:i+this.ndiff(t-i,r)}minimalMonotonic(t,i,r){return this._normalize(t,t+this.range,i,r)}center(t,i,r){return i=this.monotonic(t,i,r),this.normalize((t+i)/2,r)}diff(t,i,r){return this.monotonic(t,i,r)-t}shortestSignedDiff(t,i){t=this.normalize(t);const r=(i=this.normalize(i))-t,s=i<t?this.minimalMonotonic(t,i)-t:i-this.minimalMonotonic(i,t);return Math.abs(r)<Math.abs(s)?r:s}contains(t,i,r){return i=this.minimalMonotonic(t,i),(r=this.minimalMonotonic(t,r))>t&&r<i}}function TZ(e){for(const t in e){const i=e[t];i instanceof Function&&(e[t]=i.bind(e))}return e}const POe=TZ(new Jv(0,2*Math.PI)),Kv=TZ(new Jv(-Math.PI,Math.PI)),SZ=TZ(new Jv(0,360));class EZ{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(t){const i=new EZ;return this._values.forEach((r,s)=>{t&&t.has(s)||i.set(s,me(r.value),r.origin)}),i}get(t,i){i=this._normalizeOrigin(i);const r=this._values.get(t);return i==null||(r==null?void 0:r.origin)===i?r==null?void 0:r.value:void 0}originOf(t){var i,r;return(r=(i=this._values.get(t))==null?void 0:i.origin)!=null?r:Yi.USER}keys(t){t=this._normalizeOrigin(t);const i=[...this._values.keys()];return t==null?i:i.filter(r=>{var s;return((s=this._values.get(r))==null?void 0:s.origin)===t})}set(t,i,r){if((r=this._normalizeOrigin(r))===Yi.DEFAULTS){const s=this._values.get(t);if(s&&s.origin!=null&&s.origin>r)return}this._values.set(t,new IOe(i,r))}delete(t,i){var r;(i=this._normalizeOrigin(i))!=null&&((r=this._values.get(t))==null?void 0:r.origin)!==i||this._values.delete(t)}has(t,i){var r;return(i=this._normalizeOrigin(i))!=null?((r=this._values.get(t))==null?void 0:r.origin)===i:this._values.has(t)}forEach(t){this._values.forEach(({value:i},r)=>t(i,r))}_normalizeOrigin(t){if(t!=null)return t===Yi.DEFAULTS?t:Yi.USER}}class IOe{constructor(t,i){this.value=t,this.origin=i}}function Cde(e,t,i){t.keys().forEach(s=>{i.set(s,t.get(s),Yi.DEFAULTS)});const r=e.metadatas;Object.keys(r).forEach(s=>{e.internalGet(s)&&i.set(s,e.internalGet(s),Yi.DEFAULTS)})}function LOe(e,t,i){if(!e||!e.read||e.read.enabled===!1||!e.read.source)return!1;const r=e.read.source;if(typeof r=="string"){if(r===t||r.includes(".")&&r.indexOf(t)===0&&LK(r,i))return!0}else for(const s of r)if(s===t||s.includes(".")&&s.indexOf(t)===0&&LK(s,i))return!0;return!1}function $Oe(e){return e&&(!e.read||e.read.enabled!==!1&&!e.read.source)}function DOe(e,t,i,r,s){let n=yG(t[i],s);$Oe(n)&&(e[i]=!0);for(const o of Object.getOwnPropertyNames(t))n=yG(t[o],s),LOe(n,i,r)&&(e[o]=!0)}function NOe(e,t,i,r){const s=i.metadatas,n=fZ(s[t],"any",r),o=n&&n.default;if(o===void 0)return;const a=typeof o=="function"?o.call(e,t,r):o;a!==void 0&&i.set(t,a)}const Ade={origin:"service"};function Ode(e,t,i=Ade){if(!t||typeof t!="object")return;const r=ll(e),s=r.metadatas,n={};for(const o of Object.getOwnPropertyNames(t))DOe(n,s,o,t,i);r.setDefaultOrigin(i.origin);for(const o of Object.getOwnPropertyNames(n)){const a=yG(s[o],i).read,l=a&&a.source;let c;c=l&&typeof l=="string"?D3(t,l):t[o],a&&a.reader&&(c=a.reader.call(e,c,t,i)),c!==void 0&&r.set(o,c)}if(!i||!i.ignoreDefaults){r.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(s))n[o]||NOe(e,o,r,i)}r.setDefaultOrigin("user")}function FOe(e,t,i,r=Ade){var n;const s={...r,messages:[]};i(s),(n=s.messages)==null||n.forEach(o=>{o.type!=="warning"||e.loaded?r&&r.messages&&r.messages.push(o):e.loadWarnings.push(o)})}const kOe=Ie.getLogger("esri.core.accessorSupport.write");function UOe(e,t,i,r,s){var o,a;const n={};return(a=(o=t.write)==null?void 0:o.writer)==null||a.call(e,r,n,i,s),n}function Rde(e,t,i,r,s,n){if(!r||!r.write)return!1;const o=e.get(i);if(!s&&r.write.overridePolicy){const a=r.write.overridePolicy.call(e,o,i,n);a!==void 0&&(s=a)}if(s||(s=r.write),!s||s.enabled===!1)return!1;if((o===null&&!s.allowNull&&!s.writerEnsuresNonNull||o===void 0)&&s.isRequired){const a=new se("web-document-write:property-required",`Missing value for required property '${i}' on '${e.declaredClass}'`,{propertyName:i,target:e});return a&&n&&n.messages?n.messages.push(a):a&&!n&&kOe.error(a.name,a.message),!1}return!(o===void 0||o===null&&!s.allowNull&&!s.writerEnsuresNonNull||(!t.store.multipleOriginsSupported||t.store.originOf(i)===Yi.DEFAULTS)&&zOe(e,i,n,r,o)||!s.ignoreOrigin&&n&&n.origin&&t.store.multipleOriginsSupported&&t.store.originOf(i)<yv(n.origin))}function zOe(e,t,i,r,s){const n=r.default;if(n===void 0)return!1;if(r.defaultEquals!=null)return r.defaultEquals(s);if(typeof n=="function"){if(Array.isArray(s)){const o=n.call(e,t,i);return Yv(o,s)}return!1}return n===s}function BOe(e,t,i,r){const s=ll(e),n=s.metadatas,o=ade(n[t],r);return!!o&&Rde(e,s,t,o,i,r)}function Mde(e,t,i){var n,o;if(e&&typeof e.toJSON=="function"&&(!e.toJSON.isDefaultToJSON||!e.write))return nN(t,e.toJSON(i));const r=ll(e),s=r.metadatas;for(const a in s){const l=ade(s[a],i);if(!Rde(e,r,a,l,void 0,i))continue;const c=e.get(a),h=UOe(e,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,i);Object.keys(h).length>0&&(t=nN(t,h),(o=(n=i==null?void 0:i.resources)==null?void 0:n.pendingOperations)!=null&&o.length&&Promise.all(i.resources.pendingOperations).then(()=>nN(t,h)),i&&i.writtenProperties&&i.writtenProperties.push({target:e,propName:a,oldOrigin:ACe(r.store.originOf(a)),newOrigin:i.origin}))}return t}const B3=e=>{let t=class extends e{constructor(...i){super(...i);const r=ll(this),s=r.store,n=new EZ;r.store=n,Cde(r,s,n)}read(i,r){Ode(this,i,r)}write(i={},r){return Mde(this,i,r)}toJSON(i){return this.write({},i)}static fromJSON(i,r){return VOe.call(this,i,r)}};return t=u([B("esri.core.JSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function VOe(e,t){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const i=new this;return i.read(e,t),i}let Fe=class extends B3(ze){};Fe=u([B("esri.core.JSONSupport")],Fe);const GOe=Object.prototype.toString;function jOe(e){const t="__accessorMetadata__"in e?hn(e):e;return function(...i){if(i.push(t),typeof i[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return HOe.apply(this,i)}}function HOe(e,t,i,r){Ok(e,t).cast=r}function qOe(e){return(t,i)=>{Ok(t,e).cast=t[i]}}function pi(...e){if(e.length!==3||typeof e[1]!="string")return e.length===1&&GOe.call(e[0])==="[object Function]"?jOe(e[0]):e.length===1&&typeof e[0]=="string"?qOe(e[0]):void 0}function it(e,t,i){let r,s;return t===void 0||Array.isArray(t)?(s=e,i=t,r=[void 0]):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;r.forEach(l=>{const c=ede(n,l,s);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],i&&(c.read.source=(c.read.source||[]).concat(i))})}}function ut(e,t,i){let r,s;return t===void 0?(s=e,r=[void 0]):typeof t!="string"?(s=e,r=[void 0],i=t):(s=t,r=Array.isArray(e)?e:[e]),(n,o)=>{const a=n.constructor.prototype;for(const l of r){const c=ede(n,l,s);c.write&&typeof c.write=="object"||(c.write={}),i&&(c.write.target=i),c.write.writer=a[o]}}}var nd;(function(e){e[e.CGCS2000=4490]="CGCS2000",e[e.GCSMARS2000=104971]="GCSMARS2000",e[e.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",e[e.GCSMOON2000=104903]="GCSMOON2000"})(nd||(nd={}));let _;const H={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(_=2e3;_<=2045;_++)H[_]=0;for(_=2056;_<=2065;_++)H[_]=0;for(_=2067;_<=2135;_++)H[_]=0;for(_=2137;_<=2154;_++)H[_]=0;for(_=2161;_<=2170;_++)H[_]=0;for(_=2172;_<=2193;_++)H[_]=0;for(_=2195;_<=2198;_++)H[_]=0;for(_=2200;_<=2203;_++)H[_]=0;for(_=2205;_<=2217;_++)H[_]=0;for(_=2222;_<=2224;_++)H[_]=1;for(_=2225;_<=2250;_++)H[_]=2;for(_=2251;_<=2253;_++)H[_]=1;for(_=2257;_<=2264;_++)H[_]=2;for(_=2274;_<=2279;_++)H[_]=2;for(_=2280;_<=2282;_++)H[_]=1;for(_=2283;_<=2289;_++)H[_]=2;for(_=2290;_<=2292;_++)H[_]=0;for(_=2308;_<=2313;_++)H[_]=0;for(_=2315;_<=2491;_++)H[_]=0;for(_=2494;_<=2866;_++)H[_]=0;for(_=2867;_<=2869;_++)H[_]=1;for(_=2870;_<=2888;_++)H[_]=2;for(_=2891;_<=2895;_++)H[_]=2;for(_=2896;_<=2898;_++)H[_]=1;for(_=2902;_<=2908;_++)H[_]=2;for(_=2915;_<=2920;_++)H[_]=2;for(_=2921;_<=2923;_++)H[_]=1;for(_=2924;_<=2930;_++)H[_]=2;for(_=2931;_<=2962;_++)H[_]=0;for(_=2964;_<=2968;_++)H[_]=2;for(_=2969;_<=2973;_++)H[_]=0;for(_=2975;_<=2991;_++)H[_]=0;for(_=2995;_<=3051;_++)H[_]=0;for(_=3054;_<=3079;_++)H[_]=0;for(_=3081;_<=3088;_++)H[_]=0;for(_=3092;_<=3101;_++)H[_]=0;for(_=3106;_<=3138;_++)H[_]=0;for(_=3146;_<=3151;_++)H[_]=0;for(_=3153;_<=3166;_++)H[_]=0;for(_=3168;_<=3172;_++)H[_]=0;for(_=3174;_<=3203;_++)H[_]=0;for(_=3294;_<=3358;_++)H[_]=0;for(_=3367;_<=3403;_++)H[_]=0;for(_=3408;_<=3416;_++)H[_]=0;for(_=3417;_<=3438;_++)H[_]=2;for(_=3441;_<=3446;_++)H[_]=2;for(_=3447;_<=3450;_++)H[_]=0;for(_=3451;_<=3459;_++)H[_]=2;for(_=3460;_<=3478;_++)H[_]=0;for(_=3554;_<=3559;_++)H[_]=0;for(_=3560;_<=3570;_++)H[_]=2;for(_=3571;_<=3581;_++)H[_]=0;for(_=3594;_<=3597;_++)H[_]=0;for(_=3601;_<=3604;_++)H[_]=0;for(_=3637;_<=3639;_++)H[_]=0;for(_=3665;_<=3667;_++)H[_]=0;for(_=3693;_<=3695;_++)H[_]=0;for(_=3701;_<=3727;_++)H[_]=0;for(_=3728;_<=3739;_++)H[_]=2;for(_=3740;_<=3751;_++)H[_]=0;for(_=3753;_<=3760;_++)H[_]=2;for(_=3761;_<=3773;_++)H[_]=0;for(_=3775;_<=3777;_++)H[_]=0;for(_=3779;_<=3781;_++)H[_]=0;for(_=3783;_<=3785;_++)H[_]=0;for(_=3788;_<=3791;_++)H[_]=0;for(_=3797;_<=3802;_++)H[_]=0;for(_=3814;_<=3816;_++)H[_]=0;for(_=3825;_<=3829;_++)H[_]=0;for(_=3832;_<=3841;_++)H[_]=0;for(_=3844;_<=3852;_++)H[_]=0;for(_=3873;_<=3885;_++)H[_]=0;for(_=3890;_<=3893;_++)H[_]=0;for(_=3907;_<=3912;_++)H[_]=0;for(_=3942;_<=3950;_++)H[_]=0;for(_=3968;_<=3970;_++)H[_]=0;for(_=3973;_<=3976;_++)H[_]=0;for(_=3986;_<=3989;_++)H[_]=0;for(_=3994;_<=3997;_++)H[_]=0;for(_=4048;_<=4051;_++)H[_]=0;for(_=4056;_<=4063;_++)H[_]=0;for(_=4093;_<=4096;_++)H[_]=0;for(_=4390;_<=4398;_++)H[_]=0;for(_=4399;_<=4413;_++)H[_]=2;for(_=4418;_<=4433;_++)H[_]=2;for(_=4455;_<=4457;_++)H[_]=2;for(_=4484;_<=4489;_++)H[_]=0;for(_=4491;_<=4554;_++)H[_]=0;for(_=4568;_<=4589;_++)H[_]=0;for(_=4652;_<=4656;_++)H[_]=0;for(_=4766;_<=4800;_++)H[_]=0;for(_=5014;_<=5016;_++)H[_]=0;for(_=5069;_<=5072;_++)H[_]=0;for(_=5105;_<=5130;_++)H[_]=0;for(_=5173;_<=5188;_++)H[_]=0;for(_=5253;_<=5259;_++)H[_]=0;for(_=5269;_<=5275;_++)H[_]=0;for(_=5292;_<=5311;_++)H[_]=0;for(_=5329;_<=5331;_++)H[_]=0;for(_=5343;_<=5349;_++)H[_]=0;for(_=5355;_<=5357;_++)H[_]=0;for(_=5387;_<=5389;_++)H[_]=0;for(_=5459;_<=5463;_++)H[_]=0;for(_=5479;_<=5482;_++)H[_]=0;for(_=5518;_<=5520;_++)H[_]=0;for(_=5530;_<=5539;_++)H[_]=0;for(_=5550;_<=5552;_++)H[_]=0;for(_=5562;_<=5583;_++)H[_]=0;for(_=5623;_<=5625;_++)H[_]=2;for(_=5631;_<=5639;_++)H[_]=0;for(_=5649;_<=5653;_++)H[_]=0;for(_=5663;_<=5680;_++)H[_]=0;for(_=5682;_<=5685;_++)H[_]=0;for(_=5875;_<=5877;_++)H[_]=0;for(_=5896;_<=5899;_++)H[_]=0;for(_=5921;_<=5940;_++)H[_]=0;for(_=6050;_<=6125;_++)H[_]=0;for(_=6244;_<=6275;_++)H[_]=0;for(_=6328;_<=6348;_++)H[_]=0;for(_=6350;_<=6356;_++)H[_]=0;for(_=6366;_<=6372;_++)H[_]=0;for(_=6381;_<=6387;_++)H[_]=0;for(_=6393;_<=6404;_++)H[_]=0;for(_=6480;_<=6483;_++)H[_]=0;for(_=6511;_<=6514;_++)H[_]=0;for(_=6579;_<=6581;_++)H[_]=0;for(_=6619;_<=6624;_++)H[_]=0;for(_=6625;_<=6627;_++)H[_]=2;for(_=6628;_<=6632;_++)H[_]=0;for(_=6634;_<=6637;_++)H[_]=0;for(_=6669;_<=6692;_++)H[_]=0;for(_=6707;_<=6709;_++)H[_]=0;for(_=6720;_<=6723;_++)H[_]=0;for(_=6732;_<=6738;_++)H[_]=0;for(_=6931;_<=6933;_++)H[_]=0;for(_=6956;_<=6959;_++)H[_]=0;for(_=7005;_<=7007;_++)H[_]=0;for(_=7057;_<=7070;_++)H[_]=2;for(_=7074;_<=7082;_++)H[_]=0;for(_=7109;_<=7118;_++)H[_]=0;for(_=7119;_<=7127;_++)H[_]=1;for(_=7374;_<=7376;_++)H[_]=0;for(_=7528;_<=7586;_++)H[_]=0;for(_=7587;_<=7645;_++)H[_]=2;for(_=7692;_<=7696;_++)H[_]=0;for(_=7755;_<=7787;_++)H[_]=0;for(_=7791;_<=7795;_++)H[_]=0;for(_=7799;_<=7801;_++)H[_]=0;for(_=7803;_<=7805;_++)H[_]=0;for(_=7825;_<=7831;_++)H[_]=0;for(_=7845;_<=7859;_++)H[_]=0;for(_=8013;_<=8032;_++)H[_]=0;for(_=8065;_<=8068;_++)H[_]=1;for(_=8518;_<=8529;_++)H[_]=2;for(_=8533;_<=8536;_++)H[_]=2;for(_=8538;_<=8540;_++)H[_]=2;for(_=8677;_<=8679;_++)H[_]=0;for(_=8836;_<=8840;_++)H[_]=0;for(_=8857;_<=8859;_++)H[_]=0;for(_=8908;_<=8910;_++)H[_]=0;for(_=9154;_<=9159;_++)H[_]=0;for(_=9205;_<=9218;_++)H[_]=0;for(_=9271;_<=9273;_++)H[_]=0;for(_=9295;_<=9297;_++)H[_]=0;for(_=9356;_<=9360;_++)H[_]=0;for(_=9404;_<=9407;_++)H[_]=0;for(_=9476;_<=9482;_++)H[_]=0;for(_=9487;_<=9494;_++)H[_]=0;for(_=9697;_<=9699;_++)H[_]=0;for(_=20002;_<=20032;_++)H[_]=0;for(_=20062;_<=20092;_++)H[_]=0;for(_=20135;_<=20138;_++)H[_]=0;for(_=20248;_<=20258;_++)H[_]=0;for(_=20348;_<=20358;_++)H[_]=0;for(_=20436;_<=20440;_++)H[_]=0;for(_=20822;_<=20824;_++)H[_]=0;for(_=20904;_<=20932;_++)H[_]=0;for(_=20934;_<=20936;_++)H[_]=0;for(_=21004;_<=21032;_++)H[_]=0;for(_=21035;_<=21037;_++)H[_]=0;for(_=21095;_<=21097;_++)H[_]=0;for(_=21148;_<=21150;_++)H[_]=0;for(_=21207;_<=21264;_++)H[_]=0;for(_=21307;_<=21364;_++)H[_]=0;for(_=21413;_<=21423;_++)H[_]=0;for(_=21453;_<=21463;_++)H[_]=0;for(_=21473;_<=21483;_++)H[_]=0;for(_=21780;_<=21782;_++)H[_]=0;for(_=21891;_<=21894;_++)H[_]=0;for(_=21896;_<=21899;_++)H[_]=0;for(_=22171;_<=22177;_++)H[_]=0;for(_=22181;_<=22187;_++)H[_]=0;for(_=22191;_<=22197;_++)H[_]=0;for(_=22234;_<=22236;_++)H[_]=0;for(_=22521;_<=22525;_++)H[_]=0;for(_=22991;_<=22994;_++)H[_]=0;for(_=23028;_<=23038;_++)H[_]=0;for(_=23830;_<=23853;_++)H[_]=0;for(_=23866;_<=23872;_++)H[_]=0;for(_=23877;_<=23884;_++)H[_]=0;for(_=23886;_<=23894;_++)H[_]=0;for(_=23946;_<=23948;_++)H[_]=0;for(_=24311;_<=24313;_++)H[_]=0;for(_=24342;_<=24347;_++)H[_]=0;for(_=24370;_<=24374;_++)H[_]=10;for(_=24375;_<=24381;_++)H[_]=0;for(_=24718;_<=24721;_++)H[_]=0;for(_=24817;_<=24821;_++)H[_]=0;for(_=24877;_<=24882;_++)H[_]=0;for(_=24891;_<=24893;_++)H[_]=0;for(_=25391;_<=25395;_++)H[_]=0;for(_=25828;_<=25838;_++)H[_]=0;for(_=26191;_<=26195;_++)H[_]=0;for(_=26391;_<=26393;_++)H[_]=0;for(_=26701;_<=26722;_++)H[_]=0;for(_=26729;_<=26799;_++)H[_]=2;for(_=26801;_<=26803;_++)H[_]=2;for(_=26811;_<=26813;_++)H[_]=2;for(_=26847;_<=26870;_++)H[_]=2;for(_=26891;_<=26899;_++)H[_]=0;for(_=26901;_<=26923;_++)H[_]=0;for(_=26929;_<=26946;_++)H[_]=0;for(_=26948;_<=26998;_++)H[_]=0;for(_=27037;_<=27040;_++)H[_]=0;for(_=27205;_<=27232;_++)H[_]=0;for(_=27258;_<=27260;_++)H[_]=0;for(_=27391;_<=27398;_++)H[_]=0;for(_=27561;_<=27564;_++)H[_]=0;for(_=27571;_<=27574;_++)H[_]=0;for(_=27581;_<=27584;_++)H[_]=0;for(_=27591;_<=27594;_++)H[_]=0;for(_=28191;_<=28193;_++)H[_]=0;for(_=28348;_<=28358;_++)H[_]=0;for(_=28402;_<=28432;_++)H[_]=0;for(_=28462;_<=28492;_++)H[_]=0;for(_=29118;_<=29122;_++)H[_]=0;for(_=29168;_<=29172;_++)H[_]=0;for(_=29177;_<=29185;_++)H[_]=0;for(_=29187;_<=29195;_++)H[_]=0;for(_=29900;_<=29903;_++)H[_]=0;for(_=30161;_<=30179;_++)H[_]=0;for(_=30491;_<=30494;_++)H[_]=0;for(_=30729;_<=30732;_++)H[_]=0;for(_=31251;_<=31259;_++)H[_]=0;for(_=31265;_<=31268;_++)H[_]=0;for(_=31275;_<=31279;_++)H[_]=0;for(_=31281;_<=31297;_++)H[_]=0;for(_=31461;_<=31469;_++)H[_]=0;for(_=31491;_<=31495;_++)H[_]=0;for(_=31917;_<=31922;_++)H[_]=0;for(_=31965;_<=32e3;_++)H[_]=0;for(_=32001;_<=32003;_++)H[_]=2;for(_=32005;_<=32031;_++)H[_]=2;for(_=32033;_<=32060;_++)H[_]=2;for(_=32064;_<=32067;_++)H[_]=2;for(_=32074;_<=32077;_++)H[_]=2;for(_=32081;_<=32086;_++)H[_]=0;for(_=32107;_<=32130;_++)H[_]=0;for(_=32133;_<=32158;_++)H[_]=0;for(_=32164;_<=32167;_++)H[_]=2;for(_=32180;_<=32199;_++)H[_]=0;for(_=32201;_<=32260;_++)H[_]=0;for(_=32301;_<=32360;_++)H[_]=0;for(_=32601;_<=32662;_++)H[_]=0;for(_=32664;_<=32667;_++)H[_]=2;for(_=32701;_<=32761;_++)H[_]=0;for(_=53001;_<=53004;_++)H[_]=0;for(_=53008;_<=53019;_++)H[_]=0;for(_=53021;_<=53032;_++)H[_]=0;for(_=53034;_<=53037;_++)H[_]=0;for(_=53042;_<=53046;_++)H[_]=0;for(_=53074;_<=53080;_++)H[_]=0;for(_=54001;_<=54004;_++)H[_]=0;for(_=54008;_<=54019;_++)H[_]=0;for(_=54021;_<=54032;_++)H[_]=0;for(_=54034;_<=54037;_++)H[_]=0;for(_=54042;_<=54046;_++)H[_]=0;for(_=54048;_<=54053;_++)H[_]=0;for(_=54074;_<=54080;_++)H[_]=0;for(_=54098;_<=54101;_++)H[_]=0;for(_=102001;_<=102040;_++)H[_]=0;for(_=102042;_<=102063;_++)H[_]=0;for(_=102065;_<=102067;_++)H[_]=0;for(_=102070;_<=102117;_++)H[_]=0;for(_=102122;_<=102216;_++)H[_]=0;for(_=102221;_<=102377;_++)H[_]=0;for(_=102382;_<=102388;_++)H[_]=0;for(_=102389;_<=102398;_++)H[_]=2;for(_=102399;_<=102444;_++)H[_]=0;for(_=102445;_<=102447;_++)H[_]=2;for(_=102448;_<=102458;_++)H[_]=0;for(_=102459;_<=102468;_++)H[_]=2;for(_=102469;_<=102499;_++)H[_]=0;for(_=102500;_<=102519;_++)H[_]=1;for(_=102520;_<=102524;_++)H[_]=0;for(_=102525;_<=102529;_++)H[_]=2;for(_=102530;_<=102588;_++)H[_]=0;for(_=102590;_<=102598;_++)H[_]=0;for(_=102601;_<=102603;_++)H[_]=0;for(_=102605;_<=102628;_++)H[_]=0;for(_=102629;_<=102646;_++)H[_]=2;for(_=102648;_<=102700;_++)H[_]=2;for(_=102701;_<=102703;_++)H[_]=0;for(_=102707;_<=102730;_++)H[_]=2;for(_=102733;_<=102758;_++)H[_]=2;for(_=102767;_<=102900;_++)H[_]=0;for(_=102901;_<=102933;_++)H[_]=2;for(_=102934;_<=102950;_++)H[_]=13;for(_=102951;_<=102955;_++)H[_]=0;for(_=102961;_<=102963;_++)H[_]=0;for(_=102965;_<=102969;_++)H[_]=0;for(_=102971;_<=102973;_++)H[_]=0;for(_=102975;_<=102989;_++)H[_]=0;for(_=102990;_<=102992;_++)H[_]=1;for(_=102997;_<=103002;_++)H[_]=0;for(_=103003;_<=103008;_++)H[_]=2;for(_=103009;_<=103011;_++)H[_]=0;for(_=103012;_<=103014;_++)H[_]=2;for(_=103019;_<=103021;_++)H[_]=0;for(_=103022;_<=103024;_++)H[_]=2;for(_=103029;_<=103031;_++)H[_]=0;for(_=103032;_<=103034;_++)H[_]=2;for(_=103065;_<=103068;_++)H[_]=0;for(_=103074;_<=103076;_++)H[_]=0;for(_=103077;_<=103079;_++)H[_]=1;for(_=103080;_<=103082;_++)H[_]=0;for(_=103083;_<=103085;_++)H[_]=2;for(_=103090;_<=103093;_++)H[_]=0;for(_=103097;_<=103099;_++)H[_]=0;for(_=103100;_<=103102;_++)H[_]=2;for(_=103107;_<=103109;_++)H[_]=0;for(_=103110;_<=103112;_++)H[_]=2;for(_=103113;_<=103116;_++)H[_]=0;for(_=103117;_<=103120;_++)H[_]=2;for(_=103153;_<=103157;_++)H[_]=0;for(_=103158;_<=103162;_++)H[_]=2;for(_=103163;_<=103165;_++)H[_]=0;for(_=103166;_<=103168;_++)H[_]=1;for(_=103169;_<=103171;_++)H[_]=2;for(_=103186;_<=103188;_++)H[_]=0;for(_=103189;_<=103191;_++)H[_]=2;for(_=103192;_<=103195;_++)H[_]=0;for(_=103196;_<=103199;_++)H[_]=2;for(_=103200;_<=103224;_++)H[_]=0;for(_=103225;_<=103227;_++)H[_]=1;for(_=103232;_<=103237;_++)H[_]=0;for(_=103238;_<=103243;_++)H[_]=2;for(_=103244;_<=103246;_++)H[_]=0;for(_=103247;_<=103249;_++)H[_]=2;for(_=103254;_<=103256;_++)H[_]=0;for(_=103257;_<=103259;_++)H[_]=2;for(_=103264;_<=103266;_++)H[_]=0;for(_=103267;_<=103269;_++)H[_]=2;for(_=103300;_<=103375;_++)H[_]=0;for(_=103381;_<=103383;_++)H[_]=0;for(_=103384;_<=103386;_++)H[_]=1;for(_=103387;_<=103389;_++)H[_]=0;for(_=103390;_<=103392;_++)H[_]=2;for(_=103397;_<=103399;_++)H[_]=0;for(_=103400;_<=103471;_++)H[_]=2;for(_=103476;_<=103478;_++)H[_]=0;for(_=103479;_<=103481;_++)H[_]=2;for(_=103486;_<=103488;_++)H[_]=0;for(_=103489;_<=103491;_++)H[_]=2;for(_=103492;_<=103495;_++)H[_]=0;for(_=103496;_<=103499;_++)H[_]=2;for(_=103528;_<=103543;_++)H[_]=0;for(_=103544;_<=103548;_++)H[_]=2;for(_=103549;_<=103551;_++)H[_]=0;for(_=103552;_<=103554;_++)H[_]=1;for(_=103555;_<=103557;_++)H[_]=2;for(_=103558;_<=103560;_++)H[_]=0;for(_=103571;_<=103573;_++)H[_]=0;for(_=103574;_<=103576;_++)H[_]=2;for(_=103577;_<=103580;_++)H[_]=0;for(_=103581;_<=103583;_++)H[_]=2;for(_=103595;_<=103694;_++)H[_]=0;for(_=103696;_<=103699;_++)H[_]=0;for(_=103700;_<=103793;_++)H[_]=2;for(_=103794;_<=103887;_++)H[_]=0;for(_=103900;_<=103971;_++)H[_]=2;const WOe={102113:!0,102100:!0,3857:!0,3785:!0},ZOe={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},iee='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',dL=[-20037508342788905e-9,20037508342788905e-9],pL=[-20037508342787e-6,20037508342787e-6],Pde={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:dL,origin:pL,dx:1e-5},102100:{wkTemplate:iee,valid:dL,origin:pL,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:dL,origin:pL,dx:1e-5},3857:{wkTemplate:iee,valid:dL,origin:pL,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function qc(e,t){return!N(e)&&!N(t)&&(e===t||(e.wkid!=null||t.wkid!=null?e.wkid===t.wkid||Sx(e)&&Sx(t)||t.latestWkid!=null&&e.wkid===t.latestWkid||e.latestWkid!=null&&t.wkid===e.latestWkid:!(!e.wkt||!t.wkt)&&e.wkt.toUpperCase()===t.wkt.toUpperCase()))}function kv(e){return Xl(e)&&e.wkid&&Pde[e.wkid]||null}function Ide(e){return!!Xl(e)&&(e.wkid?H[e.wkid]==null:!!e.wkt&&!!/^\s*GEOGCS/i.test(e.wkt))}function uP(e){return!(km(e)||Um(e))}function hP(e){return Xl(e)&&e.wkid===4326}function Lde(e){return Xl(e)&&e.wkid===nd.CGCS2000}function Sx(e){return Xl(e)&&e.wkid!=null&&WOe[e.wkid]===!0}function dP(e){return Xl(e)&&e.wkid===32662}function CZ(e){return e===nd.GCSMARS2000||e===nd.GCSMARS2000_SPHERE}function km(e){return Xl(e)&&e.wkid!=null&&CZ(e.wkid)}function AZ(e){return e===nd.GCSMOON2000}function Um(e){return Xl(e)&&e.wkid!=null&&AZ(e.wkid)}function XOe(e){return Xl(e)&&e.wkid!=null&&ZOe[e.wkid]===!0}function Xl(e){return w(e)&&(e.wkid!=null&&e.wkid>=2e3||e.wkt!=null)}const YOe={wkid:4326,wkt:Sm(Pde[4326].wkTemplate,{Central_Meridian:"0.0"})},QOe={wkid:102100,latestWkid:3857},JOe={wkid:32662};var Rf;let Wr=Rf=class extends Fe{constructor(e){super(e),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(e){if(!e)return null;if(e.wkid){if(e.wkid===102100)return Rf.WebMercator;if(e.wkid===4326)return Rf.WGS84}const t=new Rf;return t.read(e),t}normalizeCtorArgs(e){return e&&typeof e=="object"?e:{[typeof e=="string"?"wkt":"wkid"]:e}}get isWGS84(){return hP(this)}get isWebMercator(){return Sx(this)}get isGeographic(){return Ide(this)}get isWrappable(){return XOe(this)}writeWkt(e,t){this.wkid||(t.wkt=e)}clone(){if(this===Rf.WGS84)return Rf.WGS84;if(this===Rf.WebMercator)return Rf.WebMercator;const e=new Rf;return this.wkid!=null?(e.wkid=this.wkid,this.latestWkid!=null&&(e.latestWkid=this.latestWkid),this.vcsWkid!=null&&(e.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(e.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(e.wkt=this.wkt),this.imageCoordinateSystem&&(e.imageCoordinateSystem=me(this.imageCoordinateSystem)),e}equals(e){if(e==null)return!1;if(this.imageCoordinateSystem||e.imageCoordinateSystem){if(this.imageCoordinateSystem==null||e.imageCoordinateSystem==null)return!1;const{id:t,referenceServiceName:i}=e.imageCoordinateSystem,{geodataXform:r}=e.imageCoordinateSystem,s=this.imageCoordinateSystem;return t==null||r?JSON.stringify(s)===JSON.stringify(e.imageCoordinateSystem):i?s.id===t&&s.referenceServiceName===i:s.id===t}return qc(this,e)}toJSON(e){return this.write(void 0,e)}};Wr.GCS_NAD_1927=null,Wr.WGS84=null,Wr.WebMercator=null,Wr.PlateCarree=null,u([f({readOnly:!0})],Wr.prototype,"isWGS84",null),u([f({readOnly:!0})],Wr.prototype,"isWebMercator",null),u([f({readOnly:!0})],Wr.prototype,"isGeographic",null),u([f({readOnly:!0})],Wr.prototype,"isWrappable",null),u([f({type:cs,json:{write:!0}})],Wr.prototype,"latestWkid",void 0),u([f({type:cs,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt===null}}}}}}})],Wr.prototype,"wkid",void 0),u([f({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid===null}}}}}}})],Wr.prototype,"wkt",void 0),u([ut("wkt"),ut("web-scene","wkt")],Wr.prototype,"writeWkt",null),u([f({type:cs,json:{write:!0}})],Wr.prototype,"vcsWkid",void 0),u([f({type:cs,json:{write:!0}})],Wr.prototype,"latestVcsWkid",void 0),u([f()],Wr.prototype,"imageCoordinateSystem",void 0),Wr=Rf=u([B("esri.geometry.SpatialReference")],Wr),Wr.prototype.toJSON.isDefaultToJSON=!0,Wr.GCS_NAD_1927=new Wr({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Wr.WGS84=new Wr(YOe),Wr.WebMercator=new Wr(QOe),Wr.PlateCarree=new Wr(JOe),Object.freeze&&(Object.freeze(Wr.GCS_NAD_1927),Object.freeze(Wr.WGS84),Object.freeze(Wr.WebMercator));const wt=Wr;let Mf=class extends Fe{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=wt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,t){if(e instanceof wt)return e;if(e!=null){const i=new wt;return i.read(e,t),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,t){this.cache[e]=t}};u([f()],Mf.prototype,"type",void 0),u([f({readOnly:!0})],Mf.prototype,"cache",null),u([f({readOnly:!0})],Mf.prototype,"extent",null),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mf.prototype,"hasM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Mf.prototype,"hasZ",void 0),u([f({type:wt,json:{write:!0}})],Mf.prototype,"spatialReference",void 0),u([it("spatialReference")],Mf.prototype,"readSpatialReference",null),Mf=u([B("esri.geometry.Geometry")],Mf);const Gc=Mf;function KOe(e,t,i,r){var s;return e.x=e.x+t,e.y=e.y+i,r!=null&&(e.z=((s=e.z)!=null?s:0)+r),e}function eRe(e,t){const i=e.x-t.x,r=e.y-t.y,s=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+r*r+s*s)}class OZ{constructor(t,i,r,s){this.semiMajorAxis=t,this.flattening=i,this.outerAtmosphereRimWidth=r;const n=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*n,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=s||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const Qi=new OZ(6378137,1/298.257223563,3e5,.006694379990137799),ym=new OZ(3396190,1/169.8944472236118,23e4),By=new OZ(1737400,0,0),tRe=57.29577951308232,iRe=.017453292519943;function ree(e){return e*tRe}function see(e){return e*iRe}function nee(e){return e/Qi.radius}function T4(e){return Math.PI/2-2*Math.atan(Math.exp(-e/Qi.radius))}function TG(e){return e.wkid!=null||e.wkt!=null}const iV=[0,0];function S4(e,t,i,r,s){const n=e,o=s;if(o.spatialReference=i,"x"in n&&"x"in o)[o.x,o.y]=t(n.x,n.y,iV,r);else if("xmin"in n&&"xmin"in o)[o.xmin,o.ymin]=t(n.xmin,n.ymin,iV,r),[o.xmax,o.ymax]=t(n.xmax,n.ymax,iV,r);else if("paths"in n&&"paths"in o||"rings"in n&&"rings"in o){const a="paths"in n?n.paths:n.rings,l=[];let c;for(let h=0;h<a.length;h++){const p=a[h];c=[],l.push(c);for(let m=0;m<p.length;m++)c.push(t(p[m][0],p[m][1],[0,0],r)),p[m].length>2&&c[m].push(p[m][2]),p[m].length>3&&c[m].push(p[m][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in n&&"points"in o){const a=n.points,l=[];for(let c=0;c<a.length;c++)l[c]=t(a[c][0],a[c][1],[0,0],r),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return s}function Uv(e,t){const i=e&&(TG(e)?e:e.spatialReference),r=t&&(TG(t)?t:t.spatialReference);return!(e&&"type"in e&&e.type==="mesh"||t&&"type"in t&&t.type==="mesh"||!i||!r)&&(!!qc(r,i)||Sx(r)&&hP(i)||Sx(i)&&hP(r))}function aT(e,t){if(N(e))return null;const i=e.spatialReference,r=t&&(TG(t)?t:t.spatialReference);return Uv(i,r)?qc(i,r)?me(e):Sx(r)?S4(e,P2,wt.WebMercator,!1,me(e)):hP(r)?S4(e,fM,wt.WGS84,!1,me(e)):null:null}function P2(e,t,i=[0,0]){t>89.99999?t=89.99999:t<-89.99999&&(t=-89.99999);const r=see(t);return i[0]=see(e)*Qi.radius,i[1]=Qi.halfSemiMajorAxis*Math.log((1+Math.sin(r))/(1-Math.sin(r))),i}function fM(e,t,i=[0,0],r=!1){const s=ree(e/Qi.radius);return i[0]=r?s:s-360*Math.floor((s+180)/360),i[1]=ree(Math.PI/2-2*Math.atan(Math.exp(-t/Qi.radius))),i}function Ay(e,t=!1,i=me(e)){return S4(e,P2,wt.WebMercator,t,i)}function JO(e,t=!1,i=me(e)){return S4(e,fM,wt.WGS84,t,i)}var uN;const NA=[0,0];function oee(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}const fL=Ie.getLogger("esri.geometry.Point");let Sl=uN=class extends Gc{constructor(...e){super(...e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(e,t){t._set("x",e._get("x")),t._set("y",e._get("y")),t._set("z",e._get("z")),t._set("m",e._get("m"));const i=e._get("spatialReference");t._set("spatialReference",Object.isFrozen(i)?i:i.clone())}normalizeCtorArgs(e,t,i,r,s){let n;if(Array.isArray(e))n=e,s=t,e=n[0],t=n[1],i=n[2],r=n[3];else if(e&&typeof e=="object"){if(n=e,e=n.x!=null?n.x:n.longitude,t=n.y!=null?n.y:n.latitude,i=n.z,r=n.m,(s=n.spatialReference)&&s.declaredClass!=="esri.geometry.SpatialReference"&&(s=new wt(s)),n.longitude!=null||n.latitude!=null){if(n.longitude==null)fL.warn(".longitude=","Latitude was defined without longitude");else if(n.latitude==null)fL.warn(".latitude=","Longitude was defined without latitude");else if(!n.declaredClass&&s&&s.isWebMercator){const a=P2(n.longitude,n.latitude,NA);e=a[0],t=a[1]}}}else oee(i)?(s=i,i=null):oee(r)&&(s=r,r=null);const o={x:e,y:t};return o.x==null&&o.y!=null?fL.warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&fL.warn(".x=","X coordinate was defined without a Y coordinate"),s!=null&&(o.spatialReference=s),i!=null&&(o.z=i),r!=null&&(o.m=r),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(e){e!==(this._get("m")!==void 0)&&(this._set("m",e?0:void 0),this._set("hasM",e))}get hasZ(){return this.z!==void 0}set hasZ(e){e!==(this._get("z")!==void 0)&&(this._set("z",e?0:void 0),this._set("hasZ",e))}get latitude(){const{spatialReference:e,x:t,y:i}=this;if(e){if(e.isWebMercator)return fM(t,i,NA)[1];if(e.isGeographic)return i}return null}set latitude(e){const{spatialReference:t,x:i}=this;t&&(t.isWebMercator?this._set("y",P2(i,e,NA)[1]):t.isGeographic&&this._set("y",e),this._set("latitude",e))}get longitude(){const{x:e,y:t,spatialReference:i}=this;if(i){if(i.isWebMercator)return fM(e,t,NA)[0];if(i.isGeographic)return e}return null}set longitude(e){const{y:t,spatialReference:i}=this;i&&(i.isWebMercator?this._set("x",P2(e,t,NA)[0]):i.isGeographic&&this._set("x",e),this._set("longitude",e))}writeX(e,t,i){t[i]=isNaN(e)?"NaN":e}readX(e){return typeof e=="string"?NaN:e}clone(){const e=new uN;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e}copy(e){return uN.copy(e,this),this}equals(e){if(N(e))return!1;const{x:t,y:i,z:r,m:s,spatialReference:n}=this,{z:o,m:a}=e;let{x:l,y:c,spatialReference:h}=e;if(!n.equals(h))if(n.isWebMercator&&h.isWGS84)[l,c]=P2(l,c),h=n;else{if(!n.isWGS84||!h.isWebMercator)return!1;[l,c]=fM(l,c),h=n}return t===l&&i===c&&r===o&&s===a&&n.wkid===h.wkid}offset(e,t,i){return KOe(this,e,t,i)}normalize(){if(!this.spatialReference)return this;const e=kv(this.spatialReference);if(!e)return this;let t=this.x;const[i,r]=e.valid,s=2*r;let n;return t>r?(n=Math.ceil(Math.abs(t-r)/s),t-=n*s):t<i&&(n=Math.ceil(Math.abs(t-i)/s),t+=n*s),this._set("x",t),this}distance(e){return eRe(this,e)}toArray(){const e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(e){return this.write({},e)}};u([f({readOnly:!0})],Sl.prototype,"cache",null),u([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Sl.prototype,"hasM",null),u([f({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],Sl.prototype,"hasZ",null),u([f({type:Number})],Sl.prototype,"latitude",null),u([f({type:Number})],Sl.prototype,"longitude",null),u([f({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),pi(e=>isNaN(e)?e:Kh(e))],Sl.prototype,"x",void 0),u([ut("x")],Sl.prototype,"writeX",null),u([it("x")],Sl.prototype,"readX",null),u([f({type:Number,json:{write:!0}})],Sl.prototype,"y",void 0),u([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],Sl.prototype,"z",void 0),u([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],Sl.prototype,"m",void 0),Sl=uN=u([B("esri.geometry.Point")],Sl),Sl.prototype.toJSON.isDefaultToJSON=!0;const xt=Sl;let Ig=class extends Hc(Fe){constructor(...e){super(...e),this.position=new xt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,t,i,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return t!=null&&(s.heading=t),i!=null&&(s.tilt=i),r!=null&&(s.fov=r),s}return e}writePosition(e,t,i,r){const s=e.clone();s.x=Kh(e.x||0),s.y=Kh(e.y||0),s.z=e.hasZ?Kh(e.z||0):e.z,t[i]=s.write({},r)}readPosition(e,t){const i=new xt;return i.read(e,t),i.x=Kh(i.x||0),i.y=Kh(i.y||0),i.z=i.hasZ?Kh(i.z||0):i.z,i}equals(e){return!!e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};u([f({type:xt,json:{write:{isRequired:!0}}})],Ig.prototype,"position",void 0),u([ut("position")],Ig.prototype,"writePosition",null),u([it("position")],Ig.prototype,"readPosition",null),u([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),pi(e=>SZ.normalize(Kh(e)))],Ig.prototype,"heading",void 0),u([f({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),pi(e=>Xe(Kh(e),-180,180))],Ig.prototype,"tilt",void 0),u([f({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Ig.prototype,"fov",void 0),Ig=u([B("esri.Camera")],Ig);const jc=Ig,rV=[0,0];function RZ(e,t){return!!w(t)&&Qa(e,t.x,t.y,t.z)}function j_t(e,t){if(!t.points||t.points.length)return!1;for(const i of t.points)if(!IE(e,i))return!1;return!0}function rRe(e,t){const{xmin:i,ymin:r,zmin:s,xmax:n,ymax:o,zmax:a}=t;return e.hasZ&&t.hasZ?Qa(e,i,r,s)&&Qa(e,i,o,s)&&Qa(e,n,o,s)&&Qa(e,n,r,s)&&Qa(e,i,r,a)&&Qa(e,i,o,a)&&Qa(e,n,o,a)&&Qa(e,n,r,a):Qa(e,i,r)&&Qa(e,i,o)&&Qa(e,n,o)&&Qa(e,n,r)}function IE(e,t){return Qa(e,t[0],t[1])}function sRe(e,t){return Qa(e,t[0],t[1],t[2])}function Qa(e,t,i,r){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax&&(r==null||!e.hasZ||r>=e.zmin&&r<=e.zmax)}function nRe(e,t){return rV[1]=t.y,rV[0]=t.x,oRe(e,rV)}function oRe(e,t){return $de(e.rings,t)}function $de(e,t){if(!e)return!1;if(aRe(e))return aee(!1,e,t);let i=!1;for(let r=0,s=e.length;r<s;r++)i=aee(i,e[r],t);return i}function aRe(e){return!Array.isArray(e[0][0])}function aee(e,t,i){const[r,s]=i;let n=e,o=0;for(let a=0,l=t.length;a<l;a++){o++,o===l&&(o=0);const[c,h]=t[a],[p,m]=t[o];(h<s&&m>=s||m<s&&h>=s)&&c+(s-h)/(m-h)*(p-c)<r&&(n=!n)}return n}function lRe(e,t){return RZ(e,t)}function cRe(e,t){const i=e.hasZ&&t.hasZ;let r,s,n;if(e.xmin<=t.xmin){if(r=t.xmin,e.xmax<r)return!1}else if(r=e.xmin,t.xmax<r)return!1;if(e.ymin<=t.ymin){if(s=t.ymin,e.ymax<s)return!1}else if(s=e.ymin,t.ymax<s)return!1;if(i&&t.hasZ){if(e.zmin<=t.zmin){if(n=t.zmin,e.zmax<n)return!1}else if(n=e.zmin,t.zmax<n)return!1}return!0}function uRe(e,t){const{points:i,hasZ:r}=t,s=r?sRe:IE;for(const n of i)if(s(e,n))return!0;return!1}const Ex=[0,0],Cx=[0,0],Ax=[0,0],Ox=[0,0],hRe=[Ex,Cx,Ax,Ox],Dde=[[Ax,Ex],[Ex,Cx],[Cx,Ox],[Ox,Ax]];function dRe(e,t){return pRe(e,t.rings)}function pRe(e,t){Ex[0]=e.xmin,Ex[1]=e.ymax,Cx[0]=e.xmax,Cx[1]=e.ymax,Ax[0]=e.xmin,Ax[1]=e.ymin,Ox[0]=e.xmax,Ox[1]=e.ymin;for(const i of hRe)if($de(t,i))return!0;for(const i of t){if(!i.length)continue;let r=i[0];if(IE(e,r))return!0;for(let s=1;s<i.length;s++){const n=i[s];if(IE(e,n)||Nde(r,n,Dde))return!0;r=n}}return!1}function fRe(e,t){Ex[0]=e.xmin,Ex[1]=e.ymax,Cx[0]=e.xmax,Cx[1]=e.ymax,Ax[0]=e.xmin,Ax[1]=e.ymin,Ox[0]=e.xmax,Ox[1]=e.ymin;const i=t.paths;for(const r of i){if(!i.length)continue;let s=r[0];if(IE(e,s))return!0;for(let n=1;n<r.length;n++){const o=r[n];if(IE(e,o)||Nde(s,o,Dde))return!0;s=o}}return!1}const jo=[0,0];function mRe(e){for(let t=0;t<e.length;t++){const i=e[t];for(let s=0;s<i.length-1;s++){const n=i[s],o=i[s+1];for(let a=t+1;a<e.length;a++)for(let l=0;l<e[a].length-1;l++){const c=e[a][l],h=e[a][l+1];if(SG(n,o,c,h,jo)&&!(jo[0]===n[0]&&jo[1]===n[1]||jo[0]===c[0]&&jo[1]===c[1]||jo[0]===o[0]&&jo[1]===o[1]||jo[0]===h[0]&&jo[1]===h[1]))return!0}}const r=i.length;if(!(r<=4))for(let s=0;s<r-3;s++){let n=r-1;s===0&&(n=r-2);const o=i[s],a=i[s+1];for(let l=s+2;l<n;l++){const c=i[l],h=i[l+1];if(SG(o,a,c,h,jo)&&!(jo[0]===o[0]&&jo[1]===o[1]||jo[0]===c[0]&&jo[1]===c[1]||jo[0]===a[0]&&jo[1]===a[1]||jo[0]===h[0]&&jo[1]===h[1]))return!0}}}return!1}function Nde(e,t,i){for(let r=0;r<i.length;r++)if(SG(e,t,i[r][0],i[r][1]))return!0;return!1}function SG(e,t,i,r,s){const[n,o]=e,[a,l]=t,[c,h]=i,[p,m]=r,g=p-c,v=n-c,b=a-n,S=m-h,T=o-h,O=l-o,C=S*b-g*O;if(C===0)return!1;const M=(g*T-S*v)/C,I=(b*T-O*v)/C;return M>=0&&M<=1&&I>=0&&I<=1&&(s&&(s[0]=n+M*(a-n),s[1]=o+M*(l-o)),!0)}function gRe(e){switch(e){case"esriGeometryEnvelope":case"extent":return cRe;case"esriGeometryMultipoint":case"multipoint":return uRe;case"esriGeometryPoint":case"point":return lRe;case"esriGeometryPolygon":case"polygon":return dRe;case"esriGeometryPolyline":case"polyline":return fRe}}var Ph;function yRe(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}function L0(e,t,i){return t==null?i:i==null?t:e(t,i)}let _o=Ph=class extends Gc{constructor(...e){super(...e),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(e,t,i,r,s){return yRe(e)?{spatialReference:e,xmin:0,ymin:0,xmax:0,ymax:0}:typeof e=="object"?(e.spatialReference=e.spatialReference==null?wt.WGS84:e.spatialReference,e):{xmin:e,ymin:t,xmax:i,ymax:r,spatialReference:s==null?wt.WGS84:s}}static fromBounds(e,t){return new Ph({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}static fromPoint(e){return new Ph({xmin:e.x,ymin:e.y,zmin:e.z,xmax:e.x,ymax:e.y,zmax:e.z,spatialReference:e.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const e=new xt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(e.z=.5*(this.zmin+this.zmax)),this.hasM&&(e.m=.5*(this.mmin+this.mmax)),e}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(e){const t=this.center;return e.z!=null&&this.hasZ?this.offset(e.x-t.x,e.y-t.y,e.z-t.z):this.offset(e.x-t.x,e.y-t.y)}clone(){const e=new Ph;return e.xmin=this.xmin,e.ymin=this.ymin,e.xmax=this.xmax,e.ymax=this.ymax,e.spatialReference=this.spatialReference,this.zmin!=null&&(e.zmin=this.zmin,e.zmax=this.zmax),this.mmin!=null&&(e.mmin=this.mmin,e.mmax=this.mmax),e}contains(e){if(!e)return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Uv(t,i)&&(e=t.isWebMercator?Ay(e):JO(e,!0)),e.type==="point"?RZ(this,e):e.type==="extent"&&rRe(this,e)}equals(e){if(this===e)return!0;if(N(e))return!1;const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Uv(t,i)&&(e=t.isWebMercator?Ay(e):JO(e,!0)),this.xmin===e.xmin&&this.ymin===e.ymin&&this.zmin===e.zmin&&this.mmin===e.mmin&&this.xmax===e.xmax&&this.ymax===e.ymax&&this.zmax===e.zmax&&this.mmax===e.mmax}expand(e){const t=.5*(1-e),i=this.width*t,r=this.height*t;if(this.xmin+=i,this.ymin+=r,this.xmax-=i,this.ymax-=r,this.hasZ){const s=(this.zmax-this.zmin)*t;this.zmin+=s,this.zmax-=s}if(this.hasM){const s=(this.mmax-this.mmin)*t;this.mmin+=s,this.mmax-=s}return this}intersects(e){if(N(e))return!1;e.type==="mesh"&&(e=e.extent);const t=this.spatialReference,i=e.spatialReference;return t&&i&&!t.equals(i)&&Uv(t,i)&&(e=t.isWebMercator?Ay(e):JO(e,!0)),gRe(e.type)(this,e)}normalize(){const e=this._normalize(!1,!0);return Array.isArray(e)?e:[e]}offset(e,t,i){return this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t,i!=null&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(e){return this===e||(this.xmin=Math.min(this.xmin,e.xmin),this.ymin=Math.min(this.ymin,e.ymin),this.xmax=Math.max(this.xmax,e.xmax),this.ymax=Math.max(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=L0(Math.min,this.zmin,e.zmin),this.zmax=L0(Math.max,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=L0(Math.min,this.mmin,e.mmin),this.mmax=L0(Math.max,this.mmax,e.mmax))),this}intersection(e){return this===e?this:N(e)||!this.intersects(e)?null:(this.xmin=Math.max(this.xmin,e.xmin),this.ymin=Math.max(this.ymin,e.ymin),this.xmax=Math.min(this.xmax,e.xmax),this.ymax=Math.min(this.ymax,e.ymax),(this.hasZ||e.hasZ)&&(this.zmin=L0(Math.max,this.zmin,e.zmin),this.zmax=L0(Math.min,this.zmax,e.zmax)),(this.hasM||e.hasM)&&(this.mmin=L0(Math.max,this.mmin,e.mmin),this.mmax=L0(Math.min,this.mmax,e.mmax)),this)}toJSON(e){return this.write({},e)}_shiftCM(e=kv(this.spatialReference)){if(!e||!this.spatialReference)return this;const t=this.spatialReference,i=this._getCM(e);if(i){const r=t.isWebMercator?JO(i):i;this.xmin-=i.x,this.xmax-=i.x,t.isWebMercator||(r.x=this._normalizeX(r.x,e).x),this.spatialReference=new wt(Sm(t.isWGS84?e.altTemplate:e.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(e){let t=null;const[i,r]=e.valid,s=this.xmin,n=this.xmax;return s>=i&&s<=r&&n>=i&&n<=r||(t=this.center),t}_normalize(e,t,i){const r=this.spatialReference;if(!r)return this;if(!(i=i||kv(r)))return this;const s=this._getParts(i).map(a=>a.extent);if(s.length<2)return s[0]||this;if(s.length>2)return e?this._shiftCM(i):this.set({xmin:i.valid[0],xmax:i.valid[1]});if(e)return this._shiftCM(i);if(t)return s;let n=!0,o=!0;return s.forEach(a=>{a.hasZ||(n=!1),a.hasM||(o=!1)}),{rings:s.map(a=>{const l=[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]];if(n){const c=(a.zmax-a.zmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}if(o){const c=(a.mmax-a.mmin)/2;for(let h=0;h<l.length;h++)l[h].push(c)}return l}),hasZ:n,hasM:o,spatialReference:r}}_getParts(e){let t=this.cache._parts;if(!t){t=[];const{ymin:s,ymax:n,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let h;e=e||kv(o);const[p,m]=e.valid;h=this._normalizeX(this.xmin,e);const g=h.x,v=h.frameId;h=this._normalizeX(this.xmax,e);const b=h.x,S=h.frameId,T=g===b&&a>0;if(a>2*m){const O=new Ph(l<c?g:b,s,m,n,o),C=new Ph(p,s,l<c?b:g,n,o),M=new Ph(0,s,m,n,o),I=new Ph(p,s,0,n,o),$=[],U=[];O.contains(M)&&$.push(v),O.contains(I)&&U.push(v),C.contains(M)&&$.push(S),C.contains(I)&&U.push(S);for(let q=v+1;q<S;q++)$.push(q),U.push(q);t.push({extent:O,frameIds:[v]},{extent:C,frameIds:[S]},{extent:M,frameIds:$},{extent:I,frameIds:U})}else g>b||T?t.push({extent:new Ph(g,s,m,n,o),frameIds:[v]},{extent:new Ph(p,s,b,n,o),frameIds:[S]}):t.push({extent:new Ph(g,s,b,n,o),frameIds:[v]});this.cache._parts=t}const i=this.hasZ,r=this.hasM;if(i||r){const s={};i&&(s.zmin=this.zmin,s.zmax=this.zmax),r&&(s.mmin=this.mmin,s.mmax=this.mmax);for(let n=0;n<t.length;n++)t[n].extent.set(s)}return t}_normalizeX(e,t){const[i,r]=t.valid,s=2*r;let n,o=0;return e>r?(n=Math.ceil(Math.abs(e-r)/s),e-=n*s,o=n):e<i&&(n=Math.ceil(Math.abs(e-i)/s),e+=n*s,o=-n),{x:e,frameId:o}}};u([f({readOnly:!0})],_o.prototype,"cache",null),u([f({readOnly:!0})],_o.prototype,"center",null),u([f({readOnly:!0})],_o.prototype,"extent",null),u([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],_o.prototype,"hasM",null),u([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],_o.prototype,"hasZ",null),u([f({readOnly:!0})],_o.prototype,"height",null),u([f({readOnly:!0})],_o.prototype,"width",null),u([f({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],_o.prototype,"xmin",void 0),u([f({type:Number,json:{write:!0}})],_o.prototype,"ymin",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],_o.prototype,"mmin",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],_o.prototype,"zmin",void 0),u([f({type:Number,json:{write:!0}})],_o.prototype,"xmax",void 0),u([f({type:Number,json:{write:!0}})],_o.prototype,"ymax",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],_o.prototype,"mmax",void 0),u([f({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],_o.prototype,"zmax",void 0),_o=Ph=u([B("esri.geometry.Extent")],_o),_o.prototype.toJSON.isDefaultToJSON=!0;const zi=_o;function LE(e,t,i=!1){let{hasM:r,hasZ:s}=e;Array.isArray(t)?t.length!==4||r||s?t.length===3&&i&&!r?(s=!0,r=!1):t.length===3&&r&&s&&(r=!1,s=!1):(r=!0,s=!0):(s=!s&&t.hasZ&&(!r||t.hasM),r=!r&&t.hasM&&(!s||t.hasZ)),e.hasZ=s,e.hasM=r}var EG;function lee(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}function _Re(e){return e&&(e.declaredClass==="esri.geometry.SpatialReference"||e.wkid!=null)}let __=EG=class extends Gc{constructor(...e){super(...e),this.points=[],this.type="multipoint"}normalizeCtorArgs(e,t){if(!e&&!t)return null;const i={};Array.isArray(e)?(i.points=e,i.spatialReference=t):_Re(e)?i.spatialReference=e:(e.points&&(i.points=e.points),e.spatialReference&&(i.spatialReference=e.spatialReference),e.hasZ&&(i.hasZ=e.hasZ),e.hasM&&(i.hasM=e.hasM));const r=i.points&&i.points[0];return r&&(i.hasZ===void 0&&i.hasM===void 0?(i.hasZ=r.length>2,i.hasM=!1):i.hasZ===void 0?i.hasZ=r.length>3:i.hasM===void 0&&(i.hasM=r.length>3)),i}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const e=this.points;if(!e.length)return null;const t=new zi,i=this.hasZ,r=this.hasM,s=i?3:2,n=e[0],o=lee(Math.min),a=lee(Math.max);let l,c,h,p,[m,g]=n,[v,b]=n;for(let S=0,T=e.length;S<T;S++){const O=e[S],[C,M]=O;if(m=o(m,C),g=o(g,M),v=a(v,C),b=a(b,M),i&&O.length>2){const I=O[2];l=o(l,I),h=a(h,I)}if(r&&O.length>s){const I=O[s];c=o(c,I),p=a(p,I)}}return t.xmin=m,t.ymin=g,t.xmax=v,t.ymax=b,t.spatialReference=this.spatialReference,i?(t.zmin=l,t.zmax=h):(t.zmin=null,t.zmax=null),r?(t.mmin=c,t.mmax=p):(t.mmin=null,t.mmax=null),t}writePoints(e,t){t.points=me(this.points)}addPoint(e){return LE(this,e),Array.isArray(e)?this.points.push(e):this.points.push(e.toArray()),this.notifyChange("points"),this}clone(){const e={points:me(this.points),spatialReference:this.spatialReference};return this.hasZ&&(e.hasZ=!0),this.hasM&&(e.hasM=!0),new EG(e)}getPoint(e){if(!this._validateInputs(e))return null;const t=this.points[e],i={x:t[0],y:t[1],spatialReference:this.spatialReference};let r=2;return this.hasZ&&(i.z=t[2],r=3),this.hasM&&(i.m=t[r]),new xt(i)}removePoint(e){if(!this._validateInputs(e))return null;const t=new xt(this.points.splice(e,1)[0],this.spatialReference);return this.notifyChange("points"),t}setPoint(e,t){return this._validateInputs(e)?(LE(this,t),Array.isArray(t)||(t=t.toArray()),this.points[e]=t,this.notifyChange("points"),this):this}toJSON(e){return this.write({},e)}_validateInputs(e){return e!=null&&e>=0&&e<this.points.length}};u([f({readOnly:!0})],__.prototype,"cache",null),u([f()],__.prototype,"extent",null),u([f({type:[[Number]],json:{write:{isRequired:!0}}})],__.prototype,"points",void 0),u([ut("points")],__.prototype,"writePoints",null),__=EG=u([B("esri.geometry.Multipoint")],__),__.prototype.toJSON.isDefaultToJSON=!0;const lT=__;function MZ(e,t){const i=t[0]-e[0],r=t[1]-e[1];if(e.length>2&&t.length>2){const s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}return Math.sqrt(i*i+r*r)}function Fde(e,t,i){const r=e[0]+i*(t[0]-e[0]),s=e[1]+i*(t[1]-e[1]);return e.length>2&&t.length>2?[r,s,e[2]+i*(t[2]-e[2])]:[r,s]}function vRe(e,t){return Fde(e,t,.5)}function kde(e){const t=e.length;let i=0;for(let r=0;r<t-1;++r)i+=MZ(e[r],e[r+1]);return i}function Ude(e,t){if(t<=0)return e[0];const i=e.length;let r=0;for(let s=0;s<i-1;++s){const n=MZ(e[s],e[s+1]);if(t-r<n){const o=(t-r)/n;return Fde(e[s],e[s+1],o)}r+=n}return e[i-1]}function PZ(e,t,i){const r=e.length;let s=0,n=0,o=0;for(let a=0;a<r;a++){const l=e[a],c=e[(a+1)%r];let h=2;s+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&i&&(n+=l[0]*c[2]-c[0]*l[2],h=3),l.length>h&&c.length>h&&t&&(o+=l[0]*c[h]-c[0]*l[h])}return s<=0&&n<=0&&o<=0}function H_t(e){if("rings"in e)for(const t of e.rings)t.length<3||t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]||t.push([t[0][0],t[0][1]])}function q_t(e){return e?e.hasZ?[e.xmax-e.xmin/2,e.ymax-e.ymin/2,e.zmax-e.zmin/2]:[e.xmax-e.xmin/2,e.ymax-e.ymin/2]:null}function bRe(e){return e?zde(e.rings,e.hasZ):null}function zde(e,t){if(!e||!e.length)return null;const i=[],r=[],s=t?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let n=0,o=e.length;n<o;n++){const a=wRe(e[n],t,s);a&&r.push(a)}if(r.sort((n,o)=>{let a=n[2]-o[2];return a===0&&t&&(a=n[4]-o[4]),a}),r.length&&(i[0]=r[0][0],i[1]=r[0][1],t&&(i[2]=r[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||t&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){const n=e[0]&&e[0].length?xRe(e[0],t):null;if(!n)return null;i[0]=n[0],i[1]=n[1],t&&n.length>2&&(i[2]=n[2])}return i}function wRe(e,t,i){let r=0,s=0,n=0,o=0,a=0;const l=e.length?e[0][0]:0,c=e.length?e[0][1]:0,h=e.length&&t?e[0][2]:0;for(let m=0;m<e.length;m++){const g=e[m],v=e[(m+1)%e.length],[b,S,T]=g,O=b-l,C=S-c,M=t?T-h:void 0,[I,$,U]=v,q=I-l,G=$-c,Y=t?U-h:void 0,J=O*G-q*C;if(o+=J,r+=(O+q)*J,s+=(C+G)*J,t&&g.length>2&&v.length>2){const X=O*Y-q*M;n+=(M+Y)*X,a+=X}b<i[0]&&(i[0]=b),b>i[1]&&(i[1]=b),S<i[2]&&(i[2]=S),S>i[3]&&(i[3]=S),t&&(T<i[4]&&(i[4]=T),T>i[5]&&(i[5]=T))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const p=[r/(6*o)+l,s/(6*o)+c,o];return t&&(i[4]===i[5]||a===0?(p[3]=(i[4]+i[5])/2,p[4]=0):(p[3]=n/(6*a)+h,p[4]=a)),p}function xRe(e,t){const i=t?[0,0,0]:[0,0],r=t?[0,0,0]:[0,0];let s=0,n=0,o=0,a=0;for(let l=0,c=e.length;l<c-1;l++){const h=e[l],p=e[l+1];if(h&&p){i[0]=h[0],i[1]=h[1],r[0]=p[0],r[1]=p[1],t&&h.length>2&&p.length>2&&(i[2]=h[2],r[2]=p[2]);const m=MZ(i,r);if(m){s+=m;const g=vRe(h,p);n+=m*g[0],o+=m*g[1],t&&g.length>2&&(a+=m*g[2])}}}return s>0?t?[n/s,o/s,a/s]:[n/s,o/s]:e.length?e[0]:null}function Bde(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function Vde(e){return e.points!==void 0}function Gde(e){return e.x!==void 0&&e.y!==void 0}function jde(e){return e.paths!==void 0}function Hde(e){return e.rings!==void 0}function qde(e){return(t,i)=>t==null?i:i==null?t:e(t,i)}const _v=qde(Math.min),vv=qde(Math.max);function W_t(e,t){return jde(t)?$E(e,t.paths,!1,!1):Hde(t)?$E(e,t.rings,!1,!1):Vde(t)?IZ(e,t.points,!1,!1,!1,!1):Bde(t)?Wde(e,t):(Gde(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.x,e[3]=t.y),e)}function Z_t(e,t){return jde(t)?$E(e,t.paths,!0,!1):Hde(t)?$E(e,t.rings,!0,!1):Vde(t)?IZ(e,t.points,!0,!1,!0,!1):Bde(t)?Wde(e,t,!0,!1,!0,!1):(Gde(t)&&(e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.x,e[4]=t.y,e[5]=t.z),e)}function $E(e,t,i,r){const s=i?3:2;if(!t.length||!t[0].length)return null;let n,o,a,l,[c,h]=t[0][0],[p,m]=t[0][0];for(let g=0;g<t.length;g++){const v=t[g];for(let b=0;b<v.length;b++){const S=v[b],[T,O]=S;if(c=_v(c,T),h=_v(h,O),p=vv(p,T),m=vv(m,O),i&&S.length>2){const C=S[2];n=_v(n,C),o=vv(o,C)}if(r&&S.length>s){const C=S[s];a=_v(n,C),l=vv(o,C)}}}return i?r?(e[0]=c,e[1]=h,e[2]=n,e[3]=a,e[4]=p,e[5]=m,e[6]=o,e[7]=l,e.length=8,e):(e[0]=c,e[1]=h,e[2]=n,e[3]=p,e[4]=m,e[5]=o,e.length=6,e):r?(e[0]=c,e[1]=h,e[2]=a,e[3]=p,e[4]=m,e[5]=l,e.length=6,e):(e[0]=c,e[1]=h,e[2]=p,e[3]=m,e.length=4,e)}function Wde(e,t,i,r,s,n){const o=t.xmin,a=t.xmax,l=t.ymin,c=t.ymax;let h=t.zmin,p=t.zmax,m=t.mmin,g=t.mmax;return s?(h=h||0,p=p||0,n?(m=m||0,g=g||0,e[0]=o,e[1]=l,e[2]=h,e[3]=m,e[4]=a,e[5]=c,e[6]=p,e[7]=g,e):(e[0]=o,e[1]=l,e[2]=h,e[3]=a,e[4]=c,e[5]=p,e)):n?(m=m||0,g=g||0,e[0]=o,e[1]=l,e[2]=m,e[3]=a,e[4]=c,e[5]=g,e):(e[0]=o,e[1]=l,e[2]=a,e[3]=c,e)}function IZ(e,t,i,r,s,n){const o=i?3:2,a=r&&n,l=i&&s;if(!t.length||!t[0].length)return null;let c,h,p,m,[g,v]=t[0],[b,S]=t[0];for(let T=0;T<t.length;T++){const O=t[T],[C,M]=O;if(g=_v(g,C),v=_v(v,M),b=vv(b,C),S=vv(S,M),l&&O.length>2){const I=O[2];c=_v(c,I),h=vv(h,I)}if(a&&O.length>o){const I=O[o];p=_v(c,I),m=vv(h,I)}}return s?(c=c||0,h=h||0,n?(p=p||0,m=m||0,e[0]=g,e[1]=v,e[2]=c,e[3]=p,e[4]=b,e[5]=S,e[6]=h,e[7]=m,e):(e[0]=g,e[1]=v,e[2]=c,e[3]=b,e[4]=S,e[5]=h,e)):n?(p=p||0,m=m||0,e[0]=g,e[1]=v,e[2]=p,e[3]=b,e[4]=S,e[5]=m,e):(e[0]=g,e[1]=v,e[2]=b,e[3]=S,e)}function TRe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function SRe(e){return e.points!==void 0}function ERe(e){return e.x!==void 0&&e.y!==void 0}function CRe(e){return e.paths!==void 0}function ARe(e){return e.rings!==void 0}const LZ=[];function Zde(e,t,i,r){return{xmin:e,ymin:t,xmax:i,ymax:r}}function Xde(e,t,i,r,s,n){return{xmin:e,ymin:t,zmin:i,xmax:r,ymax:s,zmax:n}}function Yde(e,t,i,r,s,n){return{xmin:e,ymin:t,mmin:i,xmax:r,ymax:s,mmax:n}}function Qde(e,t,i,r,s,n,o,a){return{xmin:e,ymin:t,zmin:i,mmin:r,xmax:s,ymax:n,zmax:o,mmax:a}}function $Z(e,t=!1,i=!1){return t?i?Qde(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]):Xde(e[0],e[1],e[2],e[3],e[4],e[5]):i?Yde(e[0],e[1],e[2],e[3],e[4],e[5]):Zde(e[0],e[1],e[2],e[3])}function X_t(e){return e?TRe(e)?e:ERe(e)?RRe(e):ARe(e)?Jde(e):CRe(e)?Kde(e):SRe(e)?ORe(e):null:null}function ORe(e){const{hasZ:t,hasM:i,points:r}=e;return $Z(IZ(LZ,r,t,i),t,i)}function RRe(e){const{x:t,y:i,z:r,m:s}=e,n=s!=null;return r!=null?n?Qde(t,i,r,s,t,i,r,s):Xde(t,i,r,t,i,r):n?Yde(t,i,s,t,i,s):Zde(t,i,t,i)}function Jde(e){const{hasZ:t,hasM:i,rings:r}=e,s=$E(LZ,r,t,i);return s?$Z(s,t,i):null}function Kde(e){const{hasZ:t,hasM:i,paths:r}=e,s=$E(LZ,r,t,i);return s?$Z(s,t,i):null}var hN;function cee(e){return!Array.isArray(e[0])}let Pf=hN=class extends Gc{constructor(...e){super(...e),this.rings=[],this.type="polygon"}static fromExtent(e){const t=e.clone().normalize(),i=e.spatialReference;let r=!1,s=!1;for(const o of t)o.hasZ&&(r=!0),o.hasM&&(s=!0);const n={rings:t.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(r&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:i};return r&&(n.hasZ=!0),s&&(n.hasM=!0),new hN(n)}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.rings?e.rings:null,t||(e.spatialReference?t=e.spatialReference:e.rings||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||wt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=n.length>3):i===void 0?i=r?n.length>3:n.length>2:r===void 0&&(r=i?n.length>3:n.length>2)),{rings:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const e=bRe(this);if(!e||isNaN(e[0])||isNaN(e[1])||this.hasZ&&isNaN(e[2]))return null;const t=new xt;return t.x=e[0],t.y=e[1],t.spatialReference=this.spatialReference,this.hasZ&&(t.z=e[2]),t}get extent(){const{spatialReference:e}=this,t=Jde(this);if(!t)return null;const i=new zi(t);return i.spatialReference=e,i}get isSelfIntersecting(){return mRe(this.rings)}writeRings(e,t){t.rings=me(this.rings)}addRing(e){if(!e)return;const t=this.rings,i=t.length;if(cee(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("rings"),this}clone(){const e=new hN;return e.spatialReference=this.spatialReference,e.rings=me(this.rings),e.hasZ=this.hasZ,e.hasM=this.hasM,e}equals(e){if(this===e)return!0;if(N(e))return!1;const t=this.spatialReference,i=e.spatialReference;if(w(t)!==w(i)||w(t)&&w(i)&&!t.equals(i)||this.rings.length!==e.rings.length)return!1;const r=([s,n,o,a],[l,c,h,p])=>s===l&&n===c&&(o==null&&h==null||o===h)&&(a==null&&p==null||a===p);for(let s=0;s<this.rings.length;s++){const n=this.rings[s],o=e.rings[s];if(!Yv(n,o,r))return!1}return!0}contains(e){if(!e)return!1;const t=aT(e,this.spatialReference);return nRe(this,w(t)?t:e)}isClockwise(e){let t;return t=cee(e)?e.map(i=>this.hasZ?this.hasM?[i.x,i.y,i.z,i.m]:[i.x,i.y,i.z]:[i.x,i.y]):e,PZ(t,this.hasM,this.hasZ)}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.rings[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new xt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new xt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new xt(i[0],i[1],i[2],i[3],this.spatialReference):new xt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(LE(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e].splice(t,0,i),this.notifyChange("rings"),this):this}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new xt(this.rings[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("rings"),i}removeRing(e){if(!this._validateInputs(e,null))return null;const t=this.rings.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new xt(s,i));return this.notifyChange("rings"),r}setPoint(e,t,i){return this._validateInputs(e,t)?(LE(this,i),Array.isArray(i)||(i=i.toArray()),this.rings[e][t]=i,this.notifyChange("rings"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.rings.length)return!1;if(t!=null){const r=this.rings[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([f({readOnly:!0})],Pf.prototype,"cache",null),u([f({readOnly:!0})],Pf.prototype,"centroid",null),u([f({readOnly:!0})],Pf.prototype,"extent",null),u([f({readOnly:!0})],Pf.prototype,"isSelfIntersecting",null),u([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],Pf.prototype,"rings",void 0),u([ut("rings")],Pf.prototype,"writeRings",null),Pf=hN=u([B("esri.geometry.Polygon")],Pf),Pf.prototype.toJSON.isDefaultToJSON=!0;const Ku=Pf;var CG;function MRe(e){return!Array.isArray(e[0])}let v_=CG=class extends Gc{constructor(...e){super(...e),this.paths=[],this.type="polyline"}normalizeCtorArgs(e,t){let i,r,s=null,n=null;return e&&!Array.isArray(e)?(s=e.paths?e.paths:null,t||(e.spatialReference?t=e.spatialReference:e.paths||(t=e)),i=e.hasZ,r=e.hasM):s=e,s=s||[],t=t||wt.WGS84,s.length&&s[0]&&s[0][0]!=null&&typeof s[0][0]=="number"&&(s=[s]),n=s[0]&&s[0][0],n&&(i===void 0&&r===void 0?(i=n.length>2,r=!1):i===void 0?i=!r&&n.length>3:r===void 0&&(r=!i&&n.length>3)),{paths:s,spatialReference:t,hasZ:i,hasM:r}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:e}=this,t=Kde(this);if(!t)return null;const i=new zi(t);return i.spatialReference=e,i}writePaths(e,t){t.paths=me(this.paths)}addPath(e){if(!e)return;const t=this.paths,i=t.length;if(MRe(e)){const r=[];for(let s=0,n=e.length;s<n;s++)r[s]=e[s].toArray();t[i]=r}else t[i]=e.concat();return this.notifyChange("paths"),this}clone(){const e=new CG;return e.spatialReference=this.spatialReference,e.paths=me(this.paths),e.hasZ=this.hasZ,e.hasM=this.hasM,e}getPoint(e,t){if(!this._validateInputs(e,t))return null;const i=this.paths[e][t],r=this.hasZ,s=this.hasM;return r&&!s?new xt(i[0],i[1],i[2],void 0,this.spatialReference):s&&!r?new xt(i[0],i[1],void 0,i[2],this.spatialReference):r&&s?new xt(i[0],i[1],i[2],i[3],this.spatialReference):new xt(i[0],i[1],this.spatialReference)}insertPoint(e,t,i){return this._validateInputs(e,t,!0)?(LE(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e].splice(t,0,i),this.notifyChange("paths"),this):this}removePath(e){if(!this._validateInputs(e,null))return null;const t=this.paths.splice(e,1)[0],i=this.spatialReference,r=t.map(s=>new xt(s,i));return this.notifyChange("paths"),r}removePoint(e,t){if(!this._validateInputs(e,t))return null;const i=new xt(this.paths[e].splice(t,1)[0],this.spatialReference);return this.notifyChange("paths"),i}setPoint(e,t,i){return this._validateInputs(e,t)?(LE(this,i),Array.isArray(i)||(i=i.toArray()),this.paths[e][t]=i,this.notifyChange("paths"),this):this}_validateInputs(e,t,i=!1){if(e==null||e<0||e>=this.paths.length)return!1;if(t!=null){const r=this.paths[e];if(i&&(t<0||t>r.length)||!i&&(t<0||t>=r.length))return!1}return!0}toJSON(e){return this.write({},e)}};u([f({readOnly:!0})],v_.prototype,"cache",null),u([f({readOnly:!0})],v_.prototype,"extent",null),u([f({type:[[[Number]]],json:{write:{isRequired:!0}}})],v_.prototype,"paths",void 0),u([ut("paths")],v_.prototype,"writePaths",null),v_=CG=u([B("esri.geometry.Polyline")],v_),v_.prototype.toJSON.isDefaultToJSON=!0;const Bu=v_;class Hi{constructor(t,i={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=t,this.options=i,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(t),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=r=>this.fromJSON(r),this.write=(r,s,n)=>{const o=this.toJSON(r);o!==void 0&&zc(n,o,s)},this.write.isJSONMapWriter=!0}toJSON(t){if(this.apiToJSON.hasOwnProperty(t)){const i=this.apiToJSON[t];return this.options.useNumericKeys?+i:i}return this.options.ignoreUnknown?void 0:t}fromJSON(t){return this.jsonToAPI.hasOwnProperty(t)?this.jsonToAPI[t]:this.options.ignoreUnknown?void 0:t}_invertMap(t){const i={};for(const r in t)i[t[r]]=r;return i}_getKeysSorted(t){const i=[];for(const r in t)i.push(r);return i.sort(),i}}function La(){return function(e,t){return new Hi(e,{ignoreUnknown:!0,...t})}}const epe=La()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),uee=La()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function tpe(e){return e.xmin!==void 0&&e.ymin!==void 0&&e.xmax!==void 0&&e.ymax!==void 0}function DZ(e){return e.points!==void 0}function NZ(e){return e.x!==void 0&&e.y!==void 0}function FZ(e){return e.paths!==void 0}function sx(e){return e.rings!==void 0}function Vy(e){return N(e)?null:e instanceof Gc?e:NZ(e)?xt.fromJSON(e):FZ(e)?Bu.fromJSON(e):sx(e)?Ku.fromJSON(e):DZ(e)?lT.fromJSON(e):tpe(e)?zi.fromJSON(e):null}function FC(e){return e?NZ(e)?"esriGeometryPoint":FZ(e)?"esriGeometryPolyline":sx(e)?"esriGeometryPolygon":tpe(e)?"esriGeometryEnvelope":DZ(e)?"esriGeometryMultipoint":null:null}const PRe={esriGeometryPoint:xt,esriGeometryPolyline:Bu,esriGeometryPolygon:Ku,esriGeometryEnvelope:zi,esriGeometryMultipoint:lT};function ipe(e){return e&&PRe[e]||null}const cT={base:Gc,key:"type",typeMap:{extent:zi,multipoint:lT,point:xt,polyline:Bu,polygon:Ku}};jp(cT);class iE{constructor(){this._emitter=new iE.EventEmitter(this)}emit(t,i){return this._emitter.emit(t,i)}on(t,i){return this._emitter.on(t,i)}once(t,i){return this._emitter.once(t,i)}hasEventListener(t){return this._emitter.hasEventListener(t)}}(function(e){class t{constructor(s=null){this.target=s,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(s,n){const o=this._listenersMap&&this._listenersMap.get(s);if(!o)return!1;const a=this.target||this;return[...o].forEach(l=>{l.call(a,n)}),o.length>0}on(s,n){if(Array.isArray(s)){const a=s.map(l=>this.on(l,n));return EE(a)}if(s.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(s)||[];return o.push(n),this._listenersMap.set(s,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(s)||[],l=a.indexOf(n);l>=0&&a.splice(l,1)}}}once(s,n){const o=this.on(s,a=>{o.remove(),n.call(null,a)});return o}hasEventListener(s){const n=this._listenersMap&&this._listenersMap.get(s);return n!=null&&n.length>0}}e.EventEmitter=t,e.EventedMixin=r=>{let s=class extends r{constructor(){super(...arguments),this._emitter=new t}destroy(){this._emitter.clear()}emit(n,o){return this._emitter.emit(n,o)}on(n,o){return this._emitter.on(n,o)}once(n,o){return this._emitter.once(n,o)}hasEventListener(n){return this._emitter.hasEventListener(n)}};return s=u([B("esri.core.Evented")],s),s};let i=class extends ze{constructor(){super(...arguments),this._emitter=new iE.EventEmitter(this)}destroy(){this._emitter.clear()}emit(r,s){return this._emitter.emit(r,s)}on(r,s){return this._emitter.on(r,s)}once(r,s){return this._emitter.once(r,s)}hasEventListener(r){return this._emitter.hasEventListener(r)}};i=u([B("esri.core.Evented")],i),e.EventedAccessor=i})(iE||(iE={}));const ks=iE;var gr;(function(e){e[e.ADD=1]="ADD",e[e.REMOVE=2]="REMOVE",e[e.MOVE=4]="MOVE"})(gr||(gr={}));function kZ(e){return(t,i)=>{t[i]=e}}class rpe{constructor(){this._observers=[]}observe(t){return this._observers.includes(t)||this._observers.push(t),new $he(this._observers,t)}notify(){const t=this._observers.slice();for(let i=0;i<t.length;++i){const r=t[i];r.onInvalidated(),r.onCommitted()}}}var py;class IRe{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(t){this.defaultPrevented=!1,this.item=t}}const _h=new qs(IRe,void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1}),LRe=()=>{};function sV(e){return e?e instanceof ww?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function nV(e){if(e&&e.length)return e[0]}function $Re(e,t,i,r){const s=Math.min(e.length-i,t.length-r);let n=0;for(;n<s&&e[i+n]===t[r+n];)n++;return n}function spe(e,t,i,r){t&&t.forEach((s,n,o)=>{e.push(s),spe(e,i.call(r,s,n,o),i,r)})}const $0=new Set,D0=new Set,N0=new Set,oV=new Map;let DRe=0,ww=py=class extends ks.EventedAccessor{constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new rpe,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:DRe++})}static isCollection(e){return e!=null&&e instanceof py}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof py?{items:e}:e:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return _i(this._observable),this._items}set items(e){this._emitBeforeChanges(gr.ADD)||(this._splice(0,this.length,sV(e)),this._emitAfterChanges(gr.ADD))}hasEventListener(e){return e==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(e)}on(e,t){if(e==="change"){const i=this._chgListeners,r={removed:!1,callback:t};return i.push(r),this._notifications&&this._notifications.push({listeners:i.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=LRe,r.removed=!0,i.splice(i.indexOf(r),1)}}}return this._emitter.on(e,t)}once(e,t){const i=this.on(e,t);return{remove(){i.remove()}}}add(e,t){if(_i(this._observable),this._emitBeforeChanges(gr.ADD))return this;const i=this.getNextIndex(t!=null?t:null);return this._splice(i,0,[e]),this._emitAfterChanges(gr.ADD),this}addMany(e,t=this._items.length){if(_i(this._observable),!e||!e.length)return this;if(this._emitBeforeChanges(gr.ADD))return this;const i=this.getNextIndex(t);return this._splice(i,0,sV(e)),this._emitAfterChanges(gr.ADD),this}at(e){if(_i(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(_i(this._observable),!this.length||this._emitBeforeChanges(gr.REMOVE))return[];const e=this._splice(0,this.length)||[];return this._emitAfterChanges(gr.REMOVE),e}clone(){return _i(this._observable),this._createNewInstance({items:this._items.map(me)})}concat(...e){_i(this._observable);const t=e.map(sV);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(_i(this._observable),!this.length||this._emitBeforeChanges(gr.REMOVE))return;const i=this._splice(0,this.length),r=i.length;for(let s=0;s<r;s++)e.call(t,i[s],s,i);this._emitAfterChanges(gr.REMOVE)}every(e,t){return _i(this._observable),this._items.every(e,t)}filter(e,t){let i;return _i(this._observable),i=arguments.length===2?this._items.filter(e,t):this._items.filter(e),this._createNewInstance({items:i})}find(e,t){return _i(this._observable),this._items.find(e,t)}findIndex(e,t){return _i(this._observable),this._items.findIndex(e,t)}flatten(e,t){_i(this._observable);const i=[];return spe(i,this,e,t),new py(i)}forEach(e,t){return _i(this._observable),this._items.forEach(e,t)}getItemAt(e){return _i(this._observable),this._items[e]}getNextIndex(e){_i(this._observable);const t=this.length;return(e=e==null?t:e)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return _i(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return _i(this._observable),this._items.indexOf(e,t)}join(e=","){return _i(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return _i(this._observable),this._items.lastIndexOf(e,t)}map(e,t){_i(this._observable);const i=this._items.map(e,t);return new py({items:i})}reorder(e,t=this.length-1){_i(this._observable);const i=this.indexOf(e);if(i!==-1){if(t<0?t=0:t>=this.length&&(t=this.length-1),i!==t){if(this._emitBeforeChanges(gr.MOVE))return e;this._splice(i,1),this._splice(t,0,[e]),this._emitAfterChanges(gr.MOVE)}return e}}pop(){if(_i(this._observable),!this.length||this._emitBeforeChanges(gr.REMOVE))return;const e=nV(this._splice(this.length-1,1));return this._emitAfterChanges(gr.REMOVE),e}push(...e){return _i(this._observable),this._emitBeforeChanges(gr.ADD)||(this._splice(this.length,0,e),this._emitAfterChanges(gr.ADD)),this.length}reduce(e,t){_i(this._observable);const i=this._items;return arguments.length===2?i.reduce(e,t):i.reduce(e)}reduceRight(e,t){_i(this._observable);const i=this._items;return arguments.length===2?i.reduceRight(e,t):i.reduceRight(e)}remove(e){return _i(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(_i(this._observable),e<0||e>=this.length||this._emitBeforeChanges(gr.REMOVE))return;const t=nV(this._splice(e,1));return this._emitAfterChanges(gr.REMOVE),t}removeMany(e){if(_i(this._observable),!e||!e.length||this._emitBeforeChanges(gr.REMOVE))return[];const t=e instanceof py?e.toArray():e,i=this._items,r=[],s=t.length;for(let n=0;n<s;n++){const o=t[n],a=i.indexOf(o);if(a>-1){const l=1+$Re(t,i,n+1,a+1),c=this._splice(a,l);c&&c.length>0&&r.push.apply(r,c),n+=l-1}}return this._emitAfterChanges(gr.REMOVE),r}reverse(){if(_i(this._observable),this._emitBeforeChanges(gr.MOVE))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(gr.MOVE),this}shift(){if(_i(this._observable),!this.length||this._emitBeforeChanges(gr.REMOVE))return;const e=nV(this._splice(0,1));return this._emitAfterChanges(gr.REMOVE),e}slice(e=0,t=this.length){return _i(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return _i(this._observable),this._items.some(e,t)}sort(e){if(_i(this._observable),!this.length||this._emitBeforeChanges(gr.MOVE))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(gr.MOVE),this}splice(e,t,...i){_i(this._observable);const r=(t?gr.REMOVE:0)|(i.length?gr.ADD:0);if(this._emitBeforeChanges(r))return[];const s=this._splice(e,t,i)||[];return this._emitAfterChanges(r),s}toArray(){return _i(this._observable),this._items.slice()}toJSON(){return _i(this._observable),this.toArray()}toLocaleString(){return _i(this._observable),this._items.toLocaleString()}toString(){return _i(this._observable),this._items.toString()}unshift(...e){return _i(this._observable),!e.length||this._emitBeforeChanges(gr.ADD)||(this._splice(0,0,e),this._emitAfterChanges(gr.ADD)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,i){const r=this._items,s=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=DC(()=>this._dispatchChange())),t){if(o=r.splice(e,t),this.hasEventListener("before-remove")){const a=_h.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)n=o[l],a.reset(n),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),r.splice(e,0,n),e+=1,l-=1,c-=1);_h.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=_h.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);_h.release(a)}}if(i&&i.length){if(s){const h=[];for(const p of i){const m=s.ensureType(p);m==null&&p!=null||h.push(m)}i=h}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=e===this.length;if(a||l){const h=_h.acquire();h.target=this,h.cancellable=!0;const p=_h.acquire();p.target=this,p.cancellable=!1;for(const m of i)a?(h.reset(m),this.emit("before-add",h),h.defaultPrevented||(c?r.push(m):r.splice(e++,0,m),this._set("length",r.length),l&&(p.reset(m),this.emit("after-add",p)))):(c?r.push(m):r.splice(e++,0,m),this._set("length",r.length),p.reset(m),this.emit("after-add",p));_h.release(p),_h.release(h)}else{if(c)for(const h of i)r.push(h);else r.splice(e,0,...i);this._set("length",r.length)}}return(i&&i.length||o&&o.length)&&this._notifyChangeEvent(i,o),o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const i=_h.acquire();i.target=this,i.cancellable=!0,i.type=e,this.emit("before-changes",i),t=i.defaultPrevented,_h.release(i)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=_h.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),_h.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const e=this._notifications;this._notifications=null;for(const t of e){const i=t.changes;$0.clear(),D0.clear(),N0.clear();for(const{added:l,removed:c}of i){if(l)if(N0.size===0&&D0.size===0)for(const h of l)$0.add(h);else for(const h of l)D0.has(h)?(N0.add(h),D0.delete(h)):N0.has(h)||$0.add(h);if(c)if(N0.size===0&&$0.size===0)for(const h of c)D0.add(h);else for(const h of c)$0.has(h)?$0.delete(h):(N0.delete(h),D0.add(h))}const r=Rc.acquire();$0.forEach(l=>{r.push(l)});const s=Rc.acquire();D0.forEach(l=>{s.push(l)});const n=this._items,o=t.items,a=Rc.acquire();if(N0.forEach(l=>{o.indexOf(l)!==n.indexOf(l)&&a.push(l)}),t.listeners&&(r.length||s.length||a.length)){const l={target:this,added:r,removed:s,moved:a},c=t.listeners.length;for(let h=0;h<c;h++){const p=t.listeners[h];p.removed||p.callback.call(this,l)}}Rc.release(r),Rc.release(s),Rc.release(a)}$0.clear(),D0.clear(),N0.clear()}};ww.ofType=e=>{if(!e)return py;if(oV.has(e))return oV.get(e);let t=null;if(typeof e=="function")t=e.prototype.declaredClass;else if(e.base)t=e.base.prototype.declaredClass;else for(const r in e.typeMap){const s=e.typeMap[r].prototype.declaredClass;t?t+=` | ${s}`:t=s}let i=class extends py{};return u([kZ({Type:e,ensureType:typeof e=="function"?hn(e):jp(e)})],i.prototype,"itemType",void 0),i=u([B(`esri.core.Collection<${t}>`)],i),oV.set(e,i),i},u([f()],ww.prototype,"length",void 0),u([f()],ww.prototype,"items",null),ww=py=u([B("esri.core.Collection")],ww);const zt=ww;var DE;function NRe(e,t){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,r="range"in e?e.range[1]:e.maxValue;if(+t<i||+t>r)return DE.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==t))return DE.INVALID_CODED_VALUE}return null}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(DE||(DE={}));let aV;function Em(){return aV||(aV=(async()=>{const e=await _e(()=>import("./arcadeUtils.ed7e1563.js").then(t=>t.t),[],import.meta.url);return{arcade:e.arcade,arcadeUtils:e,Dictionary:e.Dictionary,Feature:e.arcadeFeature}})()),aV}const FRe=(e,t,i)=>V3.create(e,t,i,null,["$feature"]),kRe=(e,t,i)=>V3.create(e,t,i,null,["$feature","$view"]),URe=(e,t,i,r)=>V3.create(e,t,i,r,["$feature","$view"]);class V3{constructor(t,i,r,s,n,o,a,l){this.script=t,this.evaluate=n;const c=Array.isArray(a)?a:a.fields;this.fields=c,this._syntaxTree=s,this._arcade=i,this._arcadeDictionary=r,this._arcadeFeature=o,this._spatialReference=l,this._referencesGeometry=i.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(t,i,r,s,n,o){const{arcade:a,Feature:l,Dictionary:c}=await Em(),h=wt.fromJSON(i),p=a.parseScript(t,o),m=n.reduce((I,$)=>({...I,[$]:null}),{});let g=null;w(s)&&(g=new c(s),g.immutable=!0,m.$config=null);const v=a.scriptUsesGeometryEngine(p)&&a.enableGeometrySupport(),b=a.scriptUsesFeatureSet(p)&&a.enableFeatureSetSupport(),S=a.scriptIsAsync(p)&&a.enableAsyncSupport(),T={vars:m,spatialReference:h,useAsync:!!S},O=new c;O.immutable=!1,O.setField("scale",0);const C=a.compileScript(p,T),M=I=>("$view"in I&&I.$view&&(O.setField("scale",I.$view.scale),I.$view=O),g&&(I.$config=g),C({vars:I,spatialReference:h}));return await Promise.all([v,b,S]),new V3(t,a,c,p,M,new l,r,h)}repurposeFeature(t){return t.geometry&&!t.geometry.spatialReference&&(t.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(t.geometry,t.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(t){return this._arcade.referencesMember(this._syntaxTree,t)}referencesFunction(t){return this._arcade.referencesFunction(this._syntaxTree,t)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}const zRe=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],BRe=["field","normalizationField"];function hee(e,t){if(e!=null&&t!=null){for(const i of Array.isArray(e)?e:[e])if(dee(zRe,i,t),"visualVariables"in i&&i.visualVariables)for(const r of i.visualVariables)dee(BRe,r,t)}}function dee(e,t,i){if(e)for(const r of e){const s=$C(r,t),n=s&&typeof s!="function"&&i.get(s);n&&zc(r,n.name,t)}}function npe(e,t){if(e!=null&&(t==null?void 0:t.fields.length))if("startField"in e){const i=t.get(e.startField),r=t.get(e.endField);e.startField=i&&i.name||null,e.endField=r&&r.name||null}else{const i=t.get(e.startTimeField),r=t.get(e.endTimeField);e.startTimeField=i&&i.name||null,e.endTimeField=r&&r.name||null}}const lV=new Set;function ope(e,t){return e&&t?(lV.clear(),pP(lV,e,t),Array.from(lV).sort()):[]}function pP(e,t,i){var r;if(i)if((r=t==null?void 0:t.fields)!=null&&r.length)if(i.includes("*"))for(const{name:s}of t.fields)e.add(s);else for(const s of i)dd(e,t,s);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const s of i)e.add(s)}}function dd(e,t,i){if(typeof i=="string")if(t){const r=t.get(i);r&&e.add(r.name)}else e.add(i)}function Y_t(e,t){return N(t)||N(e)?[]:t.includes("*")?e.fields.map(i=>i.name):t}async function Yl(e,t,i){var n;if(!i)return;const{arcadeUtils:r}=await Em(),s=r.extractFieldNames(i,(n=t==null?void 0:t.fields)==null?void 0:n.map(o=>o.name));for(const o of s)dd(e,t,o)}async function ape(e,t,i){if(i&&i!=="1=1"){const r=(await _e(()=>import("./WhereClause.d715e7d1.js"),[],import.meta.url)).WhereClause.create(i,t);if(!r.isStandardized)throw new se("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});pP(e,t,r.fieldNames)}}function VRe({displayField:e,fields:t}){return e||(t&&t.length?cV(t,"name-or-title")||cV(t,"unique-identifier")||cV(t,"type-or-category")||GRe(t):null)}function GRe(e){for(const t of e){if(!t||!t.name)continue;const i=t.name.toLowerCase();if(i.includes("name")||i.includes("title"))return t.name}return null}function cV(e,t){for(const i of e)if(i&&i.valueType&&i.valueType===t)return i.name;return null}async function Q_t(e,t){if(!t)return;const i=$C("elevationInfo.featureExpressionInfo",t);return i?i.collectRequiredFields(e,t.fieldsIndex):void 0}async function jRe(e,t,i){i.outStatistic.onStatisticValueExpression?Yl(e,t,i.outStatistic.onStatisticValueExpression):e.add(i.outStatistic.onStatisticField)}async function J_t(e,t,i){var s,n;if(!t||!i||!("fields"in i))return;const r=[];if((s=i.popupTemplate)!=null&&s.expressionInfos&&r.push(...i.popupTemplate.expressionInfos.map(o=>Yl(e,t.fieldsIndex,o.expression))),Array.isArray((n=i.popupTemplate)==null?void 0:n.content)){const o=i.popupTemplate.content;for(const a of o)a.type==="expression"&&a.expressionInfo&&r.push(Yl(e,t.fieldsIndex,a.expressionInfo.expression))}i.fields&&r.push(...i.fields.map(o=>jRe(e,t.fieldsIndex,o))),await Promise.all(r)}async function K_t(e,t,i){t&&(t.timeInfo&&w(i)&&i.timeExtent&&pP(e,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),t.floorInfo&&pP(e,t.fieldsIndex,[t.floorInfo.floorField]),w(i)&&w(i.where)&&await ape(e,t.fieldsIndex,i.where))}async function evt(e,t,i){t&&i&&await Promise.all(i.map(r=>HRe(e,t,r)))}async function HRe(e,t,i){t&&i&&(i.valueExpression?await Yl(e,t.fieldsIndex,i.valueExpression):i.field&&dd(e,t.fieldsIndex,i.field))}function tvt(e){if(!e)return[];const t="editFieldsInfo"in e&&e.editFieldsInfo;return t?ope(e.fieldsIndex,[t&&t.creatorField,t&&t.creationDateField,t&&t.editorField,t&&t.editDateField]):[]}async function ivt(e,t){const{labelingInfo:i,fieldsIndex:r}=t;i&&i.length&&await Promise.all(i.map(s=>qRe(e,r,s)))}async function qRe(e,t,i){if(!i)return;const r=i.getLabelExpression(),s=i.where;if(r.type==="arcade")await Yl(e,t,r.expression);else{const n=r.expression.match(/{[^}]*}/g);n&&n.forEach(o=>{dd(e,t,o.slice(1,-1))})}await ape(e,t,s)}function WRe(e){const t=e.defaultValue;return t!==void 0&&upe(e,t)?t:e.nullable?null:void 0}function lpe(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function ZRe(e){return e===null||lpe(e)}const UZ="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function XRe(e){return e===null||UZ(e)}function cpe(e){return e!=null&&typeof e=="string"}function YRe(e){return e===null||cpe(e)}function QRe(){return!0}function upe(e,t){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?XRe:UZ;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?ZRe:lpe;break;case"string":case"esriFieldTypeString":i=e.nullable?YRe:cpe;break;default:i=QRe}return arguments.length===1?i:i(t)}const JRe=["integer","small-integer","single","double"],KRe=new Set([...JRe,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function kk(e){return e!=null&&KRe.has(e.type)}function rvt(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}var E4,C4;function svt(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function nvt(e,t){return e.nullable&&t===null?null:kk(e)&&!eMe(e.type,Number(t))?E4.OUT_OF_RANGE:upe(e,t)?e.domain?NRe(e.domain,t):null:C4.INVALID_TYPE}function eMe(e,t){const i=typeof e=="string"?hpe(e):e;return!!i&&(i.isInteger?UZ(t)&&t>=i.min&&t<=i.max:t>=i.min&&t<=i.max)}function hpe(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return tMe;case"esriFieldTypeInteger":case"integer":return iMe;case"esriFieldTypeSingle":case"single":return rMe;case"esriFieldTypeDouble":case"double":return sMe}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(E4||(E4={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(C4||(C4={}));const tMe={min:-32768,max:32767,isInteger:!0},iMe={min:-2147483648,max:2147483647,isInteger:!0},rMe={min:-34e37,max:12e37,isInteger:!1},sMe={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function ovt(e,t,i){switch(e){case DE.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case DE.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${t.name}, domain: ${JSON.stringify(t.domain)}`;case C4.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${t.name}, type: ${t.type}, nullable: ${t.nullable}`;case E4.OUT_OF_RANGE:{const{min:r,max:s}=hpe(t.type);return`Value ${i} is out of range for the number type - field: ${t.name}, type: ${t.type}, value range is ${r} to ${s}`}}}function nMe(e,t){return!oMe(e,t,null)}function oMe(e,t,i){if(!t||!t.attributes||!e){if(w(i))for(const n of e)i.add(n);return!0}const r=t.attributes;let s=!1;for(const n of e)if(!(n in r)){if(s=!0,!w(i))break;i.add(n)}return s}function dpe(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(t=>e.toLowerCase().startsWith(t))}let dN=class extends Fe{constructor(e){super(e),this.type=null}};u([f({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],dN.prototype,"type",void 0),dN=u([B("esri.popup.content.Content")],dN);const uT=dN;var AG;let Ab=AG=class extends uT{constructor(e){super(e),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new AG({description:this.description,displayType:this.displayType,title:this.title})}};u([f({type:String,json:{write:!0}})],Ab.prototype,"description",void 0),u([f({type:["auto","preview","list"],json:{write:!0}})],Ab.prototype,"displayType",void 0),u([f({type:String,json:{write:!0}})],Ab.prototype,"title",void 0),u([f({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],Ab.prototype,"type",void 0),Ab=AG=u([B("esri.popup.content.AttachmentsContent")],Ab);const fP=Ab;var OG;let Ob=OG=class extends uT{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new OG({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?me(this.outFields):null})}};u([f()],Ob.prototype,"creator",void 0),u([f()],Ob.prototype,"destroyer",void 0),u([f()],Ob.prototype,"outFields",void 0),u([f({type:["custom"],readOnly:!0})],Ob.prototype,"type",void 0),Ob=OG=u([B("esri.popup.content.CustomContent")],Ob);const aMe=Ob;var RG;let zS=RG=class extends Fe{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new RG({title:this.title,expression:this.expression})}};u([f({type:String,json:{write:!0}})],zS.prototype,"title",void 0),u([f({type:String,json:{write:!0}})],zS.prototype,"expression",void 0),u([f({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],zS.prototype,"returnType",void 0),zS=RG=u([B("esri.popup.ElementExpressionInfo")],zS);const ppe=zS;var MG;let KO=MG=class extends uT{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){var e;return new MG({expressionInfo:(e=this.expressionInfo)==null?void 0:e.clone()})}};u([f({type:ppe,json:{write:!0}})],KO.prototype,"expressionInfo",void 0),u([f({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],KO.prototype,"type",void 0),KO=MG=u([B("esri.popup.content.ExpressionContent")],KO);const zZ=KO;function Rt(e,t={}){var s;const i=e instanceof Hi?e:new Hi(e,t),r={type:(s=t==null?void 0:t.ignoreUnknown)==null||s?i.apiValues:String,json:{type:i.jsonValues,read:!(t!=null&&t.readOnly)&&{reader:i.read},write:{writer:i.write}}};return(t==null?void 0:t.readOnly)!==void 0&&(r.readOnly=!!t.readOnly),(t==null?void 0:t.default)!==void 0&&(r.json.default=t.default),(t==null?void 0:t.name)!==void 0&&(r.json.name=t.name),f(r)}const mP=La()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});mP.toJSON.bind(mP);mP.fromJSON.bind(mP);let mM;var Xue,Yue,Que;const uV=(Que=(Xue=globalThis.esriConfig)==null?void 0:Xue.locale)!=null?Que:(Yue=globalThis.dojoConfig)==null?void 0:Yue.locale;function fpe(){var e,t;return(t=uV!=null?uV:(e=globalThis.navigator)==null?void 0:e.language)!=null?t:"en"}function Hu(){return mM===void 0&&(mM=fpe()),mM}const gM=[];function lMe(e){return gM.push(e),{remove(){gM.splice(gM.indexOf(e),1)}}}const PG=[];function BZ(e){return PG.push(e),{remove(){gM.splice(PG.indexOf(e),1)}}}function cMe(){const e=fpe();mM!==e&&(mM=e,[...PG].forEach(t=>{t.call(null,e)}),[...gM].forEach(t=>{t.call(null,e)}))}var Jue;(Jue=globalThis.addEventListener)==null||Jue.call(globalThis,"languagechange",cMe);const cf={year:"numeric",month:"numeric",day:"numeric"},FA={year:"numeric",month:"long",day:"numeric"},kA={year:"numeric",month:"short",day:"numeric"},UA={year:"numeric",month:"long",weekday:"long",day:"numeric"},Ih={hour:"numeric",minute:"numeric"},Nd={...Ih,second:"numeric"},VZ={"short-date":cf,"short-date-short-time":{...cf,...Ih},"short-date-short-time-24":{...cf,...Ih,hour12:!1},"short-date-long-time":{...cf,...Nd},"short-date-long-time-24":{...cf,...Nd,hour12:!1},"short-date-le":cf,"short-date-le-short-time":{...cf,...Ih},"short-date-le-short-time-24":{...cf,...Ih,hour12:!1},"short-date-le-long-time":{...cf,...Nd},"short-date-le-long-time-24":{...cf,...Nd,hour12:!1},"long-month-day-year":FA,"long-month-day-year-short-time":{...FA,...Ih},"long-month-day-year-short-time-24":{...FA,...Ih,hour12:!1},"long-month-day-year-long-time":{...FA,...Nd},"long-month-day-year-long-time-24":{...FA,...Nd,hour12:!1},"day-short-month-year":kA,"day-short-month-year-short-time":{...kA,...Ih},"day-short-month-year-short-time-24":{...kA,...Ih,hour12:!1},"day-short-month-year-long-time":{...kA,...Nd},"day-short-month-year-long-time-24":{...kA,...Nd,hour12:!1},"long-date":UA,"long-date-short-time":{...UA,...Ih},"long-date-short-time-24":{...UA,...Ih,hour12:!1},"long-date-long-time":{...UA,...Nd},"long-date-long-time-24":{...UA,...Nd,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":Ih,"long-time":Nd},gP=La()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});gP.apiValues;gP.toJSON.bind(gP);gP.fromJSON.bind(gP);const uMe={ar:"ar-u-nu-latn-ca-gregory"};let pN=new WeakMap,mpe=VZ["short-date-short-time"];function hMe(e){const t=e||mpe;if(!pN.has(t)){const i=Hu(),r=uMe[Hu()]||i;pN.set(t,new Intl.DateTimeFormat(r,t))}return pN.get(t)}function Uk(e){return VZ[e]||null}function Cm(e,t){return hMe(t).format(e)}BZ(()=>{pN=new WeakMap,mpe=VZ["short-date-short-time"]});const dMe={ar:"ar-u-nu-latn"};let fN=new WeakMap,gpe={};function pMe(e){const t=e||gpe;if(!fN.has(t)){const i=Hu(),r=dMe[Hu()]||i;fN.set(t,new Intl.NumberFormat(r,e))}return fN.get(t)}function ype(e={}){const t={};return e.digitSeparator!=null&&(t.useGrouping=e.digitSeparator),e.places!=null&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function Am(e,t){return e===-0&&(e=0),pMe(t).format(e)}BZ(()=>{fN=new WeakMap,gpe={}});var IG;let Rb=IG=class extends Fe{constructor(e){super(e),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new IG({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(e){return this.dateFormat?Cm(e,{...Uk(this.dateFormat),...this.dateTimeFormatOptions}):Am(e,ype(this))}formatRasterPixelValue(e){let t,i;return e.trim().includes(",")?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(";")?(t=";",i=t+" ",this._formatDelimitedString(e,t,i,this)):e.trim().includes(" ")?(t=i=" ",this._formatDelimitedString(e,t,i,this)):this.format(Number(e))}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map(s=>this.format(Number(s))).join(i):e}};u([Rt(mP)],Rb.prototype,"dateFormat",void 0),u([f({type:Object,json:{read:!1}})],Rb.prototype,"dateTimeFormatOptions",void 0),u([f({type:Boolean,json:{write:!0}})],Rb.prototype,"digitSeparator",void 0),u([f({type:cs,json:{write:!0}})],Rb.prototype,"places",void 0),Rb=IG=u([B("esri.popup.support.FieldInfoFormat")],Rb);const I2=Rb;var LG;let Hd=LG=class extends Fe{constructor(e){super(e),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new LG({fieldName:this.fieldName,format:this.format?me(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};u([f({type:String,json:{write:!0}})],Hd.prototype,"fieldName",void 0),u([f({type:I2,json:{write:!0}})],Hd.prototype,"format",void 0),u([f({type:Boolean,json:{write:!0,default:!1}})],Hd.prototype,"isEditable",void 0),u([f({type:String,json:{write:!0}})],Hd.prototype,"label",void 0),u([Rt(new Hi({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],Hd.prototype,"stringFieldOption",void 0),u([f({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],Hd.prototype,"statisticType",void 0),u([f({type:String,json:{write:!0}})],Hd.prototype,"tooltip",void 0),u([f({type:Boolean,json:{write:!0}})],Hd.prototype,"visible",void 0),Hd=LG=u([B("esri.popup.FieldInfo")],Hd);const G3=Hd;var $G;let Lg=$G=class extends uT{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(i=>i.toJSON())}clone(){return new $G(me({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};u([f({type:Object,json:{write:!0}})],Lg.prototype,"attributes",void 0),u([f({type:String,json:{write:!0}})],Lg.prototype,"description",void 0),u([f({type:[G3]})],Lg.prototype,"fieldInfos",void 0),u([ut("fieldInfos")],Lg.prototype,"writeFieldInfos",null),u([f({type:String,json:{write:!0}})],Lg.prototype,"title",void 0),u([f({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Lg.prototype,"type",void 0),Lg=$G=u([B("esri.popup.content.FieldsContent")],Lg);const NE=Lg;let Mb=class extends Fe{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};u([f({type:String,json:{write:!0}})],Mb.prototype,"altText",void 0),u([f({type:String,json:{write:!0}})],Mb.prototype,"caption",void 0),u([f({type:String,json:{write:!0}})],Mb.prototype,"title",void 0),u([f({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],Mb.prototype,"type",void 0),Mb=u([B("esri.popup.content.mixins.MediaInfo")],Mb);const GZ=Mb;var DG;let BS=DG=class extends ze{constructor(e){super(e),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new DG({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};u([f()],BS.prototype,"fieldName",void 0),u([f()],BS.prototype,"tooltip",void 0),u([f()],BS.prototype,"value",void 0),BS=DG=u([B("esri.popup.content.support.ChartMediaInfoValueSeries")],BS);const _pe=BS;var NG;let Pb=NG=class extends Fe{constructor(e){super(e),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new NG({fields:me(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};u([f({type:[String],json:{write:!0}})],Pb.prototype,"fields",void 0),u([f({type:String,json:{write:!0}})],Pb.prototype,"normalizeField",void 0),u([f({type:[_pe],json:{read:!1}})],Pb.prototype,"series",void 0),u([f({type:String,json:{write:!0}})],Pb.prototype,"tooltipField",void 0),Pb=NG=u([B("esri.popup.content.support.ChartMediaInfoValue")],Pb);const fMe=Pb;let eR=class extends GZ{constructor(e){super(e),this.type=null,this.value=null}};u([f({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],eR.prototype,"type",void 0),u([f({type:fMe,json:{write:!0}})],eR.prototype,"value",void 0),eR=u([B("esri.popup.content.mixins.ChartMediaInfo")],eR);const zk=eR,Bk=La()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var FG;let mN=FG=class extends zk{constructor(e){super(e),this.type="bar-chart"}clone(){return new FG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([f({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:Bk.write}})],mN.prototype,"type",void 0),mN=FG=u([B("esri.popup.content.BarChartMediaInfo")],mN);const vpe=mN;var kG;let gN=kG=class extends zk{constructor(e){super(e),this.type="column-chart"}clone(){return new kG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([f({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:Bk.write}})],gN.prototype,"type",void 0),gN=kG=u([B("esri.popup.content.ColumnChartMediaInfo")],gN);const bpe=gN;var UG;let tR=UG=class extends Fe{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new UG({linkURL:this.linkURL,sourceURL:this.sourceURL})}};u([f({type:String,json:{write:!0}})],tR.prototype,"linkURL",void 0),u([f({type:String,json:{write:!0}})],tR.prototype,"sourceURL",void 0),tR=UG=u([B("esri.popup.content.support.ImageMediaInfoValue")],tR);const mMe=tR;var zG;let VS=zG=class extends GZ{constructor(e){super(e),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new zG({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};u([f({type:Number,json:{write:!0}})],VS.prototype,"refreshInterval",void 0),u([f({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],VS.prototype,"type",void 0),u([f({type:mMe,json:{write:!0}})],VS.prototype,"value",void 0),VS=zG=u([B("esri.popup.content.ImageMediaInfo")],VS);const wpe=VS;var BG;let yN=BG=class extends zk{constructor(e){super(e),this.type="line-chart"}clone(){return new BG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([f({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:Bk.write}})],yN.prototype,"type",void 0),yN=BG=u([B("esri.popup.content.LineChartMediaInfo")],yN);const xpe=yN;var VG;let _N=VG=class extends zk{constructor(e){super(e),this.type="pie-chart"}clone(){return new VG({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};u([f({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:Bk.write}})],_N.prototype,"type",void 0),_N=VG=u([B("esri.popup.content.PieChartMediaInfo")],_N);const Tpe=_N,Spe={base:GZ,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":vpe,"column-chart":bpe,"line-chart":xpe,"pie-chart":Tpe,image:wpe}};var GG;let qd=GG=class extends uT{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(t=>t.type==="image"?wpe.fromJSON(t):t.type==="barchart"?vpe.fromJSON(t):t.type==="columnchart"?bpe.fromJSON(t):t.type==="linechart"?xpe.fromJSON(t):t.type==="piechart"?Tpe.fromJSON(t):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(i=>i.toJSON())}clone(){return new GG(me({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};u([f()],qd.prototype,"activeMediaInfoIndex",void 0),u([f({type:Object,json:{write:!0}})],qd.prototype,"attributes",void 0),u([f({type:String,json:{write:!0}})],qd.prototype,"description",void 0),u([f({types:[Spe]})],qd.prototype,"mediaInfos",void 0),u([it("mediaInfos")],qd.prototype,"readMediaInfos",null),u([ut("mediaInfos")],qd.prototype,"writeMediaInfos",null),u([f({type:String,json:{write:!0}})],qd.prototype,"title",void 0),u([f({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],qd.prototype,"type",void 0),qd=GG=u([B("esri.popup.content.MediaContent")],qd);const yP=qd;var jG;let iR=jG=class extends uT{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new jG({text:this.text})}};u([f({type:String,json:{write:!0}})],iR.prototype,"text",void 0),u([f({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],iR.prototype,"type",void 0),iR=jG=u([B("esri.popup.content.TextContent")],iR);const FE=iR,gMe={base:null,key:"type",typeMap:{attachment:fP,media:yP,text:FE,expression:zZ,field:NE}};var HG;let Ib=HG=class extends Fe{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new HG({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([f({type:String,json:{write:!0}})],Ib.prototype,"name",void 0),u([f({type:String,json:{write:!0}})],Ib.prototype,"title",void 0),u([f({type:String,json:{write:!0}})],Ib.prototype,"expression",void 0),u([f({type:["string","number"],json:{write:!0}})],Ib.prototype,"returnType",void 0),Ib=HG=u([B("esri.popup.ExpressionInfo")],Ib);const Epe=Ib;var qG;let rR=qG=class extends Fe{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new qG({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};u([f({type:Boolean,json:{write:!0}})],rR.prototype,"returnTopmostRaster",void 0),u([f({type:Boolean,json:{write:!0}})],rR.prototype,"showNoDataRecords",void 0),rR=qG=u([B("esri.popup.LayerOptions")],rR);const yMe=rR;var WG;let sR=WG=class extends Fe{constructor(e){super(e),this.field=null,this.order=null}clone(){return new WG({field:this.field,order:this.order})}};u([f({type:String,json:{write:!0}})],sR.prototype,"field",void 0),u([f({type:["asc","desc"],json:{write:!0}})],sR.prototype,"order",void 0),sR=WG=u([B("esri.popup.support.RelatedRecordsInfoFieldOrder")],sR);const Cpe=sR;var ZG;let nR=ZG=class extends Fe{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new ZG({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?me(this.orderByFields):null})}};u([f({type:Boolean,json:{write:!0}})],nR.prototype,"showRelatedRecords",void 0),u([f({type:[Cpe],json:{write:!0}})],nR.prototype,"orderByFields",void 0),nR=ZG=u([B("esri.popup.RelatedRecordsInfo")],nR);const _Me=nR;let vMe=0;const jZ=e=>{let t=class extends e{constructor(...i){super(...i),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+vMe++})}};return t=u([B("esri.core.Identifiable")],t),t};let pee=class extends jZ(class{}){};pee=u([B("esri.core.Identifiable")],pee);var XG;let Wd=XG=class extends jZ(ze){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new XG({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};u([f()],Wd.prototype,"active",void 0),u([f()],Wd.prototype,"className",void 0),u([f()],Wd.prototype,"disabled",void 0),u([f()],Wd.prototype,"id",void 0),u([f()],Wd.prototype,"indicator",void 0),u([f()],Wd.prototype,"title",void 0),u([f()],Wd.prototype,"type",void 0),u([f()],Wd.prototype,"visible",void 0),Wd=XG=u([B("esri.support.actions.ActionBase")],Wd);const Vk=Wd;var YG;let vN=YG=class extends Vk{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new YG({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};u([f()],vN.prototype,"image",void 0),vN=YG=u([B("esri.support.Action.ActionButton")],vN);const kC=vN;var QG;let oR=QG=class extends Vk{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new QG({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};u([f()],oR.prototype,"image",void 0),u([f()],oR.prototype,"value",void 0),oR=QG=u([B("esri.support.Action.ActionToggle")],oR);const Ape=oR;var JG;const bMe=zt.ofType({key:"type",defaultKeyValue:"button",base:Vk,typeMap:{button:kC,toggle:Ape}}),wMe={base:uT,key:"type",typeMap:{media:yP,custom:aMe,text:FE,attachments:fP,fields:NE,expression:zZ}},Ope="esri.PopupTemplate",xMe=Ie.getLogger(Ope),TMe=["attachments","fields","media","text","expression"];let Kn=JG=class extends Fe{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(e){return Array.isArray(e)?e.map(t=>jp(wMe,t)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||ah(e)?e:(xMe.error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:i}=t;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(t):this._readPopupInfo(t)}writeContent(e,t,i,r){typeof e!="string"?Array.isArray(e)&&(t.popupElements=e.filter(s=>TMe.includes(s.type)).map(s=>s&&s.toJSON(r)),t.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(t):s.type==="media"?this._writeMediaContent(s,t):s.type==="text"&&this._writeTextContent(s,t)})):t.description=e}writeFieldInfos(e,t,i,r){const{content:s}=this,n=Array.isArray(s)?s:null;if(e){const o=n?n.filter(l=>l.type==="fields"):[],a=o.length&&o.every(l=>{var c;return(c=l.fieldInfos)==null?void 0:c.length});t.fieldInfos=e.filter(Boolean).map(l=>{const c=l.toJSON(r);return a&&(c.visible=!1),c})}if(n)for(const o of n)o.type==="fields"&&this._writeFieldsContent(o,t)}writeLayerOptions(e,t,i,r){t[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(r)}writeTitle(e,t){t.title=e||""}clone(){const{actions:e}=this,t=e?me(e.toArray()):[];return new JG({actions:t,content:Array.isArray(this.content)?me(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?me(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?me(this.fieldInfos):null,layerOptions:this.layerOptions?me(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?me(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?me(this.relatedRecordsInfo):null})}async collectRequiredFields(e,t){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...i,...this._getContentExpressionInfos(this.content,i)]),pP(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=me(e.fieldInfos);Array.isArray(t.fieldInfos)?i.forEach(r=>{const s=t.fieldInfos.find(n=>n.fieldName.toLowerCase()===r.fieldName.toLowerCase());s?s.visible=!0:t.fieldInfos.push(r)}):t.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=me(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...i]:t.mediaInfos=i}_readPopupInfoElements({description:e,mediaInfos:t,popupElements:i}){const r={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!t||r.mediaInfos||(s.mediaInfos=t,r.mediaInfos=!0),yP.fromJSON(s)):s.type==="text"?(s.text||!e||r.description||(s.text=e,r.description=!0),FE.fromJSON(s)):s.type==="attachments"?fP.fromJSON(s):s.type==="fields"?NE.fromJSON(s):s.type==="expression"?zZ.fromJSON(s):void 0).filter(Boolean)}_readPopupInfo({description:e,mediaInfos:t,showAttachments:i}){const r=[];return e?r.push(new FE({text:e})):r.push(new NE),Array.isArray(t)&&t.length&&r.push(yP.fromJSON({mediaInfos:t})),i&&r.push(fP.fromJSON({displayType:"auto"})),r.length?r:e}_getContentElementFields(e){const t=e==null?void 0:e.type;if(t==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(t==="custom")return e.outFields||[];if(t==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos||this.fieldInfos)];if(t==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((r,s)=>[...r,...this._getMediaInfoFields(s)],[])]}return t==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:t,title:i,value:r}=e,s=r||{},{fields:n=[],normalizeField:o,tooltipField:a,sourceURL:l,linkURL:c}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...n];return o&&h.push(o),a&&h.push(a),h}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((i,r)=>[...i,...r.type==="expression"&&r.expressionInfo?[r.expressionInfo]:[]],t):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((t,i)=>[...t,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,t,i){i&&await Promise.all(i.map(r=>Yl(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(t=>t.visible===void 0||!!t.visible).map(t=>t.fieldName).filter(t=>!t.includes("relationships/")&&!t.includes("expression/")):[]}_getActionsFields(e){return e?e.toArray().reduce((t,i)=>[...t,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:t,title:i,type:r}=e,s=r==="button"||r==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(t),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const t=/{[^}]*}/g,i=e.match(t);if(!i)return[];const r=/\{(\w+):.+\}/,s=i.filter(n=>!(n.indexOf("{relationships/")===0||n.indexOf("{expression/")===0)).map(n=>n.replace(r,"{$1}"));return s?s.map(n=>n.slice(1,-1)):[]}};u([f({type:bMe})],Kn.prototype,"actions",void 0),u([f()],Kn.prototype,"content",void 0),u([pi("content")],Kn.prototype,"castContent",null),u([it("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],Kn.prototype,"readContent",null),u([ut("content",{popupElements:{type:zt.ofType(gMe)},showAttachments:{type:Boolean},mediaInfos:{type:zt.ofType(Spe)},description:{type:String}})],Kn.prototype,"writeContent",null),u([f({type:[Epe],json:{write:!0}})],Kn.prototype,"expressionInfos",void 0),u([f({type:[G3]})],Kn.prototype,"fieldInfos",void 0),u([ut("fieldInfos")],Kn.prototype,"writeFieldInfos",null),u([f({type:yMe})],Kn.prototype,"layerOptions",void 0),u([ut("layerOptions")],Kn.prototype,"writeLayerOptions",null),u([f({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],Kn.prototype,"lastEditInfoEnabled",void 0),u([f()],Kn.prototype,"outFields",void 0),u([f()],Kn.prototype,"overwriteActions",void 0),u([f()],Kn.prototype,"returnGeometry",void 0),u([f({json:{type:String}})],Kn.prototype,"title",void 0),u([ut("title")],Kn.prototype,"writeTitle",null),u([f({type:_Me,json:{write:!0}})],Kn.prototype,"relatedRecordsInfo",void 0),Kn=JG=u([B(Ope)],Kn);const j3=Kn,A4={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function Rpe(e){return A4[e]||A4[e.toLowerCase()]}function HZ(e){var t;return(t=A4[e])!=null?t:A4[e.toLowerCase()]}function SMe(e){return[...HZ(e)]}function hV(e,t,i){i<0&&++i,i>1&&--i;const r=6*i;return r<1?e+(t-e)*r:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}function Mpe(e,t,i,r=1){const s=(e%360+360)%360/360,n=i<=.5?i*(t+1):i+t-i*t,o=2*i-n;return[Math.round(255*hV(o,n,s+1/3)),Math.round(255*hV(o,n,s)),Math.round(255*hV(o,n,s-1/3)),r]}function EMe(e){const t=e.length>5,i=t?8:4,r=(1<<i)-1,s=t?1:17,n=t?e.length===9:e.length===5;let o=Number("0x"+e.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return n&&(l=o&r,o>>=i,a[3]=s*l/255),l=o&r,o>>=i,a[2]=s*l,l=o&r,o>>=i,a[1]=s*l,l=o&r,o>>=i,a[0]=s*l,a}function mL(e){return Xe(hZ(e),0,255)}function gL(e,t,i){return e=Number(e),isNaN(e)?i:e<t?t:e>i?i:e}class Hn{constructor(t){this.r=255,this.g=255,this.b=255,this.a=1,t&&this.setColor(t)}static blendColors(t,i,r,s=new Hn){return s.r=Math.round(t.r+(i.r-t.r)*r),s.g=Math.round(t.g+(i.g-t.g)*r),s.b=Math.round(t.b+(i.b-t.b)*r),s.a=t.a+(i.a-t.a)*r,s._sanitize()}static fromRgb(t,i){const r=t.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(r){const s=r[2].split(/\s*,\s*/),n=r[1];if(n==="rgb"&&s.length===3||n==="rgba"&&s.length===4){const o=s[0];if(o.charAt(o.length-1)==="%"){const a=s.map(l=>2.56*parseFloat(l));return s.length===4&&(a[3]=parseFloat(s[3])),Hn.fromArray(a,i)}return Hn.fromArray(s.map(a=>parseFloat(a)),i)}if(n==="hsl"&&s.length===3||n==="hsla"&&s.length===4)return Hn.fromArray(Mpe(parseFloat(s[0]),parseFloat(s[1])/100,parseFloat(s[2])/100,parseFloat(s[3])),i)}return null}static fromHex(t,i=new Hn){if(t.length!==4&&t.length!==7||t[0]!=="#")return null;const r=t.length===4?4:8,s=(1<<r)-1;let n=Number("0x"+t.substr(1));return isNaN(n)?null:(["b","g","r"].forEach(o=>{const a=n&s;n>>=r,i[o]=r===4?17*a:a}),i.a=1,i)}static fromArray(t,i=new Hn){return i._set(Number(t[0]),Number(t[1]),Number(t[2]),Number(t[3])),isNaN(i.a)&&(i.a=1),i._sanitize()}static fromString(t,i){const r=Rpe(t)?HZ(t):null;return r&&Hn.fromArray(r,i)||Hn.fromRgb(t,i)||Hn.fromHex(t,i)}static fromJSON(t){return t&&new Hn([t[0],t[1],t[2],t[3]/255])}static toUnitRGB(t){return w(t)?[t.r/255,t.g/255,t.b/255]:null}static toUnitRGBA(t){return w(t)?[t.r/255,t.g/255,t.b/255,t.a!=null?t.a:1]:null}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(t){var i,r,s,n;return typeof t=="string"?Hn.fromString(t,this):Array.isArray(t)?Hn.fromArray(t,this):(this._set((i=t.r)!=null?i:0,(r=t.g)!=null?r:0,(s=t.b)!=null?s:0,(n=t.a)!=null?n:1),t instanceof Hn||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const t=this.r.toString(16),i=this.g.toString(16),r=this.b.toString(16);return`#${t.length<2?"0"+t:t}${i.length<2?"0"+i:i}${r.length<2?"0"+r:r}`}toCss(t=!1){const i=this.r+", "+this.g+", "+this.b;return t?`rgba(${i}, ${this.a})`:`rgb(${i})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(t=Hn.AlphaMode.ALWAYS){const i=mL(this.r),r=mL(this.g),s=mL(this.b);return t===Hn.AlphaMode.ALWAYS||this.a!==1?[i,r,s,mL(255*this.a)]:[i,r,s]}clone(){return new Hn(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(t){return w(t)&&t.r===this.r&&t.g===this.g&&t.b===this.b&&t.a===this.a}_sanitize(){return this.r=Math.round(gL(this.r,0,255)),this.g=Math.round(gL(this.g,0,255)),this.b=Math.round(gL(this.b,0,255)),this.a=gL(this.a,0,1),this}_set(t,i,r,s){this.r=t,this.g=i,this.b=r,this.a=s}}Hn.prototype.declaredClass="esri.Color",function(e){var t;(t=e.AlphaMode||(e.AlphaMode={}))[t.ALWAYS=0]="ALWAYS",t[t.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(Hn||(Hn={}));const at=Hn,fee=new Hi({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let CMe=0,GS=class extends Fe{constructor(e){super(e),this.id="sym"+CMe++,this.type=null,this.color=new at([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}};u([f({type:fee.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:fee.write}}})],GS.prototype,"type",void 0),u([f({type:at,json:{write:{allowNull:!0}}})],GS.prototype,"color",void 0),u([it("color")],GS.prototype,"readColor",null),GS=u([B("esri.symbols.Symbol")],GS);const Wc=GS;var KG;let b_=KG=class extends Wc{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){if(e)for(const i in e)t[i]=e[i]}async collectRequiredFields(e,t){if(this.data.type==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const r=i.map(s=>{const n=s.valueExpressionInfo;return Yl(e,t,n.expression)});await Promise.all(r)}}}clone(){return new KG({data:me(this.data)})}hash(){return nZ(JSON.stringify(this.data)).toString()}};u([f({json:{write:!1}})],b_.prototype,"color",void 0),u([f({json:{write:!0}})],b_.prototype,"data",void 0),u([it("data",["symbol"])],b_.prototype,"readData",null),u([ut("data",{})],b_.prototype,"writeData",null),u([Rt({CIMSymbolReference:"cim"},{readOnly:!0})],b_.prototype,"type",void 0),b_=KG=u([B("esri.symbols.CIMSymbol")],b_);const UC=b_;let jS=class extends Fe{constructor(e){super(e),this.enabled=!0,this.type=null}writeEnabled(e,t,i){e||(t[i]=e)}};u([f({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],jS.prototype,"enabled",void 0),u([ut("enabled")],jS.prototype,"writeEnabled",null),u([f({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],jS.prototype,"type",void 0),jS=u([B("esri.symbols.Symbol3DLayer")],jS);const zm=jS,AMe=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,OMe="screenUtils.toPt: input not recognized!",Ppe=96;function No(e){return e?e/72*Ppe:0}function eh(e){return e?72*e/Ppe:0}function xr(e){if(typeof e=="string"){const t=e.match(AMe);if(t){const i=Number(t[1]),r=t[3]&&t[3].toLowerCase(),s=e.charAt(0)==="-",n=r==="px"?eh(i):i;return s?-n:n}return console.warn(OMe),null}return e}function qp(e=0,t=0){return{x:e,y:t}}function ys(e=0,t=0){return[e,t]}function RMe(e=0,t=0){return[e,t]}function sa(e=0,t=0,i=0){return[e,t,i]}function avt(e){return e}function lvt(e){return e}function cvt(e){return e}function gy(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]}function Gk(e){const t=hZ(100*(1-e));return Math.max(0,Math.min(t,100))}function _P(e){const t=1-e/100;return Math.max(0,Math.min(t,1))}function MMe(e,t){const i=t.transparency!=null?_P(t.transparency):1,r=t.color;return r&&Array.isArray(r)?new at([r[0]||0,r[1]||0,r[2]||0,i]):null}function PMe(e,t){t.color=e.toJSON().slice(0,3);const i=Gk(e.a);i!==0&&(t.transparency=i)}const i0={type:at,json:{type:[cs],default:null,read:{source:["color","transparency"],reader:MMe},write:{target:{color:{type:[cs]},transparency:{type:cs}},writer:PMe}}},Om={type:Number,cast:xr,json:{write:!0}};let Lb=class extends Fe{constructor(e){super(e),this.color=new at([0,0,0,1]),this.extensionLength=0,this.size=eh(1)}clone(){}cloneProperties(){return{color:me(this.color),size:this.size,extensionLength:this.extensionLength}}};u([f({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Lb.prototype,"type",void 0),u([f(i0)],Lb.prototype,"color",void 0),u([f({...Om,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],Lb.prototype,"extensionLength",void 0),u([f(Om)],Lb.prototype,"size",void 0),Lb=u([B("esri.symbols.edges.Edges3D")],Lb);const qZ=Lb;var e7;let bN=e7=class extends qZ{constructor(e){super(e),this.type="sketch"}clone(){return new e7(this.cloneProperties())}};u([Rt({sketch:"sketch"},{readOnly:!0})],bN.prototype,"type",void 0),bN=e7=u([B("esri.symbols.edges.SketchEdges3D")],bN);const IMe=bN;var t7;let wN=t7=class extends qZ{constructor(e){super(e),this.type="solid"}clone(){return new t7(this.cloneProperties())}};u([Rt({solid:"solid"},{readOnly:!0})],wN.prototype,"type",void 0),wN=t7=u([B("esri.symbols.support.SolidEdges3D")],wN);const LMe=wN,Ipe={types:{key:"type",base:qZ,typeMap:{solid:LMe,sketch:IMe}},json:{write:!0}};var i7;let qu=i7=class extends Fe{constructor(e){super(e),this.color=null}clone(){const e={color:w(this.color)?this.color.clone():null};return new i7(e)}};u([f(i0)],qu.prototype,"color",void 0),qu=i7=u([B("esri.symbols.support.Symbol3DMaterial")],qu);var r7;let w_=r7=class extends zm{constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new r7({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:w(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};u([Rt({Extrude:"extrude"},{readOnly:!0})],w_.prototype,"type",void 0),u([f({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],w_.prototype,"size",void 0),u([f({type:qu,json:{write:!0}})],w_.prototype,"material",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],w_.prototype,"castShadows",void 0),u([f(Ipe)],w_.prototype,"edges",void 0),w_=r7=u([B("esri.symbols.ExtrudeSymbol3DLayer")],w_);const Lpe=w_;let aR=class extends Wc{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};u([Rt({esriSLS:"simple-line"},{readOnly:!0})],aR.prototype,"type",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],aR.prototype,"width",void 0),aR=u([B("esri.symbols.LineSymbol")],aR);const $Me=aR,DMe=["begin","end","begin-end"],$pe=["arrow","circle","square","diamond","cross","x"];var s7;let If=s7=class extends Fe{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,i,r){t[i]=(r==null?void 0:r.origin)==="web-map"?"arrow":e}set color(e){this._set("color",e)}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,i,r){(r==null?void 0:r.origin)==="web-map"||(t[i]=e)}clone(){return new s7({color:me(this.color),placement:this.placement,style:this.style})}hash(){var e;return`${this.placement}.${(e=this.color)==null?void 0:e.hash()}.${this.style}`}};u([f({type:["begin","end","begin-end"],json:{write:!0}})],If.prototype,"placement",void 0),u([Rt({"line-marker":"line-marker"},{readOnly:!0}),f({json:{origins:{"web-map":{write:!1}}}})],If.prototype,"type",void 0),u([f({type:$pe})],If.prototype,"style",void 0),u([ut("style")],If.prototype,"writeStyle",null),u([f({type:at,value:null,json:{write:{allowNull:!0}}})],If.prototype,"color",null),u([it("color")],If.prototype,"readColor",null),u([ut("color")],If.prototype,"writeColor",null),If=s7=u([B("esri.symbols.LineSymbolMarker")],If);const NMe=If;var n7;const dV=new Hi({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let $g=n7=class extends $Me{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,i,r,s,n){if(e&&typeof e!="string")return e;const o={};return e!=null&&(o.style=e),t!=null&&(o.color=t),i!=null&&(o.width=xr(i)),r!=null&&(o.cap=r),s!=null&&(o.join=s),n!=null&&(o.miterLimit=xr(n)),o}clone(){var e;return new n7({color:me(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(e=this.marker)==null?void 0:e.clone()})}hash(){var e,t;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(t=this.marker)==null?void 0:t.hash()}`}};u([Rt({esriSLS:"simple-line"},{readOnly:!0})],$g.prototype,"type",void 0),u([f({type:dV.apiValues,json:{read:dV.read,write:dV.write}})],$g.prototype,"style",void 0),u([f({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],$g.prototype,"cap",void 0),u([f({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,i)=>({enabled:e!=="round"&&(i==null||i.origin==null)})}}})],$g.prototype,"join",void 0),u([f({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":NMe}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],$g.prototype,"marker",void 0),u([f({type:Number,json:{read:!1,write:!1}})],$g.prototype,"miterLimit",void 0),$g=n7=u([B("esri.symbols.SimpleLineSymbol")],$g);const Sd=$g;let lR=class extends Wc{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};u([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Sd}},json:{default:null,write:!0}})],lR.prototype,"outline",void 0),u([f({type:["simple-fill","picture-fill"],readOnly:!0})],lR.prototype,"type",void 0),lR=u([B("esri.symbols.FillSymbol")],lR);const Dpe=lR;let xN=class extends Fe{constructor(e){super(e)}clone(){}};u([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],xN.prototype,"type",void 0),xN=u([B("esri.symbols.patterns.LinePattern3D")],xN);const Npe=xN,FMe=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var o7;const kMe=La()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let cR=o7=class extends Npe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new o7(e)}};u([f({type:["style"]})],cR.prototype,"type",void 0),u([Rt(kMe),f({type:FMe})],cR.prototype,"style",void 0),cR=o7=u([B("esri.symbols.patterns.LineStylePattern3D")],cR);const WZ=cR;let TN=class extends Fe{constructor(e){super(e)}clone(){}};u([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],TN.prototype,"type",void 0),TN=u([B("esri.symbols.patterns.Pattern3D")],TN);const Fpe=TN,UMe=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var a7;let uR=a7=class extends Fpe{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new a7(e)}};u([f({type:["style"]})],uR.prototype,"type",void 0),u([f({type:UMe,json:{read:!0,write:!0}})],uR.prototype,"style",void 0),uR=a7=u([B("esri.symbols.patterns.StylePattern3D")],uR);const kpe=uR,zMe={types:{key:"type",base:Fpe,typeMap:{style:kpe}},json:{write:!0}},Upe={types:{key:"type",base:Npe,typeMap:{style:WZ}},json:{write:!0}},yM=new at("white");new at("black");const BMe=new at([255,255,255,0]);function VMe(e){return e.r===0&&e.g===0&&e.b===0}var l7;let _M=l7=class extends qu{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:w(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new l7(e)}};u([Rt({multiply:"multiply",replace:"replace",tint:"tint"})],_M.prototype,"colorMixMode",void 0),_M=l7=u([B("esri.symbols.support.Symbol3DFillMaterial")],_M);function ei(e=qMe){return[e[0],e[1],e[2],e[3]]}function uvt(e){return[e[0],e[1],e[2],e[3]]}function Gy(e,t){return e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e}function ZZ(e,t,i,r,s=ei()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function zpe(e,t=ei()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax,t}function jk(e,t){return new zi({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:t})}function rE(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function nx(e,t,i){if(N(t))Gy(i,e);else if("length"in t)u7(t)?(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[2]),i[3]=Math.max(e[3],t[3])):t.length!==2&&t.length!==3||(i[0]=Math.min(e[0],t[0]),i[1]=Math.min(e[1],t[1]),i[2]=Math.max(e[2],t[0]),i[3]=Math.max(e[3],t[1]));else switch(t.type){case"extent":i[0]=Math.min(e[0],t.xmin),i[1]=Math.min(e[1],t.ymin),i[2]=Math.max(e[2],t.xmax),i[3]=Math.max(e[3],t.ymax);break;case"point":i[0]=Math.min(e[0],t.x),i[1]=Math.min(e[1],t.y),i[2]=Math.max(e[2],t.x),i[3]=Math.max(e[3],t.y)}}function pV(e,t,i=e){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3];for(let l=0;l<r;l++){const c=t[l];s=Math.min(s,c[0]),n=Math.min(n,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return i[0]=s,i[1]=n,i[2]=o,i[3]=a,i}function c7(e){for(let t=0;t<4;t++)if(!isFinite(e[t]))return!1;return!0}function Nu(e){return N(e)||e[0]>=e[2]?0:e[2]-e[0]}function Wp(e){return e[1]>=e[3]?0:e[3]-e[1]}function Bpe(e){return Nu(e)*Wp(e)}function XZ(e,t=[0,0]){return t[0]=(e[0]+e[2])/2,t[1]=(e[1]+e[3])/2,t}function Vpe(e,t){return YZ(e,t[0],t[1])}function mee(e,t){const i=t[3],r=.5*(e[0]+e[2]),s=Math.abs(t[0]-r),n=.5*(e[2]-e[0]);if(s>i+n)return!1;const o=.5*(e[1]+e[3]),a=.5*(e[3]-e[1]),l=Math.abs(t[1]-o);if(l>i+a)return!1;if(s<n||l<a)return!0;const c=s-n,h=l-a;return c*c+h*h<=i*i}function hvt(e,t,i){const r=e[0],s=e[1],n=e[2],o=e[3],{x:a,y:l}=t,{x:c,y:h}=i,p=(S,T)=>(h-l)*S+(a-c)*T+(c*l-a*h)<0,m=p(r,o),g=p(n,o),v=p(n,s),b=p(r,s);return!(m===g&&g===v&&v===b&&b===m||a<r&&c<r||a>n&&c>n||l>o&&h>o||l<s&&h<s)}function dvt(e,t){return YZ(e,t.x,t.y)}function YZ(e,t,i){return t>=e[0]&&i>=e[1]&&t<=e[2]&&i<=e[3]}function hR(e,t,i,r){return t>=e[0]-r&&i>=e[1]-r&&t<=e[2]+r&&i<=e[3]+r}function GMe(e,t,i){return t[0]>=e[0]-i&&t[1]>=e[1]-i&&t[0]<=e[2]+i&&t[1]<=e[3]+i}function H3(e,t){return Math.max(t[0],e[0])<=Math.min(t[2],e[2])&&Math.max(t[1],e[1])<=Math.min(t[3],e[3])}function gee(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}function SN(e,t,i){if(N(t))return Gy(i,e);const r=t[0],s=t[1],n=t[2],o=t[3];return i[0]=Xe(e[0],r,n),i[1]=Xe(e[1],s,o),i[2]=Xe(e[2],r,n),i[3]=Xe(e[3],s,o),i}function jMe(e,t){const i=(e[0]+e[2])/2,r=(e[1]+e[3])/2,s=Math.max(Math.abs(t[0]-i)-Nu(e)/2,0),n=Math.max(Math.abs(t[1]-r)-Wp(e)/2,0);return Math.sqrt(s*s+n*n)}function O4(e,t,i,r=e){return r[0]=e[0]+t,r[1]=e[1]+i,r[2]=e[2]+t,r[3]=e[3]+i,r}function th(e){return e?Gy(e,h7):ei(h7)}function u7(e){return e!=null&&e.length===4}function HMe(e){return!(Nu(e)!==0&&isFinite(e[0])||Wp(e)!==0&&isFinite(e[1]))}function ox(e,t){return u7(e)&&u7(t)?e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]:e===t}const pvt=[-1/0,-1/0,1/0,1/0],h7=[1/0,1/0,-1/0,-1/0],qMe=[0,0,0,0];function dn(e=Wpe){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Rx(e,t,i,r,s,n,o=dn()){return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function fvt(e,t){const i=isFinite(e[2])||isFinite(e[5]);return new zi(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:t}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:t})}function kE(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function WMe(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])}function Rm(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function Vu(e,t,i=0,r=t.length/3){let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<r;h++)s=Math.min(s,t[i+3*h]),n=Math.min(n,t[i+3*h+1]),o=Math.min(o,t[i+3*h+2]),a=Math.max(a,t[i+3*h]),l=Math.max(l,t[i+3*h+1]),c=Math.max(c,t[i+3*h+2]);e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function fV(e,t,i){const r=t.length;let s=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(i)for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),o=Math.min(o,p[2]),a=Math.max(a,p[0]),l=Math.max(l,p[1]),c=Math.max(c,p[2])}else for(let h=0;h<r;h++){const p=t[h];s=Math.min(s,p[0]),n=Math.min(n,p[1]),a=Math.max(a,p[0]),l=Math.max(l,p[1])}e[0]=s,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function ZMe(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0}function hT(e){return e[0]>=e[3]?0:e[3]-e[0]}function dT(e){return e[1]>=e[4]?0:e[4]-e[1]}function v1(e){return e[2]>=e[5]?0:e[5]-e[2]}function Gpe(e){const t=hT(e),i=v1(e),r=dT(e);return Math.sqrt(t*t+i*i+r*r)}function Op(e,t=[0,0,0]){return t[0]=e[0]+hT(e)/2,t[1]=e[1]+dT(e)/2,t[2]=e[2]+v1(e)/2,t}function yL(e,t=[0,0,0]){return t[0]=hT(e),t[1]=dT(e),t[2]=v1(e),t}function XMe(e){return Math.max(hT(e),v1(e),dT(e))}function QZ(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]}function mvt(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]}function YMe(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function Rp(e,t){return!!N(t)||YMe(e,t)}function jpe(e,t,i,r,s=e){return s[0]=e[0]+t,s[1]=e[1]+i,s[2]=e[2]+r,s[3]=e[3]+t,s[4]=e[4]+i,s[5]=e[5]+r,s}function gvt(e,t,i=e){const r=e[0]+hT(e)/2,s=e[1]+dT(e)/2,n=e[2]+v1(e)/2;return i[0]=r+(e[0]-r)*t,i[1]=s+(e[1]-s)*t,i[2]=n+(e[2]-n)*t,i[3]=r+(e[3]-r)*t,i[4]=s+(e[4]-s)*t,i[5]=n+(e[5]-n)*t,i}function Hpe(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function qpe(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function Hk(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Fr(e){return e?Hk(e,_ee):dn(_ee)}function JZ(e,t){return t||(t=ei()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t}function yvt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function yee(e){return e.length===6}function qk(e){return hT(e)===0&&dT(e)===0&&v1(e)===0}function _vt(e,t,i){if(N(e)||N(t))return e===t;if(!yee(e)||!yee(t))return!1;if(i){for(let r=0;r<e.length;r++)if(!i(e[r],t[r]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function QMe(e,t,i,r,s,n){return Rx(e,t,i,r,s,n,JMe)}const vvt=[-1/0,-1/0,-1/0,1/0,1/0,1/0],_ee=[1/0,1/0,1/0,-1/0,-1/0,-1/0],Wpe=[0,0,0,0,0,0],JMe=dn();function mV(e,{isPrimitive:t,width:i,depth:r,height:s}){const n=t?10:1;if(i==null&&s==null&&r==null)return[n*e[0],n*e[1],n*e[2]];const o=Ke(i,r,s);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/e[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=e[l]*a);return o}const KMe=Rx(-.5,-.5,-.5,.5,.5,.5),ePe=Rx(-.5,-.5,0,.5,.5,1),tPe=Rx(-.5,-.5,0,.5,.5,.5);function iPe(e){switch(e){case"sphere":case"cube":case"diamond":return KMe;case"cylinder":case"cone":case"inverted-cone":return ePe;case"tetrahedron":return tPe;default:return}}const KZ=["butt","square","round"],rPe=[...KZ,"none"],Zpe=["miter","bevel","round"];var d7;let $b=d7=class extends Fe{constructor(e){super(e),this.color=new at([0,0,0,1]),this.size=eh(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:w(this.color)?this.color.clone():null,size:this.size,pattern:w(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new d7(e)}};u([f(i0)],$b.prototype,"color",void 0),u([f(Om)],$b.prototype,"size",void 0),u([f(Upe)],$b.prototype,"pattern",void 0),u([f({type:KZ,json:{default:"butt",write:{overridePolicy(){return{enabled:w(this.pattern)}}}}})],$b.prototype,"patternCap",void 0),$b=d7=u([B("esri.symbols.support.Symbol3DOutline")],$b);var EN;let Dg=EN=class extends zm{constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:w(this.edges)?this.edges.clone():null,enabled:this.enabled,material:w(this.material)?this.material.clone():null,pattern:w(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:w(this.outline)?this.outline.clone():null};return new EN(e)}static fromSimpleFillSymbol(e){var r,s,n,o,a,l;const t=e.outline&&e.outline.style&&e.outline.style!=="inside-frame"&&e.outline.style!=="solid"?new WZ({style:e.outline.style}):null,i={size:(s=(r=e.outline)==null?void 0:r.width)!=null?s:0,color:((o=(n=e.outline)==null?void 0:n.color)!=null?o:yM).clone(),pattern:t};return t&&((a=e.outline)==null?void 0:a.cap)&&(i.patternCap=e.outline.cap),new EN({material:new _M({color:((l=e.color)!=null?l:BMe).clone()}),pattern:e.style&&e.style!=="solid"?new kpe({style:e.style}):null,outline:i})}};u([Rt({Fill:"fill"},{readOnly:!0})],Dg.prototype,"type",void 0),u([f({type:_M,json:{write:!0}})],Dg.prototype,"material",void 0),u([f(zMe)],Dg.prototype,"pattern",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Dg.prototype,"castShadows",void 0),u([f({type:$b,json:{write:!0}})],Dg.prototype,"outline",void 0),u([f(Ipe)],Dg.prototype,"edges",void 0),Dg=EN=u([B("esri.symbols.FillSymbol3DLayer")],Dg);const Wk=Dg,sPe=["none","underline","line-through"],nPe=["normal","italic","oblique"],oPe=["normal","lighter","bold","bolder"],Xpe={type:Number,cast:e=>{const t=Kh(e);return t===0?1:Xe(t,.1,4)},nonNullable:!0},aPe=["left","right","center"],lPe=["baseline","top","middle","bottom"],Ype={type:aPe,nonNullable:!0},Qpe={type:lPe,nonNullable:!0};var p7;let Ng=p7=class extends Fe{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return xr(e)}clone(){return new p7({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};u([f({type:sPe,json:{default:"none",write:!0}})],Ng.prototype,"decoration",void 0),u([f({type:String,json:{write:!0}})],Ng.prototype,"family",void 0),u([f({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.textSymbol3D})}}})],Ng.prototype,"size",void 0),u([pi("size")],Ng.prototype,"castSize",null),u([f({type:nPe,json:{default:"normal",write:!0}})],Ng.prototype,"style",void 0),u([f({type:oPe,json:{default:"normal",write:!0}})],Ng.prototype,"weight",void 0),Ng=p7=u([B("esri.symbols.Font")],Ng);const Zk=Ng,cPe=Ie.getLogger("esri.core.urlUtils"),zC=sr.request,vee="esri/config: esriConfig.request.proxyUrl is not set.",Jpe=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,Kpe=/^\s*http:/i,uPe=/^\s*https:/i,hPe=/^\s*file:/i,dPe=/:\d+$/,pPe=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,fPe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),mPe=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class sE{constructor(t=""){this.uri=t,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let i=this.uri.match(fPe);this.scheme=i[2]||(i[1]?"":null),this.authority=i[4]||(i[3]?"":null),this.path=i[5],this.query=i[7]||(i[6]?"":null),this.fragment=i[9]||(i[8]?"":null),this.authority!=null&&(i=this.authority.match(mPe),this.user=i[3]||null,this.password=i[4]||null,this.host=i[6]||i[7],this.port=i[9]||null)}toString(){return this.uri}}const _L={},gPe=new sE(sr.applicationUrl);let sl=gPe;const yPe=_Pe();let eX=yPe;const tX=()=>sl,bvt=()=>eX;function _Pe(){const e=sl.path,t=e.substring(0,e.lastIndexOf(e.split("/")[e.split("/").length-1]));return`${`${sl.scheme}://${sl.host}${sl.port!=null?`:${sl.port}`:""}`}${t}`}function $a(e){const t={path:null,query:null},i=new sE(e),r=e.indexOf("?");return i.query===null?t.path=e:(t.path=e.substring(0,r),t.query=efe(i.query)),i.fragment&&(t.hash=i.fragment,i.query===null&&(t.path=t.path.substring(0,t.path.length-(i.fragment.length+1)))),t}function efe(e){const t=e.split("&"),i={};for(const r of t){if(!r)continue;const s=r.indexOf("=");let n,o;s<0?(n=decodeURIComponent(r),o=""):(n=decodeURIComponent(r.slice(0,s)),o=decodeURIComponent(r.slice(s+1)));let a=i[n];typeof a=="string"&&(a=i[n]=[a]),Array.isArray(a)?a.push(o):i[n]=o}return i}function bee(e){return e&&typeof e=="object"&&"toJSON"in e&&typeof e.toJSON=="function"}function vP(e,t){return e?t&&typeof t=="function"?Object.keys(e).map(i=>encodeURIComponent(i)+"="+encodeURIComponent(t(i,e[i]))).join("&"):Object.keys(e).map(i=>{const r=e[i];if(r==null)return"";const s=encodeURIComponent(i)+"=",n=t&&t[i];return n?s+encodeURIComponent(n(r)):Array.isArray(r)?r.map(o=>bee(o)?s+encodeURIComponent(JSON.stringify(o)):s+encodeURIComponent(o)).join("&"):bee(r)?s+encodeURIComponent(JSON.stringify(r)):s+encodeURIComponent(r)}).filter(i=>i).join("&"):""}function vPe(e=!1){let t,i=zC.proxyUrl;if(typeof e=="string"){t=EPe(e);const r=Xk(e);r&&(i=r.proxyUrl)}else t=!!e;if(!i)throw cPe.warn(vee),new se("urlutils:proxy-not-set",vee);return t&&f7()&&(i=oX(i)),$a(i)}function wvt(e){const t=Xk(e);let i,r;if(t){const s=iX(t.proxyUrl);i=s.path,r=s.query?efe(s.query):null}if(i){const s=$a(e);e=i+"?"+s.path;const n=vP({...r,...s.query});n&&(e=`${e}?${n}`)}return e}const zA={path:"",query:""};function iX(e){const t=e.indexOf("?");return t!==-1?(zA.path=e.slice(0,t),zA.query=e.slice(t+1)):(zA.path=e,zA.query=null),zA}function tfe(e){return e=(e=R4(e=PPe(e=iX(e).path),!0)).toLowerCase()}function bPe(e){const t={proxyUrl:e.proxyUrl,urlPrefix:tfe(e.urlPrefix)},i=zC.proxyRules,r=t.urlPrefix;let s=i.length;for(let n=0;n<i.length;n++){const o=i[n].urlPrefix;if(r.indexOf(o)===0){if(r.length===o.length)return-1;s=n;break}o.indexOf(r)===0&&(s=n+1)}return i.splice(s,0,t),s}function Xk(e){const t=zC.proxyRules,i=tfe(e);for(let r=0;r<t.length;r++)if(i.indexOf(t[r].urlPrefix)===0)return t[r]}function ife(e,t){return e=wee(e),t=wee(t),R4(e)===R4(t)}function wee(e){const t=(e=Fp(e)).indexOf("/sharing");return t>0?e.substring(0,t):e.replace(/\/+$/,"")}function rfe(e){const t=r=>r==null||r instanceof RegExp&&r.test(e)||typeof r=="string"&&e.startsWith(r),i=zC.interceptors;if(i){for(const r of i)if(Array.isArray(r.urls)){if(r.urls.some(t))return r}else if(t(r.urls))return r}return null}function bP(e,t,i=!1){const r=g7(e),s=g7(t);return!(!i&&r.scheme!==s.scheme)&&r.host!=null&&s.host!=null&&r.host.toLowerCase()===s.host.toLowerCase()&&r.port===s.port}function rX(e){if(typeof e=="string"){if(!Wu(e))return!0;e=g7(e)}if(bP(e,sl))return!0;const t=zC.trustedServers||[];for(let i=0;i<t.length;i++){const r=wPe(t[i]);for(let s=0;s<r.length;s++)if(bP(e,r[s]))return!0}return!1}function wPe(e){return _L[e]||(nX(e)||Mm(e)?_L[e]=[new sE(cd(e))]:_L[e]=[new sE(`http://${e}`),new sE(`https://${e}`)]),_L[e]}function cd(e,t=eX,i){return Mm(e)?i&&i.preserveProtocolRelative?e:sl.scheme==="http"&&sl.authority===kp(e).slice(2)?`http:${e}`:`https:${e}`:nX(e)?e:Mx(e[0]==="/"?RPe(t):t,e)}function sX(e,t=eX,i){if(!Wu(e))return e;const r=Fp(e),s=r.toLowerCase(),n=Fp(t).toLowerCase().replace(/\/+$/,""),o=i?Fp(i).toLowerCase().replace(/\/+$/,""):null;if(o&&n.indexOf(o)!==0)return e;const a=(p,m,g)=>(g=p.indexOf(m,g))===-1?p.length:g;let l=a(s,"/",s.indexOf("//")+2),c=-1;for(;s.slice(0,l+1)===n.slice(0,l)+"/"&&(c=l+1,l!==s.length);)l=a(s,"/",l+1);if(c===-1||o&&c<o.length)return e;e=r.slice(c);const h=n.slice(c-1).replace(/[^/]+/g,"").length;if(h>0)for(let p=0;p<h;p++)e=`../${e}`;else e=`./${e}`;return e}function Fp(e){return e=$Pe(e=LPe(e=IPe(e=cd(e=e.trim()))))}function Mx(...e){const t=e.filter(w);if(!t||!t.length)return;const i=[];if(Wu(t[0])){const s=t[0],n=s.indexOf("//");n!==-1&&(i.push(s.slice(0,n+1)),APe(t[0])&&(i[0]+="/"),t[0]=s.slice(n+2))}else t[0][0]==="/"&&i.push("");const r=t.reduce((s,n)=>n?s.concat(n.split("/")):s,[]);for(let s=0;s<r.length;s++){const n=r[s];n===".."&&i.length>0&&i[i.length-1]!==".."?i.pop():(!n&&s===r.length-1||n&&(n!=="."||i.length===0))&&i.push(n)}return i.join("/")}function kp(e,t=!1){if(UE(e)||Bm(e))return null;let i=e.indexOf("://");if(i===-1&&Mm(e))i=2;else{if(i===-1)return null;i+=3}const r=e.indexOf("/",i);return r!==-1&&(e=e.slice(0,r)),t&&(e=R4(e,!0)),e}function Wu(e){return Mm(e)||nX(e)}function UE(e){return e!=null&&e.slice(0,5)==="blob:"}function Bm(e){return e.slice(0,5)==="data:"}function sfe(e){const t=Yk(e);if(!t||!t.isBase64)return null;const i=atob(t.data),r=new Uint8Array(i.length);for(let s=0;s<i.length;s++)r[s]=i.charCodeAt(s);return r.buffer}function xvt(e){return btoa(String.fromCharCode.apply(null,e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const xPe=/^data:(.*?)(;base64)?,(.*)$/;function Yk(e){const t=e.match(xPe);if(!t)return null;const[,i,r,s]=t;return{mediaType:i,isBase64:!!r,data:s}}function nfe(e){return e.isBase64?`data:${e.mediaType};base64,${e.data}`:`data:${e.mediaType},${e.data}`}function Tvt(e,t){TPe(e,t)||SPe(e,t)}function TPe(e,t){if(!e)return!1;const i=document.createElement("a");if(!("download"in i))return!1;const r=URL.createObjectURL(e);return i.download=t,i.href=r,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),!0}function SPe(e,t){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(e,t)}function Mm(e){return e!=null&&e!==void 0&&e[0]==="/"&&e[1]==="/"}function nX(e){return Jpe.test(e)}function EPe(e){return uPe.test(e)||sl.scheme==="https"&&Mm(e)}function CPe(e){return Kpe.test(e)||sl.scheme==="http"&&Mm(e)}function APe(e){return hPe.test(e)}function oX(e){return Mm(e)?`https:${e}`:e.replace(Kpe,"https:")}function OPe(){return sl.scheme==="http"}function f7(){return sl.scheme==="https"}function R4(e,t=!1){return Mm(e)?e.slice(2):(e=e.replace(Jpe,""),t&&e.length>1&&e[0]==="/"&&e[1]==="/"&&(e=e.slice(2)),e)}function RPe(e){const t=e.indexOf("//"),i=e.indexOf("/",t+2);return i===-1?e:e.slice(0,i)}function MPe(e){let t=0;if(Wu(e)){const r=e.indexOf("//");r!==-1&&(t=r+2)}const i=e.lastIndexOf("/");return i<t?e:e.slice(0,i+1)}function Svt(e,t){if(!e)return"";const i=$a(e).path.replace(/\/+$/,""),r=i.substring(i.lastIndexOf("/")+1);if(!(t!=null&&t.length))return r;const s=new RegExp(`.(${t.join("|")})$`,"ig");return r.replace(s,"")}function PPe(e){return e&&e[e.length-1]==="/"?e:`${e}/`}function ofe(e){return e.replace(/\/+$/,"")}function IPe(e){if(/^https?:\/\//i.test(e)){const t=iX(e);e=(e=t.path.replace(/\/{2,}/g,"/")).replace("/","//"),t.query&&(e+=`?${t.query}`)}return e}function LPe(e){return e.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function $Pe(e){const t=zC.httpsDomains;if(!CPe(e))return e;const i=e.indexOf("/",7);let r;if(r=i===-1?e:e.slice(0,i),r=r.toLowerCase().slice(7),dPe.test(r)){if(!r.endsWith(":80"))return e;r=r.slice(0,-3),e=e.replace(":80","")}return OPe()&&r===sl.authority&&!pPe.test(e)||(f7()&&r===sl.authority||t&&t.some(s=>r===s||r.endsWith(`.${s}`))||f7()&&!Xk(e))&&(e=oX(e)),e}function m7(e,t,i){if(!(t&&i&&e&&Wu(e)))return e;const r=e.indexOf("//"),s=e.indexOf("/",r+2),n=e.indexOf(":",r+2),o=Math.min(s<0?e.length:s,n<0?e.length:n);return e.slice(r+2,o).toLowerCase()!==t.toLowerCase()?e:`${e.slice(0,r+2)}${i}${e.slice(o)}`}function g7(e){return typeof e=="string"?new sE(cd(e)):(e.scheme||(e.scheme=sl.scheme),e)}function aX(e){return NPe.test(e)}function afe(e,t){const i=$a(e),r=Object.keys(i.query||{});return r.length>0&&t&&t.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${r.join(", ")}.`),i.path}function lfe(e,t,i){const r=$a(e),s=r.query||{};return s[t]=String(i),`${r.path}?${vP(s)}`}function gV(e,t){const i=$a(e),r=i.query||{};for(const n in t)r[n]=t[n];const s=vP(r);return s?`${i.path}?${s}`:i.path}function Evt(e){if(N(e))return null;const t=e.match(DPe);return t?t[1]:null}const DPe=/.*?\.([^\/]*)$/,NPe=/(^data:image\/svg|\.svg$)/i;function BC(e,t){const i=t&&t.url&&t.url.path;if(e&&i&&(e=cd(e,i,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const r=sX(e,t.portalItem.itemUrl);kPe.test(r)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(r).path)}return y7(e,t&&t.portal)}function Px(e,t,i=wP.YES){if(!e)return e;!Wu(e)&&t&&t.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let r=cd(e);if(t){const s=t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.rootPath||t.url&&t.url.path;if(s){const n=y7(s,t.portal);r=sX(y7(r,t.portal),n,n),r!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(r)}}return r=cfe(r,t&&t.portal),Wu(r)&&(r=Fp(r)),(t==null?void 0:t.resources)&&(t==null?void 0:t.portalItem)&&!Wu(r)&&!Bm(r)&&i===wP.YES&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(r)}),r}function lX(e,t,i){return BC(e,i)}function e1(e,t,i,r){const s=Px(e,r);s!==void 0&&(t[i]=s)}const FPe=/\/items\/([^\/]+)\/resources\//,kPe=/^\.\/resources\//;function UPe(e){const t=w(e)?e.match(FPe):null;return w(t)?t[1]:null}function cfe(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?m7(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function y7(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const i=`${t.urlKey}.${t.customBaseUrl}`,r=tX();return bP(r,`${r.scheme}://${i}`)?m7(e,t.portalHostname,i):m7(e,i,t.portalHostname)}var wP;(function(e){e[e.YES=0]="YES",e[e.NO=1]="NO"})(wP||(wP={}));const Cvt=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:BC,toJSON:Px,read:lX,write:e1,itemIdFromResourceUrl:UPe,ensureMainOnlineDomain:cfe,get MarkKeep(){return wP}},Symbol.toStringTag,{value:"Module"}));var _7;const zPe=La()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Db=_7=class extends Fe{constructor(e){super(e)}readHref(e,t,i){return e?BC(e,i):t.dataURI}writeHref(e,t,i,r){e&&(Bm(e)?t.dataURI=e:(t.href=Px(e,r),Wu(t.href)&&(t.href=Fp(t.href))))}clone(){return new _7({href:this.href,primitive:this.primitive})}};u([f({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Db.prototype,"href",void 0),u([it("href")],Db.prototype,"readHref",null),u([ut("href",{href:{type:String},dataURI:{type:String}})],Db.prototype,"writeHref",null),u([Rt(zPe)],Db.prototype,"primitive",void 0),Db=_7=u([B("esri.symbols.support.IconSymbol3DLayerResource")],Db);const BPe="circle";var v7;let L2=v7=class extends ze{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new v7({x:this.x,y:this.y})}};u([f({type:Number})],L2.prototype,"x",void 0),u([f({type:Number})],L2.prototype,"y",void 0),L2=v7=u([B("esri.symbols.support.Symbol3DAnchorPosition2D")],L2);var b7;let dR=b7=class extends Fe{constructor(e){super(e),this.color=new at([0,0,0,1]),this.size=eh(1)}clone(){const e={color:w(this.color)?this.color.clone():null,size:this.size};return new b7(e)}};u([f(i0)],dR.prototype,"color",void 0),u([f(Om)],dR.prototype,"size",void 0),dR=b7=u([B("esri.symbols.support.Symbol3DIconOutline")],dR);var HS;const VPe=Ie.getLogger("esri.symbols.IconSymbol3DLayer");let Lf=HS=class extends zm{constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new HS({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:w(this.material)?this.material.clone():null,outline:w(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||yM,i=xee(e),r=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||yM).clone()}:null;return new HS({size:e.size,resource:{primitive:jPe(e.style)},material:{color:t},outline:r,anchor:i?"relative":void 0,anchorPosition:i})}static fromPictureMarkerSymbol(e){const t=!e.color||VMe(e.color)?yM:e.color,i=xee(e);return new HS({size:e.width<=e.height?e.height:e.width,resource:{href:e.url},material:{color:t.clone()},anchor:i?"relative":void 0,anchorPosition:i})}static fromCIMSymbol(e){return new HS({resource:{href:nfe({mediaType:"application/json",data:JSON.stringify(e.data)})}})}};function xee(e){const t="width"in e?e.width:e.size,i="height"in e?e.height:e.size,r=Tee(e.xoffset),s=Tee(e.yoffset);return(r||s)&&t&&i?{x:-r/t,y:s/i}:null}function Tee(e){return isFinite(e)?e:0}u([f({type:qu,json:{write:!0}})],Lf.prototype,"material",void 0),u([f({type:Db,json:{write:!0}})],Lf.prototype,"resource",void 0),u([Rt({Icon:"icon"},{readOnly:!0})],Lf.prototype,"type",void 0),u([f(Om)],Lf.prototype,"size",void 0),u([Rt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),f({json:{default:"center"}})],Lf.prototype,"anchor",void 0),u([f({type:L2,json:{type:[Number],read:{reader:e=>new L2({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Lf.prototype,"anchorPosition",void 0),u([f({type:dR,json:{write:!0}})],Lf.prototype,"outline",void 0),Lf=HS=u([B("esri.symbols.IconSymbol3DLayer")],Lf);const GPe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function jPe(e){return GPe[e]||(VPe.warn(`${e} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const bv=Lf;function Ix(e,t,i=zt){return t||(t=new i),t===e||(t.removeAll(),HPe(e)?t.addMany(e):e&&t.add(e)),t}function ufe(e){return e}function HPe(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}const hfe="20220708",dfe="7fd01dbc0e83d753fcf101c8ff2a8d215430252d",pfe="4.24",qPe={async request(e,t){var a;const{default:i}=await _e(()=>Promise.resolve().then(()=>l3e),void 0,import.meta.url),r=e.options,s=r.responseType;r.signal=t==null?void 0:t.signal,r.responseType=s==="native"||s==="native-request-init"?"native-request-init":["blob","json","text"].includes(s)&&((a=rfe(e.url))==null?void 0:a.after)?s:"array-buffer";const n=await i(e.url,r),o={data:n.data,ssl:n.ssl};switch(n.requestOptions.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let cn;function Avt(e){cn=e}function Ovt(e){const t=cn&&cn.findCredential(e);return t&&t.token?lfe(e,"token",t.token):e}Ce("host-webworker")||(Ce("edge")||Ce("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser");const WPe=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function ffe(e){const t=kp(e,!0);return t&&t.endsWith(".arcgis.com")&&!WPe.includes(t)&&!e.endsWith("/sharing/rest/generateToken")}function mfe(e,t,i=!1,r){return new Promise((s,n)=>{if(An(r))return void n(See());let o=()=>{c(),n(new Error(`Unable to load ${t}`))},a=()=>{const h=e;c(),s(h)},l=()=>{if(!e)return;const h=e;c(),h.src="",n(See())};const c=()=>{Ce("esri-image-decode")||(e.removeEventListener("error",o),e.removeEventListener("load",a)),o=null,a=null,e=null,w(r)&&r.removeEventListener("abort",l),l=null,i&&URL.revokeObjectURL(t)};w(r)&&r.addEventListener("abort",l),Ce("esri-image-decode")?e.decode().then(a,o):(e.addEventListener("error",o),e.addEventListener("load",a))})}function See(){try{return new DOMException("Aborted","AbortError")}catch{const e=new Error;return e.name="AbortError",e}}function ZPe(e){sr.request.crossOriginNoCorsDomains||(sr.request.crossOriginNoCorsDomains={});const t=sr.request.crossOriginNoCorsDomains;for(let i of e)i=i.toLowerCase(),/^https?:\/\//.test(i)?t[kp(i)]=0:(t[kp("http://"+i)]=0,t[kp("https://"+i)]=0)}function XPe(e){const t=sr.request.crossOriginNoCorsDomains;if(t){let i=kp(e);if(i)return i=i.toLowerCase(),!bP(i,tX())&&t[i]<Date.now()-36e5}return!1}async function YPe(e){var r;const t=sr.request.crossOriginNoCorsDomains;t&&(t[kp(e).toLowerCase()]=Date.now());const i=$a(e);e=i.path,((r=i.query)==null?void 0:r.f)==="json"&&(e+="?f=json");try{await fetch(e,{mode:"no-cors",credentials:"include"})}catch{}}async function jr(e,t){var c;const i=Bm(e),r=UE(e);r||i||(e=Fp(e));const s={url:e,requestOptions:{...t}};let n=rfe(e);if(n){const h=await s3e(n,s);if(h!=null)return{data:h,getHeader:cX,requestOptions:s.requestOptions,url:s.url};n.after||n.error||(n=null)}if(e=s.url,(t=s.requestOptions).responseType==="image"){if(Ce("host-webworker")||Ce("host-node"))throw Mp("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),s)}else if(i)throw Mp("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+t.responseType),s);if(t.method==="head"){if(t.body)throw Mp("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),s);if(i||r)throw Mp("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),s)}if(await t3e(),M4)return M4.execute(e,t);const o=new AbortController;Ma(t,()=>o.abort());const a={controller:o,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:n,params:s,redoRequest:!1,useIdentity:fp.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await o3e(a);return(c=n==null?void 0:n.after)==null||c.call(n,l),l}let M4;const fp=sr.request,gfe="FormData"in globalThis,QPe=[499,498,403,401],JPe=["COM_0056","COM_0057","SB_0008"],KPe=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],cX=()=>null,w7=Symbol();function e3e(e){const t=kp(e);t&&!jr._corsServers.includes(t)&&jr._corsServers.push(t)}function Eee(e){const t=kp(e);return!t||t.endsWith(".arcgis.com")||jr._corsServers.includes(t)||rX(t)}function Mp(e,t,i,r){let s="Error";const n={url:i.url,requestOptions:i.requestOptions,getHeader:cX,ssl:!1};if(t instanceof se)return t.details?(t.details=me(t.details),t.details.url=i.url,t.details.requestOptions=i.requestOptions):t.details=n,t;if(t){const o=r&&(c=>r.headers.get(c)),a=r&&r.status,l=t.message;l&&(s=l),o&&(n.getHeader=o),n.httpStatus=(t.httpCode!=null?t.httpCode:t.code)||a||0,n.subCode=t.subcode,n.messageCode=t.messageCode,typeof t.details=="string"?n.messages=[t.details]:n.messages=t.details,n.raw=w7 in t?t[w7]:t}return Cs(t)?$i():new se(e,s,n)}async function t3e(){Ce("host-webworker")?M4||(M4=await _e(()=>import("./request.949bcf26.js"),[],import.meta.url)):jr._abortableFetch||(jr._abortableFetch=globalThis.fetch.bind(globalThis))}async function x7(){cn||await _e(()=>import("./IdentityManager.de16d488.js"),[],import.meta.url)}async function i3e(e){var a;const t=e.params.url,i=e.params.requestOptions,r=e.controller.signal,s=i.body;let n=null,o=null;if(gfe&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(n=new FormData(s))),typeof s=="string"&&(o=s),e.fetchOptions={cache:i.cacheBust&&!jr._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:i.headers||{},method:i.method==="head"?"HEAD":"GET",mode:"cors",priority:fp.priority,redirect:"follow",signal:r},(n||o)&&(e.fetchOptions.body=n||o),i.authMode==="anonymous"&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||((a=i.query)==null?void 0:a.token)||(n==null?void 0:n.get("token"))),!e.hasToken&&sr.apiKey&&ffe(t)&&(i.query||(i.query={}),i.query.token=sr.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!yfe(t)&&!An(r)){let l;i.authMode==="immediate"?(await x7(),l=await cn.getCredential(t,{signal:r}),e.credential=l):i.authMode==="no-prompt"?(await x7(),l=await cn.getCredential(t,{prompt:!1,signal:r}).catch(()=>{}),e.credential=l):cn&&(l=cn.findCredential(t)),l&&(e.credentialToken=l.token,e.useSSL=!!l.ssl)}}function yfe(e){return KPe.some(t=>t.test(e))}async function r3e(e){let t=e.params.url;const i=e.params.requestOptions,r=e.fetchOptions,s=UE(t)||Bm(t),n=i.responseType||"json",o=s?0:i.timeout!=null?i.timeout:fp.timeout;let a=!1;if(!s){e.useSSL&&(t=oX(t)),i.cacheBust&&r.cache==="default"&&(t=lfe(t,"request.preventCache",Date.now()));let m={...i.query};e.credentialToken&&(m.token=e.credentialToken);let g=vP(m);Ce("esri-url-encodes-apostrophe")&&(g=g.replace(/'/g,"%27"));const v=t.length+1+g.length;let b;a=i.method==="delete"||i.method==="post"||i.method==="put"||!!i.body||v>fp.maxUrlLength;const S=i.useProxy||!!Xk(t);if(S){const T=vPe(t);b=T.path,!a&&b.length+1+v>fp.maxUrlLength&&(a=!0),T.query&&(m={...T.query,...m})}if(r.method==="HEAD"&&(a||S)){if(a)throw v>fp.maxUrlLength?Mp("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params):Mp("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params);if(S)throw Mp("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(a?(r.method=i.method==="delete"?"DELETE":i.method==="put"?"PUT":"POST",i.body?t=gV(t,m):(r.body=vP(m),r.headers["Content-Type"]="application/x-www-form-urlencoded")):t=gV(t,m),S&&(e.useProxy=!0,t=`${b}?${t}`),m.token&&gfe&&r.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)&&r.body.set("token",m.token),i.hasOwnProperty("withCredentials"))e.withCredentials=i.withCredentials;else if(!bP(t,tX())){if(rX(t))e.withCredentials=!0;else if(cn){const T=cn.findServerInfo(t);T&&T.webTierAuth&&(e.withCredentials=!0)}}e.withCredentials&&(r.credentials="include",XPe(t)&&await YPe(a?gV(t,m):t))}let l,c,h=0,p=!1;o>0&&(h=setTimeout(()=>{p=!0,e.controller.abort()},o));try{if(i.responseType==="native-request-init")c=r,c.url=t;else if(i.responseType!=="image"||r.cache!=="default"||r.method!=="GET"||a||n3e(i.headers)||!s&&!e.useProxy&&fp.proxyUrl&&!Eee(t)){if(l=await jr._abortableFetch(t,r),e.useProxy||e3e(t),i.responseType==="native")c=l;else if(r.method!=="HEAD")if(l.ok){switch(n){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(h&&(clearTimeout(h),h=0),n==="json"||n==="xml"||n==="document")if(c)switch(n){case"json":c=JSON.parse(c);break;case"xml":c=Cee(c,"application/xml");break;case"document":c=Cee(c,"text/html")}else c=null;if(c){if(n==="array-buffer"||n==="blob"){const m=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(m)&&c[n==="blob"?"size":"byteLength"]<=750)try{const g=await new Response(c).json();g.error&&(c=g)}catch{}}n==="image"&&c instanceof Blob&&(c=await Aee(URL.createObjectURL(c),e,!0))}}else c=await l.text()}else c=await Aee(t,e)}catch(m){if(m.name==="AbortError")throw p?new Error("Timeout exceeded"):$i("Request canceled");if(!(!l&&m instanceof TypeError&&fp.proxyUrl)||i.body||i.method==="delete"||i.method==="head"||i.method==="post"||i.method==="put"||e.useProxy||Eee(t))throw m;e.redoRequest=!0,bPe({proxyUrl:fp.proxyUrl,urlPrefix:kp(t)})}finally{h&&clearTimeout(h)}return[l,c]}async function s3e(e,t){if(e.responseData!=null)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let i,r;try{r=await e.before(t)}catch(s){i=Mp("request:interceptor",s,t)}if((r instanceof Error||r instanceof se)&&(i=Mp("request:interceptor",r,t)),i)throw e.error&&e.error(i),i;return r}}function n3e(e){if(e){for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0}return!1}function Cee(e,t){let i;try{i=new DOMParser().parseFromString(e,t)}catch{}if(!i||i.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return i}async function o3e(e){var n;let t,i;await i3e(e);try{do[t,i]=await r3e(e);while(!await a3e(e,t,i))}catch(o){const a=Mp("request:server",o,e.params,t);throw a.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(a),a}const r=e.params.url;if(i&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(r)){if(!e.hasToken&&!e.credentialToken&&((n=i.user)==null?void 0:n.username)&&!rX(r)){const o=kp(r,!0);o&&fp.trustedServers.push(o)}Array.isArray(i.authorizedCrossOriginNoCorsDomains)&&ZPe(i.authorizedCrossOriginNoCorsDomains)}const s=e.credential;if(s&&cn){const o=cn.findServerInfo(s.server);let a=o&&o.owningSystemUrl;if(a){a=a.replace(/\/?$/,"/sharing");const l=cn.findCredential(a,s.userId);l&&cn._getIdenticalSvcIdx(a,l)===-1&&l.resources.unshift(a)}}return{data:i,getHeader:t?o=>t.headers.get(o):cX,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}async function a3e(e,t,i){if(e.redoRequest)return e.redoRequest=!1,!1;const r=e.params.requestOptions;if(!t||r.responseType==="native"||r.responseType==="native-request-init")return!0;let s,n,o,a;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[w7]=i,s;i!=null&&i.error&&(s=i.error),s&&(n=Number(s.code),o=s.hasOwnProperty("subcode")?Number(s.subcode):null,a=s.messageCode,a=a&&a.toUpperCase());const l=r.authMode;if(n===403&&(o===4||s.message&&s.message.toLowerCase().includes("ssl")&&!s.message.toLowerCase().includes("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&(l!=="no-prompt"||n===498)&&QPe.includes(n)&&!yfe(e.params.url)&&(n!==403||!JPe.includes(a)&&(o==null||o===2&&e.credentialToken))){await x7();try{const c=await cn.getCredential(e.params.url,{error:Mp("request:server",s,e.params),prompt:l!=="no-prompt",signal:e.controller.signal,token:e.credentialToken});return e.credential=c,e.credentialToken=c.token,e.useSSL=e.useSSL||c.ssl,!1}catch(c){if(l==="no-prompt")return e.credential=null,e.credentialToken=null,!1;s=c}}if(s)throw s;return!0}function Aee(e,t,i=!1){const r=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.fetchPriority=fp.priority,s.src=e,mfe(s,e,i,r)}jr._abortableFetch=null,jr._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const l3e=Object.freeze(Object.defineProperty({__proto__:null,default:jr},Symbol.toStringTag,{value:"Module"}));var Y_;(function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"})(Y_||(Y_={}));class c3e{constructor(t){this.instance=t,this._resolver=Qv(),this._status=Y_.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Y_.RESOLVED,this._cleanUp()},()=>{this._status=Y_.REJECTED,this._cleanUp()})}addResolvingPromise(t){this._resolvingPromises.push(t),this._tryResolve()}isResolved(){return this._status===Y_.RESOLVED}isRejected(){return this._status===Y_.REJECTED}isFulfilled(){return this._status!==Y_.PENDING}abort(){this._resolver.reject($i())}when(t,i){return this._resolver.promise.then(t,i)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const t=Qv(),i=[...this._resolvingPromises,t.promise],r=this._allPromise=Promise.all(i);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve(this.instance)},s=>{this.isFulfilled()||this._allPromise!==r||Cs(s)||this._resolver.reject(s)}),t.resolve()}}const Qk=e=>{let t=class extends e{constructor(...i){super(...i),this._promiseProps=new c3e(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(i,r){return new Promise((s,n)=>{this._promiseProps.when(s,n)}).then(i,r)}catch(i){return this.when(null,i)}addResolvingPromise(i){i&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in i?i.when():i)}};return t=u([B("esri.core.Promise")],t),t};let P4=class extends Qk(ze){};P4=u([B("esri.core.Promise")],P4);const u3e="not-loaded",h3e="loading",d3e="failed",Oee="loaded",_fe=e=>{let t=class extends e{constructor(...i){super(...i),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(r=>{const s=this.load.bind(this);this.load=n=>{const o=new Promise((a,l)=>{const c=lZ(n,l);this.destroyed&&l(new se("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===u3e){this._set("loadStatus",h3e);const a=this._loadController=new AbortController;s({signal:a.signal}),Ma(a.signal,()=>{this._promiseProps.abort()})}return r(),o}})),this.when(()=>{this._set("loadStatus",Oee),this._loadController=null},r=>{this._set("loadStatus",d3e),this._set("loadError",r),this._loadController=null})}get loaded(){return this.loadStatus===Oee}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var i;return this.isFulfilled()||(this._set("loadError",new se("load:cancelled","Cancelled")),(i=this._loadController)==null||i.abort()),this}};return u([f({readOnly:!0})],t.prototype,"loaded",null),u([f({readOnly:!0})],t.prototype,"loadError",void 0),u([f({clonable:!1})],t.prototype,"loadStatus",void 0),u([f({type:[Ju],readOnly:!0})],t.prototype,"loadWarnings",null),t=u([B("esri.core.Loadable")],t),t};let pR=class extends _fe(P4){};pR=u([B("esri.core.Loadable")],pR),function(e){function t(i){return!(!i||!i.load)}e.LoadableMixin=_fe,e.isLoadable=t}(pR||(pR={}));const jy=pR;var T7;const p3e=new Hi({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Lh=T7=class extends ze{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){e!=="asc"&&e!=="desc"||this._set("sortOrder",e)}clone(){return new T7({categories:this.categories?me(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let i,r;if(this.categories&&(i=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o)),this.extent){const o=aT(this.extent,wt.WGS84);w(o)&&(r=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let s=this.query;!this.disableExtraQuery&&e.extraQuery&&(s="("+s+")"+e.extraQuery);const n={categories:i,bbox:r,q:s,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(n.sortField=this.sortField.split(",").map(o=>p3e.toJSON(o.trim())).join(","),n.sortOrder=this.sortOrder),{query:{...t,...n}}}};u([f()],Lh.prototype,"categories",void 0),u([f()],Lh.prototype,"disableExtraQuery",void 0),u([f({type:zi})],Lh.prototype,"extent",void 0),u([f()],Lh.prototype,"filter",void 0),u([f()],Lh.prototype,"num",void 0),u([f()],Lh.prototype,"query",void 0),u([f()],Lh.prototype,"sortField",void 0),u([f()],Lh.prototype,"sortOrder",null),u([f()],Lh.prototype,"start",void 0),Lh=T7=u([B("esri.portal.PortalQueryParams")],Lh);const yy=Lh;let Nb=class extends ze{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};u([f()],Nb.prototype,"nextQueryParams",void 0),u([f()],Nb.prototype,"queryParams",void 0),u([f()],Nb.prototype,"results",void 0),u([f()],Nb.prototype,"total",void 0),Nb=u([B("esri.portal.PortalQueryResult")],Nb);const f3e=Nb;let Fg=class extends Fe{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new se("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};u([f({type:Date})],Fg.prototype,"created",void 0),u([f()],Fg.prototype,"id",void 0),u([f()],Fg.prototype,"portal",void 0),u([f()],Fg.prototype,"title",void 0),u([f({readOnly:!0})],Fg.prototype,"url",null),u([f()],Fg.prototype,"username",void 0),Fg=u([B("esri.portal.PortalFolder")],Fg);const m3e=Fg;let vo=class extends Fe{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal._request(this.url+"/categorySchema",e).then(t=>{const i=t.categorySchema||[];return i.some(r=>r.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return this.portal._request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new se("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,t){let i=hn(yy,e);return parseFloat(this.portal.currentVersion)>5?(i=i||new yy,this.portal._queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",t)):(i=i?i.clone():new yy,i.query="group:"+this.id+(i.query?" "+i.query:""),this.portal.queryItems(i,t))}_fetchCategorySchemaSet(e,t){return this.portal._fetchSelf(this.portal.authMode,!0,t).then(i=>{const r=i.contentCategorySetsGroupQuery;if(r){const s=new yy;return s.disableExtraQuery=!0,s.num=1,s.query=r,this.portal.queryGroups(s,t)}throw new se("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],s=new yy;return s.num=1,s.query=`typekeywords:"${e}"`,r.queryItems(s,t)}throw new se("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(i=>i.total?i.results[0].fetchData("json",t).then(r=>{const s=r&&r.categorySchema;return s&&s.length?s:[]}):[])}};u([f()],vo.prototype,"access",void 0),u([f({type:Date})],vo.prototype,"created",void 0),u([f()],vo.prototype,"description",void 0),u([f()],vo.prototype,"id",void 0),u([f()],vo.prototype,"isInvitationOnly",void 0),u([f({type:Date})],vo.prototype,"modified",void 0),u([f()],vo.prototype,"owner",void 0),u([f()],vo.prototype,"portal",void 0),u([f()],vo.prototype,"snippet",void 0),u([f()],vo.prototype,"sortField",void 0),u([f()],vo.prototype,"sortOrder",void 0),u([f()],vo.prototype,"tags",void 0),u([f()],vo.prototype,"thumbnail",void 0),u([f({readOnly:!0})],vo.prototype,"thumbnailUrl",null),u([f()],vo.prototype,"title",void 0),u([f({readOnly:!0})],vo.prototype,"url",null),vo=u([B("esri.portal.PortalGroup")],vo);const S7=vo,g3e=Object.freeze(Object.defineProperty({__proto__:null,default:S7},Symbol.toStringTag,{value:"Module"}));var E7;let bs=E7=class extends Fe{constructor(...e){super(...e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}`:null}get url(){const e=this.get("portal.restUrl");return e?`${e}/community/users/${this.username}`:null}addItem(e){const t=e&&e.item,i=e&&e.data,r=e&&e.folder,s={method:"post"};t&&(s.query=t.createPostQuery(),i!=null&&(typeof i=="string"?s.query.text=i:typeof i=="object"&&(s.query.text=JSON.stringify(i))));let n=this.userContentUrl;return r&&(n+="/"+(typeof r=="string"?r:r.id)),this.portal._request(n+"/addItem",s).then(o=>(t.id=o.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}deleteItem(e){let t=this.userContentUrl;return e.ownerFolder&&(t+="/"+e.ownerFolder),this.portal._request(t+`/items/${e.id}/delete`,{method:"post"}).then(()=>{e.id=null,e.portal=null})}deleteItems(e){const t=this.userContentUrl+"/deleteItems",i=e.map(r=>r.id);if(i.length){const r={method:"post",query:{items:i.join(",")}};return this.portal._request(t,r).then(()=>{e.forEach(s=>{s.id=null,s.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const e={query:{num:1}};return this.portal._request(this.userContentUrl,e).then(t=>{let i;return i=t&&t.folders?t.folders.map(r=>{const s=m3e.fromJSON(r);return s.portal=this.portal,s}):[],i})}fetchGroups(){return this.portal._request(this.url).then(e=>{let t;return t=e&&e.groups?e.groups.map(i=>{const r=S7.fromJSON(i);return r.portal=this.portal,r}):[],t})}fetchItems(e){e||(e={});let t,i=this.userContentUrl;return e.folder&&(i+="/"+e.folder.id),_e(()=>Promise.resolve().then(()=>ave),void 0,import.meta.url).then(({default:r})=>{t=r;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal._request(i,{query:s})}).then(r=>{let s;return r&&r.items?(s=r.items.map(n=>{const o=t.fromJSON(n);return o.portal=this.portal,o}),Promise.all(s.map(n=>n.load())).catch(n=>n).then(()=>({items:s,nextStart:r.nextStart,total:r.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new S7({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new se("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new se("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new E7;return t.sourceJSON=e,t.read(e),t}};u([f()],bs.prototype,"access",void 0),u([f({type:Date})],bs.prototype,"created",void 0),u([f()],bs.prototype,"culture",void 0),u([f()],bs.prototype,"description",void 0),u([f()],bs.prototype,"email",void 0),u([f()],bs.prototype,"favGroupId",void 0),u([f()],bs.prototype,"fullName",void 0),u([f({type:Date})],bs.prototype,"modified",void 0),u([f()],bs.prototype,"orgId",void 0),u([f()],bs.prototype,"portal",void 0),u([f()],bs.prototype,"preferredView",void 0),u([f()],bs.prototype,"privileges",void 0),u([f()],bs.prototype,"region",void 0),u([f()],bs.prototype,"role",void 0),u([f()],bs.prototype,"roleId",void 0),u([f()],bs.prototype,"sourceJSON",void 0),u([f()],bs.prototype,"thumbnail",void 0),u([f({readOnly:!0})],bs.prototype,"thumbnailUrl",null),u([f()],bs.prototype,"units",void 0),u([f({readOnly:!0})],bs.prototype,"userContentUrl",null),u([f({readOnly:!0})],bs.prototype,"url",null),u([f()],bs.prototype,"username",void 0),u([f()],bs.prototype,"userType",void 0),bs=E7=u([B("esri.portal.PortalUser")],bs);const uX=bs,y3e=Object.freeze(Object.defineProperty({__proto__:null,default:uX},Symbol.toStringTag,{value:"Module"}));var hu;let yV;const Ree={PortalGroup:()=>_e(()=>Promise.resolve().then(()=>g3e),void 0,import.meta.url),PortalItem:()=>_e(()=>Promise.resolve().then(()=>ave),void 0,import.meta.url),PortalUser:()=>_e(()=>Promise.resolve().then(()=>y3e),void 0,import.meta.url)};let rt=hu=class extends B3(jy){constructor(e){super(e),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=sr.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return typeof e=="string"?{url:e}:e}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)sr.request.trustedServers.includes(t)||sr.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!e?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.substring(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e&&e.toLowerCase()}readUser(e){let t=null;return e&&(t=uX.fromJSON(e),t.portal=this),t}load(e){const t=_e(()=>Promise.resolve().then(()=>c7e),void 0,import.meta.url).then(({default:i})=>{Ui(e),yV=i}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,e)).then(i=>{if(cn){const r=cn;this.credential=r.findCredential(this.restUrl),this.credential||this.authMode!==hu.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=r.on("credential-create",()=>{r.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}async createElevationLayers(){await this.load();const e=this._getHelperService("defaultElevationLayers"),t=(await _e(()=>import("./ElevationLayer.fd50f4c9.js"),["ElevationLayer.fd50f4c9.js","ArcGISCachedService.110871f6.js","TilemapCache.4ff90c07.js"],import.meta.url)).default;return e?e.map(i=>new t({id:i.id,url:i.url})):[]}fetchBasemaps(e,t){const i=new yy;return i.query=e||(sr.apiKey&&ffe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),i.disableExtraQuery=!0,this.queryGroups(i,t).then(r=>{if(i.num=100,i.query='type:"Web Map" -type:"Web Application"',r.total){const s=r.results[0];return i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc",s.queryItems(i,t)}return null}).then(r=>{let s;return s=r&&r.total?r.results.filter(n=>n.type==="Web Map").map(n=>new yV({portalItem:n})):[],s})}fetchCategorySchema(e){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",e).then(t=>t.categorySchema):An(e)?Promise.reject($i()):Promise.resolve([])}fetchFeaturedGroups(e){const t=this.featuredGroups,i=new yy;if(i.num=100,i.sortField="title",t&&t.length){const r=[];for(const s of t)r.push(`(title:"${s.title}" AND owner:${s.owner})`);return i.query=r.join(" OR "),this.queryGroups(i,e).then(s=>s.results)}return An(e)?Promise.reject($i()):Promise.resolve([])}fetchRegions(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Hu();return this._request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){var i;const t=((i=this.user)==null?void 0:i.culture)||this.culture||Hu();return this._request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return hu._default&&!hu._default.destroyed||(hu._default=new hu),hu._default}queryGroups(e,t){return this._queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this._queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this._queryPortal("/community/users",e,"PortalUser",t)}toJSON(){throw new se("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new hu({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new se("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}_getHelperServiceUrl(e){const t=this._getHelperService(e);if(!t.url)throw new se("portal:service-url-not-found",`The \`helperServices\` entry "${e}" does not include a \`url\` value`);return t.url}_fetchSelf(e=this.authMode,t=!1,i){const r=this.restUrl+"/portals/self",s={authMode:e,query:{culture:Hu().toLowerCase()},...i};return s.authMode==="auto"&&(s.authMode="no-prompt"),t&&(s.query.default=!0),this._request(r,s)}_queryPortal(e,t,i,r){const s=hn(yy,t),n=o=>this._request(this.restUrl+e,{...s.toRequestOptions(this),...r}).then(a=>{const l=s.clone();return l.start=a.nextStart,new f3e({nextQueryParams:l,queryParams:s,total:a.total,results:hu._resultsToTypedArray(o,{portal:this},a,r)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(e0(l),a)));return i&&Ree[i]?Ree[i]().then(({default:o})=>(Ui(r),n(o))):n()}_signIn(){if(this.authMode===hu.AUTH_MODE_ANONYMOUS)return Promise.reject(new se("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const e=t=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(t||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=t,this._fetchSelf("immediate"))):this.user&&this.credential===t?null:(this.credential=t,this._fetchSelf("immediate"))).then(i=>{i&&(this.sourceJSON=i,this.read(i))});return cn?cn.getCredential(this.restUrl).then(t=>e(t)):e(this.credential)}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(e){const t=this.credential&&this.credential.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}_requestToTypedArray(e,t,i){return this._request(e,t).then(r=>{const s=hu._resultsToTypedArray(i,{portal:this},r);return Promise.all(s.map(n=>typeof n.when=="function"?n.when():r)).then(()=>s,()=>s)})}_readBasemap(e){if(e){const t=yV.fromJSON(e);return t.portalItem={portal:this},t}return null}_request(e,t={}){const i={f:"json",...t.query},{authMode:r=this.authMode===hu.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:s=null,cacheBust:n=!1,method:o="auto",responseType:a="json",signal:l}=t,c={authMode:r,body:s,cacheBust:n,method:o,query:i,responseType:a,timeout:0,signal:l};return jr(this._normalizeSSL(e),c).then(h=>h.data)}static _resultsToTypedArray(e,t,i,r){let s;if(i){const n=w(r)?r.signal:null;s=i.listings||i.notifications||i.userInvitations||i.tags||i.items||i.groups||i.comments||i.provisions||i.results||i.relatedItems||i,(e||t)&&(s=s.map(o=>{const a=Object.assign(e?e.fromJSON(o):o,t);return typeof a.load=="function"&&a.load(n),a}))}else s=[];return s}};rt.AUTH_MODE_ANONYMOUS="anonymous",rt.AUTH_MODE_AUTO="auto",rt.AUTH_MODE_IMMEDIATE="immediate",u([f()],rt.prototype,"access",void 0),u([f()],rt.prototype,"allSSL",void 0),u([f()],rt.prototype,"authMode",void 0),u([f()],rt.prototype,"authorizedCrossOriginDomains",void 0),u([it("authorizedCrossOriginDomains")],rt.prototype,"readAuthorizedCrossOriginDomains",null),u([f()],rt.prototype,"basemapGalleryGroupQuery",void 0),u([f()],rt.prototype,"bingKey",void 0),u([f()],rt.prototype,"canListApps",void 0),u([f()],rt.prototype,"canListData",void 0),u([f()],rt.prototype,"canListPreProvisionedItems",void 0),u([f()],rt.prototype,"canProvisionDirectPurchase",void 0),u([f()],rt.prototype,"canSearchPublic",void 0),u([f()],rt.prototype,"canShareBingPublic",void 0),u([f()],rt.prototype,"canSharePublic",void 0),u([f()],rt.prototype,"canSignInArcGIS",void 0),u([f()],rt.prototype,"canSignInIDP",void 0),u([f()],rt.prototype,"colorSetsGroupQuery",void 0),u([f()],rt.prototype,"commentsEnabled",void 0),u([f({type:Date})],rt.prototype,"created",void 0),u([f()],rt.prototype,"credential",void 0),u([f()],rt.prototype,"culture",void 0),u([f()],rt.prototype,"currentVersion",void 0),u([f()],rt.prototype,"customBaseUrl",void 0),u([f()],rt.prototype,"defaultBasemap",void 0),u([it("defaultBasemap")],rt.prototype,"readDefaultBasemap",null),u([f()],rt.prototype,"defaultDevBasemap",void 0),u([it("defaultDevBasemap")],rt.prototype,"readDefaultDevBasemap",null),u([f({type:zi})],rt.prototype,"defaultExtent",void 0),u([f()],rt.prototype,"defaultVectorBasemap",void 0),u([it("defaultVectorBasemap")],rt.prototype,"readDefaultVectorBasemap",null),u([f()],rt.prototype,"description",void 0),u([f()],rt.prototype,"devBasemapGalleryGroupQuery",void 0),u([f()],rt.prototype,"eueiEnabled",void 0),u([f({readOnly:!0})],rt.prototype,"extraQuery",null),u([f()],rt.prototype,"featuredGroups",void 0),u([f()],rt.prototype,"featuredItemsGroupQuery",void 0),u([f()],rt.prototype,"galleryTemplatesGroupQuery",void 0),u([f()],rt.prototype,"livingAtlasGroupQuery",void 0),u([f()],rt.prototype,"hasCategorySchema",void 0),u([f()],rt.prototype,"helpBase",void 0),u([f()],rt.prototype,"helperServices",void 0),u([f()],rt.prototype,"helpMap",void 0),u([f()],rt.prototype,"homePageFeaturedContent",void 0),u([f()],rt.prototype,"homePageFeaturedContentCount",void 0),u([f()],rt.prototype,"httpPort",void 0),u([f()],rt.prototype,"httpsPort",void 0),u([f()],rt.prototype,"id",void 0),u([f()],rt.prototype,"ipCntryCode",void 0),u([f({readOnly:!0})],rt.prototype,"isOrganization",null),u([f()],rt.prototype,"isPortal",void 0),u([f()],rt.prototype,"isReadOnly",void 0),u([f()],rt.prototype,"layerTemplatesGroupQuery",void 0),u([f()],rt.prototype,"maxTokenExpirationMinutes",void 0),u([f({type:Date})],rt.prototype,"modified",void 0),u([f()],rt.prototype,"name",void 0),u([f()],rt.prototype,"portalHostname",void 0),u([f()],rt.prototype,"portalMode",void 0),u([f()],rt.prototype,"portalProperties",void 0),u([f()],rt.prototype,"region",void 0),u([f({readOnly:!0})],rt.prototype,"restUrl",null),u([f()],rt.prototype,"rotatorPanels",void 0),u([f()],rt.prototype,"showHomePageDescription",void 0),u([f()],rt.prototype,"sourceJSON",void 0),u([f()],rt.prototype,"staticImagesUrl",void 0),u([f({json:{name:"2DStylesGroupQuery"}})],rt.prototype,"stylesGroupQuery2d",void 0),u([f({json:{name:"stylesGroupQuery"}})],rt.prototype,"stylesGroupQuery3d",void 0),u([f()],rt.prototype,"supportsHostedServices",void 0),u([f()],rt.prototype,"symbolSetsGroupQuery",void 0),u([f()],rt.prototype,"templatesGroupQuery",void 0),u([f()],rt.prototype,"thumbnail",void 0),u([f({readOnly:!0})],rt.prototype,"thumbnailUrl",null),u([f()],rt.prototype,"units",void 0),u([f()],rt.prototype,"url",void 0),u([f()],rt.prototype,"urlKey",void 0),u([it("urlKey")],rt.prototype,"readUrlKey",null),u([f()],rt.prototype,"user",void 0),u([it("user")],rt.prototype,"readUser",null),u([f()],rt.prototype,"useStandardizedQuery",void 0),u([f()],rt.prototype,"useVectorBasemaps",void 0),u([f()],rt.prototype,"vectorBasemapGalleryGroupQuery",void 0),rt=hu=u([B("esri.portal.Portal")],rt);const Ql=rt;let Fb=class extends Hc(Fe){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return w(e)&&e.placement===this.placement&&e.style===this.style&&(N(this.color)&&N(e.color)||w(this.color)&&w(e.color)&&this.color.toJSON()===e.color.toJSON())}};u([f({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Fb.prototype,"type",void 0),u([f({type:DMe,json:{default:"begin-end",write:!0}})],Fb.prototype,"placement",void 0),u([f({type:$pe,json:{default:"arrow",write:!0}})],Fb.prototype,"style",void 0),u([f({type:at,json:{type:[cs],default:null,write:!0}})],Fb.prototype,"color",void 0),Fb=u([B("esri.symbols.LineStyleMarker3D")],Fb);const C7=Fb;var CN;let $f=CN=class extends zm{constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=eh(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:w(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:w(this.pattern)?this.pattern.clone():null,marker:w(this.marker)?this.marker.clone():null};return new CN(e)}static fromSimpleLineSymbol(e){var i,r,s;const t={enabled:!0,size:(i=e.width)!=null?i:eh(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style&&e.style!=="inside-frame"?new WZ({style:e.style}):null,material:new qu({color:(e.color||yM).clone()}),marker:e.marker?new C7({placement:e.marker.placement,style:e.marker.style,color:(s=(r=e.marker.color)==null?void 0:r.clone())!=null?s:null}):null};return new CN(t)}};u([f({type:qu,json:{write:!0}})],$f.prototype,"material",void 0),u([Rt({Line:"line"},{readOnly:!0})],$f.prototype,"type",void 0),u([f({type:Zpe,json:{write:!0,default:"miter"}})],$f.prototype,"join",void 0),u([f({type:KZ,json:{write:!0,default:"butt"}})],$f.prototype,"cap",void 0),u([f(Om)],$f.prototype,"size",void 0),u([f(Upe)],$f.prototype,"pattern",void 0),u([f({types:{key:"type",base:C7,typeMap:{style:C7}},json:{write:!0}})],$f.prototype,"marker",void 0),$f=CN=u([B("esri.symbols.LineSymbol3DLayer")],$f);const q3=$f;var A7;const _3e=La()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let fR=A7=class extends Fe{clone(){return new A7({href:this.href,primitive:this.primitive})}};u([f({type:String,json:{read:lX,write:e1}})],fR.prototype,"href",void 0),u([Rt(_3e)],fR.prototype,"primitive",void 0),fR=A7=u([B("esri.symbols.support.ObjectSymbol3DLayerResource")],fR);const vfe="sphere";var O7;let xw=O7=class extends ze{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new O7({x:this.x,y:this.y,z:this.z})}};u([f({type:Number})],xw.prototype,"x",void 0),u([f({type:Number})],xw.prototype,"y",void 0),u([f({type:Number})],xw.prototype,"z",void 0),xw=O7=u([B("esri.symbols.support.Symbol3DAnchorPosition3D")],xw);var R7;let Ua=R7=class extends zm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new R7({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:w(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};u([f({type:qu,json:{write:!0}})],Ua.prototype,"material",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Ua.prototype,"castShadows",void 0),u([f({type:fR,json:{write:!0}})],Ua.prototype,"resource",void 0),u([Rt({Object:"object"},{readOnly:!0})],Ua.prototype,"type",void 0),u([f({type:Number,json:{write:!0}})],Ua.prototype,"width",void 0),u([f({type:Number,json:{write:!0}})],Ua.prototype,"height",void 0),u([f({type:Number,json:{write:!0}})],Ua.prototype,"depth",void 0),u([Rt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),f({json:{default:"origin"}})],Ua.prototype,"anchor",void 0),u([f({type:xw,json:{type:[Number],read:{reader:e=>new xw({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Ua.prototype,"anchorPosition",void 0),u([f({type:Number,json:{write:!0}})],Ua.prototype,"heading",void 0),u([f({type:Number,json:{write:!0}})],Ua.prototype,"tilt",void 0),u([f({type:Number,json:{write:!0}})],Ua.prototype,"roll",void 0),u([f({readOnly:!0})],Ua.prototype,"isPrimitive",null),Ua=R7=u([B("esri.symbols.ObjectSymbol3DLayer")],Ua);const hX=Ua;var M7;let El=M7=class extends zm{constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return e!=null?e:t.height==null&&t.size!=null?t.size:void 0}readHeight(e,t){return e!=null?e:t.width==null&&t.size!=null?t.size:void 0}clone(){return new M7({enabled:this.enabled,material:w(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};u([f({type:qu,json:{write:!0}})],El.prototype,"material",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],El.prototype,"castShadows",void 0),u([Rt({Path:"path"},{readOnly:!0})],El.prototype,"type",void 0),u([f({type:["circle","quad"],json:{write:!0,default:"circle"}})],El.prototype,"profile",void 0),u([f({type:Zpe,json:{write:!0,default:"miter"}})],El.prototype,"join",void 0),u([f({type:rPe,json:{write:!0,default:"butt"}})],El.prototype,"cap",void 0),u([f({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],El.prototype,"width",void 0),u([it("width",["width","size","height"])],El.prototype,"readWidth",null),u([f({type:Number,json:{write:!0}})],El.prototype,"height",void 0),u([it("height",["height","size","width"])],El.prototype,"readHeight",null),u([f({type:["center","bottom","top"],json:{write:!0,default:"center"}})],El.prototype,"anchor",void 0),u([f({type:["heading","all"],json:{write:!0,default:"all"}})],El.prototype,"profileRotation",void 0),El=M7=u([B("esri.symbols.PathSymbol3DLayer")],El);const dX=El;var P7;let $2=P7=class extends Fe{constructor(){super(...arguments),this.color=new at([0,0,0,1]),this.size=0}clone(){const e={color:me(this.color),size:this.size};return new P7(e)}};u([f(i0)],$2.prototype,"color",void 0),u([f(Om)],$2.prototype,"size",void 0),$2=P7=u([B("esri.symbols.support.Symbol3DHalo")],$2);let vM=class extends Hc(Fe){constructor(e){super(e),this.color=null}};u([f(i0)],vM.prototype,"color",void 0),vM=u([B("esri.symbols.support.Symbol3DTextBackground")],vM);var AN;let hc=AN=class extends zm{constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){w(e)&&w(this._userSize)&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,i,r){const s={...r,textSymbol3D:!0};t.font=e.write({},s),delete t.font.size}get size(){return w(this._userSize)?this._userSize:w(this.font)&&this.font.size!=null?this.font.size:9}set size(e){this._userSize=e,w(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new AN({enabled:this.enabled,font:this.font&&me(this.font),halo:this.halo&&me(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:w(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:me(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new AN({font:w(e.font)?e.font.clone():new Zk,halo:v3e(e.haloColor,e.haloSize),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new qu({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new vM({color:e.backgroundColor.clone()}):null})}};function v3e(e,t){return e&&t>0?new $2({color:me(e),size:t}):null}u([f({type:Zk,json:{write:!0}})],hc.prototype,"font",null),u([ut("font")],hc.prototype,"writeFont",null),u([f({type:$2,json:{write:!0}})],hc.prototype,"halo",void 0),u([f({...Ype,json:{default:"center",write:!0}})],hc.prototype,"horizontalAlignment",void 0),u([f({...Xpe,json:{default:1,write:!0}})],hc.prototype,"lineHeight",void 0),u([f({type:qu,json:{write:!0}})],hc.prototype,"material",void 0),u([f({type:vM,json:{write:!0}})],hc.prototype,"background",void 0),u([f(Om)],hc.prototype,"size",null),u([f({type:String,json:{write:!0}})],hc.prototype,"text",void 0),u([Rt({Text:"text"},{readOnly:!0})],hc.prototype,"type",void 0),u([f({...Qpe,json:{default:"baseline",write:!0}})],hc.prototype,"verticalAlignment",void 0),hc=AN=u([B("esri.symbols.TextSymbol3DLayer")],hc);const pT=hc;var I7;let x_=I7=class extends zm{constructor(e){super(e),this.color=L7.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new I7({color:me(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};u([f({type:at,nonNullable:!0,json:{type:[cs],write:(e,t,i)=>t[i]=e.toArray(at.AlphaMode.UNLESS_OPAQUE),default:()=>L7.clone(),defaultEquals:e=>e.toCss(!0)===L7.toCss(!0)}})],x_.prototype,"color",void 0),u([Rt({Water:"water"},{readOnly:!0})],x_.prototype,"type",void 0),u([f({type:["small","medium","large"],json:{write:!0,default:"medium"}})],x_.prototype,"waterbodySize",void 0),u([f({type:Number,json:{write:!0,default:null}})],x_.prototype,"waveDirection",void 0),u([f({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],x_.prototype,"waveStrength",void 0),x_=I7=u([B("esri.symbols.WaterSymbol3DLayer")],x_);const L7=new at([0,119,190]),bfe=x_;var $7;let kb=$7=class extends ze{constructor(){super(...arguments),this.portal=null}clone(){return new $7({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};u([f({type:String})],kb.prototype,"name",void 0),u([f({type:String})],kb.prototype,"styleUrl",void 0),u([f({type:String})],kb.prototype,"styleName",void 0),u([f({type:Ql})],kb.prototype,"portal",void 0),kb=$7=u([B("esri.symbols.support.StyleOrigin")],kb);const D7=kb;var N7;let bM=N7=class extends ze{clone(){return new N7({url:this.url})}};u([f({type:String})],bM.prototype,"url",void 0),bM=N7=u([B("esri.symbols.support.Thumbnail")],bM);const wfe={icon:bv,object:hX,line:q3,path:dX,fill:Wk,extrude:Lpe,text:pT,water:bfe},b3e=zt.ofType({base:zm,key:"type",typeMap:wfe,errorContext:"symbol-layer"}),w3e=Ie.getLogger("esri.symbols.Symbol3D");let Df=class extends Wc{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=t&&t.type||zt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.initialized&&w3e.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){Ix(e,this._get("symbolLayers"))}readStyleOrigin(e,t,i){if(e.styleUrl&&e.name){const r=BC(e.styleUrl,i);return new D7({styleUrl:r,name:e.name})}if(e.styleName&&e.name)return new D7({portal:i&&i.portal||Ql.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new Ju("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,t,i,r){if(e.styleUrl&&e.name){let s=Px(e.styleUrl,r);Wu(s)&&(s=Fp(s)),t.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&r&&r.portal&&!ife(e.portal.restUrl,r.portal.restUrl)?r&&r.messages&&r.messages.push(new Ju("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof zm||e&&wfe[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};u([f({json:{read:!1,write:!1}})],Df.prototype,"color",null),u([f({type:b3e,nonNullable:!0,json:{write:!0}}),pi(ufe)],Df.prototype,"symbolLayers",null),u([f({type:D7})],Df.prototype,"styleOrigin",void 0),u([it("styleOrigin")],Df.prototype,"readStyleOrigin",null),u([ut("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Df.prototype,"writeStyleOrigin",null),u([f({type:bM,json:{read:!1}})],Df.prototype,"thumbnail",void 0),u([f({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Df.prototype,"type",void 0),Df=u([B("esri.symbols.Symbol3D")],Df);const VC=Df;let mR=class extends Fe{constructor(e){super(e),this.visible=!0}clone(){}};u([f({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],mR.prototype,"type",void 0),u([f({readOnly:!0})],mR.prototype,"visible",void 0),mR=u([B("esri.symbols.callouts.Callout3D")],mR);const xfe=mR;var F7;let ON=F7=class extends Fe{constructor(){super(...arguments),this.color=new at("white")}clone(){return new F7({color:me(this.color)})}};u([f(i0)],ON.prototype,"color",void 0),ON=F7=u([B("esri.symbols.callouts.LineCallout3DBorder")],ON);const Tfe=ON;Object.freeze(Object.defineProperty({__proto__:null,default:Tfe},Symbol.toStringTag,{value:"Module"}));var k7;let T_=k7=class extends xfe{constructor(e){super(e),this.type="line",this.color=new at([0,0,0,1]),this.size=eh(1),this.border=null}get visible(){return this.size>0&&w(this.color)&&this.color.a>0}clone(){return new k7({color:me(this.color),size:this.size,border:me(this.border)})}};u([Rt({line:"line"},{readOnly:!0})],T_.prototype,"type",void 0),u([f(i0)],T_.prototype,"color",void 0),u([f(Om)],T_.prototype,"size",void 0),u([f({type:Tfe,json:{write:!0}})],T_.prototype,"border",void 0),u([f({readOnly:!0})],T_.prototype,"visible",null),T_=k7=u([B("esri.symbols.callouts.LineCallout3D")],T_);const x3e=T_;function pX(e){if(!e)return!1;const t=e.verticalOffset;return!!t&&!(t.screenLength<=0||t.maxWorldLength<=0)}function Sfe(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t&&!!t.visible&&!!pX(e)}function fX(e){return e.type==="point-3d"||e.type==="label-3d"}function Efe(e){return e.horizontalAlignment==="center"}const Cfe={types:{key:"type",base:xfe,typeMap:{line:x3e}},json:{write:!0}};var U7;let Tw=U7=class extends Fe{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new U7({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};u([f(Om)],Tw.prototype,"screenLength",void 0),u([f({type:Number,json:{write:!0,default:0}})],Tw.prototype,"minWorldLength",void 0),u([f({type:Number,json:{write:!0}})],Tw.prototype,"maxWorldLength",void 0),Tw=U7=u([B("esri.symbols.support.Symbol3DVerticalOffset")],Tw);var RN;const Afe=zt.ofType({base:null,key:"type",typeMap:{text:pT}});let S_=RN=class extends VC{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new Afe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return Sfe(this)}hasVisibleVerticalOffset(){return pX(this)}clone(){return new RN({styleOrigin:me(this.styleOrigin),symbolLayers:me(this.symbolLayers),thumbnail:me(this.thumbnail),callout:me(this.callout),verticalOffset:me(this.verticalOffset)})}static fromTextSymbol(e){return new RN({symbolLayers:[pT.fromTextSymbol(e)]})}};u([f({type:Tw,json:{write:!0}})],S_.prototype,"verticalOffset",void 0),u([f(Cfe)],S_.prototype,"callout",void 0),u([f({json:{read:!1,write:!1}})],S_.prototype,"styleOrigin",void 0),u([f({type:Afe})],S_.prototype,"symbolLayers",void 0),u([Rt({LabelSymbol3D:"label-3d"},{readOnly:!0})],S_.prototype,"type",void 0),S_=RN=u([B("esri.symbols.LabelSymbol3D")],S_);const Jk=S_;var MN;const Ofe=zt.ofType({base:null,key:"type",typeMap:{line:q3,path:dX}}),T3e=zt.ofType({base:null,key:"type",typeMap:{line:q3,path:dX}});let gR=MN=class extends VC{constructor(e){super(e),this.symbolLayers=new Ofe,this.type="line-3d"}clone(){return new MN({styleOrigin:me(this.styleOrigin),symbolLayers:me(this.symbolLayers),thumbnail:me(this.thumbnail)})}static fromSimpleLineSymbol(e){return new MN({symbolLayers:[q3.fromSimpleLineSymbol(e)]})}};u([f({type:Ofe,json:{type:T3e}})],gR.prototype,"symbolLayers",void 0),u([Rt({LineSymbol3D:"line-3d"},{readOnly:!0})],gR.prototype,"type",void 0),gR=MN=u([B("esri.symbols.LineSymbol3D")],gR);const Kk=gR;let E_=class extends Wc{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};u([f({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],E_.prototype,"angle",void 0),u([f({type:["simple-marker","picture-marker"],readOnly:!0})],E_.prototype,"type",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],E_.prototype,"xoffset",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],E_.prototype,"yoffset",void 0),u([f({type:Number,cast:e=>e==="auto"?e:xr(e),json:{write:!0}})],E_.prototype,"size",void 0),E_=u([B("esri.symbols.MarkerSymbol")],E_);const Rfe=E_;var z7;const Mfe=zt.ofType({base:null,key:"type",typeMap:{fill:Wk}});let yR=z7=class extends VC{constructor(e){super(e),this.symbolLayers=new Mfe,this.type="mesh-3d"}clone(){return new z7({styleOrigin:me(this.styleOrigin),symbolLayers:me(this.symbolLayers),thumbnail:me(this.thumbnail)})}};u([f({type:Mfe})],yR.prototype,"symbolLayers",void 0),u([Rt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],yR.prototype,"type",void 0),yR=z7=u([B("esri.symbols.MeshSymbol3D")],yR);const mX=yR;function S3e(e,t,i){return t.imageData?nfe({mediaType:t.contentType||"image/png",isBase64:!0,data:t.imageData}):Pfe(t.url,i)}function Pfe(e,t){return C3e(t)&&!Wu(e)&&t.layer.parsedUrl?Mx(t.layer.parsedUrl.path,"images",e):BC(e,t)}function E3e(e,t,i,r){if(Bm(e)){const s=Yk(e);t.contentType=s.mediaType,t.imageData=s.data,i&&i.imageData===t.imageData&&i.url&&e1(i.url,t,"url",r)}else e1(e,t,"url",r)}const Ife={json:{read:{source:["imageData","url"],reader:S3e},write:{writer(e,t,i,r){E3e(e,t,this.source,r)}}}},Lfe={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,i){const r={};return t.imageData&&(r.imageData=t.imageData),t.contentType&&(r.contentType=t.contentType),t.url&&(r.url=Pfe(t.url,i)),r}}}};function C3e(e){return e&&(e.origin==="service"||e.origin==="portal-item")&&e.layer&&(e.layer.type==="feature"||e.layer.type==="stream")}var B7;let $h=B7=class extends Dpe{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string"&&e.imageData==null)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),i!=null&&(s.width=xr(i)),r!=null&&(s.height=xr(r)),s}clone(){const e=new B7({color:me(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",me(this.source)),e}hash(){var e;return`${super.hash()}.${(e=this.color)==null?void 0:e.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};u([Rt({esriPFS:"picture-fill"},{readOnly:!0})],$h.prototype,"type",void 0),u([f(Ife)],$h.prototype,"url",void 0),u([f({type:Number,json:{write:!0}})],$h.prototype,"xscale",void 0),u([f({type:Number,json:{write:!0}})],$h.prototype,"yscale",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],$h.prototype,"width",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],$h.prototype,"height",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],$h.prototype,"xoffset",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],$h.prototype,"yoffset",void 0),u([f(Lfe)],$h.prototype,"source",void 0),$h=B7=u([B("esri.symbols.PictureFillSymbol")],$h);const $fe=$h;var V7;let Zd=V7=class extends Rfe{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string"&&e.imageData==null)return e;const r={};return e&&(r.url=e),t!=null&&(r.width=xr(t)),i!=null&&(r.height=xr(i)),r}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new V7({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",me(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};u([f({json:{write:!1}})],Zd.prototype,"color",void 0),u([Rt({esriPMS:"picture-marker"},{readOnly:!0})],Zd.prototype,"type",void 0),u([f(Ife)],Zd.prototype,"url",void 0),u([f(Lfe)],Zd.prototype,"source",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],Zd.prototype,"height",void 0),u([it("height",["height","size"])],Zd.prototype,"readHeight",null),u([f({type:Number,cast:xr,json:{write:!0}})],Zd.prototype,"width",void 0),u([f({json:{write:!1}})],Zd.prototype,"size",void 0),Zd=V7=u([B("esri.symbols.PictureMarkerSymbol")],Zd);const eU=Zd;var C_;const Dfe=zt.ofType({base:null,key:"type",typeMap:{icon:bv,object:hX,text:pT}});let Ub=C_=class extends VC{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new Dfe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return Sfe(this)}hasVisibleVerticalOffset(){return pX(this)}clone(){return new C_({verticalOffset:me(this.verticalOffset),callout:me(this.callout),styleOrigin:me(this.styleOrigin),symbolLayers:me(this.symbolLayers),thumbnail:me(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new C_({symbolLayers:[bv.fromSimpleMarkerSymbol(e)]})}static fromPictureMarkerSymbol(e){return new C_({symbolLayers:[bv.fromPictureMarkerSymbol(e)]})}static fromCIMSymbol(e){var i,r;return((r=(i=e.data)==null?void 0:i.symbol)==null?void 0:r.type)!=="CIMPointSymbol"?null:e.data.symbol.callout?new C_({symbolLayers:[bv.fromCIMSymbol(e)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}):new C_({symbolLayers:[bv.fromCIMSymbol(e)]})}static fromTextSymbol(e){return new C_({symbolLayers:[pT.fromTextSymbol(e)]})}};u([f({type:Tw,json:{write:!0}})],Ub.prototype,"verticalOffset",void 0),u([f(Cfe)],Ub.prototype,"callout",void 0),u([f({type:Dfe,json:{origins:{"web-scene":{write:!0}}}})],Ub.prototype,"symbolLayers",void 0),u([Rt({PointSymbol3D:"point-3d"},{readOnly:!0})],Ub.prototype,"type",void 0),Ub=C_=u([B("esri.symbols.PointSymbol3D")],Ub);const wv=Ub;var _R;const Nfe=zt.ofType({base:null,key:"type",typeMap:{extrude:Lpe,fill:Wk,icon:bv,line:q3,object:hX,text:pT,water:bfe}});let vR=_R=class extends VC{constructor(e){super(e),this.symbolLayers=new Nfe,this.type="polygon-3d"}clone(){return new _R({styleOrigin:me(this.styleOrigin),symbolLayers:me(this.symbolLayers),thumbnail:me(this.thumbnail)})}static fromJSON(e){const t=new _R;if(t.read(e),t.symbolLayers.length===2&&t.symbolLayers.getItemAt(0).type==="fill"&&t.symbolLayers.getItemAt(1).type==="line"){const i=t.symbolLayers.getItemAt(0),r=t.symbolLayers.getItemAt(1);!r.enabled||e.symbolLayers&&e.symbolLayers[1]&&e.symbolLayers[1].enable===!1||(i.outline={size:r.size,color:w(r.material)?r.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new _R({symbolLayers:[Wk.fromSimpleFillSymbol(e)]})}};u([f({type:Nfe,json:{write:!0}})],vR.prototype,"symbolLayers",void 0),u([Rt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],vR.prototype,"type",void 0),vR=_R=u([B("esri.symbols.PolygonSymbol3D")],vR);const W3=vR;var G7;const _V=new Hi({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let zb=G7=class extends Dpe{constructor(...e){super(...e),this.color=new at([0,0,0,.25]),this.outline=new Sd,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.style=e),t&&(r.outline=t),i&&(r.color=i),r}clone(){return new G7({color:me(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};u([f()],zb.prototype,"color",void 0),u([f()],zb.prototype,"outline",void 0),u([Rt({esriSFS:"simple-fill"},{readOnly:!0})],zb.prototype,"type",void 0),u([f({type:_V.apiValues,json:{read:_V.read,write:_V.write}})],zb.prototype,"style",void 0),zb=G7=u([B("esri.symbols.SimpleFillSymbol")],zb);const b1=zb;var j7;const vV=new Hi({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let Nf=j7=class extends Rfe{constructor(...e){super(...e),this.color=new at([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Sd}normalizeCtorArgs(e,t,i,r){if(e&&typeof e!="string")return e;const s={};return e&&(s.style=e),t!=null&&(s.size=xr(t)),i&&(s.outline=i),r&&(s.color=r),s}writeColor(e,t){e&&this.style!=="x"&&this.style!=="cross"&&(t.color=e.toJSON()),e===null&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new j7({angle:this.angle,color:me(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var e;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(e=this.outline)==null?void 0:e.hash()}`}};u([f()],Nf.prototype,"color",void 0),u([ut("color")],Nf.prototype,"writeColor",null),u([Rt({esriSMS:"simple-marker"},{readOnly:!0})],Nf.prototype,"type",void 0),u([f()],Nf.prototype,"size",void 0),u([f({type:vV.apiValues,json:{read:vV.read,write:vV.write}})],Nf.prototype,"style",void 0),u([f({type:String,json:{write:!0}})],Nf.prototype,"path",null),u([f({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Sd}},json:{default:null,write:!0}})],Nf.prototype,"outline",void 0),Nf=j7=u([B("esri.symbols.SimpleMarkerSymbol")],Nf);const w1=Nf;var H7;let Rs=H7=class extends Wc{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new Zk,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,i){if(e&&typeof e!="string")return e;const r={};return e&&(r.text=e),t&&(r.font=t),i&&(r.color=i),r}writeLineWidth(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}castLineWidth(e){return xr(e)}writeLineHeight(e,t,i,r){r&&typeof r!="string"?r.origin:t[i]=e}clone(){return new H7({angle:this.angle,backgroundColor:me(this.backgroundColor),borderLineColor:me(this.borderLineColor),borderLineSize:this.borderLineSize,color:me(this.color),font:this.font&&this.font.clone(),haloColor:me(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};u([f({type:at,json:{write:!0}})],Rs.prototype,"backgroundColor",void 0),u([f({type:at,json:{write:!0}})],Rs.prototype,"borderLineColor",void 0),u([f({type:Number,json:{write:!0}})],Rs.prototype,"borderLineSize",void 0),u([f({type:Zk,json:{write:!0}})],Rs.prototype,"font",void 0),u([f({...Ype,json:{write:!0}})],Rs.prototype,"horizontalAlignment",void 0),u([f({type:Boolean,json:{write:!0}})],Rs.prototype,"kerning",void 0),u([f({type:at,json:{write:!0}})],Rs.prototype,"haloColor",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],Rs.prototype,"haloSize",void 0),u([f({type:Boolean,json:{write:!0}})],Rs.prototype,"rightToLeft",void 0),u([f({type:Boolean,json:{write:!0}})],Rs.prototype,"rotated",void 0),u([f({type:String,json:{write:!0}})],Rs.prototype,"text",void 0),u([Rt({esriTS:"text"},{readOnly:!0})],Rs.prototype,"type",void 0),u([f({...Qpe,json:{write:!0}})],Rs.prototype,"verticalAlignment",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],Rs.prototype,"xoffset",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],Rs.prototype,"yoffset",void 0),u([f({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],Rs.prototype,"angle",void 0),u([f({type:Number,json:{write:!0}})],Rs.prototype,"width",void 0),u([f({type:Number})],Rs.prototype,"lineWidth",void 0),u([ut("lineWidth")],Rs.prototype,"writeLineWidth",null),u([pi("lineWidth")],Rs.prototype,"castLineWidth",null),u([f(Xpe)],Rs.prototype,"lineHeight",void 0),u([ut("lineHeight")],Rs.prototype,"writeLineHeight",null),Rs=H7=u([B("esri.symbols.TextSymbol")],Rs);const GC=Rs;var q7;const A3e=Ie.getLogger("esri.symbols.WebStyleSymbol");let Xd=q7=class extends Wc{constructor(e){super(e),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const e=w(this.portal)?this.portal:Ql.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?t.portal:void 0,super.read(e,t)}clone(){return new q7({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol("webRef",e)}fetchCIMSymbol(e){return this._fetchSymbol("cimRef",e)}async _fetchSymbol(e,t){const i=w(t)?t.cache:null,r=i?this.fetchCacheKey:null;if(w(i)){const a=i.get(r);if(a)return a.clone()}const s=await O3e();Ui(t);const n=s.resolveWebStyleSymbol(this,{portal:this.portal},e,t);n.catch(a=>{A3e.error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await n;return e==="webRef"&&o.type==="point-3d"||e==="cimRef"&&o.type==="cim"?(w(i)&&i.set(r,o.clone()),o):null}};function O3e(){return _e(()=>import("./webStyleSymbolUtils.a5029bcd.js"),[],import.meta.url)}u([f({json:{write:!1}})],Xd.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"styleName",void 0),u([f({type:Ql,json:{write:!1}})],Xd.prototype,"portal",void 0),u([f({type:String,json:{read:lX,write:e1}})],Xd.prototype,"styleUrl",void 0),u([f({type:bM,json:{read:!1}})],Xd.prototype,"thumbnail",void 0),u([f({type:String,json:{write:!0}})],Xd.prototype,"name",void 0),u([Rt({styleSymbolReference:"web-style"},{readOnly:!0})],Xd.prototype,"type",void 0),u([f()],Xd.prototype,"fetchCacheKey",null),Xd=q7=u([B("esri.symbols.WebStyleSymbol")],Xd);const fT=Xd;function tU(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function zE(e){if(!e)return!1;switch(e.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const ax={base:Wc,key:"type",typeMap:{"simple-fill":b1,"picture-fill":$fe,"picture-marker":eU,"simple-line":Sd,"simple-marker":w1,text:GC,"label-3d":Jk,"line-3d":Kk,"mesh-3d":mX,"point-3d":wv,"polygon-3d":W3,"web-style":fT,cim:UC},errorContext:"symbol"},R3e={base:Wc,key:"type",typeMap:{"picture-marker":eU,"simple-marker":w1,text:GC,"web-style":fT,cim:UC},errorContext:"symbol"},M3e=NC({types:ax}),Ffe={base:Wc,key:"type",typeMap:{"simple-fill":b1,"picture-fill":$fe,"picture-marker":eU,"simple-line":Sd,"simple-marker":w1,text:GC,"line-3d":Kk,"mesh-3d":mX,"point-3d":wv,"polygon-3d":W3,"web-style":fT,cim:UC},errorContext:"symbol"},P3e={base:Wc,key:"type",typeMap:{text:GC,"label-3d":Jk},errorContext:"symbol"},Mee={base:Wc,key:"type",typeMap:{"line-3d":Kk,"mesh-3d":mX,"point-3d":wv,"polygon-3d":W3,"web-style":fT,cim:UC},errorContext:"symbol"},I3e={base:Wc,key:"type",typeMap:{"label-3d":Jk},errorContext:"symbol"},kfe=jp(ax);function L3e(e){if(!e)return null;const t={};for(const i in e){const r=Vy(e[i]);r&&(t[i]=r)}return Object.keys(t).length!==0?t:null}function $3e(e){if(!w(e))return null;const t={};for(const i in e){const r=e[i];r&&(t[i]=r.toJSON())}return Object.keys(t).length!==0?t:null}let dc=class extends Hc(Fe){constructor(...e){super(...e),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:Gl(),configurable:!0})}normalizeCtorArgs(e,t,i,r){return e&&!e.declaredClass?e:{geometry:e,symbol:t,attributes:i,popupTemplate:r}}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),this._notifyLayer("geometry",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;for(const t of[this.sourceLayer,this.layer])if(t){if("popupTemplate"in t&&t.popupTemplate)return t.popupTemplate;if(e&&"defaultPopupTemplate"in t&&w(t.defaultPopupTemplate))return t.defaultPopupTemplate}return null}getAttribute(e){return this.attributes&&this.attributes[e]}setAttribute(e,t){if(this.attributes){const i=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",i,t,e)}else this.attributes={[e]:t},this._notifyLayer("attributes",void 0,t,e)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:$3e(this.aggregateGeometries),geometry:w(this.geometry)?this.geometry.toJSON():null,symbol:w(this.symbol)?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){w(this.geometry)&&this.geometry.type==="mesh"&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(e,t,i,r){if(!this.layer||!("graphicChanged"in this.layer))return;const s={graphic:this,property:e,oldValue:t,newValue:i};e==="attributes"&&(s.attributeName=r),this.layer.graphicChanged(s)}};u([f({value:null,json:{read:L3e}})],dc.prototype,"aggregateGeometries",null),u([f({value:null})],dc.prototype,"attributes",null),u([f({value:null,types:cT,json:{read:Vy}})],dc.prototype,"geometry",null),u([f({type:Boolean})],dc.prototype,"isAggregate",void 0),u([f({clonable:"reference"})],dc.prototype,"layer",void 0),u([f({type:j3})],dc.prototype,"popupTemplate",void 0),u([f({clonable:"reference"})],dc.prototype,"sourceLayer",void 0),u([f({value:null,types:ax})],dc.prototype,"symbol",null),u([f({type:Boolean,value:!0})],dc.prototype,"visible",null),dc=u([B("esri.Graphic")],dc),function(e){e.generateUID=Gl}(dc||(dc={}));const ul=dc;var W7;let A_=W7=class extends Fe{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new W7({rotation:this.rotation,scale:this.scale,targetGeometry:w(this.targetGeometry)?this.targetGeometry.clone():null,camera:w(this.camera)?this.camera.clone():null})}};function bV(){return{enabled:!this.camera}}u([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:bV}}}}})],A_.prototype,"rotation",void 0),u([pi("rotation")],A_.prototype,"castRotation",null),u([f({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:bV}}}}})],A_.prototype,"scale",void 0),u([f({types:cT,json:{read:Vy,write:!0,origins:{"web-scene":{read:Vy,write:{overridePolicy:bV}}}}})],A_.prototype,"targetGeometry",void 0),u([f({type:jc,json:{write:!0}})],A_.prototype,"camera",void 0),A_=W7=u([B("esri.Viewpoint")],A_);const Zp=A_;function iU(e){return typeof e=="string"?document.getElementById(e):e}function Ufe(e){for(;e.hasChildNodes();)e.removeChild(e.firstChild)}function Pee(e,t){const i=t.parentNode;i&&i.insertBefore(e,t)}function Iee(e,t){for(;;){const i=e.firstChild;if(!i)break;t.appendChild(i)}}function xe(e,t,i={}){return gX(e,t,i,zfe)}function Jl(e,t,i={}){return gX(e,t,i,Bfe)}function gX(e,t,i={},r){let s=null;const n=i.once?(o,a)=>{r(o)&&(Ln(s),t(o,a))}:(o,a)=>{r(o)&&t(o,a)};if(s=pAe(e,n,i.sync,i.equals),i.initial){const o=e();n(o,o)}return s}function Fo(e,t,i,r={}){let s=null,n=null,o=null;function a(){var h;s&&n&&(n.remove(),(h=r.onListenerRemove)==null||h.call(r,s),s=null,n=null)}function l(h){r.once&&r.once&&Ln(o),i(h)}const c=xe(e,(h,p)=>{var m;a(),Pk(h)&&(s=h,n=F3(h,t,l),(m=r.onListenerAdd)==null||m.call(r,h))},{sync:r.sync,initial:!0});return o=md(()=>{c.remove(),a()}),o}function xP(e,t){return D3e(e,Bfe,t)}function D3e(e,t,i){if(An(i))return Promise.reject($i());const r=e();if(t!=null&&t(r))return Promise.resolve(r);let s=null;function n(){s=Ln(s)}return new Promise((o,a)=>{s=EE([Ma(i,()=>{n(),a($i())}),gX(e,l=>{n(),o(l)},{sync:!1,once:!0},t!=null?t:zfe)])})}function zfe(e){return!0}function Bfe(e){return!!e}const Rr={sync:!0},si={initial:!0},an={sync:!0,initial:!0};class Z7{constructor(t=i=>i.values().next().value){this._peeker=t,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(this._items.size===0)return;let t;for(t of this._items);return t}peek(){if(this._items.size!==0)return this._peeker(this._items)}push(t){this.contains(t)||this._items.add(t)}contains(t){return this._items.has(t)}pop(){if(this.length===0)return;const t=this.peek();return this._items.delete(t),t}popLast(){if(this.length===0)return;const t=this.last();return this._items.delete(t),t}remove(t){this._items.delete(t)}filter(t){return this._items.forEach(i=>{t(i)||this._items.delete(i)}),this}}var jl;(function(e){e[e.HANDSHAKE=0]="HANDSHAKE",e[e.OPEN=1]="OPEN",e[e.OPENED=2]="OPENED",e[e.RESPONSE=3]="RESPONSE",e[e.INVOKE=4]="INVOKE",e[e.ABORT=5]="ABORT",e[e.CLOSE=6]="CLOSE",e[e.OPEN_PORT=7]="OPEN_PORT",e[e.ON=8]="ON"})(jl||(jl={}));let N3e=0;function Vfe(){return N3e++}function F3e(e){return e&&typeof e=="object"&&("result"in e||"transferList"in e)}function I4(e){return e?typeof e=="string"?JSON.stringify({name:"message",message:e}):e.toJSON?JSON.stringify(e):JSON.stringify({name:e.name,message:e.message,details:e.details||{stack:e.stack}}):null}function Gfe(e,t,i,r){if(t.type===jl.OPEN_PORT)return void e.postMessage(t,[t.port]);if(t.type!==jl.INVOKE&&t.type!==jl.RESPONSE)return void e.postMessage(t);let s;F3e(i)?(s=Lee(i.transferList),t.data=i.result):(s=Lee(r),t.data=i),s?e.postMessage(t,s):e.postMessage(t)}function TP(e){if(!e)return null;const t=e.data;return t?typeof t=="string"?JSON.parse(t):t:null}function Lee(e){if(!e||!e.length)return null;if(Ce("esri-workers-arraybuffer-transfer"))return e;const t=e.filter(i=>!k3e(i));return t.length?t:null}function k3e(e){return e instanceof ArrayBuffer||e&&e.constructor&&e.constructor.name==="ArrayBuffer"}const U3e={statsWorker:()=>_e(()=>import("./statsWorker.a8173898.js"),["statsWorker.a8173898.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js"],import.meta.url),geometryEngineWorker:()=>_e(()=>import("./geometryEngineWorker.dfc67929.js"),["geometryEngineWorker.dfc67929.js","geometryEngineJSON.a34a7363.js","geometryEngineBase.cf4f989f.js","json.d1a0fa35.js"],import.meta.url),CSVSourceWorker:()=>_e(()=>import("./CSVSourceWorker.2c867db0.js"),["CSVSourceWorker.2c867db0.js","json.d1a0fa35.js","FeatureStore.b55521bf.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","QueryEngine.dd064fa9.js","QueryEngineCapabilities.c2e9875c.js","clientSideDefaults.41204392.js"],import.meta.url),EdgeProcessingWorker:()=>_e(()=>Promise.resolve().then(()=>Imt),void 0,import.meta.url),ElevationSamplerWorker:()=>_e(()=>import("./ElevationSamplerWorker.f62f66b9.js"),["ElevationSamplerWorker.f62f66b9.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","georeference.2ed95a9f.js"],import.meta.url),FeatureServiceSnappingSourceWorker:()=>_e(()=>import("./FeatureServiceSnappingSourceWorker.c65b39e0.js"),["FeatureServiceSnappingSourceWorker.c65b39e0.js","FeatureStore.b55521bf.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js"],import.meta.url),GeoJSONSourceWorker:()=>_e(()=>import("./GeoJSONSourceWorker.36e46278.js"),["GeoJSONSourceWorker.36e46278.js","FeatureStore.b55521bf.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngine.dd064fa9.js","QueryEngineCapabilities.c2e9875c.js","geojson.f0d5253f.js","clientSideDefaults.41204392.js","sourceUtils.1e6c69e2.js"],import.meta.url),LercWorker:()=>_e(()=>import("./LercWorker.f02bd491.js"),[],import.meta.url),MemorySourceWorker:()=>_e(()=>import("./MemorySourceWorker.83273955.js"),["MemorySourceWorker.83273955.js","objectIdUtils.773397d7.js","FeatureStore.b55521bf.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngine.dd064fa9.js","QueryEngineCapabilities.c2e9875c.js","clientSideDefaults.41204392.js","sourceUtils.1e6c69e2.js"],import.meta.url),PBFDecoderWorker:()=>_e(()=>import("./PBFDecoderWorker.716efee0.js"),[],import.meta.url),Pipeline:()=>_e(()=>import("./Pipeline.b33c5b41.js").then(e=>e.P),["Pipeline.b33c5b41.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","createConnection.6406b37d.js","quickselect.03306040.js","centroid.88cb65db.js","ogcFeatureUtils.26caad6c.js","geojson.f0d5253f.js","clientSideDefaults.41204392.js","enums.ba1e21c6.js","Utils.53ef10e9.js","number.08b65821.js"],import.meta.url),PointCloudWorker:()=>_e(()=>import("./PointCloudWorker.156ac4ca.js"),["PointCloudWorker.156ac4ca.js","PointCloudWorkerUtil.5788bd32.js","PointCloudUniqueValueRenderer.47b43249.js"],import.meta.url),RasterWorker:()=>_e(()=>import("./RasterWorker.9b1fa65d.js"),["RasterWorker.9b1fa65d.js","PixelBlock.93a15a4d.js","dataUtils.ba165ecb.js","colorUtils.e5585cd0.js","rasterProjectionHelper.86160a91.js","utils.93ec4940.js"],import.meta.url),SceneLayerSnappingSourceWorker:()=>_e(()=>import("./SceneLayerSnappingSourceWorker.82923723.js"),["SceneLayerSnappingSourceWorker.82923723.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js"],import.meta.url),SceneLayerWorker:()=>_e(()=>import("./SceneLayerWorker.4ba37db1.js").then(e=>e.S),["SceneLayerWorker.4ba37db1.js","I3SNode.2febe09c.js"],import.meta.url),WFSSourceWorker:()=>_e(()=>import("./WFSSourceWorker.4ec7965e.js"),["WFSSourceWorker.4ec7965e.js","FeatureStore.b55521bf.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngine.dd064fa9.js","QueryEngineCapabilities.c2e9875c.js","geojson.f0d5253f.js","sourceUtils.1e6c69e2.js","wfsUtils.3e777f55.js","xmlUtils.986ddba5.js"],import.meta.url),WorkerTileHandler:()=>_e(()=>import("./WorkerTileHandler.baf6e754.js"),["WorkerTileHandler.baf6e754.js","StyleRepository.1e4d25cc.js","enums.ba1e21c6.js","colorUtils.e5585cd0.js","Geometry.b68345ae.js","GeometryUtils.316cebf1.js","TileClipper.26f024db.js","BidiEngine.4cfb7343.js"],import.meta.url)},{CLOSE:$ee,ABORT:Dee,INVOKE:Nee,RESPONSE:BA,OPEN_PORT:Fee,ON:z3e}=jl,B3e=2;class V3e{constructor(t){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=t,this._timer=null,this._process=this._process.bind(this)}push(t){t.type===jl.ABORT?this._cancelledJobIds.add(t.jobId):(this._invokeMessages.push(t),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const t of this._invokeMessages)this._cancelledJobIds.has(t.jobId)||this._invoke(t);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class Pc{constructor(t,i,r){this._port=t,this._getNextJob=r,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new V3e(s=>this._onInvokeMessage(s)),this._client=i.client,this._onMessage=this._onMessage.bind(this),this._channel=i.channel,this._schedule=i.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(t){const i=new MessageChannel;let r;r=typeof t=="function"?new t:"default"in t&&typeof t.default=="function"?new t.default:t;const s=new Pc(i.port1,{channel:i,client:r},()=>null);return typeof r=="object"&&"remoteClient"in r&&(r.remoteClient=s),Pc.clients.set(s,r),i.port2}static loadWorker(t){const i=U3e[t];return i?i():Promise.resolve(null)}close(){this._post({type:$ee}),this._close()}isBusy(){return this._outJobs.size>0}invoke(t,i,r){const s=r&&r.signal,n=r&&r.transferList;if(!this._port)return Promise.reject(new se("worker:port-closed",`Cannot call invoke('${t}'), port is closed`,{methodName:t,data:i}));const o=Vfe();return new Promise((a,l)=>{if(An(s))return this._processWork(),void l($i());const c=Ma(s,()=>{const p=this._outJobs.get(o);p&&(this._outJobs.delete(o),this._processWork(),Ln(p.abortHandle),this._post({type:Dee,jobId:o}),l($i()))}),h={resolve:a,reject:l,abortHandle:c,debugInfo:t};this._outJobs.set(o,h),this._post({type:Nee,jobId:o,methodName:t,abortable:s!=null},i,n)})}on(t,i){const r=new MessageChannel;function s(n){i(n.data)}return this._port.postMessage({type:jl.ON,eventType:t,port:r.port2},[r.port2]),r.port1.addEventListener("message",s),r.port1.start(),{remove(){r.port1.postMessage({type:jl.CLOSE}),r.port1.close(),r.port1.removeEventListener("message",s)}}}jobAdded(){this._processWork()}openPort(){const t=new MessageChannel;return this._post({type:Fee,port:t.port2}),t.port1}_processWork(){if(this._outJobs.size>=B3e)return;const t=this._getNextJob();if(!t)return;const{methodName:i,data:r,invokeOptions:s,deferred:n}=t;this.invoke(i,r,s).then(o=>n.resolve(o)).catch(o=>n.reject(o))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(t=>{Ln(t.abortHandle),t.reject($i(`Worker closing, aborting job calling '${t.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(t){w(this._schedule)?this._schedule(()=>this._processMessage(t)):this._processMessage(t)}_processMessage(t){const i=TP(t);if(i)switch(i.type){case BA:this._onResponseMessage(i);break;case Nee:this._invokeQueue.push(i);break;case Dee:this._onAbortMessage(i);break;case $ee:this._onCloseMessage();break;case Fee:this._onOpenPortMessage(i);break;case z3e:this._onOnMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);this._invokeQueue.push(t),s&&(s.controller&&s.controller.abort(),i.delete(r))}_onCloseMessage(){const t=this._client;this._close(),t&&"destroy"in t&&Pc.clients.get(this)===t&&t.destroy(),Pc.clients.delete(this),t&&t.remoteClient&&(t.remoteClient=null)}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs;let l,c=this._client,h=c[i];try{if(!h&&i&&i.includes(".")){const p=i.split(".");for(let m=0;m<p.length-1;m++)c=c[p[m]],h=c[p[m+1]]}if(typeof h!="function")throw new TypeError(`${i} is not a function`);l=h.call(c,s,{client:this,signal:o?o.signal:null})}catch(p){return void this._post({type:BA,jobId:r,error:I4(p)})}ah(l)?(a.set(r,{controller:o,promise:l}),l.then(p=>{a.has(r)&&(a.delete(r),this._post({type:BA,jobId:r},p))},p=>{a.has(r)&&(a.delete(r),Cs(p)||this._post({type:BA,jobId:r,error:I4(p||{message:`Error encountered at method ${i}`})}))})):this._post({type:BA,jobId:r},l)}_onOpenPortMessage(t){new Pc(t.port,{client:this._client},()=>null)}_onOnMessage(t){const{port:i}=t,r=this._client.on(t.eventType,n=>{i.postMessage(n)}),s=F3(t.port,"message",n=>{TP(n).type===jl.CLOSE&&(s.remove(),r.remove(),i.close())})}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs;if(!n.has(i))return;const o=n.get(i);this._processWork(),n.delete(i),Ln(o.abortHandle),r?o.reject(se.fromJSON(JSON.parse(r))):o.resolve(s)}_post(t,i,r){return Gfe(this._port,t,i,r)}}Pc.kernelInfo={revision:dfe,version:pfe,buildDate:hfe},Pc.clients=new Map;const G3e=Ie.getLogger("esri.core.workers.Connection");class j3e{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Z7}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(t,i){return new Promise((r,s)=>{let n=!0;const o=a=>{Ui(i.signal),n&&(n=!1,a())};this._clients.length=t.length,this._clientPromises.length=t.length,this._inUseClients.length=t.length;for(let a=0;a<t.length;++a){const l=t[a];ah(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new Pc(c,i,()=>this._ongoingJobsQueue.pop()),o(r),this._clients[a]),()=>(o(s),null)):(this._clients[a]=new Pc(l,i,()=>this._ongoingJobsQueue.pop()),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(r))}})}broadcast(t,i,r){const s=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const o=this._clientPromises[n];s[n]=o.then(a=>a.invoke(t,i,r))}return s}close(){let t;for(;t=this._ongoingJobsQueue.pop();)t.deferred.reject($i(`Worker closing, aborting job calling '${t.methodName}'`));for(const i of this._clientPromises)i.then(r=>r.close());this._clients.length=0,this._clientPromises.length=0}invoke(t,i,r){let s=null;Array.isArray(r)?(G3e.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),s={transferList:r}):s=r;const n=Qv();this._ongoingJobsQueue.push({methodName:t,data:i,invokeOptions:s,deferred:n});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l.jobAdded())}return n.promise}on(t,i){return Promise.all(this._clientPromises).then(()=>EE(this._clients.map(r=>r.on(t,i))))}openPorts(){return new Promise(t=>{const i=new Array(this._clientPromises.length);let r=i.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(n=>{i[s]=n.openPort(),--r==0&&t(i)})})}get test(){return{numClients:this._clients.length}}}const H3e=Ie.getLogger("esri.assets");function q3e(e,t){return jr(tr(e),t)}function tr(e){if(!sr.assetsPath)throw H3e.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new se("assets:path-not-set","config.assetsPath is not set");return Mx(sr.assetsPath,e)}const jfe=Ie.getLogger("esri.intl");function kg(e,t,i={}){const{format:r={}}=i;return Sm(e,s=>W3e(s,t,r))}function W3e(e,t,i){let r,s;const n=e.indexOf(":");if(n===-1?r=e.trim():(r=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!r)return"";const o=$C(r,t);if(o==null)return"";const a=i[s]||i[r];return a?Z3e(o,a):s?X3e(o,s):yX(o)}function Z3e(e,t){switch(t.type){case"date":return Cm(e,t.intlOptions);case"number":return Am(e,t.intlOptions);default:return jfe.warn("missing format descriptor for key {key}"),yX(e)}}function X3e(e,t){switch(t.toLowerCase()){case"dateformat":return Cm(e);case"numberformat":return Am(e);default:return jfe.warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?Cm(e):/^numberformat/i.test(t)?Am(e):yX(e)}}function yX(e){switch(typeof e){case"string":return e;case"number":return Am(e);case"boolean":return""+e;default:return e instanceof Date?Cm(e):""}}const kee=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,Y3e={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function Uee(e){var t;return(t=Y3e[e])!=null?t:!1}const bR=[],nE=new Map;function zee(e){for(const t of nE.keys())qfe(e.pattern,t)&&nE.delete(t)}function Q3e(e){return bR.includes(e)||(zee(e),bR.unshift(e)),{remove(){const t=bR.indexOf(e);t>-1&&(bR.splice(t,1),zee(e))}}}async function Hfe(e){const t=Hu();nE.has(e)||nE.set(e,K3e(e,t));const i=nE.get(e);return await eIe.add(i),i}function J3e(e){if(!kee.test(e))return null;const[,t,i]=kee.exec(e),r=t+(i?"-"+i.toUpperCase():"");return Uee(r)?r:Uee(t)?t:null}async function K3e(e,t){const i=[];for(const r of bR)if(qfe(r.pattern,e))try{return await r.fetchMessageBundle(e,t)}catch(s){i.push(s)}throw i.length?new se("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i}):new se("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}function qfe(e,t){return typeof e=="string"?t.startsWith(e):e.test(t)}BZ(()=>{nE.clear()});const eIe=new class{constructor(){this._numLoading=0}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Qv())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function tIe(e,t,i,r){const s=t.exec(i);if(!s)throw new se("esri-intl:invalid-bundle",`Bundle id "${i}" is not compatible with the pattern "${t}"`);const n=s[1]?`${s[1]}/`:"",o=s[2],a=J3e(r),l=`${n}${o}.json`,c=a?`${n}${o}_${a}.json`:l;let h;try{h=await Bee(e(c))}catch(p){if(c===l)throw new se("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:p});try{h=await Bee(e(l))}catch(m){throw new se("intl:unknown-bundle",`Bundle "${i}" cannot be loaded`,{error:m})}}return h}async function Bee(e){if(w(Vee.fetchBundleAsset))return Vee.fetchBundleAsset(e);const t=await jr(e,{responseType:"text"});return JSON.parse(t.data)}class iIe{constructor({base:t="",pattern:i,location:r=new URL(window.location.href)}){let s;s=typeof r=="string"?n=>new URL(n,new URL(r,window.location.href)).href:r instanceof URL?n=>new URL(n,r).href:r,this.pattern=typeof i=="string"?new RegExp(`^${i}`):i,this.getAssetUrl=s,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(t,i){return tIe(this.getAssetUrl,this.matcher,t,i)}}function rIe(e){return new iIe(e)}const Vee={};Q3e(rIe({pattern:"esri/",location:tr}));const Gee={};function sIe(e,t){for(const i of e)if(i.name===t.name)return;e.push(t)}function nIe(e){var i;const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages&&e.packages.concat()||[],paths:{...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=Gee.baseUrl),(i=Gee.packages)==null||i.forEach(r=>{sIe(t.packages,r)}),t}class oIe{constructor(){const t=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(i=>{this[i]=(...r)=>t[i](...r)})}}class PN{constructor(){this._dispatcher=new oIe,this._workerPostMessage({type:jl.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(t){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=t,t&&this.addEventListener("message",t)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(t){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=t,t&&this.addEventListener("messageerror",t)}get onerror(){return this._onerrorHandler}set onerror(t){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=t,t&&this.addEventListener("error",t)}postMessage(t){CE(()=>{this._workerMessageHandler(new MessageEvent("message",{data:t}))})}dispatchEvent(t){return this._dispatcher.dispatchEvent(t)}addEventListener(t,i,r){this._dispatcher.addEventListener(t,i,r)}removeEventListener(t,i,r){this._dispatcher.removeEventListener(t,i,r)}_workerPostMessage(t){CE(()=>{this.dispatchEvent(new MessageEvent("message",{data:t}))})}async _workerMessageHandler(t){const i=TP(t);if(i&&i.type===jl.OPEN){const{modulePath:r,jobId:s}=i;let n=await Pc.loadWorker(r);n||(n=await _e(()=>import(r),[],import.meta.url));const o=Pc.connect(n);this._workerPostMessage({type:jl.OPENED,jobId:s,data:o})}}}const X7=Ie.getLogger("esri.core.workers"),{HANDSHAKE:aIe}=jl,lIe='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let vL,bL;const jee="Failed to create Worker. Fallback to execute module in main thread";async function cIe(){if(!Ce("esri-workers")||(Ce("mozilla"),0))return Hee(new PN);if(!vL&&!bL)try{const t=lIe.replace('"{CONFIGURATION}"',`'${uIe()}'`);vL=URL.createObjectURL(new Blob([t],{type:"text/javascript"}))}catch(t){bL=t||{}}let e;if(vL)try{e=new Worker(vL,{name:"esri-worker-"+hIe++})}catch{X7.warn(jee,bL),e=new PN}else X7.warn(jee,bL),e=new PN;return Hee(e)}async function Hee(e){return new Promise(t=>{function i(s){const n=TP(s);n&&n.type===aIe&&(e.removeEventListener("message",i),e.removeEventListener("error",r),t(e))}function r(s){s.preventDefault(),e.removeEventListener("message",i),e.removeEventListener("error",r),X7.warn("Failed to create Worker. Fallback to execute module in main thread",s),(e=new PN).addEventListener("message",i),e.addEventListener("error",r)}e.addEventListener("message",i),e.addEventListener("error",r)})}function uIe(){let e;if(sr.default!=null){const s={...sr};delete s.default,e=JSON.parse(JSON.stringify(s))}else e=JSON.parse(JSON.stringify(sr));e.assetsPath=cd(e.assetsPath),e.request.interceptors=[],e.log.interceptors=[],e.locale=Hu(),e.has={"esri-csp-restrictions":Ce("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":Ce("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":Ce("esri-2d-query-centroid-enabled"),"featurelayer-pbf":Ce("featurelayer-pbf"),"featurelayer-simplify-thresholds":Ce("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":Ce("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":Ce("featurelayer-simplify-mobile-factor"),"esri-atomics":Ce("esri-atomics"),"esri-shared-array-buffer":Ce("esri-shared-array-buffer"),"esri-tiles-debug":Ce("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":Ce("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":Ce("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl&&(e.workers.loaderUrl=cd(e.workers.loaderUrl)),e.workers.workerPath?e.workers.workerPath=cd(e.workers.workerPath):e.workers.workerPath=cd(tr("esri/core/workers/RemoteClient.js")),e.workers.useDynamicImport=!1;const t=sr.workers.loaderConfig,i=nIe({baseUrl:t==null?void 0:t.baseUrl,locale:Hu(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...t==null?void 0:t.has},map:{...t==null?void 0:t.map},paths:{...t==null?void 0:t.paths},packages:(t==null?void 0:t.packages)||[]}),r={version:pfe,buildDate:hfe,revision:dfe};return JSON.stringify({esriConfig:e,loaderConfig:i,kernelInfo:r})}let hIe=0;const dIe=Ie.getLogger("esri.core.workers"),{ABORT:qee,INVOKE:pIe,OPEN:fIe,OPENED:mIe,RESPONSE:VA}=jl;class _X{constructor(t,i){this._outJobs=new Map,this._inJobs=new Map,this.worker=t,this.id=i,t.addEventListener("message",this._onMessage.bind(this)),t.addEventListener("error",r=>{r.preventDefault(),dIe.error(r)})}static async create(t){const i=await cIe();return new _X(i,t)}terminate(){this.worker.terminate()}async open(t,i={}){const{signal:r}=i,s=Vfe();return new Promise((n,o)=>{const a={resolve:n,reject:o,abortHandle:lZ(r,()=>{this._outJobs.delete(s),this._post({type:qee,jobId:s})})};this._outJobs.set(s,a),this._post({type:fIe,jobId:s,modulePath:t})})}_onMessage(t){const i=TP(t);if(i)switch(i.type){case mIe:this._onOpenedMessage(i);break;case VA:this._onResponseMessage(i);break;case qee:this._onAbortMessage(i);break;case pIe:this._onInvokeMessage(i)}}_onAbortMessage(t){const i=this._inJobs,r=t.jobId,s=i.get(r);s&&(s.controller&&s.controller.abort(),i.delete(r))}_onInvokeMessage(t){const{methodName:i,jobId:r,data:s,abortable:n}=t,o=n?new AbortController:null,a=this._inJobs,l=qPe[i];let c;try{if(typeof l!="function")throw new TypeError(`${i} is not a function`);c=l.call(null,s,{signal:o?o.signal:null})}catch(h){return void this._post({type:VA,jobId:r,error:I4(h)})}ah(c)?(a.set(r,{controller:o,promise:c}),c.then(h=>{a.has(r)&&(a.delete(r),this._post({type:VA,jobId:r},h))},h=>{a.has(r)&&(a.delete(r),h||(h={message:"Error encountered at method"+i}),Cs(h)||this._post({type:VA,jobId:r,error:I4(h||{message:`Error encountered at method ${i}`})}))})):this._post({type:VA,jobId:r},c)}_onOpenedMessage(t){const{jobId:i,data:r}=t,s=this._outJobs.get(i);s&&(this._outJobs.delete(i),Ln(s.abortHandle),s.resolve(r))}_onResponseMessage(t){const{jobId:i,error:r,data:s}=t,n=this._outJobs.get(i);n&&(this._outJobs.delete(i),Ln(n.abortHandle),r?n.reject(se.fromJSON(JSON.parse(r))):n.resolve(s))}_post(t,i,r){return Gfe(this.worker,t,i,r)}}let Uw=Ce("esri-workers-debug")?1:Ce("host-browser")?navigator.hardwareConcurrency-1:0;Uw||(Uw=Ce("safari")&&Ce("mac")||Ce("trident")?7:2);let Wee=0;const IN=[];function gIe(){Zfe()}async function wL(e,t){const i=new j3e;return await i.open(e,t),i}async function Wfe(e,t={}){if(typeof e!="string")throw new se("workers:undefined-module","modulePath is missing");let i=t.strategy||"distributed";if(Ce("host-webworker")&&!Ce("esri-workers")&&(i="local"),i==="local"){let r=await Pc.loadWorker(e);r||(r=await _e(()=>import(e),[],import.meta.url)),Ui(t.signal);const s=t.client||r;return wL([Pc.connect(r)],{...t,client:s})}if(await Zfe(),Ui(t.signal),i==="dedicated"){const r=Wee++%Uw;return wL([await IN[r].open(e,t)],t)}if(t.maxNumWorkers&&t.maxNumWorkers>0){const r=Math.min(t.maxNumWorkers,Uw);if(r<Uw){const s=new Array(r);for(let n=0;n<r;++n){const o=Wee++%Uw;s[n]=IN[o].open(e,t)}return wL(s,t)}}return wL(IN.map(r=>r.open(e,t)),t)}let xL=null;async function Zfe(){if(xL)return xL;new AbortController;const e=[];for(let t=0;t<Uw;t++){const i=_X.create(t).then(r=>(IN[t]=r,r));e.push(i)}return xL=Promise.all(e),xL}let LN=class extends ze{constructor(e){super(e),this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(t=>{e+=t.length}),e}add(e,t){if(!this._isHandle(e)&&!Array.isArray(e)&&!zt.isCollection(e))return this;const i=this._getOrCreateGroup(t);return Array.isArray(e)||zt.isCollection(e)?e.forEach(r=>this._isHandle(r)&&i.push(r)):i.push(e),this.notifyChange("size"),this}forEach(e,t){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&t&&i.forEach(t)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(Array.isArray(e)||zt.isCollection(e))return e.forEach(this.remove,this),this;if(!this.has(e))return this;const t=this._getGroup(e);for(let i=0;i<t.length;i++)t[i].remove();return this._deleteGroup(e),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(e=>{for(let t=0;t<e.length;t++)e[t].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(e){return e&&!!e.remove}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const t=[];return this._groups.set(this._ensureGroupKey(e),t),t}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_deleteGroup(e){return this._groups.delete(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}};u([f({readOnly:!0})],LN.prototype,"size",null),LN=u([B("esri.core.Handles")],LN);const xi=LN;let _m=class extends ze{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new xi,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(e,t,i={}){return this._installWatch(e,t,i,xe)}addWhen(e,t,i={}){return this._installWatch(e,t,i,Jl)}addOnCollectionChange(e,t,{initial:i=!1,final:r=!1}={}){const s=++this.handleId;return this.handles.add([Fo(e,"after-changes",this._createSyncUpdatingCallback(),Rr),Fo(e,"change",t,{onListenerAdd:i?n=>t({added:n.toArray(),removed:[]}):void 0,onListenerRemove:r?n=>t({added:[],removed:n.toArray()}):void 0})],s),{remove:()=>this.handles.remove(s)}}addPromise(e){if(N(e))return e;const t=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(e)&&(this.pendingPromises.size!==0||this.handles.has(TL)||this._set("updating",!1))}},t),this.pendingPromises.add(e),this._set("updating",!0);const i=()=>this.handles.remove(t);return e.then(i,i),e}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(e,t,i={},r){const s=++this.handleId;i.sync||this._installSyncUpdatingWatch(e,s);const n=r(e,t,i);return this.handles.add(n,s),{remove:()=>this.handles.remove(s)}}_installSyncUpdatingWatch(e,t){const i=this._createSyncUpdatingCallback(),r=xe(e,i,{sync:!0,equals:()=>!1});return this.handles.add(r,t),r}_createSyncUpdatingCallback(){return()=>{this.handles.remove(TL),++this.scheduleHandleId;const e=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(DC(()=>{e===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(TL))}),TL)}}};u([f({readOnly:!0})],_m.prototype,"updating",void 0),_m=u([B("esri.core.support.WatchUpdatingTracking")],_m);const TL=-42;var Zee;(function(e){e[e.NONE=0]="NONE",e[e.SYNC=1]="SYNC",e[e.INIT=2]="INIT"})(Zee||(Zee={}));const mT=e=>{let t=class extends e{destroy(){var i,r;this.destroyed||((i=this._get("handles"))==null||i.destroy(),(r=this._get("updatingHandles"))==null||r.destroy())}get handles(){return this._get("handles")||new xi}get updatingHandles(){return this._get("updatingHandles")||new _m}};return u([f({readOnly:!0})],t.prototype,"handles",null),u([f({readOnly:!0})],t.prototype,"updatingHandles",null),t=u([B("esri.core.HandleOwner")],t),t};let BE=class extends mT(ze){};BE=u([B("esri.core.HandleOwner")],BE);Ie.getLogger("esri.core.support.OwningCollection");let wM=class extends mT(zt){constructor(e){super(e),this.handles.add([this.on("before-add",t=>{N(t.item)&&t.preventDefault()}),this.on("after-add",t=>this._own(t.item)),this.on("after-remove",t=>this._release(t.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(zt.ofType(this.itemType.Type))(e):new zt(e)}};function Y7(e,t){return{type:e,cast:ufe,set(i){const r=Ix(i,this._get(t),e);r.owner=this,this._set(t,r)}}}u([f()],wM.prototype,"owner",null),wM=u([B("esri.core.support.OwningCollection")],wM);function vX(e){return new wt({wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${e.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`})}const Xfe=vX(Qi),L4=vX(ym),$4=vX(By),yIe=new wt({wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Qi.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`});function Pm(e){return e&&(km(e)||e===L4)?L4:e&&(Um(e)||e===$4)?$4:Xfe}function ji(e){return e&&(km(e)||e===L4)?ym:e&&(Um(e)||e===$4)?By:Qi}function Rvt(e){return CZ(e)?ym:AZ(e)?By:Qi}const Yfe=39.37,_Ie=Qi.radius*Math.PI/200,Qfe=/UNIT\[([^\]]+)\]\]$/i,lx=H,Jfe=/UNIT\[([^\]]+)\]/i,vIe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),bIe=La()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),uf=e=>e*e,F0=e=>e*e*e,SP={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:uf(.001)},"square-centimeters":{inBaseUnits:uf(.01)},"square-decimeters":{inBaseUnits:uf(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:uf(1e3)},"square-inches":{inBaseUnits:uf(.0254)},"square-feet":{inBaseUnits:uf(.3048)},"square-yards":{inBaseUnits:uf(.9144)},"square-miles":{inBaseUnits:uf(1609.344)},"square-us-feet":{inBaseUnits:uf(1200/3937)},acres:{inBaseUnits:.0015625*uf(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*F0(.001)},"cubic-centimeters":{inBaseUnits:1e3*F0(.01)},"cubic-decimeters":{inBaseUnits:1e3*F0(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*F0(1e3)},"cubic-inches":{inBaseUnits:1e3*F0(.0254)},"cubic-feet":{inBaseUnits:1e3*F0(.3048)},"cubic-yards":{inBaseUnits:1e3*F0(.9144)},"cubic-miles":{inBaseUnits:1e3*F0(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},wIe=(()=>{const e={};for(const t in SP)for(const i in SP[t].units)e[i]=t;return e})();function xIe(e,t,i){return e*SP[i].units[t].inBaseUnits}function TIe(e,t,i){return e/SP[i].units[t].inBaseUnits}const SIe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"];function Q7(e){const t=wIe[e];if(!t)throw new Error("unknown type");return t}function Xee(e,t=null){return t=t||Q7(e),SP[t].baseUnit===e}function En(e,t,i){if(t===i)return e;const r=Q7(t);if(r!==Q7(i))throw new Error("incompatible units");const s=Xee(t,r)?e:xIe(e,t,r);return Xee(i,r)?s:TIe(s,i,r)}function EIe(e,t){const i=En(e,t,"meters");return Math.abs(i)<3e3?"meters":"kilometers"}function CIe(e,t){const i=En(e,t,"meters");return Math.abs(i)<1e5?"meters":"kilometers"}function AIe(e,t){const i=En(e,t,"feet");return Math.abs(i)<1e3?"feet":"miles"}function OIe(e,t){const i=En(e,t,"feet");return Math.abs(i)<1e5?"feet":"miles"}function Mvt(e,t){const i=En(e,t,"square-meters");return Math.abs(i)<3e6?"square-meters":"square-kilometers"}function Pvt(e,t){const i=En(e,t,"square-feet");return Math.abs(i)<1e6?"square-feet":"square-miles"}function RIe(e,t,i){return En(e,t,"meters")/(i*Math.PI/180)}function Kfe(e){return bIe.fromJSON(e.toLowerCase())||null}function VE(e){if(e&&typeof e=="object"&&!uP(e))return 1;const t=Zc(e);return t>1e5?1:t}function MIe(e){return Zc(e)>=(e instanceof wt?ji(e).metersPerDegree:1e5)?"meters":bX(e)}function Zc(e,t=Qi.metersPerDegree){return $t(PIe(e,!0),t)}function PIe(e,t=!1){let i,r,s=null;if(e!=null&&(typeof e=="object"?(i=e.wkid,r=e.wkt):typeof e=="number"?i=e:typeof e=="string"&&(r=e)),i){if(CZ(i))return ym.metersPerDegree;if(AZ(i))return By.metersPerDegree;s=lx.values[lx[i]],!s&&t&&vIe.has(i)&&(s=_Ie)}else r&&(ime(r)?s=Yee(Qfe.exec(r),s):tme(r)&&(s=Yee(Jfe.exec(r),s)));return s}function Yee(e,t){return e&&e[1]?eme(e[1]):t}function eme(e){return parseFloat(e.split(",")[1])}function bX(e){let t,i,r=null;if(e!=null&&(typeof e=="object"?(t=e.wkid,i=e.wkt):typeof e=="number"?t=e:typeof e=="string"&&(i=e)),t)r=lx.units[lx[t]];else if(i){const s=ime(i)?Qfe:tme(i)?Jfe:null;if(s){const n=s.exec(i);n&&n[1]&&(r=LIe(n[1]))}}return w(r)?Kfe(r):null}function Ivt(e){const t=bX(e);return N(t)||!SIe.includes(t)?null:t}function tme(e){return/^GEOCCS/i.test(e)}function ime(e){return/^PROJCS/i.test(e)}const IIe=1e-7;function LIe(e){const t=/[\\"\\']{1}([^\\"\\']+)/.exec(e);let i=t&&t[1];if(!i||!lx.units.includes(i)){const r=eme(e);i=null;const s=lx.values;for(let n=0;n<s.length;++n)if(Math.abs(r-s[n])<IIe){i=lx.units[n];break}}return i}function $Ie(e){const t=bX(e);if(N(t))return null;switch(t){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}function Lvt(e){var s,n,o;const t="metric";if(N(e))return t;const i=e.map,r=i&&"portalItem"in i?(s=i.portalItem)==null?void 0:s.portal:null;if(r)switch((o=(n=r==null?void 0:r.user)==null?void 0:n.units)!=null?o:r.units){case t:return t;case"english":return"imperial"}return $t($Ie(e.spatialReference),t)}const rme={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},sme={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},DIe=La()(rme),NIe=La()(sme);La()({...rme,...sme});var wR;const D4=La()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),nme=D4.jsonValues.slice();Ak(nme,"orthometric");const xM=La()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let Yd=wR=class extends Fe{constructor(e){super(e),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(e,t,i){return D4.write(e,t,i)}readHeightModel(e,t,i){return D4.read(e)||(i&&i.messages&&i.messages.push(FIe(e,{context:i})),null)}readHeightUnit(e,t,i){return xM.read(e)||(i&&i.messages&&i.messages.push(Qee(e,{context:i})),null)}readHeightUnitService(e,t,i){return Kfe(e)||xM.read(e)||(i&&i.messages&&i.messages.push(Qee(e,{context:i})),null)}readVertCRS(e,t){return t.vertCRS||t.ellipsoid||t.geoid}clone(){return new wR({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(e){return!!e&&(this===e||this.heightModel===e.heightModel&&this.heightUnit===e.heightUnit&&this.vertCRS===e.vertCRS)}static deriveUnitFromSR(e,t){const i=MIe(t);return new wR({heightModel:e.heightModel,heightUnit:i,vertCRS:e.vertCRS})}write(e,t){return t={origin:"web-scene",...t},super.write(e,t)}static fromJSON(e){if(!e)return null;const t=new wR;return t.read(e,{origin:"web-scene"}),t}};function Qee(e,t){return new Ju("height-unit:unsupported",`Height unit of value '${e}' is not supported`,t)}function FIe(e,t){return new Ju("height-model:unsupported",`Height model of value '${e}' is not supported`,t)}u([f({type:D4.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:nme,default:"ellipsoidal"}}}})],Yd.prototype,"heightModel",void 0),u([ut("web-scene","heightModel")],Yd.prototype,"writeHeightModel",null),u([it(["web-scene","service"],"heightModel")],Yd.prototype,"readHeightModel",null),u([f({type:xM.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:xM.jsonValues,write:xM.write}}}})],Yd.prototype,"heightUnit",void 0),u([it("web-scene","heightUnit")],Yd.prototype,"readHeightUnit",null),u([it("service","heightUnit")],Yd.prototype,"readHeightUnitService",null),u([f({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],Yd.prototype,"vertCRS",void 0),u([it("service","vertCRS",["vertCRS","ellipsoid","geoid"])],Yd.prototype,"readVertCRS",null),Yd=wR=u([B("esri.geometry.HeightModelInfo")],Yd);const jC=Yd;function js(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Vm(e,t,i,r,s,n,o,a,l,c,h,p,m,g,v,b,S){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=h,e[10]=p,e[11]=m,e[12]=g,e[13]=v,e[14]=b,e[15]=S,e}function Im(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kl(e,t){if(e===t){const i=t[1],r=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Fs(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],m=t[10],g=t[11],v=t[12],b=t[13],S=t[14],T=t[15],O=i*a-r*o,C=i*l-s*o,M=i*c-n*o,I=r*l-s*a,$=r*c-n*a,U=s*c-n*l,q=h*b-p*v,G=h*S-m*v,Y=h*T-g*v,J=p*S-m*b,X=p*T-g*b,ne=m*T-g*S;let re=O*ne-C*X+M*J+I*Y-$*G+U*q;return re?(re=1/re,e[0]=(a*ne-l*X+c*J)*re,e[1]=(s*X-r*ne-n*J)*re,e[2]=(b*U-S*$+T*I)*re,e[3]=(m*$-p*U-g*I)*re,e[4]=(l*Y-o*ne-c*G)*re,e[5]=(i*ne-s*Y+n*G)*re,e[6]=(S*M-v*U-T*C)*re,e[7]=(h*U-m*M+g*C)*re,e[8]=(o*X-a*Y+c*q)*re,e[9]=(r*Y-i*X-n*q)*re,e[10]=(v*$-b*M+T*O)*re,e[11]=(p*M-h*$-g*O)*re,e[12]=(a*G-o*J-l*q)*re,e[13]=(i*J-r*G+s*q)*re,e[14]=(b*C-v*I-S*O)*re,e[15]=(h*I-p*C+m*O)*re,e):null}function kIe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],m=t[10],g=t[11],v=t[12],b=t[13],S=t[14],T=t[15];return e[0]=a*(m*T-g*S)-p*(l*T-c*S)+b*(l*g-c*m),e[1]=-(r*(m*T-g*S)-p*(s*T-n*S)+b*(s*g-n*m)),e[2]=r*(l*T-c*S)-a*(s*T-n*S)+b*(s*c-n*l),e[3]=-(r*(l*g-c*m)-a*(s*g-n*m)+p*(s*c-n*l)),e[4]=-(o*(m*T-g*S)-h*(l*T-c*S)+v*(l*g-c*m)),e[5]=i*(m*T-g*S)-h*(s*T-n*S)+v*(s*g-n*m),e[6]=-(i*(l*T-c*S)-o*(s*T-n*S)+v*(s*c-n*l)),e[7]=i*(l*g-c*m)-o*(s*g-n*m)+h*(s*c-n*l),e[8]=o*(p*T-g*b)-h*(a*T-c*b)+v*(a*g-c*p),e[9]=-(i*(p*T-g*b)-h*(r*T-n*b)+v*(r*g-n*p)),e[10]=i*(a*T-c*b)-o*(r*T-n*b)+v*(r*c-n*a),e[11]=-(i*(a*g-c*p)-o*(r*g-n*p)+h*(r*c-n*a)),e[12]=-(o*(p*S-m*b)-h*(a*S-l*b)+v*(a*m-l*p)),e[13]=i*(p*S-m*b)-h*(r*S-s*b)+v*(r*m-s*p),e[14]=-(i*(a*S-l*b)-o*(r*S-s*b)+v*(r*l-s*a)),e[15]=i*(a*m-l*p)-o*(r*m-s*p)+h*(r*l-s*a),e}function UIe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],p=e[10],m=e[11],g=e[12],v=e[13],b=e[14],S=e[15];return(t*o-i*n)*(p*S-m*b)-(t*a-r*n)*(h*S-m*v)+(t*l-s*n)*(h*b-p*v)+(i*a-r*o)*(c*S-m*g)-(i*l-s*o)*(c*b-p*g)+(r*l-s*a)*(c*v-h*g)}function hs(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],m=t[9],g=t[10],v=t[11],b=t[12],S=t[13],T=t[14],O=t[15];let C=i[0],M=i[1],I=i[2],$=i[3];return e[0]=C*r+M*a+I*p+$*b,e[1]=C*s+M*l+I*m+$*S,e[2]=C*n+M*c+I*g+$*T,e[3]=C*o+M*h+I*v+$*O,C=i[4],M=i[5],I=i[6],$=i[7],e[4]=C*r+M*a+I*p+$*b,e[5]=C*s+M*l+I*m+$*S,e[6]=C*n+M*c+I*g+$*T,e[7]=C*o+M*h+I*v+$*O,C=i[8],M=i[9],I=i[10],$=i[11],e[8]=C*r+M*a+I*p+$*b,e[9]=C*s+M*l+I*m+$*S,e[10]=C*n+M*c+I*g+$*T,e[11]=C*o+M*h+I*v+$*O,C=i[12],M=i[13],I=i[14],$=i[15],e[12]=C*r+M*a+I*p+$*b,e[13]=C*s+M*l+I*m+$*S,e[14]=C*n+M*c+I*g+$*T,e[15]=C*o+M*h+I*v+$*O,e}function hl(e,t,i){const r=i[0],s=i[1],n=i[2];if(t===e)e[12]=t[0]*r+t[4]*s+t[8]*n+t[12],e[13]=t[1]*r+t[5]*s+t[9]*n+t[13],e[14]=t[2]*r+t[6]*s+t[10]*n+t[14],e[15]=t[3]*r+t[7]*s+t[11]*n+t[15];else{const o=t[0],a=t[1],l=t[2],c=t[3],h=t[4],p=t[5],m=t[6],g=t[7],v=t[8],b=t[9],S=t[10],T=t[11];e[0]=o,e[1]=a,e[2]=l,e[3]=c,e[4]=h,e[5]=p,e[6]=m,e[7]=g,e[8]=v,e[9]=b,e[10]=S,e[11]=T,e[12]=o*r+h*s+v*n+t[12],e[13]=a*r+p*s+b*n+t[13],e[14]=l*r+m*s+S*n+t[14],e[15]=c*r+g*s+T*n+t[15]}return e}function rU(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Dc(e,t,i,r){let s,n,o,a,l,c,h,p,m,g,v,b,S,T,O,C,M,I,$,U,q,G,Y,J,X=r[0],ne=r[1],re=r[2],ye=Math.sqrt(X*X+ne*ne+re*re);return ye<Gt?null:(ye=1/ye,X*=ye,ne*=ye,re*=ye,s=Math.sin(i),n=Math.cos(i),o=1-n,a=t[0],l=t[1],c=t[2],h=t[3],p=t[4],m=t[5],g=t[6],v=t[7],b=t[8],S=t[9],T=t[10],O=t[11],C=X*X*o+n,M=ne*X*o+re*s,I=re*X*o-ne*s,$=X*ne*o-re*s,U=ne*ne*o+n,q=re*ne*o+X*s,G=X*re*o+ne*s,Y=ne*re*o-X*s,J=re*re*o+n,e[0]=a*C+p*M+b*I,e[1]=l*C+m*M+S*I,e[2]=c*C+g*M+T*I,e[3]=h*C+v*M+O*I,e[4]=a*$+p*U+b*q,e[5]=l*$+m*U+S*q,e[6]=c*$+g*U+T*q,e[7]=h*$+v*U+O*q,e[8]=a*G+p*Y+b*J,e[9]=l*G+m*Y+S*J,e[10]=c*G+g*Y+T*J,e[11]=h*G+v*Y+O*J,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function GE(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=t[9],p=t[10],m=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+c*r,e[5]=o*s+h*r,e[6]=a*s+p*r,e[7]=l*s+m*r,e[8]=c*s-n*r,e[9]=h*s-o*r,e[10]=p*s-a*r,e[11]=m*s-l*r,e}function sU(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],h=t[9],p=t[10],m=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-c*r,e[1]=o*s-h*r,e[2]=a*s-p*r,e[3]=l*s-m*r,e[8]=n*r+c*s,e[9]=o*r+h*s,e[10]=a*r+p*s,e[11]=l*r+m*s,e}function jE(e,t,i){const r=Math.sin(i),s=Math.cos(i),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],h=t[5],p=t[6],m=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+c*r,e[1]=o*s+h*r,e[2]=a*s+p*r,e[3]=l*s+m*r,e[4]=c*s-n*r,e[5]=h*s-o*r,e[6]=p*s-a*r,e[7]=m*s-l*r,e}function nU(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function zIe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ih(e,t,i){let r,s,n,o=i[0],a=i[1],l=i[2],c=Math.sqrt(o*o+a*a+l*l);return c<Gt?null:(c=1/c,o*=c,a*=c,l*=c,r=Math.sin(t),s=Math.cos(t),n=1-s,e[0]=o*o*n+s,e[1]=a*o*n+l*r,e[2]=l*o*n-a*r,e[3]=0,e[4]=o*a*n-l*r,e[5]=a*a*n+s,e[6]=l*a*n+o*r,e[7]=0,e[8]=o*l*n+a*r,e[9]=a*l*n-o*r,e[10]=l*l*n+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function ome(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function BIe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ame(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function lme(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=r+r,l=s+s,c=n+n,h=r*a,p=r*l,m=r*c,g=s*l,v=s*c,b=n*c,S=o*a,T=o*l,O=o*c;return e[0]=1-(g+b),e[1]=p+O,e[2]=m-T,e[3]=0,e[4]=p-O,e[5]=1-(h+b),e[6]=v+S,e[7]=0,e[8]=m+T,e[9]=v-S,e[10]=1-(h+g),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function VIe(e,t){const i=GIe,r=-t[0],s=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=r*r+s*s+n*n+o*o;return p>0?(i[0]=2*(a*o+h*r+l*n-c*s)/p,i[1]=2*(l*o+h*s+c*r-a*n)/p,i[2]=2*(c*o+h*n+a*s-l*r)/p):(i[0]=2*(a*o+h*r+l*n-c*s),i[1]=2*(l*o+h*s+c*r-a*n),i[2]=2*(c*o+h*n+a*s-l*r)),lme(e,t,i),e}const GIe=F();function jIe(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function cme(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10];return e[0]=Math.sqrt(i*i+r*r+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+h*h),e}function HIe(e,t){const i=t[0]+t[5]+t[10];let r=0;return i>0?(r=2*Math.sqrt(i+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function qIe(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3],l=s+s,c=n+n,h=o+o,p=s*l,m=s*c,g=s*h,v=n*c,b=n*h,S=o*h,T=a*l,O=a*c,C=a*h,M=r[0],I=r[1],$=r[2];return e[0]=(1-(v+S))*M,e[1]=(m+C)*M,e[2]=(g-O)*M,e[3]=0,e[4]=(m-C)*I,e[5]=(1-(p+S))*I,e[6]=(b+T)*I,e[7]=0,e[8]=(g+O)*$,e[9]=(b-T)*$,e[10]=(1-(p+v))*$,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function WIe(e,t,i,r,s){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,h=o+o,p=a+a,m=n*c,g=n*h,v=n*p,b=o*h,S=o*p,T=a*p,O=l*c,C=l*h,M=l*p,I=r[0],$=r[1],U=r[2],q=s[0],G=s[1],Y=s[2],J=(1-(b+T))*I,X=(g+M)*I,ne=(v-C)*I,re=(g-M)*$,ye=(1-(m+T))*$,pe=(S+O)*$,z=(v+C)*U,j=(S-O)*U,Q=(1-(m+b))*U;return e[0]=J,e[1]=X,e[2]=ne,e[3]=0,e[4]=re,e[5]=ye,e[6]=pe,e[7]=0,e[8]=z,e[9]=j,e[10]=Q,e[11]=0,e[12]=i[0]+q-(J*q+re*G+z*Y),e[13]=i[1]+G-(X*q+ye*G+j*Y),e[14]=i[2]+Y-(ne*q+pe*G+Q*Y),e[15]=1,e}function ZIe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,m=s*o,g=s*a,v=s*l,b=n*o,S=n*a,T=n*l;return e[0]=1-p-v,e[1]=h+T,e[2]=m-S,e[3]=0,e[4]=h-T,e[5]=1-c-v,e[6]=g+b,e[7]=0,e[8]=m+S,e[9]=g-b,e[10]=1-c-p,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ume(e,t,i,r,s,n,o){const a=1/(i-t),l=1/(s-r),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(i+t)*a,e[9]=(s+r)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function XIe(e,t,i,r,s){const n=1/Math.tan(t/2);let o;return e[0]=n/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}function YIe(e,t,i,r){const s=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(s+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(s-n)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function wX(e,t,i,r,s,n,o){const a=1/(t-i),l=1/(r-s),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*a,e[13]=(s+r)*l,e[14]=(o+n)*c,e[15]=1,e}function oU(e,t,i,r){let s,n,o,a,l,c,h,p,m,g;const v=t[0],b=t[1],S=t[2],T=r[0],O=r[1],C=r[2],M=i[0],I=i[1],$=i[2];return Math.abs(v-M)<Gt&&Math.abs(b-I)<Gt&&Math.abs(S-$)<Gt?Im(e):(h=v-M,p=b-I,m=S-$,g=1/Math.sqrt(h*h+p*p+m*m),h*=g,p*=g,m*=g,s=O*m-C*p,n=C*h-T*m,o=T*p-O*h,g=Math.sqrt(s*s+n*n+o*o),g?(g=1/g,s*=g,n*=g,o*=g):(s=0,n=0,o=0),a=p*o-m*n,l=m*s-h*o,c=h*n-p*s,g=Math.sqrt(a*a+l*l+c*c),g?(g=1/g,a*=g,l*=g,c*=g):(a=0,l=0,c=0),e[0]=s,e[1]=a,e[2]=h,e[3]=0,e[4]=n,e[5]=l,e[6]=p,e[7]=0,e[8]=o,e[9]=c,e[10]=m,e[11]=0,e[12]=-(s*v+n*b+o*S),e[13]=-(a*v+l*b+c*S),e[14]=-(h*v+p*b+m*S),e[15]=1,e)}function hme(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=r[0],l=r[1],c=r[2];let h=s-i[0],p=n-i[1],m=o-i[2],g=h*h+p*p+m*m;g>0&&(g=1/Math.sqrt(g),h*=g,p*=g,m*=g);let v=l*m-c*p,b=c*h-a*m,S=a*p-l*h;return g=v*v+b*b+S*S,g>0&&(g=1/Math.sqrt(g),v*=g,b*=g,S*=g),e[0]=v,e[1]=b,e[2]=S,e[3]=0,e[4]=p*S-m*b,e[5]=m*v-h*S,e[6]=h*b-p*v,e[7]=0,e[8]=h,e[9]=p,e[10]=m,e[11]=0,e[12]=s,e[13]=n,e[14]=o,e[15]=1,e}function QIe(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function JIe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function KIe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function dme(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function eLe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function tLe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function iLe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function pme(e,t){if(e===t)return!0;const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=e[9],m=e[10],g=e[11],v=e[12],b=e[13],S=e[14],T=e[15],O=t[0],C=t[1],M=t[2],I=t[3],$=t[4],U=t[5],q=t[6],G=t[7],Y=t[8],J=t[9],X=t[10],ne=t[11],re=t[12],ye=t[13],pe=t[14],z=t[15];return Math.abs(i-O)<=Gt*Math.max(1,Math.abs(i),Math.abs(O))&&Math.abs(r-C)<=Gt*Math.max(1,Math.abs(r),Math.abs(C))&&Math.abs(s-M)<=Gt*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(n-I)<=Gt*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(o-$)<=Gt*Math.max(1,Math.abs(o),Math.abs($))&&Math.abs(a-U)<=Gt*Math.max(1,Math.abs(a),Math.abs(U))&&Math.abs(l-q)<=Gt*Math.max(1,Math.abs(l),Math.abs(q))&&Math.abs(c-G)<=Gt*Math.max(1,Math.abs(c),Math.abs(G))&&Math.abs(h-Y)<=Gt*Math.max(1,Math.abs(h),Math.abs(Y))&&Math.abs(p-J)<=Gt*Math.max(1,Math.abs(p),Math.abs(J))&&Math.abs(m-X)<=Gt*Math.max(1,Math.abs(m),Math.abs(X))&&Math.abs(g-ne)<=Gt*Math.max(1,Math.abs(g),Math.abs(ne))&&Math.abs(v-re)<=Gt*Math.max(1,Math.abs(v),Math.abs(re))&&Math.abs(b-ye)<=Gt*Math.max(1,Math.abs(b),Math.abs(ye))&&Math.abs(S-pe)<=Gt*Math.max(1,Math.abs(S),Math.abs(pe))&&Math.abs(T-z)<=Gt*Math.max(1,Math.abs(T),Math.abs(z))}function xX(e){const t=Gt,i=e[0],r=e[1],s=e[2],n=e[4],o=e[5],a=e[6],l=e[8],c=e[9],h=e[10];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const rLe=hs,sLe=dme;Object.freeze(Object.defineProperty({__proto__:null,copy:js,set:Vm,identity:Im,transpose:Kl,invert:Fs,adjoint:kIe,determinant:UIe,multiply:hs,translate:hl,scale:rU,rotate:Dc,rotateX:GE,rotateY:sU,rotateZ:jE,fromTranslation:nU,fromScaling:zIe,fromRotation:ih,fromXRotation:ome,fromYRotation:BIe,fromZRotation:ame,fromRotationTranslation:lme,fromQuat2:VIe,getTranslation:jIe,getScaling:cme,getRotation:HIe,fromRotationTranslationScale:qIe,fromRotationTranslationScaleOrigin:WIe,fromQuat:ZIe,frustum:ume,perspective:XIe,perspectiveFromFieldOfView:YIe,ortho:wX,lookAt:oU,targetTo:hme,str:QIe,frob:JIe,add:KIe,subtract:dme,multiplyScalar:eLe,multiplyScalarAndAdd:tLe,exactEquals:iLe,equals:pme,isOrthoNormal:xX,mul:rLe,sub:sLe},Symbol.toStringTag,{value:"Module"}));let wV,ge=null;function fme(){return!!ge}function nLe(){return!!Ce("esri-wasm")}function mme(){return wV||(wV=_e(()=>import("./pe-wasm.41ba155b.js"),[],import.meta.url).then(e=>e.p).then(({default:e})=>e({locateFile:t=>tr(`esri/geometry/support/${t}`)})).then(e=>{yme(e)}),wV)}var J7,Ps,K7;(function(e){function t(n,o,a){ge.ensureCache.prepare();const l=Sw(a),c=a===l,h=ge.ensureFloat64(l),p=ge._pe_geog_to_proj(ge.getPointer(n),o,h);return p&&lv(a,o,h,c),p}function i(n,o,a,l){switch(l){case Ps.PE_TRANSFORM_P_TO_G:return r(n,o,a);case Ps.PE_TRANSFORM_G_TO_P:return t(n,o,a)}return 0}function r(n,o,a){return s(n,o,a,0)}function s(n,o,a,l){ge.ensureCache.prepare();const c=Sw(a),h=a===c,p=ge.ensureFloat64(c),m=ge._pe_proj_to_geog_center(ge.getPointer(n),o,p,l);return m&&lv(a,o,p,h),m}e.geogToProj=t,e.projGeog=i,e.projToGeog=r,e.projToGeogCenter=s})(J7||(J7={})),function(e){function t(){e.PE_BUFFER_MAX=ge.PeDefs.prototype.PE_BUFFER_MAX,e.PE_NAME_MAX=ge.PeDefs.prototype.PE_NAME_MAX,e.PE_MGRS_MAX=ge.PeDefs.prototype.PE_MGRS_MAX,e.PE_USNG_MAX=ge.PeDefs.prototype.PE_USNG_MAX,e.PE_DD_MAX=ge.PeDefs.prototype.PE_DD_MAX,e.PE_DDM_MAX=ge.PeDefs.prototype.PE_DDM_MAX,e.PE_DMS_MAX=ge.PeDefs.prototype.PE_DMS_MAX,e.PE_UTM_MAX=ge.PeDefs.prototype.PE_UTM_MAX,e.PE_PARM_MAX=ge.PeDefs.prototype.PE_PARM_MAX,e.PE_TYPE_NONE=ge.PeDefs.prototype.PE_TYPE_NONE,e.PE_TYPE_GEOGCS=ge.PeDefs.prototype.PE_TYPE_GEOGCS,e.PE_TYPE_PROJCS=ge.PeDefs.prototype.PE_TYPE_PROJCS,e.PE_TYPE_GEOGTRAN=ge.PeDefs.prototype.PE_TYPE_GEOGTRAN,e.PE_TYPE_COORDSYS=ge.PeDefs.prototype.PE_TYPE_COORDSYS,e.PE_TYPE_UNIT=ge.PeDefs.prototype.PE_TYPE_UNIT,e.PE_TYPE_LINUNIT=ge.PeDefs.prototype.PE_TYPE_LINUNIT,e.PE_STR_OPTS_NONE=ge.PeDefs.prototype.PE_STR_OPTS_NONE,e.PE_STR_AUTH_NONE=ge.PeDefs.prototype.PE_STR_AUTH_NONE,e.PE_STR_AUTH_TOP=ge.PeDefs.prototype.PE_STR_AUTH_TOP,e.PE_STR_NAME_CANON=ge.PeDefs.prototype.PE_STR_NAME_CANON,e.PE_PARM_X0=ge.PeDefs.prototype.PE_PARM_X0,e.PE_PARM_ND=ge.PeDefs.prototype.PE_PARM_ND,e.PE_TRANSFORM_1_TO_2=ge.PeDefs.prototype.PE_TRANSFORM_1_TO_2,e.PE_TRANSFORM_2_TO_1=ge.PeDefs.prototype.PE_TRANSFORM_2_TO_1,e.PE_TRANSFORM_P_TO_G=ge.PeDefs.prototype.PE_TRANSFORM_P_TO_G,e.PE_TRANSFORM_G_TO_P=ge.PeDefs.prototype.PE_TRANSFORM_G_TO_P,e.PE_HORIZON_RECT=ge.PeDefs.prototype.PE_HORIZON_RECT,e.PE_HORIZON_POLY=ge.PeDefs.prototype.PE_HORIZON_POLY,e.PE_HORIZON_LINE=ge.PeDefs.prototype.PE_HORIZON_LINE,e.PE_HORIZON_DELTA=ge.PeDefs.prototype.PE_HORIZON_DELTA}e.init=t}(Ps||(Ps={})),function(e){const t={},i={},r=g=>{if(g){const v=g.getType();switch(v){case Ps.PE_TYPE_GEOGCS:g=ge.castObject(g,ge.PeGeogcs);break;case Ps.PE_TYPE_PROJCS:g=ge.castObject(g,ge.PeProjcs);break;case Ps.PE_TYPE_GEOGTRAN:g=ge.castObject(g,ge.PeGeogtran);break;default:v&Ps.PE_TYPE_UNIT&&(g=ge.castObject(g,ge.PeUnit))}}return g};function s(){ge.PeFactory.prototype.initialize(null)}function n(g){return o(Ps.PE_TYPE_COORDSYS,g)}function o(g,v){let b=null,S=t[g];if(S||(S={},t[g]=S),S.hasOwnProperty(String(v)))b=S[v];else{const T=ge.PeFactory.prototype.factoryByType(g,v);ge.compare(T,ge.NULL)||(b=T,S[v]=b)}return b=r(b),b}function a(g,v){let b=null,S=i[g];if(S||(S={},i[g]=S),S.hasOwnProperty(v))b=S[v];else{const T=ge.PeFactory.prototype.fromString(g,v);ge.compare(T,ge.NULL)||(b=T,S[v]=b)}return b=r(b),b}function l(g){return o(Ps.PE_TYPE_GEOGCS,g)}function c(g){return o(Ps.PE_TYPE_GEOGTRAN,g)}function h(g){return ge.PeFactory.prototype.getCode(g)}function p(g){return o(Ps.PE_TYPE_PROJCS,g)}function m(g){return o(Ps.PE_TYPE_UNIT,g)}e.initialize=s,e.coordsys=n,e.factoryByType=o,e.fromString=a,e.geogcs=l,e.geogtran=c,e.getCode=h,e.projcs=p,e.unit=m}(K7||(K7={}));let gme=null;var N4,ej,tj,ij,F4,rj,k4,U4,sj;function yme(e){function t(n,o,a){n[o]=a(n[o])}ge=e,Ps.init(),N4.init(),F4.init(),k4.init(),U4.init(),gme=class extends ge.PeGCSExtent{destroy(){ge.destroy(this)}};const i=[ge.PeDatum,ge.PeGeogcs,ge.PeGeogtran,ge.PeObject,ge.PeParameter,ge.PePrimem,ge.PeProjcs,ge.PeSpheroid,ge.PeUnit];for(const n of i)t(n.prototype,"getName",o=>function(){return o.call(this,new Array(Ps.PE_NAME_MAX))});for(const n of[ge.PeGeogtran,ge.PeProjcs])t(n.prototype,"getParameters",o=>function(){const a=new Array(Ps.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const h=ge.getValue(l,"*");a[c]=h?ge.wrapPointer(h,ge.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});t(ge.PeHorizon.prototype,"getCoord",n=>function(){const o=this.getSize();if(!o)return null;const a=[];return lv(a,o,n.call(this)),a}),t(ge.PeGTlistExtendedEntry.prototype,"getEntries",n=>{const o=ge._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=n.call(this);if(!ge.compare(l,ge.NULL)){a=[l];const c=this.getSteps();if(c>1){const h=ge.getPointer(l);for(let p=1;p<c;p++)a.push(ge.wrapPointer(h+o*p,ge.PeGTlistExtendedGTs))}}return a}});const r=ge._pe_getPeHorizonSize(),s=n=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(n))return o.get(n);let a=null;const l=n.call(this);if(!ge.compare(l,ge.NULL)){a=[l];const c=l.getNump();if(c>1){const h=ge.getPointer(l);for(let p=1;p<c;p++)a.push(ge.wrapPointer(h+r*p,ge.PeHorizon))}}return o.set(n,a),a};t(ge.PeProjcs.prototype,"horizonGcsGenerate",s),t(ge.PeProjcs.prototype,"horizonPcsGenerate",s),ge.PeObject.prototype.toString=function(n=Ps.PE_STR_OPTS_NONE){ge.ensureCache.prepare();const o=ge.getPointer(this),a=ge.ensureInt8(new Array(Ps.PE_BUFFER_MAX));return ge.UTF8ToString(ge._pe_object_to_string_ext(o,n,a))}}function fg(e){if(!e)return;const t=ge.getClass(e);if(!t)return;const i=ge.getCache(t);if(!i)return;const r=ge.getPointer(e);r&&delete i[r]}function SL(e,t){const i=[],r=new Array(t);for(let s=0;s<e;s++)i.push(ge.ensureInt8(r));return i}function Sw(e){let t;return Array.isArray(e[0])?(t=[],e.forEach(i=>{t.push(i[0],i[1])})):t=e,t}function lv(e,t,i,r=!1){if(r)for(let s=0;s<2*t;s++)e[s]=ge.getValue(i+s*Float64Array.BYTES_PER_ELEMENT,"double");else{const s=e.length===0;for(let n=0;n<t;n++)s&&(e[n]=new Array(2)),e[n][0]=ge.getValue(i,"double"),e[n][1]=ge.getValue(i+Float64Array.BYTES_PER_ELEMENT,"double"),i+=2*Float64Array.BYTES_PER_ELEMENT}}(function(e){let t;function i(){e.PE_GTLIST_OPTS_COMMON=ge.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,t=ge._pe_getPeGTlistExtendedEntrySize()}function r(s,n,o,a,l,c){let h=null;const p=new ge.PeInteger(c);try{const m=ge.PeGTlistExtended.prototype.getGTlist(s,n,o,a,l,p);if((c=p.val)&&(h=[m],c>1)){const g=ge.getPointer(m);for(let v=1;v<c;v++)h.push(ge.wrapPointer(g+t*v,ge.PeGTlistExtendedEntry))}}finally{ge.destroy(p)}return h}e.init=i,e.getGTlist=r})(N4||(N4={})),function(e){function t(i){if(i&&i.length){for(const r of i)fg(r),r.getEntries().forEach(s=>{fg(s);const n=s.getGeogtran();fg(n),n.getParameters().forEach(fg),[n.getGeogcs1(),n.getGeogcs2()].forEach(o=>{fg(o);const a=o.getDatum();fg(a),fg(a.getSpheroid()),fg(o.getPrimem()),fg(o.getUnit())})});ge.PeGTlistExtendedEntry.prototype.Delete(i[0])}}e.destroy=t}(ej||(ej={})),function(e){function t(i,r,s,n,o){ge.ensureCache.prepare();const a=Sw(s),l=s===a,c=ge.ensureFloat64(a);let h=0;n&&(h=ge.ensureFloat64(n));const p=ge._pe_geog_to_geog(ge.getPointer(i),r,c,h,o);return p&&lv(s,r,c,l),p}e.geogToGeog=t}(tj||(tj={})),function(e){const t=(c,h,p,m,g,v)=>{let b,S;switch(ge.ensureCache.prepare(),c){case"dd":b=ge._pe_geog_to_dd,S=Ps.PE_DD_MAX;break;case"ddm":b=ge._pe_geog_to_ddm,S=Ps.PE_DDM_MAX;break;case"dms":b=ge._pe_geog_to_dms,S=Ps.PE_DMS_MAX}let T=0;h&&(T=ge.getPointer(h));const O=Sw(m),C=ge.ensureFloat64(O),M=SL(p,S),I=b(T,p,C,g,ge.ensureInt32(M));if(I)for(let $=0;$<p;$++)v[$]=ge.UTF8ToString(M[$]);return I},i=(c,h,p,m,g)=>{let v;switch(ge.ensureCache.prepare(),c){case"dd":v=ge._pe_dd_to_geog;break;case"ddm":v=ge._pe_ddm_to_geog;break;case"dms":v=ge._pe_dms_to_geog}let b=0;h&&(b=ge.getPointer(h));const S=m.map(M=>ge.ensureString(M)),T=ge.ensureInt32(S),O=ge.ensureFloat64(new Array(2*p)),C=v(b,p,T,O);return C&&lv(g,p,O),C};function r(c,h,p,m,g){return t("dms",c,h,p,m,g)}function s(c,h,p,m){return i("dms",c,h,p,m)}function n(c,h,p,m,g){return t("ddm",c,h,p,m,g)}function o(c,h,p,m){return i("ddm",c,h,p,m)}function a(c,h,p,m,g){return t("dd",c,h,p,m,g)}function l(c,h,p,m){return i("dd",c,h,p,m)}e.geogToDms=r,e.dmsToGeog=s,e.geogToDdm=n,e.ddmToGeog=o,e.geogToDd=a,e.ddToGeog=l}(ij||(ij={})),function(e){function t(){e.PE_MGRS_STYLE_NEW=ge.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,e.PE_MGRS_STYLE_OLD=ge.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,e.PE_MGRS_STYLE_AUTO=ge.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,e.PE_MGRS_180_ZONE_1_PLUS=ge.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,e.PE_MGRS_ADD_SPACES=ge.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function i(s,n,o,a,l,c,h){ge.ensureCache.prepare();let p=0;s&&(p=ge.getPointer(s));const m=Sw(o),g=ge.ensureFloat64(m),v=SL(n,Ps.PE_MGRS_MAX),b=ge.ensureInt32(v),S=ge._pe_geog_to_mgrs_extended(p,n,g,a,l,c,b);if(S)for(let T=0;T<n;T++)h[T]=ge.UTF8ToString(v[T]);return S}function r(s,n,o,a,l){ge.ensureCache.prepare();let c=0;s&&(c=ge.getPointer(s));const h=o.map(v=>ge.ensureString(v)),p=ge.ensureInt32(h),m=ge.ensureFloat64(new Array(2*n)),g=ge._pe_mgrs_to_geog_extended(c,n,p,a,m);return g&&lv(l,n,m),g}e.init=t,e.geogToMgrsExtended=i,e.mgrsToGeogExtended=r}(F4||(F4={})),function(e){function t(r,s,n,o,a,l,c){ge.ensureCache.prepare();let h=0;r&&(h=ge.getPointer(r));const p=Sw(n),m=ge.ensureFloat64(p),g=SL(s,Ps.PE_MGRS_MAX),v=ge.ensureInt32(g),b=ge._pe_geog_to_usng(h,s,m,o,a,l,v);if(b)for(let S=0;S<s;S++)c[S]=ge.UTF8ToString(g[S]);return b}function i(r,s,n,o){ge.ensureCache.prepare();let a=0;r&&(a=ge.getPointer(r));const l=n.map(m=>ge.ensureString(m)),c=ge.ensureInt32(l),h=ge.ensureFloat64(new Array(2*s)),p=ge._pe_usng_to_geog(a,s,c,h);return p&&lv(o,s,h),p}e.geogToUsng=t,e.usngToGeog=i}(rj||(rj={})),function(e){function t(){e.PE_UTM_OPTS_NONE=ge.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,e.PE_UTM_OPTS_ADD_SPACES=ge.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,e.PE_UTM_OPTS_NS=ge.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function i(s,n,o,a,l){ge.ensureCache.prepare();let c=0;s&&(c=ge.getPointer(s));const h=Sw(o),p=ge.ensureFloat64(h),m=SL(n,Ps.PE_UTM_MAX),g=ge.ensureInt32(m),v=ge._pe_geog_to_utm(c,n,p,a,g);if(v)for(let b=0;b<n;b++)l[b]=ge.UTF8ToString(m[b]);return v}function r(s,n,o,a,l){ge.ensureCache.prepare();let c=0;s&&(c=ge.getPointer(s));const h=o.map(v=>ge.ensureString(v)),p=ge.ensureInt32(h),m=ge.ensureFloat64(new Array(2*n)),g=ge._pe_utm_to_geog(c,n,p,a,m);return g&&lv(l,n,m),g}e.init=t,e.geogToUtm=i,e.utmToGeog=r}(k4||(k4={})),function(e){const t=new Map;function i(){e.PE_PCSINFO_OPTION_NONE=ge.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,e.PE_PCSINFO_OPTION_DOMAIN=ge.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,e.PE_POLE_OUTSIDE_BOUNDARY=ge.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,e.PE_POLE_POINT=ge.PePCSInfo.prototype.PE_POLE_POINT}function r(s,n=e.PE_PCSINFO_OPTION_DOMAIN){let o,a;return t.has(s)&&(a=t.get(s),a[n]&&(o=a[n])),o||(o=ge.PePCSInfo.prototype.generate(s,n),a||(a=[],t.set(s,a)),a[n]=o),o}e.init=i,e.generate=r}(U4||(U4={})),function(e){function t(){return ge.PeVersion.prototype.version_string()}e.versionString=t}(sj||(sj={}));const oLe=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return ge},isLoaded:fme,isSupported:nLe,load:mme,get PeCSTransformations(){return J7},get PeDefs(){return Ps},get PeFactory(){return K7},get PeGCSExtent(){return gme},get PeGTlistExtended(){return N4},get PeGTlistExtendedEntry(){return ej},get PeGTTransformations(){return tj},get PeNotationDms(){return ij},get PeNotationMgrs(){return F4},get PeNotationUsng(){return rj},get PeNotationUtm(){return k4},get PePCSInfo(){return U4},get PeVersion(){return sj},_init:yme},Symbol.toStringTag,{value:"Module"})),$vt=Math.PI/180,Dvt=/SPHEROID\[([^\]]+)]/i,k0=Qi.radius,Fd=Qi.eccentricitySquared,aLe={a1:k0*Fd,a2:k0*Fd*k0*Fd,a3:k0*Fd*Fd/2,a4:k0*Fd*k0*Fd*2.5,a5:k0*Fd+k0*Fd*Fd/2,a6:1-Fd},Nvt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Qi.radius,f:Qi.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:By.radius,f:By.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:ym.radius,f:ym.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:ym.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let EL=0;class oE{constructor(t=null){this.uid=EL++,t?(this._wkt=t.wkt!==void 0?t.wkt:null,this._wkid=t.wkid!==void 0?t.wkid:-1,this._isInverse=t.isInverse!==void 0&&t.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(t){const i=new oE;return i._wkt=t.wkt,i._wkid=t.wkid,i._isInverse=t.isInverse,i}get wkt(){return this._wkt}set wkt(t){this._wkt=t,this.uid=EL++}get wkid(){return this._wkid}set wkid(t){this._wkid=t,this.uid=EL++}get isInverse(){return this._isInverse}set isInverse(t){this._isInverse=t,this.uid=EL++}getInverse(){const t=new oE;return t._wkt=this.wkt,t._wkid=this._wkid,t._isInverse=!this.isInverse,t}}class xv{constructor(t){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,t&&t.steps)for(const i of t.steps)i instanceof oE?this.steps.push(i):this.steps.push(new oE({wkid:i.wkid,wkt:i.wkt,isInverse:i.isInverse}))}static cacheKey(t,i){return[t.wkid!==void 0&&t.wkid!==null?t.wkid.toString():"-1",t.wkt!==void 0&&t.wkt!==null?t.wkt.toString():"",i.wkid!==void 0&&i.wkid!==null?i.wkid.toString():"-1",i.wkt!==void 0&&i.wkt!==null?i.wkt.toString():""].join(",")}static fromGE(t){const i=new xv;let r="";for(const s of t.steps){const n=oE.fromGE(s);i.steps.push(n),r+=n.uid.toString()+","}return i._cached_projection={},i._gtlistentry=null,i._chain=r,i}getInverse(){const t=new xv;t.steps=[];for(let i=this.steps.length-1;i>=0;i--){const r=this.steps[i];t.steps.push(r.getInverse())}return t}getGTListEntry(){let t="";for(const i of this.steps)t+=i.uid.toString()+",";return t!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=t),this._gtlistentry}assignCachedGe(t,i,r){this._cached_projection[xv.cacheKey(t,i)]=r}getCachedGeTransformation(t,i){let r="";for(const n of this.steps)r+=n.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);const s=this._cached_projection[xv.cacheKey(t,i)];return s===void 0?null:s}}function _me(e,t,i){if(N(t)||N(i)||i.vcsWkid||qc(t,i))return null;const r=VE(t)/VE(i);if(r===1)return null;switch(e){case"point":case"esriGeometryPoint":return s=>lLe(s,r);case"polyline":case"esriGeometryPolyline":return s=>uLe(s,r);case"polygon":case"esriGeometryPolygon":return s=>cLe(s,r);case"multipoint":case"esriGeometryMultipoint":return s=>hLe(s,r);case"extent":case"esriGeometryExtent":return s=>dLe(s,r);default:return null}}function lLe(e,t){e&&e.z!=null&&(e.z*=t)}function cLe(e,t){if(e)for(const i of e.rings)for(const r of i)r.length>2&&(r[2]*=t)}function uLe(e,t){if(e)for(const i of e.paths)for(const r of i)r.length>2&&(r[2]*=t)}function hLe(e,t){if(e)for(const i of e.points)i.length>2&&(i[2]*=t)}function dLe(e,t){e&&e.zmin!=null&&e.zmax!=null&&(e.zmin*=t,e.zmax*=t)}let zv=null,z4=null,xV=null,TV={};const vme=new rpe;function TX(){return!!zv&&fme()}function B4(e){return N(xV)&&(xV=Promise.all([mme(),_e(()=>import("./geometryEngineBase.cf4f989f.js"),[],import.meta.url).then(t=>t.g),_e(()=>import("./hydrated.2565c3a9.js"),[],import.meta.url)])),xV.then(([,t,{hydratedAdapter:i}])=>{Ui(e),z4=i,zv=t.default,zv._enableProjection(oLe),vme.notify()})}function Z3(e,t,i=null,r=null){return Array.isArray(e)?e.length===0?[]:Jee(z4,e,e[0].spatialReference,t,i,r):Jee(z4,[e],e.spatialReference,t,i,r)[0]}function Jee(e,t,i,r,s=null,n=null){if(N(i)||N(r))return t;if(t1(i,r,s))return t.map(o=>bme(o,i,r));if(N(s)){const o=xv.cacheKey(i,r);TV[o]!==void 0?s=TV[o]:(s=pLe(i,r,null),N(s)&&(s=new xv),TV[o]=s)}if(N(zv))throw new SX;return w(n)?zv._project(e,t,i,r,s,n):zv._project(e,t,i,r,s)}function Fvt(e,t){return N(e)?{pending:null,geometry:null}:qc(e.spatialReference,t)?{pending:null,geometry:e}:Xl(e.spatialReference)&&Xl(t)?t1(e.spatialReference,t)||TX()?{pending:null,geometry:fLe(e,t)}:(_i(vme),{pending:B4(),geometry:null}):{pending:null,geometry:null}}function pLe(e,t,i=null){if(N(zv))throw new SX;if(N(e)||N(t))return null;const r=zv._getTransformation(z4,e,t,i,i==null?void 0:i.spatialReference);return r!==null?xv.fromGE(r):null}class SX extends se{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var ce;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",e[e.WGS84=2]="WGS84",e[e.WEB_MERCATOR=3]="WEB_MERCATOR",e[e.WGS84_ECEF=4]="WGS84_ECEF",e[e.CGCS2000=5]="CGCS2000",e[e.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",e[e.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",e[e.GCSMARS2000=8]="GCSMARS2000",e[e.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",e[e.GCSMOON2000=10]="GCSMOON2000",e[e.LON_LAT=11]="LON_LAT",e[e.PLATE_CARREE=12]="PLATE_CARREE"})(ce||(ce={}));function fLe(e,t){try{const i=Z3(e,t);if(i==null)return null;"xmin"in e&&"xmin"in i&&(i.zmin=e.zmin,i.zmax=e.zmax);const r=_me(i.type,e.spatialReference,t);return w(r)&&r(i),i}catch(i){if(!(i instanceof SX))throw i;return null}}function t1(e,t,i){return!i&&(!!qc(e,t)||Xl(e)&&Xl(t)&&!!OX(e,t,MX))}async function kvt(e,t,i,r){if(TX())return GK(r);if(Array.isArray(e)){for(const{source:s,dest:n,geographicTransformation:o}of e)if(!t1(s,n,o))return B4(r)}else if(!t1(e,t,i))return B4(r);return GK(r)}function Uvt(e,t){switch(OX(e,t,MX)){case zr:return"copy3";case Sv:return"wgs84ToSphericalECEF";case Lx:return"wgs84ToWebMercator";case Tv:return"wgs84ToPlateCarree";case Cv:return"wgs84ToWGS84ECEF";case cx:return"webMercatorToWGS84";case Cme:return"webMercatorToSphericalECEF";case Ame:return"webMercatorToWGS84ECEF";case Ome:return"webMercatorToPlateCarree";case Av:return"wgs84ECEFToWGS84";case Pme:return"wgs84ECEFToSphericalECEF";case Ime:return"wgs84ECEFToWebMercator";case Ev:return"sphericalECEFToWGS84";case Rme:return"sphericalECEFToWebMercator";case lj:return"sphericalMarsPCPFToMars2000";case aj:return"sphericalMoonPCPFToMoon2000";case Mme:return"sphericalECEFToWGS84ECEF";case oj:return"mars2000ToSphericalPCPF";case nj:return"moon2000ToSphericalPCPF";default:return null}}function bme(e,t,i){return e?"x"in e?wme(e,t,new xt,i,0):"xmin"in e?_Le(e,t,new zi,i,0):"rings"in e?xme(e,t,new Ku,i,0):"paths"in e?yLe(e,t,new Bu,i,0):"points"in e?gLe(e,t,new lT,i,0):null:null}function mLe(e,t,i=t.spatialReference,r=0){return!N(i)&&w(wme(e,e.spatialReference,t,i,r))}function wme(e,t,i,r,s){lr[0]=e.x,lr[1]=e.y;const n=e.z;return lr[2]=n!==void 0?n:s,Lr(lr,t,0,lr,r,0,1)?(i.x=lr[0],i.y=lr[1],i.spatialReference=r,n===void 0?(i.z=void 0,i.hasZ=!1):(i.z=lr[2],i.hasZ=!0),e.m===void 0?(i.m=void 0,i.hasM=!1):(i.m=e.m,i.hasM=!0),i):null}function gLe(e,t,i,r,s){const{points:n,hasZ:o,hasM:a}=e,l=[],c=n.length,h=[];for(const p of n)h.push(p[0],p[1],o?p[2]:s);if(!Lr(h,t,0,h,r,0,c))return null;for(let p=0;p<c;++p){const m=3*p,g=h[m],v=h[m+1];o&&a?l.push([g,v,h[m+2],n[p][3]]):o?l.push([g,v,h[m+2]]):a?l.push([g,v,n[p][2]]):l.push([g,v])}return i.points=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i}function yLe(e,t,i,r,s){const{paths:n,hasZ:o,hasM:a}=e,l=[];return Sme(n,o,a,t,l,r,s)?(i.paths=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function zvt(e,t,i=t.spatialReference,r=0){return w(i)&&w(xme(e,e.spatialReference,t,i,r))}function xme(e,t,i,r,s){const{rings:n,hasZ:o,hasM:a}=e,l=[];return Sme(n,o,a,t,l,r,s)?(i.rings=l,i.spatialReference=r,i.hasZ=o,i.hasM=a,i):null}function _Le(e,t,i,r,s){const{xmin:n,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:h}=e;return Kee(n,o,c?e.zmin:s,t,lr,r)?(i.xmin=lr[0],i.ymin=lr[1],c&&(i.zmin=lr[2]),Kee(a,l,c?e.zmax:s,t,lr,r)?(i.xmax=lr[0],i.ymax=lr[1],c&&(i.zmax=lr[2]),h&&(i.mmin=e.mmin,i.mmax=e.mmax),i.spatialReference=r,i):null):null}function i1(e,t,i){if(N(t)||N(i))return null;const r=new xt({spatialReference:i});return Lr(e,t,0,lr,i,0,1)?(r.x=lr[0],r.y=lr[1],r.z=lr[2],r):null}function Tme(e,t,i){return Lr(e,t,0,lr,i.spatialReference,0,1)?(i.x=lr[0],i.y=lr[1],i.z=lr[2],i):null}function po(e,t,i,r=0){lr[0]=e.x,lr[1]=e.y;const s=e.z;return lr[2]=s!==void 0?s:r,Lr(lr,e.spatialReference,0,t,i,0,1)}function Kee(e,t,i,r,s,n){return gs[0]=e,gs[1]=t,gs[2]=i,Lr(gs,r,0,s,n,0,1)}function $n(e,t,i,r){return!(N(t)||N(r)||e.length<2)&&(e.length===2&&(gs[0]=e[0],gs[1]=e[1],gs[2]=0,e=gs),Lr(e,t,0,i,r,0,1))}function vLe(e,t){lr[0]=e.x,lr[1]=e.y;const i=e.z;return lr[2]=i!==void 0?i:0,bLe(lr,e.spatialReference,t)}function bLe(e,t,i){return wLe(e,t,i)}function wLe(e,t,i){if(N(t))return!1;const r=r1(t,lU),s=fm[r][ce.WGS84_COMPARABLE_LON_LAT];return!N(s)&&(s(e,0,gs,0),i!==gs&&(i[0]=gs[0],i[1]=gs[1],i.length>2&&(i[2]=gs[2])),!0)}function Lr(e,t,i,r,s,n,o=1){const a=OX(t,s,MX);if(N(a))return!1;if(a===zr){if(e===r&&i===n)return!0;const c=i+3*o;for(let h=i,p=n;h<c;h++,p++)r[p]=e[h];return!0}const l=i+3*o;for(let c=i,h=n;c<l;c+=3,h+=3)a(e,c,r,h);return!0}function Bvt(e,t,i,r,s){ve(lr,e),Oe(CL,e,t),$n(lr,i,lr,s),$n(CL,i,CL,s),Me(r,CL,lr),De(r,r)}function Sme(e,t,i,r,s,n,o=0){const a=new Array;for(const c of e)for(const h of c)a.push(h[0],h[1],t?h[2]:o);if(!Lr(a,r,0,a,n,0,a.length/3))return!1;let l=0;s.length=0;for(const c of e){const h=new Array;for(const p of c)t&&i?h.push([a[l++],a[l++],a[l++],p[3]]):t?h.push([a[l++],a[l++],a[l++]]):i?(h.push([a[l++],a[l++],p[2]]),l++):(h.push([a[l++],a[l++]]),l++);s.push(h)}return!0}function xLe(e,t,i,r){if(N(t)||N(r))return!1;const s=Lme(t,r,MLe);if(s.projector===zr)return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],!0;if(N(s.projector))return!1;const{source:n,dest:o}=s;if(o.spatialReferenceId===ce.WEB_MERCATOR){const a=fm[n.spatialReferenceId][ce.WGS84];return!N(a)&&(a(e,0,dp,0),Lx(dp,0,i,0),i[3]=ete(dp[1],e[2],e[3],Qi.radius),!0)}if(n.spatialReferenceId!==ce.WGS84&&n.spatialReferenceId!==ce.CGCS2000||o.spatialReferenceId!==ce.PLATE_CARREE)s.projector(e,0,i,0),i[3]=e[3]*n.metersPerUnit/o.metersPerUnit;else{const a=fm[n.spatialReferenceId][ce.SPHERICAL_ECEF],l=fm[ce.SPHERICAL_ECEF][ce.PLATE_CARREE];let c=e[3];w(a)&&w(l)&&(c=ete(e[1],e[2],e[3],Qi.radius)),s.projector(e,0,i,0),i[3]=c}return!0}function ete(e,t,i,r){const s=r+t;if(s<r/2||i>s)return Number.MAX_VALUE;const n=Math.abs(Pp*e)+Math.asin(i/s);return n>=Math.PI/2?Number.MAX_VALUE:i/Math.cos(n)}function aU(e,t,i,r){return e!=null&&(qc(t,r)?(Gy(i,e),!0):(gs[0]=e[0],gs[1]=e[1],gs[2]=0,!!Lr(gs,t,0,gs,r,0,1)&&(i[0]=gs[0],i[1]=gs[1],gs[0]=e[2],gs[1]=e[3],gs[2]=0,!!Lr(gs,t,0,gs,r,0,1)&&(i[2]=gs[0],i[3]=gs[1],!0))))}function Vvt(e,t,i,r){if(N(t)||N(r))return!1;const s=r1(t,lU),n=r1(r,$me);if(s===n&&s!==ce.UNKNOWN||qc(t,r))return i[0]=1,i[1]=1,i[2]=1,!0;if(s===ce.SPHERICAL_ECEF){const o=He(e),a=o/Math.sqrt(e[0]*e[0]+e[1]*e[1]),l=o/Qi.radius;if(n===ce.WEB_MERCATOR)return i[0]=a*l,i[1]=a*l,i[2]=1,!0;if(n===ce.WGS84||n===ce.CGCS2000){const c=TM;return i[0]=c*a*l,i[1]=c*l,i[2]=1,!0}}else if(s===ce.PLATE_CARREE){if(n===ce.WGS84||n===ce.CGCS2000)return i[0]=TM,i[1]=TM,i[2]=1,!0;if(n===ce.WEB_MERCATOR){const o=e[1]/Qi.radius;return i[0]=1,i[1]=1/Math.cos(o),i[2]=1,!0}}return!1}function rh(e,t,i,r){if(N(e)||N(r))return!1;const s=r1(e,lU),n=r1(r,$me);if(s===n&&!tte(n)&&(s!==ce.UNKNOWN||qc(e,r)))return nU(i,t),!0;if(tte(n)){const o=fm[s][ce.LON_LAT],a=fm[ce.LON_LAT][n];return!N(o)&&!N(a)&&(o(t,0,dp,0),a(dp,0,U0,0),Eme(Pp*dp[0],Pp*dp[1],i),i[12]=U0[0],i[13]=U0[1],i[14]=U0[2],!0)}if((n===ce.WEB_MERCATOR||n===ce.PLATE_CARREE)&&(s===ce.WGS84||s===ce.CGCS2000&&n===ce.PLATE_CARREE||s===ce.SPHERICAL_ECEF||s===ce.WEB_MERCATOR)){const o=fm[s][ce.LON_LAT],a=fm[ce.LON_LAT][n];return!N(o)&&!N(a)&&(o(t,0,dp,0),a(dp,0,U0,0),s===ce.SPHERICAL_ECEF?TLe(Pp*dp[0],Pp*dp[1],i):Im(i),i[12]=U0[0],i[13]=U0[1],i[14]=U0[2],!0)}return!1}function tte(e){return e===ce.SPHERICAL_ECEF||e===ce.SPHERICAL_MARS_PCPF||e===ce.SPHERICAL_MOON_PCPF}function Eme(e,t,i){const r=Math.sin(e),s=Math.cos(e),n=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-n*s,a[8]=o*s,a[12]=0,a[1]=s,a[5]=-n*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=n,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function TLe(e,t,i){return Eme(e,t,i),Kl(i,i),i}function r1(e,t){return t.spatialReference===e?t.spatialReferenceId:(t.spatialReference=e,"metersPerUnit"in t&&(t.metersPerUnit=Zc(e,1)),e.wkt===Xfe.wkt?t.spatialReferenceId=ce.SPHERICAL_ECEF:hP(e)?t.spatialReferenceId=ce.WGS84:Sx(e)?t.spatialReferenceId=ce.WEB_MERCATOR:dP(e)?t.spatialReferenceId=ce.PLATE_CARREE:e.wkt===yIe.wkt?t.spatialReferenceId=ce.WGS84_ECEF:e.wkid===nd.CGCS2000?t.spatialReferenceId=ce.CGCS2000:e.wkt===L4.wkt?t.spatialReferenceId=ce.SPHERICAL_MARS_PCPF:e.wkt===$4.wkt?t.spatialReferenceId=ce.SPHERICAL_MOON_PCPF:km(e)?t.spatialReferenceId=ce.GCSMARS2000:Um(e)?t.spatialReferenceId=ce.GCSMOON2000:t.spatialReferenceId=ce.UNKNOWN)}function zr(e,t,i,r){e!==i&&(i[r++]=e[t++],i[r++]=e[t++],i[r]=e[t])}function cx(e,t,i,r){i[r++]=HE*(e[t++]/Qi.radius),i[r++]=HE*(Math.PI/2-2*Math.atan(Math.exp(-e[t++]/Qi.radius))),i[r]=e[t]}function Cme(e,t,i,r){cx(e,t,i,r),Sv(i,r,i,r)}function Ame(e,t,i,r){cx(e,t,i,r),Cv(i,r,i,r)}function EX(e,t,i,r,s){const n=.4999999*Math.PI,o=Xe(Pp*e[t+1],-n,n),a=Math.sin(o);i[r++]=Pp*e[t]*s.radius,i[r++]=s.halfSemiMajorAxis*Math.log((1+a)/(1-a)),i[r]=e[t+2]}function Lx(e,t,i,r){EX(e,t,i,r,Qi)}const ite=Qi.radius*Math.PI/180,TM=180/(Qi.radius*Math.PI);function Tv(e,t,i,r){i[r]=e[t]*ite,i[r+1]=e[t+1]*ite,i[r+2]=e[t+2]}function zw(e,t,i,r){i[r]=e[t]*TM,i[r+1]=e[t+1]*TM,i[r+2]=e[t+2]}function Ome(e,t,i,r){cx(e,t,i,r),Tv(i,r,i,r)}function SLe(e,t,i,r){Av(e,t,i,r),Tv(i,r,i,r)}function ELe(e,t,i,r){Ev(e,t,i,r),Tv(i,r,i,r)}function CLe(e,t,i,r){zw(e,t,i,r),Sv(i,r,i,r)}function ALe(e,t,i,r){zw(e,t,i,r),Lx(i,r,i,r)}function OLe(e,t,i,r){zw(e,t,i,r),Cv(i,r,i,r)}function $x(e){if(N(e))return!1;const t=r1(e,lU);return!!fm[t][ce.WGS84_COMPARABLE_LON_LAT]}function GA(e,t,i,r){const s=Math.cos(i);e[0]=Math.cos(t)*s*r,e[1]=Math.sin(t)*s*r,e[2]=Math.sin(i)*r}function CX(e,t,i,r,s){const n=s+e[t+2],o=Pp*e[t+1],a=Pp*e[t],l=Math.cos(o);i[r++]=Math.cos(a)*l*n,i[r++]=Math.sin(a)*l*n,i[r]=Math.sin(o)*n}function nj(e,t,i,r){CX(e,t,i,r,By.radius)}function oj(e,t,i,r){CX(e,t,i,r,ym.radius)}function Sv(e,t,i,r){CX(e,t,i,r,Qi.radius)}function AX(e,t,i,r,s){const n=e[t],o=e[t+1],a=e[t+2],l=Math.sqrt(n*n+o*o+a*a),c=Hp(a/(l===0?1:l)),h=Math.atan2(o,n);i[r++]=HE*h,i[r++]=HE*c,i[r]=l-s}function aj(e,t,i,r){AX(e,t,i,r,By.radius)}function lj(e,t,i,r){AX(e,t,i,r,ym.radius)}function Ev(e,t,i,r){AX(e,t,i,r,Qi.radius)}function Rme(e,t,i,r){Ev(e,t,i,r),Lx(i,r,i,r)}function Mme(e,t,i,r){Ev(e,t,i,r),Cv(i,r,i,r)}function RLe(e,t,i,r,s){const n=Pp*e[t],o=Pp*e[t+1],a=e[t+2],l=Math.sin(o),c=Math.cos(o),h=s.radius/Math.sqrt(1-s.eccentricitySquared*l*l);i[r++]=(h+a)*c*Math.cos(n),i[r++]=(h+a)*c*Math.sin(n),i[r++]=(h*(1-s.eccentricitySquared)+a)*l}function Cv(e,t,i,r){RLe(e,t,i,r,Qi)}function Av(e,t,i,r){const s=aLe,n=e[t],o=e[t+1],a=e[t+2];let l,c,h,p,m,g,v,b,S,T,O,C,M,I,$,U,q,G,Y,J,X;l=Math.abs(a),c=n*n+o*o,h=Math.sqrt(c),p=c+a*a,m=Math.sqrt(p),J=Math.atan2(o,n),g=a*a/p,v=c/p,I=s.a2/m,$=s.a3-s.a4/m,v>.3?(b=l/m*(1+v*(s.a1+I+g*$)/m),Y=Math.asin(b),T=b*b,S=Math.sqrt(1-T)):(S=h/m*(1-g*(s.a5-I-v*$)/m),Y=Math.acos(S),T=1-S*S,b=Math.sqrt(T)),O=1-Qi.eccentricitySquared*T,C=Qi.radius/Math.sqrt(O),M=s.a6*C,I=h-C*S,$=l-M*b,q=S*I+b*$,U=S*$-b*I,G=U/(M/O+q),Y+=G,X=q+U*G/2,a<0&&(Y=-Y),i[r++]=HE*J,i[r++]=HE*Y,i[r]=X}function Pme(e,t,i,r){Av(e,t,i,r),Sv(i,r,i,r)}function Ime(e,t,i,r){Av(e,t,i,r),Lx(i,r,i,r)}const fm={[ce.WGS84]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:zr,[ce.WGS84_COMPARABLE_LON_LAT]:zr,[ce.SPHERICAL_ECEF]:Sv,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:Lx,[ce.PLATE_CARREE]:Tv,[ce.WGS84]:zr,[ce.WGS84_ECEF]:Cv},[ce.CGCS2000]:{[ce.CGCS2000]:zr,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:zr,[ce.WGS84_COMPARABLE_LON_LAT]:zr,[ce.SPHERICAL_ECEF]:Sv,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:null,[ce.PLATE_CARREE]:Tv,[ce.WGS84]:null,[ce.WGS84_ECEF]:Cv},[ce.GCSMARS2000]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:zr,[ce.GCSMOON2000]:null,[ce.LON_LAT]:zr,[ce.WGS84_COMPARABLE_LON_LAT]:null,[ce.SPHERICAL_ECEF]:null,[ce.SPHERICAL_MARS_PCPF]:oj,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:null,[ce.PLATE_CARREE]:null,[ce.WGS84]:null,[ce.WGS84_ECEF]:null},[ce.GCSMOON2000]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:zr,[ce.LON_LAT]:zr,[ce.WGS84_COMPARABLE_LON_LAT]:null,[ce.SPHERICAL_ECEF]:null,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:nj,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:null,[ce.PLATE_CARREE]:null,[ce.WGS84]:null,[ce.WGS84_ECEF]:null},[ce.WEB_MERCATOR]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:cx,[ce.WGS84_COMPARABLE_LON_LAT]:cx,[ce.SPHERICAL_ECEF]:Cme,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:zr,[ce.PLATE_CARREE]:Ome,[ce.WGS84]:cx,[ce.WGS84_ECEF]:Ame},[ce.WGS84_ECEF]:{[ce.CGCS2000]:Av,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:Av,[ce.WGS84_COMPARABLE_LON_LAT]:Av,[ce.SPHERICAL_ECEF]:Pme,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:Ime,[ce.PLATE_CARREE]:SLe,[ce.WGS84]:Av,[ce.WGS84_ECEF]:zr},[ce.SPHERICAL_ECEF]:{[ce.CGCS2000]:Ev,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:Ev,[ce.WGS84_COMPARABLE_LON_LAT]:Ev,[ce.SPHERICAL_ECEF]:zr,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:Rme,[ce.PLATE_CARREE]:ELe,[ce.WGS84]:Ev,[ce.WGS84_ECEF]:Mme},[ce.SPHERICAL_MARS_PCPF]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:lj,[ce.GCSMOON2000]:null,[ce.LON_LAT]:lj,[ce.WGS84_COMPARABLE_LON_LAT]:null,[ce.SPHERICAL_ECEF]:null,[ce.SPHERICAL_MARS_PCPF]:zr,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:null,[ce.PLATE_CARREE]:null,[ce.WGS84]:null,[ce.WGS84_ECEF]:null},[ce.SPHERICAL_MOON_PCPF]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:aj,[ce.LON_LAT]:aj,[ce.WGS84_COMPARABLE_LON_LAT]:null,[ce.SPHERICAL_ECEF]:null,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:zr,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:null,[ce.PLATE_CARREE]:null,[ce.WGS84]:null,[ce.WGS84_ECEF]:null},[ce.UNKNOWN]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:null,[ce.WGS84_COMPARABLE_LON_LAT]:null,[ce.SPHERICAL_ECEF]:null,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:zr,[ce.WEB_MERCATOR]:null,[ce.PLATE_CARREE]:null,[ce.WGS84]:null,[ce.WGS84_ECEF]:null},[ce.LON_LAT]:{[ce.CGCS2000]:zr,[ce.GCSMARS2000]:zr,[ce.GCSMOON2000]:zr,[ce.LON_LAT]:zr,[ce.WGS84_COMPARABLE_LON_LAT]:zr,[ce.SPHERICAL_ECEF]:Sv,[ce.SPHERICAL_MARS_PCPF]:oj,[ce.SPHERICAL_MOON_PCPF]:nj,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:Lx,[ce.PLATE_CARREE]:Tv,[ce.WGS84]:zr,[ce.WGS84_ECEF]:Cv},[ce.WGS84_COMPARABLE_LON_LAT]:{[ce.CGCS2000]:null,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:zr,[ce.WGS84_COMPARABLE_LON_LAT]:zr,[ce.SPHERICAL_ECEF]:Sv,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:null,[ce.PLATE_CARREE]:Tv,[ce.WGS84]:zr,[ce.WGS84_ECEF]:Cv},[ce.PLATE_CARREE]:{[ce.CGCS2000]:zw,[ce.GCSMARS2000]:null,[ce.GCSMOON2000]:null,[ce.LON_LAT]:zw,[ce.WGS84_COMPARABLE_LON_LAT]:zw,[ce.SPHERICAL_ECEF]:CLe,[ce.SPHERICAL_MARS_PCPF]:null,[ce.SPHERICAL_MOON_PCPF]:null,[ce.UNKNOWN]:null,[ce.WEB_MERCATOR]:ALe,[ce.PLATE_CARREE]:zr,[ce.WGS84]:zw,[ce.WGS84_ECEF]:OLe}};function OX(e,t,i=RX()){return N(e)||N(t)?null:Lme(e,t,i).projector}function Lme(e,t,i){if(N(e)||N(t)||i.source.spatialReference===e&&i.dest.spatialReference===t)return i;const r=r1(e,i.source),s=r1(t,i.dest);return r===ce.UNKNOWN&&s===ce.UNKNOWN?qc(e,t)?i.projector=zr:i.projector=null:i.projector=fm[r][s],i}function RX(){return{source:{spatialReference:null,spatialReferenceId:ce.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ce.UNKNOWN,metersPerUnit:1},projector:zr}}const lU={spatialReference:null,spatialReferenceId:ce.UNKNOWN},$me={spatialReference:null,spatialReferenceId:ce.UNKNOWN},MX=RX(),MLe=RX(),Pp=Jt(1),HE=Vc(1),gs=F(),dp=F(),U0=F(),lr=F(),CL=F();class r0{constructor(t){this.allocator=t,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&CE(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const t=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*rte);this._items.length=Math.min(t,this._items.length),this._itemsPtr=0}_grow(){for(let t=0;t<Math.max(8,Math.min(this._items.length,rte));t++)this._items.push(this.allocator())}}const rte=1024;function Be(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ux(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function PX(e,t,i,r,s,n,o,a,l,c,h,p,m,g,v,b){return[e,t,i,r,s,n,o,a,l,c,h,p,m,g,v,b]}function Dme(e,t){return new Float64Array(e,t,16)}const Dn=Be();Object.freeze(Object.defineProperty({__proto__:null,create:Be,clone:ux,fromValues:PX,createView:Dme,IDENTITY:Dn},Symbol.toStringTag,{value:"Module"}));var Zu;(function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"})(Zu||(Zu={}));function PLe(e){return 32+e.length}function ILe(){return 16}function Nme(e){if(!e)return 0;let t=32;for(const i in e)if(e.hasOwnProperty(i)){const r=e[i];switch(typeof r){case"string":t+=PLe(r);break;case"number":t+=ILe();break;case"boolean":t+=4}}return t}function Gvt(e,t){return 32+e.length*t}var qE;(function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"})(qE||(qE={}));function Qr(){return[1,0,0,0,1,0,0,0,1]}function LLe(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function $Le(e,t,i,r,s,n,o,a,l){return[e,t,i,r,s,n,o,a,l]}function Fme(e,t){return new Float64Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Qr,clone:LLe,fromValues:$Le,createView:Fme},Symbol.toStringTag,{value:"Module"}));function s0(){return[0,0,0,1]}function DLe(e){return[e[0],e[1],e[2],e[3]]}function NLe(e,t,i,r){return[e,t,i,r]}function kme(e,t){return new Float64Array(e,t,4)}const FLe=s0();Object.freeze(Object.defineProperty({__proto__:null,create:s0,clone:DLe,fromValues:NLe,createView:kme,IDENTITY:FLe},Symbol.toStringTag,{value:"Module"}));function yt(){return[0,0]}function xR(e){return[e[0],e[1]]}function ir(e,t){return[e,t]}function Ume(e){const t=yt(),i=Math.min(2,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function zme(e,t){return new Float64Array(e,t,2)}function Bme(){return yt()}function Vme(){return ir(1,1)}function Gme(){return ir(1,0)}function jme(){return ir(0,1)}const gd=Bme(),Hme=Vme(),kLe=Gme(),ULe=jme();Object.freeze(Object.defineProperty({__proto__:null,create:yt,clone:xR,fromValues:ir,fromArray:Ume,createView:zme,zeros:Bme,ones:Vme,unitX:Gme,unitY:jme,ZEROS:gd,ONES:Hme,UNIT_X:kLe,UNIT_Y:ULe},Symbol.toStringTag,{value:"Module"}));function di(){return[0,0,0,0]}function cU(e){return[e[0],e[1],e[2],e[3]]}function ki(e,t,i,r){return[e,t,i,r]}function IX(e){const t=di(),i=Math.min(4,e.length);for(let r=0;r<i;++r)t[r]=e[r];return t}function qme(e,t){return new Float64Array(e,t,4)}function Wme(){return di()}function Zme(){return ki(1,1,1,1)}function Xme(){return ki(1,0,0,0)}function Yme(){return ki(0,1,0,0)}function Qme(){return ki(0,0,1,0)}function Jme(){return ki(0,0,0,1)}const vm=Wme(),od=Zme(),zLe=Xme(),BLe=Yme(),VLe=Qme(),GLe=Jme();Object.freeze(Object.defineProperty({__proto__:null,create:di,clone:cU,fromValues:ki,fromArray:IX,createView:qme,zeros:Wme,ones:Zme,unitX:Xme,unitY:Yme,unitZ:Qme,unitW:Jme,ZEROS:vm,ONES:od,UNIT_X:zLe,UNIT_Y:BLe,UNIT_Z:VLe,UNIT_W:GLe},Symbol.toStringTag,{value:"Module"}));class Lu{constructor(t,i,r){this.itemByteSize=t,this.itemCreate=i,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}get(){this._itemsPtr===0&&CE(()=>this._reset());const t=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=t;){const i=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(i,r*this.itemByteSize));this._buffers.push(i)}return this._items[this._itemsPtr++]}_reset(){const t=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>t;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(t=kT){return new Lu(16,zme,t)}static createVec3f64(t=kT){return new Lu(24,mZ,t)}static createVec4f64(t=kT){return new Lu(32,qme,t)}static createMat3f64(t=kT){return new Lu(72,Fme,t)}static createMat4f64(t=kT){return new Lu(128,Dme,t)}static createQuatf64(t=kT){return new Lu(32,kme,t)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const kT=4*qE.KILOBYTES,jvt=Lu.createVec2f64(),ot=Lu.createVec3f64(),LX=Lu.createVec4f64();Lu.createMat3f64();const $X=Lu.createMat4f64(),Hvt=Lu.createQuatf64();function Gm(e){return e?{origin:un(e.origin),vector:un(e.vector)}:{origin:F(),vector:F()}}function jLe(e,t){const i=qLe.get();return i.origin=e,i.vector=t,i}function qvt(e,t=Gm()){return HLe(e.origin,e.vector,t)}function HLe(e,t,i=Gm()){return ve(i.origin,e),ve(i.vector,t),i}function hx(e,t,i=Gm()){return ve(i.origin,e),Me(i.vector,t,e),i}function DX(e,t){const i=Me(ot.get(),t,e.origin),r=ke(e.vector,i),s=ke(e.vector,e.vector),n=Xe(r/s,0,1),o=Me(ot.get(),be(ot.get(),e.vector,n),i);return ke(o,o)}function Wvt(e,t,i){return cj(e,t,0,1,i)}function Zvt(e,t,i){return Oe(i,e.origin,be(i,e.vector,t))}function cj(e,t,i,r,s){const{vector:n,origin:o}=e,a=Me(ot.get(),t,o),l=ke(n,a)/rl(n);return be(s,n,Xe(l,i,r)),Oe(s,s,e.origin)}function Xvt(e,t){if(ege(e,jLe(t.origin,t.direction),!1,V4)){const{tA:i,pB:r,distance2:s}=V4;if(i>=0&&i<=1)return s;if(i<0)return Yn(e.origin,r);if(i>1)return Yn(Oe(ot.get(),e.origin,e.vector),r)}return null}function Kme(e,t,i){return!!ege(e,t,!0,V4)&&(ve(i,V4.pA),!0)}function ege(e,t,i,r){const n=e.origin,o=Oe(ot.get(),n,e.vector),a=t.origin,l=Oe(ot.get(),a,t.vector),c=ot.get(),h=ot.get();if(c[0]=n[0]-a[0],c[1]=n[1]-a[1],c[2]=n[2]-a[2],h[0]=l[0]-a[0],h[1]=l[1]-a[1],h[2]=l[2]-a[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const p=ot.get();if(p[0]=o[0]-n[0],p[1]=o[1]-n[1],p[2]=o[2]-n[2],Math.abs(p[0])<1e-6&&Math.abs(p[1])<1e-6&&Math.abs(p[2])<1e-6)return!1;const m=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],g=h[0]*p[0]+h[1]*p[1]+h[2]*p[2],v=c[0]*p[0]+c[1]*p[1]+c[2]*p[2],b=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],S=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*b-g*g;if(Math.abs(S)<1e-6)return!1;let T=(m*g-v*b)/S,O=(m+g*T)/b;i&&(T=Xe(T,0,1),O=Xe(O,0,1));const C=ot.get(),M=ot.get();return C[0]=n[0]+T*p[0],C[1]=n[1]+T*p[1],C[2]=n[2]+T*p[2],M[0]=a[0]+O*h[0],M[1]=a[1]+O*h[1],M[2]=a[2]+O*h[2],r.tA=T,r.tB=O,r.pA=C,r.pB=M,r.distance2=Yn(C,M),!0}const V4={tA:0,tB:0,pA:F(),pB:F(),distance2:0},qLe=new r0(()=>({origin:null,vector:null}));function Lo(e){return e?{origin:un(e.origin),direction:un(e.direction)}:{origin:F(),direction:F()}}function Yvt(e,t){return Yv(e.origin,t.origin)&&Yv(e.direction,t.direction)}function sh(e,t){const i=QLe.get();return i.origin=e,i.direction=t,i}function G4(e,t=Lo()){return tge(e.origin,e.direction,t)}function WLe(e,t,i=Lo()){return ve(i.origin,e),Me(i.direction,t,e),i}function tge(e,t,i=Lo()){return ve(i.origin,e),ve(i.direction,t),i}function ZLe(e,t){const i=St(ot.get(),De(ot.get(),e.direction),Me(ot.get(),t,e.origin));return ke(i,i)}function XLe(e,t,i){const r=ke(e.direction,Me(i,t,e.origin));return Oe(i,e.origin,be(i,e.direction,r)),i}function YLe(){return{origin:null,direction:null}}const QLe=new r0(YLe);function SM(e,t){return ke(e,t)/He(e)}function NX(e,t){const i=ke(e,t)/(He(e)*He(t));return-Fn(i)}function JLe(e,t,i){De(AL,e),De(SV,t);const r=ke(AL,SV),s=Fn(r),n=St(AL,AL,SV);return ke(n,i)<0?2*Math.PI-s:s}const AL=F(),SV=F(),KLe=Ie.getLogger("esri.geometry.support.sphere");function Qn(){return di()}function WE(e,t=Qn()){return Ap(t,e)}function ige(e,t){return ki(e[0],e[1],e[2],t)}function e$e(e){return e}function rge(e){e[0]=e[1]=e[2]=e[3]=0}function uU(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function Oy(e){return e[3]}function t$e(e){return e}function sge(e,t,i,r){return ki(e,t,i,r)}function i$e(e,t,i){return e!==i&&ve(i,e),i[3]=e[3]+t,i}function r$e(e,t,i){return KLe.error("sphere.setExtent is not yet supported"),e===i?i:WE(e,i)}function x1(e,t,i){if(N(t))return!1;const{origin:r,direction:s}=t,n=s$e;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const o=s[0]*s[0]+s[1]*s[1]+s[2]*s[2],a=2*(s[0]*n[0]+s[1]*n[1]+s[2]*n[2]),l=a*a-4*o*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);let h=(-a-c)/(2*o);const p=(-a+c)/(2*o);return(h<0||p<h&&p>0)&&(h=p),!(h<0)&&(i&&(i[0]=r[0]+s[0]*h,i[1]=r[1]+s[1]*h,i[2]=r[2]+s[2]*h),!0)}const s$e=F();function uj(e,t){return x1(e,t,null)}function n$e(e,t,i){if(x1(e,t,i))return i;const r=HC(e,t,ot.get());return Oe(i,t.origin,be(ot.get(),t.direction,Pr(t.origin,r)/He(t.direction))),i}function HC(e,t,i){const r=ot.get(),s=$X.get();St(r,t.origin,t.direction);const n=Oy(e);St(i,r,t.origin),be(i,i,1/He(i)*n);const o=age(e,t.origin),a=NX(t.origin,i);return ih(s,a+o,r),et(i,i,s),i}function o$e(e,t,i){return x1(e,t,i)?i:(XLe(t,e,i),nge(e,i,i))}function nge(e,t,i){const r=Me(ot.get(),t,e),s=be(ot.get(),r,e[3]/He(r));return Oe(i,s,e)}function oge(e,t){const i=Me(ot.get(),t,e),r=rl(i),s=e[3]*e[3];return Math.sqrt(Math.abs(r-s))}function age(e,t){const i=Me(ot.get(),t,e),r=He(i),s=Oy(e),n=s+Math.abs(s-r);return Fn(s/n)}const EV=F();function lge(e,t,i,r){const s=Me(EV,t,e);switch(i){case Zu.X:{const n=tee(s,EV)[2];return fe(r,-Math.sin(n),Math.cos(n),0)}case Zu.Y:{const n=tee(s,EV),o=n[1],a=n[2],l=Math.sin(o);return fe(r,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case Zu.Z:return De(r,s);default:return}}function cge(e,t){const i=Me(hj,t,e);return He(i)-e[3]}function a$e(e,t,i,r){const s=cge(e,t),n=lge(e,t,Zu.Z,hj),o=be(hj,n,i-s);return Oe(r,t,o)}function l$e(e,t){const i=Yn(e,t),r=Oy(e);return i<=r*r}const hj=F(),hU=Qn(),c$e=Object.freeze(Object.defineProperty({__proto__:null,create:Qn,copy:WE,fromCenterAndRadius:ige,wrap:e$e,clear:rge,fromRadius:uU,getRadius:Oy,getCenter:t$e,fromValues:sge,elevate:i$e,setExtent:r$e,intersectRay:x1,intersectsRay:uj,intersectRayClosestSilhouette:n$e,closestPointOnSilhouette:HC,closestPoint:o$e,projectPoint:nge,distanceToSilhouette:oge,angleToSilhouette:age,axisAt:lge,altitudeAt:cge,setAltitudeAt:a$e,containsPoint:l$e,tmpSphere:hU},Symbol.toStringTag,{value:"Module"}));function Dx(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],i=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}function u$e(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),r=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return fe(e,i,r,s),e}function Qvt(e,t,i){i=i||e;const r=ke(e,t);fe(i,e[0]-r*t[0],e[1]-r*t[1],e[2]-r*t[2]),De(i,i)}function Jvt(e,t,i){Math.abs(e[0])>Math.abs(e[1])?fe(t,0,1,0):fe(t,1,0,0),St(i,e,t),De(t,t),St(t,i,e),De(i,i)}function OL(e,t,i,r,s,n){const o=e+(t-e)*s;return o+(i+(r-i)*s-o)*n}function h$e(e,t,i,r=F()){const s=He(e),n=He(t),o=ke(e,t)/(s*n);if(o<.9999999999999999){const a=Math.acos(o),l=((1-i)*s+i*n)/Math.sin(a),c=l/s*Math.sin((1-i)*a),h=l/n*Math.sin(i*a);return be(Bw,e,c),be(Vw,t,h),Oe(r,Bw,Vw)}return Nn(r,e,t,i)}function Kvt(e,t,i,r=F(),s=F()){const n=He(e),o=He(t),a=ke(e,t)/(n*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),h=Math.sin(i*l),p=Math.sin((1-i)*l),m=(1-i)*n+i*o;{const g=m/c,v=g/o*h;be(Bw,e,g/n*p),be(Vw,t,v),Oe(r,Bw,Vw)}{const g=1/n*(-Math.cos((1-i)*l)*l*m+p*(-n+o));be(Bw,e,g);const v=1/o*(Math.cos(i*l)*l*m+h*(-n+o));be(Vw,t,v),Oe(s,Bw,Vw),be(s,s,1/c)}return s}return Nn(r,e,t,i),Me(s,t,e),De(s,s),s}function $N(e,t,i){e=De(Bw,e),t=De(Vw,t);const r=Fn(ke(e,t));if(i){const s=St(d$e,e,t);if(ke(s,i)<0)return-r}return r}function DN(e){const t=e.length;return i=>{if(i<=e[0][0])return e[0][1];if(i>=e[t-1][0])return e[t-1][1];let r=1;for(;i>e[r][0];)r++;const s=e[r-1][0],n=e[r][0],o=(n-i)/(n-s);return o*e[r-1][1]+(1-o)*e[r][1]}}function e1t(e,t,i,r){Me(ste,t,e),Me(nte,i,e),St(r,ste,nte),De(r,r),r[3]=-ke(e,r)}const ste=F(),nte=F(),d$e=F(),Bw=F(),Vw=F();function Vi(e=TR){return[e[0],e[1],e[2],e[3]]}function p$e(e=TR[0],t=TR[1],i=TR[2],r=TR[3]){return FX(e,t,i,r,LX.get())}function dU(e,t){return FX(t[0],t[1],t[2],t[3],e)}function FX(e,t,i,r,s=Vi()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function uge(e,t,i){return ve(i,e),i[3]=t,i}function ZE(e,t,i){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function Ea(e,t,i,r=Vi()){const s=i[0]-t[0],n=i[1]-t[1],o=i[2]-t[2],a=e[0]-t[0],l=e[1]-t[1],c=e[2]-t[2],h=n*c-o*l,p=o*a-s*c,m=s*l-n*a,g=h*h+p*p+m*m,v=Math.abs(g-1)>1e-5&&g>1e-12?1/Math.sqrt(g):1;return r[0]=h*v,r[1]=p*v,r[2]=m*v,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function hge(e,t,i,r,s){if(e.count<3)return!1;e.getVec(i,jA);let n=r,o=!1;for(;n<e.count-1&&!o;)e.getVec(n,UT),n++,o=!zl(jA,UT);if(!o)return!1;for(n=Math.max(n,s),o=!1;n<e.count&&!o;)e.getVec(n,Ew),n++,Me(RL,jA,UT),De(RL,RL),Me(ML,UT,Ew),De(ML,ML),o=!zl(jA,Ew)&&!zl(UT,Ew)&&Math.abs(ke(RL,ML))<f$e;return o?(Ea(jA,UT,Ew,t),!0):(i!==0||r!==1||s!==2)&&hge(e,t,0,1,2)}const f$e=.99619469809,jA=F(),UT=F(),Ew=F(),RL=F(),ML=F();function dj(e,t,i){return t!==e&&dU(e,t),e[3]=-ke(e,i),e}function pj(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function EP(e,t,i,r){return St(Ew,t,e),ZE(i,Ew,r)}function t1t(e,t,i,r){return pU(e,t,Me(ot.get(),i,t),w$e,r)}function gT(e,t,i){return!!w(t)&&pU(e,t.origin,t.direction,x$e,i)}function m$e(e,t,i){return pU(e,t.origin,t.vector,bm.NONE,i)}function g$e(e,t,i){return pU(e,t.origin,t.vector,bm.CLAMP,i)}function dge(e,t){return Or(e,t)>=0}function y$e(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];return e[0]*(e[0]>0?i:n)+e[1]*(e[1]>0?r:o)+e[2]*(e[2]>0?s:a)+e[3]>=0}function _$e(e,t){const i=ke(e,t.ray.direction),r=-Or(e,t.ray.origin);if(r<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return r>0;if((r<0||i<0)&&!(r<0&&i<0))return!0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function v$e(e,t){const i=ke(e,t.ray.direction),r=-Or(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return r>0;const s=r/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1}function b$e(e,t,i){const r=be(ot.get(),e,-e[3]),s=fj(e,Me(ot.get(),t,r),ot.get());return Oe(i,s,r),i}function fj(e,t,i){const r=be(ot.get(),e,ke(e,t));return Me(i,t,r),i}function Or(e,t){return ke(e,t)+e[3]}function pU(e,t,i,r,s){const n=ke(e,i);if(n===0)return!1;let o=-(ke(e,t)+e[3])/n;return r&bm.CLAMP&&(o=Xe(o,0,1)),!(!(r&bm.INFINITE_MIN)&&o<0||!(r&bm.INFINITE_MAX)&&o>1)&&(Oe(s,t,be(s,i,o)),!0)}function i1t(e){return e}const TR=[0,0,1,0];var bm;(function(e){e[e.NONE=0]="NONE",e[e.CLAMP=1]="CLAMP",e[e.INFINITE_MIN=4]="INFINITE_MIN",e[e.INFINITE_MAX=8]="INFINITE_MAX"})(bm||(bm={}));const w$e=bm.INFINITE_MIN|bm.INFINITE_MAX,x$e=bm.INFINITE_MAX,CV=Ie.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class pge{constructor(){this.plane=Vi(),this.origin=F(),this.basis1=F(),this.basis2=F()}}function T1(e=Sge){return{plane:Vi(e.plane),origin:un(e.origin),basis1:un(e.basis1),basis2:un(e.basis2)}}function T$e(e,t,i){const r=D$e.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=p$e(0,0,0,0),fU(r),r}function yT(e,t=T1()){return kX(e.origin,e.basis1,e.basis2,t)}function S$e(e,t){ve(t.origin,e.origin),ve(t.basis1,e.basis1),ve(t.basis2,e.basis2),dU(t.plane,e.plane)}function kX(e,t,i,r=T1()){return ve(r.origin,e),ve(r.basis1,t),ve(r.basis2,i),fU(r),L$e(r,"fromValues()"),r}function fU(e){EP(e.basis2,e.basis1,e.origin,e.plane)}function fge(e,t,i){e!==i&&yT(e,i);const r=be(ot.get(),Hy(e),t);return Oe(i.origin,i.origin,r),i.plane[3]-=t,i}function E$e(e,t,i){return mge(t,i),fge(i,VX(e,e.origin),i),i}function mge(e,t=T1()){const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return fe(t.origin,e[0]+i,e[1]+r,0),fe(t.basis1,i,0,0),fe(t.basis2,0,r,0),FX(0,0,1,0,t.plane),t}function UX(e,t,i){return!!gT(e.plane,t,i)&&xge(e,i)}function C$e(e,t,i){if(UX(e,t,i))return i;const r=gge(e,t,ot.get());return Oe(i,t.origin,be(ot.get(),t.direction,Pr(t.origin,r)/He(t.direction))),i}function gge(e,t,i){const r=j4.get();Tge(e,t,r,j4.get());let s=Number.POSITIVE_INFINITY;for(const n of jX){const o=GX(e,n,mU.get()),a=ot.get();if(m$e(r,o,a)){const l=t0(ot.get(),t.origin,a),c=Math.abs(Fn(ke(t.direction,l)));c<s&&(s=c,ve(i,a))}}return s===Number.POSITIVE_INFINITY?yge(e,t,i):i}function yge(e,t,i){if(UX(e,t,i))return i;const r=j4.get(),s=j4.get();Tge(e,t,r,s);let n=Number.POSITIVE_INFINITY;for(const o of jX){const a=GX(e,o,mU.get()),l=ot.get();if(g$e(r,a,l)){const c=ZLe(t,l);if(!dge(s,l))continue;c<n&&(n=c,ve(i,l))}}return zX(e,t.origin)<n&&_ge(e,t.origin,i),i}function _ge(e,t,i){const r=b$e(e.plane,t,ot.get()),s=cj(ote(e,e.basis1),r,-1,1,ot.get()),n=cj(ote(e,e.basis2),r,-1,1,ot.get());return Me(i,Oe(ot.get(),s,n),e.origin),i}function vge(e,t,i){const{origin:r,basis1:s,basis2:n}=e,o=Me(ot.get(),t,r),a=SM(s,o),l=SM(n,o),c=SM(Hy(e),o);return fe(i,a,l,c)}function zX(e,t){const i=vge(e,t,ot.get()),{basis1:r,basis2:s}=e,n=He(r),o=He(s),a=Math.max(Math.abs(i[0])-n,0),l=Math.max(Math.abs(i[1])-o,0),c=i[2];return a*a+l*l+c*c}function A$e(e,t){return Math.sqrt(zX(e,t))}function O$e(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of jX){const s=GX(e,r,mU.get()),n=DX(s,t);n>i&&(i=n)}return Math.sqrt(i)}function BX(e,t){return dge(e.plane,t)&&xge(e,t)}function R$e(e,t,i,r){return I$e(e,i,r)}function VX(e,t){const i=-e.plane[3];return SM(Hy(e),t)-i}function M$e(e,t,i,r){const s=VX(e,t),n=be($$e,Hy(e),i-s);return Oe(r,t,n),r}function bge(e,t){return zl(e.basis1,t.basis1)&&zl(e.basis2,t.basis2)&&zl(e.origin,t.origin)}function wge(e,t,i){return e!==i&&yT(e,i),Fs(zT,t),Kl(zT,zT),et(i.basis1,e.basis1,zT),et(i.basis2,e.basis2,zT),et(i.plane,e.plane,zT),et(i.origin,e.origin,t),dj(i.plane,i.plane,i.origin),i}function P$e(e,t,i,r){return e!==r&&yT(e,r),ih(AV,t,i),et(r.basis1,e.basis1,AV),et(r.basis2,e.basis2,AV),fU(r),r}function Hy(e){return e.plane}function I$e(e,t,i){switch(t){case Zu.X:ve(i,e.basis1),De(i,i);break;case Zu.Y:ve(i,e.basis2),De(i,i);break;case Zu.Z:ve(i,Hy(e))}return i}function xge(e,t){const i=Me(ot.get(),t,e.origin),r=rl(e.basis1),s=rl(e.basis2),n=ke(e.basis1,i),o=ke(e.basis2,i);return-n-r<0&&n-r<0&&-o-s<0&&o-s<0}function ote(e,t){const i=mU.get();return ve(i.origin,e.origin),ve(i.vector,t),i}function GX(e,t,i){const{basis1:r,basis2:s,origin:n}=e,o=be(ot.get(),r,t.origin[0]),a=be(ot.get(),s,t.origin[1]);Oe(i.origin,o,a),Oe(i.origin,i.origin,n);const l=be(ot.get(),r,t.direction[0]),c=be(ot.get(),s,t.direction[1]);return be(i.vector,Oe(l,l,c),2),i}function L$e(e,t){Math.abs(ke(e.basis1,e.basis2)/(He(e.basis1)*He(e.basis2)))>1e-6&&CV.warn(t,"Provided basis vectors are not perpendicular"),Math.abs(ke(e.basis1,Hy(e)))>1e-6&&CV.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-ke(Hy(e),e.origin)-e.plane[3])>1e-6&&CV.warn(t,"Plane offset is not consistent with plane origin")}function Tge(e,t,i,r){const s=Hy(e);EP(s,t.direction,t.origin,i),EP(i,s,t.origin,r)}const Sge={plane:Vi(),origin:Ke(0,0,0),basis1:Ke(1,0,0),basis2:Ke(0,1,0)},j4=new r0(Vi),mU=new r0(Gm),$$e=F(),D$e=new r0(()=>({origin:null,basis1:null,basis2:null,plane:null})),jX=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],zT=Be(),AV=Be(),N$e=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:pge,create:T1,wrap:T$e,copy:yT,copyWithoutVerify:S$e,fromValues:kX,updateUnboundedPlane:fU,elevate:fge,setExtent:E$e,fromAABoundingRect:mge,intersectRay:UX,intersectRayClosestSilhouette:C$e,closestPointOnSilhouette:gge,closestPoint:yge,projectPoint:_ge,projectPointLocal:vge,distance2:zX,distance:A$e,distanceToSilhouette:O$e,extrusionContainsPoint:BX,axisAt:R$e,altitudeAt:VX,setAltitudeAt:M$e,equals:bge,transform:wge,rotate:P$e,normal:Hy,UP:Sge},Symbol.toStringTag,{value:"Module"}));function F$e(e){const{value:t,operations:i}=e;return{operations:i,value:i.create(t)}}function k$e(e,t,i){return e.operations.setExtent(e.value,t,i.value),i}function U$e(e){return{operations:e,value:e.create()}}function Ege(e,t,i=U$e(e)){return i.operations=e,e.copy(t,i.value),i}function z$e(e){return Ege(c$e,sge(0,0,0,ji(e).radius))}const ate=2**50;function B$e(){return Ege(N$e,kX([0,0,0],[ate,0,0],[0,ate,0]))}function V$e(e,t,i){return e.operations.axisAt(e.value,t,Zu.Z,i)}function G$e(e,t,i,r){return e.operations.axisAt(e.value,t,i,r)}function j$e(e,t,i){return e.operations.intersectRay(e.value,t,i)}function H$e(e,t,i){return e.operations.intersectRayClosestSilhouette(e.value,t,i)}function q$e(e,t){return e.operations.altitudeAt(e.value,t)}function Cge(e,t,i,r){return e.operations.setAltitudeAt(e.value,t,i,r)}function W$e(e,t,i,r){return t!==r&&js(r,t),fe(BT,r[12],r[13],r[14]),Cge(e,BT,i,BT),r[12]=BT[0],r[13]=BT[1],r[14]=BT[2],r}function OV(e,t,i){return e.operations.elevate(e.value,t,i.value)}const BT=F();function lte(e,t,i,r,s){return s[0]=ke(e,t),s[1]=ke(e,i),s[2]=ke(e,r),s}function mj(e,t,i,r,s){ve(i,e),ve(PL,t),De(PL,PL),St(r,PL,i),St(s,r,i)}function Age(e,t){return e?Pm(t):t.isGeographic?wt.PlateCarree:t}const PL=F(),Oge=96;function r1t(e,t){const i=t||e.extent,r=e.width,s=Zc(i&&i.spatialReference);return i&&r?i.width/r*s*Yfe*Oge:0}function Rge(e,t){return e/(Zc(t)*Yfe*Oge)}function EM(e){const t=e==null?void 0:e.type;return t==="base-tile"||t==="tile"||t==="elevation"||t==="imagery-tile"||t==="base-elevation"||t==="open-street-map"||t==="wcs"||t==="web-tile"||t==="wmts"||t==="vector-tile"}function cte(e){return(e==null?void 0:e.type)==="voxel"}function ute(e){return(e==null?void 0:e.type)==="imagery-tile"}function Mge(e){var t;return((t=e.parent)==null?void 0:t.declaredClass)==="esri.Basemap"&&e.parent.baseLayers.includes(e)}function HX(e){var t;return(e==null?void 0:e.type)==="feature"&&!e.url&&((t=e.source)==null?void 0:t.type)==="memory"}function s1t(e){var t;return(e==null?void 0:e.type)==="feature"&&((t=e.source)==null?void 0:t.type)==="feature-layer"}function gj(e){return e.labelsVisible===!0&&e.labelingInfo!=null&&e.labelingInfo.length>0}function Z$e(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const i=e.activeLayer.tileMatrixSets;if(i)return i}return null}const X$e=Ie.getLogger("esri.support.AnalysesCollection");let XE=class extends wM{constructor(e){super(e),this.handles.add(this.on("before-add",t=>{N(t.item)||t.item.parent===this.owner&&(X$e.warn("Analysis inside the collection must be unique. Not adding this element again."),t.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};XE=u([B("esri.support.AnalysesCollection")],XE);const NN={widthBreakpoint:{getValue(e){const t=e.viewSize[0],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(e){const t=e.viewSize[1],i=e.breakpoints,r=this.values;return t<=i.xsmall?r.xsmall:t<=i.small?r.small:t<=i.medium?r.medium:t<=i.large?r.large:r.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(e){const t=e.viewSize,i=t[0],r=t[1],s=this.values;return r>=i?s.portrait:s.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},RV={xsmall:544,small:768,medium:992,large:1200};function Y$e(e){const t=e;return t&&t.xsmall<t.small&&t.small<t.medium&&t.medium<t.large}function MV(e,t){return t?NN[e].valueToClassName[t].split(" "):[]}const Q$e=e=>{let t=class extends e{constructor(...i){super(...i),this._breakpointsHandles=new xi,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=RV}initialize(){this._breakpointsHandles.add(xe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),si))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=Tt(this._breakpointsHandles))}set breakpoints(i){if(i===this._get("breakpoints"))return;const r=Y$e(i);if(!r){const s=JSON.stringify(RV,null,2);console.warn("provided breakpoints are not valid, using defaults:"+s)}i=r?i:RV,this._set("breakpoints",{...i})}_updateClassNames(){if(!this.container)return;const i=Rc.acquire(),r=Rc.acquire();let s,n=!1;for(s in NN){const o=this[s],a=NN[s].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(n=!0,this[s]=a,MV(s,o).forEach(l=>r.push(l)),MV(s,a).forEach(l=>i.push(l)))}n&&(this._applyClassNameChanges(i,r),Rc.release(i),Rc.release(r))}_applyClassNameChanges(i,r){const s=this.container;s&&(r.forEach(n=>s.classList.remove(n)),i.forEach(n=>s.classList.add(n)))}_removeActiveClassNames(){const i=this.container;if(!i)return;let r;for(r in NN)MV(r,this[r]).forEach(s=>i.classList.remove(s))}};return u([f()],t.prototype,"breakpoints",null),u([f()],t.prototype,"orientation",void 0),u([f()],t.prototype,"widthBreakpoint",void 0),u([f()],t.prototype,"heightBreakpoint",void 0),t=u([B("esri.views.BreakpointsOwner")],t),t};/*!
 * @esri/arcgis-html-sanitizer - v2.10.0 - Tue Mar 15 2022 16:38:25 GMT-0400 (Eastern Daylight Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2017 Zongmin Lei(雷宗民) <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 * 
 * Lodash/isPlainObject
 * Copyright (c) JS Foundation and other contributors <https://js.foundation/>
 * MIT License, see https://raw.githubusercontent.com/lodash/lodash/4.17.10-npm/LICENSE for details
 */var J$e="[object Object]";function K$e(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function eDe(e,t){return function(i){return e(t(i))}}var tDe=Function.prototype,Pge=Object.prototype,Ige=tDe.toString,iDe=Pge.hasOwnProperty,rDe=Ige.call(Object),sDe=Pge.toString,nDe=eDe(Object.getPrototypeOf,Object);function oDe(e){return!!e&&typeof e=="object"}function aDe(e){if(!oDe(e)||sDe.call(e)!=J$e||K$e(e))return!1;var t=nDe(e);if(t===null)return!0;var i=iDe.call(t,"constructor")&&t.constructor;return typeof i=="function"&&i instanceof i&&Ige.call(i)==rDe}var lDe=aDe,Cw={exports:{}},fn={},CP={exports:{}},_T={};function Lge(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e.float=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function cDe(e,t,i){}function uDe(e,t,i){}var hDe=/javascript\s*\:/img;function dDe(e,t){return hDe.test(t)?"":t}_T.whiteList=Lge();_T.getDefaultWhiteList=Lge;_T.onAttr=cDe;_T.onIgnoreAttr=uDe;_T.safeAttrValue=dDe;var pDe={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}},HA=pDe;function fDe(e,t){e=HA.trimRight(e),e[e.length-1]!==";"&&(e+=";");var i=e.length,r=!1,s=0,n=0,o="";function a(){if(!r){var h=HA.trim(e.slice(s,n)),p=h.indexOf(":");if(p!==-1){var m=HA.trim(h.slice(0,p)),g=HA.trim(h.slice(p+1));if(m){var v=t(s,o.length,m,g,h);v&&(o+=v+"; ")}}}s=n+1}for(;n<i;n++){var l=e[n];if(l==="/"&&e[n+1]==="*"){var c=e.indexOf("*/",n+2);if(c===-1)break;n=c+1,s=n+1,r=!1}else l==="("?r=!0:l===")"?r=!1:l===";"?r||a():l===`
`&&a()}return HA.trim(o)}var mDe=fDe,IL=_T,gDe=mDe;function hte(e){return e==null}function yDe(e){var t={};for(var i in e)t[i]=e[i];return t}function $ge(e){e=yDe(e||{}),e.whiteList=e.whiteList||IL.whiteList,e.onAttr=e.onAttr||IL.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||IL.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||IL.safeAttrValue,this.options=e}$ge.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onAttr,n=i.onIgnoreAttr,o=i.safeAttrValue,a=gDe(e,function(l,c,h,p,m){var g=r[h],v=!1;if(g===!0?v=g:typeof g=="function"?v=g(p):g instanceof RegExp&&(v=g.test(p)),v!==!0&&(v=!1),p=o(h,p),!!p){var b={position:c,sourcePosition:l,source:m,isWhite:v};if(v){var S=s(h,p,b);return hte(S)?h+":"+p:S}else{var S=n(h,p,b);if(!hte(S))return S}}});return a};var _De=$ge;(function(e,t){var i=_T,r=_De;function s(o,a){var l=new r(a);return l.process(o)}t=e.exports=s,t.FilterCSS=r;for(var n in i)t[n]=i[n]})(CP,CP.exports);var qX={indexOf:function(e,t){var i,r;if(Array.prototype.indexOf)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(e[i]===t)return i;return-1},forEach:function(e,t,i){var r,s;if(Array.prototype.forEach)return e.forEach(t,i);for(r=0,s=e.length;r<s;r++)t.call(i,e[r],r,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,i=t.exec(e);return i?i.index:-1}},vDe=CP.exports.FilterCSS,bDe=CP.exports.getDefaultWhiteList,H4=qX;function Dge(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var Nge=new vDe;function wDe(e,t,i){}function xDe(e,t,i){}function TDe(e,t,i){}function SDe(e,t,i){}function Fge(e){return e.replace(CDe,"&lt;").replace(ADe,"&gt;")}function EDe(e,t,i,r){if(i=Gge(i),t==="href"||t==="src"){if(i=H4.trim(i),i==="#")return"#";if(!(i.substr(0,7)==="http://"||i.substr(0,8)==="https://"||i.substr(0,7)==="mailto:"||i.substr(0,4)==="tel:"||i.substr(0,11)==="data:image/"||i.substr(0,6)==="ftp://"||i.substr(0,2)==="./"||i.substr(0,3)==="../"||i[0]==="#"||i[0]==="/"))return""}else if(t==="background"){if(LL.lastIndex=0,LL.test(i))return""}else if(t==="style"){if(dte.lastIndex=0,dte.test(i)||(pte.lastIndex=0,pte.test(i)&&(LL.lastIndex=0,LL.test(i))))return"";r!==!1&&(r=r||Nge,i=r.process(i))}return i=jge(i),i}var CDe=/</g,ADe=/>/g,ODe=/"/g,RDe=/&quot;/g,MDe=/&#([a-zA-Z0-9]*);?/gim,PDe=/&colon;?/gim,IDe=/&newline;?/gim,LL=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,dte=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,pte=/u\s*r\s*l\s*\(.*/gi;function kge(e){return e.replace(ODe,"&quot;")}function Uge(e){return e.replace(RDe,'"')}function zge(e){return e.replace(MDe,function(i,r){return r[0]==="x"||r[0]==="X"?String.fromCharCode(parseInt(r.substr(1),16)):String.fromCharCode(parseInt(r,10))})}function Bge(e){return e.replace(PDe,":").replace(IDe," ")}function Vge(e){for(var t="",i=0,r=e.length;i<r;i++)t+=e.charCodeAt(i)<32?" ":e.charAt(i);return H4.trim(t)}function Gge(e){return e=Uge(e),e=zge(e),e=Bge(e),e=Vge(e),e}function jge(e){return e=kge(e),e=Fge(e),e}function LDe(){return""}function $De(e,t){typeof t!="function"&&(t=function(){});var i=!Array.isArray(e);function r(o){return i?!0:H4.indexOf(e,o)!==-1}var s=[],n=!1;return{onIgnoreTag:function(o,a,l){if(r(o))if(l.isClosing){var c="[/removed]",h=l.position+c.length;return s.push([n!==!1?n:l.position,h]),n=!1,c}else return n||(n=l.position),"[removed]";else return t(o,a,l)},remove:function(o){var a="",l=0;return H4.forEach(s,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function DDe(e){for(var t="",i=0;i<e.length;){var r=e.indexOf("<!--",i);if(r===-1){t+=e.slice(i);break}t+=e.slice(i,r);var s=e.indexOf("-->",r);if(s===-1)break;i=s+3}return t}function NDe(e){var t=e.split("");return t=t.filter(function(i){var r=i.charCodeAt(0);return r===127?!1:r<=31?r===10||r===13:!0}),t.join("")}fn.whiteList=Dge();fn.getDefaultWhiteList=Dge;fn.onTag=wDe;fn.onIgnoreTag=xDe;fn.onTagAttr=TDe;fn.onIgnoreTagAttr=SDe;fn.safeAttrValue=EDe;fn.escapeHtml=Fge;fn.escapeQuote=kge;fn.unescapeQuote=Uge;fn.escapeHtmlEntities=zge;fn.escapeDangerHtml5Entities=Bge;fn.clearNonPrintableCharacter=Vge;fn.friendlyAttrValue=Gge;fn.escapeAttrValue=jge;fn.onIgnoreTagStripAll=LDe;fn.StripTagBody=$De;fn.stripCommentTag=DDe;fn.stripBlankChar=NDe;fn.cssFilter=Nge;fn.getDefaultCSSWhiteList=bDe;var gU={},Q_=qX;function FDe(e){var t=Q_.spaceIndex(e);if(t===-1)var i=e.slice(1,-1);else var i=e.slice(1,t+1);return i=Q_.trim(i).toLowerCase(),i.slice(0,1)==="/"&&(i=i.slice(1)),i.slice(-1)==="/"&&(i=i.slice(0,-1)),i}function kDe(e){return e.slice(0,2)==="</"}function UDe(e,t,i){var r="",s=0,n=!1,o=!1,a=0,l=e.length,c="",h="";e:for(a=0;a<l;a++){var p=e.charAt(a);if(n===!1){if(p==="<"){n=a;continue}}else if(o===!1){if(p==="<"){r+=i(e.slice(s,a)),n=a,s=a;continue}if(p===">"){r+=i(e.slice(s,n)),h=e.slice(n,a+1),c=FDe(h),r+=t(n,r.length,c,h,kDe(h)),s=a+1,n=!1;continue}if(p==='"'||p==="'")for(var m=1,g=e.charAt(a-m);g.trim()===""||g==="=";){if(g==="="){o=p;continue e}g=e.charAt(a-++m)}}else if(p===o){o=!1;continue}}return s<e.length&&(r+=i(e.substr(s))),r}var zDe=/[^a-zA-Z0-9_:\.\-]/gim;function BDe(e,t){var i=0,r=[],s=!1,n=e.length;function o(p,m){if(p=Q_.trim(p),p=p.replace(zDe,"").toLowerCase(),!(p.length<1)){var g=t(p,m||"");g&&r.push(g)}}for(var a=0;a<n;a++){var l=e.charAt(a),c,h;if(s===!1&&l==="="){s=e.slice(i,a),i=a+1;continue}if(s!==!1&&a===i&&(l==='"'||l==="'")&&e.charAt(a-1)==="="){if(h=e.indexOf(l,a+1),h===-1)break;c=Q_.trim(e.slice(i+1,h)),o(s,c),s=!1,a=h,i=a+1;continue}if(/\s|\n|\t/.test(l))if(e=e.replace(/\s|\n|\t/g," "),s===!1)if(h=VDe(e,a),h===-1){c=Q_.trim(e.slice(i,a)),o(c),s=!1,i=a+1;continue}else{a=h-1;continue}else if(h=GDe(e,a-1),h===-1){c=Q_.trim(e.slice(i,a)),c=fte(c),o(s,c),s=!1,i=a+1;continue}else continue}return i<e.length&&(s===!1?o(e.slice(i)):o(s,fte(Q_.trim(e.slice(i))))),Q_.trim(r.join(" "))}function VDe(e,t){for(;t<e.length;t++){var i=e[t];if(i!==" ")return i==="="?t:-1}}function GDe(e,t){for(;t>0;t--){var i=e[t];if(i!==" ")return i==="="?t:-1}}function jDe(e){return e[0]==='"'&&e[e.length-1]==='"'||e[0]==="'"&&e[e.length-1]==="'"}function fte(e){return jDe(e)?e.substr(1,e.length-2):e}gU.parseTag=UDe;gU.parseAttr=BDe;var HDe=CP.exports.FilterCSS,pp=fn,Hge=gU,qDe=Hge.parseTag,WDe=Hge.parseAttr,FN=qX;function $L(e){return e==null}function ZDe(e){var t=FN.spaceIndex(e);if(t===-1)return{html:"",closing:e[e.length-2]==="/"};e=FN.trim(e.slice(t+1,-1));var i=e[e.length-1]==="/";return i&&(e=FN.trim(e.slice(0,-1))),{html:e,closing:i}}function XDe(e){var t={};for(var i in e)t[i]=e[i];return t}function qge(e){e=XDe(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=pp.onIgnoreTagStripAll),e.whiteList=e.whiteList||e.allowList||pp.whiteList,e.onTag=e.onTag||pp.onTag,e.onTagAttr=e.onTagAttr||pp.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||pp.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||pp.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||pp.safeAttrValue,e.escapeHtml=e.escapeHtml||pp.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new HDe(e.css))}qge.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,i=t.options,r=i.whiteList,s=i.onTag,n=i.onIgnoreTag,o=i.onTagAttr,a=i.onIgnoreTagAttr,l=i.safeAttrValue,c=i.escapeHtml,h=t.cssFilter;i.stripBlankChar&&(e=pp.stripBlankChar(e)),i.allowCommentTag||(e=pp.stripCommentTag(e));var p=!1;if(i.stripIgnoreTagBody){var p=pp.StripTagBody(i.stripIgnoreTagBody,n);n=p.onIgnoreTag}var m=qDe(e,function(g,v,b,S,T){var O={sourcePosition:g,position:v,isClosing:T,isWhite:r.hasOwnProperty(b)},C=s(b,S,O);if(!$L(C))return C;if(O.isWhite){if(O.isClosing)return"</"+b+">";var M=ZDe(S),I=r[b],$=WDe(M.html,function(q,G){var Y=FN.indexOf(I,q)!==-1,J=o(b,q,G,Y);if(!$L(J))return J;if(Y)return G=l(b,q,G,h),G?q+'="'+G+'"':q;var J=a(b,q,G,Y);return $L(J)?void 0:J}),S="<"+b;return $&&(S+=" "+$),M.closing&&(S+=" /"),S+=">",S}else{var C=n(b,S,O);return $L(C)?c(S):C}},c);return p&&(m=p.remove(m)),m};var YDe=qge;(function(e,t){var i=fn,r=gU,s=YDe;function n(l,c){var h=new s(c);return h.process(l)}t=e.exports=n,t.filterXSS=n,t.FilterXSS=s;for(var o in i)t[o]=i[o];for(var o in r)t[o]=r[o];function a(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}a()&&(self.filterXSS=e.exports)})(Cw,Cw.exports);var QDe=function(){function e(t,i){var r=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(n,o,a,l){return n==="a"&&o==="href"||(n==="img"||n==="source")&&o==="src"?r.sanitizeUrl(a):Cw.exports.safeAttrValue(n,o,a,l)}};var s;t&&!i?s=t:t&&i?(s=Object.create(this.arcgisFilterOptions),Object.keys(t).forEach(function(n){n==="whiteList"?s.whiteList=r._extendObjectOfArrays([r.arcgisWhiteList,t.whiteList||{}]):s[n]=t[n]})):(s=Object.create(this.arcgisFilterOptions),s.whiteList=this.arcgisWhiteList),this.xssFilterOptions=s,this._xssFilter=new Cw.exports.FilterXSS(s)}return e.prototype.sanitize=function(t,i){switch(i===void 0&&(i={}),typeof t){case"number":return isNaN(t)||!isFinite(t)?null:t;case"boolean":return t;case"string":return this._xssFilter.process(t);case"object":return this._iterateOverObject(t,i);default:return i.allowUndefined&&typeof t>"u"?void 0:null}},e.prototype.sanitizeUrl=function(t,i){var r=(i!=null?i:{}).isProtocolRequired,s=r===void 0?!0:r,n=this._trim(t.substring(0,t.indexOf(":"))),o=t==="/",a=/^#/.test(t),l=n&&this.allowedProtocols.indexOf(n.toLowerCase())>-1;return o||a||l?Cw.exports.escapeAttrValue(t):!n&&!s?Cw.exports.escapeAttrValue("https://".concat(t)):""},e.prototype.sanitizeHTMLAttribute=function(t,i,r,s){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(t,i,r,s):Cw.exports.safeAttrValue(t,i,r,s)},e.prototype.validate=function(t,i){i===void 0&&(i={});var r=this.sanitize(t,i);return{isValid:t===r,sanitized:r}},e.prototype._extendObjectOfArrays=function(t){var i={};return t.forEach(function(r){Object.keys(r).forEach(function(s){Array.isArray(r[s])&&Array.isArray(i[s])?i[s]=i[s].concat(r[s]):i[s]=r[s]})}),i},e.prototype._iterateOverObject=function(t,i){var r=this;i===void 0&&(i={});try{var s=!1,n=void 0;if(Array.isArray(t))n=t.reduce(function(a,l){var c=r.validate(l,i);return c.isValid?a.concat([l]):(s=!0,a.concat([c.sanitized]))},[]);else if(lDe(t)){var o=Object.keys(t);n=o.reduce(function(a,l){var c=t[l],h=r.validate(c,i);return h.isValid?a[l]=c:(s=!0,a[l]=h.sanitized),a},{})}else return i.allowUndefined&&typeof t>"u"?void 0:null;return s?n:t}catch{return null}},e.prototype._trim=function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},e}();const yU=new Map;function Wge(){yU.clear()}function JDe(e){return yU.get(e)}function KDe(e,t){yU.set(e,t)}function PV(e){yU.delete(e)}var Nx,YE,eNe=function(e){if("WebkitTransition"in e.style)Nx="webkitTransitionEnd",YE="webkitAnimationEnd";else{if(!("transition"in e.style))throw new Error("Your browser is not supported!");Nx="transitionend",YE="animationend"}},Zge=function(e){Nx||eNe(e)},tNe=function(e,t){return t===void 0&&(t=e+"-active"),function(i){Zge(i);var r=!1,s=function(n){r||(r=!0,i.removeEventListener(Nx,s),i.removeEventListener(YE,s),i.classList.remove(e),i.classList.remove(t))};i.classList.add(e),i.addEventListener(Nx,s),i.addEventListener(YE,s),requestAnimationFrame(function(){i.classList.add(t)})}},iNe=function(e,t){return t===void 0&&(t=e+"-active"),function(i,r){Zge(i);var s=!1,n=function(o){s||(s=!0,i.removeEventListener(Nx,n),i.removeEventListener(YE,n),r())};i.classList.add(e),i.addEventListener(Nx,n),i.addEventListener(YE,n),requestAnimationFrame(function(){i.classList.add(t)})}};const rNe=Ie.getLogger("esri.widgets.support.widgetUtils");function Xge(e){const t=Rc.acquire();for(let r=0;r<arguments.length;r++){const s=arguments[r],n=typeof s;if(n==="string")t.push(s);else if(Array.isArray(s))t.push.apply(t,s);else if(n==="object")for(const o in s)s[o]&&t.push(o)}const i=t.join(" ");return Rc.release(t),i}(()=>{const e=new Map,t=new ResizeObserver(i=>{Wge();for(const r of i)e.get(r.target)(r)});return(i,r,s)=>(e.has(i)&&rNe.error("Already observing element",i),e.set(i,r),t.observe(i,s),md(()=>{t.unobserve(i),e.delete(i)}))})();function Ov(e){const t=e==null?void 0:e.closest("[dir]");return t!==null&&t instanceof HTMLElement&&t.dir==="rtl"||document.dir==="rtl"}function mte(e){const t="data-node-ref";this[e.getAttribute(t)]=null}function yj(e){const t="data-node-ref";this[e.getAttribute(t)]=e}function sNe(e,t){return(e==="enter"?tNe:iNe)(t)}const nNe=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],oNe=nNe.reduce((e,t)=>(e[t]=[],e),{}),aNe=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],Yge=new QDe({whiteList:oNe,onTagAttr:(e,t,i)=>{const r=`${t}="${i}"`;if(aNe.includes(t))return r},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function lNe(e){return e==="Enter"||e===" "}const Qge="http://www.w3.org/",_U=`${Qge}2000/svg`,Jge=`${Qge}1999/xlink`;let q4,gte=[],WX=(e,t)=>{let i={};return Object.keys(e).forEach(r=>{i[r]=e[r]}),t&&Object.keys(t).forEach(r=>{i[r]=t[r]}),i},ZX=(e,t)=>e.vnodeSelector===t.vnodeSelector&&(e.properties&&t.properties?e.properties.key===t.properties.key&&e.properties.bind===t.properties.bind:!e.properties&&!t.properties),Kge=e=>{if(typeof e!="string")throw new Error("Style values must be strings")},cNe=(e,t,i)=>{if(t.vnodeSelector!==""){for(let r=i;r<e.length;r++)if(ZX(e[r],t))return r}return-1},IV=(e,t,i,r)=>{let s=e[t];if(s.vnodeSelector==="")return;let n=s.properties;if(!(n&&(n.key===void 0?n.bind:n.key))){for(let o=0;o<e.length;o++)if(o!==t){let a=e[o];if(ZX(a,s))throw new Error(`${i.vnodeSelector} had a ${s.vnodeSelector} child ${r==="added"?r:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},uNe=e=>{if(e.properties){let t=e.properties.enterAnimation;t&&t(e.domNode,e.properties)}},_j=[],vj=!1,eye=e=>{(e.children||[]).forEach(eye),e.properties&&e.properties.afterRemoved&&e.properties.afterRemoved.apply(e.properties.bind||e.properties,[e.domNode])},yte=()=>{vj=!1,_j.forEach(eye),_j.length=0},_te=e=>{_j.push(e),vj||(vj=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(yte,{timeout:16}):setTimeout(yte,16))},vte=e=>{let t=e.domNode;if(e.properties){let i=e.properties.exitAnimation;if(i)return t.style.pointerEvents="none",void i(t,()=>{t.parentNode&&(t.parentNode.removeChild(t),_te(e))},e.properties)}t.parentNode&&(t.parentNode.removeChild(t),_te(e))},hNe=(e,t,i)=>{if(!t)return;let r=i.eventHandlerInterceptor,s=Object.keys(t),n=s.length;for(let o=0;o<n;o++){let a=s[o],l=t[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")bj(e,l,!0);else if(a==="classes"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let m=c[p];l[m]&&e.classList.add(m)}}else if(a==="styles"){let c=Object.keys(l),h=c.length;for(let p=0;p<h;p++){let m=c[p],g=l[m];g&&(Kge(g),i.styleApplyer(e,m,g))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(r&&(l=r(a,l,e,t)),a==="oninput"&&function(){let h=l;l=function(p){h.apply(this,[p]),p.target["oninput-value"]=p.target.value}}()),e[a]=l):i.namespace===_U?a==="href"?e.setAttributeNS(Jge,a,l):e.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?e[a]=Yge.sanitize(l):e.setAttribute(a,l):e[a]=l}}},dNe=(e,t,i)=>{if(t)for(let r of t)D2(r,e,void 0,i)},tye=(e,t,i)=>{dNe(e,t.children,i),t.text&&(e.textContent=t.text),hNe(e,t.properties,i),t.properties&&t.properties.afterCreate&&t.properties.afterCreate.apply(t.properties.bind||t.properties,[e,i,t.vnodeSelector,t.properties,t.children])},D2=(e,t,i,r)=>{let s,n=0,o=e.vnodeSelector,a=t.ownerDocument;if(o==="")s=e.domNode=a.createTextNode(e.text),i!==void 0?t.insertBefore(s,i):t.appendChild(s);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let h=o.charAt(n-1),p=o.slice(n,l);h==="."?s.classList.add(p):h==="#"?s.id=p:(p==="svg"&&(r=WX(r,{namespace:_U})),r.namespace!==void 0?s=e.domNode=a.createElementNS(r.namespace,p):(s=e.domNode=e.domNode||a.createElement(p),p==="input"&&e.properties&&e.properties.type!==void 0&&s.setAttribute("type",e.properties.type)),i!==void 0?t.insertBefore(s,i):s.parentNode!==t&&t.appendChild(s)),n=l+1}}tye(s,e,r)}},bj=(e,t,i)=>{t&&t.split(" ").forEach(r=>{r&&e.classList.toggle(r,i)})},pNe=(e,t,i,r)=>{if(!i)return;let s=!1,n=Object.keys(i),o=n.length;for(let a=0;a<o;a++){let l=n[a],c=i[l],h=t[l];if(l==="class")h!==c&&(bj(e,h,!1),bj(e,c,!0));else if(l==="classes"){let p=e.classList,m=Object.keys(c),g=m.length;for(let v=0;v<g;v++){let b=m[v],S=!!c[b];S!==!!h[b]&&(s=!0,S?p.add(b):p.remove(b))}}else if(l==="styles"){let p=Object.keys(c),m=p.length;for(let g=0;g<m;g++){let v=p[g],b=c[v];b!==h[v]&&(s=!0,b?(Kge(b),r.styleApplyer(e,v,b)):r.styleApplyer(e,v,""))}}else if(c||typeof h!="string"||(c=""),l==="value"){let p=e[l];p!==c&&(e["oninput-value"]?p===e["oninput-value"]:c!==h)&&(e[l]=c,e["oninput-value"]=void 0),c!==h&&(s=!0)}else if(c!==h){let p=typeof c;p==="function"&&r.eventHandlerInterceptor||(r.namespace===_U?l==="href"?e.setAttributeNS(Jge,l,c):e.setAttribute(l,c):p==="string"?l==="innerHTML"?e[l]=Yge.sanitize(c):l==="role"&&c===""?e.removeAttribute(l):e.setAttribute(l,c):e[l]!==c&&(e[l]=c),s=!0)}}return s},fNe=(e,t,i,r,s)=>{if(i===r)return!1;r=r||gte;let n,o=(i=i||gte).length,a=r.length,l=0,c=0,h=!1;for(;c<a;){let p=l<o?i[l]:void 0,m=r[c];if(p!==void 0&&ZX(p,m))h=q4(p,m,s)||h,l++;else{let g=cNe(i,m,l+1);if(g>=0){for(n=l;n<g;n++)vte(i[n]),IV(i,n,e,"removed");h=q4(i[g],m,s)||h,l=g+1}else D2(m,t,l<o?i[l].domNode:void 0,s),uNe(m),IV(r,c,e,"added")}c++}if(o>l)for(n=l;n<o;n++)vte(i[n]),IV(i,n,e,"removed");return h};q4=(e,t,i)=>{let r=e.domNode,s=!1;if(e===t)return!1;let n=!1;if(t.vnodeSelector===""){if(t.text!==e.text){let o=r.ownerDocument.createTextNode(t.text);return r.parentNode.replaceChild(o,r),t.domNode=o,s=!0,s}t.domNode=r}else t.vnodeSelector.lastIndexOf("svg",0)===0&&(i=WX(i,{namespace:_U})),e.text!==t.text&&(n=!0,t.text===void 0?r.removeChild(r.firstChild):r.textContent=t.text),t.domNode=r,n=fNe(t,r,e.children,t.children,i)||n,n=pNe(r,e.properties,t.properties,i)||n,t.properties&&t.properties.afterUpdate&&t.properties.afterUpdate.apply(t.properties.bind||t.properties,[r,i,t.vnodeSelector,t.properties,t.children]);return n&&t.properties&&t.properties.updateAnimation&&t.properties.updateAnimation(r,t.properties,e.properties),s};let qA=(e,t)=>({getLastRender:()=>e,update:i=>{if(e.vnodeSelector!==i.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let r=e;e=i,q4(r,i,t)},domNode:e.domNode});const mNe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{t.charAt(0)==="-"?e.style.setProperty(t,i):e.style[t]=i}};let qS=e=>WX(mNe,e),Rv={create:(e,t)=>(t=qS(t),D2(e,document.createElement("div"),void 0,t),qA(e,t)),append:(e,t,i)=>(i=qS(i),D2(t,e,void 0,i),qA(t,i)),insertBefore:(e,t,i)=>(i=qS(i),D2(t,e.parentNode,e,i),qA(t,i)),merge:(e,t,i)=>(i=qS(i),t.domNode=e,tye(e,t,i),qA(t,i)),replace:(e,t,i)=>(i=qS(i),D2(t,e.parentNode,e,i),e.parentNode.removeChild(e),qA(t,i))},iye,gNe=(e,t)=>{let i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i};iye=Array.prototype.find?(e,t)=>e.find(t):(e,t)=>e.filter(t)[0];let yNe=(e,t)=>{let i=e;return t.forEach(r=>{i=i&&i.children?iye(i.children,s=>s.domNode===r):void 0}),i},_Ne=(e,t,i)=>{let r=function(s){i("domEvent",s);let n=t(),o=gNe(s.currentTarget,n.domNode);o.reverse();let a,l=yNe(n.getLastRender(),o);return e.scheduleRender(),l&&(a=l.properties[`on${s.type}`].apply(l.properties.bind||this,arguments)),i("domEventProcessed",s),a};return(s,n,o,a)=>r},wj=e=>{let t,i,r=qS(e),s=r.performanceLogger,n=!0,o=!1,a=[],l=[],c=(p,m,g)=>{let v,b=()=>v;r.eventHandlerInterceptor=_Ne(t,b,s),v=p(m,g(),r),a.push(v),l.push(g)},h=()=>{if(i=void 0,n){n=!1,s("renderStart",void 0);for(let p=0;p<a.length;p++){let m=l[p]();s("rendered",void 0),a[p].update(m),s("patched",void 0)}s("renderDone",void 0),n=!0}};return t={renderNow:h,scheduleRender:()=>{i||o||(i=requestAnimationFrame(h))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),o=!0},resume:()=>{o=!1,n=!0,t.scheduleRender()},append:(p,m)=>{c(Rv.append,p,m)},insertBefore:(p,m)=>{c(Rv.insertBefore,p,m)},merge:(p,m)=>{c(Rv.merge,p,m)},replace:(p,m)=>{c(Rv.replace,p,m)},detach:p=>{for(let m=0;m<l.length;m++)if(l[m]===p)return l.splice(m,1),a.splice(m,1)[0];throw new Error("renderFunction was not found")}},t},O_=class extends ze{constructor(){super(...arguments),this.items=new zt,this._watchUpdatingTracking=new _m,this._callbacks=new Map,this._projector=wj(),this._hiddenProjector=wj()}get needsRender(){return this.items.length>0}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,t=>{for(const i of t.added){const r=()=>i.render();this._callbacks.set(i,r),this._projector.append(this.surface,r)}for(const i of t.removed){const r=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(r.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const t=this._hiddenSurface,i=this._hiddenProjector;let r=null;const s=()=>(r=e.render(),r);i.append(t,s),i.renderNow();const n={left:0,top:0,right:0,bottom:0};if(r&&r.domNode){const o=r.domNode.getBoundingClientRect();n.left=o.left,n.top=o.top,n.right=o.right,n.bottom=o.bottom}for(i.detach(s);t.firstChild;)t.removeChild(t.firstChild);return n}overlaps(e,t){const i=this.computeBoundingRect(e),r=this.computeBoundingRect(t);return Math.max(i.left,r.left)<=Math.min(i.right,r.right)&&Math.max(i.top,r.top)<=Math.min(i.bottom,r.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const t=e.getContext("2d");t.save(),t.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(i=>{t.save(),i.renderCanvas(t),t.restore()}),t.restore()}};u([f({readOnly:!0})],O_.prototype,"surface",void 0),u([f({readOnly:!0})],O_.prototype,"items",void 0),u([f({readOnly:!0})],O_.prototype,"needsRender",null),u([f({readOnly:!0})],O_.prototype,"_watchUpdatingTracking",void 0),u([f({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],O_.prototype,"updating",void 0),O_=u([B("esri.views.overlay.ViewOverlay")],O_);const bte=O_;function XX(e,t,i,r){let s=null,n=1e3;typeof t=="number"?(n=t,r=i):(s=t!=null?t:null,n=i);let o,a=0;const l=()=>{a=0,e.apply(r,o)},c=(...h)=>{s&&s.apply(r,h),o=h,n?a||(a=setTimeout(l,n)):l()};return c.remove=()=>{a&&(clearTimeout(a),a=0)},c.forceUpdate=()=>{a&&(clearTimeout(a),l())},c.hasPendingUpdates=()=>!!a,c}function Lt(e,t){const i=t?{...t,source:e}:e;return f({aliasOf:i})}const vNe="randomUUID"in crypto;function bNe(){if(vNe)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=i=>e[i].toString(16);return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}const wNe={handleInterceptedEvent:(e,t,i,r)=>(e.scheduleRender(),t.properties[`on${r.type}`].apply(t.properties.bind||i,[r]))},xNe={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(e,t,i)=>{e.style[t]=i}},TNe=e=>({...xNe,...e}),SNe=(e,t)=>{const i=[];for(;e&&e!==t;)i.push(e),e=e.parentNode;return i},ENe=(e,t)=>e.find(t),wte=(e,t,i=!1)=>{let r=e;return t.forEach((s,n)=>{const o=r!=null&&r.children?ENe(r.children,a=>a.domNode===s):void 0;i&&!o&&n!==t.length-1||(r=o)}),r},CNe=e=>{let t;const i={...wNe,...e},r=TNe(i),s=r.performanceLogger;let n,o=!0,a=!1;const l=[],c=[],h=(m,g,v)=>{var T;let b;r.eventHandlerInterceptor=(O,C,M,I)=>function($){let U;s("domEvent",$);const q=SNe($.currentTarget,b.domNode),G=q.some(J=>{var X;return customElements.get((X=J==null?void 0:J.tagName)==null?void 0:X.toLowerCase())});if($.eventPhase===Event.CAPTURING_PHASE||!G)q.reverse(),U=wte(b.getLastRender(),q);else{const J=$.composedPath(),X=J.slice(J.indexOf($.currentTarget),J.indexOf(b.domNode)).filter(ne=>ne.getRootNode()===ne.ownerDocument).reverse();U=wte(b.getLastRender(),X,!0)}let Y;return U&&(Y=i.handleInterceptedEvent(t,U,this,$)),s("domEventProcessed",$),Y},(T=i.postProcessProjectionOptions)==null||T.call(i,r);const S=v();b=m(g,S,r),l.push(b),c.push(v),i.afterFirstVNodeRendered&&i.afterFirstVNodeRendered(b,S)};let p=()=>{if(n=void 0,o){o=!1,s("renderStart",void 0);for(let m=0;m<l.length;m++){const g=c[m]();s("rendered",void 0),l[m].update(g),s("patched",void 0)}s("renderDone",void 0),o=!0}};return i.modifyDoRenderImplementation&&(p=i.modifyDoRenderImplementation(p,l,c)),t={renderNow:p,scheduleRender:()=>{n||a||(n=requestAnimationFrame(p))},stop:()=>{n&&(cancelAnimationFrame(n),n=void 0),a=!0},resume:()=>{a=!1,o=!0,t.scheduleRender()},append:(m,g)=>{h(Rv.append,m,g)},insertBefore:(m,g)=>{h(Rv.insertBefore,m,g)},merge:(m,g)=>{h(Rv.merge,m,g)},replace:(m,g)=>{h(Rv.replace,m,g)},detach:m=>{for(let g=0;g<c.length;g++)if(c[g]===m)return c.splice(g,1),l.splice(g,1)[0];throw new Error("renderFunction was not found")}},t},Xi={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let WS,rye,vU,sye=!1,W4=!1,YX=!1,Su=!1,xte=null,xj=!1;const qC=typeof window<"u"?window:{};Xi.cssVarShim&&qC.CSS;const Up=qC.document||{head:{}},n1t=qC.HTMLElement||class{},Pa={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,i,r)=>e.addEventListener(t,i,r),rel:(e,t,i,r)=>e.removeEventListener(t,i,r),ce:(e,t)=>new CustomEvent(e,t)},Z4=Xi.shadowDomShim&&Xi.shadowDom?(()=>(Up.head.attachShadow+"").indexOf("[native")>-1)():!0,ANe=(()=>{let e=!1;try{Up.addEventListener("e",null,Object.defineProperty({},"passive",{get(){e=!0}}))}catch{}return e})(),ONe=e=>Promise.resolve(e),RNe=Xi.constructableCSS?(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replace=="function"}catch{}return!1})():!1,nye=(e,t,i,r)=>{i&&i.map(([s,n,o])=>{const a=PNe(e,s),l=MNe(t,o),c=INe(s);Pa.ael(a,n,l,c),(t.$rmListeners$=t.$rmListeners$||[]).push(()=>Pa.rel(a,n,l,c))})},MNe=(e,t)=>i=>{try{Xi.lazyLoad||e.$hostElement$[t](i)}catch(r){X3(r)}},PNe=(e,t)=>t&4?Up:t&8?qC:t&16?Up.body:e,INe=e=>ANe?{passive:(e&1)!==0,capture:(e&2)!==0}:(e&2)!==0,Tte="http://www.w3.org/1999/xlink",Fx=(e,t="")=>()=>{},Ste=new WeakMap,LNe=(e,t,i)=>{let r=Q4.get(e);RNe&&i?(r=r||new CSSStyleSheet,r.replace(t)):r=t,Q4.set(e,r)},$Ne=(e,t,i,r)=>{let s=oye(t,i),n=Q4.get(s);if(e=e.nodeType===11?e:Up,n)if(typeof n=="string"){e=e.head||e;let o=Ste.get(e),a;o||Ste.set(e,o=new Set),o.has(s)||(a=Up.createElement("style"),a.innerHTML=n,e.insertBefore(a,e.querySelector("link")),o&&o.add(s))}else e.adoptedStyleSheets.includes(n)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,n]);return s},DNe=e=>{const t=e.$cmpMeta$,i=e.$hostElement$,r=t.$flags$,s=Fx("attachStyles",t.$tagName$),n=$Ne(Z4&&i.shadowRoot?i.shadowRoot:i.getRootNode(),t,e.$modeName$);r&10&&(i["s-sc"]=n,i.classList.add(n+"-h"),r&2&&i.classList.add(n+"-s")),s()},oye=(e,t)=>"sc-"+(t&&e.$flags$&32?e.$tagName$+"-"+t:e.$tagName$),NNe=e=>dFe.map(t=>t(e)).find(t=>!!t),Ete={},FNe="http://www.w3.org/2000/svg",kNe="http://www.w3.org/1999/xhtml",UNe=e=>e!=null,QX=e=>(e=typeof e,e==="object"||e==="function"),aye=(e,t,...i)=>{let r=null,s=null,n=null,o=!1,a=!1,l=[];const c=p=>{for(let m=0;m<p.length;m++)r=p[m],Array.isArray(r)?c(r):r!=null&&typeof r!="boolean"&&((o=typeof e!="function"&&!QX(r))&&(r=String(r)),o&&a?l[l.length-1].$text$+=r:l.push(o?X4(null,r):r),a=o)};if(c(i),t&&(Xi.isDev&&e==="input"&&GNe(t),Xi.vdomKey&&t.key&&(s=t.key),Xi.slotRelocation&&t.name&&(n=t.name),Xi.vdomClass)){const p=t.className||t.class;p&&(t.class=typeof p!="object"?p:Object.keys(p).filter(m=>p[m]).join(" "))}if(Xi.isDev&&l.some(lye)&&hFe(`The <Host> must be the single root component. Make sure:
- You are NOT using hostData() and <Host> in the same component.
- <Host> is used once, and it's the single root component of the render() function.`),Xi.vdomFunctional&&typeof e=="function")return e(t===null?{}:t,l,BNe);const h=X4(e,null);return h.$attrs$=t,l.length>0&&(h.$children$=l),Xi.vdomKey&&(h.$key$=s),Xi.slotRelocation&&(h.$name$=n),h},X4=(e,t)=>{const i={$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null};return Xi.vdomAttribute&&(i.$attrs$=null),Xi.vdomKey&&(i.$key$=null),Xi.slotRelocation&&(i.$name$=null),i},zNe={},lye=e=>e&&e.$tag$===zNe,BNe={forEach:(e,t)=>e.map(Cte).forEach(t),map:(e,t)=>e.map(Cte).map(t).map(VNe)},Cte=e=>({vattrs:e.$attrs$,vchildren:e.$children$,vkey:e.$key$,vname:e.$name$,vtag:e.$tag$,vtext:e.$text$}),VNe=e=>{if(typeof e.vtag=="function"){const i=Object.assign({},e.vattrs);return e.vkey&&(i.key=e.vkey),e.vname&&(i.name=e.vname),aye(e.vtag,i,...e.vchildren||[])}const t=X4(e.vtag,e.vtext);return t.$attrs$=e.vattrs,t.$children$=e.vchildren,t.$key$=e.vkey,t.$name$=e.vname,t},GNe=e=>{const t=Object.keys(e),i=t.indexOf("value");if(i===-1)return;const r=t.indexOf("type"),s=t.indexOf("min"),n=t.indexOf("max"),o=t.indexOf("step");(i<r||i<s||i<n||i<o)&&_ye('The "value" prop of <input> should be set after "min", "max", "type" and "step"')},Ate=(e,t,i,r,s,n)=>{if(i!==r){let o=Pte(e,t),a=t.toLowerCase();if(t==="class"){const l=e.classList,c=Ote(i),h=Ote(r);l.remove(...c.filter(p=>p&&!h.includes(p))),l.add(...h.filter(p=>p&&!c.includes(p)))}else if(t==="style"){for(const l in i)(!r||r[l]==null)&&(l.includes("-")?e.style.removeProperty(l):e.style[l]="");for(const l in r)(!i||r[l]!==i[l])&&(l.includes("-")?e.style.setProperty(l,r[l]):e.style[l]=r[l])}else if(t!=="key")if(t==="ref")r&&r(e);else if(!e.__lookupSetter__(t)&&t[0]==="o"&&t[1]==="n")t[2]==="-"?t=t.slice(3):Pte(qC,a)?t=a.slice(2):t=a[2]+t.slice(3),i&&Pa.rel(e,t,i,!1),r&&Pa.ael(e,t,r,!1);else{const l=QX(r);if((o||l&&r!==null)&&!s)try{if(e.tagName.includes("-"))e[t]=r;else{let h=r==null?"":r;t==="list"?o=!1:(i==null||e[t]!=h)&&(e[t]=h)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(t=a,c=!0),r==null||r===!1?(r!==!1||e.getAttribute(t)==="")&&(c?e.removeAttributeNS(Tte,t):e.removeAttribute(t)):(!o||n&4||s)&&!l&&(r=r===!0?"":r,c?e.setAttributeNS(Tte,t,r):e.setAttribute(t,r))}}},jNe=/\s/,Ote=e=>e?e.split(jNe):[],cye=(e,t,i,r)=>{const s=t.$elm$.nodeType===11&&t.$elm$.host?t.$elm$.host:t.$elm$,n=e&&e.$attrs$||Ete,o=t.$attrs$||Ete;for(r in n)r in o||Ate(s,r,n[r],void 0,i,t.$flags$);for(r in o)Ate(s,r,n[r],o[r],i,t.$flags$)},Y4=(e,t,i,r)=>{let s=t.$children$[i],n=0,o,a,l;if(sye||(YX=!0,s.$tag$==="slot"&&(WS&&r.classList.add(WS+"-s"),s.$flags$|=s.$children$?2:1)),s.$text$!==null)o=s.$elm$=Up.createTextNode(s.$text$);else if(s.$flags$&1)o=s.$elm$=Up.createTextNode("");else{if(Su||(Su=s.$tag$==="svg"),o=s.$elm$=Up.createElementNS(Su?FNe:kNe,s.$flags$&2?"slot-fb":s.$tag$),Su&&s.$tag$==="foreignObject"&&(Su=!1),cye(null,s,Su),UNe(WS)&&o["s-si"]!==WS&&o.classList.add(o["s-si"]=WS),s.$children$)for(n=0;n<s.$children$.length;++n)a=Y4(e,s,n,o),a&&o.appendChild(a);s.$tag$==="svg"?Su=!1:o.tagName==="foreignObject"&&(Su=!0)}return o["s-hn"]=vU,s.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=rye,o["s-sn"]=s.$name$||"",l=e&&e.$children$&&e.$children$[i],l&&l.$tag$===s.$tag$&&e.$elm$&&AP(e.$elm$,!1)),o},AP=(e,t)=>{Pa.$flags$|=1;const i=e.childNodes;for(let r=i.length-1;r>=0;r--){const s=i[r];s["s-hn"]!==vU&&s["s-ol"]&&(dye(s).insertBefore(s,JX(s)),s["s-ol"].remove(),s["s-ol"]=void 0,YX=!0),t&&AP(s,t)}Pa.$flags$&=-2},uye=(e,t,i,r,s,n)=>{let o=e["s-cr"]&&e["s-cr"].parentNode||e,a;for(o.shadowRoot&&o.tagName===vU&&(o=o.shadowRoot);s<=n;++s)r[s]&&(a=Y4(null,i,s,e),a&&(r[s].$elm$=a,o.insertBefore(a,JX(t))))},hye=(e,t,i,r,s)=>{for(;t<=i;++t)(r=e[t])&&(s=r.$elm$,mye(r),W4=!0,s["s-ol"]?s["s-ol"].remove():AP(s,!0),s.remove())},HNe=(e,t,i,r)=>{let s=0,n=0,o=0,a=0,l=t.length-1,c=t[0],h=t[l],p=r.length-1,m=r[0],g=r[p],v,b;for(;s<=l&&n<=p;)if(c==null)c=t[++s];else if(h==null)h=t[--l];else if(m==null)m=r[++n];else if(g==null)g=r[--p];else if(DL(c,m))ZS(c,m),c=t[++s],m=r[++n];else if(DL(h,g))ZS(h,g),h=t[--l],g=r[--p];else if(DL(c,g))(c.$tag$==="slot"||g.$tag$==="slot")&&AP(c.$elm$.parentNode,!1),ZS(c,g),e.insertBefore(c.$elm$,h.$elm$.nextSibling),c=t[++s],g=r[--p];else if(DL(h,m))(c.$tag$==="slot"||g.$tag$==="slot")&&AP(h.$elm$.parentNode,!1),ZS(h,m),e.insertBefore(h.$elm$,c.$elm$),h=t[--l],m=r[++n];else{for(o=-1,a=s;a<=l;++a)if(t[a]&&t[a].$key$!==null&&t[a].$key$===m.$key$){o=a;break}o>=0?(b=t[o],b.$tag$!==m.$tag$?v=Y4(t&&t[n],i,o,e):(ZS(b,m),t[o]=void 0,v=b.$elm$),m=r[++n]):(v=Y4(t&&t[n],i,n,e),m=r[++n]),v&&dye(c.$elm$).insertBefore(v,JX(c.$elm$))}s>l?uye(e,r[p+1]==null?null:r[p+1].$elm$,i,r,n,p):n>p&&hye(t,s,l)},DL=(e,t)=>e.$tag$===t.$tag$?e.$tag$==="slot"?e.$name$===t.$name$:e.$key$===t.$key$:!1,JX=e=>e&&e["s-ol"]||e,dye=e=>(e["s-ol"]?e["s-ol"]:e).parentNode,ZS=(e,t)=>{const i=t.$elm$=e.$elm$,r=e.$children$,s=t.$children$,n=t.$tag$,o=t.$text$;let a;o===null?(Su=n==="svg"?!0:n==="foreignObject"?!1:Su,n==="slot"||cye(e,t,Su),r!==null&&s!==null?HNe(i,r,t,s):s!==null?(e.$text$!==null&&(i.textContent=""),uye(i,null,t,s,0,s.length-1)):r!==null&&hye(r,0,r.length-1),Su&&n==="svg"&&(Su=!1)):(a=i["s-cr"])?a.parentNode.textContent=o:e.$text$!==o&&(i.data=o)},pye=e=>{let t=e.childNodes,i,r,s,n,o,a;for(r=0,s=t.length;r<s;r++)if(i=t[r],i.nodeType===1){if(i["s-sr"]){for(o=i["s-sn"],i.hidden=!1,n=0;n<s;n++)if(a=t[n].nodeType,t[n]["s-hn"]!==i["s-hn"]||o!==""){if(a===1&&o===t[n].getAttribute("slot")){i.hidden=!0;break}}else if(a===1||a===3&&t[n].textContent.trim()!==""){i.hidden=!0;break}}pye(i)}},_p=[],fye=e=>{let t,i,r,s,n,o,a=0,l=e.childNodes,c=l.length;for(;a<c;a++){if(t=l[a],t["s-sr"]&&(i=t["s-cr"])&&i.parentNode)for(r=i.parentNode.childNodes,s=t["s-sn"],o=r.length-1;o>=0;o--)i=r[o],!i["s-cn"]&&!i["s-nr"]&&i["s-hn"]!==t["s-hn"]&&(Rte(i,s)?(n=_p.find(h=>h.$nodeToRelocate$===i),W4=!0,i["s-sn"]=i["s-sn"]||s,n?n.$slotRefNode$=t:_p.push({$slotRefNode$:t,$nodeToRelocate$:i}),i["s-sr"]&&_p.map(h=>{Rte(h.$nodeToRelocate$,i["s-sn"])&&(n=_p.find(p=>p.$nodeToRelocate$===i),n&&!h.$slotRefNode$&&(h.$slotRefNode$=n.$slotRefNode$))})):_p.some(h=>h.$nodeToRelocate$===i)||_p.push({$nodeToRelocate$:i}));t.nodeType===1&&fye(t)}},Rte=(e,t)=>e.nodeType===1?e.getAttribute("slot")===null&&t===""||e.getAttribute("slot")===t:e["s-sn"]===t?!0:t==="",mye=e=>{e.$attrs$&&e.$attrs$.ref&&e.$attrs$.ref(null),e.$children$&&e.$children$.map(mye)},qNe=(e,t)=>{const i=e.$hostElement$,r=e.$cmpMeta$,s=e.$vnode$||X4(null,null),n=lye(t)?t:aye(null,null,t);vU=i.tagName,r.$attrsToReflect$&&(n.$attrs$=n.$attrs$||{},r.$attrsToReflect$.map(([o,a])=>n.$attrs$[a]=i[o])),n.$tag$=null,n.$flags$|=4,e.$vnode$=n,n.$elm$=s.$elm$=i.shadowRoot||i,WS=i["s-sc"],rye=i["s-cr"],sye=Z4&&(r.$flags$&1)!==0,W4=!1,ZS(s,n);{if(Pa.$flags$|=1,YX){fye(n.$elm$);let o,a,l,c,h,p,m=0;for(;m<_p.length;m++)o=_p[m],a=o.$nodeToRelocate$,a["s-ol"]||(l=Up.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(m=0;m<_p.length;m++)if(o=_p[m],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,h=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(p=l["s-nr"],p&&p["s-sn"]===a["s-sn"]&&c===p.parentNode&&(p=p.nextSibling,!p||!p["s-nr"])){h=p;break}(!h&&c!==a.parentNode||a.nextSibling!==h)&&a!==h&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,h))}else a.nodeType===1&&(a.hidden=!0)}W4&&pye(n.$elm$),Pa.$flags$&=-2,_p.length=0}},WNe=e=>Xi.lazyLoad?WC(e).$hostElement$:e,o1t=(e,t,i)=>{const r=WNe(e);return{emit:s=>(Xi.isDev&&!r.isConnected&&_ye(`The "${t}" event was emitted, but the dispatcher node is no longer connected to the dom.`),ZNe(r,t,{bubbles:!!(i&4),composed:!!(i&2),cancelable:!!(i&1),detail:s}))}},ZNe=(e,t,i)=>{const r=Pa.ce(t,i);return e.dispatchEvent(r),r},XNe=(e,t)=>{},KX=(e,t)=>(e.$flags$|=16,XNe(e,e.$ancestorComponent$),mFe(()=>YNe(e,t))),YNe=(e,t)=>{const i=e.$hostElement$,r=Fx("scheduleUpdate",e.$cmpMeta$.$tagName$),s=i;let n;return t?n=aE(s,"componentWillLoad"):n=aE(s,"componentWillUpdate"),n=Mte(n,()=>aE(s,"componentWillRender")),r(),Mte(n,()=>QNe(e,s,t))},QNe=async(e,t,i)=>{const r=e.$hostElement$,s=Fx("update",e.$cmpMeta$.$tagName$);r["s-rc"],i&&DNe(e);const n=Fx("render",e.$cmpMeta$.$tagName$);JNe(e,t,r),n(),s(),KNe(e)},JNe=(e,t,i)=>{try{xte=t,t=t.render&&t.render(),e.$flags$&=-17,e.$flags$|=2,(Xi.hasRenderFn||Xi.reflect)&&(Xi.vdomRender||Xi.reflect)&&(Xi.hydrateServerSide||qNe(e,t))}catch(a){X3(a,e.$hostElement$)}return xte=null,null},KNe=e=>{const t=e.$cmpMeta$.$tagName$,i=e.$hostElement$,r=Fx("postUpdate",t),s=i;e.$ancestorComponent$,aE(s,"componentDidRender"),e.$flags$&64?(aE(s,"componentDidUpdate"),r()):(e.$flags$|=64,aE(s,"componentDidLoad"),r())},a1t=e=>{if(Xi.updatable){const t=WC(e),i=t.$hostElement$.isConnected;return i&&(t.$flags$&18)===2&&KX(t,!1),i}return!1},aE=(e,t,i)=>{if(e&&e[t])try{return e[t](i)}catch(r){X3(r)}},Mte=(e,t)=>e&&e.then?e.then(t):t(),eFe=(e,t)=>e!=null&&!QX(e)?t&4?e==="false"?!1:e===""||!!e:t&2?parseFloat(e):t&1?String(e):e:e,tFe=(e,t)=>WC(e).$instanceValues$.get(t),iFe=(e,t,i,r)=>{const s=WC(e),n=e,o=s.$instanceValues$.get(t),a=s.$flags$,l=n;i=eFe(i,r.$members$[t][0]);const c=Number.isNaN(o)&&Number.isNaN(i);if(i!==o&&!c){s.$instanceValues$.set(t,i);{if(r.$watchers$&&a&128){const p=r.$watchers$[t];p&&p.map(m=>{try{l[m](i,o,t)}catch(g){X3(g,n)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(i,o,t)===!1)return;KX(s,!1)}}}},rFe=(e,t,i)=>{if(t.$members$){e.watchers&&(t.$watchers$=e.watchers);const r=Object.entries(t.$members$),s=e.prototype;r.map(([n,[o]])=>{(o&31||o&32)&&Object.defineProperty(s,n,{get(){return tFe(this,n)},set(a){iFe(this,n,a,t)},configurable:!0,enumerable:!0})});{const n=new Map;s.attributeChangedCallback=function(o,a,l){Pa.jmp(()=>{const c=n.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(s.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},e.observedAttributes=r.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return n.set(l,o),a[0]&512&&t.$attrsToReflect$.push([o,l]),l})}}return e},sFe=async(e,t,i,r,s)=>{if((t.$flags$&32)===0&&(s=e.constructor,t.$flags$|=32,customElements.whenDefined(i.$tagName$).then(()=>t.$flags$|=128),s.style)){let o=s.style;typeof o!="string"&&(o=o[t.$modeName$=NNe(e)]);const a=oye(i,t.$modeName$);if(!Q4.has(a)){const l=Fx("registerStyles",i.$tagName$);LNe(a,o,!!(i.$flags$&1)),l()}}t.$ancestorComponent$,(()=>KX(t,!0))()},nFe=e=>{},oFe=e=>{if((Pa.$flags$&1)===0){const t=WC(e),i=t.$cmpMeta$,r=Fx("connectedCallback",i.$tagName$);t.$flags$&1?(nye(e,t,i.$listeners$),nFe(t.$lazyInstance$)):(t.$flags$|=1,i.$flags$&12&&aFe(e),i.$members$&&Object.entries(i.$members$).map(([s,[n]])=>{if(n&31&&e.hasOwnProperty(s)){const o=e[s];delete e[s],e[s]=o}}),sFe(e,t,i)),r()}},aFe=e=>{const t=e["s-cr"]=Up.createComment("");t["s-cn"]=!0,e.insertBefore(t,e.firstChild)},lFe=e=>{if((Pa.$flags$&1)===0){const t=WC(e);t.$rmListeners$&&(t.$rmListeners$.map(i=>i()),t.$rmListeners$=void 0)}},l1t=(e,t)=>{const i={$flags$:t[0],$tagName$:t[1]};Xi.member&&(i.$members$=t[2]),Xi.hostListener&&(i.$listeners$=t[3]),Xi.watchCallback&&(i.$watchers$=e.$watchers$),Xi.reflect&&(i.$attrsToReflect$=[]),Xi.shadowDom&&!Z4&&i.$flags$&1&&(i.$flags$|=8);const r=e.prototype.connectedCallback,s=e.prototype.disconnectedCallback;return Object.assign(e.prototype,{__registerHost(){uFe(this,i)},connectedCallback(){oFe(this),Xi.connectedCallback&&r&&r.call(this)},disconnectedCallback(){lFe(this),Xi.disconnectedCallback&&s&&s.call(this)},__attachShadow(){Z4?Xi.shadowDelegatesFocus?this.attachShadow({mode:"open",delegatesFocus:!!(i.$flags$&16)}):this.attachShadow({mode:"open"}):this.shadowRoot=this}}),e.is=i.$tagName$,rFe(e,i)},c1t=e=>{const t=new URL(e,Pa.$resourcesUrl$);return t.origin!==qC.location.origin?t.href:t.pathname},cFe=e=>Pa.$resourcesUrl$=e,gye=new WeakMap,WC=e=>gye.get(e),uFe=(e,t)=>{const i={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};return Xi.isDev&&(i.$renderCount$=0),Xi.method&&Xi.lazyLoad&&(i.$onInstancePromise$=new Promise(r=>i.$onInstanceResolve$=r)),Xi.asyncLoading&&(i.$onReadyPromise$=new Promise(r=>i.$onReadyResolve$=r),e["s-p"]=[],e["s-rc"]=[]),nye(e,i,t.$listeners$),gye.set(e,i)},Pte=(e,t)=>t in e,X3=(e,t)=>(0,console.error)(e,t),yye=Xi.isTesting?["STENCIL:"]:["%cstencil","color: white;background:#4c47ff;font-weight: bold; font-size:10px; padding:2px 6px; border-radius: 5px"],hFe=(...e)=>console.error(...yye,...e),_ye=(...e)=>console.warn(...yye,...e),Q4=new Map,dFe=[],Ite=[],vye=[],pFe=(e,t)=>i=>{e.push(i),xj||(xj=!0,t&&Pa.$flags$&4?fFe(Tj):Pa.raf(Tj))},Lte=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(i){X3(i)}e.length=0},Tj=()=>{Lte(Ite),Lte(vye),(xj=Ite.length>0)&&Pa.raf(Tj)},fFe=e=>ONe().then(e),mFe=pFe(vye,!0),u1t={isDev:!!Xi.isDev,isBrowser:!0,isServer:!1,isTesting:!!Xi.isTesting};let bye;function gFe(){cFe(cd(tr(bye)))}bye="components/assets";const wye=Symbol("widget"),yFe=[],_Fe={},J4=new WeakMap;function xye(e,t){let i=t.children;if(i&&i.length)for(let s=0;s<i.length;++s)i[s]=xye(e,i[s]);else i=yFe;const r=t.vnodeSelector;if(eY(r)){const s=t.properties||_Fe,n=s.key||r;return{vnodeSelector:"div",properties:{key:n,afterCreate:vFe,afterUpdate:bFe,afterRemoved:Tye,parentWidget:e,widgetConstructor:r,widgetProperties:{...s,key:n,children:i}},children:void 0,text:void 0,domNode:null}}return t}function vFe(e,t,i,{parentWidget:r,widgetConstructor:s,widgetProperties:n}){var a;const o=new s(n);o.container=e,J4.set(e,o),(a=o.afterCreate)==null||a.call(o,o,e),r._internalHandles.add(md(()=>Tye(e)))}function bFe(e,t,i,{widgetProperties:r}){var n;const s=J4.get(e);s&&(s.set(r),(n=s.afterUpdate)==null||n.call(s,s,e))}function Tye(e){const t=J4.get(e);t&&(t.destroy(),J4.delete(e))}function eY(e){return typeof e=="function"&&e[wye]}const $te=new Set;function wFe(e){$te.add(e),e.finally(()=>$te.delete(e))}const Sye="esri.widgets.Widget",xFe=Ie.getLogger(Sye);let TFe=0;const SFe={widgetIcon:"esri-icon-checkbox-unchecked"};function Eye(e,t){for(const i in t)e[i]!=null&&(typeof e[i]=="object"&&typeof t[i]=="object"?Eye(e[i],t[i]):e[i]=t[i]);return e}const EFe=CNe({postProcessProjectionOptions(e){const t=e.eventHandlerInterceptor,i=/capture$/i;e.eventHandlerInterceptor=(r,s,n,o)=>{const a=t(r,s,n,o),l=i.test(r);if(!((r=r.replace(i,"")).toLowerCase()in n)||l){const c=r[2].toLowerCase()+r.slice(3),h=g=>a.call(n,g);n.addEventListener(c,h,l);const p=()=>n.removeEventListener(c,h,l),m=o.afterRemoved;o.afterRemoved=g=>{m==null||m(g),p()}}return a}},handleInterceptedEvent(e,t,i,r){const{eventPhase:s,type:n}=r,o=s===Event.CAPTURING_PHASE;let a=`on${n}${o?"capture":""}`;const l=t.properties;(a in l||(a=`on${n[0].toUpperCase()}${n.slice(1)}${o?"Capture":""}`,a in l))&&(Wge(),e.scheduleRender(),l[a].call(l.bind||i,r))}});let LV=!1,eo=class extends Qk(ks.EventedAccessor){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new xi,this._projector=EFe,this._readyForTrueRender=!1,this.domNode=null,this.iconClass=SFe.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=khe(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const n=await cl(this._messageBundleProps.map(async({bundlePath:o,propertyName:a})=>{let l=await Hfe(o);this.uiStrings&&Object.keys(this.uiStrings)&&(l=Eye(me(l),this.uiStrings)),this[a]=l}));for(const o of n)o.error&&xFe.error("widget-intl:locale-error",this.declaredClass,o.error)}await this.loadLocale()}),gFe();const i="esri-widget-uid-"+bNe(),r=this.render.bind(this);this._trackingTarget=new Lk(()=>this.scheduleRender());const s=()=>{var h;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:i,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const n=r();let{properties:o}=n;o||(n.properties=o={});let{key:a,styles:l}=o;a||(o.key=i),l||(o.styles=l={}),l.display||(l.display="");let c=0;return(h=n.children)==null||h.forEach(p=>{if(eY(p.vnodeSelector))return;let{properties:m}=p;m||(p.properties=m={}),m.key||(m.key=`${this.id}--${c++}`)}),xye(this,n)};this.render=()=>{if(LV)return s();let n=JDe(this);if(n)return n;this._trackingTarget.clear(),LV=!0;try{n=zy(this._trackingTarget,s)}catch(o){throw console.error(o),o}finally{LV=!1}return KDe(this,n),n},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),wFe(this._resourcesFetch)}normalizeCtorArgs(e,t){const i={...e};return t&&(i.container=t),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(sG)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(Tt(this._trackingTarget),Tt(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,PV(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return iU(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+TFe++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||(PV(this),this._projector.scheduleRender())}classes(...e){return Xge.apply(this,e)}renderNow(){PV(this),this._projector.renderNow()}_postInitialize(){var t;if(this.destroyed)return;this.scheduleRender(),(t=this._delegatedEventNames)!=null&&t.length&&this._internalHandles.add(xe(()=>this.viewModel,(i,r)=>{r&&this._internalHandles.remove("delegated-events"),i&&Pk(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>F3(i,s,n=>{this.emit(s,n)})),"delegated-events")},si)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(sG),this.scheduleRender()};this._internalHandles.add([lMe(e),xe(()=>this.uiStrings,e),Jl(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};eo[wye]=!0,u([f()],eo.prototype,"_readyForTrueRender",void 0),u([f({value:null})],eo.prototype,"container",null),u([pi("container")],eo.prototype,"castContainer",null),u([f({aliasOf:"container"})],eo.prototype,"domNode",void 0),u([f()],eo.prototype,"iconClass",void 0),u([f()],eo.prototype,"id",null),u([f()],eo.prototype,"label",void 0),u([f()],eo.prototype,"renderable",null),u([f()],eo.prototype,"uiStrings",void 0),u([f()],eo.prototype,"viewModel",void 0),u([f()],eo.prototype,"visible",void 0),u([f()],eo.prototype,"key",void 0),u([f()],eo.prototype,"children",void 0),u([f()],eo.prototype,"afterCreate",void 0),u([f()],eo.prototype,"afterUpdate",void 0),u([f()],eo.prototype,"afterRemoved",void 0),eo=u([B(Sye)],eo);const dl=eo;function CFe(e,t,i){return e.units[t][i]}function bU(e,t,i,r=2,s="abbr"){return`${Am(t,{minimumFractionDigits:r,maximumFractionDigits:r})} ${CFe(e,i,s)}`}function h1t(e,t,i,r=2,s="abbr"){const n=EIe(t,i);return bU(e,En(t,i,n),n,r,s)}function d1t(e,t,i,r=2,s="abbr"){const n=CIe(t,i);return bU(e,En(t,i,n),n,r,s)}function p1t(e,t,i,r=2,s="abbr"){const n=AIe(t,i);return bU(e,En(t,i,n),n,r,s)}function f1t(e,t,i,r=2,s="abbr"){const n=OIe(t,i);return bU(e,En(t,i,n),n,r,s)}const Dte=["B","kB","MB","GB","TB"];function AFe(e,t){let i=t===0?0:Math.floor(Math.log(t)/Math.log(qE.KILOBYTES));i=Xe(i,0,Dte.length-1);const r=Am(t/qE.KILOBYTES**i,{maximumFractionDigits:2});return Sm(e.units.bytes[Dte[i]],{fileSize:r})}function OFe(e){const{exifInfo:t,exifName:i,tagName:r}=e;if(!t||!i||!r)return null;const s=t.find(n=>n.name===i);return s?RFe({tagName:r,tags:s.tags}):null}function RFe(e){const{tagName:t,tags:i}=e;if(!i||!t)return null;const r=i.find(s=>s.name===t);return r&&r.value||null}var Sj;const MFe={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let pc=Sj=class extends Fe{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=OFe({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return MFe[t]||null}clone(){return new Sj({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};u([f({type:String})],pc.prototype,"contentType",void 0),u([f()],pc.prototype,"exifInfo",void 0),u([f({readOnly:!0})],pc.prototype,"orientationInfo",null),u([f({type:cs})],pc.prototype,"id",void 0),u([f({type:String})],pc.prototype,"globalId",void 0),u([f({type:String})],pc.prototype,"keywords",void 0),u([f({type:String})],pc.prototype,"name",void 0),u([f({json:{read:!1}})],pc.prototype,"parentGlobalId",void 0),u([f({json:{read:!1}})],pc.prototype,"parentObjectId",void 0),u([f({type:cs})],pc.prototype,"size",void 0),u([f({json:{read:!1}})],pc.prototype,"url",void 0),pc=Sj=u([B("esri.layers.support.AttachmentInfo")],pc);const PFe=pc;var Ej;let Xo=Ej=class extends Fe{constructor(e){super(e),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new Ej(me({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};u([f({type:[String],json:{write:!0}})],Xo.prototype,"attachmentTypes",void 0),u([f({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Xo.prototype,"attachmentsWhere",void 0),u([f({type:Boolean,json:{write:!0}})],Xo.prototype,"cacheHint",void 0),u([f({type:[String],json:{write:!0}})],Xo.prototype,"keywords",void 0),u([f({type:[Number],json:{write:!0}})],Xo.prototype,"globalIds",void 0),u([f({json:{write:!0}})],Xo.prototype,"name",void 0),u([f({type:Number,json:{read:{source:"resultRecordCount"}}})],Xo.prototype,"num",void 0),u([f({type:[Number],json:{write:!0}})],Xo.prototype,"objectIds",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],Xo.prototype,"returnMetadata",void 0),u([f({type:[Number],json:{write:!0}})],Xo.prototype,"size",void 0),u([f({type:Number,json:{read:{source:"resultOffset"}}})],Xo.prototype,"start",void 0),u([ut("start"),ut("num")],Xo.prototype,"writeStart",null),u([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Xo.prototype,"where",void 0),Xo=Ej=u([B("esri.rest.support.AttachmentQuery")],Xo),Xo.from=hn(Xo);const Cj=Xo,IFe="esri.widgets.Feature.support.featureUtils",Nte=Ie.getLogger(IFe),LFe=/href=(""|'')/gi,$Fe=/(\{([^\{\r\n]+)\})/g,DFe=/\'/g,Cye=/^\s*expression\//i,NFe=/(\n)/gi,FFe=/[\u00A0-\u9999<>\&]/gim,kFe=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,UFe=/^(?:mailto:|tel:)/,Aye="relationships/",Aj=Uk("short-date-short-time");function Oye(e){if(!N(e))return e.get("sourceLayer")||e.get("layer")}async function K4(e,t){return typeof e=="function"?e.call(null,t):e}function Rye(e=""){if(e)return!UFe.test(e.trim().toLowerCase())}function Mye(e){return!!e&&Cye.test(e)}function zFe(e,t){if(!Mye(t)||!e)return null;const i=t.replace(Cye,"").toLowerCase();let r;return e.some(s=>s.name.toLowerCase()===i&&(r=s,!0)),r}function Pye(e,t){const i=zFe(t,e==null?void 0:e.fieldName);return i?i.title||null:e?e.label||e.fieldName:null}function BFe(e,t){const i=t.get(e.toLowerCase());return`{${i&&i.fieldName||e}}`}function VFe(e){return e.replace(LFe,"")}function e5(e,t){const i=tY(t,e);return i?i.name:e}function GFe(e,t){return e&&e.map(i=>e5(i,t))}function tY(e,t){return e&&typeof e.getField=="function"?e.getField(t):null}function Iye(e){return`${e}`.trim()}function Gw({attributes:e,globalAttributes:t,layer:i,text:r,expressionAttributes:s,fieldInfoMap:n}){return r?Oj({formattedAttributes:t,template:WFe(r,{...t,...s,...e},i),fieldInfoMap:n}):""}function Oj({formattedAttributes:e,template:t,fieldInfoMap:i}){return Iye(VFe(Sm(Sm(t,r=>BFe(r,i)),e)))}function jFe(e,t,i=!1){const r=t[e];if(typeof r=="string"){const s="%27",n=(i?encodeURIComponent(r):r).replace(DFe,s);t[e]=n}}function HFe(e,t=!1){const i={...e};return Object.keys(i).forEach(r=>jFe(r,i,t)),i}function qFe(e,t,i){const r=(t=Iye(t))&&t[0]!=="{";return Sm(e,HFe(i,r))}function Rj(e,t){return e.replace($Fe,(i,r,s)=>{const n=tY(t,s);return n?`{${n.name}}`:r})}function WFe(e,t,i){const r=Rj(e,i);return r&&r.replace(kFe,(s,n,o)=>qFe(s,n||o,t))}function ZFe(e,t){if(typeof e=="string"&&t&&t.dateFormat==null&&(t.places!=null||t.digitSeparator!=null)){const i=Number(e);if(!isNaN(i))return i}return e}function XFe(e){return(e==null?void 0:e.type)==="feature"}function Fte(e){return!!(e!=null&&e.layer)}function YFe(e){return(e==null?void 0:e.type)==="map-image"}function QFe(e,t){var c;const i=t.fieldInfos,r=t.fieldName,s=(c=Lye(i,r))==null?void 0:c.clone(),n=t.preventPlacesFormatting,o=t.layer,a=tY(o,r);if(s&&(a==null?void 0:a.type)==="date"){const h=s.format||new I2;h.dateFormat=h.dateFormat||"short-date-short-time",h.dateTimeFormatOptions=!Fte(o)&&XFe(o)&&o.datesInUnknownTimezone||Fte(o)&&YFe(o.layer)&&o.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,s.format=h}const l=s&&s.format;return typeof e=="string"&&dpe(r)&&l?l.formatRasterPixelValue(e):typeof(e=ZFe(e,l))=="string"||e==null||l==null?Y3(e):n?Am(e,{...ype(l),minimumFractionDigits:0,maximumFractionDigits:20}):l.format(e)}function Lye(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some(s=>!(!s.fieldName||s.fieldName.toLowerCase()!==i)&&(r=s,!0)),r}function JFe({fieldName:e,graphic:t,layer:i}){if(by(e)||!i||typeof i.getFeatureType!="function")return null;const{typeIdField:r}=i;if(!r||e!==r)return null;const s=i.getFeatureType(t);return s?s.name:null}function KFe({fieldName:e,value:t,graphic:i,layer:r}){if(by(e)||!r||typeof r.getFieldDomain!="function")return null;const s=r.getFieldDomain(e,{feature:i});return s&&s.type==="coded-value"?s.getName(t):null}function e4e(e,t){const{creatorField:i,creationDateField:r,editorField:s,editDateField:n}=e;if(!t)return;const o=t[n];if(typeof o=="number"){const l=t[s];return{type:"edit",date:Cm(o,Aj),user:l}}const a=t[r];if(typeof a=="number"){const l=t[i];return{type:"create",date:Cm(a,Aj),user:l}}return null}function t4e(e,t){const i=new Map;return e&&e.forEach(r=>{const s=e5(r.fieldName,t);r.fieldName=s,i.set(s.toLowerCase(),r)}),i}function kte(e){const t=[];if(!e)return t;const{fieldInfos:i,content:r}=e;return i&&t.push(...i),r&&Array.isArray(r)&&r.forEach(s=>{if(s.type==="fields"){const n=s&&s.fieldInfos;n&&t.push(...n)}}),t}function iY(e){return e.replace(FFe,t=>`&#${t.charCodeAt(0)};`)}function Y3(e){return typeof e=="string"?e.replace(NFe,'<br class="esri-text-new-line" />'):e}function $ye(e){const{value:t,fieldName:i,fieldInfos:r,fieldInfoMap:s,layer:n,graphic:o}=e;if(t==null)return"";const a=KFe({fieldName:i,value:t,graphic:o,layer:n});if(a)return a;const l=JFe({fieldName:i,graphic:o,layer:n});if(l)return l;if(s.get(i.toLowerCase()))return QFe(t,{fieldInfos:r||Array.from(s.values()),fieldName:i,layer:n});const c=n&&n.fieldsIndex;return c&&c.isDateField(i)?Cm(t,Aj):Y3(t)}function $V({fieldInfos:e,attributes:t,layer:i,graphic:r,fieldInfoMap:s,relatedInfos:n}){const o={};return n==null||n.forEach(a=>o4e({attributes:o,relatedInfo:a,fieldInfoMap:s,fieldInfos:e,layer:i})),Object.keys(t).forEach(a=>{const l=t[a];o[a]=$ye({fieldName:a,fieldInfos:e,fieldInfoMap:s,layer:i,value:l,graphic:r})}),o}async function i4e(e,t){var h,p;const{layer:i,graphic:r,outFields:s,objectIds:n,returnGeometry:o,spatialReference:a}=e,l=n[0];if(typeof l!="number"&&typeof l!="string"){const m="Could not query required fields for the specified feature. The feature's ID is invalid.",g={layer:i,graphic:r,objectId:l,requiredFields:s};return Nte.warn(m,g),null}if(!((p=(h=i.capabilities)==null?void 0:h.operations)!=null&&p.supportsQuery)){const m="The specified layer cannot be queried. The following fields will not be available.",g={layer:i,graphic:r,requiredFields:s,returnGeometry:o};return Nte.warn(m,g),null}const c=i.createQuery();return c.objectIds=n,c.outFields=s!=null&&s.length?s:[i.objectIdField],c.returnGeometry=!!o,c.returnZ=!!o,c.returnM=!!o,c.outSpatialReference=a,(await i.queryFeatures(c,t)).features[0]}async function r4e(e){var r;if(!((r=e.expressionInfos)!=null&&r.length))return!1;const t=await Em(),{arcadeUtils:{hasGeometryFunctions:i}}=t;return i(e)}async function s4e({graphic:e,popupTemplate:t,layer:i,spatialReference:r},s){if(!i||!t||(typeof i.load=="function"&&await i.load(s),!e.attributes))return;const n=e.attributes[i.objectIdField];if(n==null)return;const o=[n],a=await t.getRequiredFields(i.fieldsIndex),l=nMe(a,e),c=l?[]:a,h=t.returnGeometry||await r4e(t);if(l&&!h)return;const p=await i4e({layer:i,graphic:e,outFields:c,objectIds:o,returnGeometry:h,spatialReference:r},s);p&&(p.geometry&&(e.geometry=p.geometry),p.attributes&&(e.attributes={...e.attributes,...p.attributes}))}function by(e=""){return!!e&&e.includes(Aye)}function n4e(e){return e?`${Aye}${e.layerId}/${e.fieldName}`:""}function Ute({attributes:e,graphic:t,relatedInfo:i,fieldInfos:r,fieldInfoMap:s,layer:n}){e&&t&&i&&Object.keys(t.attributes).forEach(o=>{const a=n4e({layerId:i.relation.id.toString(),fieldName:o}),l=t.attributes[o];e[a]=$ye({fieldName:a,fieldInfos:r,fieldInfoMap:s,layer:n,value:l,graphic:t})})}function o4e({attributes:e,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s}){e&&t&&(t.relatedFeatures&&t.relatedFeatures&&t.relatedFeatures.forEach(n=>Ute({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})),t.relatedStatsFeatures&&t.relatedStatsFeatures&&t.relatedStatsFeatures.forEach(n=>Ute({attributes:e,graphic:n,relatedInfo:t,fieldInfoMap:i,fieldInfos:r,layer:s})))}const zte=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Dye=({layer:e,method:t,query:i,definitionExpression:r})=>{var o,a;if(!((a=(o=e.capabilities)==null?void 0:o.query)!=null&&a.supportsCacheHint)||t==="attachments")return;const s=w(i.where)&&i.where,n=w(i.geometry)&&i.geometry;zte(r)||zte(s)||(n==null?void 0:n.type)==="extent"||i.resultType==="tile"||(i.cacheHint=!0)},a4e=({query:e,layer:t,method:i})=>{Dye({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},l4e=({queryPayload:e,layer:t,method:i})=>{Dye({layer:t,method:i,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression}`})},Bte={editing:!1,operations:{add:!0,update:!0,delete:!0}},Nye=zt.ofType(PFe),c4e="graphic.layer.capabilities.operations.supportsResizeAttachments";let Qd=class extends ze{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities={...Bte},this.activeAttachmentInfo=null,this.attachmentInfos=new Nye,this.graphic=null,this.mode="view",this.own(xe(()=>this.graphic,()=>this._graphicChanged(),si))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(e){return{...Bte,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get(c4e)||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t}=this;if(!e||typeof e.queryAttachments!="function")throw new se("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getFeatureId(),r=new Cj({objectIds:[i],returnMetadata:!0}),s=[],n=e.queryAttachments(r).then(a=>a[i]||s).catch(()=>s);this._getAttachmentsPromise=n,this.notifyChange("state");const o=await n;return t.removeAll(),o.length&&t.addMany(o),this._getAttachmentsPromise=null,this.notifyChange("state"),o}async addAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new se("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!s.operations.add)throw new se("invalid-abilities","addAttachment(): add abilities are required.");if(!t||typeof t.addAttachment!="function")throw new se("invalid-layer","addAttachment(): A valid layer is required.");const n=t.addAttachment(r,e).then(a=>this._queryAttachment(a.objectId)),o=await n;return i.add(o),o}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:i,graphic:r,abilities:s}=this;if(!e)throw new se("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!s.operations.delete)throw new se("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!t||typeof t.deleteAttachments!="function")throw new se("invalid-layer","deleteAttachment(): A valid layer is required.");const n=t.deleteAttachments(r,[e.id]).then(()=>e),o=await n;return i.remove(o),o}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:i,attachmentInfos:r,graphic:s,abilities:n}=this;if(!e)throw new se("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new se("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!n.operations.update)throw new se("invalid-abilities","updateAttachment(): Update abilities are required.");const o=r.findIndex(c=>c===t);if(!i||typeof i.updateAttachment!="function")throw new se("invalid-layer","updateAttachment(): A valid layer is required.");const a=i.updateAttachment(s,t.id,e).then(c=>this._queryAttachment(c.objectId)),l=await a;return r.splice(o,1,l),l}async _queryAttachment(e){if(!e)throw new se("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:t}=this,i=this._getFeatureId(),r=new Cj({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return t.queryAttachments(r).then(s=>s[i][0])}_getFeatureId(){const{_attachmentLayer:e,graphic:t}=this;if(!e||!t)return null;const{objectIdField:i}=e,{attributes:r}=t;return r&&r[i]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:e}=this,t=Oye(e);this._attachmentLayer=t?t.type==="scene"&&w(t.associatedLayer)?t.associatedLayer:t:null}};u([f()],Qd.prototype,"abilities",void 0),u([pi("abilities")],Qd.prototype,"castAbilities",null),u([f()],Qd.prototype,"activeAttachmentInfo",void 0),u([f({readOnly:!0,type:Nye})],Qd.prototype,"attachmentInfos",void 0),u([f({type:ul})],Qd.prototype,"graphic",void 0),u([f()],Qd.prototype,"mode",void 0),u([f({readOnly:!0})],Qd.prototype,"state",null),u([f({readOnly:!0})],Qd.prototype,"supportsResizeAttachments",null),Qd=u([B("esri.widgets.Attachments.AttachmentsViewModel")],Qd);const rY=Qd;function u4e(e){const t=e.toLowerCase();return t==="image/bmp"||t==="image/emf"||t==="image/exif"||t==="image/gif"||t==="image/x-icon"||t==="image/jpeg"||t==="image/png"||t==="image/tiff"||t==="image/x-wmf"}function h4e(e){const t=tr("esri/themes/base/images/files/");return e?e==="text/plain"?`${t}text-32.svg`:e==="application/pdf"?`${t}pdf-32.svg`:e==="text/csv"?`${t}csv-32.svg`:e==="application/gpx+xml"?`${t}gpx-32.svg`:e==="application/x-dwf"?`${t}cad-32.svg`:e==="application/postscript"||e==="application/json"||e==="text/xml"||e==="model/vrml"?`${t}code-32.svg`:e==="application/x-zip-compressed"||e==="application/x-7z-compressed"||e==="application/x-gzip"||e==="application/x-tar"||e==="application/x-gtar"||e==="application/x-bzip2"||e==="application/gzip"||e==="application/x-compress"||e==="application/x-apple-diskimage"||e==="application/x-rar-compressed"||e==="application/zip"?`${t}zip-32.svg`:e.includes("image/")?`${t}image-32.svg`:e.includes("audio/")?`${t}sound-32.svg`:e.includes("video/")?`${t}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${t}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${t}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`}function Hl(e){return(t,i)=>{t.hasOwnProperty("_messageBundleProps")||(t._messageBundleProps=t._messageBundleProps?t._messageBundleProps.slice():[]),t._messageBundleProps.push({bundlePath:e,propertyName:i})}}var d4e=function(e){return{vnodeSelector:"",properties:void 0,children:void 0,text:e.toString(),domNode:null}},Fye=function(e,t){for(var i=0,r=e.length;i<r;i++){var s=e[i];Array.isArray(s)?Fye(s,t):s!=null&&s!==!1&&(s.hasOwnProperty("vnodeSelector")||(s=d4e(s)),t.push(s))}},p4e=function(e,t){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];if(i.length===1&&typeof i[0]=="string")return{vnodeSelector:e,properties:t||void 0,children:void 0,text:i[0],domNode:null};var s=[];return Fye(i,s),{vnodeSelector:e,properties:t||void 0,children:s,text:void 0,domNode:null}};function Te(e,t,...i){return typeof e!="function"||eY(e)?p4e(e,t,...i):e(t,...i)}const Vte={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},gt={base:"esri-attachments",loaderContainer:"esri-attachments__loader-container",loader:"esri-attachments__loader",fadeIn:"esri-attachments--fade-in",container:"esri-attachments__container",containerList:"esri-attachments__container--list",containerPreview:"esri-attachments__container--preview",actions:"esri-attachments__actions",deleteButton:"esri-attachments__delete-button",addAttachmentButton:"esri-attachments__add-attachment-button",errorMessage:"esri-attachments__error-message",items:"esri-attachments__items",item:"esri-attachments__item",itemButton:"esri-attachments__item-button",itemMask:"esri-attachments__item-mask",itemMaskIcon:"esri-attachments__item-mask--icon",itemImage:"esri-attachments__image",itemImageResizable:"esri-attachments__image--resizable",itemLabel:"esri-attachments__label",itemFilename:"esri-attachments__filename",itemChevronIcon:"esri-attachments__item-chevron-icon",itemLink:"esri-attachments__item-link",itemLinkOverlay:"esri-attachments__item-link-overlay",itemLinkOverlayIcon:"esri-attachments__item-link-overlay-icon",itemEditIcon:"esri-attachments__item-edit-icon",itemAddIcon:"esri-attachments__item-add-icon",itemAddButton:"esri-attachments__item-add-button",formNode:"esri-attachments__form-node",fileFieldset:"esri-attachments__file-fieldset",fileLabel:"esri-attachments__file-label",fileName:"esri-attachments__file-name",fileInput:"esri-attachments__file-input",metadata:"esri-attachments__metadata",metadataFieldset:"esri-attachments__metadata-fieldset",progressBar:"esri-attachments__progress-bar",esriWidget:"esri-widget",esriButton:"esri-button",buttonDisabled:"esri-button--disabled",esriButtonSecondary:"esri-button--secondary",esriButtonTertiary:"esri-button--tertiary",esriButtonThird:"esri-button--third",esriButtonSmall:"esri-button--small",esriButtonHalf:"esri-button--half",empty:"esri-widget__content--empty",iconExternalLink:"esri-icon-link-external",iconEdit:"esri-icon-edit",iconRight:"esri-icon-right",iconLeft:"esri-icon-left",iconPlus:"esri-icon-plus"},DV=window.CSS;let za=class extends dl{constructor(e,t){super(e,t),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new rY,this.visibleElements={...Vte},this._supportsImageOrientation=DV&&DV.supports&&DV.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([Fo(()=>{var e;return(e=this.viewModel)==null?void 0:e.attachmentInfos},"change",()=>this.scheduleRender()),xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.mode},()=>this._modeChanged(),si)])}get effectiveDisplayType(){const{displayType:e}=this;return e&&e!=="auto"?e:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(e){return{...Vte,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new se("attachments:add-attachment",this.messages.addErrorMessage,i)),i})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(i=>(this._set("submitting",!1),this._set("error",null),t.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new se("attachments:delete-attachment",this.messages.deleteErrorMessage,i)),i})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(i=>(this._set("submitting",!1),this._set("error",null),e.mode="view",i)).catch(i=>{throw this._set("submitting",!1),this._set("error",new se("attachments:update-attachment",this.messages.updateErrorMessage,i)),i})}render(){const{submitting:e,viewModel:t}=this,{state:i}=t;return Te("div",{class:this.classes(gt.base,gt.esriWidget)},e?this.renderProgressBar():null,i==="loading"?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?Te("div",{key:"error-message",class:gt.errorMessage},e.message):null}renderAttachments(){const{mode:e,activeAttachmentInfo:t}=this.viewModel;return e==="add"?this.renderAddForm():e==="edit"?this.renderDetailsForm(t):this.renderAttachmentContainer()}renderLoading(){return Te("div",{class:gt.loaderContainer,key:"loader"},Te("div",{class:gt.loader}))}renderProgressBar(){return this.visibleElements.progressBar?Te("div",{class:gt.progressBar,key:"progress-bar"}):null}renderAddForm(){const{submitting:e,selectedFile:t}=this,i=e||!t,r=this.visibleElements.cancelAddButton?Te("button",{type:"button",bind:this,disabled:e,onclick:this._cancelForm,class:this.classes(gt.esriButton,gt.esriButtonTertiary,gt.esriButtonSmall,gt.esriButtonHalf,e&&gt.buttonDisabled)},this.messages.cancel):null,s=this.visibleElements.addSubmitButton?Te("button",{type:"submit",disabled:i,class:this.classes(gt.esriButton,gt.esriButtonSecondary,gt.esriButtonSmall,gt.esriButtonHalf,{[gt.buttonDisabled]:i})},this.messages.add):null,n=t?Te("span",{key:"file-name",class:gt.fileName},t.name):null,o=Te("form",{bind:this,afterCreate:yj,afterRemoved:mte,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},Te("fieldset",{class:gt.fileFieldset},n,Te("label",{class:this.classes(gt.fileLabel,gt.esriButton,gt.esriButtonSecondary)},t?this.messages.changeFile:this.messages.selectFile,Te("input",{class:gt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),s,r);return Te("div",{key:"add-form-container",class:gt.formNode},o)}renderDetailsForm(e){const{visibleElements:t,viewModel:i,selectedFile:r,submitting:s}=this,{contentType:n,size:o,url:a}=e,{abilities:l}=i,c=s||!r,h=l.editing&&l.operations.delete&&t.deleteButton?Te("button",{key:"delete-button",type:"button",disabled:s,bind:this,onclick:O=>this._submitDeleteAttachment(O,e),class:this.classes(gt.esriButton,gt.esriButtonSmall,gt.esriButtonTertiary,gt.deleteButton,{[gt.buttonDisabled]:s})},this.messages.delete):null,p=l.editing&&l.operations.update&&t.updateButton?Te("button",{disabled:c,key:"update-button",type:"submit",class:this.classes(gt.esriButton,gt.esriButtonSmall,gt.esriButtonThird,{[gt.buttonDisabled]:c})},this.messages.update):null,m=this.visibleElements.cancelUpdateButton?Te("button",{disabled:s,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes(gt.esriButton,gt.esriButtonSmall,gt.esriButtonTertiary,gt.esriButtonThird,{[gt.buttonDisabled]:s})},this.messages.cancel):null,g=r?Te("span",{key:"file-name",class:gt.fileName},r.name):null,v=l.editing&&l.operations.update?Te("fieldset",{key:"file",class:gt.fileFieldset},g,Te("label",{class:this.classes(gt.fileLabel,gt.esriButton,gt.esriButtonSecondary)},this.messages.changeFile,Te("input",{class:gt.fileInput,type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,b=Te("fieldset",{key:"size",class:gt.metadataFieldset},Te("label",null,AFe(this.messagesUnits,o))),S=Te("fieldset",{key:"content-type",class:gt.metadataFieldset},Te("label",null,n)),T=Te("form",{bind:this,afterCreate:yj,afterRemoved:mte,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},Te("div",{class:gt.metadata},b,S),v,Te("div",{class:gt.actions},h,m,p));return Te("div",{key:"edit-form-container",class:gt.formNode},Te("a",{class:gt.itemLink,href:a,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:e,size:400}),Te("div",{class:gt.itemLinkOverlay},Te("span",{class:gt.itemLinkOverlayIcon},Te("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},Te("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),Te("path",{fill:"none",d:"M0 0h32v32H0z"}))))),T)}renderImageMask({attachmentInfo:e,size:t}){const{supportsResizeAttachments:i}=this.viewModel,{contentType:r,name:s,url:n}=e,o=i&&u4e(r),a=this._getCSSTransform(e,o),l=a?{transform:a,"image-orientation":"none"}:{},c=n.includes("?")?"&":"?",h=o?`${n}${c}w=${t}`:h4e(r),p={[gt.itemMaskIcon]:!o},m={[gt.itemImageResizable]:i};return Te("div",{class:this.classes(p,gt.itemMask)},Te("img",{styles:l,alt:s,src:h,class:this.classes(m,gt.itemImage)}))}renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:i}=this,{abilities:r}=i,{name:s,url:n}=e,o=this.renderImageMask({attachmentInfo:e,size:t==="list"?48:400}),a=r.editing?Te("span",{"aria-hidden":"true",class:this.classes(gt.itemChevronIcon,Ov(this.container)?gt.iconLeft:gt.iconRight)}):null,l=[o,Te("label",{class:gt.itemLabel},Te("span",{class:gt.itemFilename},s||this.messages.noTitle),a)],c=r.editing?Te("button",{key:"details-button",bind:this,class:gt.itemButton,title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":e.id,onclick:()=>this._startEditAttachment(e),type:"button"},l):Te("a",{key:"details-link",class:gt.itemButton,href:n,target:"_blank"},l);return Te("li",{class:gt.item,key:e},c)}renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:i}=this,{attachmentInfos:r,abilities:s}=t,n=r&&r.length,o={[gt.containerList]:e!=="preview",[gt.containerPreview]:e==="preview"},a=s.editing&&s.operations.add&&i.addButton?Te("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes(gt.esriButton,gt.esriButtonTertiary,gt.addAttachmentButton),type:"button"},Te("span",{"aria-hidden":"true",class:this.classes(gt.itemAddIcon,gt.iconPlus)}),this.messages.add):null,l=n?Te("ul",{class:gt.items},r.toArray().map(c=>this.renderAttachmentInfo({attachmentInfo:c,displayType:e}))):Te("div",{class:gt.empty},this.messages.noAttachments);return Te("div",{key:"attachments-container",class:this.classes(gt.container,o)},l,a)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,i=t&&t.files&&t.files.item(0);this._set("selectedFile",i)}_submitDeleteAttachment(e,t){e.preventDefault(),this.deleteAttachment(t)}_submitAddAttachment(e){e.preventDefault(),this.addAttachment()}_submitUpdateAttachment(e){e.preventDefault(),this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeAttachmentInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e,t){const{orientationInfo:i}=e;return!this._supportsImageOrientation&&t&&i?[i.rotation?`rotate(${i.rotation}deg)`:"",i.mirrored?"scaleX(-1)":""].join(" "):""}};u([Lt("viewModel.abilities")],za.prototype,"abilities",void 0),u([f()],za.prototype,"displayType",void 0),u([f({readOnly:!0})],za.prototype,"effectiveDisplayType",null),u([Lt("viewModel.graphic")],za.prototype,"graphic",void 0),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],za.prototype,"label",void 0),u([f(),Hl("esri/widgets/Attachments/t9n/Attachments")],za.prototype,"messages",void 0),u([f(),Hl("esri/core/t9n/Units")],za.prototype,"messagesUnits",void 0),u([f({readOnly:!0})],za.prototype,"selectedFile",void 0),u([f({readOnly:!0})],za.prototype,"submitting",void 0),u([f({readOnly:!0})],za.prototype,"error",void 0),u([f({type:rY})],za.prototype,"viewModel",void 0),u([f()],za.prototype,"visibleElements",void 0),u([pi("visibleElements")],za.prototype,"castVisibleElements",null),za=u([B("esri.widgets.Attachments")],za);const f4e=za;let SR=class extends rY{constructor(e){super(e),this.description=null,this.title=null}};u([f()],SR.prototype,"description",void 0),u([f()],SR.prototype,"title",void 0),SR=u([B("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],SR);const sY=SR,m4e={heading:"esri-widget__heading"};function nY(e,t){const i=g4e(e.level),r=`h${i}`;return delete e.level,Te(r,{...e,class:Xge(m4e.heading,e.class),role:"heading","aria-level":String(i)},t)}function g4e(e){return Xe(Math.ceil(e),1,6)}const NV={base:"esri-feature-element-info",title:"esri-feature-element-info__title",description:"esri-feature-element-info__description"};let XS=class extends dl{constructor(e,t){super(e,t),this.description=null,this.headingLevel=2,this.title=null}render(){return Te("div",{class:NV.base},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:e}=this;return e?Te(nY,{level:this.headingLevel,class:NV.title},e):null}renderDescription(){const{description:e}=this;return e?Te("div",{key:"description",class:NV.description},e):null}};u([f()],XS.prototype,"description",void 0),u([f()],XS.prototype,"headingLevel",void 0),u([f()],XS.prototype,"title",void 0),XS=u([B("esri.widgets.Feature.support.FeatureElementInfo")],XS);const oY=XS,y4e={base:"esri-feature-attachments"};let Ff=class extends dl{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attachmentsWidget=new f4e,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new sY}initialize(){this._featureElementInfo=new oY,this.own([xe(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),si),xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.graphic},e=>this.attachmentsWidget.graphic=e,si)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var t;const{attachmentsWidget:e}=this;return Te("div",{class:y4e.base},(t=this._featureElementInfo)==null?void 0:t.render(),e==null?void 0:e.render())}_setupFeatureElementInfo(){const{description:e,title:t,headingLevel:i}=this;this._featureElementInfo.set({description:e,title:t,headingLevel:i})}};u([f({readOnly:!0})],Ff.prototype,"attachmentsWidget",void 0),u([Lt("viewModel.description")],Ff.prototype,"description",void 0),u([Lt("attachmentsWidget.displayType")],Ff.prototype,"displayType",void 0),u([Lt("viewModel.graphic")],Ff.prototype,"graphic",void 0),u([f()],Ff.prototype,"headingLevel",void 0),u([Lt("viewModel.title")],Ff.prototype,"title",void 0),u([f({type:sY})],Ff.prototype,"viewModel",void 0),Ff=u([B("esri.widgets.Feature.FeatureAttachments")],Ff);const _4e=Ff;let R_=class extends mT(ze){constructor(e){super(e),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add(xe(()=>this.creator,t=>{this._destroyContent(),this._createContent(t)},si))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:e,graphic:t,destroyer:i}=this;e&&(K4(i,{graphic:t}).catch(()=>null),this._set("created",null))}async _createContent(e){const{graphic:t}=this,i=K4(e,{graphic:t}).catch(()=>null);this._loadingPromise=i,this.notifyChange("state");const r=await i;i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",r))}};u([f({readOnly:!0})],R_.prototype,"created",void 0),u([f()],R_.prototype,"creator",void 0),u([f()],R_.prototype,"destroyer",void 0),u([f({type:ul})],R_.prototype,"graphic",void 0),u([f({readOnly:!0})],R_.prototype,"state",null),R_=u([B("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],R_);const t5=R_;function Eu(){return function(e,t){if(!e[t])throw new TypeError(`Cannot auto bind undefined function '${t}'`);return{value:b4e(e[t])}}}function v4e(e){const{type:t}=e;return e instanceof KeyboardEvent||t==="keyup"||t==="keydown"||t==="keypress"}function b4e(e){return function(t,...i){v4e(t)?lNe(t.key)&&(t.preventDefault(),t.stopPropagation(),t.target.click()):e.call(this,t,...i)}}function w4e(e){return e.split(",").map(t=>t.trim())}function x4e(e){return t=>{t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);const i=t._delegatedEventNames,r=Array.isArray(e)?e:w4e(e);i.push(...r)}}const kye="calcite-theme-";function T4e(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}function Uye(){return T4e().startsWith("dark")}function S4e(){return`${kye}${Uye()?"dark":"light"}`}function E4e(e){C4e(e),e.classList.add(S4e())}function C4e(e){Array.from(e.classList).forEach(t=>{t.startsWith(kye)&&e.classList.remove(t)})}function zye(e){return e&&typeof e.render=="function"}function A4e(e){return e&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}const FV={base:"esri-feature-content",loaderContainer:"esri-feature-content__loader-container",loader:"esri-feature-content__loader"};let YS=class extends dl{constructor(e,t){super(e,t),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=i=>{Array.from(i.querySelectorAll("a")).forEach(r=>{Rye(r.href)&&!r.hasAttribute("target")&&r.setAttribute("target","_blank")})}}renderLoading(){return Te("div",{class:FV.loaderContainer,key:"loader"},Te("div",{class:FV.loader}))}renderCreated(){var t;const e=(t=this.viewModel)==null?void 0:t.created;return e?e instanceof HTMLElement?Te("div",{key:e,bind:e,afterCreate:this._attachToNode}):zye(e)?Te("div",{key:e},!e.destroyed&&e.render()):Te("div",{key:e,innerHTML:e,afterCreate:this._addTargetToAnchors}):null}render(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return Te("div",{class:FV.base},e==="loading"?this.renderLoading():this.renderCreated())}_attachToNode(e){const t=this;e.appendChild(t)}};u([Lt("viewModel.creator")],YS.prototype,"creator",void 0),u([Lt("viewModel.graphic")],YS.prototype,"graphic",void 0),u([f({type:t5})],YS.prototype,"viewModel",void 0),YS=u([B("esri.widgets.Feature.FeatureContent")],YS);const kN=YS;let Ug=class extends ze{constructor(e){super(e),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:e,fieldInfos:t}=this,i=[];return t==null||t.forEach(r=>{if(!(!r.hasOwnProperty("visible")||r.visible))return;const s=r.clone();s.label=Pye(s,e),i.push(s)}),i}};u([f()],Ug.prototype,"attributes",void 0),u([f({type:[Epe]})],Ug.prototype,"expressionInfos",void 0),u([f()],Ug.prototype,"description",void 0),u([f({type:[G3]})],Ug.prototype,"fieldInfos",void 0),u([f({readOnly:!0})],Ug.prototype,"formattedFieldInfos",null),u([f()],Ug.prototype,"title",void 0),Ug=u([B("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Ug);const wU=Ug,O4e=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function R4e(e){let t=null;return O4e.some(i=>(i.pattern.test(e)&&(t=i),!!t)),t}function M4e(e,t){if(typeof t!="string"||!t)return t;const i=R4e(t);if(!i)return t;const r=t.match(i.pattern),s=r&&r[2],n=Sm(Sm(i.label,{messages:e,hierPart:s}),{appName:i.appName}),o=i.target?` target="${i.target}"`:"",a=i.target==="_blank"?' rel="noreferrer"':"";return t.replace(i.pattern,`<a${o} href="$1"${a}>${n}</a>`)}const WA={base:"esri-feature-fields",fieldHeader:"esri-feature-fields__field-header",fieldData:"esri-feature-fields__field-data",fieldDataDate:"esri-feature-fields__field-data--date",esriTable:"esri-widget__table"};let Jd=class extends dl{constructor(e,t){super(e,t),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new wU,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new oY,this.own(xe(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),si))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(e,t){const{attributes:i}=this.viewModel,r=e.fieldName,s=e.label||r,n=i?i[r]==null?"":i[r]:"",o=!(!e.format||!e.format.dateFormat),a=typeof n=="number"&&!o?this._forceLTR(n):M4e(this.messagesURIUtils,n),l={[WA.fieldDataDate]:o};return Te("tr",{key:`fields-element-info-row-${r}-${t}`},Te("th",{key:`fields-element-info-row-header-${r}-${t}`,class:WA.fieldHeader,innerHTML:s}),Te("td",{key:`fields-element-info-row-data-${r}-${t}`,class:this.classes(WA.fieldData,l),innerHTML:a}))}renderFields(){const{formattedFieldInfos:e}=this.viewModel;return e!=null&&e.length?Te("table",{class:WA.esriTable,summary:this.messages.fieldsSummary},Te("tbody",null,e.map((t,i)=>this.renderFieldInfo(t,i)))):null}render(){var e;return Te("div",{class:WA.base},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_forceLTR(e){return`&lrm;${e}`}};u([Lt("viewModel.attributes")],Jd.prototype,"attributes",void 0),u([Lt("viewModel.description")],Jd.prototype,"description",void 0),u([Lt("viewModel.expressionInfos")],Jd.prototype,"expressionInfos",void 0),u([Lt("viewModel.fieldInfos")],Jd.prototype,"fieldInfos",void 0),u([Lt("viewModel.title")],Jd.prototype,"title",void 0),u([f({type:wU})],Jd.prototype,"viewModel",void 0),u([f(),Hl("esri/widgets/Feature/t9n/Feature")],Jd.prototype,"messages",void 0),u([f(),Hl("esri/widgets/support/t9n/uriUtils")],Jd.prototype,"messagesURIUtils",void 0),Jd=u([B("esri.widgets.Feature.FeatureFields")],Jd);const Bye=Jd,P4e={maximumFractionDigits:20};function I4e(e){return Am(e,P4e)}var Mj;let Bb=Mj=class extends Fe{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,i){t[i]=e==null?0:e}clone(){return new Mj({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};u([f({type:at,json:{type:[cs],write:!0}})],Bb.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],Bb.prototype,"label",void 0),u([f({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],Bb.prototype,"value",void 0),u([ut("value")],Bb.prototype,"writeValue",null),Bb=Mj=u([B("esri.renderers.visualVariables.support.ColorStop")],Bb);const L4e=Bb;function xU(e,t,i){return cl(e.map((r,s)=>t.apply(i,[r,s])))}async function $4e(e,t,i){return(await cl(e.map((r,s)=>t.apply(i,[r,s])))).map(r=>r.value)}async function Xp(e){if(N(e))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:await e}}catch(t){return{ok:!1,error:t}}}async function m1t(e){try{return{ok:!0,value:await e}}catch(t){return e0(t),{ok:!1,error:t}}}function g1t(e){if(e.ok===!0)return e.value;throw e.error}function Q3(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function D4e(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function N4e(e,t,i,r,s,n,o,a,l,c,h,p,m,g,v,b){const S=new Float32Array(16);return S[0]=e,S[1]=t,S[2]=i,S[3]=r,S[4]=s,S[5]=n,S[6]=o,S[7]=a,S[8]=l,S[9]=c,S[10]=h,S[11]=p,S[12]=m,S[13]=g,S[14]=v,S[15]=b,S}function F4e(e,t){return new Float32Array(e,t,16)}const k4e=Q3();Object.freeze(Object.defineProperty({__proto__:null,create:Q3,clone:D4e,fromValues:N4e,createView:F4e,IDENTITY:k4e},Symbol.toStringTag,{value:"Module"}));const U4e=(e,t)=>{const i=Vm(e,t,0,0,0,0,t,0,0,0,0,t,0,0,0,0,1);return Kl(i,i)},z4e=(e,t)=>{const i=Vm(e,t,0,0,.5-.5*t,0,t,0,.5-.5*t,0,0,t,.5-.5*t,0,0,0,1);return Kl(i,i)},B4e=(e,t)=>{const i=1-t,r=Vm(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return Kl(r,r)},V4e=(e,t)=>{const i=Math.sin(t*Math.PI/180),r=Math.cos(t*Math.PI/180),s=Vm(e,.213+.787*r-.213*i,.715-.715*r-.715*i,.072-.072*r+.928*i,0,.213-.213*r+.143*i,.715+.285*r+.14*i,.072-.072*r-.283*i,0,.213-.213*r-.787*i,.715-.715*r+.715*i,.072+.928*r+.072*i,0,0,0,0,1);return Kl(s,s)},G4e=(e,t)=>{const i=1-2*t,r=Vm(e,i,0,0,t,0,i,0,t,0,0,i,t,0,0,0,1);return Kl(r,r)},j4e=(e,t)=>{const i=Vm(e,.213+.787*t,.715-.715*t,.072-.072*t,0,.213-.213*t,.715+.285*t,.072-.072*t,0,.213-.213*t,.715-.715*t,.072+.928*t,0,0,0,0,1);return Kl(i,i)},H4e=(e,t)=>{const i=1-t,r=Vm(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return Kl(r,r)};class TU{constructor(t,i,r){this.strength=t,this.radius=i,this.threshold=r,this.type="bloom"}interpolate(t,i,r){this.strength=Cc(t.strength,i.strength,r),this.radius=Cc(t.radius,i.radius,r),this.threshold=Cc(t.threshold,i.threshold,r)}clone(){return new TU(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:CM(this.radius),strength:this.strength,threshold:this.threshold}}}class SU{constructor(t){this.radius=t,this.type="blur"}interpolate(t,i,r){this.radius=Math.round(Cc(t.radius,i.radius,r))}clone(){return new SU(this.radius)}toJSON(){return{type:"blur",radius:CM(this.radius)}}}class OP{constructor(t,i){this.type=t,this.amount=i,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.amount=Cc(t.amount,i.amount,r),this._updateMatrix()}clone(){return new OP(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const t=this._colorMatrix||Q3();switch(this.type){case"brightness":this._colorMatrix=U4e(t,this.amount);break;case"contrast":this._colorMatrix=z4e(t,this.amount);break;case"grayscale":this._colorMatrix=B4e(t,this.amount);break;case"invert":this._colorMatrix=G4e(t,this.amount);break;case"saturate":this._colorMatrix=j4e(t,this.amount);break;case"sepia":this._colorMatrix=H4e(t,this.amount)}}}class EU{constructor(t,i,r,s){this.offsetX=t,this.offsetY=i,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(t,i,r){this.offsetX=Cc(t.offsetX,i.offsetX,r),this.offsetY=Cc(t.offsetY,i.offsetY,r),this.blurRadius=Cc(t.blurRadius,i.blurRadius,r),this.color[0]=Math.round(Cc(t.color[0],i.color[0],r)),this.color[1]=Math.round(Cc(t.color[1],i.color[1],r)),this.color[2]=Math.round(Cc(t.color[2],i.color[2],r)),this.color[3]=Cc(t.color[3],i.color[3],r)}clone(){return new EU(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const t=[...this.color];return t[3]*=255,{type:"drop-shadow",xoffset:CM(this.offsetX),yoffset:CM(this.offsetY),blurRadius:CM(this.blurRadius),color:t}}}class CU{constructor(t){this.angle=t,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(t,i,r){this.angle=Cc(t.angle,i.angle,r),this._updateMatrix()}clone(){return new CU(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const t=this._colorMatrix||Q3();this._colorMatrix=V4e(t,this.angle)}}class AU{constructor(t){this.amount=t,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(t,i,r){this.amount=Cc(t.amount,i.amount,r)}clone(){return new AU(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function Cc(e,t,i){return e+(t-e)*i}function CM(e){return Math.round(1e3*eh(e))/1e3}function q4e(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new OP(e.type,0);case"saturate":case"brightness":case"contrast":return new OP(e.type,1);case"opacity":return new AU(1);case"hue-rotate":return new CU(0);case"blur":return new SU(0);case"drop-shadow":return new EU(0,0,0,[...HZ("transparent")]);case"bloom":return new TU(0,0,1)}}function W4e(e,t){const i=e.length>t.length?e:t;return(e.length>t.length?t:e).every((r,s)=>r.type===i[s].type)}function Z4e(e,t){const i=e.length>t.length?e:t,r=e.length>t.length?t:e;for(let s=r.length;s<i.length;s++)r.push(q4e(i[s]))}function X4e(e){const t=e[0];return!!t&&"type"in t}var Gte,jte,Vye={exports:{}};function Gye(e){if(!e||e.length===0)return null;if(typeof e=="string"){const i=Hte(e);return i&&i.length!==0?i:null}const t=e.map(i=>{if(!Number.isFinite(i.scale)||i.scale<=0)throw new se("effect:invalid-scale","scale must be finite and greater than 0",{stop:i});return{scale:i.scale,effects:Hte(i.value)}});t.sort((i,r)=>r.effects.length-i.effects.length);for(let i=0;i<t.length-1;i++){if(!W4e(t[i].effects,t[i+1].effects))throw new se("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:t[i].effects,b:t[i+1].effects});Z4e(t[i].effects,t[i+1].effects)}return t.sort((i,r)=>r.scale-i.scale),t}function Hte(e){let t;if(!e)return[];try{t=Vye.exports.parse(e)}catch(i){throw new se("effect:invalid-syntax","Invalid effect syntax",{value:e,error:i})}return t.map(i=>Y4e(i))}function Y4e(e){try{switch(e.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return Q4e(e);case"opacity":return J4e(e);case"hue-rotate":return K4e(e);case"blur":return e5e(e);case"drop-shadow":return t5e(e);case"bloom":return i5e(e)}}catch(t){throw t.details.filter=e,t}throw new se("effect:unknown-effect",`Effect '${e.name}' is not supported`,{effect:e})}function Q4e(e){let t=1;return ZC(e.parameters,1),e.parameters.length===1&&(t=mp(e.parameters[0])),new OP(e.name,t)}function J4e(e){let t=1;return ZC(e.parameters,1),e.parameters.length===1&&(t=mp(e.parameters[0])),new AU(t)}function K4e(e){let t=0;return ZC(e.parameters,1),e.parameters.length===1&&(t=l5e(e.parameters[0])),new CU(t)}function e5e(e){let t=0;return ZC(e.parameters,1),e.parameters.length===1&&(t=cY(e.parameters[0]),J3(t,e.parameters[0])),new SU(t)}function t5e(e){const t=[];let i=null;for(const r of e.parameters)if(r.type==="color"){if(t.length&&Object.freeze(t),i)throw new se("effect:type-error","Accepts only one color",{});i=c5e(r)}else{const s=cY(r);if(Object.isFrozen(t))throw new se("effect:type-error","<length> parameters not consecutive",{lengths:t});t.push(s),t.length===3&&J3(s,r)}if(t.length<2||t.length>3)throw new se("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${t.length}}`,{lengths:t});return new EU(t[0],t[1],t[2]||0,i||jye("black"))}function i5e(e){let t=1,i=0,r=0;return ZC(e.parameters,3),e.parameters[0]&&(t=mp(e.parameters[0])),e.parameters[1]&&(i=cY(e.parameters[1]),J3(i,e.parameters[1])),e.parameters[2]&&(r=mp(e.parameters[2])),new TU(t,i,r)}function ZC(e,t){if(e.length>t)throw new se("effect:type-error",`Function supports up to ${t} parameters, Actual: ${e.length}`,{parameters:e})}function OU(e){if(e.type==="color")return"<color>";if(e.unit){if(lY[e.unit])return"<length>";if(aY[e.unit])return"<angle>";if(e.unit==="%")return"<percentage>"}return"<double>"}function J3(e,t){if(e<0)throw new se("effect:type-error",`Negative values are not allowed, Actual: ${e}`,{term:t})}function r5e(e){if(e.type!=="quantity"||e.unit!==null)throw new se("effect:type-error",`Expected <double>, Actual: ${OU(e)}`,{term:e})}function s5e(e){if(e.type!=="quantity"||e.unit!==null&&e.unit!=="%")throw new se("effect:type-error",`Expected <double> or <percentage>, Actual: ${OU(e)}`,{term:e})}jte=function(){function e(s,n){function o(){this.constructor=s}o.prototype=n.prototype,s.prototype=new o}function t(s,n,o,a){var l=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(l,t.prototype),l.expected=n,l.found=o,l.location=a,l.name="SyntaxError",l}function i(s,n,o){return o=o||" ",s.length>n?s:(n-=s.length,s+(o+=o.repeat(n)).slice(0,n))}function r(s,n){var o,a={},l=(n=n!==void 0?n:{}).grammarSource,c={start:sg},h=sg,p="none",m=")",g=",",v="(",b="%",S="px",T="cm",O="mm",C="in",M="pt",I="pc",$="deg",U="rad",q="grad",G="turn",Y="#",J=".",X="e",ne=/^[ \t\n\r]/,re=/^[a-z\-]/,ye=/^[0-9a-fA-F]/,pe=/^[+\-]/,z=/^[0-9]/,j=pa("none"),Q=Jr("none",!1),Z=Jr(")",!1),ie=Jr(",",!1),le=pa("whitespace"),K=hh([" ","	",`
`,"\r"],!1,!1),ae=pa("function"),we=Jr("(",!1),Re=pa("identifier"),Ge=hh([["a","z"],"-"],!1,!1),Pe=pa("percentage"),Se=Jr("%",!1),$e=pa("length"),qe=Jr("px",!1),jt=Jr("cm",!1),Ti=Jr("mm",!1),li=Jr("in",!1),Pi=Jr("pt",!1),ct=Jr("pc",!1),Kt=pa("angle"),Fi=Jr("deg",!1),pr=Jr("rad",!1),Je=Jr("grad",!1),ti=Jr("turn",!1),Os=pa("number"),Zs=pa("color"),Dr=Jr("#",!1),ml=hh([["0","9"],["a","f"],["A","F"]],!1,!1),Vo=hh(["+","-"],!1,!1),gn=hh([["0","9"]],!1,!1),ic=Jr(".",!1),R1=Jr("e",!1),g0=function(){return[]},gi=function(te,Ae){return{type:"function",name:te,parameters:Ae||[]}},y0=function(te,Ae){return Ae.length>0?D1(te,Ae,3):[te]},Jm=function(te){return{type:"quantity",value:te.value,unit:te.unit}},Ad=function(te){return{type:"color",colorType:te.type,value:te.value}},_0=function(te){return te},M1=function(){return uh()},ha=function(te){return{value:te,unit:"%"}},P1=function(te){return{value:te,unit:"px"}},Km=function(te){return{value:te,unit:"cm"}},eg=function(te){return{value:te,unit:"mm"}},tg=function(te){return{value:te,unit:"in"}},ig=function(te){return{value:te,unit:"pt"}},Si=function(te){return{value:te,unit:"pc"}},kn=function(te){return{value:te,unit:"deg"}},yn=function(te){return{value:te,unit:"rad"}},_n=function(te){return{value:te,unit:"grad"}},Od=function(te){return{value:te,unit:"turn"}},v0=function(te){return{value:te,unit:null}},ef=function(){return{type:"hex",value:uh()}},b0=function(te){return{type:"function",value:te}},tf=function(){return{type:"named",value:uh()}},Xs=function(){return parseFloat(uh())},de=0,fr=0,Rd=[{line:1,column:1}],da=0,ch=[],vt=0;if("startRule"in n){if(!(n.startRule in c))throw new Error(`Can't start parsing from rule "`+n.startRule+'".');h=c[n.startRule]}function uh(){return s.substring(fr,de)}function Jr(te,Ae){return{type:"literal",text:te,ignoreCase:Ae}}function hh(te,Ae,Ve){return{type:"class",parts:te,inverted:Ae,ignoreCase:Ve}}function w0(){return{type:"end"}}function pa(te){return{type:"other",description:te}}function Qc(te){var Ae,Ve=Rd[te];if(Ve)return Ve;for(Ae=te-1;!Rd[Ae];)Ae--;for(Ve={line:(Ve=Rd[Ae]).line,column:Ve.column};Ae<te;)s.charCodeAt(Ae)===10?(Ve.line++,Ve.column=1):Ve.column++,Ae++;return Rd[te]=Ve,Ve}function rg(te,Ae){var Ve=Qc(te),ci=Qc(Ae);return{source:l,start:{offset:te,line:Ve.line,column:Ve.column},end:{offset:Ae,line:ci.line,column:ci.column}}}function Zt(te){de<da||(de>da&&(da=de,ch=[]),ch.push(te))}function Go(te,Ae,Ve){return new t(t.buildMessage(te,Ae),te,Ae,Ve)}function sg(){var te;return(te=uA())===a&&(te=hA()),te}function uA(){var te,Ae;return vt++,te=de,Us(),s.substr(de,4)===p?(Ae=p,de+=4):(Ae=a,vt===0&&Zt(Q)),Ae!==a?(Us(),fr=te,te=g0()):(de=te,te=a),vt--,te===a&&vt===0&&Zt(j),te}function hA(){var te,Ae;if(te=[],(Ae=x0())!==a)for(;Ae!==a;)te.push(Ae),Ae=x0();else te=a;return te}function x0(){var te,Ae,Ve,ci;return te=de,Us(),(Ae=rf())!==a?(Us(),(Ve=dA())===a&&(Ve=null),Us(),s.charCodeAt(de)===41?(ci=m,de++):(ci=a,vt===0&&Zt(Z)),ci!==a?(Us(),fr=te,te=gi(Ae,Ve)):(de=te,te=a)):(de=te,te=a),te}function dA(){var te,Ae,Ve,ci,Nr,is,mo,rc;if(te=de,(Ae=I1())!==a){for(Ve=[],ci=de,Nr=Us(),s.charCodeAt(de)===44?(is=g,de++):(is=a,vt===0&&Zt(ie)),is===a&&(is=null),mo=Us(),(rc=I1())!==a?ci=Nr=[Nr,is,mo,rc]:(de=ci,ci=a);ci!==a;)Ve.push(ci),ci=de,Nr=Us(),s.charCodeAt(de)===44?(is=g,de++):(is=a,vt===0&&Zt(ie)),is===a&&(is=null),mo=Us(),(rc=I1())!==a?ci=Nr=[Nr,is,mo,rc]:(de=ci,ci=a);fr=te,te=y0(Ae,Ve)}else de=te,te=a;return te}function I1(){var te,Ae;return te=de,(Ae=$1())===a&&(Ae=ng())===a&&(Ae=ar())===a&&(Ae=ds()),Ae!==a&&(fr=te,Ae=Jm(Ae)),(te=Ae)===a&&(te=de,(Ae=T0())!==a&&(fr=te,Ae=Ad(Ae)),te=Ae),te}function Us(){var te,Ae;for(vt++,te=[],ne.test(s.charAt(de))?(Ae=s.charAt(de),de++):(Ae=a,vt===0&&Zt(K));Ae!==a;)te.push(Ae),ne.test(s.charAt(de))?(Ae=s.charAt(de),de++):(Ae=a,vt===0&&Zt(K));return vt--,Ae=a,vt===0&&Zt(le),te}function rf(){var te,Ae,Ve;return vt++,te=de,(Ae=L1())!==a?(s.charCodeAt(de)===40?(Ve=v,de++):(Ve=a,vt===0&&Zt(we)),Ve!==a?(fr=te,te=_0(Ae)):(de=te,te=a)):(de=te,te=a),vt--,te===a&&(Ae=a,vt===0&&Zt(ae)),te}function L1(){var te,Ae,Ve;if(vt++,te=de,Ae=[],re.test(s.charAt(de))?(Ve=s.charAt(de),de++):(Ve=a,vt===0&&Zt(Ge)),Ve!==a)for(;Ve!==a;)Ae.push(Ve),re.test(s.charAt(de))?(Ve=s.charAt(de),de++):(Ve=a,vt===0&&Zt(Ge));else Ae=a;return Ae!==a&&(fr=te,Ae=M1()),vt--,(te=Ae)===a&&(Ae=a,vt===0&&Zt(Re)),te}function $1(){var te,Ae,Ve;return vt++,te=de,Us(),(Ae=Un())!==a?(s.charCodeAt(de)===37?(Ve=b,de++):(Ve=a,vt===0&&Zt(Se)),Ve!==a?(fr=te,te=ha(Ae)):(de=te,te=a)):(de=te,te=a),vt--,te===a&&vt===0&&Zt(Pe),te}function ng(){var te,Ae,Ve;return vt++,te=de,Us(),(Ae=Un())!==a?(s.substr(de,2)===S?(Ve=S,de+=2):(Ve=a,vt===0&&Zt(qe)),Ve!==a?(fr=te,te=P1(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,Us(),(Ae=Un())!==a?(s.substr(de,2)===T?(Ve=T,de+=2):(Ve=a,vt===0&&Zt(jt)),Ve!==a?(fr=te,te=Km(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,Us(),(Ae=Un())!==a?(s.substr(de,2)===O?(Ve=O,de+=2):(Ve=a,vt===0&&Zt(Ti)),Ve!==a?(fr=te,te=eg(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,Us(),(Ae=Un())!==a?(s.substr(de,2)===C?(Ve=C,de+=2):(Ve=a,vt===0&&Zt(li)),Ve!==a?(fr=te,te=tg(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,Us(),(Ae=Un())!==a?(s.substr(de,2)===M?(Ve=M,de+=2):(Ve=a,vt===0&&Zt(Pi)),Ve!==a?(fr=te,te=ig(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,Us(),(Ae=Un())!==a?(s.substr(de,2)===I?(Ve=I,de+=2):(Ve=a,vt===0&&Zt(ct)),Ve!==a?(fr=te,te=Si(Ae)):(de=te,te=a)):(de=te,te=a)))))),vt--,te===a&&vt===0&&Zt($e),te}function ar(){var te,Ae,Ve;return vt++,te=de,(Ae=Un())!==a?(s.substr(de,3)===$?(Ve=$,de+=3):(Ve=a,vt===0&&Zt(Fi)),Ve!==a?(fr=te,te=kn(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,(Ae=Un())!==a?(s.substr(de,3)===U?(Ve=U,de+=3):(Ve=a,vt===0&&Zt(pr)),Ve!==a?(fr=te,te=yn(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,(Ae=Un())!==a?(s.substr(de,4)===q?(Ve=q,de+=4):(Ve=a,vt===0&&Zt(Je)),Ve!==a?(fr=te,te=_n(Ae)):(de=te,te=a)):(de=te,te=a),te===a&&(te=de,(Ae=Un())!==a?(s.substr(de,4)===G?(Ve=G,de+=4):(Ve=a,vt===0&&Zt(ti)),Ve!==a?(fr=te,te=Od(Ae)):(de=te,te=a)):(de=te,te=a)))),vt--,te===a&&(Ae=a,vt===0&&Zt(Kt)),te}function ds(){var te,Ae;return vt++,te=de,Us(),(Ae=Un())!==a?(fr=te,te=v0(Ae)):(de=te,te=a),vt--,te===a&&vt===0&&Zt(Os),te}function T0(){var te,Ae,Ve,ci;if(vt++,te=de,s.charCodeAt(de)===35?(Ae=Y,de++):(Ae=a,vt===0&&Zt(Dr)),Ae!==a){if(Ve=[],ye.test(s.charAt(de))?(ci=s.charAt(de),de++):(ci=a,vt===0&&Zt(ml)),ci!==a)for(;ci!==a;)Ve.push(ci),ye.test(s.charAt(de))?(ci=s.charAt(de),de++):(ci=a,vt===0&&Zt(ml));else Ve=a;Ve!==a?(fr=te,te=ef()):(de=te,te=a)}else de=te,te=a;return te===a&&(te=de,(Ae=x0())!==a&&(fr=te,Ae=b0(Ae)),(te=Ae)===a&&(te=de,(Ae=L1())!==a&&(fr=te,Ae=tf()),te=Ae)),vt--,te===a&&(Ae=a,vt===0&&Zt(Zs)),te}function Un(){var te,Ae,Ve,ci,Nr,is,mo;for(te=de,pe.test(s.charAt(de))?(s.charAt(de),de++):vt===0&&Zt(Vo),Ae=de,Ve=[],z.test(s.charAt(de))?(ci=s.charAt(de),de++):(ci=a,vt===0&&Zt(gn));ci!==a;)Ve.push(ci),z.test(s.charAt(de))?(ci=s.charAt(de),de++):(ci=a,vt===0&&Zt(gn));if(s.charCodeAt(de)===46?(ci=J,de++):(ci=a,vt===0&&Zt(ic)),ci!==a){if(Nr=[],z.test(s.charAt(de))?(is=s.charAt(de),de++):(is=a,vt===0&&Zt(gn)),is!==a)for(;is!==a;)Nr.push(is),z.test(s.charAt(de))?(is=s.charAt(de),de++):(is=a,vt===0&&Zt(gn));else Nr=a;Nr!==a?Ae=Ve=[Ve,ci,Nr]:(de=Ae,Ae=a)}else de=Ae,Ae=a;if(Ae===a)if(Ae=[],z.test(s.charAt(de))?(Ve=s.charAt(de),de++):(Ve=a,vt===0&&Zt(gn)),Ve!==a)for(;Ve!==a;)Ae.push(Ve),z.test(s.charAt(de))?(Ve=s.charAt(de),de++):(Ve=a,vt===0&&Zt(gn));else Ae=a;if(Ae!==a){if(Ve=de,s.charCodeAt(de)===101?(ci=X,de++):(ci=a,vt===0&&Zt(R1)),ci!==a){if(pe.test(s.charAt(de))?(Nr=s.charAt(de),de++):(Nr=a,vt===0&&Zt(Vo)),Nr===a&&(Nr=null),is=[],z.test(s.charAt(de))?(mo=s.charAt(de),de++):(mo=a,vt===0&&Zt(gn)),mo!==a)for(;mo!==a;)is.push(mo),z.test(s.charAt(de))?(mo=s.charAt(de),de++):(mo=a,vt===0&&Zt(gn));else is=a;is!==a?Ve=ci=[ci,Nr,is]:(de=Ve,Ve=a)}else de=Ve,Ve=a;Ve===a&&(Ve=null),fr=te,te=Xs()}else de=te,te=a;return te}function sf(te,Ae){return te.map(function(Ve){return Ve[Ae]})}function D1(te,Ae,Ve){return[te].concat(sf(Ae,Ve))}if((o=h())!==a&&de===s.length)return o;throw o!==a&&de<s.length&&Zt(w0()),Go(ch,da<s.length?s.charAt(da):null,da<s.length?rg(da,da+1):rg(da,da))}return e(t,Error),t.prototype.format=function(s){var n="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<s.length;o++)if(s[o].source===this.location.source){a=s[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source+":"+l.line+":"+l.column;if(a){var h=this.location.end,p=i("",l.line.toString().length),m=a[l.line-1],g=l.line===h.line?h.column:m.length+1;n+=`
 --> `+c+`
`+p+` |
`+l.line+" | "+m+`
`+p+" | "+i("",l.column-1)+i("",g-l.column,"^")}else n+=`
 at `+c}return n},t.buildMessage=function(s,n){var o={literal:function(g){return'"'+l(g.text)+'"'},class:function(g){var v=g.parts.map(function(b){return Array.isArray(b)?c(b[0])+"-"+c(b[1]):c(b)});return"["+(g.inverted?"^":"")+v+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(g){return g.description}};function a(g){return g.charCodeAt(0).toString(16).toUpperCase()}function l(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+a(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+a(v)})}function c(g){return g.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+a(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+a(v)})}function h(g){return o[g.type](g)}function p(g){var v,b,S=g.map(h);if(S.sort(),S.length>0){for(v=1,b=1;v<S.length;v++)S[v-1]!==S[v]&&(S[b]=S[v],b++);S.length=b}switch(S.length){case 1:return S[0];case 2:return S[0]+" or "+S[1];default:return S.slice(0,-1).join(", ")+", or "+S[S.length-1]}}function m(g){return g?'"'+l(g)+'"':"end of input"}return"Expected "+p(s)+" but "+m(n)+" found."},{SyntaxError:t,parse:r}},(Gte=Vye).exports&&(Gte.exports=jte());const aY={deg:1,grad:.9,rad:180/Math.PI,turn:360};function n5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&aY[e.unit]!=null))throw new se("effect:type-error",`Expected <angle>, Actual: ${OU(e)}`,{term:e})}const lY={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function o5e(e){if(e.type!=="quantity"||!(e.value===0&&e.unit===null||e.unit&&lY[e.unit]!=null))throw new se("effect:type-error",`Expected <length>, Actual: ${OU(e)}`,{term:e})}function mp(e){s5e(e);const t=e.value;return J3(t,e),e.unit==="%"?.01*t:t}function a5e(e){return r5e(e),J3(e.value,e),e.value}function l5e(e){return n5e(e),e.value*aY[e.unit]||0}function cY(e){return o5e(e),e.value*lY[e.unit]||0}function c5e(e){switch(e.colorType){case"hex":return EMe(e.value);case"named":return jye(e.value);case"function":return d5e(e.value)}}function jye(e){if(!Rpe(e))throw new se("effect:unknown-color",`color '${e}' isn't valid`,{namedColor:e});return SMe(e)}const u5e=/^rgba?/i,h5e=/^hsla?/i;function d5e(e){if(ZC(e.parameters,4),u5e.test(e.name))return[mp(e.parameters[0]),mp(e.parameters[1]),mp(e.parameters[2]),e.parameters[3]?mp(e.parameters[3]):1];if(h5e.test(e.name))return Mpe(a5e(e.parameters[0]),mp(e.parameters[1]),mp(e.parameters[2]),e.parameters[3]?mp(e.parameters[3]):1);throw new se("effect:syntax-error",`Invalid color function '${e.name}'`,{colorFunction:e})}function uY(e,t,i){var r;try{return f5e(e)}catch(s){(r=i==null?void 0:i.messages)==null||r.push(s)}return null}function hY(e,t,i,r){try{const s=p5e(e);zc(i,s,t)}catch(s){r.messages&&r.messages.push(s)}}function p5e(e){const t=Gye(e);return t?X4e(t)?t.map(i=>i.toJSON()):t.map(({scale:i,effects:r})=>({scale:i,value:r.map(s=>s.toJSON())})):null}function f5e(e){if(!e||e.length===0)return null;if(m5e(e)){const t=[];for(const i of e)t.push({scale:i.scale,value:qte(i.value)});return t}return qte(e)}function m5e(e){const t=e[0];return!!t&&"scale"in t}function qte(e){if(!e||!e.length)return"";const t=[];for(const i of e){let r=[];switch(i.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":r=[mg(i,"amount")];break;case"blur":r=[mg(i,"radius","pt")];break;case"hue-rotate":r=[mg(i,"angle","deg")];break;case"drop-shadow":r=[mg(i,"xoffset","pt"),mg(i,"yoffset","pt"),mg(i,"blurRadius","pt"),g5e(i,"color")];break;case"bloom":r=[mg(i,"strength"),mg(i,"radius","pt"),mg(i,"threshold")]}const s=`${i.type}(${r.filter(Boolean).join(" ")})`;Gye(s),t.push(s)}return t.join(" ")}function mg(e,t,i){if(e[t]==null)throw new se("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});return i?e[t]+i:""+e[t]}function g5e(e,t){if(e[t]==null)throw new se("effect:missing-parameter",`Missing parameter '${t}' in ${e.type} effect`,{effect:e});const i=e[t];return`rgba(${i[0]||0}, ${i[1]||0}, ${i[2]||0}, ${i[3]/255||0})`}const UN=-3;var fy;(function(e){e[e.ALL=0]="ALL",e[e.SOME=1]="SOME"})(fy||(fy={}));class y5e{constructor(t,i,r){this._namespace=t,this._storage=i,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",r&&(this._storage.registerRemoveFunc(this._namespace,r),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(t,i,r,s=0){this._storage.put(this._namespace+t,i,r,s)}get(t){const i=this._storage.get(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}pop(t){const i=this._storage.pop(this._namespace+t);return i===void 0?++this._miss:++this._hit,i}updateSize(t,i,r){this._storage.updateSize(this._namespace+t,i,r)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class dY{constructor(t=10485760){this._maxSize=t,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new hi,this._users=new hi}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(t){this._users.push(t)}deregister(t){this._users.removeUnordered(t)}registerRemoveFunc(t,i){this._removeFuncs.push([t,i])}deregisterRemoveFunc(t){this._removeFuncs.filterInPlace(i=>i[0]!==t)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(t){this._maxSize=Math.max(t,0),this._checkSizeLimit()}put(t,i,r,s){const n=this._db.get(t);if(n&&(this._size-=n.size,this._db.delete(t),n.entry!==i&&this._notifyRemove(t,n.entry,fy.ALL)),r>this._maxSize)return void this._notifyRemove(t,i,fy.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return void console.warn("Refusing to cache entry with invalid size "+r);const o=1+Math.max(s,UN)-UN;this._db.set(t,{entry:i,size:r,lifetime:o,lives:o}),this._size+=r,this._checkSizeLimit()}updateSize(t,i,r){const s=this._db.get(t);if(s&&s.entry===i){for(this._size-=s.size;r>this._maxSize;){const n=this._notifyRemove(t,i,fy.SOME);if(!(w(n)&&n>0))return void this._db.delete(t);r=n}s.size=r,this._size+=r,this._checkSizeLimit()}}pop(t){const i=this._db.get(t);if(i)return this._size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(t){const i=this._db.get(t);if(i!==void 0)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}getStats(){const t={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},i={},r=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;r[l]=(r[l]||0)+o.size,this._users.forAll(c=>{const h=c.namespace;if(a.startsWith(h)){const p=i[h]||0;i[h]=p+o.size}})});const s={};this._users.forAll(o=>{const a=o.namespace;if(!isNaN(o.hitRate)&&o.hitRate>0){const l=i[a]||0;i[a]=l,s[a]=Math.round(100*o.hitRate)+"%"}else s[a]="0%"});const n=Object.keys(i);n.sort((o,a)=>i[a]-i[o]),n.forEach(o=>t[o]=Math.round(i[o]/2**20)+"MB / "+s[o]);for(let o=r.length-1;o>=0;--o){const a=r[o];a&&(t["Priority "+(o+UN-1)]=Math.round(a/this.size*100)+"%")}return t}resetStats(){this._hit=this._miss=0,this._users.forAll(t=>t.resetHitRate())}clear(t){this._db.forEach((i,r)=>{r.startsWith(t)&&(this._size-=i.size,this._db.delete(r),this._notifyRemove(r,i.entry,fy.ALL))})}clearAll(){this._db.forEach((t,i)=>this._notifyRemove(i,t.entry,fy.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(t,i,r){let s;return this._removeFuncs.some(n=>{if(t.startsWith(n[0])){const o=n[1](i,r);return typeof o=="number"&&(s=o),!0}return!1}),s}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[t,i]of this._db){if(this._db.delete(t),i.lives<=1){this._size-=i.size;const r=this._notifyRemove(t,i.entry,fy.SOME);w(r)&&r>0&&(this._size+=r,i.lives=i.lifetime,i.size=r,this._db.set(t,i))}else--i.lives,this._db.set(t,i);if(this._size<=.9*this.maxSize)return}}}class _5e{constructor(t,i){this._storage=new dY,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i){this._storage.put(t,i,1,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}new _5e(1e3);new at([128,128,128]);const Wte=/\/resource\/(.*?)\.svg$/,v5e=new at("white");function b5e(e,t){const i=t.resource.href;return!Ce("esri-canvas-svg-support")&&e.styleOrigin&&Wte.test(i)?i.replace(Wte,"/resource/png/$1.png"):i}function VT(e,t){if(!e)return null;let i=null;return zE(e)?i=w5e(e):tU(e)&&(i=e.color?new at(e.color):null),i?RP(i,t):null}function w5e(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(r=>{r.type==="object"&&r.resource.href!=null||(i=r.type==="water"?r.color:w(r.material)?r.material.color:null)}),i?new at(i):null}function RP(e,t){if(t==null)return e;const i=e.toRgba();return i[3]=i[3]*t,new at(i)}function x5e(e,t,i){const r=e.symbolLayers;if(!r)return;const s=n=>{const o=w(n)?n:null;return RP(t=t||o||i!=null&&v5e,i)};r.forEach(n=>{if(n.type!=="object"||n.resource.href==null||t)if(n.type==="water")n.color=s(n.color);else{const o=w(n.material)?n.material.color:null,a=s(o);N(n.material)?n.material=new qu({color:a}):n.material.color=a,i!=null&&"outline"in n&&w(n.outline)&&w(n.outline.color)&&(n.outline.color=RP(n.outline.color,i))}})}function T5e(e,t,i){(t=t||e.color)&&(e.color=RP(t,i)),i!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=RP(e.outline.color,i))}function kV(e,t,i){e&&(t||i!=null)&&(t&&(t=new at(t)),zE(e)?x5e(e,t,i):tU(e)&&T5e(e,t,i))}async function S5e(e,t){const i=e.symbolLayers;i&&await xU(i,async r=>E5e(r,t))}async function E5e(e,t){switch(e.type){case"extrude":A5e(e,t);break;case"icon":case"line":case"text":C5e(e,t);break;case"path":R5e(e,t);break;case"object":await O5e(e,t)}}function C5e(e,t){const i=Hye(t);w(i)&&(e.size=i)}function Hye(e){for(const t of e)if(typeof t=="number")return t;return null}function A5e(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function O5e(e,t){const{resourceSize:i,symbolSize:r}=await M5e(e),s=qye(t,i,r);e.width=AM(t[0],r[0],i[0],s),e.depth=AM(t[1],r[1],i[1],s),e.height=AM(t[2],r[2],i[2],s)}function R5e(e,t){const i=qye(t,pm,[e.width,void 0,e.height]);e.width=AM(t[0],e.width,1,i),e.height=AM(t[2],e.height,1,i)}function qye(e,t,i){for(let r=0;r<3;r++){const s=e[r];switch(s){case"symbol-value":return i[r]!=null?i[r]/t[r]:1;case"proportional":break;default:if(s&&t[r])return s/t[r]}}return 1}async function M5e(e){const t=await _e(()=>import("./symbolLayerUtils.f9ee6fe6.js"),[],import.meta.url),i=await t.computeObjectLayerResourceSize(e,10),{width:r,height:s,depth:n}=e,o=[r,n,s];let a=1;for(let l=0;l<3;l++)if(o[l]!=null){a=o[l]/i[l];break}for(let l=0;l<3;l++)o[l]==null&&(o[l]=i[l]*a);return{resourceSize:i,symbolSize:o}}function AM(e,t,i,r){switch(e){case"proportional":return i*r;case"symbol-value":return t!=null?t:i;default:return e}}function P5e(e,t){const i=Hye(t);if(!N(i))switch(e.type){case"simple-marker":e.size=i;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=i,e.height=i*r):(e.width=i*r,e.height=i);break}case"simple-line":e.width=i;break;case"text":e.font.size=i}}async function I5e(e,t){if(e&&t)return zE(e)?S5e(e,t):void(tU(e)&&P5e(e,t))}function L5e(e,t,i){if(e&&t!=null)if(zE(e)){const r=e.symbolLayers;r&&r.forEach(s=>{if(s&&s.type==="object")switch(i){case"tilt":s.tilt=t;break;case"roll":s.roll=t;break;default:s.heading=t}})}else tU(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}const $5e="<",D5e=">",N5e=Uk("short-date");function F5e(e,t,i,r){let s="";t===0?s=`${$5e} `:t===i&&(s=`${D5e} `);let n=null;return n=r?Cm(e,N5e):I4e(e),s+n}const k5e=new at([64,64,64]);function U5e(e,t){const i=[],r=e.length-1;return e.length===5?i.push(0,2,4):i.push(0,r),e.map((s,n)=>i.includes(n)?F5e(s,n,r,t):null)}async function z5e(e,t,i){let r=!1,s=[],n=[];if(e.stops){const c=e.stops;s=c.map(h=>h.value),r=c.some(h=>!!h.label),r&&(n=c.map(h=>h.label))}const o=s[0],a=s[s.length-1];if(o==null&&a==null)return null;const l=r?null:U5e(s,i);return(await Promise.all(s.map(async(c,h)=>({value:c,color:e.type==="opacity"?await B5e(c,e,t):(await _e(()=>Promise.resolve().then(()=>kY),void 0,import.meta.url)).getColor(e,c),label:r?n[h]:l[h]})))).reverse()}async function B5e(e,t,i=k5e){const r=new at(i),s=(await _e(()=>Promise.resolve().then(()=>kY),void 0,import.meta.url)).getOpacity(t,e);return s!=null&&(r.a=s),r}var Pj;let ER=Pj=class extends Fe{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new Pj({color:this.color,ratio:this.ratio})}};u([f({type:at,json:{type:[cs],default:null,write:!0}})],ER.prototype,"color",void 0),u([f({type:Number,json:{write:!0}})],ER.prototype,"ratio",void 0),ER=Pj=u([B("esri.renderers.support.HeatmapColorStop")],ER);const OM=ER;function V5e(e){if(!e.colorStops)return[];const t=[...e.colorStops].filter(r=>{var s;return((s=r.color)==null?void 0:s.a)>0});let i=t.length-1;if(t&&t[0]){const r=t[i];r&&r.ratio!==1&&(t.push(new OM({ratio:1,color:r.color})),i++)}return t.map((r,s)=>{var o,a;let n="";return s===0?n=((o=e.legendOptions)==null?void 0:o.minLabel)||"low":s===i&&(n=((a=e.legendOptions)==null?void 0:a.maxLabel)||"high"),{color:r.color,label:n,ratio:r.ratio}}).reverse()}Ie.getLogger("esri.renderers.support.utils");function eu(e,t,i){uZ(e,t,()=>[]).push(...i)}async function G5e(e){var i,r;const t=new Map;if("visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(n=>n.type==="color");for(const n of s){const o=n.field||n.valueExpression,a=(await z5e(n)).map(l=>l.color);eu(t,o,a)}}if(e.type==="heatmap"){const s=V5e(e).map(n=>n.color);eu(t,e.field,s)}else if(e.type==="pie-chart"){for(const s of e.attributes)eu(t,s.field,[s.color]);eu(t,null,[(i=e==null?void 0:e.othersCategory)==null?void 0:i.color,VT(e.backgroundFillSymbol,null)])}else if(e.type==="dot-density"){for(const s of e.attributes)eu(t,s.field,[s.color]);eu(t,null,[e.backgroundColor])}else if(e.type==="unique-value")if(((r=e.authoringInfo)==null?void 0:r.type)==="predominance")for(const s of e.uniqueValueInfos)eu(t,s.value.toString(),[VT(s.symbol,null)]);else{const s=e.uniqueValueInfos.map(c=>VT(c.symbol,null)),{field:n,field2:o,field3:a,valueExpression:l}=e;(n||l)&&eu(t,n||l,s),o&&eu(t,o,s),a&&eu(t,a,s)}else if(e.type==="class-breaks"){const s=e.classBreakInfos.map(n=>VT(n.symbol,null));eu(t,e.field||e.valueExpression,s)}else e.type==="simple"&&eu(t,null,[VT(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&eu(t,null,[VT(e.defaultSymbol,null)]),t.forEach((s,n)=>{const o=$3(s.filter(Boolean),(a,l)=>JSON.stringify(a)===JSON.stringify(l));t.set(n,o)}),t}var Ij;let CR=Ij=class extends Fe{constructor(e){super(e),this.name=null,this.code=null}clone(){return new Ij({name:this.name,code:this.code})}};u([f({type:String,json:{write:!0}})],CR.prototype,"name",void 0),u([f({type:[String,Number],json:{write:!0}})],CR.prototype,"code",void 0),CR=Ij=u([B("esri.layers.support.CodedValue")],CR);const j5e=new Hi({inherited:"inherited",codedValue:"coded-value",range:"range"});let AR=class extends Fe{constructor(e){super(e),this.name=null,this.type=null}};u([f({type:String,json:{write:!0}})],AR.prototype,"name",void 0),u([Rt(j5e)],AR.prototype,"type",void 0),AR=u([B("esri.layers.support.Domain")],AR);const RU=AR;var Lj;let OR=Lj=class extends RU{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const i=String(e);this.codedValues.some(r=>(String(r.code)===i&&(t=r.name),!!t))}return t}clone(){return new Lj({codedValues:me(this.codedValues),name:this.name})}};u([f({type:[CR],json:{write:!0}})],OR.prototype,"codedValues",void 0),u([Rt({codedValue:"coded-value"})],OR.prototype,"type",void 0),OR=Lj=u([B("esri.layers.support.CodedValueDomain")],OR);const Wye=OR;var $j;let zN=$j=class extends RU{constructor(e){super(e),this.type="inherited"}clone(){return new $j}};u([Rt({inherited:"inherited"})],zN.prototype,"type",void 0),zN=$j=u([B("esri.layers.support.InheritedDomain")],zN);const Zye=zN;var Dj;let QS=Dj=class extends RU{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new Dj({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};u([f({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(e,t,i){t[i]=[this.minValue||0,e]}}}})],QS.prototype,"maxValue",void 0),u([f({type:Number,json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range&&t.range[0]},write:{target:"range",writer(e,t,i){t[i]=[e,this.maxValue||0]}}}})],QS.prototype,"minValue",void 0),u([Rt({range:"range"})],QS.prototype,"type",void 0),QS=Dj=u([B("esri.layers.support.RangeDomain")],QS);const Xye=QS,Yye={key:"type",base:RU,typeMap:{range:Xye,"coded-value":Wye,inherited:Zye}};function pY(e){if(!e||!e.type)return null;switch(e.type){case"range":return Xye.fromJSON(e);case"codedValue":return Wye.fromJSON(e);case"inherited":return Zye.fromJSON(e)}return null}const H5e=new Hi({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"});var Nj;const q5e=new Hi({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let Cl=Nj=class extends Fe{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?i.value:null}readValueType(e,{description:t}){let i;try{i=JSON.parse(t)}catch{}return i?q5e.fromJSON(i.fieldValueType):null}clone(){return new Nj({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};u([f({type:String,json:{write:!0}})],Cl.prototype,"alias",void 0),u([f({type:[String,Number],json:{write:{allowNull:!0}}})],Cl.prototype,"defaultValue",void 0),u([f()],Cl.prototype,"description",void 0),u([it("description")],Cl.prototype,"readDescription",null),u([f({types:Yye,json:{read:{reader:pY},write:!0}})],Cl.prototype,"domain",void 0),u([f({type:Boolean,json:{write:!0}})],Cl.prototype,"editable",void 0),u([f({type:cs,json:{write:!0}})],Cl.prototype,"length",void 0),u([f({type:String,json:{write:!0}})],Cl.prototype,"name",void 0),u([f({type:Boolean,json:{write:!0}})],Cl.prototype,"nullable",void 0),u([Rt(H5e)],Cl.prototype,"type",void 0),u([f()],Cl.prototype,"valueType",void 0),u([it("valueType",["description"])],Cl.prototype,"readValueType",null),Cl=Nj=u([B("esri.layers.support.Field")],Cl);const K3=Cl;var Fj;let JS=Fj=class extends Fe{constructor(e){super(e),this.type="map-layer"}clone(){const{mapLayerId:e,gdbVersion:t}=this;return new Fj({mapLayerId:e,gdbVersion:t})}};u([Rt({mapLayer:"map-layer"})],JS.prototype,"type",void 0),u([f({type:cs,json:{write:!0}})],JS.prototype,"mapLayerId",void 0),u([f({type:String,json:{write:!0}})],JS.prototype,"gdbVersion",void 0),JS=Fj=u([B("esri.layers.support.source.MapLayerSource")],JS);var kj;let zg=kj=class extends Fe{constructor(e){super(e),this.type="query-table"}clone(){var o;const{workspaceId:e,query:t,oidFields:i,spatialReference:r,geometryType:s}=this,n={workspaceId:e,query:t,oidFields:i,spatialReference:(o=r==null?void 0:r.clone())!=null?o:void 0,geometryType:s};return new kj(n)}};u([Rt({queryTable:"query-table"})],zg.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],zg.prototype,"workspaceId",void 0),u([f({type:String,json:{write:!0}})],zg.prototype,"query",void 0),u([f({type:String,json:{write:!0}})],zg.prototype,"oidFields",void 0),u([f({type:wt,json:{write:!0}})],zg.prototype,"spatialReference",void 0),u([Rt(epe)],zg.prototype,"geometryType",void 0),zg=kj=u([B("esri.layers.support.source.QueryTableDataSource")],zg);var Uj;let KS=Uj=class extends Fe{constructor(e){super(e),this.type="raster"}clone(){const{workspaceId:e,dataSourceName:t}=this;return new Uj({workspaceId:e,dataSourceName:t})}};u([Rt({raster:"raster"})],KS.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],KS.prototype,"dataSourceName",void 0),u([f({type:String,json:{write:!0}})],KS.prototype,"workspaceId",void 0),KS=Uj=u([B("esri.layers.support.source.RasterDataSource")],KS);var zj;let Vb=zj=class extends Fe{constructor(e){super(e),this.type="table"}clone(){const{workspaceId:e,gdbVersion:t,dataSourceName:i}=this;return new zj({workspaceId:e,gdbVersion:t,dataSourceName:i})}};u([Rt({table:"table"})],Vb.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],Vb.prototype,"workspaceId",void 0),u([f({type:String,json:{write:!0}})],Vb.prototype,"gdbVersion",void 0),u([f({type:String,json:{write:!0}})],Vb.prototype,"dataSourceName",void 0),Vb=zj=u([B("esri.layers.support.source.TableDataSource")],Vb);var Bj,Vj;const W5e=La()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let du=Bj=class extends Fe{constructor(e){super(e),this.type="join-table"}readLeftTableSource(e,t,i){return Zte()(e,t,i)}castLeftTableSource(e){return jp(Gj(),e)}readRightTableSource(e,t,i){return Zte()(e,t,i)}castRightTableSource(e){return jp(Gj(),e)}clone(){var o,a;const{leftTableKey:e,rightTableKey:t,leftTableSource:i,rightTableSource:r,joinType:s}=this,n={leftTableKey:e,rightTableKey:t,leftTableSource:(o=i==null?void 0:i.clone())!=null?o:void 0,rightTableSource:(a=r==null?void 0:r.clone())!=null?a:void 0,joinType:s};return new Bj(n)}};u([Rt({joinTable:"join-table"})],du.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],du.prototype,"leftTableKey",void 0),u([f({type:String,json:{write:!0}})],du.prototype,"rightTableKey",void 0),u([f({json:{write:!0}})],du.prototype,"leftTableSource",void 0),u([it("leftTableSource")],du.prototype,"readLeftTableSource",null),u([pi("leftTableSource")],du.prototype,"castLeftTableSource",null),u([f({json:{write:!0}})],du.prototype,"rightTableSource",void 0),u([it("rightTableSource")],du.prototype,"readRightTableSource",null),u([pi("rightTableSource")],du.prototype,"castRightTableSource",null),u([Rt(W5e)],du.prototype,"joinType",void 0),du=Bj=u([B("esri.layers.support.source.JoinTableDataSource")],du);let UV=null;function Zte(){return UV||(UV=NC({types:Gj()})),UV}let zV=null;function Gj(){return zV||(zV={key:"type",base:null,typeMap:{"data-layer":gp,"map-layer":JS}}),zV}const Z5e={key:"type",base:null,typeMap:{"join-table":du,"query-table":zg,raster:KS,table:Vb}};let gp=Vj=class extends Fe{constructor(e){super(e),this.type="data-layer"}clone(){const{fields:e,dataSource:t}=this;return new Vj({fields:e,dataSource:t})}};u([Rt({dataLayer:"data-layer"})],gp.prototype,"type",void 0),u([f({type:[K3],json:{write:!0}})],gp.prototype,"fields",void 0),u([f({types:Z5e,json:{write:!0}})],gp.prototype,"dataSource",void 0),gp=Vj=u([B("esri.layers.support.source.DataLayerSource")],gp),gp.from=hn(gp);function X5e(e,t){return t?{...t,query:{...e,...t.query}}:{query:e}}function Qye(e){return typeof e=="string"?$a(e):me(e)}function Y5e(e,t,i){const r={};for(const s in e){if(s==="declaredClass")continue;const n=e[s];if(n!=null&&typeof n!="function")if(Array.isArray(n)){r[s]=[];for(let o=0;o<n.length;o++)r[s][o]=Y5e(n[o])}else if(typeof n=="object")if(n.toJSON){const o=n.toJSON(i&&i[s]);r[s]=t?o:JSON.stringify(o)}else r[s]=t?n:JSON.stringify(n);else r[s]=n}return r}const NL={102100:{maxX:20037508342788905e-9,minX:-20037508342788905e-9,plus180Line:new Bu({paths:[[[20037508342788905e-9,-20037508342788905e-9],[20037508342788905e-9,20037508342788905e-9]]],spatialReference:wt.WebMercator}),minus180Line:new Bu({paths:[[[-20037508342788905e-9,-20037508342788905e-9],[-20037508342788905e-9,20037508342788905e-9]]],spatialReference:wt.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new Bu({paths:[[[180,-180],[180,180]]],spatialReference:wt.WGS84}),minus180Line:new Bu({paths:[[[-180,-180],[-180,180]]],spatialReference:wt.WGS84})}};function jw(e,t){return Math.ceil((e-t)/(2*t))}function Jye(e,t){const i=RM(e);for(const r of i)for(const s of r)s[0]+=t;return e}function RM(e){return sx(e)?e.rings:e.paths}async function Q5e(e,t,i,r){const s=typeof e=="string"?$a(e):e,n=t[0].spatialReference,o={...r,query:{...s.query,f:"json",sr:JSON.stringify(n),target:JSON.stringify({geometryType:FC(t[0]),geometries:t}),cutter:JSON.stringify(i)}},a=await jr(s.path+"/cut",o),{cutIndexes:l,geometries:c=[]}=a.data;return{cutIndexes:l,geometries:c.map(h=>{const p=Vy(h);return p.spatialReference=n,p})}}async function J5e(e,t,i){const r=typeof e=="string"?$a(e):e,s=t[0].spatialReference,n=FC(t[0]),o={...i,query:{...r.query,f:"json",sr:s.wkid?s.wkid:JSON.stringify(s),geometries:JSON.stringify(K5e(t))}};return eke((await jr(r.path+"/simplify",o)).data,n,s)}function K5e(e){return{geometryType:FC(e[0]),geometries:e.map(t=>t.toJSON())}}function eke(e,t,i){const r=ipe(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}const Kye=Ie.getLogger("esri.geometry.support.normalizeUtils");function tke(e){return e.type==="polygon"}function ike(e){return e[0].type==="polygon"}function rke(e){return e[0].type==="polyline"}function ske(e,t){if(!(e instanceof Bu||e instanceof Ku)){const s="straightLineDensify: the input geometry is neither polyline nor polygon";throw Kye.error(s),new se(s)}const i=RM(e),r=[];for(const s of i){const n=[];r.push(n),n.push([s[0][0],s[0][1]]);for(let o=0;o<s.length-1;o++){const a=s[o][0],l=s[o][1],c=s[o+1][0],h=s[o+1][1],p=Math.sqrt((c-a)*(c-a)+(h-l)*(h-l)),m=(h-l)/p,g=(c-a)/p,v=p/t;if(v>1){for(let O=1;O<=v-1;O++){const C=O*t,M=g*C+a,I=m*C+l;n.push([M,I])}const b=(p+Math.floor(v-1)*t)/2,S=g*b+a,T=m*b+l;n.push([S,T])}n.push([c,h])}}return tke(e)?new Ku({rings:r,spatialReference:e.spatialReference}):new Bu({paths:r,spatialReference:e.spatialReference})}function Xte(e,t,i){if(t){const r=ske(e,1e6);e=JO(r,!0)}return i&&(e=Jye(e,i)),e}function Yte(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const s=jw(r,t);e[0]=r+s*(-2*t)}else if(r<i){const s=jw(r,i);e[0]=r+s*(-2*i)}}else{const r=e.x;if(r>t){const s=jw(r,t);e=e.clone().offset(s*(-2*t),0)}else if(r<i){const s=jw(r,i);e=e.clone().offset(s*(-2*i),0)}}return e}function nke(e,t){let i=-1;for(let r=0;r<t.cutIndexes.length;r++){const s=t.cutIndexes[r],n=t.geometries[r],o=RM(n);for(let a=0;a<o.length;a++){const l=o[a];l.some(c=>{if(c[0]<180)return!0;{let h=0;for(let m=0;m<l.length;m++){const g=l[m][0];h=g>h?g:h}h=Number(h.toFixed(9));const p=-360*jw(h,180);for(let m=0;m<l.length;m++){const g=n.getPoint(a,m);n.setPoint(a,m,g.clone().offset(p,0))}return!0}})}if(s===i){if(ike(e))for(const a of RM(n))e[s]=e[s].addRing(a);else if(rke(e))for(const a of RM(n))e[s]=e[s].addPath(a)}else i=s,e[s]=n}return e}async function e0e(e,t,i){var M;if(!Array.isArray(e))return e0e([e],t);t&&typeof t!="string"&&Kye.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const r=typeof t=="string"?t:(M=t==null?void 0:t.url)!=null?M:sr.geometryServiceUrl;let s,n,o,a,l,c,h,p,m=0;const g=[],v=[];for(const I of e)if(N(I))v.push(I);else if(s||(s=I.spatialReference,n=kv(s),o=s.isWebMercator,c=o?102100:4326,a=NL[c].maxX,l=NL[c].minX,h=NL[c].plus180Line,p=NL[c].minus180Line),n)if(I.type==="mesh")v.push(I);else if(I.type==="point")v.push(Yte(I.clone(),a,l));else if(I.type==="multipoint"){const $=I.clone();$.points=$.points.map(U=>Yte(U,a,l)),v.push($)}else if(I.type==="extent"){const $=I.clone()._normalize(!1,!1,n);v.push($.rings?new Ku($):$)}else if(I.extent){const $=I.extent,U=jw($.xmin,l)*(2*a);let q=U===0?I.clone():Jye(I.clone(),U);$.offset(U,0),$.intersects(h)&&$.xmax!==a?(m=$.xmax>m?$.xmax:m,q=Xte(q,o),g.push(q),v.push("cut")):$.intersects(p)&&$.xmin!==l?(m=$.xmax*(2*a)>m?$.xmax*(2*a):m,q=Xte(q,o,360),g.push(q),v.push("cut")):v.push(q)}else v.push(I.clone());else v.push(I);let b=jw(m,a),S=-90;const T=b,O=new Bu;for(;b>0;){const I=360*b-180;O.addPath([[I,S],[I,-1*S]]),S*=-1,b--}if(g.length>0&&T>0){const I=nke(g,await Q5e(r,g,O,i)),$=[],U=[];for(let Y=0;Y<v.length;Y++){const J=v[Y];if(J!=="cut")U.push(J);else{const X=I.shift(),ne=e[Y];w(ne)&&ne.type==="polygon"&&ne.rings&&ne.rings.length>1&&X.rings.length>=ne.rings.length?($.push(X),U.push("simplify")):U.push(o?Ay(X):X)}}if(!$.length)return U;const q=await J5e(r,$,i),G=[];for(let Y=0;Y<U.length;Y++){const J=U[Y];J!=="simplify"?G.push(J):G.push(o?Ay(q.shift()):q.shift())}return G}const C=[];for(let I=0;I<v.length;I++){const $=v[I];if($!=="cut")C.push($);else{const U=g.shift();C.push(o===!0?Ay(U):U)}}return C}function t0e(e){const t={};for(const i in e){if(i==="declaredClass")continue;const r=e[i];if(r!=null&&typeof r!="function")if(Array.isArray(r)){t[i]=[];for(let s=0;s<r.length;s++)t[i][s]=t0e(r[s])}else typeof r=="object"?r.toJSON&&(t[i]=JSON.stringify(r)):t[i]=r}return t}var J_;(function(e){e[e.varint=0]="varint",e[e.fixed64=1]="fixed64",e[e.delimited=2]="delimited",e[e.fixed32=5]="fixed32",e[e.unknown=99]="unknown"})(J_||(J_={}));const Qte=4294967296,oke=new TextDecoder("utf-8"),ake=Ce("safari")||Ce("ios")?6:Ce("ff")?12:32;class dx{constructor(t,i,r=0,s=t?t.byteLength:0){this._tag=0,this._dataType=J_.unknown,this._init(t,i,r,s)}_init(t,i,r,s){this._data=t,this._dataView=i,this._pos=r,this._end=s}clone(){return new dx(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(t){this._pos=t}nextTag(t){for(;;){if(this._pos===this._end)return!1;const i=this._decodeVarint();if(this._tag=i>>3,this._dataType=7&i,!t||t===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const t=this.getUInt32();return t>>>1^-(1&t)|0}getSInt64(){return this._decodeSVarint()}getBool(){const t=this._data[this._pos]!==0;return this._skip(1),t}getEnum(){return this._decodeVarint()}getFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getUint32(i+4,!0)*Qte;return this._skip(8),r}getSFixed64(){const t=this._dataView,i=this._pos,r=t.getUint32(i,!0)+t.getInt32(i+4,!0)*Qte;return this._skip(8),r}getDouble(){const t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}getFixed32(){const t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}getSFixed32(){const t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}getFloat(){const t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}getString(){const t=this._getLength(),i=this._pos,r=this._toString(this._data,i,i+t);return this._skip(t),r}getBytes(){const t=this._getLength(),i=this._pos,r=this._toBytes(this._data,i,i+t);return this._skip(t),r}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(t,i,r,s){const n=this.getMessage(),o=t(n,i,r,s);return n.release(),o}processMessage(t){const i=this.getMessage(),r=t(i);return i.release(),r}getMessage(){const t=this._getLength(),i=dx.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}release(){dx.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case J_.varint:this._decodeVarint();break;case J_.fixed64:this._skip(8);break;case J_.delimited:this._skip(this._getLength());break;case J_.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(t){this._skip(t)}_skip(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}_decodeVarint(){const t=this._data;let i,r=this._pos,s=0;if(this._end-r>=10)do{if(i=t[r++],s|=127&i,(128&i)==0||(i=t[r++],s|=(127&i)<<7,(128&i)==0)||(i=t[r++],s|=(127&i)<<14,(128&i)==0)||(i=t[r++],s|=(127&i)<<21,(128&i)==0)||(i=t[r++],s+=268435456*(127&i),(128&i)==0)||(i=t[r++],s+=34359738368*(127&i),(128&i)==0)||(i=t[r++],s+=4398046511104*(127&i),(128&i)==0)||(i=t[r++],s+=562949953421312*(127&i),(128&i)==0)||(i=t[r++],s+=72057594037927940*(127&i),(128&i)==0)||(i=t[r++],s+=9223372036854776e3*(127&i),(128&i)==0))break;throw new Error("Varint too long!")}while(0);else{let n=1;for(;r!==this._end&&(i=t[r],(128&i)!=0);)++r,s+=(127&i)*n,n*=128;if(r===this._end)throw new Error("Varint overrun!");++r,s+=i*n}return this._pos=r,s}_decodeSVarint(){const t=this._decodeVarint();return t%2?-(t+1)/2:t/2}_getLength(){if(this._dataType!==J_.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(t,i,r){if((r=Math.min(this._end,r))-i>ake){const o=t.subarray(i,r);return oke.decode(o)}let s="",n="";for(let o=i;o<r;++o){const a=t[o];128&a?n+="%"+a.toString(16):(s+=decodeURIComponent(n)+String.fromCharCode(a),n="")}return n.length&&(s+=decodeURIComponent(n)),s}_toBytes(t,i,r){return r=Math.min(this._end,r),new Uint8Array(t.buffer,i,r-i)}}dx.pool=new qs(dx,null,e=>{e._data=null,e._dataView=null});class ql{constructor(t=[],i=[],r=!1){this.lengths=t!=null?t:[],this.coords=i!=null?i:[],this.hasIndeterminateRingOrder=r}static fromRect(t){const[i,r,s,n]=t,o=s-i,a=n-r;return new ql([5],[i,r,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((t,i)=>t+i)}forEachVertex(t){let i=0;this.lengths.length||t(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let n=0;n<s;n++)t(this.coords[2*(n+i)],this.coords[2*(n+i)+1]);i+=s}}clone(t){return t?(t.set(this.coords),new ql(this.lengths.slice(),t,this.hasIndeterminateRingOrder)):new ql(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}class Lm{constructor(t=null,i={},r,s){this.geometry=t,this.attributes=i,this.centroid=r,this.objectId=s,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const t=new Lm(this.geometry,this.attributes,this.centroid,this.objectId);return t.displayId=this.displayId,t.geohashX=this.geohashX,t.geohashY=this.geohashY,t}}function lke(e){return!(N(e.geometry)||!e.geometry.coords||!e.geometry.coords.length)}class y1t extends Lm{}class MU{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new MU;return t.objectIdFieldName=this.objectIdFieldName,t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}const i0e=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class _1t{constructor(t){this.options=t,this.geometryTypes=i0e,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new MU}prepareFeatures(t){this._vertexDimension=2,t.hasZ&&this._vertexDimension++,t.hasM&&this._vertexDimension++}finishFeatureResult(t){if(!t||!t.features||!t.hasZ||!this.options.sourceSpatialReference||!t.spatialReference||qc(t.spatialReference,this.options.sourceSpatialReference)||t.spatialReference.vcsWkid)return;const i=VE(this.options.sourceSpatialReference)/VE(t.spatialReference);if(i!==1)for(const r of t.features){if(!lke(r))continue;const s=r.geometry.coords;for(let n=2;n<s.length;n+=3)s[n]*=i}}addFeature(t,i){t.features.push(i)}createFeature(){return new Lm}createSpatialReference(){return{wkid:0}}createGeometry(){return new ql}addField(t,i){t.fields.push(i)}allocateCoordinates(t){t.coords.length=t.lengths.reduce((i,r)=>i+r,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(t,i){t.coords[this._coordinatePtr++]=i}addCoordinatePoint(t,i){t.coords.push(i)}addLength(t,i){t.lengths.push(i)}addQueryGeometry(t,i){t.queryGeometry=i.queryGeometry,t.queryGeometryType=i.queryGeometryType}createPointGeometry(){return new ql}}const Jte=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],Kte=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],eie=["upperLeft","lowerLeft"];function tie(e){return e>=Jte.length?null:Jte[e]}function cke(e){return e>=Kte.length?null:Kte[e]}function iie(e){return e>=eie.length?null:eie[e]}function rie(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function uke(e,t,i){const s=t.createPointGeometry(i);for(;e.next();)switch(e.tag()){case 3:{const n=e.getUInt32(),o=e.pos()+n;let a=0;for(;e.pos()<o;)t.addCoordinatePoint(s,e.getSInt64(),a++);break}default:e.skip()}return s}function hke(e,t,i){const n=t.createGeometry(i),o=2+(i.hasZ?1:0)+(i.hasM?1:0);for(;e.next();)switch(e.tag()){case 2:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(;e.pos()<l;)t.addLength(n,e.getUInt32(),c++);break}case 3:{const a=e.getUInt32(),l=e.pos()+a;let c=0;for(t.allocateCoordinates(n);e.pos()<l;)t.addCoordinate(n,e.getSInt64(),c),c++,c===o&&(c=0);break}default:e.skip()}return n}function dke(e){const s=new ql;let n="esriGeometryPoint";for(;e.next();)switch(e.tag()){case 2:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.lengths.push(e.getUInt32());break}case 3:{const o=e.getUInt32(),a=e.pos()+o;for(;e.pos()<a;)s.coords.push(e.getSInt64());break}case 1:n=i0e[e.getEnum()];break;default:e.skip()}return{queryGeometry:s,queryGeometryType:n}}function pke(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}function fke(e){const a={type:tie(0)};for(;e.next();)switch(e.tag()){case 1:a.name=e.getString();break;case 2:a.type=tie(e.getEnum());break;case 3:a.alias=e.getString();break;case 4:a.sqlType=cke(e.getEnum());break;case 5:e.skip();break;case 6:a.defaultValue=e.getString();break;default:e.skip()}return a}function mke(e){const r={};for(;e.next();)switch(e.tag()){case 1:r.name=e.getString();break;case 2:r.isSystemMaintained=e.getBool();break;default:e.skip()}return r}function gke(e,t,i,r){const a=t.createFeature(i);let l=0;for(;e.next();)switch(e.tag()){case 1:{const c=r[l++].name;a.attributes[c]=e.processMessage(pke);break}case 2:a.geometry=e.processMessageWithArgs(hke,t,i);break;case 4:a.centroid=e.processMessageWithArgs(uke,t,i);break;default:e.skip()}return a}function yke(e){const n=[1,1,1,1];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function _ke(e){const n=[0,0,0,0];for(;e.next();)switch(e.tag()){case 1:n[0]=e.getDouble();break;case 2:n[1]=e.getDouble();break;case 4:n[2]=e.getDouble();break;case 3:n[3]=e.getDouble();break;default:e.skip()}return n}function vke(e){const s={originPosition:iie(0)};for(;e.next();)switch(e.tag()){case 1:s.originPosition=iie(e.getEnum());break;case 2:s.scale=e.processMessage(yke);break;case 3:s.translate=e.processMessage(_ke);break;default:e.skip()}return s}function bke(e){const s={};for(;e.next();)switch(e.tag()){case 1:s.shapeAreaFieldName=e.getString();break;case 2:s.shapeLengthFieldName=e.getString();break;case 3:s.units=e.getString();break;default:e.skip()}return s}function wke(e,t){const a=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:a.wkid=e.getUInt32();break;case 5:a.wkt=e.getString();break;case 2:a.latestWkid=e.getUInt32();break;case 3:a.vcsWkid=e.getUInt32();break;case 4:a.latestVcsWkid=e.getUInt32();break;default:e.skip()}return a}function xke(e,t){const b=t.createFeatureResult();b.geometryType=rie(t,0);let S=!1;for(;e.next();)switch(e.tag()){case 1:b.objectIdFieldName=e.getString();break;case 3:b.globalIdFieldName=e.getString();break;case 4:b.geohashFieldName=e.getString();break;case 5:b.geometryProperties=e.processMessage(bke);break;case 7:b.geometryType=rie(t,e.getEnum());break;case 8:b.spatialReference=e.processMessageWithArgs(wke,t);break;case 10:b.hasZ=e.getBool();break;case 11:b.hasM=e.getBool();break;case 12:b.transform=e.processMessage(vke);break;case 9:{const T=e.getBool();b.exceededTransferLimit=T;break}case 13:t.addField(b,e.processMessage(fke));break;case 15:S||(t.prepareFeatures(b),S=!0),t.addFeature(b,e.processMessageWithArgs(gke,t,b,b.fields));break;case 2:b.uniqueIdField=e.processMessage(mke);break;default:e.skip()}return t.finishFeatureResult(b),b}function Tke(e,t){const s={};let n=null;for(;e.next();)switch(e.tag()){case 4:n=e.processMessageWithArgs(dke);break;case 1:s.featureResult=e.processMessageWithArgs(xke,t);break;default:e.skip()}return w(n)&&s.featureResult&&t.addQueryGeometry(s,n),s}function Ske(e,t){try{const r=new dx(new Uint8Array(e),new DataView(e)),s={};for(;r.next();)r.tag()===2?s.queryResult=r.processMessageWithArgs(Tke,t):r.skip();return s}catch(i){throw new se("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:i})}}function Eke(e,t){const i=Ske(e,t),r=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(r&&r.features&&r.features.length&&r.objectIdFieldName){const o=r.objectIdFieldName;for(const a of r.features)a.attributes&&(a.objectId=a.attributes[o])}return r&&(r.queryGeometry=s,r.queryGeometryType=n),r}function jj(e,t,i){if(!i||!i.features||!i.hasZ)return;const r=_me(i.geometryType,t,e.outSpatialReference);if(!N(r))for(const s of i.features)r(s.geometry)}const sie="Layer does not support extent calculation.";function r0e(e,t){if(t&&e.type==="extent")return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&e.type==="point")return`${e.x},${e.y}`;const i=e.toJSON();return delete i.spatialReference,JSON.stringify(i)}function s0e(e,t){const i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const s=r;let n,o,a;if(w(i)&&(o=i.spatialReference,a=i.spatialReference.wkid||JSON.stringify(i.spatialReference),s.geometryType=FC(i),s.geometry=r0e(i,e.compactGeometryEnabled),s.inSR=a),r.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(s.objectIds=r.objectIds.join(",")),r.orderByFields&&(s.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&((t==null?void 0:t.returnCountOnly)||(t==null?void 0:t.returnExtentOnly)||(t==null?void 0:t.returnIdsOnly))?delete s.outFields:r.outFields.includes("*")?s.outFields="*":s.outFields=r.outFields.join(","),r.outSR?(s.outSR=r.outSR.wkid||JSON.stringify(r.outSR),n=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(s.outSR=s.inSR,n=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(s.outStatistics=JSON.stringify(r.outStatistics)),r.pixelSize&&(s.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&w(o)&&w(e.quantizationParameters)&&w(e.quantizationParameters.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,s.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(s.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(s.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(s.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const l=r.timeExtent,{start:c,end:h}=l;c==null&&h==null||(s.time=c===h?c:`${c==null?"null":c},${h==null?"null":h}`),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&w(o)&&w(n)&&o.equals(n)&&(s.defaultSR=s.inSR,delete s.inSR,delete s.outSR),s}async function n0e(e,t,i,r){const s=w(t.timeExtent)&&t.timeExtent.isEmpty?{data:{features:[]}}:await XC(e,t,"json",r);return jj(t,i,s.data),s}async function Cke(e,t,i,r){if(w(t.timeExtent)&&t.timeExtent.isEmpty)return{data:i.createFeatureResult()};const s=await o0e(e,t,r),n=s;return n.data=Eke(s.data,i),n}function o0e(e,t,i){return XC(e,t,"pbf",i)}function Ake(e,t,i){return w(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):XC(e,t,"json",i,{returnIdsOnly:!0})}function Oke(e,t,i){return w(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):XC(e,t,"json",i,{returnIdsOnly:!0,returnCountOnly:!0})}function Rke(e,t,i){return w(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):XC(e,t,"json",i,{returnExtentOnly:!0,returnCountOnly:!0}).then(r=>{const s=r.data;if(s.hasOwnProperty("extent"))return r;if(s.features)throw new Error(sie);if(s.hasOwnProperty("count"))throw new Error(sie);return r})}function XC(e,t,i,r={},s={}){const n=typeof e=="string"?$a(e):e,o=t.geometry?[t.geometry]:[];return r.responseType=i==="pbf"?"array-buffer":"json",e0e(o,null,r).then(a=>{const l=a&&a[0];w(l)&&((t=t.clone()).geometry=l);const c=t0e({...n.query,f:i,...s,...s0e(t,s)});return jr(Mx(n.path,"query"),{...r,query:{...c,...r.query}})})}const v1t=Object.freeze(Object.defineProperty({__proto__:null,encodeGeometry:r0e,executeQuery:n0e,executeQueryForCount:Oke,executeQueryForExtent:Rke,executeQueryForIds:Ake,executeQueryPBF:Cke,executeQueryPBFBuffer:o0e,queryToQueryStringParameters:s0e,runQuery:XC},Symbol.toStringTag,{value:"Module"}));var Hj;const qj=new Hi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Yo=Hj=class extends Fe{constructor(e){super(e),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(e,t){var s;const i=wt.fromJSON(t.spatialReference),r=[];for(let n=0;n<e.length;n++){const o=e[n],a=ul.fromJSON(o),l=o.geometry&&o.geometry.spatialReference;w(a.geometry)&&!l&&(a.geometry.spatialReference=i);const c=o.aggregateGeometries,h=a.aggregateGeometries;if(c&&w(h))for(const p in h){const m=h[p],g=(s=c[p])==null?void 0:s.spatialReference;w(m)&&!g&&(m.spatialReference=i)}r.push(a)}return r}writeGeometryType(e,t,i,r){if(e)return void qj.write(e,t,i,r);const{features:s}=this;if(s){for(const n of s)if(n&&w(n.geometry))return void qj.write(n.geometry.type,t,i,r)}}readQueryGeometry(e,t){if(!e)return null;const i=!!e.spatialReference,r=Vy(e);return!i&&t.spatialReference&&(r.spatialReference=wt.fromJSON(t.spatialReference)),r}writeSpatialReference(e,t){if(e)return void(t.spatialReference=e.toJSON());const{features:i}=this;if(i){for(const r of i)if(r&&w(r.geometry)&&r.geometry.spatialReference)return void(t.spatialReference=r.geometry.spatialReference.toJSON())}}clone(){return new Hj(this.cloneProperties())}cloneProperties(){return me({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(e){const t=this.write();if(t.features&&Array.isArray(e)&&e.length>0)for(let i=0;i<t.features.length;i++){const r=t.features[i];if(r.geometry){const s=e&&e[i];r.geometry=s&&s.toJSON()||r.geometry}}return t}quantize(e){const{scale:[t,i],translate:[r,s]}=e,n=c=>Math.round((c-r)/t),o=c=>Math.round((s-c)/i),a=this.features,l=this._getQuantizationFunction(this.geometryType,n,o);for(let c=0,h=a.length;c<h;c++)l(a[c].geometry)||(a.splice(c,1),c--,h--);return this.transform=e,this}unquantize(){const{geometryType:e,features:t,transform:i}=this;if(!i)return this;const{translate:[r,s],scale:[n,o]}=i,a=h=>h*n+r,l=h=>s-h*o,c=this._getHydrationFunction(e,a,l);for(const{geometry:h}of t)w(h)&&c(h);return this.transform=null,this}_quantizePoints(e,t,i){let r,s;const n=[];for(let o=0,a=e.length;o<a;o++){const l=e[o];if(o>0){const c=t(l[0]),h=i(l[1]);c===r&&h===s||(n.push([c-r,h-s]),r=c,s=h)}else r=t(l[0]),s=i(l[1]),n.push([r,s])}return n.length>0?n:null}_getQuantizationFunction(e,t,i){return e==="point"?r=>(r.x=t(r.x),r.y=i(r.y),r):e==="polyline"||e==="polygon"?r=>{const s=sx(r)?r.rings:r.paths,n=[];for(let o=0,a=s.length;o<a;o++){const l=s[o],c=this._quantizePoints(l,t,i);c&&n.push(c)}return n.length>0?(sx(r)?r.rings=n:r.paths=n,r):null}:e==="multipoint"?r=>{const s=this._quantizePoints(r.points,t,i);return s.length>0?(r.points=s,r):null}:e==="extent"?r=>r:null}_getHydrationFunction(e,t,i){return e==="point"?r=>{r.x=t(r.x),r.y=i(r.y)}:e==="polyline"||e==="polygon"?r=>{const s=sx(r)?r.rings:r.paths;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];for(let h=0,p=c.length;h<p;h++){const m=c[h];h>0?(n+=m[0],o+=m[1]):(n=m[0],o=m[1]),m[0]=t(n),m[1]=i(o)}}}:e==="extent"?r=>{r.xmin=t(r.xmin),r.ymin=i(r.ymin),r.xmax=t(r.xmax),r.ymax=i(r.ymax)}:e==="multipoint"?r=>{const s=r.points;let n,o;for(let a=0,l=s.length;a<l;a++){const c=s[a];a>0?(n+=c[0],o+=c[1]):(n=c[0],o=c[1]),c[0]=t(n),c[1]=i(o)}}:void 0}};u([f({type:String,json:{write:!0}})],Yo.prototype,"displayFieldName",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yo.prototype,"exceededTransferLimit",void 0),u([f({type:[ul],json:{write:!0}})],Yo.prototype,"features",void 0),u([it("features")],Yo.prototype,"readFeatures",null),u([f({type:[K3],json:{write:!0}})],Yo.prototype,"fields",void 0),u([f({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:qj.read}}})],Yo.prototype,"geometryType",void 0),u([ut("geometryType")],Yo.prototype,"writeGeometryType",null),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yo.prototype,"hasM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],Yo.prototype,"hasZ",void 0),u([f({types:cT,json:{write:!0}})],Yo.prototype,"queryGeometry",void 0),u([it("queryGeometry")],Yo.prototype,"readQueryGeometry",null),u([f({type:wt,json:{write:!0}})],Yo.prototype,"spatialReference",void 0),u([ut("spatialReference")],Yo.prototype,"writeSpatialReference",null),u([f({json:{write:!0}})],Yo.prototype,"transform",void 0),Yo=Hj=u([B("esri.rest.support.FeatureSet")],Yo),Yo.prototype.toJSON.isDefaultToJSON=!0;const PU=Yo,b1t=Object.freeze(Object.defineProperty({__proto__:null,default:PU},Symbol.toStringTag,{value:"Module"})),nie={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},Mke={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function Pke(e,t){const i=new Date(e,t+1,1);return i.setDate(0),i.getDate()}function px(e,t,i){const r=new Date(e.getTime());if(t&&i){const s=Mke[i],{getter:n,setter:o,multiplier:a}=s;if(i==="months"){const l=Pke(r.getFullYear(),r.getMonth()+t);r.getDate()>l&&r.setDate(l)}r[o](r[n]()+t*a)}return r}function oie(e,t){switch(t){case"milliseconds":return new Date(e.getTime());case"seconds":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());case"minutes":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes());case"hours":return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours());case"days":return new Date(e.getFullYear(),e.getMonth(),e.getDate());case"weeks":return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay());case"months":return new Date(e.getFullYear(),e.getMonth(),1);case"years":return new Date(e.getFullYear(),0,1);case"decades":return new Date(e.getFullYear()-e.getFullYear()%10,0,1);case"centuries":return new Date(e.getFullYear()-e.getFullYear()%100,0,1);default:return new Date}}function Ike(e,t,i){return e===0?0:e*nie[t]/nie[i]}var Kd;let xu=Kd=class extends Fe{constructor(e){super(e),this.end=null,this.start=null}static get allTime(){return aie}static get empty(){return Lke}readEnd(e,t){return t.end!=null?new Date(t.end):null}writeEnd(e,t){t.end=e?e.getTime():null}get isAllTime(){return this.equals(Kd.allTime)}get isEmpty(){return this.equals(Kd.empty)}readStart(e,t){return t.start!=null?new Date(t.start):null}writeStart(e,t){t.start=e?e.getTime():null}clone(){return new Kd({end:this.end,start:this.start})}equals(e){if(!e)return!1;const t=w(this.start)?this.start.getTime():this.start,i=w(this.end)?this.end.getTime():this.end,r=w(e.start)?e.start.getTime():e.start,s=w(e.end)?e.end.getTime():e.end;return t===r&&i===s}expandTo(e){if(this.isEmpty||this.isAllTime)return this.clone();const t=Cn(this.start,r=>oie(r,e)),i=Cn(this.end,r=>px(oie(r,e),1,e));return new Kd({start:t,end:i})}intersection(e){if(!e)return this.clone();if(this.isEmpty||e.isEmpty)return Kd.empty;if(this.isAllTime)return e.clone();if(e.isAllTime)return this.clone();const t=Iu(this.start,-1/0,a=>a.getTime()),i=Iu(this.end,1/0,a=>a.getTime()),r=Iu(e.start,-1/0,a=>a.getTime()),s=Iu(e.end,1/0,a=>a.getTime());let n,o;if(r>=t&&r<=i?n=r:t>=r&&t<=s&&(n=t),i>=r&&i<=s?o=i:s>=t&&s<=i&&(o=s),!isNaN(n)&&!isNaN(o)){const a=new Kd;return a.start=n===-1/0?null:new Date(n),a.end=o===1/0?null:new Date(o),a}return Kd.empty}offset(e,t){if(this.isEmpty||this.isAllTime)return this.clone();const i=new Kd,{start:r,end:s}=this;return w(r)&&(i.start=px(r,e,t)),w(s)&&(i.end=px(s,e,t)),i}union(e){if(!e||e.isEmpty)return this.clone();if(this.isEmpty)return e.clone();if(this.isAllTime||e.isAllTime)return aie.clone();const t=w(this.start)&&w(e.start)?new Date(Math.min(this.start.getTime(),e.start.getTime())):null,i=w(this.end)&&w(e.end)?new Date(Math.max(this.end.getTime(),e.end.getTime())):null;return new Kd({start:t,end:i})}};u([f({type:Date,json:{write:{allowNull:!0}}})],xu.prototype,"end",void 0),u([it("end")],xu.prototype,"readEnd",null),u([ut("end")],xu.prototype,"writeEnd",null),u([f({readOnly:!0,json:{read:!1}})],xu.prototype,"isAllTime",null),u([f({readOnly:!0,json:{read:!1}})],xu.prototype,"isEmpty",null),u([f({type:Date,json:{write:{allowNull:!0}}})],xu.prototype,"start",void 0),u([it("start")],xu.prototype,"readStart",null),u([ut("start")],xu.prototype,"writeStart",null),xu=Kd=u([B("esri.TimeExtent")],xu);const aie=new xu,Lke=new xu({start:void 0,end:void 0}),jm=xu;var Wj;const lie=new Hi({upperLeft:"upper-left",lowerLeft:"lower-left"});let Gb=Wj=class extends Fe{constructor(e){super(e),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new Wj(me({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};u([f({type:zi,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Gb.prototype,"extent",void 0),u([f({type:["view","edit"],json:{write:!0}})],Gb.prototype,"mode",void 0),u([f({type:String,json:{read:lie.read,write:lie.write}})],Gb.prototype,"originPosition",void 0),u([f({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],Gb.prototype,"tolerance",void 0),Gb=Wj=u([B("esri.rest.support.QuantizationParameters")],Gb);const $ke=Gb;var Zj;const cie=new Hi({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let ep=Zj=class extends Fe{constructor(e){super(e),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(e,t){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(t.statisticParameters=me(e))}clone(){return new Zj({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:me(this.statisticParameters)})}};u([f({type:Number,json:{write:!0}})],ep.prototype,"maxPointCount",void 0),u([f({type:Number,json:{write:!0}})],ep.prototype,"maxRecordCount",void 0),u([f({type:Number,json:{write:!0}})],ep.prototype,"maxVertexCount",void 0),u([f({type:String,json:{write:!0}})],ep.prototype,"onStatisticField",void 0),u([f({type:String,json:{write:!0}})],ep.prototype,"outStatisticFieldName",void 0),u([f({type:String,json:{read:{source:"statisticType",reader:cie.read},write:{target:"statisticType",writer:cie.write}}})],ep.prototype,"statisticType",void 0),u([f({type:Object})],ep.prototype,"statisticParameters",void 0),u([ut("statisticParameters")],ep.prototype,"writeStatisticParameters",null),ep=Zj=u([B("esri.rest.support.StatisticDefinition")],ep);const a0e=ep;var lE;const Dke=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),Nke=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let qt=lE=class extends Fe{constructor(e){super(e),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(e){return OE(lE,e)}castDatumTransformation(e){return typeof e=="number"||typeof e=="object"?e:null}writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeParameterValues(e,t){if(e){const i={};for(const r in e){const s=e[r];Array.isArray(s)?i[r]=s.map(n=>n instanceof Date?n.getTime():n):s instanceof Date?i[r]=s.getTime():i[r]=s}t.parameterValues=i}}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,t.where="1=1"}writeWhere(e,t){t.where=e||"1=1"}clone(){return new lE(me({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:w(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};qt.MAX_MAX_RECORD_COUNT_FACTOR=5,u([f({json:{write:!0}})],qt.prototype,"aggregateIds",void 0),u([f({type:Boolean,json:{write:!0}})],qt.prototype,"cacheHint",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"compactGeometryEnabled",void 0),u([f({json:{write:!0}})],qt.prototype,"datumTransformation",void 0),u([pi("datumTransformation")],qt.prototype,"castDatumTransformation",null),u([f({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"defaultSpatialReferenceEnabled",void 0),u([f({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],qt.prototype,"distance",void 0),u([f({type:gp,json:{write:!0}})],qt.prototype,"dynamicDataSource",void 0),u([f({type:String,json:{write:!0}})],qt.prototype,"formatOf3DObjects",void 0),u([f({type:String,json:{write:!0}})],qt.prototype,"gdbVersion",void 0),u([f({types:cT,json:{read:Vy,write:!0}})],qt.prototype,"geometry",void 0),u([f({type:Number,json:{write:!0}})],qt.prototype,"geometryPrecision",void 0),u([f({type:[String],json:{write:!0}})],qt.prototype,"groupByFieldsForStatistics",void 0),u([f({type:String,json:{write:!0}})],qt.prototype,"having",void 0),u([f({type:Date})],qt.prototype,"historicMoment",void 0),u([ut("historicMoment")],qt.prototype,"writeHistoricMoment",null),u([f({type:Number,json:{write:!0}})],qt.prototype,"maxAllowableOffset",void 0),u([f({type:Number,cast:e=>e<1?1:e>lE.MAX_MAX_RECORD_COUNT_FACTOR?lE.MAX_MAX_RECORD_COUNT_FACTOR:e,json:{write:{overridePolicy:e=>({enabled:e>1})}}})],qt.prototype,"maxRecordCountFactor",void 0),u([f({type:["xyFootprint"],json:{write:!0}})],qt.prototype,"multipatchOption",void 0),u([f({type:Number,json:{read:{source:"resultRecordCount"}}})],qt.prototype,"num",void 0),u([f({json:{write:!0}})],qt.prototype,"objectIds",void 0),u([f({type:[String],json:{write:!0}})],qt.prototype,"orderByFields",void 0),u([f({type:[String],json:{write:!0}})],qt.prototype,"outFields",void 0),u([f({type:wt,json:{name:"outSR",write:!0}})],qt.prototype,"outSpatialReference",void 0),u([f({type:[a0e],json:{write:{enabled:!0,overridePolicy(){return{enabled:w(this.outStatistics)&&this.outStatistics.length>0}}}}})],qt.prototype,"outStatistics",void 0),u([f({json:{write:!0}})],qt.prototype,"parameterValues",void 0),u([ut("parameterValues")],qt.prototype,"writeParameterValues",null),u([f({type:xt,json:{write:!0}})],qt.prototype,"pixelSize",void 0),u([f({type:$ke,json:{write:!0}})],qt.prototype,"quantizationParameters",void 0),u([f({type:[Object],json:{write:!0}})],qt.prototype,"rangeValues",void 0),u([f({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],qt.prototype,"relationParameter",void 0),u([f({type:String,json:{write:!0}})],qt.prototype,"resultType",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnCentroid",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnDistinctValues",void 0),u([f({type:Boolean,json:{default:!0,write:!0}})],qt.prototype,"returnExceededLimitFeatures",void 0),u([f({type:Boolean,json:{write:!0}})],qt.prototype,"returnGeometry",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnQueryGeometry",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"returnM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],qt.prototype,"returnZ",void 0),u([f({type:wt,json:{write:!0}})],qt.prototype,"sourceSpatialReference",void 0),u([Rt(Dke,{ignoreUnknown:!1,name:"spatialRel"})],qt.prototype,"spatialRelationship",void 0),u([f({type:Number,json:{read:{source:"resultOffset"}}})],qt.prototype,"start",void 0),u([ut("start"),ut("num")],qt.prototype,"writeStart",null),u([f({type:String,json:{write:!0}})],qt.prototype,"sqlFormat",void 0),u([f({type:String,json:{write:!0}})],qt.prototype,"text",void 0),u([f({type:jm,json:{write:!0}})],qt.prototype,"timeExtent",void 0),u([f({type:Boolean,json:{default:!1,write:!0}})],qt.prototype,"timeReferenceUnknownClient",void 0),u([Rt(Nke,{ignoreUnknown:!1}),f({json:{write:{overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],qt.prototype,"units",void 0),u([f({type:String,json:{write:{overridePolicy(e){return{enabled:e!=null||this.start>0}}}}})],qt.prototype,"where",void 0),u([ut("where")],qt.prototype,"writeWhere",null),qt=lE=u([B("esri.rest.support.Query")],qt);const xp=qt;async function BV(e,t,i){const r=await Fke(e,t,i);return PU.fromJSON(r)}async function Fke(e,t,i){const r=Qye(e),s={...i},n=xp.from(t),{data:o}=await n0e(r,n,n.sourceSpatialReference,s);return o}function Ia(e,t){return e?t?4:3:t?3:2}const eI=Ie.getLogger("esri.layers.graphics.featureConversionUtils"),l0e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},c0e=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n},i5=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2]},kke=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+3]},u0e=(e,t,i,r,s,n)=>{e[i]=s,e[i+1]=n,e[i+2]=t[r+2],e[i+3]=t[r+3]};function fY(e,t,i,r){if(e){if(i)return t&&r?u0e:i5;if(t&&r)return kke}else if(t&&r)return i5;return c0e}function VV({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function GV({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function uie({scale:e,translate:t},i){return i*e[0]+t[0]}function hie({scale:e,translate:t},i){return t[1]-i*e[1]}function w1t(e,t,i){return e?t?i?yY(e):mY(e):i?gY(e):IU(e):null}function IU(e){const t=e.coords;return{x:t[0],y:t[1]}}function h0e(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function mY(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function Uke(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function gY(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function zke(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function yY(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function Bke(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function Vke(e,t,i,r){let s=IU;i&&r?s=yY:i?s=mY:r&&(s=gY);for(const n of t){const{geometry:o,attributes:a}=n,l=w(o)?s(o):null;e.push({attributes:a,geometry:l})}return e}function _Y(e,t){return e&&t?Bke:e?Uke:t?zke:h0e}function Gke(e,t,i,r,s){const n=_Y(i,r);for(const o of t){const{geometry:a,attributes:l}=o;let c;a&&(c=n(new ql,a)),e.push(new Lm(c,l,null,l[s]))}return e}function x1t(e,t,i=_Y(t.z!=null,t.m!=null)){return i(e,t)}function jke(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;n&&(a=d0e(n,i,r)),e.push({attributes:o,geometry:a})}return e}function d0e(e,t,i){if(N(e))return null;const r=Ia(t,i),s=[];for(let n=0;n<e.coords.length;n+=r){const o=[];for(let a=0;a<r;a++)o.push(e.coords[n+a]);s.push(o)}return t?i?{points:s,hasZ:t,hasM:i}:{points:s,hasZ:t}:i?{points:s,hasM:i}:{points:s}}function Hke(e,t,i,r,s){const n=Ia(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=p0e(new ql,a,n)),e.push(new Lm(c,l,null,l[s]))}return e}function p0e(e,t,i=Ia(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const r=e.coords;let s=0;for(const n of t.points)for(let o=0;o<i;o++)r[s++]=n[o];return e}function qke(e,t,i,r){for(const s of t){const{geometry:n,attributes:o}=s;let a;w(n)&&(a=f0e(n,i,r)),e.push({attributes:o,geometry:a})}return e}function f0e(e,t,i){if(!e)return null;const r=Ia(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let m=0;m<r;m++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{paths:o,hasZ:t,hasM:i}:{paths:o,hasZ:t}:i?{paths:o,hasM:i}:{paths:o}}function Wke(e,t,i,r,s){const n=Ia(i,r);for(const o of t){const a=o.geometry,l=o.attributes;let c;a&&(c=m0e(new ql,a,n)),e.push(new Lm(c,l,null,l[s]))}return e}function m0e(e,t,i=Ia(t.hasZ,t.hasM)){const{lengths:r,coords:s}=e;let n=0;for(const o of t.paths){for(const a of o)for(let l=0;l<i;l++)s[n++]=a[l];r.push(o.length)}return e}function Zke(e,t,i,r){for(const s of t){const{geometry:n,attributes:o,centroid:a}=s;let l;if(w(n)&&(l=g0e(n,i,r)),w(a)){const c=IU(a);e.push({attributes:o,centroid:c,geometry:l})}else e.push({attributes:o,geometry:l})}return e}function g0e(e,t,i){if(!e)return null;const r=Ia(t,i),{coords:s,lengths:n}=e,o=[];let a=0;for(const l of n){const c=[];for(let h=0;h<l;h++){const p=[];for(let m=0;m<r;m++)p.push(s[a++]);c.push(p)}o.push(c)}return t?i?{rings:o,hasZ:t,hasM:i}:{rings:o,hasZ:t}:i?{rings:o,hasM:i}:{rings:o}}function Xke(e,t,i,r,s){for(const n of t){const o=n.geometry,a=n.centroid,l=n.attributes;let c;o&&(c=y0e(new ql,o,i,r)),w(a)?e.push(new Lm(c,l,h0e(new ql,a),l[s])):e.push(new Lm(c,l,null,l[s]))}return e}function y0e(e,t,i=t.hasZ,r=t.hasM){return Yke(e,t.rings,i,r),e}function Yke(e,t,i,r){const s=Ia(i,r),{lengths:n,coords:o}=e;let a=0;n.length=o.length=0;for(const l of t){for(const c of l)for(let h=0;h<s;h++)o[a++]=c[h];n.push(l.length)}return e}const cE=[],MM=[];function T1t(e,t,i,r,s){cE[0]=e;const[n]=_0e(MM,cE,t,i,r,s);return cE.length=MM.length=0,n}function _0e(e,t,i,r,s,n){if(e.length=0,!i){for(const o of t){const a=o.attributes[n];e.push(new Lm(null,o.attributes,null,a))}return e}switch(i){case"esriGeometryPoint":return Gke(e,t,r,s,n);case"esriGeometryMultipoint":return Hke(e,t,r,s,n);case"esriGeometryPolyline":return Wke(e,t,r,s,n);case"esriGeometryPolygon":return Xke(e,t,r,s,n);default:eI.error("convertToFeatureSet:unknown-geometry",new se(`Unable to parse unknown geometry type '${i}'`)),e.length=0}return e}function S1t(e,t,i,r){MM[0]=e,v0e(cE,MM,t,i,r);const s=cE[0];return cE.length=MM.length=0,s}function Qke(e,t,i){if(N(e))return null;const r=new ql;return"hasZ"in e&&t==null&&(t=e.hasZ),"hasM"in e&&i==null&&(i=e.hasM),NZ(e)?_Y(t!=null?t:e.z!=null,i!=null?i:e.m!=null)(r,e):sx(e)?y0e(r,e,t,i):FZ(e)?m0e(r,e,Ia(t,i)):DZ(e)?p0e(r,e,Ia(t,i)):void eI.error("convertFromGeometry:unknown-geometry",new se(`Unable to parse unknown geometry type '${e}'`))}function Jke(e,t,i,r){const s=e&&("coords"in e?e:e.geometry);if(N(s))return null;switch(t){case"esriGeometryPoint":{let n=IU;return i&&r?n=yY:i?n=mY:r&&(n=gY),n(s)}case"esriGeometryMultipoint":return d0e(s,i,r);case"esriGeometryPolyline":return f0e(s,i,r);case"esriGeometryPolygon":return g0e(s,i,r);default:return void eI.error("convertToGeometry:unknown-geometry",new se(`Unable to parse unknown geometry type '${t}'`))}}function Kke(e,t){for(const i of t)e.push({attributes:i.attributes});return e}function v0e(e,t,i,r,s){if(e.length=0,N(i))return Kke(e,t);switch(i){case"esriGeometryPoint":return Vke(e,t,r,s);case"esriGeometryMultipoint":return jke(e,t,r,s);case"esriGeometryPolyline":return qke(e,t,r,s);case"esriGeometryPolygon":return Zke(e,t,r,s);default:eI.error("convertToFeatureSet:unknown-geometry",new se(`Unable to parse unknown geometry type '${i}'`))}return e}function E1t(e){const{objectIdFieldName:t,spatialReference:i,transform:r,fields:s,hasM:n,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:h,queryGeometry:p,queryGeometryType:m}=e,g={features:v0e([],a,l,o,n),fields:s,geometryType:l,objectIdFieldName:t,spatialReference:i,uniqueIdField:h,queryGeometry:Jke(p,m,!1,!1)};return r&&(g.transform=r),c&&(g.exceededTransferLimit=c),n&&(g.hasM=n),o&&(g.hasZ=o),g}function C1t(e,t){const i=new MU,{hasM:r,hasZ:s,features:n,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:h,fields:p}=e;return p&&(i.fields=p),i.geometryType=l,i.objectIdFieldName=o||t,i.spatialReference=a,i.objectIdFieldName?(n&&_0e(i.features,n,l,s,r,i.objectIdFieldName),c&&(i.exceededTransferLimit=c),r&&(i.hasM=r),s&&(i.hasZ=s),h&&(i.transform=h),i):(eI.error(new se("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),i)}function A1t(e){const{transform:t,features:i,hasM:r,hasZ:s}=e;if(!t)return e;for(const n of i)w(n.geometry)&&pie(n.geometry,n.geometry,r,s,t),w(n.centroid)&&pie(n.centroid,n.centroid,r,s,t);return e.transform=null,e}function O1t(e,t){const{geometryType:i,features:r,hasM:s,hasZ:n}=t;if(!e)return t;for(let o=0;o<r.length;o++){const a=r[o],l=a.weakClone();l.geometry=new ql,die(l.geometry,a.geometry,s,n,i,e),a.centroid&&(l.centroid=new ql,die(l.centroid,a.centroid,s,n,"esriGeometryPoint",e)),r[o]=l}return t.transform=e,t}function die(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),N(t)||!t.coords.length)return null;const l=l0e[s],{coords:c,lengths:h}=t,p=Ia(i,r),m=Ia(i&&o,r&&a),g=fY(i,r,o,a);if(!h.length)return g(e.coords,c,0,0,VV(n,c[0]),GV(n,c[1])),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let v,b,S,T,O=0,C=0,M=C;for(const I of h){if(I<l)continue;let $=0;C=M,S=v=VV(n,c[O]),T=b=GV(n,c[O+1]),g(e.coords,c,C,O,S,T),$++,O+=p,C+=m;for(let U=1;U<I;U++,O+=p)S=VV(n,c[O]),T=GV(n,c[O+1]),S===v&&T===b||(g(e.coords,c,C,O,S-v,T-b),C+=m,$++,v=S,b=T);$>=l&&(e.lengths.push($),M=C)}return e.coords.length=M,e.coords.length?e:null}function R1t(e,t,i,r,s,n,o=i,a=r){if(e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0),!t||!t.coords.length)return null;const l=l0e[s],{coords:c,lengths:h}=t,p=Ia(i,r),m=Ia(i&&o,r&&a),g=fY(i,r,o,a);if(!h.length)return g(e.coords,c,0,0,c[0],c[1]),e.lengths.length&&(e.lengths.length=0),e.coords.length=p,e;let v=0;const b=n*n;for(const S of h){if(S<l){v+=S*p;continue}const T=e.coords.length/m,O=v,C=v+(S-1)*p;g(e.coords,c,e.coords.length,O,c[O],c[O+1]),Xj(e.coords,c,p,b,g,O,C),g(e.coords,c,e.coords.length,C,c[C],c[C+1]);const M=e.coords.length/m-T;M>=l?e.lengths.push(M):e.coords.length=T*m,v+=S*p}return e.coords.length?e:null}function eUe(e,t,i,r){const s=e[t],n=e[t+1],o=e[i],a=e[i+1],l=e[r],c=e[r+1];let h=o,p=a,m=l-h,g=c-p;if(m!==0||g!==0){const v=((s-h)*m+(n-p)*g)/(m*m+g*g);v>1?(h=l,p=c):v>0&&(h+=m*v,p+=g*v)}return m=s-h,g=n-p,m*m+g*g}function Xj(e,t,i,r,s,n,o){let a,l=r,c=0;for(let h=n+i;h<o;h+=i)a=eUe(t,h,n,o),a>l&&(c=h,l=a);l>r&&(c-n>i&&Xj(e,t,i,r,s,n,c),s(e,t,e.length,c,t[c],t[c+1]),o-c>i&&Xj(e,t,i,r,s,c,o))}function M1t(e,t,i,r){if(N(t)||!t.coords||!t.coords.length)return null;const s=Ia(i,r);let n=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(t&&t.coords){const c=t.coords;for(let h=0;h<c.length;h+=s){const p=c[h],m=c[h+1];n=Math.min(n,p),a=Math.max(a,p),o=Math.min(o,m),l=Math.max(l,m)}}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function pie(e,t,i,r,s){const{coords:n,lengths:o}=t,a=i?r?u0e:i5:r?i5:c0e,l=Ia(i,r);if(!n.length)return e!==t&&(e.lengths.length=0,e.coords.length=0),e;if(!o.length)return a(e.coords,n,0,0,uie(s,n[0]),hie(s,n[1])),e!==t&&(e.lengths.length=0,e.coords.length=l),e;const[c,h]=s.scale;let p=0;for(let m=0;m<o.length;m++){const g=o[m];e.lengths[m]=g;let v=uie(s,n[p]),b=hie(s,n[p+1]);a(e.coords,n,p,p,v,b),p+=l;for(let S=1;S<g;S++,p+=l)v+=n[p]*c,b-=n[p+1]*h,a(e.coords,n,p,p,v,b)}return e!==t&&(e.lengths.length=o.length,e.coords.length=n.length),e}function P1t(e,t,i,r,s,n){const o=Ia(i,r),a=fY(i,r,s,n),l=t.coords;e.coords.length=0,e.lengths.length=0,e.lengths.push(...t.lengths);for(let c=0;c<l.length;c+=o)a(e.coords,l,e.coords.length,c,l[c],l[c+1]);return e}function tUe(e,t,i,r){let s=0,n=e[r*t],o=e[r*(t+1)];for(let a=1;a<i;a++){const l=n+e[r*(t+a)],c=o+e[r*(t+a)+1],h=(l-n)*(c+o);n=l,o=c,s+=h}return .5*s}function I1t(e,t){const{coords:i,lengths:r}=e;let s=0,n=0;for(let o=0;o<r.length;o++)n+=tUe(i,s,r[o],t),s+=o;return Math.abs(n)}function L1t(e,t){if(N(e))return null;const i=e.clone(),r=e.coords,s=e.lengths;let n=0;for(let o=0;o<s.length;o++){const a=s[o];let l=r[t*n],c=r[t*n+1];for(let h=1;h<a;h++){const p=l+r[t*(n+h)],m=c+r[t*(n+h)+1];i.coords[t*(n+h)]=p,i.coords[t*(n+h)+1]=m,l=p,c=m}n+=a}return i}var Yj;let zs=Yj=class extends Fe{constructor(e){super(e),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(e,t){t.historicMoment=e&&e.getTime()}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(t.definitionExpression="1=1")}clone(){return new Yj(me({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};u([f({type:Boolean,json:{write:!0}})],zs.prototype,"cacheHint",void 0),u([f({type:gp,json:{write:!0}})],zs.prototype,"dynamicDataSource",void 0),u([f({type:String,json:{write:!0}})],zs.prototype,"gdbVersion",void 0),u([f({type:Number,json:{write:!0}})],zs.prototype,"geometryPrecision",void 0),u([f({type:Date})],zs.prototype,"historicMoment",void 0),u([ut("historicMoment")],zs.prototype,"_writeHistoricMoment",null),u([f({type:Number,json:{write:!0}})],zs.prototype,"maxAllowableOffset",void 0),u([f({type:[Number],json:{write:!0}})],zs.prototype,"objectIds",void 0),u([f({type:[String],json:{write:!0}})],zs.prototype,"orderByFields",void 0),u([f({type:[String],json:{write:!0}})],zs.prototype,"outFields",void 0),u([f({type:wt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],zs.prototype,"outSpatialReference",void 0),u([f({json:{write:!0}})],zs.prototype,"relationshipId",void 0),u([f({type:Number,json:{read:{source:"resultOffset"}}})],zs.prototype,"start",void 0),u([ut("start"),ut("num")],zs.prototype,"writeStart",null),u([f({type:Number,json:{read:{source:"resultRecordCount"}}})],zs.prototype,"num",void 0),u([f({json:{write:!0}})],zs.prototype,"returnGeometry",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],zs.prototype,"returnM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],zs.prototype,"returnZ",void 0),u([f({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],zs.prototype,"where",void 0),zs=Yj=u([B("esri.rest.support.RelationshipQuery")],zs),zs.from=hn(zs);const Qj=zs;var Jj;let e2=Jj=class extends Fe{constructor(e){super(e),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new Jj({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};u([f({type:[String],json:{write:!0}})],e2.prototype,"groupByFields",void 0),u([f({type:Number,json:{write:!0}})],e2.prototype,"topCount",void 0),u([f({type:[String],json:{write:!0}})],e2.prototype,"orderByFields",void 0),e2=Jj=u([B("esri.rest.support.TopFilter")],e2);const iUe=e2;var Kj;const fie=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),mie=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let ws=Kj=class extends Fe{constructor(e){super(e),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(e,t){t.resultOffset=this.start,t.resultRecordCount=this.num||10}clone(){return new Kj(me({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};u([f({type:Boolean,json:{write:!0}})],ws.prototype,"cacheHint",void 0),u([f({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],ws.prototype,"distance",void 0),u([f({types:cT,json:{read:Vy,write:!0}})],ws.prototype,"geometry",void 0),u([f({type:Number,json:{write:!0}})],ws.prototype,"geometryPrecision",void 0),u([f({type:Number,json:{write:!0}})],ws.prototype,"maxAllowableOffset",void 0),u([f({type:Number,json:{read:{source:"resultRecordCount"}}})],ws.prototype,"num",void 0),u([f({json:{write:!0}})],ws.prototype,"objectIds",void 0),u([f({type:[String],json:{write:!0}})],ws.prototype,"orderByFields",void 0),u([f({type:[String],json:{write:!0}})],ws.prototype,"outFields",void 0),u([f({type:wt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ws.prototype,"outSpatialReference",void 0),u([f({type:String,json:{write:!0}})],ws.prototype,"resultType",void 0),u([f({json:{write:!0}})],ws.prototype,"returnGeometry",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ws.prototype,"returnM",void 0),u([f({type:Boolean,json:{write:{overridePolicy:e=>({enabled:e})}}})],ws.prototype,"returnZ",void 0),u([f({type:Number,json:{read:{source:"resultOffset"}}})],ws.prototype,"start",void 0),u([ut("start"),ut("num")],ws.prototype,"writeStart",null),u([f({type:String,json:{read:{source:"spatialRel",reader:fie.read},write:{target:"spatialRel",writer:fie.write}}})],ws.prototype,"spatialRelationship",void 0),u([f({type:jm,json:{write:!0}})],ws.prototype,"timeExtent",void 0),u([f({type:iUe,json:{write:!0}})],ws.prototype,"topFilter",void 0),u([f({type:String,json:{read:mie.read,write:{writer:mie.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],ws.prototype,"units",void 0),u([f({type:String,json:{write:!0}})],ws.prototype,"where",void 0),ws=Kj=u([B("esri.rest.support.TopFeaturesQuery")],ws),ws.from=hn(ws);const FL=ws,rUe="esri.widgets.Feature.support.relatedFeatureUtils",gie=Ie.getLogger(rUe),yie=new Map;function eH(e){if(!by(e))return null;const[t,i]=e.split("/").slice(1);return{layerId:t,fieldName:i}}function sUe(e,t){if(!t.relationships)return null;let i=null;const{relationships:r}=t;return r.some(s=>s.id===parseInt(e,10)&&(i=s,!0)),i}function nUe({originRelationship:e,relationships:t,layerId:i}){let r;return t&&t.some(s=>(`${s.relatedTableId}`===i&&s.id===e.id&&(r=s),!!r)),r}function oUe(e,t){const i=t.toLowerCase();for(const r in e)if(r.toLowerCase()===i)return e[r];return null}function aUe(e,t){const i=sUe(e,t);if(!!i)return{url:`${t.url}/${i.relatedTableId}`,sourceSpatialReference:t.spatialReference,relation:i,relatedFields:[],outStatistics:[]}}function lUe(e,t){if(!t||!e)return;const{features:i,statsFeatures:r}=e,s=i&&i.value;t.relatedFeatures=s?s.features:[];const n=r&&r.value;t.relatedStatsFeatures=n?n.features:[]}function cUe(e,t,i,r){const s=new Qj;return s.outFields=["*"],s.relationshipId=typeof t.id=="number"?t.id:parseInt(t.id,10),s.objectIds=[e.attributes[i.objectIdField]],i.queryRelatedFeatures(s,r)}function uUe(e,t,i){let r=0;const s=[];for(;r<t.length;)s.push(`${e} IN (${t.slice(r,i+r)})`),r+=i;return s.join(" OR ")}async function hUe(e,t,i,r){const s=i.layerId.toString(),{layerInfo:n,relation:o,relatedFields:a,outStatistics:l,url:c,sourceSpatialReference:h}=t,p=nUe({originRelationship:o,relationships:n.relationships,layerId:s});if(p.relationshipTableId&&p.keyFieldInRelationshipTable){const g=(await cUe(e,p,i,r))[e.attributes[i.objectIdField]];if(!g)return null;const v=g.features.map(b=>b.attributes[n.objectIdField]);if((l==null?void 0:l.length)>0&&n.supportsStatistics){const b=new xp;b.where=uUe(n.objectIdField,v,1e3),b.outFields=a,b.outStatistics=l,b.sourceSpatialReference=h;const S={features:Promise.resolve(g),statsFeatures:BV(c,b)};return cl(S)}}const m=p==null?void 0:p.keyField;if(m){const g=kk(gUe(n.fields,m)),v=oUe(e.attributes,o.keyField),b=g?`${m}=${v}`:`${m}='${v}'`,S=BV(c,new xp({where:b,outFields:t.relatedFields,sourceSpatialReference:h}),r),T=t.outStatistics&&t.outStatistics.length>0&&n.supportsStatistics?BV(c,new xp({where:b,outFields:t.relatedFields,outStatistics:t.outStatistics,sourceSpatialReference:h}),r):null,O={features:S};return T&&(O.statsFeatures=T),cl(O)}return null}function dUe(e,t){return jr(e,{query:{f:"json"},signal:t&&t.signal})}function pUe({relatedInfos:e,layer:t},i){const r={};return e.forEach((s,n)=>{const{relation:o}=s;if(!o){const p=new se("relation-required","A relation is required on a layer to retrieve related records.");throw gie.error(p),p}const{relatedTableId:a}=o;if(typeof a!="number"){const p=new se("A related table ID is required on a layer to retrieve related records.");throw gie.error(p),p}const l=`${t.url}/${a}`,c=yie.get(l),h=c||dUe(l,i);c||yie.set(l,h),r[n]=h}),cl(r)}function fUe({graphic:e,relatedInfos:t,layer:i},r){const s={};return t.forEach((n,o)=>{n.layerInfo&&(s[o]=hUe(e,n,i,r))}),cl(s)}function mUe({relatedInfo:e,fieldName:t,fieldInfo:i}){if(e.relatedFields.push(t),i.statisticType){const r=new a0e({statisticType:i.statisticType,onStatisticField:t,outStatisticFieldName:t});e.outStatistics.push(r)}}function gUe(e,t){if(e!=null){t=t.toLowerCase();for(const i of e)if(i&&i.name.toLowerCase()===t)return i}return null}const _ie={chartAnimation:!0};let bo=class extends ze{constructor(e){super(e),this.abilities={..._ie},this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(e){return{..._ie,...e}}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(e){this._setContentElementMedia(e)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(e){const{formattedMediaInfoCount:t}=this,i=(e+t)%t;this.activeMediaInfoIndex=i}_pageContentElementMedia(e){const{activeMediaInfoIndex:t}=this,i=t+e;this._setContentElementMedia(i)}_formatMediaInfos(){const{attributes:e,mediaInfos:t,formattedAttributes:i,expressionAttributes:r,fieldInfoMap:s,layer:n}=this;return t==null?void 0:t.map(o=>{const a=o==null?void 0:o.clone();if(!a)return null;if(a.title=Gw({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.title}),a.caption=Gw({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.caption}),a.altText=Gw({attributes:e,fieldInfoMap:s,globalAttributes:i,expressionAttributes:r,layer:n,text:a.altText}),a.type==="image"){const{value:l}=a;return this._setImageValue({value:l,formattedAttributes:i,layer:n}),a.value.sourceURL?a:void 0}if(a.type==="pie-chart"||a.type==="line-chart"||a.type==="column-chart"||a.type==="bar-chart"){const{value:l}=a;return this._setChartValue({value:l,chartType:a.type,attributes:e,formattedAttributes:i,layer:n}),a}return null}).filter(Boolean)}_setImageValue(e){const{fieldInfoMap:t}=this,{value:i,formattedAttributes:r,layer:s}=e,{linkURL:n,sourceURL:o}=i;if(o){const a=Rj(o,s);i.sourceURL=Oj({formattedAttributes:r,template:a,fieldInfoMap:t})}if(n){const a=Rj(n,s);i.linkURL=Oj({formattedAttributes:r,template:a,fieldInfoMap:t})}}_setChartValue(e){const{value:t,attributes:i,formattedAttributes:r,chartType:s,layer:n}=e,{popupTemplate:o,relatedInfos:a}=this,{fields:l,normalizeField:c}=t;if(t.fields=GFe(l,n),c&&(t.normalizeField=e5(c,n)),!l.some(p=>!!(r[p]!=null||by(p)&&a.size)))return;const h=o==null?void 0:o.fieldInfos;l.forEach(p=>{if(by(p))return void(t.series=[...t.series,...this._getRelatedChartInfos({fieldInfos:h,fieldName:p,formattedAttributes:r,chartType:s,value:t})]);const m=this._getChartOption({value:t,attributes:i,chartType:s,formattedAttributes:r,fieldName:p,fieldInfos:h});t.series.push(m)})}_getRelatedChartInfos(e){var v;const{fieldInfos:t,fieldName:i,formattedAttributes:r,chartType:s,value:n}=e,o=[],a=eH(i),{layerId:l,fieldName:c}=a,h=(v=this.relatedInfos)==null?void 0:v.get(l.toString());if(!h)return o;const{relatedFeatures:p,relation:m}=h;if(!m||!p)return o;const{cardinality:g}=m;return p.forEach(b=>{const{attributes:S}=b;S&&Object.keys(S).forEach(T=>{T===c&&o.push(this._getChartOption({value:n,attributes:S,formattedAttributes:r,fieldName:i,chartType:s,relatedFieldName:T,fieldInfos:t}))})}),g==="one-to-many"||g==="many-to-many"?o:[o[0]]}_getTooltip({label:e,value:t,chartType:i}){return i==="pie-chart"?`${e}`:`${e}: ${t}`}_getChartOption(e){var C,M,I,$,U,q;const{value:t,attributes:i,formattedAttributes:r,fieldName:s,relatedFieldName:n,fieldInfos:o,chartType:a}=e,{layer:l,fieldInfoMap:c}=this,{normalizeField:h,tooltipField:p}=t,m=h?by(h)?i[eH(h).fieldName]:i[h]:null,g=n&&i[n]!==void 0?i[n]:i[s]!==void 0?i[s]:r[s],v=new _pe({fieldName:s,value:g===void 0?null:g&&m?g/m:g});if(by(s)){const G=c.get(s.toLowerCase()),Y=c.get(p.toLowerCase()),J=(C=G==null?void 0:G.fieldName)!=null?C:s,X=(U=($=(I=r[(M=Y==null?void 0:Y.fieldName)!=null?M:p])!=null?I:G==null?void 0:G.label)!=null?$:G==null?void 0:G.fieldName)!=null?U:n,ne=r[J];return v.tooltip=this._getTooltip({label:X,value:ne,chartType:a}),v}const b=Lye(o,s),S=e5(s,l),T=p&&r[p]!==void 0?r[p]:Pye(b||new G3({fieldName:S}),(q=this.popupTemplate)==null?void 0:q.expressionInfos),O=r[S];return v.tooltip=this._getTooltip({label:T,value:O,chartType:a}),v}};u([f()],bo.prototype,"abilities",void 0),u([pi("abilities")],bo.prototype,"castAbilities",null),u([f()],bo.prototype,"activeMediaInfoIndex",void 0),u([f({readOnly:!0})],bo.prototype,"activeMediaInfo",null),u([f()],bo.prototype,"attributes",void 0),u([f()],bo.prototype,"description",void 0),u([f()],bo.prototype,"fieldInfoMap",void 0),u([f()],bo.prototype,"formattedAttributes",void 0),u([f()],bo.prototype,"expressionAttributes",void 0),u([f({readOnly:!0})],bo.prototype,"formattedMediaInfos",null),u([f()],bo.prototype,"layer",void 0),u([f({readOnly:!0})],bo.prototype,"formattedMediaInfoCount",null),u([f()],bo.prototype,"mediaInfos",void 0),u([f()],bo.prototype,"popupTemplate",void 0),u([f()],bo.prototype,"relatedInfos",void 0),u([f()],bo.prototype,"title",void 0),bo=u([B("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],bo);const Hw=bo;var vie=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],yUe=[].concat(vie.slice(30,39),vie.slice(28,30).reverse()),_Ue=[{name:"default",colors:yUe},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}];const bie="en-us",vY=new Map([["ar",()=>_e(()=>import("./ar.5d7bdca7.js"),["ar.5d7bdca7.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.a)],["bg-bg",()=>_e(()=>import("./bg_BG.e6ba29c2.js"),["bg_BG.e6ba29c2.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.b)],["bs-ba",()=>_e(()=>import("./bs_BA.14911a00.js"),["bs_BA.14911a00.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.b)],["ca-es",()=>_e(()=>import("./ca_ES.1a938920.js"),["ca_ES.1a938920.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.c)],["cs-cz",()=>_e(()=>import("./cs_CZ.8624de8a.js"),["cs_CZ.8624de8a.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.c)],["da-dk",()=>_e(()=>import("./da_DK.aef5a9c8.js"),["da_DK.aef5a9c8.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.d)],["de-de",()=>_e(()=>import("./de_DE.b08b4cf1.js"),["de_DE.b08b4cf1.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.d)],["de-ch",()=>_e(()=>import("./de_CH.0b6cd702.js"),["de_CH.0b6cd702.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.d)],["el-gr",()=>_e(()=>import("./el_GR.8e618bc9.js"),["el_GR.8e618bc9.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.e)],["en-us",()=>_e(()=>import("./en_US.41c717af.js"),["en_US.41c717af.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.e)],["en-ca",()=>_e(()=>import("./en_CA.f60d00bf.js"),["en_CA.f60d00bf.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.e)],["es-es",()=>_e(()=>import("./es_ES.1f0f76f4.js"),["es_ES.1f0f76f4.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.e)],["et-ee",()=>_e(()=>import("./et_EE.a7babafb.js"),["et_EE.a7babafb.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.e)],["fi-fi",()=>_e(()=>import("./fi_FI.fdc0a8b3.js"),["fi_FI.fdc0a8b3.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.f)],["fr-fr",()=>_e(()=>import("./fr_FR.9fb72c1a.js"),["fr_FR.9fb72c1a.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.f)],["he-il",()=>_e(()=>import("./he_IL.3941bb8a.js"),["he_IL.3941bb8a.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.h)],["hr-hr",()=>_e(()=>import("./hr_HR.0f5af0f2.js"),["hr_HR.0f5af0f2.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.h)],["hu-hu",()=>_e(()=>import("./hu_HU.b4dae139.js"),["hu_HU.b4dae139.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.h)],["id-id",()=>_e(()=>import("./id_ID.f5b918ea.js"),["id_ID.f5b918ea.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.i)],["it-it",()=>_e(()=>import("./it_IT.94769a92.js"),["it_IT.94769a92.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.i)],["ja-jp",()=>_e(()=>import("./ja_JP.8eb86db8.js"),["ja_JP.8eb86db8.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.j)],["ko-kr",()=>_e(()=>import("./ko_KR.8ba7fd29.js"),["ko_KR.8ba7fd29.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.k)],["lt-lt",()=>_e(()=>import("./lt_LT.d8c1cc92.js"),["lt_LT.d8c1cc92.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.l)],["lv-lv",()=>_e(()=>import("./lv_LV.ceb923a4.js"),["lv_LV.ceb923a4.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.l)],["nb-no",()=>_e(()=>import("./nb_NO.d0457d8e.js"),["nb_NO.d0457d8e.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.n)],["nl-nl",()=>_e(()=>import("./nl_NL.fbf1ad03.js"),["nl_NL.fbf1ad03.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.n)],["pl-pl",()=>_e(()=>import("./pl_PL.44d49398.js"),["pl_PL.44d49398.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.p)],["pt-br",()=>_e(()=>import("./pt_BR.89b1d3a7.js"),["pt_BR.89b1d3a7.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.p)],["pt-pt",()=>_e(()=>import("./pt_PT.2abd4e91.js"),["pt_PT.2abd4e91.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.p)],["ro-ro",()=>_e(()=>import("./ro_RO.fb4fff60.js"),["ro_RO.fb4fff60.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.r)],["ru-ru",()=>_e(()=>import("./ru_RU.684f53ee.js"),["ru_RU.684f53ee.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.r)],["sk-sk",()=>_e(()=>import("./sk_SK.eaca904e.js"),["sk_SK.eaca904e.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.s)],["sl-sl",()=>_e(()=>import("./sl_SL.cff9b92a.js"),["sl_SL.cff9b92a.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.s)],["sr-rs",()=>_e(()=>import("./sr_RS.44ddc4cf.js"),["sr_RS.44ddc4cf.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.s)],["sv-se",()=>_e(()=>import("./sv_SE.16043ad0.js"),["sv_SE.16043ad0.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.s)],["th-th",()=>_e(()=>import("./th_TH.99f2a35e.js"),["th_TH.99f2a35e.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.t)],["tr-tr",()=>_e(()=>import("./tr_TR.ab1c9f2f.js"),["tr_TR.ab1c9f2f.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.t)],["uk-ua",()=>_e(()=>import("./uk_UA.ae3608ad.js"),["uk_UA.ae3608ad.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.u)],["vi-vn",()=>_e(()=>import("./vi_VN.7d19f32e.js"),["vi_VN.7d19f32e.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.v)],["zh-cn",()=>_e(()=>import("./zh_Hans.0f482448.js"),["zh_Hans.0f482448.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.z)],["zh-hk",()=>_e(()=>import("./zh_Hant.f458376f.js"),["zh_Hant.f458376f.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.z)],["zh-tw",()=>_e(()=>import("./zh_Hant.f458376f.js"),["zh_Hant.f458376f.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(e=>e.z)]]);function vUe(e){const t=e.split("-")[0].toLowerCase();let i=null;for(const r of vY.keys())if(r.startsWith(t)){i=r;break}return i}function bUe(e){return e?vY.has(e.toLowerCase())?e.toLowerCase():vUe(e)||bie:bie}let GT,ZA;async function wUe(e=Hu()){if(e=bUe(e),GT&&e===ZA)return GT;GT=_e(()=>import("./index.7ba26017.js"),["index.7ba26017.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(t=>t.i),ZA=e;try{const[t,i]=await Promise.all([GT,vY.get(ZA)()]);ZA===e&&(t.am4core.options.defaultLocale=i.default),t.am4core.options.suppressWarnings=!0,t.am4core.options.autoDispose=!0}catch{return GT=null,ZA=null,null}return GT}function xUe(e,t="default"){const i=_Ue.find(r=>r.name===t);return i?i.colors.map(r=>e.color(r)):null}const Qs={base:"esri-feature-media",mediaContainer:"esri-feature-media__container",mediaItemContainer:"esri-feature-media__item-container",mediaItem:"esri-feature-media__item",mediaItemTitle:"esri-feature-media__item-title",mediaItemCaption:"esri-feature-media__item-caption",mediaPrevious:"esri-feature-media__previous",mediaPreviousIconLTR:"esri-feature-media__previous-icon",mediaPreviousIconRTL:"esri-feature-media__previous-icon--rtl",mediaNext:"esri-feature-media__next",mediaNextIconLTR:"esri-feature-media__next-icon",mediaNextIconRTL:"esri-feature-media__next-icon--rtl",mediaChart:"esri-feature-media__chart",mediaButton:"esri-feature-media__button",mediaIcon:"esri-feature-media__icon",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow"},jV=.05,HV=.95,qV=15,gg="color",z0="tooltip",XA="value",wie="default-line-value";let fc=class extends dl{constructor(e,t){super(e,t),this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new Hw,this.messages=null,this._getChartDependencies=async i=>{const r=await wUe(),{destroyed:s,viewModel:n}=this;if(s||!n||!i)return;const{activeMediaInfo:o}=n,a=await this._getRendererColors(r);this._renderChart({chartDiv:i,mediaInfo:o,chartsModule:r,colorMap:a})}}initialize(){this._featureElementInfo=new oY,this.own([xe(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.activeMediaInfo,(t=this.viewModel)==null?void 0:t.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),si),xe(()=>{var e,t;return[(e=this.viewModel)==null?void 0:e.description,(t=this.viewModel)==null?void 0:t.title]},()=>this._setupFeatureElementInfo(),si)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var e;return Te("div",{bind:this,class:Qs.base,onkeyup:this._handleMediaKeyup},(e=this._featureElementInfo)==null?void 0:e.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:e}=this.viewModel;return e?Te("div",{key:"media-element-container",class:Qs.mediaContainer},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(e){const{_refreshIntervalInfo:t}=this,{activeMediaInfoIndex:i,formattedMediaInfoCount:r}=this.viewModel,{value:s,refreshInterval:n,altText:o,title:a,type:l}=e,{sourceURL:c,linkURL:h}=s,p=Rye(h)?"_blank":"_self",m=p==="_blank"?"noreferrer":"",g=n?t:null,v=g?g.timestamp:0,b=g?g.sourceURL:c,S=Te("img",{alt:o||a,key:`media-${l}-${i}-${r}-${v}`,src:b});return(h?Te("a",{title:a,href:h,rel:m,target:p},S):null)||S}renderChartMediaInfo(e){const{activeMediaInfoIndex:t,formattedMediaInfoCount:i}=this.viewModel;return Te("div",{key:`media-${e.type}-${t}-${i}`,bind:this,class:Qs.mediaChart,afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:e}=this.viewModel;return e?e.type==="image"?this.renderImageMediaInfo(e):e.type.includes("chart")?this.renderChartMediaInfo(e):null:null}renderMediaInfo(){const{activeMediaInfo:e}=this.viewModel;if(!e)return null;const t=e.title?Te("div",{key:"media-title",class:Qs.mediaItemTitle,innerHTML:e.title}):null,i=e.caption?Te("div",{key:"media-caption",class:Qs.mediaItemCaption,innerHTML:e.caption}):null;return Te("div",{key:"media-container",class:Qs.mediaItemContainer},Te("div",{key:"media-item-container",class:Qs.mediaItem},this.renderMediaInfoType()),t,i)}renderMediaPageButton(e){if(this.viewModel.formattedMediaInfoCount<2)return null;const t=e==="previous",i=t?this.messages.previous:this.messages.next,r=t?this.classes(Qs.mediaButton,Qs.mediaPrevious):this.classes(Qs.mediaButton,Qs.mediaNext),s=t?this.classes(Qs.mediaIcon,Qs.mediaPreviousIconLTR,Qs.iconLeftTriangleArrow):this.classes(Qs.mediaIcon,Qs.mediaNextIconLTR,Qs.iconRightTriangleArrow),n=t?this.classes(Qs.mediaIcon,Qs.mediaPreviousIconRTL,Qs.iconRightTriangleArrow):this.classes(Qs.mediaIcon,Qs.mediaNextIconRTL,Qs.iconLeftTriangleArrow),o=t?"media-previous":"media-next",a=t?this._previous:this._next;return Te("button",{type:"button",key:o,title:i,"aria-label":i,tabIndex:0,class:r,bind:this,onclick:a},Te("span",{"aria-hidden":"true",class:s}),Te("span",{"aria-hidden":"true",class:n}))}_setupFeatureElementInfo(){const{description:e,title:t}=this;this._featureElementInfo.set({description:e,title:t})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}async _getRendererColors(e){var n;const{am4core:t}=e,i=(n=this.viewModel)==null?void 0:n.layer,r=new Map;if(!i)return r;const s=await G5e(i.renderer);return s.delete(null),Array.from(s.values()).every(o=>(o==null?void 0:o.length)===1)&&(r.set(wie,t.color({r:50,g:50,b:50,a:1})),Array.from(s.keys()).forEach(o=>{o&&r.set(o,t.color(s.get(o)[0].toCss(!0)))})),r}_handleMediaKeyup(e){const t=bw(e);t==="ArrowLeft"&&(e.stopPropagation(),this.viewModel.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.viewModel.next())}_renderChart(e){const{abilities:t}=this.viewModel,{chartsModule:i,chartDiv:r,mediaInfo:s,colorMap:n}=e,{value:o,type:a}=s,{am4core:l}=i,c=xUe(l);function h(g){g instanceof l.ColorSet&&c&&(g.list=c)}Uye()&&l.useTheme(i.am4themes_dark);const p=window.matchMedia("(prefers-reduced-motion: reduce)");t.chartAnimation&&!p.matches?l.useTheme(i.am4themes_animated):l.unuseTheme(i.am4themes_animated),l.useTheme(h);const m=a==="pie-chart"?this._createPieChart(e):this._createXYChart(e);r.setAttribute("aria-label",s.altText||s.title),m.data=o.series.map(g=>({[z0]:g.tooltip,[XA]:g.value,[gg]:n.get(g.fieldName)})).filter(g=>a!=="pie-chart"||g.value>0)}_customizeChartTooltip(e,t){e.label.wrap=!0,e.label.maxWidth=200,e.autoTextColor=!1,e.getFillFromObject=!1,e.label.fill=t.color("#ffffff"),e.background.fill=t.color({r:0,g:0,b:0,a:.7})}_createPieChart(e){const{chartDiv:t,chartsModule:i}=e,{am4core:r,am4charts:s}=i,n=r.create(t,s.PieChart);n.rtl=Ov(this.container);const o=n.series.push(new s.PieSeries);return o.labels.template.disabled=!0,o.ticks.template.disabled=!0,o.dataFields.value=XA,o.dataFields.category=z0,this._customizeChartTooltip(o.tooltip,r),o.slices.template.tooltipText=n.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",o.slices.template.propertyFields.fill=gg,o.slices.template.propertyFields.stroke=gg,n}_getMinSeriesValue(e){let t=0;return e.forEach(i=>t=Math.min(i.value,t)),t}_createColumnChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.xAxes.push(new o.CategoryAxis);a.dataFields.category=z0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dy=-a.tooltip.contentHeight});const l=e.yAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=jV,l.renderer.maxLabelPosition=HV,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueY=XA,h.dataFields.categoryX=z0,h.columns.template.propertyFields.fill=gg,h.columns.template.propertyFields.stroke=gg,e.cursor=new o.XYCursor,s.series.length>qV&&(e.scrollbarX=new n.Scrollbar)}_createBarChart(e,t){const{chartsModule:i,mediaInfo:r}=t,{value:s}=r,{am4core:n,am4charts:o}=i,a=e.yAxes.push(new o.CategoryAxis);a.dataFields.category=z0,a.renderer.inversed=!0,a.renderer.labels.template.disabled=!0,this._customizeChartTooltip(a.tooltip,n),a.tooltip.events.on("sizechanged",()=>{a.tooltip.dx=a.tooltip.contentWidth});const l=e.xAxes.push(new o.ValueAxis),c=l.renderer.labels.template;l.renderer.minLabelPosition=jV,l.renderer.maxLabelPosition=HV,l.min=this._getMinSeriesValue(s.series),this._customizeChartTooltip(l.tooltip,n),c.wrap=!0;const h=e.series.push(new o.ColumnSeries);h.dataFields.valueX=XA,h.dataFields.categoryY=z0,h.columns.template.propertyFields.fill=gg,h.columns.template.propertyFields.stroke=gg,e.cursor=new o.XYCursor,s.series.length>qV&&(e.scrollbarY=new n.Scrollbar)}_createLineChart(e,t){const{chartsModule:i,mediaInfo:r,colorMap:s}=t,{value:n}=r,{am4core:o,am4charts:a}=i,l=e.xAxes.push(new a.CategoryAxis);l.dataFields.category=z0,l.renderer.labels.template.disabled=!0,this._customizeChartTooltip(l.tooltip,o),l.tooltip.events.on("sizechanged",()=>{l.tooltip.dy=-l.tooltip.contentHeight});const c=e.yAxes.push(new a.ValueAxis),h=c.renderer.labels.template;c.renderer.minLabelPosition=jV,c.renderer.maxLabelPosition=HV,c.min=this._getMinSeriesValue(n.series),this._customizeChartTooltip(c.tooltip,o),h.wrap=!0;const p=e.series.push(new a.LineSeries);p.dataFields.categoryX=z0,p.dataFields.valueY=XA,p.strokeWidth=1;const m=s.get(wie);m&&(p.stroke=m);const g=p.bullets.push(new a.CircleBullet);g.propertyFields.fill=gg,g.propertyFields.stroke=gg,e.cursor=new a.XYCursor,n.series.length>qV&&(e.scrollbarX=new o.Scrollbar)}_createXYChart(e){const{chartDiv:t,chartsModule:i,mediaInfo:r}=e,{type:s}=r,{am4core:n,am4charts:o}=i,a=n.create(t,o.XYChart);return a.rtl=Ov(this.container),s==="column-chart"&&this._createColumnChart(a,e),s==="bar-chart"&&this._createBarChart(a,e),s==="line-chart"&&this._createLineChart(a,e),a}_clearMediaRefreshTimer(){const{_refreshTimer:e}=this;e&&(clearTimeout(e),this._refreshTimer=null)}_updateMediaInfoTimestamp(e){const t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:this._getImageSource(e,t)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:e}=this.viewModel;e&&e.type==="image"&&e.refreshInterval&&this._setRefreshTimeout(e)}_setRefreshTimeout(e){const{refreshInterval:t,value:i}=e;if(!t)return;const r=6e4*t;this._updateMediaInfoTimestamp(i.sourceURL);const s=setInterval(()=>{this._updateMediaInfoTimestamp(i.sourceURL)},r);this._refreshTimer=s}_getImageSource(e,t){const i=e.includes("?")?"&":"?",[r,s=""]=e.split("#");return`${r}${i}timestamp=${t}${s?"#":""}${s}`}};u([Lt("viewModel.attributes")],fc.prototype,"attributes",void 0),u([Lt("viewModel.activeMediaInfoIndex")],fc.prototype,"activeMediaInfoIndex",void 0),u([Lt("viewModel.description")],fc.prototype,"description",void 0),u([Lt("viewModel.fieldInfoMap")],fc.prototype,"fieldInfoMap",void 0),u([Lt("viewModel.layer")],fc.prototype,"layer",void 0),u([Lt("viewModel.mediaInfos")],fc.prototype,"mediaInfos",void 0),u([Lt("viewModel.popupTemplate")],fc.prototype,"popupTemplate",void 0),u([Lt("viewModel.relatedInfos")],fc.prototype,"relatedInfos",void 0),u([Lt("viewModel.title")],fc.prototype,"title",void 0),u([f({type:Hw})],fc.prototype,"viewModel",void 0),u([f(),Hl("esri/widgets/Feature/t9n/Feature")],fc.prototype,"messages",void 0),fc=u([B("esri.widgets.Feature.FeatureMedia")],fc);const b0e=fc;class TUe{constructor(t,i){this.definition=null,this.context=null,this.definition=t,this.context=i}}class Hm{constructor(t=[]){this._elements=t}length(){return this._elements.length}get(t){return this._elements[t]}toArray(){const t=[];for(let i=0;i<this.length();i++)t.push(this.get(i));return t}}class vT extends Hm{constructor(t,i,r,s,n,o){super(t),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=i,this._hasZ=r,this._hasM=s,this._cacheId=n,this._partId=o}get(t){if(this._lazyPt[t]===void 0){const i=this._elements[t];if(i===void 0)return;const r=this._hasZ,s=this._hasM;let n=null;n=r&&!s?new xt(i[0],i[1],i[2],void 0,this._spRef):s&&!r?new xt(i[0],i[1],void 0,i[2],this._spRef):r&&s?new xt(i[0],i[1],i[2],i[3],this._spRef):new xt(i[0],i[1],this._spRef),n.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+t.toString(),this._lazyPt[t]=n}return this._lazyPt[t]}equalityTest(t){return t===this||t!==null&&t instanceof vT&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}class bY extends Hm{constructor(t,i,r,s,n){super(t),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=i,this._cacheId=n}get(t){if(this._lazyPath[t]===void 0){const i=this._elements[t];if(i===void 0)return;this._lazyPath[t]=new vT(i,this._spRef,this._hasZ,this._hasM,this._cacheId,t)}return this._lazyPath[t]}equalityTest(t){return t===this||t!==null&&t instanceof bY&&t.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}class bT extends Error{}class SUe extends bT{constructor(t){super(`Invalid DateTime: ${t.toMessage()}`)}}class EUe extends bT{constructor(t){super(`Invalid Interval: ${t.toMessage()}`)}}class CUe extends bT{constructor(t){super(`Invalid Duration: ${t.toMessage()}`)}}class RR extends bT{}class w0e extends bT{constructor(t){super(`Invalid unit ${t}`)}}class ed extends bT{}class B0 extends bT{constructor(){super("Zone is an abstract class")}}const dt="numeric",Yp="short",Xu="long",tH={year:dt,month:dt,day:dt},x0e={year:dt,month:Yp,day:dt},AUe={year:dt,month:Yp,day:dt,weekday:Yp},T0e={year:dt,month:Xu,day:dt},S0e={year:dt,month:Xu,day:dt,weekday:Xu},E0e={hour:dt,minute:dt},C0e={hour:dt,minute:dt,second:dt},A0e={hour:dt,minute:dt,second:dt,timeZoneName:Yp},O0e={hour:dt,minute:dt,second:dt,timeZoneName:Xu},R0e={hour:dt,minute:dt,hourCycle:"h23"},M0e={hour:dt,minute:dt,second:dt,hourCycle:"h23"},P0e={hour:dt,minute:dt,second:dt,hourCycle:"h23",timeZoneName:Yp},I0e={hour:dt,minute:dt,second:dt,hourCycle:"h23",timeZoneName:Xu},L0e={year:dt,month:dt,day:dt,hour:dt,minute:dt},$0e={year:dt,month:dt,day:dt,hour:dt,minute:dt,second:dt},D0e={year:dt,month:Yp,day:dt,hour:dt,minute:dt},N0e={year:dt,month:Yp,day:dt,hour:dt,minute:dt,second:dt},OUe={year:dt,month:Yp,day:dt,weekday:Yp,hour:dt,minute:dt},F0e={year:dt,month:Xu,day:dt,hour:dt,minute:dt,timeZoneName:Yp},k0e={year:dt,month:Xu,day:dt,hour:dt,minute:dt,second:dt,timeZoneName:Yp},U0e={year:dt,month:Xu,day:dt,weekday:Xu,hour:dt,minute:dt,timeZoneName:Xu},z0e={year:dt,month:Xu,day:dt,weekday:Xu,hour:dt,minute:dt,second:dt,timeZoneName:Xu};function yr(e){return typeof e>"u"}function fx(e){return typeof e=="number"}function LU(e){return typeof e=="number"&&e%1===0}function RUe(e){return typeof e=="string"}function MUe(e){return Object.prototype.toString.call(e)==="[object Date]"}function B0e(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function PUe(e){return Array.isArray(e)?e:[e]}function xie(e,t,i){if(e.length!==0)return e.reduce((r,s)=>{const n=[t(s),s];return r&&i(r[0],n[0])===r[0]?r:n},null)[1]}function IUe(e,t){return t.reduce((i,r)=>(i[r]=e[r],i),{})}function QE(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function wy(e,t,i){return LU(e)&&e>=t&&e<=i}function LUe(e,t){return e-t*Math.floor(e/t)}function lo(e,t=2){const i=e<0;let r;return i?r="-"+(""+-e).padStart(t,"0"):r=(""+e).padStart(t,"0"),r}function K_(e){if(!(yr(e)||e===null||e===""))return parseInt(e,10)}function j1(e){if(!(yr(e)||e===null||e===""))return parseFloat(e)}function wY(e){if(!(yr(e)||e===null||e==="")){const t=parseFloat("0."+e)*1e3;return Math.floor(t)}}function xY(e,t,i=!1){const r=10**t;return(i?Math.trunc:Math.round)(e*r)/r}function tI(e){return e%4===0&&(e%100!==0||e%400===0)}function PM(e){return tI(e)?366:365}function r5(e,t){const i=LUe(t-1,12)+1,r=e+(t-i)/12;return i===2?tI(r)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][i-1]}function TY(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(t.getUTCFullYear()-1900)),+t}function s5(e){const t=(e+Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400))%7,i=e-1,r=(i+Math.floor(i/4)-Math.floor(i/100)+Math.floor(i/400))%7;return t===4||r===3?53:52}function iH(e){return e>99?e:e>60?1900+e:2e3+e}function V0e(e,t,i,r=null){const s=new Date(e),n={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(n.timeZone=r);const o={timeZoneName:t,...n},a=new Intl.DateTimeFormat(i,o).formatToParts(s).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function $U(e,t){let i=parseInt(e,10);Number.isNaN(i)&&(i=0);const r=parseInt(t,10)||0,s=i<0||Object.is(i,-0)?-r:r;return i*60+s}function G0e(e){const t=Number(e);if(typeof e=="boolean"||e===""||Number.isNaN(t))throw new ed(`Invalid unit value ${e}`);return t}function n5(e,t){const i={};for(const r in e)if(QE(e,r)){const s=e[r];if(s==null)continue;i[t(r)]=G0e(s)}return i}function IM(e,t){const i=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),s=e>=0?"+":"-";switch(t){case"short":return`${s}${lo(i,2)}:${lo(r,2)}`;case"narrow":return`${s}${i}${r>0?`:${r}`:""}`;case"techie":return`${s}${lo(i,2)}${lo(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function DU(e){return IUe(e,["hour","minute","second","millisecond"])}const j0e=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,$Ue=["January","February","March","April","May","June","July","August","September","October","November","December"],H0e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],DUe=["J","F","M","A","M","J","J","A","S","O","N","D"];function q0e(e){switch(e){case"narrow":return[...DUe];case"short":return[...H0e];case"long":return[...$Ue];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const W0e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Z0e=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],NUe=["M","T","W","T","F","S","S"];function X0e(e){switch(e){case"narrow":return[...NUe];case"short":return[...Z0e];case"long":return[...W0e];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const Y0e=["AM","PM"],FUe=["Before Christ","Anno Domini"],kUe=["BC","AD"],UUe=["B","A"];function Q0e(e){switch(e){case"narrow":return[...UUe];case"short":return[...kUe];case"long":return[...FUe];default:return null}}function zUe(e){return Y0e[e.hour<12?0:1]}function BUe(e,t){return X0e(t)[e.weekday-1]}function VUe(e,t){return q0e(t)[e.month-1]}function GUe(e,t){return Q0e(t)[e.year<0?0:1]}function jUe(e,t,i="always",r=!1){const s={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},n=["hours","minutes","seconds"].indexOf(e)===-1;if(i==="auto"&&n){const p=e==="days";switch(t){case 1:return p?"tomorrow":`next ${s[e][0]}`;case-1:return p?"yesterday":`last ${s[e][0]}`;case 0:return p?"today":`this ${s[e][0]}`}}const o=Object.is(t,-0)||t<0,a=Math.abs(t),l=a===1,c=s[e],h=r?l?c[1]:c[2]||c[1]:l?s[e][0]:e;return o?`${a} ${h} ago`:`in ${a} ${h}`}function Tie(e,t){let i="";for(const r of e)r.literal?i+=r.val:i+=t(r.val);return i}const HUe={D:tH,DD:x0e,DDD:T0e,DDDD:S0e,t:E0e,tt:C0e,ttt:A0e,tttt:O0e,T:R0e,TT:M0e,TTT:P0e,TTTT:I0e,f:L0e,ff:D0e,fff:F0e,ffff:U0e,F:$0e,FF:N0e,FFF:k0e,FFFF:z0e};class Nc{static create(t,i={}){return new Nc(t,i)}static parseFormat(t){let i=null,r="",s=!1;const n=[];for(let o=0;o<t.length;o++){const a=t.charAt(o);a==="'"?(r.length>0&&n.push({literal:s,val:r}),i=null,r="",s=!s):s||a===i?r+=a:(r.length>0&&n.push({literal:!1,val:r}),r=a,i=a)}return r.length>0&&n.push({literal:s,val:r}),n}static macroTokenToFormatOpts(t){return HUe[t]}constructor(t,i){this.opts=i,this.loc=t,this.systemLoc=null}formatWithSystemDefault(t,i){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(t,{...this.opts,...i}).format()}formatDateTime(t,i={}){return this.loc.dtFormatter(t,{...this.opts,...i}).format()}formatDateTimeParts(t,i={}){return this.loc.dtFormatter(t,{...this.opts,...i}).formatToParts()}resolvedOptions(t,i={}){return this.loc.dtFormatter(t,{...this.opts,...i}).resolvedOptions()}num(t,i=0){if(this.opts.forceSimple)return lo(t,i);const r={...this.opts};return i>0&&(r.padTo=i),this.loc.numberFormatter(r).format(t)}formatDateTimeFromString(t,i){const r=this.loc.listingMode()==="en",s=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",n=(g,v)=>this.loc.extract(t,g,v),o=g=>t.isOffsetFixed&&t.offset===0&&g.allowZ?"Z":t.isValid?t.zone.formatOffset(t.ts,g.format):"",a=()=>r?zUe(t):n({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(g,v)=>r?VUe(t,g):n(v?{month:g}:{month:g,day:"numeric"},"month"),c=(g,v)=>r?BUe(t,g):n(v?{weekday:g}:{weekday:g,month:"long",day:"numeric"},"weekday"),h=g=>{const v=Nc.macroTokenToFormatOpts(g);return v?this.formatWithSystemDefault(t,v):g},p=g=>r?GUe(t,g):n({era:g},"era"),m=g=>{switch(g){case"S":return this.num(t.millisecond);case"u":case"SSS":return this.num(t.millisecond,3);case"s":return this.num(t.second);case"ss":return this.num(t.second,2);case"uu":return this.num(Math.floor(t.millisecond/10),2);case"uuu":return this.num(Math.floor(t.millisecond/100));case"m":return this.num(t.minute);case"mm":return this.num(t.minute,2);case"h":return this.num(t.hour%12===0?12:t.hour%12);case"hh":return this.num(t.hour%12===0?12:t.hour%12,2);case"H":return this.num(t.hour);case"HH":return this.num(t.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return t.zone.offsetName(t.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return t.zone.offsetName(t.ts,{format:"long",locale:this.loc.locale});case"z":return t.zoneName;case"a":return a();case"d":return s?n({day:"numeric"},"day"):this.num(t.day);case"dd":return s?n({day:"2-digit"},"day"):this.num(t.day,2);case"c":return this.num(t.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(t.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return s?n({month:"numeric",day:"numeric"},"month"):this.num(t.month);case"LL":return s?n({month:"2-digit",day:"numeric"},"month"):this.num(t.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return s?n({month:"numeric"},"month"):this.num(t.month);case"MM":return s?n({month:"2-digit"},"month"):this.num(t.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return s?n({year:"numeric"},"year"):this.num(t.year);case"yy":return s?n({year:"2-digit"},"year"):this.num(t.year.toString().slice(-2),2);case"yyyy":return s?n({year:"numeric"},"year"):this.num(t.year,4);case"yyyyyy":return s?n({year:"numeric"},"year"):this.num(t.year,6);case"G":return p("short");case"GG":return p("long");case"GGGGG":return p("narrow");case"kk":return this.num(t.weekYear.toString().slice(-2),2);case"kkkk":return this.num(t.weekYear,4);case"W":return this.num(t.weekNumber);case"WW":return this.num(t.weekNumber,2);case"o":return this.num(t.ordinal);case"ooo":return this.num(t.ordinal,3);case"q":return this.num(t.quarter);case"qq":return this.num(t.quarter,2);case"X":return this.num(Math.floor(t.ts/1e3));case"x":return this.num(t.ts);default:return h(g)}};return Tie(Nc.parseFormat(i),m)}formatDurationFromString(t,i){const r=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},s=l=>c=>{const h=r(c);return h?this.num(l.get(h),c.length):c},n=Nc.parseFormat(i),o=n.reduce((l,{literal:c,val:h})=>c?l:l.concat(h),[]),a=t.shiftTo(...o.map(r).filter(l=>l));return Tie(n,s(a))}}class Ip{constructor(t,i){this.reason=t,this.explanation=i}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class iI{get type(){throw new B0}get name(){throw new B0}get ianaName(){return this.name}get isUniversal(){throw new B0}offsetName(t,i){throw new B0}formatOffset(t,i){throw new B0}offset(t){throw new B0}equals(t){throw new B0}get isValid(){throw new B0}}let WV=null;class SY extends iI{static get instance(){return WV===null&&(WV=new SY),WV}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return V0e(t,i,r)}formatOffset(t,i){return IM(this.offset(t),i)}offset(t){return-new Date(t).getTimezoneOffset()}equals(t){return t.type==="system"}get isValid(){return!0}}let BN={};function qUe(e){return BN[e]||(BN[e]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),BN[e]}const WUe={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function ZUe(e,t){const i=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(i),[,s,n,o,a,l,c,h]=r;return[o,s,n,a,l,c,h]}function XUe(e,t){const i=e.formatToParts(t),r=[];for(let s=0;s<i.length;s++){const{type:n,value:o}=i[s],a=WUe[n];n==="era"?r[a]=o:yr(a)||(r[a]=parseInt(o,10))}return r}let kL={};class qy extends iI{static create(t){return kL[t]||(kL[t]=new qy(t)),kL[t]}static resetCache(){kL={},BN={}}static isValidSpecifier(t){return this.isValidZone(t)}static isValidZone(t){if(!t)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:t}).format(),!0}catch{return!1}}constructor(t){super(),this.zoneName=t,this.valid=qy.isValidZone(t)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(t,{format:i,locale:r}){return V0e(t,i,r,this.name)}formatOffset(t,i){return IM(this.offset(t),i)}offset(t){const i=new Date(t);if(isNaN(i))return NaN;const r=qUe(this.name);let[s,n,o,a,l,c,h]=r.formatToParts?XUe(r,i):ZUe(r,i);a==="BC"&&(s=-Math.abs(s)+1);const m=TY({year:s,month:n,day:o,hour:l===24?0:l,minute:c,second:h,millisecond:0});let g=+i;const v=g%1e3;return g-=v>=0?v:1e3+v,(m-g)/(60*1e3)}equals(t){return t.type==="iana"&&t.name===this.name}get isValid(){return this.valid}}let ZV=null;class Bl extends iI{static get utcInstance(){return ZV===null&&(ZV=new Bl(0)),ZV}static instance(t){return t===0?Bl.utcInstance:new Bl(t)}static parseSpecifier(t){if(t){const i=t.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(i)return new Bl($U(i[1],i[2]))}return null}constructor(t){super(),this.fixed=t}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${IM(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${IM(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(t,i){return IM(this.fixed,i)}get isUniversal(){return!0}offset(){return this.fixed}equals(t){return t.type==="fixed"&&t.fixed===this.fixed}get isValid(){return!0}}class YUe extends iI{constructor(t){super(),this.zoneName=t}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function cv(e,t){if(yr(e)||e===null)return t;if(e instanceof iI)return e;if(RUe(e)){const i=e.toLowerCase();return i==="local"||i==="system"?t:i==="utc"||i==="gmt"?Bl.utcInstance:Bl.parseSpecifier(i)||qy.create(e)}else return fx(e)?Bl.instance(e):typeof e=="object"&&e.offset&&typeof e.offset=="number"?e:new YUe(e)}let Sie=()=>Date.now(),Eie="system",Cie=null,Aie=null,Oie=null,Rie;class Oo{static get now(){return Sie}static set now(t){Sie=t}static set defaultZone(t){Eie=t}static get defaultZone(){return cv(Eie,SY.instance)}static get defaultLocale(){return Cie}static set defaultLocale(t){Cie=t}static get defaultNumberingSystem(){return Aie}static set defaultNumberingSystem(t){Aie=t}static get defaultOutputCalendar(){return Oie}static set defaultOutputCalendar(t){Oie=t}static get throwOnInvalid(){return Rie}static set throwOnInvalid(t){Rie=t}static resetCaches(){nn.resetCache(),qy.resetCache()}}let Mie={};function QUe(e,t={}){const i=JSON.stringify([e,t]);let r=Mie[i];return r||(r=new Intl.ListFormat(e,t),Mie[i]=r),r}let rH={};function sH(e,t={}){const i=JSON.stringify([e,t]);let r=rH[i];return r||(r=new Intl.DateTimeFormat(e,t),rH[i]=r),r}let nH={};function JUe(e,t={}){const i=JSON.stringify([e,t]);let r=nH[i];return r||(r=new Intl.NumberFormat(e,t),nH[i]=r),r}let oH={};function KUe(e,t={}){const{base:i,...r}=t,s=JSON.stringify([e,r]);let n=oH[s];return n||(n=new Intl.RelativeTimeFormat(e,t),oH[s]=n),n}let MR=null;function eze(){return MR||(MR=new Intl.DateTimeFormat().resolvedOptions().locale,MR)}function tze(e){const t=e.indexOf("-u-");if(t===-1)return[e];{let i;const r=e.substring(0,t);try{i=sH(e).resolvedOptions()}catch{i=sH(r).resolvedOptions()}const{numberingSystem:s,calendar:n}=i;return[r,s,n]}}function ize(e,t,i){return(i||t)&&(e+="-u",i&&(e+=`-ca-${i}`),t&&(e+=`-nu-${t}`)),e}function rze(e){const t=[];for(let i=1;i<=12;i++){const r=bi.utc(2016,i,1);t.push(e(r))}return t}function sze(e){const t=[];for(let i=1;i<=7;i++){const r=bi.utc(2016,11,13+i);t.push(e(r))}return t}function UL(e,t,i,r,s){const n=e.listingMode(i);return n==="error"?null:n==="en"?r(t):s(t)}function nze(e){return e.numberingSystem&&e.numberingSystem!=="latn"?!1:e.numberingSystem==="latn"||!e.locale||e.locale.startsWith("en")||new Intl.DateTimeFormat(e.intl).resolvedOptions().numberingSystem==="latn"}class oze{constructor(t,i,r){this.padTo=r.padTo||0,this.floor=r.floor||!1;const{padTo:s,floor:n,...o}=r;if(!i||Object.keys(o).length>0){const a={useGrouping:!1,...r};r.padTo>0&&(a.minimumIntegerDigits=r.padTo),this.inf=JUe(t,a)}}format(t){if(this.inf){const i=this.floor?Math.floor(t):t;return this.inf.format(i)}else{const i=this.floor?Math.floor(t):xY(t,3);return lo(i,this.padTo)}}}class aze{constructor(t,i,r){this.opts=r;let s;if(t.zone.isUniversal){const o=-1*(t.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;t.offset!==0&&qy.create(a).valid?(s=a,this.dt=t):(s="UTC",r.timeZoneName?this.dt=t:this.dt=t.offset===0?t:bi.fromMillis(t.ts+t.offset*60*1e3))}else t.zone.type==="system"?this.dt=t:(this.dt=t,s=t.zone.name);const n={...this.opts};s&&(n.timeZone=s),this.dtf=sH(i,n)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class lze{constructor(t,i,r){this.opts={style:"long",...r},!i&&B0e()&&(this.rtf=KUe(t,r))}format(t,i){return this.rtf?this.rtf.format(t,i):jUe(i,t,this.opts.numeric,this.opts.style!=="long")}formatToParts(t,i){return this.rtf?this.rtf.formatToParts(t,i):[]}}class nn{static fromOpts(t){return nn.create(t.locale,t.numberingSystem,t.outputCalendar,t.defaultToEN)}static create(t,i,r,s=!1){const n=t||Oo.defaultLocale,o=n||(s?"en-US":eze()),a=i||Oo.defaultNumberingSystem,l=r||Oo.defaultOutputCalendar;return new nn(o,a,l,n)}static resetCache(){MR=null,rH={},nH={},oH={}}static fromObject({locale:t,numberingSystem:i,outputCalendar:r}={}){return nn.create(t,i,r)}constructor(t,i,r,s){const[n,o,a]=tze(t);this.locale=n,this.numberingSystem=i||o||null,this.outputCalendar=r||a||null,this.intl=ize(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=s,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=nze(this)),this.fastNumbersCached}listingMode(){const t=this.isEnglish(),i=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return t&&i?"en":"intl"}clone(t){return!t||Object.getOwnPropertyNames(t).length===0?this:nn.create(t.locale||this.specifiedLocale,t.numberingSystem||this.numberingSystem,t.outputCalendar||this.outputCalendar,t.defaultToEN||!1)}redefaultToEN(t={}){return this.clone({...t,defaultToEN:!0})}redefaultToSystem(t={}){return this.clone({...t,defaultToEN:!1})}months(t,i=!1,r=!0){return UL(this,t,r,q0e,()=>{const s=i?{month:t,day:"numeric"}:{month:t},n=i?"format":"standalone";return this.monthsCache[n][t]||(this.monthsCache[n][t]=rze(o=>this.extract(o,s,"month"))),this.monthsCache[n][t]})}weekdays(t,i=!1,r=!0){return UL(this,t,r,X0e,()=>{const s=i?{weekday:t,year:"numeric",month:"long",day:"numeric"}:{weekday:t},n=i?"format":"standalone";return this.weekdaysCache[n][t]||(this.weekdaysCache[n][t]=sze(o=>this.extract(o,s,"weekday"))),this.weekdaysCache[n][t]})}meridiems(t=!0){return UL(this,void 0,t,()=>Y0e,()=>{if(!this.meridiemCache){const i={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[bi.utc(2016,11,13,9),bi.utc(2016,11,13,19)].map(r=>this.extract(r,i,"dayperiod"))}return this.meridiemCache})}eras(t,i=!0){return UL(this,t,i,Q0e,()=>{const r={era:t};return this.eraCache[t]||(this.eraCache[t]=[bi.utc(-40,1,1),bi.utc(2017,1,1)].map(s=>this.extract(s,r,"era"))),this.eraCache[t]})}extract(t,i,r){const s=this.dtFormatter(t,i),n=s.formatToParts(),o=n.find(a=>a.type.toLowerCase()===r);return o?o.value:null}numberFormatter(t={}){return new oze(this.intl,t.forceSimple||this.fastNumbers,t)}dtFormatter(t,i={}){return new aze(t,this.intl,i)}relFormatter(t={}){return new lze(this.intl,this.isEnglish(),t)}listFormatter(t={}){return QUe(this.intl,t)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(t){return this.locale===t.locale&&this.numberingSystem===t.numberingSystem&&this.outputCalendar===t.outputCalendar}}function YC(...e){const t=e.reduce((i,r)=>i+r.source,"");return RegExp(`^${t}$`)}function QC(...e){return t=>e.reduce(([i,r,s],n)=>{const[o,a,l]=n(t,s);return[{...i,...o},a||r,l]},[{},null,1]).slice(0,2)}function JC(e,...t){if(e==null)return[null,null];for(const[i,r]of t){const s=i.exec(e);if(s)return r(s)}return[null,null]}function J0e(...e){return(t,i)=>{const r={};let s;for(s=0;s<e.length;s++)r[e[s]]=K_(t[i+s]);return[r,null,i+s]}}const K0e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,cze=`(?:${K0e.source}?(?:\\[(${j0e.source})\\])?)?`,EY=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,e_e=RegExp(`${EY.source}${cze}`),CY=RegExp(`(?:T${e_e.source})?`),uze=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,hze=/(\d{4})-?W(\d\d)(?:-?(\d))?/,dze=/(\d{4})-?(\d{3})/,pze=J0e("weekYear","weekNumber","weekDay"),fze=J0e("year","ordinal"),mze=/(\d{4})-(\d\d)-(\d\d)/,t_e=RegExp(`${EY.source} ?(?:${K0e.source}|(${j0e.source}))?`),gze=RegExp(`(?: ${t_e.source})?`);function uE(e,t,i){const r=e[t];return yr(r)?i:K_(r)}function yze(e,t){return[{year:uE(e,t),month:uE(e,t+1,1),day:uE(e,t+2,1)},null,t+3]}function KC(e,t){return[{hours:uE(e,t,0),minutes:uE(e,t+1,0),seconds:uE(e,t+2,0),milliseconds:wY(e[t+3])},null,t+4]}function rI(e,t){const i=!e[t]&&!e[t+1],r=$U(e[t+1],e[t+2]),s=i?null:Bl.instance(r);return[{},s,t+3]}function sI(e,t){const i=e[t]?qy.create(e[t]):null;return[{},i,t+1]}const _ze=RegExp(`^T?${EY.source}$`),vze=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function bze(e){const[t,i,r,s,n,o,a,l,c]=e,h=t[0]==="-",p=l&&l[0]==="-",m=(g,v=!1)=>g!==void 0&&(v||g&&h)?-g:g;return[{years:m(j1(i)),months:m(j1(r)),weeks:m(j1(s)),days:m(j1(n)),hours:m(j1(o)),minutes:m(j1(a)),seconds:m(j1(l),l==="-0"),milliseconds:m(wY(c),p)}]}const wze={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function AY(e,t,i,r,s,n,o){const a={year:t.length===2?iH(K_(t)):K_(t),month:H0e.indexOf(i)+1,day:K_(r),hour:K_(s),minute:K_(n)};return o&&(a.second=K_(o)),e&&(a.weekday=e.length>3?W0e.indexOf(e)+1:Z0e.indexOf(e)+1),a}const xze=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function Tze(e){const[,t,i,r,s,n,o,a,l,c,h,p]=e,m=AY(t,s,r,i,n,o,a);let g;return l?g=wze[l]:c?g=0:g=$U(h,p),[m,new Bl(g)]}function Sze(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const Eze=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,Cze=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,Aze=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function Pie(e){const[,t,i,r,s,n,o,a]=e;return[AY(t,s,r,i,n,o,a),Bl.utcInstance]}function Oze(e){const[,t,i,r,s,n,o,a]=e;return[AY(t,a,i,r,s,n,o),Bl.utcInstance]}const Rze=YC(uze,CY),Mze=YC(hze,CY),Pze=YC(dze,CY),Ize=YC(e_e),i_e=QC(yze,KC,rI,sI),Lze=QC(pze,KC,rI,sI),$ze=QC(fze,KC,rI,sI),Dze=QC(KC,rI,sI);function Nze(e){return JC(e,[Rze,i_e],[Mze,Lze],[Pze,$ze],[Ize,Dze])}function Fze(e){return JC(Sze(e),[xze,Tze])}function kze(e){return JC(e,[Eze,Pie],[Cze,Pie],[Aze,Oze])}function Uze(e){return JC(e,[vze,bze])}const zze=QC(KC);function Bze(e){return JC(e,[_ze,zze])}const Vze=YC(mze,gze),Gze=YC(t_e),jze=QC(KC,rI,sI);function Hze(e){return JC(e,[Vze,i_e],[Gze,jze])}const qze="Invalid Duration",r_e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},Wze={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...r_e},vh=146097/400,jT=146097/4800,Zze={years:{quarters:4,months:12,weeks:vh/7,days:vh,hours:vh*24,minutes:vh*24*60,seconds:vh*24*60*60,milliseconds:vh*24*60*60*1e3},quarters:{months:3,weeks:vh/28,days:vh/4,hours:vh*24/4,minutes:vh*24*60/4,seconds:vh*24*60*60/4,milliseconds:vh*24*60*60*1e3/4},months:{weeks:jT/7,days:jT,hours:jT*24,minutes:jT*24*60,seconds:jT*24*60*60,milliseconds:jT*24*60*60*1e3},...r_e},jb=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],Xze=jb.slice(0).reverse();function H1(e,t,i=!1){const r={values:i?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy};return new Cr(r)}function Yze(e){return e<0?Math.floor(e):Math.ceil(e)}function s_e(e,t,i,r,s){const n=e[s][i],o=t[i]/n,a=Math.sign(o)===Math.sign(r[s]),l=!a&&r[s]!==0&&Math.abs(o)<=1?Yze(o):Math.trunc(o);r[s]+=l,t[i]-=l*n}function Qze(e,t){Xze.reduce((i,r)=>yr(t[r])?i:(i&&s_e(e,t,i,t,r),r),null)}class Cr{constructor(t){const i=t.conversionAccuracy==="longterm"||!1;this.values=t.values,this.loc=t.loc||nn.create(),this.conversionAccuracy=i?"longterm":"casual",this.invalid=t.invalid||null,this.matrix=i?Zze:Wze,this.isLuxonDuration=!0}static fromMillis(t,i){return Cr.fromObject({milliseconds:t},i)}static fromObject(t,i={}){if(t==null||typeof t!="object")throw new ed(`Duration.fromObject: argument expected to be an object, got ${t===null?"null":typeof t}`);return new Cr({values:n5(t,Cr.normalizeUnit),loc:nn.fromObject(i),conversionAccuracy:i.conversionAccuracy})}static fromDurationLike(t){if(fx(t))return Cr.fromMillis(t);if(Cr.isDuration(t))return t;if(typeof t=="object")return Cr.fromObject(t);throw new ed(`Unknown duration argument ${t} of type ${typeof t}`)}static fromISO(t,i){const[r]=Uze(t);return r?Cr.fromObject(r,i):Cr.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static fromISOTime(t,i){const[r]=Bze(t);return r?Cr.fromObject(r,i):Cr.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static invalid(t,i=null){if(!t)throw new ed("need to specify a reason the Duration is invalid");const r=t instanceof Ip?t:new Ip(t,i);if(Oo.throwOnInvalid)throw new CUe(r);return new Cr({invalid:r})}static normalizeUnit(t){const i={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[t&&t.toLowerCase()];if(!i)throw new w0e(t);return i}static isDuration(t){return t&&t.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(t,i={}){const r={...i,floor:i.round!==!1&&i.floor!==!1};return this.isValid?Nc.create(this.loc,r).formatDurationFromString(this,t):qze}toHuman(t={}){const i=jb.map(r=>{const s=this.values[r];return yr(s)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...t,unit:r.slice(0,-1)}).format(s)}).filter(r=>r);return this.loc.listFormatter({type:"conjunction",style:t.listStyle||"narrow",...t}).format(i)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let t="P";return this.years!==0&&(t+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(t+=this.months+this.quarters*3+"M"),this.weeks!==0&&(t+=this.weeks+"W"),this.days!==0&&(t+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(t+="T"),this.hours!==0&&(t+=this.hours+"H"),this.minutes!==0&&(t+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(t+=xY(this.seconds+this.milliseconds/1e3,3)+"S"),t==="P"&&(t+="T0S"),t}toISOTime(t={}){if(!this.isValid)return null;const i=this.toMillis();if(i<0||i>=864e5)return null;t={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...t};const r=this.shiftTo("hours","minutes","seconds","milliseconds");let s=t.format==="basic"?"hhmm":"hh:mm";(!t.suppressSeconds||r.seconds!==0||r.milliseconds!==0)&&(s+=t.format==="basic"?"ss":":ss",(!t.suppressMilliseconds||r.milliseconds!==0)&&(s+=".SSS"));let n=r.toFormat(s);return t.includePrefix&&(n="T"+n),n}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(t){if(!this.isValid)return this;const i=Cr.fromDurationLike(t),r={};for(const s of jb)(QE(i.values,s)||QE(this.values,s))&&(r[s]=i.get(s)+this.get(s));return H1(this,{values:r},!0)}minus(t){if(!this.isValid)return this;const i=Cr.fromDurationLike(t);return this.plus(i.negate())}mapUnits(t){if(!this.isValid)return this;const i={};for(const r of Object.keys(this.values))i[r]=G0e(t(this.values[r],r));return H1(this,{values:i},!0)}get(t){return this[Cr.normalizeUnit(t)]}set(t){if(!this.isValid)return this;const i={...this.values,...n5(t,Cr.normalizeUnit)};return H1(this,{values:i})}reconfigure({locale:t,numberingSystem:i,conversionAccuracy:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i}),n={loc:s};return r&&(n.conversionAccuracy=r),H1(this,n)}as(t){return this.isValid?this.shiftTo(t).get(t):NaN}normalize(){if(!this.isValid)return this;const t=this.toObject();return Qze(this.matrix,t),H1(this,{values:t},!0)}shiftTo(...t){if(!this.isValid)return this;if(t.length===0)return this;t=t.map(o=>Cr.normalizeUnit(o));const i={},r={},s=this.toObject();let n;for(const o of jb)if(t.indexOf(o)>=0){n=o;let a=0;for(const c in r)a+=this.matrix[c][o]*r[c],r[c]=0;fx(s[o])&&(a+=s[o]);const l=Math.trunc(a);i[o]=l,r[o]=(a*1e3-l*1e3)/1e3;for(const c in s)jb.indexOf(c)>jb.indexOf(o)&&s_e(this.matrix,s,c,i,o)}else fx(s[o])&&(r[o]=s[o]);for(const o in r)r[o]!==0&&(i[n]+=o===n?r[o]:r[o]/this.matrix[n][o]);return H1(this,{values:i},!0).normalize()}negate(){if(!this.isValid)return this;const t={};for(const i of Object.keys(this.values))t[i]=this.values[i]===0?0:-this.values[i];return H1(this,{values:t},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(t){if(!this.isValid||!t.isValid||!this.loc.equals(t.loc))return!1;function i(r,s){return r===void 0||r===0?s===void 0||s===0:r===s}for(const r of jb)if(!i(this.values[r],t.values[r]))return!1;return!0}}const YA="Invalid Interval";function Jze(e,t){return!e||!e.isValid?wn.invalid("missing or invalid start"):!t||!t.isValid?wn.invalid("missing or invalid end"):t<e?wn.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null}class wn{constructor(t){this.s=t.start,this.e=t.end,this.invalid=t.invalid||null,this.isLuxonInterval=!0}static invalid(t,i=null){if(!t)throw new ed("need to specify a reason the Interval is invalid");const r=t instanceof Ip?t:new Ip(t,i);if(Oo.throwOnInvalid)throw new EUe(r);return new wn({invalid:r})}static fromDateTimes(t,i){const r=KA(t),s=KA(i),n=Jze(r,s);return n==null?new wn({start:r,end:s}):n}static after(t,i){const r=Cr.fromDurationLike(i),s=KA(t);return wn.fromDateTimes(s,s.plus(r))}static before(t,i){const r=Cr.fromDurationLike(i),s=KA(t);return wn.fromDateTimes(s.minus(r),s)}static fromISO(t,i){const[r,s]=(t||"").split("/",2);if(r&&s){let n,o;try{n=bi.fromISO(r,i),o=n.isValid}catch{o=!1}let a,l;try{a=bi.fromISO(s,i),l=a.isValid}catch{l=!1}if(o&&l)return wn.fromDateTimes(n,a);if(o){const c=Cr.fromISO(s,i);if(c.isValid)return wn.after(n,c)}else if(l){const c=Cr.fromISO(r,i);if(c.isValid)return wn.before(a,c)}}return wn.invalid("unparsable",`the input "${t}" can't be parsed as ISO 8601`)}static isInterval(t){return t&&t.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(t="milliseconds"){return this.isValid?this.toDuration(t).get(t):NaN}count(t="milliseconds"){if(!this.isValid)return NaN;const i=this.start.startOf(t),r=this.end.startOf(t);return Math.floor(r.diff(i,t).get(t))+1}hasSame(t){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,t):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(t){return this.isValid?this.s>t:!1}isBefore(t){return this.isValid?this.e<=t:!1}contains(t){return this.isValid?this.s<=t&&this.e>t:!1}set({start:t,end:i}={}){return this.isValid?wn.fromDateTimes(t||this.s,i||this.e):this}splitAt(...t){if(!this.isValid)return[];const i=t.map(KA).filter(o=>this.contains(o)).sort(),r=[];let{s}=this,n=0;for(;s<this.e;){const o=i[n]||this.e,a=+o>+this.e?this.e:o;r.push(wn.fromDateTimes(s,a)),s=a,n+=1}return r}splitBy(t){const i=Cr.fromDurationLike(t);if(!this.isValid||!i.isValid||i.as("milliseconds")===0)return[];let{s:r}=this,s=1,n;const o=[];for(;r<this.e;){const a=this.start.plus(i.mapUnits(l=>l*s));n=+a>+this.e?this.e:a,o.push(wn.fromDateTimes(r,n)),r=n,s+=1}return o}divideEqually(t){return this.isValid?this.splitBy(this.length()/t).slice(0,t):[]}overlaps(t){return this.e>t.s&&this.s<t.e}abutsStart(t){return this.isValid?+this.e==+t.s:!1}abutsEnd(t){return this.isValid?+t.e==+this.s:!1}engulfs(t){return this.isValid?this.s<=t.s&&this.e>=t.e:!1}equals(t){return!this.isValid||!t.isValid?!1:this.s.equals(t.s)&&this.e.equals(t.e)}intersection(t){if(!this.isValid)return this;const i=this.s>t.s?this.s:t.s,r=this.e<t.e?this.e:t.e;return i>=r?null:wn.fromDateTimes(i,r)}union(t){if(!this.isValid)return this;const i=this.s<t.s?this.s:t.s,r=this.e>t.e?this.e:t.e;return wn.fromDateTimes(i,r)}static merge(t){const[i,r]=t.sort((s,n)=>s.s-n.s).reduce(([s,n],o)=>n?n.overlaps(o)||n.abutsStart(o)?[s,n.union(o)]:[s.concat([n]),o]:[s,o],[[],null]);return r&&i.push(r),i}static xor(t){let i=null,r=0;const s=[],n=t.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...n),a=o.sort((l,c)=>l.time-c.time);for(const l of a)r+=l.type==="s"?1:-1,r===1?i=l.time:(i&&+i!=+l.time&&s.push(wn.fromDateTimes(i,l.time)),i=null);return wn.merge(s)}difference(...t){return wn.xor([this].concat(t)).map(i=>this.intersection(i)).filter(i=>i&&!i.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:YA}toISO(t){return this.isValid?`${this.s.toISO(t)}/${this.e.toISO(t)}`:YA}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:YA}toISOTime(t){return this.isValid?`${this.s.toISOTime(t)}/${this.e.toISOTime(t)}`:YA}toFormat(t,{separator:i=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(t)}${i}${this.e.toFormat(t)}`:YA}toDuration(t,i){return this.isValid?this.e.diff(this.s,t,i):Cr.invalid(this.invalidReason)}mapEndpoints(t){return wn.fromDateTimes(t(this.s),t(this.e))}}class zL{static hasDST(t=Oo.defaultZone){const i=bi.now().setZone(t).set({month:12});return!t.isUniversal&&i.offset!==i.set({month:6}).offset}static isValidIANAZone(t){return qy.isValidZone(t)}static normalizeZone(t){return cv(t,Oo.defaultZone)}static months(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||nn.create(i,r,n)).months(t)}static monthsFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null,outputCalendar:n="gregory"}={}){return(s||nn.create(i,r,n)).months(t,!0)}static weekdays(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||nn.create(i,r,null)).weekdays(t)}static weekdaysFormat(t="long",{locale:i=null,numberingSystem:r=null,locObj:s=null}={}){return(s||nn.create(i,r,null)).weekdays(t,!0)}static meridiems({locale:t=null}={}){return nn.create(t).meridiems()}static eras(t="short",{locale:i=null}={}){return nn.create(i,null,"gregory").eras(t)}static features(){return{relative:B0e()}}}function Iie(e,t){const i=s=>s.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=i(t)-i(e);return Math.floor(Cr.fromMillis(r).as("days"))}function Kze(e,t,i){const r=[["years",(a,l)=>l.year-a.year],["quarters",(a,l)=>l.quarter-a.quarter],["months",(a,l)=>l.month-a.month+(l.year-a.year)*12],["weeks",(a,l)=>{const c=Iie(a,l);return(c-c%7)/7}],["days",Iie]],s={};let n,o;for(const[a,l]of r)if(i.indexOf(a)>=0){n=a;let c=l(e,t);o=e.plus({[a]:c}),o>t?(e=e.plus({[a]:c-1}),c-=1):e=o,s[a]=c}return[e,s,o,n]}function eBe(e,t,i,r){let[s,n,o,a]=Kze(e,t,i);const l=t-s,c=i.filter(p=>["hours","minutes","seconds","milliseconds"].indexOf(p)>=0);c.length===0&&(o<t&&(o=s.plus({[a]:1})),o!==s&&(n[a]=(n[a]||0)+l/(o-s)));const h=Cr.fromObject(n,r);return c.length>0?Cr.fromMillis(l,r).shiftTo(...c).plus(h):h}const OY={arab:"[\u0660-\u0669]",arabext:"[\u06F0-\u06F9]",bali:"[\u1B50-\u1B59]",beng:"[\u09E6-\u09EF]",deva:"[\u0966-\u096F]",fullwide:"[\uFF10-\uFF19]",gujr:"[\u0AE6-\u0AEF]",hanidec:"[\u3007|\u4E00|\u4E8C|\u4E09|\u56DB|\u4E94|\u516D|\u4E03|\u516B|\u4E5D]",khmr:"[\u17E0-\u17E9]",knda:"[\u0CE6-\u0CEF]",laoo:"[\u0ED0-\u0ED9]",limb:"[\u1946-\u194F]",mlym:"[\u0D66-\u0D6F]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0B66-\u0B6F]",tamldec:"[\u0BE6-\u0BEF]",telu:"[\u0C66-\u0C6F]",thai:"[\u0E50-\u0E59]",tibt:"[\u0F20-\u0F29]",latn:"\\d"},Lie={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},tBe=OY.hanidec.replace(/[\[|\]]/g,"").split("");function iBe(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let i=0;i<e.length;i++){const r=e.charCodeAt(i);if(e[i].search(OY.hanidec)!==-1)t+=tBe.indexOf(e[i]);else for(const s in Lie){const[n,o]=Lie[s];r>=n&&r<=o&&(t+=r-n)}}return parseInt(t,10)}else return t}function kd({numberingSystem:e},t=""){return new RegExp(`${OY[e||"latn"]}${t}`)}const rBe="missing Intl.DateTimeFormat.formatToParts support";function Ur(e,t=i=>i){return{regex:e,deser:([i])=>t(iBe(i))}}const sBe=String.fromCharCode(160),n_e=`[ ${sBe}]`,o_e=new RegExp(n_e,"g");function nBe(e){return e.replace(/\./g,"\\.?").replace(o_e,n_e)}function $ie(e){return e.replace(/\./g,"").replace(o_e," ").toLowerCase()}function Ud(e,t){return e===null?null:{regex:RegExp(e.map(nBe).join("|")),deser:([i])=>e.findIndex(r=>$ie(i)===$ie(r))+t}}function Die(e,t){return{regex:e,deser:([,i,r])=>$U(i,r),groups:t}}function XV(e){return{regex:e,deser:([t])=>t}}function oBe(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function aBe(e,t){const i=kd(t),r=kd(t,"{2}"),s=kd(t,"{3}"),n=kd(t,"{4}"),o=kd(t,"{6}"),a=kd(t,"{1,2}"),l=kd(t,"{1,3}"),c=kd(t,"{1,6}"),h=kd(t,"{1,9}"),p=kd(t,"{2,4}"),m=kd(t,"{4,6}"),g=S=>({regex:RegExp(oBe(S.val)),deser:([T])=>T,literal:!0}),b=(S=>{if(e.literal)return g(S);switch(S.val){case"G":return Ud(t.eras("short",!1),0);case"GG":return Ud(t.eras("long",!1),0);case"y":return Ur(c);case"yy":return Ur(p,iH);case"yyyy":return Ur(n);case"yyyyy":return Ur(m);case"yyyyyy":return Ur(o);case"M":return Ur(a);case"MM":return Ur(r);case"MMM":return Ud(t.months("short",!0,!1),1);case"MMMM":return Ud(t.months("long",!0,!1),1);case"L":return Ur(a);case"LL":return Ur(r);case"LLL":return Ud(t.months("short",!1,!1),1);case"LLLL":return Ud(t.months("long",!1,!1),1);case"d":return Ur(a);case"dd":return Ur(r);case"o":return Ur(l);case"ooo":return Ur(s);case"HH":return Ur(r);case"H":return Ur(a);case"hh":return Ur(r);case"h":return Ur(a);case"mm":return Ur(r);case"m":return Ur(a);case"q":return Ur(a);case"qq":return Ur(r);case"s":return Ur(a);case"ss":return Ur(r);case"S":return Ur(l);case"SSS":return Ur(s);case"u":return XV(h);case"uu":return XV(a);case"uuu":return Ur(i);case"a":return Ud(t.meridiems(),0);case"kkkk":return Ur(n);case"kk":return Ur(p,iH);case"W":return Ur(a);case"WW":return Ur(r);case"E":case"c":return Ur(i);case"EEE":return Ud(t.weekdays("short",!1,!1),1);case"EEEE":return Ud(t.weekdays("long",!1,!1),1);case"ccc":return Ud(t.weekdays("short",!0,!1),1);case"cccc":return Ud(t.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Die(new RegExp(`([+-]${a.source})(?::(${r.source}))?`),2);case"ZZZ":return Die(new RegExp(`([+-]${a.source})(${r.source})?`),2);case"z":return XV(/[a-z_+-/]{1,256}?/i);default:return g(S)}})(e)||{invalidReason:rBe};return b.token=e,b}const lBe={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};function cBe(e,t,i){const{type:r,value:s}=e;if(r==="literal")return{literal:!0,val:s};const n=i[r];let o=lBe[r];if(typeof o=="object"&&(o=o[n]),o)return{literal:!1,val:o}}function uBe(e){return[`^${e.map(i=>i.regex).reduce((i,r)=>`${i}(${r.source})`,"")}$`,e]}function hBe(e,t,i){const r=e.match(t);if(r){const s={};let n=1;for(const o in i)if(QE(i,o)){const a=i[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(s[a.token.val[0]]=a.deser(r.slice(n,n+l))),n+=l}return[r,s]}else return[r,{}]}function dBe(e){const t=n=>{switch(n){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let i=null,r;return yr(e.z)||(i=qy.create(e.z)),yr(e.Z)||(i||(i=new Bl(e.Z)),r=e.Z),yr(e.q)||(e.M=(e.q-1)*3+1),yr(e.h)||(e.h<12&&e.a===1?e.h+=12:e.h===12&&e.a===0&&(e.h=0)),e.G===0&&e.y&&(e.y=-e.y),yr(e.u)||(e.S=wY(e.u)),[Object.keys(e).reduce((n,o)=>{const a=t(o);return a&&(n[a]=e[o]),n},{}),i,r]}let YV=null;function pBe(){return YV||(YV=bi.fromMillis(1555555555555)),YV}function fBe(e,t){if(e.literal)return e;const i=Nc.macroTokenToFormatOpts(e.val);if(!i)return e;const n=Nc.create(t,i).formatDateTimeParts(pBe()).map(o=>cBe(o,t,i));return n.includes(void 0)?e:n}function mBe(e,t){return Array.prototype.concat(...e.map(i=>fBe(i,t)))}function a_e(e,t,i){const r=mBe(Nc.parseFormat(i),e),s=r.map(o=>aBe(o,e)),n=s.find(o=>o.invalidReason);if(n)return{input:t,tokens:r,invalidReason:n.invalidReason};{const[o,a]=uBe(s),l=RegExp(o,"i"),[c,h]=hBe(t,l,a),[p,m,g]=h?dBe(h):[null,null,void 0];if(QE(h,"a")&&QE(h,"H"))throw new RR("Can't include meridiem when specifying 24-hour format");return{input:t,tokens:r,regex:l,rawMatches:c,matches:h,result:p,zone:m,specificOffset:g}}}function gBe(e,t,i){const{result:r,zone:s,specificOffset:n,invalidReason:o}=a_e(e,t,i);return[r,s,n,o]}const l_e=[0,31,59,90,120,151,181,212,243,273,304,334],c_e=[0,31,60,91,121,152,182,213,244,274,305,335];function ud(e,t){return new Ip("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function u_e(e,t,i){const r=new Date(Date.UTC(e,t-1,i));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const s=r.getUTCDay();return s===0?7:s}function h_e(e,t,i){return i+(tI(e)?c_e:l_e)[t-1]}function d_e(e,t){const i=tI(e)?c_e:l_e,r=i.findIndex(n=>n<t),s=t-i[r];return{month:r+1,day:s}}function aH(e){const{year:t,month:i,day:r}=e,s=h_e(t,i,r),n=u_e(t,i,r);let o=Math.floor((s-n+10)/7),a;return o<1?(a=t-1,o=s5(a)):o>s5(t)?(a=t+1,o=1):a=t,{weekYear:a,weekNumber:o,weekday:n,...DU(e)}}function Nie(e){const{weekYear:t,weekNumber:i,weekday:r}=e,s=u_e(t,1,4),n=PM(t);let o=i*7+r-s-3,a;o<1?(a=t-1,o+=PM(a)):o>n?(a=t+1,o-=PM(t)):a=t;const{month:l,day:c}=d_e(a,o);return{year:a,month:l,day:c,...DU(e)}}function QV(e){const{year:t,month:i,day:r}=e,s=h_e(t,i,r);return{year:t,ordinal:s,...DU(e)}}function Fie(e){const{year:t,ordinal:i}=e,{month:r,day:s}=d_e(t,i);return{year:t,month:r,day:s,...DU(e)}}function yBe(e){const t=LU(e.weekYear),i=wy(e.weekNumber,1,s5(e.weekYear)),r=wy(e.weekday,1,7);return t?i?r?!1:ud("weekday",e.weekday):ud("week",e.week):ud("weekYear",e.weekYear)}function _Be(e){const t=LU(e.year),i=wy(e.ordinal,1,PM(e.year));return t?i?!1:ud("ordinal",e.ordinal):ud("year",e.year)}function p_e(e){const t=LU(e.year),i=wy(e.month,1,12),r=wy(e.day,1,r5(e.year,e.month));return t?i?r?!1:ud("day",e.day):ud("month",e.month):ud("year",e.year)}function f_e(e){const{hour:t,minute:i,second:r,millisecond:s}=e,n=wy(t,0,23)||t===24&&i===0&&r===0&&s===0,o=wy(i,0,59),a=wy(r,0,59),l=wy(s,0,999);return n?o?a?l?!1:ud("millisecond",s):ud("second",r):ud("minute",i):ud("hour",t)}const JV="Invalid DateTime",kie=864e13;function BL(e){return new Ip("unsupported zone",`the zone "${e.name}" is not supported`)}function KV(e){return e.weekData===null&&(e.weekData=aH(e.c)),e.weekData}function QA(e,t){const i={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new bi({...i,...t,old:i})}function m_e(e,t,i){let r=e-t*60*1e3;const s=i.offset(r);if(t===s)return[r,t];r-=(s-t)*60*1e3;const n=i.offset(r);return s===n?[r,s]:[e-Math.min(s,n)*60*1e3,Math.max(s,n)]}function Uie(e,t){e+=t*60*1e3;const i=new Date(e);return{year:i.getUTCFullYear(),month:i.getUTCMonth()+1,day:i.getUTCDate(),hour:i.getUTCHours(),minute:i.getUTCMinutes(),second:i.getUTCSeconds(),millisecond:i.getUTCMilliseconds()}}function VN(e,t,i){return m_e(TY(e),t,i)}function zie(e,t){const i=e.o,r=e.c.year+Math.trunc(t.years),s=e.c.month+Math.trunc(t.months)+Math.trunc(t.quarters)*3,n={...e.c,year:r,month:s,day:Math.min(e.c.day,r5(r,s))+Math.trunc(t.days)+Math.trunc(t.weeks)*7},o=Cr.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),a=TY(n);let[l,c]=m_e(a,i,e.zone);return o!==0&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function JA(e,t,i,r,s,n){const{setZone:o,zone:a}=i;if(e&&Object.keys(e).length!==0){const l=t||a,c=bi.fromObject(e,{...i,zone:l,specificOffset:n});return o?c:c.setZone(a)}else return bi.invalid(new Ip("unparsable",`the input "${s}" can't be parsed as ${r}`))}function VL(e,t,i=!0){return e.isValid?Nc.create(nn.create("en-US"),{allowZ:i,forceSimple:!0}).formatDateTimeFromString(e,t):null}function e6(e,t){const i=e.c.year>9999||e.c.year<0;let r="";return i&&e.c.year>=0&&(r+="+"),r+=lo(e.c.year,i?6:4),t?(r+="-",r+=lo(e.c.month),r+="-",r+=lo(e.c.day)):(r+=lo(e.c.month),r+=lo(e.c.day)),r}function Bie(e,t,i,r,s,n){let o=lo(e.c.hour);return t?(o+=":",o+=lo(e.c.minute),(e.c.second!==0||!i)&&(o+=":")):o+=lo(e.c.minute),(e.c.second!==0||!i)&&(o+=lo(e.c.second),(e.c.millisecond!==0||!r)&&(o+=".",o+=lo(e.c.millisecond,3))),s&&(e.isOffsetFixed&&e.offset===0&&!n?o+="Z":e.o<0?(o+="-",o+=lo(Math.trunc(-e.o/60)),o+=":",o+=lo(Math.trunc(-e.o%60))):(o+="+",o+=lo(Math.trunc(e.o/60)),o+=":",o+=lo(Math.trunc(e.o%60)))),n&&(o+="["+e.zone.ianaName+"]"),o}const g_e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},vBe={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},bBe={ordinal:1,hour:0,minute:0,second:0,millisecond:0},y_e=["year","month","day","hour","minute","second","millisecond"],wBe=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],xBe=["year","ordinal","hour","minute","second","millisecond"];function Vie(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new w0e(e);return t}function Gie(e,t){const i=cv(t.zone,Oo.defaultZone),r=nn.fromObject(t),s=Oo.now();let n,o;if(yr(e.year))n=s;else{for(const c of y_e)yr(e[c])&&(e[c]=g_e[c]);const a=p_e(e)||f_e(e);if(a)return bi.invalid(a);const l=i.offset(s);[n,o]=VN(e,l,i)}return new bi({ts:n,zone:i,loc:r,o})}function jie(e,t,i){const r=yr(i.round)?!0:i.round,s=(o,a)=>(o=xY(o,r||i.calendary?0:2,!0),t.loc.clone(i).relFormatter(i).format(o,a)),n=o=>i.calendary?t.hasSame(e,o)?0:t.startOf(o).diff(e.startOf(o),o).get(o):t.diff(e,o).get(o);if(i.unit)return s(n(i.unit),i.unit);for(const o of i.units){const a=n(o);if(Math.abs(a)>=1)return s(a,o)}return s(e>t?-0:0,i.units[i.units.length-1])}function Hie(e){let t={},i;return e.length>0&&typeof e[e.length-1]=="object"?(t=e[e.length-1],i=Array.from(e).slice(0,e.length-1)):i=Array.from(e),[t,i]}class bi{constructor(t){const i=t.zone||Oo.defaultZone;let r=t.invalid||(Number.isNaN(t.ts)?new Ip("invalid input"):null)||(i.isValid?null:BL(i));this.ts=yr(t.ts)?Oo.now():t.ts;let s=null,n=null;if(!r)if(t.old&&t.old.ts===this.ts&&t.old.zone.equals(i))[s,n]=[t.old.c,t.old.o];else{const a=i.offset(this.ts);s=Uie(this.ts,a),r=Number.isNaN(s.year)?new Ip("invalid input"):null,s=r?null:s,n=r?null:a}this._zone=i,this.loc=t.loc||nn.create(),this.invalid=r,this.weekData=null,this.c=s,this.o=n,this.isLuxonDateTime=!0}static now(){return new bi({})}static local(){const[t,i]=Hie(arguments),[r,s,n,o,a,l,c]=i;return Gie({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static utc(){const[t,i]=Hie(arguments),[r,s,n,o,a,l,c]=i;return t.zone=Bl.utcInstance,Gie({year:r,month:s,day:n,hour:o,minute:a,second:l,millisecond:c},t)}static fromJSDate(t,i={}){const r=MUe(t)?t.valueOf():NaN;if(Number.isNaN(r))return bi.invalid("invalid input");const s=cv(i.zone,Oo.defaultZone);return s.isValid?new bi({ts:r,zone:s,loc:nn.fromObject(i)}):bi.invalid(BL(s))}static fromMillis(t,i={}){if(fx(t))return t<-kie||t>kie?bi.invalid("Timestamp out of range"):new bi({ts:t,zone:cv(i.zone,Oo.defaultZone),loc:nn.fromObject(i)});throw new ed(`fromMillis requires a numerical input, but received a ${typeof t} with value ${t}`)}static fromSeconds(t,i={}){if(fx(t))return new bi({ts:t*1e3,zone:cv(i.zone,Oo.defaultZone),loc:nn.fromObject(i)});throw new ed("fromSeconds requires a numerical input")}static fromObject(t,i={}){t=t||{};const r=cv(i.zone,Oo.defaultZone);if(!r.isValid)return bi.invalid(BL(r));const s=Oo.now(),n=yr(i.specificOffset)?r.offset(s):i.specificOffset,o=n5(t,Vie),a=!yr(o.ordinal),l=!yr(o.year),c=!yr(o.month)||!yr(o.day),h=l||c,p=o.weekYear||o.weekNumber,m=nn.fromObject(i);if((h||a)&&p)throw new RR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new RR("Can't mix ordinal dates with month/day");const g=p||o.weekday&&!h;let v,b,S=Uie(s,n);g?(v=wBe,b=vBe,S=aH(S)):a?(v=xBe,b=bBe,S=QV(S)):(v=y_e,b=g_e);let T=!1;for(const q of v){const G=o[q];yr(G)?T?o[q]=b[q]:o[q]=S[q]:T=!0}const O=g?yBe(o):a?_Be(o):p_e(o),C=O||f_e(o);if(C)return bi.invalid(C);const M=g?Nie(o):a?Fie(o):o,[I,$]=VN(M,n,r),U=new bi({ts:I,zone:r,o:$,loc:m});return o.weekday&&h&&t.weekday!==U.weekday?bi.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${U.toISO()}`):U}static fromISO(t,i={}){const[r,s]=Nze(t);return JA(r,s,i,"ISO 8601",t)}static fromRFC2822(t,i={}){const[r,s]=Fze(t);return JA(r,s,i,"RFC 2822",t)}static fromHTTP(t,i={}){const[r,s]=kze(t);return JA(r,s,i,"HTTP",i)}static fromFormat(t,i,r={}){if(yr(t)||yr(i))throw new ed("fromFormat requires an input string and a format");const{locale:s=null,numberingSystem:n=null}=r,o=nn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0}),[a,l,c,h]=gBe(o,t,i);return h?bi.invalid(h):JA(a,l,r,`format ${i}`,t,c)}static fromString(t,i,r={}){return bi.fromFormat(t,i,r)}static fromSQL(t,i={}){const[r,s]=Hze(t);return JA(r,s,i,"SQL",t)}static invalid(t,i=null){if(!t)throw new ed("need to specify a reason the DateTime is invalid");const r=t instanceof Ip?t:new Ip(t,i);if(Oo.throwOnInvalid)throw new SUe(r);return new bi({invalid:r})}static isDateTime(t){return t&&t.isLuxonDateTime||!1}get(t){return this[t]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?KV(this).weekYear:NaN}get weekNumber(){return this.isValid?KV(this).weekNumber:NaN}get weekday(){return this.isValid?KV(this).weekday:NaN}get ordinal(){return this.isValid?QV(this.c).ordinal:NaN}get monthShort(){return this.isValid?zL.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?zL.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?zL.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?zL.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return tI(this.year)}get daysInMonth(){return r5(this.year,this.month)}get daysInYear(){return this.isValid?PM(this.year):NaN}get weeksInWeekYear(){return this.isValid?s5(this.weekYear):NaN}resolvedLocaleOptions(t={}){const{locale:i,numberingSystem:r,calendar:s}=Nc.create(this.loc.clone(t),t).resolvedOptions(this);return{locale:i,numberingSystem:r,outputCalendar:s}}toUTC(t=0,i={}){return this.setZone(Bl.instance(t),i)}toLocal(){return this.setZone(Oo.defaultZone)}setZone(t,{keepLocalTime:i=!1,keepCalendarTime:r=!1}={}){if(t=cv(t,Oo.defaultZone),t.equals(this.zone))return this;if(t.isValid){let s=this.ts;if(i||r){const n=t.offset(this.ts),o=this.toObject();[s]=VN(o,n,t)}return QA(this,{ts:s,zone:t})}else return bi.invalid(BL(t))}reconfigure({locale:t,numberingSystem:i,outputCalendar:r}={}){const s=this.loc.clone({locale:t,numberingSystem:i,outputCalendar:r});return QA(this,{loc:s})}setLocale(t){return this.reconfigure({locale:t})}set(t){if(!this.isValid)return this;const i=n5(t,Vie),r=!yr(i.weekYear)||!yr(i.weekNumber)||!yr(i.weekday),s=!yr(i.ordinal),n=!yr(i.year),o=!yr(i.month)||!yr(i.day),a=n||o,l=i.weekYear||i.weekNumber;if((a||s)&&l)throw new RR("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&s)throw new RR("Can't mix ordinal dates with month/day");let c;r?c=Nie({...aH(this.c),...i}):yr(i.ordinal)?(c={...this.toObject(),...i},yr(i.day)&&(c.day=Math.min(r5(c.year,c.month),c.day))):c=Fie({...QV(this.c),...i});const[h,p]=VN(c,this.o,this.zone);return QA(this,{ts:h,o:p})}plus(t){if(!this.isValid)return this;const i=Cr.fromDurationLike(t);return QA(this,zie(this,i))}minus(t){if(!this.isValid)return this;const i=Cr.fromDurationLike(t).negate();return QA(this,zie(this,i))}startOf(t){if(!this.isValid)return this;const i={},r=Cr.normalizeUnit(t);switch(r){case"years":i.month=1;case"quarters":case"months":i.day=1;case"weeks":case"days":i.hour=0;case"hours":i.minute=0;case"minutes":i.second=0;case"seconds":i.millisecond=0;break}if(r==="weeks"&&(i.weekday=1),r==="quarters"){const s=Math.ceil(this.month/3);i.month=(s-1)*3+1}return this.set(i)}endOf(t){return this.isValid?this.plus({[t]:1}).startOf(t).minus(1):this}toFormat(t,i={}){return this.isValid?Nc.create(this.loc.redefaultToEN(i)).formatDateTimeFromString(this,t):JV}toLocaleString(t=tH,i={}){return this.isValid?Nc.create(this.loc.clone(i),t).formatDateTime(this):JV}toLocaleParts(t={}){return this.isValid?Nc.create(this.loc.clone(t),t).formatDateTimeParts(this):[]}toISO({format:t="extended",suppressSeconds:i=!1,suppressMilliseconds:r=!1,includeOffset:s=!0,extendedZone:n=!1}={}){if(!this.isValid)return null;const o=t==="extended";let a=e6(this,o);return a+="T",a+=Bie(this,o,i,r,s,n),a}toISODate({format:t="extended"}={}){return this.isValid?e6(this,t==="extended"):null}toISOWeekDate(){return VL(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:t=!1,suppressSeconds:i=!1,includeOffset:r=!0,includePrefix:s=!1,extendedZone:n=!1,format:o="extended"}={}){return this.isValid?(s?"T":"")+Bie(this,o==="extended",i,t,r,n):null}toRFC2822(){return VL(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return VL(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?e6(this,!0):null}toSQLTime({includeOffset:t=!0,includeZone:i=!1,includeOffsetSpace:r=!0}={}){let s="HH:mm:ss.SSS";return(i||t)&&(r&&(s+=" "),i?s+="z":t&&(s+="ZZ")),VL(this,s,!0)}toSQL(t={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(t)}`:null}toString(){return this.isValid?this.toISO():JV}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(t={}){if(!this.isValid)return{};const i={...this.c};return t.includeConfig&&(i.outputCalendar=this.outputCalendar,i.numberingSystem=this.loc.numberingSystem,i.locale=this.loc.locale),i}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(t,i="milliseconds",r={}){if(!this.isValid||!t.isValid)return Cr.invalid("created by diffing an invalid DateTime");const s={locale:this.locale,numberingSystem:this.numberingSystem,...r},n=PUe(i).map(Cr.normalizeUnit),o=t.valueOf()>this.valueOf(),a=o?this:t,l=o?t:this,c=eBe(a,l,n,s);return o?c.negate():c}diffNow(t="milliseconds",i={}){return this.diff(bi.now(),t,i)}until(t){return this.isValid?wn.fromDateTimes(this,t):this}hasSame(t,i){if(!this.isValid)return!1;const r=t.valueOf(),s=this.setZone(t.zone,{keepLocalTime:!0});return s.startOf(i)<=r&&r<=s.endOf(i)}equals(t){return this.isValid&&t.isValid&&this.valueOf()===t.valueOf()&&this.zone.equals(t.zone)&&this.loc.equals(t.loc)}toRelative(t={}){if(!this.isValid)return null;const i=t.base||bi.fromObject({},{zone:this.zone}),r=t.padding?this<i?-t.padding:t.padding:0;let s=["years","months","days","hours","minutes","seconds"],n=t.unit;return Array.isArray(t.unit)&&(s=t.unit,n=void 0),jie(i,this.plus(r),{...t,numeric:"always",units:s,unit:n})}toRelativeCalendar(t={}){return this.isValid?jie(t.base||bi.fromObject({},{zone:this.zone}),this,{...t,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...t){if(!t.every(bi.isDateTime))throw new ed("min requires all arguments be DateTimes");return xie(t,i=>i.valueOf(),Math.min)}static max(...t){if(!t.every(bi.isDateTime))throw new ed("max requires all arguments be DateTimes");return xie(t,i=>i.valueOf(),Math.max)}static fromFormatExplain(t,i,r={}){const{locale:s=null,numberingSystem:n=null}=r,o=nn.fromOpts({locale:s,numberingSystem:n,defaultToEN:!0});return a_e(o,t,i)}static fromStringExplain(t,i,r={}){return bi.fromFormatExplain(t,i,r)}static get DATE_SHORT(){return tH}static get DATE_MED(){return x0e}static get DATE_MED_WITH_WEEKDAY(){return AUe}static get DATE_FULL(){return T0e}static get DATE_HUGE(){return S0e}static get TIME_SIMPLE(){return E0e}static get TIME_WITH_SECONDS(){return C0e}static get TIME_WITH_SHORT_OFFSET(){return A0e}static get TIME_WITH_LONG_OFFSET(){return O0e}static get TIME_24_SIMPLE(){return R0e}static get TIME_24_WITH_SECONDS(){return M0e}static get TIME_24_WITH_SHORT_OFFSET(){return P0e}static get TIME_24_WITH_LONG_OFFSET(){return I0e}static get DATETIME_SHORT(){return L0e}static get DATETIME_SHORT_WITH_SECONDS(){return $0e}static get DATETIME_MED(){return D0e}static get DATETIME_MED_WITH_SECONDS(){return N0e}static get DATETIME_MED_WITH_WEEKDAY(){return OUe}static get DATETIME_FULL(){return F0e}static get DATETIME_FULL_WITH_SECONDS(){return k0e}static get DATETIME_HUGE(){return U0e}static get DATETIME_HUGE_WITH_SECONDS(){return z0e}}function KA(e){if(bi.isDateTime(e))return e;if(e&&e.valueOf&&fx(e.valueOf()))return bi.fromJSDate(e);if(e&&typeof e=="object")return bi.fromObject(e);throw new ed(`Unknown datetime argument: ${e}, of type ${typeof e}`)}const t6={ar:[".",","],bg:[",","\xA0"],bs:[",","."],ca:[",","."],cs:[",","\xA0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xA0"],fi:[",","\xA0"],fr:[",","\u202F"],"fr-ch":[",","\u202F"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xA0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xA0"],lv:[",","\xA0"],mk:[",","."],nb:[",","\xA0"],nl:[",","."],pl:[",","\xA0"],pt:[",","."],"pt-pt":[",","\xA0"],ro:[",","."],ru:[",","\xA0"],sk:[",","\xA0"],sl:[",","."],sr:[",","."],sv:[",","\xA0"],th:[".",","],tr:[",","."],uk:[",","\xA0"],vi:[",","."],zh:[".",","]};function __e(e){e||(e=Hu());let t=e in t6;if(!t){const n=e.split("-");n.length>1&&n[0]in t6&&(e=n[0],t=!0),t||(e="en")}const[i,r,s="#,##0.###"]=t6[e];return{decimal:i,group:r,pattern:s}}function TBe(e,t){const i=__e((t={...t}).locale);t.customs=i;const r=t.pattern||i.pattern;return isNaN(e)||Math.abs(e)===1/0?null:SBe(e,r,t)}const v_e=/[#0,]*[#0](?:\.0*#*)?/;function SBe(e,t,i){const r=(i=i||{}).customs.group,s=i.customs.decimal,n=t.split(";"),o=n[0];if((t=n[e<0?1:0]||"-"+o).includes("%"))e*=100;else if(t.includes("\u2030"))e*=1e3;else{if(t.includes("\xA4"))throw new Error("currency notation not supported");if(t.includes("E"))throw new Error("exponential notation not supported")}const a=v_e,l=o.match(a);if(!l)throw new Error("unable to find a number expression in pattern: "+t);return i.fractional===!1&&(i.places=0),t.replace(a,EBe(e,l[0],{decimal:s,group:r,places:i.places,round:i.round}))}function EBe(e,t,i){(i=i||{}).places===!0&&(i.places=0),i.places===1/0&&(i.places=6);const r=t.split("."),s=typeof i.places=="string"&&i.places.indexOf(",");let n=i.places;s?n=i.places.substring(s+1):n>=0||(n=(r[1]||[]).length),i.round<0||(e=Number(e.toFixed(Number(n))));const o=String(Math.abs(e)).split("."),a=o[1]||"";if(r[1]||i.places){s&&(i.places=i.places.substring(0,s));const v=i.places!==void 0?i.places:r[1]&&r[1].lastIndexOf("0")+1;v>a.length&&(o[1]=a.padEnd(Number(v),"0")),n<a.length&&(o[1]=a.substr(0,Number(n)))}else o[1]&&o.pop();const l=r[0].replace(",","");let c=l.indexOf("0");c!==-1&&(c=l.length-c,c>o[0].length&&(o[0]=o[0].padStart(c,"0")),l.includes("#")||(o[0]=o[0].substr(o[0].length-c)));let h,p,m=r[0].lastIndexOf(",");if(m!==-1){h=r[0].length-m-1;const v=r[0].substr(0,m);m=v.lastIndexOf(","),m!==-1&&(p=v.length-m-1)}const g=[];for(let v=o[0];v;){const b=v.length-h;g.push(b>0?v.substr(b):v),v=b>0?v.slice(0,b):"",p&&(h=p,p=void 0)}return o[0]=g.reverse().join(i.group||","),o.join(i.decimal||".")}function CBe(e){const t=__e((e=e||{}).locale),i=e.pattern||t.pattern,r=t.group,s=t.decimal;let n=1;if(i.includes("%"))n/=100;else if(i.includes("\u2030"))n/=1e3;else if(i.includes("\xA4"))throw new Error("currency notation not supported");const o=i.split(";");return o.length===1&&o.push("-"+o[0]),{regexp:MP(o,l=>(l="(?:"+Rhe(l,".")+")").replace(v_e,c=>{const h={signed:!1,separator:e.strict?r:[r,""],fractional:e.fractional,decimal:s,exponent:!1},p=c.split(".");let m=e.places;p.length===1&&n!==1&&(p[1]="###"),p.length===1||m===0?h.fractional=!1:(m===void 0&&(m=e.pattern?p[1].lastIndexOf("0")+1:1/0),m&&e.fractional==null&&(h.fractional=!0),!e.places&&m<p[1].length&&(m+=","+p[1].length),h.places=m);const g=p[0].split(",");return g.length>1&&(h.groupSize=g.pop().length,g.length>1&&(h.groupSize2=g.pop().length)),"("+OBe(h)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:r,decimal:s,factor:n}}function ABe(e,t){const i=CBe(t),r=new RegExp("^"+i.regexp+"$").exec(e);if(!r)return NaN;let s=r[1];if(!r[1]){if(!r[2])return NaN;s=r[2],i.factor*=-1}return s=s.replace(new RegExp("["+i.group+"\\s\\xa0]","g"),"").replace(i.decimal,"."),Number(s)*i.factor}function OBe(e){"places"in(e=e||{})||(e.places=1/0),typeof e.decimal!="string"&&(e.decimal="."),"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]),"exponent"in e||(e.exponent=[!0,!1]),"eSigned"in e||(e.eSigned=[!0,!1]);const t=qie(e),i=MP(e.fractional,s=>{let n="";return s&&e.places!==0&&(n="\\"+e.decimal,e.places===1/0?n="(?:"+n+"\\d+)?":n+="\\d{"+e.places+"}"),n},!0);let r=t+i;return i&&(r="(?:(?:"+r+")|(?:"+i+"))"),r+MP(e.exponent,s=>s?"([eE]"+qie({signed:e.eSigned})+")":"")}function qie(e){return"signed"in(e=e||{})||(e.signed=[!0,!1]),"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="",MP(e.signed,t=>t?"[-+]":"",!0)+MP(e.separator,t=>{if(!t)return"(?:\\d+)";(t=Rhe(t))===" "?t="\\s":t==="\xA0"&&(t="\\s\\xa0");const i=e.groupSize,r=e.groupSize2;if(r){const s="(?:0|[1-9]\\d{0,"+(r-1)+"}(?:["+t+"]\\d{"+r+"})*["+t+"]\\d{"+i+"})";return i-r>0?"(?:"+s+"|(?:0|[1-9]\\d{0,"+(i-1)+"}))":s}return"(?:0|[1-9]\\d{0,"+(i-1)+"}(?:["+t+"]\\d{"+i+"})*)"},!0)}const MP=(e,t,i)=>{if(!(e instanceof Array))return t(e);const r=[];for(let s=0;s<e.length;s++)r.push(t(e[s]));return RBe(r.join("|"),i)},RBe=(e,t)=>"("+(t?"?:":"")+e+")";var Wie,Zie;function $1t(e){return K3.fromJSON(e.toJSON())}function MBe(e){return e.toJSON?e.toJSON():e}function D1t(e){return typeof e=="string"||e instanceof String}function N1t(e){return typeof e=="number"}function Xie(e){return e instanceof Date}function F1t(e,t){return e===t||!(!Xie(e)||!Xie(t))&&e.getTime()===t.getTime()}function k1t(e){if(e===void 0)return null;if(typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function U1t(e){if(e===null)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new zi({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function z1t(e){if(e===void 0)return null;if(typeof e=="number"||typeof e=="number")return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"})(Wie||(Wie={})),function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(Zie||(Zie={}));const B1t=1e3,V1t={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},Yie={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},G1t={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function j1t(e){return e===void 0?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function H1t(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const m=p[l],g=o(a[m]);g&&(c&&(c+=","),c+=JSON.stringify(m)+":"+g)}return n.splice(h,1),"{"+c+"}"}(e)}class b_e{constructor(t){this.value=t}}class w_e{constructor(t){this.value=t}}class RY{constructor(t){this.fn=t}}class MY{constructor(t,i){this.paramCount=i,this.fn=t}}const PBe=RY,IBe=w_e,LBe=b_e,$Be=MY,Mu={type:"VOID"},DBe={type:"BREAK"},NBe={type:"CONTINUE"};function PP(e,t,i){return t===""||t==null||t===i||t===i?e:e=e.split(t).join(i)}function PY(e){return e instanceof RY||e instanceof TUe||e instanceof MY}function o5(e){return!!Sa(e)||!!Nl(e)||!!Ka(e)||!!Dl(e)||e===null||e===Mu||typeof e=="number"}function FBe(e,t){return e===void 0?t:e}function Sa(e){return typeof e=="string"||e instanceof String}function Dl(e){return typeof e=="boolean"}function Nl(e){return typeof e=="number"}function kBe(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}function yd(e){return e instanceof Array}function UBe(e){return(e==null?void 0:e.arcadeDeclaredClass)==="esri.arcade.Feature"}function zBe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureset.support.FeatureSet")===!0}function BBe(e){return(e&&e.declaredRootClass&&e.declaredRootClass==="esri.arcade.featureSetCollection")===!0}function kx(e){return e instanceof Hm}function Ka(e){return e instanceof Date}function VBe(e,t,i){if(e.length<t||e.length>i)throw new Error("Function called with wrong number of Parameters")}function GBe(e){return e<0?-Math.round(-e):Math.round(e)}function jBe(){let e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),(t==="x"?i:3&i|8).toString(16)})}function IY(e,t){return isNaN(e)===!1?t==null||t===""?e.toString():(t=PP(t,"\u2030",""),t=PP(t,"\xA4",""),TBe(e,{pattern:t})):e.toString()}function NU(e,t){const i=bi.fromJSDate(e);return t==null||t===""?i.toISO({suppressMilliseconds:!0}):i.toFormat(x_e(t),{locale:Hu(),numberingSystem:"latn"})}function x_e(e){e=e.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let t="";const i=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const r of e.match(i))switch(r){case"D":t+="d";break;case"DD":t+="dd";break;case"DDD":t+="o";break;case"d":t+="c";break;case"ddd":t+="ccc";break;case"dddd":t+="cccc";break;case"M":t+="L";break;case"MM":t+="LL";break;case"MMM":t+="LLL";break;case"MMMM":t+="LLLL";break;case"YY":t+="yy";break;case"Y":case"YYYY":t+="yyyy";break;case"Q":t+="q";break;case"Z":t+="ZZ";break;case"ZZ":t+="ZZZ";break;case"S":t+="'S'";break;case"SS":t+="'SS'";break;case"SSS":t+="u";break;case"A":case"a":t+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":t+=r;break;default:r.length>=2&&r.slice(0,1)==="["&&r.slice(-1)==="]"?t+=`'${r.slice(1,-1)}'`:t+=`'${r}'`}return t}function qr(e,t,i){switch(i){case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t}return!1}function HBe(e,t,i){if(e===null){if(t===null||t===Mu)return qr(null,null,i);if(Nl(t))return qr(0,t,i);if(Sa(t)||Dl(t))return qr(0,rn(t),i);if(Ka(t))return qr(0,t.getTime(),i)}if(e===Mu){if(t===null||t===Mu)return qr(null,null,i);if(Nl(t))return qr(0,t,i);if(Sa(t)||Dl(t))return qr(0,rn(t),i);if(Ka(t))return qr(0,t.getTime(),i)}else if(Nl(e)){if(Nl(t))return qr(e,t,i);if(Dl(t))return qr(e,rn(t),i);if(t===null||t===Mu)return qr(e,0,i);if(Sa(t))return qr(e,rn(t),i);if(Ka(t))return qr(e,t.getTime(),i)}else if(Sa(e)){if(Sa(t))return qr(Bv(e),Bv(t),i);if(Ka(t))return qr(rn(e),t.getTime(),i);if(Nl(t))return qr(rn(e),t,i);if(t===null||t===Mu)return qr(rn(e),0,i);if(Dl(t))return qr(rn(e),rn(t),i)}else if(Ka(e)){if(Ka(t))return qr(e,t,i);if(t===null||t===Mu)return qr(e.getTime(),0,i);if(Nl(t))return qr(e.getTime(),t,i);if(Dl(t)||Sa(t))return qr(e.getTime(),rn(t),i)}else if(Dl(e)){if(Dl(t))return qr(e,t,i);if(Nl(t))return qr(rn(e),rn(t),i);if(Ka(t))return qr(rn(e),t.getTime(),i);if(t===null||t===Mu)return qr(rn(e),0,i);if(Sa(t))return qr(rn(e),rn(t),i)}return!!T_e(e,t)&&(i==="<="||i===">=")}function T_e(e,t){if(e===t||e===null&&t===Mu||t===null&&e===Mu)return!0;if(Ka(e)&&Ka(t))return e.getTime()===t.getTime();if(e instanceof bY||e instanceof vT)return e.equalityTest(t);if(e instanceof xt&&t instanceof xt){const i=e.cache._arcadeCacheId,r=t.cache._arcadeCacheId;if(i!=null)return i===r}return e!==void 0&&t!==void 0&&e!==null&&t!==null&&typeof e=="object"&&typeof t=="object"&&(e._arcadeCacheId===t._arcadeCacheId&&e._arcadeCacheId!==void 0&&e._arcadeCacheId!==null||e._underlyingGraphic===t._underlyingGraphic&&e._underlyingGraphic!==void 0&&e._underlyingGraphic!==null)}function Bv(e,t){if(Sa(e))return e;if(e===null)return"";if(Nl(e))return IY(e,t);if(Dl(e))return e.toString();if(Ka(e))return NU(e,t);if(e instanceof Gc)return JSON.stringify(e.toJSON());if(yd(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=a5(e[r]);return"["+i.join(",")+"]"}if(e instanceof Hm){const i=[];for(let r=0;r<e.length();r++)i[r]=a5(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():PY(e)?"object, Function":""}function qBe(e){const t=[];if(yd(e)===!1)return null;if(e instanceof Hm){for(let i=0;i<e.length();i++)t[i]=rn(e.get(i));return t}for(let i=0;i<e.length;i++)t[i]=rn(e[i]);return t}function GN(e,t){if(Sa(e))return e;if(e===null)return"";if(Nl(e))return IY(e,t);if(Dl(e))return e.toString();if(Ka(e))return NU(e,t);if(e instanceof Gc)return e instanceof zi?'{"xmin":'+e.xmin.toString()+',"ymin":'+e.ymin.toString()+","+(e.hasZ?'"zmin":'+e.zmin.toString()+",":"")+(e.hasM?'"mmin":'+e.mmin.toString()+",":"")+'"xmax":'+e.xmax.toString()+',"ymax":'+e.ymax.toString()+","+(e.hasZ?'"zmax":'+e.zmax.toString()+",":"")+(e.hasM?'"mmax":'+e.mmax.toString()+",":"")+'"spatialReference":'+lH(e.spatialReference)+"}":lH(e.toJSON(),(i,r)=>i.key===r.key?0:i.key==="spatialReference"?1:r.key==="spatialReference"||i.key<r.key?-1:i.key>r.key?1:0);if(yd(e)){const i=[];for(let r=0;r<e.length;r++)i[r]=a5(e[r]);return"["+i.join(",")+"]"}if(e instanceof Hm){const i=[];for(let r=0;r<e.length();r++)i[r]=a5(e.get(r));return"["+i.join(",")+"]"}return e!==null&&typeof e=="object"&&e.castToText!==void 0?e.castToText():PY(e)?"object, Function":""}function a5(e){if(e===null)return"null";if(Dl(e)||Nl(e)||Sa(e))return JSON.stringify(e);if(e instanceof Gc||e instanceof Hm||e instanceof Array)return GN(e);if(e instanceof Date)return JSON.stringify(NU(e,""));if(e!==null&&typeof e=="object"){if(e.castToText!==void 0)return e.castToText()}else if(e===Mu)return"null";return"null"}function rn(e,t){return Nl(e)?e:e===null||e===""?0:Ka(e)?NaN:Dl(e)?e?1:0:yd(e)||e===""||e===void 0?NaN:t!==void 0&&Sa(e)?(t=PP(t,"\u2030",""),t=PP(t,"\xA4",""),ABe(e,{pattern:t})):e===Mu?0:Number(e)}function WBe(e){if(Ka(e))return e;if(Sa(e)){const t=S_e(e);if(t)return t.toJSDate()}return null}function ZBe(e){return Ka(e)?bi.fromJSDate(e):Sa(e)?S_e(e):null}function S_e(e){const t=/ (\d\d)/;let i=bi.fromISO(e);return i.isValid||t.test(e)&&(e=e.replace(t,"T$1"),i=bi.fromISO(e),i.isValid)?i:null}function XBe(e){return Dl(e)?e:Sa(e)?(e=e.toLowerCase())==="true":!!Nl(e)&&e!==0&&!isNaN(e)}function YBe(e,t){return N(e)?null:(e.spatialReference!==null&&e.spatialReference!==void 0||(e.spatialReference=t),e)}function QBe(e){if(e===null)return null;if(e instanceof xt)return e.x==="NaN"||e.x===null||isNaN(e.x)?null:e;if(e instanceof Ku){if(e.rings.length===0)return null;for(const t of e.rings)if(t.length>0)return e;return null}if(e instanceof Bu){if(e.paths.length===0)return null;for(const t of e.paths)if(t.length>0)return e;return null}return e instanceof lT?e.points.length===0?null:e:e instanceof zi?e.xmin==="NaN"||e.xmin===null||isNaN(e.xmin)?null:e:null}function E_e(e,t){if(!e||!e.domain)return t;let i=null;if(e.field.type==="string"||e.field.type==="esriFieldTypeString")t=Bv(t);else{if(t==null)return null;if(t==="")return t;t=rn(t)}for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.code===t&&(i=s)}return i===null?t:i.name}function C_e(e,t){if(!e||!e.domain)return t;let i=null;t=Bv(t);for(let r=0;r<e.domain.codedValues.length;r++){const s=e.domain.codedValues[r];s.name===t&&(i=s)}return i===null?t:i.code}function FU(e,t,i=null,r=null){if(!t||!t.fields)return null;let s,n,o=null;for(let a=0;a<t.fields.length;a++){const l=t.fields[a];l.name.toLowerCase()===e.toString().toLowerCase()&&(o=l)}if(o===null)throw new Error("Field not found");return r===null&&i&&t.typeIdField&&(r=i.hasField(t.typeIdField)?i.field(t.typeIdField):null),r!=null&&t.types.some(function(a){return a.id===r&&(s=a.domains&&a.domains[o.name],s&&s.type==="inherited"&&(s=Qie(o.name,t),n=!0),!0)}),n||s||(s=Qie(e,t)),{field:o,domain:s}}function Qie(e,t){let i;return t.fields.some(function(r){return r.name.toLowerCase()===e.toLowerCase()&&(i=r.domain),!!i}),i}function lH(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});const i=typeof t.cycles=="boolean"&&t.cycles,r=t.cmp&&(s=t.cmp,function(o){return function(a,l){const c={key:a,value:o[a]},h={key:l,value:o[l]};return s(c,h)}});var s;const n=[];return function o(a){if(a&&a.toJSON&&typeof a.toJSON=="function"&&(a=a.toJSON()),a===void 0)return;if(typeof a=="number")return isFinite(a)?""+a:"null";if(typeof a!="object")return JSON.stringify(a);let l,c;if(Array.isArray(a)){for(c="[",l=0;l<a.length;l++)l&&(c+=","),c+=o(a[l])||"null";return c+"]"}if(a===null)return"null";if(n.includes(a)){if(i)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const h=n.push(a)-1,p=Object.keys(a).sort(r&&r(a));for(c="",l=0;l<p.length;l++){const m=p[l],g=o(a[m]);g&&(c&&(c+=","),c+=JSON.stringify(m)+":"+g)}return n.splice(h,1),"{"+c+"}"}(e)}function JBe(e){if(e===null)return null;const t=[];for(const i of e)i&&i.arcadeDeclaredClass&&i.arcadeDeclaredClass==="esri.arcade.Feature"?t.push(i.geometry()):t.push(i);return t}function JE(e,t){if(!(t instanceof xt))throw new Error("Invalid Argument");e.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}function KBe(e,t){if(yd(e)||kx(e)){let i=!1,r=!1,s=[],n=t;if(yd(e)){for(const o of e)JE(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ,r=e[0].hasM)}else if(e instanceof vT)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else{if(!kx(e))throw new Error("Invalid Argument");for(const o of e.toArray())JE(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:(PZ(s,r,i)===!1&&(s=s.slice(0).reverse()),new Ku({rings:[s],spatialReference:n,hasZ:i,hasM:r}))}return e}function eVe(e,t){if(yd(e)||kx(e)){let i=!1,r=!1,s=[],n=t;if(yd(e)){for(const o of e)JE(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof vT)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(kx(e)){for(const o of e.toArray())JE(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new Bu({paths:[s],spatialReference:n,hasZ:i,hasM:r})}return e}function tVe(e,t){if(yd(e)||kx(e)){let i=!1,r=!1,s=[],n=t;if(yd(e)){for(const o of e)JE(s,o);s.length>0&&(n=e[0].spatialReference,i=e[0].hasZ===!0,r=e[0].hasM===!0)}else if(e instanceof vT)s=e._elements,s.length>0&&(i=e._hasZ,r=e._hasM,n=e.get(0).spatialReference);else if(kx(e)){for(const o of e.toArray())JE(s,o);s.length>0&&(n=e.get(0).spatialReference,i=e.get(0).hasZ===!0,r=e.get(0).hasM===!0)}return s.length===0?null:new lT({points:s,spatialReference:n,hasZ:i,hasM:r})}return e}function iVe(e,t=!1){const i=[];if(e===null)return i;if(yd(e)===!0){for(let r=0;r<e.length;r++){const s=Bv(e[r]);s===""&&t!==!0||i.push(s)}return i}if(e instanceof Hm){for(let r=0;r<e.length();r++){const s=Bv(e.get(r));s===""&&t!==!0||i.push(s)}return i}if(o5(e)){const r=Bv(e);return r===""&&t!==!0||i.push(r),i}return[]}let i6=0;function rVe(e){return i6++,i6%100==0?(i6=0,new Promise(t=>{setTimeout(()=>{t(e)},0)})):e}function sVe(e,t,i){switch(i){case"&":return e&t;case"|":return e|t;case"^":return e^t;case"<<":return e<<t;case">>":return e>>t;case">>>":return e>>>t}}function IP(e,t=null){return e==null?null:Dl(e)||Nl(e)||Sa(e)?e:e instanceof Gc?(t==null?void 0:t.keepGeometryType)===!0?e:e.toJSON():e instanceof Hm?e.toArray().map(i=>IP(i,t)):e instanceof Array?e.map(i=>IP(i,t)):e instanceof Date?e:e!==null&&typeof e=="object"&&e.castAsJson!==void 0?e.castAsJson(t):null}async function nVe(e,t,i,r,s){const n=await LY(e,t,i);s[r]=n}async function LY(e,t=null,i=null){if(e instanceof Hm&&(e=e.toArray()),e==null)return null;if(o5(e)||e instanceof Gc||e instanceof Date)return IP(e,i);if(e instanceof Array){const r=[],s=[];for(const n of e)n===null||o5(n)||n instanceof Gc||n instanceof Date?s.push(IP(n,i)):(s.push(null),r.push(nVe(n,t,i,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return e!==null&&typeof e=="object"&&e.castAsJsonAsync!==void 0?e.castAsJsonAsync(t,i):null}function oVe(e,t,i){const r=e.fullSchema();return r===null||!r.fields?null:FU(t,r,e,i)}function aVe(e){const t=e.fullSchema();return t===null?null:t.fields&&t.typeIdField?{subtypeField:t.typeIdField,subtypes:t.types?t.types.map(i=>({name:i.name,code:i.id})):[]}:null}function lVe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;const n=FU(t,s,e,r);if(i===void 0)try{i=e.field(t)}catch{return null}return E_e(n,i)}function cVe(e,t,i,r){const s=e.fullSchema();if(s===null||!s.fields)return null;if(i===void 0){try{i=e.field(t)}catch{return null}return i}return C_e(FU(t,s,e,r),i)}function uVe(e){const t=e.fullSchema();if(t===null||!t.fields)return null;const i=[];for(const r of t.fields)i.push(MBe(r));return{objectIdField:t.objectIdField,globalIdField:t.globalIdField,geometryType:Yie[t.geometryType]===void 0?"":Yie[t.geometryType],fields:i}}const q1t=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:b_e,ImplicitResultE:w_e,NativeFunctionE:RY,SizzleFunctionE:MY,NativeFunction:PBe,ImplicitResult:IBe,ReturnResult:LBe,SizzleFunction:$Be,voidOperation:Mu,breakResult:DBe,continueResult:NBe,multiReplace:PP,isFunctionParameter:PY,isSimpleType:o5,defaultUndefined:FBe,isString:Sa,isBoolean:Dl,isNumber:Nl,isInteger:kBe,isArray:yd,isFeature:UBe,isFeatureSet:zBe,isFeatureSetCollection:BBe,isImmutableArray:kx,isDate:Ka,pcCheck:VBe,absRound:GBe,generateUUID:jBe,formatNumber:IY,formatDate:NU,standardiseDateFormat:x_e,greaterThanLessThan:HBe,equalityTest:T_e,toString:Bv,toNumberArray:qBe,toStringExplicit:GN,toNumber:rn,toDate:WBe,toDateTime:ZBe,toBoolean:XBe,fixSpatialReference:YBe,fixNullGeometry:QBe,getDomainValue:E_e,getDomainCode:C_e,getDomain:FU,stableStringify:lH,autoCastFeatureToGeometry:JBe,autoCastArrayOfPointsToPolygon:KBe,autoCastArrayOfPointsToPolyline:eVe,autoCastArrayOfPointsToMultiPoint:tVe,toStringArray:iVe,tick:rVe,binaryOperator:sVe,castAsJson:IP,castAsJsonAsync:LY,featureFullDomain:oVe,featureSubtypes:aVe,featureDomainValueLookup:lVe,featureDomainCodeLookup:cVe,featureSchema:uVe},Symbol.toStringTag,{value:"Module"}));var cH;let PR=cH=class extends Fe{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new cH({minValue:this.minValue,maxValue:this.maxValue})}};u([f({type:Number,json:{write:!0}})],PR.prototype,"minValue",void 0),u([f({type:Number,json:{write:!0}})],PR.prototype,"maxValue",void 0),PR=cH=u([B("esri.renderer.support.AuthoringInfoClassBreakInfo")],PR);var uH;let ev=uH=class extends Fe{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new uH({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:me(this.classBreakInfos)})}};u([f({type:String,json:{write:!0}})],ev.prototype,"field",void 0),u([f({type:String,json:{write:!0}})],ev.prototype,"normalizationField",void 0),u([f({type:String,json:{write:!0}})],ev.prototype,"label",void 0),u([f({type:[PR],json:{write:!0}})],ev.prototype,"classBreakInfos",void 0),ev=uH=u([B("esri.renderers.support.AuthoringInfoFieldInfo")],ev);var hH;const GL=new Hi({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),jL=new Hi({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),Jie={key:e=>typeof e=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},Kie=["high-to-low","above-and-below","centered-on","extremes"],ere=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],tre=["seconds","minutes","hours","days","months","years"];let mc=hH=class extends Fe{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return typeof e=="string"||typeof e=="number"?e:null}castStartTime(e){return typeof e=="string"||typeof e=="number"?e:null}get style(){return this.type==="color"?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new hH({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};u([f({types:Jie,json:{write:!0}})],mc.prototype,"endTime",void 0),u([pi("endTime")],mc.prototype,"castEndTime",null),u([f({type:String,json:{write:!0}})],mc.prototype,"field",void 0),u([f({type:Number,json:{write:!0}})],mc.prototype,"maxSliderValue",void 0),u([f({type:Number,json:{write:!0}})],mc.prototype,"minSliderValue",void 0),u([f({types:Jie,json:{write:!0}})],mc.prototype,"startTime",void 0),u([pi("startTime")],mc.prototype,"castStartTime",null),u([f({type:GL.apiValues,value:null,json:{type:GL.jsonValues,read:GL.read,write:GL.write}})],mc.prototype,"style",null),u([f({type:ere,value:null,json:{type:ere,origins:{"web-scene":{type:Kie,write:{writer:(e,t)=>{Kie.includes(e)&&(t.theme=e)}}}},write:!0}})],mc.prototype,"theme",null),u([f({type:jL.apiValues,json:{type:jL.jsonValues,read:jL.read,write:jL.write}})],mc.prototype,"type",void 0),u([f({type:tre,json:{type:tre,write:!0}})],mc.prototype,"units",void 0),mc=hH=u([B("esri.renderers.support.AuthoringInfoVisualVariable")],mc);const hVe=mc;let jN=class extends Fe{constructor(e){super(e),this.type=null}};u([f({readOnly:!0,json:{read:!1,write:!0}})],jN.prototype,"type",void 0),jN=u([B("esri.rest.support.ColorRamp")],jN);const $Y=jN;var dH;let Hb=dH=class extends $Y{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new dH({fromColor:me(this.fromColor),toColor:me(this.toColor),algorithm:this.algorithm})}};u([Rt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Hb.prototype,"algorithm",void 0),u([f({type:at,json:{type:[cs],write:!0}})],Hb.prototype,"fromColor",void 0),u([f({type:at,json:{type:[cs],write:!0}})],Hb.prototype,"toColor",void 0),u([f({type:["algorithmic"]})],Hb.prototype,"type",void 0),Hb=dH=u([B("esri.rest.support.AlgorithmicColorRamp")],Hb);const DY=Hb;var pH;let IR=pH=class extends $Y{constructor(e){super(e),this.colorRamps=null,this.type="multipart"}clone(){return new pH({colorRamps:me(this.colorRamps)})}};u([f({type:[DY],json:{write:!0}})],IR.prototype,"colorRamps",void 0),u([f({type:["multipart"]})],IR.prototype,"type",void 0),IR=pH=u([B("esri.rest.support.MultipartColorRamp")],IR);const A_e=IR,dVe={key:"type",base:$Y,typeMap:{algorithmic:DY,multipart:A_e}};function pVe(e){return e&&e.type?e.type==="algorithmic"?DY.fromJSON(e):e.type==="multipart"?A_e.fromJSON(e):null:null}var fH;const q1=new Hi({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),HL=new Hi({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),ire=new Hi({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),rre=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],fVe=["high-to-low","above-and-below","above","below","90-10"],mVe=["flow-line","wave-front"],gVe=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let Gn=fH=class extends Fe{constructor(e){super(e),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&t!=="relationship"?t==="class-breaks-size"||t==="class-breaks-color"?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){if(e)return pVe(e)}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&e!=="relationship"&&e!=="class-breaks-size"&&e!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;e==="classed-size"?t="class-breaks-size":e==="classed-color"&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new fH({classificationMethod:this.classificationMethod,colorRamp:me(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:me(this.field1),field2:me(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};u([f({type:q1.apiValues,value:null,json:{type:q1.jsonValues,read:q1.read,write:q1.write,origins:{"web-document":{default:"manual",type:q1.jsonValues,read:q1.read,write:q1.write}}}})],Gn.prototype,"classificationMethod",null),u([f({types:dVe,json:{write:!0}})],Gn.prototype,"colorRamp",void 0),u([it("colorRamp")],Gn.prototype,"readColorRamp",null),u([f({type:[String],value:null,json:{write:!0}})],Gn.prototype,"fields",null),u([f({type:ev,value:null,json:{write:!0}})],Gn.prototype,"field1",null),u([f({type:ev,value:null,json:{write:!0}})],Gn.prototype,"field2",null),u([f({type:mVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gn.prototype,"flowTheme",null),u([f({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],Gn.prototype,"focus",null),u([f({type:Number,value:null,json:{type:cs,write:!0}})],Gn.prototype,"numClasses",null),u([f({type:rre,json:{type:rre,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],Gn.prototype,"lengthUnit",void 0),u([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gn.prototype,"maxSliderValue",void 0),u([f({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gn.prototype,"minSliderValue",void 0),u([f({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],Gn.prototype,"statistics",null),u([f({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],Gn.prototype,"standardDeviationInterval",null),u([f({type:HL.apiValues,value:null,json:{type:HL.jsonValues,read:HL.read,write:HL.write,origins:{"web-scene":{type:ire.jsonValues,write:{writer:ire.write,overridePolicy:e=>({enabled:e!=="flow"})}}}}})],Gn.prototype,"type",null),u([f({type:[hVe],json:{write:!0}})],Gn.prototype,"visualVariables",void 0),u([f({type:gVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gn.prototype,"univariateSymbolStyle",null),u([f({type:fVe,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Gn.prototype,"univariateTheme",null),Gn=fH=u([B("esri.renderers.support.AuthoringInfo")],Gn);const O_e=Gn,r6=new Hi({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let LR=class extends Fe{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};u([f({type:O_e,json:{write:!0}})],LR.prototype,"authoringInfo",void 0),u([f({type:r6.apiValues,readOnly:!0,json:{type:r6.jsonValues,read:!1,write:{writer:r6.write,ignoreOrigin:!0}}})],LR.prototype,"type",void 0),LR=u([B("esri.renderers.Renderer")],LR);const n0=LR;var mH;let hE=mH=class extends Fe{constructor(){super(...arguments),this.title=null}clone(){return new mH({title:this.title})}};u([f({type:String,json:{write:!0}})],hE.prototype,"title",void 0),hE=mH=u([B("esri.renderers.support.LegendOptions")],hE);var gH;let HN=gH=class extends hE{constructor(){super(...arguments),this.showLegend=null}clone(){return new gH({title:this.title,showLegend:this.showLegend})}};u([f({type:Boolean,json:{write:!0}})],HN.prototype,"showLegend",void 0),HN=gH=u([B("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],HN);const R_e=HN,yVe=Ie.getLogger("esri.renderers.visualVariables.VisualVariable"),s6=new Hi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let tp=class extends Fe{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(yVe.error(".field: field must be a string value"),null):U3(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};u([f()],tp.prototype,"index",void 0),u([f({type:s6.apiValues,readOnly:!0,json:{read:s6.read,write:s6.write}})],tp.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],tp.prototype,"field",void 0),u([pi("field")],tp.prototype,"castField",null),u([f({type:String,json:{write:!0}})],tp.prototype,"valueExpression",void 0),u([f({type:String,json:{write:!0}})],tp.prototype,"valueExpressionTitle",void 0),u([f({readOnly:!0})],tp.prototype,"arcadeRequired",null),u([f({type:R_e,json:{write:!0}})],tp.prototype,"legendOptions",void 0),tp=u([B("esri.renderers.visualVariables.VisualVariable")],tp);const nI=tp;var yH;let qb=yH=class extends nI{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new yH({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([f({readOnly:!0})],qb.prototype,"cache",null),u([f({type:["color"],json:{type:["colorInfo"]}})],qb.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],qb.prototype,"normalizationField",void 0),u([f({type:[L4e],json:{write:!0}})],qb.prototype,"stops",null),qb=yH=u([B("esri.renderers.visualVariables.ColorVariable")],qb);const M_e=qb;var _H;let M_=_H=class extends Fe{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return _P(t.transparency)}writeOpacity(e,t,i){t[i]=Gk(e)}clone(){return new _H({label:this.label,opacity:this.opacity,value:this.value})}};u([f({type:String,json:{write:!0}})],M_.prototype,"label",void 0),u([f({type:Number,json:{type:cs,write:{target:"transparency"}}})],M_.prototype,"opacity",void 0),u([it("opacity",["transparency"])],M_.prototype,"readOpacity",null),u([ut("opacity")],M_.prototype,"writeOpacity",null),u([f({type:Number,json:{write:!0}})],M_.prototype,"value",void 0),M_=_H=u([B("esri.renderers.visualVariables.support.OpacityStop")],M_);const _Ve=M_;var vH;let Wb=vH=class extends nI{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value),this._set("stops",e)}clone(){return new vH({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([f({readOnly:!0})],Wb.prototype,"cache",null),u([f({type:["opacity"],json:{type:["transparencyInfo"]}})],Wb.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],Wb.prototype,"normalizationField",void 0),u([f({type:[_Ve],json:{write:!0}})],Wb.prototype,"stops",null),Wb=vH=u([B("esri.renderers.visualVariables.OpacityVariable")],Wb);const P_e=Wb;var bH;let Bg=bH=class extends nI{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(e,t,i,r){if(r&&r.messages){const s=`visualVariables[${this.index}]`;r.messages.push(new se("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpressionTitle",context:r}))}}clone(){return new bH({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};u([f({readOnly:!0})],Bg.prototype,"cache",null),u([f({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],Bg.prototype,"axis",void 0),u([f({type:["rotation"],json:{type:["rotationInfo"]}})],Bg.prototype,"type",void 0),u([f({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],Bg.prototype,"rotationType",void 0),u([f({type:String,json:{write:!0}})],Bg.prototype,"valueExpressionTitle",void 0),u([ut("web-scene","valueExpressionTitle")],Bg.prototype,"writeValueExpressionTitleWebScene",null),Bg=bH=u([B("esri.renderers.visualVariables.RotationVariable")],Bg);const I_e=Bg;var wH;let t2=wH=class extends Fe{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new wH({label:this.label,size:this.size,value:this.value})}};u([f({type:String,json:{write:!0}})],t2.prototype,"label",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],t2.prototype,"size",void 0),u([f({type:Number,json:{write:!0}})],t2.prototype,"value",void 0),t2=wH=u([B("esri.renderers.visualVariables.support.SizeStop")],t2);const vVe=t2;var xH;let qN=xH=class extends R_e{constructor(){super(...arguments),this.customValues=null}clone(){return new xH({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};u([f({type:[Number],json:{write:!0}})],qN.prototype,"customValues",void 0),qN=xH=u([B("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],qN);const bVe=qN;var Ry,Mo;function N2(e){return e&&e.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function LP(e){return e!=null&&!isNaN(e)&&isFinite(e)}function L_e(e){return e.valueExpression?Ry.Expression:e.field&&typeof e.field=="string"?Ry.Field:Ry.Unknown}function wVe(e,t){const i=t||L_e(e),r=e.valueUnit||"unknown";return i===Ry.Unknown?Mo.Constant:e.stops?Mo.Stops:e.minSize!=null&&e.maxSize!=null&&e.minDataValue!=null&&e.maxDataValue!=null?Mo.ClampedLinear:r==="unknown"?e.minSize!=null&&e.minDataValue!=null?e.minSize&&e.minDataValue?Mo.Proportional:Mo.Additive:Mo.Identity:Mo.RealWorldSize}(function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"})(Ry||(Ry={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(Mo||(Mo={}));function W1t(e){}function xVe(e){return()=>e}const KE={inches:En(1,"meters","inches"),feet:En(1,"meters","feet"),"us-feet":En(1,"meters","us-feet"),yards:En(1,"meters","yards"),miles:En(1,"meters","miles"),"nautical-miles":En(1,"meters","nautical-miles"),millimeters:En(1,"meters","millimeters"),centimeters:En(1,"meters","centimeters"),decimeters:En(1,"meters","decimeters"),meters:En(1,"meters","meters"),kilometers:En(1,"meters","kilometers"),"decimal-degrees":1/RIe(1,"meters",Qi.radius)},s1=Ie.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),sre=new ul,WN=Math.PI,$_e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function D_e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(v=>v.type==="color"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void s1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const v=r.stops;return v&&v[0]&&v[0].color}if(typeof a!="number")if(h){if(N(i)||N(i.arcade))return void s1.error("Use of arcade expressions requires an arcade context");const v={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,S=b.getViewInfo(v),T=b.createExecContext(n,S);if(!p){const O=b.createSyntaxTree(r.valueExpression);p=b.createFunction(O),r.cache.compiledFunc=p}a=b.executeFunction(p,T)}else o&&(a=o[l]);const m=r.normalizationField,g=o?parseFloat(o[m]):void 0;if(a!=null&&(!m||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const v=FY(a,c);if(v){const b=v[0],S=v[1],T=b===S?r.stops[b].color:at.blendColors(r.stops[b].color,r.stops[S].color,v[2],w(i)?i.color:void 0);return new at(T)}}}function N_e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(v=>v.type==="opacity"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void s1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const s=typeof t=="number",n=s?null:t,o=n&&n.attributes;let a=s?t:null;const l=r.field,{ipData:c,hasExpression:h}=r.cache;let p=r.cache.compiledFunc;if(!l&&!h){const v=r.stops;return v&&v[0]&&v[0].opacity}if(typeof a!="number")if(h){if(N(i)||N(i.arcade))return void s1.error("Use of arcade expressions requires an arcade context");const v={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},b=i.arcade.arcadeUtils,S=b.getViewInfo(v),T=b.createExecContext(n,S);if(!p){const O=b.createSyntaxTree(r.valueExpression);p=b.createFunction(O),r.cache.compiledFunc=p}a=b.executeFunction(p,T)}else o&&(a=o[l]);const m=r.normalizationField,g=o?parseFloat(o[m]):void 0;if(a!=null&&(!m||s||!isNaN(g)&&g!==0)){isNaN(g)||s||(a/=g);const v=FY(a,c);if(v){const b=v[0],S=v[1];if(b===S)return r.stops[b].opacity;{const T=r.stops[b].opacity;return T+(r.stops[S].opacity-T)*v[2]}}}}function F_e(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(g=>g.type==="rotation"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void s1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const s=r.axis||"heading",n=s==="heading"&&r.rotationType==="arithmetic"?90:0,o=s==="heading"&&r.rotationType==="arithmetic"?-1:1,a=typeof t=="number"?null:t,l=a&&a.attributes,c=r.field,{hasExpression:h}=r.cache;let p=r.cache.compiledFunc,m=0;if(!c&&!h)return m;if(h){if(N(i)||N(i.arcade))return void s1.error("Use of arcade expressions requires an arcade context");const g={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},v=i.arcade.arcadeUtils,b=v.getViewInfo(g),S=v.createExecContext(a,b);if(!p){const T=v.createSyntaxTree(r.valueExpression);p=v.createFunction(T),r.cache.compiledFunc=p}m=v.executeFunction(p,S)}else l&&(m=l[c]||0);return m=typeof m!="number"||isNaN(m)?null:n+o*m,m}function TVe(e,t,i){const r=typeof t=="number",s=r?null:t,n=s&&s.attributes;let o=r?t:null;const{isScaleDriven:a}=e.cache;let l=e.cache.compiledFunc;if(a){const h=w(i)?i.scale:void 0,p=w(i)?i.view:void 0;o=h==null||p==="3d"?SVe(e):h}else if(!r)switch(e.inputValueType){case Ry.Expression:{if(N(i)||N(i.arcade))return void s1.error("Use of arcade expressions requires an arcade context");const h={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},p=i.arcade.arcadeUtils,m=p.getViewInfo(h),g=p.createExecContext(s,m);if(!l){const v=p.createSyntaxTree(e.valueExpression);l=p.createFunction(v),e.cache.compiledFunc=l}o=p.executeFunction(l,g);break}case Ry.Field:n&&(o=n[e.field]);break;case Ry.Unknown:o=null}if(!LP(o))return null;if(r||!e.normalizationField)return o;const c=n?parseFloat(n[e.normalizationField]):null;return LP(c)&&c!==0?o/c:null}function SVe(e){let t=null,i=null;const r=e.stops;return r?(t=r[0].value,i=r[r.length-1].value):(t=e.minDataValue||0,i=e.maxDataValue||0),(t+i)/2}function kU(e,t,i){const r="visualVariables"in e&&e.visualVariables?e.visualVariables.find(n=>n.type==="size"):e;if(!r)return;if(r.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void s1.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const s=U_e(TVe(r,t,i),r,t,i,r.cache.ipData);return s==null||isNaN(s)?0:s}function Uc(e,t,i){return e==null?null:N2(e)?kU(e,t,i):LP(e)?e:null}function k_e(e,t,i){return LP(i)&&e>i?i:LP(t)&&e<t?t:e}function EVe(e,t,i,r){return e+(Uc(t.minSize,i,r)||t.minDataValue)}function CVe(e,t,i){const r=e.stops;let s=r&&r.length&&r[0].size;return s==null&&(s=e.minSize),Uc(s,t,i)}function AVe(e,t,i,r){const s=(e-t.minDataValue)/(t.maxDataValue-t.minDataValue),n=Uc(t.minSize,i,r),o=Uc(t.maxSize,i,r),a=w(r)?r.shape:void 0;if(e<=t.minDataValue)return n;if(e>=t.maxDataValue)return o;if(t.scaleBy==="area"&&a){const l=a==="circle",c=l?WN*(n/2)**2:n*n,h=c+s*((l?WN*(o/2)**2:o*o)-c);return l?2*Math.sqrt(h/WN):Math.sqrt(h)}return n+s*(o-n)}function OVe(e,t,i,r){const s=w(r)?r.shape:void 0,n=e/t.minDataValue,o=Uc(t.minSize,i,r),a=Uc(t.maxSize,i,r);let l=null;return l=s==="circle"?2*Math.sqrt(n*(o/2)**2):s==="square"||s==="diamond"||s==="image"?Math.sqrt(n*o**2):n*o,k_e(l,o,a)}function RVe(e,t,i,r,s){const[n,o,a]=FY(e,s);if(n===o)return Uc(t.stops[n].size,i,r);{const l=Uc(t.stops[n].size,i,r);return l+(Uc(t.stops[o].size,i,r)-l)*a}}function MVe(e,t,i,r){const s=(w(r)&&r.resolution?r.resolution:1)*KE[t.valueUnit],n=Uc(t.minSize,i,r),o=Uc(t.maxSize,i,r),{valueRepresentation:a}=t;let l=null;return l=a==="area"?2*Math.sqrt(e/WN)/s:a==="radius"||a==="distance"?2*e/s:e/s,k_e(l,n,o)}function U_e(e,t,i,r,s){switch(t.transformationType){case Mo.Additive:return EVe(e,t,i,r);case Mo.Constant:return CVe(t,i,r);case Mo.ClampedLinear:return AVe(e,t,i,r);case Mo.Proportional:return OVe(e,t,i,r);case Mo.Stops:return RVe(e,t,i,r,s);case Mo.RealWorldSize:return MVe(e,t,i,r);case Mo.Identity:return e;case Mo.Unknown:return null}}function PVe(e,t,i){const{isScaleDriven:r}=e.cache;if(!(r&&i==="3d"||t))return null;const s={scale:t,view:i};let n=Uc(e.minSize,sre,s),o=Uc(e.maxSize,sre,s);if(n!=null||o!=null){if(n>o){const a=o;o=n,n=a}return{minSize:n,maxSize:o}}}function NY(e,t,i){if(!e.visualVariables)return;const r=[],s=[],n=[],o=[],a=[];for(const l of e.visualVariables)switch(l.type){case"color":s.push(l);break;case"opacity":n.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return s.forEach(l=>{const c=D_e(l,t,i);r.push({variable:l,value:c})}),n.forEach(l=>{const c=N_e(l,t,i);r.push({variable:l,value:c})}),a.forEach(l=>{const c=F_e(l,t,i);r.push({variable:l,value:c})}),o.forEach(l=>{const c=kU(l,t,i);r.push({variable:l,value:c})}),r.filter(l=>l.value!=null)}function FY(e,t){if(!t)return;let i=0,r=t.length-1;return t.some((s,n)=>e<s?(r=n,!0):(i=n,!1)),[i,r,(e-t[i])/(t[r]-t[i])]}function IVe(e,t,i){const r=["proportional","proportional","proportional"];for(const s of e){const n=s.useSymbolValue?"symbol-value":kU(s,t,i);switch(s.axis){case"width":r[0]=n;break;case"depth":r[1]=n;break;case"height":r[2]=n;break;case"width-and-depth":r[0]=n,r[1]=n;break;case"all":case void 0:case null:r[0]=n,r[1]=n,r[2]=n;break;default:s.axis}}return r}const kY=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:IVe,getColor:D_e,getOpacity:N_e,getRotationAngle:F_e,getSize:kU,getSizeForValue:U_e,getSizeFromNumberOrVariable:Uc,getSizeRangeAtScale:PVe,getVisualVariableValues:NY,viewScaleRE:$_e},Symbol.toStringTag,{value:"Module"}));var TH;const HT=Ie.getLogger("esri.renderers.visualVariables.SizeVariable"),qL=new Hi({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),SH=new Hi({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function nre(e){if(e!=null)return typeof e=="string"||typeof e=="number"?xr(e):e.type==="size"?N2(e)?e:(delete(e={...e}).type,new Er(e)):void 0}function ore(e,t,i){if(typeof e!="object")return e;const r=new Er;return r.read(e,i),r}let Er=TH=class extends nI{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:$_e.test(this.valueExpression)}}set expression(e){HT.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),e==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",e)):this._set("expression",null)}set index(e){N2(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),N2(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return L_e(this)}set maxDataValue(e){e&&this.stops&&(HT.warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(HT.warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return nre(e)}readMaxSize(e,t,i){return ore(e,t,i)}set minDataValue(e){e&&this.stops&&(HT.warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(HT.warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return nre(e)}readMinSize(e,t,i){return ore(e,t,i)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(e){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?e&&Array.isArray(e)&&(e=e.filter(t=>!!t)).sort((t,i)=>t.value-i.value):e&&(HT.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return wVe(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,r){if(e==="$view.scale"){if(r&&r.messages){const s=this.index,n=typeof s=="string"?s:`visualVariables[${s}]`;r.messages.push(new se("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpression",context:r}))}}else t[i]=e}readValueUnit(e){return e?SH.read(e):null}clone(){return new TH({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:N2(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:N2(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Mo.ClampedLinear){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if(this.transformationType===Mo.Stops){const e=this.stops,t=e.map(r=>r.size).reverse(),i=e.length;for(let r=0;r<i;r++)e[r].size=t[r];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}};u([f({readOnly:!0})],Er.prototype,"cache",null),u([f({type:qL.apiValues,json:{type:qL.jsonValues,origins:{"web-map":{read:!1}},read:qL.read,write:qL.write}})],Er.prototype,"axis",void 0),u([f({type:String,value:null,json:{read:!1}})],Er.prototype,"expression",null),u([f()],Er.prototype,"index",null),u([f({type:String,readOnly:!0})],Er.prototype,"inputValueType",null),u([f({type:bVe,json:{write:!0}})],Er.prototype,"legendOptions",void 0),u([f({type:Number,value:null,json:{write:!0}})],Er.prototype,"maxDataValue",null),u([f({type:Number,value:null,json:{write:!0}})],Er.prototype,"maxSize",null),u([pi("maxSize")],Er.prototype,"castMaxSize",null),u([it("maxSize")],Er.prototype,"readMaxSize",null),u([f({type:Number,value:null,json:{write:!0}})],Er.prototype,"minDataValue",null),u([f({type:Number,value:null,json:{write:!0}})],Er.prototype,"minSize",null),u([pi("minSize")],Er.prototype,"castMinSize",null),u([it("minSize")],Er.prototype,"readMinSize",null),u([f({type:String,json:{write:!0}})],Er.prototype,"normalizationField",void 0),u([f({readOnly:!0})],Er.prototype,"arcadeRequired",null),u([f({type:String})],Er.prototype,"scaleBy",void 0),u([f({type:[vVe],value:null,json:{write:!0}})],Er.prototype,"stops",null),u([f({type:["outline"],json:{write:!0}})],Er.prototype,"target",void 0),u([f({type:String,readOnly:!0})],Er.prototype,"transformationType",null),u([f({type:["size"],json:{type:["sizeInfo"]}})],Er.prototype,"type",void 0),u([f({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Er.prototype,"useSymbolValue",void 0),u([f({type:String,json:{write:!0}})],Er.prototype,"valueExpression",void 0),u([it("valueExpression",["valueExpression","expression"])],Er.prototype,"readValueExpression",null),u([ut("web-scene","valueExpression")],Er.prototype,"writeValueExpressionWebScene",null),u([f({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Er.prototype,"valueRepresentation",void 0),u([f({type:SH.apiValues,json:{write:SH.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],Er.prototype,"valueUnit",void 0),u([it("valueUnit")],Er.prototype,"readValueUnit",null),Er=TH=u([B("esri.renderers.visualVariables.SizeVariable")],Er);const z_e=Er,LVe=Ie.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),$Ve={color:M_e,size:z_e,opacity:P_e,rotation:I_e},DVe=new Hi({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),NVe=/^\[([^\]]+)\]$/i;let ZN=class extends ze{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(t=>!!t))&&e.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(t=>!!t.target)&&e.sort((t,i)=>{let r=null;return r=t.target===i.target?0:t.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,i){const{rotationExpression:r,rotationType:s}=t,n=r&&r.match(NVe),o=n&&n[1];if(o&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:o})),e)return e.map(a=>{const l=DVe.read(a.type),c=$Ve[l];c||(LVe.warn(`Unknown variable type: ${l}`),i&&i.messages&&i.messages.push(new Ju("visual-variable:unsupported",`visualVariable of type '${l}' is not supported`,{definition:a,context:i})));const h=new c;return h.read(a,i),h})}writeVariables(e,t){const i=[];for(const r of e){const s=r.toJSON(t);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};u([f()],ZN.prototype,"visualVariables",null),ZN=u([B("esri.renderers.visualVariables.VisualVariableFactory")],ZN);const FVe=ZN,kVe={base:nI,key:"type",typeMap:{opacity:P_e,color:M_e,rotation:I_e,size:z_e}},eA=e=>{let t=class extends e{constructor(){super(...arguments),this._vvFactory=new FVe}set visualVariables(i){this._vvFactory.visualVariables=i,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(i,r,s){return this._vvFactory.readVariables(i,r,s)}writeVisualVariables(i,r,s,n){r[s]=this._vvFactory.writeVariables(i,n)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const i of this.visualVariables)if(i.arcadeRequired)return!0;return!1}hasVisualVariables(i,r){return i?this.getVisualVariablesForType(i,r).length>0:this.getVisualVariablesForType("size",r).length>0||this.getVisualVariablesForType("color",r).length>0||this.getVisualVariablesForType("opacity",r).length>0||this.getVisualVariablesForType("rotation",r).length>0}getVisualVariablesForType(i,r){const s=this.visualVariables;return s?s.filter(n=>n.type===i&&(typeof r=="string"?n.target===r:r!==!1||!n.target)):[]}async collectVVRequiredFields(i,r){let s=[];this.visualVariables&&(s=s.concat(this.visualVariables));for(const n of s)n&&(n.field&&dd(i,r,n.field),n.normalizationField&&dd(i,r,n.normalizationField),n.valueExpression&&await Yl(i,r,n.valueExpression))}};return u([f({types:[kVe],value:null,json:{write:!0}})],t.prototype,"visualVariables",null),u([it("visualVariables",["visualVariables","rotationType","rotationExpression"])],t.prototype,"readVisualVariables",null),u([ut("visualVariables")],t.prototype,"writeVisualVariables",null),t=u([B("esri.renderers.mixins.VisualVariablesMixin")],t),t},eO={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function UVe(e,t=eO){var a,l;if(!e)return{symbol:null};const{retainId:i=eO.retainId,ignoreDrivers:r=eO.ignoreDrivers,hasLabelingContext:s=eO.hasLabelingContext,retainCIM:n=eO.retainCIM}=t;let o;if(zE(e)||e instanceof fT)o=e.clone();else if(e.type==="cim"){const c=(l=(a=e.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new se("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:e})};o=n?e.clone():wv.fromCIMSymbol(e)}else if(e instanceof Sd)o=Kk.fromSimpleLineSymbol(e);else if(e instanceof w1)o=wv.fromSimpleMarkerSymbol(e);else if(e instanceof eU)o=wv.fromPictureMarkerSymbol(e);else if(e instanceof b1)o=W3.fromSimpleFillSymbol(e);else{if(!(e instanceof GC))return{error:new se("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};o=s?Jk.fromTextSymbol(e):wv.fromTextSymbol(e)}if(i&&o.type!=="cim"&&(o.id=e.id),r&&zE(o))for(let c=0;c<o.symbolLayers.length;++c)o.symbolLayers.getItemAt(c)._ignoreDrivers=!0;return{symbol:o}}const zVe=["building-scene","integrated-mesh","point-cloud","scene"];function l5(e,t,i,r){const s=B_e(e,{},{context:r,isLabelSymbol:!1});w(s)&&(t[i]=s)}function are(e,t,i,r){const s=B_e(e,{},{context:r,isLabelSymbol:!0});w(s)&&(t[i]=s)}function lre(e){return e instanceof VC||e instanceof fT}function B_e(e,t,i){var a;if(N(e))return null;const{context:r,isLabelSymbol:s}=i,n=r==null?void 0:r.origin,o=r==null?void 0:r.messages;if(n==="web-scene"&&!lre(e)){const l=UVe(e,{retainCIM:!0,hasLabelingContext:s});return w(l.symbol)?l.symbol.write(t,r):(o==null||o.push(new se("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:r,error:l.error})),null)}return(n==="web-map"||n==="portal-item"&&!zVe.includes((a=r==null?void 0:r.layer)==null?void 0:a.type))&&lre(e)?(o==null||o.push(new se("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:r})),null):e.write(t,r)}function Z1t(e,t){return M3e(e,null,t)}const oI={types:Ffe,json:{write:{writer:l5},origins:{"web-scene":{types:Mee,write:{writer:l5},read:{reader:NC({types:Mee})}}}}},V_e={types:{base:Wc,key:"type",typeMap:{"simple-fill":ax.typeMap["simple-fill"],"picture-fill":ax.typeMap["picture-fill"],"polygon-3d":ax.typeMap["polygon-3d"]}},json:{write:{writer:l5},origins:{"web-scene":{type:W3,write:{writer:l5}}}}};var EH;let P_=EH=class extends Fe{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new EH({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};u([f({type:String,json:{write:!0}})],P_.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],P_.prototype,"label",void 0),u([f({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],P_.prototype,"minValue",void 0),u([f({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],P_.prototype,"maxValue",void 0),u([f(oI)],P_.prototype,"symbol",void 0),P_=EH=u([B("esri.renderers.support.ClassBreakInfo")],P_);const c5=P_;var CH;const WL=Ie.getLogger("esri.renderers.ClassBreaksRenderer"),G_e="log",XN="percent-of-total",YN="field",ZL=new Hi({esriNormalizeByLog:G_e,esriNormalizeByPercentOfTotal:XN,esriNormalizeByField:YN}),BVe=hn(c5);let to=CH=class extends eA(n0){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,i){if(!Array.isArray(e))return;let r=t.minValue;return e.map(s=>{const n=new c5;return n.read(s,i),n.minValue==null&&(n.minValue=r),n.maxValue==null&&(n.maxValue=n.minValue),r=n.maxValue,n})}writeClassBreakInfos(e,t,i,r){const s=e.map(n=>n.write({},r));this._areClassBreaksConsecutive()&&s.forEach(n=>delete n.classMinValue),t[i]=s}castField(e){return e==null?e:typeof e=="function"?(WL.error(".field: field must be a string value"),null):U3(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,i=this.normalizationTotal!=null;return t||i?(e=t&&YN||i&&XN||null,t&&i&&WL.warn("warning: both normalizationField and normalizationTotal are set!")):e!==YN&&e!==XN||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,i){let r=null;r=typeof e=="number"?new c5({minValue:e,maxValue:t,symbol:kfe(i)}):BVe(me(e)),this.classBreakInfos.push(r),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const i=this.classBreakInfos.length;for(let r=0;r<i;r++){const s=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(r,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(N(t)||N(t.arcade))&&WL.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let i=t;this.valueExpression&&(N(t)||N(t.arcade))&&(i={...i,arcade:await Em()});const r=this.getBreakIndex(e,i);return r!==-1?this.classBreakInfos[r]:null}getSymbol(e,t){if(this.valueExpression&&(N(t)||N(t.arcade)))return void WL.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this.getBreakIndex(e,t);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(N(t)||N(t.arcade))){const s=await Em(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this.getBreakIndex(e,i);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),i=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((r,s)=>r+s.getMeshHash(),"")}.${i}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new CH({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:me(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:me(this.visualVariables),legendOptions:me(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Yl(e,t,this.valueExpression)];dd(e,t,this.field),dd(e,t,this.normalizationField),await Promise.all(i)}_getBreakIndexForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=$t(t,{});let o=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._compiledValueExpression.compiledFunction=o}this._compiledValueExpression.valueExpression=this.valueExpression;const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._getBreakIndexfromInfos(l)}_getBreakIndexForField(e){const t=this.field,i=e.attributes,r=this.normalizationType;let s=parseFloat(i[t]);if(r){const n=this.normalizationTotal,o=parseFloat(i[this.normalizationField]);if(r===G_e)s=Math.log(s)*Math.LOG10E;else if(r!==XN||isNaN(n)){if(r===YN&&!isNaN(o)){if(isNaN(s)||isNaN(o))return-1;s/=o}}else s=s/n*100}return this._getBreakIndexfromInfos(s)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(e!=null&&typeof e=="number"&&!isNaN(e))for(let i=0;i<this.classBreakInfos.length;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]<=e&&(t?e<=r[1]:e<r[1]))return i}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let i=1;i<t;i++)if(e[i-1].maxValue!==e[i].minValue)return!1;return!0}};u([f(V_e)],to.prototype,"backgroundFillSymbol",void 0),u([f({type:[c5]})],to.prototype,"classBreakInfos",void 0),u([it("classBreakInfos")],to.prototype,"readClassBreakInfos",null),u([ut("classBreakInfos")],to.prototype,"writeClassBreakInfos",null),u([f({type:String,json:{write:!0}})],to.prototype,"defaultLabel",void 0),u([f(oI)],to.prototype,"defaultSymbol",void 0),u([f({type:String,json:{write:!0}})],to.prototype,"field",void 0),u([pi("field")],to.prototype,"castField",null),u([f({type:Boolean})],to.prototype,"isMaxInclusive",void 0),u([f({type:hE,json:{write:!0}})],to.prototype,"legendOptions",void 0),u([f({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],to.prototype,"minValue",null),u([f({type:String,json:{write:!0}})],to.prototype,"normalizationField",void 0),u([f({type:Number,cast:e=>Kh(e),json:{write:!0}})],to.prototype,"normalizationTotal",void 0),u([f({type:ZL.apiValues,value:null,json:{type:ZL.jsonValues,read:ZL.read,write:ZL.write}})],to.prototype,"normalizationType",null),u([Rt({classBreaks:"class-breaks"})],to.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],to.prototype,"valueExpression",void 0),u([f({type:String,json:{write:!0}})],to.prototype,"valueExpressionTitle",void 0),to=CH=u([B("esri.renderers.ClassBreaksRenderer")],to);const j_e=to;class VVe{constructor(t,i){this._storage=new dY,this._storage.maxSize=t,i&&this._storage.registerRemoveFunc("",i)}put(t,i,r){this._storage.put(t,i,r,1)}pop(t){return this._storage.pop(t)}get(t){return this._storage.get(t)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(t){this._storage.maxSize=t}}const cre=Ie.getLogger("esri.renderers.support.DictionaryLoader"),GVe={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class UY{constructor(t,i,r){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new VVe(100),this.url=t,this.config=i,this.fieldMap=r}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,i){let r;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(i));try{r=await this._dictionaryPromise}catch(g){if(Cs(g))return this._dictionaryPromise=null,null}const s={};if(this.fieldMap)for(const g of this._symbolFields){const v=this.fieldMap[g];if(v&&t.attributes[v]!=null){const b=""+t.attributes[v];s[g]=b}else s[g]=""}const n=r(s,i);if(!n||typeof n!="string")return null;const o=nZ(n).toString(),a=this._symbolCache.get(o);if(a)return a.catch(()=>{this._symbolCache.pop(o)}),a;const l=n.split(";"),c=[],h=[];for(const g of l)if(g)if(g.includes("po:")){const v=g.substr(3).split("|");if(v.length===3){const b=v[0],S=v[1];let T=v[2];if(S==="DashTemplate")T=T.split(" ").map(O=>Number(O));else if(S==="Color"){const O=new at(T).toRgba();T=[O[0],O[1],O[2],255*O[3]]}else T=Number(T);h.push({primitiveName:b,propertyName:S,value:T})}}else if(g.includes("|")){for(const v of g.split("|"))if(this._itemNames.has(v)){c.push(v);break}}else this._itemNames.has(g)&&c.push(g);const p=!w(t.geometry)||!t.geometry.hasZ&&t.geometry.type==="point",m=this._cimPartsToCIMSymbol(c,h,p,i);return this._symbolCache.put(o,m,1),m}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void cre.error("no valid URL!");const i=jr(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:w(t)?t.signal:null}),[{data:r}]=await Promise.all([i,Em()]);if(!r)throw this._dictionaryPromise=null,new se("esri.renderers.DictionaryRenderer","Bad dictionary data!");const s=r.expression,n=r.authoringInfo;this._refSymbolUrlTemplate=this.url+"/"+r.cimRefTemplateUrl,this._itemNames=new Set(r.itemsNames),this._symbolFields=n.symbol;const o={};if(this.config){const l=this.config;for(const c in l)o[c]=l[c]}if(n.configuration)for(const l of n.configuration)o.hasOwnProperty(l.name)||(o[l.name]=l.value);const a=[];if(w(t)&&t.fields&&this.fieldMap)for(const l of this._symbolFields){const c=this.fieldMap[l],h=t.fields.filter(p=>p.name===c);h.length>0&&a.push({...h[0],name:l})}return this._dictionaryPromise=URe(s,w(t)?t.spatialReference:null,a,o).then(l=>{const c={scale:0};return(h,p)=>{const m=l.repurposeFeature({geometry:null,attributes:h});return c.scale=w(p)?p.scale:void 0,l.evaluate({$feature:m,$view:c})}}).catch(l=>(cre.error("Creating dictinoary expression failed:",l),null)),this._dictionaryPromise}async _cimPartsToCIMSymbol(t,i,r,s){const n=new Array(t.length);for(let l=0;l<t.length;l++)n[l]=this._getSymbolPart(t[l],s);const o=await Promise.all(n),a=this.fieldMap;for(const l of o)H_e(l,a);return new UC({data:this._combineSymbolParts(o,i,r)})}async _getSymbolPart(t,i){if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(n=>n.data);const r=this._refSymbolUrlTemplate.replace(/\{itemName\}/gi,t),s=jr(r,{responseType:"json",query:{f:"json"},...i});this._ongoingRequests.set(t,s);try{return(await s).data}catch(n){throw this._ongoingRequests.delete(t),n}}_combineSymbolParts(t,i,r){if(!t||t.length===0)return null;const s={...t[0]};if(t.length>1){s.symbolLayers=[];for(const n of t){const o=n;s.symbolLayers.unshift(...o.symbolLayers)}}return r&&(s.callout=GVe),{type:"CIMSymbolReference",symbol:s,primitiveOverrides:i}}}function H_e(e,t){if(!e)return;const i=e.symbolLayers;if(!i)return;let r=i.length;for(;r--;){const s=i[r];s&&s.enable!==!1&&s.type==="CIMVectorMarker"&&jVe(s,t)}}function jVe(e,t){const i=e.markerGraphics;if(i)for(const r of i){if(!r)continue;const s=r.symbol;if(s)switch(s.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":H_e(s,t);break;case"CIMTextSymbol":s.fieldMap=t}}}const X1t=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:UY},Symbol.toStringTag,{value:"Module"}));var AH;let ip=AH=class extends eA(n0){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new UY(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,i,r){r!=null&&r.origin||super.writeVisualVariables(e,t,i,r)}clone(){return new AH({config:me(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:me(this.fieldMap),url:me(this.url),visualVariables:me(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await Yl(e,t,this.scaleExpression);for(const i in this.fieldMap){const r=this.fieldMap[i];t.has(r)&&e.add(r)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};u([f({type:UY})],ip.prototype,"_loader",null),u([f({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],ip.prototype,"config",void 0),u([f({type:Object,json:{write:!0}})],ip.prototype,"fieldMap",void 0),u([f({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],ip.prototype,"scaleExpression",void 0),u([ut("scaleExpression")],ip.prototype,"writeData",null),u([f({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],ip.prototype,"scaleExpressionTitle",void 0),u([f({type:String,json:{write:!0}})],ip.prototype,"url",void 0),u([ut("visualVariables")],ip.prototype,"writeVisualVariables",null),ip=AH=u([B("esri.renderers.DictionaryRenderer")],ip);const HVe=ip;var OH;const qVe=Ie.getLogger("esri.renderers.support.AttributeColorInfo");let Vg=OH=class extends Fe{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(qVe.error(".field: field must be a string value"),null):U3(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new OH({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([f({type:at,json:{type:[Number],write:!0}})],Vg.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],Vg.prototype,"field",void 0),u([pi("field")],Vg.prototype,"castField",null),u([f({type:String,json:{write:!0}})],Vg.prototype,"label",void 0),u([f({type:String,json:{write:!0}})],Vg.prototype,"valueExpression",void 0),u([f({type:String,json:{write:!0}})],Vg.prototype,"valueExpressionTitle",void 0),Vg=OH=u([B("esri.renderers.support.AttributeColorInfo")],Vg);const q_e=Vg;var RH;let QN=RH=class extends Fe{constructor(){super(...arguments),this.unit=null}clone(){return new RH({unit:this.unit})}};u([f({type:String,json:{write:!0}})],QN.prototype,"unit",void 0),QN=RH=u([B("esri.renderers.support.DotDensityLegendOptions")],QN);const WVe=QN;var MH;let Ba=MH=class extends eA(n0){constructor(e){super(e),this.attributes=null,this.backgroundColor=new at([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Sd,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new b1({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new MH({attributes:me(this.attributes),backgroundColor:me(this.backgroundColor),dotBlendingEnabled:me(this.dotBlendingEnabled),dotShape:me(this.dotShape),dotSize:me(this.dotSize),dotValue:me(this.dotValue),legendOptions:me(this.legendOptions),outline:me(this.outline),referenceScale:me(this.referenceScale),visualVariables:me(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Yl(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([f({type:[q_e],json:{write:!0}})],Ba.prototype,"attributes",void 0),u([f({type:at,json:{write:!0}})],Ba.prototype,"backgroundColor",void 0),u([f({type:Boolean}),Lt("dotBlendingEnabled")],Ba.prototype,"blendDots",void 0),u([f({type:Boolean,json:{write:!0}})],Ba.prototype,"dotBlendingEnabled",void 0),u([f({type:String,json:{write:!1}})],Ba.prototype,"dotShape",void 0),u([f({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],Ba.prototype,"dotSize",void 0),u([f({type:WVe,json:{write:!0}})],Ba.prototype,"legendOptions",void 0),u([f({type:Sd,json:{default:null,write:!0}})],Ba.prototype,"outline",void 0),u([f({type:Number,json:{write:!0}})],Ba.prototype,"dotValue",void 0),u([f({type:Number}),Lt("dotValue")],Ba.prototype,"referenceDotValue",void 0),u([f({type:Number,json:{write:!0}})],Ba.prototype,"referenceScale",void 0),u([f({type:Number,json:{write:!0}})],Ba.prototype,"seed",void 0),u([Rt({dotDensity:"dot-density"})],Ba.prototype,"type",void 0),Ba=MH=u([B("esri.renderers.DotDensityRenderer")],Ba);const ZVe=Ba;let i2=class extends Hc(Fe){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};u([f({type:String,json:{write:!0}})],i2.prototype,"minLabel",void 0),u([f({type:String,json:{write:!0}})],i2.prototype,"maxLabel",void 0),u([f({type:String,json:{write:!0}})],i2.prototype,"title",void 0),i2=u([B("esri.renderers.support.HeatmapLegendOptions")],i2);const zY=2.4;function XVe(e){return eh(e*zY)}function YVe(e){return No(e)/zY}function QVe(e,t,i,r){let{color:s,ratio:n}=t,{color:o,ratio:a}=i;a===n&&(a===1?n-=1e-6:a+=1e-6);const l=Xe((r-n)/(a-n),0,1);Fk(e,s.toArray(),o.toArray(),l)}function Y1t(e){const i=new Uint8ClampedArray(2048);if(e=e.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),e.length<1)return i;let r=e[0],s=e[0],n=1;const o=di();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>s.ratio&&n<e.length;)r=s,s=e[n++];QVe(o,r,s,l),i.set(o,4*a)}return i}function Q1t(e,t,i,r){const{radius:s,fieldOffset:n,field:o}=t,a=Math.round(No(s)),l=new Float64Array(i*r);let c,h=Number.NEGATIVE_INFINITY;const p=KVe(o,n),m=new Set;for(const g of e){const v=g.getCursor();for(;v.next();){const b=v.getObjectId();if(m.has(b))continue;m.add(b);const S=v.readLegacyPointGeometry(),T=128;if(S.x<-T||S.x>=i+T||S.y<-T||S.y>r+T)continue;const O=+p(v),C=Math.max(0,Math.round(S.x)-a),M=Math.max(0,Math.round(S.y)-a),I=Math.min(r,Math.round(S.y)+a),$=Math.min(i,Math.round(S.x)+a);for(let U=M;U<I;U++)for(let q=C;q<$;q++){const G=U*i+q,Y=JVe(S.x-q,S.y-U,a);c=l[G]+=Y*O,c>h&&(h=c)}}}return{matrix:l.buffer,max:h}}function JVe(e,t,i){const r=Math.sqrt(e**2+t**2)/i;return r>1?0:3/(Math.PI*i**2)*(1-r**2)**2}function J1t(e,t){return typeof e=="function"?e:e?typeof t=="string"?i=>-1*+i[e]:i=>+i[e]+t:()=>1}function KVe(e,t){return e!=null?typeof t=="string"?i=>-1*+i.readAttribute(e):i=>+i.readAttribute(e)+t:i=>1}var PH;const e6e=Ie.getLogger("esri.renderers.HeatmapRenderer");function ure(e){if(e!=null){const{maxDensity:t,minDensity:i,radius:r}=e;if(t!=null||i!=null||r!=null){const{blurRadius:s,maxPixelIntensity:n,minPixelIntensity:o,...a}=e;return a}}return e}let wo=PH=class extends n0{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new OM({ratio:0,color:new at("rgba(255, 140, 0, 0)")}),new OM({ratio:.75,color:new at("rgba(255, 140, 0, 1)")}),new OM({ratio:.9,color:new at("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(e){return ure(e)}get blurRadius(){return YVe(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,i=this.minPixelIntensity;this._set("radius",XVe(e)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",i*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(zY**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(e,t){this._warnedProps[e]||ll(this).getDefaultOrigin()==="user"&&(this._warnedProps[e]=!0,DC(()=>{jCe(e6e,e,{replacement:`${String(t)} (suggested value: ${this._get(t)})`,version:"4.24"})}))}read(e,t){e=ure(e),super.read(e,t)}getSymbol(){const e=this.referenceScale!==0?5:1,t=Math.min(this.radius*e,eh(256));return new w1({size:t})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const i=this.field,r=this.valueExpression;i&&typeof i=="string"&&await dd(e,t,i),r&&typeof r=="string"&&await Yl(e,t,r)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new PH({colorStops:me(this.colorStops),field:this.field,legendOptions:me(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};u([f({type:O_e,json:{write:!1}})],wo.prototype,"authoringInfo",void 0),u([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],wo.prototype,"blurRadius",null),u([f({type:[OM],json:{write:!0}})],wo.prototype,"colorStops",void 0),u([f({type:String,json:{write:!0}})],wo.prototype,"field",void 0),u([f({type:Number,json:{write:{overridePolicy:(e,t,i)=>({enabled:i==null})},origins:{"web-scene":{write:!1}}}})],wo.prototype,"fieldOffset",void 0),u([f({type:i2,json:{write:!0}})],wo.prototype,"legendOptions",void 0),u([f({type:Number,json:{write:!0}})],wo.prototype,"maxDensity",void 0),u([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],wo.prototype,"maxPixelIntensity",null),u([f({type:Number,json:{write:!0}})],wo.prototype,"minDensity",void 0),u([f({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],wo.prototype,"minPixelIntensity",null),u([f({type:Number,cast:xr,json:{write:!0}})],wo.prototype,"radius",void 0),u([f({type:Number,range:{min:0},json:{default:0,write:!0}})],wo.prototype,"referenceScale",void 0),u([Rt({heatmap:"heatmap"})],wo.prototype,"type",void 0),u([f({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],wo.prototype,"valueExpression",void 0),u([f({type:String})],wo.prototype,"valueExpressionTitle",void 0),u([f({readOnly:!0})],wo.prototype,"_pixelIntensityToDensity",null),wo=PH=u([B("esri.renderers.HeatmapRenderer")],wo);const W_e=wo;let Aw=class extends Hc(Fe){constructor(){super(...arguments),this.color=new at([0,0,0,0]),this.label=null,this.threshold=0}};u([f({type:at,json:{write:!0}})],Aw.prototype,"color",void 0),u([f({type:String,json:{write:!0}})],Aw.prototype,"label",void 0),u([f({type:Number,range:{min:0,max:1},json:{write:!0}})],Aw.prototype,"threshold",void 0),Aw=u([B("esri.renderers.support.OthersCategory")],Aw);let JN=class extends Hc(Fe){constructor(){super(...arguments),this.title=null}};u([f({type:String,json:{write:!0}})],JN.prototype,"title",void 0),JN=u([B("esri.renderers.support.PieChartLegendOptions")],JN);let pu=class extends eA(Hc(n0)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new at([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new Aw,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new w1({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const i of this.attributes)i.valueExpression&&await Yl(e,t,i.valueExpression),i.field&&e.add(i.field)}};u([f({type:[q_e],json:{write:!0}})],pu.prototype,"attributes",void 0),u([f({type:b1,json:{default:null,write:!0}})],pu.prototype,"backgroundFillSymbol",void 0),u([f({type:at,json:{write:!0}})],pu.prototype,"defaultColor",void 0),u([f({type:String,json:{write:!0}})],pu.prototype,"defaultLabel",void 0),u([f({type:Number,range:{min:0,max:1},json:{write:!0}})],pu.prototype,"holePercentage",void 0),u([f({type:Aw,json:{write:!0}})],pu.prototype,"othersCategory",void 0),u([f({type:JN,json:{write:!0}})],pu.prototype,"legendOptions",void 0),u([f({type:Sd,json:{default:null,write:!0}})],pu.prototype,"outline",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],pu.prototype,"size",void 0),u([Rt({pieChart:"pie-chart"})],pu.prototype,"type",void 0),pu=u([B("esri.renderers.PieChartRenderer")],pu);const t6e=pu;var IH;let Zb=IH=class extends eA(n0){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.getSymbols().map(i=>i.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new IH({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:me(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};u([f({type:String,json:{write:!0}})],Zb.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],Zb.prototype,"label",void 0),u([f(oI)],Zb.prototype,"symbol",void 0),u([Rt({simple:"simple"})],Zb.prototype,"type",void 0),Zb=IH=u([B("esri.renderers.SimpleRenderer")],Zb);const BY=Zb,i6e=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function LH(e){return e instanceof ze}function hre(e){return e instanceof zt?Object.keys(e.items):LH(e)?ll(e).keys():e?Object.keys(e):[]}function XL(e,t){return e instanceof zt?e.items[t]:e[t]}function r6e(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}function LM(e){return e?e.declaredClass:null}function Z_e(e,t){const i=e.diff;if(i&&typeof i=="function")return i(e,t);const r=hre(e),s=hre(t);if(r.length===0&&s.length===0)return;if(!r.length||!s.length||r6e(e,t))return{type:"complete",oldValue:e,newValue:t};const n=s.filter(p=>!r.includes(p)),o=r.filter(p=>!s.includes(p)),a=r.filter(p=>s.includes(p)&&XL(e,p)!==XL(t,p)).concat(n,o).sort(),l=LM(e);if(l&&i6e.includes(l)&&a.length)return{type:"complete",oldValue:e,newValue:t};let c;const h=LH(e)&&LH(t);for(const p of a){const m=XL(e,p),g=XL(t,p);let v;if((h||typeof m!="function"&&typeof g!="function")&&m!==g&&(m!=null||g!=null)){if(i&&i[p]&&typeof i[p]=="function")v=i[p](m,g);else if(m instanceof Date&&g instanceof Date){if(m.getTime()===g.getTime())continue;v={type:"complete",oldValue:m,newValue:g}}else v=typeof m=="object"&&typeof g=="object"&&LM(m)===LM(g)?Z_e(m,g):{type:"complete",oldValue:m,newValue:g};w(v)&&(w(c)?c.diff[p]=v:c={type:"partial",diff:{[p]:v}})}}return c}function s6e(e,t){if(N(e))return!1;const i=t.split(".");let r=e;for(const s of i){if(r.type==="complete")return!0;if(r.type!=="partial")return!1;{const n=r.diff[s];if(!n)return!1;r=n}}return!0}function K1t(e,t){for(const i of t)if(s6e(e,i))return!0;return!1}function n6e(e,t){if(!(typeof e=="function"||typeof t=="function"||N(e)&&N(t)))return N(e)||N(t)||typeof e=="object"&&typeof t=="object"&&LM(e)!==LM(t)?{type:"complete",oldValue:e,newValue:t}:Z_e(e,t)}function YL(e){if(N(e))return!0;switch(e.type){case"complete":return!1;case"collection":{const t=e;for(const i of t.added)if(!YL(i))return!1;for(const i of t.removed)if(!YL(i))return!1;for(const i of t.changed)if(!YL(i))return!1;return!0}case"partial":for(const t in e.diff)if(!YL(e.diff[t]))return!1;return!0}}var $H;let I_=$H=class extends Fe{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(e){return e==null||typeof e=="string"||typeof e=="number"?e:`${e}`}clone(){return new $H({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};u([f({type:String,json:{write:!0}})],I_.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],I_.prototype,"label",void 0),u([f(oI)],I_.prototype,"symbol",void 0),u([f({json:{type:String,write:{writer:(e,t)=>{t.value=e==null?void 0:e.toString()}}}})],I_.prototype,"value",void 0),u([pi("value")],I_.prototype,"castValue",null),I_=$H=u([B("esri.renderers.support.UniqueValueInfo")],I_);const u5=I_,o6e=()=>!!Ce("enable-feature:force-wosr"),ebt=()=>!!Ce("enable-feature:direct-3d-object-feature-layer-display"),n6={};async function a6e(e,t){try{return{data:(await h6e(e,t)).data,baseUrl:MPe(e),styleUrl:e}}catch(i){return e0(i),null}}function l6e(e,t,i){const r=w(t.portal)?t.portal:Ql.getDefault();let s;const n=`${r.url} - ${r.user&&r.user.username} - ${e}`;return n6[n]||(n6[n]=c6e(e,r,i).then(o=>(s=o,o.fetchData())).then(o=>({data:o,baseUrl:s.itemUrl,styleName:e}))),n6[n]}function c6e(e,t,i){return t.load(i).then(()=>{const r=new yy({disableExtraQuery:!0,query:`owner:${dre} AND type:${pre} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:r})=>{let s=null;const n=e.toLowerCase();if(r&&Array.isArray(r)){for(const o of r)if(o.typeKeywords.some(a=>a.toLowerCase()===n)&&o.type===pre&&o.owner===dre){s=o;break}}if(!s)throw new se("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(i)})}function u6e(e,t,i){return e.styleUrl?a6e(e.styleUrl,i):e.styleName?l6e(e.styleName,t,i):Promise.reject(new se("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function tbt(e){return e===null||e.type==="CIMSymbolReference"?e:{type:"CIMSymbolReference",symbol:e}}function ibt(e,t){if(t==="cimRef")return e.cimRef;if(e.formatInfos&&!o6e()){for(const i of e.formatInfos)if(i.type==="gltf")return i.href}return e.webRef}function h6e(e,t){const i={responseType:"json",query:{f:"json"},...t};return jr(Fp(e),i)}const dre="esri_en",pre="Style",rbt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";var $R;const W1=Ie.getLogger("esri.renderers.UniqueValueRenderer"),d6e=hn(u5);let Js=$R=class extends eA(n0){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(t,i){if(!t&&!i)return;if(!t||!i)return{type:"complete",oldValue:t,newValue:i};let r=!1;const s={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<i.length;n++){const o=t.find(a=>a.value===i[n].value);o?n6e(o,i[n])?(s.changed.push({type:"complete",oldValue:o,newValue:i[n]}),r=!0):s.unchanged.push({oldValue:o,newValue:i[n]}):(s.added.push(i[n]),r=!0)}for(let n=0;n<t.length;n++)i.find(o=>o.value===t[n].value)||(s.removed.push(t[n]),r=!0);return r?s:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return e==null||typeof e=="function"?e:U3(e)}writeField(e,t,i,r){typeof e=="string"?t[i]=e:r&&r.messages?r.messages.push(new se("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):W1.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,i){return i.portal||Ql.getDefault()}readStyleOrigin(e,t,i){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const r=BC(t.styleUrl,i);return Object.freeze({styleUrl:r})}}writeStyleOrigin(e,t,i,r){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=Px(e.styleUrl,r))}set uniqueValueInfos(e){this.styleOrigin?W1.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void W1.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let i;i=typeof e=="object"?d6e(e):new u5({value:e,symbol:kfe(t)}),this.uniqueValueInfos.push(i),this._valueInfoMap[i.value]=i}removeUniqueValueInfo(e){if(this.styleOrigin)W1.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let i=t;return this.valueExpression&&(N(t)||N(t.arcade))&&(i={...i,arcade:await Em()}),this._getUniqueValueInfo(e,i)}getSymbol(e,t){if(this.valueExpression&&(N(t)||N(t.arcade)))return void W1.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const i=this._getUniqueValueInfo(e,t);return i&&i.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let i=t;if(this.valueExpression&&(N(i)||N(i.arcade))){const s=await Em(),{arcadeUtils:n}=s;n.hasGeometryOperations(this.valueExpression)&&await n.enableGeometryOperations(),i={...i,arcade:s}}const r=this._getUniqueValueInfo(e,i);return r&&r.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,t)=>e+t.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const e=new $R({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:me(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:me(this.visualVariables),legendOptions:me(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:me(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=me(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(me(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const i=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(i)}async collectSymbolFields(e,t){const i=[...this.getSymbols().map(r=>r.collectRequiredFields(e,t)),Yl(e,t,this.valueExpression)];dd(e,t,this.field),dd(e,t,this.field2),dd(e,t,this.field3),await Promise.all(i)}populateFromStyle(){return u6e(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach(i=>{const r=new fT({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==e.data.defaultItem||(this.defaultSymbol=r,this._isDefaultSymbolDerived=!0);const s=new u5({value:i.name,symbol:r});t.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(e=>this._valueInfoMap[e.value+""]=e)}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:i,scale:r,spatialReference:s,arcade:n}=$t(t,{});let o=this._cache.compiledFunc;const a=n.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(e,a.getViewInfo({viewingMode:i,scale:r,spatialReference:s})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(e){const t=this.field,i=e.attributes;let r;if(typeof t!="function"&&this.field2){const s=this.field2,n=this.field3,o=[];t&&o.push(i[t]),s&&o.push(i[s]),n&&o.push(i[n]),r=o.join(this.fieldDelimiter||"")}else typeof t=="function"?r=t(e):t&&(r=i[t]);return this._valueInfoMap[r+""]}static fromPortalStyle(e,t){const i=new $R(t&&t.properties);i._set("styleOrigin",Object.freeze({styleName:e})),i._set("portal",t&&t.portal||Ql.getDefault());const r=i.populateFromStyle();return r.catch(s=>{W1.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",s)}),r}static fromStyleUrl(e,t){const i=new $R(t&&t.properties);i._set("styleOrigin",Object.freeze({styleUrl:e}));const r=i.populateFromStyle();return r.catch(s=>{W1.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",s)}),r}};u([f({readOnly:!0})],Js.prototype,"_cache",null),u([Rt({uniqueValue:"unique-value"})],Js.prototype,"type",void 0),u([f(V_e)],Js.prototype,"backgroundFillSymbol",void 0),u([f({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Js.prototype,"field",void 0),u([pi("field")],Js.prototype,"castField",null),u([ut("field")],Js.prototype,"writeField",null),u([f({type:String,json:{write:!0}})],Js.prototype,"field2",void 0),u([f({type:String,json:{write:!0}})],Js.prototype,"field3",void 0),u([f({type:String,json:{write:!0}})],Js.prototype,"valueExpression",void 0),u([f({type:String,json:{write:!0}})],Js.prototype,"valueExpressionTitle",void 0),u([f({type:hE,json:{write:!0}})],Js.prototype,"legendOptions",void 0),u([f({type:String,json:{write:!0}})],Js.prototype,"defaultLabel",void 0),u([f(Che({...oI},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Js.prototype,"defaultSymbol",null),u([f({type:String,json:{write:!0}})],Js.prototype,"fieldDelimiter",void 0),u([f({type:Ql,readOnly:!0})],Js.prototype,"portal",void 0),u([it("portal",["styleName"])],Js.prototype,"readPortal",null),u([f({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Js.prototype,"styleOrigin",void 0),u([it("styleOrigin",["styleName","styleUrl"])],Js.prototype,"readStyleOrigin",null),u([ut("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Js.prototype,"writeStyleOrigin",null),u([f({type:[u5],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Js.prototype,"uniqueValueInfos",null),Js=$R=u([B("esri.renderers.UniqueValueRenderer")],Js);const VY=Js,UU={key:"type",base:n0,typeMap:{heatmap:W_e,simple:BY,"unique-value":VY,"class-breaks":j_e,"dot-density":ZVe,dictionary:HVe,"pie-chart":t6e},errorContext:"renderer"},p6e={key:"type",base:n0,typeMap:{simple:BY,"unique-value":VY,"class-breaks":j_e,heatmap:W_e},errorContext:"renderer"},f6e=NC({types:UU});function m6e(e,t,i){return e?e&&(e.styleName||e.styleUrl)&&e.type!=="uniqueValue"?(i&&i.messages&&i.messages.push(new Ju("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):f6e(e,t,i):null}class GY{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(iG),this._values=new Map,this.multipleOriginsSupported=!0}clone(t){const i=new GY,r=this._originStores[Yi.DEFAULTS];r&&r.forEach((s,n)=>{i.set(n,me(s),Yi.DEFAULTS)});for(let s=Yi.SERVICE;s<iG;s++){const n=this._originStores[s];n&&n.forEach((o,a)=>{t&&t.has(a)||i.set(a,me(o),s)})}return i}get(t,i){const r=i===void 0?this._values:this._originStores[i];return r?r.get(t):void 0}keys(t){const i=t==null?this._values:this._originStores[t];return i?[...i.keys()]:[]}set(t,i,r=Yi.USER){let s=this._originStores[r];if(s||(s=new Map,this._originStores[r]=s),s.set(t,i),!this._values.has(t)||this._propertyOriginMap.get(t)<=r){const n=this._values.get(t);return this._values.set(t,i),this._propertyOriginMap.set(t,r),n!==i}return!1}delete(t,i=Yi.USER){const r=this._originStores[i];if(!r)return;const s=r.get(t);if(r.delete(t),this._values.has(t)&&this._propertyOriginMap.get(t)===i){this._values.delete(t);for(let n=i-1;n>=0;n--){const o=this._originStores[n];if(o&&o.has(t)){this._values.set(t,o.get(t)),this._propertyOriginMap.set(t,n);break}}}return s}has(t,i){const r=i===void 0?this._values:this._originStores[i];return!!r&&r.has(t)}revert(t,i){for(;i>0&&!this.has(t,i);)--i;const r=this._originStores[i],s=r&&r.get(t),n=this._values.get(t);return this._values.set(t,s),this._propertyOriginMap.set(t,i),n!==s}originOf(t){return this._propertyOriginMap.get(t)||Yi.DEFAULTS}forEach(t){this._values.forEach(t)}}const X_e=e=>{let t=class extends e{constructor(...i){super(...i);const r=ll(this),s=r.store,n=new GY;r.store=n,Cde(r,s,n)}read(i,r){Ode(this,i,r)}getAtOrigin(i,r){const s=o6(this),n=yv(r);if(typeof i=="string")return s.get(i,n);const o={};return i.forEach(a=>{o[a]=s.get(a,n)}),o}originOf(i){return c4(this.originIdOf(i))}originIdOf(i){return o6(this).originOf(i)}revert(i,r){const s=o6(this),n=yv(r),o=ll(this);let a;a=typeof i=="string"?i==="*"?s.keys(n):[i]:i,a.forEach(l=>{o.invalidate(l),s.revert(l,n),o.commit(l)})}};return t=u([B("esri.core.ReadOnlyMultiOriginJSONSupport")],t),t};function o6(e){return ll(e).store}let fre=class extends X_e(ze){};fre=u([B("esri.core.ReadOnlyMultiOriginJSONSupport")],fre);const g6e=e=>{let t=class extends e{constructor(...i){super(...i)}clear(i,r="user"){return a6(this).delete(i,yv(r))}write(i={},r){return Mde(this,i=i||{},r),i}setAtOrigin(i,r,s){ll(this).setAtOrigin(i,r,yv(s))}removeOrigin(i){const r=a6(this),s=yv(i),n=r.keys(s);for(const o of n)r.originOf(o)===s&&r.set(o,r.get(o,s),Yi.USER)}updateOrigin(i,r){const s=a6(this),n=yv(r),o=this.get(i);for(let a=n+1;a<iG;++a)s.delete(i,a);s.set(i,o,n)}toJSON(i){return this.write({},i)}};return t=u([B("esri.core.WriteableMultiOriginJSONSupport")],t),t.prototype.toJSON.isDefaultToJSON=!0,t};function a6(e){return ll(e).store}const Y_e=e=>{let t=class extends g6e(X_e(e)){constructor(...i){super(...i)}};return t=u([B("esri.core.MultiOriginJSONSupport")],t),t};let mre=class extends Y_e(ze){};mre=u([B("esri.core.MultiOriginJSONSupport")],mre);async function y6e(e,t){const{WhereClause:i}=await _e(()=>import("./WhereClause.d715e7d1.js"),[],import.meta.url);return i.create(e,t)}function _6e(e,t){return w(e)?w(t)?`(${e}) AND (${t})`:e:t}var DH;let Xb=DH=class extends Fe{constructor(e){super(e),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new DH({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};u([f({type:String,json:{write:!0}})],Xb.prototype,"expression",void 0),u([f({type:String,json:{write:!0}})],Xb.prototype,"name",void 0),u([f({type:["boolean","date","number","string"],json:{write:!0}})],Xb.prototype,"returnType",void 0),u([f({type:String,json:{write:!0}})],Xb.prototype,"title",void 0),Xb=DH=u([B("esri.form.ExpressionInfo")],Xb);const v6e=Xb;let Yb=class extends Fe{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};u([f({type:String,json:{write:!0}})],Yb.prototype,"description",void 0),u([f({type:String,json:{write:!0}})],Yb.prototype,"label",void 0),u([f()],Yb.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],Yb.prototype,"visibilityExpression",void 0),Yb=u([B("esri.form.elements.Element")],Yb);const eC=Yb;var NH;let KN=NH=class extends Fe{constructor(e){super(e),this.type=null}clone(){return new NH({type:this.type})}};u([f({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],KN.prototype,"type",void 0),KN=NH=u([B("esri.form.elements.inputs.AttachmentInput")],KN);const b6e=KN;var FH;let Qb=FH=class extends eC{constructor(e){super(e),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new FH({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};u([f({type:String,json:{write:!0}})],Qb.prototype,"attachmentKeyword",void 0),u([f({type:Boolean,json:{write:!0}})],Qb.prototype,"editable",void 0),u([f({type:b6e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Qb.prototype,"input",void 0),u([f({type:["attachment"],json:{read:!1,write:!0}})],Qb.prototype,"type",void 0),Qb=FH=u([B("esri.form.elements.AttachmentElement")],Qb);const gre=Qb;let eF=class extends Fe{constructor(e){super(e),this.type=null}};u([f()],eF.prototype,"type",void 0),eF=u([B("esri.form.elements.inputs.Input")],eF);const tA=eF;let DR=class extends tA{constructor(e){super(e),this.maxLength=null,this.minLength=0}};u([f({type:Number,json:{write:!0}})],DR.prototype,"maxLength",void 0),u([f({type:Number,json:{write:!0}})],DR.prototype,"minLength",void 0),DR=u([B("esri.form.elements.inputs.TextInput")],DR);const jY=DR;var kH;let tF=kH=class extends jY{constructor(e){super(e),this.type="barcode-scanner"}clone(){return new kH({maxLength:this.maxLength,minLength:this.minLength})}};u([f({type:["barcode-scanner"],json:{read:!1,write:!0}})],tF.prototype,"type",void 0),tF=kH=u([B("esri.form.elements.inputs.BarcodeScannerInput")],tF);const w6e=tF;var UH;let r2=UH=class extends tA{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new UH({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};u([f({type:String,json:{write:!0}})],r2.prototype,"noValueOptionLabel",void 0),u([f({type:Boolean,json:{write:!0}})],r2.prototype,"showNoValueOption",void 0),u([f({type:["combo-box"],json:{read:!1,write:!0}})],r2.prototype,"type",void 0),r2=UH=u([B("esri.form.elements.inputs.ComboBoxInput")],r2);const x6e=r2;var zH;function yre(e){return e!=null?new Date(e):null}function _re(e){return e?e.getTime():null}let rp=zH=class extends tA{constructor(e){super(e),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(e,t){return yre(t.max)}writeMax(e,t){t.max=_re(e)}readMin(e,t){return yre(t.min)}writeMin(e,t){t.min=_re(e)}clone(){return new zH({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};u([f({type:Boolean,json:{write:!0}})],rp.prototype,"includeTime",void 0),u([f({type:Date,json:{type:Number,write:!0}})],rp.prototype,"max",void 0),u([it("max")],rp.prototype,"readMax",null),u([ut("max")],rp.prototype,"writeMax",null),u([f({type:Date,json:{type:Number,write:!0}})],rp.prototype,"min",void 0),u([it("min")],rp.prototype,"readMin",null),u([ut("min")],rp.prototype,"writeMin",null),u([f({type:["datetime-picker"],json:{read:!1,write:!0}})],rp.prototype,"type",void 0),rp=zH=u([B("esri.form.elements.inputs.DateTimePickerInput")],rp);const T6e=rp;var BH;let s2=BH=class extends tA{constructor(e){super(e),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new BH({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};u([f({type:String,json:{write:!0}})],s2.prototype,"noValueOptionLabel",void 0),u([f({type:Boolean,json:{write:!0}})],s2.prototype,"showNoValueOption",void 0),u([f({type:["radio-buttons"],json:{read:!1,write:!0}})],s2.prototype,"type",void 0),s2=BH=u([B("esri.form.elements.inputs.RadioButtonsInput")],s2);const S6e=s2;var VH;let n2=VH=class extends tA{constructor(e){super(e),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new VH({offValue:this.offValue,onValue:this.onValue})}};u([f({type:[String,Number],json:{write:!0}})],n2.prototype,"offValue",void 0),u([f({type:[String,Number],json:{write:!0}})],n2.prototype,"onValue",void 0),u([f({type:["switch"],json:{read:!1,write:!0}})],n2.prototype,"type",void 0),n2=VH=u([B("esri.form.elements.inputs.SwitchInput")],n2);const E6e=n2;var GH;let iF=GH=class extends jY{constructor(e){super(e),this.type="text-area"}clone(){return new GH({maxLength:this.maxLength,minLength:this.minLength})}};u([f({type:["text-area"],json:{read:!1,write:!0}})],iF.prototype,"type",void 0),iF=GH=u([B("esri.form.elements.inputs.TextAreaInput")],iF);const C6e=iF;var jH;let rF=jH=class extends jY{constructor(e){super(e),this.type="text-box"}clone(){return new jH({maxLength:this.maxLength,minLength:this.minLength})}};u([f({type:["text-box"],json:{read:!1,write:!0}})],rF.prototype,"type",void 0),rF=jH=u([B("esri.form.elements.inputs.TextBoxInput")],rF);const A6e=rF,O6e={base:tA,key:"type",typeMap:{"barcode-scanner":w6e,"combo-box":x6e,"datetime-picker":T6e,"radio-buttons":S6e,switch:E6e,"text-area":C6e,"text-box":A6e}};var HH;let Dh=HH=class extends eC{constructor(e){super(e),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new HH({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};u([f({types:Yye,json:{read:{reader:pY},write:!0}})],Dh.prototype,"domain",void 0),u([f({type:Boolean,json:{write:!0}})],Dh.prototype,"editable",void 0),u([f({type:String,json:{write:!0}})],Dh.prototype,"editableExpression",void 0),u([f({type:String,json:{write:!0}})],Dh.prototype,"fieldName",void 0),u([f({type:String,json:{write:!0}})],Dh.prototype,"hint",void 0),u([f({types:O6e,json:{read:{source:"inputType"},write:{target:"inputType"}}})],Dh.prototype,"input",void 0),u([f({type:String,json:{write:!0}})],Dh.prototype,"requiredExpression",void 0),u([f({type:String,json:{read:!1,write:!0}})],Dh.prototype,"type",void 0),u([f({type:String,json:{write:!0}})],Dh.prototype,"valueExpression",void 0),Dh=HH=u([B("esri.form.elements.FieldElement")],Dh);const vre=Dh;var qH;let Gg=qH=class extends eC{constructor(e){super(e),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new qH({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:me(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};u([f({type:Number,json:{write:!0}})],Gg.prototype,"displayCount",void 0),u([f({type:["list"],json:{write:!0}})],Gg.prototype,"displayType",void 0),u([f({type:Boolean,json:{write:!0}})],Gg.prototype,"editable",void 0),u([f({type:[Cpe],json:{write:!0}})],Gg.prototype,"orderByFields",void 0),u([f({type:Number,json:{write:!0}})],Gg.prototype,"relationshipId",void 0),u([f({type:["relationship"],json:{read:!1,write:!0}})],Gg.prototype,"type",void 0),Gg=qH=u([B("esri.form.elements.RelationshipElement")],Gg);const bre=Gg;function Q_e(e){return{typesWithGroup:{base:eC,key:"type",typeMap:{attachment:gre,field:vre,group:e,relationship:bre}},typesWithoutGroup:{base:eC,key:"type",typeMap:{attachment:gre,field:vre,relationship:bre}}}}function J_e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>r[s.type].fromJSON(s))}function K_e(e,t,i=!0){if(!e)return null;const r=i?t.typesWithGroup.typeMap:t.typesWithoutGroup.typeMap;return e.filter(s=>r[s.type]).map(s=>s.toJSON())}function eve(e,t,i=!0){return e?e.map(r=>jp(i?t.typesWithGroup:t.typesWithoutGroup,r)):null}var WH;let Kf=WH=class extends eC{constructor(e){super(e),this.elements=null,this.initialState="expanded",this.type="group"}castElements(e){return eve(e,l6,!1)}readElements(e,t){return J_e(t.formElements,l6,!1)}writeElements(e,t){t.formElements=K_e(e,l6,!1)}clone(){return new WH({description:this.description,elements:me(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};u([f({json:{write:!0}})],Kf.prototype,"elements",void 0),u([pi("elements")],Kf.prototype,"castElements",null),u([it("elements",["formElements"])],Kf.prototype,"readElements",null),u([ut("elements")],Kf.prototype,"writeElements",null),u([f({type:["collapsed","expanded"],json:{write:!0}})],Kf.prototype,"initialState",void 0),u([f({type:String,json:{read:!1,write:!0}})],Kf.prototype,"type",void 0),Kf=WH=u([B("esri.form.elements.GroupElement")],Kf);const l6=Q_e(Kf),R6e=Kf;var ZH;const c6=Q_e(R6e);let kf=ZH=class extends Fe{constructor(e){super(e),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(e){return eve(e,c6)}readElements(e,t){return J_e(t.formElements,c6)}writeElements(e,t){t.formElements=K_e(e,c6)}clone(){return new ZH({description:this.description,expressionInfos:me(this.expressionInfos),elements:me(this.elements),title:this.title})}};u([f({type:String,json:{write:!0}})],kf.prototype,"description",void 0),u([f({json:{write:!0}})],kf.prototype,"elements",void 0),u([pi("elements")],kf.prototype,"castElements",null),u([it("elements",["formElements"])],kf.prototype,"readElements",null),u([ut("elements")],kf.prototype,"writeElements",null),u([f({type:[v6e],json:{write:!0}})],kf.prototype,"expressionInfos",void 0),u([f({type:String,json:{write:!0}})],kf.prototype,"title",void 0),kf=ZH=u([B("esri.form.FormTemplate")],kf);const M6e=kf,P6e=Ie.getLogger("esri.layers.support.fromPortalItem");async function I6e(e){const t="portalItem"in e?e:{portalItem:e},i=await _e(()=>import("./portalLayers.0f0eaa30.js"),["portalLayers.0f0eaa30.js","lazyLayerLoader.3b511a62.js","layersLoader.6e46b4a0.js","jsonContext.7555778f.js","portalItemUtils.eba1acfc.js"],import.meta.url);try{return await i.fromItem(t)}catch(r){const s=t&&t.portalItem,n=s&&s.id||"unset",o=s&&s.portal&&s.portal.url||sr.portalUrl;throw P6e.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+n+"')",r),r}}let L6e=0,xo=class extends ks.EventedMixin(jZ(jy)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new zi(-180,-90,180,90,wt.WGS84),this.id=Date.now().toString(16)+"-layer-"+L6e++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=wt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const t=typeof e=="string"?{url:e}:e;return(await _e(()=>import("./arcgisLayers.1ab8670d.js"),["arcgisLayers.1ab8670d.js","lazyLayerLoader.3b511a62.js"],import.meta.url)).fromUrl(t)}static fromPortalItem(e){return I6e(e)}initialize(){this.when().catch(e=>{var t,i;Cs(e)||Ie.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${(t=this.title)!=null?t:"no title"}', id: '${(i=this.id)!=null?i:"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,t=this.parent;"layers"in t&&t.layers.includes(e)?t.layers.remove(e):"tables"in t&&t.tables.includes(e)?t.tables.remove(e):"baseLayers"in t&&t.baseLayers.includes(e)?t.baseLayers.remove(e):"baseLayers"in t&&t.referenceLayers.includes(e)&&t.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){const e=this.url;return e?$a(e):null}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await jr(e,{query:{f:"json"},responseType:"json"})).data;throw new se("layer:no-attribution-data","Layer does not have attribution data")}};u([f({type:String})],xo.prototype,"attributionDataUrl",void 0),u([f({type:zi})],xo.prototype,"fullExtent",void 0),u([f({readOnly:!0})],xo.prototype,"hasAttributionData",null),u([f({type:String,clonable:!1})],xo.prototype,"id",void 0),u([f({type:Boolean,nonNullable:!0})],xo.prototype,"legendEnabled",void 0),u([f({type:["show","hide","hide-children"]})],xo.prototype,"listMode",void 0),u([f({type:Number,range:{min:0,max:1},nonNullable:!0})],xo.prototype,"opacity",void 0),u([f({clonable:!1})],xo.prototype,"parent",void 0),u([f({readOnly:!0})],xo.prototype,"parsedUrl",null),u([f({type:Boolean})],xo.prototype,"popupEnabled",void 0),u([f({type:Boolean})],xo.prototype,"attributionVisible",void 0),u([f({type:wt})],xo.prototype,"spatialReference",void 0),u([f({type:String})],xo.prototype,"title",void 0),u([f({readOnly:!0,json:{read:!1}})],xo.prototype,"type",void 0),u([f()],xo.prototype,"url",void 0),u([f({type:Boolean,nonNullable:!0})],xo.prototype,"visible",void 0),xo=u([B("esri.layers.Layer")],xo);const h5=xo;function wre(e,t,i){if(e.hasM==null||e.hasZ)for(const r of t)for(const s of r)s.length>2&&(s[2]*=i)}function $6e(e,t,i){if(!e&&!t||!i)return;const r=VE(i);xre(e,i,r),xre(t,i,r)}function xre(e,t,i){if(e)for(const r of e)D6e(r.geometry,t,i)}function D6e(e,t,i){if(N(e)||!e.spatialReference||qc(e.spatialReference,t))return;const r=VE(e.spatialReference)/i;if(r!==1){if("x"in e)e.z!=null&&(e.z*=r);else if("rings"in e)wre(e,e.rings,r);else if("paths"in e)wre(e,e.paths,r);else if("points"in e&&(e.hasM==null||e.hasZ))for(const s of e.points)s.length>2&&(s[2]*=r)}}let N6e=0;const u6=Ie.getLogger("esri.layers.graphics.sources.MemorySource");let oy=class extends jy.LoadableMixin(Qk(mT(zt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const t=w(e)?e.signal:null;return this.addResolvingPromise(this._startWorker(t)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get workerGeometryType(){var t;const e=(t=this.layer)==null?void 0:t.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,t={}){await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);jj(e,this.layer.spatialReference,i);const r=PU.fromJSON(i);if(!this._requiresClientGraphicMapping())return r;const s=this.layer.objectIdField;for(const n of r.features){const o=n.attributes[s],a=this._idToClientGraphic.get(o);a&&(n.geometry=a.geometry)}return r.geometryType=this.layer.geometryType,r}async queryFeaturesJSON(e,t={}){if(this._requiresClientGraphicMapping())throw new se("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(t);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,t);return jj(e,this.layer.spatialReference,i),i}queryFeatureCount(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,t))}queryObjectIds(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,t))}queryExtent(e,t={}){return this.load(t).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,t)).then(i=>({count:i.count,extent:zi.fromJSON(i.extent)}))}querySnapping(e,t={}){return this.load(t).then(()=>this._connection.invoke("querySnapping",e,t))}async _applyEdits(e){if(!this._connection)throw new se("feature-layer-source:edit-failure","Memory source not loaded");const t=this.layer.objectIdField;let i=null;const r=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const n=c=>"objectId"in c&&c.objectId!=null?c.objectId:"attributes"in c&&c.attributes[t]!=null?c.attributes[t]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const c of e.deleteFeatures){const h=n(c);h!=null&&r.push(h)}const o=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const c of e.updateFeatures)if(s.push(this._serializeFeature(c)),o){const h=n(c);h!=null&&o.set(h,c)}}$6e(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:a,featureEditResults:l}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:r});return this.fullExtent=a,i&&i.finish(l.uidToObjectId),this._updateClientGraphicIds(o,l),this._createEditsResult(l)}async _prepareClientMapping(e,t){if(this.layerOrSourceGeometryType!=="mesh"||N(e))return;const i=[];for(const{geometry:r}of e)!w(r)||r.type!=="mesh"||r.hasExtent||r.loaded||i.push(r.load({signal:t}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,t){if(this._idToClientGraphic){if(e)for(const i of t.updateResults){if(!i.success)continue;const r=e.get(i.objectId);r!=null&&this._addIdToClientGraphic(r)}for(const i of t.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const t=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new se("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_prepareAddFeatures(e){const t=new Map,i=new Array(e.length);let r=null;for(let n=0;n<e.length;n++){const o=e[n],a=this._serializeFeature(o);!r&&w(o.geometry)&&(r=o.geometry.type),i[n]=a,t.set(`${a.uid}`,o)}const s=this;return{features:i,inferredGeometryType:r,finish(n){const o=s.sourceJSON.objectIdField;for(const a in n){const l=n[a],c=t.get(a);c&&(c.attributes||(c.attributes={}),l===-1?delete c.attributes[o]:c.attributes[o]=l,s._addIdToClientGraphic(c))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const t=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[t];i!=null&&this._idToClientGraphic.set(i,e)}get layerOrSourceGeometryType(){var e,t,i;return(i=(e=this.layer)==null?void 0:e.geometryType)!=null?i:(t=this.sourceJSON)==null?void 0:t.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:t}=e,i=this._geometryForSerialization(e),r=(N6e++).toString();return i?{uid:r,geometry:i.toJSON(),attributes:t}:{uid:r,attributes:t}}_geometryForSerialization(e){const{geometry:t}=e;return N(t)?null:this._geometryRequiresClientGraphicMapping(t)?t.extent?Ku.fromExtent(t.extent):null:t}async _startWorker(e){this._connection=await Wfe("MemorySourceWorker",{strategy:Ce("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:t,spatialReference:i,objectIdField:r,hasM:s,hasZ:n,timeInfo:o}=this.layer,a=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const l=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{u6.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const c={features:l.features,fields:t&&t.map(m=>m.toJSON()),geometryType:uee.toJSON(this.workerGeometryType),hasM:this.layerOrSourceGeometryType!=="mesh"&&s,hasZ:this.layerOrSourceGeometryType==="mesh"||n,objectIdField:r,spatialReference:a?null:i&&i.toJSON(),timeInfo:o?o.toJSON():null},h=await this._connection.invoke("load",c,{signal:e});for(const m of h.warnings)u6.warn(m.message,{layer:this.layer,warning:m});h.featureErrors.length&&u6.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const p=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(l.inferredGeometryType)&&(p.geometryType=uee.toJSON(l.inferredGeometryType)),this.sourceJSON=p,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),l.finish(h.assignedObjectIds)}};u([kZ({Type:ul,ensureType:hn(ul)})],oy.prototype,"itemType",void 0),u([f()],oy.prototype,"type",void 0),u([f({constructOnly:!0})],oy.prototype,"layer",void 0),u([f({readOnly:!0})],oy.prototype,"workerGeometryType",null),u([f()],oy.prototype,"sourceJSON",void 0),oy=u([B("esri.layers.graphics.sources.MemorySource")],oy);function F6e(e){return"portalItem"in e}const k6e=e=>{let t=class extends e{get apiKey(){var i;return this._isOverridden("apiKey")?this._get("apiKey"):F6e(this)?(i=this.portalItem)==null?void 0:i.apiKey:null}set apiKey(i){i!=null?this._override("apiKey",i):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return u([f({type:String})],t.prototype,"apiKey",null),t=u([B("esri.layers.mixins.APIKeyMixin")],t),t},tve={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},ive=Object.values(tve),rve=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${ive.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),U6e=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${ive.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),z6e=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function sbt(e){return!!rve.test(e)}function tC(e){if(N(e))return null;const t=$a(e),i=t.path.match(rve)||t.path.match(U6e);if(!i)return null;const[,r,s,n,o]=i,a=s.indexOf("/");return{title:HY(a!==-1?s.slice(a+1):s),serverType:tve[n.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:r}}}function B6e(e){const t=$a(e).path.match(z6e);return t?{serviceUrl:t[1],sublayerId:Number(t[2])}:null}function HY(e){return(e=e.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+e.slice(1)}function V6e(e,t){const i=[];if(e){const r=tC(e);w(r)&&r.title&&i.push(r.title)}if(t){const r=HY(t);i.push(r)}if(i.length===2){if(i[0].toLowerCase().includes(i[1].toLowerCase()))return i[0];if(i[1].toLowerCase().includes(i[0].toLowerCase()))return i[1]}return i.join(" - ")}function sve(e){if(!e)return!1;const t=".arcgis.com/",i="//services",r="//tiles",s="//features",n=(e=e.toLowerCase()).includes(t),o=e.includes(i)||e.includes(r)||e.includes(s);return n&&o}function G6e(e,t){return e&&ofe(afe(e,t))}function j6e(e){let{url:t}=e;if(!t)return{url:t};t=afe(t,e.logger);const i=$a(t),r=tC(i.path);let s;if(w(r))r.sublayer!=null&&e.layer.layerId==null&&(s=r.sublayer),t=r.url.path;else if(e.nonStandardUrlAllowed){const n=B6e(i.path);w(n)&&(t=n.serviceUrl,s=n.sublayerId)}return{url:ofe(t),layerId:s}}function H6e(e,t,i,r,s){e1(t,r,"url",s),r.url&&e.layerId!=null&&(r.url=Mx(r.url,i,e.layerId.toString()))}function nbt(e){if(!e)return!1;const t=e.toLowerCase(),i=t.includes("/services/"),r=t.includes("/mapserver/wmsserver"),s=t.includes("/imageserver/wmsserver"),n=t.includes("/wmsserver");return i&&(r||s||n)}const q6e=e=>{let t=class extends e{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const i=tC(this.url);if(w(i)&&i.title)return i.title}return this._get("title")||""}set title(i){this._set("title",i)}set url(i){this._set("url",G6e(i,Ie.getLogger(this.declaredClass)))}};return u([f()],t.prototype,"title",null),u([f({type:String})],t.prototype,"url",null),t=u([B("esri.layers.mixins.ArcGISService")],t),t},Tre={read:{reader:uY},write:{allowNull:!0,writer:hY}},W6e=e=>{let t=class extends e{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return u([f({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],t.prototype,"blendMode",void 0),u([f({json:{read:!1,write:!1,origins:{"web-map":Tre,"portal-item":Tre}}})],t.prototype,"effect",void 0),t=u([B("esri.layers.mixins.BlendLayer")],t),t},Z6e=e=>{let t=class extends e{constructor(){super(...arguments),this.customParameters=null}};return u([f({type:Object,json:{write:{overridePolicy:i=>({enabled:!!(i&&Object.keys(i).length>0)})}}})],t.prototype,"customParameters",void 0),t=u([B("esri.layers.mixins.CustomParametersMixin")],t),t};var XH;const h6=new Hi({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),d6=new Hi({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Uf=XH=class extends Fe{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(e={}){const{where:t,geometry:i,spatialRelationship:r,timeExtent:s,objectIds:n,units:o,distance:a}=this;return new xp({geometry:me(i),objectIds:me(n),spatialRelationship:r,timeExtent:me(s),where:t,units:o,distance:a,...e})}clone(){const{where:e,geometry:t,spatialRelationship:i,timeExtent:r,objectIds:s,units:n,distance:o}=this;return new XH({geometry:me(t),objectIds:me(s),spatialRelationship:i,timeExtent:me(r),where:e,units:n,distance:o})}};u([f({type:String,json:{write:!0}})],Uf.prototype,"where",void 0),u([f({types:cT,json:{write:!0}})],Uf.prototype,"geometry",void 0),u([f({type:h6.apiValues,json:{name:"spatialRel",read:{reader:h6.read},write:{allowNull:!1,writer:h6.write,overridePolicy(){return{enabled:w(this.geometry)}}}}})],Uf.prototype,"spatialRelationship",void 0),u([f({type:Number,json:{write:{overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Uf.prototype,"distance",void 0),u([f({type:[Number],json:{write:!0}})],Uf.prototype,"objectIds",void 0),u([f({type:d6.apiValues,json:{read:d6.read,write:{writer:d6.write,overridePolicy(e){return{enabled:e!=null&&this.geometry!=null}}}}})],Uf.prototype,"units",void 0),u([f({type:jm,json:{write:!0}})],Uf.prototype,"timeExtent",void 0),Uf=XH=u([B("esri.layers.support.FeatureFilter")],Uf);const X6e=Uf;var YH;const Sre={read:{reader:uY},write:{writer:hY,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},Ere={read:{reader:uY},write:{writer:hY,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},Cre={name:"showExcludedLabels",default:!0};let Jb=YH=class extends Fe{constructor(e){super(e),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(e,t){var r,s;const i=super.write(e,t);if(t!=null&&t.origin){if(i.filter){const n=Object.keys(i.filter);if(n.length>1||n[0]!=="where")return(r=t.messages)==null||r.push(new se("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:t.layer,effect:this})),null}if("showExcludedLabels"in i)return(s=t.messages)==null||s.push(new se("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:t.layer,effect:this})),null}return i}clone(){return new YH({filter:w(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};u([f({type:X6e,json:{write:{allowNull:!0,writer(e,t,i,r){const s=e==null?void 0:e.write({},r);s&&Object.keys(s).length!==0?zc(i,s,t):zc(i,null,t)}}}})],Jb.prototype,"filter",void 0),u([f({json:{write:!0,origins:{"web-map":Sre,"portal-item":Sre}}})],Jb.prototype,"includedEffect",void 0),u([f({json:{write:!0,origins:{"web-map":Ere,"portal-item":Ere}}})],Jb.prototype,"excludedEffect",void 0),u([f({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Cre,"portal-item":Cre}}})],Jb.prototype,"excludedLabelsVisible",void 0),Jb=YH=u([B("esri.layers.support.FeatureEffect")],Jb);const Y6e=Jb,Are={write:{allowNull:!0}},Q6e=e=>{let t=class extends e{constructor(){super(...arguments),this.featureEffect=null}};return u([f({type:Y6e,json:{origins:{"web-map":Are,"portal-item":Are}}})],t.prototype,"featureEffect",void 0),t=u([B("esri.layers.mixins.FeatureEffectLayer")],t),t},J6e={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};function K6e(e){if(!e)return e;const{start:t,end:i}=e;return new jm({start:w(t)?px(t,-t.getTimezoneOffset(),"minutes"):t,end:w(i)?px(i,-i.getTimezoneOffset(),"minutes"):i})}function e8e(e){if(!e)return e;const{start:t,end:i}=e;return new jm({start:w(t)?px(t,t.getTimezoneOffset(),"minutes"):t,end:w(i)?px(i,i.getTimezoneOffset(),"minutes"):i})}var QH;let NR=QH=class extends Fe{async collectRequiredFields(e,t){return Yl(e,t,this.expression)}clone(){return new QH({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};u([f({type:String,json:{write:!0}})],NR.prototype,"expression",void 0),u([f({type:String,json:{write:!0}})],NR.prototype,"title",void 0),NR=QH=u([B("esri.layers.support.FeatureExpressionInfo")],NR);const Ore=NR;function t8e(e){return KE[e]!=null}function i8e(e){return 1/(KE[e]||1)}function r8e(){const e=Object.keys(KE);return e.sort(),e}const s8e=r8e();var JH;const QL=La()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Rre=new Hi({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let jg=JH=class extends Fe{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(e,t){return e!=null?e:t.featureExpression&&t.featureExpression.value===0?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,i,r){t[i]=e.write({},r),e.expression==="0"&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):w(e)||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}clone(){return new JH({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&eCe(this.featureExpressionInfo,e.featureExpressionInfo)}};u([f({type:Ore,json:{write:!0}})],jg.prototype,"featureExpressionInfo",void 0),u([it("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],jg.prototype,"readFeatureExpressionInfo",null),u([ut("featureExpressionInfo",{featureExpressionInfo:{type:Ore},"featureExpression.value":{type:[0]}})],jg.prototype,"writeFeatureExpressionInfo",null),u([f({type:QL.apiValues,nonNullable:!0,json:{type:QL.jsonValues,read:QL.read,write:{writer:QL.write,isRequired:!0}}})],jg.prototype,"mode",null),u([f({type:Number,json:{write:!0}})],jg.prototype,"offset",void 0),u([f({type:s8e,json:{type:String,read:Rre.read,write:Rre.write}})],jg.prototype,"unit",null),jg=JH=u([B("esri.layers.support.ElevationInfo")],jg);const n8e=jg,o8e={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},qY={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(e,t)=>!t.disablePopup},write:{enabled:!0,writer(e,t,i){t[i]=!e}}}},WY={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},a8e={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:e1}}},l8e={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},c8e={value:null,type:n8e,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function obt(e){return{type:e,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const sF={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},u8e={...sF,json:{...sF.json,origins:{"web-document":{...sF.json.origins["web-document"],write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(e,t,i)=>i&&i.origin!=="service"||!t.drawingInfo||t.drawingInfo.transparency===void 0?t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.transparency!==void 0?_P(t.layerDefinition.drawingInfo.transparency):void 0:_P(t.drawingInfo.transparency)}}},abt={type:jm,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:e,timeOffset:t,useViewTime:i}=this.layer,r=(l=this.view)==null?void 0:l.timeExtent;let s=this.layer.timeExtent;e&&(s=e8e(s));let n=i?r&&s?r.intersection(s):r||s:s;if(!n||n.isEmpty||n.isAllTime)return n;t&&(n=n.offset(-t.value,t.unit)),e&&(n=K6e(n));const o=this._get("timeExtent");return n.equals(o)?o:n}},lbt={type:zi,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(e,t)=>{const i=zi.fromJSON(e);return t.spatialReference!=null&&typeof t.spatialReference=="object"&&(i.spatialReference=wt.fromJSON(t.spatialReference)),i}}}},read:!1}},h8e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},d8e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},p8e={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},nve={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},f8e=e=>{let t=class extends e{constructor(){super(...arguments),this.title=null}writeListMode(i,r,s,n){(n&&n.layerContainerType==="ground"||i&&BOe(this,s,{},n))&&(r[s]=i)}writeOperationalLayerType(i,r,s,n){!i||n&&n.layerContainerType==="tables"||(r.layerType=i)}writeTitle(i,r){r.title=i||"Layer"}read(i,r){r&&(r.layer=this),FOe(this,i,s=>super.read(i,s),r)}write(i,r){var o,a;if(r!=null&&r.origin){const l=`${r.origin}/${r.layerContainerType||"operational-layers"}`,c=J6e[l];let h=c&&c[this.operationalLayerType];if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(h=!1),!h)return(o=r.messages)==null||o.push(new se("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const s=super.write(i,{...r,layer:this}),n=!!r&&!!r.messages&&!!r.messages.filter(l=>l instanceof se&&l.name==="web-document-write:property-required").length;return UE(s==null?void 0:s.url)?((a=r==null?void 0:r.messages)==null||a.push(new se("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&n?null:s}beforeSave(){}};return u([f({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],t.prototype,"id",void 0),u([f(nve)],t.prototype,"listMode",void 0),u([ut("listMode")],t.prototype,"writeListMode",null),u([f({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],t.prototype,"operationalLayerType",void 0),u([ut("operationalLayerType")],t.prototype,"writeOperationalLayerType",null),u([f(sF)],t.prototype,"opacity",void 0),u([f({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],t.prototype,"title",void 0),u([ut([void 0,"web-scene"],"title")],t.prototype,"writeTitle",null),u([f({type:Boolean,json:{name:"visibility"}})],t.prototype,"visible",void 0),t=u([B("esri.layers.mixins.OperationalLayer")],t),t};var KH;const p6=new Hi({asc:"ascending",desc:"descending"});let o2=KH=class extends Fe{constructor(e){super(e),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new KH({field:this.field,valueExpression:this.valueExpression,order:this.order})}};u([f({type:String,json:{write:!0}})],o2.prototype,"field",void 0),u([f({type:String,json:{write:!0}})],o2.prototype,"valueExpression",void 0),u([f({type:p6.apiValues,json:{read:p6.read,write:p6.write}})],o2.prototype,"order",void 0),o2=KH=u([B("esri.layers.support.OrderByInfo")],o2);const ove=o2;function m8e(e,t,i){if(!e)return null;const r=e.find(n=>!!n.field);if(!r)return null;const s=new ove;return s.read(r,i),[s]}function g8e(e,t,i,r){const s=e.find(n=>!!n.field);s&&zc(i,[s.toJSON()],t)}const y8e=e=>{let t=class extends e{constructor(){super(...arguments),this.orderBy=null}};return u([f({type:[ove],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:m8e},write:{target:"layerDefinition.orderBy",writer:g8e}}})],t.prototype,"orderBy",void 0),t=u([B("esri.layers.mixins.OrderedLayer")],t),t},_8e=Ie.getLogger("esri.portal.PortalItemResource");let L_=class extends ze{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){w(e)&&Wu(e)?_8e.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",t){const i=this.url;if(N(i))throw new se("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:Mn(t,"signal")})}async update(e,t){return(await _e(()=>import("./resourceUtils.8d9b1519.js"),[],import.meta.url)).addOrUpdateResource(this,"update",e,t)}hasPath(){return w(this.path)}_normalizePath(e,t){return N(e)?e:(e=e.replace(/^\/+/,""),w(t)&&Wu(e)&&(e=sX(e,t.itemUrl)),e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};u([f()],L_.prototype,"portalItem",void 0),u([f({type:String,value:null})],L_.prototype,"path",null),u([pi("path")],L_.prototype,"_castPath",null),u([f({type:String,readOnly:!0})],L_.prototype,"url",null),u([f({type:String,readOnly:!0})],L_.prototype,"itemRelativeUrl",null),L_=u([B("esri.portal.PortalItemResource")],L_);const v8e=L_;let FR=class extends ze{constructor(e){super(e),this.created=null,this.rating=null}};u([f()],FR.prototype,"created",void 0),u([f()],FR.prototype,"rating",void 0),FR=u([B("esri.portal.PortalRating")],FR);const f6=FR;var a2;let Ri=a2=class extends B3(jy){constructor(e){super(e),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(e){return OE(a2,e)}destroy(){this.portal=null}get displayName(){const e=this.type,t=this.typeKeywords||[];let i=e;return e==="Feature Service"||e==="Feature Collection"?i=t.includes("Table")?"Table":t.includes("Route Layer")?"Route Layer":t.includes("Markup")?"Markup":"Feature Layer":e==="Image Service"?i=t.includes("Elevation 3D Layer")?"Elevation Layer":t.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":e==="Scene Service"?i="Scene Layer":e==="Video Service"?i="Video Layer":e==="Scene Package"?i="Scene Layer Package":e==="Stream Service"?i="Feature Layer":e==="Geoprocessing Service"&&this.portal&&this.portal.isPortal?i=t.includes("Web Tool")?"Tool":"Geoprocessing Service":e==="Geocoding Service"?i="Locator":e==="Geoenrichment Service"?i="GeoEnrichment Service":e==="Microsoft Powerpoint"?i="Microsoft PowerPoint":e==="GeoJson"?i="GeoJSON":e==="Globe Service"?i="Globe Layer":e==="Vector Tile Service"?i="Tile Layer":e==="netCDF"?i="NetCDF":e==="Map Service"?i=t.includes("Spatiotemporal")||!t.includes("Hosted Service")&&!t.includes("Tiled")||t.includes("Relational")?"Map Image Layer":"Tile Layer":e&&e.toLowerCase().includes("add in")?i=e.replace(/(add in)/gi,"Add-In"):e==="datastore catalog service"?i="Big Data File Share":e==="Compact Tile Package"?i="Tile Package (tpkx)":e==="OGCFeatureServer"?i="OGC Feature Layer":e==="web mapping application"&&t.includes("configurableApp")&&(i="Instant App"),i}readExtent(e){return e&&e.length?new zi(e[0][0],e[0][1],e[1][0],e[1][1]):null}get iconUrl(){const e=this.type&&this.type.toLowerCase()||"",t=this.typeKeywords||[],i="esri/images/portal/",r="16";let s,n=!1,o=!1,a=!1,l=!1,c=!1,h=!1;return e.indexOf("service")>0||e==="feature collection"||e==="kml"||e==="wms"||e==="wmts"||e==="wfs"?(n=t.includes("Hosted Service"),e==="feature service"||e==="feature collection"||e==="kml"||e==="wfs"?(o=t.includes("Table"),a=t.includes("Route Layer"),l=t.includes("Markup"),c=t.includes("Spatiotemporal"),h=t.includes("UtilityNetwork"),s=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":n?"featureshosted":h?"utilitynetwork":"features"):s=e==="map service"||e==="wms"||e==="wmts"?n||t.includes("Tiled")||e==="wmts"?"maptiles":"mapimages":e==="scene service"?t.includes("Line")?"sceneweblayerline":t.includes("3DObject")?"sceneweblayermultipatch":t.includes("Point")?"sceneweblayerpoint":t.includes("IntegratedMesh")?"sceneweblayermesh":t.includes("PointCloud")?"sceneweblayerpointcloud":t.includes("Polygon")?"sceneweblayerpolygon":t.includes("Building")?"sceneweblayerbuilding":t.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":e==="image service"?t.includes("Elevation 3D Layer")?"elevationlayer":t.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":e==="stream service"?"streamlayer":e==="video service"?"mediaservice":e==="vector tile service"?"vectortile":e==="datastore catalog service"?"datastorecollection":e==="geocoding service"?"geocodeservice":e==="geoprocessing service"?t.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":e==="geodata service"?"geodataservice":"layers"):s=e==="web map"||e==="cityengine web scene"?"maps":e==="web scene"?t.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":e==="web mapping application"&&t.includes("configurableApp")?"instantapps":e==="web mapping application"||e==="mobile application"||e==="application"||e==="operation view"||e==="desktop application"?"apps":e==="map document"||e==="map package"||e==="published map"||e==="scene document"||e==="globe document"||e==="basemap package"||e==="mobile basemap package"||e==="mobile map package"||e==="project package"||e==="project template"||e==="pro map"||e==="layout"||e==="layer"&&t.includes("ArcGIS Pro")||e==="explorer map"&&t.indexOf("Explorer Document")?"mapsgray":e==="service definition"||e==="csv"||e==="shapefile"||e==="cad drawing"||e==="geojson"||e==="360 vr experience"||e==="netcdf"||e==="administrative report"?"datafiles":e==="explorer add in"||e==="desktop add in"||e==="windows viewer add in"||e==="windows viewer configuration"?"appsgray":e==="arcgis pro add in"||e==="arcgis pro configuration"?"addindesktop":e==="rule package"||e==="file geodatabase"||e==="sqlite geodatabase"||e==="csv collection"||e==="kml collection"||e==="windows mobile package"||e==="map template"||e==="desktop application template"||e==="gml"||e==="arcpad package"||e==="code sample"||e==="form"||e==="document link"||e==="earth configuration"||e==="operations dashboard add in"||e==="rules package"||e==="image"||e==="workflow manager package"||e==="explorer map"&&t.includes("Explorer Mapping Application")||t.includes("Document")?"datafilesgray":e==="network analysis service"||e==="geoprocessing service"||e==="geodata service"||e==="geometry service"||e==="geoprocessing package"||e==="locator package"||e==="geoprocessing sample"||e==="workflow manager service"?"toolsgray":e==="layer"||e==="layer package"||e==="explorer layer"?"layersgray":e==="scene package"?"scenepackage":e==="mobile scene package"?"mobilescenepackage":e==="tile package"||e==="compact tile package"?"tilepackage":e==="task file"?"taskfile":e==="report template"?"report-template":e==="statistical data collection"?"statisticaldatacollection":e==="insights workbook"?"workbook":e==="insights model"?"insightsmodel":e==="insights page"?"insightspage":e==="insights theme"?"insightstheme":e==="hub initiative"?"hubinitiative":e==="hubpage"?"hubpage":e==="hub event"?"hubevent":e==="hub site application"?"hubsite":e==="hub project"?"hubproject":e==="relational database connection"?"relationaldatabaseconnection":e==="big data file share"?"datastorecollection":e==="image collection"?"imagecollection":e==="style"?"style":e==="desktop style"?"desktopstyle":e==="dashboard"?"dashboard":e==="raster function template"?"rasterprocessingtemplate":e==="vector tile package"?"vectortilepackage":e==="ortho mapping project"?"orthomappingproject":e==="ortho mapping template"?"orthomappingtemplate":e==="solution"?"solutions":e==="geopackage"?"geopackage":e==="deep learning package"?"deeplearningpackage":e==="real time analytic"?"realtimeanalytics":e==="big data analytic"?"bigdataanalytics":e==="feed"?"feed":e==="excalibur imagery project"?"excaliburimageryproject":e==="notebook"?"notebook":e==="storymap"?"storymap":e==="survey123 add in"?"survey123addin":e==="mission"?"mission":e==="mission report"?"missionreport":e==="quickcapture project"?"quickcaptureproject":e==="pro report"?"proreport":e==="urban model"?"urbanmodel":e==="web experience"?"experiencebuilder":e==="web experience template"?"webexperiencetemplate":e==="experience builder widget"?"experiencebuilderwidget":e==="experience builder widget package"?"experiencebuilderwidgetpackage":e==="workflow"?"workflow":e==="insights script"?"insightsscript":e==="kernel gateway connection"?"kernelgatewayconnection":e==="hub initiative template"?"hubinitiativetemplate":e==="storymap theme"?"storymaptheme":e==="knowledge graph"?"knowledgegraph":e==="native application"?"nativeapp":e==="native application installer"?"nativeappinstaller":e==="link chart"?"linkchart":e==="investigation"?"investigation":e==="ogcfeatureserver"?"features":e==="pro project"?"proproject":e==="insights workbook package"?"insightsworkbookpackage":e==="apache parquet"?"apacheparquet":e==="notebook code snippets"?"notebookcodesnippets":e==="suitability model"?"suitabilitymodel":e==="esri classifier definition"?"classifierdefinition":e==="esri classification schema"?"classificationschema":e==="insights data engineering workbook"?"dataengineeringworkbook":e==="insights data engineering model"?"dataengineeringmodel":e==="deep learning studio project"?"deeplearningproject":"maps",s?tr(i+s+r+".png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const e=this.get("portal.restUrl");return e&&this.id?`${e}/content/items/${this.id}`:null}get thumbnailUrl(){const e=this.itemUrl,t=this.thumbnail;return e&&t?this.portal._normalizeUrl(`${e}/info/${t}?f=json`):null}get userItemUrl(){const e=this.get("portal.restUrl");if(!e)return null;const t=this.owner||this.get("portal.user.username");return t?`${e}/content/users/${this.ownerFolder?`${t}/${this.ownerFolder}`:t}/items/${this.id}`:null}load(e){this.portal||(this.portal=Ql.getDefault());const t=this.portal.load(e).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:w(e)?e.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(t),Promise.resolve(this)}addRating(e){const t={method:"post",query:{}};return e instanceof f6&&(e=e.rating),isNaN(e)||typeof e!="number"||(t.query.rating=e),this.portal._request(this.itemUrl+"/addRating",t).then(()=>new f6({rating:e,created:new Date}))}clone(){const e={access:this.access,accessInformation:this.accessInformation,applicationProxies:me(this.applicationProxies),avgRating:this.avgRating,categories:me(this.categories),created:me(this.created),culture:this.culture,description:this.description,extent:me(this.extent),groupCategories:me(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:me(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:me(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:me(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:me(this.typeKeywords),url:this.url};return this.loaded&&(e.loadStatus="loaded"),new a2({sourceJSON:this.sourceJSON}).set(e)}createPostQuery(){const e=this.toJSON();for(const i of["tags","typeKeywords","categories"])e[i]&&(e[i]=e[i].join(", "));const{extent:t}=e;return t&&(e.extent=JSON.stringify(t)),e}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(e="json",t){return this.portal._request(this.itemUrl+"/data",{responseType:e,...t,query:{token:this.apiKey}})}fetchRating(e){return this.portal._request(this.itemUrl+"/rating",{query:{token:this.apiKey},...e}).then(t=>t.rating!=null?(t.created=new Date(t.created),new f6(t)):null)}fetchRelatedItems(e,t){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...e,token:this.apiKey},...t},a2)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(e=>(this.sourceJSON=e,this.read(e),this))}update(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e&&e.data,i={method:"post"};i.query=this.createPostQuery();for(const r in i.query)i.query[r]===null&&(i.query[r]="");return i.query.clearEmptyFields=!0,t!=null&&(typeof t=="string"?i.query.text=t:typeof t=="object"&&(i.query.text=JSON.stringify(t))),this.portal._request(`${this.userItemUrl}/update`,i).then(()=>this.reload())}):Promise.reject(new se("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(e){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const t=e.thumbnail,i=e.filename,r={method:"post"};if(typeof t=="string")Bm(t)?r.query={data:t}:r.query={url:cd(t)},w(i)&&(r.query.filename=i);else{const s=new FormData;w(i)?s.append("file",t,i):s.append("file",t),r.body=s}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,r).then(()=>this.reload())}):Promise.reject(new se("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(e={},t){return(await _e(()=>import("./resourceUtils.8d9b1519.js"),[],import.meta.url)).fetchResources(this,e,t)}async addResource(e,t,i){const r=await _e(()=>import("./resourceUtils.8d9b1519.js"),[],import.meta.url);return e.portalItem=this,r.addOrUpdateResource(e,"add",t,i)}async removeResource(e,t){const i=await _e(()=>import("./resourceUtils.8d9b1519.js"),[],import.meta.url);if(e.portalItem&&e.portalItem.itemUrl!==this.itemUrl)throw new se("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return i.removeResource(this,e,t)}async removeAllResources(e){return(await _e(()=>import("./resourceUtils.8d9b1519.js"),[],import.meta.url)).removeAllResources(this,e)}resourceFromPath(e){return new v8e({portalItem:this,path:e})}toJSON(){const e=this.extent,t={accessInformation:this.accessInformation,categories:me(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:e&&[[e.xmin,e.ymin],[e.xmax,e.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:me(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:me(this.typeKeywords),url:this.url};return yhe(t)}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new a2({sourceJSON:e})}_getPostQuery(){const e=this.toJSON();for(const t in e)t==="tags"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="typeKeywords"&&e[t]!==null&&(e[t]=e[t].join(", ")),t==="extent"&&e[t]&&(e[t]=JSON.stringify(e[t]));return e}};u([f({type:["private","shared","org","public"]})],Ri.prototype,"access",void 0),u([f()],Ri.prototype,"accessInformation",void 0),u([f({type:String})],Ri.prototype,"apiKey",void 0),u([f({json:{read:{source:"appProxies"}}})],Ri.prototype,"applicationProxies",void 0),u([f()],Ri.prototype,"avgRating",void 0),u([f()],Ri.prototype,"categories",void 0),u([f({type:Date})],Ri.prototype,"created",void 0),u([f()],Ri.prototype,"culture",void 0),u([f()],Ri.prototype,"description",void 0),u([f({readOnly:!0})],Ri.prototype,"displayName",null),u([f({type:zi})],Ri.prototype,"extent",void 0),u([it("extent")],Ri.prototype,"readExtent",null),u([f()],Ri.prototype,"groupCategories",void 0),u([f({readOnly:!0})],Ri.prototype,"iconUrl",null),u([f()],Ri.prototype,"id",void 0),u([f({readOnly:!0})],Ri.prototype,"isLayer",null),u([f()],Ri.prototype,"itemControl",void 0),u([f({readOnly:!0})],Ri.prototype,"itemUrl",null),u([f()],Ri.prototype,"licenseInfo",void 0),u([f({type:Date})],Ri.prototype,"modified",void 0),u([f()],Ri.prototype,"name",void 0),u([f()],Ri.prototype,"numComments",void 0),u([f()],Ri.prototype,"numRatings",void 0),u([f()],Ri.prototype,"numViews",void 0),u([f()],Ri.prototype,"owner",void 0),u([f()],Ri.prototype,"ownerFolder",void 0),u([f({type:Ql})],Ri.prototype,"portal",void 0),u([f()],Ri.prototype,"screenshots",void 0),u([f()],Ri.prototype,"size",void 0),u([f()],Ri.prototype,"snippet",void 0),u([f()],Ri.prototype,"sourceJSON",void 0),u([f({type:String})],Ri.prototype,"spatialReference",void 0),u([f()],Ri.prototype,"tags",void 0),u([f()],Ri.prototype,"thumbnail",void 0),u([f({readOnly:!0})],Ri.prototype,"thumbnailUrl",null),u([f()],Ri.prototype,"title",void 0),u([f()],Ri.prototype,"type",void 0),u([f()],Ri.prototype,"typeKeywords",void 0),u([f({type:String,json:{read(e,t){var r;if(t.type!=="KML")return e;const i=(r=this.portal)==null?void 0:r.restUrl;return e||(e=i&&this.id?`${i}/content/items/${this.id}/data`:null),e}}})],Ri.prototype,"url",void 0),u([f({readOnly:!0})],Ri.prototype,"userItemUrl",null),Ri=a2=u([B("esri.portal.PortalItem")],Ri);const d5=Ri,ave=Object.freeze(Object.defineProperty({__proto__:null,default:d5},Symbol.toStringTag,{value:"Module"})),b8e=Ie.getLogger("esri.layers.mixins.PortalLayer"),w8e=e=>{let t=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var i;(i=this.portalItem)==null||i.destroy(),this.portalItem=null}set portalItem(i){i!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",i))}readPortalItem(i,r,s){if(r.itemId)return new d5({id:r.itemId,portal:s&&s.portal})}writePortalItem(i,r){i&&i.id&&(r.itemId=i.id)}async loadFromPortal(i,r){if(this.portalItem&&this.portalItem.id)try{const s=await _e(()=>import("./layersLoader.6e46b4a0.js").then(n=>n.l),["layersLoader.6e46b4a0.js","lazyLayerLoader.3b511a62.js","jsonContext.7555778f.js"],import.meta.url);return Ui(r),await s.load({instance:this,supportedTypes:i.supportedTypes,validateItem:i.validateItem,supportsData:i.supportsData},r)}catch(s){throw Cs(s)||b8e.warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${s}`),s}}async finishLoadEditablePortalLayer(i){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(i).catch(r=>(e0(r),!0)))}async _fetchUserHasEditingPrivileges(i){const r=this.url?cn==null?void 0:cn.findCredential(this.url):null;if(!r)return!0;const s=JL.credential===r?JL.user:await this._fetchEditingUser(i);return JL.credential=r,JL.user=s,N(s)||s.privileges==null||s.privileges.includes("features:user:edit")}async _fetchEditingUser(i){var h,p;const r=(p=(h=this.portalItem)==null?void 0:h.portal)==null?void 0:p.user;if(r)return r;const s=cn.findServerInfo(this.url);if(!(s!=null&&s.owningSystemUrl))return null;const n=`${s.owningSystemUrl}/sharing/rest`,o=Ql.getDefault();if(o&&o.loaded&&Fp(o.restUrl)===Fp(n))return o.user;const a=`${n}/community/self`,l=w(i)?i.signal:null,c=await Xp(jr(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?uX.fromJSON(c.value.data):null}read(i,r){r&&(r.layer=this),super.read(i,r)}write(i,r){const s=r&&r.portal,n=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Ql.getDefault());return s&&n&&!ife(n.restUrl,s.restUrl)?(r.messages&&r.messages.push(new se("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(i,{...r,layer:this})}};return u([f({type:d5})],t.prototype,"portalItem",null),u([it("web-document","portalItem",["itemId"])],t.prototype,"readPortalItem",null),u([ut("web-document","portalItem",{itemId:{type:String}})],t.prototype,"writePortalItem",null),u([f({clonable:!1})],t.prototype,"resourceReferences",void 0),u([f({readOnly:!0})],t.prototype,"userHasEditingPrivileges",void 0),t=u([B("esri.layers.mixins.PortalLayer")],t),t},JL={credential:null,user:null},$P=new zt,$M=new WeakMap;function x8e(e){lve(e)&&$P.push(e)}function T8e(e){lve(e)&&$P.includes(e)&&$P.remove(e)}function lve(e){return e&&typeof e=="object"&&"refreshInterval"in e&&"refresh"in e}function cve(e,t){return Number.isFinite(e)&&Number.isFinite(t)?t<=0?e:cve(t,e%t):0}let m6=0,KL=0;function S8e(){var t;const e=Date.now();for(const i of $P)i.refreshInterval&&e-((t=$M.get(i))!=null?t:0)+5>=6e4*i.refreshInterval&&($M.set(i,e),i.refresh(e))}Hhe(()=>{const e=Date.now();let t=0;for(const i of $P)t=cve(Math.round(6e4*i.refreshInterval),t),i.refreshInterval?$M.get(i)||$M.set(i,e):$M.delete(i);if(t!==KL){if(KL=t,clearInterval(m6),KL===0)return void(m6=0);m6=setInterval(S8e,KL)}});function E8e(e){return e&&typeof e=="object"&&"refreshTimestamp"in e&&"refresh"in e}const C8e=e=>{let t=class extends e{constructor(...i){super(...i),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=khe(()=>this.hasDataChanged()),this.when().then(()=>{x8e(this)},()=>{})}destroy(){T8e(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(i=Date.now()){nG(this._debounceHasDataChanged()).then(r=>{r&&this._set("refreshTimestamp",i),this.emit("refresh",{dataChanged:r})},r=>{Ie.getLogger(this.declaredClass).error(r),this.emit("refresh",{dataChanged:!1,error:r})})}async hasDataChanged(){return!0}};return u([f({type:Number,cast:i=>i>=.1?i:i<=0?0:.1,json:{write:!0}})],t.prototype,"refreshInterval",void 0),u([f({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),u([f()],t.prototype,"refreshParameters",null),t=u([B("esri.layers.mixins.RefreshableLayer")],t),t},A8e=e=>{let t=class extends e{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const i={minScale:this.minScale,maxScale:this.maxScale},r=this.parent;r&&"effectiveScaleRange"in r&&O8e(i,r.effectiveScaleRange);const s=this._get("effectiveScaleRange");return s&&s.minScale===i.minScale&&s.maxScale===i.maxScale?s:i}};return u([f({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"minScale",void 0),u([f({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"maxScale",void 0),u([f({readOnly:!0})],t.prototype,"effectiveScaleRange",null),t=u([B("esri.layers.mixins.ScaleRangeLayer")],t),t};function O8e(e,t){return e.minScale=e.minScale>0?t.minScale>0?Math.min(e.minScale,t.minScale):e.minScale:t.minScale,e.maxScale=e.maxScale>0?t.maxScale>0?Math.max(e.maxScale,t.maxScale):e.maxScale:t.maxScale,e}const qw=La()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});var eq;let kR=eq=class extends Fe{constructor(e){super(e),this.value=0,this.unit="milliseconds"}toMilliseconds(){return Ike(this.value,this.unit,"milliseconds")}clone(){return new eq({value:this.value,unit:this.unit})}};u([f({type:Number,json:{write:!0},nonNullable:!0})],kR.prototype,"value",void 0),u([f({type:qw.apiValues,json:{type:qw.jsonValues,read:qw.read,write:qw.write},nonNullable:!0})],kR.prototype,"unit",void 0),kR=eq=u([B("esri.TimeInterval")],kR);const DP=kR;var tq;let l2=tq=class extends Fe{constructor(e){super(e),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving(e,t){return t.respectsDaylightSaving!==void 0?t.respectsDaylightSaving:t.respectDaylightSaving!==void 0&&t.respectDaylightSaving}clone(){const{respectsDaylightSaving:e,timezone:t}=this;return new tq({respectsDaylightSaving:e,timezone:t})}};u([f({type:Boolean,json:{write:!0}})],l2.prototype,"respectsDaylightSaving",void 0),u([it("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],l2.prototype,"readRespectsDaylightSaving",null),u([f({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],l2.prototype,"timezone",void 0),l2=tq=u([B("esri.layers.support.TimeReference")],l2);const R8e=l2;var iq;let Va=iq=class extends Fe{constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,t){if(!t.timeExtent||!Array.isArray(t.timeExtent)||t.timeExtent.length!==2)return null;const i=new Date(t.timeExtent[0]),r=new Date(t.timeExtent[1]);return new jm({start:i,end:r})}writeFullTimeExtent(e,t){e&&w(e.start)&&w(e.end)?t.timeExtent=[e.start.getTime(),e.end.getTime()]:t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?new DP({value:t.timeInterval,unit:qw.fromJSON(t.timeIntervalUnits)}):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?new DP({value:t.defaultTimeInterval,unit:qw.fromJSON(t.defaultTimeIntervalUnits)}):null}writeInterval(e,t){if(e){const i=e.toJSON();t.timeInterval=i.value,t.timeIntervalUnits=i.unit}else t.timeInterval=null,t.timeIntervalUnits=null}clone(){const{cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:n,fullTimeExtent:o,trackIdField:a,useTime:l}=this;return new iq({cumulative:e,endField:t,hasLiveData:i,interval:r,startField:s,timeReference:me(n),fullTimeExtent:me(o),trackIdField:a,useTime:l})}};u([f({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],Va.prototype,"cumulative",void 0),u([f({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],Va.prototype,"endField",void 0),u([f({type:jm,json:{write:{enabled:!0,allowNull:!0}}})],Va.prototype,"fullTimeExtent",void 0),u([it("fullTimeExtent",["timeExtent"])],Va.prototype,"readFullTimeExtent",null),u([ut("fullTimeExtent")],Va.prototype,"writeFullTimeExtent",null),u([f({type:Boolean,json:{write:!0}})],Va.prototype,"hasLiveData",void 0),u([f({type:DP,json:{write:{enabled:!0,allowNull:!0}}})],Va.prototype,"interval",void 0),u([it("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],Va.prototype,"readInterval",null),u([ut("interval")],Va.prototype,"writeInterval",null),u([f({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],Va.prototype,"startField",void 0),u([f({type:R8e,json:{write:{enabled:!0,allowNull:!0}}})],Va.prototype,"timeReference",void 0),u([f({type:String,json:{write:{enabled:!0,allowNull:!0}}})],Va.prototype,"trackIdField",void 0),u([f({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],Va.prototype,"useTime",void 0),Va=iq=u([B("esri.layers.support.TimeInfo")],Va);const uve=Va,M8e=e=>{let t=class extends e{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(i,r){const s=r.timeInfo.exportOptions;if(!s)return null;const n=s.timeOffset,o=qw.fromJSON(s.timeOffsetUnits);return n&&o?new DP({value:n,unit:o}):null}set timeInfo(i){npe(i,this.fieldsIndex),this._set("timeInfo",i)}};return u([f({type:jm,json:{write:!1}})],t.prototype,"timeExtent",void 0),u([f({type:DP})],t.prototype,"timeOffset",void 0),u([it("service","timeOffset",["timeInfo.exportOptions"])],t.prototype,"readOffset",null),u([f({value:null,type:uve,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],t.prototype,"timeInfo",null),u([f({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"useViewTime",void 0),t=u([B("esri.layers.mixins.TemporalLayer")],t),t};var rq;let ay=rq=class extends Fe{constructor(e){super(e)}clone(){const{name:e,fields:t,isAscending:i,isUnique:r,description:s}=this;return new rq({name:e,fields:t,isAscending:i,isUnique:r,description:s})}};u([f({constructOnly:!0})],ay.prototype,"name",void 0),u([f({constructOnly:!0})],ay.prototype,"fields",void 0),u([f({constructOnly:!0})],ay.prototype,"isAscending",void 0),u([f({constructOnly:!0})],ay.prototype,"isUnique",void 0),u([f({constructOnly:!0})],ay.prototype,"description",void 0),ay=rq=u([B("esri.layers.support.FeatureIndex")],ay);let Vv=class extends Fe{constructor(){super(...arguments),this.type=null}};u([f({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],Vv.prototype,"type",void 0),Vv=u([B("esri.layers.support.FeatureReduction")],Vv);var sq;let c2=sq=class extends Fe{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new sq({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};u([f({type:String,json:{write:!0}})],c2.prototype,"statisticType",void 0),u([f({type:String,json:{write:!0}})],c2.prototype,"onStatisticField",void 0),u([f({type:String,json:{write:!0}})],c2.prototype,"onStatisticValueExpression",void 0),c2=sq=u([B("esri.layers.support.OutStatistic")],c2);const P8e=c2;var nq;let UR=nq=class extends Fe{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new nq({name:this.name,outStatistic:this.outStatistic.clone()})}};u([f({type:String,json:{write:!0}})],UR.prototype,"name",void 0),u([f({type:P8e,json:{write:!0}})],UR.prototype,"outStatistic",void 0),UR=nq=u([B("esri.layers.support.AggregateField")],UR);const hve=UR,ZY="__begin__",XY="__end__",I8e=new RegExp(ZY,"ig"),L8e=new RegExp(XY,"ig"),Mre=new RegExp("^"+ZY,"i"),Pre=new RegExp(XY+"$","i"),p5='"',$8e=p5+" + ",D8e=" + "+p5;function N8e(e){return e.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}function F8e(e){return e.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function zU(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):e.labelExpression!=null&&(t.expression=N8e(e.labelExpression),t.type="conventional"),t}function k8e(e){const t=zU(e);if(!t)return null;switch(t.type){case"conventional":return oq(t.expression);case"arcade":return t.expression}return null}function U8e(e){const t=zU(e);if(!t)return null;switch(t.type){case"conventional":return B8e(t.expression);case"arcade":return YY(t.expression)}return null}function oq(e){let t;return e?(t=Sm(e,i=>ZY+'$feature["'+i+'"]'+XY),t=Mre.test(t)?t.replace(Mre,""):p5+t,t=Pre.test(t)?t.replace(Pre,""):t+p5,t=t.replace(I8e,$8e).replace(L8e,D8e)):t='""',t}const z8e=/^\s*\{([^}]+)\}\s*$/i;function B8e(e){const t=e.match(z8e);return t&&t[1].trim()||null}const V8e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,G8e=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,j8e=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function YY(e){if(!e)return null;let t=V8e.exec(e)||G8e.exec(e);return t?t[1]||t[3]:(t=j8e.exec(e),t?t[2]:null)}var aq;let $_=aq=class extends Fe{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(e,t){return t.value?oq(t.value):e}writeExpression(e,t,i){this.value!=null&&(e=oq(this.value)),e!=null&&(t[i]=e)}clone(){return new aq({expression:this.expression,title:this.title,value:this.value})}};u([f({type:String,json:{write:{writerEnsuresNonNull:!0}}})],$_.prototype,"expression",void 0),u([it("expression",["expression","value"])],$_.prototype,"readExpression",null),u([ut("expression")],$_.prototype,"writeExpression",null),u([f({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],$_.prototype,"title",void 0),u([f({json:{read:!1,write:!1}})],$_.prototype,"value",void 0),$_=aq=u([B("esri.layers.support.LabelExpressionInfo")],$_);const dve=$_,pve=[252,146,31,255],cbt=[153,153,153,255],H8e={type:"esriSMS",style:"esriSMSCircle",size:6,color:pve,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},q8e={type:"esriSLS",style:"esriSLSSolid",width:.75,color:pve},W8e={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},Z8e={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},X8e={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},Y8e={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Q8e={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},ubt=w1.fromJSON(H8e),hbt=Sd.fromJSON(q8e),dbt=b1.fromJSON(W8e),J8e=GC.fromJSON(Z8e);w1.fromJSON(X8e);Sd.fromJSON(Y8e);b1.fromJSON(Q8e);var lq;const e$=new Hi({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function fve(e){var t;return!e||e.origin!=="service"&&((t=e.layer)==null?void 0:t.type)!=="map-image"}function K8e(e){return(e==null?void 0:e.type)==="map-image"}function mve(e){var t,i;return!!K8e(e)&&!!((i=(t=e.capabilities)==null?void 0:t.exportMap)!=null&&i.supportsArcadeExpressionForLabeling)}function e9e(e){return fve(e)||mve(e.layer)}let bn=lq=class extends Fe{constructor(e){super(e),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=J8e,this.useCodedValues=void 0,this.where=null}static evaluateWhere(e,t){const i=(r,s,n)=>{switch(s){case"=":return r==n;case"<>":return r!=n;case">":return r>n;case">=":return r>=n;case"<":return r<n;case"<=":return r<=n}return!1};try{if(e==null)return!0;const r=e.split(" ");if(r.length===3)return i(t[r[0]],r[1],r[2]);if(r.length===7){const s=i(t[r[0]],r[1],r[2]),n=r[3],o=i(t[r[4]],r[5],r[6]);switch(n){case"AND":return s&&o;case"OR":return s||o}}return!1}catch{console.log("Error.: can't parse = "+e)}}readLabelExpression(e,t){const i=t.labelExpressionInfo;if(!i||!i.value&&!i.expression)return e}writeLabelExpression(e,t,i){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)e=F8e(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const r=YY(this.labelExpressionInfo.expression);r&&(e="["+r+"]")}}e!=null&&(t[i]=e)}writeLabelExpressionInfo(e,t,i,r){if(e==null&&this.labelExpression!=null&&fve(r))e=new dve({expression:this.getLabelExpressionArcade()});else if(!e)return;const s=e.toJSON(r);s.expression&&(t[i]=s)}writeMaxScale(e,t){(e||this.minScale)&&(t.maxScale=e)}writeMinScale(e,t){(e||this.maxScale)&&(t.minScale=e)}getLabelExpression(){return zU(this)}getLabelExpressionArcade(){return k8e(this)}getLabelExpressionSingleField(){return U8e(this)}hash(){return JSON.stringify(this)}clone(){return new lq({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:me(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:me(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};u([f({type:String,json:{write:!0}})],bn.prototype,"name",void 0),u([f({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],bn.prototype,"allowOverrun",void 0),u([f({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],bn.prototype,"deconflictionStrategy",void 0),u([f({type:String,json:{write:{overridePolicy(e,t,i){return this.labelExpressionInfo&&(i==null?void 0:i.origin)==="service"&&mve(i.layer)?{enabled:!1}:{allowNull:!0}}}}})],bn.prototype,"labelExpression",void 0),u([it("labelExpression")],bn.prototype,"readLabelExpression",null),u([ut("labelExpression")],bn.prototype,"writeLabelExpression",null),u([f({type:dve,json:{write:{overridePolicy:(e,t,i)=>e9e(i)?{allowNull:!0}:{enabled:!1}}}})],bn.prototype,"labelExpressionInfo",void 0),u([ut("labelExpressionInfo")],bn.prototype,"writeLabelExpressionInfo",null),u([f({type:e$.apiValues,json:{type:e$.jsonValues,read:e$.read,write:e$.write}})],bn.prototype,"labelPlacement",void 0),u([f({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],bn.prototype,"labelPosition",void 0),u([f({type:Number})],bn.prototype,"maxScale",void 0),u([ut("maxScale")],bn.prototype,"writeMaxScale",null),u([f({type:Number})],bn.prototype,"minScale",void 0),u([ut("minScale")],bn.prototype,"writeMinScale",null),u([f({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],bn.prototype,"repeatLabel",void 0),u([f({type:Number,cast:xr,json:{write:!0,origins:{"web-scene":{write:!1}}}})],bn.prototype,"repeatLabelDistance",void 0),u([f({types:P3e,json:{origins:{"web-scene":{types:I3e,write:are,default:null}},write:are,default:null}})],bn.prototype,"symbol",void 0),u([f({type:Boolean,json:{write:!0}})],bn.prototype,"useCodedValues",void 0),u([f({type:String,json:{write:!0}})],bn.prototype,"where",void 0),bn=lq=u([B("esri.layers.support.LabelClass")],bn);const BU=bn;var cq;let sp=cq=class extends Vv{constructor(e){super(e),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new cq({fields:me(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:me(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:me(this.popupTemplate),renderer:me(this.renderer)})}};u([Rt({binning:"binning"})],sp.prototype,"type",void 0),u([f({type:Number,json:{write:!0}})],sp.prototype,"fixedBinLevel",void 0),u([f({type:[BU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],sp.prototype,"labelingInfo",void 0),u([f(WY)],sp.prototype,"labelsVisible",void 0),u([f(qY)],sp.prototype,"popupEnabled",void 0),u([f({type:j3,json:{name:"popupInfo",write:!0}})],sp.prototype,"popupTemplate",void 0),u([f({type:[hve],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],sp.prototype,"fields",void 0),u([f({types:UU,json:{write:!0}})],sp.prototype,"renderer",void 0),sp=cq=u([B("esri.layers.support.FeatureReductionBinning")],sp);const t9e=sp;var uq;let gc=uq=class extends Fe{constructor(e){super(e),this.type="cluster",this.clusterRadius=xr("80px"),this.clusterMinSize=xr("12px"),this.clusterMaxSize=xr("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new uq({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:me(this.labelingInfo),labelsVisible:this.labelsVisible,fields:me(this.fields),renderer:me(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:me(this.popupTemplate)})}};u([f({type:["cluster"],readOnly:!0,json:{write:!0}})],gc.prototype,"type",void 0),u([f({type:Number,cast:e=>e==="auto"?e:xr(e),json:{write:!0}})],gc.prototype,"clusterRadius",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],gc.prototype,"clusterMinSize",void 0),u([f({type:Number,cast:xr,json:{write:!0}})],gc.prototype,"clusterMaxSize",void 0),u([f(qY)],gc.prototype,"popupEnabled",void 0),u([f({type:j3,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],gc.prototype,"popupTemplate",void 0),u([f({types:UU,json:{write:!0}})],gc.prototype,"renderer",void 0),u([f({types:R3e})],gc.prototype,"symbol",void 0),u([f({type:[BU],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],gc.prototype,"labelingInfo",void 0),u([f(WY)],gc.prototype,"labelsVisible",void 0),u([f({type:[hve],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],gc.prototype,"fields",void 0),gc=uq=u([B("esri.layers.support.FeatureReductionCluster")],gc);const gve=gc;var hq;let nF=hq=class extends Vv{constructor(e){super(e),this.type="selection"}clone(){return new hq}};u([f({type:["selection"]})],nF.prototype,"type",void 0),nF=hq=u([B("esri.layers.support.FeatureReductionSelection")],nF);const Ire=nF,Lre={key:"type",base:Vv,typeMap:{selection:gve}},i9e={types:{key:"type",base:Vv,typeMap:{selection:Ire,cluster:gve,binning:t9e}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:Lre},"portal-item":{types:Lre},"web-scene":{types:{key:"type",base:Vv,typeMap:{selection:Ire}}}}}},$re=new Hi({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let D_=class extends Hc(Fe){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};u([f({json:{write:!0}})],D_.prototype,"name",void 0),u([f({json:{write:!0}})],D_.prototype,"description",void 0),u([f({json:{read:$re.read,write:$re.write}})],D_.prototype,"drawingTool",void 0),u([f({json:{write:!0}})],D_.prototype,"prototype",void 0),u([f({json:{write:!0}})],D_.prototype,"thumbnail",void 0),D_=u([B("esri.layers.support.FeatureTemplate")],D_);const QY=D_;let Hg=class extends Hc(Fe){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const t={};for(const i of Object.keys(e))t[i]=pY(e[i]);return t}writeDomains(e,t){var r;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(r=e[s])==null?void 0:r.toJSON());t.domains=i}};u([f({json:{write:!0}})],Hg.prototype,"id",void 0),u([f({json:{write:!0}})],Hg.prototype,"name",void 0),u([f({json:{write:!0}})],Hg.prototype,"domains",void 0),u([it("domains")],Hg.prototype,"readDomains",null),u([ut("domains")],Hg.prototype,"writeDomains",null),u([f({type:[QY],json:{write:!0}})],Hg.prototype,"templates",void 0),Hg=u([B("esri.layers.support.FeatureType")],Hg);const yve=Hg;function r9e(e){return e.type==="date"||e.type==="esriFieldTypeDate"}function Dre(e){return e.type==="oid"||e.type==="esriFieldTypeOID"}function Nre(e){return e.type==="global-id"||e.type==="esriFieldTypeGlobalID"}class s9e{constructor(t){if(this.fields=t,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!t)return;const i=[];for(const r of t){const s=r&&r.name;if(s){const n=Fre(s);this._fieldsMap.set(s,r),this._fieldsMap.set(n,r),i.push(n),r9e(r)?(this.dateFields.push(r),this._dateFieldsSet.add(r)):kk(r)&&(this._numericFieldsSet.add(r),this.numericFields.push(r)),Dre(r)||Nre(r)||(r.editable=r.editable==null||!!r.editable,r.nullable=r.nullable==null||!!r.nullable)}}i.sort(),this.uid=i.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const t of this.fields)Dre(t)||Nre(t)||t.nullable||WRe(t)!==void 0||this._requiredFields.push(t)}return this._requiredFields}has(t){return this.get(t)!=null}get(t){return t!=null?this._fieldsMap.get(t)||this._fieldsMap.get(Fre(t)):void 0}isDateField(t){return this._dateFieldsSet.has(this.get(t))}isNumericField(t){return this._numericFieldsSet.has(this.get(t))}normalizeFieldName(t){const i=this.get(t);if(i)return i.name}}function Fre(e){return e.toLowerCase().trim()}const n9e=Ie.getLogger("esri.layers.support.fieldProperties");function o9e(){return{fields:{type:[K3],value:null},fieldsIndex:{readOnly:!0,get(){return new s9e(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e||!e.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e)this.fieldsIndex.has(t)||n9e.error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e});return ope(this.fieldsIndex,e)}}}}let u2=class extends Hc(Fe){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};u([f({type:String,json:{read:{source:"shapeAreaFieldName"}}})],u2.prototype,"shapeAreaField",void 0),u([f({type:String,json:{read:{source:"shapeLengthFieldName"}}})],u2.prototype,"shapeLengthField",void 0),u([f({type:String,json:{read:e=>DIe.read(e)||NIe.read(e)}})],u2.prototype,"units",void 0),u2=u([B("esri.layers.support.GeometryFieldsInfo")],u2);const a9e=u2,l9e=/\[([^\[\]]+)\]/gi;function kre(e,t,i){return e?e.map(r=>{const s=new BU;if(s.read(r,i),s.labelExpression){const n=t.fields||t.layerDefinition&&t.layerDefinition.fields||this.fields;s.labelExpression=s.labelExpression.replace(l9e,(o,a)=>`[${c9e(a,n)}]`)}return s}):null}function c9e(e,t){if(!t)return e;const i=e.toLowerCase();for(let r=0;r<t.length;r++){const s=t[r].name;if(s.toLowerCase()===i)return s}return e}var dq;let h2=dq=class extends Fe{constructor(e){super(e),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new zt}clone(){return new dq({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};u([f({type:String,json:{write:!0}})],h2.prototype,"floorField",void 0),u([f({json:{read:!1,write:!1}})],h2.prototype,"viewAllMode",void 0),u([f({json:{read:!1,write:!1}})],h2.prototype,"viewAllLevelIds",void 0),h2=dq=u([B("esri.layers.support.LayerFloorInfo")],h2);const u9e=h2,Ure=new Hi({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),zre=new Hi({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Nh=class extends Hc(Fe){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};u([f({json:{read:Ure.read,write:Ure.write}})],Nh.prototype,"cardinality",void 0),u([f({json:{read:!0,write:!0}})],Nh.prototype,"composite",void 0),u([f({json:{read:!0,write:!0}})],Nh.prototype,"id",void 0),u([f({json:{read:!0,write:!0}})],Nh.prototype,"keyField",void 0),u([f({json:{read:!0,write:!0}})],Nh.prototype,"keyFieldInRelationshipTable",void 0),u([f({json:{read:!0,write:!0}})],Nh.prototype,"name",void 0),u([f({json:{read:!0,write:!0}})],Nh.prototype,"relatedTableId",void 0),u([f({json:{read:!0,write:!0}})],Nh.prototype,"relationshipTableId",void 0),u([f({json:{read:zre.read,write:zre.write}})],Nh.prototype,"role",void 0),Nh=u([B("esri.layers.support.Relationship")],Nh);const h9e=Nh,np=[];function d9e(e,t){if(sve(e.url))return!0;const{wkid:i}=t;for(const r of np){if(e.version>=r[0])return!0;if(typeof r[1]=="function"&&(r[1]=r[1]()),r[1].has(i))return!1}return!0}np.push([10.91,()=>{const e=new Set([9709,9716,9741,9761,9766]);for(let t=9712;t<=9713;t++)e.add(t);for(let t=9748;t<=9749;t++)e.add(t);for(let t=20904;t<=20932;t++)e.add(t);for(let t=21004;t<=21032;t++)e.add(t);for(let t=21207;t<=21264;t++)e.add(t);for(let t=21307;t<=21364;t++)e.add(t);for(let t=102759;t<=102760;t++)e.add(t);for(let t=102901;t<=102955;t++)e.add(t);return e}]),np.push([10.9,()=>{const e=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let t=9356;t<=9360;t++)e.add(t);for(let t=9404;t<=9407;t++)e.add(t);for(let t=9476;t<=9482;t++)e.add(t);for(let t=9487;t<=9494;t++)e.add(t);for(let t=9697;t<=9699;t++)e.add(t);return e}]),np.push([10.81,()=>{const e=new Set([9265,9333,103598,103699]);for(let t=9248;t<=9254;t++)e.add(t);for(let t=9271;t<=9273;t++)e.add(t);for(let t=9284;t<=9285;t++)e.add(t);for(let t=21453;t<=21463;t++)e.add(t);return e}]),np.push([10.8,()=>{const e=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let t=8035;t<=8036;t++)e.add(t);for(let t=8455;t<=8456;t++)e.add(t);for(let t=8518;t<=8529;t++)e.add(t);for(let t=8533;t<=8536;t++)e.add(t);for(let t=8538;t<=8540;t++)e.add(t);for(let t=8677;t<=8679;t++)e.add(t);for(let t=8902;t<=8903;t++)e.add(t);for(let t=8907;t<=8910;t++)e.add(t);for(let t=8949;t<=8951;t++)e.add(t);for(let t=8972;t<=8987;t++)e.add(t);for(let t=9039;t<=9040;t++)e.add(t);for(let t=9068;t<=9069;t++)e.add(t);for(let t=9140;t<=9141;t++)e.add(t);for(let t=9148;t<=9150;t++)e.add(t);for(let t=9153;t<=9159;t++)e.add(t);for(let t=9205;t<=9218;t++)e.add(t);for(let t=9221;t<=9222;t++)e.add(t);for(let t=54098;t<=54101;t++)e.add(t);return e}]),np.push([10.71,()=>{const e=new Set([6316]);for(let t=8351;t<=8353;t++)e.add(t);for(let t=9294;t<=9297;t++)e.add(t);for(let t=103586;t<=103594;t++)e.add(t);for(let t=103696;t<=103698;t++)e.add(t);return e}]),np.push([10.7,()=>{const e=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let t=8065;t<=8068;t++)e.add(t);for(let t=8082;t<=8083;t++)e.add(t);for(let t=8379;t<=8385;t++)e.add(t);for(let t=8836;t<=8840;t++)e.add(t);for(let t=8857;t<=8860;t++)e.add(t);for(let t=53035;t<=53037;t++)e.add(t);for(let t=54090;t<=54091;t++)e.add(t);for(let t=102498;t<=102499;t++)e.add(t);return e}]),np.push([10.61,()=>new Set([102497])]),np.push([10.6,()=>{const e=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let t=7755;t<=7787;t++)e.add(t);for(let t=7791;t<=7795;t++)e.add(t);for(let t=7799;t<=7801;t++)e.add(t);for(let t=7825;t<=7831;t++)e.add(t);for(let t=7877;t<=7878;t++)e.add(t);for(let t=7882;t<=7883;t++)e.add(t);for(let t=7991;t<=7992;t++)e.add(t);for(let t=8042;t<=8043;t++)e.add(t);for(let t=8058;t<=8059;t++)e.add(t);for(let t=8311;t<=8348;t++)e.add(t);for(let t=9060;t<=9067;t++)e.add(t);for(let t=102562;t<=102568;t++)e.add(t);for(let t=102799;t<=102900;t++)e.add(t);return e}]),np.push([10.51,()=>{const e=new Set([7683,7881,7886,7899,8888,9e3]);for(let t=8013;t<=8032;t++)e.add(t);for(let t=9053;t<=9057;t++)e.add(t);for(let t=104017;t<=104018;t++)e.add(t);for(let t=104971;t<=104974;t++)e.add(t);return e}]),np.push([10.5,()=>{const e=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let t=4087;t<=4088;t++)e.add(t);for(let t=5896;t<=5899;t++)e.add(t);for(let t=7005;t<=7007;t++)e.add(t);for(let t=7057;t<=7070;t++)e.add(t);for(let t=7073;t<=7082;t++)e.add(t);for(let t=7109;t<=7128;t++)e.add(t);for(let t=7844;t<=7859;t++)e.add(t);return e}]);async function p9e(e,t,i){const r=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(r&&r.type==="unique-value"&&r.styleOrigin){const s=await Xp(r.populateFromStyle());if(Ui(i),s.ok===!1){const n=s.error;t&&t.messages&&t.messages.push(new Ju("renderer:style-reference",`Failed to create unique value renderer from style reference: ${n.message}`,{error:n,context:t})),e.clear("renderer",t.origin)}}}const f9e=["oid","global-id"],m9e=["oid","global-id","guid"];function g9e({displayField:e,editFieldsInfo:t,fields:i,objectIdField:r,title:s},n){if(!i)return null;const o=x9e({editFieldsInfo:t,fields:i,objectIdField:r},n);if(!o.length)return null;const a=E9e({titleBase:s,fields:i,displayField:e}),l=S9e();return new j3({title:a,content:l,fieldInfos:o})}const y9e=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],_9e=(e,{editFieldsInfo:t,objectIdField:i,visibleFieldNames:r})=>r?r.has(e.name):!_ve(e.name,t)&&(!i||e.name!==i)&&!f9e.includes(e.type)&&!y9e.some(s=>s.test(e.name));function v9e(e,t){const i=e;return t&&(e=e.filter(r=>!t.includes(r.type))),e===i&&(e=e.slice()),e.sort(b9e),e}function b9e(e,t){return e.type==="oid"?-1:t.type==="oid"?1:Bre(e)?-1:Bre(t)?1:(e.alias||e.name).toLocaleLowerCase().localeCompare((t.alias||t.name).toLocaleLowerCase())}function _ve(e,t){if(!e||!t)return!1;const{creationDateField:i,creatorField:r,editDateField:s,editorField:n}=t;return[i&&i.toLowerCase(),r&&r.toLowerCase(),s&&s.toLowerCase(),n&&n.toLowerCase()].includes(e.toLowerCase())}function w9e(e,t){return e.editable&&!m9e.includes(e.type)&&!_ve(e.name,t)}function x9e({editFieldsInfo:e,fields:t,objectIdField:i},r){return v9e(t,(r==null?void 0:r.ignoreFieldTypes)||C9e).map(s=>new G3({fieldName:s.name,isEditable:w9e(s,e),label:s.alias,format:T9e(s),visible:_9e(s,{editFieldsInfo:e,objectIdField:i,visibleFieldNames:r==null?void 0:r.visibleFieldNames})}))}function T9e(e){switch(e.type){case"small-integer":case"integer":case"single":return new I2({digitSeparator:!0,places:0});case"double":return new I2({digitSeparator:!0,places:2});case"date":return new I2({dateFormat:"long-month-day-year"});default:return e.type==="string"&&dpe(e.name)?new I2({digitSeparator:!0,places:0}):null}}function S9e(){return[new NE,new fP]}function E9e(e){const t=VRe(e),{titleBase:i}=e;return t?`${i}: {${t.trim()}}`:i}function Bre(e){return(e.name&&e.name.toLowerCase())==="name"?!0:(e.alias&&e.alias.toLowerCase())==="name"||void 0}const C9e=["geometry","blob","raster","guid","xml"],g6=new Hi({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),A9e={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},vn="FeatureLayer",Vre=Ie.getLogger("esri.layers.FeatureLayer");function t$(e,t){return new se("layer:unsupported",`Layer (${e.title}, ${e.id}) of type '${e.declaredClass}' ${t}`,{layer:e})}function Gre(e){return e&&e instanceof zt}function ii(e,t,i){return!!(e&&e.hasOwnProperty(t)?e[t]:i)}function i$(e,t,i){return e&&e.hasOwnProperty(t)?e[t]:i}function O9e(e){var i;const t=(i=e==null?void 0:e.supportedSpatialAggregationStatistics)==null?void 0:i.map(r=>r.toLowerCase());return{envelope:!!(t!=null&&t.includes("envelopeaggregate")),centroid:!!(t!=null&&t.includes("centroidaggregate")),convexHull:!!(t!=null&&t.includes("convexhullaggregate"))}}function tO(e,t){var r;const i=(r=e==null?void 0:e.supportedOperationsWithCacheHint)==null?void 0:r.map(s=>s.toLowerCase());return!!(i!=null&&i.includes(t.toLowerCase()))}const y6=o9e();function _6(e,t,i){const r=!!(i!=null&&i.writeLayerSchema);return{enabled:r,ignoreOrigin:r}}let Ze=class extends Q6e(W6e(y8e(M8e(A8e(C8e(q6e(f8e(w8e(Y_e(Z6e(k6e(Hc(h5))))))))))))){constructor(...e){super(...e),this._handles=new xi,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=wt.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(zt.ofType(ay)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=Tt(this._handles)}normalizeCtorArgs(e,t){return typeof e=="string"?{url:e,...t}:e}load(e){const t=w(e)?e.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(t).then(r=>this._initLayerProperties(r)));const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(e0).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const r=await this._fetchFirstLayerId(t);r!=null&&(this.layerId=r)}if(!this.url&&!this._hasMemorySource())throw new se("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this._initLayerProperties(await this.createGraphicsSource(t))}).then(()=>this.finishLoadEditablePortalLayer(e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,t){return t=t.layerDefinition||t,{analytics:this._readAnalyticsCapabilities(t),attachment:this._readAttachmentCapabilities(t),data:this._readDataCapabilities(t),metadata:this._readMetadataCapabilities(t),operations:this._readOperationsCapabilities(t.capabilities||e,t),query:this._readQueryCapabilities(t),queryRelated:this._readQueryRelatedCapabilities(t),queryTopFeatures:this._readQueryTopFeaturesCapabilities(t),editing:this._readEditingCapabilities(t)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){e!=null?this._override("editingEnabled",e):this._clearOverride("editingEnabled")}readEditingEnabled(e,t){return this._readEditingEnabled(t,!1)}readEditingEnabledFromWebMap(e,t,i){return this._readEditingEnabled(t,!0,i)}writeEditingEnabled(e,t){this._writeEditingEnabled(e,t,!1)}writeEditingEnabledToWebMap(e,t,i,r){this._writeEditingEnabled(e,t,!0,r)}readEditingInfo(e,t){const{editingInfo:i}=t;return i?{lastEditDate:i.lastEditDate!=null?new Date(i.lastEditDate):null}:null}readIsTable(e,t){return(t=t&&t.layerDefinition||t).type==="Table"||!t.geometryType}writeIsTable(e,t,i,r){r!=null&&r.writeLayerSchema&&zc(i,e?"Table":"Feature Layer",t)}readMinScale(e,t){return t.effectiveMinScale||e||0}readMaxScale(e,t){return t.effectiveMaxScale||e||0}readGlobalIdFieldFromService(e,t){if((t=t.layerDefinition||t).globalIdField)return t.globalIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeGlobalID")return i.name}}readObjectIdFieldFromService(e,t){if((t=t.layerDefinition||t).objectIdField)return t.objectIdField;if(t.fields){for(const i of t.fields)if(i.type==="esriFieldTypeOID")return i.name}}get parsedUrl(){const e=this.url?$a(this.url):null;return e!=null&&(this.dynamicDataSource!=null?e.path=Mx(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=Mx(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){hee(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,t,i){const r=(t=t.layerDefinition||t).drawingInfo&&t.drawingInfo.renderer||void 0;if(r){const s=m6e(r,t,i)||void 0;return s||Vre.error("Failed to create renderer",{rendererDefinition:t.drawingInfo.renderer,layer:this,context:i}),s}if(t.defaultSymbol)return t.types&&t.types.length?new VY({defaultSymbol:v6(t.defaultSymbol,t,i),field:t.typeIdField,uniqueValueInfos:t.types.map(s=>({id:s.id,symbol:v6(s.symbol,s,i)}))}):new BY({symbol:v6(t.defaultSymbol,t,i)})}set source(e){const t=this._get("source");t!==e&&(Gre(t)&&this._resetMemorySource(t),Gre(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof zt?new oy({layer:this,items:e}):e:null}readSource(e,t){const i=PU.fromJSON(t.featureSet);return new oy({layer:this,items:i&&i.features||[]})}readServiceDefinitionExpression(e,t){return t.definitionQuery||t.definitionExpression}readTemplates(e,t){const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(n=>QY.fromJSON(n)),this._fixTemplates(e,r),this._fixTemplates(e,s),e}readTitle(e,t){const i=t.layerDefinition&&t.layerDefinition.name||t.name,r=t.title||t.layerDefinition&&t.layerDefinition.title;if(i){const s=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?V6e(this.url,i):i;let n=i;if(!n&&this.url){const o=tC(this.url);w(o)&&(n=o.title)}return n?(this.sublayerTitleMode==="item-title-and-service-name"&&s&&s!==n&&(n=s+" - "+n),HY(n)):void 0}if(this.sublayerTitleMode==="item-title"&&r)return r}readTitleFromWebMap(e,t){return t.title||t.layerDefinition&&t.layerDefinition.name}readTypeIdField(e,t){let i=(t=t.layerDefinition||t).typeIdField;if(i&&t.fields){i=i.toLowerCase();const r=t.fields.find(s=>s.name.toLowerCase()===i);r&&(i=r.name)}return i}readTypes(e,t){e=(t=t.layerDefinition||t).types;const i=t.editFieldsInfo,r=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(n=>(n=yve.fromJSON(n),this._fixTemplates(n.templates,r),this._fixTemplates(n.templates,s),n))}set url(e){const t=j6e({layer:this,url:e,nonStandardUrlAllowed:!0,logger:Vre});this._set("url",t.url),t.layerId!=null&&this._set("layerId",t.layerId)}writeUrl(e,t,i,r){H6e(this,e,null,t,r)}readVersion(e,t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}readVisible(e,t){return t.layerDefinition&&t.layerDefinition.defaultVisibility!=null?!!t.layerDefinition.defaultVisibility:t.visibility!=null?!!t.visibility:void 0}addAttachment(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("addAttachment"in this.source))throw new se(vn,"Layer source does not support addAttachment capability");return this.source.addAttachment(e,t)})}updateAttachment(e,t,i){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("updateAttachment"in this.source))throw new se(vn,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(e,t,i)})}async applyEdits(e,t){const i=await _e(()=>import("./editingSupport.0b59e938.js"),[],import.meta.url);return await this.load(),i.applyEdits(this,this.source,e,t)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return g9e(this,e)}async createGraphicsSource(e){if(this._hasMemorySource())return this.source.load({signal:e});const{default:t}=await qCe(_e(()=>import("./FeatureLayerSource.21973bbf.js"),["FeatureLayerSource.21973bbf.js","clientSideDefaults.41204392.js","QueryEngineCapabilities.c2e9875c.js","executeForIds.e24004f0.js"],import.meta.url),e);return new t({layer:this}).load({signal:e})}createQuery(){const e=new xp,t=this.get("capabilities.data"),i=this.get("capabilities.query");e.dynamicDataSource=this.dynamicDataSource,e.historicMoment=this.historicMoment,e.gdbVersion=this.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),t&&(t.supportsZ&&this.returnZ!=null&&(e.returnZ=this.returnZ),t.supportsM&&this.returnM!=null&&(e.returnM=this.returnM)),e.outFields=["*"];const r=w(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,s=_6e(this.definitionExpression,r);e.where=s||"1=1";const{timeOffset:n,timeExtent:o}=this;return e.timeExtent=n!=null&&o!=null?o.offset(-n.value,n.unit):o||null,e.multipatchOption=this.geometryType==="multipatch"?"xyFootprint":null,e}deleteAttachments(e,t){return this.load().then(()=>this._checkAttachmentSupport(e)).then(()=>{if(!("deleteAttachments"in this.source))throw new se(vn,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(e,t)})}fetchRecomputedExtents(e){return this.load({signal:e==null?void 0:e.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(e);throw new se(vn,"Layer source does not support fetchUpdates capability")})}getFeatureType(e){const{typeIdField:t,types:i}=this;if(!t||!e)return null;const r=e.attributes?e.attributes[t]:void 0;if(r==null)return null;let s=null;return i.some(n=>{const{id:o}=n;return o!=null&&(o.toString()===r.toString()&&(s=n),!!s)}),s}getFieldDomain(e,t){const i=t&&t.feature,r=this.getFeatureType(i);if(r){const s=r.domains&&r.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}queryAttachments(e,t){return e=Cj.from(e),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new se(vn,"this layer doesn't support attachments");const{attachmentTypes:i,objectIds:r,globalIds:s,num:n,size:o,start:a,where:l}=e;if(!this.get("capabilities.operations.supportsQueryAttachments")){const c=r&&r.length>1,h=i&&i.length,p=s&&s.length,m=o&&o.length;if(c||h||p||m||n||a||l)throw new se(vn,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",e)}if(!(r&&r.length||l))throw new se(vn,"'objectIds' or 'where' are required to perform attachment query",e);if(!("queryAttachments"in this.source))throw new se(vn,"Layer source does not support queryAttachments capability",e);return this.source.queryAttachments(e)})}queryFeatures(e,t){return this.load().then(()=>this.source.queryFeatures(xp.from(e)||this.createQuery(),t)).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i})}queryObjectIds(e,t){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(xp.from(e)||this.createQuery(),t);throw new se(vn,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(e,t){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(xp.from(e)||this.createQuery(),t);throw new se(vn,"Layer source does not support queryFeatureCount capability")})}queryExtent(e,t){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(xp.from(e)||this.createQuery(),t);throw new se(vn,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(e,t){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(Qj.from(e),t);throw new se(vn,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(e,t){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(Qj.from(e),t);throw new se(vn,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(e,t){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(FL.from(e),t).then(i=>{if(i!=null&&i.features)for(const r of i.features)r.layer=r.sourceLayer=this;return i});throw new se(vn,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(e,t){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(FL.from(e),t);throw new se(vn,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(e,t){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(FL.from(e),t);throw new se(vn,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(e,t){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(FL.from(e),t);throw new se(vn,"Layer source does not support queryFeatureCount capability")})}read(e,t){const i=e.featureCollection;if(i){const r=i.layers;r&&r.length===1&&(super.read(r[0],t),i.showLegend!=null&&super.read({showLegend:i.showLegend},t))}super.read(e,t),t&&t.origin==="service"&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(e,t){var n;t={...t,writeLayerSchema:(n=t==null?void 0:t.writeLayerSchema)!=null?n:this._hasMemorySource()};const{origin:i,layerContainerType:r,messages:s}=t;if(this.dynamicDataSource)return s==null||s.push(t$(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&r!=="tables")return s==null||s.push(t$(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(t$(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&r==="tables")return s==null||s.push(t$(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,t)}clone(){if(this._hasMemorySource())throw new se(vn,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){return!!this.loaded&&(this.source.type==="memory"||d9e(this,e))}async save(e){return(await _e(()=>import("./featureLayerUtils.424e6492.js"),["featureLayerUtils.424e6492.js","originUtils.68552ec1.js","multiOriginJSONSupportUtils.8128aa52.js","arcgisLayers.1ab8670d.js","lazyLayerLoader.3b511a62.js","jsonContext.7555778f.js","portalItemUtils.eba1acfc.js"],import.meta.url)).save(this,e)}async saveAs(e,t){return(await _e(()=>import("./featureLayerUtils.424e6492.js"),["featureLayerUtils.424e6492.js","originUtils.68552ec1.js","multiOriginJSONSupportUtils.8128aa52.js","arcgisLayers.1ab8670d.js","lazyLayerLoader.3b511a62.js","jsonContext.7555778f.js","portalItemUtils.eba1acfc.js"],import.meta.url)).saveAs(this,e,t)}_readEditingEnabled(e,t,i){var s;let r=(s=e.layerDefinition)==null?void 0:s.capabilities;return r?this._hasEditingCapability(r):(r=e.capabilities,t&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&r?this._hasEditingCapability(r):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(t=>t.trim()).includes("editing")}_writeEditingEnabled(e,t,i,r){var s,n;if(!e){const o=(n=(s=this.capabilities)==null?void 0:s.operations)!=null&&n.supportsSync?"Query,Sync":"Query";zc("layerDefinition.capabilities",o,t),i&&!(r!=null&&r.writeLayerSchema)&&(t.capabilities=o)}}_checkAttachmentSupport(e){const{attributes:t}=e,{objectIdField:i}=this;return this.get("capabilities.data.supportsAttachment")?e?t?t[i]?void 0:Promise.reject(new se(vn,`feature is missing the identifying attribute ${i}`)):Promise.reject(new se(vn,"'attributes' are required on a feature to query attachments")):Promise.reject(new se(vn,"A feature is required to add/delete/update attachments")):Promise.reject(new se(vn,"this layer doesn't support attachments"))}_getLayerDomain(e){const t=this.fieldsIndex.get(e);return t?t.domain:null}_fetchFirstLayerId(e){return jr(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(t=>{const i=t.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async _initLayerProperties(e){return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",url:this.parsedUrl})),this._verifySource(),this._verifyFields(),hee(this.renderer,this.fieldsIndex),npe(this.timeInfo,this.fieldsIndex),p9e(this,{origin:"service"})}async hasDataChanged(){var e,t;if((e=this.source)!=null&&e.refresh)try{const{dataChanged:i,updates:r}=await((t=this.source)==null?void 0:t.refresh());if(w(r)&&(this.sourceJSON={...this.sourceJSON,...r},this.read(r,{origin:"service",url:this.parsedUrl})),i)return!0}catch{}if(this.definitionExpression)try{return(await y6e(this.definitionExpression,this.fieldsIndex)).hasDateFunctions}catch{}return!1}_verifyFields(){var t;const e=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||((t=this.fields)==null?void 0:t.some(i=>i.type==="geometry"))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,t){e&&e.forEach(i=>{const r=i.prototype&&i.prototype.attributes;r&&t&&delete r[t]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new se("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new se("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(t=>{t.layer=this,t.sourceLayer=this}),this._handles.add([e.on("after-add",t=>{t.item.layer=this,t.item.sourceLayer=this}),e.on("after-remove",t=>{t.item.layer=null,t.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(t=>{t.layer=null,t.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(e){return{supportsCacheHint:tO(e.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(e){const t=e.attachmentProperties,i={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:tO(e.advancedQueryCapabilities,"queryAttachments"),supportsResize:ii(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(r=>{const s=A9e[r.name];s&&(i[s]=!!r.isEnabled)}),i}_readDataCapabilities(e){return{isVersioned:ii(e,"isDataVersioned",!1),supportsAttachment:ii(e,"hasAttachments",!1),supportsM:ii(e,"hasM",!1),supportsZ:ii(e,"hasZ",!1)}}_readMetadataCapabilities(e){return{supportsAdvancedFieldProperties:ii(e,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(e,t){const i=e?e.toLowerCase().split(",").map(p=>p.trim()):[],r=this.url?tC(this.url):null,s=i.includes(w(r)&&r.serverType==="MapServer"?"data":"query"),n=i.includes("editing")&&!t.datesInUnknownTimezone;let o=n&&i.includes("create"),a=n&&i.includes("delete"),l=n&&i.includes("update");const c=i.includes("changetracking"),h=t.advancedQueryCapabilities;return n&&!(o||a||l)&&(o=a=l=!0),{supportsCalculate:ii(t,"supportsCalculate",!1),supportsTruncate:ii(t,"supportsTruncate",!1),supportsValidateSql:ii(t,"supportsValidateSql",!1),supportsAdd:o,supportsDelete:a,supportsEditing:n,supportsChangeTracking:c,supportsQuery:s,supportsQueryAnalytics:ii(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:ii(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:ii(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:ii(t,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:ii(t,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(e){var l;const t=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,r=e.archivingInfo,s=(l=this.url)==null?void 0:l.includes("MapServer"),n=!Ce("mapserver-pbf-enabled")&&s&&this.version<10.81,o=sve(this.url),a=(e.supportedQueryFormats||"").split(",").reduce((c,h)=>{const p=h.toLowerCase().trim();return p&&c.add(p),c},new Set);return{supportsStatistics:ii(t,"supportsStatistics",e.supportsStatistics),supportsPercentileStatistics:ii(t,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:ii(t,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:O9e(t),supportsCentroid:ii(t,"supportsReturningGeometryCentroid",!1),supportsDistance:ii(t,"supportsQueryWithDistance",!1),supportsDistinct:ii(t,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:ii(t,"supportsReturningQueryExtent",!1),supportsGeometryProperties:ii(t,"supportsReturningGeometryProperties",!1),supportsHavingClause:ii(t,"supportsHavingClause",!1),supportsOrderBy:ii(t,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:ii(t,"supportsPagination",!1),supportsQuantization:ii(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:ii(e,"supportsQuantizationEditMode",!1),supportsQueryGeometry:ii(e,"supportsReturningQueryGeometry",!1),supportsResultType:ii(t,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:ii(t,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:ii(t,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:ii(e,"useStandardizedQueries",!1),supportsTopFeaturesQuery:ii(t,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:ii(i,"allowOthersToQuery",!0),supportsHistoricMoment:ii(r,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!n&&a.has("pbf"),supportsDisjointSpatialRelationship:ii(t,"supportsDisjointSpatialRel",!1),supportsCacheHint:ii(t,"supportsQueryWithCacheHint",!1)||tO(t,"query"),supportsDefaultSpatialReference:ii(t,"supportsDefaultSR",!1),supportsCompactGeometry:o,maxRecordCountFactor:i$(e,"maxRecordCountFactor",void 0),maxRecordCount:i$(e,"maxRecordCount",void 0),standardMaxRecordCount:i$(e,"standardMaxRecordCount",void 0),tileMaxRecordCount:i$(e,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(e){const t=e.advancedQueryCapabilities,i=ii(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:ii(t,"supportsQueryRelatedPagination",!1),supportsCount:i,supportsOrderBy:i,supportsCacheHint:tO(t,"queryRelated")}}_readQueryTopFeaturesCapabilities(e){return{supportsCacheHint:tO(e.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(e){const t=e.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:ii(e,"allowGeometryUpdates",!0),supportsGlobalId:ii(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:ii(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:ii(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:ii(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:ii(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:ii(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:ii(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:ii(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:ii(t,"allowOthersToUpdate",!0)}}};u([f({readOnly:!0,json:{read:!1}})],Ze.prototype,"capabilities",void 0),u([it("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],Ze.prototype,"readCapabilities",null),u([f({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ze.prototype,"charts",void 0),u([f({readOnly:!0})],Ze.prototype,"createQueryVersion",null),u([f({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],Ze.prototype,"copyright",void 0),u([f({type:Boolean})],Ze.prototype,"datesInUnknownTimezone",void 0),u([f({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],Ze.prototype,"displayField",void 0),u([f({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],Ze.prototype,"definitionExpression",void 0),u([f({types:ax,readOnly:!0})],Ze.prototype,"defaultSymbol",void 0),u([f({type:gp})],Ze.prototype,"dynamicDataSource",void 0),u([f({readOnly:!0})],Ze.prototype,"editFieldsInfo",void 0),u([f({type:Boolean})],Ze.prototype,"editingEnabled",null),u([it(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ze.prototype,"readEditingEnabled",null),u([it("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ze.prototype,"readEditingEnabledFromWebMap",null),u([ut(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ze.prototype,"writeEditingEnabled",null),u([ut("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ze.prototype,"writeEditingEnabledToWebMap",null),u([f({readOnly:!0})],Ze.prototype,"editingInfo",void 0),u([it("editingInfo")],Ze.prototype,"readEditingInfo",null),u([f((()=>{const e=me(c8e),t=e.json.origins;return t["web-map"]={read:!1,write:!1},t["portal-item"]={read:!1,write:!1},e})())],Ze.prototype,"elevationInfo",void 0),u([f(i9e)],Ze.prototype,"featureReduction",void 0),u([f({...y6.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:_6}}}}})],Ze.prototype,"fields",void 0),u([f(y6.fieldsIndex)],Ze.prototype,"fieldsIndex",void 0),u([f({type:u9e,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],Ze.prototype,"floorInfo",void 0),u([f({type:M6e,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ze.prototype,"formTemplate",void 0),u([f({type:zi,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],Ze.prototype,"fullExtent",void 0),u([f()],Ze.prototype,"gdbVersion",void 0),u([f({readOnly:!0,type:a9e,json:{read:{source:"geometryProperties"}}})],Ze.prototype,"geometryFieldsInfo",void 0),u([f({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:g6.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:_6,writer(e,t,i){const r=e?g6.toJSON(e):null;r&&zc(i,r,t)}}}},read:{source:"layerDefinition.geometryType",reader:g6.read}}})],Ze.prototype,"geometryType",void 0),u([f({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],Ze.prototype,"hasM",void 0),u([f({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],Ze.prototype,"hasZ",void 0),u([f({readOnly:!0,type:jC})],Ze.prototype,"heightModelInfo",void 0),u([f({type:Date})],Ze.prototype,"historicMoment",void 0),u([f(h8e)],Ze.prototype,"id",void 0),u([f({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Ze.prototype,"infoFor3D",void 0),u([f({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ze.prototype,"isTable",void 0),u([it("service","isTable",["type","geometryType"]),it("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ze.prototype,"readIsTable",null),u([ut("web-map","isTable")],Ze.prototype,"writeIsTable",null),u([f(WY)],Ze.prototype,"labelsVisible",void 0),u([f({type:[BU],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:kre},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:kre},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Ze.prototype,"labelingInfo",void 0),u([f((()=>{const e=me(u8e);return e.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(t,i,r){zc(r,Gk(t),i)}}},e})())],Ze.prototype,"opacity",void 0),u([f({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],Ze.prototype,"layerId",void 0),u([f(l8e)],Ze.prototype,"legendEnabled",void 0),u([f({type:["show","hide"],json:(()=>{const e=me(nve.json);return e.origins["portal-item"]={read:!1,write:!1},e})()})],Ze.prototype,"listMode",void 0),u([f(d8e)],Ze.prototype,"minScale",void 0),u([it("service","minScale",["minScale","effectiveMinScale"])],Ze.prototype,"readMinScale",null),u([f(p8e)],Ze.prototype,"maxScale",void 0),u([it("service","maxScale",["maxScale","effectiveMaxScale"])],Ze.prototype,"readMaxScale",null),u([f({type:String})],Ze.prototype,"globalIdField",void 0),u([it("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),it("service","globalIdField",["globalIdField","fields"])],Ze.prototype,"readGlobalIdFieldFromService",null),u([f({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:_6}}}}})],Ze.prototype,"objectIdField",void 0),u([it("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),it("service","objectIdField",["objectIdField","fields"])],Ze.prototype,"readObjectIdFieldFromService",null),u([f({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ze.prototype,"operationalLayerType",void 0),u([f(y6.outFields)],Ze.prototype,"outFields",void 0),u([f({readOnly:!0})],Ze.prototype,"parsedUrl",null),u([f({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ze.prototype,"path",void 0),u([f(qY)],Ze.prototype,"popupEnabled",void 0),u([f({type:j3,json:{name:"popupInfo",write:!0}})],Ze.prototype,"popupTemplate",void 0),u([f({readOnly:!0})],Ze.prototype,"defaultPopupTemplate",null),u([f({type:[h9e],readOnly:!0})],Ze.prototype,"relationships",void 0),u([f({types:UU,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:p6e,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(e,t,i)=>({ignoreOrigin:i==null?void 0:i.writeLayerSchema})}}})],Ze.prototype,"renderer",null),u([it("service","renderer",["drawingInfo.renderer","defaultSymbol"]),it("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ze.prototype,"readRenderer",null),u([f()],Ze.prototype,"sourceJSON",void 0),u([f({type:Boolean})],Ze.prototype,"returnM",void 0),u([f({type:Boolean})],Ze.prototype,"returnZ",void 0),u([f((()=>{const e=me(o8e);return e.json.origins["portal-item"]={read:!1,write:!1},e})())],Ze.prototype,"screenSizePerspectiveEnabled",void 0),u([f({clonable:!1})],Ze.prototype,"source",null),u([pi("source")],Ze.prototype,"castSource",null),u([it("portal-item","source",["featureSet"]),it("web-map","source",["featureSet"])],Ze.prototype,"readSource",null),u([f({readOnly:!0})],Ze.prototype,"serviceDefinitionExpression",void 0),u([it("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],Ze.prototype,"readServiceDefinitionExpression",null),u([f({type:wt,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],Ze.prototype,"spatialReference",void 0),u([f({type:Number})],Ze.prototype,"subtypeCode",void 0),u([f({type:String,json:{origins:{service:{read:!0}}}})],Ze.prototype,"subtypeField",void 0),u([f({type:[QY]})],Ze.prototype,"templates",void 0),u([it("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ze.prototype,"readTemplates",null),u([f({type:uve})],Ze.prototype,"timeInfo",void 0),u([f()],Ze.prototype,"title",void 0),u([it("service","title",["name"]),it("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ze.prototype,"readTitle",null),u([it("web-map","title",["layerDefinition.name","title"])],Ze.prototype,"readTitleFromWebMap",null),u([f({type:String})],Ze.prototype,"sublayerTitleMode",void 0),u([f({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],Ze.prototype,"trackIdField",void 0),u([f({json:{read:!1}})],Ze.prototype,"type",void 0),u([f({type:String})],Ze.prototype,"typeIdField",void 0),u([it("service","typeIdField"),it("typeIdField",["layerDefinition.typeIdField"])],Ze.prototype,"readTypeIdField",null),u([f({type:[yve]})],Ze.prototype,"types",void 0),u([it("service","types",["types"]),it("types",["layerDefinition.types"])],Ze.prototype,"readTypes",null),u([f({readOnly:!0,json:{write:!1}})],Ze.prototype,"serverGens",void 0),u([f({type:zt.ofType(ay),readOnly:!0})],Ze.prototype,"indexes",void 0),u([f(a8e)],Ze.prototype,"url",null),u([ut("url")],Ze.prototype,"writeUrl",null),u([f({readOnly:!0})],Ze.prototype,"userIsAdmin",void 0),u([f({json:{origins:{service:{read:!0}},read:!1}})],Ze.prototype,"version",void 0),u([it("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],Ze.prototype,"readVersion",null),u([f({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ze.prototype,"visible",void 0),u([it("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ze.prototype,"readVisible",null),Ze=u([B("esri.layers.FeatureLayer")],Ze);const v6=NC({types:Ffe}),vve=Ze,pbt=Object.freeze(Object.defineProperty({__proto__:null,default:vve},Symbol.toStringTag,{value:"Module"})),R9e=["$datastore","$map","$layer","$aggregatedfeatures"],M9e="esri.widgets.Feature.support.arcadeFeatureUtils",P9e=Ie.getLogger(M9e);function I9e(e){return typeof e=="string"?Y3(iY(e)):Array.isArray(e)?L9e(e):(e==null?void 0:e.declaredClass)==="esri.arcade.Dictionary"?$9e(e):e}function L9e(e){return`<ul class="esri-widget__list">${e.map(t=>`<li>${typeof t=="string"?Y3(iY(t)):t}</li>`).join("")}</ul>`}function $9e(e){return`<table class="esri-widget__table">${e.keys().map(t=>{const i=e.field(t);return`<tr><th>${t}</th><td>${typeof i=="string"?Y3(iY(i)):i}</td></tr>`}).join("")}</table>`}function D9e({aggregatedFeatures:e,arcadeUtils:t,featureSetVars:i,context:r,viewInfo:s,map:n,graphic:o,interceptor:a}){i.forEach(l=>{const c=l.toLowerCase(),h={map:n,spatialReference:s.sr,interceptor:a};if(c==="$map"&&(r.vars[c]=t.convertMapToFeatureSetCollection(h)),c==="$layer"&&(r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:o.sourceLayer,spatialReference:s.sr,interceptor:a})),c==="$datastore"&&(r.vars[c]=t.convertServiceUrlToWorkspace({url:o.sourceLayer.url,spatialReference:s.sr,interceptor:a})),c==="$aggregatedfeatures"){const p=o.layer,{fields:m,objectIdField:g,geometryType:v,spatialReference:b,displayField:S}=p,T=new vve({fields:m,objectIdField:g,geometryType:v,spatialReference:b,displayField:S,...p.type==="feature"?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null,source:e});r.vars[c]=t.convertFeatureLayerToFeatureSet({layer:T,spatialReference:s.sr,interceptor:a})}})}function bve(){return _e(()=>import("./arcadeUtils.ed7e1563.js").then(e=>e.t),[],import.meta.url)}async function N9e({graphic:e,view:t}){const{isAggregate:i,layer:r}=e;if(!i||!r||(t==null?void 0:t.type)!=="2d")return[];const s=await t.whenLayerView(r);if(!s.createQuery||!s.queryFeatures)return[];const n=s.createQuery();n.aggregateIds=[e.getObjectId()];const{features:o}=await s.queryFeatures(n);return o}async function wve({expressionInfo:e,arcadeUtils:t,interceptor:i,spatialReference:r,map:s,graphic:n,view:o}){if(!e||!e.expression)return null;const a=t.createSyntaxTree(e.expression),l=R9e.filter(g=>t.hasVariable(a,g)),[c]=await Promise.all([N9e({graphic:n,view:o}),t.loadScriptDependencies(a,!0,l)]),h=t.getViewInfo({spatialReference:r}),p=t.createExecContext(n,h);p.interceptor=i,p.useAsync=!0,D9e({aggregatedFeatures:c,arcadeUtils:t,featureSetVars:l,context:p,viewInfo:h,map:s,graphic:n,interceptor:i});const m=t.createFunction(a,p);return t.executeAsyncFunction(m,p).catch(g=>P9e.error("arcade-execution-error",{error:g,graphic:n,expressionInfo:e}))}async function F9e({expressionInfos:e,spatialReference:t,graphic:i,interceptor:r,map:s,view:n}){if(!e||!e.length)return{};const o=await bve(),a={};for(const h of e)a[`expression/${h.name}`]=wve({expressionInfo:h,arcadeUtils:o,interceptor:r,spatialReference:t,map:s,graphic:i,view:n});const l=await cl(a),c={};for(const h in l)c[h]=I9e(l[h].value);return c}const k9e=1;let fu=class extends mT(ze){constructor(e){super(e),this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:t}=this;t&&t.abort(),this._abortController=null},this._createVM=()=>{var r,s;const t=(r=this.contentElement)==null?void 0:r.type;(s=this.contentElementViewModel)==null||s.destroy();const i=t==="fields"?new wU:t==="media"?new Hw:t==="text"?new t5:null;this._set("contentElementViewModel",i)},this._compile=async()=>{this._cancelQuery();const t=new AbortController;this._abortController=t,await this._compileExpression(),this._abortController===t&&(this._abortController=null)},this._compileThrottled=XX(this._compile,k9e,this),this._compileExpression=async()=>{const{expressionInfo:t,graphic:i,interceptor:r,spatialReference:s,map:n,view:o,_abortController:a}=this;if(!(t&&i&&s&&n))return void this._set("contentElement",null);const l=await bve();if(a!==this._abortController)return;const c=await wve({arcadeUtils:l,expressionInfo:t,graphic:i,interceptor:r,map:n,spatialReference:s,view:o});if(!c||c.declaredClass!=="esri.arcade.Dictionary")return void this._set("contentElement",null);const h=await LY(c,a.signal),p=h==null?void 0:h.type,m=p==="media"?yP.fromJSON(h):p==="text"?FE.fromJSON(h):p==="fields"?NE.fromJSON(h):null;this._set("contentElement",m)},this.handles.add([xe(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),si),xe(()=>[this.contentElement],()=>this._createVM(),si)])}destroy(){var e;this._cancelQuery(),(e=this.contentElementViewModel)==null||e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var e;return((e=this.view)==null?void 0:e.spatialReference)||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get state(){const{_abortController:e,contentElement:t,contentElementViewModel:i}=this;return e?"loading":t||i?"ready":"disabled"}get map(){var e;return((e=this.view)==null?void 0:e.map)||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}};u([f()],fu.prototype,"_abortController",void 0),u([f({type:ppe})],fu.prototype,"expressionInfo",void 0),u([f({type:ul})],fu.prototype,"graphic",void 0),u([f({readOnly:!0})],fu.prototype,"contentElement",void 0),u([f({readOnly:!0})],fu.prototype,"contentElementViewModel",void 0),u([f()],fu.prototype,"interceptor",void 0),u([f()],fu.prototype,"spatialReference",null),u([f({readOnly:!0})],fu.prototype,"state",null),u([f()],fu.prototype,"map",null),u([f()],fu.prototype,"view",void 0),fu=u([B("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],fu);const JY=fu,r$={iconLoading:"esri-icon-loading-indicator esri-rotating",base:"esri-feature-expression",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};let oF=class extends dl{constructor(e,t){super(e,t),this.viewModel=new JY}initialize(){this.own(xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentElementViewModel},()=>this._setupExpressionWidget(),si))}destroy(){this._destroyContentWidget()}renderLoading(){return Te("div",{key:"loading-container",class:r$.loadingSpinnerContainer},Te("span",{class:this.classes(r$.iconLoading,r$.spinner)}))}render(){var t;const{state:e}=this.viewModel;return Te("div",{class:r$.base},e==="loading"?this.renderLoading():e==="disabled"?null:(t=this._contentWidget)==null?void 0:t.render())}_destroyContentWidget(){const{_contentWidget:e}=this;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:e,contentElement:t}=this.viewModel,i=t==null?void 0:t.type;this._destroyContentWidget();const r=e?i==="fields"?new Bye({viewModel:e}):i==="media"?new b0e({viewModel:e}):i==="text"?new kN({viewModel:e}):null:null;this._contentWidget=r,this.scheduleRender()}};u([f({type:JY})],oF.prototype,"viewModel",void 0),oF=u([B("esri.widgets.Feature.FeatureExpression")],oF);const U9e=oF;class z9e{constructor(t,i){this.preLayerQueryCallback=t,this.preRequestCallback=i,this.preLayerQueryCallback||(this.preLayerQueryCallback=r=>{}),this.preRequestCallback||(this.preLayerQueryCallback=r=>{})}}var aF;const B9e=1,jre="content-view-models",xve="esri.widgets.FeatureViewModel",V9e=Ie.getLogger(xve),Hre={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let Bs=aF=class extends ze{constructor(e){super(e),this._handles=new xi,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=XX(this._graphicChanged,B9e,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities={...Hre},this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=t=>{const{abilities:i}=this;return t.type==="attachments"&&i.attachmentsContent||t.type==="custom"&&i.customContent||t.type==="fields"&&i.fieldsContent||t.type==="media"&&i.mediaContent||t.type==="text"&&i.textContent||t.type==="expression"&&i.expressionContent},this._handles.add(xe(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),si))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return w(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return t4e(kte(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return Oye(this.graphic)}castAbilities(e){return{...Hre,...e}}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(e){this._set("graphic",e?e.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(e){e!==void 0?this._override("spatialReference",e):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(e){e!==void 0?this._override("map",e):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(e,t){const i=this.contentViewModels[e];i instanceof Hw&&i.setActiveMedia(t)}nextMedia(e){const t=this.contentViewModels[e];t instanceof Hw&&t.next()}previousMedia(e){const t=this.contentViewModels[e];t instanceof Hw&&t.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}async _graphicChanged(){this._cancelFeatureQuery(),this._error=null,this._clear();const{graphic:e}=this;if(!e)return;const t=new AbortController;this._featureAbortController=t;try{await this._queryFeature({signal:t.signal})}catch(i){Cs(i)||(this._error=i,V9e.error("error","The popupTemplate could not be displayed for this feature.",{error:i,graphic:e,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===t&&(this._featureAbortController=null)}_cancelFeatureQuery(){const{_featureAbortController:e}=this;e&&e.abort(),this._featureAbortController=null}_compileContentElement(e,t){return e.type==="attachments"?this._compileAttachments(e,t):e.type==="custom"?this._compileCustom(e,t):e.type==="fields"?this._compileFields(e,t):e.type==="media"?this._compileMedia(e,t):e.type==="text"?this._compileText(e,t):e.type==="expression"?this._compileExpression(e,t):void 0}_compileContent(e){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((t,i)=>this._compileContentElement(t,i)):typeof e=="string"?this._compileText(new FE({text:e}),0).text:e}_destroyContentViewModels(){var e;(e=this._handles)==null||e.remove(jre),this.contentViewModels.forEach(t=>t&&!t.destroyed&&t.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(e,t){const{formattedAttributes:i}=this,{contentElement:r,contentElementViewModel:s}=e,n=r==null?void 0:r.type;s&&n&&(n==="fields"&&(this._createFieldsFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createFieldsVMParams(r,t))),n==="media"&&(this._createMediaFormattedAttributes({contentElement:r,contentElementIndex:t,formattedAttributes:i}),s.set(this._createMediaVMParams(r,t))),n==="text"&&s.set(this._createTextVMParams(r)))}_compileExpression(e,t){const{expressionInfo:i}=e,{graphic:r,map:s,spatialReference:n,view:o}=this,a=new JY({expressionInfo:i,graphic:r,interceptor:aF.interceptor,map:s,spatialReference:n,view:o});return this.contentViewModels[t]=a,this._handles.add(xe(()=>a.contentElementViewModel,()=>this._setExpressionContentVM(a,t),si),jre),e}_compileAttachments(e,t){const{graphic:i}=this,{description:r,title:s}=e;return this.contentViewModels[t]=new sY({graphic:i,...this._compileTitleAndDesc({title:s,description:r})}),e}_compileCustom(e,t){const{graphic:i}=this,{creator:r,destroyer:s}=e;return this.contentViewModels[t]=new t5({graphic:i,creator:r,destroyer:s}),e}_compileTitleAndDesc({title:e,description:t}){const{_fieldInfoMap:i,_sourceLayer:r,graphic:s,formattedAttributes:n,_expressionAttributes:o}=this,{attributes:a}=s,l=n.global;return{title:Gw({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:e}),description:Gw({attributes:a,fieldInfoMap:i,globalAttributes:l,expressionAttributes:o,layer:r,text:t})}}_createFieldsVMParams(e,t){var c;const{_effectivePopupTemplate:i,formattedAttributes:r}=this,s={...r.global,...r.content[t]},n=(c=(e==null?void 0:e.fieldInfos)||(i==null?void 0:i.fieldInfos))==null?void 0:c.filter(({fieldName:h})=>Mye(h)||by(h)||s.hasOwnProperty(h)),o=i==null?void 0:i.expressionInfos,{description:a,title:l}=e;return{attributes:s,expressionInfos:o,fieldInfos:n,...this._compileTitleAndDesc({title:l,description:a})}}_compileFields(e,t){const i=e.clone(),r=new wU(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=r,i.fieldInfos=r.formattedFieldInfos.slice(0),i}_createMediaVMParams(e,t){const{abilities:i,graphic:r,_fieldInfoMap:s,formattedAttributes:n,_effectivePopupTemplate:o,relatedInfos:a,_sourceLayer:l,_expressionAttributes:c}=this,{attributes:h}=r,{description:p,mediaInfos:m,title:g}=e;return{abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:h,layer:l,fieldInfoMap:s,formattedAttributes:{...n.global,...n.content[t]},expressionAttributes:c,mediaInfos:m,popupTemplate:o,relatedInfos:a,...this._compileTitleAndDesc({title:g,description:p})}}_compileMedia(e,t){const i=e.clone(),r=new Hw(this._createMediaVMParams(e,t));return i.mediaInfos=r.formattedMediaInfos.slice(0),this.contentViewModels[t]=r,i}_createTextVMParams(e){const{graphic:t,_fieldInfoMap:i,_sourceLayer:r,_expressionAttributes:s}=this;if(e&&e.text){const{attributes:n}=t,o=this.formattedAttributes.global;e.text=Gw({attributes:n,fieldInfoMap:i,globalAttributes:o,expressionAttributes:s,layer:r,text:e.text})}return{graphic:t,creator:e.text}}_compileText(e,t){const i=e.clone();return this.contentViewModels[t]=new t5(this._createTextVMParams(i)),i}_compileLastEditInfo(){const{_effectivePopupTemplate:e,_sourceLayer:t,graphic:i}=this;if(!e)return;const{lastEditInfoEnabled:r}=e,s=t==null?void 0:t.editFieldsInfo;return r&&s?e4e(s,i.attributes):void 0}_compileTitle(e){const{_fieldInfoMap:t,_sourceLayer:i,graphic:r,_expressionAttributes:s}=this,{attributes:n}=r,o=this.formattedAttributes.global;return Gw({attributes:n,fieldInfoMap:t,globalAttributes:o,expressionAttributes:s,layer:i,text:e})}async _getTitle(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.title;return K4(i,{graphic:t})}async _getContent(){const{_effectivePopupTemplate:e,graphic:t}=this,i=e==null?void 0:e.content;return K4(i,{graphic:t})}async _queryFeature(e){const{_featureAbortController:t,_sourceLayer:i,graphic:r,_effectivePopupTemplate:s,spatialReference:n,map:o,view:a}=this,{content:{value:l},title:{value:c}}=await cl({content:this._getContent(),title:this._getTitle()});if(t!==this._featureAbortController||!r)return;await s4e({graphic:r,popupTemplate:s,layer:i,spatialReference:n},e);const{expressionAttributes:{value:h}}=await cl({checkForRelatedFeatures:this._checkForRelatedFeatures(e),expressionAttributes:F9e({expressionInfos:s==null?void 0:s.expressionInfos,spatialReference:n,graphic:r,map:o,interceptor:aF.interceptor,view:a})});t===this._featureAbortController&&r&&(this._expressionAttributes=h,this._graphicExpressionAttributes={...r.attributes,...h},this._set("formattedAttributes",this._createFormattedAttributes(l)),this._set("title",this._compileTitle(c)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(l)||null))}_createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){const{_effectivePopupTemplate:r,graphic:s,relatedInfos:n,_sourceLayer:o,_fieldInfoMap:a,_graphicExpressionAttributes:l}=this;i.content[t]=$V({fieldInfos:r==null?void 0:r.fieldInfos,graphic:s,attributes:{...l,...e.attributes},layer:o,fieldInfoMap:a,relatedInfos:n})}_createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:i}){if(e.fieldInfos){const{graphic:r,relatedInfos:s,_sourceLayer:n,_fieldInfoMap:o,_graphicExpressionAttributes:a}=this;i.content[t]=$V({fieldInfos:e.fieldInfos,graphic:r,attributes:{...a,...e.attributes},layer:n,fieldInfoMap:o,relatedInfos:s})}}_createFormattedAttributes(e){const{_effectivePopupTemplate:t,graphic:i,relatedInfos:r,_sourceLayer:s,_fieldInfoMap:n,_graphicExpressionAttributes:o}=this,a=t==null?void 0:t.fieldInfos,l={global:$V({fieldInfos:a,graphic:i,attributes:o,layer:s,fieldInfoMap:n,relatedInfos:r}),content:[]};return Array.isArray(e)&&e.forEach((c,h)=>{c.type==="fields"&&this._createFieldsFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l}),c.type==="media"&&this._createMediaFormattedAttributes({contentElement:c,contentElementIndex:h,formattedAttributes:l})}),l}_checkForRelatedFeatures(e){const{graphic:t,_effectivePopupTemplate:i}=this;return this._queryRelatedInfos(t,kte(i),e)}async _queryRelatedInfos(e,t,i){const{relatedInfos:r,_sourceLayer:s}=this;r.clear();const n=w(s.associatedLayer)?await s.associatedLayer.load(i):s;if(!n)return;const o=t.filter(c=>c&&by(c.fieldName));if(!o||!o.length)return;t.forEach(c=>this._configureRelatedInfo(c,n));const a=await pUe({relatedInfos:r,layer:n},i);Object.keys(a).forEach(c=>{var m;const h=r.get(c.toString()),p=(m=a[c])==null?void 0:m.value;h&&p&&(h.layerInfo=p.data)});const l=await fUe({graphic:e,relatedInfos:r,layer:n},i);Object.keys(l).forEach(c=>{var h;lUe((h=l[c])==null?void 0:h.value,r.get(c.toString()))})}_configureRelatedInfo(e,t){const{relatedInfos:i}=this,r=eH(e.fieldName);if(!r)return;const{layerId:s,fieldName:n}=r;if(!s)return;const o=i.get(s.toString())||aUe(s,t);o&&(mUe({relatedInfo:o,fieldName:n,fieldInfo:e}),this.relatedInfos.set(s,o))}};Bs.interceptor=new z9e(a4e,l4e),u([f()],Bs.prototype,"_error",void 0),u([f()],Bs.prototype,"_featureAbortController",void 0),u([f({readOnly:!0})],Bs.prototype,"_effectivePopupTemplate",null),u([f({readOnly:!0})],Bs.prototype,"_fieldInfoMap",null),u([f({readOnly:!0})],Bs.prototype,"_sourceLayer",null),u([f()],Bs.prototype,"abilities",void 0),u([pi("abilities")],Bs.prototype,"castAbilities",null),u([f({readOnly:!0})],Bs.prototype,"content",void 0),u([f({readOnly:!0})],Bs.prototype,"contentViewModels",void 0),u([f({type:Boolean})],Bs.prototype,"defaultPopupTemplateEnabled",void 0),u([f({readOnly:!0})],Bs.prototype,"state",null),u([f({readOnly:!0})],Bs.prototype,"formattedAttributes",void 0),u([f({type:ul,value:null})],Bs.prototype,"graphic",null),u([f({readOnly:!0})],Bs.prototype,"lastEditInfo",void 0),u([f({readOnly:!0})],Bs.prototype,"relatedInfos",void 0),u([f()],Bs.prototype,"spatialReference",null),u([f({readOnly:!0})],Bs.prototype,"title",void 0),u([f()],Bs.prototype,"map",null),u([f({readOnly:!0})],Bs.prototype,"waitingForContent",null),u([f()],Bs.prototype,"view",void 0),Bs=aF=u([B(xve)],Bs);const KY=Bs,Tve=e=>{let t=class extends e{constructor(){super(...arguments),this.renderNodeContent=i=>zye(i)&&!i.destroyed?Te("div",{key:i},i.render()):i instanceof HTMLElement?Te("div",{key:i,bind:i,afterCreate:this._attachToNode}):A4e(i)?Te("div",{key:i,bind:i.domNode,afterCreate:this._attachToNode}):null}_attachToNode(i){const r=this;i.appendChild(r)}};return t=u([B("esri.widgets.Feature.ContentMixin")],t),t},fa={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"},qre={title:!0,content:!0,lastEditedInfo:!0};let ba=class extends Tve(dl){constructor(e,t){super(e,t),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements={...qre},this.map=null,this.view=null,this.viewModel=new KY}initialize(){this.own(xe(()=>{var e;return(e=this.viewModel)==null?void 0:e.contentViewModels},()=>this._setupContentWidgets(),si))}loadDependencies(){return _e(()=>import("./calcite-notice.5c061dff.js"),[],import.meta.url)}destroy(){this._destroyContentWidgets()}castVisibleElements(e){return{...qre,...e}}render(){const{state:e}=this.viewModel,t=Te("div",{class:fa.container,key:"container"},this.renderTitle(),e==="error"?this.renderError():e==="loading"?this.renderLoading():this.renderContentContainer());return Te("div",{class:this.classes(fa.base,fa.esriWidget)},t)}setActiveMedia(e,t){this.viewModel.setActiveMedia(e,t)}nextMedia(e){this.viewModel.nextMedia(e)}previousMedia(e){this.viewModel.previousMedia(e)}renderError(){const{messagesCommon:e,messages:t,visibleElements:i}=this;return Te("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},i.title?Te("div",{key:"error-title",slot:"title"},e.errorMessage):null,Te("div",{key:"error-message",slot:"message"},t.loadingError))}renderLoading(){return Te("div",{key:"loading-container",class:fa.loadingSpinnerContainer},Te("span",{class:this.classes(fa.iconLoading,fa.spinner)}))}renderContentContainer(){const{visibleElements:e}=this;return e.content?Te("div",{class:fa.main},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:e,title:t}=this;return e.title?Te(nY,{level:this.headingLevel,class:fa.title,innerHTML:t}):null}renderContent(){const e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?Te("div",{key:`${t}-content-elements`},e.map(this.renderContentElement,this)):null;if(typeof e=="string"){const i=this._contentWidgets[0];return!i||i.destroyed?null:Te("div",{key:`${t}-content`},i.render())}return this.renderNodeContent(e)}renderContentElement(e,t){const{visibleElements:i}=this;if(typeof i.content!="boolean"&&!i.content[e.type])return null;switch(e.type){case"attachments":return this.renderAttachments(t);case"custom":return this.renderCustom(e,t);case"fields":return this.renderFields(t);case"media":return this.renderMedia(t);case"text":return this.renderText(e,t);case"expression":return this.renderExpression(t);default:return null}}renderAttachments(e){const t=this._contentWidgets[e];if(!t||t.destroyed)return null;const{state:i,attachmentInfos:r}=t.viewModel;return i==="loading"||r.length>0?Te("div",{key:this._buildKey("attachments-element",e),class:this.classes(fa.contentElement)},t.render()):null}renderExpression(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Te("div",{key:this._buildKey("expression-element",e),class:fa.contentElement},t.render())}renderCustom(e,t){const{creator:i}=e,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Te("div",{key:this._buildKey("custom-element",t),class:fa.contentElement},r.render()):null}renderFields(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Te("div",{key:this._buildKey("fields-element",e),class:fa.contentElement},t.render())}renderMedia(e){const t=this._contentWidgets[e];return!t||t.destroyed?null:Te("div",{key:this._buildKey("media-element",e),class:fa.contentElement},t.render())}renderLastEditInfo(){const{visibleElements:e,messages:t}=this,{lastEditInfo:i}=this.viewModel;if(!i||!e.lastEditedInfo)return null;const{date:r,user:s}=i,n=i.type==="edit"?s?t.lastEditedByUser:t.lastEdited:s?t.lastCreatedByUser:t.lastCreated,o=kg(n,{date:r,user:s});return Te("div",{key:"edit-info-element",class:this.classes(fa.lastEditedInfo,fa.contentElement)},o)}renderText(e,t){const i=e.text,r=this._contentWidgets[t];return!r||r.destroyed?null:i?Te("div",{key:this._buildKey("text-element",t),class:this.classes(fa.contentElement,fa.text)},r.render()):null}_buildKey(e,...t){return`${e}__${this.get("viewModel.graphic.uid")||"0"}-${t.join("-")}`}_destroyContentWidget(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(e=>this._destroyContentWidget(e)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:e,visibleElements:t}=this,i=this.get("viewModel.content"),{contentViewModels:r}=this.viewModel;if(Array.isArray(i))i.forEach((s,n)=>{s.type==="attachments"&&(this._contentWidgets[n]=new _4e({displayType:s.displayType,headingLevel:t.title?e+1:e,viewModel:r[n]})),s.type==="fields"&&(this._contentWidgets[n]=new Bye({viewModel:r[n]})),s.type==="media"&&(this._contentWidgets[n]=new b0e({viewModel:r[n]})),s.type==="text"&&(this._contentWidgets[n]=new kN({viewModel:r[n]})),s.type==="custom"&&(this._contentWidgets[n]=new kN({viewModel:r[n]})),s.type==="expression"&&(this._contentWidgets[n]=new U9e({viewModel:r[n]}))},this);else{const s=r[0];s&&!s.destroyed&&(this._contentWidgets[0]=new kN({viewModel:s}))}this.scheduleRender()}};u([Lt("viewModel.graphic")],ba.prototype,"graphic",void 0),u([Lt("viewModel.defaultPopupTemplateEnabled")],ba.prototype,"defaultPopupTemplateEnabled",void 0),u([f()],ba.prototype,"headingLevel",void 0),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ba.prototype,"label",void 0),u([f(),Hl("esri/widgets/Feature/t9n/Feature")],ba.prototype,"messages",void 0),u([f(),Hl("esri/t9n/common")],ba.prototype,"messagesCommon",void 0),u([f(),Hl("esri/widgets/support/t9n/uriUtils")],ba.prototype,"messagesURIUtils",void 0),u([Lt("viewModel.spatialReference")],ba.prototype,"spatialReference",void 0),u([Lt("viewModel.title")],ba.prototype,"title",void 0),u([f()],ba.prototype,"visibleElements",void 0),u([pi("visibleElements")],ba.prototype,"castVisibleElements",null),u([Lt("viewModel.map")],ba.prototype,"map",void 0),u([Lt("viewModel.view")],ba.prototype,"view",void 0),u([f({type:KY})],ba.prototype,"viewModel",void 0),ba=u([B("esri.widgets.Feature")],ba);const G9e=ba;var Sve;const lF=Symbol("anchorHandles");let Kb=class extends ks.EventedAccessor{constructor(e){super(e),this[Sve]=new xi,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[lF].add([Jl(()=>Cn(this.screenLocationEnabled?this.view:null,t=>[t.size,t.type==="3d"?t.camera:t.viewpoint]),()=>this.notifyChange("screenLocation")),xe(()=>this.screenLocation,(t,i)=>{w(t)&&w(i)&&this.emit("view-change")})])}destroy(){this.view=null,this[lF]=Tt(this[lF])}get screenLocation(){const{location:e,view:t,screenLocationEnabled:i}=this;return i&&w(e)&&w(t)&&t.ready?t.toScreen(e):null}};Sve=lF,u([f()],Kb.prototype,"location",void 0),u([f()],Kb.prototype,"screenLocation",null),u([f()],Kb.prototype,"screenLocationEnabled",void 0),u([f()],Kb.prototype,"view",void 0),Kb=u([B("esri.widgets.support.AnchorElementViewModel")],Kb);const Eve=Kb,j9e="esri.widgets.CompassViewModel";let cF=class extends Eve{constructor(e){super(e),this.visible=!1}};u([f()],cF.prototype,"visible",void 0),cF=u([B(j9e)],cF);const Cve=cF,b6={base:"esri-spinner",spinnerStart:"esri-spinner--start",spinnerFinish:"esri-spinner--finish"};let ew=class extends dl{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new Cve,this.visible=!1}initialize(){this.own([xe(()=>this.visible,e=>this._visibleChange(e))])}destroy(){this._animationPromise=null}show(e){const{location:t,promise:i}=e;t&&(this.viewModel.location=t),this.visible=!0;const r=()=>this.hide();i&&i.catch(()=>{}).then(r)}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,i=!!t,r=e&&i,s=!e&&i,n={[b6.spinnerStart]:r,[b6.spinnerFinish]:s},o=this._getPositionStyles();return Te("div",{class:this.classes(b6.base,n),styles:o})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=AE(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(N(t)||N(e))return{};const{padding:i}=t;return{left:e.x-i.left+"px",top:e.y-i.top+"px"}}};u([Lt("viewModel.location")],ew.prototype,"location",void 0),u([Lt("viewModel.view")],ew.prototype,"view",void 0),u([f({type:Cve})],ew.prototype,"viewModel",void 0),u([Lt("viewModel.visible")],ew.prototype,"visible",void 0),ew=u([B("esri.widgets.Spinner")],ew);const H9e=ew;var Wre;(function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"})(Wre||(Wre={}));function Ave(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function q9e(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function W9e(e,t,i,r,s,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=s,o[5]=n,o}function Z9e(e,t){return new Float32Array(e,t,6)}function Ove(e,t,i,r){const s=t[r],n=t[r+1];e[r]=i[0]*s+i[2]*n+i[4],e[r+1]=i[1]*s+i[3]*n+i[5]}function X9e(e,t,i,r=0,s=0,n=2){const o=s||t.length/n;for(let a=r;a<o;a++)Ove(e,t,i,a*n)}Object.freeze(Object.defineProperty({__proto__:null,create:Ave,clone:q9e,fromValues:W9e,createView:Z9e,transform:Ove,transformMany:X9e},Symbol.toStringTag,{value:"Module"}));function Y9e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Q9e(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function J9e(e,t,i,r,s,n,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e}function Rve(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5];let l=i*n-r*s;return l?(l=1/l,e[0]=n*l,e[1]=-r*l,e[2]=-s*l,e[3]=i*l,e[4]=(s*a-n*o)*l,e[5]=(r*o-i*a)*l,e):null}function K9e(e){return e[0]*e[3]-e[1]*e[2]}function Mve(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1],p=i[2],m=i[3],g=i[4],v=i[5];return e[0]=r*c+n*h,e[1]=s*c+o*h,e[2]=r*p+n*m,e[3]=s*p+o*m,e[4]=r*g+n*v+a,e[5]=s*g+o*v+l,e}function eQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+n*c,e[1]=s*h+o*c,e[2]=r*-c+n*h,e[3]=s*-c+o*h,e[4]=a,e[5]=l,e}function Pve(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r*c,e[1]=s*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function tQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=r*c+n*h+a,e[5]=s*c+o*h+l,e}function eGe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e}function tGe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function iQ(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function iGe(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function rGe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function sGe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e}function Ive(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}function nGe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e}function oGe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e}function aGe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function lGe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=t[0],c=t[1],h=t[2],p=t[3],m=t[4],g=t[5];return Math.abs(i-l)<=Gt*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=Gt*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(s-h)<=Gt*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(n-p)<=Gt*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-m)<=Gt*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(a-g)<=Gt*Math.max(1,Math.abs(a),Math.abs(g))}const cGe=Mve,uGe=Ive;Object.freeze(Object.defineProperty({__proto__:null,copy:Y9e,identity:Q9e,set:J9e,invert:Rve,determinant:K9e,multiply:Mve,rotate:eQ,scale:Pve,translate:tQ,fromRotation:eGe,fromScaling:tGe,fromTranslation:iQ,str:iGe,frob:rGe,add:sGe,subtract:Ive,multiplyScalar:nGe,multiplyScalarAndAdd:oGe,exactEquals:aGe,equals:lGe,mul:cGe,sub:uGe},Symbol.toStringTag,{value:"Module"}));const Zre=Ce("android");Ce("chrome")||Zre&&Zre>=4;wj();function Lve(e){return e&&"opacity"in e?e.opacity*Lve(e.parent):1}async function hGe(e,t){var S;if(!e)return;const i=e.sourceLayer,r=(S=w(t)&&t.useSourceLayer?i:e.layer)!=null?S:i,s=Lve(r);if(w(e.symbol)&&(!w(t)||t.ignoreGraphicSymbol!==!0)){const T=e.symbol.type==="web-style"?await e.symbol.fetchSymbol({...t,cache:w(t)?t.webStyleCache:null}):e.symbol.clone();return kV(T,null,s),T}const n=w(t)&&t.renderer||r&&"renderer"in r&&r.renderer;let o=n&&"getSymbolAsync"in n?await n.getSymbolAsync(e,t):null;if(!o)return;if(o=o.type==="web-style"?await o.fetchSymbol({...t,cache:w(t)?t.webStyleCache:null}):o.clone(),!("visualVariables"in n)||!n.visualVariables||!n.visualVariables.length)return kV(o,null,s),o;if("arcadeRequiredForVisualVariables"in n&&n.arcadeRequiredForVisualVariables&&(N(t)||N(t.arcade))){const T={...t};T.arcade=await Em(),t=T}const a=await _e(()=>Promise.resolve().then(()=>kY),void 0,import.meta.url),l=[],c=[],h=[],p=[];for(const T of n.visualVariables)switch(T.type){case"color":l.push(T);break;case"opacity":c.push(T);break;case"rotation":p.push(T);break;case"size":T.target||h.push(T)}const m=!!l.length&&l[l.length-1],g=m?a.getColor(m,e,t):null,v=!!c.length&&c[c.length-1];let b=v?a.getOpacity(v,e,t):null;if(s!=null&&(b=b!=null?b*s:s),kV(o,g,b),h.length){const T=a.getAllSizes(h,e,t);await I5e(o,T)}for(const T of p)L5e(o,a.getRotationAngle(T,e,t),T.axis);return o}class Wy{constructor(t,i){this.owner=i,this.properties={},this.afterDispatchHandle=null;for(const r in t){const s=t[r],n=new Dhe(s,null,null,2,2);this.properties[r]={pool:n,acquired:[]}}this.afterDispatchHandle=Zhe(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const t in this.properties){const i=this.properties[t];for(const r of i.acquired)jK(r)||i.pool.release(r);i.pool.destroy(),i.pool=null,i.acquired=null}this.properties=null,this.owner=null}get(t){const i=this.owner._get(t),r=this.properties[t];let s=r.pool.acquire();for(r.acquired.push(s);s===i;)r.acquired.push(s),s=r.pool.acquire();return s}_release(){for(const t in this.properties){const i=this.properties[t];let r=0;for(const s of i.acquired)jK(s)?i.acquired[r++]=s:i.pool.release(s);i.acquired.length=r}}}const dGe=Ce("mac")?"Meta":"Ctrl",VU={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let e=48;e<58;e++)VU[e]=String.fromCharCode(e);for(let e=1;e<25;e++)VU[111+e]=`F${e}`;for(let e=65;e<91;e++)VU[e]=[String.fromCharCode(e+32),String.fromCharCode(e)];function pGe(e){if(e.key!==void 0)return bw(e);const t=VU[e.keyCode];return Array.isArray(t)?e.shiftKey?t[1]:t[0]:t}function fGe(e){switch(e){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}class mGe{constructor(t,i=[]){this.eventType=t,this.keyModifiers=i}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const i=t.modifiers;for(const r of this.keyModifiers)if(!i.has(r))return!1;return!0}}const Xre=Ie.getLogger("esri.views.input.InputHandler");class ua{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const i=this._incoming[t];for(const r of i)this._incomingEventMatches.push(r.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager?Xre.error("This InputHandler has already been registered with an InputManager"):(t.setEventCallback(i=>this._handleEvent(i)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,i,r){let s;typeof i=="function"?(r=i,s=[]):s=i||[];const n=typeof t=="string"?new mGe(t,s):t,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=h=>{const p=this._incoming[h.match.eventType];if(p){const m=p.indexOf(h);p.splice(m,1),o(),this._manager&&this._manager.updateDependencies()}},l=new gGe(n,r,{onPause:a,onRemove:a,onResume:h=>{const p=this._incoming[h.match.eventType];p&&!p.includes(h)&&(p.push(h),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[n.eventType];return c||(c=[],this._incoming[n.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(t){if(this._outgoing[t])throw Error("There is already a callback registered for this outgoing InputEvent: "+t);const i=new yGe(t,{onEmit:(r,s,n,o)=>{this._manager.emit(r.eventType,s,n,o)},onRemove:r=>{delete this._outgoing[r.eventType],this._manager.updateDependencies()}});return this._outgoing[t]=i,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),i}startCapturingPointer(t){this._manager.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):Xre.error("This InputHandler is not registered with an InputManager")}_handleEvent(t){const i=this._incoming[t.type];if(i){for(const r of i)if(r.match.matches(t)&&(r.callback(t),t.shouldStopPropagation()))break}}}class gGe{constructor(t,i,r){this.match=t,this._callback=i,this._handler=r}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class yGe{constructor(t,i){this.eventType=t,this._removed=!1,this._handler=i}emit(t,i,r){this._removed||this._handler.onEmit(this,t,i,r)}remove(){this._removed=!0,this._handler.onRemove(this)}}class _Ge extends ua{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",i=>{const r=i.data.native.pointerType==="touch";this._setValue(r?"touch":"mouse",i.data.x,i.data.y)})}_setValue(t,i,r){t===this._value&&this._x===i&&this._y===r||(this._value=t,this._x=i,this._y=r,this._onChange(t,i,r))}}const w6=Ie.getLogger("esri.views.input.InputManager");let N_=class extends ze{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=dGe,this.latestPointerType="mouse",this._propertiesPool=new Wy({latestPointerLocation:bGe},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const t of e)this.uninstallHandlers(t);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}installHandlers(e,t,i=Gv.INTERNAL){if(this._nameToGroup[e])return void w6.error("There is already an InputHandler group registered under the name `"+e+"`");if(t.length===0)return void w6.error("Can't register a group of zero handlers");const r={name:e,handlers:t.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=r;for(let s=r.handlers.length-1;s>=0;s--){const n=r.handlers[s];this._handlers.push(n),n.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,l,c,h)=>{this._emitInputEvent(n.priorityIndex+1,o,a,l,h,c)},setPointerCapture:(o,a)=>{this._setPointerCapture(r,n,o,a)},setEventCallback:o=>{n.eventCallback=o},setUninstallCallback:o=>{n.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const t=this._nameToGroup[e];t?(t.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback()}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):w6.error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,t=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const r=this._handlers[i];r.priorityIndex=i,this._handlersPriority.push(r)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const r=this._handlersPriority[i];r.priorityIndex=i;let s=r.handler.hasSideEffects;if(!s){for(const n of r.handler.outgoingEventTypes)if(e.has(n)){s=!0;break}}if(s)for(const n of r.handler.incomingEventMatches){e.add(n.eventType);for(const o of n.keyModifiers)fGe(o)||t.add(o)}r.active=s}this._sourceEvents=e,this._keyModifiers=t,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,t,i){this._get("latestPointerType")!==e&&this._set("latestPointerType",e);const r=this._get("latestPointerLocation");if(N(r)||r.x!==t||r.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=t,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,t){if(e==="pointer-capture-lost"){const s=t;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,t);const i=this.test.timestamp!=null?this.test.timestamp:t.native?t.native.timestamp:void 0,r=t.native?t.native.cancelable:void 0;this._emitInputEventFromSource(e,t,i,r)}_updateKeyModifiers(e,t){if(!t)return;let i=!1;const r=()=>{if(!i){const o=new Set;this._activeKeyModifiers.forEach(a=>{o.add(a)}),this._activeKeyModifiers=o,i=!0}},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(r(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(r(),this._activeKeyModifiers.delete(o))};if(e==="key-down"||e==="key-up"){const o=t.key;this._keyModifiers.has(o)&&s(o,e==="key-down")}const n=t.native;s("Alt",!(!n||!n.altKey)),s("Ctrl",!(!n||!n.ctrlKey)),s("Shift",!(!n||!n.shiftKey)),s("Meta",!(!n||!n.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new _Ge((e,t,i)=>this._setLatestPointer(e,t,i)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],Gv.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Gv.INTERNAL)}_setPointerCapture(e,t,i,r){const s=e.name+"-"+t.priorityIndex,n=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,n),r?(n.add(s),n.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):n.has(s)&&(n.delete(s),n.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,t,i,r){this._emitInputEvent(0,e,t,i,r)}_emitInputEvent(e,t,i,r,s,n){const o=r!==void 0?r:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,l={event:new vGe(t,i,o,n||this._activeKeyModifiers,a),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(l):this._doNewPropagation(l)}_doNewPropagation(e){this._currentPropagation={events:new Z7,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){const e=this._currentPropagation;if(e){for(;this._currentPropagation.events.length>0;){const{event:t,priorityIndex:i}=this._currentPropagation.events.pop(),r=t.data&&t.data.eventId;if(!(r!=null&&this._stoppedPropagationEventIds.has(r)))for(e.currentHandler=this._handlersPriority[i];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!t.shouldStopPropagation()&&e.currentHandler.eventCallback(t),t.shouldStopPropagation()){r!=null&&this._stoppedPropagationEventIds.add(r);break}if(t.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:t,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const t=new Z7;for(t.push(e);this._currentPropagation.events.length;)t.push(this._currentPropagation.events.pop());this._currentPropagation.events=t,this._currentPropagation.currentHandler=null}_compareHandlerPriority(e,t){if(e.handler.hasSideEffects!==t.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==t.groupPriority)return e.groupPriority>t.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const r of t.handler.incomingEventMatches){if(i.eventType!==r.eventType)continue;const s=i.keyModifiers.filter(n=>r.keyModifiers.includes(n));if(s.length===i.keyModifiers.length!=(s.length===r.keyModifiers.length))return i.keyModifiers.length>r.keyModifiers.length?-1:1}return e.priorityIndex>t.priorityIndex?-1:1}_sortHandlersPriority(e){const t=[];for(const i of e){let r=0;for(;r<t.length&&this._compareHandlerPriority(i,t[r])>=0;)r++;t.splice(r,0,i)}return t}get debug(){const e=t=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},t(),this._setPointerCapture=i};return{injectEvent:(t,i)=>{e(()=>{this._onEventReceived(t,i)})},disablePointerCapture:e}}};u([f({readOnly:!0})],N_.prototype,"hasPendingInputs",null),u([f()],N_.prototype,"eventSource",void 0),u([f()],N_.prototype,"recognizers",void 0),u([f({readOnly:!0})],N_.prototype,"latestPointerType",void 0),u([f({readOnly:!0})],N_.prototype,"latestPointerLocation",void 0),N_=u([B("esri.views.input.InputManager")],N_);class vGe{constructor(t,i,r,s,n){this.type=t,this.data=i,this.timestamp=r,this.modifiers=s,this.cancelable=n,this._propagationState=tv.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=tv.STOPPED}shouldStopPropagation(){return(this._propagationState&tv.STOPPED)!=0}async(t){this._propagationState|=tv.PAUSED;const i=(r,s)=>{this._propagationState&=~tv.PAUSED;const n=this._resumeCallback;if(this._resumeCallback=null,n&&n(),s)throw r;return r};return(typeof t=="function"?t():t).then(r=>i(r,!1),r=>i(r,!0))}shouldPausePropagation(t){return!!(this._propagationState&tv.PAUSED)&&(this._resumeCallback=t,!0)}preventDefault(){this.data.native.preventDefault()}}var tv;(function(e){e[e.NONE=0]="NONE",e[e.STOPPED=1]="STOPPED",e[e.PAUSED=2]="PAUSED"})(tv||(tv={}));const Gv={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class bGe{}function Yre(e){return e&&typeof e.highlight=="function"}function wGe(e){return e&&typeof e.maskOccludee=="function"}function fbt(e,t,i){return N(e)||e>i&&(t===0||e<t)}function mbt(e,t){return e>0||t>0}function gbt(e){var i,r;const t=e.effectiveScaleRange;return{minScale:(i=t==null?void 0:t.minScale)!=null?i:0,maxScale:(r=t==null?void 0:t.maxScale)!=null?r:0}}const GU={iconZoom:"esri-icon-zoom-in-magnifying-glass",iconTrash:"esri-icon-trash",iconBrowseClusteredFeatures:"esri-icon-table"},Ww=new kC({id:"zoom-to-feature",title:"{messages.zoom}",className:GU.iconZoom}),Qre=new kC({id:"remove-selected-feature",title:"{messages.remove}",className:GU.iconTrash}),F2=new kC({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:GU.iconZoom}),k2=new kC({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:GU.iconBrowseClusteredFeatures}),xGe="esri.widgets.Popup.PopupViewModel",f5=Ie.getLogger(xGe),TGe=e=>{const{event:t,view:i}=e,{action:r}=t,s=i&&i.popup;if(!r)return Promise.reject(new se("trigger-action:missing-arguments","Event has no action"));if(!s)return Promise.reject(new se("trigger-action:missing-arguments","view.popup is missing"));const{disabled:n,id:o}=r;if(!o)return Promise.reject(new se("trigger-action:invalid-action","action.id is missing"));if(n)return Promise.reject(new se("trigger-action:invalid-action","Action is disabled"));if(o===Ww.id)return EGe(s.viewModel).catch(sG);if(o===F2.id)return CGe(s.viewModel);if(o===k2.id)return s.featureMenuOpen=!s.featureMenuOpen,s.viewModel.browseClusterEnabled=!s.viewModel.browseClusterEnabled,Promise.resolve();if(s.viewModel.browseClusterEnabled=!1,o===Qre.id){s.close();const{selectedFeature:a}=s;if(!a)return Promise.reject(new se(`trigger-action:${Qre.id}`,"selectedFeature is required",{selectedFeature:a}));const{sourceLayer:l}=a;return l?l.remove(a):i.graphics.remove(a),Promise.resolve()}return Promise.resolve()};function $ve(e){const{selectedFeature:t,location:i,view:r}=e;return r?r.type==="3d"?t||i:e.get("selectedFeature.geometry")||i:null}function Ow(e){var t,i;return(e==null?void 0:e.isAggregate)&&((i=(t=e==null?void 0:e.sourceLayer)==null?void 0:t.featureReduction)==null?void 0:i.type)==="cluster"}function SGe(e,t){if((t==null?void 0:t.type)!=="3d"||!e||e.declaredClass!=="esri.Graphic")return!0;const i=t.getViewForGraphic(e);if(i&&"whenGraphicBounds"in i){let r=!1;return i.whenGraphicBounds(e,{useViewElevation:!0}).then(s=>{r=!s||!s.boundingBox||s.boundingBox[0]===s.boundingBox[3]&&s.boundingBox[1]===s.boundingBox[4]&&s.boundingBox[2]===s.boundingBox[5]}).catch(()=>{const s=new se("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:e});f5.error(s)}),r}return!0}async function EGe(e){const{location:t,selectedFeature:i,view:r,zoomFactor:s}=e,n=$ve(e);if(!n){const c=new se("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:n,view:r});throw f5.error(c),c}const o=r.scale/s,a=e.get("selectedFeature.geometry")||t,l=a&&a.type==="point"&&SGe(i,r);Ww.active=!0,Ww.disabled=!0;try{await e.view.goTo({target:n,scale:l?o:void 0})}finally{Ww.active=!1,Ww.disabled=!1,e.zoomToLocation=null,l&&(e.location=a)}}async function CGe(e){const{selectedFeature:t,view:i}=e;if((i==null?void 0:i.type)!=="2d"){const a=new se("zoomToCluster:invalid-view","View must be 2d MapView.",{view:i});throw f5.error(a),a}if(!Ow(t)){const a=new se("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:t});throw f5.error(a),a}const r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],F2.active=!0,F2.disabled=!0;const{extent:o}=await s.queryExtent(n);await i.goTo({target:o}),F2.active=!1,F2.disabled=!1}async function AGe(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()];const{extent:o}=await s.queryExtent(n);e.selectedClusterBoundaryFeature.geometry=o,i.graphics.add(e.selectedClusterBoundaryFeature)}async function OGe(e){const{selectedFeature:t,view:i}=e,r=t.sourceLayer,s=await i.whenLayerView(r),n=s.createQuery();n.aggregateIds=[t.getObjectId()],k2.active=!0,k2.disabled=!0;const{features:o}=await s.queryFeatures(n);k2.active=!1,k2.disabled=!1,i.popup.open({features:[t].concat(o),featureMenuOpen:!0})}function RGe(e){const t=e.features.filter(i=>Ow(i));t.length&&(e.features=t)}const Dve=e=>{let t=class extends e{constructor(...i){super(...i),this.goToOverride=null,this.view=null}callGoTo(i){const{view:r}=this;return this.goToOverride?this.goToOverride(r,i):r.goTo(i.target,i.options)}};return u([f()],t.prototype,"goToOverride",void 0),u([f()],t.prototype,"view",void 0),t=u([B("esri.widgets.support.GoTo")],t),t},DM=zt.ofType({key:"type",defaultKeyValue:"button",base:Vk,typeMap:{button:kC,toggle:Ape}}),MGe=()=>[Ww.clone()],PGe=()=>[F2.clone(),k2.clone()],Nve="esri.widgets.Popup.PopupViewModel",s$=Ie.getLogger(Nve);let qi=class extends Dve(Eve){constructor(e){super(e),this._handles=new xi,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new DM,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ul({symbol:new b1({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(e=>e.waitingForContent)}initialize(){this._handles.add([xe(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),xe(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),xe(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),xe(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.animation)==null?void 0:t.state},e=>this._animationStateChange(e)),xe(()=>this.location,e=>this._locationChange(e)),xe(()=>this.selectedFeature,e=>this._selectedFeatureChange(e)),xe(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),xe(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),xe(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",e=>TGe({event:e,view:this.view})),Jl(()=>!this.waitingForResult,()=>this._waitingForResultChange(),Rr),xe(()=>{var e,t;return[this.features,(e=this.view)==null?void 0:e.map,(t=this.view)==null?void 0:t.spatialReference]},()=>this._updateFeatureVMs()),xe(()=>{var e;return(e=this.view)==null?void 0:e.scale},()=>this._viewScaleChange()),Jl(()=>!this.visible,()=>this.browseClusterEnabled=!1),xe(()=>this.browseClusterEnabled,e=>e?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const e=this._get("allActions")||new DM;e.removeAll();const{actions:t,defaultActions:i,defaultPopupTemplateEnabled:r,includeDefaultActions:s,selectedFeature:n}=this,o=s?i.concat(t):t,a=n&&(typeof n.getEffectivePopupTemplate=="function"&&n.getEffectivePopupTemplate(r)||n.popupTemplate),l=a&&a.actions,c=a&&a.overwriteActions?l:l?l.concat(o):o;return c&&c.filter(Boolean).forEach(h=>e.add(h)),e}get defaultActions(){const e=this._get("defaultActions")||new DM;return e.removeAll(),e.addMany(Ow(this.selectedFeature)?PGe():MGe()),e}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(e){const t=e||[];this._set("features",t);const{pendingPromisesCount:i,promiseCount:r,selectedFeatureIndex:s}=this,n=r&&t.length;n&&i&&s===-1?this.selectedFeatureIndex=0:n&&s!==-1||(this.selectedFeatureIndex=t.length?0:-1)}get location(){return this._get("location")||null}set location(e){const t=this.get("view.spatialReference.isWebMercator");e&&e.get("spatialReference.isWGS84")&&t&&(e=Ay(e)),this._set("location",e)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(!!this._fetchFeaturesController||this.pendingPromisesCount>0)||this.featureCount!==0)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(e){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(e)||!e.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",e),(e=e.slice(0)).forEach(t=>{this._pendingPromises.add(t);const i=s=>{this._pendingPromises.has(t)&&this._updateFeatures(s),this._updatePendingPromises(t)},r=()=>this._updatePendingPromises(t);t.then(i,r)}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:e,selectedFeatureIndex:t}=this;return t===-1?null:e[t]||null}get selectedFeatureIndex(){const e=this._get("selectedFeatureIndex");return typeof e=="number"?e:-1}set selectedFeatureIndex(e){const{featureCount:t}=this;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:e}=this,t=$ve(this);if(!t){const i=new se("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e});return s$.error(i),Promise.reject(i)}return this.callGoTo({target:{target:t,scale:e.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(e,t){const{view:i}=this;if(!i||!e){const r=new se("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:i});return s$.error(r),Promise.reject(r)}return i.fetchPopupFeatures(e,{event:t&&t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:t&&t.signal})}open(e){const t={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...e,visible:!0},{fetchFeatures:i}=t;delete t.fetchFeatures,i&&this._setFetchFeaturesPromises(t.location);const r=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const s of r)delete t[s];this.set(t)}triggerAction(e){const t=this.allActions.getItemAt(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){RGe(this),this._clearBrowsedClusterGraphics()}async enableClusterBrowsing(){const{view:e,selectedFeature:t}=this;(e==null?void 0:e.type)==="2d"?Ow(t)?(await AGe(this),await OGe(this)):s$.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",t):s$.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",t)}_animationStateChange(e){this.zoomToLocation||(Ww.disabled=e==="waiting-for-target")}_clearBrowsedClusterGraphics(){var t;const e=(t=this.view)==null?void 0:t.graphics;e&&(e.remove(this.selectedClusterBoundaryFeature),e.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Ow(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(e){const{selectedFeature:t,updateLocationEnabled:i}=this;i&&e&&(!t||t.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:e,featureCount:t,featurePage:i,featuresPerPage:r,featureViewModels:s}=this;if(i===null)return;const n=((i-1)*r+t)%t,o=n+r;s.slice(n,o).forEach((a,l)=>{a&&!a.graphic&&(a.graphic=e[n+l])})}async _selectedFeatureChange(e){if(!e)return;const{location:t,updateLocationEnabled:i,view:r}=this;if(this.browseClusterEnabled)return this._selectedClusterFeature&&(r.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),Ow(e)?void 0:(e.symbol=await hGe(e),this._selectedClusterFeature=e,void r.graphics.add(this._selectedClusterFeature));!i&&t||!e.geometry?i&&!e.geometry&&this.centerAtLocation().then(()=>{this.location=r.center.clone()}):this.location=this._getPointFromGeometry(e.geometry)}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(e){return this._fetchFeaturesWithController(this._getScreenPoint(e||this.location)).then(t=>{const{clientOnlyGraphics:i,promisesPerLayerView:r}=t,s=Promise.resolve(i),n=r.map(o=>o.promise);this.promises=[s,...n]})}_destroyFeatureVMs(){this.featureViewModels.forEach(e=>e&&!e.destroyed&&e.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:e,features:t,featureViewModels:i}=this;if(Ow(e)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!t||!t.length)return;const r=i.slice(0),s=[];t.forEach((n,o)=>{var l,c;if(!n)return;let a=null;if(r.some((h,p)=>(h&&h.graphic===n&&(a=h,r.splice(p,1)),!!a)),a)s[o]=a;else{const h=new KY({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:(l=this.view)==null?void 0:l.spatialReference,graphic:n===e?n:null,map:(c=this.view)==null?void 0:c.map,view:this.view});s[o]=h}}),r.forEach(n=>n&&!n.destroyed&&n.destroy()),this._set("featureViewModels",s)}_getScreenPoint(e){const{view:t}=this;return t&&e&&typeof t.toScreen=="function"?t.toScreen(e):null}_autoOpenEnabledChange(){const e="auto-fetch-features",{_handles:t,autoOpenEnabled:i}=this;if(t.remove(e),i&&this.view){const r=this.view.on("click",s=>{s.pointerType==="mouse"&&s.button!==0||this._fetchFeaturesAndOpen(s)},Gv.WIDGET);t.add(r,e)}}_cancelFetchingFeatures(){const e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(e,t){this._cancelFetchingFeatures();const i=new AbortController,{signal:r}=i;this._fetchFeaturesController=i,this.notifyChange("waitingForResult");const s=this.fetchFeatures(e,{signal:r,event:t});return s.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),s}_fetchFeaturesAndOpen(e){const{screenPoint:t,mapPoint:i}=e,{view:r}=this;this._fetchFeaturesWithController(t,e).then(s=>{const{clientOnlyGraphics:n,promisesPerLayerView:o,location:a}=s,l=[Promise.resolve(n),...o.map(c=>c.promise)];return r.popup.open({location:a||i,promises:l}),s})}_updatePendingPromises(e){e&&this._pendingPromises.has(e)&&(this._pendingPromises.delete(e),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(e){return N(e)?null:e.type==="point"?e:e.type==="extent"?e.center:e.type==="polygon"?e.centroid:e.type==="multipoint"||e.type==="polyline"?e.extent.center:null}async _getLayerView(e,t){return await e.when(),e.whenLayerView(t)}_getHighlightLayer(e){const{layer:t,sourceLayer:i}=e;return(i==null?void 0:i.type)==="map-notes"||(i==null?void 0:i.type)==="subtype-group"?i:t}_getHighlightTarget(e,t){const i=t.type==="imagery"?void 0:"objectIdField"in t&&t.objectIdField,r=e.attributes;return r&&i&&r[i]||e}async _highlightActiveFeature(){const e="highlight-active-feature";this._handles.remove(e);const{highlightEnabled:t,view:i,activeFeature:r,visible:s}=this;if(!(r&&i&&t&&s))return;const n=this._getHighlightLayer(r);if(!(n&&n instanceof h5))return;const o=this._getLayerView(i,n);this._highlightActiveFeaturePromise=o;const a=await o;if(!(a&&Yre(a)&&this._highlightActiveFeaturePromise===o&&this.activeFeature&&this.highlightEnabled))return;const l=a.highlight(this._getHighlightTarget(r,n));this._handles.add(l,e)}async _highlightSelectedFeature(){const e="highlight-selected-feature";this._handles.remove(e);const{selectedFeature:t,highlightEnabled:i,view:r,visible:s}=this;if(!(t&&r&&i&&s))return;const n=this._getHighlightLayer(t);if(!(n&&n instanceof h5))return;const o=this._getLayerView(r,n);this._highlightSelectedFeaturePromise=o;const a=await o;if(!(a&&Yre(a)&&this._highlightSelectedFeaturePromise===o&&this.selectedFeature&&this.highlightEnabled&&this.visible))return;const l=a.highlight(this._getHighlightTarget(t,n));this._handles.add(l,e)}_updateFeatures(e){const{features:t}=this;if(!e||!e.length)return;if(!t.length)return void(this.features=e);const i=e.filter(r=>!t.includes(r));this.features=t.concat(i)}};u([f()],qi.prototype,"featurePage",void 0),u([f()],qi.prototype,"isLoadingFeature",null),u([f({type:DM})],qi.prototype,"actions",void 0),u([f({readOnly:!0})],qi.prototype,"active",null),u([f()],qi.prototype,"activeFeature",void 0),u([f({readOnly:!0})],qi.prototype,"allActions",null),u([f({type:Boolean})],qi.prototype,"defaultPopupTemplateEnabled",void 0),u([f()],qi.prototype,"autoCloseEnabled",void 0),u([f()],qi.prototype,"autoOpenEnabled",void 0),u([f()],qi.prototype,"browseClusterEnabled",void 0),u([f()],qi.prototype,"content",void 0),u([f({type:DM,readOnly:!0})],qi.prototype,"defaultActions",null),u([f({readOnly:!0})],qi.prototype,"featureCount",null),u([f()],qi.prototype,"features",null),u([f()],qi.prototype,"featuresPerPage",void 0),u([f()],qi.prototype,"featureViewModelAbilities",void 0),u([f({readOnly:!0})],qi.prototype,"featureViewModels",void 0),u([f()],qi.prototype,"highlightEnabled",void 0),u([f()],qi.prototype,"includeDefaultActions",void 0),u([f({type:xt})],qi.prototype,"location",null),u([f({readOnly:!0})],qi.prototype,"pendingPromisesCount",null),u([f({readOnly:!0})],qi.prototype,"selectedClusterBoundaryFeature",void 0),u([f({readOnly:!0})],qi.prototype,"waitingForResult",null),u([f({readOnly:!0})],qi.prototype,"promiseCount",null),u([f()],qi.prototype,"promises",null),u([f({value:null,readOnly:!0})],qi.prototype,"selectedFeature",null),u([f({value:-1})],qi.prototype,"selectedFeatureIndex",null),u([f({readOnly:!0})],qi.prototype,"selectedFeatureViewModel",null),u([f({readOnly:!0})],qi.prototype,"state",null),u([f()],qi.prototype,"title",void 0),u([f()],qi.prototype,"updateLocationEnabled",void 0),u([f()],qi.prototype,"view",void 0),u([f()],qi.prototype,"visible",void 0),u([f()],qi.prototype,"zoomFactor",void 0),u([f()],qi.prototype,"zoomToLocation",void 0),u([f()],qi.prototype,"centerAtLocation",null),qi=u([B(Nve)],qi);const Fve=qi,Jre="selected-index",IGe=0,Kre="popup-spinner",We={iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",headerTitle:"esri-popup__header-title",content:"esri-popup__content",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button"},ese={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},tse="esri-popup";function yg(e,t){return t===void 0?`${tse}__${e}`:`${tse}__${e}-${t}`}const kve="esri.widgets.Popup",ise=Ie.getLogger(kve),rse={closeButton:!0,featureNavigation:!0};let Bt=class extends Tve(dl){constructor(e,t){super(e,t),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new xi,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([i])=>{i!=null&&i.isIntersecting&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=XX(()=>this._displaySpinner(),IGe),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Fve,this.visible=null,this.visibleElements={...rse},this._addSelectedFeatureIndexHandle(),this.own([xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},()=>this._positionContainer()),xe(()=>{var i;return[(i=this.viewModel)==null?void 0:i.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.screenLocation},(i,r)=>{!!i!=!!r&&this.reposition()}),xe(()=>{var i,r,s,n,o,a;return[(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.padding,(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.size,(o=this.viewModel)==null?void 0:o.active,(a=this.viewModel)==null?void 0:a.location,this.alignment]},()=>this.reposition()),xe(()=>this.spinnerEnabled,i=>this._spinnerEnabledChange(i)),xe(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.size},(i,r)=>this._updateDockEnabledForViewSize(i,r)),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.view},(i,r)=>this._viewChange(i,r)),xe(()=>{var i,r;return(r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.ready},(i,r)=>this._viewReadyChange(i,r)),xe(()=>{var i,r;return[(i=this.viewModel)==null?void 0:i.waitingForResult,(r=this.viewModel)==null?void 0:r.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),xe(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.title,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setTitleFromFeatureWidget()),xe(()=>{var i,r,s,n;return[(r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.content,(n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.state]},()=>this._setContentFromFeatureWidget()),Jl(()=>!this.collapsed,()=>{var i,r;((r=(i=this.viewModel)==null?void 0:i.view)==null?void 0:r.widthBreakpoint)==="xsmall"&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),Fo(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},"change",()=>this._watchActions()),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.allActions},()=>this._watchActions(),si),xe(()=>{var i;return(i=this.viewModel)==null?void 0:i.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var e,t;this._destroySelectedFeatureWidget(),this._destroySpinner(),(e=this._handles)==null||e.destroy(),this._unobserveFeatureMenuObserver(),(t=this._featureMenuIntersectionObserver)==null||t.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var e,t,i,r,s,n,o;return!!(this.selectedFeatureWidget?((t=(e=this.selectedFeatureWidget)==null?void 0:e.viewModel)==null?void 0:t.waitingForContent)||((r=(i=this.selectedFeatureWidget)==null?void 0:i.viewModel)==null?void 0:r.state)==="error"||((n=(s=this.selectedFeatureWidget)==null?void 0:s.viewModel)==null?void 0:n.content):(o=this.viewModel)==null?void 0:o.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(e){this._set("actionsMenuOpen",!!e)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||ese}set dockOptions(e){const t={...ese},i=this.get("viewModel.view.breakpoints"),r={};i&&(r.width=i.xsmall,r.height=i.xsmall);const s={...t,...e},n={...t.breakpoint,...r},{breakpoint:o}=s;o===!0?s.breakpoint=n:typeof o=="object"&&(s.breakpoint={...n,...o}),this._set("dockOptions",s),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:e,visibleElements:t,headingLevel:i}=this,{selectedFeatureViewModel:r}=this.viewModel,s={...t,title:!1};return r?(e?(e.viewModel=r,e.visibleElements=s):this._feature=new G9e({headingLevel:i+1,viewModel:r,visibleElements:s}),this._feature):null}castVisibleElements(e){return{...rse,...e}}blur(){const{active:e}=this.viewModel;e||ise.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(e,t){return this.viewModel.fetchFeatures(e,t)}focus(){const{active:e}=this.viewModel;e||ise.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(e){var s,n;this._handles.remove(Jre);const t=!!e&&!!e.featureMenuOpen,i=!!e&&!!e.actionsMenuOpen,r={collapsed:!!e&&!!e.collapsed,actionsMenuOpen:i,featureMenuOpen:t};((n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint)==="xsmall"&&(r.collapsed=!0),this.set(r),this.viewModel.open(e),this._shouldFocus(e),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(e){this.viewModel.triggerAction(e)}render(){var v,b,S,T;const{actionsMenuOpen:e,dockEnabled:t,featureMenuVisible:i,dividedActions:r,currentAlignment:s,currentDockPosition:n}=this,{active:o}=this.viewModel,{menuActions:a}=r,l=o&&a.length>1&&e,c=o&&t,h=o&&!t,p=(b=(v=this.selectedFeature)==null?void 0:v.layer)==null?void 0:b.title,m=(T=(S=this.selectedFeature)==null?void 0:S.layer)==null?void 0:T.id,g={[We.alignTopCenter]:s==="top-center",[We.alignBottomCenter]:s==="bottom-center",[We.alignTopLeft]:s==="top-left",[We.alignBottomLeft]:s==="bottom-left",[We.alignTopRight]:s==="top-right",[We.alignBottomRight]:s==="bottom-right",[We.isDocked]:c,[We.shadow]:h,[We.isDockedTopLeft]:n==="top-left",[We.isDockedTopCenter]:n==="top-center",[We.isDockedTopRight]:n==="top-right",[We.isDockedBottomLeft]:n==="bottom-left",[We.isDockedBottomCenter]:n==="bottom-center",[We.isDockedBottomRight]:n==="bottom-right",[We.isFeatureMenuOpen]:i,[We.isActionsMenuOpen]:l};return Te("div",{class:this.classes(We.base,g),role:"presentation","data-layer-title":p,"data-layer-id":m,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},o?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return Te("span",{"aria-hidden":"true",class:this.classes(We.icon,We.iconLoading,We.rotating)})}renderNavigationLoading(){const{messagesCommon:e}=this;return this.viewModel.pendingPromisesCount?Te("div",{key:yg("loading-container"),role:"presentation",class:We.loadingContainer,"aria-label":e.loading,title:e.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const e=Ov(this.container),t={[We.iconRightTriangleArrow]:e,[We.paginationPreviousIconRTL]:e,[We.iconLeftTriangleArrow]:!e,[We.paginationPreviousIconLTR]:!e};return Te("span",{"aria-hidden":"true",class:this.classes(We.icon,t)})}renderPreviousButton(){const{messages:e}=this;return Te("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(We.button,We.paginationPrevious),"aria-label":e.previous,title:e.previous},this.renderPreviousIcon())}renderNextIcon(){const e=Ov(this.container),t={[We.iconLeftTriangleArrow]:e,[We.paginationNextIconRTL]:e,[We.iconRightTriangleArrow]:!e,[We.paginationNextIconLTR]:!e};return Te("span",{"aria-hidden":"true",class:this.classes(We.icon,t)})}renderNextButton(){const{messages:e}=this;return Te("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(We.button,We.paginationNext),"aria-label":e.next,title:e.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:e,featureMenuId:t,messagesCommon:i}=this,{featureCount:r,selectedFeatureIndex:s}=this.viewModel;return Te("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(We.button,We.featureMenuButton),"aria-haspopup":"true","aria-controls":t,"aria-expanded":e.toString(),"aria-label":i.menu,title:i.menu},this._getPageText(r,s))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:e}=this,t=this._wouldDockTo(),i={[We.iconUndock]:e,[We.iconDock]:!e,[We.iconDockToRight]:!e&&(t==="top-right"||t==="bottom-right"),[We.iconDockToLeft]:!e&&(t==="top-left"||t==="bottom-left"),[We.iconDockToTop]:!e&&t==="top-center",[We.iconDockToBottom]:!e&&t==="bottom-center"};return Te("span",{"aria-hidden":"true",class:this.classes(i,We.icon)})}renderDockButton(){var s,n,o;const{dockEnabled:e,messages:t}=this,i=(n=(s=this.viewModel)==null?void 0:s.view)==null?void 0:n.widthBreakpoint,r=e?t.undock:t.dock;return i!=="xsmall"&&((o=this.dockOptions)==null?void 0:o.buttonEnabled)?Te("div",{role:"button","aria-label":r,title:r,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(We.button,We.buttonDock)},this.renderDockIcon()):null}renderTitle(){const{title:e}=this.viewModel,{titleId:t,collapsible:i,contentCollapsed:r,messagesCommon:s}=this,n={[We.headerContainerButton]:i},o=Te(nY,{level:this.headingLevel,class:We.headerTitle,innerHTML:e}),a=i?Te("button",{key:`${e}--collapsible`,id:t,title:r?s.expand:s.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(We.headerContainer,n),"aria-expanded":r?"false":"true",onclick:this._toggleCollapsed,type:"button"},o):Te("div",{key:e,id:t,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(We.headerContainer,n)},o);return e?a:null}renderCloseIcon(){return Te("span",{"aria-hidden":"true",class:this.classes(We.icon,We.iconClose)})}renderCloseButton(){const{visibleElements:e,messagesCommon:t}=this;return e.closeButton?Te("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:We.button,"aria-label":t.close,title:t.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return Te("header",{class:We.header},this.renderTitle(),Te("div",{class:We.headerButtons},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:e,hasContent:t,contentCollapsed:i}=this,{content:r}=this.viewModel;return t&&!i?Te("article",{key:r,enterAnimation:this._createFeatureUpdatedAnimation(),id:e,class:We.content},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r,messagesCommon:s}=this,n=i?s.close:s.open,{menuActions:o}=r;return o.length?Te("div",{key:yg("actions-menu-button"),class:this.classes(We.button,We.actionsMenuButton),role:"button",id:t,"aria-haspopup":"true","aria-controls":i?e:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":n,title:n},Te("span",{"aria-hidden":"true",class:We.iconActionsMenu})):null}renderMenuActions(){const{actionsMenuId:e,actionsMenuButtonId:t,actionsMenuOpen:i,dividedActions:r}=this,{menuActions:s}=r;return s.length&&i?Te("ul",{id:e,role:"menu","aria-labelledby":t,key:yg("actions"),class:We.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},s.toArray().map(n=>this.renderAction({action:n,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:e}=this.dividedActions;return!!e.length&&e.toArray().map(t=>this.renderAction({action:t,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:e,menuActions:t}=this.dividedActions,i=!!e.length,r=!!t.length;return i||r?Te("div",{key:"inline-actions-container","data-inline-actions":i.toString(),"data-menu-actions":r.toString(),class:We.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?Te("section",{key:yg("navigation"),class:this.classes(We.navigation)},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:e,dividedActions:t}=this,{inlineActions:i,menuActions:r}=t,s=!!i.length,n=!!r.length,o={[We.footerHasPagination]:e,[We.footerHasActions]:s,[We.footerHasActionsMenu]:n};return e||s?Te("div",{key:yg("feature-buttons"),class:this.classes(We.footer,o)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:e}=this,{featureViewModels:t,isLoadingFeature:i}=this.viewModel,r=kg(e.selectedFeatures,{total:t.length});return Te("section",{key:yg("menu"),class:We.featureMenu},Te("strong",{class:We.featureMenuHeader},r),Te("nav",{bind:this,class:We.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:yj},this.renderFeatureMenu(),Te("div",{class:We.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),i?Te("div",{class:We.featureMenuLoader},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:Te("div",{key:yg("pointer"),class:We.pointer,role:"presentation"},Te("div",{class:this.classes(We.pointerDirection,We.shadow)}))}renderMainContainer(){const{dockEnabled:e,currentAlignment:t,currentDockPosition:i,titleId:r,contentId:s,collapsible:n,hasContent:o,contentCollapsed:a,visibleElements:l}=this,{title:c}=this.viewModel,h=t==="bottom-left"||t==="bottom-center"||t==="bottom-right"||i==="top-left"||i==="top-center"||i==="top-right",p=t==="top-left"||t==="top-center"||t==="top-right"||i==="bottom-left"||i==="bottom-center"||i==="bottom-right",m={[We.shadow]:e,[We.isCollapsible]:n,[We.isCollapsed]:a};return Te("div",{class:this.classes(We.main,We.widget,m),tabIndex:l.closeButton?null:-1,role:"dialog","aria-labelledby":c?r:"","aria-describedby":o&&!a?s:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},h?this.renderFooter():null,h?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),p?this.renderFooter():null,p?this.renderFeatureMenuContainer():null)}renderContent(){var t;const e=(t=this.viewModel)==null?void 0:t.content;return e?typeof e=="string"?Te("div",{key:e,innerHTML:e}):this.renderNodeContent(e):null}renderActionText(e){return Te("span",{key:"text",class:We.actionText},e)}renderActionIcon(e){const t=this._getActionClass(e),i=this._getActionImage(e),r={[We.iconLoading]:e.active,[We.rotating]:e.active,[We.icon]:!!t,[We.actionImage]:!e.active&&!!i};return t&&(r[t]=!e.active),Te("span",{key:"icon","aria-hidden":"true",class:this.classes(We.icon,r),styles:this._getIconStyles(i)})}renderAction(e){const{action:t,type:i}=e,r=this._getActionTitle(t),s={[We.action]:t.type!=="toggle",[We.actionToggle]:t.type==="toggle",[We.actionToggleOn]:t.type==="toggle"&&t.value,[We.buttonDisabled]:t.disabled},n=[this.renderActionIcon(t),this.renderActionText(r)],o=i==="menu-item"?Te("li",{key:t.uid,role:"menuitem",tabIndex:0,title:r,"aria-label":r,class:this.classes(We.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n):Te("div",{key:t.uid,role:"button",tabIndex:0,title:r,"aria-label":r,class:this.classes(We.button,s),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":t.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},n);return t.visible?o:null}renderFeatureMenuItem(e,t){const{messages:i,messagesCommon:r}=this,{selectedFeatureIndex:s,selectedFeatureViewModel:n}=this.viewModel,o=e===n,a={[We.featureMenuSelected]:o},l=o?Te("span",{key:yg(`feature-menu-selected-feature-${s}`),title:i.selectedFeature,"aria-label":i.selectedFeature,class:We.iconCheckMark}):null,c=Te("span",{innerHTML:e.title||r.untitled});return Te("li",{role:"menuitem",tabIndex:-1,key:yg(`feature-menu-feature-${s}`),class:this.classes(a,We.featureMenuItem),bind:this,"data-feature-index":t,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},Te("span",{class:We.featureMenuTitle},c,l))}renderFeatureMenu(){const{featureMenuId:e}=this,{featureViewModels:t}=this.viewModel;return t.length>1?Te("ol",{class:We.featureMenuList,id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},t.filter(i=>!!i.graphic).map((i,r)=>this.renderFeatureMenuItem(i,r))):null}_getActionTitle(e){const{messages:t,selectedFeature:i,messagesCommon:r}=this,{id:s}=e,n=i==null?void 0:i.attributes,o=s==="zoom-to-feature"?kg(e.title,{messages:t}):s==="remove-selected-feature"?kg(e.title,{messages:r}):s==="zoom-to-clustered-features"||s==="browse-clustered-features"?kg(e.title,{messages:t}):e.title;return o&&n?kg(o,n):o}_getActionClass(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{className:r,image:s}=e,n=s||r?r:We.iconDefaultAction;return n&&i?kg(n,i):n}_getActionImage(e){const{selectedFeature:t}=this,i=t==null?void 0:t.attributes,{image:r}=e;return r&&i?kg(r,i):r}_createFeatureUpdatedAnimation(){return sNe("enter",We.hasFeatureUpdated)}_getInlineActionCount(){const{maxInlineActions:e,featureNavigationVisible:t}=this;if(typeof e!="number")return null;const i=Math.round(e);return Math.max(t?i-1:i,0)}_watchActions(){const{allActions:e}=this.viewModel;this.notifyChange("dividedActions");const t="actions";this._handles.remove(t),e&&e.forEach(i=>{this._handles.add(xe(()=>[i.uid,i.active,i.className,i.disabled,i.id,i.title,i.image,i.visible],()=>this.scheduleRender()),t)})}_divideActions(){const{allActions:e}=this.viewModel,t=e.filter(n=>n.visible),i=this._getInlineActionCount(),r=i===null,s=i===0;return{inlineActions:r?t.slice(0):s?new zt:t.slice(0,i),menuActions:r?new zt:s?t.slice(0):t.slice(i)}}_featureMenuOpenChanged(e){e?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(e){e?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var i,r;const{selectedFeatureWidget:e,messagesCommon:t}=this;e&&(this.viewModel.title=((i=e.viewModel)==null?void 0:i.state)==="error"?t.errorMessage:((r=e.viewModel)==null?void 0:r.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:e}=this;e&&(this.viewModel.content=e)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}_handleFeatureMenuKeyup(e){bw(e)==="Escape"&&(e.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(e){bw(e)==="Escape"&&(e.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(e){const{viewModel:t}=this,i=e.currentTarget["data-feature-index"];t.activeFeature=t.features[i]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(e){const t=bw(e),{_featureMenuNode:i}=this,r=e.currentTarget["data-feature-index"];if(!i)return;const s=i.querySelectorAll("li"),n=s.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),s[s.length-1].focus()):(e.stopPropagation(),s[0].focus()):(e.stopPropagation(),s[(r+1+n)%n].focus()):(e.stopPropagation(),s[(r-1+n)%n].focus())}_handleActionMenuItemKeyup(e){const t=bw(e),{_actionsMenuNode:i}=this,r=e.currentTarget.dataset.actionUid,{menuActions:s}=this.dividedActions,n=s.findIndex(l=>l.uid===r);if(!i)return;const o=i.querySelectorAll("li"),a=o.length;t!=="ArrowUp"?t!=="ArrowDown"?t!=="Home"?t!=="End"||(e.stopPropagation(),o[o.length-1].focus()):(e.stopPropagation(),o[0].focus()):(e.stopPropagation(),o[(n+1+a)%a].focus()):(e.stopPropagation(),o[(n-1+a)%a].focus())}_handleMainKeyup(e){const t=bw(e);t==="ArrowLeft"&&(e.stopPropagation(),this.previous()),t==="ArrowRight"&&(e.stopPropagation(),this.next())}_spinnerEnabledChange(e){if(this._destroySpinner(),!e)return;const t=this.get("viewModel.view");this._createSpinner(t)}_hideSpinner(){const{_spinner:e}=this;e&&(e.location=null,e.hide())}_displaySpinner(){const{_spinner:e}=this;if(!e)return;const{location:t,waitingForResult:i}=this.viewModel;i?e.show({location:t}):e.hide()}_getIconStyles(e){return{"background-image":e?`url(${e})`:""}}async _shouldFocus(e){e.shouldFocus&&(await xP(()=>{var t;return((t=this.viewModel)==null?void 0:t.active)===!0}),this.focus())}_addSelectedFeatureIndexHandle(){const e=xe(()=>{var t;return(t=this.viewModel)==null?void 0:t.selectedFeatureIndex},(t,i)=>this._selectedFeatureIndexUpdated(t,i));this._handles.add(e,Jre)}_selectedFeatureIndexUpdated(e,t){const{featureCount:i}=this;i&&e!==t&&e!==-1&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:e}=this;e&&(e.viewModel=null,e&&!e.destroyed&&e.destroy()),this._feature=null}_isScreenLocationWithinView(e,t){return e.x>-1&&e.y>-1&&e.x<=t.width&&e.y<=t.height}_isOutsideView(e){const{popupHeight:t,popupWidth:i,screenLocation:r,side:s,view:n}=e;if(isNaN(i)||isNaN(t)||!n||!r)return!1;const o=n.padding;return s==="right"&&r.x+i/2>n.width-o.right||s==="left"&&r.x-i/2<o.left||s==="top"&&r.y-t<o.top||s==="bottom"&&r.y+t>n.height-o.bottom}_calculateAutoAlignment(e){if(e!=="auto")return e;const{_pointerOffsetInPx:t,_containerNode:i,_mainContainerNode:r,viewModel:s}=this,{screenLocation:n,view:o}=s;if(N(n)||!o||!i)return"top-center";if(!this._isScreenLocationWithinView(n,o))return this._get("currentAlignment")||"top-center";function a(C){return parseInt(C.replace(/[^-\d\.]/g,""),10)}const l=r?window.getComputedStyle(r,null):null,c=l?a(l.getPropertyValue("max-height")):0,h=l?a(l.getPropertyValue("height")):0,{height:p,width:m}=i.getBoundingClientRect(),g=m+t,v=Math.max(p,c,h)+t,b=this._isOutsideView({popupHeight:v,popupWidth:g,screenLocation:n,side:"right",view:o}),S=this._isOutsideView({popupHeight:v,popupWidth:g,screenLocation:n,side:"left",view:o}),T=this._isOutsideView({popupHeight:v,popupWidth:g,screenLocation:n,side:"top",view:o}),O=this._isOutsideView({popupHeight:v,popupWidth:g,screenLocation:n,side:"bottom",view:o});return S?T?"bottom-right":"top-right":b?T?"bottom-left":"top-left":T?O?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(e){return typeof e=="function"?e.call(this):e}_getCurrentAlignment(){const{alignment:e,dockEnabled:t}=this;return t||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(e){const t=["left","right"];return Ov(this.container)&&t.reverse(),e.replace(/leading/gi,t[0]).replace(/trailing/gi,t[1])}_callDockPosition(e){return typeof e=="function"?e.call(this):e}_getDockPosition(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition((e=this.dockOptions)==null?void 0:e.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(e){var o;if(e!=="auto")return e;const t=(o=this.viewModel)==null?void 0:o.view,i=Ov(this.container)?"top-left":"top-right";if(!t)return i;const r=t.padding||{left:0,right:0,top:0,bottom:0},s=t.width-r.left-r.right,{breakpoints:n}=t;return n&&s<=n.xsmall?"bottom-center":i}_positionContainer(e=this._containerNode){if(e&&(this._containerNode=e),!e)return;const{screenLocation:t}=this.viewModel,{width:i}=e.getBoundingClientRect(),r=this._calculatePositionStyle(t,i);r&&(e.style.top=r.top,e.style.left=r.left,e.style.bottom=r.bottom,e.style.right=r.right)}_calculateFullWidth(e){const{currentAlignment:t,_pointerOffsetInPx:i}=this;return t==="top-left"||t==="bottom-left"||t==="top-right"||t==="bottom-right"?e+i:e}_calculateAlignmentPosition(e,t,i,r){const{currentAlignment:s,_pointerOffsetInPx:n}=this,o=r/2,a=i.height-t,l=i.width-e,{padding:c}=this.view;return s==="bottom-center"?{top:t+n-c.top,left:e-o-c.left}:s==="top-left"?{bottom:a+n-c.bottom,right:l+n-c.right}:s==="bottom-left"?{top:t+n-c.top,right:l+n-c.right}:s==="top-right"?{bottom:a+n-c.bottom,left:e+n-c.left}:s==="bottom-right"?{top:t+n-c.top,left:e+n-c.left}:s==="top-center"?{bottom:a+n-c.bottom,left:e-o-c.left}:void 0}_calculatePositionStyle(e,t){const{dockEnabled:i,view:r}=this;if(!r)return;if(i)return{left:"",top:"",right:"",bottom:""};if(N(e)||!t)return;const s=this._calculateFullWidth(t),n=this._calculateAlignmentPosition(e.x,e.y,r,s);return n?{top:n.top!==void 0?`${n.top}px`:"auto",left:n.left!==void 0?`${n.left}px`:"auto",bottom:n.bottom!==void 0?`${n.bottom}px`:"auto",right:n.right!==void 0?`${n.right}px`:"auto"}:void 0}_viewChange(e,t){e&&t&&(this.close(),this.clear())}_viewReadyChange(e,t){if(e){const i=this.get("viewModel.view");this._wireUpView(i)}else t&&(this.close(),this.clear())}_wireUpView(e){if(this._destroySpinner(),!e)return;const{spinnerEnabled:t}=this;t&&this._createSpinner(e),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(e,t,i){const[r,s]=e,[n,o]=t,{width:a,height:l}=i;return r<=a&&n>a||r>a&&n<=a||s<=l&&o>l||s>l&&o<=l}_updateDockEnabledForViewSize(e,t){if(!e||!t)return;const i=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,s=i.top+i.bottom,n=[],o=[];n[0]=e[0]-r,n[1]=e[1]-s,o[0]=t[0]-r,o[1]=t[1]-s;const{dockOptions:a}=this,l=a.breakpoint;this._dockingThresholdCrossed(n,o,l)&&this._setDockEnabledForViewSize(a),this._setCurrentDockPosition()}_focusDockButtonNode(e){this._focusDockButton&&(this._focusDockButton=!1,e.focus())}_closeButtonNodeUpdated(e){return this._focusClose?(this._focusClose=!1,void e.focus()):this._blurClose?(this._blurClose=!1,void e.blur()):void 0}_mainContainerNodeUpdated(e){return this._mainContainerNode=e,this._focusContainer?(this._focusContainer=!1,void e.focus()):this._blurContainer?(this._blurContainer=!1,void e.blur()):void 0}_featureMenuNodeUpdated(e){if(this._featureMenuNode=e,!e||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_actionsMenuNodeUpdated(e){if(this._actionsMenuNode=e,!e||!this._focusFirstAction)return;this._focusFirstAction=!1;const t=e.querySelectorAll("li");t.length&&t[0].focus()}_focusFeatureMenuButtonNode(e){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,e.focus())}_focusActionsMenuButtonNode(e){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,e.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:e,viewModel:t}=this;if(!t)return;const i=t.active&&!e;t.screenLocationEnabled=i}_shouldDockAtCurrentViewSize(e){var a,l;const t=e.breakpoint,i=(l=(a=this.viewModel)==null?void 0:a.view)==null?void 0:l.ui;if(!i)return!1;const{width:r,height:s}=i;if(isNaN(r)||isNaN(s))return!1;const n=t.hasOwnProperty("width")&&r<=t.width,o=t.hasOwnProperty("height")&&s<=t.height;return n||o}_setDockEnabledForViewSize(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}_getPageText(e,t){return this.featureNavigationVisible?kg(this.messages.pageText,{index:t+1,total:e}):null}_destroySpinner(){const{_spinner:e,view:t}=this;e&&(t&&t.ui&&t.ui.remove(this._spinner,Kre),e.destroy(),this._spinner=null)}_createSpinner(e){e&&(this._spinner=new H9e({view:e}),e.ui.add(this._spinner,{key:Kre,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const e=!this.featureMenuOpen;this._featureMenuOpenChanged(e),this.actionsMenuOpen=!1,this.featureMenuOpen=e}_toggleActionsMenu(){const e=!this.actionsMenuOpen;this._actionsMenuOpenChanged(e),this.featureMenuOpen=!1,this.actionsMenuOpen=e}_triggerAction(e){const t=e.currentTarget.dataset.actionUid,{allActions:i}=this.viewModel,r=i.findIndex(n=>n.uid===t),s=i.getItemAt(r);s&&s.type==="toggle"&&(s.value=!s.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(r)}_selectFeature(e){const t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};u([f({readOnly:!0})],Bt.prototype,"actionsMenuId",null),u([f({readOnly:!0})],Bt.prototype,"actionsMenuButtonId",null),u([f({readOnly:!0})],Bt.prototype,"featureMenuId",null),u([f({readOnly:!0})],Bt.prototype,"titleId",null),u([f({readOnly:!0})],Bt.prototype,"contentId",null),u([f({readOnly:!0})],Bt.prototype,"hasContent",null),u([f({readOnly:!0})],Bt.prototype,"featureNavigationVisible",null),u([f({readOnly:!0})],Bt.prototype,"collapsible",null),u([f({readOnly:!0})],Bt.prototype,"featureMenuVisible",null),u([f({readOnly:!0})],Bt.prototype,"contentCollapsed",null),u([f({readOnly:!0})],Bt.prototype,"dividedActions",null),u([Lt("viewModel.actions")],Bt.prototype,"actions",void 0),u([f()],Bt.prototype,"actionsMenuOpen",null),u([f()],Bt.prototype,"alignment",void 0),u([Lt("viewModel.autoCloseEnabled")],Bt.prototype,"autoCloseEnabled",void 0),u([Lt("viewModel.autoOpenEnabled")],Bt.prototype,"autoOpenEnabled",void 0),u([Lt("viewModel.defaultPopupTemplateEnabled")],Bt.prototype,"defaultPopupTemplateEnabled",void 0),u([Lt("viewModel.content")],Bt.prototype,"content",void 0),u([f()],Bt.prototype,"collapsed",void 0),u([f()],Bt.prototype,"collapseEnabled",void 0),u([f({readOnly:!0})],Bt.prototype,"currentAlignment",null),u([f({readOnly:!0})],Bt.prototype,"currentDockPosition",null),u([f()],Bt.prototype,"dockOptions",null),u([f()],Bt.prototype,"dockEnabled",void 0),u([Lt("viewModel.featureCount")],Bt.prototype,"featureCount",void 0),u([f()],Bt.prototype,"featureMenuOpen",void 0),u([Lt("viewModel.features")],Bt.prototype,"features",void 0),u([Lt("viewModel.goToOverride")],Bt.prototype,"goToOverride",void 0),u([f()],Bt.prototype,"headingLevel",void 0),u([Lt("viewModel.highlightEnabled")],Bt.prototype,"highlightEnabled",void 0),u([Lt("viewModel.location")],Bt.prototype,"location",void 0),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Bt.prototype,"label",void 0),u([f()],Bt.prototype,"maxInlineActions",void 0),u([f(),Hl("esri/widgets/Popup/t9n/Popup")],Bt.prototype,"messages",void 0),u([f(),Hl("esri/t9n/common")],Bt.prototype,"messagesCommon",void 0),u([Lt("viewModel.promises")],Bt.prototype,"promises",void 0),u([Lt("viewModel.selectedFeature")],Bt.prototype,"selectedFeature",void 0),u([Lt("viewModel.selectedFeatureIndex")],Bt.prototype,"selectedFeatureIndex",void 0),u([f({readOnly:!0})],Bt.prototype,"selectedFeatureWidget",null),u([f()],Bt.prototype,"spinnerEnabled",void 0),u([Lt("viewModel.title")],Bt.prototype,"title",void 0),u([Lt("viewModel.updateLocationEnabled")],Bt.prototype,"updateLocationEnabled",void 0),u([Lt("viewModel.view")],Bt.prototype,"view",void 0),u([f({type:Fve}),x4e(["triggerAction","trigger-action"])],Bt.prototype,"viewModel",void 0),u([Lt("viewModel.visible")],Bt.prototype,"visible",void 0),u([f()],Bt.prototype,"visibleElements",void 0),u([pi("visibleElements")],Bt.prototype,"castVisibleElements",null),u([Eu()],Bt.prototype,"_close",null),u([Eu()],Bt.prototype,"_toggleDockEnabled",null),u([Eu()],Bt.prototype,"_toggleFeatureMenu",null),u([Eu()],Bt.prototype,"_toggleActionsMenu",null),u([Eu()],Bt.prototype,"_triggerAction",null),u([Eu()],Bt.prototype,"_selectFeature",null),u([Eu()],Bt.prototype,"_next",null),u([Eu()],Bt.prototype,"_previous",null),Bt=u([B(kve)],Bt);const sse=Bt,x6=[0,0];function LGe(e){const t=(e.ownerDocument||window.document).defaultView,i=e.getBoundingClientRect();return x6[0]=i.left+t.pageXOffset,x6[1]=i.top+t.pageYOffset,x6}function nse(e){e&&(Ufe(e),e.parentNode&&e.parentNode.removeChild(e))}function $Ge(e){const t=document.createElement("div");return e.appendChild(t),t}const iO=16,n$=750,DGe=512,NGe=2,FGe=e=>{let t=class extends e{constructor(...i){super(...i),this._freqInfo={freq:iO,time:n$},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([xe(()=>this.cursor,r=>{const{surface:s}=this;s&&s.setAttribute("data-cursor",r)}),xe(()=>this.interacting,r=>{const{surface:s}=this;s&&s.setAttribute("data-interacting",r.toString())})])}initialize(){this.handles.add(xe(()=>this.ui,(i,r)=>this._handleUIChange(i,r))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(i){const r=this._get("container");if(r===i)return;const s="dom-size";if(this.handles.remove(s),this._stopMeasuring(),r&&(r.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),nse(this.root),this._set("root",null),Iee(this.userContent,r),nse(this.userContent),this._set("userContent",null)),i){i.classList.add("esri-view");const n=document.createElement("div");n.className="esri-view-user-storage",Iee(i,n),i.appendChild(n),this._set("userContent",n);const o=document.createElement("div");o.className="esri-view-root",i.insertBefore(o,i.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new bte;o.appendChild(l.surface),this._set("overlay",l),xe(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=xx({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add(xe(()=>this.size,c=>{const[h,p]=c,m="esri-view-surface--inset-outline";h>=document.body.clientWidth||p>=document.body.clientHeight?a.classList.add(m):a.classList.remove(m)},si),s),this._set("container",i),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const i=document.activeElement===this.surface;return document.hasFocus()&&i}get popup(){return this._get("popup")||new sse({view:this})}set popup(i){const r=this._get("popup");r&&r!==i&&r.destroy(),this._set("popup",i)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(i,r,s){const n=this.position;return i-=n[0],r-=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}containerToPage(i,r,s){const n=this.position;return i+=n[0],r+=n[1],s?(s[0]=i,s[1]=r):s=[i,r],s}_handleUIChange(i,r){r&&(this.handles.remove("ui"),r.destroy()),i&&this._wireUI(i),this._set("ui",i)}_wireUI(i){this.handles.remove("ui"),i&&(i.view=this,this.handles.add([xe(()=>this.root,r=>{i.container=r?$Ge(r):null},si),xe(()=>this.popup,(r,s)=>{const n="popup",o="manual";s&&i.remove(s,n),r&&(r.view=i.view,i.add(r,{key:n,position:o}))},si)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const i=this._freqInfo;i.freq=iO,i.time=n$,this.handles.add([(()=>{const r=()=>{i.freq=iO,i.time=n$};return window.addEventListener("resize",r),{remove(){window.removeEventListener("resize",r)}}})(),xx({prepare:r=>{const s=this._measure(),n=this._freqInfo;if(n.time+=r.deltaTime,s&&(n.freq=iO,this._get("resizing")||this._set("resizing",!0)),n.time<n.freq)return;n.time=0;const o=this._position();n.freq=o||s?iO:Math.min(n$,n.freq*NGe),!s&&n.freq>=DGe&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const i=this.container,r=i?i.clientWidth:0,s=i?i.clientHeight:0;if(r===0||s===0)return this.suspended||this._set("suspended",!0),!1;const n=this.width,o=this.height;return r===n&&s===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",r),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:n,oldHeight:o,width:r,height:s}),!0)}_position(){const i=this.container,r=this.position,s=LGe(i);return(!r||s[0]!==r[0]||s[1]!==r[1])&&(this._set("position",[s[0],s[1]]),!0)}forceDOMReadyCycle(){}};return u([f({value:null,cast:i=>iU(i)})],t.prototype,"container",null),u([f({readOnly:!0})],t.prototype,"focused",null),u([f({readOnly:!0})],t.prototype,"height",void 0),u([f({type:sse})],t.prototype,"popup",null),u([f({type:bte})],t.prototype,"overlay",void 0),u([f({readOnly:!0})],t.prototype,"position",void 0),u([f({readOnly:!0})],t.prototype,"resizing",void 0),u([f({readOnly:!0})],t.prototype,"root",void 0),u([f({value:null,readOnly:!0})],t.prototype,"size",null),u([f({readOnly:!0})],t.prototype,"surface",void 0),u([f({readOnly:!0})],t.prototype,"suspended",void 0),u([f()],t.prototype,"ui",void 0),u([f({readOnly:!0})],t.prototype,"userContent",void 0),u([f({readOnly:!0})],t.prototype,"width",void 0),u([f()],t.prototype,"widthBreakpoint",void 0),t=u([B("esri.views.DOMContainer")],t),t};function ybt(e){return e&&"focus"in e}const rQ=Ie.getLogger("esri.layers.support.ElevationSampler");class Uve{queryElevation(t){return zve(t.clone(),this)}on(){return VGe}projectIfRequired(t,i){return Bve(t,i)}}class kGe extends Uve{constructor(t,i,r){super(),this.tile=t,this.noDataValue=r,this.extent=jk(t.tile.extent,i.spatialReference),this.extent.zmin=t.zmin,this.extent.zmax=t.zmax,this.aaExtent=t.tile.extent;const s=Zc(i.spatialReference),n=i.lodAt(t.tile.level).resolution*s;this.demResolution={min:n,max:n}}get spatialReference(){return this.extent.spatialReference}contains(t){const i=this.projectIfRequired(t,this.spatialReference);return!N(i)&&this.containsAt(i.x,i.y)}containsAt(t,i){return YZ(this.aaExtent,t,i)}elevationAt(t,i){if(!this.containsAt(t,i)){const r=this.extent,s=`${r.xmin}, ${r.ymin}, ${r.xmax}, ${r.ymax}`;return rQ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler extent (${s})`),this.noDataValue}return $t(this.tile.sample(t,i),this.noDataValue)}}class _bt extends Uve{constructor(t,i,r){let s;super(),typeof i=="number"?(this.noDataValue=i,s=null):(s=i,this.noDataValue=r),this.samplers=s?t.map(o=>new kGe(o,s,this.noDataValue)):t;const n=this.samplers[0];if(n){this.extent=n.extent.clone();const{min:o,max:a}=n.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=jk(ei(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(t,i){for(const r of this.samplers)if(r.containsAt(t,i))return r.elevationAt(t,i);return rQ.warn("#elevationAt()",`Point used to sample elevation (${t}, ${i}) is outside of the sampler`),this.noDataValue}}function zve(e,t){const i=Bve(e,t.spatialReference);if(!i)return null;switch(e.type){case"point":UGe(e,i,t);break;case"polyline":zGe(e,i,t);break;case"multipoint":BGe(e,i,t)}return e}function Bve(e,t){if(N(e))return null;const i=e.spatialReference;if(i.equals(t))return e;const r=aT(e,t);return r||rQ.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${t.wkid})`),r}function UGe(e,t,i){e.z=i.elevationAt(t.x,t.y)}function zGe(e,t,i){cm.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s],o=t.paths[s];for(let a=0;a<n.length;a++){const l=n[a],c=o[a];cm.x=c[0],cm.y=c[1],r&&(l[3]=l[2]),l[2]=i.elevationAt(cm.x,cm.y)}}e.hasZ=!0}function BGe(e,t,i){cm.spatialReference=t.spatialReference;const r=e.hasM&&!e.hasZ;for(let s=0;s<e.points.length;s++){const n=e.points[s],o=t.points[s];cm.x=o[0],cm.y=o[1],r&&(n[3]=n[2]),n[2]=i.elevationAt(cm.x,cm.y)}e.hasZ=!0}const cm=new xt,VGe={remove(){}};var pq;let zf=pq=class extends Fe{constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new pq({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};u([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],zf.prototype,"cols",void 0),u([f({type:cs,json:{write:!0}})],zf.prototype,"level",void 0),u([f({type:String,json:{write:!0}})],zf.prototype,"levelValue",void 0),u([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],zf.prototype,"origin",void 0),u([f({type:Number,json:{write:!0}})],zf.prototype,"resolution",void 0),u([f({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],zf.prototype,"rows",void 0),u([f({type:Number,json:{write:!0}})],zf.prototype,"scale",void 0),zf=pq=u([B("esri.layers.support.LOD")],zf);const Vve=zf;var F_;const ose=new Hi({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let To=F_=class extends Fe{constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(e={}){const{resolutionFactor:t=1,scales:i,size:r=256,spatialReference:s=wt.WebMercator,numLODs:n=24}=e;if(!Xl(s)){const p=[];if(i)for(let m=0;m<i.length;m++){const g=i[m];p.push({level:m,scale:g,resolution:g})}else{let m=5e-4;for(let g=n-1;g>=0;g--)p.unshift({level:g,scale:m,resolution:m}),m*=2}return new F_({dpi:96,lods:p,origin:new xt(0,0,s),size:[r,r],spatialReference:s})}const o=kv(s),a=e.origin?new xt({x:e.origin.x,y:e.origin.y,spatialReference:s}):new xt(o?{x:o.origin[0],y:o.origin[1],spatialReference:s}:{x:0,y:0,spatialReference:s}),l=96,c=1/(Zc(s)*39.37*l),h=[];if(i)for(let p=0;p<i.length;p++){const m=i[p],g=m*c;h.push({level:p,scale:m,resolution:g})}else{let p=Ide(s)?512/r*5916575275917094e-7:256/r*591657527591555e-6;const m=Math.ceil(n/t);h.push({level:0,scale:p,resolution:p*c});for(let g=1;g<m;g++){const v=p/2**t,b=v*c;h.push({level:g,scale:v,resolution:b}),p=v}}return new F_({dpi:l,lods:h,origin:a,size:[r,r],spatialReference:s})}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const i=kv(e);return e.isWrappable&&Math.abs(i.origin[0]-t.x)<=i.dx}return!1}readOrigin(e,t){return xt.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,i=0;const r=[];this._levelToLOD={},e&&(t=-1/0,i=1/0,e.forEach(s=>{r.push(s.scale),t=s.scale>t?s.scale:t,i=s.scale<i?s.scale:i,this._levelToLOD[s.level]=s})),this._set("scales",r),this._set("minScale",t),this._set("maxScale",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];{const i=Math.floor(e),r=i+1;return t[i]/(t[i]/t[r])**(e-i)}}scaleToZoom(e){const t=this.scales,i=t.length-1;let r=0;for(;r<i;r++){const s=t[r],n=t[r+1];if(s<=e)return r;if(n===e)return r+1;if(s>e&&n<e)return r+Math.log(s/e)/Math.log(s/n)}return r}snapScale(e,t=.95){const i=this.scaleToZoom(e);return i%Math.floor(i)>=t?this.zoomToScale(Math.ceil(i)):this.zoomToScale(Math.floor(i))}tileAt(e,t,i,r){const s=this.lodAt(e);if(!s)return null;let n,o;if(typeof t=="number")n=t,o=i;else if(qc(t.spatialReference,this.spatialReference))n=t.x,o=t.y,r=i;else{const c=aT(t,this.spatialReference);if(N(c))return null;n=c.x,o=c.y,r=i}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return r||(r={id:null,level:0,row:0,col:0,extent:ei()}),r.level=e,r.row=Math.floor((this.origin.y-o)/l+.001),r.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(r),r}updateTileInfo(e,t=F_.ExtrapolateOptions.NONE){let i=this.lodAt(e.level);if(!i&&t===F_.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<e.level&&(i=o)}if(!i)return;const r=e.level-i.level,s=i.resolution*this.size[0]/2**r,n=i.resolution*this.size[1]/2**r;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=ei()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||t.parentLevel===-1)&&(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),!0)}getTileBounds(e,t){const{resolution:i}=this.lodAt(t.level),r=i*this.size[0],s=i*this.size[1];return e[0]=this.origin.x+t.col*r,e[1]=this.origin.y-(t.row+1)*s,e[2]=e[0]+r,e[3]=e[1]+s,e}lodAt(e){return this._levelToLOD&&this._levelToLOD[e]||null}clone(){return F_.fromJSON(this.write({}))}getOrCreateCompatible(e,t){if(this.size[0]===256&&this.size[1]===256)return e===256?this:null;const i=[],r=this.lods.length;for(let s=0;s<r;s++){const n=this.lods[s],o=n.resolution*t;i.push(new Vve({level:n.level,scale:n.scale,resolution:o}))}return new F_({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:i})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let i=0;i<e.length;i++){const r=e[i];this._upsampleLevels[r.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/r.resolution:0},t=r}}};u([f({type:Number,json:{write:!0}})],To.prototype,"compressionQuality",void 0),u([f({type:Number,json:{write:!0}})],To.prototype,"dpi",void 0),u([f({type:String,json:{read:ose.read,write:ose.write,origins:{"web-scene":{read:!1,write:!1}}}})],To.prototype,"format",void 0),u([f({readOnly:!0})],To.prototype,"isWrappable",null),u([f({type:xt,json:{write:!0}})],To.prototype,"origin",void 0),u([it("origin")],To.prototype,"readOrigin",null),u([f({type:[Vve],value:null,json:{write:!0}})],To.prototype,"lods",null),u([f({readOnly:!0})],To.prototype,"minScale",void 0),u([f({readOnly:!0})],To.prototype,"maxScale",void 0),u([f({readOnly:!0})],To.prototype,"scales",void 0),u([f({cast:e=>Array.isArray(e)?e:typeof e=="number"?[e,e]:[256,256]})],To.prototype,"size",void 0),u([it("size",["rows","cols"])],To.prototype,"readSize",null),u([ut("size",{cols:{type:cs},rows:{type:cs}})],To.prototype,"writeSize",null),u([f({type:wt,json:{write:!0}})],To.prototype,"spatialReference",void 0),To=F_=u([B("esri.layers.support.TileInfo")],To),function(e){var t;(t=e.ExtrapolateOptions||(e.ExtrapolateOptions={}))[t.NONE=0]="NONE",t[t.POWER_OF_TWO=1]="POWER_OF_TWO"}(To||(To={}));const uF=To,GGe=12;class es{constructor(t){const i=es.checkUnsupported(t);if(w(i))throw i;const r=t;this.spatialReference=r.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=$x(this.spatialReference)||km(this.spatialReference)||Um(this.spatialReference),this.origin=[r.origin.x,r.origin.y],this.pixelSize=r.size[0],this.dpi=r.dpi;const s=r.lods.reduce((c,h,p)=>(h.level<c.min&&(c.min=h.level,c.minIndex=p),c.max=Math.max(c.max,h.level),c),{min:1/0,minIndex:0,max:-1/0}),n=r.lods[s.minIndex],o=2**n.level;let a=n.resolution*o,l=n.scale*o;this.levels=new Array(s.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*r.size[0],a*r.size[1]]},a/=2,l/=2}clone(){return new es(this.toTileInfo())}toTileInfo(){return new uF({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,r,s){const n=this.levels[t],o=n.tileSize[0],a=n.tileSize[1];s[0]=this.origin[0]+r*o,s[2]=this.origin[0]+(r+1)*o,s[3]=this.origin[1]-i*a,s[1]=this.origin[1]-(i+1)*a}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=nee(t[0]),i[1]=T4(t[1]),i[2]=nee(t[2]),i[3]=T4(t[3])):this._isGCS&&(i[0]=Jt(t[0]),i[1]=Jt(t[1]),i[2]=Jt(t[2]),i[3]=Jt(t[3]))}getExtentGeometry(t,i,r,s=new zi){return this.getExtent(t,i,r,hf),s.spatialReference=this.spatialReference,s.xmin=hf[0],s.ymin=hf[1],s.xmax=hf[2],s.ymax=hf[3],s.zmin=void 0,s.zmax=void 0,s}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const r=this.levels[this.levels.length-1],s=r.resolution/2;this.levels.push({resolution:s,scale:r.scale/2,tileSize:[s*this.pixelSize,s*this.pixelSize]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t){if(!(t instanceof es)){if(es.checkUnsupported(t))return!1;t=new es(t)}if(!t.spatialReference.equals(this.spatialReference)||t.pixelSize!==this.pixelSize)return!1;const i=Math.min(this.levels.length,t.levels.length)-1,r=this.levels[i].resolution;let s=.5*r;return!tE(t.origin[0],this.origin[0],s)||!tE(t.origin[1],this.origin[1],s)?!1:(s=.5*r/2**i/this.pixelSize*GGe,tE(r,t.levels[i].resolution,s))}rootTilesInExtent(t,i=null,r=1/0){const s=new Array,n=this.levels[0].tileSize;if(N(t)||n[0]===0||n[1]===0)return s;es.computeRowColExtent(t,n,this.origin,hf);let o=hf[1],a=hf[3],l=hf[0],c=hf[2];const h=c-l,p=a-o;if(h*p>r){const m=Math.floor(Math.sqrt(r));p>m&&(o=o+Math.floor(.5*p)-Math.floor(.5*m),a=o+m),h>m&&(l=l+Math.floor(.5*h)-Math.floor(.5*m),c=l+m)}for(let m=o;m<a;m++)for(let g=l;g<c;g++)s.push([0,m,g]);return w(i)&&(i[0]=this.origin[0]+l*n[0],i[1]=this.origin[1]-a*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-o*n[1]),s}static computeRowColExtent(t,i,r,s){const n=.001*(t[2]-t[0]+(t[3]-t[1]));s[0]=Math.max(0,Math.floor((t[0]+n-r[0])/i[0])),s[2]=Math.max(0,Math.ceil((t[2]-n-r[0])/i[0])),s[1]=Math.max(0,Math.floor((r[1]-t[3]+n)/i[1])),s[3]=Math.max(0,Math.ceil((r[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,r=i[0].resolution*2**i[0].level;return!i.some(s=>!ROe(s.resolution,r/2**s.level))}static hasGapInLevels(t){const i=t.lods.map(r=>r.level);i.sort((r,s)=>r-s);for(let r=1;r<i.length;r++)if(i[r]!==i[0]+r)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&(i&i-1)==0&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(r=>r.origin!=null&&(r.origin[0]!==i.x||r.origin[1]!==i.y))}static getMissingTileInfoError(){return new se("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return N(t)?sQ():t.lods.length<1?new se("tilingscheme:generic","Tiling scheme must have at least one level"):es.isPowerOfTwo(t)?es.hasGapInLevels(t)?new se("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):es.tileSizeSupported(t)?es.hasOriginPerLODs(t)?new se("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new se("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new se("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const r=t[2]-t[0],s=t[3]-t[1],n=Zc(i),o=1.2*Math.max(r,s),a=256,l=96,c=.0254,h=new es(new uF({size:[a,a],origin:{x:t[0]-.5*(o-r),y:t[3]+.5*(o-s)},lods:[{level:0,resolution:o/a,scale:1/(a/l*c/(o*n))}],spatialReference:i}));return h.ensureMaxLod(20),h}static makeWebMercatorAuxiliarySphere(t){const i=new es(es.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,r=16){const s=256/i,n=new es(new uF({size:[i,i],origin:{x:-180,y:90,spatialReference:t},spatialReference:t,lods:[{level:0,resolution:.703125*s,scale:295497598570834e-6*s}]}));return n.ensureMaxLod(r),n}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function sQ(){return new se("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}es.WebMercatorAuxiliarySphereTileInfo=new uF({size:[256,256],origin:{x:-20037508342787e-6,y:20037508342787e-6,spatialReference:wt.WebMercator},spatialReference:wt.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527591555e-6}]}),es.WebMercatorAuxiliarySphere=es.makeWebMercatorAuxiliarySphere(19);const hf=ei(),U2=64,fq=512,jGe=2.5,NP=MOe(xG/10),Gve=4,HGe=4,hF=e=>e<4?3:HGe,jve=ei();es.WebMercatorAuxiliarySphere.getExtent(0,0,0,jve);const qGe=ei([-180,-90,180,90]),WGe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",ZGe="Surface extent is too large for tile resolution at level 0.",jh=8,XGe=Ie.getLogger("esri.views.support.GroundViewElevationSampler");let k_=class extends ks.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=NP}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(N(e.extent)||!e.spatialReference)return null;const t=jk(e.extent,e.spatialReference);return t.zmin=e.elevationBounds.min,t.zmax=e.elevationBounds.max,t}elevationAt(e,t){if(N(this.extent)||!Qa(this.extent,e,t)){const i=w(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return XGe.warn("#elevationAt()",`Point used to sample elevation (${e}, ${t}) is outside of the sampler extent (${i})`),this.noDataValue}return $t(this.view.elevationProvider.getElevation(e,t,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(e){return zve(e.clone(),this)}};u([f({readOnly:!0})],k_.prototype,"demResolution",void 0),u([f({readOnly:!0})],k_.prototype,"extent",null),u([f({readOnly:!0})],k_.prototype,"noDataValue",void 0),u([f({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],k_.prototype,"spatialReference",void 0),u([f({constructOnly:!0})],k_.prototype,"view",void 0),k_=u([B("esri.views.support.GroundViewElevationSampler")],k_);const YGe=k_;let U_=class extends ze{constructor(e){super(e),this.handles=new xi,this.view=null,this.layerViews=new zt}initialize(){this.handles.add(Jl(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground},e=>e.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new YGe({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(e=>xe(()=>e.updating,()=>this._updateUpdating(),Rr)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};u([f({readOnly:!0})],U_.prototype,"elevationSampler",null),u([f({type:Boolean,readOnly:!0})],U_.prototype,"updating",null),u([f({constructOnly:!0})],U_.prototype,"view",void 0),u([f({type:zt,readOnly:!0})],U_.prototype,"layerViews",void 0),u([f({readOnly:!0})],U_.prototype,"suspended",null),U_=u([B("esri.views.GroundView")],U_);const QGe=U_,JGe=e=>{let t=class extends e{async fetchPopupFeatures(i,r){await this.when();const{location:s,queryArea:n,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(i,r),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(n,o,r),h=c.map(p=>p.promise);return{location:s,clientOnlyGraphics:a,allGraphicsPromise:WCe([l,...h]).then(p=>Array.from(new Set(p.flat()))),promisesPerLayerView:c}}_queryLayerPopupFeatures(i,r,s){return r.map(({layerView:n,graphics:o})=>{const a={clientGraphics:o,event:w(s)?s.event:null,signal:w(s)?s.signal:null,defaultPopupTemplateEnabled:!!w(s)&&!!s.defaultPopupTemplateEnabled},l=n.fetchPopupFeatures(i,a);return{layerView:n,promise:l}})}_isValidPopupGraphic(i,r){return i&&!!i.getEffectivePopupTemplate(w(r)&&r.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(i,r){const{clientGraphics:s,queryArea:n,location:o}=await this._popupHitTestGraphics(i,r),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(s,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:n,location:o}}async _popupHitTestGraphics(i,r){const{results:s,mapPoint:n}=await this.popupHitTest(i),o=s.filter(l=>l.type==="graphic"&&this._isValidPopupGraphic(l.graphic,r)),a=o.length?o[0].mapPoint:null;return{clientGraphics:o.map(l=>l.graphic),queryArea:n,location:n||a}}_getFetchPopupLayerViews(){const i=[];return this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&i.push(r)}),w(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&i.push(this.graphicsView),i.reverse()}_isValidPopupLayerView(i){return w(i)&&(!("layer"in i)||!i.suspended)&&"fetchPopupFeatures"in i}_graphicsPerFetchPopupLayerView(i,r){const s=[],n=new Map,o=r.map(a=>{const l=[];return"layer"in a?n.set(a.layer,l):n.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of i){const l=n.get(a.layer)||n.get(a.sourceLayer)||null;l?l.push(a):s.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:s}}};return t=u([B("esri.views.PopupView")],t),t};async function Hve(e,t){return await e.load(),KGe(e,t)}async function KGe(e,t){const i=[],r=(...n)=>{for(const o of n)N(o)||(Array.isArray(o)?r(...o):zt.isCollection(o)?o.forEach(a=>r(a)):jy.isLoadable(o)&&i.push(o))};t(r);let s=null;if(await $4e(i,async n=>{(await Xp(e7e(n)?n.loadAll():n.load())).ok!==!1||s||(s=n)}),s)throw s.loadError;return e}function e7e(e){return"loadAll"in e&&typeof e.loadAll=="function"}async function t7e(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e,i=await Hfe("esri/t9n/basemaps");return i[e]||i[t]}const mq={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return tr("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return tr("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return tr("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return tr("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return tr("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return tr("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return tr("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return tr("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return tr("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return tr("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return tr("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return tr("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return tr("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return tr("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return tr("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}},i7e=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),r7e=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function s7e(e){return e.layerContainerType==="basemap"?i7e:e.layerContainerType==="operational-layers"?r7e:null}function n7e(e,t){if(t.restrictedWebMapWriting){const i=s7e(t);return!w(i)||i.has(e.type)&&!HX(e)}return!0}function o7e(e,t){if(HX(e)){const i=$C("featureCollection.layers",t),r=i&&i[0]&&i[0].layerDefinition;r&&T6(e,r)}else e.type==="stream"?T6(e,t.layerDefinition=t.layerDefinition||{}):e.type!=="group"&&T6(e,t)}function T6(e,t){"maxScale"in e&&(t.maxScale=b4(e.maxScale)),"minScale"in e&&(t.minScale=b4(e.minScale))}function a7e(e,t){if(o7e(e,t),"blendMode"in e&&(t.blendMode=e.blendMode,t.blendMode==="normal"&&delete t.blendMode),t.opacity=b4(e.opacity),t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&e.type!=="wmts")if(HX(e)){const i=t.featureCollection;i&&(i.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function ase(e,t,i){if(!("write"in e)||!e.write)return i&&i.messages&&i.messages.push(new se("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if(n7e(e,i)){const r={};return e.write(r,i)?r:null}return w(t)&&a7e(e,t=me(t)),t}var dF;let l7e=0;const S6=Ie.getLogger("esri.Basemap");let Fh=dF=class extends B3(jy){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+l7e++,this.baseLayers=new zt,this.referenceLayers=new zt;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type==="elevation"&&S6.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a basemap layer and will therefore be ignored.`)},i=r=>{r.parent=null};this.baseLayers.on("after-add",r=>t(r.item)),this.referenceLayers.on("after-add",r=>t(r.item)),this.baseLayers.on("after-remove",r=>i(r.item)),this.referenceLayers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{S6.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var i;const e=this.baseLayers.removeAll();for(const r of e)r.destroy();const t=this.referenceLayers.removeAll();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(i=this.portalItem)==null||i.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",Ix(e,this._get("baseLayers")))}_writeBaseLayers(e,t,i){const r=[];e&&(i={...i,layerContainerType:"basemap"},this.baseLayers.forEach(s=>{const n=ase(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);w(n)&&r.push(n)}),this.referenceLayers.forEach(s=>{const n=ase(s,i.webmap?i.webmap.getLayerJSONFromResourceInfo(s):null,i);w(n)&&(n.isReference=!0,r.push(n))})),t.baseMapLayers=r}set referenceLayers(e){this._set("referenceLayers",Ix(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Hve(this,e=>{e(this.baseLayers,this.referenceLayers)})}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new dF({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(i=>{const r=me(i);return r.url&&Mm(r.url)&&(r.url=`https:${r.url}`),r.templateUrl&&Mm(r.templateUrl)&&(r.templateUrl=`https:${r.templateUrl}`),r})),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:i}=this;Ui(e);const r=[];if(t){const s=t.context?t.context.url:null;if(r.push(this._loadLayersFromJSON(t.data,s,e)),t.data.id&&!t.data.title){const n=t.data.id;r.push(t7e(n).then(o=>{o&&this.read({title:o},t.context)}))}}else i&&r.push(this._loadFromItem(i,e));await Promise.all(r)}async _loadLayersFromJSON(e,t,i){const r=this.resourceInfo&&this.resourceInfo.context,s=this.portalItem&&this.portalItem.portal||r&&r.portal||null,n=r&&r.origin==="web-scene"?"web-scene":"web-map",{populateOperationalLayers:o}=await _e(()=>import("./layersCreator.1e0fc8ba.js"),["layersCreator.1e0fc8ba.js","lazyLayerLoader.3b511a62.js","portalLayers.0f0eaa30.js","layersLoader.6e46b4a0.js","jsonContext.7555778f.js","portalItemUtils.eba1acfc.js"],import.meta.url),a=[];if(Ui(i),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const l={context:{origin:n,url:t,portal:s,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=o(this.baseLayers,e.baseMapLayers.filter(p=>!p.isReference),l);a.push(c);const h=o(this.referenceLayers,e.baseMapLayers.filter(p=>p.isReference),l);a.push(h)}await cl(a)}async _loadFromItem(e,t){const i=await e.load(t),r=await i.fetchData("json",t),s=$a(e.itemUrl);return this._set("resourceInfo",{data:r.baseMap,context:{origin:"web-map",portal:e.portal||Ql.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:r.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||Ql.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=mq[e];if(t){if(t.deprecated){let i=null;e==="dark-gray"?i="dark-gray-vector":e==="gray"?i="gray-vector":e==="streets"?i="streets-vector":e==="topo"&&(i="topo-vector"),Nhe(S6,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:i,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return dF.fromJSON(t)}return null}};u([f({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,i,r){this._writeBaseLayers(e,t,r)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:zt}},writer(e,t,i,r){this._writeBaseLayers(e,t,r)}}}}}})],Fh.prototype,"baseLayers",null),u([f({type:String,json:{origins:{"web-scene":{write:!0}}}})],Fh.prototype,"id",void 0),u([f({type:d5})],Fh.prototype,"portalItem",void 0),u([f()],Fh.prototype,"referenceLayers",null),u([f({readOnly:!0})],Fh.prototype,"resourceInfo",void 0),u([f({type:wt})],Fh.prototype,"spatialReference",void 0),u([f()],Fh.prototype,"thumbnailUrl",void 0),u([f({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],Fh.prototype,"title",void 0),u([ut("title")],Fh.prototype,"writeTitle",null),Fh=dF=u([B("esri.Basemap")],Fh);const m5=Fh,c7e=Object.freeze(Object.defineProperty({__proto__:null,default:m5},Symbol.toStringTag,{value:"Module"}));var gq;let pF=gq=class extends Fe{constructor(e){super(e),this.type="none"}clone(){return new gq({type:this.type})}};u([Rt({none:"none",stayAbove:"stay-above"})],pF.prototype,"type",void 0),pF=gq=u([B("esri.ground.NavigationConstraint")],pF);var yq;const lse=Ie.getLogger("esri.Ground");let qg=yq=class extends B3(jy){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new zt;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&lse.error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},i=r=>{r.parent=null};this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>i(r.item))}initialize(){this.when().catch(e=>{lse.error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)t.destroy();this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",Ix(e,this._get("layers")))}writeLayers(e,t,i,r){const s=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const o={};xVe(n)().write(o,r)&&s.push(o)}else r&&r.messages&&r.messages.push(new se("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=s}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return Hve(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await _e(()=>import("./ElevationQuery.733ec039.js"),[],import.meta.url);Ui(t);const r=new i,s=this.layers.filter(cse).toArray();return r.queryAll(s,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:i}=await _e(()=>import("./ElevationQuery.733ec039.js"),[],import.meta.url);Ui(t);const r=new i,s=this.layers.filter(cse).toArray();return r.createSamplerAll(s,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:me(this.surfaceColor),navigationConstraint:me(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new yq({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve(null)}_loadLayersFromJSON(e,t,i){const r=t&&t.origin||"web-scene",s=t&&t.portal||null,n=t&&t.url||null;return _e(()=>import("./layersCreator.1e0fc8ba.js"),["layersCreator.1e0fc8ba.js","lazyLayerLoader.3b511a62.js","portalLayers.0f0eaa30.js","layersLoader.6e46b4a0.js","jsonContext.7555778f.js","portalItemUtils.eba1acfc.js"],import.meta.url).then(({populateOperationalLayers:o})=>{Ui(i);const a=[];if(e.layers&&Array.isArray(e.layers)){const l={context:{origin:r,url:n,portal:s,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,e.layers,l))}return cl(a)}).then(()=>{})}};function u7e(e){return e&&"createElevationSampler"in e}function cse(e){return e.type==="elevation"||u7e(e)}u([f({json:{read:!1}})],qg.prototype,"layers",null),u([ut("layers")],qg.prototype,"writeLayers",null),u([f({readOnly:!0})],qg.prototype,"resourceInfo",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:cs,read:{reader:_P,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Gk(e)},target:"transparency"}}})],qg.prototype,"opacity",void 0),u([f({type:at,json:{type:[cs],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],qg.prototype,"surfaceColor",void 0),u([f({type:pF,json:{write:!0}})],qg.prototype,"navigationConstraint",void 0),qg=yq=u([B("esri.Ground")],qg);const g5=qg;let d2=class extends mT(zt){constructor(e){super(e),this.getCollections=null}initialize(){this.handles.add(Hhe(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=w(this.getCollections)?this.getCollections():null;if(N(e))return void this.removeAll();let t=0;for(const i of e)w(i)&&(t=this._processCollection(t,i));this.splice(t,this.length)}_createNewInstance(e){return new zt(e)}_processCollection(e,t){if(!t)return e;const i=this.itemFilterFunction?this.itemFilterFunction:r=>!!r;for(const r of t)if(r){if(i(r)){const s=this.indexOf(r,e);s>=0?s!==e&&this.reorder(r,e):this.add(r,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(r);if(Array.isArray(s))for(const n of s)e=this._processCollection(e,n);else e=this._processCollection(e,s)}}return e}};u([f()],d2.prototype,"getCollections",void 0),u([f()],d2.prototype,"getChildrenFunction",void 0),u([f()],d2.prototype,"itemFilterFunction",void 0),d2=u([B("esri.core.CollectionFlattener")],d2);const iC=d2;function h7e(e){var t;return!!(e&&e.loaded&&"capabilities"in e&&((t=e==null?void 0:e.capabilities)==null?void 0:t.operations)&&"supportsEditing"in e.capabilities.operations&&e.capabilities.operations.supportsEditing===!0)&&!("editingEnabled"in e&&!e.editingEnabled)}const use=Ie.getLogger("esri.support.basemapUtils");function d7e(){return{}}function p7e(e){for(const t in e){const i=e[t];(i==null?void 0:i.destroyed)===!1&&i.destroy(),delete e[t]}}function f7e(e,t){let i;if(typeof e=="string"){if(!(e in mq)){const r=Object.entries(mq).filter(([s,n])=>sr.apiKey&&!n.classic||!sr.apiKey&&n.classic&&!n.deprecated).map(([s])=>`"${s}"`).join(", ");return use.warn(`Unable to find basemap definition for: ${e}. Try one of these: ${r}`),null}t&&(i=t[e]),i||(i=m5.fromId(e),t&&(t[e]=i))}else i=hn(m5,e);return i!=null&&i.destroyed&&(use.warn("The provided basemap is already destroyed",{basemap:i}),i=null),i}function m7e(e){return new iC({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const i=[];return"tables"in t&&i.push(t.tables),"layers"in t&&i.push(t.layers),i},itemFilterFunction:t=>{const i=t.parent;return i&&"tables"in i&&i.tables.includes(t)}})}const g7e=Ie.getLogger("esri.support.groundUtils"),hse={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function y7e(e){let t=null;if(typeof e=="string")if(e in hse){const i=hse[e];t=new g5({resourceInfo:{data:{layers:[i]}}})}else g7e.warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=hn(g5,e);return t}function _q(e,t,i){let r,s;if(e)for(let n=0,o=e.length;n<o;n++){if(r=e.getItemAt(n),r[t]===i)return r;if((r==null?void 0:r.type)==="group"&&(s=_q(r.layers,t,i),s))return s}}const dse=Ie.getLogger("esri.support.LayersMixin"),_7e=e=>{let t=class extends e{constructor(...i){super(...i),this.layers=new zt;const r=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},s=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||dse.error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},n=o=>{o.parent=null,this.layerRemoved(o)};this.layers.on("before-add",o=>r(o.item)),this.layers.on("after-add",o=>s(o.item)),this.layers.on("after-remove",o=>n(o.item))}destroy(){const i=this.layers.removeAll();for(const r of i)this.layerRemoved(r),r.destroy();this.layers.destroy()}set layers(i){this._set("layers",Ix(i,this._get("layers")))}add(i,r){const s=this.layers;if(r=s.getNextIndex(r),i instanceof h5){const n=i;n.parent===this?this.reorder(n,r):s.add(n,r)}else ah(i)?i.then(n=>{this.destroyed||this.add(n,r)}):dse.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(i,r){const s=this.layers;r=s.getNextIndex(r),i.slice().forEach(n=>{n.parent!==this?(s.add(n,r),r+=1):this.reorder(n,r)})}findLayerById(i){return _q(this.layers,"id",i)}findLayerByUid(i){return _q(this.layers,"uid",i)}remove(i){return this.layers.remove(i)}removeMany(i){return this.layers.removeMany(i)}removeAll(){return this.layers.removeAll()}reorder(i,r){return this.layers.reorder(i,r)}layerAdded(i){}layerRemoved(i){}};return u([f()],t.prototype,"layers",null),t=u([B("esri.support.LayersMixin")],t),t},qve="esri.support.TablesMixin",v7e=Ie.getLogger(qve);function vq(e,t,i){if(e)for(let r=0,s=e.length;r<s;r++){const n=e.getItemAt(r);if(n[t]===i)return n;if((n==null?void 0:n.type)==="group"){const o=vq(n.tables,t,i);if(o)return o}}}const b7e=e=>{let t=class extends e{constructor(...i){super(...i),this.tables=new zt,this.tables.on("after-add",r=>{const s=r.item;s.parent&&s.parent!==this&&"tables"in s.parent&&s.parent.tables.remove(s),s.parent=this,s.type!=="feature"&&v7e.error(`Layer 'title:${s.title}, id:${s.id}' of type '${s.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",r=>{r.item.parent=null})}destroy(){const i=this.tables.removeAll();for(const r of i)r.destroy();this.tables.destroy()}set tables(i){this._set("tables",Ix(i,this._get("tables")))}findTableById(i){return vq(this.tables,"id",i)}findTableByUid(i){return vq(this.tables,"uid",i)}};return u([f()],t.prototype,"tables",null),t=u([B(qve)],t),t};let Bf=class extends b7e(_7e(ks.EventedMixin(ze))){constructor(e){super(e),this.allLayers=new iC({getCollections:()=>{var t,i,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=m7e(this),this.basemap=null,this.editableLayers=new iC({getCollections:()=>[this.allLayers],itemFilterFunction:h7e}),this.ground=new g5,this._basemapCache=d7e()}destroy(){var e,t;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(t=this.basemap)==null||t.destroy(),p7e(this._basemapCache),this._basemapCache=null}castBasemap(e){return f7e(e,this._basemapCache)}castGround(e){const t=y7e(e);return N(t)?this._get("ground"):t}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};u([f({readOnly:!0,dependsOn:[]})],Bf.prototype,"allLayers",void 0),u([f({readOnly:!0})],Bf.prototype,"allTables",void 0),u([f({type:m5})],Bf.prototype,"basemap",void 0),u([pi("basemap")],Bf.prototype,"castBasemap",null),u([f({readOnly:!0})],Bf.prototype,"editableLayers",void 0),u([f({type:g5,nonNullable:!0})],Bf.prototype,"ground",void 0),u([pi("ground")],Bf.prototype,"castGround",null),Bf=u([B("esri.Map")],Bf);const Wve=Bf;let NM=class extends wM{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};u([kZ({Type:ul,ensureType:hn(ul)})],NM.prototype,"itemType",void 0),NM=u([B("esri.support.GraphicsCollection")],NM);let z_=class extends ze{constructor(e){super(e),this.view=null,this.baseLayerViews=new zt,this.referenceLayerViews=new zt,this._loadingHandle=xe(()=>{var t,i;return(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap},t=>{t&&t.load().catch(()=>{})},si)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var t,i;if(this.view&&this.view.suspended)return!1;const e=(i=(t=this.view)==null?void 0:t.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(r=>r.updating)||this.referenceLayerViews.some(r=>r.updating))}};u([f({constructOnly:!0})],z_.prototype,"view",void 0),u([f({readOnly:!0})],z_.prototype,"baseLayerViews",void 0),u([f({readOnly:!0})],z_.prototype,"referenceLayerViews",void 0),u([f({readOnly:!0})],z_.prototype,"suspended",null),u([f({type:Boolean,readOnly:!0})],z_.prototype,"updating",null),z_=u([B("esri.views.BasemapView")],z_);const w7e=Ie.getLogger("esri.views.LayerViewManager");class x7e{constructor(t,i,r){this.layer=t,this.view=i,this.layerViewImporter=r,this._controller=new AbortController,this._deferred=Qv(),this._started=!1,this.done=!1,Ma(this._controller.signal,()=>{const s=new se("cancelled:layerview-create","layerview creation cancelled",{layer:t});this._deferred.reject(s)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:t}=this;if(!t)return;const{layer:i,view:r}=this;i.emit("layerview-destroy",{view:r,layerView:t}),r.emit("layerview-destroy",{layer:i,layerView:t}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){var s,n;if(this._started)return;this._started=!0;const{_controller:{signal:t},layer:i,view:r}=this;this._map=r.map;try{let o,a;if(await i.load({signal:t}),"prefetchResources"in i&&await i.prefetchResources({signal:t}),i.createLayerView)o=await i.createLayerView(r,{signal:t});else{if(!this.layerViewImporter.hasLayerViewModule(i))throw new se("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(i);Ui(t),o="default"in h?new h.default({layer:i,view:r}):new h({layer:i,view:r})}const l=()=>{a=Ln(a),o.destroyed||o.destroy(),o.layer=null,o.parent=null,o.view=null,this.done=!0};a=Ma(t,l),Ui(t);try{await o.when()}catch(h){throw l(),h}if(!((n=(s=this._map)==null?void 0:s.allLayers)==null?void 0:n.includes(i)))return l(),void this._deferred.reject(new se("view:no-layerview-for-layer","The layer has been removed from the map",{layer:i}));this.layerView=o,i.emit("layerview-create",{view:r,layerView:o}),r.emit("layerview-create",{layer:i,layerView:o}),this.done=!0,this._deferred.resolve(o)}catch(o){i.emit("layerview-create-error",{view:r,error:o}),r.emit("layerview-create-error",{layer:i,error:o}),this.done=!0,this._deferred.reject(new se("layerview:create-error","layerview creation failed",{layer:i,error:o}))}}}let kh=class extends BE{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new _m,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const t=(i=this.view.map)==null?void 0:i.allLayers;if(t)for(const r of t)this.layerViewImporter.hasLayerViewModule(r)&&this.layerViewImporter.importLayerView(r)},this._reschedule=()=>(N(this._workPromise)&&(this._workPromise=Qv()),this.handles.remove("reschedule"),this.handles.add(DC(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var n,o,a;const t=this.view.map;if(this._map!==t&&(this.clear(),this._map=t),N(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const i=new iC({getCollections:()=>this._rootCollectionNames.map(l=>this.get(l)),getChildrenFunction:l=>l&&"layers"in l?l.layers:null});if(!i)return this._workPromise.resolve(),void(this._workPromise=null);for(const l of i)this._createLayerView(l);this._refreshCollections();for(const[l,c]of this._layerLayerViewInfoMap)i.includes(l)||(this._layerLayerViewInfoMap.delete(c.layer),c.destroy());const r=i.filter(l=>l.type==="group").map(l=>l.layers),s=[(n=t==null?void 0:t.ground)==null?void 0:n.layers,(o=t==null?void 0:t.basemap)==null?void 0:o.baseLayers,(a=t==null?void 0:t.basemap)==null?void 0:a.referenceLayers,t==null?void 0:t.layers,...r].filter(l=>!!l);this.handles.add(s.map(l=>this._watchUpdatingTracking.addOnCollectionChange(()=>l,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([Fo(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),xe(()=>{const e=this.view,t=e==null?void 0:e.map;return[t==null?void 0:t.basemap,t==null?void 0:t.ground,t==null?void 0:t.layers,e==null?void 0:e.ready]},()=>this._reschedule(),an)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return w(this._workPromise)||this._watchUpdatingTracking.updating||On(this._layerLayerViewInfoMap,e=>!e.done)}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new se("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const s of e){const n=this._layerLayerViewInfoMap.get(s);if(!n||!n.layerView)continue;const o=n.layerView;o.layer=s,o.parent=i,t.getItemAt(r)!==o&&t.splice(r,0,o),s.layers&&this._populateLayerViewsOwners(s.layers,o.layerViews,o),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new x7e(e,this.view,this.layerViewImporter);t.promise.then(()=>this._refreshCollections(),i=>{var r,s;i&&(Cs(i)||i.name==="cancelled:layerview-create")||w7e.error(`Failed to create layerview for layer title:'${(r=e.title)!=null?r:"no title"}', id:'${(s=e.id)!=null?s:"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};u([f()],kh.prototype,"_workPromise",void 0),u([f({readOnly:!0})],kh.prototype,"_watchUpdatingTracking",void 0),u([f({readOnly:!0})],kh.prototype,"_layersToLayerViews",null),u([f({readOnly:!0})],kh.prototype,"_rootCollectionNames",null),u([f()],kh.prototype,"layerViewImporter",void 0),u([f()],kh.prototype,"supportsGround",void 0),u([f({readOnly:!0})],kh.prototype,"updating",null),u([f({readOnly:!0})],kh.prototype,"updatingRemaining",null),u([f({constructOnly:!0})],kh.prototype,"view",void 0),kh=u([B("esri.views.LayerViewManager")],kh);const T7e=kh;let mu=class extends ze{constructor(e){super(e),this.factor=1.5,this.offset=qp(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};u([f({type:Number})],mu.prototype,"factor",void 0),u([f({nonNullable:!0})],mu.prototype,"offset",void 0),u([f()],mu.prototype,"position",void 0),u([f({type:Number,range:{min:0}})],mu.prototype,"size",void 0),u([f()],mu.prototype,"maskUrl",void 0),u([f()],mu.prototype,"maskEnabled",void 0),u([f()],mu.prototype,"overlayUrl",void 0),u([f()],mu.prototype,"overlayEnabled",void 0),u([f({readOnly:!0})],mu.prototype,"version",null),u([f({type:Boolean})],mu.prototype,"visible",void 0),mu=u([B("esri.views.Magnifier")],mu);const Zve=mu;let fF=class extends ze{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.push(new pse(r,s,e,t,i)))}unshift(e,t,i){return this.running=!0,new Promise((r,s)=>this._tasks.unshift(new pse(r,s,e,t,i)))}_process(e){if(this._tasks.length===0)return!1;const t=this._tasks.shift();try{const i=An(t.signal);if(i&&!t.abortCallback)t.reject($i());else{const r=i?t.abortCallback($i()):t.callback(e);ah(r)?r.then(t.resolve,t.reject):t.resolve(r)}}catch(i){t.reject(i)}return this.running=this._tasks.length>0,!0}cancelAll(){const e=$i();for(const t of this._tasks)if(t.abortCallback){const i=t.abortCallback(e);t.resolve(i)}else t.reject(e);this._tasks.length=0,this.running=!1}};u([f()],fF.prototype,"running",void 0),fF=u([B("esri.layers.support.PromiseQueue")],fF);class pse{constructor(t,i,r,s,n){this.resolve=t,this.reject=i,this.callback=r,this.signal=s,this.abortCallback=n}}let zR=class extends ze{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};u([f()],zR.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),u([f()],zR.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),zR=u([B("esri.views.support.DebugFlags")],zR);const S7e=new zR,E7e=Ie.getLogger("esri.views.support.Scheduler");function C7e(){return new y5.Scheduler}var It;(function(e){e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="cloud generator",e[e.TEST_PRIO=1]="TEST_PRIO"})(It||(It={}));const rm=0,fse=new Map([[It.RESOURCE_CONTROLLER,rm],[It.SLIDE,rm],[It.STREAM_DATA_LOADER,rm],[It.ELEVATION_QUERY,rm],[It.TERRAIN_SURFACE,1],[It.SURFACE_GEOMETRY_UPDATES,1],[It.GRAPHICS_CORE,2],[It.I3S_CONTROLLER,2],[It.POINT_CLOUD_LAYER,2],[It.FEATURE_TILE_FETCHER,2],[It.OVERLAY,4],[It.STAGE,4],[It.GRAPHICS_DECONFLICTOR,4],[It.FILTER_VISIBILITY,4],[It.SCALE_VISIBILITY,4],[It.FRUSTUM_VISIBILITY,4],[It.POINT_OF_INTEREST_FREQUENT,6],[It.POINT_OF_INTEREST_INFREQUENT,30],[It.LABELER,8],[It.FEATURE_QUERY_ENGINE,8],[It.FEATURE_TILE_TREE,16],[It.FEATURE_TILE_TREE_ACTIVE,rm],[It.ELEVATION_ALIGNMENT,12],[It.TEXT_TEXTURE_ATLAS,12],[It.CLOUDS_GENERATOR,12],[It.TEXTURE_UNLOAD,12],[It.LINE_OF_SIGHT_TOOL,16],[It.LINE_OF_SIGHT_TOOL_INTERACTIVE,rm],[It.SNAPPING,rm],[It.SHADOW_ACCUMULATOR,30]]);function mse(e){return fse.has(e)?fse.get(e):typeof e=="number"?e:1}var no;(function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"})(no||(no={}));const gse=6.5,yse=1,A7e=30,_se=1e3/30,vse=100,bse=.9;var y5,Z1;(function(e){let t=class extends ze{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new Fv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new r,this._state=no.INTERACTING,this._tasks=new hi,this._runQueue=new hi,this._load=0,this._idleStateCallbacks=new hi,this._idleUpdatesStartFired=!1,this._maxReschedule=o$,this._forceTask=!1,this._debug=!1,this._debugHandle=xe(()=>S7e.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,si);for(const o of Object.keys(It))this.performanceInfo.tasks.set(It[o],new Fv(It[o]));let s;const n=this;this._test={get state(){return $t(s,n._state)},set state(o){s=o},FRAME_SAFETY_BUDGET:gse,INTERACTING_BUDGET:_se,IDLE_BUDGET:vse,get availableBudget(){return n._budget.budget},usedBudget:0,getBudget:()=>n._budget,setBudget:o=>n._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),Ln(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=o$,this._schedule(),this.frame()))}))}registerTask(s,n){const o=mse(s),a=new i(this,s,n,o);return this._tasks.push(a),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new Fv(s)),a}registerIdleStateCallbacks(s,n){const o={idleBegin:s,idleEnd:n};this._idleStateCallbacks.push(o),this.state===no.IDLE&&this._idleUpdatesStartFired&&o.idleBegin();const a=this;return{remove:()=>this._removeIdleStateCallbacks(o),set idleBegin(l){a._idleUpdatesStartFired&&(o.idleEnd(),a._state===no.IDLE&&l()),o.idleBegin=l},set idleEnd(l){o.idleEnd=l}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==no.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(n=>n.idleEnd())))}get state(){return N(this._test.state)?this._state:this._test.state}updateBudget(s){this._test.usedBudget=0;let n=gse,o=s.frameDuration,a=yse;switch(this.state){case no.IDLE:n=0,o=Math.max(vse,s.frameDuration),a=A7e;break;case no.INTERACTING:o=Math.max(_se,s.frameDuration);case no.ANIMATING:}return o=o-s.elapsedFrameTime-n,this.state!==no.IDLE&&o<yse&&!this._forceTask?(this._forceTask=!0,!1):(o=Math.max(o,a),this._budget.reset(o,this.state),this._maxReschedule=o$,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case no.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case no.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s)}_updateTask(s){this._tasks.forAll(n=>{n.name===s&&n.setPriority(s)})}_getState(s){if(this._runQueue.some(o=>o.name===s))return Z1.SCHEDULED;let n=Z1.IDLE;return this._tasks.forAll(o=>{o.name===s&&o.needsUpdate&&(o.schedulePriority<=1?n=Z1.READY:n!==Z1.READY&&(n=Z1.WAITING))}),n}_getRuntime(s){let n=0;return this._tasks.forAll(o=>{o.name===s&&(n+=o.runtime)}),n}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(o=>{o.needsUpdate&&s.set(o.name,(s.get(o.name)||0)+1)}),s.size===0)return null;let n="";return s.forEach((o,a)=>{n+=o>1?` ${o}x ${a}`:` ${a}`}),n}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((n,o)=>o.needsUpdate?++n:n,0);this._load=this._load*bse+s*(1-bse)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===rm&&s.needsUpdate&&!this._runQueue.includes(s)&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,n=0;if(this._tasks.forAll(o=>{o.needsUpdate&&o.schedulePriority!==0&&o.basePriority!==rm&&(s=!0,n=Math.max(n,o.basePriority),o.schedulePriority===1?(o.schedulePriority=0,this._runQueue.push(o)):--o.schedulePriority)}),!s)return this.updating=!1,!1;this._maxReschedule===o$&&(this._maxReschedule=n),--this._maxReschedule}return this.updating=!0,!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const n=this._budget.now(),o=this._runQueue.pop();this._budget.resetProgress();try{o.task.runTask(this._budget)}catch(l){E7e.error(`Exception in task "${o.name}"`,l)}o.schedulePriority=o.basePriority;const a=this._budget.now()-n;if(o.runtime+=a,this._frameTaskTimes.set(o.priority,this._frameTaskTimes.get(o.priority)+a),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",o.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some(l=>l.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this.updating=this._tasks.some(n=>n.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(It))this._frameTaskTimes.set(It[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((n,o)=>this.performanceInfo.tasks.get(o).record(n)),this.performanceInfo.total.record(s)}get test(){return this._test}};u([f()],t.prototype,"updating",void 0),t=u([B("esri.views.support.Scheduler")],t),e.Scheduler=t;let i=class extends ze{constructor(s,n,o,a){super({}),this._scheduler=s,this.name=n,this._basePriority=a,this.runtime=0,this._queue=new fF,this._handles=new xi,this.schedulePriority=this._basePriority,this.task=w(o)?o:this._queue,this._handles.add(Jl(()=>this.task.running,()=>s.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(iA),this._scheduler.removeTask(this),this.schedule=rC.schedule,this.reschedule=rC.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const n=mse(s);this._basePriority!==rm&&this.schedulePriority===0||(this.schedulePriority=n),this._basePriority=n}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,n,o){return this._queue.push(s,n,o)}reschedule(s,n,o){return this._queue.unshift(s,n,o)}processQueue(s){this._queue.runTask(s)}};u([f({constructOnly:!0})],i.prototype,"task",void 0),u([f({readOnly:!0})],i.prototype,"updating",null),i=u([B("esri.views.support.SchedulerTask")],i);class r{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=no.IDLE,this._didWork=!1,this._enabled=!0}run(n){return!this.done&&(n()===!0&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(n){this._enabled=n}reset(n,o){this._begin=this.now(),this._budget=n,this._state=o,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}e.Budget=r})(y5||(y5={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(Z1||(Z1={}));const iA=(()=>{const e=new y5.Budget;return e.enabled=!1,e})();class O7e{remove(){}processQueue(){}schedule(t,i,r){try{if(An(i)){const s=$i();return r?Promise.resolve(r(s)):Promise.reject(s)}return oG(t(iA))}catch(s){return Promise.reject(s)}}reschedule(t,i,r){return this.schedule(t,i,r)}}const rC=new O7e,o$=Number.MAX_SAFE_INTEGER;let z2=class extends ze{constructor(e,t){var i;super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(i=t==null?void 0:t.registerTask(It.TEXTURE_UNLOAD))!=null?i:rC}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(e=>this._releaseTextureRequest(e)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let s=this._textureRequests.get(r);return s||(s={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(s.texture),this._stage.loadImmediate(s.texture)),this._textureRequests.set(r,s)),s.referenceCount++,{uid:r,texture:s.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){var t;e.onRemove&&e.onRemove(),e.texture?(t=this._stage)==null||t.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return w(t)?`${e}.${t}px`:e}};u([f()],z2.prototype,"_frameTask",void 0),u([f()],z2.prototype,"updating",null),z2=u([B("esri.views.3d.support.TextureCollection")],z2);var wse;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right"})(wse||(wse={}));const Xve=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],Yve={};function Qve(e){return!!Yve[e]}function R7e(e){for(const t of e)if(!Qve(t))return!1;return!0}Xve.forEach(e=>{Yve[e]=!0});class M7e{constructor(t){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=t,this.inputManager=null}connect(t){t&&this.disconnect(),this.inputManager=t,this.handlers.forEach(({handler:i,priority:r},s)=>this.inputManager.installHandlers(s,[i],r))}disconnect(){this.inputManager&&this.handlers.forEach((t,i)=>this.inputManager.uninstallHandlers(i)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(t,i,r,s){const n=Array.isArray(t)?t:t.split(",");if(!R7e(n))return n.some(Qve)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(i)?a=i:(o=i,a=[]),typeof r=="function"?o=r:s=r,s=s!=null?s:Gv.DEFAULT;const l=this._createUniqueGroupName(),c=new P7e(this.view,n,a,o);this.handlers.set(l,{handler:c,priority:s});for(const h of n){const p=this.handlerCounts.get(h)||0;this.handlerCounts.set(h,p+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],s),{remove:()=>this._removeHandler(l,n)}}hasHandler(t){return!!this.handlerCounts.get(t)}_removeHandler(t,i){if(this.handlers.has(t)){this.handlers.delete(t);for(const r of i){const s=this.handlerCounts.get(r);s===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",r):s===1?this.handlerCounts.delete(r):this.handlerCounts.set(r,s-1)}}this.inputManager&&this.inputManager.uninstallHandlers(t)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class P7e extends ua{constructor(t,i,r,s){super(!0),this.view=t;for(const n of i)switch(n){case"click":this.registerIncoming("click",r,o=>s(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",r,o=>s(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",r,o=>s(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",r,o=>s(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",r,o=>s(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",r,o=>{const a=this._wrapDrag(o);a&&s(a)});break;case"key-down":this.registerIncoming("key-down",r,o=>s(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",r,o=>s(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",r,o=>s(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",r,o=>s(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",r,o=>s(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",r,o=>s(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",r,o=>s(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",r,o=>s(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",r,o=>s(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",r,o=>{s(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",r,o=>{s(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",r,o=>{s(this._wrapBlur(o))})}}_wrapFocus(t){return{type:"focus",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapBlur(t){return{type:"blur",timestamp:t.timestamp,native:t.data.native,cancelable:t.cancelable,stopPropagation:()=>t.stopPropagation(),async:i=>t.async(i),preventDefault:()=>t.preventDefault()}}_wrapClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,screenPoint:qp(n,o),mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,{cancelable:c,timestamp:h}=t;return{type:"double-click",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:c,stopPropagation:()=>t.stopPropagation(),async:p=>t.async(p),preventDefault:()=>t.preventDefault()}}_wrapImmediateClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapImmediateDoubleClick(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a,eventId:l}=t.data,c=a.pointerId,{cancelable:h,timestamp:p}=t;return{type:"immediate-double-click",pointerId:c,pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:p,mapPoint:this._getMapPoint(n,o),eventId:l,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:m=>t.async(m),preventDefault:()=>t.preventDefault()}}_wrapHold(t){const{pointerType:i,button:r,buttons:s,x:n,y:o,native:a}=t.data,{cancelable:l,timestamp:c}=t;return{type:"hold",pointerType:i,button:r,buttons:s,x:n,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(n,o),cancelable:l,stopPropagation:()=>t.stopPropagation(),async:h=>t.async(h),preventDefault:()=>t.preventDefault()}}_getMapPoint(t,i){return this.view.toMap(qp(t,i),{exclude:[]})}_wrapDrag(t){const i=t.data,{x:r,y:s}=i.center,{action:n,pointerType:o,button:a}=i;if(n==="start"&&(this.latestDragStart=i),!this.latestDragStart)return;const l=i.pointer.native,c=i.buttons,{cancelable:h,timestamp:p}=t,m={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return n==="end"&&(this.latestDragStart=void 0),{type:"drag",action:n,x:r,y:s,origin:m,pointerType:o,button:a,buttons:c,radius:i.radius,angle:Vc(i.angle),native:l,timestamp:p,cancelable:h,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapKeyDown(t){const{key:i,repeat:r,native:s}=t.data,{cancelable:n,timestamp:o}=t;return{type:"key-down",key:i,repeat:r,native:s,timestamp:o,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:a=>t.async(a),preventDefault:()=>t.preventDefault()}}_wrapKeyUp(t){const{key:i,native:r}=t.data,{cancelable:s,timestamp:n}=t;return{type:"key-up",key:i,native:r,timestamp:n,cancelable:s,stopPropagation:()=>t.stopPropagation(),async:o=>t.async(o),preventDefault:()=>t.preventDefault()}}_wrapPointer(t,i){const{x:r,y:s,button:n,buttons:o,native:a,eventId:l}=t.data,c=a.pointerId,h=a.pointerType,{cancelable:p,timestamp:m}=t;return{type:i,x:r,y:s,pointerId:c,pointerType:h,button:n,buttons:o,native:a,timestamp:m,eventId:l,cancelable:p,stopPropagation:()=>t.stopPropagation(),async:g=>t.async(g),preventDefault:()=>t.preventDefault()}}_wrapPointerDrag(t){const{x:i,y:r,buttons:s,native:n,eventId:o}=t.data.currentEvent,{button:a}=t.data.startEvent,l=t.data.startEvent.native.pointerId,c=t.data.startEvent.native.pointerType,h=t.data.action,p={x:t.data.startEvent.x,y:t.data.startEvent.y},{cancelable:m,timestamp:g}=t;return{type:"pointer-drag",x:i,y:r,pointerId:l,pointerType:c,button:a,buttons:s,action:h,origin:p,native:n,timestamp:g,eventId:o,cancelable:m,stopPropagation:()=>t.stopPropagation(),async:v=>t.async(v),preventDefault:()=>t.preventDefault()}}_wrapMouseWheel(t){const{cancelable:i,data:r,timestamp:s}=t,{x:n,y:o,deltaY:a,native:l}=r;return{type:"mouse-wheel",x:n,y:o,deltaY:a,native:l,timestamp:s,cancelable:i,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}_wrapGamepad(t){const{action:i,state:r,device:s}=t.data,{cancelable:n,timestamp:o}=t,{buttons:a,axes:l}=r;return{type:"gamepad",device:s,timestamp:o,action:i,buttons:a,axes:l,cancelable:n,stopPropagation:()=>t.stopPropagation(),async:c=>t.async(c),preventDefault:()=>t.preventDefault()}}}var FP,xse,Tse;(function(e){e[e.USER=0]="USER",e[e.MANAGER=1]="MANAGER"})(FP||(FP={})),function(e){e[e.None=0]="None",e[e.Unfocused=1]="Unfocused",e[e.Focused=2]="Focused",e[e.Unselected=4]="Unselected",e[e.Selected=8]="Selected",e[e.All=15]="All"}(xse||(xse={})),function(e){e[e.None=0]="None",e[e.Custom1=16]="Custom1",e[e.Custom2=32]="Custom2",e[e.Custom3=64]="Custom3",e[e.Custom4=128]="Custom4",e[e.Custom5=256]="Custom5",e[e.Custom6=512]="Custom6",e[e.Custom7=1024]="Custom7",e[e.Custom8=2048]="Custom8",e[e.Custom9=4096]="Custom9",e[e.Custom10=8192]="Custom10",e[e.Custom11=16384]="Custom11",e[e.Custom12=32768]="Custom12",e[e.All=65520]="All"}(Tse||(Tse={}));const I7e=Ie.getLogger("esri.views.interactive.interactiveToolUtils");function L7e(e){return[e.on("before-add",t=>{const i=t.item;if(i==null||e.includes(i))return I7e.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()}),e.on("after-remove",t=>{const i=t.item;i.visible=!1,i.active&&(i.view.activeTool=null),i.destroy()})]}function _5(e){return e.visible&&e.getEditableFlag(FP.USER)&&e.getEditableFlag(FP.MANAGER)}function Vf(e){return qp(e.x,e.y)}function vbt(e){return ys(e.x,e.y)}function Jve(e,t){const i=(e instanceof HTMLElement?e:e.surface).getBoundingClientRect();return qp(t.clientX-i.left,t.clientY-i.top)}function Sse(e,t){return t instanceof Event?Jve(e,t):Vf(t)}function Ese(e){if(e instanceof Event)return!0;if(typeof e=="object"&&"type"in e)switch(e.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class $7e{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(t,i){const r=()=>t.stopPropagation();switch(t.type){case"pointer-move":Cse(t.pointerType)&&this._pointerLocations.set(t.pointerId,{x:t.x,y:t.y,pointerType:t.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(r(),t.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!Ase(t))break;const s=Vf(t),n=this._intersect(s,t.pointerType,i.forEachTool);if(N(n))break;const o=this._findToolAndManipulatorByKey(n,i.forEachTool,a$),a=Cn(o,c=>c.manipulator),l=Cn(o,c=>c.tool);!(w(a)&&w(l)&&a.interactive)||a.grabbable&&a.grabbableForEvent(t)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,l,t),w(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(t)&&!a.grabbing&&(this._grabbedManipulators.set(t.pointerId,{key:n,start:s,pointerType:t.pointerType}),this._grabbedManipulators.size===1&&i.activeTool!==n.tool&&(this._currentlyActiveTool=i.activeTool,this._revertToActiveTool=!0,i.setActiveTool(n.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:t.pointerType,screenPoint:s}),r());break}case"pointer-up":this._handlePointerEnd(t,i);break;case"pointer-drag":{if(!Ase(t))break;const s=this._grabbedManipulators.get(t.pointerId),n=this._draggedManipulators.get(t.pointerId),o=Cn(s||n,({key:h})=>h),a=this._findManipulatorByKey(o,i.forEachTool);if(N(a))break;const l=Vf(t);l.x=Xe(l.x,0,i.view.width),l.y=Xe(l.y,0,i.view.height);const c=(s||n).start;switch(t.action){case"start":case"update":t.action!=="update"&&this._grabbedManipulators.size!==1||(a.dragging=!0,n?a.events.emit("drag",{action:"update",start:c,screenPoint:l}):a.events.emit("drag",{action:"start",start:c,screenPoint:l,pointerType:t.pointerType}),this._draggedManipulators.set(t.pointerId,{key:o,start:c}));break;case"end":a.dragging=!1,n&&a.events.emit("drag",{action:"end",start:c,screenPoint:l}),this._draggedManipulators.delete(t.pointerId),this._handlePointerEnd(t,i)}r();break}case"immediate-click":{const s=Vf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findToolAndManipulatorByKey(n,i.forEachTool,a$);if(D7e(t)||i.forEachTool(h=>{if((!w(o)||o.tool!==h||h.automaticManipulatorSelection)&&h.manipulators){let p=!1;h.manipulators.forEach(({manipulator:m})=>{m.selected&&(m.selected=!1,p=!0)}),p&&h.manipulatorSelectionChanged&&h.manipulatorSelectionChanged()}}),N(o))break;const{manipulator:a,tool:l}=o;if(!a.interactive)break;a.selectable&&l.automaticManipulatorSelection&&(a.selected=!a.selected,l.manipulatorSelectionChanged&&l.manipulatorSelectionChanged());const c=t.native.shiftKey;a.events.emit("immediate-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:c,stopPropagation:r});break}case"click":{const s=Vf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(N(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit(t.type,{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a}),r();break}case"double-click":{const s=Vf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(N(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}case"immediate-double-click":{const s=Vf(t),n=this._intersect(s,t.pointerType,i.forEachTool),o=this._findManipulatorByKey(n,i.forEachTool);if(N(o)||!o.interactive)break;const a=t.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:s,button:t.button,pointerType:t.pointerType,shiftKey:a,stopPropagation:r});break}}this._onFocusChange(i.forEachTool)}_ungrabManipulatorBeforeDragging(t,i,r){t.grabbing=!1,t.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:Vf(r)}),this._grabbedManipulators.forEach(({key:s},n)=>{s.tool===i&&i.manipulators.findById(s.manipulatorId)===t&&this._grabbedManipulators.delete(n)})}_handlePointerEnd(t,i){const r=Cn(this._grabbedManipulators.get(t.pointerId),({key:n})=>n),s=this._findManipulatorByKey(r,i.forEachTool);w(s)&&!s.dragging&&(this._grabbedManipulators.size===1&&this._draggedManipulators.size===0&&this._revertToActiveTool&&(i.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),s.grabbing&&(s.grabbing=!1,s.events.emit("grab-changed",{action:"end",pointerType:t.pointerType,screenPoint:Vf(t)})),this._grabbedManipulators.delete(t.pointerId))}_cursorFromMap(t,i){let r=null;return On(t,({key:s})=>{const n=this._findManipulatorByKey(s,i);return!!(w(n)&&n.interactive&&"cursor"in n&&n.cursor)&&(r=n.cursor,!0)}),r}_onFocusChange(t){this._updateCursor(t),this._updateFocusedManipulatorTools(t)}_updateCursor(t){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,t)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,t)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(t){const i=new Set;this._grabbedManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),this._hoveredManipulators.forEach(({key:{tool:r}})=>{i.add(r)}),t(r=>{r.hasFocusedManipulators=i.has(r)})}clearPointers(t,i,r=!0,s){const n=o=>o.tool===t&&(N(s)||o.manipulatorId===s);this._grabbedManipulators.forEach(({key:o,pointerType:a},l)=>{if(n(o)){this._grabbedManipulators.delete(l);const c=this._findManipulatorByKey(o,i);w(c)&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:a}))}}),this._draggedManipulators.forEach(({key:o},a)=>{if(n(o)){this._draggedManipulators.delete(a);const l=this._findManipulatorByKey(o,i);w(l)&&(l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}}),r&&this._hoveredManipulators.forEach(({key:o},a)=>{if(n(o)){this._hoveredManipulators.delete(a);const l=this._findManipulatorByKey(o,i);w(l)&&(l.hovering=!1)}}),this._onFocusChange(i)}_intersect(t,i,r){let s=null;return r(n=>{if(n.manipulators==null||!_5(n))return!1;const o=n.manipulators.intersect(t,i);return!N(o)&&(s={manipulatorId:o.id,tool:n},!0)}),s}updateHoveredStateFromKnownPointers(t){this._pointerLocations.forEach((i,r)=>{this._updateHoveredStateForPointerAtScreenPosition(qp(i.x,i.y),r,i.pointerType,t)})}handleHoverEvent(t,i){t.type!=="pointer-up"&&t.type!=="immediate-click"&&t.type!=="pointer-move"||!Cse(t.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(Vf(t),t.pointerId,t.pointerType,i)}_updateHoveredStateForPointerAtScreenPosition(t,i,r,s){const n=this._intersect(t,r,s);let o=this._findManipulatorByKey(n,s);const a=Cn(this._hoveredManipulators.get(i),({key:c})=>c),l=this._findManipulatorByKey(a,s);w(o)&&!o.interactive&&(o=null),l!==o&&(w(l)&&(l.hovering=!1),w(o)?(o.hovering=!0,this._hoveredManipulators.set(i,{key:n})):this._hoveredManipulators.delete(i),this._onFocusChange(s))}_findManipulatorByKey(t,i){return this._findToolAndManipulatorByKey(t,i,a$)?a$.manipulator:null}_findToolAndManipulatorByKey(t,i,r){return N(t)?null:(r.tool=null,r.manipulator=null,i(s=>{if(s!==t.tool||s.manipulators==null||!_5(s))return!1;const n=s.manipulators.findById(t.manipulatorId);return!!w(n)&&(r.manipulator=n,r.tool=s,!0)}),r.manipulator?r:null)}}function Cse(e){return e==="mouse"}function Ase(e){return e.pointerType!=="mouse"||e.button===0}function D7e(e){return!!e.native.shiftKey}const a$={manipulator:null,tool:null},N7e=Ie.getLogger("esri.views.ToolViewManager"),Ose="attached",E6="tools";let Wg=class extends BE{constructor(e){super(e),this._manipulatorState=new $7e,this.tools=new zt,this.cursor=null,this._forEachTool=t=>{for(const i of this.tools.items)if(t(i))return}}initialize(){this.handles.add([this.view.on(Xve,e=>{this._handleInputEvent(e)},Gv.TOOL),...L7e(this.tools),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(w(e)&&!this.view.ready)return void N7e.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),w(t)&&t.deactivate(),w(e)&&e.activate(),this._removeIncompleteTools(e);const i=N(this.activeTool);for(const r of this.tools){r.setEditableFlag(FP.MANAGER,i||r===this.activeTool);const s=_5(r);!i&&s||this._manipulatorState.clearPointers(r,this._forEachTool,!s)}this._updateCursor()}get updating(){var e,t;return this.updatingHandles.updating||this.tools.some(i=>i.updating)||((t=(e=this.textures)==null?void 0:e.updating)!=null?t:!1)}attach(){this.view.type==="3d"?(this._set("textures",new z2(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([xe(()=>{const{state:e}=this.view;return"camera"in e&&e.camera},()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}),this.view.elevationProvider.on("elevation-change",e=>{this._forEachManipulator(t=>{t.onElevationChange!=null&&t.onElevationChange(e)})}),md(()=>this._set("textures",Tt(this.textures)))],Ose)):this.handles.add(xe(()=>this.view.extent,()=>{this._forEachManipulator(e=>{e.onViewChange!=null&&e.onViewChange()})}))}detach(){w(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(Ose)}_forEachManipulator(e){this._forEachTool(t=>{t.manipulators&&t.manipulators.forEach(({manipulator:i})=>e(i,t))})}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};w(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(r=>{!t&&r.visible&&r.handleInputEvent(i)}),!t&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:r=>{this.activeTool=r},view:this.view}),!t&&w(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(E6),this._forEachTool(e=>{if(e instanceof ze){const t=xe(()=>[e.cursor,e.visible,e.editable],()=>{_5(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()});this.handles.add(t,E6)}e.manipulators&&this.handles.add(e.manipulators.on("change",t=>{t.removed.forEach(({id:i})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,i)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),E6)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool(i=>!(!w(i.cursor)||!i.visible||!N(e)&&i.preferManipulatorCursor)&&(t=i.cursor,!0)),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter(t=>(N(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel).forEach(t=>{this.tools.remove(t)})}};u([f({constructOnly:!0,nonNullable:!0})],Wg.prototype,"view",void 0),u([f({readOnly:!0,nonNullable:!0})],Wg.prototype,"textures",void 0),u([f({value:null})],Wg.prototype,"activeTool",null),u([f({readOnly:!0,type:zt})],Wg.prototype,"tools",void 0),u([f({readOnly:!0})],Wg.prototype,"cursor",void 0),u([f({readOnly:!0})],Wg.prototype,"updating",null),Wg=u([B("esri.views.ToolViewManager")],Wg);const F7e=Wg;let p2=class extends ze{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":k7e.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return U7e[this.deviceType]}};u([f({nonNullable:!0,readOnly:!0})],p2.prototype,"nativeIndex",void 0),u([f({type:String,readOnly:!0})],p2.prototype,"deviceType",null),u([f({type:Number,readOnly:!0})],p2.prototype,"axisThreshold",null),p2=u([B("esri.views.input.gamepad.GamepadInputDevice")],p2);const k7e=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),U7e={standard:.15,spacemouse:.025,unknown:0},nQ=p2;let BR=class extends ze{constructor(...e){super(...e),this.devices=new zt,this.enabledFocusMode="document"}};u([f({type:zt.ofType(nQ),readOnly:!0})],BR.prototype,"devices",void 0),u([f({type:["document","view","none"]})],BR.prototype,"enabledFocusMode",void 0),BR=u([B("esri.views.input.gamepad.GamepadSettings")],BR);const z7e=BR;let mF=class extends ze{constructor(){super(...arguments),this.gamepad=new z7e}};u([f({readOnly:!0})],mF.prototype,"gamepad",void 0),mF=u([B("esri.views.input.Input")],mF);const B7e=mF;let B_=class extends ze{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};u([f({type:Boolean,nonNullable:!0})],B_.prototype,"enabled",void 0),u([f({type:nQ})],B_.prototype,"device",void 0),u([f({type:["pan","zoom"],nonNullable:!0})],B_.prototype,"mode",void 0),u([f({type:["forward-down","forward-up"],nonNullable:!0})],B_.prototype,"tiltDirection",void 0),u([f({type:Number,nonNullable:!0})],B_.prototype,"velocityFactor",void 0),B_=u([B("esri.views.navigation.gamepad.GamepadSettings")],B_);const Kve=B_;let tw=class extends ze{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Kve,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};u([f({type:Boolean})],tw.prototype,"browserTouchPanEnabled",void 0),u([f({type:Kve,nonNullable:!0})],tw.prototype,"gamepad",void 0),u([f({type:Boolean})],tw.prototype,"momentumEnabled",void 0),u([f({type:Boolean})],tw.prototype,"mouseWheelZoomEnabled",void 0),tw=u([B("esri.views.navigation.Navigation")],tw);const e1e=tw;function bbt(e,t,i){const r=t1e(e),s=t,n=V7e(r,s,i);if(r){const o=jC.deriveUnitFromSR(r,e.spatialReference).heightUnit;if(!i&&o!==r.heightUnit){const a=new se("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new se("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r,error:a})}}if(!G7e(e)||n===Tc.Unsupported)return new se("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:r});switch(n){case Tc.Units:{const o=r.heightUnit||"unknown",a=s.heightUnit||"unknown",l=new se("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new se("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Tc.HeightModel:{const o=r.heightModel||"unknown",a=s.heightModel||"unknown",l=new se("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new se("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}case Tc.CRS:{const o=r.vertCRS||"unknown",a=s.vertCRS||"unknown",l=new se("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new se("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:r,sceneHeightModelInfo:s,error:l})}}return null}function V7e(e,t,i){if(!Rse(e)||!Rse(t))return Tc.Unsupported;if(e==null||t==null)return Tc.Ok;if(!i&&e.heightUnit!==t.heightUnit)return Tc.Units;if(e.heightModel!==t.heightModel)return Tc.HeightModel;switch(e.heightModel){case"gravity-related-height":return Tc.Ok;case"ellipsoidal":return e.vertCRS===t.vertCRS?Tc.Ok:Tc.CRS;default:return Tc.Unsupported}}var Tc;function Rse(e){return e==null||e.heightModel!=null&&e.heightUnit!=null}function G7e(e){return"heightModelInfo"in e&&e.heightModelInfo!=null||e.spatialReference!=null||!s1e(e)}function t1e(e){const t=e.url&&tC(e.url);return!((e.spatialReference&&e.spatialReference.vcsWkid)==null&&w(t)&&t.serverType==="ImageServer")&&i1e(e)&&e.heightModelInfo?e.heightModelInfo:s1e(e)?jC.deriveUnitFromSR(H7e,e.spatialReference):null}function i1e(e){return"heightModelInfo"in e}function r1e(e){if(e.type==="unknown"||!("capabilities"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function s1e(e){return r1e(e)?!!(e.capabilities&&e.capabilities.data&&e.capabilities.data.supportsZ):n1e(e)}function j7e(e){return e.layers!=null||n1e(e)||r1e(e)||i1e(e)}function n1e(e){switch(e.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(e){e[e.Ok=0]="Ok",e[e.Units=1]="Units",e[e.HeightModel=2]="HeightModel",e[e.CRS=3]="CRS",e[e.Unsupported=4]="Unsupported"})(Tc||(Tc={}));const H7e=new jC({heightModel:"gravity-related-height"});var st;function Mse(e){return e==="global"?st.Global:st.Local}function C6(e){return e===st.Global?"global":"local"}(function(e){e[e.Global=1]="Global",e[e.Local=2]="Local"})(st||(st={}));let bq,A6=null;async function q7e(e){A6||(A6=_e(()=>Promise.resolve().then(()=>zct),void 0,import.meta.url).then(t=>bq=t)),await A6,Ui(e)}async function o1e(e,t,i,r){if(!e)return null;const s=e.spatialReference;return TX()||t1(s,t)?Z3(e,t):bq?bq.projectGeometry(e,t,i,r):(await Promise.race([q7e(r),B4(r)]),o1e(e,t,i,r))}let Kr=class extends ze{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=fd(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return w(this.userSpatialReference)?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return N(this.userSpatialReference)||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,r,s,n;const e=(i=this.map)==null?void 0:i.call(this),t=[];return w(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e==null?void 0:e.basemap,layers:(r=e==null?void 0:e.basemap)==null?void 0:r.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var s;if(this.suspended)return(s=this._get("_spatialReferenceTask"))!=null?s:{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const n of e){const o=this._getSupportedSpatialReferences(n);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);w(a)&&(i=a)}if(w(i)&&i.length===1)break}if(t&&(N(i)||i.length!==1))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:w(r)?r.spatialReference:null,viewingMode:w(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,r,s,n,o,a,l,c;if(!this.required.tileInfo)return(i=this._get("_tileInfoTask"))!=null?i:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:(s=(r=this.map)==null?void 0:r.call(this))==null?void 0:s.basemap,layers:(a=(o=(n=this.map)==null?void 0:n.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const h=e[0].tileInfo;return{tileInfo:h&&h.spatialReference.equals(this.spatialReference)?h:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){var i,r,s,n;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))==null?void 0:i.heightModelInfo))return(r=this._get("_heightModelInfoTask"))!=null?r:{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const o of e)if(j7e(o)){const a=t1e(o);if(a)return{heightModelInfo:a,vcsWkid:(s=o.spatialReference)==null?void 0:s.vcsWkid,latestVcsWkid:(n=o.spatialReference)==null?void 0:n.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){var r,s;if(this.suspended||!this.required.extent)return(r=this._get("_extentCandidatesTask"))!=null?r:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const n of e.layers){const o="fullExtents"in n&&n.fullExtents||(w(n.fullExtent)?[n.fullExtent]:[]),a=this.requiresExtentInSpatialReference?null:o[0],l=(s=o.find(c=>c.spatialReference.equals(this.spatialReference)))!=null?s:a;if(l)return{candidates:[{extent:l,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const c of o)i.push({extent:c,layer:n})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(N(e)||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:w(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(w(this._projectExtentTask.task)&&(this._projectExtentTask.task=fd(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:k3(async s=>{try{const n=await o1e(i.extent,r,i.layer.portalItem,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:n}}catch{if(An(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(N(e))return t;const i=[],r=(s,n)=>w(s)?w(n)?s===n&&s:s:n;for(const s of e)for(const n of t){if(!s.spatialReference.equals(n.spatialReference))continue;const o=r(s.viewingMode,n.viewingMode);if(o!==!1){i.push({spatialReference:s.spatialReference,viewingMode:o});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return N(e)||e.length<1?w(t)?{spatialReference:t,viewingMode:null}:null:(w(t)&&e.length>1&&e.some(({spatialReference:i})=>i.equals(t))&&(e=e.filter(({spatialReference:i})=>i.equals(t))),e.length>1&&e.some(({viewingMode:i})=>i!==st.Local)&&(e=e.filter(({viewingMode:i})=>i!==st.Local)),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(t.length===0)return[];const i=[];for(const r of t){const s=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(w(s)){const n=w(s.constraints)?s.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:o,viewingMode:a}of n)(!this.requiresExtentInSpatialReference||N(this.userSpatialReference)||o.equals(this.userSpatialReference))&&i.push({spatialReference:o,viewingMode:a})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find(({extent:i})=>t.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const r of e)if(this._collectCollection(r,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?e.loadStatus==="not-loaded"?(e.load(),"loading"):e.loadStatus:"loaded"}};u([f()],Kr.prototype,"required",void 0),u([f({constructOnly:!0})],Kr.prototype,"map",void 0),u([f({constructOnly:!0})],Kr.prototype,"getSpatialReferenceSupport",void 0),u([f()],Kr.prototype,"defaultSpatialReference",void 0),u([f()],Kr.prototype,"userSpatialReference",void 0),u([f()],Kr.prototype,"sourcePreloadCount",void 0),u([f()],Kr.prototype,"priorityCollection",void 0),u([f()],Kr.prototype,"requiresExtentInSpatialReference",void 0),u([f()],Kr.prototype,"suspended",void 0),u([f({readOnly:!0})],Kr.prototype,"ready",null),u([f({readOnly:!0})],Kr.prototype,"heightModelInfoReady",null),u([f({readOnly:!0})],Kr.prototype,"spatialReference",null),u([f({readOnly:!0})],Kr.prototype,"extent",null),u([f({readOnly:!0})],Kr.prototype,"heightModelInfo",null),u([f({readOnly:!0})],Kr.prototype,"vcsWkid",null),u([f({readOnly:!0})],Kr.prototype,"latestVcsWkid",null),u([f({readOnly:!0})],Kr.prototype,"viewingMode",null),u([f({readOnly:!0})],Kr.prototype,"tileInfo",null),u([f({readOnly:!0})],Kr.prototype,"mapCollections",null),u([f({readOnly:!0})],Kr.prototype,"_allLayers",null),u([f({readOnly:!0})],Kr.prototype,"_spatialReferenceTask",null),u([f({readOnly:!0})],Kr.prototype,"_tileInfoTask",null),u([f({readOnly:!0})],Kr.prototype,"_heightModelInfoTask",null),u([f({readOnly:!0})],Kr.prototype,"_extentCandidatesTask",null),u([f()],Kr.prototype,"_extentTask",null),u([f()],Kr.prototype,"_projectExtentTask",void 0),Kr=u([B("esri.views.support.DefaultsFromMap")],Kr);var gF;const l$=Ie.getLogger("esri.views.View");let Xt=gF=class extends mT(ks.EventedMixin(Qk(ze))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new iC({getCollections:()=>{var t,i,r;return[(t=this.basemapView)==null?void 0:t.baseLayerViews,(i=this.groundView)==null?void 0:i.layerViews,this.layerViews,(r=this.basemapView)==null?void 0:r.referenceLayerViews]},getChildrenFunction:t=>t.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new NM,this.analyses=new XE,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new zt,this.magnifier=new Zve,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new B7e,this.navigation=new e1e,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new M7e(this),this.persistableViewModels=new zt,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(xe(()=>this.preconditionsReady,t=>{var i,r;t?(this._currentSpatialReference=this.spatialReference,gF.views.add(this)):(this._currentSpatialReference=null,gF.views.remove(this)),this.notifyChange("spatialReference"),!t&&this.ready?((i=this.layerViewManager)==null||i.clear(),(r=this.toolViewManager)==null||r.detach(),w(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):t&&!this.ready&&(this._startup(),w(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},Rr))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,xP(()=>this.ready)))),this.basemapView=new z_({view:this}),this.layerViewManager=new T7e({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new F7e({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([xe(()=>this.initialExtentRequired,e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e},{sync:!0,initial:!0}),xe(()=>this.ready,e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)},{sync:!0}),xe(()=>this._userSpatialReference,e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([xe(()=>{var t;return(t=this.defaultsFromMap)==null?void 0:t.ready},t=>{var r;const i=((r=this.map)==null?void 0:r.allLayers.length)>0;if(t&&!this.spatialReference&&i){if(w(e))return;const s=md(()=>e=fd(e));e=k3(async n=>{try{await AE(this.spatialReferenceWarningDelay,null,n)}catch{return}finally{e=null}l$.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(s,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=Tt(this.graphics),this.analyses=Tt(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),Tt(this.analysisViewManager),this.toolViewManager=Tt(this.toolViewManager),this.layerViewManager=Tt(this.layerViewManager),this.basemapView=Tt(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e==null||e.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return l$.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Kr({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var e;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||jy.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((e=this.defaultsFromMap)!=null&&e.ready)||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e!=null&&e.destroyed&&(l$.warn("#map","The provided map is already destroyed",{map:e}),e=null),jy.isLoadable(e)&&e.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){var t,i;let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&((i=(t=this.defaultsFromMap)==null?void 0:t.required)==null?void 0:i.heightModelInfo)&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!qc(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var e;return(e=this.defaultsFromMap)==null?void 0:e.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return w(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){var e;return(e=this.defaultsFromMap)==null?void 0:e.spatialReference}getDefaultHeightModelInfo(){var e,t,i;return(i=(t=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)!=null?t:(e=this.defaultsFromMap)==null?void 0:e.heightModelInfo)!=null?i:null}importLayerView(e){throw new se("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return w(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&l$.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(Jl(()=>this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Xt.views=new zt,u([f()],Xt.prototype,"_userSpatialReference",void 0),u([Lt("toolViewManager.activeTool")],Xt.prototype,"activeTool",void 0),u([f({readOnly:!0})],Xt.prototype,"allLayerViews",void 0),u([f()],Xt.prototype,"groundView",void 0),u([f()],Xt.prototype,"animation",void 0),u([f()],Xt.prototype,"basemapView",void 0),u([f({readOnly:!0})],Xt.prototype,"_defaultsFromMapSettings",null),u([f()],Xt.prototype,"defaultsFromMap",null),u([f()],Xt.prototype,"fatalError",void 0),u([f({type:zi})],Xt.prototype,"extent",void 0),u([f(Y7(NM,"graphics"))],Xt.prototype,"graphics",void 0),u([f(Y7(XE,"analyses"))],Xt.prototype,"analyses",void 0),u([f({readOnly:!0,type:jC})],Xt.prototype,"heightModelInfo",null),u([f({readOnly:!0})],Xt.prototype,"interacting",null),u([f({readOnly:!0})],Xt.prototype,"navigating",void 0),u([f({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Xt.prototype,"preconditionsReady",null),u([f({readOnly:!0})],Xt.prototype,"typeSpecificPreconditionsReady",void 0),u([f({type:zt,readOnly:!0})],Xt.prototype,"layerViews",void 0),u([f({type:Zve})],Xt.prototype,"magnifier",void 0),u([f({value:null,type:Wve})],Xt.prototype,"map",null),u([f()],Xt.prototype,"padding",void 0),u([f({readOnly:!0})],Xt.prototype,"ready",void 0),u([f({type:wt})],Xt.prototype,"spatialReference",null),u([f()],Xt.prototype,"spatialReferenceWarningDelay",void 0),u([f()],Xt.prototype,"stationary",null),u([f({readOnly:!0})],Xt.prototype,"supportsGround",void 0),u([f({type:jm})],Xt.prototype,"timeExtent",void 0),u([Lt("toolViewManager.tools")],Xt.prototype,"tools",void 0),u([f()],Xt.prototype,"toolViewManager",void 0),u([f({readOnly:!0})],Xt.prototype,"type",void 0),u([f({type:Number})],Xt.prototype,"scale",void 0),u([f({readOnly:!0})],Xt.prototype,"updating",void 0),u([f({readOnly:!0})],Xt.prototype,"initialExtentRequired",void 0),u([f({readOnly:!0})],Xt.prototype,"initialExtent",null),u([f()],Xt.prototype,"cursor",null),u([f({readOnly:!0})],Xt.prototype,"input",void 0),u([f({type:e1e,nonNullable:!0})],Xt.prototype,"navigation",void 0),u([f()],Xt.prototype,"layerViewManager",void 0),u([f()],Xt.prototype,"analysisViewManager",void 0),u([f()],Xt.prototype,"width",void 0),u([f()],Xt.prototype,"height",void 0),u([f({readOnly:!0})],Xt.prototype,"resizing",void 0),u([f({value:null,readOnly:!0})],Xt.prototype,"size",null),u([f({readOnly:!0})],Xt.prototype,"suspended",void 0),u([f({readOnly:!0})],Xt.prototype,"viewEvents",void 0),u([f({readOnly:!0})],Xt.prototype,"persistableViewModels",void 0),u([f()],Xt.prototype,"_isValid",void 0),u([f()],Xt.prototype,"_readyCycleForced",void 0),u([f()],Xt.prototype,"_currentSpatialReference",void 0),Xt=gF=u([B("esri.views.View")],Xt);const W7e=Xt;let V_=class extends P4{constructor(e){super(e),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((e,t)=>this._dfd={resolve:e,reject:t}))}get done(){return this.state==="finished"||this.state==="stopped"}stop(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),this._dfd.reject(new se("ViewAnimation stopped")))}finish(){this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),this._dfd.resolve())}update(e,t){t||(t=ah(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",t)}};u([f({readOnly:!0})],V_.prototype,"done",null),u([f({readOnly:!0,type:String})],V_.prototype,"state",void 0),u([f()],V_.prototype,"target",void 0),V_=u([B("esri.views.ViewAnimation")],V_),function(e){e.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(V_||(V_={}));const sC=V_,rO=()=>_e(()=>import("./TileLayerView3D.1d7e8327.js"),["TileLayerView3D.1d7e8327.js","LayerView3D.8dc7c2ab.js","TiledLayerView3D.621b0088.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js","clickToleranceUtils.501648d0.js","drapedUtils.ed0ea243.js"],import.meta.url),Pse=()=>_e(()=>import("./ElevationLayerView3D.b8e3b749.js"),["ElevationLayerView3D.b8e3b749.js","LayerView3D.8dc7c2ab.js","TiledLayerView3D.621b0088.js","LayerView.bc32b3eb.js"],import.meta.url),Ise={"base-dynamic":()=>_e(()=>import("./BaseDynamicLayerView3D.17c19bf4.js"),["BaseDynamicLayerView3D.17c19bf4.js","DynamicLayerView3D.1e5fbd37.js","LayerView3D.8dc7c2ab.js","projectExtentUtils.4c0871bc.js","ImageMaterial.c05046f5.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js"],import.meta.url),"base-elevation":Pse,"base-tile":rO,"bing-maps":rO,"building-scene":()=>_e(()=>import("./BuildingSceneLayerView3D.8c52c86f.js"),["BuildingSceneLayerView3D.8c52c86f.js","BuildingGroupSublayer.ad20b27b.js","BuildingComponentSublayer.ecd163b1.js","capabilities.64684acb.js","I3SIndexInfo.aa09632f.js","I3SLayerDefinitions.38b2ee60.js","WhereClause.d715e7d1.js","I3SMeshView3D.2ba98bfb.js","I3SAttributeOverrides.531a14c8.js","I3SNode.2febe09c.js","SceneModification.14253e3f.js","persistable.6d7b5a7d.js","multiOriginJSONSupportUtils.8128aa52.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","SceneLayerWorker.4ba37db1.js","attributeUtils.99d8ee08.js","I3SQueryFeatureStore.2a1df369.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","DefinitionExpressionSceneLayerView.aca73a26.js","popupUtils.097ff953.js","LayerView3D.8dc7c2ab.js","LayerView.bc32b3eb.js"],import.meta.url),csv:()=>_e(()=>import("./CSVLayerView3D.c5be4f46.js"),["CSVLayerView3D.c5be4f46.js","FeatureLayerViewBase3D.f94051fd.js","FeatureLikeLayerView3D.9be8195f.js","dehydratedFeatureComparison.47577290.js","Graphics3DFeatureProcessor.cae1d677.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","floorFilterUtils.69500d62.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","attributeUtils.99d8ee08.js","FeatureStore.b55521bf.js","projectExtentUtils.4c0871bc.js","LayerView3D.8dc7c2ab.js","EventedSet.21b8712b.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js"],import.meta.url),elevation:Pse,feature:()=>_e(()=>import("./FeatureLayerView3D.1d72b843.js"),["FeatureLayerView3D.1d72b843.js","FeatureLayerViewBase3D.f94051fd.js","FeatureLikeLayerView3D.9be8195f.js","dehydratedFeatureComparison.47577290.js","Graphics3DFeatureProcessor.cae1d677.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","floorFilterUtils.69500d62.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","attributeUtils.99d8ee08.js","FeatureStore.b55521bf.js","projectExtentUtils.4c0871bc.js","LayerView3D.8dc7c2ab.js","EventedSet.21b8712b.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js"],import.meta.url),geojson:()=>_e(()=>import("./GeoJSONLayerView3D.89e7b9a5.js"),["GeoJSONLayerView3D.89e7b9a5.js","FeatureLayerViewBase3D.f94051fd.js","FeatureLikeLayerView3D.9be8195f.js","dehydratedFeatureComparison.47577290.js","Graphics3DFeatureProcessor.cae1d677.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","floorFilterUtils.69500d62.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","attributeUtils.99d8ee08.js","FeatureStore.b55521bf.js","projectExtentUtils.4c0871bc.js","LayerView3D.8dc7c2ab.js","EventedSet.21b8712b.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js"],import.meta.url),graphics:()=>_e(()=>import("./GraphicsLayerView3D.78a4e977.js"),["GraphicsLayerView3D.78a4e977.js","LayerView3D.8dc7c2ab.js","GraphicsProcessor.ee9e344d.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","projectExtentUtils.4c0871bc.js","LayerView.bc32b3eb.js"],import.meta.url),group:()=>_e(()=>import("./GroupLayerView.bed4c4ce.js"),["GroupLayerView.bed4c4ce.js","LayerView.bc32b3eb.js"],import.meta.url),imagery:()=>_e(()=>import("./ImageryLayerView3D.49a92ee3.js"),["ImageryLayerView3D.49a92ee3.js","DynamicLayerView3D.1e5fbd37.js","LayerView3D.8dc7c2ab.js","projectExtentUtils.4c0871bc.js","ImageMaterial.c05046f5.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js","popupUtils.097ff953.js"],import.meta.url),"integrated-mesh":()=>_e(()=>import("./IntegratedMeshLayerView3D.343dddc9.js"),["IntegratedMeshLayerView3D.343dddc9.js","I3SMeshView3D.2ba98bfb.js","I3SAttributeOverrides.531a14c8.js","I3SNode.2febe09c.js","SceneModification.14253e3f.js","persistable.6d7b5a7d.js","multiOriginJSONSupportUtils.8128aa52.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","SceneLayerWorker.4ba37db1.js","attributeUtils.99d8ee08.js","LayerView3D.8dc7c2ab.js","LayerView.bc32b3eb.js"],import.meta.url),"line-of-sight":()=>_e(()=>import("./LineOfSightLayerView3D.03f60114.js"),["LineOfSightLayerView3D.03f60114.js","LayerView3D.8dc7c2ab.js","LayerView.bc32b3eb.js"],import.meta.url),"map-image":()=>_e(()=>import("./MapImageLayerView3D.34b7c7b6.js"),["MapImageLayerView3D.34b7c7b6.js","DynamicLayerView3D.1e5fbd37.js","LayerView3D.8dc7c2ab.js","projectExtentUtils.4c0871bc.js","ImageMaterial.c05046f5.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js","ExportImageParameters.7c5e117f.js","floorFilterUtils.69500d62.js","sublayerUtils.82b4cc5f.js","clickToleranceUtils.501648d0.js","popupUtils.097ff953.js","drapedUtils.ed0ea243.js"],import.meta.url),media:()=>_e(()=>import("./MediaLayerView3D.733ae113.js"),["MediaLayerView3D.733ae113.js","normalizeUtilsSync.0990a781.js","LayerView3D.8dc7c2ab.js","ImageMaterial.c05046f5.js","LayerView.bc32b3eb.js"],import.meta.url),"ogc-feature":()=>_e(()=>import("./OGCFeatureLayerView3D.75dcb13e.js"),["OGCFeatureLayerView3D.75dcb13e.js","FeatureLayerViewBase3D.f94051fd.js","FeatureLikeLayerView3D.9be8195f.js","dehydratedFeatureComparison.47577290.js","Graphics3DFeatureProcessor.cae1d677.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","floorFilterUtils.69500d62.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","attributeUtils.99d8ee08.js","FeatureStore.b55521bf.js","projectExtentUtils.4c0871bc.js","LayerView3D.8dc7c2ab.js","EventedSet.21b8712b.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js"],import.meta.url),"open-street-map":rO,"point-cloud":()=>_e(()=>import("./PointCloudLayerView3D.b6afc679.js").then(e=>e.P),["PointCloudLayerView3D.b6afc679.js","LayerView3D.8dc7c2ab.js","PointCloudWorkerUtil.5788bd32.js","PointCloudUniqueValueRenderer.47b43249.js","PopupSceneLayerView.93522a98.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js"],import.meta.url),voxel:()=>_e(()=>import("./VoxelLayerView3D.a0d85b9b.js"),["VoxelLayerView3D.a0d85b9b.js","LayerView3D.8dc7c2ab.js","LayerView.bc32b3eb.js"],import.meta.url),route:()=>_e(()=>import("./RouteLayerView3D.2b812ba7.js"),["RouteLayerView3D.2b812ba7.js","Stop.e8676f22.js","LayerView3D.8dc7c2ab.js","GraphicsProcessor.ee9e344d.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","projectExtentUtils.4c0871bc.js","EventedSet.21b8712b.js","LayerView.bc32b3eb.js"],import.meta.url),scene:e=>e.profile==null||e.profile==="mesh-pyramids"?_e(()=>import("./SceneLayerView3D.f9dd8ae0.js"),["SceneLayerView3D.f9dd8ae0.js","WhereClause.d715e7d1.js","floorFilterUtils.69500d62.js","I3SMeshView3D.2ba98bfb.js","I3SAttributeOverrides.531a14c8.js","I3SNode.2febe09c.js","SceneModification.14253e3f.js","persistable.6d7b5a7d.js","multiOriginJSONSupportUtils.8128aa52.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","SceneLayerWorker.4ba37db1.js","attributeUtils.99d8ee08.js","LayerView3D.8dc7c2ab.js","SceneLayerView.051342eb.js","LayerView.bc32b3eb.js","I3SQueryFeatureStore.2a1df369.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","DefinitionExpressionSceneLayerView.aca73a26.js","PopupSceneLayerView.93522a98.js","popupUtils.097ff953.js"],import.meta.url):_e(()=>import("./SceneLayerGraphicsView3D.c2697cc3.js"),["SceneLayerGraphicsView3D.c2697cc3.js","I3SAttributeOverrides.531a14c8.js","I3SNode.2febe09c.js","LayerView3D.8dc7c2ab.js","Graphics3DFeatureProcessor.cae1d677.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","floorFilterUtils.69500d62.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","attributeUtils.99d8ee08.js","SceneLayerView.051342eb.js","LayerView.bc32b3eb.js","DefinitionExpressionSceneLayerView.aca73a26.js","PopupSceneLayerView.93522a98.js","popupUtils.097ff953.js"],import.meta.url),stream:()=>_e(()=>import("./StreamLayerView3D.02a29dc7.js"),["StreamLayerView3D.02a29dc7.js","createConnection.6406b37d.js","EventedSet.21b8712b.js","FeatureLikeLayerView3D.9be8195f.js","dehydratedFeatureComparison.47577290.js","Graphics3DFeatureProcessor.cae1d677.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","floorFilterUtils.69500d62.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","attributeUtils.99d8ee08.js","FeatureStore.b55521bf.js","projectExtentUtils.4c0871bc.js","LayerView3D.8dc7c2ab.js","LayerView.bc32b3eb.js"],import.meta.url),tile:rO,"imagery-tile":()=>_e(()=>import("./ImageryTileLayerView3D.b57068e5.js"),["ImageryTileLayerView3D.b57068e5.js","LayerView3D.8dc7c2ab.js","TiledLayerView3D.621b0088.js","rasterProjectionHelper.86160a91.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js","drapedUtils.ed0ea243.js"],import.meta.url),"vector-tile":()=>_e(()=>import("./VectorTileLayerView3D.f7aeaa19.js"),["VectorTileLayerView3D.f7aeaa19.js","GeometryUtils.316cebf1.js","CIMSymbolHelper.f189aa12.js","BidiEngine.4cfb7343.js","enums.ba1e21c6.js","number.08b65821.js","StyleRepository.1e4d25cc.js","colorUtils.e5585cd0.js","Geometry.b68345ae.js","PixelBlock.93a15a4d.js","Utils.53ef10e9.js","MaterialKey.7ac72932.js","LayerView3D.8dc7c2ab.js","TiledLayerView3D.621b0088.js","LayerView.bc32b3eb.js"],import.meta.url),wcs:()=>_e(()=>import("./ImageryTileLayerView3D.b57068e5.js"),["ImageryTileLayerView3D.b57068e5.js","LayerView3D.8dc7c2ab.js","TiledLayerView3D.621b0088.js","rasterProjectionHelper.86160a91.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js","drapedUtils.ed0ea243.js"],import.meta.url),"web-tile":rO,wfs:()=>_e(()=>import("./WFSLayerView3D.3f979b15.js"),["WFSLayerView3D.3f979b15.js","FeatureLayerViewBase3D.f94051fd.js","FeatureLikeLayerView3D.9be8195f.js","dehydratedFeatureComparison.47577290.js","Graphics3DFeatureProcessor.cae1d677.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js","floorFilterUtils.69500d62.js","QueryEngine.dd064fa9.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","QueryEngineCapabilities.c2e9875c.js","attributeUtils.99d8ee08.js","FeatureStore.b55521bf.js","projectExtentUtils.4c0871bc.js","LayerView3D.8dc7c2ab.js","EventedSet.21b8712b.js","popupUtils.097ff953.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js"],import.meta.url),wms:()=>_e(()=>import("./WMSLayerView3D.080cea9b.js"),["WMSLayerView3D.080cea9b.js","DynamicLayerView3D.1e5fbd37.js","LayerView3D.8dc7c2ab.js","projectExtentUtils.4c0871bc.js","ImageMaterial.c05046f5.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js","ExportWMSImageParameters.de2deadb.js"],import.meta.url),wmts:()=>_e(()=>import("./WMTSLayerView3D.43dd8466.js"),["WMTSLayerView3D.43dd8466.js","LayerView3D.8dc7c2ab.js","TiledLayerView3D.621b0088.js","LayerView.bc32b3eb.js","RefreshableLayerView.06f790ae.js"],import.meta.url),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};function Z7e(e){const t=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",i=t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new se(`${i}:view-not-supported`,`${t} is not supported in 3D`)}const Lse={hasLayerViewModule:e=>w(Ise[e.type]),importLayerView:e=>{const t=Ise[e.type];if(N(t))throw Z7e(e);return t(e)}},X7e=Ie.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),$se="analyses-owner-handles";var B2,Rw;(function(e){e[e.PENDING=0]="PENDING",e[e.CREATED=1]="CREATED"})(B2||(B2={})),function(e){e[e.ADDED=0]="ADDED",e[e.REMOVED=1]="REMOVED"}(Rw||(Rw={}));let iw=class extends BE{constructor(e){super(e),this._allAnalysisViews=new zt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=Gp(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject($i("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject($i()),this._attachedToViewResolver=Gp(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const t=this._items.get(e);if(N(t)||t.state.list===Rw.REMOVED)throw new se("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return t.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),$se)}_disconnectOwners(){this.handles.remove($se),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const r of e)this._addAnalysis(r);const t=e.on("after-add",r=>this._addAnalysis(r.item)),i=e.on("after-remove",r=>this._removeAnalysis(r.item));return{remove:()=>{t.remove(),i.remove();for(const r of e)this._removeAnalysis(r)}}}_addAnalysis(e){const t=this._items.get(e);if(t==null){const i={state:{view:B2.PENDING,list:Rw.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=k3(r=>this._createAnalysisViewPromise(i,r))}else t.state.list=Rw.ADDED}_removeAnalysis(e){const t=this._items.get(e);t!=null?(t.state.list=Rw.REMOVED,this._scheduleUpdate()):X7e.error("Trying to remove analysis which was not added")}_scheduleUpdate(){w(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=DC(()=>this._update()))}_update(){this._scheduledUpdateHandle=Ln(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===Rw.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case B2.PENDING:e.createAnalysisViewTask=fd(e.createAnalysisViewTask);break;case B2.CREATED:w(e.view)&&(this._allAnalysisViews.remove(e.view),e.view=Tt(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,t){const i=e.analysis,r=i.type,s=this._analysisModules[r];if(this._creatingViewCount+=1,N(s.module))try{s.module=await this._loadAnalysisModule(r)}catch(o){throw this._creatingViewCount-=1,o}if(An(t))throw this._creatingViewCount-=1,$i("AnalysisView creation aborted");const n=new s.module.default({analysis:i,view:this.view});try{await n.when()}catch(o){throw this._creatingViewCount-=1,o}if(An(t))throw this._creatingViewCount-=1,n.destroy(),$i("AnalysisView creation aborted");return e.view=n,e.state.view=B2.CREATED,this._allAnalysisViews.add(n),this._creatingViewCount-=1,n}_loadAnalysisModule(e){switch(e){case"area-measurement":return _e(()=>import("./AreaMeasurementAnalysisView3D.cb3b96cd.js").then(t=>t.A),["AreaMeasurementAnalysisView3D.cb3b96cd.js","quantityFormatUtils.119b552b.js","Segment.00e10e0b.js","LineVisualElement.c8ac394d.js","elevationInfoUtils.fe889101.js","geometryEngine.d0411681.js","geometryEngineBase.cf4f989f.js","hydrated.2565c3a9.js","projectionUtils.eb41893b.js","EditGeometryOperations.17db3234.js"],import.meta.url);case"dimensioning":return _e(()=>import("./DimensioningAnalysisView3D.87b57003.js").then(t=>t.D),["DimensioningAnalysisView3D.87b57003.js","LineVisualElement.c8ac394d.js","analysisViewUtils.1368068e.js","PointVisualElement.1a1f0dbc.js","RightAngleQuadVisualElement.93093297.js","Segment.00e10e0b.js","elevationInfoUtils.fe889101.js","dragEventPipeline3D.dd7775a3.js","EditGeometryOperations.17db3234.js","QueryEngineResult.3d7a8c8d.js","WhereClause.d715e7d1.js","utils.bf6b5607.js","ClassBreaksDefinition.d9c6c51f.js","json.d1a0fa35.js","dehydratedFeatureComparison.47577290.js"],import.meta.url);case"direct-line-measurement":return _e(()=>import("./DirectLineMeasurementAnalysisView3D.85827b91.js").then(t=>t.D),["DirectLineMeasurementAnalysisView3D.85827b91.js","quantityFormatUtils.119b552b.js","Segment.00e10e0b.js","LineVisualElement.c8ac394d.js","elevationInfoUtils.fe889101.js","geometryEngine.d0411681.js","geometryEngineBase.cf4f989f.js","hydrated.2565c3a9.js","projectionUtils.eb41893b.js","RightAngleQuadVisualElement.93093297.js"],import.meta.url);case"line-of-sight":return _e(()=>import("./LineOfSightAnalysisView3D.1d0d9828.js"),["LineOfSightAnalysisView3D.1d0d9828.js","LineVisualElement.c8ac394d.js","LineOfSightAnalysisTarget.091ad9e1.js","persistable.6d7b5a7d.js","multiOriginJSONSupportUtils.8128aa52.js","elevationInfoUtils.fe889101.js","projectionUtils.eb41893b.js","analysisViewUtils.1368068e.js","PointVisualElement.1a1f0dbc.js"],import.meta.url);case"slice":return _e(()=>import("./SliceAnalysisView3D.dac2feb7.js").then(t=>t.S),["SliceAnalysisView3D.dac2feb7.js","LineVisualElement.c8ac394d.js","persistable.6d7b5a7d.js","multiOriginJSONSupportUtils.8128aa52.js","BuildingComponentSublayer.ecd163b1.js","capabilities.64684acb.js","I3SIndexInfo.aa09632f.js","I3SLayerDefinitions.38b2ee60.js","projectionUtils.eb41893b.js","analysisViewUtils.1368068e.js","ImageMaterial.c05046f5.js","dragEventPipeline3D.dd7775a3.js"],import.meta.url)}}};u([f()],iw.prototype,"updating",null),u([f({constructOnly:!0})],iw.prototype,"view",void 0),u([f()],iw.prototype,"_allAnalysisViews",void 0),u([f()],iw.prototype,"_creatingViewCount",void 0),iw=u([B("esri.views.3d.analysis.AnalysisViewManager3D")],iw);const Y7e=iw,Q7e=Ie.getLogger("esri.views.3d.state.Constraints");let Zg=class extends ze{constructor(e){super(e),this.collision=new VR,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===st.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==st.Local?this._set("altitude",e):Q7e.warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Xe(e,this.altitude.min,this.altitude.max):e}clampTilt(e,t){if(!this.tilt)return t;const i=this.tilt(e);return Xe(t,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===st.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(t,i=O6)=>(i.min=ta.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?DN([[4e3,ta.max],[1e4,Jt(88)],[6e6,Jt(88)]]):()=>ta.max;return(t,i=O6)=>(i.min=ta.min,i.max=e(t),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?DN([[4e3,ta.max],[5e4,Jt(88)],[6e6,Jt(88)],[2e7,ta.min]]):DN([[3e5,ta.max],[3e6,Jt(88)],[6e6,Jt(88)],[2e7,ta.min]]);return(t,i=O6)=>(i.min=ta.min,i.max=e(t),i)}};function J7e(e){return{min:-2e5,max:4*e.radius}}u([f()],Zg.prototype,"altitude",null),u([f({readOnly:!0})],Zg.prototype,"collision",void 0),u([f()],Zg.prototype,"distance",void 0),u([f({readOnly:!0})],Zg.prototype,"minimumPoiDistance",void 0),u([f()],Zg.prototype,"tilt",void 0),u([f({constructOnly:!0})],Zg.prototype,"mode",void 0),Zg=u([B("esri.views.3d.state.Constraints")],Zg);const Dse=J7e(Qi),ta={min:Jt(.5),max:Jt(179.5)},O6={min:0,max:0};let VR=class extends ze{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};u([f({type:Boolean})],VR.prototype,"enabled",void 0),u([f({type:Number})],VR.prototype,"elevationMargin",void 0),VR=u([B("esri.views.3d.state.Constraints.CollisionConstraint")],VR);let V2=class extends ze{constructor(){super(...arguments),this.min=Dse.min,this.max=Dse.max}};u([f({type:Number})],V2.prototype,"min",void 0),u([f({type:Number})],V2.prototype,"max",void 0),V2=u([B("esri.views.3d.constraints.AltitudeConstraint")],V2);let ly=class extends ze{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,t){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==t&&this._set("far",t))}};u([f({type:Number,value:1e-8})],ly.prototype,"near",null),u([pi("near")],ly.prototype,"castNear",null),u([f({type:Number,value:1e-8})],ly.prototype,"far",null),u([pi("far")],ly.prototype,"castFar",null),u([f({type:["auto","manual"]})],ly.prototype,"mode",void 0),ly=u([B("esri.views.3d.constraints.ClipDistanceConstraint")],ly);const wq={min:Vc(ta.min),max:Vc(ta.max)};let Mw=class extends ze{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Xe(e,wq.min,wq.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};u([f({type:["auto","manual"]})],Mw.prototype,"mode",void 0),u([f({type:Number,value:wq.max})],Mw.prototype,"max",null),u([pi("max")],Mw.prototype,"castMax",null),Mw=u([B("esri.views.3d.constraints.TiltConstraint")],Mw);let Pw=class extends ze{constructor(){super(...arguments),this.tilt=new Mw,this.altitude=new V2,this.clipDistance=new ly}};u([f({type:Mw})],Pw.prototype,"tilt",void 0),u([f({type:V2})],Pw.prototype,"altitude",void 0),u([f({type:ly})],Pw.prototype,"clipDistance",void 0),Pw=u([B("esri.views.3d.constraints.Constraints")],Pw);var xq;let Uh=xq=class extends Fe{constructor(e){super(e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return t.datetime!=null&&new Date(t.datetime)||null}writeDate(e,t,i){t[i]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,i){e&&(t[i]=e)}writeDisplayUTCOffset(e,t){e!=null&&(t.displayUTCOffset=e)}clone(){return new xq(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(e.date=new Date(this.date.getTime())),e}};u([f({readOnly:!0,type:["sun"],json:{write:!0}})],Uh.prototype,"type",void 0),u([f({type:Date,json:{type:Number,write:{target:"datetime"}}})],Uh.prototype,"date",void 0),u([it("date",["datetime"])],Uh.prototype,"readDate",null),u([ut("date")],Uh.prototype,"writeDate",null),u([f({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Uh.prototype,"directShadowsEnabled",void 0),u([it("directShadowsEnabled",["directShadows"])],Uh.prototype,"readDirectShadowsEnabled",null),u([ut("directShadowsEnabled")],Uh.prototype,"writedirectShadowsEnabled",null),u([f({type:Number,json:{write:!0}})],Uh.prototype,"displayUTCOffset",void 0),u([ut("displayUTCOffset")],Uh.prototype,"writeDisplayUTCOffset",null),Uh=xq=u([B("esri.webscene.SunLighting")],Uh);const kP=Uh;var f2;let Gf=f2=class extends ks.EventedMixin(kP){constructor(e){super(e),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const t=new Date().getFullYear(),i=new Date("March 15, "+t+" 12:00:00 UTC");this._set("defaultDate",i),this._set("date",i)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(e){return new f2(e.cloneConstructProperties())}set defaultDate(e){const t=this._get("date")===this._get("defaultDate");e=new Date(e.getTime()),this._set("defaultDate",e),t&&this._set("date",e)}set date(e){e!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(e.getTime())))}autoUpdate(e,t){const i=f2.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours,this.positionTimezoneInfo.minutes=t.minutes,this.positionTimezoneInfo.seconds=t.seconds;let r=null;e!=null&&(this.positionTimezoneInfo.autoUpdated=!0,r=this.date&&this.date.getTime(),this._set("date",new Date(e.getTime())));const s=f2.calculateTimezoneOffset(this.positionTimezoneInfo);if(i!==s&&(R6.target=this,R6.timezoneOffset=s,this.emit("timezone-will-change",R6)),e!=null)return r!==e.getTime()}clone(){const e=this._get("date")===this._get("defaultDate"),t=new f2({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});return e&&t._set("date",t._get("defaultDate")),t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,t}cloneWithWebsceneLighting(e){const t=this.clone();return e.date!=null&&(t.date=e.date),t.directShadowsEnabled=e.directShadowsEnabled,t.displayUTCOffset=e.displayUTCOffset,t}};u([f({type:Boolean})],Gf.prototype,"cameraTrackingEnabled",void 0),u([f({type:Boolean})],Gf.prototype,"ambientOcclusionEnabled",void 0),u([f({type:Boolean})],Gf.prototype,"waterReflectionEnabled",void 0),u([f({type:Date})],Gf.prototype,"defaultDate",null),u([f({type:Date})],Gf.prototype,"date",null),Gf=f2=u([B("esri.views.3d.environment.SunLighting")],Gf),function(e){function t({hours:i,minutes:r,seconds:s}){return Math.round(i+r/60+s/3600)}e.calculateTimezoneOffset=t}(Gf||(Gf={}));const R6={target:null,timezoneOffset:0},G_=Gf;var Tq;let GR=Tq=class extends Fe{constructor(e){super(e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Tq(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};u([f({readOnly:!0,type:["virtual"],json:{write:!0}})],GR.prototype,"type",void 0),u([f({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],GR.prototype,"directShadowsEnabled",void 0),GR=Tq=u([B("esri.webscene.VirtualLighting")],GR);const jU=GR;var yF;let jR=yF=class extends ks.EventedMixin(jU){constructor(e){super(e),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new yF({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})}static fromWebsceneLighting(e){return new yF(e.cloneConstructProperties())}cloneWithWebsceneLighting(e){const t=this.clone();return t.directShadowsEnabled=e.directShadowsEnabled,t}};u([f({type:Boolean})],jR.prototype,"ambientOcclusionEnabled",void 0),u([f({type:Boolean})],jR.prototype,"waterReflectionEnabled",void 0),jR=yF=u([B("esri.views.3d.environment.VirtualLighting")],jR);const HR=jR,K7e={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:G_,virtual:HR}};var Sq;let FM=Sq=class extends ze{set quality(e){["low","high"].includes(e)&&this._set("quality",e)}clone(){return new Sq({quality:this.quality})}};u([f({type:["low","high"],value:"low"})],FM.prototype,"quality",null),FM=Sq=u([B("esri.views.3d.environment.SceneViewAtmosphere")],FM);var Eq;let qR=Eq=class extends Fe{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new Eq({cloudCover:this.cloudCover})}};u([Rt({sunny:"sunny"})],qR.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],qR.prototype,"cloudCover",void 0),qR=Eq=u([B("esri.views.3d.environment.SunnyWeather")],qR);const Cq=qR;var Aq;let WR=Aq=class extends Fe{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new Aq({cloudCover:this.cloudCover})}};u([Rt({cloudy:"cloudy"})],WR.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],WR.prototype,"cloudCover",void 0),WR=Aq=u([B("esri.views.3d.environment.CloudyWeather")],WR);const eje=WR;var Oq;let ZR=Oq=class extends Fe{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new Oq({fogStrength:this.fogStrength})}};u([Rt({foggy:"foggy"})],ZR.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],ZR.prototype,"fogStrength",void 0),ZR=Oq=u([B("esri.views.3d.environment.FoggyWeather")],ZR);const tje=ZR;var Rq;let m2=Rq=class extends Fe{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Rq({cloudCover:this.cloudCover,precipitation:this.precipitation})}};u([Rt({rainy:"rainy"})],m2.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m2.prototype,"cloudCover",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m2.prototype,"precipitation",void 0),m2=Rq=u([B("esri.views.3d.environment.RainyWeather")],m2);const ije=m2;var Mq;let rw=Mq=class extends Fe{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Mq({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};u([Rt({snowy:"snowy"})],rw.prototype,"type",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rw.prototype,"cloudCover",void 0),u([f({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],rw.prototype,"precipitation",void 0),u([f({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],rw.prototype,"snowCover",void 0),rw=Mq=u([B("esri.views.3d.environment.SnowyWeather")],rw);const rje=rw,a1e={key:"type",base:Cq,typeMap:{sunny:Cq,cloudy:eje,rainy:ije,snowy:rje,foggy:tje}},sje=Object.keys(a1e.typeMap);function nje(e,t){return!!sje.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)}const Yh=1e4,oje={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:kP,virtual:jU}};let _F=class extends Fe{constructor(e){super(e)}clone(){}};u([f({readOnly:!0,json:{read:!1}})],_F.prototype,"type",void 0),_F=u([B("esri.webscene.background.Background")],_F);const l1e=_F;var Pq;const aje={...i0,nonNullable:!0};let XR=Pq=class extends l1e{constructor(e){super(e),this.type="color",this.color=new at([0,0,0,1])}clone(){return new Pq(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};u([Rt({color:"color"},{readOnly:!0})],XR.prototype,"type",void 0),u([f(aje)],XR.prototype,"color",void 0),XR=Pq=u([B("esri.webscene.background.ColorBackground")],XR);const c1e=XR,Nse={base:l1e,key:"type",typeMap:{color:c1e}};function lje(e){return(t,i,r)=>{if(!t)return t;for(const s in e.typeMap)if(t.type===s){const n=new e.typeMap[s];return n.read(t,r),n}}}const cje={types:Nse,json:{read:lje(Nse),write:{overridePolicy:(e,t,i)=>({enabled:!i||!i.isPresentation})}}};var Iq;const uje=Ie.getLogger("esri.webscene.Environment"),Fse=(e,t,i)=>({enabled:!i||!i.isPresentation});let j_=Iq=class extends Fe{constructor(e){super(e),this.lighting=new kP,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){nje(e==null?void 0:e.type,uje)&&this._set("weather",e)}clone(){return new Iq(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?jU.prototype.clone.call(this.lighting):kP.prototype.clone.call(this.lighting),background:me(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};u([f({types:oje,nonNullable:!0,json:{write:!0}})],j_.prototype,"lighting",void 0),u([f(cje)],j_.prototype,"background",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Fse}}})],j_.prototype,"atmosphereEnabled",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:Fse}}})],j_.prototype,"starsEnabled",void 0),u([f({types:a1e,nonNullable:!0,json:{write:!0},value:new Cq})],j_.prototype,"weather",null),j_=Iq=u([B("esri.webscene.Environment")],j_);const u1e=j_;var YR;let g2=YR=class extends u1e{constructor(e){super(e),this.atmosphere=new FM,this.lighting=new G_}static fromWebsceneEnvironment(e){const t=e.cloneConstructProperties();return new YR({...t,lighting:t.lighting.type==="virtual"?HR.fromWebsceneLighting(t.lighting):G_.fromWebsceneLighting(t.lighting)})}castLighting(e){return this._convertLighting(e)}applyLighting(e){this.lighting=this._convertLighting(e)}_convertLighting(e){return e?e instanceof G_||e instanceof HR?e:e instanceof kP?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e):new G_(e.cloneConstructProperties()):e instanceof jU?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e):new HR(e.cloneConstructProperties()):jp(K7e,e):new G_}clone(){return new YR({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:me(this.background)})}cloneWithWebsceneEnvironment(e){return new YR({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:me(this.background),...e.cloneConstructProperties(),lighting:this._getLighting(e)})}_getLighting(e){return e.lighting.type==="sun"?this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(e.lighting):G_.fromWebsceneLighting(e.lighting):e.lighting.type==="virtual"?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(e.lighting):HR.fromWebsceneLighting(e.lighting):G_.fromWebsceneLighting(e.lighting)}};u([f({type:FM,json:{read:!1},nonNullable:!0})],g2.prototype,"atmosphere",void 0),u([f({nonNullable:!0})],g2.prototype,"lighting",void 0),u([pi("lighting")],g2.prototype,"castLighting",null),g2=YR=u([B("esri.views.3d.environment.SceneViewEnvironment")],g2);const y2=g2;function zo(e,t){return e[0]=t[0],e[1]=t[1],e}function Di(e,t,i){return e[0]=t,e[1]=i,e}function yp(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function um(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function h1e(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function d1e(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function hje(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function dje(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function pje(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function fje(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function mje(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function Ic(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function gje(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function oQ(e,t){const i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function v5(e,t){const i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function aQ(e){const t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function p1e(e){const t=e[0],i=e[1];return t*t+i*i}function lQ(e,t){return e[0]=-t[0],e[1]=-t[1],e}function yje(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function UP(e,t){const i=t[0],r=t[1];let s=i*i+r*r;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s),e}function xn(e,t){return e[0]*t[0]+e[1]*t[1]}function _je(e,t,i){const r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function _2(e,t,i,r){const s=t[0],n=t[1];return e[0]=s+r*(i[0]-s),e[1]=n+r*(i[1]-n),e}function vje(e,t){t=t||1;const i=2*Cp()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function Lq(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s,e[1]=i[1]*r+i[3]*s,e}function sw(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[2]*s+i[4],e[1]=i[1]*r+i[3]*s+i[5],e}function bje(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[3]*s+i[6],e[1]=i[1]*r+i[4]*s+i[7],e}function wje(e,t,i){const r=t[0],s=t[1];return e[0]=i[0]*r+i[4]*s+i[12],e[1]=i[1]*r+i[5]*s+i[13],e}function xje(e,t,i,r){const s=t[0]-i[0],n=t[1]-i[1],o=Math.sin(r),a=Math.cos(r);return e[0]=s*a-n*o+i[0],e[1]=s*o+n*a+i[1],e}function Tje(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];let o=i*i+r*r;o>0&&(o=1/Math.sqrt(o));let a=s*s+n*n;a>0&&(a=1/Math.sqrt(a));const l=(i*s+r*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function Sje(e){return"vec2("+e[0]+", "+e[1]+")"}function f1e(e,t){return e[0]===t[0]&&e[1]===t[1]}function Eje(e,t){const i=e[0],r=e[1],s=t[0],n=t[1];return Math.abs(i-s)<=Gt*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-n)<=Gt*Math.max(1,Math.abs(r),Math.abs(n))}function Cje(e,t,i,r,s){let n=t[0]-i[0],o=t[1]-i[1];const a=(r[0]*n+r[1]*o)*(s-1);return n=r[0]*a,o=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const Aje=aQ,Oje=um,Rje=h1e,Mje=d1e,m1e=oQ,Pje=v5,Ije=p1e;Object.freeze(Object.defineProperty({__proto__:null,copy:zo,set:Di,add:yp,subtract:um,multiply:h1e,divide:d1e,ceil:hje,floor:dje,min:pje,max:fje,round:mje,scale:Ic,scaleAndAdd:gje,distance:oQ,squaredDistance:v5,length:aQ,squaredLength:p1e,negate:lQ,inverse:yje,normalize:UP,dot:xn,cross:_je,lerp:_2,random:vje,transformMat2:Lq,transformMat2d:sw,transformMat3:bje,transformMat4:wje,rotate:xje,angle:Tje,str:Sje,exactEquals:f1e,equals:Eje,projectAndScale:Cje,len:Aje,sub:Oje,mul:Rje,div:Mje,dist:m1e,sqrDist:Pje,sqrLen:Ije},Symbol.toStringTag,{value:"Module"}));function g1e(e){return Math.min(1,Math.max(0,(e-1e5)/(1e6-1e5)))}const $q=1e4,qT=Ke(5802e-9,13558e-9,331e-7),M6=3,P6=Ke(65e-8*M6,1881e-9*M6,85e-9*M6),Lje=3996e-9,$je=.085,vF=1e5;class mn{}function E(e,...t){let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i}(function(e){function t(r){return Math.round(r).toString()}function i(r){return r.toPrecision(8)}e.int=t,e.float=i})(E||(E={}));var D;(function(e){e.POSITION="position",e.NORMAL="normal",e.UV0="uv0",e.AUXPOS1="auxpos1",e.AUXPOS2="auxpos2",e.MAPPOS="mapPos",e.COLOR="color",e.SYMBOLCOLOR="symbolColor",e.SIZE="size",e.TANGENT="tangent",e.OFFSET="offset",e.SUBDIVISIONFACTOR="subdivisionFactor",e.COLORFEATUREATTRIBUTE="colorFeatureAttribute",e.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",e.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",e.DISTANCETOSTART="distanceToStart",e.UVMAPSPACE="uvMapSpace",e.BOUNDINGRECT="boundingRect",e.UVREGION="uvRegion",e.NORMALCOMPRESSED="normalCompressed",e.PROFILERIGHT="profileRight",e.PROFILEUP="profileUp",e.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",e.FEATUREVALUE="featureValue",e.MODELORIGINHI="modelOriginHi",e.MODELORIGINLO="modelOriginLo",e.MODEL="model",e.MODELNORMAL="modelNormal",e.INSTANCECOLOR="instanceColor",e.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",e.LOCALTRANSFORM="localTransform",e.GLOBALTRANSFORM="globalTransform",e.BOUNDINGSPHERE="boundingSphere",e.MODELORIGIN="modelOrigin",e.MODELSCALEFACTORS="modelScaleFactors",e.FEATUREATTRIBUTE="featureAttribute",e.STATE="state",e.LODLEVEL="lodLevel",e.POSITION0="position0",e.POSITION1="position1",e.NORMALA="normalA",e.NORMALB="normalB",e.COMPONENTINDEX="componentIndex",e.VARIANTOFFSET="variantOffset",e.VARIANTSTROKE="variantStroke",e.VARIANTEXTENSION="variantExtension",e.U8PADDING="u8padding",e.U16PADDING="u16padding",e.SIDENESS="sideness",e.START="start",e.END="end",e.UP="up",e.EXTRUDE="extrude"})(D||(D={}));var Pn;function My(e,t){switch(t.textureCoordinateType){case Pn.Default:return e.attributes.add(D.UV0,"vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Pn.Atlas:return e.attributes.add(D.UV0,"vec2"),e.varyings.add("vuv0","vec2"),e.attributes.add(D.UVREGION,"vec4"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(E`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case Pn.None:return void e.vertex.code.add(E`void forwardTextureCoordinates() {}`);default:t.textureCoordinateType;case Pn.COUNT:return}}(function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.Atlas=2]="Atlas",e[e.COUNT=3]="COUNT"})(Pn||(Pn={}));function Xc(e){e.code.add(E`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function nh(e){e.include(Xc),e.code.add(E`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}function HU(e){e.fragment.code.add(E`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var nr;(function(e){e[e.Pass=0]="Pass",e[e.Draw=1]="Draw"})(nr||(nr={}));class vs{constructor(t,i,r,s,n=null){this.name=t,this.type=i,this.arraySize=n,this.bind={[nr.Pass]:null,[nr.Draw]:null},w(r)&&w(s)&&(this.bind[r]=s)}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}class Ni extends vs{constructor(t,i){super(t,"vec2",nr.Pass,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class Py extends vs{constructor(t){super(t,"vec2")}}class Ut extends vs{constructor(t,i){super(t,"vec3",nr.Pass,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class Vl extends vs{constructor(t){super(t,"vec3")}}class nl extends vs{constructor(t){super(t,"vec4")}}class rr extends vs{constructor(t){super(t,"float")}}class Hr extends vs{constructor(t,i){super(t,"mat4",nr.Pass,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}const Dje=Ie.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class y1e{constructor(){this.includedModules=new Map}include(t,i){if(this.includedModules.has(t)){const r=this.includedModules.get(t);if(r!==i){Dje.error("Trying to include shader module multiple times with different sets of options.");const s=new Set;for(const n of Object.keys(r))r[n]!==t[n]&&s.add(n);for(const n of Object.keys(t))r[n]!==t[n]&&s.add(n);s.forEach(n=>console.error(`  ${n}: current ${r[n]} new ${t[n]}`))}}else this.includedModules.set(t,i),t(this.builder,i)}}class dr extends y1e{constructor(){super(...arguments),this.vertex=new kse,this.fragment=new kse,this.attributes=new kje,this.varyings=new Uje,this.extensions=new nC,this.constants=new Vs}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t){const i=this.extensions.generateSource(t),r=this.attributes.generateSource(t),s=this.varyings.generateSource(),n=t==="vertex"?this.vertex:this.fragment,o=n.uniforms.generateSource(),a=n.code.generateSource(),l=t==="vertex"?Bje:zje,c=this.constants.generateSource().concat(n.constants.generateSource());return`
${i.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${r.join(`
`)}

${s.join(`
`)}

${a.join(`
`)}`}generateBind(t,i){const r=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[t];w(a)&&r.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[t];w(a)&&r.set(o.name,a)});const s=Array.from(r.values()),n=s.length;return(o,a)=>{for(let l=0;l<n;++l)s[l](i,o,a)}}}class Nje{constructor(){this._entries=new Map}add(t){if(!Array.isArray(t))return this._add(t);for(const i of t)this._add(i)}_add(t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new se(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}generateSource(){return Array.from(this._entries.values()).map(t=>w(t.arraySize)?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`)}get entries(){return Array.from(this._entries.values())}}class Fje{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class kse extends y1e{constructor(){super(...arguments),this.uniforms=new Nje,this.code=new Fje,this.constants=new Vs}get builder(){return this}}class kje{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(t){return t==="fragment"?[]:this._entries.map(i=>`attribute ${i[1]} ${i[0]};`)}}class Uje{constructor(){this._entries=new Array}add(t,i){this._entries.push([t,i])}generateSource(){return this._entries.map(t=>`varying ${t[1]} ${t[0]};`)}}class nC{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const i=t==="vertex"?nC.ALLOWLIST_VERTEX:nC.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(r=>i.includes(r)).map(r=>`#extension ${r} : enable`)}}nC.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],nC.ALLOWLIST_VERTEX=[];class Vs{constructor(){this._entries=new Set}add(t,i,r){let s="ERROR_CONSTRUCTOR_STRING";switch(i){case"float":s=Vs._numberToFloatStr(r);break;case"int":s=Vs._numberToIntStr(r);break;case"bool":s=r.toString();break;case"vec2":s=`vec2(${Vs._numberToFloatStr(r[0])},                            ${Vs._numberToFloatStr(r[1])})`;break;case"vec3":s=`vec3(${Vs._numberToFloatStr(r[0])},                            ${Vs._numberToFloatStr(r[1])},                            ${Vs._numberToFloatStr(r[2])})`;break;case"vec4":s=`vec4(${Vs._numberToFloatStr(r[0])},                            ${Vs._numberToFloatStr(r[1])},                            ${Vs._numberToFloatStr(r[2])},                            ${Vs._numberToFloatStr(r[3])})`;break;case"ivec2":s=`ivec2(${Vs._numberToIntStr(r[0])},                             ${Vs._numberToIntStr(r[1])})`;break;case"ivec3":s=`ivec3(${Vs._numberToIntStr(r[0])},                             ${Vs._numberToIntStr(r[1])},                             ${Vs._numberToIntStr(r[2])})`;break;case"ivec4":s=`ivec4(${Vs._numberToIntStr(r[0])},                             ${Vs._numberToIntStr(r[1])},                             ${Vs._numberToIntStr(r[2])},                             ${Vs._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":s=`${i}(${Array.prototype.map.call(r,n=>Vs._numberToFloatStr(n)).join(", ")})`}return this._entries.add(`const ${i} ${t} = ${s};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const zje=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif`,Bje=`precision highp float;
precision highp sampler2D;`;class as extends vs{constructor(t){super(t,"sampler2D")}}function Vje(e){const t=new dr;t.attributes.add(D.POSITION,"vec2"),t.include(My,{textureCoordinateType:Pn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Hr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Hr("inverseViewMatrix",(s,n)=>Fs(Gje,n.camera.viewMatrix))]),i.code.add(E`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add([new Ut("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Py("radii"),new rr("scaleHeight"),new Vl("cameraPosition"),new nl("heightParameters"),new rr("innerFadeDistance"),new rr("altitudeFade"),new as("depthTex"),new Vl("betaRayleigh"),new Vl("betaCombined"),new rr("betaMie"),new rr("hazeStrength")]),t.include(HU),e.haze&&(r.include(nh),r.uniforms.add(new Ni("nearFar",(s,n)=>n.camera.nearFar))),r.code.add(E`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(E`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),r.code.add(E`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),r.code.add(E`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${e.haze?E`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${e.haze?E``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${e.haze?"":E`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${e.haze?E`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:E`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${e.haze?E`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:E`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${e.haze?E`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:E`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${e.haze?"":E`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),t}const Gje=Be(),jje=Object.freeze(Object.defineProperty({__proto__:null,build:Vje},Symbol.toStringTag,{value:"Module"}));class Tr{constructor(t,i){this._module=t,this._loadModule=i}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}}var br,Yt,je,Zy,kt,Lp,oC,Ct,kr,Es,mt,Ft,Ot,tt,Mt,Vt,el,Gi,$u,oo,Ss,Zi;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(br||(br={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Yt||(Yt={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(je||(je={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBTRACT=32778]="SUBTRACT",e[e.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Zy||(Zy={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(kt||(kt={})),function(e){e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(Lp||(Lp={})),function(e){e[e.CW=2304]="CW",e[e.CCW=2305]="CCW"}(oC||(oC={})),function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(Ct||(Ct={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(kr||(kr={})),function(e){e[e.ZERO=0]="ZERO",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP"}(Es||(Es={})),function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(mt||(mt={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(Ft||(Ft={})),function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(Ot||(Ot={})),function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.RG=33319]="RG",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER"}(tt||(tt={})),function(e){e[e.RGBA4=32854]="RGBA4",e[e.R16F=33325]="R16F",e[e.RG16F=33327]="RG16F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.R32F=33326]="R32F",e[e.RG32F=33328]="RG32F",e[e.RGBA32F=34836]="RGBA32F",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB5_A1=32855]="RGB5_A1",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.RGB16F=34843]="RGB16F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.RGB565=36194]="RGB565",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2=32857]="RGB10_A2",e[e.RGB10_A2UI=36975]="RGB10_A2UI"}(Mt||(Mt={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.INT=5124]="INT",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Vt||(Vt={})),function(e){e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(el||(el={})),function(e){e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_READ=35045]="STATIC_READ",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.STREAM_COPY=35042]="STREAM_COPY"}(Gi||(Gi={})),function(e){e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER"}($u||($u={})),function(e){e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(oo||(oo={})),function(e){e[e.TEXTURE=0]="TEXTURE",e[e.RENDER_BUFFER=1]="RENDER_BUFFER",e[e.CUBEMAP=2]="CUBEMAP"}(Ss||(Ss={})),function(e){e[e.NONE=0]="NONE",e[e.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",e[e.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",e[e.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(Zi||(Zi={}));const I6=33984;var Xn,Tu;(function(e){e[e.Texture=0]="Texture",e[e.BufferObject=1]="BufferObject",e[e.VertexArrayObject=2]="VertexArrayObject",e[e.Shader=3]="Shader",e[e.Program=4]="Program",e[e.FramebufferObject=5]="FramebufferObject",e[e.Renderbuffer=6]="Renderbuffer",e[e.Sync=7]="Sync",e[e.COUNT=8]="COUNT"})(Xn||(Xn={})),function(e){e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Tu||(Tu={}));const Use=33306;var Ts,zse,Bse,Vse,b5,Dq,Gse;(function(e){e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(Ts||(Ts={})),function(e){e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT=5124]="INT",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(zse||(zse={})),function(e){e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS"}(Bse||(Bse={})),function(e){e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED"}(Vse||(Vse={})),function(e){e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED"}(b5||(b5={})),function(e){e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Dq||(Dq={})),function(e){e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Gse||(Gse={}));class $r{constructor(t,i,r){this.release=r,i&&(this.initializeConfiguration(t,i),this._configuration=i.snapshot()),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}destroy(){this._program=ht(this._program),this._pipeline=this._configuration=null}reload(t){ht(this._program),this._program=this.initializeProgram(t),this._pipeline=this.initializePipeline(t.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(t,i){this.program.bindPass(t,i)}bindDraw(t,i){this.program.bindDraw(t,i),this.program.rebindTextures()}bindPipelineState(t,i=null,r){t.setPipelineState(this.getPipelineState(i,r))}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}get primitiveType(){return Yt.TRIANGLES}getPipelineState(t,i){return this._pipeline}initializeConfiguration(t,i){}}const or=new Map([[D.POSITION,0],[D.NORMAL,1],[D.UV0,2],[D.COLOR,3],[D.SIZE,4],[D.TANGENT,4],[D.AUXPOS1,5],[D.SYMBOLCOLOR,5],[D.AUXPOS2,6],[D.FEATUREATTRIBUTE,6],[D.INSTANCEFEATUREATTRIBUTE,6],[D.INSTANCECOLOR,7],[D.MODEL,8],[D.MODELNORMAL,12],[D.MODELORIGINHI,11],[D.MODELORIGINLO,15]]),Hje=Ie.getLogger("esri/views/webgl");function qje(e,t){switch(t){case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const _1e=!!Ce("enable-feature:webgl-debug");function Hh(){return _1e}function zP(){return _1e}function Mv(e){if(Hh()){const t=e.getError();if(t){const i=qje(e,t),r=new Error().stack;Hje.error(new se("webgl-error","WebGL error occured",{message:i,stack:r}))}}}class Sr{constructor(t,i,r){this._context=t,this._locations=r,this._textures=new Map,this._freeTextureUnits=new hi({deallocator:null}),this._glProgram=t.programCache.acquire(i.generate("vertex"),i.generate("fragment"),r),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=i.generateBind(nr.Pass,this),this.bindDraw=i.generateBind(nr.Draw,this),this._fragmentUniforms=Hh()?i.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(t,i){this._glProgram.setUniform1i(t,i?1:0)}setUniform1i(t,i){this._glProgram.setUniform1i(t,i)}setUniform1f(t,i){this._glProgram.setUniform1f(t,i)}setUniform2f(t,i,r){this._glProgram.setUniform2f(t,i,r)}setUniform2fv(t,i){this._glProgram.setUniform2fv(t,i)}setUniform3f(t,i,r,s){this._glProgram.setUniform3f(t,i,r,s)}setUniform3fv(t,i){this._glProgram.setUniform3fv(t,i)}setUniform4f(t,i,r,s,n){this._glProgram.setUniform4f(t,i,r,s,n)}setUniform4fv(t,i){this._glProgram.setUniform4fv(t,i)}setUniformMatrix3fv(t,i){this._glProgram.setUniformMatrix3fv(t,i)}setUniformMatrix4fv(t,i){this._glProgram.setUniformMatrix4fv(t,i)}setUniform1fv(t,i){this._glProgram.setUniform1fv(t,i)}setUniform1iv(t,i){this._glProgram.setUniform1iv(t,i)}setUniform2iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform3iv(t,i){this._glProgram.setUniform3iv(t,i)}setUniform4iv(t,i){this._glProgram.setUniform4iv(t,i)}assertCompatibleVertexAttributeLocations(t){t.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(t,i){if(N(i)||i.glName==null){const s=this._textures.get(t);return s&&(this._context.bindTexture(null,s.unit),this._freeTextureUnit(s),this._textures.delete(t)),null}let r=this._textures.get(t);return r==null?(r=this._allocTextureUnit(i),this._textures.set(t,r)):r.texture=i,this._context.useProgram(this),this.setUniform1i(t,r.unit),this._context.bindTexture(i,r.unit),r.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((t,i)=>{this._context.bindTexture(t.texture,t.unit),this.setUniform1i(i,t.unit)}),w(this._fragmentUniforms)&&this._fragmentUniforms.forEach(t=>{t.type!=="sampler2D"&&t.type!=="samplerCube"||this._textures.has(t.name)||console.error(`Texture sampler ${t.name} has no bound texture`)})}_allocTextureUnit(t){return{texture:t,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(t){this._freeTextureUnits.push(t.unit)}}var Ir,Ux,Iw,Pt,on,Ac,Wl,aC,Xy,Zl,jv,lC,Mr,zx;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.COUNT=3]="COUNT"})(Ir||(Ir={})),function(e){e[e.Less=0]="Less",e[e.Lequal=1]="Lequal",e[e.COUNT=2]="COUNT"}(Ux||(Ux={})),function(e){e[e.NONE=0]="NONE",e[e.SMAA=1]="SMAA"}(Iw||(Iw={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.FrontFace=2]="FrontFace",e[e.NONE=3]="NONE",e[e.COUNT=4]="COUNT"}(Pt||(Pt={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.UPDATE=1]="UPDATE"}(on||(on={})),function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED"}(Ac||(Ac={})),function(e){e[e.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",e[e.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(Wl||(Wl={})),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(aC||(aC={})),function(e){e[e.Highlight=0]="Highlight",e[e.MaskOccludee=1]="MaskOccludee",e[e.COUNT=2]="COUNT"}(Xy||(Xy={})),function(e){e[e.Triangle=0]="Triangle",e[e.Point=1]="Point",e[e.Line=2]="Line"}(Zl||(Zl={})),function(e){e[e.STRETCH=1]="STRETCH",e[e.PAD=2]="PAD"}(jv||(jv={})),function(e){e[e.CHANGED=0]="CHANGED",e[e.UNCHANGED=1]="UNCHANGED"}(lC||(lC={})),function(e){e[e.Blend=0]="Blend",e[e.Opaque=1]="Opaque",e[e.Mask=2]="Mask",e[e.MaskBlend=3]="MaskBlend",e[e.COUNT=4]="COUNT"}(Mr||(Mr={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(zx||(zx={}));function qm(e,t,i=Zy.ADD,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function Bo(e,t,i,r,s=Zy.ADD,n=Zy.ADD,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:s,opAlpha:n,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const cQ={face:Lp.BACK,mode:oC.CCW},v1e={face:Lp.FRONT,mode:oC.CCW},qU=e=>e===Ir.Back?cQ:e===Ir.Front?v1e:null,ec={zNear:0,zFar:1},wi={r:!0,g:!0,b:!0,a:!0};function Wje(e){return tHe.intern(e)}function Zje(e){return iHe.intern(e)}function Xje(e){return rHe.intern(e)}function Yje(e){return sHe.intern(e)}function Qje(e){return nHe.intern(e)}function Jje(e){return oHe.intern(e)}function Kje(e){return aHe.intern(e)}function eHe(e){return lHe.intern(e)}function ni(e){return cHe.intern(e)}class o0{constructor(t,i){this.makeKey=t,this.makeRef=i,this.interns=new Map}intern(t){if(!t)return null;const i=this.makeKey(t),r=this.interns;return r.has(i)||r.set(i,this.makeRef(t)),r.get(i)}}function a0(e){return"["+e.join(",")+"]"}const tHe=new o0(b1e,e=>({__tag:"Blending",...e}));function b1e(e){return e?a0([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const iHe=new o0(w1e,e=>({__tag:"Culling",...e}));function w1e(e){return e?a0([e.face,e.mode]):null}const rHe=new o0(x1e,e=>({__tag:"PolygonOffset",...e}));function x1e(e){return e?a0([e.factor,e.units]):null}const sHe=new o0(T1e,e=>({__tag:"DepthTest",...e}));function T1e(e){return e?a0([e.func]):null}const nHe=new o0(S1e,e=>({__tag:"StencilTest",...e}));function S1e(e){return e?a0([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const oHe=new o0(E1e,e=>({__tag:"DepthWrite",...e}));function E1e(e){return e?a0([e.zNear,e.zFar]):null}const aHe=new o0(C1e,e=>({__tag:"ColorWrite",...e}));function C1e(e){return e?a0([e.r,e.g,e.b,e.a]):null}const lHe=new o0(A1e,e=>({__tag:"StencilWrite",...e}));function A1e(e){return e?a0([e.mask]):null}const cHe=new o0(uHe,e=>({blending:Wje(e.blending),culling:Zje(e.culling),polygonOffset:Xje(e.polygonOffset),depthTest:Yje(e.depthTest),stencilTest:Qje(e.stencilTest),depthWrite:Jje(e.depthWrite),colorWrite:Kje(e.colorWrite),stencilWrite:eHe(e.stencilWrite)}));function uHe(e){return e?a0([b1e(e.blending),w1e(e.culling),x1e(e.polygonOffset),T1e(e.depthTest),S1e(e.stencilTest),E1e(e.depthWrite),C1e(e.colorWrite),A1e(e.stencilWrite)]):null}class hHe{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,i,r,s){return(r||t!==i)&&(s(t),this._pipelineInvalid=!0),t}}class BP extends $r{initializeProgram(t){const i=BP.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return this.configuration.haze?ni({blending:Bo(je.ONE,je.ZERO,je.ONE_MINUS_SRC_COLOR,je.ONE),colorWrite:wi}):ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:wi})}}BP.shader=new Tr(jje,()=>_e(()=>import("./ChapmanAtmosphere.glsl.10797fd1.js"),[],import.meta.url));class pl{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const t=this._parameterNames,i={key:this.key};for(const r of t)i[r]=this[r];return i}}function ee(e={}){return(t,i)=>{var r,s;if(t._parameterNames=(r=t._parameterNames)!=null?r:[],t._parameterNames.push(i),e.constValue!=null)Object.defineProperty(t,i,{get:()=>e.constValue});else{const n=t._parameterNames.length-1,o=e.count||2,a=Math.ceil(Math.log2(o)),l=(s=t._parameterBits)!=null?s:[0];let c=0;for(;l[c]+a>16;)c++,c>=l.length&&l.push(0);t._parameterBits=l;const h=l[c],p=(1<<a)-1<<h;l[c]+=a,Object.defineProperty(t,i,{get(){return this[n]},set(m){if(this[n]!==m&&(this[n]=m,this._keyDirty=!0,this._parameterBits[c]=this._parameterBits[c]&~p|+m<<h&p,typeof m!="number"&&typeof m!="boolean"))throw"Configuration value for "+i+" must be boolean or number, got "+typeof m}})}}}class O1e extends pl{constructor(){super(...arguments),this.haze=!1}}u([ee()],O1e.prototype,"haze",void 0);class ko{constructor(t,i,r,s,n,o=!1,a=0){this.name=t,this.count=i,this.type=r,this.offset=s,this.stride=n,this.normalized=o,this.divisor=a}}new ko(D.POSITION,3,Ct.FLOAT,0,12);new ko(D.POSITION,3,Ct.FLOAT,0,20),new ko(D.UV0,2,Ct.FLOAT,12,20);new ko(D.POSITION,3,Ct.FLOAT,0,32),new ko(D.NORMAL,3,Ct.FLOAT,12,32),new ko(D.UV0,2,Ct.FLOAT,24,32);new ko(D.POSITION,3,Ct.FLOAT,0,16),new ko(D.COLOR,4,Ct.UNSIGNED_BYTE,12,16);const uQ=[new ko(D.POSITION,2,Ct.FLOAT,0,8)],aI=[new ko(D.POSITION,2,Ct.FLOAT,0,16),new ko(D.UV0,2,Ct.FLOAT,8,16)];var Li;function dHe(e,t,i={}){const r=R1e(e);for(;r.length>1;){const s=w5(t,r.shift(),i);if(w(s))return s}return pHe(t,r.shift(),i)}function R1e(e){const t=Ce("esri-force-webgl");if(t===Li.WEBGL1||t===Li.WEBGL2)return[t];switch(e){case"2d":return Ce("mac")&&Ce("chrome")?[Li.WEBGL1,Li.WEBGL2]:[Li.WEBGL2,Li.WEBGL1];case"3d":return[Li.WEBGL2,Li.WEBGL1]}}function pHe(e,t,i={}){if(!window.WebGLRenderingContext)return jse(e,fHe),null;const r=w5(e,t,i);return N(r)&&jse(e,mHe),r}function w5(e,t,i={}){const r=t===Li.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let s=null;for(const n of r){try{s=e.getContext(n,i)}catch{}if(s)break}return s}function jse(e,t){const i=e.parentNode;i&&(i.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>")}(function(e){e[e.WEBGL1=1]="WEBGL1",e[e.WEBGL2=2]="WEBGL2"})(Li||(Li={}));const fHe='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',mHe=`It doesn't appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>`,tu=Ie.getLogger("esri.views.webgl.BufferObject");function gHe(e){return sCe(e)}class Ai{constructor(t,i,r,s){this._context=t,this.bufferType=i,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(Xn.BufferObject,this),this._glName=this._context.gl.createBuffer(),Mv(this._context.gl),s&&this.setData(s)}static createIndex(t,i,r){return new Ai(t,kt.ELEMENT_ARRAY_BUFFER,i,r)}static createVertex(t,i,r){return new Ai(t,kt.ARRAY_BUFFER,i,r)}static createUniform(t,i,r){if(t.type!==Li.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new Ai(t,kt.UNIFORM_BUFFER,i,r)}static createPixelPack(t,i=Gi.STREAM_READ,r){if(t.type!==Li.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const s=new Ai(t,kt.PIXEL_PACK_BUFFER,i);return r&&s.setSize(r),s}static createPixelUnpack(t,i=Gi.STREAM_DRAW,r){if(t.type!==Li.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new Ai(t,kt.PIXEL_UNPACK_BUFFER,i,r)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===kt.ELEMENT_ARRAY_BUFFER?this._indexType===Ct.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===kt.ELEMENT_ARRAY_BUFFER||this.bufferType===kt.ARRAY_BUFFER}dispose(){var t;(t=this._context)!=null&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(Xn.BufferObject,this),this._context=null):this._glName&&tu.warn("Leaked WebGL buffer object")}setSize(t,i=null){if(t<=0&&tu.error("Buffer size needs to be positive!"),this.bufferType===kt.ELEMENT_ARRAY_BUFFER&&w(i))switch(this._indexType=i,i){case Ct.UNSIGNED_SHORT:t*=2;break;case Ct.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let i=t.byteLength;this.bufferType===kt.ELEMENT_ARRAY_BUFFER&&(n4(t)&&(i/=2,this._indexType=Ct.UNSIGNED_SHORT),o4(t)&&(i/=4,this._indexType=Ct.UNSIGNED_INT)),this._setBufferData(i,t)}_setBufferData(t,i=null){this._size=t;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const s=this._context.gl;w(i)?s.bufferData(this.bufferType,i,this.usage):s.bufferData(this.bufferType,t,this.usage),Mv(s),this._isVAOAware&&this._context.bindVAO(r)}setSubData(t,i=0,r=0,s=t.byteLength){if(!t)return;(i<0||i>=this._size)&&tu.error("offset is out of range!");let n=i,o=r,a=s,l=t.byteLength;this.bufferType===kt.ELEMENT_ARRAY_BUFFER&&(n4(t)?(l/=2,n*=2,o*=2,a*=2):o4(t)&&(l/=4,n*=4,o*=4,a*=4)),s===void 0&&(s=l-1),r>=s&&tu.error("end must be bigger than start!"),i+r-s>this._size&&tu.error("An attempt to write beyond the end of the buffer!");const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const h=this._context.gl,p=ArrayBuffer.isView(t)?t.buffer:t,m=o===0&&a===t.byteLength?p:p.slice(o,a);h.bufferSubData(this.bufferType,n,m),Mv(h),this._isVAOAware&&this._context.bindVAO(c)}setSubDataFromView(t,i,r,s){if(!t)return;(i<0||i>=this._size)&&tu.error("offset is out of range!"),r>=s&&tu.error("end must be bigger than start!"),i+r-s>this._size&&tu.error("An attempt to write beyond the end of the buffer!");const n=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Li.WEBGL2)o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,t,r,s-r);else{const a=r===0&&s===t.length?t:t.subarray(r,s);o.bufferSubData(this.bufferType,i*t.BYTES_PER_ELEMENT,a)}Mv(o),this._isVAOAware&&this._context.bindVAO(n)}getSubData(t,i=0,r,s){if(this._context.type!==Li.WEBGL2)return void tu.error("Get buffer subdata is supported in WebGL2 only!");if(r<0||s<0)return void tu.error("Problem getting subdata: offset and length were less than zero!");const n=gHe(t)?t.BYTES_PER_ELEMENT:1;if(n*((r!=null?r:0)+(s!=null?s:0))>t.byteLength)return void tu.error("Problem getting subdata: offset and length exceeded destination size!");i+n*(s!=null?s:0)>this.byteSize&&tu.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,kt.COPY_READ_BUFFER),o.getBufferSubData(kt.COPY_READ_BUFFER,i,t,r,s),this._context.unbindBuffer(kt.COPY_READ_BUFFER)}async getSubDataAsync(t,i=0,r,s){this._context.type===Li.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(t,i,r,s)):tu.error("Get buffer subdata is supported in WebGL2 only!")}}function co(e){return window.WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext}const Hse=4;class bt{constructor(t,i,r=null){if(this._context=t,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,t.instanceCounter.increment(Xn.Texture,this),this._descriptor={target:Ot.TEXTURE_2D,samplingMode:mt.LINEAR,wrapMode:Ft.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...i},t.type!==Li.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),X1(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===Ot.TEXTURE_CUBE_MAP?this._setDataCubeMap(r):this.setData(r)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(Xn.Texture,this))}release(){this.dispose()}resize(t,i){const r=this._descriptor;if(r.width!==t||r.height!==i){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");r.width=t,r.height=i,this._descriptor.target===Ot.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(t=null){for(let i=Ot.TEXTURE_CUBE_MAP_POSITIVE_X;i<=Ot.TEXTURE_CUBE_MAP_NEGATIVE_Z;i++)this._setData(t,i)}setData(t){this._setData(t)}_setData(t,i){var c;if(!this._context||!this._context.gl)return;const r=this._context.gl;this._glName||(this._glName=r.createTexture()),t===void 0&&(t=null);const s=this._descriptor;i!=null||(i=s.target);const n=X1(i);t===null&&(s.width=s.width||Hse,s.height=s.height||Hse,n&&(s.depth=(c=s.depth)!=null?c:1));const o=this._context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),bt._validateTexture(this._context,s),this._configurePixelStorage();const a=s.pixelFormat;let l=s.internalFormat?s.internalFormat:this._deriveInternalFormat(a,s.dataType);if(L6(t)){let h=t.width,p=t.height;const m=1;t instanceof HTMLVideoElement&&(h=t.videoWidth,p=t.videoHeight),s.width&&s.height,n&&s.depth,s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,m),this._texImage(i,0,l,h,p,m,t),Mv(r),s.hasMipmap&&this.generateMipmap(),s.width===void 0&&(s.width=h),s.height===void 0&&(s.height=p),n&&s.depth===void 0&&(s.depth=m)}else{const{width:h,height:p,depth:m}=s;if(h!=null&&p!=null||console.error("Width and height must be specified!"),n&&m==null&&console.error("Depth must be specified!"),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(i,l,s.hasMipmap,h,p,m),r.DEPTH24_STENCIL8&&l===r.DEPTH_STENCIL&&(l=r.DEPTH24_STENCIL8),bF(t)){const g=t.levels,v=qse(i,h,p,m),b=Math.min(v-1,g.length-1);co(r)?r.texParameteri(s.target,r.TEXTURE_MAX_LEVEL,b):s.hasMipmap=s.hasMipmap&&v===g.length;const S=l;if(!_He(S))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((T,O,C,M)=>{const I=g[Math.min(T,g.length-1)];this._compressedTexImage(i,T,S,O,C,M,I)},b)}else w(t)?(this._texImage(i,0,l,h,p,m,t),Mv(r),s.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((g,v,b,S)=>{this._texImage(i,g,l,v,b,S,null),Mv(r)})}bt._applySamplingMode(r,this._descriptor),bt._applyWrapMode(r,this._descriptor),bt._applyAnisotropicFilteringParameters(this._context,this._descriptor),Mv(r),this._context.bindTexture(o,bt.TEXTURE_UNIT_FOR_UPDATES)}updateData(t,i,r,s,n,o){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const a=this._context.gl,l=this._descriptor,{pixelFormat:c,internalFormat:h,dataType:p,isImmutable:m,target:g}=l;if(m&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const v=this._context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES);(i<0||r<0||s>l.width||n>l.height||i+s>l.width||r+n>l.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),L6(o)?a.texSubImage2D(g,t,i,r,c,p,o):bF(o)?a.compressedTexSubImage2D(g,t,i,r,s,n,h,o.levels[t]):a.texSubImage2D(g,t,i,r,s,n,c,p,o),this._context.bindTexture(v,bt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(t,i,r,s,n,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._context.gl;if(!co(c))throw new Error("3D textures are not supported in WebGL1");const h=this._descriptor,{pixelFormat:p,dataType:m,isImmutable:g,target:v,internalFormat:b}=h;if(g&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");X1(v)||console.warn("Attempting to set 3D texture data on a non-3D texture");const S=this._context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES);if(this._context.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),(i<0||r<0||s<0||n>h.width||o>h.height||a>h.depth||i+n>h.width||r+o>h.height||s+a>h.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),bF(l))l=l.levels[t],c.compressedTexSubImage3D(v,t,i,r,s,n,o,a,b,l);else{const T=l;c.texSubImage3D(v,t,i,r,s,n,o,a,p,m,T)}this._context.bindTexture(S,bt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");t.hasMipmap=!0,this._samplingModeDirty=!0,bt._validateTexture(this._context,t)}t.samplingMode===mt.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=mt.LINEAR_MIPMAP_NEAREST):t.samplingMode===mt.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=mt.NEAREST_MIPMAP_NEAREST);const i=this._context.bindTexture(this,bt.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(t.target),this._context.bindTexture(i,bt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)}setWrapMode(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,bt._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const t=this._context.gl,i=this._descriptor;this._samplingModeDirty&&(bt._applySamplingMode(t,i),this._samplingModeDirty=!1),this._wrapModeDirty&&(bt._applyWrapMode(t,i),this._wrapModeDirty=!1)}_deriveInternalFormat(t,i){if(this._context.type===Li.WEBGL1)return t;switch(i){case Vt.FLOAT:switch(t){case tt.RGBA:return Mt.RGBA32F;case tt.RGB:return Mt.RGB32F;default:throw new Error("Unable to derive format")}case Vt.UNSIGNED_BYTE:switch(t){case tt.RGBA:return Mt.RGBA8;case tt.RGB:return Mt.RGB8}default:return t}}_configurePixelStorage(){const t=this._context.gl,{unpackAlignment:i,flipped:r,preMultiplyAlpha:s}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,i),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,r?1:0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s?1:0)}_texStorage(t,i,r,s,n,o){const a=this._context.gl;if(!co(a))throw new Error("Immutable textures are not supported in WebGL1");if(!yHe(i))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=r?qse(t,s,n,o):1;X1(t)?a.texStorage3D(t,l,i,s,n,o):a.texStorage2D(t,l,i,s,n),this._wasImmutablyAllocated=!0}_texImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=this._context.type===Li.WEBGL2,p=X1(t),{isImmutable:m,pixelFormat:g,dataType:v}=this._descriptor;if(h&&(c=l),h||!L6(a))if(m){if(w(a)){const b=a;p?c.texSubImage3D(t,i,0,0,0,s,n,o,g,v,b):l.texSubImage2D(t,i,0,0,s,n,g,v,b)}}else{const b=a;p?c.texImage3D(t,i,r,s,n,o,0,g,v,b):l.texImage2D(t,i,r,s,n,0,g,v,b)}else l.texImage2D(t,0,r,g,v,a)}_compressedTexImage(t,i,r,s,n,o,a){const l=this._context.gl;let c=null;const h=X1(t),p=this._descriptor.isImmutable;if(h){if(this._context.type!==Li.WEBGL2)throw new Error("3D textures are not supported in WebGL1");c=l}p?w(a)&&(h?c.compressedTexSubImage3D(t,i,0,0,0,s,n,o,r,a):l.compressedTexSubImage2D(t,i,0,0,s,n,r,a)):h?c.compressedTexImage3D(t,i,r,s,n,o,0,a):l.compressedTexImage2D(t,i,r,s,n,0,a)}_forEachMipmapLevel(t,i=1/0){let{width:r,height:s,depth:n,hasMipmap:o,target:a}=this._descriptor;const l=a===Ot.TEXTURE_3D;for(let c=0;t(c,r,s,n),o&&(r!==1||s!==1||l&&n!==1)&&!(c>=i);++c)r=Math.max(1,r>>1),s=Math.max(1,s>>1),l&&(n=Math.max(1,n>>1))}static _validateTexture(t,i){(i.width<0||i.height<0||i.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=co(t.gl),s=ME(i.width)&&ME(i.height);r||!i.isImmutable&&!X1(i.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),r||s||(typeof i.wrapMode=="number"?i.wrapMode!==Ft.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):i.wrapMode.s===Ft.CLAMP_TO_EDGE&&i.wrapMode.t===Ft.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),i.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(t,i){let r=i.samplingMode,s=i.samplingMode;r===mt.LINEAR_MIPMAP_NEAREST||r===mt.LINEAR_MIPMAP_LINEAR?(r=mt.LINEAR,i.hasMipmap||(s=mt.LINEAR)):r!==mt.NEAREST_MIPMAP_NEAREST&&r!==mt.NEAREST_MIPMAP_LINEAR||(r=mt.NEAREST,i.hasMipmap||(s=mt.NEAREST)),t.texParameteri(i.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(i.target,t.TEXTURE_MIN_FILTER,s)}static _applyWrapMode(t,i){typeof i.wrapMode=="number"?(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode)):(t.texParameteri(i.target,t.TEXTURE_WRAP_S,i.wrapMode.s),t.texParameteri(i.target,t.TEXTURE_WRAP_T,i.wrapMode.t))}static _applyAnisotropicFilteringParameters(t,i){var s;const r=t.capabilities.textureFilterAnisotropic;!r||t.gl.texParameterf(i.target,r.TEXTURE_MAX_ANISOTROPY,(s=i.maxAnisotropy)!=null?s:1)}}function yHe(e){return e in Mt}function _He(e){return e in Ts}function bF(e){return w(e)&&"type"in e&&e.type==="compressed"}function vHe(e){return w(e)&&"byteLength"in e}function L6(e){return w(e)&&!bF(e)&&!vHe(e)}function X1(e){return e===Ot.TEXTURE_3D||e===Ot.TEXTURE_2D_ARRAY}function qse(e,t,i,r=1){let s=Math.max(t,i);return e===Ot.TEXTURE_3D&&(s=Math.max(s,r)),Math.round(Math.log(s)/Math.LN2)+1}bt.TEXTURE_UNIT_FOR_UPDATES=0;function Wse(e){const t=e.gl;switch(t.getError()){case t.NO_ERROR:return null;case t.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case t.INVALID_VALUE:return"A numeric argument is out of range";case t.INVALID_OPERATION:return"The specified command is not allowed for the current state";case t.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case t.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case t.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function na(e,t){return e.vertexBuffers[t].size/bHe(e.layout[t])}function bHe(e){return e[0].stride}function hQ(e,t,i,r,s=0){const n=e.gl,o=e.capabilities.instancing;e.bindBuffer(i);for(const a of r){const l=t.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=s*a.stride;if(a.count<=4)n.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),n.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let h=0;h<3;h++)n.vertexAttribPointer(l+h,3,a.type,a.normalized,a.stride,a.offset+12*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else if(a.count===16)for(let h=0;h<4;h++)n.vertexAttribPointer(l+h,4,a.type,a.normalized,a.stride,a.offset+16*h+c),n.enableVertexAttribArray(l+h),a.divisor>0&&o&&o.vertexAttribDivisor(l+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function dQ(e,t,i,r){const s=e.gl,n=e.capabilities.instancing;e.bindBuffer(i);for(const o of r){const a=t.get(o.name);if(o.count<=4)s.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)s.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&n&&n.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}e.unbindBuffer(kt.ARRAY_BUFFER)}function M1e(e){switch(e){case tt.ALPHA:case tt.LUMINANCE:case tt.RED:case tt.RED_INTEGER:case Mt.R8:case Mt.R8I:case Mt.R8UI:case Mt.R8_SNORM:case el.STENCIL_INDEX8:return 1;case tt.LUMINANCE_ALPHA:case tt.RG:case tt.RG_INTEGER:case Mt.RGBA4:case Mt.R16F:case Mt.R16I:case Mt.R16UI:case Mt.RG8:case Mt.RG8I:case Mt.RG8UI:case Mt.RG8_SNORM:case Mt.RGB565:case Mt.RGB5_A1:case el.DEPTH_COMPONENT16:return 2;case tt.DEPTH_COMPONENT:case tt.RGB:case tt.RGB_INTEGER:case Mt.RGB8:case Mt.RGB8I:case Mt.RGB8UI:case Mt.RGB8_SNORM:case Mt.SRGB8:case el.DEPTH_COMPONENT24:return 3;case tt.DEPTH_STENCIL:case tt.RGBA:case tt.RGBA_INTEGER:case Mt.RGBA8:case Mt.R32F:case Mt.R11F_G11F_B10F:case Mt.RG16F:case Mt.R32I:case Mt.R32UI:case Mt.RG16I:case Mt.RG16UI:case Mt.RGBA8I:case Mt.RGBA8UI:case Mt.RGBA8_SNORM:case Mt.SRGB8_ALPHA8:case Mt.RGB9_E5:case Mt.RGB10_A2UI:case Mt.RGB10_A2:case el.DEPTH_STENCIL:case el.DEPTH_COMPONENT32F:case el.DEPTH24_STENCIL8:return 4;case el.DEPTH32F_STENCIL8:return 5;case Mt.RGB16F:case Mt.RGB16I:case Mt.RGB16UI:return 6;case Mt.RG32F:case Mt.RG32I:case Mt.RG32UI:case Mt.RGBA16F:case Mt.RGBA16I:case Mt.RGBA16UI:return 8;case Mt.RGB32F:case Mt.RGB32I:case Mt.RGB32UI:return 12;case Mt.RGBA32F:case Mt.RGBA32I:case Mt.RGBA32UI:return 16;case Ts.COMPRESSED_RGB_S3TC_DXT1_EXT:case Ts.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case Ts.COMPRESSED_RGBA_S3TC_DXT3_EXT:case Ts.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case Ts.COMPRESSED_R11_EAC:case Ts.COMPRESSED_SIGNED_R11_EAC:case Ts.COMPRESSED_RGB8_ETC2:case Ts.COMPRESSED_SRGB8_ETC2:case Ts.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case Ts.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case Ts.COMPRESSED_RG11_EAC:case Ts.COMPRESSED_SIGNED_RG11_EAC:case Ts.COMPRESSED_RGBA8_ETC2_EAC:case Ts.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Bx(e){if(N(e))return 0;if("descriptor"in e)return e.glName?Bx(e.descriptor):0;const t=e.internalFormat||"pixelFormat"in e&&e.pixelFormat;if(!t)return 0;const i="hasMipmap"in e&&e.hasMipmap?1.3:1,r=e.width*e.height;return M1e(t)*r*i}const Y1=Ie.getLogger("esri.views.webgl.VertexArrayObject");class pn{constructor(t,i,r,s,n=null){this._context=t,this._locations=i,this._layout=r,this._buffers=s,this._indexBuffer=n,this._glName=null,this._initialized=!1,t.instanceCounter.increment(Xn.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((t,i)=>t+this._buffers[i].size,w(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(t=!0){var i,r;if(!this._context)return void((this._glName||t&&Object.getOwnPropertyNames(this._buffers).length>0)&&Y1.warn("Leaked WebGL VAO"));if(this._glName){const s=(r=(i=this._context)==null?void 0:i.capabilities)==null?void 0:r.vao;s?(s.deleteVertexArray(this._glName),this._glName=null):Y1.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),t){for(const s in this._buffers)this._buffers[s].dispose(),delete this._buffers[s];this._indexBuffer=ht(this._indexBuffer)}this._context.instanceCounter.decrement(Xn.VertexArrayObject,this),this._context=null}initialize(){if(this._initialized)return;const t=this._context.capabilities.vao;if(t){const i=t.createVertexArray();t.bindVertexArray(i),this._bindLayout(),t.bindVertexArray(null),this._glName=i}this._initialized=!0}bind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:t,_layout:i,_indexBuffer:r}=this;t||Y1.error("Vertex buffer dictionary is empty!");const s=this._context.gl;for(const n in t){const o=t[n];o||Y1.error("Vertex buffer is uninitialized!");const a=i[n];a||Y1.error("Vertex element descriptor is empty!"),hQ(this._context,this._locations,o,a)}w(r)&&(this._context.capabilities.vao?s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r.glName):this._context.bindBuffer(r))}unbind(){this.initialize();const t=this._context.capabilities.vao;t?t.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:t,_layout:i}=this;t||Y1.error("Vertex buffer dictionary is empty!");for(const r in t){const s=t[r];s||Y1.error("Vertex buffer is uninitialized!");const n=i[r];dQ(this._context,this._locations,s,n)}w(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}function fl(e,t=uQ,i=or,r=-1,s=1){let n=null;return t===aI?n=new Float32Array([r,r,0,0,s,r,1,0,r,s,0,1,s,s,1,1]):n=new Float32Array([r,r,s,r,r,s,s,s]),new pn(e,i,{geometry:t},{geometry:Ai.createVertex(e,Gi.STATIC_DRAW,n)})}function wHe(e,t=uQ,i=or){const r=new Float32Array([-1,-1,3,-1,-1,3]);return new pn(e,i,{geometry:t},{geometry:Ai.createVertex(e,Gi.STATIC_DRAW,r)})}const P1e=4;function I1e(e,t=P1e){return new bt(e,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:t,height:t})}function xHe(e,t,i=P1e){const r=new Uint8Array(i*i*4);for(let s=0;s<r.length;s+=4)r[s+0]=255*t[0],r[s+1]=255*t[1],r[s+2]=255*t[2],r[s+3]=255*t[3];return new bt(e,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:i,height:i},r)}function L1e(e){return new bt(e,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}class Zse{constructor(t){this._view=t,this.type="realistic",this.canRender=!0,this._cameraPosition=F(),this._heightParameters=di(),this._betasRayleigh=F(),this._betasCombined=F(),this._scaleHeight=0,this._radii=yt(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=Qi.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(Qi.radius)}destroy(){this._atmosphereTechnique=vr(this._atmosphereTechnique),this._atmosphereHazeTechnique=vr(this._atmosphereHazeTechnique),this._vao=ht(this._vao),this._handles=Tt(this._handles)}when(){return Promise.resolve()}initializeRenderContext(t){const i=t.renderContext.rctx,r=this._handles=new xi,s=this._view.basemapTerrain;w(s.rootTiles)&&this._updateElevation({spatialReference:s.spatialReference,tile:s.rootTiles[0],extent:s.rootTiles[0].extent,context:"ground"}),r.add(Fo(()=>this._view.basemapTerrain,"elevation-change",o=>this._updateElevation(o),{onListenerAdd:()=>this._updateElevation()})),r.add(Fo(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const n=new O1e;n.haze=!1,this._atmosphereTechnique=t.shaderTechniqueRepository.acquire(BP,n),n.haze=!0,this._atmosphereHazeTechnique=t.shaderTechniqueRepository.acquire(BP,n),this._vao=fl(i,aI),this._scaleHeight=$je*vF,fe(this._betasRayleigh,qT[0],qT[1],qT[2]),fe(this._betasCombined,qT[0]+P6[0],qT[1]+P6[1],qT[2]+P6[2])}render(t){this._render(t,this._atmosphereTechnique,t.offscreenRenderingHelper.depthTexture)}renderHaze(t,i){this._darkenHaze=i,this._render(t,this._atmosphereHazeTechnique,t.offscreenRenderingHelper.linearDepthTexture)}_render(t,i,r){this._update(t.bindParameters.camera);const s=t.rctx.bindTechnique(i,THe,t.bindParameters);t.offscreenRenderingHelper.renderDepthDetached(()=>{s.bindTexture("depthTex",r),this._renderCommon(i.program,t)})}_renderCommon(t,i){if(N(this._vao))return;const r=i.rctx;t.setUniform4fv("heightParameters",this._heightParameters),t.setUniform3fv("cameraPosition",this._cameraPosition),t.setUniform2fv("radii",this._radii),t.setUniform1f("scaleHeight",this._scaleHeight),t.setUniform1f("betaMie",Lje),t.setUniform3fv("betaRayleigh",this._betasRayleigh),t.setUniform3fv("betaCombined",this._betasCombined),t.setUniform1f("innerFadeDistance",this._innerFadeDistance),t.setUniform1f("altitudeFade",this._altitudeFade),t.setUniform1f("hazeStrength",this._hazeStrength),r.bindVAO(this._vao),t.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Yt.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(t){return t*Math.cos(Math.PI/16/16)}_updateElevation(t){const i=t?t.tile:$t(this._view.basemapTerrain.rootTiles,[null])[0];if(N(i)||i.level!==0)return;const r=this._adjustRadiusForTesselation(Qi.radius+i.elevationBounds[0]);r!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=r,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const t=this._adjustRadiusForTesselation(Qi.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||t<this._lowerBoundEarthRadius)&&this._updateRadius(t)}_updateRadius(t){this._lowerBoundEarthRadius=t,Di(this._radii,t,t+vF),this._innerFadeDistance=2*Math.sqrt((2*t-$q)*$q)}_update(t){if(N(t))return;this._cameraHeight=He(t.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const i=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/vF));this._heightParameters=ki(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,i),ve(this._cameraPosition,t.eye),this._altitudeFade=g1e(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?fi(.6,1,PE(9500,10500,this._cameraHeight-Qi.radius)):1}static isSupported(t){return t.renderContext.rctx.capabilities.depthTexture}}const THe=new mn;function SHe(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function $1e(e,t,i){i*=.5;const r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function D1e(e,t){const i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Gt?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i}function pQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*a+s*c-n*l,e[1]=s*h+o*l+n*a-r*c,e[2]=n*h+o*c+r*l-s*a,e[3]=o*h-r*a-s*l-n*c,e}function EHe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-r*a,e}function CHe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l-n*a,e[1]=s*l+o*a,e[2]=n*l+r*a,e[3]=o*l-s*a,e}function AHe(e,t,i){i*=.5;const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+s*a,e[1]=s*l-r*a,e[2]=n*l+o*a,e[3]=o*l-n*a,e}function OHe(e,t){const i=t[0],r=t[1],s=t[2];return e[0]=i,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-s*s)),e}function wF(e,t,i,r){const s=t[0],n=t[1],o=t[2],a=t[3];let l,c,h,p,m,g=i[0],v=i[1],b=i[2],S=i[3];return c=s*g+n*v+o*b+a*S,c<0&&(c=-c,g=-g,v=-v,b=-b,S=-S),1-c>Gt?(l=Math.acos(c),h=Math.sin(l),p=Math.sin((1-r)*l)/h,m=Math.sin(r*l)/h):(p=1-r,m=r),e[0]=p*s+m*g,e[1]=p*n+m*v,e[2]=p*o+m*b,e[3]=p*a+m*S,e}function RHe(e){const t=Cp(),i=Cp(),r=Cp(),s=Math.sqrt(1-t),n=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*i),e[1]=s*Math.cos(2*Math.PI*i),e[2]=n*Math.sin(2*Math.PI*r),e[3]=n*Math.cos(2*Math.PI*r),e}function MHe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i*i+r*r+s*s+n*n,a=o?1/o:0;return e[0]=-i*a,e[1]=-r*a,e[2]=-s*a,e[3]=n*a,e}function Yy(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function N1e(e,t){const i=t[0]+t[4]+t[8];let r;if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[3*s+s]&&(s=2);const n=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[3*s+s]-t[3*n+n]-t[3*o+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[3*n+o]-t[3*o+n])*r,e[n]=(t[3*n+s]+t[3*s+n])*r,e[o]=(t[3*o+s]+t[3*s+o])*r}return e}function PHe(e,t,i,r){const s=.5*Math.PI/180;t*=s,i*=s,r*=s;const n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=n*l*h-o*a*c,e[1]=o*a*h+n*l*c,e[2]=o*l*c-n*a*h,e[3]=o*l*h+n*a*c,e}function IHe(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const lI=Ap,LHe=_r,$He=bZ,DHe=pQ,NHe=z3,FHe=xde,kHe=Fk,F1e=wZ,UHe=F1e,k1e=xZ,zHe=k1e,fQ=wde,BHe=cP,VHe=Tde;function GHe(e,t,i){const r=ke(t,i);return r<-.999999?(St(df,jHe,t),vZ(df)<1e-6&&St(df,HHe,t),De(df,df),$1e(e,df,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(St(df,t,i),e[0]=df[0],e[1]=df[1],e[2]=df[2],e[3]=1+r,fQ(e,e))}const df=F(),jHe=Ke(1,0,0),HHe=Ke(0,1,0);function qHe(e,t,i,r,s,n){return wF(Xse,t,s,n),wF(Yse,i,r,n),wF(e,Xse,Yse,2*n*(1-n)),e}const Xse=s0(),Yse=s0();function WHe(e,t,i,r){const s=ZHe;return s[0]=i[0],s[3]=i[1],s[6]=i[2],s[1]=r[0],s[4]=r[1],s[7]=r[2],s[2]=-t[0],s[5]=-t[1],s[8]=-t[2],fQ(e,N1e(e,s))}const ZHe=Qr();Object.freeze(Object.defineProperty({__proto__:null,identity:SHe,setAxisAngle:$1e,getAxisAngle:D1e,multiply:pQ,rotateX:EHe,rotateY:CHe,rotateZ:AHe,calculateW:OHe,slerp:wF,random:RHe,invert:MHe,conjugate:Yy,fromMat3:N1e,fromEuler:PHe,str:IHe,copy:lI,set:LHe,add:$He,mul:DHe,scale:NHe,dot:FHe,lerp:kHe,length:F1e,len:UHe,squaredLength:k1e,sqrLen:zHe,normalize:fQ,exactEquals:BHe,equals:VHe,rotationTo:GHe,sqlerp:qHe,setAxes:WHe},Symbol.toStringTag,{value:"Module"}));function rA(e=YHe){return[e[0],e[1],e[2],e[3]]}function VP(e,t){return XHe(e[0],e[1],e[2],t,LX.get())}function XHe(e,t,i,r,s=rA()){return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function GP(e,t,i=rA()){return St(i,e,t),De(i,i),i[3]=NX(e,t),i}const YHe=[0,0,1,0];class QHe{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=F(),this.parallax={anchorPointClouds:F(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Be()},this.parallaxNew={anchorPointClouds:F(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:Be()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:Ao.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:qh.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:Hv.FINISHED,factor:-1}}}var qh,Ao,Hv;(function(e){e[e.FINISHED=0]="FINISHED",e[e.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",e[e.FADE_IN=2]="FADE_IN"})(qh||(qh={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.FADE_OUT=1]="FADE_OUT",e[e.SWITCH=2]="SWITCH",e[e.FADE_IN=3]="FADE_IN"}(Ao||(Ao={})),function(e){e[e.FINISHED=0]="FINISHED",e[e.HEIGHT_FADE=1]="HEIGHT_FADE"}(Hv||(Hv={}));function Wi(){return new Float32Array(3)}function x5(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Ki(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function U1e(e,t){return new Float32Array(e,t,3)}function mQ(){return Wi()}function z1e(){return Ki(1,1,1)}function B1e(){return Ki(1,0,0)}function V1e(){return Ki(0,1,0)}function G1e(){return Ki(0,0,1)}const JHe=mQ(),KHe=z1e(),eqe=B1e(),tqe=V1e(),iqe=G1e();Object.freeze(Object.defineProperty({__proto__:null,create:Wi,clone:x5,fromValues:Ki,createView:U1e,zeros:mQ,ones:z1e,unitX:B1e,unitY:V1e,unitZ:G1e,ZEROS:JHe,ONES:KHe,UNIT_X:eqe,UNIT_Y:tqe,UNIT_Z:iqe},Symbol.toStringTag,{value:"Module"}));function j1e(e){e.extensions.add("GL_EXT_shader_texture_lod"),e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(E`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}function gQ(e,t){switch(e.include(My,t),e.fragment.code.add(E`
  struct TextureLookupParameter {
    vec2 uv;
    ${t.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),t.textureCoordinateType){case Pn.Default:return void e.fragment.code.add(E`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case Pn.Atlas:return e.include(j1e),void e.fragment.code.add(E`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:t.textureCoordinateType;case Pn.None:case Pn.COUNT:return}}class al extends vs{constructor(t,i){super(t,"vec3",nr.Draw,(r,s,n)=>r.setUniform3fv(t,i(s,n)))}}class yQ extends vs{constructor(t,i){super(t,"vec2",nr.Draw,(r,s,n)=>r.setUniform2fv(t,i(s,n)))}}class _Q extends vs{constructor(t,i){super(t,"sampler2D",nr.Draw,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function kM(e,t,i){const r=[new _Q(e,t)];if(i){const s=e+"Size";r.push(new yQ(s,(n,o)=>{const a=t(n,o);return w(a)?Di(rqe,a.descriptor.width,a.descriptor.height):gd}))}return r}const rqe=yt();class ai extends vs{constructor(t,i){super(t,"sampler2D",nr.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function xF(e,t,i){const r=[new ai(e,t)];if(i){const s=e+"Size";r.push(new Ni(s,(n,o)=>{const a=t(n,o);return w(a)?Di(sqe,a.descriptor.width,a.descriptor.height):gd}))}return r}const sqe=yt();class S1{constructor(t){this._material=t.material,this._techniqueRepository=t.techniqueRep,this._output=t.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(t,i,r=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(t,this._material.getConfiguration(r,i),this._technique),this._technique}ensureResources(t){return Ac.LOADED}}class vQ extends S1{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textureRepository=t.textureRep,this._textureId=t.textureId,this._acquire(t.textureId,i=>this._texture=i),this._acquire(t.normalTextureId,i=>this._textureNormal=i),this._acquire(t.emissiveTextureId,i=>this._textureEmissive=i),this._acquire(t.occlusionTextureId,i=>this._textureOcclusion=i),this._acquire(t.metallicRoughnessTextureId,i=>this._textureMetallicRoughness=i)}dispose(){this._texture=vr(this._texture),this._textureNormal=vr(this._textureNormal),this._textureEmissive=vr(this._textureEmissive),this._textureOcclusion=vr(this._textureOcclusion),this._textureMetallicRoughness=vr(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return this._numLoading===0?Ac.LOADED:Ac.LOADING}get textureBindParameters(){return new H1e(w(this._texture)?this._texture.glTexture:null,w(this._textureNormal)?this._textureNormal.glTexture:null,w(this._textureEmissive)?this._textureEmissive.glTexture:null,w(this._textureOcclusion)?this._textureOcclusion.glTexture:null,w(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(t){(N(this._texture)||t!==this._texture.id)&&(this._texture=vr(this._texture),this._textureId=t,this._acquire(this._textureId,i=>this._texture=i))}_acquire(t,i){if(N(t))return void i(null);const r=this._textureRepository.acquire(t);if(ah(r))return++this._numLoading,void r.then(s=>{if(this._disposed)return vr(s),void i(null);i(s)}).finally(()=>--this._numLoading);i(r)}}class H1e extends mn{constructor(t=null,i=null,r=null,s=null,n=null){super(),this.texture=t,this.textureNormal=i,this.textureEmissive=r,this.textureOcclusion=s,this.textureMetallicRoughness=n}}const wbt=Ki(0,.6,.2);var Wt;(function(e){e[e.Disabled=0]="Disabled",e[e.Normal=1]="Normal",e[e.Schematic=2]="Schematic",e[e.Water=3]="Water",e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",e[e.COUNT=5]="COUNT"})(Wt||(Wt={}));function bQ(e,t){const i=e.fragment,r=t.hasMetalnessAndRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture;if(t.pbrMode===Wt.Normal&&r&&e.include(gQ,t),t.pbrMode!==Wt.Schematic)if(t.pbrMode!==Wt.Disabled){if(t.pbrMode===Wt.Normal){i.code.add(E`vec3 mrr;
vec3 emission;
float occlusion;`);const s=t.supportsTextureAtlas,n=t.pbrTextureBindType;t.hasMetalnessAndRoughnessTexture&&(i.uniforms.add(n===nr.Pass?xF("texMetallicRoughness",o=>o.textureMetallicRoughness,s):kM("texMetallicRoughness",o=>o.textureMetallicRoughness,s)),i.code.add(E`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),t.hasEmissionTexture&&(i.uniforms.add(n===nr.Pass?xF("texEmission",o=>o.textureEmissive,s):kM("texEmission",o=>o.textureEmissive,s)),i.code.add(E`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),t.hasOcclusionTexture?(i.uniforms.add(n===nr.Pass?xF("texOcclusion",o=>o.textureOcclusion,s):kM("texOcclusion",o=>o.textureOcclusion,s)),i.code.add(E`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):i.code.add(E`float getBakedOcclusion() { return 1.0; }`),i.uniforms.add(n===nr.Pass?[new Ut("emissionFactor",o=>o.emissiveFactor),new Ut("mrrFactors",o=>o.mrrFactors)]:[new al("emissionFactor",o=>o.emissiveFactor),new al("mrrFactors",o=>o.mrrFactors)]),i.code.add(E`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${r?"vtc.uv = vuv0;":""}
      ${t.hasMetalnessAndRoughnessTexture?t.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${t.hasEmissionTexture?t.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${t.hasOcclusionTexture?t.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else i.code.add(E`float getBakedOcclusion() { return 1.0; }`);else i.code.add(E`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}class Ci extends vs{constructor(t,i){super(t,"vec4",nr.Pass,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}function wQ(e,t){const i=e.fragment,r=t.lightingSphericalHarmonicsOrder!==void 0?t.lightingSphericalHarmonicsOrder:2;r===0?(i.uniforms.add(new Ut("lightingAmbientSH0",(s,n)=>fe(Qse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0]))),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===1?(i.uniforms.add([new Ci("lightingAmbientSH_R",(s,n)=>_r(_g,n.lighting.sh.r[0],n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3])),new Ci("lightingAmbientSH_G",(s,n)=>_r(_g,n.lighting.sh.g[0],n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3])),new Ci("lightingAmbientSH_B",(s,n)=>_r(_g,n.lighting.sh.b[0],n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3]))]),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):r===2&&(i.uniforms.add([new Ut("lightingAmbientSH0",(s,n)=>fe(Qse,n.lighting.sh.r[0],n.lighting.sh.g[0],n.lighting.sh.b[0])),new Ci("lightingAmbientSH_R1",(s,n)=>_r(_g,n.lighting.sh.r[1],n.lighting.sh.r[2],n.lighting.sh.r[3],n.lighting.sh.r[4])),new Ci("lightingAmbientSH_G1",(s,n)=>_r(_g,n.lighting.sh.g[1],n.lighting.sh.g[2],n.lighting.sh.g[3],n.lighting.sh.g[4])),new Ci("lightingAmbientSH_B1",(s,n)=>_r(_g,n.lighting.sh.b[1],n.lighting.sh.b[2],n.lighting.sh.b[3],n.lighting.sh.b[4])),new Ci("lightingAmbientSH_R2",(s,n)=>_r(_g,n.lighting.sh.r[5],n.lighting.sh.r[6],n.lighting.sh.r[7],n.lighting.sh.r[8])),new Ci("lightingAmbientSH_G2",(s,n)=>_r(_g,n.lighting.sh.g[5],n.lighting.sh.g[6],n.lighting.sh.g[7],n.lighting.sh.g[8])),new Ci("lightingAmbientSH_B2",(s,n)=>_r(_g,n.lighting.sh.b[5],n.lighting.sh.b[6],n.lighting.sh.b[7],n.lighting.sh.b[8]))]),i.code.add(E`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),t.pbrMode!==Wt.Normal&&t.pbrMode!==Wt.Schematic||i.code.add(E`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Qse=F(),_g=di();class lt extends vs{constructor(t,i){super(t,"float",nr.Pass,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function xQ(e,t){const i=e.fragment;t.isGround?i.uniforms.add(new lt("lightingFixedFactor",(r,s)=>(1-s.lighting.groundLightingFactor)*(1-s.lighting.globalFactor))):i.constants.add("lightingFixedFactor","float",0),i.uniforms.add([new Ut("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection),new Ut("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(E`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}function WU(e){e.vertex.code.add(E`const float PI = 3.141592653589793;`),e.fragment.code.add(E`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}class Vx extends vs{constructor(t,i){super(t,"bool",nr.Pass,(r,s,n)=>r.setUniform1b(t,i(s,n)))}}class nqe extends vs{constructor(t,i){super(t,"samplerCube",nr.Pass,(r,s,n)=>r.bindTexture(t,i(s,n)))}}function q1e(e){const t=e.fragment;t.uniforms.add([new Hr("rotationMatrixClouds",(i,r)=>r.clouds.parallax.transform),new Hr("rotationMatrixCloudsCrossFade",(i,r)=>r.clouds.parallaxNew.transform),new Ut("anchorPosition",(i,r)=>r.clouds.parallax.anchorPointClouds),new Ut("anchorPositionCrossFade",(i,r)=>r.clouds.parallaxNew.anchorPointClouds),new Ni("cloudVariables",(i,r)=>w(r.clouds.data)?Di(oqe,r.clouds.data.coverage,r.clouds.data.absorption):gd),new lt("cloudsHeight",(i,r)=>r.clouds.parallax.cloudsHeight),new lt("radiusCurvatureCorrectionFactor",(i,r)=>r.clouds.parallax.radiusCurvatureCorrectionFactor),new lt("totalFadeInOut",(i,r)=>r.clouds.fadeInOut.stage===Ao.FINISHED?r.clouds.fadeInOutHeight.factor+Math.max(Xe(r.clouds.fadeIn.factor,0,1)):r.clouds.fadeInOutHeight.factor+Math.max(Xe(r.clouds.fadeInOut.factor,0,1))),new lt("crossFadeAnchorFactor",(i,r)=>Xe(r.clouds.crossFade.factor,0,1)),new nqe("cubeMap",(i,r)=>w(r.clouds.data)?r.clouds.data.cubeMap.colorTexture:null),new Vx("crossFade",(i,r)=>r.clouds.crossFade.enabled)]),t.constants.add("planetRadius","float",Qi.radius),t.code.add(E`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),t.code.add(E`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),t.code.add(E`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),t.uniforms.add([new Ut("lightingMainDirection",(i,r)=>r.lighting.lightingMainDirection),new Ut("lightingMainIntensity",(i,r)=>r.lighting.mainLight.intensity)]),t.code.add(E`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),t.code.add(E`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),t.code.add(E`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),t.code.add(E`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),t.code.add(E`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const oqe=yt();function Wm(e){e.code.add(E`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function aqe(){const e=new dr;e.attributes.add(D.POSITION,"vec2"),e.varyings.add("worldRay","vec3");const{vertex:t,fragment:i}=e;return t.uniforms.add([new Hr("inverseProjectionMatrix",(r,s)=>s.camera.inverseProjectionMatrix),new Hr("inverseViewMatrix",(r,s)=>Fs(lqe,s.camera.viewMatrix))]),t.code.add(E`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),i.include(Wm),i.include(Xc),e.include(wQ,{pbrMode:Wt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(WU),e.include(HU),e.include(xQ,{isGround:!1}),e.include(q1e,{instancedDoublePrecision:!1,isGround:!1}),i.uniforms.add([new Ut("cameraPosition",(r,s)=>s.camera.eye)]),i.code.add(E`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),e}const lqe=Be(),cqe=Object.freeze(Object.defineProperty({__proto__:null,build:aqe},Symbol.toStringTag,{value:"Module"}));class ZU extends $r{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=ZU.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:qm(je.ONE,je.SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:wi})}}ZU.shader=new Tr(cqe,()=>_e(()=>import("./CloudsComposition.glsl.9ec719f8.js"),[],import.meta.url));function uqe(e){return w(e)&&w(e.cubeMap)&&e.coverage>0}function Jse(e){return w(e)&&!e.running}let nw=class extends ze{constructor(e){super(e),this._technique=new ZU(e),this._vao=fl(e.rctx)}destroy(){this._technique=vr(this._technique),this._vao=ht(this._vao)}render(e,t){const i=e.bindParameters.clouds;if(N(this._vao)||N(i.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(i,e.bindParameters.camera.eye,t);const r=e.rctx.bindTechnique(this._technique,gqe,e.bindParameters);e.rctx.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Yt.TRIANGLE_STRIP,0,4),mqe(i)&&this.requestRender()}_setFadeInStage(e,t){const i=performance.now(),r=e.parallax.anchorPointClouds;e.fadeIn.stage===qh.FINISHED&&(e.fadeIn.factor=1,ve(r,pf),e.fadeIn.stage=qh.CHANGE_ANCHOR,e.crossFade.enabled=!1,e.fadeInOut.stage=Ao.FINISHED);const s=tne(e,t);e.fadeIn.stage===qh.CHANGE_ANCHOR&&s&&Jse(e.data)&&(ve(r,pf),e.fadeIn.stage=qh.FADE_IN,e.startTime=i),e.fadeIn.factor>0&&e.fadeIn.stage===qh.FADE_IN&&(e.fadeIn.factor=1-(i-e.startTime)/ene),e.fadeIn.factor<=0&&e.fadeIn.stage===qh.FADE_IN&&(e.fadeIn.stage=qh.FINISHED,e.fadeIn.factor=0)}_setCrossFadingStage(e){const t=performance.now(),{crossFade:i}=e,r=e.parallax.anchorPointClouds;e.crossFade.enabled||(ve(e.parallaxNew.anchorPointClouds,pf),e.startTime=t,i.factor=0,e.crossFade.enabled=!0),i.factor<1&&e.crossFade.enabled&&(i.factor=(t-e.startTime)/pqe),i.factor>=1&&e.crossFade.enabled&&(e.crossFade.enabled=!1,i.factor=1,ve(r,e.parallaxNew.anchorPointClouds))}_setFadeInOutStage(e,t){const i=performance.now(),{fadeInOut:r,crossFade:s}=e;r.stage===Ao.FINISHED&&(e.startTime=i,r.factor=0,r.stage=Ao.FADE_OUT),r.factor<1&&r.stage===Ao.FADE_OUT&&(r.factor=(i-e.startTime)/dqe),r.factor>=1&&r.stage===Ao.FADE_OUT&&(r.factor=1,ve(e.parallax.anchorPointClouds,pf)),r.factor>=1&&r.stage===Ao.FADE_OUT&&tne(e,t)&&(r.factor=1,r.stage=Ao.SWITCH,e.crossFade.enabled=!1,s.factor=1),Jse(e.data)&&r.stage===Ao.SWITCH&&(e.startTime=i,r.factor=1,r.stage=Ao.FADE_IN,ve(e.parallax.anchorPointClouds,pf),e.crossFade.enabled=!1,s.factor=1),r.factor>0&&r.stage===Ao.FADE_IN&&(r.factor=1-(i-e.startTime)/ene),r.factor<=0&&r.stage===Ao.FADE_IN&&(r.stage=Ao.FINISHED,r.factor=0)}_setFadeInOutHeight(e,t){const i=performance.now(),r=e.fadeInOutHeight,s=(i-(r.stage===Hv.FINISHED?i:e.startTimeHeightFade))/fqe;r.factor+=t?-s:s,e.startTimeHeightFade=i,r.factor=Xe(r.factor,0,1),r.stage=Hv.HEIGHT_FADE}_setParallaxParameters(e,t,i){const{parallax:r}=e;e.fadeInOutHeight.factor<0&&(e.fadeInOutHeight.factor=He(t)-this.planetRadius>Yh?1:0),De(pf,t),be(pf,pf,this.planetRadius),r.anchorPointClouds[0]===0&&r.anchorPointClouds[1]===0&&r.anchorPointClouds[2]===0&&ve(r.anchorPointClouds,pf);const s=He(Me(hqe,r.anchorPointClouds,pf));let n=!0;s>e.fadeIn.distanceThresholdFactor*r.cloudsHeight||e.fadeIn.stage!==qh.FINISHED?this._setFadeInStage(e,t):s>e.fadeInOut.distanceThresholdFactor*r.cloudsHeight||e.fadeInOut.stage!==Ao.FINISHED?this._setFadeInOutStage(e,t):s>e.crossFade.distanceThresholdFactor*r.cloudsHeight&&!i||e.crossFade.enabled?this._setCrossFadingStage(e):n=!1;const o=He(t),a=o-this.planetRadius;if((a>1.7*Yh||a<-Yh)&&e.fadeInOutHeight.factor<1?e.fadeInOutHeight.factor=1:(a>Yh||a<-.35*Yh)&&e.fadeInOutHeight.factor<1?this._setFadeInOutHeight(e,!1):a<Yh&&a>-.35*Yh&&e.fadeInOutHeight.factor>0?this._setFadeInOutHeight(e,!0):e.fadeInOutHeight.stage=Hv.FINISHED,r.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(o*o-this.planetRadius*this.planetRadius,0))/o,GP(Kse,r.anchorPointClouds,WT),r.transform=Be(),Dc(r.transform,r.transform,WT[3],WT),n){const{parallaxNew:l}=e;GP(Kse,l.anchorPointClouds,WT),l.transform=Be(),Dc(l.transform,l.transform,WT[3],WT)}ve(e.cameraPositionLastFrame,t)}};u([f({constructOnly:!0})],nw.prototype,"rctx",void 0),u([f({constructOnly:!0})],nw.prototype,"viewingMode",void 0),u([f({constructOnly:!0})],nw.prototype,"planetRadius",void 0),u([f({constructOnly:!0})],nw.prototype,"requestRender",void 0),nw=u([B("esri.views.3d.environment.CloudsComposition")],nw);const Kse=Ke(0,0,1),WT=rA(),pf=F(),hqe=F(),ene=500,dqe=250,pqe=500,fqe=500;function mqe(e){return e.crossFade.enabled||e.fadeInOut.stage!==Ao.FINISHED||e.fadeIn.stage!==qh.FINISHED||e.fadeInOutHeight.stage!==Hv.FINISHED}function tne(e,t){return Tx(e.cameraPositionLastFrame,t)}const gqe=new mn;function _d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function yqe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function TQ(e,t,i,r,s,n,o,a,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e}function SQ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function vd(e,t){if(e===t){const i=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function wT(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=h*o-a*c,m=-h*n+a*l,g=c*n-o*l;let v=i*p+r*m+s*g;return v?(v=1/v,e[0]=p*v,e[1]=(-h*r+s*c)*v,e[2]=(a*r-s*o)*v,e[3]=m*v,e[4]=(h*i-s*l)*v,e[5]=(-a*i+s*n)*v,e[6]=g*v,e[7]=(-c*i+r*l)*v,e[8]=(o*i-r*n)*v,e):null}function _qe(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-a*c,e[1]=s*c-r*h,e[2]=r*a-s*o,e[3]=a*l-n*h,e[4]=i*h-s*l,e[5]=s*n-i*a,e[6]=n*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*n,e}function vqe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-o*l)+i*(-c*s+o*a)+r*(l*s-n*a)}function XU(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],m=i[0],g=i[1],v=i[2],b=i[3],S=i[4],T=i[5],O=i[6],C=i[7],M=i[8];return e[0]=m*r+g*o+v*c,e[1]=m*s+g*a+v*h,e[2]=m*n+g*l+v*p,e[3]=b*r+S*o+T*c,e[4]=b*s+S*a+T*h,e[5]=b*n+S*l+T*p,e[6]=O*r+C*o+M*c,e[7]=O*s+C*a+M*h,e[8]=O*n+C*l+M*p,e}function T5(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],m=i[0],g=i[1];return e[0]=r,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=m*r+g*o+c,e[7]=m*s+g*a+h,e[8]=m*n+g*l+p,e}function EQ(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],h=t[7],p=t[8],m=Math.sin(i),g=Math.cos(i);return e[0]=g*r+m*o,e[1]=g*s+m*a,e[2]=g*n+m*l,e[3]=g*o-m*r,e[4]=g*a-m*s,e[5]=g*l-m*n,e[6]=c,e[7]=h,e[8]=p,e}function CQ(e,t,i){const r=i[0],s=i[1],n=i[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function bqe(e,t,i){const r=i[0],s=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e}function wqe(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function xqe(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Tqe(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Sqe(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function YU(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=i+i,a=r+r,l=s+s,c=i*o,h=r*o,p=r*a,m=s*o,g=s*a,v=s*l,b=n*o,S=n*a,T=n*l;return e[0]=1-p-v,e[3]=h-T,e[6]=m+S,e[1]=h+T,e[4]=1-c-v,e[7]=g-b,e[2]=m-S,e[5]=g+b,e[8]=1-c-p,e}function W1e(e,t){const i=t[0],r=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],h=t[10],p=h*o-a*c,m=-h*n+a*l,g=c*n-o*l,v=i*p+r*m+s*g;if(!v)return null;const b=1/v;return e[0]=p*b,e[1]=(-h*r+s*c)*b,e[2]=(a*r-s*o)*b,e[3]=m*b,e[4]=(h*i-s*l)*b,e[5]=(-a*i+s*n)*b,e[6]=g*b,e[7]=(-c*i+r*l)*b,e[8]=(o*i-r*n)*b,e}function cC(e,t){const i=t[0],r=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],p=t[9],m=t[10],g=t[11],v=t[12],b=t[13],S=t[14],T=t[15],O=i*a-r*o,C=i*l-s*o,M=i*c-n*o,I=r*l-s*a,$=r*c-n*a,U=s*c-n*l,q=h*b-p*v,G=h*S-m*v,Y=h*T-g*v,J=p*S-m*b,X=p*T-g*b,ne=m*T-g*S;let re=O*ne-C*X+M*J+I*Y-$*G+U*q;return re?(re=1/re,e[0]=(a*ne-l*X+c*J)*re,e[1]=(l*Y-o*ne-c*G)*re,e[2]=(o*X-a*Y+c*q)*re,e[3]=(s*X-r*ne-n*J)*re,e[4]=(i*ne-s*Y+n*G)*re,e[5]=(r*Y-i*X-n*q)*re,e[6]=(b*U-S*$+T*I)*re,e[7]=(S*M-v*U-T*C)*re,e[8]=(v*$-b*M+T*O)*re,e):null}function Eqe(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function Cqe(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function Aqe(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function Oqe(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e}function Z1e(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}function Rqe(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e}function Mqe(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e}function Pqe(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function Iqe(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],p=t[0],m=t[1],g=t[2],v=t[3],b=t[4],S=t[5],T=t[6],O=t[7],C=t[8];return Math.abs(i-p)<=Gt*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-m)<=Gt*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(s-g)<=Gt*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(n-v)<=Gt*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-b)<=Gt*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-S)<=Gt*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(l-T)<=Gt*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-O)<=Gt*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(h-C)<=Gt*Math.max(1,Math.abs(h),Math.abs(C))}function AQ(e){const t=Gt,i=e[0],r=e[1],s=e[2],n=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8];return Math.abs(1-(i*i+n*n+l*l))<=t&&Math.abs(1-(r*r+o*o+c*c))<=t&&Math.abs(1-(s*s+a*a+h*h))<=t}const Lqe=XU,$qe=Z1e;Object.freeze(Object.defineProperty({__proto__:null,fromMat4:_d,copy:yqe,set:TQ,identity:SQ,transpose:vd,invert:wT,adjoint:_qe,determinant:vqe,multiply:XU,translate:T5,rotate:EQ,scale:CQ,scaleByVec2:bqe,fromTranslation:wqe,fromRotation:xqe,fromScaling:Tqe,fromMat2d:Sqe,fromQuat:YU,normalFromMat4Legacy:W1e,normalFromMat4:cC,projection:Eqe,str:Cqe,frob:Aqe,add:Oqe,subtract:Z1e,multiplyScalar:Rqe,multiplyScalarAndAdd:Mqe,exactEquals:Pqe,equals:Iqe,isOrthoNormal:AQ,mul:Lqe,sub:$qe},Symbol.toStringTag,{value:"Module"}));function OQ(){return new Float32Array(2)}function Dqe(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function il(e,t){const i=new Float32Array(2);return i[0]=e,i[1]=t,i}function Nqe(e,t){return new Float32Array(e,t,2)}function X1e(){return OQ()}function Y1e(){return il(1,1)}function Q1e(){return il(1,0)}function J1e(){return il(0,1)}const Fqe=X1e(),kqe=Y1e(),Uqe=Q1e(),zqe=J1e();Object.freeze(Object.defineProperty({__proto__:null,create:OQ,clone:Dqe,fromValues:il,createView:Nqe,zeros:X1e,ones:Y1e,unitX:Q1e,unitY:J1e,ZEROS:Fqe,ONES:kqe,UNIT_X:Uqe,UNIT_Y:zqe},Symbol.toStringTag,{value:"Module"}));var Tp;(function(e){e[e.SIXTEEN=0]="SIXTEEN",e[e.HUNDRED=1]="HUNDRED",e[e.TWOHUNDRED=2]="TWOHUNDRED",e[e.COUNT=3]="COUNT"})(Tp||(Tp={}));class K1e extends pl{constructor(){super(...arguments),this.steps=Tp.SIXTEEN}}u([ee({count:Tp.COUNT})],K1e.prototype,"steps",void 0);const Qh=Ce("esri-mobile")?64:128,Bqe=Qh/128,up=Math.ceil(Math.sqrt(Qh)),vp=(Qh+2)*up,Vqe=1e5,$6=128,Gqe=vp/1560;function E1(e,t=!0){e.attributes.add(D.POSITION,"vec2"),t&&e.varyings.add("uv","vec2"),e.vertex.code.add(E`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${t?E`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}class jP extends vs{constructor(t,i){super(t,"mat3",nr.Draw,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class ebe extends mn{constructor(){super(...arguments),this.viewMatrix=Qr()}}function jqe(e){const t=new dr;return t.include(E1,!1),t.fragment.uniforms.add(new rr("cloudRadius")),t.fragment.uniforms.add(new rr("halfCubeMapSize")),t.fragment.uniforms.add(new rr("power")),t.fragment.uniforms.add(new rr("sigmaE")),t.fragment.uniforms.add(new rr("density")),t.fragment.uniforms.add(new rr("cloudSize")),t.fragment.uniforms.add(new rr("detailSize")),t.fragment.uniforms.add(new rr("smoothness")),t.fragment.uniforms.add(new rr("cloudHeight")),t.fragment.uniforms.add(new rr("coverage")),t.fragment.uniforms.add(new jP("view",i=>i.viewMatrix)),t.fragment.uniforms.add(new as("cloudShapeTexture")),t.fragment.code.add(E`
    const int STEPS = ${e.steps===Tp.SIXTEEN?E`16`:e.steps===Tp.HUNDRED?E`100`:E`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),t.fragment.code.add(E`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${E.float(vp)};
      const float dataWidth = ${E.float(vp)};
      const float tileRows = ${E.float(up)};
      const vec3 atlasDimensions = vec3(${E.float(Qh)}, ${E.float(Qh)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${E.float(Bqe)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${E.float(Gqe)} * p) / ${E.float(vp)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),t.fragment.code.add(E`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),t.fragment.code.add(E`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),t.fragment.code.add(`
    vec3 multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      vec3 luminance = vec3(0);

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),t.fragment.code.add(E`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),t.fragment.code.add(E`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),t.fragment.code.add(E`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),t}const Hqe=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:ebe,build:jqe},Symbol.toStringTag,{value:"Module"}));class sO{constructor(t,i,r,s,n,o,a,l,c=.5){this.coverage=t,this.density=i,this.absorption=r,this.cloudSize=s,this.detailSize=n,this.smoothness=o,this.cloudHeight=a,this.raymarchingStepType=l,this.median=c}}const tbe={sunny:new sO([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],Tp.SIXTEEN),cloudy:new sO([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],Tp.TWOHUNDRED,.6),rainy:new sO([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],Tp.TWOHUNDRED,.4),snowy:new sO([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],Tp.HUNDRED,.65),foggy:new sO([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],Tp.SIXTEEN)};class QU extends $r{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=QU.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:Bo(je.ONE,je.ONE,je.ZERO,je.ZERO),depthTest:{func:kr.LEQUAL},colorWrite:wi})}}QU.shader=new Tr(Hqe,()=>_e(()=>import("./Clouds.glsl.b504b09f.js"),[],import.meta.url));var Fu;(function(e){e[e.Full=0]="Full",e[e.WeatherMap=1]="WeatherMap",e[e.COUNT=2]="COUNT"})(Fu||(Fu={}));class Nq extends pl{constructor(){super(...arguments),this.mode=Fu.Full}}u([ee({count:Fu.COUNT})],Nq.prototype,"mode",void 0);function qqe(e){const t=new dr;return t.include(E1,!1),t.fragment.code.add(E`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.fragment.uniforms.add(new Py("weatherTile")),e.mode===Fu.Full&&t.fragment.code.add(E`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${E.float(up)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${E.float(8)});

      float worley0 = worley(p, ${E.float(2)} * 2.0);
      float worley1 = worley(p, ${E.float(2)} * 8.0);
      float worley2 = worley(p, ${E.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${E.float(2)});
      float worley1 = worley(p, ${E.float(2)} * 2.0);
      float worley2 = worley(p, ${E.float(2)} * 4.0);
      float worley3 = worley(p, ${E.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),t.fragment.code.add(E`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${E.float($6)});

      // Get global coordinates of p
      p += weatherTile * ${E.float($6)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${E.float(Vqe)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),t.fragment.code.add(E`void main() {`),e.mode===Fu.Full&&t.fragment.code.add(E`
        float padWidth = 1.0;
        float paddedSize = ${E.float(Qh)} + 2.0 * padWidth;
        float tileCount = ${E.float(up)} * ${E.float(up)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${E.float(Qh)};
          }

          if (startPadY) {
            pixel.y += ${E.float(Qh)};
          }

          if (endPadX) {
            pixel.x -= ${E.float(Qh)};
          }

          if (endPadY) {
            pixel.y -= ${E.float(Qh)};
          }

          uv = vec2(pixel.xy / ${E.float(Qh)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${E.float(Qh)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${E.float(up)} * ${E.float(up)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${E.float(up)} * ${E.float(up)});
        p = p_;
        p.z /= (${E.float(up)} * ${E.float(up)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),t.fragment.code.add(E`
      vec2 mapUV = ${E.float($6)} * (gl_FragCoord.xy / ${E.float(vp)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${e.mode===Fu.Full?E`gl_FragColor.ba = vec2(0.0, map);`:E`gl_FragColor = vec4(map);`};
    }
  `),t}const Wqe=Object.freeze(Object.defineProperty({__proto__:null,build:qqe},Symbol.toStringTag,{value:"Module"}));class HP extends $r{initializeProgram(t){const i=HP.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:this.configuration.mode===Fu.Full?qm(je.ONE,je.ZERO):Bo(je.ZERO,je.ONE,je.ONE,je.ZERO),depthTest:{func:kr.ALWAYS},colorWrite:wi})}}HP.shader=new Tr(Wqe,()=>_e(()=>import("./NoiseTextureAtlas.glsl.cee7f9c9.js"),[],import.meta.url));class v2{constructor(t,i){this._context=t,this._desc=i,this.type="renderbuffer",this._context.instanceCounter.increment(Xn.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:n,internalFormat:o,multisampled:a}=i;if(a){if(this._context.type!==Li.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,s,n)}else r.renderbufferStorage(r.RENDERBUFFER,o,s,n)}get descriptor(){return this._desc}get samples(){const t=this._desc.samples,i=this._context.parameters.maxSamples;return t?Math.min(t,i):i}resize(t,i){const r=this._desc;if(r.width===t&&r.height===i)return;r.width=t,r.height=i;const s=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?s.renderbufferStorageMultisample(s.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):s.renderbufferStorage(s.RENDERBUFFER,r.internalFormat,r.width,r.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(Xn.Renderbuffer,this),this._context=null)}}const Zqe=Ie.getLogger("esri.views.webgl.FrameBufferObject");class Xr{constructor(t,i,r=null,s=null){var n;if(this._context=t,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc={...i},t.instanceCounter.increment(Xn.FramebufferObject,this),w(r)){Array.isArray(r)||(r=[r]);for(let o=0;o<r.length;++o){const a=r[o],l=Tu.COLOR_ATTACHMENT0+o;let c;rne(a)?(Xg(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new bt(this._context,c))),c$(c,this._desc)):(ine(a)?(c=a.descriptor,this._colorAttachments.set(l,a)):(c=a,this._colorAttachments.set(l,new v2(this._context,c))),D6(c,this._desc)),this._validateColorAttachmentPoint(l)}}if(w(s)){let o,a;if(rne(s))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),Xg(s)?(a=s.descriptor,this._depthStencilTexture=s):(a=s,this._depthStencilTexture=new bt(this._context,a)),c$(a,this._desc);else{ine(s)?(a=s.descriptor,o=s):(a=s,o=new v2(this._context,a));const l=(n=this._desc.depthStencilTarget)!=null?n:Zi.DEPTH_STENCIL_RENDER_BUFFER;l===Zi.STENCIL_RENDER_BUFFER?this._stencilAttachment=o:l===Zi.DEPTH_RENDER_BUFFER||l===Zi.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=o:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),D6(a,this._desc)}}}dispose(){if(!this._desc)return;const t=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(t),this._context.instanceCounter.decrement(Xn.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const t=this._colorAttachments.get(Tu.COLOR_ATTACHMENT0);return t&&Xg(t)?t:null}get colorAttachment(){return this._colorAttachments.get(Tu.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce((t,[i,r])=>t+Bx(r),0)+Bx(this.depthStencilAttachment)}getColorTexture(t){const i=this._colorAttachments.get(t);return i&&Xg(i)?i:null}attachColorTexture(t,i=Tu.COLOR_ATTACHMENT0){!t||(this._validateColorAttachmentPoint(i),c$(t.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,i)),this._colorAttachments.set(i,t))}detachColorTexture(t=Tu.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(t);if(Xg(i)){const r=i;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)),this._colorAttachments.delete(t),r}}setColorTextureTarget(t,i=Tu.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(i);Xg(r)&&this._framebufferTexture2D(r.glName,i,t)}attachDepthStencilTexture(t){if(N(t))return;const i=t.descriptor;i.pixelFormat!==tt.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),i.dataType!==Vt.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),c$(i,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==Zi.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=Zi.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,Use)),this._depthStencilTexture=t}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,Use)),this._depthStencilTexture=null,t}attachDepthStencilBuffer(t){if(N(t))return;const i=t.descriptor;if(i.internalFormat!==el.DEPTH_STENCIL&&i.internalFormat!==el.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),D6(i,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=i.internalFormat===el.DEPTH_STENCIL?Zi.DEPTH_STENCIL_RENDER_BUFFER:Zi.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,s=this._desc.depthStencilTarget===Zi.DEPTH_RENDER_BUFFER?r.DEPTH_ATTACHMENT:r.DEPTH_STENCIL_ATTACHMENT;r.framebufferRenderbuffer(oo.FRAMEBUFFER,s,r.RENDERBUFFER,t.glName)}this._depthAttachment=t}detachDepthStencilBuffer(){const t=this._context.gl,i=this._depthAttachment;if(i&&this._initialized){this._context.bindFramebuffer(this);const r=this._desc.depthStencilTarget===Zi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(oo.FRAMEBUFFER,r,t.RENDERBUFFER,null)}return this._depthAttachment=null,i}detachAll(){this._colorAttachments.forEach((t,i)=>this._detachColorAttachment(i)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture(t,i,r,s,n,o,a){(t<0||i<0||n<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!");const l=this._desc,c=a.descriptor;a.descriptor.target!==Ot.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),(t+r>l.width||i+s>l.height||n+r>c.width||o+s>c.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const h=this._context,p=h.bindTexture(a,bt.TEXTURE_UNIT_FOR_UPDATES);h.setActiveTexture(bt.TEXTURE_UNIT_FOR_UPDATES),h.bindFramebuffer(this),h.gl.copyTexSubImage2D(Ot.TEXTURE_2D,0,n,o,t,i,r,s),h.bindTexture(p,bt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,i,r,s,n,o,a){(r<=0||s<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,i,r,s,n,o,a)}async readPixelsAsync(t,i,r,s,n,o,a){if(this._context.type!==Li.WEBGL2)return Hh()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(t,i,r,s,n,o,a);const l=this._context.gl,c=Ai.createPixelPack(this._context,Gi.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(t,i,r,s,n,o,0),this._context.unbindBuffer(kt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(t,i){const r=this._desc;if(r.width!==t||r.height!==i){if(!this._initialized)return r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize(t,i));r.width=t,r.height=i,this._colorAttachments.forEach(s=>{s&&s.resize(t,i)}),this._depthStencilTexture!=null?this._depthStencilTexture.resize(t,i):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize(t,i),this._stencilAttachment&&this._stencilAttachment.resize(t,i)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind(t=oo.FRAMEBUFFER){var h,p,m,g;const i=this._context.gl;if(this._initialized)return void i.bindFramebuffer(t,this.glName);this._glName&&i.deleteFramebuffer(this._glName);const r=this._context,s=i.createFramebuffer(),n=this._desc,o=(h=n.colorTarget)!=null?h:Ss.RENDER_BUFFER,a=(p=n.width)!=null?p:1,l=(m=n.height)!=null?m:1;if(i.bindFramebuffer(t,s),this._colorAttachments.size===0)if(o===Ss.TEXTURE||o===Ss.CUBEMAP)this._colorAttachments.set(Tu.COLOR_ATTACHMENT0,Xqe(r,n,this.descriptor.colorTarget===Ss.CUBEMAP?Ot.TEXTURE_CUBE_MAP:Ot.TEXTURE_2D));else{const v=new v2(r,{internalFormat:Mt.RGBA4,width:a,height:l});this._colorAttachments.set(Tu.COLOR_ATTACHMENT0,v)}this._colorAttachments.forEach((v,b)=>{v&&(Xg(v)?this._framebufferTexture2D(v.glName,b,sne(v),t):i.framebufferRenderbuffer(t,b,i.RENDERBUFFER,v.glName))});const c=(g=n.depthStencilTarget)!=null?g:Zi.NONE;switch(c){case Zi.DEPTH_RENDER_BUFFER:case Zi.DEPTH_STENCIL_RENDER_BUFFER:{this._depthAttachment||(this._depthAttachment=new v2(r,{internalFormat:n.depthStencilTarget===Zi.DEPTH_RENDER_BUFFER?el.DEPTH_COMPONENT16:el.DEPTH_STENCIL,width:a,height:l}));const v=c===Zi.DEPTH_RENDER_BUFFER?i.DEPTH_ATTACHMENT:i.DEPTH_STENCIL_ATTACHMENT;i.framebufferRenderbuffer(t,v,i.RENDERBUFFER,this._depthAttachment.glName);break}case Zi.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new v2(r,{internalFormat:el.STENCIL_INDEX8,width:a,height:l})),i.framebufferRenderbuffer(t,i.STENCIL_ATTACHMENT,i.RENDERBUFFER,this._stencilAttachment.glName);break;case Zi.DEPTH_STENCIL_TEXTURE:if(!this._depthStencilTexture){r.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!");const v={target:Ot.TEXTURE_2D,pixelFormat:tt.DEPTH_STENCIL,dataType:Vt.UNSIGNED_INT_24_8,samplingMode:mt.NEAREST,wrapMode:Ft.CLAMP_TO_EDGE,width:a,height:l};this._depthStencilTexture=new bt(r,v)}this._framebufferTexture2D(this._depthStencilTexture.glName,i.DEPTH_STENCIL_ATTACHMENT,sne(this._depthStencilTexture),t)}zP()&&i.checkFramebufferStatus(t)!==i.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=s,this._initialized=!0}_framebufferTexture2D(t,i=Tu.COLOR_ATTACHMENT0,r=Ot.TEXTURE_2D,s=oo.FRAMEBUFFER,n=0){this._context.gl.framebufferTexture2D(s,i,r,t,n)}_detachColorAttachment(t){Hh()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const i=this._context.gl,r=this._colorAttachments.get(t);return Xg(r)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t)):this._initialized&&(this._context.bindFramebuffer(this),i.framebufferRenderbuffer(oo.FRAMEBUFFER,t,i.RENDERBUFFER,null)),this._colorAttachments.delete(t),r}_disposeColorAttachments(){this._colorAttachments.forEach((t,i)=>{this._detachColorAttachment(i),t.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);const i=this._desc.depthStencilTarget===Zi.DEPTH_RENDER_BUFFER?t.DEPTH_ATTACHMENT:t.DEPTH_STENCIL_ATTACHMENT;t.framebufferRenderbuffer(oo.FRAMEBUFFER,i,t.RENDERBUFFER,null)}this._depthAttachment.dispose(),this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),t.framebufferRenderbuffer(oo.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,t.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint(t){if(Xr._MAX_COLOR_ATTACHMENTS===-1){const r=this._context.capabilities.drawBuffers;if(r){const s=this._context.gl;Xr._MAX_COLOR_ATTACHMENTS=s.getParameter(r.MAX_COLOR_ATTACHMENTS)}else Xr._MAX_COLOR_ATTACHMENTS=1}const i=t-Tu.COLOR_ATTACHMENT0;i+1>Xr._MAX_COLOR_ATTACHMENTS&&Zqe.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${i+1}. Implementation supports up to ${Xr._MAX_COLOR_ATTACHMENTS} color attachments`)}}function Xg(e){return"type"in e&&e.type==="texture"}function ine(e){return"type"in e&&e.type==="renderbuffer"}function rne(e){return Xg(e)||"pixelFormat"in e}function Xqe(e,t,i){return new bt(e,{target:i,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,wrapMode:Ft.CLAMP_TO_EDGE,width:t.width,height:t.height})}function c$(e,t){e.target!==Ot.TEXTURE_2D&&e.target!==Ot.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Color attachment texture must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function D6(e,t){t.width!==void 0&&t.width>=0&&t.height!==void 0&&t.height>=0?t.width===e.width&&t.height===e.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(t.width=e.width,t.height=e.height)}function sne(e){return e.descriptor.target===Ot.TEXTURE_CUBE_MAP?Ot.TEXTURE_CUBE_MAP_POSITIVE_X:Ot.TEXTURE_2D}Xr._MAX_COLOR_ATTACHMENTS=-1;class ibe extends ze{constructor(t){let i;super(t),this._weatherTile=il(0,0),this._needsRender=!0,this._frameBuffer=new Xr(t.context.renderContext.rctx,{colorTarget:Ss.TEXTURE,width:vp,height:vp},{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,hasMipmap:!1,width:vp,height:vp}),this._vao=fl(t.context.renderContext.rctx),this._shaderTechniqueRepository=t.context.shaderTechniqueRepository,this._ensureRendered=()=>(w(i)?w(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(i=this._render(t.context.renderContext.rctx,Fu.WeatherMap)):w(this.fullTechnique)&&this.fullTechnique.compiled&&(i=this._render(t.context.renderContext.rctx,Fu.Full)),i)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(t){this._weatherTile[0]===t[0]&&this._weatherTile[1]===t[1]||(this._weatherTile=t,this._setDirty())}destroy(){this._fullTechnique=vr(this._fullTechnique),this._weatherMapTechnique=vr(this._weatherMapTechnique),this._frameBuffer=ht(this._frameBuffer),this._vao=ht(this._vao)}get fullTechnique(){if(N(this._fullTechnique)){const t=new Nq;t.mode=Fu.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(HP,t)}return this._fullTechnique}get weatherMapTechnique(){if(N(this._weatherMapTechnique)){const t=new Nq;t.mode=Fu.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(HP,t)}return this._weatherMapTechnique}_render(t,i){if(N(this._vao)||N(this._frameBuffer))return null;const r=i===Fu.Full?this.fullTechnique:this.weatherMapTechnique;if(N(r))return null;const s=t.getViewport();t.setViewport(0,0,vp,vp),t.bindFramebuffer(this._frameBuffer);const n=t.bindTechnique(r);return n.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),t.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.setViewport(s.x,s.y,s.width,s.height),this._needsRender=!1,this._frameBuffer.colorTexture}}u([f({constructOnly:!0})],ibe.prototype,"context",void 0);function rbe(e){e.include(nh),e.uniforms.add([new ai("geometryDepthTexture",(t,i)=>i.multipassGeometry.linearDepthTexture),new Ni("nearFar",(t,i)=>i.camera.nearFar)]),e.code.add(E`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class Yqe{constructor(){this.enabled=!1}}function oh(e,t){t.hasMultipassTerrain&&(e.fragment.include(nh),e.fragment.uniforms.add(new ai("terrainDepthTexture",(i,r)=>r.multipassTerrain.linearDepthTexture)),e.fragment.uniforms.add(new Ni("nearFar",(i,r)=>r.camera.nearFar)),e.fragment.uniforms.add(new Ni("inverseViewport",(i,r)=>r.inverseViewport)),e.fragment.code.add(E`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${t.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class Qqe{constructor(){this.enabled=!1,this.cullAboveGround=!1}}function Jqe(e,t){const i=e.fragment.uniforms;i.add(new Ni("nearFar",(r,s)=>s.camera.nearFar)),i.add(new ai("depthMap",(r,s)=>s.linearDepthTexture)),i.add(new Hr("view",(r,s)=>s.ssr.camera.viewMatrix)),i.add(new Hr("proj",(r,s)=>s.ssr.camera.projectionMatrix)),i.add(new lt("invResolutionHeight",(r,s)=>1/s.ssr.camera.height)),i.add(new ai("lastFrameColorMap",(r,s)=>s.ssr.lastFrameColorTexture)),i.add(new Hr("reprojectionMatrix",(r,s)=>s.ssr.reprojectionMatrix)),e.fragment.include(nh),e.fragment.code.add(E`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${t.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class Kqe{constructor(){this.reprojectionMatrix=Be()}}var Ue;(function(e){e[e.INTEGRATED_MESH=0]="INTEGRATED_MESH",e[e.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",e[e.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",e[e.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",e[e.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",e[e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",e[e.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",e[e.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",e[e.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",e[e.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",e[e.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",e[e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",e[e.LASERLINES=12]="LASERLINES",e[e.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",e[e.HUD_MATERIAL=14]="HUD_MATERIAL",e[e.LABEL_MATERIAL=15]="LABEL_MATERIAL",e[e.LINE_CALLOUTS=16]="LINE_CALLOUTS",e[e.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",e[e.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",e[e.DRAPED_WATER=19]="DRAPED_WATER",e[e.VOXEL=20]="VOXEL",e[e.MAX_SLOTS=21]="MAX_SLOTS"})(Ue||(Ue={}));class RQ{constructor(t=F()){this.intensity=t}}class sbe{constructor(t=F(),i=Ke(.57735,.57735,.57735)){this.intensity=t,this.direction=i}}class Fq{constructor(t=F(),i=Ke(.57735,.57735,.57735),r=!0,s=1,n=1){this.intensity=t,this.direction=i,this.castShadows=r,this.specularStrength=s,this.environmentStrength=n}}class nbe{constructor(){this.r=[0],this.g=[0],this.b=[0]}}function eWe(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t[r];return i}function N6(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]*t;return i}function dE(e,t,i){(i=i||e).length=e.length;for(let r=0;r<e.length;r++)i[r]=e[r]+t[r];return i}function obe(e){return(e+1)*(e+1)}function tWe(e){return Xe(Math.floor(Math.sqrt(e)-1),0,2)}function abe(e,t,i){const r=e[0],s=e[1],n=e[2],o=i||[];return o.length=obe(t),t>=0&&(o[0]=.28209479177),t>=1&&(o[1]=.4886025119*r,o[2]=.4886025119*n,o[3]=.4886025119*s),t>=2&&(o[4]=1.09254843059*r*s,o[5]=1.09254843059*s*n,o[6]=.31539156525*(3*n*n-1),o[7]=1.09254843059*r*n,o[8]=.54627421529*(r*r-s*s)),o}function iWe(e,t){const i=obe(e),r=t||{r:[],g:[],b:[]};r.r.length=r.g.length=r.b.length=i;for(let s=0;s<i;s++)r.r[s]=r.g[s]=r.b[s]=0;return r}function rWe(e,t){const i=tWe(t.r.length);for(const r of e)Ra(kq,r.direction),abe(kq,i,_y),eWe(_y,TF),N6(_y,r.intensity[0],ZT),dE(t.r,ZT),N6(_y,r.intensity[1],ZT),dE(t.g,ZT),N6(_y,r.intensity[2],ZT),dE(t.b,ZT);return t}function sWe(e,t){abe(kq,0,_y);for(const i of e)t.r[0]+=_y[0]*TF[0]*i.intensity[0]*4*Math.PI,t.g[0]+=_y[0]*TF[0]*i.intensity[1]*4*Math.PI,t.b[0]+=_y[0]*TF[0]*i.intensity[2]*4*Math.PI;return t}function nWe(e,t,i,r){iWe(t,r),fe(i.intensity,0,0,0);let s=!1;const n=oWe,o=aWe,a=lWe;n.length=0,o.length=0,a.length=0;for(const l of e)l instanceof Fq&&!s?(ve(i.direction,l.direction),ve(i.intensity,l.intensity),i.specularStrength=l.specularStrength,i.environmentStrength=l.environmentStrength,i.castShadows=l.castShadows,s=!0):l instanceof Fq||l instanceof sbe?n.push(l):l instanceof RQ?o.push(l):l instanceof nbe&&a.push(l);rWe(n,r),sWe(o,r);for(const l of a)dE(r.r,l.r),dE(r.g,l.g),dE(r.b,l.b)}const oWe=[],aWe=[],lWe=[],_y=[0],ZT=[0],kq=F(),TF=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],sA=.4;class cWe{constructor(){this._shOrder=2,this._oldSunlight={direction:F(),ambient:{color:F(),intensity:1},diffuse:{color:F(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new nbe,this._mainLight={intensity:F(),direction:Ke(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(t){nWe(t,this._shOrder,this._mainLight,this._sphericalHarmonics),ve(this._oldSunlight.direction,this._mainLight.direction);const i=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*i,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*i,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*i,be(this._oldSunlight.diffuse.color,this._mainLight.intensity,i),ve(u$,this._oldSunlight.diffuse.color),be(u$,u$,sA*this.globalFactor),Oe(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,u$)}get old(){return this._oldSunlight}}const u$=F();class JU{constructor(t,i,r){this.shadowMap=t,this.ssaoHelper=i,this.slicePlane=r,this.slot=Ue.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=yt(),this.lighting=new cWe,this.ssr=new Kqe,this.multipassTerrain=new Qqe,this.multipassGeometry=new Yqe,this.clouds=new QHe,this.overlays=[]}get camera(){return this._camera}set camera(t){this._camera=this.ssr.camera=t,this._inverseViewport[0]=1/t.fullViewport[2],this._inverseViewport[1]=1/t.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}let Ga=class extends ze{constructor(e){super(e),this._frameTask=null,this._handles=new xi,this._cubeMapSize=Ce("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new K1e,this._bindParameters=new JU(null,null,null),this._drawParameters=new ebe,this._weatherTile=il(0,0),this._weatherTileCount=128,this.coverage=fi(gl.coverage[0],gl.coverage[1],.5),this.density=fi(gl.density[0],gl.density[1],.5),this.absorption=fi(gl.absorption[0],gl.absorption[1],.5),this.cloudSize=fi(gl.cloudSize[0],gl.cloudSize[1],.5),this.detailSize=fi(gl.detailSize[0],gl.detailSize[1],.5),this.smoothness=fi(gl.smoothness[0],gl.smoothness[1],.5),this.cloudHeight=fi(gl.cloudHeight[0],gl.cloudHeight[1],.5),this.raymarchingStepType=gl.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=Be(),this._cameraPositionLastFrame=F(),this.running=!1}_getTechnique(e){return this._techniques[e]||(this._techniqueConfiguration.steps=e,this._techniques[e]=new QU({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[e])}_getWeatherTile(){const e=this.view.camera.position.latitude,t=this.view.camera.position.longitude;let i=il((e+90)/180,(t+180)/360);const r=Math.floor(this._weatherTileCount*Math.abs(2*i[0]-1));i=il(Math.floor(2*this._weatherTileCount*i[0]),Math.floor(4*(this._weatherTileCount-r)*i[1]));let s=0,n=0;if(w(this.view.environment)&&this.view.environment.lighting.type==="sun"&&w(this.view.environment.lighting.date)){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),s=31*o.getUTCMonth()+o.getUTCDate(),n=o.getUTCFullYear()}return i[0]=(i[0]+s)%(2*this._weatherTileCount),i[1]=(i[1]+n%100)%(4*this._weatherTileCount),i}initialize(){this._vao=fl(this.context.renderContext.rctx);const e=ji(this.view.spatialReference);this._cloudRadius=.5*e.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(It.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add(xe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),si))}destroy(){this._handles.destroy(),this._techniques.forEach(e=>vr(e)),this._techniques=null,this._frameBufferCube=ht(this._frameBufferCube),this._vao=ht(this._vao),this._noiseTexture=Tt(this._noiseTexture)}_ensureNoiseTexture(){if(N(this._noiseTexture)){const e=this.context;this._noiseTexture=new ibe({context:e}),this._noiseTexture.updateWeatherMap(this._weatherTile)}return this._noiseTexture.textureAtlas}ensureWeatherTile(){const e=this._getWeatherTile();w(this._noiseTexture)&&w(this.context)&&this._noiseTexture.updateWeatherMap(e),e[0]===this._weatherTile[0]&&e[1]===this._weatherTile[1]||(this._weatherTile=e,this.setDirty())}get frameBufferCube(){if(N(this._frameBufferCube)){const e={target:Ot.TEXTURE_CUBE_MAP,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize};this._frameBufferCube=new Xr(this.context.renderContext.rctx,{colorTarget:Ss.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},e)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(e){return e.crossFade.enabled||e.fadeInOut.stage===Ao.FADE_OUT||e.fadeInOutHeight.stage!==Hv.FINISHED}applyPreset(e,t){const i=e.median,r=s=>{const n=fi(s[0],s[1],i);return t<.5?fi(s[0],n,2*t):fi(n,s[1],2*(t-.5))};this.coverage=r(e.coverage),this.density=r(e.density),this.absorption=r(e.absorption),this.cloudSize=r(e.cloudSize),this.detailSize=r(e.detailSize),this.smoothness=r(e.smoothness),this.cloudHeight=r(e.cloudHeight),this.raymarchingStepType=e.raymarchingStepType}setDirty(){this.running=!0}runTask(e){if(this.coverage===0||N(this._vao))return void(this.running=!1);const t=this._getTechnique(this.raymarchingStepType);if(!t.compiled)return;if(!Tx(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void ve(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const i=this._ensureNoiseTexture();if(N(i))return;const r=this.context.renderContext.rctx,s=r.bindTechnique(t),n=1+this.absorption,o=fi(35,120,this.absorption);s.bindTexture("cloudShapeTexture",i),s.setUniform1f("cloudRadius",this._cloudRadius),s.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),s.setUniform1f("power",o),s.setUniform1f("sigmaE",n),s.setUniform1f("density",fi(0,.3,this.density)),s.setUniform1f("cloudSize",fi(0,.02,Math.max(.01,1-this.cloudSize))),s.setUniform1f("detailSize",fi(0,.2,Math.max(.01,1-this.detailSize))),s.setUniform1f("smoothness",fi(0,.5,1-this.smoothness)),s.setUniform1f("cloudHeight",fi(0,1500,this.cloudHeight)),s.setUniform1f("coverage",this.coverage),r.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao);const a=r.getViewport();r.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),r.bindFramebuffer(this.frameBufferCube);for(let l=0;l<5;l++){const c=uWe[l],h=hWe[l];hme(this._viewMatrix,dWe,c,h),_d(this._drawParameters.viewMatrix,this._viewMatrix);const p=Ot.TEXTURE_CUBE_MAP_POSITIVE_X+l;this.frameBufferCube.setColorTextureTarget(p),s.bindDraw(this._drawParameters,this._bindParameters),r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4),r.gl.flush()}this.running=!1,r.setViewport(a.x,a.y,a.width,a.height),this.requestRender(),e.madeProgress()}};u([f({constructOnly:!0})],Ga.prototype,"context",void 0),u([f({constructOnly:!0})],Ga.prototype,"view",void 0),u([f({constructOnly:!0})],Ga.prototype,"requestRender",void 0),u([f()],Ga.prototype,"_frameTask",void 0),u([f()],Ga.prototype,"coverage",void 0),u([f()],Ga.prototype,"density",void 0),u([f()],Ga.prototype,"absorption",void 0),u([f()],Ga.prototype,"cloudSize",void 0),u([f()],Ga.prototype,"detailSize",void 0),u([f()],Ga.prototype,"smoothness",void 0),u([f()],Ga.prototype,"cloudHeight",void 0),u([f()],Ga.prototype,"raymarchingStepType",void 0),u([f()],Ga.prototype,"running",void 0),Ga=u([B("esri.views.3d.environment.CloudsGenerator")],Ga);const uWe=[Ki(1,0,0),Ki(-1,0,0),Ki(0,1,0),Ki(0,-1,0),Ki(0,0,1)],hWe=[Ki(0,1,0),Ki(0,1,0),Ki(0,0,-1),Ki(0,0,1),Ki(0,1,0)],dWe=mQ(),gl=tbe.sunny;function pWe(e){const t=new dr;t.attributes.add(D.POSITION,"vec2"),t.include(My,{textureCoordinateType:Pn.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Hr("inverseProjectionMatrix",(s,n)=>n.camera.inverseProjectionMatrix),new Hr("inverseViewMatrix",(s,n)=>Fs(fWe,n.camera.viewMatrix))]),i.code.add(E`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new rr("atmosphereC")),r.uniforms.add(new Vl("cameraPosition")),r.uniforms.add(new Ni("nearFar",(s,n)=>n.camera.nearFar)),r.uniforms.add(new as("depthTex")),r.uniforms.add(new rr("fogStrength")),r.uniforms.add(new rr("fogAmount")),r.uniforms.add(new Vl("fogColor")),t.include(HU),r.include(nh),r.code.add(E`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(E`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(E`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${e.haze?E`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),t}const fWe=Be(),mWe=Object.freeze(Object.defineProperty({__proto__:null,build:pWe},Symbol.toStringTag,{value:"Module"}));class qP extends $r{initializeProgram(t){const i=qP.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return this.configuration.haze?ni({blending:Bo(je.ONE,je.ZERO,je.ONE_MINUS_SRC_COLOR,je.ONE),colorWrite:wi}):ni({blending:Bo(je.SRC_ALPHA,je.ZERO,je.ONE_MINUS_SRC_ALPHA,je.ONE),colorWrite:wi})}}qP.shader=new Tr(mWe,()=>_e(()=>import("./Fog.glsl.e9a94e7d.js"),[],import.meta.url));class Uq extends pl{constructor(){super(...arguments),this.haze=!1}}u([ee()],Uq.prototype,"haze",void 0);let QR=class extends ze{constructor(e){super(e),this._fogColor=Wi(),this._fogColorAtNight=Wi(),this._cameraDirection=Wi(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6;const t=e.context.renderContext.rctx;this._vao=fl(t,aI);const i=ji(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+vF}destroy(){this._hazeFogTechnique=vr(this._hazeFogTechnique),this._thickFogTechnique=vr(this._thickFogTechnique),this._vao=ht(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(e){this._strength=e}get strength(){return this._strength}get thickFogTechnique(){if(N(this._thickFogTechnique)){const e=new Uq;e.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(qP,e)}return this._thickFogTechnique}get hazeFogTechnique(){if(N(this._hazeFogTechnique)){const e=new Uq;e.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(qP,e)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(e,t,i){if(this.view.basemapTerrain.baseOpacity===0&&!t||(this._update(e,t,i),this._fogAmount<=0))return;const r=t?this.thickFogTechnique:this.hazeFogTechnique;if(!r.compiled)return void this.context.requestRender();const s=e.offscreenRenderingHelper,n=e.rctx.bindTechnique(r,gWe,e.bindParameters);s.renderDepthDetached(()=>{n.bindTexture("depthTex",s.depthTexture),this._renderFog(r.program,e)})}_renderFog(e,t){if(N(this._vao))return!1;const i=t.rctx,r=t.bindParameters.camera;return e.setUniform3fv("cameraPosition",r.eye),e.setUniform1f("atmosphereC",this._atmosphereC),e.setUniform1f("fogStrength",this._strength),e.setUniform1f("fogAmount",this._fogAmount),e.setUniform3fv("fogColor",this._fogColor),i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Yt.TRIANGLE_STRIP,0,4),!0}_update(e,t,i){const r=e.bindParameters.camera,s=t?.1:0;i?fe(this._fogColor,.5,.5,.5):t?fe(this._fogColor,1.5,1.5,1.5):fe(this._fogColor,.24,.44,.8),be(this._fogColorAtNight,this._fogColor,s),De(this._cameraDirection,r.eye);const n=Math.max(0,ke(this._cameraDirection,e.bindParameters.lighting.lightingMainDirection));Nn(this._fogColor,this._fogColorAtNight,this._fogColor,n);const o=He(r.eye),a=o*o;this._atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=t?1-PE(this._foggyFadeStart*Yh,this._foggyFadeEnd*Yh,Math.abs(o-this._planetRadius)):1-PE(this._hazeFadeStart*Yh,this._hazeFadeEnd*Yh,Math.abs(o-this._planetRadius))}static isSupported(e){return e.capabilities.depthTexture}};u([f({constructOnly:!0})],QR.prototype,"context",void 0),u([f({constructOnly:!0})],QR.prototype,"view",void 0),QR=u([B("esri.views.3d.environment.Fog")],QR);const gWe=new mn;async function Qp(e,t){const{data:i}=await jr(e,{responseType:"image",...t});return i}var $m;(function(e){e[e.Cone=0]="Cone",e[e.Cylinder=1]="Cylinder",e[e.Underground=2]="Underground",e[e.COUNT=3]="COUNT"})($m||($m={}));class S5 extends pl{constructor(){super(...arguments),this.geometry=$m.Cone}}u([ee({count:$m.COUNT})],S5.prototype,"geometry",void 0);function oa(e,t={hasModelTransformation:!1,linearDepth:!1}){if(t.hasModelTransformation)return t.linearDepth?void e.vertex.code.add(E`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void e.vertex.code.add(E`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);t.linearDepth?e.vertex.code.add(E`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):e.vertex.code.add(E`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}class n1 extends vs{constructor(t){super(t,"mat4")}}class MQ extends mn{}function yWe(e){const t=new dr,{vertex:i,fragment:r}=t;if(e.geometry===$m.Underground)t.attributes.add(D.POSITION,"vec2"),t.varyings.add("color","vec4"),i.uniforms.add([new Ut("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Vl("cameraPosition"),new rr("undergroundFadeAlpha")]),i.code.add(E`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),r.code.add(E`void main() {
gl_FragColor = color;
}`);else{t.include(oa),t.attributes.add(D.POSITION,"vec3"),t.varyings.add("vtc","vec2"),t.varyings.add("falloff","float");const s=e.geometry===$m.Cylinder;i.uniforms.add([new Hr("proj",(a,l)=>l.camera.projectionMatrix),new n1("view"),new Ut("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)]),s||(t.varyings.add("innerFactor","float"),i.uniforms.add(new Vl("silCircleCenter")),i.uniforms.add(new Vl("silCircleV1")),i.uniforms.add(new Vl("silCircleV2")),i.uniforms.add(new Py("texV")),i.uniforms.add(new rr("innerScale")));const n=6.2831853,o=1/128;i.code.add(E`
		void main(void) {
      ${s?E`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:E`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${E.float(n*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${E.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),r.uniforms.add(new ai("tex",a=>a.texture)),s||r.uniforms.add(new rr("altitudeFade")),r.code.add(E`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${s?E`gl_FragColor = atmosphereColor;`:E`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return t}const _We=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:MQ,build:yWe},Symbol.toStringTag,{value:"Module"}));class uC extends $r{initializeProgram(t){const i=uC.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return this.configuration.geometry===$m.Cylinder?ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),culling:cQ,depthTest:{func:kr.LEQUAL},colorWrite:wi}):ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:wi})}}uC.shader=new Tr(_We,()=>_e(()=>import("./SimpleAtmosphere.glsl.119a9f8c.js"),[],import.meta.url));const lbe="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";function Yc(e,t=0){const i=e.stride;return e.fieldNames.filter(r=>{const s=e.fields.get(r).optional;return!(s&&s.glPadding)}).map(r=>{const s=e.fields.get(r),n=s.constructor.ElementCount,o=vWe(s.constructor.ElementType),a=s.offset,l=!(!s.optional||!s.optional.glNormalized);return new ko(r,n,o,a,i,l,t)})}function vWe(e){const t=bWe[e];if(t)return t;throw new Error("BufferType not supported in WebGL")}const bWe={u8:Ct.UNSIGNED_BYTE,u16:Ct.UNSIGNED_SHORT,u32:Ct.UNSIGNED_INT,i8:Ct.BYTE,i16:Ct.SHORT,i32:Ct.INT,f32:Ct.FLOAT};class PQ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=9;const o=this.TypedArrayConstructor;s===void 0&&(s=9*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<9;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<9;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}PQ.ElementCount=9;class IQ{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=16;const o=this.TypedArrayConstructor;s===void 0&&(s=16*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)i[s]=this.typedBuffer[r++];return i}setMat(t,i){let r=t*this.typedBufferStride;for(let s=0;s<16;s++)this.typedBuffer[r++]=i[s]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;for(let l=0;l<16;++l)s[o++]=n[a++]}get buffer(){return this.typedBuffer.buffer}}IQ.ElementCount=16;class l0{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=1;const o=this.TypedArrayConstructor;s===void 0&&(s=o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}get(t){return this.typedBuffer[t*this.typedBufferStride]}set(t,i){this.typedBuffer[t*this.typedBufferStride]=i}get buffer(){return this.typedBuffer.buffer}}l0.ElementCount=1;class c0{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=2;const o=this.TypedArrayConstructor;s===void 0&&(s=2*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,Di(i,this.typedBuffer[t],this.typedBuffer[t+1])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t]=i[1]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t]=r}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}c0.ElementCount=2;class u0{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=3;const o=this.TypedArrayConstructor;s===void 0&&(s=3*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,fe(i,this.typedBuffer[t],this.typedBuffer[t+1],this.typedBuffer[t+2])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t]=i[2]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t]=s}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}u0.ElementCount=3;class h0{constructor(t,i,r=0,s,n){this.TypedArrayConstructor=t,this.elementCount=4;const o=this.TypedArrayConstructor;s===void 0&&(s=4*o.BYTES_PER_ELEMENT);const a=i.byteLength===0?0:r;this.typedBuffer=n==null?new o(i,a):new o(i,a,(n-r)/o.BYTES_PER_ELEMENT),this.typedBufferStride=s/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(t,i,r=this.count-i){const s=this.typedBuffer.byteOffset+i*this.stride;return new t(this.buffer,s,this.stride,s+r*this.stride)}getVec(t,i){return t*=this.typedBufferStride,_r(i,this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t++],this.typedBuffer[t])}setVec(t,i){t*=this.typedBufferStride,this.typedBuffer[t++]=i[0],this.typedBuffer[t++]=i[1],this.typedBuffer[t++]=i[2],this.typedBuffer[t]=i[3]}get(t,i){return this.typedBuffer[t*this.typedBufferStride+i]}set(t,i,r){this.typedBuffer[t*this.typedBufferStride+i]=r}setValues(t,i,r,s,n){t*=this.typedBufferStride,this.typedBuffer[t++]=i,this.typedBuffer[t++]=r,this.typedBuffer[t++]=s,this.typedBuffer[t]=n}copyFrom(t,i,r){const s=this.typedBuffer,n=i.typedBuffer;let o=t*this.typedBufferStride,a=r*i.typedBufferStride;s[o++]=n[a++],s[o++]=n[a++],s[o++]=n[a++],s[o]=n[a]}get buffer(){return this.typedBuffer.buffer}}h0.ElementCount=4;class cI extends l0{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}static fromTypedArray(t,i){return new cI(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}cI.ElementType="f32";class bd extends c0{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(bd,t,i)}static fromTypedArray(t,i){return new bd(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}bd.ElementType="f32";class hr extends u0{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(hr,t,i)}static fromTypedArray(t,i){return new hr(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}hr.ElementType="f32";class fo extends h0{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(fo,t,i)}static fromTypedArray(t,i){return new fo(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}fo.ElementType="f32";class Jp extends PQ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(Jp,t,i)}static fromTypedArray(t,i){return new Jp(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Jp.ElementType="f32";class o1 extends PQ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(o1,t,i)}static fromTypedArray(t,i){return new o1(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}o1.ElementType="f64";class hC extends IQ{constructor(t,i=0,r,s){super(Float32Array,t,i,r,s),this.elementType="f32"}slice(t,i){return this.sliceBuffer(hC,t,i)}static fromTypedArray(t,i){return new hC(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}hC.ElementType="f32";class a1 extends IQ{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(a1,t,i)}static fromTypedArray(t,i){return new a1(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}a1.ElementType="f64";class dC extends l0{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(dC,t,i)}static fromTypedArray(t,i){return new dC(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}dC.ElementType="f64";class pC extends c0{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(pC,t,i)}static fromTypedArray(t,i){return new pC(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}pC.ElementType="f64";class Ws extends u0{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Ws,t,i)}static fromTypedArray(t,i){return new Ws(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Ws.ElementType="f64";class Gx extends h0{constructor(t,i=0,r,s){super(Float64Array,t,i,r,s),this.elementType="f64"}slice(t,i){return this.sliceBuffer(Gx,t,i)}static fromTypedArray(t,i){return new Gx(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Gx.ElementType="f64";class Qy extends l0{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(Qy,t,i)}static fromTypedArray(t,i){return new Qy(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Qy.ElementType="u8";class jx extends c0{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(jx,t,i)}static fromTypedArray(t,i){return new jx(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}jx.ElementType="u8";class l1 extends u0{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(l1,t,i)}static fromTypedArray(t,i){return new l1(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}l1.ElementType="u8";class tc extends h0{constructor(t,i=0,r,s){super(Uint8Array,t,i,r,s),this.elementType="u8"}slice(t,i){return this.sliceBuffer(tc,t,i)}static fromTypedArray(t,i){return new tc(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}tc.ElementType="u8";class Hx extends l0{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(Hx,t,i)}static fromTypedArray(t,i){return new Hx(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Hx.ElementType="u16";class fC extends c0{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(fC,t,i)}static fromTypedArray(t,i){return new fC(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}fC.ElementType="u16";class qx extends u0{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(qx,t,i)}static fromTypedArray(t,i){return new qx(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}qx.ElementType="u16";class c1 extends h0{constructor(t,i=0,r,s){super(Uint16Array,t,i,r,s),this.elementType="u16"}slice(t,i){return this.sliceBuffer(c1,t,i)}static fromTypedArray(t,i){return new c1(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}c1.ElementType="u16";class Wx extends l0{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(Wx,t,i)}static fromTypedArray(t,i){return new Wx(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Wx.ElementType="u32";class mC extends c0{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(mC,t,i)}static fromTypedArray(t,i){return new mC(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}mC.ElementType="u32";class WP extends u0{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(WP,t,i)}static fromTypedArray(t,i){return new WP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}WP.ElementType="u32";class ZP extends h0{constructor(t,i=0,r,s){super(Uint32Array,t,i,r,s),this.elementType="u32"}slice(t,i){return this.sliceBuffer(ZP,t,i)}static fromTypedArray(t,i){return new ZP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}ZP.ElementType="u32";class gC extends l0{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(gC,t,i)}static fromTypedArray(t,i){return new gC(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}gC.ElementType="i8";class Zx extends c0{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(Zx,t,i)}static fromTypedArray(t,i){return new Zx(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Zx.ElementType="i8";class XP extends u0{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(XP,t,i)}static fromTypedArray(t,i){return new XP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}XP.ElementType="i8";class YP extends h0{constructor(t,i=0,r,s){super(Int8Array,t,i,r,s),this.elementType="i8"}slice(t,i){return this.sliceBuffer(YP,t,i)}static fromTypedArray(t,i){return new YP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}YP.ElementType="i8";class QP extends l0{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(QP,t,i)}static fromTypedArray(t,i){return new QP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}QP.ElementType="i16";class Xx extends c0{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(Xx,t,i)}static fromTypedArray(t,i){return new Xx(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}Xx.ElementType="i16";class JP extends u0{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(JP,t,i)}static fromTypedArray(t,i){return new JP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}JP.ElementType="i16";class KP extends h0{constructor(t,i=0,r,s){super(Int16Array,t,i,r,s),this.elementType="i16"}slice(t,i){return this.sliceBuffer(KP,t,i)}static fromTypedArray(t,i){return new KP(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}KP.ElementType="i16";class e3 extends l0{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(e3,t,i)}static fromTypedArray(t,i){return new e3(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}e3.ElementType="i32";class t3 extends c0{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(t3,t,i)}static fromTypedArray(t,i){return new t3(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}t3.ElementType="i32";class i3 extends u0{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(i3,t,i)}static fromTypedArray(t,i){return new i3(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}i3.ElementType="i32";class r3 extends h0{constructor(t,i=0,r,s){super(Int32Array,t,i,r,s),this.elementType="i32"}slice(t,i){return this.sliceBuffer(r3,t,i)}static fromTypedArray(t,i){return new r3(t.buffer,t.byteOffset,i,t.byteOffset+t.byteLength)}}r3.ElementType="i32";function cbe(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function wWe(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function xWe(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function TWe(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}class E5{constructor(t,i){this.layout=t,this.buffer=typeof i=="number"?new ArrayBuffer(i*t.stride):i;for(const r of t.fieldNames){const s=t.fields.get(r);this[r]=new s.constructor(this.buffer,s.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,i){const r=this[t];return r&&r.elementCount===i.ElementCount&&r.elementType===i.ElementType?r:null}slice(t,i){return new E5(this.layout,this.buffer.slice(t*this.stride,i*this.stride))}copyFrom(t,i,r,s){const n=this.stride;if(n%4==0){const o=new Uint32Array(t.buffer,i*n,s*n/4);new Uint32Array(this.buffer,r*n,s*n/4).set(o)}else{const o=new Uint8Array(t.buffer,i*n,s*n);new Uint8Array(this.buffer,r*n,s*n).set(o)}}}class LQ{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(t,i){return this._appendField(t,bd,i),this}vec2f64(t,i){return this._appendField(t,pC,i),this}vec3f(t,i){return this._appendField(t,hr,i),this}vec3f64(t,i){return this._appendField(t,Ws,i),this}vec4f(t,i){return this._appendField(t,fo,i),this}vec4f64(t,i){return this._appendField(t,Gx,i),this}mat3f(t,i){return this._appendField(t,Jp,i),this}mat3f64(t,i){return this._appendField(t,o1,i),this}mat4f(t,i){return this._appendField(t,hC,i),this}mat4f64(t,i){return this._appendField(t,a1,i),this}vec4u8(t,i){return this._appendField(t,tc,i),this}f32(t,i){return this._appendField(t,cI,i),this}f64(t,i){return this._appendField(t,dC,i),this}u8(t,i){return this._appendField(t,Qy,i),this}u16(t,i){return this._appendField(t,Hx,i),this}i8(t,i){return this._appendField(t,gC,i),this}vec2i8(t,i){return this._appendField(t,Zx,i),this}vec2i16(t,i){return this._appendField(t,Xx,i),this}vec2u8(t,i){return this._appendField(t,jx,i),this}vec4u16(t,i){return this._appendField(t,c1,i),this}u32(t,i){return this._appendField(t,Wx,i),this}_appendField(t,i,r){const s=i.ElementCount*cbe(i.ElementType),n=this.stride;this.fields.set(t,{size:s,constructor:i,offset:n,optional:r}),this.stride+=s,this.fieldNames.push(t)}alignTo(t){return this.stride=Math.floor((this.stride+t-1)/t)*t,this}hasField(t){return this.fieldNames.includes(t)}createBuffer(t){return new E5(this,t)}createView(t){return new E5(this,t)}clone(){const t=new LQ;return t.stride=this.stride,t.fields=new Map,this.fields.forEach((i,r)=>t.fields.set(r,i)),t.fieldNames=this.fieldNames.slice(),t.BufferType=this.BufferType,t}}function As(){return new LQ}var zq;(function(e){function t(o,a){const l=o[a],c=o[a+1],h=o[a+2];return Math.sqrt(l*l+c*c+h*h)}function i(o,a){const l=o[a],c=o[a+1],h=o[a+2],p=1/Math.sqrt(l*l+c*c+h*h);o[a]*=p,o[a+1]*=p,o[a+2]*=p}function r(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function s(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]+l[c],h[p+1]=o[a+1]+l[c+1],h[p+2]=o[a+2]+l[c+2]}function n(o,a,l,c,h,p=a){(h=h||o)[p]=o[a]-l[c],h[p+1]=o[a+1]-l[c+1],h[p+2]=o[a+2]-l[c+2]}e.length=t,e.normalize=i,e.scale=r,e.add=s,e.subtract=n})(zq||(zq={}));const Da=di();class SWe{constructor(t){this.message=t}toString(){return`AssertException: ${this.message}`}}function At(e,t){if(!e)throw t=t||"assert",console.log(new Error(t).stack),new SWe(t)}function XT(e,t){e||(t=t||"",console.warn("Verify failed: "+t+`
`+new Error("verify").stack))}function nne(e,t,i,r){let s,n=(i[0]-e[0])/t[0],o=(r[0]-e[0])/t[0];n>o&&(s=n,n=o,o=s);let a=(i[1]-e[1])/t[1],l=(r[1]-e[1])/t[1];if(a>l&&(s=a,a=l,l=s),n>l||a>o)return!1;a>n&&(n=a),l<o&&(o=l);let c=(i[2]-e[2])/t[2],h=(r[2]-e[2])/t[2];return c>h&&(s=c,c=h,h=s),!(n>h||c>o)&&(h<o&&(o=h),!(o<0))}function h$(e,t,i,r,s,n=yt()){const o=(r[s]-i[s])*(t[0]-e[0])-(r[0]-i[0])*(t[s]-e[s]),a=(r[0]-i[0])*(e[s]-i[s])-(r[s]-i[s])*(e[0]-i[0]);if(o===0)return!1;const l=a/o;return n[0]=e[0]+l*(t[0]-e[0]),n[1]=e[s]+l*(t[s]-e[s]),!0}function one(e,t,i,r,s){s||(s=e),Da[0]=e[0],Da[1]=e[1],Da[2]=e[2],Da[3]=1,zu(Da,Da,t),s.length>2&&(s[2]=-Da[2]),zu(Da,Da,i),At(Da[3]!==0),s[0]=Da[0]/Da[3],s[1]=Da[1]/Da[3],s[2]=Da[2]/Da[3],s[0]=(.5*s[0]+.5)*r[2]+r[0],s[1]=(.5*s[1]+.5)*r[3]+r[1]}function EWe(e,t){return Math.log(e)/Math.log(t)}function ube(e,t,i,r){e[12]=t,e[13]=i,e[14]=r}function hbe(e){return e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[15]===1}function CWe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}function AWe(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}function OWe(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}function RWe(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}class KU{constructor(t,i,r,s){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.indices=r,this.position=s,this.center=F(),At(t.length>=1),At(r.length%this._numIndexPerPrimitive==0),At(r.length>=t.length*this._numIndexPerPrimitive),At(s.size===3||s.size===4);const{data:n,size:o}=s,a=t.length;let l=o*r[this._numIndexPerPrimitive*t[0]];Q1.clear(),Q1.push(l),this.bbMin=Ke(n[l],n[l+1],n[l+2]),this.bbMax=un(this.bbMin);for(let h=0;h<a;++h){const p=this._numIndexPerPrimitive*t[h];for(let m=0;m<this._numIndexPerPrimitive;++m){l=o*r[p+m],Q1.push(l);let g=n[l];this.bbMin[0]=Math.min(g,this.bbMin[0]),this.bbMax[0]=Math.max(g,this.bbMax[0]),g=n[l+1],this.bbMin[1]=Math.min(g,this.bbMin[1]),this.bbMax[1]=Math.max(g,this.bbMax[1]),g=n[l+2],this.bbMin[2]=Math.min(g,this.bbMin[2]),this.bbMax[2]=Math.max(g,this.bbMax[2])}}Nn(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let c=this.radius*this.radius;for(let h=0;h<Q1.length;++h){l=Q1.getItemAt(h);const p=n[l]-this.center[0],m=n[l+1]-this.center[1],g=n[l+2]-this.center[2],v=p*p+m*m+g*g;if(v<=c)continue;const b=Math.sqrt(v),S=.5*(b-this.radius);this.radius=this.radius+S,c=this.radius*this.radius;const T=S/b;this.center[0]+=p*T,this.center[1]+=m*T,this.center[2]+=g*T}Q1.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if(Yn(this.bbMin,this.bbMax)>1){const t=Nn(F(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,r=new Uint8Array(i),s=new Array(8);for(let c=0;c<8;++c)s[c]=0;const{data:n,size:o}=this.position;for(let c=0;c<i;++c){let h=0;const p=this._numIndexPerPrimitive*this.primitiveIndices[c];let m=o*this.indices[p],g=n[m],v=n[m+1],b=n[m+2];for(let S=1;S<this._numIndexPerPrimitive;++S){m=o*this.indices[p+S];const T=n[m],O=n[m+1],C=n[m+2];T<g&&(g=T),O<v&&(v=O),C<b&&(b=C)}g<t[0]&&(h|=1),v<t[1]&&(h|=2),b<t[2]&&(h|=4),r[c]=h,++s[h]}let a=0;for(let c=0;c<8;++c)s[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=s[c]>0?new Uint32Array(s[c]):void 0;for(let c=0;c<8;++c)s[c]=0;for(let c=0;c<i;++c){const h=r[c];l[h][s[h]++]=this.primitiveIndices[c]}this._children=new Array(8);for(let c=0;c<8;++c)l[c]!==void 0&&(this._children[c]=new KU(l[c],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){Q1.prune()}}const Q1=new hi({deallocator:null});class uI{constructor(){this.id=Gl()}unload(){}}var Kp;(function(e){e[e.Layer=0]="Layer",e[e.Object=1]="Object",e[e.Geometry=2]="Geometry",e[e.Material=3]="Material",e[e.Texture=4]="Texture",e[e.COUNT=5]="COUNT"})(Kp||(Kp={}));function ane(e,t,i){const r=t[0]-e[0],s=t[1]-e[1],n=i[0]-e[0],o=i[1]-e[1];return .5*Math.abs(r*o-s*n)}function MWe(e,t,i){return Me(F6,t,e),Me(lne,i,e),He(St(F6,F6,lne))/2}new r0(Gm);new r0(()=>({p0:null,p1:null,p2:null}));const F6=F(),lne=F();let iv=(()=>{const e=new Uint32Array(131072);for(let t=0;t<e.length;++t)e[t]=t;return e})();const dbe=new Uint16Array([0]),C5=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function yC(e){if(e===1)return dbe;if(e<C5.length)return new Uint16Array(C5.buffer,0,e);if(e>iv.length){const t=Math.max(2*iv.length,e);iv=new Uint32Array(t);for(let i=0;i<iv.length;i++)iv[i]=i}return new Uint32Array(iv.buffer,0,e)}function xbt(e){if(e===1)return new Uint16Array(dbe);if(e<C5.length)return new Uint16Array(C5.slice(0,e));if(e>iv.length){const t=new Uint32Array(e);for(let i=0;i<t.length;i++)t[i]=i;return t}return new Uint32Array(iv.slice(0,e))}function pbe(e,t,i){if(!e)return!1;const{size:r,data:s}=e;fe(i,0,0,0),fe(Wh,0,0,0);let n=0,o=0;for(let a=0;a<t.length-2;a+=3){const l=t[a+0]*r,c=t[a+1]*r,h=t[a+2]*r;fe(ao,s[l+0],s[l+1],s[l+2]),fe(vy,s[c+0],s[c+1],s[c+2]),fe(d$,s[h+0],s[h+1],s[h+2]);const p=MWe(ao,vy,d$);p?(Oe(ao,ao,vy),Oe(ao,ao,d$),be(ao,ao,1/3*p),Oe(i,i,ao),n+=p):(Oe(Wh,Wh,ao),Oe(Wh,Wh,vy),Oe(Wh,Wh,d$),o+=3)}return(o!==0||n!==0)&&(n!==0?(be(i,i,1/n),!0):o!==0&&(be(i,Wh,1/o),!0))}function fbe(e,t,i){if(!e||!t)return!1;const{size:r,data:s}=e;fe(i,0,0,0);let n=-1,o=0;for(let a=0;a<t.length;a++){const l=t[a]*r;n!==l&&(i[0]+=s[l+0],i[1]+=s[l+1],i[2]+=s[l+2],o++),n=l}return o>1&&be(i,i,1/o),o>0}function $Q(e,t,i,r){if(!e)return!1;const{size:s,data:n}=e;fe(r,0,0,0),fe(Wh,0,0,0);let o=0,a=0;const l=t?t.length-1:n.length/s-1,c=l+(i?2:0);for(let h=0;h<c;h+=2){const p=h<l?h:l,m=h<l?h+1:0,g=(t?t[p]:p)*s,v=(t?t[m]:m)*s;ao[0]=n[g+0],ao[1]=n[g+1],ao[2]=n[g+2],vy[0]=n[v+0],vy[1]=n[v+1],vy[2]=n[v+2],be(ao,Oe(ao,ao,vy),.5);const b=yZ(ao,vy);b>0?(Oe(r,r,be(ao,ao,b)),o+=b):(Oe(Wh,Wh,ao),a++)}return o!==0?(be(r,r,1/o),!0):a!==0&&(be(r,Wh,1/a),!0)}const ao=F(),vy=F(),d$=F(),Wh=F();class ss extends uI{constructor(t,i=[],r=Zl.Triangle,s=-1){super(),this._primitiveType=r,this.edgeIndicesLength=s,this.type=Kp.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[n,o]of t)o&&this._vertexAttributes.set(n,{...o});if(i==null||i.length===0){const n=PWe(this._vertexAttributes),o=yC(n);this.edgeIndicesLength=this.edgeIndicesLength<0?n:this.edgeIndicesLength;for(const a of this._vertexAttributes.keys())this._indices.set(a,o)}else for(const[n,o]of i)o&&(this._indices.set(n,IWe(o)),n===D.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(n).length:this.edgeIndicesLength))}cloneShallow(){const t=new ss([],void 0,this._primitiveType,void 0),{_vertexAttributes:i,_indices:r}=t;return this._vertexAttributes.forEach((s,n)=>{i.set(n,s)}),this._indices.forEach((s,n)=>{r.set(n,s)}),t.screenToWorldRatio=this.screenToWorldRatio,t._boundingInfo=this._boundingInfo,t}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(t){const i=this._vertexAttributes.get(t);return i&&!i.exclusive&&(i.data=Array.from(i.data),i.exclusive=!0),i}get indices(){return this._indices}get indexCount(){const t=this._indices.values().next().value;return t?t.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return N(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return this.primitiveType===Zl.Triangle?this._computeAttachmentOriginTriangles(t):this._computeAttachmentOriginPoints(t)}_computeAttachmentOriginTriangles(t){const i=this.indices.get(D.POSITION),r=this.vertexAttributes.get(D.POSITION);return pbe(r,i,t)}_computeAttachmentOriginPoints(t){const i=this.indices.get(D.POSITION),r=this.vertexAttributes.get(D.POSITION);return fbe(r,i,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.indices.get(D.POSITION);if(t.length===0)return null;const i=this.primitiveType===Zl.Triangle?3:1;At(t.length%i==0,"Indexing error: "+t.length+" not divisible by "+i);const r=yC(t.length/i),s=this.vertexAttributes.get(D.POSITION);return new KU(r,i,t,s)}}function PWe(e){const t=e.values().next().value;return t==null?0:t.data.length/t.size}function IWe(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const t of e)if(t>=65536)return e;return new Uint16Array(e)}const YT=zq;var k6,U6,z6,Bq;(function(e){const i=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],r=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],s=[0,0,1,0,1,1,0,1],n=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),o=new Uint16Array(36);for(let c=0;c<6;c++)for(let h=0;h<6;h++)o[6*c+h]=c;const a=new Uint16Array(36);for(let c=0;c<6;c++)a[6*c+0]=0,a[6*c+1]=1,a[6*c+2]=2,a[6*c+3]=2,a[6*c+4]=3,a[6*c+5]=0;function l(c){Array.isArray(c)||(c=[c,c,c]);const h=new Array(24);for(let p=0;p<8;p++)h[3*p]=i[p][0]*c[0],h[3*p+1]=i[p][1]*c[1],h[3*p+2]=i[p][2]*c[2];return new ss([[D.POSITION,{size:3,data:h,exclusive:!0}],[D.NORMAL,{size:3,data:r}],[D.UV0,{size:2,data:s}]],[[D.POSITION,n],[D.NORMAL,o],[D.UV0,a]])}e.createGeometry=l})(k6||(k6={})),function(e){const i=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],r=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],s=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),n=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);function o(a){Array.isArray(a)||(a=[a,a,a]);const l=new Array(18);for(let c=0;c<6;c++)l[3*c]=i[c][0]*a[0],l[3*c+1]=i[c][1]*a[1],l[3*c+2]=i[c][2]*a[2];return new ss([[D.POSITION,{size:3,data:l,exclusive:!0}],[D.NORMAL,{size:3,data:r}]],[[D.POSITION,s],[D.NORMAL,n]])}e.createGeometry=o}(U6||(U6={})),function(e){const r=Ki(-.5,0,-.5),s=Ki(.5,0,-.5),n=Ki(0,0,.5),o=Ki(0,0+.5,0),a=Wi(),l=Wi(),c=Wi(),h=Wi(),p=Wi();Me(a,r,o),Me(l,r,s),St(c,a,l),De(c,c),Me(a,s,o),Me(l,s,n),St(h,a,l),De(h,h),Me(a,n,o),Me(l,n,r),St(p,a,l),De(p,p);const m=[r,s,n,o],g=[0,-1,0,c[0],c[1],c[2],h[0],h[1],h[2],p[0],p[1],p[2]],v=[0,1,2,3,1,0,3,2,1,3,0,2],b=[0,0,0,1,1,1,2,2,2,3,3,3];function S(T){Array.isArray(T)||(T=[T,T,T]);const O=new Array(12);for(let C=0;C<4;C++)O[3*C]=m[C][0]*T[0],O[3*C+1]=m[C][1]*T[1],O[3*C+2]=m[C][2]*T[2];return new ss([[D.POSITION,{size:3,data:O,exclusive:!0}],[D.NORMAL,{size:3,data:g}]],[[D.POSITION,new Uint16Array(v)],[D.NORMAL,new Uint16Array(b)]])}e.createGeometry=S}(z6||(z6={})),function(e){function t(C,M,I,$={uv:!0}){const U=-Math.PI,q=2*Math.PI,G=-Math.PI/2,Y=Math.PI,J=Math.max(3,Math.floor(M)),X=Math.max(2,Math.floor(I)),ne=(J+1)*(X+1),re=new Float32Array(3*ne),ye=new Float32Array(3*ne),pe=new Float32Array(2*ne),z=[];let j=0;for(let le=0;le<=X;le++){const K=[],ae=le/X,we=G+ae*Y,Re=Math.cos(we);for(let Ge=0;Ge<=J;Ge++){const Pe=Ge/J,Se=U+Pe*q,$e=Math.cos(Se)*Re,qe=Math.sin(we),jt=-Math.sin(Se)*Re;re[3*j]=$e*C,re[3*j+1]=qe*C,re[3*j+2]=jt*C,ye[3*j]=$e,ye[3*j+1]=qe,ye[3*j+2]=jt,pe[2*j]=Pe,pe[2*j+1]=ae,K.push(j),++j}z.push(K)}const Q=new Uint32Array(2*J*(X-1)*3);j=0;for(let le=0;le<X;le++)for(let K=0;K<J;K++){const ae=z[le][K],we=z[le][K+1],Re=z[le+1][K+1],Ge=z[le+1][K];le===0?(Q[j++]=ae,Q[j++]=Re,Q[j++]=Ge):le===X-1?(Q[j++]=ae,Q[j++]=we,Q[j++]=Re):(Q[j++]=ae,Q[j++]=we,Q[j++]=Re,Q[j++]=Re,Q[j++]=Ge,Q[j++]=ae)}const Z=[[D.POSITION,Q],[D.NORMAL,Q]],ie=[[D.POSITION,{size:3,data:re,exclusive:!0}],[D.NORMAL,{size:3,data:ye,exclusive:!0}]];return $.uv&&(ie.push([D.UV0,{size:2,data:pe,exclusive:!0}]),Z.push([D.UV0,Q])),$.offset&&(Z[0][0]=D.OFFSET,ie[0][0]=D.OFFSET,Z.push([D.POSITION,new Uint32Array(Q.length)]),ie.push([D.POSITION,{size:3,data:Float64Array.from($.offset),exclusive:!0}])),new ss(ie,Z)}function i(C,M,I){const $=C;let U,q;if(I)U=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],q=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const re=$*(1+Math.sqrt(5))/2;U=[-$,re,0,$,re,0,-$,-re,0,$,-re,0,0,-$,re,0,$,re,0,-$,-re,0,$,-re,re,0,-$,re,0,$,-re,0,-$,-re,0,$],q=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let re=0;re<U.length;re+=3)YT.scale(U,re,C/YT.length(U,re));let G={};function Y(re,ye){re>ye&&([re,ye]=[ye,re]);const pe=re.toString()+"."+ye.toString();if(G[pe])return G[pe];let z=U.length;return U.length+=3,YT.add(U,3*re,U,3*ye,U,z),YT.scale(U,z,C/YT.length(U,z)),z/=3,G[pe]=z,z}for(let re=0;re<M;re++){const ye=q.length,pe=new Uint32Array(4*ye);for(let z=0;z<ye;z+=3){const j=q[z],Q=q[z+1],Z=q[z+2],ie=Y(j,Q),le=Y(Q,Z),K=Y(Z,j),ae=4*z;pe[ae]=j,pe[ae+1]=ie,pe[ae+2]=K,pe[ae+3]=Q,pe[ae+4]=le,pe[ae+5]=ie,pe[ae+6]=Z,pe[ae+7]=K,pe[ae+8]=le,pe[ae+9]=ie,pe[ae+10]=le,pe[ae+11]=K}q=pe,G={}}const J=new Float32Array(U);for(let re=0;re<J.length;re+=3)YT.normalize(J,re);const X=[[D.POSITION,q],[D.NORMAL,q]],ne=[[D.POSITION,{size:3,data:new Float32Array(U),exclusive:!0}],[D.NORMAL,{size:3,data:J,exclusive:!0}]];return new ss(ne,X)}function r(C,M,I,$,U,q,G){const Y=M?[M[0],M[1],M[2]]:[0,0,0],J=C?[C[0],C[1],C[2]]:[0,0,1];q=q||[0,0];const X=I?[255*I[0],255*I[1],255*I[2],I.length>3?255*I[3]:255]:[255,255,255,255],ne=$!=null&&$.length===2?$:[1,1],re=[[D.POSITION,{size:3,data:Y,exclusive:!0}],[D.NORMAL,{size:3,data:J,exclusive:!0}],[D.UV0,{size:q.length,data:q}],[D.COLOR,{size:4,data:X,exclusive:!0}],[D.SIZE,{size:2,data:ne}]];if(U!=null){const ye=new Float32Array([U[0],U[1],U[2],U[3]]);re.push([D.AUXPOS1,{size:4,data:ye}])}if(G!=null){const ye=new Float32Array([G[0],G[1],G[2],G[3]]);re.push([D.AUXPOS2,{size:4,data:ye}])}return new ss(re,null,Zl.Point)}function s(C,M,I,$,U,q,G,Y){if(C!=null){const{data:J}=Y.getMutableAttribute(D.NORMAL);J[0]=C[0],J[1]=C[1],J[2]=C[2]}if(M!=null){const{data:J}=Y.getMutableAttribute(D.POSITION);J[0]=M[0],J[1]=M[1],J[2]=M[2]}if(I!=null){const{data:J}=Y.getMutableAttribute(D.COLOR);J[0]=I[0],J[1]=I[1],J[2]=I[2],J[3]=I[3]}if($!=null){const{data:J}=Y.getMutableAttribute(D.SIZE);J[0]=$[0],J[1]=$[1]}if(U!=null){const{data:J}=Y.getMutableAttribute(D.AUXPOS1);J[0]=U[0],J[1]=U[1],J[2]=U[2],J[3]=U[3]}if(q!=null){const{data:J}=Y.getMutableAttribute(D.UV0);J[0]=q[0],J[1]=q[1]}if(G!=null){const{data:J}=Y.getMutableAttribute(D.AUXPOS2);J[0]=G[0],J[1]=G[1],J[2]=G[2],J[3]=G[3]}}function n(C,M){const I=new Float32Array(3*C.length),$=new Float32Array(M?3*C.length:3),U=new Uint32Array(C.length),q=new Uint32Array(C.length);for(let X=0;X<C.length;X++)I[3*X]=C[X][0],I[3*X+1]=C[X][1],I[3*X+2]=C[X][2],M&&($[3*X]=M[X][0],$[3*X+1]=M[X][1],$[3*X+2]=M[X][2]),U[X]=X,q[X]=0;M||($[0]=0,$[1]=1,$[2]=0);const G=[0,0],Y=[[D.POSITION,U],[D.NORMAL,M?U:q],[D.UV0,q]],J=[[D.POSITION,{size:3,data:I,exclusive:!0}],[D.NORMAL,{size:3,data:$,exclusive:!0}],[D.UV0,{size:2,data:G,exclusive:!0}]];return new ss(J,Y,Zl.Point)}function o(){const C=[0,0,0,0,0,100,100,0,0],M=new Uint16Array([0,1,2]),I=[0,1,0],$=new Uint16Array([0,0,0]),U=[0,0],q=new Uint16Array([0,0,0]),G=[[D.POSITION,M],[D.NORMAL,$],[D.UV0,q]],Y=[[D.POSITION,{size:3,data:C,exclusive:!0}],[D.NORMAL,{size:3,data:I,exclusive:!0}],[D.UV0,{size:2,data:U,exclusive:!0}]];return new ss(Y,G)}e.createBoxGeometry=k6.createGeometry,e.createDiamondGeometry=U6.createGeometry,e.createTetrahedronGeometry=z6.createGeometry,e.createSphereGeometry=t,e.createPolySphereGeometry=i,e.createPointGeometry=r,e.updatePointGeometry=s,e.createPointArrayGeometry=n,e.createTriangleGeometry=o;const a=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function l(C=a){const M=new Array(12);for(let X=0;X<4;X++)for(let ne=0;ne<3;ne++)M[3*X+ne]=C[X][ne];const I=new Uint32Array([0,1,2,2,3,0]),$=[0,0,1],U=new Uint32Array([0,0,0,0,0,0]),q=[0,0,1,0,1,1,0,1],G=[255,255,255,255],Y=[[D.POSITION,I],[D.NORMAL,U],[D.UV0,I],[D.COLOR,U]],J=[[D.POSITION,{size:3,data:M,exclusive:!0}],[D.NORMAL,{size:3,data:$,exclusive:!0}],[D.UV0,{size:2,data:q,exclusive:!0}],[D.COLOR,{size:4,data:G,exclusive:!0}]];return new ss(J,Y)}function c(C,M,I,$,U=!0,q=!0){let G=0;const Y=M,J=C;let X=Ki(0,G,0),ne=Ki(0,G+J,0),re=Ki(0,-1,0),ye=Ki(0,1,0);$&&(G=J,ne=Ki(0,0,0),X=Ki(0,G,0),re=Ki(0,1,0),ye=Ki(0,-1,0));const pe=[ne,X],z=[re,ye],j=I+2,Q=Math.sqrt(J*J+Y*Y);if($)for(let Pe=I-1;Pe>=0;Pe--){const Se=Pe*(2*Math.PI/I),$e=Ki(Math.cos(Se)*Y,G,Math.sin(Se)*Y);pe.push($e);const qe=Ki(J*Math.cos(Se)/Q,-Y/Q,J*Math.sin(Se)/Q);z.push(qe)}else for(let Pe=0;Pe<I;Pe++){const Se=Pe*(2*Math.PI/I),$e=Ki(Math.cos(Se)*Y,G,Math.sin(Se)*Y);pe.push($e);const qe=Ki(J*Math.cos(Se)/Q,Y/Q,J*Math.sin(Se)/Q);z.push(qe)}const Z=new Uint32Array(2*(I+2)*3),ie=new Uint32Array(2*(I+2)*3);let le=0,K=0;if(U){for(let Pe=3;Pe<pe.length;Pe++)Z[le++]=1,Z[le++]=Pe-1,Z[le++]=Pe,ie[K++]=0,ie[K++]=0,ie[K++]=0;Z[le++]=pe.length-1,Z[le++]=2,Z[le++]=1,ie[K++]=0,ie[K++]=0,ie[K++]=0}if(q){for(let Pe=3;Pe<pe.length;Pe++)Z[le++]=Pe,Z[le++]=Pe-1,Z[le++]=0,ie[K++]=Pe,ie[K++]=Pe-1,ie[K++]=1;Z[le++]=0,Z[le++]=2,Z[le++]=pe.length-1,ie[K++]=1,ie[K++]=2,ie[K++]=z.length-1}const ae=new Float32Array(3*j);for(let Pe=0;Pe<j;Pe++)ae[3*Pe]=pe[Pe][0],ae[3*Pe+1]=pe[Pe][1],ae[3*Pe+2]=pe[Pe][2];const we=new Float32Array(3*j);for(let Pe=0;Pe<j;Pe++)we[3*Pe]=z[Pe][0],we[3*Pe+1]=z[Pe][1],we[3*Pe+2]=z[Pe][2];const Re=[[D.POSITION,Z],[D.NORMAL,ie]],Ge=[[D.POSITION,{size:3,data:ae,exclusive:!0}],[D.NORMAL,{size:3,data:we,exclusive:!0}]];return new ss(Ge,Re)}function h(C,M,I,$,U,q){const G=$?x5($):Ki(1,0,0),Y=U?x5(U):Ki(0,0,0);q=q==null||q;const J=Wi();De(J,G);const X=Wi();be(X,J,Math.abs(C));const ne=Wi();be(ne,X,-.5),Oe(ne,ne,Y);const re=Ki(0,1,0);Math.abs(1-ke(J,re))<.2&&fe(re,0,0,1);const ye=Wi();St(ye,J,re),De(ye,ye),St(re,ye,J);const pe=2*I+(q?2:0),z=I+(q?2:0),j=new Float32Array(3*pe),Q=new Float32Array(3*z),Z=new Float32Array(2*pe),ie=new Uint32Array(3*I*(q?4:2)),le=new Uint32Array(3*I*(q?4:2));q&&(j[3*(pe-2)+0]=ne[0],j[3*(pe-2)+1]=ne[1],j[3*(pe-2)+2]=ne[2],Z[2*(pe-2)]=0,Z[2*(pe-2)+1]=0,j[3*(pe-1)+0]=j[3*(pe-2)+0]+X[0],j[3*(pe-1)+1]=j[3*(pe-2)+1]+X[1],j[3*(pe-1)+2]=j[3*(pe-2)+2]+X[2],Z[2*(pe-1)]=1,Z[2*(pe-1)+1]=1,Q[3*(z-2)+0]=-J[0],Q[3*(z-2)+1]=-J[1],Q[3*(z-2)+2]=-J[2],Q[3*(z-1)+0]=J[0],Q[3*(z-1)+1]=J[1],Q[3*(z-1)+2]=J[2]);const K=(Se,$e,qe)=>{ie[Se]=$e,le[Se]=qe};let ae=0;const we=Wi(),Re=Wi();for(let Se=0;Se<I;Se++){const $e=Se*(2*Math.PI/I);be(we,re,Math.sin($e)),be(Re,ye,Math.cos($e)),Oe(we,we,Re),Q[3*Se+0]=we[0],Q[3*Se+1]=we[1],Q[3*Se+2]=we[2],be(we,we,M),Oe(we,we,ne),j[3*Se+0]=we[0],j[3*Se+1]=we[1],j[3*Se+2]=we[2],Z[2*Se+0]=Se/I,Z[2*Se+1]=0,j[3*(Se+I)+0]=j[3*Se+0]+X[0],j[3*(Se+I)+1]=j[3*Se+1]+X[1],j[3*(Se+I)+2]=j[3*Se+2]+X[2],Z[2*(Se+I)+0]=Se/I,Z[2*Se+1]=1;const qe=(Se+1)%I;K(ae++,Se,Se),K(ae++,Se+I,Se),K(ae++,qe,qe),K(ae++,qe,qe),K(ae++,Se+I,Se),K(ae++,qe+I,qe)}if(q){for(let Se=0;Se<I;Se++){const $e=(Se+1)%I;K(ae++,pe-2,z-2),K(ae++,Se,z-2),K(ae++,$e,z-2)}for(let Se=0;Se<I;Se++){const $e=(Se+1)%I;K(ae++,Se+I,z-1),K(ae++,pe-1,z-1),K(ae++,$e+I,z-1)}}const Ge=[[D.POSITION,ie],[D.NORMAL,le],[D.UV0,ie]],Pe=[[D.POSITION,{size:3,data:j,exclusive:!0}],[D.NORMAL,{size:3,data:Q,exclusive:!0}],[D.UV0,{size:2,data:Z,exclusive:!0}]];return new ss(Pe,Ge)}function p(C,M,I,$,U){I=I||10,$=$==null||$,At(C.length>1);const q=[[0,0,0]],G=[],Y=[];for(let J=0;J<I;J++){G.push([0,-J-1,-(J+1)%I-1]);const X=J/I*2*Math.PI;Y.push([Math.cos(X)*M,Math.sin(X)*M])}return e.createPathExtrusionGeometry(Y,C,q,G,$,U)}function m(C,M,I,$,U,q=Ki(0,0,0)){const G=C.length,Y=new Float32Array(M.length*G*3+(6*I.length||0)),J=new Float32Array(M.length*G*3+(I?6:0)),X=(M.length-1)*G*6+3*$.length*2,ne=new Uint32Array(X),re=new Uint32Array(X);let ye=0,pe=0,z=0,j=0;const Q=Wi(),Z=Wi(),ie=Wi(),le=Wi(),K=Wi(),ae=Wi(),we=Wi(),Re=F(),Ge=Wi(),Pe=Wi(),Se=Wi(),$e=Wi(),qe=Wi(),jt=Vi();fe(Ge,0,1,0),Me(Z,M[1],M[0]),De(Z,Z),U?(Oe(Re,M[0],q),De(ie,Re)):fe(ie,0,0,1),O(Z,ie,Ge,Ge,K,ie,cne),ve(le,ie),ve($e,K);for(let Je=0;Je<I.length;Je++)be(ae,K,I[Je][0]),be(Re,ie,I[Je][2]),Oe(ae,ae,Re),Oe(ae,ae,M[0]),Y[ye++]=ae[0],Y[ye++]=ae[1],Y[ye++]=ae[2];J[pe++]=-Z[0],J[pe++]=-Z[1],J[pe++]=-Z[2];for(let Je=0;Je<$.length;Je++)ne[z++]=$[Je][0]>0?$[Je][0]:-$[Je][0]-1+I.length,ne[z++]=$[Je][1]>0?$[Je][1]:-$[Je][1]-1+I.length,ne[z++]=$[Je][2]>0?$[Je][2]:-$[Je][2]-1+I.length,re[j++]=0,re[j++]=0,re[j++]=0;let Ti=I.length;const li=I.length-1;for(let Je=0;Je<M.length;Je++){let ti=!1;Je>0&&(ve(Q,Z),Je<M.length-1?(Me(Z,M[Je+1],M[Je]),De(Z,Z)):ti=!0,Oe(Pe,Q,Z),De(Pe,Pe),Oe(Se,M[Je-1],le),ZE(M[Je],Pe,jt),gT(jt,sh(Se,Q),Re)?(Me(Re,Re,M[Je]),De(ie,Re),St(K,Pe,ie),De(K,K)):O(Pe,le,$e,Ge,K,ie,cne),ve(le,ie),ve($e,K)),U&&(Oe(Re,M[Je],q),De(qe,Re));for(let Os=0;Os<G;Os++)if(be(ae,K,C[Os][0]),be(Re,ie,C[Os][1]),Oe(ae,ae,Re),De(we,ae),J[pe++]=we[0],J[pe++]=we[1],J[pe++]=we[2],Oe(ae,ae,M[Je]),Y[ye++]=ae[0],Y[ye++]=ae[1],Y[ye++]=ae[2],!ti){const Zs=(Os+1)%G;ne[z++]=Ti+Os,ne[z++]=Ti+G+Os,ne[z++]=Ti+Zs,ne[z++]=Ti+Zs,ne[z++]=Ti+G+Os,ne[z++]=Ti+G+Zs;for(let Dr=0;Dr<6;Dr++)re[j++]=ne[z-6+Dr]-li}Ti+=G}const Pi=M[M.length-1];for(let Je=0;Je<I.length;Je++)be(ae,K,I[Je][0]),be(Re,ie,I[Je][1]),Oe(ae,ae,Re),Oe(ae,ae,Pi),Y[ye++]=ae[0],Y[ye++]=ae[1],Y[ye++]=ae[2];const ct=pe/3;J[pe++]=Z[0],J[pe++]=Z[1],J[pe++]=Z[2];const Kt=Ti-G;for(let Je=0;Je<$.length;Je++)ne[z++]=$[Je][0]>=0?Ti+$[Je][0]:-$[Je][0]-1+Kt,ne[z++]=$[Je][2]>=0?Ti+$[Je][2]:-$[Je][2]-1+Kt,ne[z++]=$[Je][1]>=0?Ti+$[Je][1]:-$[Je][1]-1+Kt,re[j++]=ct,re[j++]=ct,re[j++]=ct;const Fi=[[D.POSITION,ne],[D.NORMAL,re]],pr=[[D.POSITION,{size:3,data:Y,exclusive:!0}],[D.NORMAL,{size:3,data:J,exclusive:!0}]];return new ss(pr,Fi)}function g(C,M,I){At(C.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),At(C[0].length===3,"createPolylineGeometry(): malformed vertex"),At(M==null||M.length===C.length,"createPolylineGeometry: need same number of points and normals"),At(M==null||M[0].length===3,"createPolylineGeometry(): malformed normal");const $=new Float64Array(3*C.length),U=new Uint32Array(2*(C.length-1));let q=0,G=0;for(let X=0;X<C.length;X++){for(let ne=0;ne<3;ne++)$[q++]=C[X][ne];X>0&&(U[G++]=X-1,U[G++]=X)}const Y=[],J=[];if(Y.push([D.POSITION,U]),J.push([D.POSITION,{size:3,data:$,exclusive:!0}]),M){const X=new Float32Array(3*M.length);let ne=0;for(let re=0;re<C.length;re++)for(let ye=0;ye<3;ye++)X[ne++]=M[re][ye];Y.push([D.NORMAL,U]),J.push([D.NORMAL,{size:3,data:X,exclusive:!0}])}return I&&(J.push([D.COLOR,{size:4,data:I}]),Y.push([D.COLOR,yC(I.length/4)])),new ss(J,Y,Zl.Line)}function v(C,M,I,$,U=0){const q=new Array(18),G=[[-M,U,$/2],[I,U,$/2],[0,C+U,$/2],[-M,U,-$/2],[I,U,-$/2],[0,C+U,-$/2]],Y=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let J=0;J<6;J++)q[3*J]=G[J][0],q[3*J+1]=G[J][1],q[3*J+2]=G[J][2];return new ss([[D.POSITION,{size:3,data:q,exclusive:!0}]],[[D.POSITION,Y]])}function b(C,M){const I=C.getMutableAttribute(D.POSITION).data;for(let $=0;$<I.length;$+=3){const U=I[$],q=I[$+1],G=I[$+2];fe(QT,U,q,G),et(QT,QT,M),I[$]=QT[0],I[$+1]=QT[1],I[$+2]=QT[2]}}function S(C,M=C){const I=C.vertexAttributes,$=I.get(D.POSITION).data,U=I.get(D.NORMAL).data;if(U){const q=M.getMutableAttribute(D.NORMAL).data;for(let G=0;G<U.length;G+=3){const Y=U[G+1];q[G+1]=-U[G+2],q[G+2]=Y}}if($){const q=M.getMutableAttribute(D.POSITION).data;for(let G=0;G<$.length;G+=3){const Y=$[G+1];q[G+1]=-$[G+2],q[G+2]=Y}}return M}function T(C,M,I,$,U){return!(Math.abs(ke(M,C))>U)&&(St(I,C,M),De(I,I),St($,I,C),De($,$),!0)}function O(C,M,I,$,U,q,G){return T(C,M,U,q,G)||T(C,I,U,q,G)||T(C,$,U,q,G)}e.createSquareGeometry=l,e.createConeGeometry=c,e.createCylinderGeometry=h,e.createTubeGeometry=p,e.createPathExtrusionGeometry=m,e.createPolylineGeometry=g,e.createExtrudedTriangle=v,e.transformInPlace=b,e.cgToGIS=S,e.makeOrthoBasisDirUp=T,e.makeOrthoBasisDirUpFallback=O}(Bq||(Bq={}));const cne=.99619469809,QT=Wi(),Sc=Bq,LWe=Ie.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class $We{constructor(){this.type="panoramic",this._techniqueConfig=new S5,this._passParameters=new MQ,this._readyResolver=Gp(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=ht(this._passParameters.texture),this._vao=ht(this._vao),this._readyController=fd(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(t){this._techniqueConfig.geometry=$m.Cylinder,this._technique=t.shaderTechniqueRepository.acquire(uC,this._techniqueConfig);const i=t.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=na(this._vao,"geometry"),Qp(lbe,{signal:this._readyController.signal}).then(r=>{this._passParameters.texture=new bt(i,{pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0},r),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(r=>{Cs(r)||LWe.error("Unable to initialize atmosphere: image request failed",r),this._readyResolver.reject()})}get canRender(){return this._passParameters.texture!=null}render(t){const i=t.rctx,r=i.bindTechnique(this._technique,this._passParameters,t.bindParameters);DWe(une,t.bindParameters.camera.viewMatrix),r.setUniformMatrix4fv("view",une),i.bindVAO(this._vao),r.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Yt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(t){const i=Sc.createPolySphereGeometry(1,2,!1),r=i.indices.get(D.POSITION);for(let a=0;a<r.length;a+=3){const l=r[a];r[a]=r[a+2],r[a+2]=l}const s=i.vertexAttributes.get(D.POSITION).data,n=hne.createBuffer(r.length),o=n.position;for(let a=0;a<r.length;++a){const l=3*r[a];o.set(a,0,s[l]),o.set(a,1,s[l+1]),o.set(a,2,s[l+2])}return new pn(t,or,{geometry:Yc(hne)},{geometry:Ai.createVertex(t,Gi.STATIC_DRAW,n.buffer)})}}function DWe(e,t){js(e,t),e[12]=0,e[13]=0,e[14]=0,e[15]=1}const une=Be(),hne=As().vec3f(D.POSITION);var u1;(function(e){e[e.Rain=0]="Rain",e[e.Snow=1]="Snow",e[e.COUNT=2]="COUNT"})(u1||(u1={}));class Vq extends pl{constructor(){super(...arguments),this.type=u1.Rain}}u([ee({count:u1.COUNT})],Vq.prototype,"type",void 0);function NWe(e){const t=new dr;return t.attributes.add(D.POSITION,"vec3"),t.attributes.add(D.INSTANCEFEATUREATTRIBUTE,"float"),t.vertex.uniforms.add(new Vl("cameraPosition")),t.vertex.uniforms.add(new Vl("offset")),t.vertex.uniforms.add(new rr("width")),t.vertex.uniforms.add(new Hr("proj",(i,r)=>r.camera.projectionMatrix)),t.vertex.uniforms.add(new n1("view")),t.vertex.uniforms.add(new rr("time")),t.varyings.add("vUv","vec2"),t.vertex.code.add(E`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===u1.Rain?E`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:E`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),t.fragment.uniforms.add(new rr("opacity")),t.fragment.uniforms.add(new Vl("particleColor")),t.fragment.code.add(E`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===u1.Rain?E`d = 0.35 * smoothstep(0.5, 0.0, d);`:E`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),t}const FWe=Object.freeze(Object.defineProperty({__proto__:null,build:NWe},Symbol.toStringTag,{value:"Module"}));class kWe extends mn{constructor(){super(...arguments),this.time=0,this.radius=1}}class xy extends $r{initializeProgram(t){const i=xy.shader.get().build(this.configuration);return new Sr(t.rctx,i,xy.attributeLocation)}initializePipeline(){return ni({blending:Bo(je.ONE,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:wi})}}xy.shader=new Tr(FWe,()=>_e(()=>import("./Precipitation.glsl.a9842c6f.js"),[],import.meta.url)),xy.attributeLocation=new Map([[D.POSITION,0],[D.INSTANCEFEATUREATTRIBUTE,1]]);class mbe{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance(t){return w(t.forcedTime)?this._time!==t.forcedTime&&(this._time=t.forcedTime,!0):!(!this.enabled||t.dt===0)&&(this._time+=t.dt,!0)}}let ow=class extends ze{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=F(),this._tile=F(),this._particleColor=Wi(),this._particleColorAtNight=Wi(),this._nightMultiplier=.7,this._cameraDirection=Wi(),this._renderParameters=new kWe,this._animation=new mbe,this._updatingTracking=new _m,this._renderParameters.time=0,this._renderParameters.radius=ji(e.view.spatialReference).radius,this._shaderTechniqueRepository=e.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=vr(this._snowTechnique),this._rainTechnique=vr(this._rainTechnique),this._vao=ht(this._vao),this._instanceIdBuffer=ht(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if(N(this._rainTechnique)){const e=new Vq;e.type=u1.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(xy,e)}return this._rainTechnique}get snowTechnique(){if(N(this._snowTechnique)){const e=new Vq;e.type=u1.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(xy,e)}return this._snowTechnique}update(e){return this._animation.advance(e)}render(e,t,i){const r=i==="rainy",s=r?this.rainTechnique:this.snowTechnique;if(!s.compiled)return void this.context.requestRender();const n=e.rctx;if(this._ensureResources(n),N(s)||N(this._vao)||N(this._instanceIdBuffer)||(w(e.bindParameters.clouds.data)&&(this._opacity=1-e.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;const o=.35;t=t<.5?fi(0,o,2*t):fi(o,1,2*(t-.5));const a=n.bindTechnique(s);this._renderParameters.camera=e.bindParameters.camera,this._renderParameters.time=(r?this._rainSpeed:this._snowSpeed)*cZ(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(a,i,e),n.bindVAO(this._vao);const l=xy.attributeLocation;a.assertCompatibleVertexAttributeLocations(this._vao),hQ(n,l,this._instanceIdBuffer,dne,0),n.capabilities.instancing.drawArraysInstanced(Yt.TRIANGLES,0,3,this._numParticles*t),dQ(n,l,this._instanceIdBuffer,dne)}_update(e,t,i){const r=i.bindParameters.camera,s=r.eye;this._tile[0]=Math.floor((s[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((s[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((s[2]+.5*this._width)/this._width),this._offset[0]=s[0]-this._tile[0]*this._width,this._offset[1]=s[1]-this._tile[1]*this._width,this._offset[2]=s[2]-this._tile[2]*this._width,e.setUniform1f("width",this._width),e.setUniform3fv("offset",this._offset),e.setUniformMatrix4fv("view",r.viewMatrix),e.setUniform3fv("cameraPosition",s),e.bindPass(null,i.bindParameters),e.setUniform1f("time",this._renderParameters.time),t==="rainy"?fe(this._particleColor,.85,.85,.85):fe(this._particleColor,1,1,1),be(this._particleColorAtNight,this._particleColor,this._nightMultiplier),De(this._cameraDirection,s);const n=Math.max(0,ke(this._cameraDirection,i.bindParameters.lighting.lightingMainDirection));Nn(this._particleColor,this._particleColorAtNight,this._particleColor,n),e.setUniform3fv("particleColor",this._particleColor),e.setUniform1f("opacity",this._opacity)}_ensureResources(e){N(this._vao)&&(this._vao=this._createVertexArrayObject(e)),N(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const t=[];for(let i=0;i<this._numParticles;i++)t.push(i);return Ai.createVertex(e,Gi.STATIC_DRAW,new Float32Array(t))}_createVertexArrayObject(e){const t=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new pn(e,xy.attributeLocation,{geometry:Yc(UWe)},{geometry:Ai.createVertex(e,Gi.STATIC_DRAW,t)})}};u([f({constructOnly:!0})],ow.prototype,"context",void 0),u([f({constructOnly:!0})],ow.prototype,"view",void 0),u([f({readOnly:!0})],ow.prototype,"updating",null),u([f()],ow.prototype,"_updatingTracking",void 0),ow=u([B("esri.views.3d.environment.Precipitation")],ow);const UWe=As().vec3f(D.POSITION),dne=Yc(As().f32(D.INSTANCEFEATUREATTRIBUTE),1),zWe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==",BWe=Ie.getLogger("esri.views.3d.environment.SimpleAtmosphere"),p$=128,pne=-$q,fne=0,B6=50,VWe=()=>1-511/512,GWe=DN([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class jWe{constructor(t){this.view=t,this.type="simple",this._renderData={texV:yt(),silCircleCenter:F(),silCircleV1:F(),silCircleV2:F(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new MQ,this._fadeVaoCount=0,this._readyResolver=Gp(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=km(t.spatialReference);const i=ji(t.spatialReference);this.planetRadius=i.radius,this.outerRimWidth=i.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+pne)/this.planetRadius,this.middleRimFactor=(this.planetRadius+fne)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=fne/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=Ln(this._cameraChangeHandle),this._passParameters.texture=ht(this._passParameters.texture),this._fadeVao=ht(this._fadeVao),this._vao=ht(this._vao),this._readyController=fd(this._readyController)}when(){return this._readyResolver.promise}async initializeRenderContext(t){this._shaderTechniqueRepository=t.shaderTechniqueRepository;const i=t.renderContext.rctx;this._cameraChangeHandle=xe(()=>{var n;return(n=this.view.state)==null?void 0:n.camera},()=>t.requestRender(),an),this._vao=this._createRibbon(i),this._vaoCount=na(this._vao,"geometry"),this._fadeVao=fl(i),this._fadeVaoCount=na(this._fadeVao,"geometry");const r=this.isOnMars?zWe:lbe,s=this._readyController.signal;try{const n=await Qp(r,{signal:s});Ui(s),this._passParameters.texture=new bt(i,{pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0},n),t.requestRender(),this._readyController=null,this._readyResolver.resolve()}catch(n){Cs(n)||BWe.error("Unable to initialize simple atmosphere: image request failed",n),this._readyResolver.reject(n)}}get coneTechnique(){if(N(this._coneTechnique)){const t=new S5;t.geometry=$m.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(uC,t)}return this._coneTechnique}get undergroundTechnique(){if(N(this._undergroundTechnique)){const t=new S5;t.geometry=$m.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(uC,t)}return this._undergroundTechnique}render(t){const i=t.bindParameters.camera;this._update(i);const r=t.rctx;if(this._renderData.undergroundFadeAlpha<1){const s=r.bindTechnique(this.coneTechnique,this._passParameters,t.bindParameters);s.setUniformMatrix4fv("proj",i.projectionMatrix),s.setUniformMatrix4fv("view",i.viewMatrix),s.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),s.setUniform3fv("silCircleV1",this._renderData.silCircleV1),s.setUniform3fv("silCircleV2",this._renderData.silCircleV2),s.setUniform2fv("texV",this._renderData.texV),s.setUniform1f("altitudeFade",this._renderData.altitudeFade),s.setUniform1f("innerScale",this._renderData.innerScale),r.bindVAO(this._vao),r.drawArrays(Yt.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const s=r.bindTechnique(this.undergroundTechnique,this._passParameters,t.bindParameters);s.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),s.setUniform3fv("cameraPosition",i.eye),r.bindVAO(this._fadeVao),r.drawArrays(Yt.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(t){const i=F(),r=this.planetRadius,s=He(t.eye),n=s-r;if(n<0){const g=Math.min(-n/5e3,1);this._renderData.undergroundFadeAlpha=g}else this._renderData.undergroundFadeAlpha=0;const o=Math.max(B6,n),a=r+pne;this._renderData.innerScale=HWe(r+o,r,a)-1,this._renderData.altitudeFade=g1e(n),be(i,t.eye,(r+B6)/s),mne(i,t.center,t.up,r,this._renderData);const l=this._computeScreenRimWidth(t,i,t.up,this._renderData),c=VWe(),h=GWe(n);let p=this.texV0+c*this.texVScale,m=this.texV0+l*h*this.texVScale;if(n>B6){mne(t.eye,t.center,t.up,r,this._renderData);const g=this._computeScreenRimWidth(t,t.eye,t.up,this._renderData),v=Xe((g-1.5)/(l-1.5),0,1);p=this.texV0+v*c*this.texVScale,m=this.texV0+fi(this.texV1,l*h,v)*this.texVScale}Di(this._renderData.texV,p,m)}_createRibbon(t){const i=new Float32Array(3+3*p$*3),r=new Uint32Array(3*p$*5);i[0]=0,i[1]=0,i[2]=-1;for(let o=0;o<p$;o++){const a=9*o+3;i[a+0]=o,i[a+1]=this.innerRimFactor,i[a+2]=-1,i[a+3]=o,i[a+4]=this.middleRimFactor,i[a+5]=0,i[a+6]=o,i[a+7]=this.outerRimFactor,i[a+8]=1;const l=3*o+1,c=o===p$-1?1:l+3,h=15*o;r[h+0]=l,r[h+1]=l+1,r[h+2]=c+1,r[h+3]=c+1,r[h+4]=c,r[h+5]=l,r[h+6]=l+1,r[h+7]=l+2,r[h+8]=c+2,r[h+9]=c+2,r[h+10]=c+1,r[h+11]=l+1,r[h+12]=l,r[h+13]=c,r[h+14]=0}const s=gne.createBuffer(r.length),n=s.position;for(let o=0;o<r.length;++o){const a=3*r[o];n.set(o,0,i[a]),n.set(o,1,i[a+1]),n.set(o,2,i[a+2])}return new pn(t,or,{geometry:Yc(gne)},{geometry:Ai.createVertex(t,Gi.STATIC_DRAW,s.buffer)})}_computeScreenRimWidth(t,i,r,s){return Oe(nO,s.silCircleCenter,s.silCircleV2),be(G6,nO,this.outerRimFactor),oU(V6,i,nO,r),one(nO,V6,t.projectionMatrix,t.viewport),one(G6,V6,t.projectionMatrix,t.viewport),Pr(nO,G6)/t.height}}function mne(e,t,i,r,s){const n=He(e),o=r*Math.sqrt(n*n-r*r)/n,a=Math.sqrt(r*r-o*o),l=s.silCircleV1,c=s.silCircleV2;return be(s.silCircleCenter,e,a/n),St(l,e,t),rl(l)<1&&St(l,e,i),be(l,l,o/He(l)),St(c,l,e),be(c,c,o/He(c)),o}const V6=Be(),nO=F(),G6=F();function HWe(e,t,i){return e*e/(Math.sqrt(e*e-t*t)*Math.sqrt(e*e-i*i)+t*i)}const gne=As().vec3f(D.POSITION);function DQ(e){const t=E`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,i=E`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;e.vertex.code.add(t),e.vertex.code.add(i),e.fragment.code.add(t),e.fragment.code.add(i)}function qWe(){const e=new dr;return e.attributes.add(D.POSITION,"vec3"),e.attributes.add(D.COLOR,"vec4"),e.attributes.add(D.SIZE,"float"),e.varyings.add("vcolor","vec4"),e.varyings.add("vsize","float"),e.vertex.uniforms.add([new Hr("transform",(t,i)=>WWe(t,i)),new Ci("viewport",(t,i)=>i.camera.fullViewport),new lt("pixelRatio",(t,i)=>i.camera.pixelRatio)]),e.include(DQ),e.vertex.code.add(E`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),e.fragment.code.add(E`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),e}function WWe(e,t){return js(V0,t.camera.projectionMatrix),V0[10]=24e-8-1,V0[11]=-1,V0[14]=(24e-8-2)*t.camera.near,hs(V0,V0,t.camera.viewMatrix),hs(V0,V0,e.modelMatrix)}const V0=Be(),ZWe=Object.freeze(Object.defineProperty({__proto__:null,build:qWe},Symbol.toStringTag,{value:"Module"}));class XWe extends mn{constructor(){super(...arguments),this.modelMatrix=Be()}}class ez extends $r{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=ez.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),depthTest:{func:kr.LEQUAL},colorWrite:wi})}}ez.shader=new Tr(ZWe,()=>_e(()=>import("./Stars.glsl.67641427.js"),[],import.meta.url));const YWe=Ie.getLogger("esri.views.3d.environment.Stars");let H_=class extends ze{constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new XWe,this._updatingTracking=new _m}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return w(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=fd(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=vr(this._technique),this._vao=ht(this._vao)}render(e){const{rctx:t}=e;if(this._ensureResources(t),N(this._technique)||N(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const i=t.bindTechnique(this._technique,this._renderParameter,e.bindParameters);t.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),t.drawArrays(Yt.POINTS,0,this._numPoints)}_ensureResources(e){if(w(this._technique)||N(JT))return;this._technique=new ez({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=JT.byteLength/yne;const t=new Float32Array(JT,0,2*this._numPoints),i=new Uint8Array(JT,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,t,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type==="sun"?this.view.environment.lighting.date:null,r=>this._update(r),si)}_computeDayDuration(e){const t=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+t-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const t=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),r=js(this._renderParameter.modelMatrix,KWe);jE(r,r,-i*Math.PI),hs(r,JWe,r),jE(r,r,-t*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,t,i,r){const s=_ne.createBuffer(r),n=s.position,o=s.color,a=s.size;for(let l=0;l<r;l++){const c=t[2*l+0],h=t[2*l+1];n.set(l,0,-Math.cos(c)*Math.sin(h)),n.set(l,1,-Math.sin(c)*Math.sin(h)),n.set(l,2,-Math.cos(h));const p=this._unpackUint8Attributes(i[l]),m=this._hexToRGB(QWe[p[1]]);o.set(l,0,255*m[0]),o.set(l,1,255*m[1]),o.set(l,2,255*m[2]),o.set(l,3,255),a.set(l,p[0])}return new pn(e,or,{geometry:Yc(_ne)},{geometry:Ai.createVertex(e,Gi.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(w(JT))return null;const e=k3(async t=>{const{data:i}=await q3e("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:t});this._verifyStarData(i),JT=i});return e.promise.catch(t=>{Cs(t)||YWe.error(t)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new se("stars:no-data-received","Failed to create stars because star catalogue is missing");const t=e.byteLength/yne;if(t%1!=0||t>5e4||t<5e3)throw new se("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};u([f({constructOnly:!0})],H_.prototype,"view",void 0),u([f({constructOnly:!0})],H_.prototype,"requestRender",void 0),u([f({readOnly:!0})],H_.prototype,"updating",null),u([f()],H_.prototype,"_loadDataTask",void 0),u([f()],H_.prototype,"_updatingTracking",void 0),H_=u([B("esri.views.3d.environment.Stars")],H_);const QWe=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],JWe=PX(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),KWe=PX(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),yne=9,_ne=As().vec3f(D.POSITION).vec4u8(D.COLOR).f32(D.SIZE);let JT=null;var nt;(function(e){e[e.MATERIAL=0]="MATERIAL",e[e.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",e[e.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",e[e.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",e[e.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",e[e.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",e[e.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",e[e.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"})(nt||(nt={}));var JR;const eZe=[Ue.POSTPROCESSING_ENVIRONMENT_OPAQUE,Ue.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let vne,ja=JR=class extends ze{constructor(e){super(e),this._handles=new xi,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(eZe,this)}destroy(){var e;this._pendingAtmosphere=Tt(this._pendingAtmosphere),((e=this.view)==null?void 0:e._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._handles=Tt(this._handles),this._set("view",null)}get atmosphereType(){return w(this._pendingAtmosphere)?this._pendingAtmosphere.type:w(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var e;return!!((e=this.view.basemapTerrain)!=null&&e.renderer.canRender)||this.view.viewingMode!=="global"}get needsLinearDepth(){return this._selectAtmosphereType()==="realistic"}updateAnimation(e){return!!w(this._precipitation)&&this._precipitation.update(e)}get updating(){return w(this._pendingAtmosphere)||w(this._stars)&&this._stars.updating||w(this._clouds)&&this._clouds.running}get weatherVisible(){return He(this.view.state.camera.eye)-ji(this.view.spatialReference).radius<=Yh}get _stars(){var r,s;const e=this.view,t=(s=(r=e.environment)==null?void 0:r.starsEnabled)!=null?s:!1,i=this._get("_stars");return!t||N(this._context)?(Tt(i),null):w(i)?i:new H_({view:e,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const e=this._get("_precipitation");if(!this._precipitationEnabled||N(this._context))return Tt(e),null;const t=this.view,i=this._context;return w(e)&&e.context===i?e:(Tt(e),new ow({context:i,view:t}))}get _clouds(){const e=this._get("_clouds");if(!this.weatherEnabled||N(this._context))return Tt(e),null;if(w(e))return e;const t=this.view,i=this._context;return Tt(e),new Ga({context:i,view:t,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const e=this._get("_cloudsComposition");if(!this.weatherEnabled||N(this._context))return Tt(e),null;const t=this.view.state.viewingMode,i=this._context.renderContext.rctx,r=ji(this.view.spatialReference).radius;return w(e)&&e.viewingMode===t&&e.planetRadius===r?e:(Tt(e),new nw({rctx:i,viewingMode:t,planetRadius:r,requestRender:()=>this._setNeedsRender()}))}get _fog(){const e=this._get("_fog");if(!this.weatherEnabled||N(this._context))return Tt(e),null;if(w(e))return e;const t=this.view,i=this._context;return Tt(e),new QR({context:i,view:t})}get weatherEnabled(){var e,t;return!!((t=(e=this.view)==null?void 0:e.environmentManager)!=null&&t.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(e=null){this._context=e,this._handles.add([Jl(()=>{var t;return(t=this.view)==null?void 0:t.basemapTerrain},()=>this._updateBasemapTerrain(),an),xe(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),an),xe(()=>this._stars,()=>this._setNeedsRender()),xe(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),si),xe(()=>this._precipitation,()=>this._setNeedsRender()),xe(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),si),xe(()=>this._weatherUpdateParameters,t=>{this._updateWeather(t),this._updateFog(t)},an)])}uninitializeRenderContext(){this._context=null,this._atmosphere=Tt(this._atmosphere),this._set("_stars",Tt(this._stars)),this._set("_precipitation",Tt(this._precipitation)),this._set("_clouds",Tt(this._clouds)),this._set("_cloudsComposition",Tt(this._cloudsComposition)),this._set("_fog",Tt(this._fog))}prepareRender(e){e.bindParameters.clouds.data=uqe(this._clouds)?this._clouds:null}render(e){if(e.pass===nt.MATERIAL)switch(e.bindParameters.slot){case Ue.POSTPROCESSING_ENVIRONMENT_OPAQUE:w(this._stars)&&this._stars.render(e),w(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(e),w(this._cloudsComposition)&&w(e.bindParameters.clouds.data)&&(this.weatherVisible&&w(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(e,w(this.view.animation))));break;case Ue.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(w(this._atmosphere)&&this._atmosphere.canRender){const t=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(e,t==="rainy"),w(this._fog)){const i=t==="foggy"||t==="rainy"||t==="snowy";(i||this._selectAtmosphereType()!=="realistic")&&this._fog.render(e,i,t==="rainy")}if(w(this._precipitation)){const i=this.view.environment.weather;i.type!=="rainy"&&i.type!=="snowy"||this._precipitation.render(e,i.precipitation,i.type)}}}}get _weatherUpdateParameters(){const e=this.weatherEnabled?this.view.environment.weather:null;return N(e)?null:e.type==="rainy"||e.type==="snowy"?{type:e.type,weatherAdjustment:e.cloudCover,effect:e.precipitation}:{type:e.type,weatherAdjustment:e.type==="foggy"?e.fogStrength:e.cloudCover}}_updateWeather(e){N(e)||N(this._clouds)||(this._clouds.applyPreset(tbe[e.type],e.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){w(this._context)&&this._context.requestRender()}_updateFog(e){if(!N(this._fog)&&!N(e))switch(e.type){case"foggy":this._fog.strength=fi(3e-5,.005,e.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=fi(4e-6,2e-4,e.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const e=this._selectAtmosphereType();if(this.atmosphereType===e)return;w(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const t=this._getAtmosphereClass();if(!t)return w(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const i=new t(this.view);w(this._context)&&i.initializeRenderContext(this._context),N(this._atmosphere)&&(this._atmosphere=i,this._setNeedsRender()),this._pendingAtmosphere=i,i.when().then(()=>{w(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===i&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return Zse;case"panoramic":return $We;case"simple":return jWe;default:return}}_selectAtmosphereType(){const e=this.view.get("environment.atmosphereEnabled"),t=this.view.get("environment.atmosphere.quality"),i=this.view.viewingMode;return!e||t==null||Um(this.view.spatialReference)?"none":i==="local"?"panoramic":t==="high"&&w(this._context)&&Zse.isSupported(this._context)&&uP(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=w(this._atmosphere)&&this.atmosphereType==="simple")}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:e=>{vne=JR.prototype._getAtmosphereClass,JR.prototype._getAtmosphereClass=e},restoreGetAtmosphereClass:()=>{JR.prototype._getAtmosphereClass=vne}}}};u([f({constructOnly:!0})],ja.prototype,"view",void 0),u([f({type:Boolean,readOnly:!0})],ja.prototype,"updating",null),u([f({readOnly:!0})],ja.prototype,"weatherVisible",null),u([f()],ja.prototype,"_context",void 0),u([f()],ja.prototype,"_pendingAtmosphere",void 0),u([f({readOnly:!0})],ja.prototype,"_stars",null),u([f({readOnly:!0})],ja.prototype,"_precipitation",null),u([f({readOnly:!0})],ja.prototype,"_clouds",null),u([f({readOnly:!0})],ja.prototype,"_cloudsComposition",null),u([f({readOnly:!0})],ja.prototype,"_fog",null),u([f({readOnly:!0})],ja.prototype,"weatherEnabled",null),u([f({readOnly:!0})],ja.prototype,"_precipitationEnabled",null),u([f({readOnly:!0})],ja.prototype,"_weatherUpdateParameters",null),ja=JR=u([B("esri.views.3d.environment.EnvironmentRenderer")],ja);function bne(e,t,i){return tZe(e,t.longitude,t.latitude,i.longitude,i.latitude)}function tZe(e,t,i,r,s){const n=Jt(i),o=Jt(s),a=n-o,l=Jt(t)-Jt(r),c=Math.sin(a/2),h=Math.sin(l/2),p=2*Hp(Math.sqrt(c*c+Math.cos(n)*Math.cos(o)*h*h))*e;return Math.round(1e4*p)/1e4}function iZe(e,t,i){const r=t.spatialReference,s=ji(r),n=new xt(t.x,e.y,r),o=new xt(i.x,e.y,r),a=new xt(e.x,t.y,r),l=new xt(e.x,i.y,r);return{lon:bne(s.radius,n,o),lat:bne(s.radius,a,l)}}function rZe(e,t,i){const r=t/i,s=Jt(e),n=Math.sin(r/2),o=Math.cos(s),a=2*Hp(Math.sqrt(n*n/(o*o)));return Vc(a)}function sZe(e,t){let i=e/15;return t||(i=Math.round(i)),i}function wne(e,t){t||(t={hours:0,minutes:0,seconds:0}),t.hours=sZe(e[0],!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const r=t.minutes%1;return t.minutes-=r,t.seconds=Math.round(60*r),t}var xne,Tne,Sne,gbe={exports:{}};xne=gbe,Tne=function(){var e=Math.PI,t=Math.sin,i=Math.cos,r=Math.tan,s=Math.asin,n=Math.atan2,o=Math.acos,a=e/180,l=864e5,c=2440588,h=2451545,p={dec:0,ra:0};function m(z){return z.valueOf()/l-.5+c}function g(z){return new Date((z+.5-c)*l)}function v(z){return m(z)-h}var b=23.4397*a;function S(z,j){return n(t(z)*i(b)-r(j)*t(b),i(z))}function T(z,j){return s(t(j)*i(b)+i(j)*t(b)*t(z))}function O(z,j,Q){return n(t(z),i(z)*t(j)-r(Q)*i(j))}function C(z,j,Q){return s(t(j)*t(Q)+i(j)*i(Q)*i(z))}function M(z,j){return a*(280.16+360.9856235*z)-j}function I(z){return a*(357.5291+.98560028*z)}function $(z){return a*(1.9148*t(z)+.02*t(2*z)+3e-4*t(3*z))}function U(z,j){return z+j+102.9372*a+e}function q(z,j){var Q=I(z),Z=U(Q,$(Q));return j||(j={dec:0,ra:0}),j.dec=T(Z,0),j.ra=S(Z,0),j}var G={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(z,j,Q,Z){var ie=a*-Q,le=a*j,K=v(z),ae=q(K,p),we=M(K,ie)-ae.ra;return Z||(Z={azimuth:0,altitude:0}),Z.azimuth=O(we,le,ae.dec),Z.altitude=C(we,le,ae.dec),Z}},Y=[[-.83,"sunrise","sunset"]];G.addTime=function(z,j,Q){Y.push([z,j,Q])};var J=9e-4;function X(z,j){return Math.round(z-J-j/(2*e))}function ne(z,j,Q){return J+(z+j)/(2*e)+Q}function re(z,j,Q){return h+z+.0053*t(j)-.0069*t(2*Q)}function ye(z,j,Q){return o((t(z)-t(j)*t(Q))/(i(j)*i(Q)))}function pe(z){var j=a*(134.963+13.064993*z),Q=a*(93.272+13.22935*z),Z=a*(218.316+13.176396*z)+6.289*a*t(j),ie=5.128*a*t(Q),le=385001-20905*i(j);return{ra:S(Z,ie),dec:T(Z,ie),dist:le}}return G.getTimes=function(z,j,Q){var Z=a*-Q,ie=a*j,le=X(v(z),Z),K=ne(0,Z,le),ae=I(K),we=$(ae),Re=U(ae,we),Ge=T(Re,0),Pe=re(K,ae,Re);function Se(Kt){return re(ne(ye(Kt,ie,Ge),Z,le),ae,Re)}function $e(Kt){var Fi=(t(Kt)-t(ie)*t(Ge))/(i(ie)*i(Ge));return Fi<-1?G.PolarException.MIDNIGHT_SUN:Fi>1?G.PolarException.POLAR_NIGHT:G.PolarException.NORMAL}var qe,jt,Ti,li,Pi,ct={solarNoon:g(Pe),nadir:g(Pe-.5),polarException:G.PolarException.NORMAL};for(qe=0,jt=Y.length;qe<jt;qe+=1)Pi=Pe-((li=Se((Ti=Y[qe])[0]*a))-Pe),ct[Ti[1]]=g(Pi),ct[Ti[2]]=g(li);return ct.polarException=$e(Y[0][0]*a),ct},G.getMoonPosition=function(z,j,Q){var Z=a*-Q,ie=a*j,le=v(z),K=pe(le),ae=M(le,Z)-K.ra,we=C(ae,ie,K.dec);return we+=.017*a/r(we+10.26*a/(we+5.1*a)),{azimuth:O(ae,ie,K.dec),altitude:we,distance:K.dist}},G.getMoonFraction=function(z){var j=v(z),Q=q(j),Z=pe(j),ie=149598e3,le=o(t(Q.dec)*t(Z.dec)+i(Q.dec)*i(Z.dec)*i(Q.ra-Z.ra)),K=n(ie*t(le),Z.dist-ie*i(le));return(1+i(K))/2},G},(Sne=Tne())!==void 0&&(xne.exports=Sne);const Yx=gbe.exports,sm={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function nZe(e,t,i,r,s,n,o){fe(o.ambient.color,1,1,1),o.ambient.intensity=sm.global.ambient,fe(o.direct.color,1,1,1),o.direct.intensity=sm.global.direct;const a=t[2],l=Xe((Math.abs(a)-sm.local.altitude)/(sm.global.altitude-sm.local.altitude),0,1);let c;if(o.globalFactor=l,n==="sun"&&(c=Yx.getTimes(e,t[1],t[0])),l<1){let h;if(n==="sun")h=pZe(e,c,r);else{const p=_be(r);h={direct:{intensity:sm.local.directAtNoon*p.direct,color:Ke(1,1,1)},ambient:{intensity:sm.local.ambientAtNoon*p.ambient,color:Ke(1,1,1)},timeOfDay:"early afternoon"}}Nn(o.ambient.color,h.ambient.color,o.ambient.color,l),o.ambient.intensity=fi(h.ambient.intensity,o.ambient.intensity,l),Nn(o.direct.color,h.direct.color,o.direct.color,l),o.direct.intensity=fi(h.direct.intensity,o.direct.intensity,l),o.specularStrength=r==="rainy"||r==="snowy"||r==="foggy"?0:1,o.environmentStrength=r==="rainy"?.7:r==="snowy"||r==="foggy"?.75:1}o.noonFactor=n==="sun"?dZe(e,c):1,n==="sun"?aZe(e,t,i,o.direct.directionToLightSource):oZe(s,i,o.direct.directionToLightSource)}function oZe(e,t,i){t===st.Global?De(j6,e.eye):fe(j6,0,0,1),be(H6,e.viewForward,-1);const r=$N(H6,j6),s=Math.max(r-2*q6,0),n=.85*s/(s+1),o=Math.max(q6,r-q6-n);ih(Cne,-o,e.viewRight),et(i,H6,Cne),Oe(i,i,be(fZe,e.viewRight,mZe)),De(i,i)}function aZe(e,t,i,r){const s=hZe,n=Im(uZe);if(i===st.Global)Yx.getPosition(e,0,0,s),fe(r,0,0,-1),GE(n,n,-s.azimuth),sU(n,n,-s.altitude),et(r,r,n);else{const o=sm.planarDirection,a=o.globalAngles,l=t[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Xe(c,0,1),c<1?(Yx.getPosition(e,t[1],t[0],s),s.azimuth=(1-c)*s.azimuth+c*a.azimuth,s.altitude=(1-c)*s.altitude+c*a.altitude):(s.azimuth=a.azimuth,s.altitude=a.altitude),fe(r,0,-1,0),jE(n,n,-s.azimuth),GE(n,n,-s.altitude),et(r,r,n)}}function lZe(e,t){if(t===st.Global)return!0;const i=sm.planarDirection;return Math.abs(e)<i.localAltitude}const cZe=Ke(.5773502691896258,-.5773502691896258,.5773502691896258);class ybe{constructor(){this.ambient={color:Ke(1,1,1),intensity:.55},this.direct={color:Ke(1,1,1),intensity:.55,directionToLightSource:un(cZe)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const uZe=Be(),hZe={azimuth:0,altitude:0};function dZe(e,t){const i=e.valueOf();let r,s;t.polarException===Yx.PolarException.MIDNIGHT_SUN?(r=i-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,s=r+432e6):t.polarException===Yx.PolarException.POLAR_NIGHT?(r=i-2,s=i-1):(r=t.sunrise.valueOf(),s=t.sunset.valueOf());const n=r+(s-r)/2;return 1-Xe(Math.abs(i-n)/432e5,0,1)}function _be(e){switch(e){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function Ene(e,t){const i=(e[0]+e[1]+e[2])/3;for(let r=0;r<3;r++)e[r]=e[r]+(i-e[r])*t;return e}function pZe(e,t,i){const r=e.valueOf();let s,n;t.polarException===Yx.PolarException.MIDNIGHT_SUN?(s=r-60*(e.getHours()+48)*60*1e3-60*e.getMinutes()*1e3,n=s+432e6):t.polarException===Yx.PolarException.POLAR_NIGHT?(s=r-2,n=r-1):(s=t.sunrise.valueOf(),n=t.sunset.valueOf());const o=n-s,a=s+o/2,l=o/4,c=a-l,h=a+l,p=.06*o,m=s-p/2,g=s+p/2,v=n-p/2,b=n+p/2,S=sm.local,T=[.01,S.ambientAtNight],O=[.8,.8,1],C=[.01,.01,.01],M=[S.directAtTwilight,S.ambientAtTwilight],I=[1,.6,.5],$=[.8,.8,1],U=[.9*S.directAtNoon,S.ambientAtNoon],q=[1,.98,.98],G=[.98,.98,1],Y=[S.directAtNoon,S.ambientAtNoon],J=[1,1,1],X=[1,1,1],ne=U,re=q,ye=G,pe=M,z=I,j=$;let Q,Z,ie=[0,0],le=[0,0,0],K=[0,0,0];r<m||r>b?(ie=T,le=C,K=O,Z="night"):r<g?(Q=g-m,ie=Ho(r-m,Q,T,M),le=Ho(r-m,Q,C,I),K=Ho(r-m,Q,O,$),Z="sun rising"):r<c?(Q=c-g,ie=Ho(r-g,Q,M,U),le=Ho(r-g,Q,I,q),K=Ho(r-g,Q,$,G),Z="early morning"):r<a?(Q=a-c,ie=Ho(r-c,Q,U,Y),le=Ho(r-c,Q,q,J),K=Ho(r-c,Q,G,X),Z="late morning"):r<h?(Q=h-a,ie=Ho(r-a,Q,Y,ne),le=Ho(r-a,Q,J,re),K=Ho(r-a,Q,X,ye),Z="early afternoon"):r<v?(Q=v-h,ie=Ho(r-h,Q,ne,pe),le=Ho(r-h,Q,re,z),K=Ho(r-h,Q,ye,j),Z="late afternoon"):r<b&&(Q=b-v,ie=Ho(r-v,Q,pe,T),le=Ho(r-v,Q,z,C),K=Ho(r-v,Q,j,O),Z="sun setting");let ae=0;switch(i){case"rainy":case"foggy":ae=.9;case"snowy":ae=.5}ae>0&&(le=Ene(le,ae),K=Ene(K,ae));const we=Ke(le[0],le[1],le[2]),Re=Ke(K[0],K[1],K[2]),Ge=_be(i);return{direct:{intensity:ie[0]*Ge.direct,color:we},ambient:{intensity:ie[1]*Ge.ambient,color:Re},timeOfDay:Z}}function Ho(e,t,i,r){const s=[];for(let n=0;n<i.length;n++)s[n]=(r[n]-i[n])*e/t+i[n];return s}const Cne=Be(),j6=F(),H6=F(),fZe=F(),q6=.25,mZe=.2;let op=class extends ks.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new xi,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new Fq,this._ambientLight=new RQ,this._moonLight=new sbe,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,t,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(t=this._view)==null?void 0:t.state)==null?void 0:i.viewingMode)===st.Global&&uP(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new ja({view:e});const t=()=>this._updateRenderParameters(),i=()=>this._cameraHandler(),r=()=>this._updateLighting();this._viewHandles.add([xe(()=>e.environment.lighting,s=>this._updateLightingHandler(s),Rr),xe(()=>e.environment.lighting.type==="sun"?e.environment.lighting.date:null,s=>this._lightingDateHandler(s),Rr),xe(()=>e.stationary,()=>this._interactingStationaryHandler()),xe(()=>e.environment.lighting.directShadowsEnabled,t,Rr),xe(()=>e.environment.lighting.ambientOcclusionEnabled,t,Rr),xe(()=>e.environment.lighting.waterReflectionEnabled,t,Rr),xe(()=>{var s;return(s=e.environment.background)==null?void 0:s.color},t,Rr),xe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),Rr),xe(()=>e.environment.weather.type,r,Rr),xe(()=>this.weatherEnabled,r,Rr),xe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),an),xe(()=>e.environment.lighting.type==="sun"&&e.environment.lighting.cameraTrackingEnabled,s=>this._updateCameraTracking(s),an),xe(()=>e.state.camera,i,an),xe(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=Tt(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type==="sun"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type==="sun"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const t=this._view.environment.lighting;(t==null?void 0:t.type)==="sun"&&(t.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const t=this._view.environment.lighting;if((t==null?void 0:t.type)!=="virtual"){if(e){if(!t.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!$x(i)){const r=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(r))return void this._requestReferencePositionUpdate(r)}if(this._preupdateTracking(e),w(this._referencePosWGS84Comparable)){const r=wne(this._referencePosWGS84Comparable,Ane);w(r)&&(t.autoUpdate(null,r),this._trackingEnabled&&(t.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type==="sun"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const t=this._view;if(!t.ready)return;const i=t.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,t){const i=uP(this._view.spatialReference);if(i&&!$x(this._view.spatialReference))return!1;const r=e.position;return N(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=F()),i?vLe(r,this._referencePosWGS84Comparable):fe(this._referencePosWGS84Comparable,r.longitude,r.latitude,r.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,t)||this._updateLighting(t),!0}_cameraHandlerServerSide(e){const t=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(t))&&this._requestReferencePositionUpdate(t,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=t.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e){const t=this._view,i=e||(t.environment.lighting.type==="sun"?t.environment.lighting.date:null),r=this._referencePosWGS84Comparable,s=w(r)?gZe:yZe;if(w(r)){const h=this.weatherVisible?t.environment.weather.type:"disabled";nZe(i,r,t.state.viewingMode,h,t.state.camera,t.environment.lighting.type,s)}const n=this._mainLight,o=s.direct;be(n.intensity,o.color,o.intensity*Math.PI),ve(n.direction,o.directionToLightSource),n.specularStrength=s.specularStrength,n.environmentStrength=s.environmentStrength;const a=this._ambientLight;be(a.intensity,s.ambient.color,s.ambient.intensity);const l=this._moonLight;Nn(l.intensity,vZe,bZe,s.globalFactor);const c=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));be(l.intensity,l.intensity,c),ve(l.direction,o.directionToLightSource),t._stage.renderView.updateLightSources([n,a,l],1-s.noonFactor,s.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(e,t=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||N(e))return!1;const i=_Ze;i.setTime((t||this._view.environment.lighting.date).getTime());const r=wne(e,Ane);if(N(r))return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===r.hours&&s.minutes===r.minutes&&s.seconds===r.seconds)return!1}else s=r;const n=i.getUTCHours()-(r.hours-s.hours),o=i.getUTCMinutes()-(r.minutes-s.minutes),a=i.getUTCSeconds()-(r.seconds-s.seconds);return i.setUTCHours(n),i.setUTCMinutes(o),i.setUTCSeconds(a),!t&&this._view.environment.lighting.autoUpdate(i,r)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const t=Iu(this._referencePosWGS84Comparable,!0,s=>lZe(s[2],this._view.state.viewingMode)),i=this._view.environment.background,r=i instanceof c1e?{type:"color",color:IX(at.toUnitRGBA(i.color))}:{type:"color",color:ki(0,0,0,1)};e.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&t,background:r,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,t=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!t,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=AE(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),r=this._referencePosUpdateTimer=AE(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===r&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const t=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(t[0])&&!isNaN(t[1])){const i=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=t[0],this._referencePosWGS84Comparable[1]=t[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[t[0],t[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let t=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(t*=this._view.mapCoordsHelper.unitInMeters),t>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(t){e._referencePointUpdateInterval=t},set referencePointUpdateDistThreshold(t){e._referencePointUpdateDistThreshold=t},set referencePosUpdateTimer(t){e._referencePosUpdateTimer=t},set referencePointUpdateDelay(t){e._referencePointUpdateDelay=t},set disableWeather(t){e._disableWeather=t}}}};u([f({type:Boolean,readOnly:!0})],op.prototype,"updating",null),u([f()],op.prototype,"disableQueries",void 0),u([f()],op.prototype,"_disableWeather",void 0),u([f()],op.prototype,"weatherEnabled",null),u([f()],op.prototype,"weatherVisible",null),u([f()],op.prototype,"referencePositionWGS84Comparable",null),u([f()],op.prototype,"_renderer",void 0),u([f()],op.prototype,"_referencePosWGS84Comparable",void 0),op=u([B("esri.views.3d.environment.SceneViewEnvironmentManager")],op);const gZe=new ybe,yZe=new ybe,_Ze=new Date,Ane={hours:0,minutes:0,seconds:0},vZe=Ke(.22,.22,.33),bZe=Ke(.22,.22,.22);function s3(e,t){return(e&t)!=0}function A5(e,t,i,r,s,n){e!==0&&(i?(n.min=Math.min(n.min,t),n.max=Math.max(n.max,t)):r!=null?(n.min-=Math.max(0,(t-n.min)*(1-r)),n.max+=Math.max(0,(t-n.max)*(1-r))):s&&(n.min-=Math.max(0,t-n.min-s),n.max+=Math.max(0,t-n.max-s)))}var oi,Vr,ho;(function(e){e[e.NONE=0]="NONE",e[e.ZOOM=1]="ZOOM",e[e.TUMBLE=2]="TUMBLE",e[e.LOOK_AROUND=3]="LOOK_AROUND",e[e.PAN=4]="PAN",e[e.ASCEND=5]="ASCEND"})(oi||(oi={})),function(e){e[e.NONE=0]="NONE",e[e.TILT=1]="TILT",e[e.ALTITUDE=2]="ALTITUDE",e[e.DISTANCE=4]="DISTANCE",e[e.COLLISION=8]="COLLISION",e[e.ALL=15]="ALL",e[e.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(Vr||(Vr={})),function(e){e[e.TUMBLE=0]="TUMBLE",e[e.LOOK_AROUND=1]="LOOK_AROUND"}(ho||(ho={}));const h1={selection:Vr.NONE,interactionType:oi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE};function vbe(e,t,i,r){return t=t||e.viewForward,ve(r,t),be(r,r,Math.sign(ke(t,i))),r}function wZe(e,t,i,r){return CZe(e,t,i,SZe(r,t,i,!0))}function xZe(e,t,i,r){const s=ke(i,Me(e,r,t));return Oe(e,t,be(e,i,s))}const TZe={dir:F(),len:0,clip:yt()};function SZe(e,t,i,r){const s=TZe;return e?(i&&r&&(s.len=Pr(t,i)),ve(s.dir,e)):r?(s.len=Pr(t,i),Me(s.dir,i,t),be(s.dir,s.dir,1/s.len)):(Me(s.dir,i,t),De(s.dir,s.dir)),s}function EZe(e,t,i){const r=ke(e,i.dir),s=-Or(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function CZe(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!EZe(e[s],t,r))return!1;return!0}function AZe(e,t,i=h1){const r=NQ(e,t,i);if(r===0)return!1;const s=e.renderCoordsHelper,n=s.getAltitude(t.eye)+r,o=vbe(t,i.interactionDirection,MZe(e,t,Math.sign(r),$Ze),LZe),a=ve(DZe,t.viewForward),l=s.intersectInfiniteManifold(sh(t.eye,o),n,W6);return t.eye=w(l)?l:s.setAltitude(W6,n,t.eye),t.center=xZe(W6,t.eye,a,t.center),!0}function NQ(e,t,i=h1){if(!OZe(e,i))return 0;const r=PZe(e.state.constraints.altitude,IZe);RZe(e,i,r);const s=e.renderCoordsHelper.getAltitude(t.eye),n=Xe(s,r.min,r.max)-s;return Math.abs(n)<=1e-6?0:n}function OZe(e,t){const i=e.state.constraints.altitude;return!(!e.state.isGlobal||!i)&&(t.interactionType!==oi.TUMBLE||!s3(t.selection,Vr.TILT))}function RZe(e,t,i){const r=t.interactionType;if(r===oi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===oi.TUMBLE||r===oi.ZOOM,c=NQ(e,o),h=c===0?0:e.renderCoordsHelper.getAltitude(o.eye);i.min=s,i.max=n,A5(c,h,l,a,.05*h,i)}function MZe(e,t,i,r){return e.renderCoordsHelper.worldUpAtPosition(t.eye,r),be(r,r,i),r}function PZe(e,t){return t.min=e.min,t.max=e.max,t}const IZe={min:0,max:0},LZe=F(),$Ze=F(),DZe=F(),W6=F();function FQ(e,t,i=h1){if(!e.state.isLocal)return 0;const r=e.state.constraints.distance;if(!e.pointsOfInterest.surfaceOrigin.renderLocation||r===1/0)return 0;f$.min=0,f$.max=r,FZe(e,i,f$);const s=kQ(e,t),n=f$.max-s;return n>=-1e-6?0:n}function NZe(e,t,i=h1){const r=FQ(e,t,i);if(r===0)return!1;const s=e.pointsOfInterest.surfaceOrigin,n=kQ(e,t)+r,o=ve(UZe,t.eye),a=vbe(t,i.interactionDirection,kZe(e,t,VZe),BZe);if(!x1(ige(s.renderLocation,n),sh(t.eye,a),m$))return!1;t.eye=m$;const l=Me(zZe,t.eye,o);t.center=Oe(m$,t.center,l);const c=e.renderCoordsHelper.getAltitude(t.center),h=e.renderCoordsHelper.intersectInfiniteManifold(t.ray,c,m$);return w(h)&&(t.center=h),!0}function FZe(e,t,i){const r=t.interactionType;if(r===oi.NONE)return;const{min:s,max:n}=i,{interactionStartCamera:o,interactionFactor:a}=t,l=r===oi.ZOOM||r===oi.PAN,c=FQ(e,o),h=c===0?0:kQ(e,o);i.min=s,i.max=n,A5(c,h,l,a,.05*h,i)}function kQ(e,t){const i=e.pointsOfInterest.surfaceOrigin;return Pr(t.eye,i.renderLocation)}function kZe(e,t,i){const r=e.pointsOfInterest.surfaceOrigin;return t0(i,t.eye,r.renderLocation)}const f$={min:0,max:0},UZe=F(),zZe=F(),BZe=F(),VZe=F(),m$=F();var ls,Uo;(function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"})(ls||(ls={}));class GZe{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=Uo.ALL}}(function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"})(Uo||(Uo={}));function Zm(e){return w(e)&&w(e.dist)}function One(e){return(t,i,r)=>(Nn(Rne,t,i,r),!BX(e,Rne))}function tz(e){return Zm(e)&&e.intersector===ls.OBJECT&&!!e.target}function iz(e){return Zm(e)&&e.intersector===ls.HUD&&!!e.target&&w(e.target.center)}const Rne=F();class jZe{constructor(){this._transform=Be(),this._transformInverse=new g$({value:this._transform},Fs,Be),this._transformInverseTranspose=new g$(this._transformInverse,Kl,Be),this._transformTranspose=new g$({value:this._transform},Kl,Be),this._transformInverseRotation=new g$({value:this._transform},W1e,Qr)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){js(this._transform,t)}multiplyTransform(t){hs(this._transform,this._transform,t)}set(t){js(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,i){this.setTransformMatrix(t),this.multiplyTransform(i),this._invalidateLazyTransforms()}}class g${constructor(t,i,r){this.original=t,this.update=i,this.dirty=!0,this.transform=r()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}class HZe{constructor(t=0){this.offset=t,this.tmpVertex=F()}applyToVertex(t,i,r){const s=t+this.localOrigin[0],n=i+this.localOrigin[1],o=r+this.localOrigin[2],a=this.offset/Math.sqrt(s*s+n*n+o*o);return this.tmpVertex[0]=t+s*a,this.tmpVertex[1]=i+n*a,this.tmpVertex[2]=r+o*a,this.tmpVertex}applyToAabb(t){for(let n=0;n<3;++n)G0[n]=t[0+n]+this.localOrigin[n],y$[n]=t[3+n]+this.localOrigin[n],KT[n]=G0[n];const i=this.applyToVertex(G0[0],G0[1],G0[2]);for(let n=0;n<3;++n)t[n]=i[n],t[n+3]=i[n];const r=n=>{const o=this.applyToVertex(n[0],n[1],n[2]);for(let a=0;a<3;++a)t[a+0]=Math.min(t[a+0],o[a]),t[a+3]=Math.max(t[a+3],o[a])};for(let n=1;n<8;++n){for(let o=0;o<3;++o)KT[o]=(n&1<<o)==0?G0[o]:y$[o];r(KT)}let s=0;for(let n=0;n<3;++n)G0[n]*y$[n]<0&&(s|=1<<n);if(s!==0&&s!==7){for(let n=0;n<8;++n)if((s&n)==0){for(let o=0;o<3;++o)s[o]?KT[o]=0:KT[o]=(n&1<<o)!=0?G0[o]:y$[o];r(KT)}}for(let n=0;n<3;++n)t[n+0]-=this.localOrigin[n],t[n+3]-=this.localOrigin[n];return t}}const G0=F(),y$=F(),KT=F();class qZe{constructor(t=0){this.componentLocalOriginLength=0,this._tmpVertex=F(),this._mbs=Qn(),this._obb={center:F(),halfSize:Wi(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}applyToVertex(t,i,r){const s=t,n=i,o=r+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(s*s+n*n+o*o);return this._tmpVertex[0]=t+s*a,this._tmpVertex[1]=i+n*a,this._tmpVertex[2]=r+o*a,this._tmpVertex}applyToAabb(t){const i=t[0],r=t[1],s=t[2]+this.componentLocalOriginLength,n=t[3],o=t[4],a=t[5]+this.componentLocalOriginLength,l=i*n<0?0:Math.min(Math.abs(i),Math.abs(n)),c=r*o<0?0:Math.min(Math.abs(r),Math.abs(o)),h=s*a<0?0:Math.min(Math.abs(s),Math.abs(a)),p=Math.sqrt(l*l+c*c+h*h);if(p<this._totalOffset)return t[0]-=i<0?this._totalOffset:0,t[1]-=r<0?this._totalOffset:0,t[2]-=s<0?this._totalOffset:0,t[3]+=n>0?this._totalOffset:0,t[4]+=o>0?this._totalOffset:0,t[5]+=a>0?this._totalOffset:0,t;const m=Math.max(Math.abs(i),Math.abs(n)),g=Math.max(Math.abs(r),Math.abs(o)),v=Math.max(Math.abs(s),Math.abs(a)),b=Math.sqrt(m*m+g*g+v*v),S=this._totalOffset/b,T=this._totalOffset/p;return t[0]+=i*(i>0?S:T),t[1]+=r*(r>0?S:T),t[2]+=s*(s>0?S:T),t[3]+=n*(n<0?S:T),t[4]+=o*(o<0?S:T),t[5]+=a*(a<0?S:T),t}applyToMbs(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this._totalOffset/i;return this._mbs[0]=t[0]+t[0]*r,this._mbs[1]=t[1]+t[1]*r,this._mbs[2]=t[2]+t[2]*r,this._mbs[3]=t[3]+t[3]*this._totalOffset/i,this._mbs}applyToObb(t){const i=t.center,r=this._totalOffset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);this._obb.center[0]=i[0]+i[0]*r,this._obb.center[1]=i[1]+i[1]*r,this._obb.center[2]=i[2]+i[2]*r,ju(this._obb.halfSize,t.halfSize,t.quaternion),Oe(this._obb.halfSize,this._obb.halfSize,t.center);const s=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*s,this._obb.halfSize[1]+=this._obb.halfSize[1]*s,this._obb.halfSize[2]+=this._obb.halfSize[2]*s,Me(this._obb.halfSize,this._obb.halfSize,t.center),Yy(Lne,t.quaternion),ju(this._obb.halfSize,this._obb.halfSize,Lne),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=t.quaternion,this._obb}}class WZe{constructor(t=0){this.offset=t,this.sphere=Qn(),this.tmpVertex=F()}applyToVertex(t,i,r){const s=this.objectTransform.transform;let n=s[0]*t+s[4]*i+s[8]*r+s[12],o=s[1]*t+s[5]*i+s[9]*r+s[13],a=s[2]*t+s[6]*i+s[10]*r+s[14];const l=this.offset/Math.sqrt(n*n+o*o+a*a);n+=n*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*n+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*n+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*n+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(t,i){const r=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*r,t[1]+=t[1]*r,t[2]+=t[2]*r;const s=this.offset/Math.sqrt(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]);i[0]+=i[0]*s,i[1]+=i[1]*s,i[2]+=i[2]*s}applyToAabb(t){const i=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*i,t[1]+=t[1]*i,t[2]+=t[2]*i;const r=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*r,t[4]+=t[4]*r,t[5]+=t[5]*r,t}applyToBoundingSphere(t){const i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),r=this.offset/i;return this.sphere[0]=t[0]+t[0]*r,this.sphere[1]=t[1]+t[1]*r,this.sphere[2]=t[2]+t[2]*r,this.sphere[3]=t[3]+t[3]*this.offset/i,this.sphere}}const Mne=new WZe;function Gq(e){return w(e)?(Mne.offset=e,Mne):null}const Pne=new qZe;function ZZe(e){return w(e)?(Pne.offset=e,Pne):null}const Ine=new HZe;function XZe(e){return w(e)?(Ine.offset=e,Ine):null}const Sp="terrain",Lne=s0();function jq(e,t,i){for(let r=0;r<i;++r)t[2*r]=e[r],t[2*r+1]=e[r]-t[2*r]}function YZe(e,t){const i=e.length;for(let r=0;r<i;++r)G2[0]=e[r],t[r]=G2[0];return t}function QZe(e,t){const i=e.length;for(let r=0;r<i;++r)G2[0]=e[r],G2[1]=e[r]-G2[0],t[r]=G2[1];return t}const G2=new Float32Array(2);function Hq(e,t){return N(e)&&(e=[]),e.push(t),e}function qq(e,t){if(N(e))return null;const i=e.filter(r=>r!==t);return i.length===0?null:i}function hI(e){return!!w(e)&&!e.visible}function JZe(e,t,i){const r=e.origin.vec3;ube(Z6,-r[0],-r[1],-r[2]),w(e.transformation)?hs(t,Z6,e.transformation):js(t,Z6),i&&(Fs(i,t),Kl(i,i))}function KZe(e,t,i,r,s){_$[0]=e.get(t,0),_$[1]=e.get(t,1),_$[2]=e.get(t,2),jq(_$,J1,3),i.set(s,0,J1[0]),r.set(s,0,J1[1]),i.set(s,1,J1[2]),r.set(s,1,J1[3]),i.set(s,2,J1[4]),r.set(s,2,J1[5])}const _$=new Float64Array(3),J1=new Float32Array(6),Z6=Be(),_C=1e-5;class eXe{constructor(t){this.options=new GZe,this._results=new tXe,this.transform=new jZe,this.tolerance=_C,this.verticalOffset=null,this._ray=Lo(),this._rayEnd=F(),this._rayBeginTransformed=F(),this._rayEndTransformed=F(),this.viewingMode=t==null?st.Global:t}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,i,r){this.resetWithRay(WLe(t,i,this._ray),r)}resetWithRay(t,i){this.camera=i,t!==this._ray&&G4(t,this._ray),this.options.verticalOffset!==0?this.viewingMode===st.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,Oe(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(t=null,i,r,s,n){this.point=i,this.filterPredicate=s,this.tolerance=r==null?_C:r;const o=Gq(this.verticalOffset);if(w(t)&&t.length>0){const a=n?l=>{n(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of t){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();w(c)?(w(o)?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(h=>a(h))}}this.sortResults()}intersectObject(t){const i=t.geometryRecords;if(!i)return;const r=t.transformation,s=Gq(this.verticalOffset);for(const n of i){const{geometry:o,material:a,instanceParameters:l}=n;if(hI(l))continue;const c=o.id;this.transform.setAndInvalidateLazyTransforms(r,n.getShaderTransformation()),et(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),et(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const h=this.transform.transform;w(s)&&(s.objectTransform=this.transform),a.intersect(o,l,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(p,m,g,v,b,S)=>{if(p>=0){if(w(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,p))return;const T=v?this._results.hud:this._results,O=v?C=>{const M={object:t,geometryId:c,triangleNr:g,center:w(S)?[S[0],S[1],S[2]]:null};C.set(ls.HUD,M,p,m,Dn,b)}:C=>C.set(ls.OBJECT,{object:t,geometryId:c,triangleNr:g},p,m,h,b);if((T.min.drapedLayerOrder==null||b>=T.min.drapedLayerOrder)&&(T.min.dist==null||p<T.min.dist)&&O(T.min),this.options.store!==Uo.MIN&&(T.max.drapedLayerOrder==null||b<T.max.drapedLayerOrder)&&(T.max.dist==null||p>T.max.dist)&&O(T.max),this.options.store===Uo.ALL)if(v){const C=new Wq(this._ray);O(C),this._results.hud.all.push(C)}else{const C=new pE(this._ray);O(C),this._results.all.push(C)}}},n.shaderTransformation)}}sortResults(t=this._results.all){t.sort((i,r)=>i.dist!==r.dist?$t(i.dist,0)-$t(r.dist,0):i.drapedLayerOrder!==r.drapedLayerOrder?$t(i.drapedLayerOrder,Number.MAX_VALUE)-$t(r.drapedLayerOrder,Number.MAX_VALUE):$t(r.drapedLayerGraphicOrder,Number.MIN_VALUE)-$t(i.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function wd(e){return new eXe(e)}class tXe{constructor(){this.min=new pE(Lo()),this.max=new pE(Lo()),this.hud={min:new Wq(Lo()),max:new Wq(Lo()),all:new Array},this.ground=new pE(Lo()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}class pE{constructor(t){this.intersector=ls.OBJECT,this.normal=F(),this.transformation=Be(),this._ray=Lo(),this.init(t)}get ray(){return this._ray}get distanceInRenderSpace(){return w(this.dist)?(be(v$,this.ray.direction,this.dist),He(v$)):null}getIntersectionPoint(t){return!!Zm(this)&&(be(v$,this.ray.direction,this.dist),Oe(t,this.ray.origin,v$),!0)}getTransformedNormal(t){return ve(oO,this.normal),oO[3]=0,zu(oO,oO,this.transformation),ve(t,oO),De(t,t)}init(t){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=ls.OBJECT,G4(t,this._ray)}set(t,i,r,s,n,o,a){this.intersector=t,this.dist=r,ve(this.normal,$t(s,fde)),js(this.transformation,$t(n,Dn)),this.target=i,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(t){G4(t.ray,this._ray),this.intersector=t.intersector,this.dist=t.dist,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.drapedLayerGraphicOrder=t.drapedLayerGraphicOrder,ve(this.normal,t.normal),js(this.transformation,t.transformation)}}class Wq extends pE{constructor(){super(...arguments),this.intersector=ls.HUD}}function UQ(e){return new pE(e)}const v$=F(),oO=di();function bbe(e,t,i,r){return w(e.renderCoordsHelper.fromRenderCoords(t.eye,O5,r))&&Vpe(i,O5)}function rz(e,t){return e.elevationProvider?$t(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function xT(e,t,i,r){const s=e.state.camera.clone();t&&(s.eye=t,s.center=i,s.up=r),iXe(e,s.ray,j0)||ve(j0,s.center);const n=e.state.constraints,o=n.minimumPoiDistance;if(Yn(s.eye,j0)<o){const a=n.collision.enabled;ve(K1,s.viewForward),be(K1,K1,o),a?s.eye=Me(O5,j0,K1):Oe(j0,s.eye,K1);const l=e.renderCoordsHelper,c=l.getAltitude(s.eye),h=n.collision.elevationMargin;a&&c<h&&(Me(K1,j0,s.eye),s.eye=l.setAltitude(O5,h,s.eye),Oe(j0,s.eye,K1))}return s.center=j0,s}function $ne(e,t,i){if(!e.state.isGlobal)return!1;const r=rz(e,t),s=e.stateManager.constraintsManager.nearFarHeuristic,{far:n}=s.compute(t,i,e.renderDataExtent,r,sXe),o=n*n;return Yn(t,i)>o}function iXe(e,t,i){let r=Dne[e.viewingMode];r||(r=wd(e.state.viewingMode),r.options.backfacesTerrain=!e.state.isGlobal,r.options.invisibleTerrain=!0,Dne[e.viewingMode]=r);const{isGlobal:s}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(t,r,i)||$ne(e,t.origin,i))||!(!e.renderCoordsHelper.intersectManifold(t,0,i)||$ne(e,t.origin,i))||!!s&&rXe(t,i,ji(e.spatialReference).radius)}function rXe(e,t,i){const r=ke(e.origin,e.origin)-i*i,s=r>0?Math.sqrt(r)/3:1;return be(t,e.direction,s/He(e.direction)),Oe(t,t,e.origin),!0}const Dne={},O5=F(),j0=F(),K1=F(),sXe={near:0,far:0};function nA(e,t,i=hd.EYE){const r=e.state.constraints;if(!r.collision.enabled)return!1;const s=rz(e,t.eye),n=e.renderCoordsHelper.getAltitude(t.eye),o=s+r.collision.elevationMargin;if(n>=o)return!1;const a=He(t.eye);if(Me(b$,t.center,t.eye),t.eye=e.renderCoordsHelper.setAltitude(nXe,o,t.eye),i===hd.EYE_AND_CENTER)t.center=Oe(b$,t.eye,b$);else if(i===hd.EYE_AND_CENTER_SCALE){const l=(a-n+o)/a;t.center=be(b$,t.center,l)}return!0}var hd;(function(e){e[e.EYE=0]="EYE",e[e.EYE_AND_CENTER=1]="EYE_AND_CENTER",e[e.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(hd||(hd={}));const b$=F(),nXe=F();function d1(e,t,i){e.worldUpAtPosition(t,Nne),Me(X6,i,t);const r=He(X6);return r===0?0:Fn(ke(X6,Nne)/r)}const Nne=F(),X6=F();function wbe(e,t,i=h1,r=!0){aO.eyeCenterDistance=0,aO.requiresTwoSteps=!1;const s=zQ(e,t,i,void 0,aO);if(s===0)return!1;switch(ih(w$,-s,t.viewRight),i.tiltMode){case ho.LOOK_AROUND:et(H0,t.viewForward,w$),be(H0,H0,aO.eyeCenterDistance),t.center=Oe(uv,t.eye,H0);break;case ho.TUMBLE:Me(H0,t.center,t.eye),et(H0,H0,w$),t.eye=Me(uv,t.center,H0);break;default:i.tiltMode}return t.up=et(uv,t.up,w$),!aO.requiresTwoSteps||!r||wbe(e,t,i,!1)}function zQ(e,t,i=h1,r=h1,s){if(!e.state.constraints.tilt)return 0;const n=t.distance,o=e.state.constraints.tilt(n,mXe);return fXe(e,i,o),r.interactionType===oi.TUMBLE&&s3(r.selection,Vr.ALTITUDE)&&xbe(e,r.interactionStartCamera,o),i.tiltMode===ho.LOOK_AROUND||r.tiltMode===ho.LOOK_AROUND?aXe(e,t,o,s):oXe(e,t,o)}function oXe(e,t,i){const r=d1(e.renderCoordsHelper,t.center,t.eye),s=r-Xe(r,i.min,i.max);return n3(s)?s:0}function aXe(e,t,i,r){switch(r&&(r.requiresTwoSteps=!1),e.viewingMode){case"global":return cXe(e,t,i,r);case"local":return lXe(e,t,i,r);default:return void(e.viewingMode,void 0)}}function lXe(e,t,i,r){const s=d1(e.renderCoordsHelper,t.center,t.eye),n=Xe(s,i.min,i.max),o=s-n;if(!n3(o))return 0;if(r){const a=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=e.renderCoordsHelper.getAltitude(t.eye)-a,c=Math.cos(n);Math.abs(c)>1e-4?r.eyeCenterDistance=l/c:r.eyeCenterDistance=t.distance}return o}function cXe(e,t,i,r){const s=uXe(e,t,gXe),n=Xe(s.tiltAtCenter,i.min,i.max);if(!n3(s.tiltAtCenter-n))return 0;let o,a;return s.centerIsOnSurface?(o=hXe(s),a=dXe(s,o)):(o=s.constraints.clampTilt(s.eyeCenterDistance,s.tiltAtCenter),r&&o<Math.PI/2&&(r.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=pXe(s,o)),r&&(r.eyeCenterDistance=Zq(s,o)),a}function uXe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,s=r+ji(e.spatialReference).radius,n=e.renderCoordsHelper.intersectManifold(t.ray,r,uv);return i.eyeCenterDistance=t.distance,i.centerIsOnSurface=!1,w(n)?(i.eyeCenterDistance=Pr(t.eye,n),i.tiltAtCenter=d1(e.renderCoordsHelper,n,t.eye),i.centerIsOnSurface=!0):e.state.isLocal?i.tiltAtCenter=d1(e.renderCoordsHelper,t.center,t.eye):(HC(uU(hU,s),t.ray,uv),i.eyeCenterDistance=Pr(t.eye,uv),i.tiltAtCenter=Fn(-ke(t.viewForward,De(uv,uv)))),i.radius=s,i.eyeRadius=He(t.eye),i.constraints=e.state.constraints,i}function n3(e){return Math.abs(e)>1e-9}function hXe(e){const{constraints:t,eyeCenterDistance:i,tiltAtCenter:r}=e;let s=r,n=t.clampTilt(i,r);const o=Zq(e,n);if(t.clampTilt(o,r)===n)return n;let a=0;for(;a<10&&n3(n-s);){const l=(s+n)/2,c=Zq(e,l);n3(t.clampTilt(c,l)-l)?s=l:n=l,a++}return n}function Zq(e,t){if(!e.centerIsOnSurface)return e.eyeCenterDistance;const i=Math.PI-Xe(t,0,Math.PI),r=Hp(e.radius/e.eyeRadius*Math.sin(i)),s=Math.PI-i-r,n=Math.sin(s)/Math.sin(i);if(e.eyeRadius<e.radius&&n>1){const o=Math.PI-r,a=Math.PI-i-o;return Math.sin(a)/Math.sin(i)*e.eyeRadius}return n*e.eyeRadius}function dXe(e,t){const i=Hp(e.radius/e.eyeRadius*Math.sin(e.tiltAtCenter)),r=Hp(e.radius/e.eyeRadius*Math.sin(t));return e.eyeRadius>e.radius?i-r:r-i}function pXe(e,t){return e.tiltAtCenter-Math.PI/2-(t-Math.PI/2)}function fXe(e,t,i){if(t.interactionType===oi.NONE)return;const{interactionStartCamera:r,interactionFactor:s}=t,{min:n,max:o}=i,a=zQ(e,r,h1,t),l=a===0?0:d1(e.renderCoordsHelper,r.center,r.eye);i.min=n,i.max=o,t.interactionType===oi.TUMBLE?(s3(t.selection,Vr.ALTITUDE)&&xbe(e,r,i),A5(a,l,!0,s,Fne,i)):A5(a,l,!1,s,Fne,i)}function xbe(e,t,i){if(e.state.isLocal)return;const r=e.state.constraints;if(!r.altitude)return;const s=rl(t.center),n=Math.sqrt(s),o=t.distance,a=ji(e.spatialReference).radius,l=r.altitude.min+a,c=r.altitude.max+a,h=(l*l-o*o-s)/(-2*n*o),p=(c*c-o*o-s)/(-2*n*o);i.min=Math.max(i.min,Math.min(Math.PI-Fn(p),i.max)),i.max=Math.min(i.max,Math.PI-Fn(h))}const H0=F(),w$=Be(),uv=F(),Fne=Jt(5),mXe={min:0,max:0},gXe={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},aO={eyeCenterDistance:0,requiresTwoSteps:!1};function yXe(e){return e}const sz=e=>e*e,BQ=e=>1-sz(1-e),_Xe=e=>e<.5?sz(2*e)/2:(BQ(2*(e-.5))+1)/2,VQ=e=>e*e*e,Tbe=e=>1-VQ(1-e),Sbe=e=>e<.5?VQ(2*e)/2:(Tbe(2*(e-.5))+1)/2,GQ=e=>e*e*e*e,Ebe=e=>1-GQ(1-e),vXe=e=>e<.5?GQ(2*e)/2:(Ebe(2*(e-.5))+1)/2,jQ=e=>e*e*e*e*e,Cbe=e=>1-jQ(1-e),bXe=e=>e<.5?jQ(2*e)/2:(Cbe(2*(e-.5))+1)/2,HQ=e=>1-Math.cos(e*Math.PI/2),Abe=e=>1-HQ(1-e),wXe=e=>e<.5?HQ(2*e)/2:(Abe(2*(e-.5))+1)/2,qQ=e=>2**(10*(e-1)),dI=e=>1-qQ(1-e),xXe=e=>e<.5?qQ(2*e)/2:(dI(2*(e-.5))+1)/2,WQ=e=>-(Math.sqrt(1-e*e)-1),Obe=e=>1-WQ(1-e),TXe=e=>e<.5?WQ(2*e)/2:(Obe(2*(e-.5))+1)/2;function Ed(e){const t=2*(e-Math.sqrt((e-1)*e)),i=t/2/e;return r=>r<i?e*r*r:t*r-t+1}function Cd(e,t){return(i,r)=>i<t?t*e(i/t,r):1-e((1-i)/(1-t),r)*(1-t)}const SXe=Cd(Ed(1),1),EXe=Cd(Ed(1),0),Rbe=Cd(Ed(1),.5),CXe=Cd(Ed(2),1),AXe=Cd(Ed(2),0),OXe=Cd(Ed(2),.5),RXe=Cd(Ed(3),1),MXe=Cd(Ed(3),0),PXe=Cd(Ed(3),.5),IXe=Cd(Ed(4),1),LXe=Cd(Ed(4),0),$Xe=Cd(Ed(4),.5),DXe={linear:yXe,"in-quad":sz,"out-quad":BQ,"in-out-quad":_Xe,"in-coast-quad":SXe,"out-coast-quad":EXe,"in-out-coast-quad":Rbe,"in-cubic":VQ,"out-cubic":Tbe,"in-out-cubic":Sbe,"in-coast-cubic":CXe,"out-coast-cubic":AXe,"in-out-coast-cubic":OXe,"in-quart":GQ,"out-quart":Ebe,"in-out-quart":vXe,"in-coast-quart":RXe,"out-coast-quart":MXe,"in-out-coast-quart":PXe,"in-quint":jQ,"out-quint":Cbe,"in-out-quint":bXe,"in-coast-quint":IXe,"out-coast-quint":LXe,"in-out-coast-quint":$Xe,"in-sine":HQ,"out-sine":Abe,"in-out-sine":wXe,"in-expo":qQ,"out-expo":dI,"in-out-expo":xXe,"in-circ":WQ,"out-circ":Obe,"in-out-circ":TXe};function Ds(e,t,i=UXe,r=t){let s=!1;r!==t&&r.copyFrom(t),r.computeUp(e.state.viewingMode);for(let a=0;a<zXe;a++){let l=0;for(const c of kXe)if(s3(i.selection,c.type)){const h=Math.abs(c.error(e,r,i));c.apply(e,r,i)&&(s=!0,l+=h)}if(l===0)break}const n=s3(i.selection,Vr.COLLISION),o=NXe(i.interactionType,e);return n&&nA(e,r,o)&&(s=!0),s&&r.computeUp(e.state.viewingMode),s}function NXe(e,t){switch(e){case oi.PAN:return hd.EYE_AND_CENTER;case oi.ASCEND:return t.state.isGlobal?hd.EYE_AND_CENTER_SCALE:hd.EYE_AND_CENTER;default:return hd.EYE}}function bp(e,t){const i=typeof e=="number"?e:oQ(e,t),r=Math.min(1,i/150);return Sbe(r)}function FXe(e,t,i){return zQ(e,t,i)*t.distance}const kXe=[{type:Vr.TILT,error:FXe,apply:wbe},{type:Vr.ALTITUDE,error:NQ,apply:AZe},{type:Vr.DISTANCE,error:FQ,apply:NZe}],UXe={selection:Vr.ALL,interactionType:oi.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE},zXe=5,iu=F(),nc=F(),q0=F(),ma=F(),eb=F(),BXe=F(),ru={upward:Ke(0,0,1),forward:Ke(0,1,0),sideway:Ke(1,0,0)},kne=Qr();class Une{constructor(t=st.Global){this.viewingMode=t,this.center=F(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=un(ru.forward)}pixelsPerPanAtZoom(t){return this.size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this.size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/t}compareTo(t,i){if(i||(i={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===st.Global){const n=(He(this.center)+He(t.center))/2;i.pan=$N(this.center,t.center)*n}else i.pan=Pr(this.center,t.center);let r=Math.abs(t.yaw-this.yaw);r>=Math.PI&&(r=2*Math.PI-r);const s=Math.abs(t.pitch-this.pitch);return i.rotate=Math.max(r,s),i.sourceZoom=this.distance,i.targetZoom=t.distance,i}interpolate(t,i,r){this.viewingMode===st.Global?h$e(t.center,i.center,r.pan,this.center):Nn(this.center,t.center,i.center,r.pan),this.distance=fi(t.distance,i.distance,r.zoom),this.pitch=fi(t.pitch,i.pitch,r.rotate);let s=t.yaw;const n=i.yaw;Math.abs(n-s)>=Math.PI&&(s+=2*(s<n?1:-1)*Math.PI),this.yaw=fi(s,n,r.rotate)}copyFrom(t){ve(this.center,t.center),this.pitch=t.pitch,this.yaw=t.yaw,this.distance=t.distance,ve(this.lookAtDirection,t.lookAtDirection),this.size=t.size,this.copyFromCommon(t),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,kne);ve(this.center,t.center),Me(ma,t.center,t.eye),$c(ma,ma,i),$c(eb,t.up,i),this.distance=He(ma),ma[0]/=this.distance,ma[1]/=this.distance,ma[2]/=this.distance,this.pitch=this._eyeUpToPitch(ma),this.yaw=this._eyeUpToYaw(ma,eb),this.size=Math.sqrt(t.width*t.width+t.height*t.height),this.copyFromCommon(t)}copyFromCommon(t){this.fov=t.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(t){const i=this._lookAtOrientation(this.center,kne);vd(i,i),this._axisAngleVec3(ru.sideway,this.pitch-Math.PI/2,ru.forward,ma),this._axisAngleVec3(ru.upward,this.yaw,ma),this._axisAngleVec3(ru.sideway,this.pitch-Math.PI/2,ru.upward,eb),this._axisAngleVec3(ru.upward,this.yaw,eb),be(ma,ma,this.distance),$c(ma,ma,i),$c(eb,eb,i),t.center=this.center,t.eye=Me(ma,this.center,ma),t.up=eb}_axisAngleVec3(t,i,r,s=r){const n=Math.cos(i),o=Math.sin(i);return be(iu,r,n),St(nc,t,r),be(nc,nc,o),be(q0,t,(1-n)*ke(t,r)),Oe(s,Oe(s,iu,nc),q0)}_lookAtOrientation(t,i=Qr()){return this._upAtLookAt(t,q0),St(iu,this.lookAtDirection,q0),De(iu,iu),iu[0]===0&&iu[1]===0&&iu[2]===0&&ve(iu,ru.sideway),St(nc,q0,iu),De(nc,nc),i[0]=iu[0],i[1]=nc[0],i[2]=q0[0],i[3]=iu[1],i[4]=nc[1],i[5]=q0[1],i[6]=iu[2],i[7]=nc[2],i[8]=q0[2],i}_upAtLookAt(t,i){return this.viewingMode===st.Local?ve(i,ru.upward):De(i,t)}_eyeUpToPitch(t){return Math.PI-$N(ru.upward,t)}_eyeUpToYaw(t,i){const r=BXe;return Math.abs(i[2])<.5?(ve(r,i),t[2]>0&&be(r,r,-1)):ve(r,t),St(nc,r,ru.upward),De(nc,nc),$N(ru.sideway,nc,ru.upward)}}function ZQ(e){return e?{ray:Lo(e.ray),c0:e.c0,c1:e.c1}:{ray:Lo(),c0:0,c1:Number.MAX_VALUE}}function VXe(e,t=ZQ()){return G4(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t}function GXe(e,t,i=ZQ()){const r=He(e.vector);return tge(e.origin,t,i.ray),i.c0=0,i.c1=r,i}function Tbt(e,t){return Mbe(e,e.c0,t)}function Sbt(e,t){return Mbe(e,e.c1,t)}function Mbe(e,t,i){return Oe(i,e.ray.origin,be(i,e.ray.direction,t))}new r0(()=>({c0:0,c1:0,ray:null}));function o3(e){return e?[Vi(e[0]),Vi(e[1]),Vi(e[2]),Vi(e[3]),Vi(e[4]),Vi(e[5])]:[Vi(),Vi(),Vi(),Vi(),Vi(),Vi()]}function Pbe(){return[F(),F(),F(),F(),F(),F(),F(),F()]}function R5(e,t){for(let i=0;i<Jy.NUM;i++)dU(e[i],t[i])}function Ibe(e,t,i,r=XXe){const s=hs($X.get(),t,e);Fs(s,s);for(let n=0;n<Xq.NUM;++n){const o=zu(LX.get(),ZXe[n],s);fe(r[n],o[0]/o[3],o[1]/o[3],o[2]/o[3])}Lbe(i,r)}function Lbe(e,t){Ea(t[ft.FAR_BOTTOM_LEFT],t[ft.NEAR_BOTTOM_LEFT],t[ft.NEAR_TOP_LEFT],e[Ar.LEFT]),Ea(t[ft.NEAR_BOTTOM_RIGHT],t[ft.FAR_BOTTOM_RIGHT],t[ft.FAR_TOP_RIGHT],e[Ar.RIGHT]),Ea(t[ft.FAR_BOTTOM_LEFT],t[ft.FAR_BOTTOM_RIGHT],t[ft.NEAR_BOTTOM_RIGHT],e[Ar.BOTTOM]),Ea(t[ft.NEAR_TOP_LEFT],t[ft.NEAR_TOP_RIGHT],t[ft.FAR_TOP_RIGHT],e[Ar.TOP]),Ea(t[ft.NEAR_BOTTOM_LEFT],t[ft.NEAR_BOTTOM_RIGHT],t[ft.NEAR_TOP_RIGHT],e[Ar.NEAR]),Ea(t[ft.FAR_BOTTOM_RIGHT],t[ft.FAR_BOTTOM_LEFT],t[ft.FAR_TOP_LEFT],e[Ar.FAR])}function Pv(e,t){for(let i=0;i<Jy.NUM;i++){const r=e[i];if(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]>=t[3])return!1}return!0}function jXe(e,t){return Dbe(e,VXe(t,Nbe.get()))}function Ebt(e,t){for(let i=0;i<Jy.NUM;i++){const r=e[i];if(!v$e(r,t))return!1}return!0}function HXe(e,t,i){return Dbe(e,GXe(t,i,Nbe.get()))}function $be(e,t){for(let i=0;i<Jy.NUM;i++)if(Or(e[i],t)>0)return!1;return!0}function qXe(e,t){for(let i=0;i<Jy.NUM;i++)if(y$e(e[i],t))return!1;return!0}function Dbe(e,t){for(let i=0;i<Jy.NUM;i++)if(!_$e(e[i],t))return!1;return!0}var Ar,ft;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.TOP=3]="TOP",e[e.NEAR=4]="NEAR",e[e.FAR=5]="FAR"})(Ar||(Ar={})),function(e){e[e.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",e[e.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",e[e.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",e[e.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",e[e.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",e[e.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",e[e.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",e[e.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(ft||(ft={}));const WXe={bottom:[ft.FAR_BOTTOM_RIGHT,ft.NEAR_BOTTOM_RIGHT,ft.NEAR_BOTTOM_LEFT,ft.FAR_BOTTOM_LEFT],near:[ft.NEAR_BOTTOM_LEFT,ft.NEAR_BOTTOM_RIGHT,ft.NEAR_TOP_RIGHT,ft.NEAR_TOP_LEFT],far:[ft.FAR_BOTTOM_RIGHT,ft.FAR_BOTTOM_LEFT,ft.FAR_TOP_LEFT,ft.FAR_TOP_RIGHT],right:[ft.NEAR_BOTTOM_RIGHT,ft.FAR_BOTTOM_RIGHT,ft.FAR_TOP_RIGHT,ft.NEAR_TOP_RIGHT],left:[ft.FAR_BOTTOM_LEFT,ft.NEAR_BOTTOM_LEFT,ft.NEAR_TOP_LEFT,ft.FAR_TOP_LEFT],top:[ft.FAR_TOP_LEFT,ft.NEAR_TOP_LEFT,ft.NEAR_TOP_RIGHT,ft.FAR_TOP_RIGHT]};var Jy,Xq;(function(e){e[e.NUM=6]="NUM"})(Jy||(Jy={})),function(e){e[e.NUM=8]="NUM"}(Xq||(Xq={}));const ZXe=[ki(-1,-1,-1,1),ki(1,-1,-1,1),ki(1,1,-1,1),ki(-1,1,-1,1),ki(-1,-1,1,1),ki(1,-1,1,1),ki(1,1,1,1),ki(-1,1,1,1)],Nbe=new r0(ZQ),XXe=Pbe(),YXe=Ie.getLogger("esri.views.3d.webgl-engine.lib.Camera");class wr{constructor(t=null,i=null,r=null){this._viewUp=F(),this._viewForward=F(),this._viewRight=F(),this._ray=Lo(),this._viewport=ki(0,0,1,1),this._padding=ki(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=ir(1,1e3),this._viewDirty=!0,this._viewMatrix=Be(),this._projectionDirty=!0,this._projectionMatrix=Be(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Be(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Be(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=o3(),this._fullViewport=di(),this._pixelRatio=1,this.relativeElevation=0,w(t)&&ve(this._ray.origin,t),this._center=w(i)?un(i):F(),this._up=w(r)?un(r):Ke(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center)}get ray(){return Me(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){js(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get x(){return this._viewport[0]}set x(t){t+=this._padding[Ht.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(t){t+=this._padding[Ht.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[Ht.RIGHT]+this._padding[Ht.LEFT]}set fullWidth(t){this.width=t-(this._padding[Ht.RIGHT]+this._padding[Ht.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Ht.TOP]+this._padding[Ht.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Ht.TOP]+this._padding[Ht.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Ht.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Ht.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){this._padding[Ht.TOP]===t[Ht.TOP]&&this._padding[Ht.RIGHT]===t[Ht.RIGHT]&&this._padding[Ht.BOTTOM]===t[Ht.BOTTOM]&&this._padding[Ht.LEFT]===t[Ht.LEFT]||(this._viewport[0]+=t[Ht.LEFT]-this._padding[Ht.LEFT],this._viewport[1]+=t[Ht.BOTTOM]-this._padding[Ht.BOTTOM],this._viewport[2]-=t[Ht.RIGHT]+t[Ht.LEFT]-(this._padding[Ht.RIGHT]+this._padding[Ht.LEFT]),this._viewport[3]-=t[Ht.TOP]+t[Ht.BOTTOM]-(this._padding[Ht.TOP]+this._padding[Ht.BOTTOM]),Ap(this._padding,t),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&(hs(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const t=this.width,i=this.height,r=this.near*Math.tan(this.fovY/2),s=r*this.aspect;ume(this._projectionMatrix,-s*(1+2*this._padding[Ht.LEFT]/t),s*(1+2*this._padding[Ht.RIGHT]/t),-r*(1+2*this._padding[Ht.BOTTOM]/i),r*(1+2*this._padding[Ht.TOP]/i),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return N(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=Be()),this._inverseProjectionDirty&&Fs(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(t){js(this._projectionMatrix,t),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(t){this._fov=t,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return OWe(this._fov,this.width,this.height)}set fovX(t){this._fov=CWe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return RWe(this._fov,this.width,this.height)}set fovY(t){this._fov=AWe(t,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Pr(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Fs(this._viewInverseTransposeMatrix,this.viewMatrix),Kl(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const i=2*t-1;return 2*this.near*this.far/(this.far+this.near-i*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(t){ve(this._ray.origin,t.eye),ve(this._center,t.center),ve(this._up,t.up),Ap(this._viewport,t.viewport),Ap(this._padding,t.padding),zo(this._nearFar,t.nearFar),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const i=t;return this._viewDirty=i._viewDirty,this._viewDirty||(js(this._viewMatrix,t.viewMatrix),ve(this._viewRight,t.viewRight),ve(this._viewUp,t.viewUp),ve(this._viewForward,t.viewForward)),i._projectionDirty?this._projectionDirty=!0:(js(this._projectionMatrix,t.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=i._frustumDirty,this._frustumDirty||(R5(this._frustum,t.frustum),this._frustumDirty=!1),i._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(js(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Ap(this._fullViewport,t.fullViewport),this._pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new wr().copyFrom(this)}equals(t){return zl(this.eye,t.eye)&&zl(this._center,t.center)&&zl(this._up,t.up)&&cP(this._viewport,t.viewport)&&cP(this._padding,t.padding)&&f1e(this._nearFar,t.nearFar)&&this._fov===t.fov&&this._pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(this._pixelRatio!==t.pixelRatio||Math.abs(t.fov-this._fov)>=.001)return!1;const i=5e-4,r=1-1e-10;Bc(ga,t.eye,t.center),Bc(Y6,this.eye,this._center);const s=ke(ga,Y6),n=bG(ga),o=bG(Y6);return s*s>=r*n*o&&_Z(t.eye,this.eye)<Math.max(n,o)*i*i&&x4(t.padding,this._padding)<.5&&x4(t.viewport,this._viewport)<.5}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(SM(this.viewForward,Me(ga,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,i){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(i||1)))}getScreenCenter(t=ys()){return t[0]=(this.padding[Ht.LEFT]+this.width/2)/this._pixelRatio,t[1]=(this.padding[Ht.TOP]+this.height/2)/this._pixelRatio,t}getRenderCenter(t,i=.5,r=.5){return t[0]=this.padding[Ht.LEFT]+this.width*i,t[1]=this.padding[Ht.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const i=this.viewport,r=this.padding;t.setViewport(i[0]-r[3],i[1]-r[2],i[2]+r[1]+r[3],i[3]+r[0]+r[2])}applyProjection(t,i){t!==ui&&ve(ui,t),ui[3]=1,zu(ui,ui,this.projectionMatrix);const r=Math.abs(ui[3]);be(ui,ui,1/r);const s=this.fullViewport;i[0]=fi(0,s[0]+s[2],.5+.5*ui[0]),i[1]=fi(0,s[1]+s[3],.5+.5*ui[1]),i[2]=.5*(ui[2]+1),i[3]=r}unapplyProjection(t,i){const r=this.fullViewport;ui[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],ui[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],ui[2]=(2*t[2]-1)*t[3],ui[3]=t[3],zu(ui,ui,this.inverseProjectionMatrix),i[0]=ui[0],i[1]=ui[1],i[2]=ui[2]}projectToScreen(t,i){this.projectToRenderScreen(t,Q6),this.renderToScreen(Q6,i)}projectToRenderScreen(t,i){if(ui[0]=t[0],ui[1]=t[1],ui[2]=t[2],ui[3]=1,zu(ui,ui,this.viewProjectionMatrix),ui[3]===0)return null;be(ui,ui,1/Math.abs(ui[3]));const r=this.fullViewport;return"x"in i?(i.x=fi(0,r[0]+r[2],.5+.5*ui[0]),i.y=fi(0,r[1]+r[3],.5+.5*ui[1])):(i[0]=fi(0,r[0]+r[2],.5+.5*ui[0]),i[1]=fi(0,r[1]+r[3],.5+.5*ui[1]),i.length>2&&(i[2]=.5*(ui[2]+1))),i}unprojectFromScreen(t,i){return this.unprojectFromRenderScreen(this.screenToRender(t,Q6),i)}unprojectFromRenderScreen(t,i){if(hs(x$,this.projectionMatrix,this.viewMatrix),!Fs(x$,x$))return null;const r=this.fullViewport;return ui[0]=2*(t[0]-r[0])/r[2]-1,ui[1]=2*(t[1]-r[1])/r[3]-1,ui[2]=2*t[2]-1,ui[3]=1,zu(ui,ui,x$),ui[3]===0?null:(i[0]=ui[0]/ui[3],i[1]=ui[1]/ui[3],i[2]=ui[2]/ui[3],i)}constrainWindowSize(t,i,r,s=r){const n=t*this._pixelRatio,o=i*this._pixelRatio,a=Math.max(n-r/2,0),l=Math.max(this.fullHeight-o-s/2,0),c=-Math.min(n-r/2,0),h=-Math.min(this.fullHeight-o-s/2,0);return[a,l,r-c- -Math.min(this.fullWidth-n-r/2,0),s-h- -Math.min(o-s/2,0)]}computeUp(t){t===st.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,i){const r=t[0]*this._pixelRatio,s=this.fullHeight-t[1]*this._pixelRatio;return i[0]=r,i[1]=s,i}renderToScreen(t,i){const r=t[0]/this._pixelRatio,s=(this.fullHeight-t[1])/this._pixelRatio;i[0]=r,i[1]=s}_computeUpGlobal(){Me(ga,this.center,this.eye);const t=He(this.center);t<1?(fe(this._up,0,0,1),this._markViewDirty()):Math.abs(ke(ga,this.center))>.9999*He(ga)*t||(St(this._up,ga,this.center),St(this._up,this._up,ga),De(this._up,this._up),this._markViewDirty())}_computeUpLocal(){t0(ga,this.eye,this.center),Math.abs(ga[2])<=.9999&&(be(ga,ga,ga[2]),fe(this._up,-ga[0],-ga[1],1-ga[2]),De(this._up,this._up),this._markViewDirty())}_compareAndSetView(t,i){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?zl(t,i)||(ve(i,t),this._markViewDirty()):YXe.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(Ibe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(oU(this._viewMatrix,this.eye,this._center,this._up),fe(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),fe(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),fe(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const ui=di(),x$=Be(),ga=F(),Y6=F(),Q6=sa();var Ht;(function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"})(Ht||(Ht={}));const M5={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};class XQ{constructor(t){this.createCamera=t,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:M5.desiredScreenFlow},this.source=t(),this.target=t()}clone(){const t=new XQ(this.createCamera);return t.copyFrom(this),t}copyFrom(t){this.update(t.source,t.target,t.settings)}update(t,i,r){this.source!==t&&this.source.copyFrom(t),this.target!==i&&this.target.copyFrom(i),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=r.desiredScreenFlow!=null?r.desiredScreenFlow:M5.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(t){const i=this.target.pixelsPerPanAtZoom(t);return this.halfWindowSize/i}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class QXe{constructor(){this.segments=[]}get time(){return this.segments.reduce((t,i)=>t+i.time,0)}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1),t*=this.time;let r=0,s=0;const n=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(t<=a.time||o===this.segments.length-1){i=this.segmentInterpolateComponentsAt(a,t/a.time,i),n.hasPan?i.pan=(r+l.compared.pan*i.pan)/n.compared.pan:i.pan=1,n.hasRotate?i.rotate=(s+l.compared.rotate*i.rotate)/n.compared.rotate:i.rotate=1;const c=i.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,p=this.segments[this.segments.length-1].definition.compared.targetZoom;return n.hasZoom?i.zoom=(c-h)/(p-h):i.zoom=1,i}t-=a.time,r+=l.compared.pan,s+=l.compared.rotate}}segmentInterpolateComponentsAt(t,i,r){return t.interpolateComponentsAt(i,r)}}class J6{constructor(t){t&&this.update(t)}get time(){return this._time}update(t){t&&(this.definition?this.definition.copyFrom(t):this.definition=t.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const t=this.definition,i=t.compared,r=i.sourceZoom,s=i.targetZoom;this._zoomSign=r>s?1:-1,this._panPixelsAtSource=i.pan*t.source.pixelsPerPanAtZoom(r);const n=(t.source.pixelsPerRotateAtZoom(r)+t.target.pixelsPerRotateAtZoom(s))/2;this._rotatePixels=i.rotate*n}_updatePixelFlow(){const t=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom,{hasZoom:r,hasPan:s,hasRotate:n}=this.definition;let o=0,a=0;r&&(s&&(o=(i/t-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),n&&(a=this._zoomSign*(Math.log(t/i)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(r&&s&&n){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(r&&s){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(r&&n){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(s&&n){const c=this._panPixelsAtSource/this._rotatePixels,h=1+c;this._panPixelFlow=c/h*l,this._rotatePixelFlow=1/h*l}else s?this._panPixelFlow=l:r?this._zoomPixelFlow=l:n&&(this._rotatePixelFlow=l);this._time=n?this.rotateTime:r?this.zoomTime:s?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const t=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,i=t*this._panPixelsAtSource;return Math.log(i*(this._zoomPixelFlow/this._panPixelFlow)+1)/(t*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(t){if(t===0||t===1)return t;if(this.definition.hasZoom){const i=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom;return(i*(i/r)**-t-i)/(r-i)}return t}_interpolateComponentsPan(t){if(t===0||t===1)return t;if(this.definition.hasPan&&this.definition.hasZoom){const i=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(i*t*this._time)-1))/(i*Math.LN2)}return t}_interpolateComponentsRotate(t){return t}interpolateComponentsAt(t,i){t=Math.min(Math.max(t,0),1);const r=this._interpolateComponentsZoom(t),s=this._interpolateComponentsPan(t),n=this._interpolateComponentsRotate(t);return i?(i.zoom=r,i.pan=s,i.rotate=n):i={zoom:r,pan:s,rotate:n},i}}function JXe(e,t,i){const r=t-e.compared.sourceZoom,s=e.halfWindowPanAtZoom(r);return-e.halfWindowSize*(i.ascensionFactor*Math.LN2*e.compared.pan+s)*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2*s)}function KXe(e,t,i){const r=1/t,s=Math.log(e.compared.sourceZoom*r),n=1/e.desiredPixelFlow,o=1/Math.LN2,a=t-e.compared.sourceZoom,l=1/a,c=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(a))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*r*n*o*l*c-e.halfWindowSize*s*n*o*l+e.halfWindowSize*s*n*o*c/(a*a)}function eYe(e,t,i){const r=t-e.compared.sourceZoom,s=1/r,n=1/t,o=Math.log(e.compared.sourceZoom*n),a=(i.ascensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(r))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a+2*s*o+2*n-2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function tYe(e,t){return-e.halfWindowSize*Math.log(e.compared.sourceZoom/t)/(e.desiredPixelFlow*Math.LN2)}function iYe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function rYe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function sYe(e,t,i){return-e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t))}function nYe(e,t,i){return e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t))}function oYe(e,t,i){return-2*e.compared.pan*e.halfWindowSize*(i.ascensionFactor+i.descensionFactor-1)/(e.desiredPixelFlow*e.halfWindowPanAtZoom(t*t*t))}function aYe(e,t,i){return e.halfWindowSize*(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*e.halfWindowPanAtZoom(-t+e.compared.targetZoom))}function lYe(e,t,i){const r=Math.log(t/e.compared.targetZoom),s=1/e.desiredPixelFlow,n=1/Math.LN2,o=-t+e.compared.targetZoom,a=1/o,l=(-e.halfWindowPanAtZoom(t)-i.descensionFactor*Math.LN2*e.compared.pan+e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return-e.halfWindowSize*r*s*n*a+e.halfWindowSize*r*s*n*l/(o*o)+e.halfWindowSize*s*n*a*l/t}function cYe(e,t,i){const r=t-e.compared.targetZoom,s=1/r,n=1/t,o=Math.log(t/e.compared.targetZoom),a=(e.halfWindowPanAtZoom(t)+i.descensionFactor*Math.LN2*e.compared.pan-e.halfWindowPanAtZoom(e.compared.targetZoom))/e.halfWindowPanAtZoom(1);return e.halfWindowSize*s*(-2*s*n*a-2*s*o+2*n+2*o*a/(r*r)-a/(t*t))/(e.desiredPixelFlow*Math.LN2)}function uYe(e,t){return e.halfWindowSize*Math.log(t/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2)}function hYe(e,t){return e.halfWindowSize/(t*e.desiredPixelFlow*Math.LN2)}function dYe(e,t){return-e.halfWindowSize/(t*t*e.desiredPixelFlow*Math.LN2)}function pYe(e){const t=Math.LN2*e.compared.pan,i=e.compared.sourceZoom-e.compared.targetZoom,r=e.halfWindowPanAtZoom(i),s=e.halfWindowSize*Math.log(e.compared.sourceZoom/e.compared.targetZoom)/(e.desiredPixelFlow*Math.LN2*r);return e.compared.sourceZoom<=e.compared.targetZoom?s*(t-r):s*(t+r)}function fYe(e,t){let i=mYe(e,t);const r={ascensionFactor:t.ascensionFactor!=null?t.ascensionFactor:.5,descensionFactor:t.descensionFactor!=null?t.descensionFactor:.5},s=r.ascensionFactor===0,n=r.descensionFactor===0,o=s?tYe:JXe,a=s?iYe:KXe,l=s?rYe:eYe,c=n?uYe:aYe,h=n?hYe:lYe,p=n?dYe:cYe,m=M=>o(e,M,r)+sYe(e,M,r)+c(e,M,r),g=M=>a(e,M,r)+nYe(e,M,r)+h(e,M,r),v=M=>l(e,M,r)+oYe(e,M,r)+p(e,M,r);let b=m(i);const S=pYe(e);let T;const O=t.maximumIterations||20,C=t.maximumDistance!=null?t.maximumDistance:1/0;for(T=0;T<O;T++){const I=(g(i)+1e-6)/v(i);if(isNaN(I)||i>=C&&I<0){if(!isFinite(C))return null;i=C,b=m(i);break}if(i-=I,i<e.compared.sourceZoom||i<e.compared.targetZoom)return null;const $=m(i);if(Math.abs($-b)/b<=.005)break;b=$}return b>S*(1-.3)||i<e.compared.sourceZoom||i<e.compared.targetZoom?null:i}function mYe(e,t){const i=Math.max(e.compared.sourceZoom,e.compared.targetZoom),r=e.source.zoomAtPixelsPerPan(e.desiredPixelFlow/e.compared.pan)/2;return r<i?t.maximumDistance!=null?i+(t.maximumDistance-i)/2:1.5*i:t.maximumDistance?Math.min(t.maximumDistance,r):r}class gYe extends QXe{constructor(t,i){super(),this._preallocSegments=[new J6,new J6,new J6],this.update(t,i)}update(t,i){if(!t)return;this.definition?this.definition.copyFrom(t):this.definition=t.clone();let r=null;i&&i.apex&&(r=fYe(t,i.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,r==null?this._updateWithoutApex():this._updateWithApex(r,i.apex)}segmentInterpolateComponentsAt(t,i,r){return r=t.interpolateComponentsAt(i,r),t===this._ascensionSegment?r.zoom=BQ(r.zoom):t===this._descensionSegment&&(r.zoom=sz(r.zoom)),r}_updateWithApex(t,i){const[r,s,n]=this._preallocSegments,o=i.ascensionFactor!=null?i.ascensionFactor:.5,a=Math.min(1-o,i.ascensionFactor!=null?i.descensionFactor:.5),l=1-o-a;r.definition?r.definition.copyFrom(this.definition):r.definition=this.definition.clone(),r.definition.compared.targetZoom=t,r.definition.compared.pan=this.definition.compared.pan*o,r.definition.compared.rotate=this.definition.compared.rotate*o,r.update(),this._ascensionSegment=r,this.segments.push(r),l>0&&(s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.copyFrom(this.definition),s.definition.compared.sourceZoom=t,s.definition.compared.targetZoom=t,s.definition.compared.pan=this.definition.compared.pan*l,s.definition.compared.rotate=this.definition.compared.rotate*l,s.update(),this.segments.push(s)),n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.compared.sourceZoom=t,n.definition.compared.pan=this.definition.compared.pan*a,n.definition.compared.rotate=this.definition.compared.rotate*a,n.update(),this._descensionSegment=n,this.segments.push(n)}_updateWithoutApex(){const[t]=this._preallocSegments;t.update(this.definition),this.segments.push(t)}}const yYe={zoom:0,pan:0,rotate:0};class _Ye{constructor(t){this.createCamera=t,this._time=0,this.definition=new XQ(t),this.path=new gYe}get time(){return this._time}update(t,i,r){this.definition.update(t,i,r),this.path.update(this.definition,r),this._time=this._applyTimeSettings(Uhe(this.path.time),r),this._easing=r.easing?r.easing:this._time>=1e3?Rbe:dI}cameraAt(t,i){i=i||this.createCamera(),t=Math.min(Math.max(0,t),1),t=this._normalizedEasing(t);const r=this.path.interpolateComponentsAt(t,yYe);return i.interpolate(this.definition.source,this.definition.target,r),i}_normalizedEasing(t){const i=this._easing(0,this._time),r=this._easing(1,this._time);return(this._easing(t,this._time)-i)/(r-i)}_applyTimeSettings(t,i){const r=i.speedFactor!=null?i.speedFactor:1;i.duration!=null?t=i.duration:i.speedFactor!=null&&(t=t/r);const s=i.minDuration!=null?i.minDuration:M5.minDuration/r,n=i.maxDuration!=null?i.maxDuration:M5.maxDuration/r;return Math.min(Math.max(s,t),n)}}const vYe=F();class bYe{constructor(t){this.currentTime=0,this._animation=new _Ye(()=>new Une(t)),this._current=new Une(t)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(t,i,r){const s=this._animation.definition.source,n=this._animation.definition.target,o=Me(vYe,i.center,t.center),a=He(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),ve(s.lookAtDirection,o),ve(n.lookAtDirection,o),s.copyFromRenderCamera(t),n.copyFromRenderCamera(i),this._current.copyFrom(s),this._animation.update(s,n,r),this.currentTime=0,t.almostEquals(i)&&(this.currentTime=this._animation.time)}cameraAt(t,i){return this._animation.cameraAt(t,this._current),i=i||new wr,this._current.copyToRenderCamera(i),i}step(t,i){return this.finished||(this.currentTime=this.currentTime+Uhe(t),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,i)}}var os;(function(e){e.Ready="ready",e.Rejected="rejected",e.Running="running",e.Stopped="stopped",e.Finished="finished"})(os||(os={}));let Zw=class extends ze{constructor(){super(...arguments),this.state=os.Ready}get active(){return this.state===os.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=os.Stopped,!0)}finishController(){this.state=os.Finished}get steppingFinished(){return!1}};u([f({readOnly:!0})],Zw.prototype,"active",null),u([f()],Zw.prototype,"state",void 0),Zw=u([B("esri.views.3d.state.controllers.CameraController")],Zw);let a3=class extends Zw{get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject($i()),this._asyncResult=null),this.state===os.Finished||this.state===os.Stopped?this.state===os.Finished?e.resolve():e.reject($i()):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=os.Running,w(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!w(this.viewAnimation)||this.state!==os.Ready&&this.state!==os.Running||(this.viewAnimation.state===sC.State.FINISHED?this.finish():this.viewAnimation.state===sC.State.STOPPED&&(this.state=os.Stopped))}onControllerEnd(){w(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===os.Finished?this.viewAnimation.finish():this.state===os.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===os.Finished?this._asyncResult.resolve():this._asyncResult.reject($i()))}finish(){this.finishController()}};a3=u([B("esri.views.3d.state.controllers.AnimationController")],a3);let Ty=class extends a3{constructor(e){super(e),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new bYe(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new sC}get isInteractive(){return this.mode==="interaction"}begin(e,t){this.hasTarget=!0;const i=this.animationSettings(t);T$.copyFrom(this.view.state.camera);const r=wd(this.view.state.viewingMode);this.intersectionHelper.intersectRay(T$.ray,r,zne)&&(T$.center=zne),this.animation.update(T$,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(e,t){this.hasTarget&&this.animation.step(e,t)}onControllerEnd(e){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?DXe[e.easing]:e.easing}}};u([f({constructOnly:!0})],Ty.prototype,"view",void 0),u([f({constructOnly:!0})],Ty.prototype,"mode",void 0),Ty=u([B("esri.views.3d.state.controllers.PointToPointAnimationController")],Ty);const T$=new wr,zne=F();function Fbe(e,t,i){return wYe(e,e.screenToRender(t,ot.get()),i)}function wYe(e,t,i){const r=zo(ot.get(),t);if(r[2]=0,!e.unprojectFromRenderScreen(r,i.origin))return null;const s=zo(ot.get(),t);s[2]=1;const n=e.unprojectFromRenderScreen(s,ot.get());return N(n)?null:(Me(i.direction,n,i.origin),i)}function oA(e,t,i){return YQ(e,e.screenToRender(t,ot.get()),i)}function YQ(e,t,i){ve(i.origin,e.eye);const r=fe(ot.get(),t[0],t[1],1),s=e.unprojectFromRenderScreen(r,ot.get());return N(s)?null:(Me(i.direction,s,i.origin),i)}function QQ(e,t,i,r){const s=oA(t,i,xYe);return x1(e,s,r)}const xYe=Lo();var vC;(function(e){e[e.Ellipsoid=0]="Ellipsoid",e[e.Silhouette=1]="Silhouette"})(vC||(vC={}));const kbe=30,P5=[1,3e8],Ube=70;function mx(e,t,i){return i[0]=t[0]/(e.fullWidth/e.pixelRatio),i[1]=t[1]/(e.fullHeight/e.pixelRatio),i}function Yq(e){for(;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;return e}function p1(e,t,i){const r=ih($X.get(),i[3],i);N(r)||(Me(cr,e.eye,t),et(cr,cr,r),e.eye=Oe(cr,cr,t),Me(cr,e.center,t),et(cr,cr,r),e.center=Oe(cr,cr,t),e.up=et(cr,e.up,r))}function TYe(e,t,i,r){return gT(e,Fbe(t,i,eJ),r)}function Qq(e,t,i,r){return gT(e,oA(t,i,eJ),r)}function JQ(e,t,i,r){const s=ot.get();let n=1-i;Me(s,t,e.eye);const o=He(s);let a=o*(1-n);n>=0&&a<r&&(a=r,n=-(a-o)/o),Math.abs(o-a)<1e-6||(be(s,s,n),e.eye=Oe(cr,e.eye,s),e.center=Nn(cr,e.center,t,n))}function zbe(e,t,i){t.getScreenCenter(Bne),QQ(e,t,Bne,cr)&&(t.center=cr);const r=t.distance,s=r*i;if(Math.abs(r-s)<1e-6)return;const n=be(ot.get(),t.viewForward,s);t.eye=Me(cr,t.center,n)}const Bne=ys();function K6(e,t){fe(t,0,0,0);for(const i of e)Oe(t,t,i);be(t,t,1/e.length)}function SF(e,t,i,r){return Math.sin(e/He(t))*(i+r.radius)}function Vne(e,t,i,r){return SF(Math.PI/2,t,i,r)+(e-Math.PI/2)}var $o;(function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"})($o||($o={}));const Gne={Elevation:3e4,Angle:Jt(6)},UM={Pole:.95,Angle:Jt(18),Tilt:45},Bbe=Jt(80);function Vbe(e,t,i,r,s,n){const o=F(),a=Qn();let l=!0,c=!0;return e.intersectScreen(i,o,n)?a[3]=He(o):(c=!1,t.aboveGround&&s!==vC.Ellipsoid?a[3]=Math.max(He(t.center),.9*r.radius):a[3]=He(t.eye)-t.relativeElevation,s===vC.Silhouette?l3(a,t,i,o):l=QQ(a,t,i,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function nz(e,t,i,r){return He(e.eye)-r.radius>Gne.Elevation?$o.Horizontal:i?(oA(e,t,Qne),-Math.sign(e.relativeElevation)*(.5*Math.PI+NX(e.eye,Qne.direction))<Gne.Angle?$o.Vertical:$o.Horizontal):$o.Vertical}function Gbe(e,t,i){Me(e8,i,t),e.eye=Me(cr,e.eye,e8),e.center=Me(cr,e.center,e8)}const e8=F();function l3(e,t,i,r){const s=oA(t,i,eJ);return!N(s)&&(HC(e,s,S$),x1(e,s,r)?!(Yn(S$,s.origin)<Yn(r,s.origin))||(ve(r,S$),!1):(Me(eS,t.eye,t.center),De(eS,eS),uge(eS,-ke(De(eS,eS),S$),jne),gT(jne,s,r),!1))}const S$=F(),eS=F(),jne=Vi();function jbe(e,t,i,r,s,n){let o;if(St($5,e,t),Me(O$,e,t),He(e)<=s||!r.aboveGround){St(i,O$,r.eye);const a=ke(e,t)/(He(e)*He(t)),l=Math.cos(Xe(Kv.normalize(Jt(n)),0,Bbe));o=-Fn(a)-Math.max(0,He(t)-s)/(l*s)}else Me(Hne,r.eye,r.center),St(i,O$,Hne),o=-He(O$)/s;return De(i,i),be(i,i,He($5)),o}const Hne=F();function qne(e,t,i,r){let s,n;const o=Math.cos(Xe(Kv.normalize(Jt(r)),0,Bbe));return s=t>i?-(t-i)/(o*i):t<-i?Math.PI-(t+i)/(o*i):Fn(t/i),n=e>i?-(e-i)/(o*i):e<-i?Math.PI-(e+i)/(o*i):Fn(e/i),(n-s)*i}function SYe(e,t,i,r,s,n,o,a,l,c){const h=qne(e[2],t[2],o[3],l),p=c?qne(e[0],t[0],o[3],180):t[0]-e[0],m=Math.sin(a)*p-Math.cos(a)*h,g=Math.cos(a)*p+Math.sin(a)*h;De(cr,s);const v=c?m/Math.sqrt(Math.abs(o[3]**2-ke(i,cr)**2)):m/o[3],b=g/Math.sqrt(Math.abs(o[3]**2-ke(i,r)**2));Di(n,v,b)}function Hbe(e,t,i,r,s,n,o,a,l,c){St($5,e,t),mj(n.up,n.eye,E$,C$,A$),mj([0,0,1],n.eye,Iy,qv,Xbe),ve(i,qv),ve(r,Iy),De(i,i),be(i,i,He($5)),lte(e,De(C$,C$),De(A$,A$),De(E$,E$),Wne),lte(t,C$,A$,E$,Zne),SYe(Wne,Zne,e,Iy,qv,s,o,a,l,c)}function EYe(e,t,i,r,s,n,o){ih(I5,s,r),ih(L5,o,n),hs(j2,I5,L5),Me(t,e,i),et(t,t,j2),Oe(t,t,i)}function qbe(e,t,i,r,s,n){ih(I5,r,i),ih(L5,n,s),hs(j2,I5,L5),Me(cr,e.eye,t),et(cr,cr,j2),e.eye=Oe(cr,cr,t),Me(cr,e.center,t),et(cr,cr,j2),e.center=Oe(cr,cr,t),Me(cr,e.up,t),et(cr,cr,j2),e.up=Oe(cr,cr,t)}function KQ(e,t,i,r,s,n,o=UM.Pole,a=UM.Angle){const l=Math.abs(r)>Math.PI-a||Math.abs(r)<a,c=Math.abs(e[2])<i*o||Math.abs(t)>i;return!!(l&&c&&n.aboveGround&&s<UM.Tilt)}function Wbe(e,t,i,r,s,n){if(n)GP(i,r,Xne),p1(t,e,Xne);else{const o=jbe(i,r,Yne,t,e[3],s);p1(t,e,VP(Yne,o))}}function Zbe(e,t,i,r,s,n,o){const a=o?20:1,l=1e-12;let c,h;ve(tb,r),R$.copyFrom(t);for(let p=0;p<a&&Yn(i,tb)>l&&(c=Yn(i,tb),Hbe(i,tb,qv,Iy,lO,R$,e,s,n,o),qbe(R$,e,Iy,lO[1],qv,lO[0]),EYe(tb,tb,e,Iy,lO[1],qv,lO[0]),h=Yn(i,tb),h<c||p===0);p++)t.copyFrom(R$)}function CYe(e,t,i,r,s,n,o){KQ(i,ke(t.up,i),e[3],-Kv.normalize(Jt(s)),n,t,UM.Pole,UM.Angle)?Zbe(e,t,i,r,-Kv.normalize(Jt(s)),n,o):Wbe(e,t,i,r,n,o)}function AYe(e,t,i,r,s,n){const{eye:o}=e;mj([0,0,1],o,Iy,qv,Xbe);const a=t.translation[0]*i.pan,l=s.mode==="zoom"?0:t.translation[1]*i.pan,c=Math.max(Math.sqrt(Math.abs(1-ke(e.center,Iy)**2/He(e.center)**2)),.5),h=(Math.sin(n)*l+Math.cos(n)*a)/c,p=-Math.cos(n)*l+Math.sin(n)*a;switch(Dc(r.pan.matrix,r.pan.matrix,h,Iy),r.pan.enabled=!0,s.mode){case"pan":Dc(r.pan.matrix,r.pan.matrix,p,qv),r.pan.enabled=!0;break;case"zoom":r.zoom=-t.translation[1]*i.zoom}}function OYe(e,t,i,r,s){const{eye:n,viewRight:o}=e,a=St(ot.get(),o,n),l=t.translation[0]*i.pan;switch(l!==0&&(Dc(r.pan.matrix,r.pan.matrix,-l,a),r.pan.enabled=!0),s.mode){case"pan":{const c=t.translation[1]*i.pan;c!==0&&(Dc(r.pan.matrix,r.pan.matrix,c,o),r.pan.enabled=!0);break}case"zoom":r.zoom=-t.translation[1]*i.zoom}}function RYe(e,t,i,r,s,n,o,a,l){KQ(e.center,ke(e.up,e.center),He(e.center),-Kv.normalize(Jt(n)),o,t)?AYe(t,i,r,a,l,-Kv.normalize(Jt(s))):OYe(t,i,r,a,l)}const Iy=F(),qv=F(),Xbe=F(),E$=F(),C$=F(),A$=F(),Wne=F(),Zne=F(),lO=yt(),Xne=rA(),I5=Be(),L5=Be(),j2=Be(),tb=F(),cr=F(),O$=F(),R$=new wr,$5=F(),Yne=F(),eJ={origin:F(),direction:F()},Qne={origin:F(),direction:F()},Jne=.6,t8=4,MYe=12,PYe=60,IYe=200;let D5=class extends Ty{constructor(){super(...arguments),this.zoomLocation=F(),this.tmpCamera=new wr,this.tmpViewDir=F(),this.tmpRayDir={origin:F(),direction:F()},this.targetOnSphere=F(),this.tmpCenter=F(),this.constraintOptions={selection:Vr.ALL_EXCEPT_COLLISION,interactionType:oi.ZOOM,interactionFactor:null,interactionStartCamera:new wr,interactionDirection:null,tiltMode:ho.TUMBLE},this.sphere=Qn()}initialize(){this.intersector=wd(this.view.state.viewingMode)}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r);let s=!1,n=!1;this.intersectionHelper.intersectScreen(t,this.zoomLocation,this.view.map.ground.opacity===0?LYe:{})&&(s=e>0,n=!0),this.tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ve(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,e,this.zoomLocation,t,n),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:dI}}_updateCamera(e,t,i,r,s){const n=ji(this.view.spatialReference),o=nz(e,r,s,n);let a;this.view.camera.position.hasZ&&(a=Math.abs(this.view.camera.position.z)),De(P$,e.eye),be(P$,P$,-1),oA(e,r,this.tmpRayDir),De(this.tmpRayDir.direction,this.tmpRayDir.direction);const l=Math.max(Math.min(MYe,1/Math.abs(ke(P$,this.tmpRayDir.direction)))*a,IYe);if(o===$o.Horizontal){let c=Jne**t;this.sphere[3]=He(i),Me(this.tmpViewDir,e.center,e.eye);const h=Math.min(He(this.tmpViewDir),l);let p=h*c;if(c<=1&&p<t8&&(p=t8,c=p/h),Math.abs(h-p)<1e-6)return;const m=He(e.center);if(this.sphere[3]!==m){const g=this.sphere[3]+c*(m-this.sphere[3]);e.center=be(M$,e.center,g/m)}be(this.tmpViewDir,this.tmpViewDir,-c),e.eye=Oe(M$,e.center,this.tmpViewDir),Ds(this.view,e,this.constraintOptions),Yn(i,e.center)>1e-12&&QQ(this.sphere,e,r,this.targetOnSphere)&&CYe(this.sphere,e,i,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let c=Jne**Math.abs(t);const h=t>0?1:-1;Me(this.tmpViewDir,i,e.eye);const p=He(this.tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,r[0],r[1],this.view.state.camera,PYe);let g=m?Math.min(l,m):l;g=s?Math.min(g,p):g,be(this.tmpRayDir.direction,this.tmpRayDir.direction,g),Oe(i,this.tmpRayDir.origin,this.tmpRayDir.direction);let v=g*c;const b=Math.max(t8,1.01*e.nearFar[0]);if(t>0&&v<b&&(v=b,c=v/g),Math.abs(g-v)<1e-6)return;be(this.tmpRayDir.direction,this.tmpRayDir.direction,h*(1-c)),e.eye=Oe(M$,e.eye,this.tmpRayDir.direction),e.center=Oe(M$,e.center,this.tmpRayDir.direction)}nA(this.view,e)}};D5=u([B("esri.views.3d.state.controllers.global.ZoomStepController")],D5);const M$=F(),P$=F(),LYe={exclude:new Set([Sp])},$Ye=.6,DYe=4,NYe=60,FYe=14,kYe=200;let N5=class extends Ty{constructor(){super(...arguments),this.zoomLocation=F(),this.tmpCamera=new wr,this.tmpRayDir=F(),this.tmpCenter=F(),this.constraintOptions={selection:Vr.ALL,interactionType:oi.ZOOM,interactionFactor:null,interactionStartCamera:new wr,interactionDirection:null,tiltMode:ho.TUMBLE}}zoomStep(e,t){if(!this.active)return;const i=this.view.state,{interactionStartCamera:r}=this.constraintOptions;this.animation.finished?r.copyFrom(i.camera):this.animation.cameraAt(1,r),this.tmpCamera.copyFrom(i.camera);const s=wd(this.view.state.viewingMode);e>0?(this.view.map.ground.opacity===0?this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation,zYe):this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,s,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:ve(this.zoomLocation,this.tmpCamera.center);const n=$Ye**e;let o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,t[0],t[1],this.view.state.camera,NYe);Me(I$,this.tmpCamera.eye,this.zoomLocation),De(I$,I$);const a=Math.max(Math.min(FYe,1/Math.abs(ke(UYe,I$)))*Math.abs(this.view.camera.position.z),kYe);if(o=o?Math.min(o,a):a,o){const l=F();Me(l,this.zoomLocation,this.tmpCamera.eye),o<He(l)&&(De(l,l),Oe(this.zoomLocation,this.tmpCamera.eye,be(l,l,o)))}this._updateCamera(this.tmpCamera,n,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:600,easing:dI}}_updateCamera(e,t,i){Me(this.tmpRayDir,i,e.eye);const r=He(this.tmpRayDir);let s=r*t;const n=t<=1,o=Math.max(DYe,1.01*e.nearFar[0]);n&&s<o&&(s=o,t=s/r),Math.abs(r-s)<1e-6||(be(this.tmpRayDir,this.tmpRayDir,t),e.eye=Me(Kne,i,this.tmpRayDir),e.center=Nn(Kne,e.center,i,1-t),Ds(this.view,e,this.constraintOptions))}};N5=u([B("esri.views.3d.state.controllers.local.ZoomStepController")],N5);const Kne=F(),UYe=Ke(0,0,1),I$=F(),zYe={exclude:new Set([Sp])};function BYe(e,t){switch(t){case"primary":return e.pointerType==="touch"||e.button===0;case"secondary":return e.pointerType!=="touch"&&e.button===2;case"tertiary":return e.pointerType!=="touch"&&e.button===1}}function tJ(e,t){if(e.pointerType==="touch")return!1;switch(t){case"primary":return e.button===0;case"secondary":return e.button===2;case"tertiary":return e.button===1}}class VYe extends ua{constructor(t,i){super(!0),this.view=t,this.registerIncoming("double-click",i,r=>this._handleDoubleClick(r))}_handleDoubleClick(t){const i=t.data;if(BYe(i,"primary")){const r=this.view.state.isGlobal?new D5({view:this.view,mode:"animation"}):new N5({view:this.view,mode:"animation"});this.view.state.switchCameraController(r),r.zoomStep(Math.log(.5)/Math.log(.6),ys(i.x,i.y)),t.stopPropagation()}}}let f1=class extends Zw{constructor(){super(...arguments),this.startCamera=new wr,this.currentCamera=new wr}get isInteractive(){return!0}stepController(e,t){t.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(t)}onControllerStart(e){this.state=os.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}};f1=u([B("esri.views.3d.state.controllers.InteractiveController")],f1);var Ec;(function(e){e[e.CENTER=0]="CENTER",e[e.EYE=1]="EYE"})(Ec||(Ec={}));const GYe=7,i8=90;let Xw=class extends f1{constructor(e){super(e),this.view=null,this.pivot=Ec.CENTER,this.lastPoint=yt(),this.tmpWorldUp=F(),this.tmpViewDir=F(),this.tmpRotCurPoint=yt(),this.tmpTransf=Be(),this.tmpAxis=F(),this.tmpPivotPoint=F(),this.pivotPos=F(),this.constraintOptions={selection:Vr.ALL,interactionType:oi.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===Ec.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Ec.EYE:ve(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=oi.LOOK_AROUND,this.constraintOptions.tiltMode=ho.LOOK_AROUND,this.constraintOptions.selection=Vr.NONE;break;case Ec.CENTER:{const t=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);t||ve(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(e,t),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=oi.TUMBLE,this.constraintOptions.tiltMode=ho.TUMBLE,this.constraintOptions.selection=Vr.ALL&~Vr.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,mx(this.startCamera,e,this.lastPoint)}}_constrainPivotPoint(e,t){const i=this.startCamera,r=F();Me(r,this.pivotPos,i.eye);const s=He(r);let n=Math.min(s,GYe*Math.abs(this.view.camera.position.z));const o=ji(this.view.spatialReference),a=ys(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),l=nz(this.startCamera,a,!0,o);let c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*i8,i8),h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,i8);c===void 0&&h===void 0||(c=c===void 0?h:c,h=h===void 0||l===$o.Horizontal?c:h,n=c>h?h:c,n=t?Math.min(n,s):n),De(r,r),ve(this.pivotPos,Oe(this.tmpPivotPoint,i.eye,be(this.tmpPivotPoint,r,n)))}update(e){if(this.active){switch(this.pivot){case Ec.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this.pivotPos);break;case Ec.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this.pivotPos)}Ds(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(e,t,i,r){this.view.renderCoordsHelper.worldUpAtPosition(r,this.tmpWorldUp),mx(e,t,this.tmpRotCurPoint);let s=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,n=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;Me(this.tmpViewDir,i,r);const o=He(this.tmpViewDir),a=Fn(ke(this.tmpViewDir,this.tmpWorldUp)/o);if(this.pivot===Ec.EYE){s*=-.5;const l=.5*Math.PI-a,c=.5*Math.PI*.99;s=l-Math.max(-c,Math.min(c,l+s))}return s=Xe(s+a,ta.min,ta.max)-a,St(this.tmpAxis,e.up,this.tmpViewDir),this.pivot===Ec.CENTER&&(n=-n),ih(this.tmpTransf,n,this.tmpWorldUp),Dc(this.tmpTransf,this.tmpTransf,s,this.tmpAxis),et(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),e.up=et(r8,e.up,this.tmpTransf),Oe(r8,r,this.tmpViewDir),zo(this.lastPoint,this.tmpRotCurPoint),r8}};u([f({constructOnly:!0})],Xw.prototype,"view",void 0),u([f()],Xw.prototype,"pivot",void 0),Xw=u([B("esri.views.3d.state.controllers.RotateController")],Xw);const r8=F();class s8 extends ua{constructor(t,i,r,s){super(!0),this.view=t,this.pointerAction=i,this.pivot=r,this.registerIncoming("drag",s,n=>this._handleDrag(n))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!tJ(t.data,this.pointerAction))return;const r=ys(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new Xw({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}let EF=class extends f1{constructor(e){super(e),this.view=null,this.pickPoint=F(),this.tmpP0=yt(),this.panAxisAngle=rA(),this.tmpRayDir=F(),this.tmpRayDirPick=F(),this.targetOnSphere=F(),this.tmpRay={origin:F(),direction:F()},this.dragBeginPoint=ys(),this.normalizedAnchorPoint=yt(),this.constraintOptions={selection:Vr.ALL_EXCEPT_COLLISION,interactionType:oi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE},this.sphere=Qn(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;zo(this.dragBeginPoint,e),mx(this.startCamera,e,this.normalizedAnchorPoint);const t=ji(this.view.spatialReference),i=Vbe(this.intersectionHelper,this.startCamera,e,t,vC.Ellipsoid,this.view.map.ground.opacity===0?jYe:{});if(this.navMode=nz(this.startCamera,e,i.hasGeometryIntersection,t),this.navMode===$o.Horizontal)this.hasPickPoint=!!i.scenePickPoint,this.pickPoint=i.scenePickPoint,this.sphere=i.sphere;else{let r,s;oA(this.startCamera,e,this.tmpRay),De(this.tmpRay.direction,this.tmpRay.direction),i.scenePickPoint&&(Me(this.tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),s=He(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let n=Xe(kbe*r,P5[0],P5[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,Ube);n=o?Math.min(n,o):n,n=i.scenePickPoint?Math.min(n,s):n,this.hasPickPoint=!0,be(this.tmpRay.direction,this.tmpRay.direction,n),Oe(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===$o.Horizontal){Me(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const t=He(this.tmpRayDir);mx(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;if(this.hasPickPoint&&r<t){const n=1-(1-r/t)*(1-this.sphere[3]/He(this.currentCamera.center));this.currentCamera.center=be(L$,this.currentCamera.center,n)}be(this.tmpRayDir,this.tmpRayDir,-r/t),this.currentCamera.eye=Oe(L$,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=bp(this.dragBeginPoint,e),Ds(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(l3(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),GP(this.pickPoint,this.targetOnSphere,this.panAxisAngle),p1(this.currentCamera,this.sphere,this.panAxisAngle))}else{const t=He(this.tmpRay.direction);mx(this.currentCamera,e,this.tmpP0);const i=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let r=t*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&r<s&&(r=s),Math.abs(t-r)<1e-6)return;be(this.tmpRayDir,this.tmpRay.direction,1-r/t),this.currentCamera.eye=Oe(L$,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=Oe(L$,this.currentCamera.center,this.tmpRayDir)}nA(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};u([f({constructOnly:!0})],EF.prototype,"view",void 0),EF=u([B("esri.views.3d.state.controllers.global.ZoomController")],EF);const L$=F(),jYe={exclude:new Set([Sp])};let CF=class extends f1{constructor(e){super(e),this.view=null,this.tmpP=F(),this.tmpDir=F(),this.tmpN=F(),this.tmpP0=yt(),this.tmpPoi=F(),this.tmpRayDir=F(),this.dragBeginPoint=ys(),this.normalizedAnchorPoint=yt(),this.constraintOptions={selection:Vr.ALL,interactionType:oi.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:F(),tiltMode:ho.TUMBLE},this.plane=Vi()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;zo(this.dragBeginPoint,e),mx(this.startCamera,e,this.normalizedAnchorPoint);const t=this.intersectionHelper.intersectScreenFreePointFallback(e,this.tmpP,this.view.map.ground.opacity===0?HYe:{});Me(this.tmpDir,this.tmpP,this.startCamera.eye);const i=He(this.tmpDir);let r;De(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(r=Math.abs(this.view.camera.position.z));let s=Xe(kbe*r,P5[0],P5[1]);const n=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,Ube);s=n?Math.min(s,n):s,s=t?Math.min(s,i):s,be(this.tmpDir,this.tmpDir,s),Oe(this.tmpP,this.startCamera.eye,this.tmpDir),Me(this.tmpN,this.startCamera.eye,this.startCamera.center),De(this.tmpN,this.tmpN),this.tmpN[1]<0&&Ra(this.tmpN,this.tmpN),ZE(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;TYe(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||ve(this.tmpPoi,this.currentCamera.center),mx(this.currentCamera,e,this.tmpP0);let t=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);zo(this.normalizedAnchorPoint,this.tmpP0),Me(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const i=He(this.tmpRayDir);let r=i*(1-t);ve(this.constraintOptions.interactionDirection,this.tmpRayDir),be(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(t)/i);const s=this.view.state.constraints.minimumPoiDistance;t>=0&&r<s&&(r=s,t=-(r-i)/i),Math.abs(i-r)<1e-6||(be(this.tmpRayDir,this.tmpRayDir,t),this.currentCamera.eye=Oe(ib,this.currentCamera.eye,this.tmpRayDir),Nn(ib,this.currentCamera.center,this.tmpPoi,t),this.tmpPoi[2]>this.startCamera.center[2]?ib[2]=Math.max(this.startCamera.center[2],ib[2]):ib[2]=Math.min(this.startCamera.center[2],ib[2]),this.currentCamera.center=ib,this.constraintOptions.interactionFactor=bp(this.dragBeginPoint,e),Ds(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};u([f({constructOnly:!0})],CF.prototype,"view",void 0),CF=u([B("esri.views.3d.state.controllers.local.ZoomController")],CF);const ib=F(),HYe={exclude:new Set([Sp])};class qYe extends ua{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){const i=t.data;if(i.pointers.size>1||!tJ(t.data,this.pointerAction))return;const r=ys(i.center.x,i.center.y);switch(i.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.view.state.isGlobal?this.cameraController=new EF({view:this.view}):this.cameraController=new CF({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":this.cameraController&&this.cameraController.update(r);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}t.stopPropagation()}}const WYe=F(),$$=F();function iJ(){return{direction:F(),up:F()}}function Ybe(e,t,i,r,s){let n=De(WYe,e),o=ke(n,r);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(ke(t,r)),o<.99?(ve(n,t),a&&be(n,n,-1)):n=null);let l=0;if(n){be($$,r,ke(r,n)),Me(n,n,$$);const h=ke(n,s)/(He(n)*He(s));St($$,n,s),l=(ke($$,r)>0?1:-1)*Vc(Fn(h))}const c=Vc(Fn(-ke(r,e)/He(e)));return i?(i.heading=l,i.tilt=c,i):{heading:l,tilt:c}}const Qbe=Ke(0,1,0),Jbe=Ke(0,0,1),cO=Be(),vg=F(),bg=F();function Kbe(e,t,i,r=iJ()){const{direction:s,up:n}=r;return ame(cO,-Jt(t)),GE(cO,cO,Jt(i)),et(s,Jbe,cO),be(s,s,-1),et(n,Qbe,cO),r}function ZYe(e,t,i,r){return Ybe(t,i,r,Jbe,Qbe)}function XYe(e,t,i,r){const s=Kbe(e,i,r),n=F();return be(n,s.direction,-t),Oe(n,n,e),{up:s.up,eye:n,heading:i,tilt:r}}function YYe(e){return Vc(e)}function QYe(e){return Jt(e)}function ewe(e,t,i,r,s){const n=e.renderSpatialReference,o=e.map&&e.spatialReference||t.spatialReference;return po(t,vg,n),po(t,bg,n),vg[0]-=i/2,bg[0]+=i/2,vg[1]-=r/2,bg[1]+=r/2,$n(vg,n,vg,o),$n(bg,n,bg,o),s?(s.xmin=vg[0],s.ymin=vg[1],s.xmax=bg[0],s.ymax=bg[1],s.spatialReference=o):s=new zi(vg[0],vg[1],bg[0],bg[1],o),s}const JYe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:Kbe,directionToHeadingTilt:ZYe,eyeForCenterWithHeadingTilt:XYe,lookAtTiltToEyeTilt:YYe,eyeTiltToLookAtTilt:QYe,toExtent:ewe},Symbol.toStringTag,{value:"Module"})),twe=Ke(0,0,1),iwe=De(F(),Ke(1,1,1)),KYe=new Jv(-180,180),uO=Be(),rv=F(),tS=F();function rwe(e,t,i,r=iJ()){St(rv,e,twe),ke(rv,rv)===0&&St(rv,e,iwe),ih(uO,-Jt(t),e),Dc(uO,uO,-Jt(i),rv);const{up:s,direction:n}=r;return St(s,rv,e),De(s,s),et(s,s,uO),De(n,e),Ra(n,n),et(n,n,uO),r}function eQe(e,t,i,r){const s=rv,n=tS;return De(s,e),St(tS,s,twe),ke(tS,tS)===0&&St(tS,s,iwe),St(n,tS,s),Ybe(t,i,r,s,n)}function tQe(e,t,i,r){const s={eye:F(),up:null,tilt:r,heading:i},n=rv;n[0]=e[0],n[1]=e[2],n[2]=-e[1];const o=t,a=Jt(i),l=Jt(r),c=Math.sin(a),h=Math.cos(a),p=Math.sin(l),m=Math.cos(l),g=He(n);let v;if(Math.abs(l)<1e-8)v=o+g;else{const pe=g/p,z=Hp(o/pe),j=Math.PI-l-z;v=pe*Math.sin(j)}const b=m*o,S=o*o*(p*p),T=h*h*S,O=v-b,C=O*O,M=T*(T+C-n[1]*n[1]);if(M<0)return be(s.eye,n,v/g),s.tilt=0,s;const I=Math.sqrt(M),$=n[1]*O,U=T+C;let q;if(q=h>0?-I+$:I+$,Math.abs(U)<1e-8)return g<1e-8?(s.eye[0]=0,s.eye[1]=0,s.eye[2]=o):be(s.eye,n,v/g),s.tilt=0,n8(s.eye),o8(s,e);s.eye[1]=q/U;const G=c*c*S,Y=p*o,J=h*Y*s.eye[1],X=s.eye[1]*s.eye[1],ne=1-X,re=Math.sqrt(ne),ye=T*X+G-2*J*re*O+ne*C;return Math.abs(ye)<1e-8?(be(s.eye,n,v/g),s.tilt=0,n8(s.eye),o8(s,e)):(s.eye[0]=(ne*(v*n[0]-b*n[0])-Y*re*(n[0]*s.eye[1]*h+n[2]*c))/ye,s.eye[2]=(ne*(v*n[2]-b*n[2])-Y*re*(n[2]*s.eye[1]*h-n[0]*c))/ye,be(s.eye,s.eye,v),n8(s.eye),o8(s,e))}function n8(e){const t=e[1];e[1]=-e[2],e[2]=t}function o8(e,t){const i=rwe(t,e.heading,e.tilt);return e.up=i.up,e}function iQe(e,t,i){const r=He(t),s=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-e)),n=Hp(i/(s/Math.sin(e)));return Vc(e-n)}function rQe(e,t,i){const r=Jt(e),s=He(t);return Hp(i/(s/Math.sin(r)))+r}function swe(e,t,i,r,s){let n,o,a,l;const c=t.latitude,h=ji(e.spatialReference).radius,p=t.longitude,m=rZe(c,i,h)/2;n=p-m,o=p+m;const g=Jt(c),v=(1+Math.sin(g))/(1-Math.sin(g)),b=(v+1)*Math.tan(r/h/2),S=b*b;function T(C){const M=Math.PI/2;return(C=POe.normalize(C,-M))>M&&(C=Math.PI-C),C}if(a=1.5*Math.PI-2*Math.atan(.5*(b+Math.sqrt(4*v+S))),l=a+r/h,a=T(a),l=T(l),l<a){const C=l;l=a,a=C}if(a=Math.max(Vc(a),-90),l=Math.min(Vc(l),90),o=KYe.monotonic(n,o),o-n>180){const C=(o-n-180)/2;n+=C,o-=C}const O=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:wt.WGS84;return s?(s.xmin=n,s.ymin=a,s.xmax=o,s.ymax=l,s.spatialReference=O):s=new zi(n,a,o,l,O),e.spatialReference&&e.spatialReference.isWebMercator&&Ay(s,!1,s),s}const sQe=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:rwe,directionToHeadingTilt:eQe,eyeForCenterWithHeadingTilt:tQe,lookAtTiltToEyeTilt:iQe,eyeTiltToLookAtTilt:rQe,toExtent:swe},Symbol.toStringTag,{value:"Module"}));function F5(e){return e.type==="point"}class nwe{constructor(t,i=null,r=0){this.array=t,this.spatialReference=i,this.offset=r}}function owe(e){return"array"in e}function mm(e,t,i="ground"){if(F5(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(owe(t)){let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,$t(t.spatialReference,e.spatialReference),i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}function k5(e,t){return e!=null&&(t==null||(t===st.Local?!e.isGeographic||e.isWGS84||e.wkid===nd.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===nd.CGCS2000||e.wkid===nd.GCSMARS2000||e.wkid===nd.GCSMARS2000_SPHERE||e.wkid===nd.GCSMOON2000))}const awe=Ie.getLogger("esri.views.3d.support.cameraUtils"),lwe=39.37,cwe=96,Jq=1,nQe=8,oQe=5,uwe=1,eoe=F(),D$=F(),aQe={heading:0,tilt:0},my=new xt,lQe=new Jv(-20037508342788905e-9,20037508342788905e-9),cQe=new Jv(-180,180);var aa;function pI(e){return e.spatialReference||wt.WGS84}function aA(e){return e.viewingMode==="global"?sQe:JYe}function uQe(e,t,i,r,s){return aA(e).headingTiltToDirectionUp(t,i,r,s)}function cy(e,t){if(N(t))return null;const i=e.renderSpatialReference,r=aA(e).headingTiltToDirectionUp,s=F();if(!po(t.position,s,i))return null;const n=r(s,t.heading,t.tilt);be(n.direction,n.direction,e.state.camera.distance),Oe(n.direction,n.direction,s);const o=xT(e,s,n.direction,n.up);return o.fov=Jt(t.fov),o}(function(e){e[e.LOCKED=0]="LOCKED",e[e.ADJUST=1]="ADJUST"})(aa||(aa={}));const iS=F();function bC(e,t,i){const r=e.renderSpatialReference,s=oz(e,t.eye,t.viewForward,t.up,aQe);let n=pI(e);return $n(t.eye,r,iS,n)||(n=wt.WGS84,$n(t.eye,r,iS,n)),N(i)?new jc(new xt(iS,n),s.heading,s.tilt,Vc(t.fov)):(i.position.x=iS[0],i.position.y=iS[1],i.position.z=iS[2],i.position.spatialReference=n,i.heading=s.heading,i.tilt=s.tilt,i.fov=Vc(t.fov),i)}function rJ(e,t,i){const r=e.state.camera,s=r.width/2/r.pixelRatio;return e.renderCoordsHelper.viewingMode===st.Global&&i!=null&&(t*=Math.cos(Jt(i))),t/=e.renderCoordsHelper.unitInMeters,s/(cwe*lwe/t)/Math.tan(r.fovX/2)}function Qx(e,t,i){const r=e.state.camera,s=t*Math.tan(r.fovX/2),n=r.width/2/r.pixelRatio;let o=cwe*lwe/(n/s);return e.renderCoordsHelper.viewingMode===st.Global&&(o/=Math.cos(Jt(i))),o*=e.renderCoordsHelper.unitInMeters,o}function hwe(e,t,i,r,s,n){return dwe(e,t,rJ(e,i,t.latitude),r,s,n)}function dwe(e,t,i,r,s,n){if(gx(n)){const a=new lA(n.signal);return c3(e,r.heading,r.tilt,t,i,s,a),void a.resolver.promise.then(l=>{const c=z5(e,l,r.fov);if(!N(c))return n.resolver.resolve(c);n.resolver.reject()},l=>n.resolver.reject(l))}const o=c3(e,r.heading,r.tilt,t,i,s);return z5(e,o,r.fov,n)}function oz(e,t,i,r,s){return aA(e).directionToHeadingTilt(t,i,r,s)}function hQe(e,t){return!!(e.basemapTerrain&&e.renderCoordsHelper.fromRenderCoords(t,my,e.spatialReference)&&$t(mm(e.elevationProvider,my),0)>my.z-uwe)}async function dQe(e,t,i){if(!e.renderCoordsHelper.fromRenderCoords(t,my,e.spatialReference))return!1;const r=await e.elevationProvider.queryElevation(my.x,my.y,my.z,my.spatialReference,"ground",i);return $t(r,0)>my.z-uwe}async function pQe(e,t,i){const r=F();if(t)if(t instanceof xt){if(po(t,r,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const s=await e.elevationProvider.queryElevation(t.x,t.y,t.z,t.spatialReference,"ground",i);return w(s)&&e.renderCoordsHelper.setAltitude(r,s),r}}else ve(r,t);else ve(r,e.state.camera.center);return r}function fQe(e,t){const i=F();if(t&&t instanceof xt){if(po(t,i,e.renderSpatialReference),t.z==null&&e.basemapTerrain!=null){const r=mm(e.elevationProvider,t);w(r)&&e.renderCoordsHelper.setAltitude(i,r)}}else ve(i,t||e.state.camera.center);return i}function c3(e,t,i,r,s,n,o){const a=r&&r instanceof xt?r:null;if(gx(o))return pQe(e,r,o.signal).then(c=>{Kq(e,t,i,a,c,s,n,o)},c=>o.resolver.reject(c)),null;const l=fQe(e,r);return Kq(e,t,i,a,l,s,n,o)}function Kq(e,t,i,r,s,n,o,a){if(N(r)){const p=e.renderSpatialReference;if(r=i1(s,p,pI(e)),N(r))return null}n=Math.max(n,e.state.constraints.minimumPoiDistance);const l=yQe(e,t,i,s,n,o),c=(0,aA(e).eyeForCenterWithHeadingTilt)(s,n,l.heading,l.tilt);if(o===aa.ADJUST&&e.viewingMode==="global"&&i>0){const p=()=>{const g=pwe(e,s,n,vQe(e,n,i,s));return o=i-g<1?aa.LOCKED:aa.ADJUST,Kq(e,t,g,r,s,n,o,a)},m=e.map.ground.navigationConstraint;if(!m||m.type==="stay-above"){if(hQe(e,c.eye))return p();if(gx(a))return dQe(e,c.eye,a.signal).then(g=>g?p():(a.resolver.resolve({eye:c.eye,up:c.up,center:un(s),heading:c.heading,tilt:c.tilt}),null)),null}}const h=!a||gx(a)?{center:F(),eye:F(),up:F(),tilt:0,heading:0}:a;return h.eye=c.eye,h.up=c.up,h.center=un(s),h.heading=c.heading,h.tilt=c.tilt,gx(a)&&a.resolver.resolve(h),h}function zM(e,t,i,r,s,n=null){const o=t.zmax!=null&&t.zmin!=null;let a,l,c;if(e.state.isGlobal){if(!k5(t.spatialReference,st.Global))return gx(n)&&n.resolver.reject(),null;const T=new xt(t.xmin,t.ymin,t.spatialReference),O=new xt(t.xmax,t.ymax,t.spatialReference),C=t.spatialReference.isGeographic?cQe:lQe;a=new xt({x:C.center(T.x,O.x),y:(O.y+T.y)/2,z:o?(t.zmax+t.zmin)/2:null,spatialReference:t.spatialReference});const M=ji(t.spatialReference),I=iZe(a,T,O);l=I.lon,c=I.lat,C.diff(T.x,O.x)>C.range/2&&(l+=M.halfCircumference),l=Math.min(l,M.halfCircumference),c=Math.min(c,M.halfCircumference)}else{const T=$t(e.renderSpatialReference,t.spatialReference);T.equals(t.spatialReference)||(t=Z3(t,T)),l=t.xmax-t.xmin,c=t.ymax-t.ymin;const O=o?(t.zmax+t.zmin)/2:null;a=new xt({x:t.xmin+.5*l,y:t.ymin+.5*c,z:O,spatialReference:T})}const h=o?t.zmax-t.zmin:0,p=e.state.camera,m=1/Math.tan(p.fovX/2),g=1/Math.tan(p.fovY/2),v=1/Math.tan(p.fov/2),b=Math.max(.5*l*m,.5*c*g,.5*h*v)/Jq;if(gx(n)){const T=new lA(n.signal);return c3(e,i,r,a,b,s,T),void T.resolver.promise.then(O=>{const C=z5(e,O,e.camera.fov);if(!N(C))return n.resolver.resolve(C);n.resolver.reject()},O=>n.resolver.reject(O))}const S=c3(e,i,r,a,b,s);return z5(e,S,e.camera.fov,n)}function mQe(e,t,i){const r=e.renderSpatialReference,s=i1(i,r,pI(e));if(N(s))return null;const n=Math.tan(t.fovX/2),o=Math.tan(t.fovY/2),a=yZ(t.eye,i),l=2*a*n*Jq,c=2*a*o*Jq;return e.viewingMode==="global"?swe(e,s,l,c):ewe(e,s,l,c)}function gQe(e,t,i){const r=e.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(i/r)/Math.LN2>nQe)return!0;const s=e.renderSpatialReference,n=pI(e),o=i1(t,s,n),a=i1(e.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s,n);if(N(o)||N(a))return!1;const l=Math.tan(.5*e.state.camera.fov)*r;return a.distance(o)/l>oQe}function yQe(e,t,i,r,s,n){let o=0;return n===aa.ADJUST&&gQe(e,r,s)?(t=0,o=_Qe(e,s,i,r)):o=sJ(e,r,s,i),o=e.state.constraints.clampTilt(s,o),{heading:t,tilt:i=pwe(e,r,s,o)}}const U5=.7;function _Qe(e,t,i,r){const s=e.state.constraints.tilt(t);s.max=Math.min(s.max,.5*Math.PI);const n=s.min*(1-U5)+s.max*U5,o=sJ(e,r,t,i);return Math.min(o,n)}function vQe(e,t,i,r){const s=e.state.constraints.tilt(t);let n=sJ(e,r,t,i);return n=Math.min(n,.5*Math.PI),s.min*(1-U5)+n*U5}function pwe(e,t,i,r){return aA(e).lookAtTiltToEyeTilt(r,t,i)}function sJ(e,t,i,r){return aA(e).eyeTiltToLookAtTilt(r,t,i)}function z5(e,t,i,r){if(N(t))return null;const s=e.renderSpatialReference,n=i1(t.eye,s,pI(e));return N(n)?null:w(r)?(r.position=n,r.heading=t.heading,r.tilt=t.tilt,r.fov=i,r):new jc(n,t.heading,t.tilt,i)}function fwe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.levelAtScale(t);awe.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function mwe(e,t){var r;const i=(r=e.basemapTerrain)==null?void 0:r.tilingScheme;if(i)return i.scaleAtLevel(t);awe.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function bQe(e,t){return e.spatialReference?Rge(t,e.spatialReference):void 0}function gwe(e,t,i){const r=e.renderSpatialReference;let s,n;t||(t=e.state.camera);const o=wt.WGS84;return t instanceof jc?(s=t.position.latitude,po(t.position,eoe,r),po(i,D$,r),n=Pr(eoe,D$)):($n(t.center,r,D$,o),s=D$[1],n=t.distance),Qx(e,n,s)}class lA{constructor(t){this.signal=t,this.resolver=Gp()}}function gx(e){return e&&"resolver"in e}function zd(e){let t=e*e;return e<0&&(t*=-1),t}function toe(e,t,i){const r=i,s=e.state,n=e.device,o=t.tiltDirection==="forward-down"?1:-1,a=1;return n.deviceType==="standard"?(r.translation[0]=zd(s.axes[0]),r.translation[1]=zd(s.axes[1]),r.translation[2]=zd(s.buttons[7])-zd(s.buttons[6]),r.heading=zd(s.axes[2]),r.tilt=zd(s.axes[3])):n.deviceType==="spacemouse"&&(r.translation[0]=1.2*zd(s.axes[0]),r.translation[1]=1.2*zd(s.axes[1]),r.translation[2]=2*-zd(s.axes[2]),r.heading=1.2*zd(s.axes[5]),r.tilt=1.2*zd(s.axes[3])),r.tilt*=o,be(r.translation,r.translation,a),r}function ioe(e,t){const i=t;return i.translation[0]=e[1]-e[0],i.translation[1]=e[3]-e[2],i.translation[2]=e[4]-e[5],i.heading=e[7]-e[6],i.tilt=e[8]-e[9],i.zoom=e[10]-e[11],i}function a8(e){return e.translation[0]===0&&e.translation[1]===0&&e.translation[2]===0&&e.heading===0&&e.tilt===0&&e.zoom===0}let hv=class extends f1{constructor(e){super(e),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new wr,this.constraintOptions={selection:Vr.ALL,interactionType:oi.NONE,interactionStartCamera:new wr,interactionFactor:0,interactionDirection:null,tiltMode:ho.LOOK_AROUND}}handleEventGamepad(e){const t=toe(e,this.view.navigation.gamepad,this.transformation);(e.action==="end"||a8(t))&&this.finishController()}activateDirection(e){this.keysButtonState[e]=1,ioe(this.keysButtonState,this.transformation)}deactivateDirection(e){this.keysButtonState[e]=0;const t=ioe(this.keysButtonState,this.transformation);a8(t)&&this.finishController()}onControllerStart(e){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const t=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this.filteredSurfaceElevation+=i*(t-this.filteredSurfaceElevation)*e}stepController(e,t){this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(t),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,rb),this._applyDisabledMovementTypes(rb),this._applyPan(rb.pan),this._applyRotate(rb.rotate),this._applyZoom(rb.zoom),this._applyAscend(rb.ascend),this.constraintOptions.interactionType=oi.NONE,this.constraintOptions.selection=Vr.COLLISION,Ds(this.view,this.currentCamera,this.constraintOptions),super.stepController(e,t)}_updateStartHeading(){this.transformation.heading!==0&&(this.headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const t=this.currentCamera;Me(yl,t.center,t.eye),et(yl,yl,e.matrix),t.center=Oe(yl,yl,t.eye),t.up=et(yl,t.up,e.matrix),this.constraintOptions.interactionType=oi.LOOK_AROUND,this.constraintOptions.selection=Vr.ALL_EXCEPT_COLLISION,Ds(this.view,t,this.constraintOptions)}_applyPan(e,t=this.currentCamera){!e.enabled||(t.eye=et(yl,t.eye,e.matrix),t.center=et(yl,t.center,e.matrix),this.view.state.isGlobal&&(t.up=et(yl,t.up,e.matrix)),this.constraintOptions.interactionType=oi.PAN,this.constraintOptions.selection=Vr.ALL,Ds(this.view,t,this.constraintOptions))}_applyZoom(e){if(!e)return;const t=this.currentCamera.viewForward;this.currentCamera.eye=Oe(yl,this.currentCamera.eye,be(ot.get(),t,e)),ve(hO,t),Ra(hO,hO),this.constraintOptions.interactionDirection=hO,this.constraintOptions.interactionType=oi.ZOOM,this.constraintOptions.selection=Vr.ALL_EXCEPT_COLLISION,Ds(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const t=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,ot.get());if(this.constraintOptions.interactionDirection=ve(hO,t),this.view.state.isGlobal){const i=He(this.currentCamera.eye),r=(i+e)/i;this.currentCamera.eye=be(yl,this.currentCamera.eye,r),this.currentCamera.center=be(yl,this.currentCamera.center,r)}else{const i=be(ot.get(),t,e);this.currentCamera.eye=Oe(yl,this.currentCamera.eye,i),this.currentCamera.center=Oe(yl,this.currentCamera.center,i)}this._updateCameraCenter(),this.constraintOptions.interactionType=oi.ASCEND,this.constraintOptions.selection=Vr.COLLISION,Ds(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=Vr.ALL_EXCEPT_COLLISION,Ds(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(e,t,i){AQe(i);const r=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(r,t,i):this._calculateControlTransformationGlobal(r,t,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,t=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=t.intersectManifoldClosestSilhouette(i,e,yl)}_calculateControlTransformationLocal(e,t,i){const{viewRight:r,viewForward:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=fe(ot.get(),s[0],s[1],0);De(a,a);const l=n.translation[0]*e.pan;if(l!==0){const v=be(ot.get(),r,l);hl(i.pan.matrix,i.pan.matrix,v),i.pan.enabled=!0}switch(o.mode){case"pan":{const v=-n.translation[1]*e.pan;if(v!==0){const b=be(ot.get(),a,v);hl(i.pan.matrix,i.pan.matrix,b),i.pan.enabled=!0}i.zoom=n.zoom*e.zoom;break}case"zoom":i.zoom=(-n.translation[1]+n.zoom)*e.zoom;break;default:o.mode}const c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Dc(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(t.eye,ot.get())),i.rotate.enabled=!0);const p=n.tilt*e.rotate,m=d1(this.view.renderCoordsHelper,t.center,t.eye),g=Xe(m+p,ta.min,ta.max)-m;g&&(Dc(i.rotate.matrix,i.rotate.matrix,g,r),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,t,i){const{eye:r,viewRight:s}=t,n=this.transformation,o=this.view.navigation.gamepad,a=St(ot.get(),s,r);De(a,a),Ra(a,a),RYe(this.startCamera,t,n,e,this.view.camera.heading,this.headingStart,this.view.camera.tilt,i,o),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(rb.pan,this.tmpCamera);const l=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,c=n.translation[2]*e.ascend;i.ascend=c;const h=-n.heading*e.rotate;h!==0&&(Dc(i.rotate.matrix,i.rotate.matrix,h,this.tmpCamera.eye),i.rotate.enabled=!0);const p=n.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(p,t.ray,l);m!==0&&(Dc(i.rotate.matrix,i.rotate.matrix,m,this.tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=n.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,t,i){const r=ji(this.view.spatialReference),s=SF(ta.min,t.origin,i,r);let n=0,o=0;const a=ot.get();if(this.view.renderCoordsHelper.intersectManifold(t,i,a)){const l=d1(this.view.renderCoordsHelper,a,t.origin);n=SF(l,t.origin,i,r),o=SF(ta.max,t.origin,i,r)}else{HC(uU(hU,i+r.radius),t,a);const l=Fn(-ke(t.direction,De(a,a)));n=Vne(l,t.origin,i,r),o=Vne(ta.max,t.origin,i,r)}return Xe(n+e,s,o)-n}_getPointAbsoluteSurfaceElevation(e,t,i){const{renderCoordsHelper:r}=this.view,s=r.getAltitude(e),n=t+Math.abs(s-t);return r.setAltitude(i,n,e),n}_clampedDistanceToSurface(e,t){const{renderCoordsHelper:i}=this.view,{camera:r}=this.view.state,{direction:s}=uQe(this.view,t,0,ywe,CQe),n=i.intersectManifoldClosestSilhouette(sh(t,s),e,ot.get()),o=Pr(t,n),a=i.intersectManifoldClosestSilhouette(sh(t,t0(ot.get(),t,r.center)),e,ot.get()),l=Pr(t,a);return Math.min(o,l)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:t,state:i}=this.view,{camera:r,isGlobal:s}=i,n=t.intersectManifoldClosestSilhouette(r.ray,this.filteredSurfaceElevation,ot.get());if(s){const o=Me(ot.get(),e,n),a=He(o);be(o,o,1/a);const l=De(ot.get(),e),c=Fn(ke(l,o));return a*Math.sin(Math.min(xQe,c))}{const o=ve(ot.get(),e);return t.setAltitude(o,this.filteredSurfaceElevation),Pr(n,o)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:TQe}_computeVelocities(e){const t=this.filteredSurfaceElevation,i=t+ji(this.view.spatialReference).radius,{camera:r,isGlobal:s}=this.view.state,n=ot.get(),o=this._getPointAbsoluteSurfaceElevation(r.eye,t,n),a=this._clampedDistanceToSurface(t,n),l=r.width/2,c=roe*r.width,h=roe*r.width,p=a*Math.tan(.5*r.fovX)/l,m=p/i,g=p/this._computeHeadingRotateRadius(n),v=o-t;return{pan:(s?m:p)*c*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(c*e/l)*v-v),zoom:2**(c*e/l)*a-a,rotate:Xe(g*h,SQe,EQe)*e}}_applyDisabledMovementTypes(e){!w(this.disableMovements)||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&Im(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&Im(e.rotate.matrix))}static activatesFor(e,t){const i=toe(t,e.navigation.gamepad,wQe);return!(t.action==="end"||a8(i))}};u([f({constructOnly:!0})],hv.prototype,"view",void 0),u([f({constructOnly:!0})],hv.prototype,"gamepadDevice",void 0),u([f({constructOnly:!0})],hv.prototype,"disableMovements",void 0),hv=u([B("esri.views.3d.state.controllers.GamepadKeyboardController")],hv);const wQe={translation:[0,0,0],heading:0,tilt:0,zoom:0},ywe=80,xQe=Jt(ywe),roe=.75,TQe=5,SQe=Jt(30),EQe=Jt(80),rb={zoom:0,ascend:0,pan:{enabled:!1,matrix:Be()},rotate:{enabled:!1,matrix:Be()}},yl=F(),hO=F(),CQe=iJ();function AQe(e){e.zoom=0,e.ascend=0,e.pan.enabled=!1,Im(e.pan.matrix),e.rotate.enabled=!1,Im(e.rotate.matrix)}class OQe extends ua{constructor(t){super(!0),this.view=t,this.watchHandles=new xi,this.handle=this.registerIncoming("gamepad",i=>this._handleEventGamepad(i)),this.handle.pause()}onInstall(t){super.onInstall(t),this.watchHandles.add([xe(()=>this.view.navigation.gamepad.enabled,i=>{i?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},si),xe(()=>this.view.navigation.gamepad.device,i=>{this.cameraControllerGamepad&&i&&this.cameraControllerGamepad.gamepadDevice!==i&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(t){const i=this.view.navigation.gamepad.device;if(i&&t.data.device!==i)return;const r=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(r||hv.activatesFor(this.view,t.data)){if(!r){const s=new hv({view:this.view,gamepadDevice:t.data.device});this.view.state.switchCameraController(s)&&(this.cameraControllerGamepad=s)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===t.data.device&&this.cameraControllerGamepad.handleEventGamepad(t.data)}}}var vc;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.FORWARD=2]="FORWARD",e[e.BACKWARD=3]="BACKWARD",e[e.UP=4]="UP",e[e.DOWN=5]="DOWN",e[e.HEADINGLEFT=6]="HEADINGLEFT",e[e.HEADINGRIGHT=7]="HEADINGRIGHT",e[e.TILTUP=8]="TILTUP",e[e.TILTDOWN=9]="TILTDOWN",e[e.ZOOMIN=10]="ZOOMIN",e[e.ZOOMOUT=11]="ZOOMOUT"})(vc||(vc={}));class RQe extends ua{constructor(t,i){super(!0),this.view=t,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:st.Local},this.keyToNumber={[i.left]:vc.LEFT,[i.right]:vc.RIGHT,[i.forward]:vc.FORWARD,[i.backward]:vc.BACKWARD,[i.up]:vc.UP,[i.down]:vc.DOWN,[i.headingLeft]:vc.HEADINGLEFT,[i.headingRight]:vc.HEADINGRIGHT,[i.tiltUp]:vc.TILTUP,[i.tiltDown]:vc.TILTDOWN,[i.zoomIn]:vc.ZOOMIN,[i.zoomOut]:vc.ZOOMOUT},this.registerIncoming("key-down",null,r=>this._handleKeyDown(r)),this.registerIncoming("key-up",null,r=>this._handleKeyUp(r)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new hv({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(i),t.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(t){if(t.data.native.ctrlKey||t.data.native.metaKey)return;const i=this.keyToNumber[t.data.key];i!=null&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(i),t.stopPropagation())}}class MQe extends ua{constructor(t,i){super(!0),this.view=t,this.registerIncoming("mouse-wheel",i,r=>this._handleMouseWheel(r))}_handleMouseWheel(t){if(!this.view.navigation.mouseWheelZoomEnabled)return;const i=t.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new D5({view:this.view,mode:"interaction"}):new N5({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*i.deltaY,ys(i.x,i.y)),t.preventDefault(),t.stopPropagation()}}class B5{constructor(t){this._gain=t}reset(t){this._value=t}set gain(t){this._gain=t}get value(){return this._value===void 0?0:this._value}update(t){this._value===void 0?this._value=t:this._value=this._gain*t+(1-this._gain)*this._value}}let Wv=class extends a3{constructor(e){super(e),this.view=null,this.beginCamera=new wr,this.elapsedTimeSec=0,this.constraintOptions={selection:Vr.ALL,interactionType:oi.PAN,interactionFactor:0,interactionStartCamera:new wr,interactionDirection:null,tiltMode:ho.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new sC}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(e){this.beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(e)}stepController(e,t){t.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=e,this.momentumStep(this.elapsedTimeSec,t),Ds(this.view,t,this.constraintOptions)}};u([f({constructOnly:!0})],Wv.prototype,"view",void 0),Wv=u([B("esri.views.3d.state.controllers.momentum.MomentumController")],Wv);let BM=class extends Wv{constructor(e){super(e),this.interactionType=oi.PAN,this.tmpPan=F()}momentumStep(e,t){const i=this.momentum.value(e);be(this.tmpPan,this.momentum.direction,i),t.eye=Me(soe,t.eye,this.tmpPan),t.center=Me(soe,t.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};u([f({constructOnly:!0})],BM.prototype,"momentum",void 0),BM=u([B("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],BM);const soe=F(),PQe=F(),N$=F();let AF=class extends Wv{constructor(e){super(e),this.interactionType=oi.PAN}momentumStep(e,t){const i=this.momentum.value1(e),r=this.momentum.value2(e);ve(N$,t.eye),De(N$,N$),St(this.momentum.axis2,N$,this.momentum.axis1),qbe(t,PQe,this.momentum.axis1,i,this.momentum.axis2,r)}};u([f({constructOnly:!0})],AF.prototype,"momentum",void 0),AF=u([B("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],AF);let Lw=class extends Wv{constructor(e){super(e),this.interactionType=oi.TUMBLE}set center(e){this._set("center",un(e))}set axis(e){this._set("axis",un(e))}momentumStep(e,t){const i=this.momentum.value(e);p1(t,this.center,VP(this.axis,i))}};u([f({constructOnly:!0})],Lw.prototype,"momentum",void 0),u([f({constructOnly:!0})],Lw.prototype,"center",null),u([f({constructOnly:!0})],Lw.prototype,"axis",null),Lw=u([B("esri.views.3d.state.controllers.momentum.MomentumController")],Lw);let H2=class extends Wv{constructor(e){super(e),this.interactionType=oi.ZOOM,this.constraintOptions.interactionDirection=F()}set zoomCenter(e){this._set("zoomCenter",un(e))}momentumStep(e,t){ve(this.constraintOptions.interactionDirection,t.eye);const i=this.momentum.valueDelta(0,e);JQ(t,this.zoomCenter,i,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=t0(this.constraintOptions.interactionDirection,t.eye,this.constraintOptions.interactionDirection)}};u([f({constructOnly:!0})],H2.prototype,"momentum",void 0),u([f({constructOnly:!0})],H2.prototype,"zoomCenter",null),H2=u([B("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],H2);let aw=class extends Wv{constructor(e){super(e),this.interactionType=oi.ZOOM,this.radius=0,this.tmpSceneCenter=F(),this.tmpZoomAxisAngle=rA(),this.sphere=Qn()}set screenCenter(e){this._set("screenCenter",ys(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",un(e))}initialize(){this.sphere[3]=this.radius}momentumStep(e,t){const i=this.momentum.valueDelta(0,e);zbe(this.sphere,t,i),this.constraintOptions.interactionType=oi.ZOOM,Ds(this.view,t,this.constraintOptions),l3(this.sphere,t,this.screenCenter,this.tmpSceneCenter),GP(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),p1(t,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=oi.PAN}};u([f({constructOnly:!0})],aw.prototype,"momentum",void 0),u([f({constructOnly:!0})],aw.prototype,"screenCenter",null),u([f({constructOnly:!0})],aw.prototype,"sceneCenter",null),u([f({constructOnly:!0})],aw.prototype,"radius",void 0),aw=u([B("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],aw);class wp{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const i=this.computeDelta(t);this._updateDelta(i)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return this.lastValue!==void 0}get hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class az{constructor(t,i,r){this._initialVelocity=t,this._stopVelocity=i,this._friction=r,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,i){const r=this.value(t);return this.value(t+i)-r}valueFromInitialVelocity(t,i){i=Math.min(i,this.duration);const r=1-this.friction;return t*(r**i-1)/Math.log(r)}}class IQe extends az{constructor(t,i,r,s,n){super(t,i,r),this.sceneVelocity=s,this.direction=n}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class _we{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.time=new wp(.6),this.screen=[new wp(.4),new wp(.4)],this.scene=[new wp(.6),new wp(.6),new wp(.6)],this.tmpDirection=F()}add(t,i,r){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(r)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(i[0]),this.scene[1].update(i[1]),this.scene[2].update(i[2]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){fe(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=He(this.tmpDirection);s>0&&be(this.tmpDirection,this.tmpDirection,1/s);const n=s/this.time.filteredDelta;return new IQe(t,i,r,n,this.tmpDirection)}}class noe{constructor(t){this.gain=t}update(t){this.hasFilteredValue?this.filteredValue=(1-this.gain)*this.filteredValue+this.gain*t:this.filteredValue=t}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}}const ooe=1e-5;class LQe extends az{constructor(t,i,r,s,n,o=0,a){super(t,i,r),this.angularVelocity1=s,this.axis1=n,this.angularVelocity2=o,this.axis2=a}value1(t){return super.valueFromInitialVelocity(this.angularVelocity1,t)}value2(t){return super.valueFromInitialVelocity(this.angularVelocity2,t)}}class $Qe{constructor(t=300,i=12,r=.84){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.enabled=!0,this.tmpAxis1=F(),this.tmpAxis2=F(),this.tmpAngles=yt(),this.time=new wp(.3),this.screen=[new wp(.4),new wp(.4)],this.angle1=new noe(.6),this.angle2=new noe(.6),this.axis1=F(),this.axis2=F(),this.lastScene=F()}addMomentumDirectRotation(t,i,r,s,n,o){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;let a=jbe(this.lastScene,i,this.tmpAxis2,s,n,o);this.angle2.update(0),rl(this.tmpAxis2)<ooe?a=0:De(this.axis1,this.tmpAxis2),this.angle1.update(a),ve(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}addMomentumPreserveHeading(t,i,r,s,n,o,a){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(r)<.01)return;Hbe(this.lastScene,i,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,s,n,o,a,!1),rl(this.tmpAxis2)<ooe?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),De(this.axis1,this.tmpAxis1),De(this.axis2,this.tmpAxis2)),ve(this.lastScene,i)}this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.time.update(r)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,i=this.screen[1].filteredDelta,r=Math.sqrt(t*t+i*i)/this.time.filteredDelta;return Math.abs(r)<this.minimumInitialVelocity?null:this.createMomentum(r,this.stopVelocity,this.friction)}createMomentum(t,i,r){const s=this.angle1.filteredValue/this.time.filteredDelta,n=this.angle2.filteredValue/this.time.filteredDelta;return new LQe(t,i,r,s,this.axis1,n,this.axis2)}}class vwe{constructor(t=2.5,i=.01,r=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=i,this.friction=r,this.maxVelocity=s,this.enabled=!0,this.value=new wp(.8),this.time=new wp(.3)}add(t,i){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(i)<.01)return;if(this.value.hasFilteredDelta){const r=this.value.computeDelta(t);this.value.filteredDelta*r<0&&this.value.reset()}}this.time.update(i),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=Xe(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,i,r){return new az(t,i,r)}}class bwe extends vwe{constructor(t=3,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){if(this.value.hasLastValue){const r=this.value.lastValue;let s=t-r;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;t=r+s}super.add(t,i)}}class DQe extends az{constructor(t,i,r){super(t,i,r)}value(t){const i=super.value(t);return Math.exp(i)}valueDelta(t,i){const r=super.value(t),s=super.value(t+i)-r;return Math.exp(s)}}class wwe extends vwe{constructor(t=2.5,i=.01,r=.95,s=12){super(t,i,r,s)}add(t,i){super.add(Math.log(t),i)}createMomentum(t,i,r){return new DQe(t,i,r)}}let OF=class extends f1{constructor(e){super(e),this.view=null,this.smoothRotation=new B5(.05),this.rotationAxis=F(),this.panningPlane=Vi(),this.smoothScaling=new B5(.05),this.zoomCenterScreen=ys(),this.zoomMomentumEstimator=new wwe,this.rotationMomentumEstimator=new bwe,this.panSphericalMomentumEstimator=new $Qe,this.panPlanarMomentumEstimator=new _we,this.adjustedSphere=Qn(),this.tmp3d=F(),this.tmpScreenPointArray=ys(),this.beginScreenPoint=ys(),this.beginScenePoint=F(),this.screenPickPoint=ys(),this.navMode=$o.Horizontal,this.tmpInteractionDirection=F(),this.constraintOptions={selection:Vr.ALL,interactionType:oi.NONE,interactionFactor:0,interactionStartCamera:new wr,interactionDirection:null,tiltMode:ho.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panPlanarMomentumEstimator.enabled=t,this.panSphericalMomentumEstimator.enabled=t,this.beginHeading=-Kv.normalize(Jt(this.view.camera.heading)),this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.smoothRotation.reset(),gy(e.center,this.screenPickPoint),zo(this.beginScreenPoint,this.screenPickPoint);const i=ji(this.view.spatialReference),r=Vbe(this.intersectionHelper,this.startCamera,this.screenPickPoint,i,vC.Silhouette);this.scenePickPoint=r.scenePickPoint,this.sphere=r.sphere,ve(this.beginScenePoint,this.scenePickPoint),this.navMode=nz(this.startCamera,this.screenPickPoint,r.hasGeometryIntersection,i),this.navMode===$o.Vertical&&this._preparePlanarPanMode(e),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(e){const t=Ra(this.tmp3d,this.startCamera.viewForward);ZE(this.scenePickPoint,t,this.panningPlane);const i=ys(this.screenPickPoint[0],0),r=F(),s=He(this.startCamera.eye);this.adjustedSphere[3]=s<this.sphere[3]?s-100:this.sphere[3],l3(this.adjustedSphere,this.startCamera,i,r);const n=sa();this.startCamera.projectToRenderScreen(r,n);const o=.9*n[1];this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],o);const a=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);a&&ZE(this.scenePickPoint,this.panningPlane,this.panningPlane);const l=F(),c=F(),h=F(),p=80,m=5,g=50;Me(l,this.scenePickPoint,this.currentCamera.eye);const v=He(l);De(l,l);const b=m*Math.max(Math.abs(this.view.camera.position.z),g),S=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,p);let T=S?Math.min(S,b):b;T=a?Math.min(T,v):T,ve(h,Oe(c,this.currentCamera.eye,be(c,l,T))),this.panningPlane[3]=-ke(this.panningPlane,h),this.startCamera.center=Oe(c,this.startCamera.eye,be(c,this.startCamera.viewForward,T));const O=gy(e.center,this.tmpScreenPointArray);Qq(this.panningPlane,this.startCamera,O,this.beginScenePoint)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1;this.navMode===$o.Horizontal?(t&&this._zoomSpherical(e),this._panningSpherical(e),t&&this._rotateSpherical(e)):(t&&this._zoomPlanar(e),this._panningPlanar(e),t&&this._rotatePlanar(e))}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return this.navMode===$o.Horizontal?new aw({view:this.view,momentum:t,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new H2({view:this.view,momentum:t,zoomCenter:this.beginScenePoint});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Lw({view:this.view,momentum:i,center:this.sphere,axis:this.rotationAxis});if(this.navMode===$o.Horizontal){const r=this.panSphericalMomentumEstimator.evaluateMomentum();if(r)return new AF({view:this.view,momentum:r})}else{const r=this.panPlanarMomentumEstimator.evaluateMomentum();if(r)return new BM({view:this.view,momentum:r})}return null}_zoomSpherical(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),zbe(this.sphere,this.currentCamera,this.smoothScaling.value),gy(e.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),this.constraintOptions.interactionType=oi.ZOOM,this.constraintOptions.interactionFactor=bp(e.radius-this.beginRadius),Ds(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(e){const t=gy(e.center,this.tmpScreenPointArray);l3(this.sphere,this.currentCamera,t,this.tmp3d),KQ(this.beginScenePoint,ke(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(Zbe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(Wbe(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(t,this.tmp3d,.001*e.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=oi.PAN,this.constraintOptions.interactionFactor=bp(this.screenPickPoint,t),Ds(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(e){De(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||Ra(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value,i=t+Yq(e.angle-t),r=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=r,this.smoothRotation.update(i);const s=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(s,.001*e.timestamp),p1(this.currentCamera,this.sphere,VP(this.rotationAxis,s)),this.constraintOptions.interactionType=oi.TUMBLE,this.constraintOptions.interactionFactor=bp(e.radius*i),Ds(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(e){const t=gy(e.center,this.tmpScreenPointArray);Qq(this.panningPlane,this.currentCamera,t,this.tmp3d)&&(Gbe(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(t,this.tmp3d,.001*e.timestamp),this.constraintOptions.interactionType=oi.PAN,this.constraintOptions.interactionFactor=bp(this.beginScreenPoint,t),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),Ds(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(e){const t=this.beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this.smoothScaling.gain=i,this.smoothScaling.update(t),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*e.timestamp),JQ(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=oi.ZOOM,this.constraintOptions.interactionFactor=bp(e.radius-this.beginRadius),Ds(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(e){ve(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||Ra(this.rotationAxis,this.rotationAxis);const t=this.smoothRotation.value;let i=e.angle-t;i=Yq(i);const r=t+i,s=.00125*Math.min(Math.max(e.radius,40),120);this.smoothRotation.gain=s,this.smoothRotation.update(r);const n=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(n,.001*e.timestamp),p1(this.currentCamera,this.sphere,VP(this.rotationAxis,n)),this.constraintOptions.interactionType=oi.TUMBLE,this.constraintOptions.interactionFactor=bp(e.radius*n),Ds(this.view,this.currentCamera,this.constraintOptions)}};u([f({constructOnly:!0})],OF.prototype,"view",void 0),OF=u([B("esri.views.3d.state.controllers.global.PinchAndPanController")],OF);const aoe=Ke(0,0,1),NQe={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI},FQe=80;let RF=class extends f1{constructor(e){super(e),this.view=null,this.rotationValueSmooth=new B5(.05),this.scalingValueSmooth=new B5(.05),this.planeHorizontal=Vi(),this.planeVertical=Vi(),this.rotationMomentumEstimator=new bwe,this.panMomentumEstimator=new _we(300,12,.9),this.zoomMomentumEstimator=new wwe,this.beginCenter=F(),this.tmpPoints=[],this.beginCenterScreen=ys(),this.tmpCentroid3d=F(),this.tmpCentroid2d=ys(),this.tmp2d=ys(),this.constraintOptions={selection:Vr.ALL,interactionType:oi.NONE,interactionFactor:0,interactionStartCamera:new wr,interactionDirection:null,tiltMode:ho.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;const t=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=t,this.rotationMomentumEstimator.enabled=t,this.panMomentumEstimator.enabled=t,this.beginRadius=e.radius,this.pointerCount=e.pointers.size,this.beginAngle=e.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),gy(e.center,this.beginCenterScreen),uge(aoe,0,this.planeHorizontal);const i=F(),r=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,i),s=F();Ra(s,this.startCamera.viewForward);const n=F();ve(n,aoe);const o=ke(s,n),a=Hp(o<0?-o:o);if(this.panMode=a>=NQe.ANGLE_THRESHOLD?$o.Horizontal:$o.Vertical,dj(this.planeHorizontal,this.planeHorizontal,i),this.startCamera.aboveGround||pj(this.planeHorizontal,this.planeHorizontal),this.panMode===$o.Vertical){be(n,n,o),Me(this.planeVertical,s,n),De(this.planeVertical,this.planeVertical),dj(this.planeVertical,this.planeVertical,i);const l=F(),c=F(),h=F();Me(l,i,this.currentCamera.eye);const p=He(l);De(l,l);const m=5*Math.max(Math.abs(this.view.camera.position.z),50),g=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,FQe);let v=g?Math.min(g,m):m;v=r?Math.min(v,p):v,ve(h,Oe(c,this.currentCamera.eye,be(c,l,v))),this.planeVertical[3]=-ke(this.planeVertical,h),this.computePlanePoints(e.pointers,this.planeVertical,this.startCamera,this.tmpPoints),K6(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(e.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),K6(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const t=e.pointers.size>1,i=this.panMode===$o.Horizontal?this.planeHorizontal:this.planeVertical,r=this.beginCenter;if(t){const s=this.beginRadius/e.radius,n=.001875*Math.min(Math.max(e.radius,40),120);this.scalingValueSmooth.gain=n,this.scalingValueSmooth.update(s),JQ(this.currentCamera,r,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*e.timestamp),this.constraintOptions.interactionType=oi.ZOOM,this.constraintOptions.interactionFactor=bp(Math.abs(e.radius-this.beginRadius)),Ds(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(e.pointers,i,this.currentCamera,this.tmpPoints),K6(this.tmpPoints,this.tmpCentroid3d),gy(e.center,this.tmpCentroid2d),Gbe(this.currentCamera,r,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*e.timestamp),this.constraintOptions.interactionType=oi.PAN,this.constraintOptions.interactionFactor=bp(this.beginCenterScreen,this.tmpCentroid2d),Ds(this.view,this.currentCamera,this.constraintOptions),t){const s=this.planeHorizontal,n=r,o=this.rotationValueSmooth.value,a=o+Yq(e.angle-o),l=.00125*Math.min(Math.max(e.radius,40),120);this.rotationValueSmooth.gain=l,this.rotationValueSmooth.update(a);const c=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*e.timestamp),p1(this.currentCamera,n,VP(s,c)),this.constraintOptions.interactionType=oi.TUMBLE,this.constraintOptions.interactionFactor=bp(Math.abs(e.radius*c)),Ds(this.view,this.currentCamera,this.constraintOptions)}}end(e){e.pointers.size===this.pointerCount&&this.update(e),this.finishController();const t=this.zoomMomentumEstimator.evaluateMomentum();if(t)return new H2({view:this.view,momentum:t,zoomCenter:this.beginCenter});const i=this.rotationMomentumEstimator.evaluateMomentum();if(i)return new Lw({view:this.view,momentum:i,center:this.beginCenter,axis:this.planeHorizontal});const r=this.panMomentumEstimator.evaluateMomentum();return r?new BM({view:this.view,momentum:r}):null}computePlanePoints(e,t,i,r){r.length=e.size;const s=this.tmp2d;let n=0;return e.forEach(o=>{s[0]=o.x,s[1]=o.y,r[n]===void 0&&(r[n]=F()),Qq(t,i,s,r[n]),n+=1}),r}};u([f({constructOnly:!0})],RF.prototype,"view",void 0),RF=u([B("esri.views.3d.state.controllers.local.PinchAndPanController")],RF);class loe extends ua{constructor(t,i,r){super(!0),this.view=t,this.pointerAction=i,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",r,s=>this._handleDrag(s))}_handleDrag(t){if(t.data.pointerType==="mouse"&&!tJ(t.data,this.pointerAction))return;const i=t.timestamp-this.lastEndTimestamp,r=40,s=this.momentum&&this.momentum.active&&i<r;switch(t.data.action){case"start":case"update":if(s)break;this.controller&&this.controller.active?t.data.timestamp-this.lastTimestamp>2&&(this.controller.update(t.data),this.lastTimestamp=t.timestamp):this._startController(t);break;case"end":case"removed":this._endController(t,!0);break;case"added":this._endController(t,!1),this._startController(t)}t.stopPropagation()}_endController(t,i){if(this.controller&&this.controller.active){this.lastEndTimestamp=t.timestamp;const r=this.controller.end(t.data);i&&r&&(this.momentum=r,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(t){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(t.data),this.lastTimestamp=t.timestamp}_createController(){return this.view.state.isGlobal?new OF({view:this.view}):new RF({view:this.view})}}class kQe extends ua{constructor(t,i){super(!0),this.view=t,this.registerIncoming("pointer-down",i,()=>this.view.state.stopActiveCameraController())}}class xwe extends ua{constructor(t,i){super(!0),this.key=t,this.registerIncoming("key-down",i,r=>this._handleKeyDown(r))}_handleKeyDown(t){t.data.key===this.key&&(this.activate(),t.stopPropagation())}}class UQe extends xwe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class zQe extends xwe{constructor(t,i,r){super(i,r),this.view=t}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class BQe extends ua{constructor(t,i=!1){super(!0),this.view=t,this.invert=i,this.registerIncoming("vertical-two-finger-drag",r=>this._handleTwoFinger(r))}_handleTwoFinger(t){var s,n,o;const i=this.invert?-1:1,r=ys(0,t.data.delta*i);switch(t.data.action){case"begin":(s=this.cameraController)==null||s.end(),this.cameraController=new Xw({view:this.view,pivot:Ec.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(r);break;case"update":(n=this.cameraController)==null||n.update(r);break;case"end":(o=this.cameraController)==null||o.end(),this.cameraController=null}}}function coe(e){const t=e.native;return t?{buttons:t.buttons.map(i=>i.pressed?i.value?i.value:1:0),axes:t.axes.map(i=>jQe(i,e.axisThreshold))}:{buttons:[],axes:[]}}function VQe(e,t){if(e.axes.length!==t.axes.length||e.buttons.length!==t.buttons.length)return!1;for(let i=0;i<e.axes.length;i++)if(e.axes[i]!==t.axes[i])return!1;for(let i=0;i<e.buttons.length;i++)if(e.buttons[i]!==t.buttons[i])return!1;return!0}function GQe(e){for(let t=0;t<e.axes.length;t++)if(e.axes[t]!==0)return!1;for(let t=0;t<e.buttons.length;t++)if(e.buttons[t]!==0)return!1;return!0}function jQe(e,t){const i=Math.abs(e);return i<t?0:Math.sign(e)*(i-t)/(1-t)}class HQe{constructor(t,i){this.element=t,this.input=i,this._hasEventListeners=!1,this._onConnectGamepad=n=>{this._connectGamepad(n.gamepad)},this._onDisconnectGamepad=n=>{const o=n.gamepad,a=o.index,l=this.inputDevices[a];l&&(this._emitGamepadEvent(o,coe(l),!1),this.inputDevices.splice(a,1),this.latestUpdate.splice(a,1),this.input.gamepad.devices.remove(l),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const r="getGamepads"in window.navigator,s=window.isSecureContext;this.supported=r&&s,this.supported&&(this._forEachGamepad(n=>this._connectGamepad(n)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(t){this._hasEventListeners!==t&&(this._hasEventListeners=t,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(t){this.callback=t}_connectGamepad(t){const i=new nQ(t);i.deviceType!=="unknown"&&(this.inputDevices[t.index]=i,this.input.gamepad.devices.add(i)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this.frameTask==null&&(this.frameTask=xx({update:()=>this._readGamepadState()}))}_stopPolling(){this.frameTask!=null&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const t=document.hasFocus(),i=this.element.contains(document.activeElement),r=this.input.gamepad.enabledFocusMode==="document"&&!t||this.input.gamepad.enabledFocusMode==="view"&&!i;this._forEachGamepad(s=>{const n=this.inputDevices[s.index];if(!n)return;const o=this.latestUpdate[s.index],a=coe(n),l=r||GQe(a);o&&(o.timestamp===s.timestamp||!o.active&&l||VQe(o.state,a))||this._emitGamepadEvent(s,a,!l)})}_forEachGamepad(t){const i=window.navigator.getGamepads();for(let r=0;r<i.length;r++){const s=i[r];this._validate(s)&&t(s)}}_emitGamepadEvent(t,i,r){const s=this.latestUpdate[t.index],n=s&&s.active;if(!n&&!r)return;const o=!n&&r?"start":n&&r?"update":"end";this.latestUpdate[t.index]={timestamp:t.timestamp,state:i,active:r},this.callback&&this.callback({device:this.inputDevices[t.index],state:i,action:o})}_validate(t){if(!t||!t.connected)return!1;for(let i=0;i<t.axes.length;i++)if(isNaN(t.axes[i]))return!1;return!0}}const uoe=Ce("trident"),hoe=Ce("edge"),qQe=Ce("chrome"),WQe=Ce("ff"),ZQe=Ce("safari"),rS={touchNone:"esri-view-surface--touch-none",touchPan:"esri-view-surface--touch-pan"};class lz{constructor(t,i){this.input=i,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=t,t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new HQe(t,this.input),this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(t=>{this._releasePointerCaptureSafe(t)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(t){this._browserTouchPanningEnabled=t,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(t){this._callback=t}set activeEvents(t){for(const i in this._active)if(!t||!t.has(i)){const r=this._active[i];this._element.removeEventListener(l8[i],r),delete this._active[i]}t&&t.forEach(i=>{if(!this._active[i]&&l8[i]){const r=(this._eventHandlers[i]||this._handleDefault).bind(this,i);this._element.addEventListener(l8[i],r),this._active[i]=r}}),this._gamepadSource.hasEventListeners=t&&t.has("gamepad")}setPointerCapture(t,i){i?(this._element.setPointerCapture(t.pointerId),this._activePointerCaptures.add(t.pointerId)):(this._releasePointerCaptureSafe(t.pointerId),this._activePointerCaptures.delete(t.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?rS.touchNone:rS.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?rS.touchPan:rS.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(rS.touchNone),this._element.classList.remove(rS.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(t){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(t))return;this._element.releasePointerCapture(t)}catch{}}_updateNormalizedPointerLikeEvent(t,i){const r=Jve(this._element,t);return lz.test.disableSubpixelCoordinates&&(r.x=Math.round(r.x),r.y=Math.round(r.y)),i.x=r.x,i.y=r.y,i}_handleKey(t,i){const r=pGe(i);r&&t==="key-up"&&this._keyDownState.delete(r);const s={native:i,key:r,repeat:r&&this._keyDownState.has(r)};r&&t==="key-down"&&this._keyDownState.add(s.key),this._callback(t,s)}_handlePointer(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});this._callback(t,r)}_handlePointerPreventDefault(t,i){const r=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,pointerType:i.pointerType,button:i.button,buttons:i.buttons,eventId:this._eventId++});i.preventDefault(),this._callback(t,r)}_handleMouseWheel(t,i){let r=i.deltaY;switch(i.deltaMode){case 0:(uoe||hoe)&&(r=r/document.documentElement.clientHeight*600);break;case 1:r*=30;break;case 2:r*=900}uoe||hoe?r*=.7:qQe||ZQe?r*=.6:WQe&&(r*=1.375);const s=100,n=Math.abs(r);n>s&&(r=r/n*200/(1+Math.exp(-.02*(n-s))));const o=this._updateNormalizedPointerLikeEvent(i,{native:i,x:0,y:0,deltaY:r});this._callback(t,o)}_handlePointerCaptureLost(t,i){this._activePointerCaptures.delete(i.pointerId),this._handleDefault(t,i)}_handleDefault(t,i){const r={native:i};i.preventDefault(),this._callback(t,r)}_preventAltKeyDefault(t){t.key==="Alt"&&t.preventDefault()}_preventMultiTouchPanning(t){t.touches.length>1&&t.preventDefault()}}lz.test={disableSubpixelCoordinates:!1};const l8={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class XQe extends ua{constructor(){super(!0),this.registerIncoming("context-menu",t=>{t.data.native.preventDefault()})}}function Twe(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}function YQe(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function QQe(e,t){if(t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:qp()},e.length===0)return t;if(e.length===1)return t.center.x=e[0].x,t.center.y=e[0].y,t;if(e.length===2){const[C,M]=e,[I,$]=[M.x-C.x,M.y-C.y];return t.radius=Math.sqrt(I*I+$*$)/2,t.center.x=(C.x+M.x)/2,t.center.y=(C.y+M.y)/2,t}let i=0,r=0;for(let C=0;C<e.length;C++)i+=e[C].x,r+=e[C].y;i/=e.length,r/=e.length;const s=e.map(C=>C.x-i),n=e.map(C=>C.y-r);let o=0,a=0,l=0,c=0,h=0,p=0,m=0;for(let C=0;C<s.length;C++){const M=s[C],I=n[C],$=M*M,U=I*I;o+=$,a+=U,l+=M*I,c+=$*M,h+=U*I,p+=M*U,m+=I*$}const g=.5*(c+p),v=.5*(h+m),b=o*a-l*l,S=(g*a-v*l)/b,T=(o*v-l*g)/b,O=qp(S+i,T+r);return{radius:Math.sqrt(S*S+T*T+(o+a)/e.length),center:O}}class JQe extends ua{constructor(t){super(!1),this.navigationTouch=t,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(t,i,r,s){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:i.buttons,timestamp:s,pointers:KQe(this.activePointerMap),pointer:i,angle:r.angle,radius:r.radius,center:r.center}}_addPointer(t){const i=t.native.pointerId,r=F$(this.activePointerMap).angle,s={event:t,initialAngle:0,lastAngle:0};this.activePointerMap.set(i,s);const n=MF(s,Swe(this.activePointerMap));s.initialAngle=n,s.lastAngle=n,this._updatePointerAngles(r)}_updatePointer(t){if(t&&t.x==null&&t.y==null)return;const i=t.native.pointerId,r=this.activePointerMap.get(i);r?r.event=t:this._addPointer(t)}_removePointer(t){const i=F$(this.activePointerMap).angle;this.activePointerMap.delete(t),this._updatePointerAngles(i)}_updatePointerAngles(t){const i=F$(this.activePointerMap);this.activePointerMap.forEach(r=>{r.initialAngle=MF(r,i)-t,r.lastAngle=MF(r,i)-t})}_emitEvent(t,i,r){const s=F$(this.activePointerMap);this.drag.emit(this._createPayload(t,i,s,r),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(t){const i=t.data.native.pointerId,r=t.timestamp;this.activePointerMap.get(i)&&(this.activePointerMap.size===1?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,r),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(i)):(this._removePointer(i),this._emitEvent("removed",t.data,t.timestamp)))}_handlePointerDrag(t){const i=t.data,r=i.currentEvent,s=t.timestamp;switch(i.action){case"start":case"update":this.isDragging?this.activePointerMap.has(r.native.pointerId)?(this._updatePointer(r),!this.isCurrentDragSuppressed&&this._emitEvent("update",r,s)):(this._addPointer(r),this._emitEvent("added",r,s),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(r),this.pointerType=t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",r,s))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&this.pointerType==="touch"&&this.activePointerMap.size===1}}function Swe(e){const t=[];return e.forEach(i=>{t.push(qp(i.event.x,i.event.y))}),QQe(t)}function F$(e){const t=Swe(e);let i=0;return e.forEach(r=>{let s=MF(r,t),n=s-r.lastAngle;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;s=r.lastAngle+n,r.lastAngle=s,i+=s-r.initialAngle}),i/=e.size||1,{angle:i,radius:t.radius,center:t.center}}function KQe(e){const t=new Map;return e.forEach((i,r)=>t.set(r,i.event)),t}function MF(e,t){const i=e.event,r=i.x-t.center.x,s=i.y-t.center.y;return Math.atan2(s,r)}var doe;(function(e){e[e.Left=0]="Left",e[e.Middle=1]="Middle",e[e.Right=2]="Right",e[e.Back=3]="Back",e[e.Forward=4]="Forward",e[e.Undefined=-1]="Undefined"})(doe||(doe={}));const Iv={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};class eJe extends ua{constructor(t=Iv.maximumDoubleClickDelay,i=Iv.maximumDoubleClickDistance,r=Iv.maximumDoubleTouchDelay,s=Iv.maximumDoubleTouchDistance,n=Mk){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(t=>t.doubleClickTimeout=Ln(t.doubleClickTimeout))}get hasPendingInputs(){return On(this._pointerState,t=>t.doubleClickTimeout!=null)}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_handleImmediateClick(t){const i=t.data,r=this._pointerId(i),s=this._pointerState.get(r);if(s){const n=i.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Twe(s.event.data,i)>n?(this._clearDoubleClickTimeout(r,!0),this._startClick(t)):(this._clearDoubleClickTimeout(r,!1),this._doubleClick.emit(s.event.data,void 0,s.event.modifiers))}else this._startClick(t)}_startClick(t){const i=this._pointerId(t.data),r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;this._pointerState.set(i,{event:t,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(i),r)}),this.refreshHasPendingInputs()}_handlePointerDrag(t){const i=this._pointerId(t.data.currentEvent);this._clearDoubleClickTimeout(i,!0)}_handleDrag(t){const i=this._pointerId(t.data.pointer);this._clearDoubleClickTimeout(i,!0)}_clearDoubleClickTimeout(t,i){const r=this._pointerState.get(t);r&&(r.doubleClickTimeout.remove(),r.doubleClickTimeout=null,i&&this._doubleClickTimeoutExceeded(t),this._pointerState.delete(t),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(t){const i=this._pointerState.get(t);this._click.emit(i.event.data,void 0,i.event.modifiers),i.doubleClickTimeout=null,this._pointerState.delete(t),this.refreshHasPendingInputs()}}class tJe extends ua{constructor(t=Iv.maximumDoubleClickDelay,i=Iv.maximumDoubleClickDistance,r=Iv.maximumDoubleTouchDelay,s=Iv.maximumDoubleTouchDistance,n=Mk){super(!1),this.maximumDoubleClickDelay=t,this.maximumDoubleClickDistance=i,this.maximumDoubleTouchDelay=r,this.maximumDoubleTouchDistance=s,this._clock=n,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",o=>{this._handlePointerLoss(o,"pointer-up")}),this.registerIncoming("pointer-capture-lost",o=>{this._handlePointerLoss(o,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",o=>{this._handlePointerLoss(o,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(t=>{t.immediateDoubleClick&&t.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=this._pointerId(i);if(!this._pointerState.has(r)){const s={downButton:i.native.button,immediateDoubleClick:null};this._pointerState.set(r,s),this.startCapturingPointer(i.native)}}_handlePointerLoss(t,i){const r=t.data,s=this._pointerId(r),n=this._pointerState.get(s);if(n&&i==="pointer-up"&&n.downButton===r.native.button){const o=n.immediateDoubleClick;if(o){o.timeoutHandle.remove();const a=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;Twe(o,t.data)>a?this._startImmediateDoubleClick(t,n):(this._immediateDoubleClick.emit(t.data,void 0,o.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(t,n)}}_startImmediateDoubleClick(t,i){const r=t.data.native.pointerType==="touch"?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay;i.immediateDoubleClick={x:t.data.x,y:t.data.y,modifiers:t.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(t.data),r)}}_pointerId(t){const i=t.native;return i.pointerType==="mouse"?`${i.pointerId}:${i.button}`:`${i.pointerType}`}_removeState(t){const i=this._pointerId(t);this._pointerState.delete(i),this.stopCapturingPointer(t.native),this.refreshHasPendingInputs()}}const dO={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};class iJe extends ua{constructor(t=dO.maximumClickDelay,i=dO.movementUntilMouseDrag,r=dO.movementUntilPenDrag,s=dO.movementUntilTouchDrag,n=dO.holdDelay,o=Mk){super(!1),this.maximumClickDelay=t,this.movementUntilMouseDrag=i,this.movementUntilPenDrag=r,this.movementUntilTouchDrag=s,this.holdDelay=n,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(t=>{t.holdTimeout!=null&&(t.holdTimeout.remove(),t.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(t){const i=t.data,r=i.native.pointerId;let s=null;this._pointerState.size===0&&(s=this._clock.setTimeout(()=>{const o=this._pointerState.get(r);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,t.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this.holdDelay));const n={startEvent:i,previousEvent:i,startTimestamp:t.timestamp,isDragging:!1,downButton:i.native.button,holdTimeout:s,modifiers:new Set};this._pointerState.set(r,n),this.startCapturingPointer(i.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(t)}_createPointerDragData(t,i,r){return{action:t,startEvent:i.startEvent,previousEvent:i.previousEvent,currentEvent:r}}_handlePointerMove(t){const i=t.data,r=i.native.pointerId,s=this._pointerState.get(r);s&&(s.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",s,i),void 0,s.modifiers):YQe(i,s.startEvent)>this._getDragThreshold(i.native.pointerType)&&this._startDragging(t),s.previousEvent=i)}_getDragThreshold(t){switch(t){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(t){const i=t.data,r=i.native.pointerId;this._pointerState.forEach(s=>{s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging||(s.modifiers=t.modifiers,s.isDragging=!0,r===s.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",s,i)):this._pointerDrag.emit(this._createPointerDragData("start",s,s.previousEvent),t.timestamp))})}_handlePointerLoss(t,i){const r=t.data,s=r.native.pointerId,n=this._pointerState.get(s);n&&(n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",n,i==="pointer-up"?r:n.previousEvent),void 0,n.modifiers):i==="pointer-up"&&n.downButton===r.native.button&&t.timestamp-n.startTimestamp<=this.maximumClickDelay&&!n.holdEmitted&&this._immediateClick.emit(r),this._pointerState.delete(s),this.stopCapturingPointer(r.native),this._pointerState.size===0&&this._moveHandle.pause())}}class rJe{constructor(t){this.callbacks=t,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(t){const i=t.data,r=i.pointers.size;switch(i.action){case"start":this.currentCount=r,this._emitStart(t);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"update":this._emitUpdate(t);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=r,this._emitStart(t);break;case"end":this._emitEnd(t),this.currentCount=0}this.previousEvent=t}_emitStart(t){this.startEvent=t,this.callbacks.condition(this.currentCount,t)&&this.callbacks.start(this.currentCount,t,this.startEvent)}_emitUpdate(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.update(this.currentCount,t,this.startEvent)}_emitEnd(t){this.callbacks.condition(this.currentCount,t)&&this.callbacks.end(this.currentCount,t,this.startEvent),this.startEvent=null}}class sJe extends ua{constructor(t=20,i=40){super(!1),this._threshold=t,this._maxDelta=i,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new rJe({start:(r,s)=>this._observeStart(r,s),update:(r,s,n)=>this._observeUpdate(r,s,n),end:(r,s)=>this._observeEnd(s)}),this.registerIncoming("drag",r=>this.dragEventSeparator.handle(r))}get failed(){return this.state==="failed"}_observeStart(t,i){t===1&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),i.stopPropagation()),this.state=t===2?"ready":"failed"}_observeUpdate(t,i,r){if(this.state!=="failed"&&t===2)return this.state==="active"?(this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void i.stopPropagation()):void(this._checkMovementWithinLimits(i.data,r.data)?this._checkVerticalThresholdReached(i.data,r.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=i.data.center,this._artificalDrag.emit({action:"end",button:i.data.button,buttons:i.data.buttons,pointerType:i.data.pointerType,timestamp:i.data.timestamp,pointers:i.data.pointers,pointer:i.data.pointer,angle:i.data.angle,radius:i.data.radius,center:i.data.center}),this._vertical.emit({delta:i.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),i.stopPropagation()):this.state="failed")}_observeEnd(t){this.state==="active"&&(this._vertical.emit({delta:t.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",t.stopPropagation())}_checkMovementWithinLimits(t,i){let r=-1/0,s=1/0,n=-1/0,o=1/0;i.pointers.forEach(b=>{r=Math.max(r,b.x),s=Math.min(s,b.x),n=Math.max(n,b.y),o=Math.min(o,b.y)});let a=-1/0,l=1/0,c=-1/0,h=1/0;t.pointers.forEach(b=>{a=Math.max(a,b.x),l=Math.min(l,b.x),c=Math.max(c,b.y),h=Math.min(h,b.y)});const p=r-s,m=n-o,g=a-l,v=c-h;return Math.abs(t.center.x-i.center.x)<this._threshold&&Math.abs(g-p)<=this._maxDelta&&Math.abs(v-m)<=this._maxDelta}_checkVerticalThresholdReached(t,i){let r=Math.abs(t.center.y-i.center.y);return t.pointers.forEach((s,n)=>{const o=i.pointers.get(n);r=Math.min(r,Math.abs(s.y-o.y))}),r>=this._threshold}}let jf=class extends ze{constructor(){super(...arguments),this._handles=new xi}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get hasPendingInputs(){var e;return(e=this._inputManager)==null?void 0:e.hasPendingInputs}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const e=this.view;this._source=new lz(this.view.surface,e.input);const t=[new tJe,new iJe,new eJe,new JQe(this.view.navigation),new sJe],i=new N_({eventSource:this._source,recognizers:t});this._inputManager=i,i.installHandlers("prevent-context-menu",[new XQe],Gv.INTERNAL),this._modeDragPan=new loe(e,"primary"),this._modeDragRotate=new s8(e,"secondary",Ec.CENTER),this._modeDragZoom=new qYe(e,"tertiary");const r={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new kQe(e),new VYe(e),new OQe(e),new RQe(e,r.pan),new MQe(e),new zQe(e,r.resetTilt),new UQe(e,r.resetHeading),new s8(e,"primary",Ec.EYE,[r.lookAround]),new s8(e,"secondary",Ec.CENTER,[r.lookAround]),new loe(e,"tertiary",[r.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new BQe(e)],Gv.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(xe(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},si))}_updateMode(){const e=this.mode,t=this.primaryDragAction,i=eW.get(e).get(t);this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};u([f()],jf.prototype,"view",void 0),u([f({value:"pan"})],jf.prototype,"primaryDragAction",null),u([f({value:"default"})],jf.prototype,"mode",null),u([f({readOnly:!0})],jf.prototype,"hasPendingInputs",null),u([f()],jf.prototype,"latestPointerType",null),u([f()],jf.prototype,"latestPointerLocation",null),u([f()],jf.prototype,"_inputManager",void 0),jf=u([B("esri.views.3d.input.SceneInputManager")],jf);const eW=new Map,c8=new Map,u8=new Map;c8.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),c8.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),u8.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),u8.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),eW.set("default",c8),eW.set("pro",u8);const nJe=jf;let Ms=class extends ze{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};u([f()],Ms.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),u([f()],Ms.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),u([f()],Ms.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),u([f()],Ms.prototype,"DECONFLICTOR_SHOW_GRID",void 0),u([f()],Ms.prototype,"LABELS_SHOW_BORDER",void 0),u([f()],Ms.prototype,"TEXT_SHOW_BASELINE",void 0),u([f()],Ms.prototype,"TEXT_SHOW_BORDER",void 0),u([f()],Ms.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),u([f()],Ms.prototype,"OVERLAY_SHOW_CENTER",void 0),u([f()],Ms.prototype,"SHOW_POI",void 0),u([f()],Ms.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),u([f()],Ms.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),u([f()],Ms.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),u([f()],Ms.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),u([f()],Ms.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),u([f()],Ms.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),u([f()],Ms.prototype,"I3S_TREE_SHOW_TILES",void 0),u([f()],Ms.prototype,"I3S_SHOW_MODIFICATIONS",void 0),u([f()],Ms.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),u([f()],Ms.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),u([f()],Ms.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),u([f()],Ms.prototype,"LINE_WIREFRAMES",void 0),Ms=u([B("esri.views.3d.support.DebugFlags")],Ms);const ur=new Ms;let Cu,fE,tW=!1,iW=!1,rW=!1,sW=!1,VM=null;function oJe(e,t){if(!iW||!fE)return;Ewe();const i=fE;let r=0;for(let s=0;s<e.accBinsNumX;s++)for(let n=0;n<e.accBinsNumY;n++){const o=e.accBins[s][e.accBinsNumY-1-n];r+=o.length;const a=s*e.accBinsSizeX,l=(s+1)*e.accBinsSizeX,c=n*e.accBinsSizeY,h=(n+1)*e.accBinsSizeY;i.fillText(o.length.toFixed(),a+5,c+15),Cwe(a,l,c,h,"blue")}i.fillText("total totalShownLabels: "+r,70,40),i.fillText("total visible labels: "+t.size,70,50),i.fillText("total numTests: "+e.accNumTests,70,30)}function aJe(e){rW=ur.DECONFLICTOR_SHOW_VISIBLE,sW=ur.DECONFLICTOR_SHOW_INVISIBLE,tW=rW||sW,iW=ur.DECONFLICTOR_SHOW_GRID,VM=null,tW||iW?VM=()=>lJe(e):Cu&&(Cu.parentElement.removeChild(Cu),Cu=null)}function Ewe(){VM&&(VM(),VM=null)}function lJe(e){Cu==null&&(Cu=document.createElement("canvas"),Cu.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(Cu));const{state:t}=e,{camera:i,pixelRatio:r}=t,{width:s,height:n}=i,o=s*r,a=n*r;Cu.setAttribute("width",`${o}px`),Cu.setAttribute("height",`${a}px`),Cu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${s}px;height:${n}px`),fE=Cu.getContext("2d"),fE.clearRect(0,0,s,n),fE.font="12px Arial"}function Cwe(e,t,i,r,s){Ewe();const n=Cu.height,o=fE;o.beginPath(),o.lineWidth=1,o.strokeStyle=s,o.moveTo(e,n-i),o.lineTo(t,n-i),o.stroke(),o.lineTo(t,n-r),o.stroke(),o.lineTo(t,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.lineTo(e,n-i),o.stroke(),o.closePath()}function cJe(e,t){tW&&(t&&rW||!t&&sW)&&Cwe(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],t?"green":"red")}var Po,ku;(function(e){e[e.GRAPHIC=0]="GRAPHIC",e[e.LABEL=1]="LABEL",e[e._COUNT=2]="_COUNT"})(Po||(Po={})),function(e){e[e.USER_SETTING=0]="USER_SETTING",e[e.SCALE_RANGE=1]="SCALE_RANGE",e[e.FILTER=2]="FILTER",e[e.DECONFLICTION=3]="DECONFLICTION",e[e._COUNT=4]="_COUNT"}(ku||(ku={}));function Awe(e,t){return new cz(e,Pwe,t)}function uJe(e,t){const{curvatureDependent:i,scaleStart:r,scaleFallOffRange:s}=Pwe;return new cz(e,{curvatureDependent:{min:{curvature:i.min.curvature,tiltAngle:i.min.tiltAngle,scaleFallOffFactor:h8.curvatureDependent.min.scaleFallOffFactor},max:{curvature:i.max.curvature,tiltAngle:i.max.tiltAngle,scaleFallOffFactor:h8.curvatureDependent.max.scaleFallOffFactor}},scaleStart:r,scaleFallOffRange:s,minPixelSize:h8.minPixelSize},t)}function hJe(e){return Math.abs(e*e*e)}function Owe(e,t,i){const r=i.parameters,s=i.paddingPixelsOverride;return pO.scale=Math.min(r.divisor/(t-r.offset),1),pO.factor=hJe(e),pO.minPixelSize=r.minPixelSize,pO.paddingPixels=s,pO}function Rwe(e,t){return e===0?t.minPixelSize:t.minPixelSize*(1+2*t.paddingPixels/e)}function nJ(e,t){return Math.max(fi(e*t.scale,e,t.factor),Rwe(e,t))}function dJe(e,t,i){const r=Owe(e,t,i);return r.minPixelSize=0,r.paddingPixels=0,nJ(1,r)}function poe(e,t,i,r){r.scale=dJe(e,t,i),r.factor=0,r.minPixelSize=i.parameters.minPixelSize,r.paddingPixels=i.paddingPixelsOverride}function Mwe(e,t,i=[0,0]){const r=Math.min(Math.max(t.scale,Rwe(e[1],t)/Math.max(1e-5,e[1])),1);return i[0]=e[0]*r,i[1]=e[1]*r,i}function pJe(e,t,i,r){return nJ(e,Owe(t,i,r))}class cz{constructor(t,i,r,s=fJe(),n){this.viewingMode=t,this.description=i,this.ellipsoidRadius=r,this.parameters=s,this._paddingPixelsOverride=n,this.viewingMode===st.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(t){return(!this.parameters||this.parameters.camera.fovY!==t.fovY||this.parameters.camera.distance!==t.distance)&&(this._calculateParameters(t,this.ellipsoidRadius,this.parameters),!0)}overridePadding(t){return t!==this.paddingPixelsOverride?new cz(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this}_calculateParameters(t,i,r){const{scaleStart:s,scaleFallOffRange:n,minPixelSize:o}=this.description,{fovY:a,distance:l}=t,c=this.calculateCurvatureDependentParameters(t,i),h=this.coverageCompensation(t,i,c),{tiltAngle:p,scaleFallOffFactor:m}=c,g=Math.sin(p)*l,v=.5*Math.PI-p-a*(.5-s*h),b=g/Math.cos(v),S=v+a*n*h,T=(b-m*(g/Math.cos(S)))/(1-m);return r.camera.fovY=t.fovY,r.camera.distance=t.distance,r.offset=T,r.divisor=b-T,r.minPixelSize=o,r}_calculateCurvatureDependentParametersLocal(t,i,r=foe){return r.tiltAngle=this.description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(t,i,r=foe){const s=this.description.curvatureDependent,n=1+t.distance/i,o=Math.sqrt(n*n-1),[a,l]=[s.min.curvature,s.max.curvature],c=Xe((o-a)/(l-a),0,1),[h,p]=[s.min,s.max];return r.tiltAngle=fi(h.tiltAngle,p.tiltAngle,c),r.scaleFallOffFactor=fi(h.scaleFallOffFactor,p.scaleFallOffFactor,c),r}_surfaceCoverageCompensationLocal(t,i,r){return(t.fovY-r.tiltAngle)/t.fovY}_surfaceCoverageCompensationGlobal(t,i,r){const s=i*i,n=r.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=t,l=a*a+s-2*Math.cos(n)*a*i,c=Math.sqrt(l),h=Math.sqrt(l-s);return(Math.acos(h/c)-Math.asin(i/(c/Math.sin(n)))+.5*o)/o}}const Pwe={curvatureDependent:{min:{curvature:Jt(10),tiltAngle:Jt(12),scaleFallOffFactor:.5},max:{curvature:Jt(70),tiltAngle:Jt(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},h8={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function fJe(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const pO={scale:0,factor:0,minPixelSize:0,paddingPixels:0},foe={tiltAngle:0,scaleFallOffFactor:0};function mJe(e){return e instanceof Float32Array&&e.length>=16}function gJe(e){return Array.isArray(e)&&e.length>=16}function yJe(e){return mJe(e)||gJe(e)}var ue;(function(e){e[e.Color=0]="Color",e[e.Depth=1]="Depth",e[e.Normal=2]="Normal",e[e.Shadow=3]="Shadow",e[e.Highlight=4]="Highlight",e[e.Draped=5]="Draped",e[e.Occlusion=6]="Occlusion",e[e.Alpha=7]="Alpha",e[e.COUNT=8]="COUNT"})(ue||(ue={}));function oJ(e){e.vertex.code.add(E`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),e.vertex.code.add(E`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(E`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),e.vertex.code.add(E`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),e.vertex.code.add(E`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(E`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),e.vertex.code.add(E`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function _Je(e){e.uniforms.add(new Ci("screenSizePerspective",t=>Iwe(t.screenSizePerspective)))}function uz(e){e.uniforms.add(new Ci("screenSizePerspectiveAlignment",t=>Iwe(t.screenSizePerspectiveAlignment||t.screenSizePerspective)))}function Iwe(e){return _r(vJe,e.parameters.divisor,e.parameters.offset,e.parameters.minPixelSize,e.paddingPixelsOverride)}const vJe=di();class nW extends vs{constructor(t,i){super(t,"mat4",nr.Draw,(r,s,n)=>r.setUniformMatrix4fv(t,i(s,n)))}}function Dm(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",ol):e.uniforms.add(new al("cameraPosition",(i,r)=>fe(Lwe,r.camera.viewInverseTransposeMatrix[3]-i.origin[0],r.camera.viewInverseTransposeMatrix[7]-i.origin[1],r.camera.viewInverseTransposeMatrix[11]-i.origin[2])))}function Yu(e,t){if(e.vertex.uniforms.add(new Hr("proj",(r,s)=>s.camera.projectionMatrix)),t.instancedDoublePrecision){const r=(n,o)=>fe(Lwe,o.camera.viewInverseTransposeMatrix[3],o.camera.viewInverseTransposeMatrix[7],o.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new Hr("view",(n,o)=>hl(moe,o.camera.viewMatrix,r(n,o))));const s=new Ut("localOrigin",r);return e.vertex.uniforms.add(s),s}e.vertex.uniforms.add(new nW("view",(r,s)=>hl(moe,s.camera.viewMatrix,r.origin)));const i=new al("localOrigin",r=>r.origin);return e.vertex.uniforms.add(i),i}const moe=Q3(),Lwe=F();function $we(e,t){const i=e.vertex;t.hasVerticalOffset?(Dwe(i),t.hasScreenSizePerspective&&(e.include(oJ),uz(i),Dm(e.vertex,t)),i.code.add(E`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?E`vec3 worldNormal = normalize(worldPos + localOrigin);`:E`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?E`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:E`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):i.code.add(E`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const bJe=di();function Dwe(e){e.uniforms.add(new Ci("verticalOffset",(t,i)=>{const{minWorldLength:r,maxWorldLength:s,screenLength:n}=t.verticalOffset,o=Math.tan(.5*i.camera.fovY)/(.5*i.camera.fullViewport[3]),a=i.camera.pixelRatio||1;return _r(bJe,n*a,o,r,s)}))}var Zh;(function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"})(Zh||(Zh={}));var Ul;function Nwe(e,t){e.include(oJ),e.attributes.add(D.POSITION,"vec3"),e.attributes.add(D.NORMAL,"vec3"),e.attributes.add(D.AUXPOS1,"vec4");const i=e.vertex;Yu(e,t),Dm(i,t),i.uniforms.add([new Ci("viewport",(r,s)=>s.camera.fullViewport),new lt("polygonOffset",r=>r.shaderPolygonOffset),new lt("cameraGroundRelative",(r,s)=>s.camera.aboveGround?1:-1),new lt("renderTransparentlyOccludedHUD",(r,s)=>s.renderTransparentlyOccludedHUD===Zh.Occluded?1:s.renderTransparentlyOccludedHUD===Zh.NotOccluded?0:.75),new ai("hudVisibilityTexture",(r,s)=>s.hudVisibilityTexture)]),t.hasVerticalOffset&&Dwe(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add(E`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),i.code.add(E`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),t.isDraped&&!t.hasVerticalOffset||i.uniforms.add(new Hr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),t.isDraped||(i.uniforms.add(new lt("perDistancePixelRatio",(r,s)=>Math.tan(s.camera.fovY/2)/(s.camera.fullViewport[2]/2))),i.code.add(E`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),t.screenCenterOffsetUnitsEnabled===Ul.Screen&&i.uniforms.add(new lt("pixelRatio",(r,s)=>s.camera.pixelRatio)),t.hasScreenSizePerspective&&uz(i),i.code.add(E`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${t.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled===Ul.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${t.hasVerticalOffset?E`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${t.screenCenterOffsetUnitsEnabled!==Ul.Screen?E`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${t.screenCenterOffsetUnitsEnabled===Ul.Screen?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${t.screenCenterOffsetUnitsEnabled===Ul.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),i.code.add(E`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(e){e[e.World=0]="World",e[e.Screen=1]="Screen",e[e.COUNT=2]="COUNT"})(Ul||(Ul={}));const k$=dn();function hz(e,t,i,r,s,n,o){if(!hI(t))if(e.boundingInfo){At(e.primitiveType===Zl.Triangle);const a=i.tolerance;Fwe(e.boundingInfo,r,s,a,n,o)}else{const a=e.indices.get(D.POSITION),l=e.vertexAttributes.get(D.POSITION);fI(r,s,0,a.length/3,a,l,void 0,n,o)}}const wJe=F();function Fwe(e,t,i,r,s,n){if(N(e))return;const o=Uwe(t,i,wJe);if(Hpe(k$,e.getBBMin()),qpe(k$,e.getBBMax()),w(s)&&s.applyToAabb(k$),lJ(k$,t,o,r)){const{primitiveIndices:a,indices:l,position:c}=e,h=a?a.length:l.length/3;if(h>CJe){const p=e.getChildren();if(p!==void 0){for(let m=0;m<8;++m)p[m]!==void 0&&Fwe(p[m],t,i,r,s,n);return}}fI(t,i,0,h,l,c,a,s,n)}}const kwe=F();function fI(e,t,i,r,s,n,o,a,l){if(o)return xJe(e,t,i,r,s,n,o,a,l);const c=n.data,h=n.stride||n.size,p=e[0],m=e[1],g=e[2],v=t[0]-p,b=t[1]-m,S=t[2]-g;for(let T=i,O=3*i;T<r;++T){let C=h*s[O++],M=c[C++],I=c[C++],$=c[C];C=h*s[O++];let U=c[C++],q=c[C++],G=c[C];C=h*s[O++];let Y=c[C++],J=c[C++],X=c[C];w(a)&&([M,I,$]=a.applyToVertex(M,I,$,T),[U,q,G]=a.applyToVertex(U,q,G,T),[Y,J,X]=a.applyToVertex(Y,J,X,T));const ne=U-M,re=q-I,ye=G-$,pe=Y-M,z=J-I,j=X-$,Q=b*j-z*S,Z=S*pe-j*v,ie=v*z-pe*b,le=ne*Q+re*Z+ye*ie;if(Math.abs(le)<=Number.EPSILON)continue;const K=p-M,ae=m-I,we=g-$,Re=K*Q+ae*Z+we*ie;if(le>0){if(Re<0||Re>le)continue}else if(Re>0||Re<le)continue;const Ge=ae*ye-re*we,Pe=we*ne-ye*K,Se=K*re-ne*ae,$e=v*Ge+b*Pe+S*Se;if(le>0){if($e<0||Re+$e>le)continue}else if($e>0||Re+$e<le)continue;const qe=(pe*Ge+z*Pe+j*Se)/le;qe>=0&&l(qe,aJ(ne,re,ye,pe,z,j,kwe),T,!1)}}function xJe(e,t,i,r,s,n,o,a,l){const c=n.data,h=n.stride||n.size,p=e[0],m=e[1],g=e[2],v=t[0]-p,b=t[1]-m,S=t[2]-g;for(let T=i;T<r;++T){const O=o[T];let C=3*O,M=h*s[C++],I=c[M++],$=c[M++],U=c[M];M=h*s[C++];let q=c[M++],G=c[M++],Y=c[M];M=h*s[C];let J=c[M++],X=c[M++],ne=c[M];w(a)&&([I,$,U]=a.applyToVertex(I,$,U,T),[q,G,Y]=a.applyToVertex(q,G,Y,T),[J,X,ne]=a.applyToVertex(J,X,ne,T));const re=q-I,ye=G-$,pe=Y-U,z=J-I,j=X-$,Q=ne-U,Z=b*Q-j*S,ie=S*z-Q*v,le=v*j-z*b,K=re*Z+ye*ie+pe*le;if(Math.abs(K)<=Number.EPSILON)continue;const ae=p-I,we=m-$,Re=g-U,Ge=ae*Z+we*ie+Re*le;if(K>0){if(Ge<0||Ge>K)continue}else if(Ge>0||Ge<K)continue;const Pe=we*pe-ye*Re,Se=Re*re-pe*ae,$e=ae*ye-re*we,qe=v*Pe+b*Se+S*$e;if(K>0){if(qe<0||Ge+qe>K)continue}else if(qe>0||Ge+qe<K)continue;const jt=(z*Pe+j*Se+Q*$e)/K;jt>=0&&l(jt,aJ(re,ye,pe,z,j,Q,kwe),O,!1)}}const goe=F(),yoe=F();function aJ(e,t,i,r,s,n,o){return fe(goe,e,t,i),fe(yoe,r,s,n),St(o,goe,yoe),De(o,o),o}function Uwe(e,t,i){return fe(i,1/(t[0]-e[0]),1/(t[1]-e[1]),1/(t[2]-e[2]))}function lJ(e,t,i,r){return cJ(e,t,i,r,1/0)}function cJ(e,t,i,r,s){const n=(e[0]-r-t[0])*i[0],o=(e[3]+r-t[0])*i[0];let a=Math.min(n,o),l=Math.max(n,o);const c=(e[1]-r-t[1])*i[1],h=(e[4]+r-t[1])*i[1];if(l=Math.min(l,Math.max(c,h)),l<0||(a=Math.max(a,Math.min(c,h)),a>l))return!1;const p=(e[2]-r-t[2])*i[2],m=(e[5]+r-t[2])*i[2];return l=Math.min(l,Math.max(p,m)),!(l<0)&&(a=Math.max(a,Math.min(p,m)),!(a>l)&&a<s)}function zwe(e,t,i,r,s){let n=(i.screenLength||0)*e.pixelRatio;w(s)&&(n=pJe(n,r,t,s));const o=n*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return Xe(o*t,i.minWorldLength||0,i.maxWorldLength!=null?i.maxWorldLength:1/0)}function Bwe(e,t){const i=t?Bwe(t):{};for(const r in e){let s=e[r];s&&s.forEach&&(s=EJe(s)),s==null&&r in i||(i[r]=s)}return i}function TJe(e,t){let i=!1;for(const r in t){const s=t[r];s!==void 0&&(Array.isArray(s)?e[r]===null?(e[r]=s.slice(),i=!0):eZ(e[r],s)&&(i=!0):e[r]!==s&&(i=!0,e[r]=s))}return i}function SJe(e,t,i,r,s,n){if(!t.options.selectionMode)return;const o=e.vertexAttributes.get(D.POSITION).data,a=e.vertexAttributes.get(D.SIZE),l=a&&a.data[0],c=r[0],h=r[1],p=((l+s)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let v=0;v<o.length-5;v+=3){const b=o[v],S=o[v+1],T=c-b,O=h-S,C=o[v+3]-b,M=o[v+4]-S,I=Xe((C*T+M*O)/(C*C+M*M),0,1),$=C*I-T,U=M*I-O,q=$*$+U*U;q<m&&(m=q,g=v/3)}m<p*p&&n(i.dist,i.normal,g,!1)}function EJe(e){const t=[];return e.forEach(i=>t.push(i)),t}const Vwe={multiply:1,ignore:2,replace:3,tint:4},CJe=1e3;class Xm extends uI{constructor(t,i){super(),this.type=Kp.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=or,this._parameters=Bwe(t,i),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(t){return!1}setParameters(t,i=!0){TJe(this._parameters,t)&&(this.validateParameters(this._parameters),i&&this.parametersChanged())}validateParameters(t){}get visible(){return this._visible}set visible(t){t!==this._visible&&(this._visible=t,this.parametersChanged())}shouldRender(t){return this.isVisible()&&this.isVisibleInPass(t.pass)&&(this.renderOccluded&t.renderOccludedMask)!=0}isVisibleInPass(t){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(t){t!==this._insertOrder&&(this._insertOrder=t,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){w(this.repository)&&this.repository.materialChanged(this)}}var ts;(function(e){e[e.Occlude=1]="Occlude",e[e.Transparent=2]="Transparent",e[e.OccludeAndTransparent=4]="OccludeAndTransparent",e[e.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",e[e.Opaque=16]="Opaque"})(ts||(ts={}));class cA extends mn{constructor(){super(...arguments),this.renderOccluded=ts.Occlude}}function Cbt(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l)n[r]=t[e[l]],r+=o;else for(let l=0;l<a;++l){const c=t[e[l]];for(let h=0;h<s;h++)n[r]=c,r+=o}}function AJe(e,t,i,r){const s=i.typedBuffer,n=i.typedBufferStride,o=e.length;r*=n;for(let a=0;a<o;++a){const l=2*e[a];s[r]=t[l],s[r+1]=t[l+1],r+=n}}function Gwe(e,t,i,r,s){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s==null||s===1)for(let l=0;l<a;++l){const c=3*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}else for(let l=0;l<a;++l){const c=3*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],r+=o}}function wC(e,t,i,r,s=1){const n=i.typedBuffer,o=i.typedBufferStride,a=e.length;if(r*=o,s===1)for(let l=0;l<a;++l){const c=4*e[l];n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}else for(let l=0;l<a;++l){const c=4*e[l];for(let h=0;h<s;++h)n[r]=t[c],n[r+1]=t[c+1],n[r+2]=t[c+2],n[r+3]=t[c+3],r+=o}}function dz(e,t,i,r,s,n=1){if(!i)return void Gwe(e,t,r,s,n);const o=r.typedBuffer,a=r.typedBufferStride,l=e.length,c=i[0],h=i[1],p=i[2],m=i[4],g=i[5],v=i[6],b=i[8],S=i[9],T=i[10],O=i[12],C=i[13],M=i[14];if(s*=a,n===1)for(let I=0;I<l;++I){const $=3*e[I],U=t[$],q=t[$+1],G=t[$+2];o[s]=c*U+m*q+b*G+O,o[s+1]=h*U+g*q+S*G+C,o[s+2]=p*U+v*q+T*G+M,s+=a}else for(let I=0;I<l;++I){const $=3*e[I],U=t[$],q=t[$+1],G=t[$+2],Y=c*U+m*q+b*G+O,J=h*U+g*q+S*G+C,X=p*U+v*q+T*G+M;for(let ne=0;ne<n;++ne)o[s]=Y,o[s+1]=J,o[s+2]=X,s+=a}}function uJ(e,t,i,r,s,n=1){if(!i)return void Gwe(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],m=o[2],g=o[4],v=o[5],b=o[6],S=o[8],T=o[9],O=o[10],C=!xX(o),M=1e-6,I=1-M;if(s*=l,n===1)for(let $=0;$<c;++$){const U=3*e[$],q=t[U],G=t[U+1],Y=t[U+2];let J=h*q+g*G+S*Y,X=p*q+v*G+T*Y,ne=m*q+b*G+O*Y;if(C){const re=J*J+X*X+ne*ne;if(re<I&&re>M){const ye=1/Math.sqrt(re);J*=ye,X*=ye,ne*=ye}}a[s+0]=J,a[s+1]=X,a[s+2]=ne,s+=l}else for(let $=0;$<c;++$){const U=3*e[$],q=t[U],G=t[U+1],Y=t[U+2];let J=h*q+g*G+S*Y,X=p*q+v*G+T*Y,ne=m*q+b*G+O*Y;if(C){const re=J*J+X*X+ne*ne;if(re<I&&re>M){const ye=1/Math.sqrt(re);J*=ye,X*=ye,ne*=ye}}for(let re=0;re<n;++re)a[s+0]=J,a[s+1]=X,a[s+2]=ne,s+=l}}function OJe(e,t,i,r,s,n=1){if(!i)return void wC(e,t,r,s,n);const o=i,a=r.typedBuffer,l=r.typedBufferStride,c=e.length,h=o[0],p=o[1],m=o[2],g=o[4],v=o[5],b=o[6],S=o[8],T=o[9],O=o[10],C=!xX(o),M=1e-6,I=1-M;if(s*=l,n===1)for(let $=0;$<c;++$){const U=4*e[$],q=t[U],G=t[U+1],Y=t[U+2],J=t[U+3];let X=h*q+g*G+S*Y,ne=p*q+v*G+T*Y,re=m*q+b*G+O*Y;if(C){const ye=X*X+ne*ne+re*re;if(ye<I&&ye>M){const pe=1/Math.sqrt(ye);X*=pe,ne*=pe,re*=pe}}a[s+0]=X,a[s+1]=ne,a[s+2]=re,a[s+3]=J,s+=l}else for(let $=0;$<c;++$){const U=4*e[$],q=t[U],G=t[U+1],Y=t[U+2],J=t[U+3];let X=h*q+g*G+S*Y,ne=p*q+v*G+T*Y,re=m*q+b*G+O*Y;if(C){const ye=X*X+ne*ne+re*re;if(ye<I&&ye>M){const pe=1/Math.sqrt(ye);X*=pe,ne*=pe,re*=pe}}for(let ye=0;ye<n;++ye)a[s+0]=X,a[s+1]=ne,a[s+2]=re,a[s+3]=J,s+=l}}function V5(e,t,i,r,s,n=1){const o=r.typedBuffer,a=r.typedBufferStride,l=e.length;if(s*=a,n===1){if(i===4)for(let c=0;c<l;++c){const h=4*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}else if(i===4)for(let c=0;c<l;++c){const h=4*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=t[h+3],s+=a}else if(i===3)for(let c=0;c<l;++c){const h=3*e[c];for(let p=0;p<n;++p)o[s]=t[h],o[s+1]=t[h+1],o[s+2]=t[h+2],o[s+3]=255,s+=a}}function pz(e,t,i,r,s,n){for(const o of t.fieldNames){const a=e.vertexAttributes.get(o),l=e.indices.get(o);if(a&&l)switch(o){case D.POSITION:{At(a.size===3);const c=s.getField(o,hr);c&&dz(l,a.data,i,c,n);break}case D.NORMAL:{At(a.size===3);const c=s.getField(o,hr);c&&uJ(l,a.data,r,c,n);break}case D.UV0:{At(a.size===2);const c=s.getField(o,bd);c&&AJe(l,a.data,c,n);break}case D.COLOR:{At(a.size===3||a.size===4);const c=s.getField(o,tc);c&&V5(l,a.data,a.size,c,n);break}case D.SYMBOLCOLOR:{At(a.size===3||a.size===4);const c=s.getField(o,tc);c&&V5(l,a.data,a.size,c,n);break}case D.TANGENT:{At(a.size===4);const c=s.getField(o,fo);c&&OJe(l,a.data,r,c,n);break}}}}function u3(e,t,i=0){const r=Xe(e,0,PJe);for(let s=0;s<4;s++)t[i+s]=Math.floor(256*IJe(r*RJe[s]))}function hJ(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*MJe[r];return i}const RJe=[1,256,65536,16777216],MJe=[1/256,1/65536,1/16777216,1/4294967296],PJe=hJ(new Uint8ClampedArray([255,255,255,255]));function IJe(e){return e-Math.floor(e)}function LJe(){if(N(d8)){const e=t=>tr(`esri/libs/basisu/${t}`);d8=_e(()=>import("./basis_transcoder.c84a33ed.js"),["basis_transcoder.c84a33ed.js","_commonjsHelpers.01f5fe30.js"],import.meta.url).then(t=>t.b).then(({default:t})=>t({locateFile:e}).then(i=>(i.initializeBasis(),delete i.then,i)))}return d8}let d8;var $w;(function(e){e[e.ETC1_RGB=0]="ETC1_RGB",e[e.ETC2_RGBA=1]="ETC2_RGBA",e[e.BC1_RGB=2]="BC1_RGB",e[e.BC3_RGBA=3]="BC3_RGBA",e[e.BC4_R=4]="BC4_R",e[e.BC5_RG=5]="BC5_RG",e[e.BC7_M6_RGB=6]="BC7_M6_RGB",e[e.BC7_M5_RGBA=7]="BC7_M5_RGBA",e[e.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",e[e.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",e[e.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",e[e.ATC_RGB=11]="ATC_RGB",e[e.ATC_RGBA=12]="ATC_RGBA",e[e.FXT1_RGB=17]="FXT1_RGB",e[e.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",e[e.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",e[e.ETC2_EAC_R11=20]="ETC2_EAC_R11",e[e.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",e[e.RGBA32=13]="RGBA32",e[e.RGB565=14]="RGB565",e[e.BGR565=15]="BGR565",e[e.RGBA4444=16]="RGBA4444"})($w||($w={}));let zp=null,U$=null;async function jwe(){return N(U$)&&(U$=LJe(),zp=await U$),U$}function $Je(e,t){if(N(zp))return e.byteLength;const i=new zp.BasisFile(new Uint8Array(e)),r=qwe(i)?Hwe(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),t):0;return i.close(),i.delete(),r}function DJe(e,t){if(N(zp))return e.byteLength;const i=new zp.KTX2File(new Uint8Array(e)),r=Wwe(i)?Hwe(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),t):0;return i.close(),i.delete(),r}function Hwe(e,t,i,r,s){const n=M1e(t?Ts.COMPRESSED_RGBA8_ETC2_EAC:Ts.COMPRESSED_RGB8_ETC2),o=s&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*r*n*o)}function qwe(e){return e.getNumImages()>=1&&!e.isUASTC()}function Wwe(e){return e.getFaces()>=1&&e.isETC1S()}async function NJe(e,t,i){N(zp)&&(zp=await jwe());const r=new zp.BasisFile(new Uint8Array(i));if(!qwe(r))return null;r.startTranscoding();const s=Zwe(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(n,o)=>r.getImageTranscodedSizeInBytes(0,n,o),(n,o,a)=>r.transcodeImage(a,0,n,o,0,0));return r.close(),r.delete(),s}async function FJe(e,t,i){N(zp)&&(zp=await jwe());const r=new zp.KTX2File(new Uint8Array(i));if(!Wwe(r))return null;r.startTranscoding();const s=Zwe(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(n,o)=>r.getImageTranscodedSizeInBytes(n,0,0,o),(n,o,a)=>r.transcodeImage(a,n,0,0,o,0,-1,-1));return r.close(),r.delete(),s}function Zwe(e,t,i,r,s,n,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=e.capabilities,[h,p]=l?r?[$w.ETC2_RGBA,Ts.COMPRESSED_RGBA8_ETC2_EAC]:[$w.ETC1_RGB,Ts.COMPRESSED_RGB8_ETC2]:c?r?[$w.BC3_RGBA,Ts.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[$w.BC1_RGB,Ts.COMPRESSED_RGB_S3TC_DXT1_EXT]:[$w.RGBA32,tt.RGBA],m=t.hasMipmap?i:Math.min(1,i),g=[];for(let T=0;T<m;T++)g.push(new Uint8Array(o(T,h))),a(T,h,g[T]);const v=g.length>1,b=v?mt.LINEAR_MIPMAP_LINEAR:mt.LINEAR,S={...t,samplingMode:b,hasMipmap:v,internalFormat:p,width:s,height:n};return new bt(e,S,{type:"compressed",levels:g})}const fO=Ie.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),kJe=542327876,UJe=131072,zJe=4;function dJ(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function BJe(e){return String.fromCharCode(255&e,e>>8&255,e>>16&255,e>>24&255)}const VJe=dJ("DXT1"),GJe=dJ("DXT3"),jJe=dJ("DXT5"),HJe=31,qJe=0,WJe=1,ZJe=2,XJe=3,YJe=4,QJe=7,JJe=20,KJe=21;function eKe(e,t,i){const{textureData:r,internalFormat:s,width:n,height:o}=tKe(i,t.hasMipmap);return t.samplingMode=r.levels.length>1?mt.LINEAR_MIPMAP_LINEAR:mt.LINEAR,t.hasMipmap=r.levels.length>1,t.internalFormat=s,t.width=n,t.height=o,new bt(e,t,r)}function tKe(e,t){const i=new Int32Array(e,0,HJe);if(i[qJe]!==kJe)return fO.error("Invalid magic number in DDS header"),null;if(!(i[JJe]&zJe))return fO.error("Unsupported format, must contain a FourCC code"),null;const r=i[KJe];let s,n;switch(r){case VJe:s=8,n=Ts.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case GJe:s=16,n=Ts.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case jJe:s=16,n=Ts.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return fO.error("Unsupported FourCC code:",BJe(r)),null}let o=1,a=i[YJe],l=i[XJe];(3&a)==0&&(3&l)==0||(fO.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,h=l;let p,m;i[ZJe]&UJe&&t!==!1&&(o=Math.max(1,i[QJe])),o===1||ME(a)&&ME(l)||(fO.warn("Ignoring mipmaps of non power of two sized compressed texture."),o=1);let g=i[WJe]+4;const v=[];for(let b=0;b<o;++b)m=(a+3>>2)*(l+3>>2)*s,p=new Uint8Array(e,g,m),v.push(p),g+=m,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:v},internalFormat:n,width:c,height:h}}class sn extends uI{constructor(t,i){super(),this.data=t,this.type=Kp.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new ks,this.params=i||{},this.params.mipmap=this.params.mipmap!==!1,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:Ft.REPEAT,t:Ft.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||jv.STRETCH,this.estimatedTexMemRequired=sn._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const t=this.data;N(t)||(t instanceof HTMLVideoElement?this._startPreloadVideoElement(t):t instanceof HTMLImageElement&&this._startPreloadImageElement(t))}_startPreloadVideoElement(t){if(!(UE(t.src)||t.preload==="auto"&&t.crossOrigin)){t.preload="auto",t.crossOrigin="anonymous";const i=!t.paused;if(t.src=t.src,i&&t.autoplay){const r=()=>{t.removeEventListener("canplay",r),t.play()};t.addEventListener("canplay",r)}}}_startPreloadImageElement(t){Bm(t.src)||UE(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}static _getDataDimensions(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}static _estimateTexMemRequired(t,i){if(N(t))return 0;if($A(t)||vw(t))return i.encoding===sn.KTX2_ENCODING?DJe(t,i.mipmap):i.encoding===sn.BASIS_ENCODING?$Je(t,i.mipmap):t.byteLength;const{width:r,height:s}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?sn._getDataDimensions(t):i;return(i.mipmap?4/3:1)*r*s*(i.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(t){var i;return{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?mt.LINEAR_MIPMAP_LINEAR:mt.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:(i=this.params.maxAnisotropy)!=null?i:this.params.mipmap?t.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(t,i){if(w(this._glTexture))return this._glTexture;if(w(this._loadingPromise))return this._loadingPromise;const r=this.data;return N(r)?(this._glTexture=new bt(t,this._createDescriptor(t),null),this._glTexture):typeof r=="string"?this._loadFromURL(t,i,r):r instanceof Image?this._loadFromImageElement(t,i,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(t,i,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(t,r,i):($A(r)||vw(r))&&this.params.encoding===sn.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(t,r)):($A(r)||vw(r))&&this.params.encoding===sn.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(t,r)):($A(r)||vw(r))&&this.params.encoding===sn.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(t,r)):vw(r)?this._loadFromPixelData(t,r):$A(r)?this._loadFromPixelData(t,new Uint8Array(r)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(t,i,r){if(!(this.data instanceof HTMLVideoElement)||N(this._glTexture)||this.data.readyState<GM.HAVE_CURRENT_DATA||r===this.data.currentTime)return r;if(w(this._powerOfTwoStretchInfo)){const{framebuffer:s,vao:n,sourceTexture:o}=this._powerOfTwoStretchInfo;o.setData(this.data),this._drawStretchedTexture(t,i,s,n,o,this._glTexture)}else{const{videoWidth:s,videoHeight:n}=this.data,{width:o,height:a}=this._glTexture.descriptor;s!==o||n!==a?this._glTexture.updateData(0,0,0,Math.min(s,o),Math.min(n,a),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(t,i){return this._glTexture=eKe(t,this._createDescriptor(t),i),this._glTexture}_loadFromKTX2(t,i){return this._loadAsync(()=>FJe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromBasis(t,i){return this._loadAsync(()=>NJe(t,this._createDescriptor(t),i).then(r=>(this._glTexture=r,r)))}_loadFromPixelData(t,i){At(this.params.width>0&&this.params.height>0);const r=this._createDescriptor(t);return r.pixelFormat=this.params.components===1?tt.LUMINANCE:this.params.components===3?tt.RGB:tt.RGBA,r.width=this.params.width,r.height=this.params.height,this._glTexture=new bt(t,r,i),this._glTexture}_loadFromURL(t,i,r){return this._loadAsync(async s=>{const n=await Qp(r,{signal:s});return Ui(s),this._loadFromImage(t,n,i)})}_loadFromImageElement(t,i,r){return r.complete?this._loadFromImage(t,r,i):this._loadAsync(async s=>{const n=await mfe(r,r.src,!1,s);return Ui(s),this._loadFromImage(t,n,i)})}_loadFromVideoElement(t,i,r){return r.readyState>=GM.HAVE_CURRENT_DATA?this._loadFromImage(t,r,i):this._loadFromVideoElementAsync(t,i,r)}_loadFromVideoElementAsync(t,i,r){return this._loadAsync(s=>new Promise((n,o)=>{const a=()=>{r.removeEventListener("loadeddata",l),r.removeEventListener("error",c),Ln(h)},l=()=>{r.readyState>=GM.HAVE_CURRENT_DATA&&(a(),n(this._loadFromImage(t,r,i)))},c=p=>{a(),o(p||new se("Failed to load video"))};r.addEventListener("loadeddata",l),r.addEventListener("error",c);const h=Ma(s,()=>c($i()))}))}_loadFromImage(t,i,r){const s=sn._getDataDimensions(i);this.params.width=s.width,this.params.height=s.height;const n=this._createDescriptor(t);return n.pixelFormat=this.params.components===3?tt.RGB:tt.RGBA,!this._requiresPowerOfTwo(t,n)||ME(s.width)&&ME(s.height)?(n.width=s.width,n.height=s.height,this._glTexture=new bt(t,n,i),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(t,i,s,n,r),this._glTexture)}_loadAsync(t){const i=new AbortController;this._loadingController=i;const r=t(i.signal);this._loadingPromise=r;const s=()=>{this._loadingController===i&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null)};return r.then(s,s),r}_requiresPowerOfTwo(t,i){const r=Ft.CLAMP_TO_EDGE,s=typeof i.wrapMode=="number"?i.wrapMode===r:i.wrapMode.s===r&&i.wrapMode.t===r;return!co(t.gl)&&(i.hasMipmap||!s)}_makePowerOfTwoTexture(t,i,r,s,n){const{width:o,height:a}=r,l=RE(o),c=RE(a);let h;switch(s.width=l,s.height=c,this.params.powerOfTwoResizeMode){case jv.PAD:s.textureCoordinateScaleFactor=[o/l,a/c],h=new bt(t,s),h.updateData(0,0,0,o,a,i);break;case jv.STRETCH:case null:case void 0:h=this._stretchToPowerOfTwo(t,i,s,n());break;default:this.params.powerOfTwoResizeMode}return s.hasMipmap&&h.generateMipmap(),h}_stretchToPowerOfTwo(t,i,r,s){const n=new bt(t,r),o=new Xr(t,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},n),a=new bt(t,{target:Ot.TEXTURE_2D,pixelFormat:r.pixelFormat,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!!r.flipped,maxAnisotropy:8,preMultiplyAlpha:r.preMultiplyAlpha},i),l=fl(t),c=t.getBoundFramebufferObject();return this._drawStretchedTexture(t,s,o,l,a,n),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:l,sourceTexture:a,framebuffer:o}:(l.dispose(!0),a.dispose(),o.detachColorTexture(),o.dispose()),t.bindFramebuffer(c),n}_drawStretchedTexture(t,i,r,s,n,o){t.bindFramebuffer(r);const a=t.getViewport();t.setViewport(0,0,o.descriptor.width,o.descriptor.height);const l=t.bindTechnique(i);l.setUniform4f("uColor",1,1,1,1),l.bindTexture("tex",n),t.bindVAO(s),t.drawArrays(Yt.TRIANGLE_STRIP,0,na(s,"geometry")),t.bindFramebuffer(null),t.setViewport(a.x,a.y,a.width,a.height)}unload(){if(w(this._powerOfTwoStretchInfo)){const{framebuffer:t,vao:i,sourceTexture:r}=this._powerOfTwoStretchInfo;i.dispose(!0),r.dispose(),t.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if(w(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),w(this._loadingController)){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}}var GM;sn.DDS_ENCODING="image/vnd-ms.dds",sn.KTX2_ENCODING="image/ktx2",sn.BASIS_ENCODING="image/x.basis",function(e){e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(GM||(GM={}));const h3=128,pJ=.5;function Xwe(e,t=h3,i=t*pJ,r=0){const s=iKe(e,t,i,r);return new sn(s,{mipmap:!1,wrap:{s:Ft.CLAMP_TO_EDGE,t:Ft.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0})}function iKe(e,t=h3,i=t*pJ,r=0){switch(e){case"circle":default:return rKe(t,i);case"square":return sKe(t,i);case"cross":return oKe(t,i,r);case"x":return aKe(t,i,r);case"kite":return nKe(t,i);case"triangle":return lKe(t,i);case"arrow":return cKe(t,i)}}function rKe(e,t){const i=e/2-.5;return mI(e,Jwe(i,i,t/2))}function sKe(e,t){return Ywe(e,t,!1)}function nKe(e,t){return Ywe(e,t,!0)}function oKe(e,t,i=0){return Qwe(e,t,!1,i)}function aKe(e,t,i=0){return Qwe(e,t,!0,i)}function lKe(e,t){return mI(e,Kwe(e/2,t,t/2))}function cKe(e,t){const i=t,r=t/2,s=e/2,n=.8*i,o=Jwe(s,(e-t)/2-n,Math.sqrt(n*n+r*r)),a=Kwe(s,i,r);return mI(e,(l,c)=>Math.max(a(l,c),-o(l,c)))}function Ywe(e,t,i){return i&&(t/=Math.SQRT2),mI(e,(r,s)=>{let n=r-.5*e+.25,o=.5*e-s-.75;if(i){const a=(n+o)/Math.SQRT2;o=(o-n)/Math.SQRT2,n=a}return Math.max(Math.abs(n),Math.abs(o))-.5*t})}function Qwe(e,t,i,r=0){t-=r,i&&(t*=Math.SQRT2);const s=.5*t;return mI(e,(n,o)=>{let a,l=n-.5*e,c=.5*e-o-1;if(i){const h=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=h}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>s?Math.sqrt((l-s)*(l-s)+c*c):c:c>s?Math.sqrt(l*l+(c-s)*(c-s)):l,a-=r/2,a})}function Jwe(e,t,i){return(r,s)=>{const n=r-e,o=s-t;return Math.sqrt(n*n+o*o)-i}}function Kwe(e,t,i){const r=Math.sqrt(t*t+i*i);return(s,n)=>{const o=Math.abs(s-e)-i,a=n-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function mI(e,t){const i=new Uint8Array(4*e*e);for(let r=0;r<e;r++)for(let s=0;s<e;s++){const n=s+e*r;let o=t(s,r);o=o/e+.5,u3(o,i,4*n)}return i}class Abt extends mn{constructor(t){super(),this.slicePlaneLocalOrigin=t}}function uKe(e,t){exe(e,t,[new Ut("slicePlaneOrigin",(i,r)=>sxe(t,i,r)),new Ut("slicePlaneBasis1",(i,r)=>{var s;return G5(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new Ut("slicePlaneBasis2",(i,r)=>{var s;return G5(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function Ns(e,t){exe(e,t,[new al("slicePlaneOrigin",(i,r)=>sxe(t,i,r)),new al("slicePlaneBasis1",(i,r)=>{var s;return G5(t,i,r,(s=r.slicePlane)==null?void 0:s.basis1)}),new al("slicePlaneBasis2",(i,r)=>{var s;return G5(t,i,r,(s=r.slicePlane)==null?void 0:s.basis2)})])}function exe(e,t,i){if(!t.hasSlicePlane){const o=E`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return t.hasSliceInVertexProgram&&e.vertex.code.add(o),void e.fragment.code.add(o)}e.extensions.add("GL_OES_standard_derivatives"),t.hasSliceInVertexProgram&&e.vertex.uniforms.add(i),e.fragment.uniforms.add(i);const r=E`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,s=E`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,n=t.hasSliceHighlight?E`
        ${s}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:E`#define highlightSlice(_color_, _pos_) (_color_)`;t.hasSliceInVertexProgram&&e.vertex.code.add(r),e.fragment.code.add(r),e.fragment.code.add(n)}function txe(e,t,i){return e.instancedDoublePrecision?fe(hKe,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function ixe(e,t){return w(e)?Me(j5,t.origin,e):t.origin}function rxe(e,t,i){return e.hasSliceTranslatedView?w(t)?hl(dKe,i.camera.viewMatrix,t):i.camera.viewMatrix:null}function sxe(e,t,i){if(N(i.slicePlane))return ol;const r=txe(e,t,i),s=ixe(r,i.slicePlane),n=rxe(e,r,i);return w(n)?et(j5,s,n):s}function G5(e,t,i,r){if(N(r)||N(i.slicePlane))return ol;const s=txe(e,t,i),n=ixe(s,i.slicePlane),o=rxe(e,s,i);return w(o)?(Oe(mO,r,n),et(j5,n,o),et(mO,mO,o),Me(mO,mO,j5)):r}const hKe=F(),j5=F(),mO=F(),dKe=Be();function pKe(e,t){const{vertex:i,fragment:r}=e;t.hasMultipassGeometry&&i.include(rbe),t.hasMultipassTerrain&&e.varyings.add("depth","float"),i.code.add(E`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${t.hasMultipassGeometry?E`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${t.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),t.hasMultipassTerrain&&r.include(nh),t.hasMultipassTerrain&&r.uniforms.add([new ai("terrainDepthTexture",(s,n)=>n.multipassTerrain.linearDepthTexture),new Ni("nearFar",(s,n)=>n.camera.nearFar),new Ni("inverseViewport",(s,n)=>n.inverseViewport)]),r.include(Xc),r.code.add(E`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${t.hasMultipassTerrain?E`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}const fKe=ki(1,1,0,1),nxe=ki(1,0,1,1);function d0(e){e.fragment.uniforms.add(new ai("depthTex",(t,i)=>i.highlightDepthTexture)),e.fragment.uniforms.add(new Ni("highlightViewportPixelSz",(t,i)=>i.inverseViewport)),e.fragment.constants.add("occludedHighlightFlag","vec4",fKe).add("unoccludedHighlightFlag","vec4",nxe),e.fragment.code.add(E`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}class fz extends vs{constructor(t,i,r){super(t,"vec4",nr.Pass,(s,n,o)=>s.setUniform4fv(t,i(n,o)),r)}}class Aa extends vs{constructor(t,i,r){super(t,"float",nr.Pass,(s,n,o)=>s.setUniform1fv(t,i(n,o)),r)}}class gI extends vs{constructor(t,i){super(t,"mat3",nr.Pass,(r,s,n)=>r.setUniformMatrix3fv(t,i(s,n)))}}class fJ extends cA{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=Ke(1,1,1),this.vvSizeMaxSize=Ke(100,100,100),this.vvSizeOffset=Ke(0,0,0),this.vvSizeFactor=Ke(1,1,1),this.vvSizeValue=Ke(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Qr()}}const Bp=8;function mE(e,t){t.hasVvInstancing&&(t.vvSize||t.vvColor)&&e.attributes.add(D.INSTANCEFEATUREATTRIBUTE,"vec4");const i=e.vertex;t.vvSize?(i.uniforms.add(new Ut("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Ut("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Ut("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Ut("vvSizeFactor",r=>r.vvSizeFactor)),i.uniforms.add(new gI("vvSymbolRotationMatrix",r=>r.vvSymbolRotationMatrix)),i.uniforms.add(new Ut("vvSymbolAnchor",r=>r.vvSymbolAnchor)),i.code.add(E`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),i.code.add(E`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${t.hasVvInstancing?E`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):i.code.add(E`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),t.vvColor?(i.constants.add("vvColorNumber","int",Bp),t.hasVvInstancing&&i.uniforms.add([new Aa("vvColorValues",r=>r.vvColorValues,Bp),new fz("vvColorColors",r=>r.vvColorColors,Bp)]),i.code.add(E`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${t.hasVvInstancing?E`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):i.code.add(E`vec4 vvColor() { return vec4(1.0); }`)}const H5=.1,la=.001;function mKe(e){const t=new dr,i=e.signedDistanceFieldEnabled;if(t.include(DQ),t.include(Nwe,e),t.include(Ns,e),e.output===ue.Occlusion)return t.include(pKe,e),t;const{vertex:r,fragment:s}=t;t.include(oJ),s.include(Xc),s.include(Wm),t.include(mE,e),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),e.binaryHighlightOcclusionEnabled&&t.varyings.add("voccluded","float"),r.uniforms.add([new Ci("viewport",(c,h)=>h.camera.fullViewport),new Ni("screenOffset",(c,h)=>Di(oxe,2*c.screenOffset[0]*h.camera.pixelRatio,2*c.screenOffset[1]*h.camera.pixelRatio)),new Ni("anchorPosition",c=>q5(c)),new Ci("materialColor",c=>c.color),new lt("pixelRatio",(c,h)=>h.camera.pixelRatio)]),i&&(r.uniforms.add(new Ci("outlineColor",c=>c.outlineColor)),s.uniforms.add([new Ci("outlineColor",c=>_oe(c)?c.outlineColor:vm),new lt("outlineSize",c=>_oe(c)?c.outlineSize:0)])),e.hasScreenSizePerspective&&(_Je(r),uz(r)),(e.debugDrawLabelBorder||e.binaryHighlightOcclusionEnabled)&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(D.UV0,"vec2"),t.attributes.add(D.COLOR,"vec4"),t.attributes.add(D.SIZE,"vec2"),t.attributes.add(D.AUXPOS2,"vec4"),r.code.add(E`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${e.hasScreenSizePerspective?E`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:E`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${e.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${e.occlusionTestEnabled||e.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${e.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const n=E`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,o=e.pixelSnappingEnabled?i?E`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:E`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:E`posProj += quadOffset;`;e.vvColor&&r.uniforms.add([new fz("vvColorColors",c=>c.vvColorColors,Bp),new Aa("vvColorValues",c=>c.vvColorValues,Bp)]),r.uniforms.add(new Ni("textureCoordinateScaleFactor",c=>w(c.texture)&&w(c.texture.descriptor.textureCoordinateScaleFactor)?c.texture.descriptor.textureCoordinateScaleFactor:Hme)),r.code.add(E`
    ${e.occlusionTestEnabled?"if (visible) {":""}
    ${n}
    ${e.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${E.float(la)};
    ${i?`alphaDiscard = alphaDiscard && outlineColor.a < ${E.float(la)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${e.occlusionTestEnabled?E`} else { vtc = vec2(0.0);
      ${e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),s.uniforms.add(new ai("tex",c=>c.texture));const a=e.debugDrawLabelBorder?E`(isBorder > 0.0 ? 0.0 : ${E.float(H5)})`:E.float(H5),l=E`
    ${e.debugDrawLabelBorder?E`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${i?E`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${E.float(h3)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${E.float(la)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:E`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${e.debugDrawLabelBorder?E`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return e.output===ue.Alpha&&s.code.add(E`
      void main() {
        ${l}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),e.output===ue.Color&&s.code.add(E`
    void main() {
      ${l}
      ${e.transparencyPassType===Pt.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),e.output===ue.Highlight&&(t.include(d0),s.code.add(E`
    void main() {
      ${l}
      ${e.binaryHighlightOcclusionEnabled?E`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),t}function _oe(e){return e.outlineColor[3]>0&&e.outlineSize>0}function q5(e,t=oxe){return e.textureIsSignedDistanceField?gKe(e.anchorPosition,e.distanceFieldBoundingBox,t):zo(t,e.anchorPosition),t}function gKe(e,t,i){w(t)?Di(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):Di(i,0,0)}const oxe=yt(),yKe=Object.freeze(Object.defineProperty({__proto__:null,build:mKe,calculateAnchorPosForRendering:q5},Symbol.toStringTag,{value:"Module"})),Qu=Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),_Ke=qm(je.ONE,je.ONE),axe=qm(je.ZERO,je.ONE_MINUS_SRC_ALPHA);function p0(e){return e===Pt.FrontFace?null:e===Pt.Alpha?axe:_Ke}function mz(e){return e===Pt.FrontFace?ec:null}const gz=5e5,yz={factor:-1,units:-2};function _z(e){return e?yz:null}function C1(e,t=kr.LESS){return e===Pt.NONE||e===Pt.FrontFace?t:kr.LEQUAL}class yI extends $r{initializeConfiguration(t,i){i.spherical=t.viewingMode===st.Global}initializeProgram(t){const i=yI.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}_setPipelineState(t){const i=this.configuration,r=t===Pt.NONE,s=t===Pt.FrontFace,n=this.configuration.hasPolygonOffset&&vKe,o=(r||s)&&i.output!==ue.Highlight?(i.depthEnabled||i.output===ue.Occlusion)&&ec:null;return ni({blending:i.output===ue.Color||i.output===ue.Alpha||i.output===ue.Highlight?r?bKe:p0(t):null,depthTest:{func:kr.LEQUAL},depthWrite:o,colorWrite:wi,polygonOffset:n})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===ue.Occlusion?Yt.POINTS:Yt.TRIANGLES}}yI.shader=new Tr(yKe,()=>_e(()=>import("./HUDMaterial.glsl.6e47c611.js"),[],import.meta.url));const vKe={factor:0,units:-4},bKe=qm(je.ONE,je.ONE_MINUS_SRC_ALPHA);class Oa extends pl{}u([ee({constValue:!0})],Oa.prototype,"hasSliceHighlight",void 0),u([ee({constValue:!1})],Oa.prototype,"hasSliceInVertexProgram",void 0),u([ee({constValue:!1})],Oa.prototype,"instancedDoublePrecision",void 0),u([ee({constValue:!1})],Oa.prototype,"isGround",void 0),u([ee({constValue:nr.Pass})],Oa.prototype,"pbrTextureBindType",void 0);class Ks extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.screenCenterOffsetUnitsEnabled=Ul.World,this.transparencyPassType=Pt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([ee({count:ue.COUNT})],Ks.prototype,"output",void 0),u([ee({count:Ul.COUNT})],Ks.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([ee({count:Pt.COUNT})],Ks.prototype,"transparencyPassType",void 0),u([ee()],Ks.prototype,"spherical",void 0),u([ee()],Ks.prototype,"occlusionTestEnabled",void 0),u([ee()],Ks.prototype,"signedDistanceFieldEnabled",void 0),u([ee()],Ks.prototype,"vvSize",void 0),u([ee()],Ks.prototype,"vvColor",void 0),u([ee()],Ks.prototype,"hasVerticalOffset",void 0),u([ee()],Ks.prototype,"hasScreenSizePerspective",void 0),u([ee()],Ks.prototype,"debugDrawLabelBorder",void 0),u([ee()],Ks.prototype,"binaryHighlightOcclusionEnabled",void 0),u([ee()],Ks.prototype,"hasSlicePlane",void 0),u([ee()],Ks.prototype,"hasPolygonOffset",void 0),u([ee()],Ks.prototype,"depthEnabled",void 0),u([ee()],Ks.prototype,"pixelSnappingEnabled",void 0),u([ee()],Ks.prototype,"isDraped",void 0),u([ee()],Ks.prototype,"hasMultipassGeometry",void 0),u([ee()],Ks.prototype,"hasMultipassTerrain",void 0),u([ee()],Ks.prototype,"cullAboveGround",void 0),u([ee({constValue:!0})],Ks.prototype,"hasSliceInVertexProgram",void 0),u([ee({constValue:!1})],Ks.prototype,"hasVvInstancing",void 0);class xC extends Xm{constructor(t){super(t,new MKe),this.techniqueConfig=new Ks}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Ul.Screen:Ul.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,t===ue.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),t===ue.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=i.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){w(c)?this._intersectDrapedHudGeometry(t,o,a,l,c):this._intersectHudGeometry(t,i,r,s,a,l)}_intersectDrapedHudGeometry(t,i,r,s,n){const o=t.vertexAttributes.get(D.POSITION),a=t.vertexAttributes.get(D.SIZE),l=this.parameters,c=q5(l);let h=1,p=1;if(w(s)){const g=s(woe);h=g[0],p=g[5]}h*=t.screenToWorldRatio,p*=t.screenToWorldRatio;const m=OKe*t.screenToWorldRatio;for(let g=0;g<o.data.length/o.size;g++){const v=g*o.size,b=o.data[v],S=o.data[v+1],T=g*a.size;let O;W0[0]=a.data[T]*h,W0[1]=a.data[T+1]*p,l.textureIsSignedDistanceField&&(O=l.outlineSize*t.screenToWorldRatio/2),voe(i,b,S,W0,m,O,l,c)&&r(n.dist,n.normal,-1,!1)}}_intersectHudGeometry(t,i,r,s,n,o){if(!s.options.selectionMode||!s.options.hud||hI(i))return;const a=this.parameters;let l=1,c=1;if(_d(f8,r),w(o)){const O=o(woe);l=O[0],c=O[5],TKe(f8)}const h=t.vertexAttributes.get(D.POSITION),p=t.vertexAttributes.get(D.SIZE),m=t.vertexAttributes.get(D.NORMAL),g=t.vertexAttributes.get(D.AUXPOS1);At(h.size>=3);const v=s.point,b=s.camera,S=q5(a);l*=b.pixelRatio,c*=b.pixelRatio;const T=this.parameters.centerOffsetUnits==="screen";for(let O=0;O<h.data.length/h.size;O++){const C=O*h.size;fe(ya,h.data[C],h.data[C+1],h.data[C+2]),et(ya,ya,r);const M=O*p.size;W0[0]=p.data[M]*l,W0[1]=p.data[M+1]*c,et(ya,ya,b.viewMatrix);const I=O*g.size;if(fe(su,g.data[I+0],g.data[I+1],g.data[I+2]),!T&&(ya[0]+=su[0],ya[1]+=su[1],su[2]!==0)){const U=su[2];De(su,ya),Me(ya,ya,be(su,su,U))}const $=O*m.size;if(fe(gO,m.data[$],m.data[$+1],m.data[$+2]),this._normalAndViewAngle(gO,f8,b,m8),this._applyVerticalOffsetTransformationView(ya,m8,b,p8),b.applyProjection(ya,Na),Na[0]>-1){Na[0]=Math.floor(Na[0]),Na[1]=Math.floor(Na[1]),T&&(su[0]||su[1])&&(Na[0]+=su[0],su[1]!==0&&(Na[1]+=nJ(su[1],p8.factorAlignment)),b.unapplyProjection(Na,ya)),Na[0]+=this.parameters.screenOffset[0],Na[1]+=this.parameters.screenOffset[1],Mwe(W0,p8.factor,W0);const U=AKe*b.pixelRatio;let q;if(a.textureIsSignedDistanceField&&(q=a.outlineSize*b.pixelRatio/2),voe(v,Na[0],Na[1],W0,U,q,a,S)){const G=s.ray;if(et(boe,ya,Fs(CKe,b.viewMatrix)),Na[0]=v[0],Na[1]=v[1],b.unprojectFromRenderScreen(Na,ya)){const Y=F();ve(Y,G.direction);const J=1/He(Y);be(Y,Y,J),n(Pr(G.origin,ya)*J,Y,-1,!0,1,boe)}}}}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(D.POSITION),n=t.indices.get(D.POSITION);return fbe(s,n,i)}createBufferWriter(){return new IKe(this)}_normalAndViewAngle(t,i,r,s){return yJe(i)&&(i=_d(EKe,i)),$c(s.normal,t,i),et(s.normal,s.normal,r.viewInverseTransposeMatrix),s.cosAngle=ke(cxe,RKe),s}_updateScaleInfo(t,i,r){const s=this.parameters;w(s.screenSizePerspective)?poe(r,i,s.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minPixelSize=0,t.factor.paddingPixels=0),w(s.screenSizePerspectiveAlignment)?poe(r,i,s.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minPixelSize=t.factor.minPixelSize,t.factorAlignment.paddingPixels=t.factor.paddingPixels)}applyShaderOffsetsView(t,i,r,s,n,o,a){const l=this._normalAndViewAngle(i,r,n,m8);return this._applyVerticalGroundOffsetView(t,l,n,a),this._applyVerticalOffsetTransformationView(a,l,n,o),this._applyPolygonOffsetView(a,l,s[3],n,a),this._applyCenterOffsetView(a,s,a),a}applyShaderOffsetsNDC(t,i,r,s,n){return this._applyCenterOffsetNDC(t,i,r,s),w(n)&&ve(n,s),this._applyPolygonOffsetNDC(s,i,r,s),s}_applyPolygonOffsetView(t,i,r,s,n){const o=s.aboveGround?1:-1;let a=Math.sign(r);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return ve(n,t);const c=Xe(Math.abs(i.cosAngle),.01,1),h=1-Math.sqrt(1-c*c)/c/s.viewport[2];return be(n,t,l>0?h:1/h),n}_applyVerticalGroundOffsetView(t,i,r,s){const n=He(t),o=r.aboveGround?1:-1,a=.5*r.computeRenderPixelSizeAtDist(n),l=be(ya,i.normal,o*a);return Oe(s,t,l),s}_applyVerticalOffsetTransformationView(t,i,r,s){const n=this.parameters;if(!n.verticalOffset||!n.verticalOffset.screenLength){if(n.screenSizePerspective||n.screenSizePerspectiveAlignment){const c=He(t);this._updateScaleInfo(s,c,i.cosAngle)}else s.factor.scale=1,s.factorAlignment.scale=1;return t}const o=He(t),a=$t(n.screenSizePerspectiveAlignment,n.screenSizePerspective),l=zwe(r,o,n.verticalOffset,i.cosAngle,a);return this._updateScaleInfo(s,o,i.cosAngle),be(i.normal,i.normal,l),Oe(t,t,i.normal)}_applyCenterOffsetView(t,i,r){const s=this.parameters.centerOffsetUnits!=="screen";return r!==t&&ve(r,t),s&&(r[0]+=i[0],r[1]+=i[1],i[2]&&(De(gO,r),Oe(r,r,be(gO,gO,i[2])))),r}_applyCenterOffsetNDC(t,i,r,s){const n=this.parameters.centerOffsetUnits!=="screen";return s!==t&&ve(s,t),n||(s[0]+=i[0]/r.fullWidth*2,s[1]+=i[1]/r.fullHeight*2),s}_applyPolygonOffsetNDC(t,i,r,s){const n=this.parameters.shaderPolygonOffset;if(t!==s&&ve(s,t),n){const o=r.aboveGround?1:-1,a=o*Math.sign(i[3]);s[2]-=(a||o)*n}return s}requiresSlot(t){if(t===Ue.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:r}=this.parameters;return t===(i?Ue.LABEL_MATERIAL:Ue.HUD_MATERIAL)||r&&t===Ue.OCCLUSION_PIXELS}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Alpha?new wKe(t):t.output===ue.Highlight?new lxe(t):null}calculateRelativeScreenBounds(t,i,r=ei()){return xKe(this.parameters,t,i,r),r[2]=r[0]+t[0],r[3]=r[1]+t[1],r}}class lxe extends vQ{constructor(t){super({...t,...t.material.parameters})}selectProgram(t){return this.ensureTechnique(yI,t)}beginSlot(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(t)}}class wKe extends lxe{_isOcclusionSlot(t){return t.slot===Ue.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===ue.Color||this._output===ue.Alpha)}selectProgram(t){return this.ensureTechnique(yI,t,this._isOcclusionSlot(t)?ue.Occlusion:this._output)}}function xKe(e,t,i,r=SKe){return zo(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i,r}function TKe(e){const t=e[0],i=e[1],r=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=1/Math.sqrt(t*t+i*i+r*r),p=1/Math.sqrt(s*s+n*n+o*o),m=1/Math.sqrt(a*a+l*l+c*c);return e[0]=t*h,e[1]=i*h,e[2]=r*h,e[3]=s*p,e[4]=n*p,e[5]=o*p,e[6]=a*m,e[7]=l*m,e[8]=c*m,e}function voe(e,t,i,r,s,n,o,a){let l=t-s-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*s,h=i-s-(a[1]>0?r[1]*a[1]:0),p=h+r[1]+2*s;const m=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&w(m)&&(l+=r[0]*m[0],h+=r[1]*m[1],c-=r[0]*(1-m[2]),p-=r[1]*(1-m[3]),l-=n,c+=n,h-=n,p+=n),e[0]>l&&e[0]<c&&e[1]>h&&e[1]<p}const p8={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},SKe=yt(),ya=F(),gO=F(),Na=di(),cxe=F(),boe=F(),f8=Qr(),EKe=Qr(),CKe=Be(),su=F(),m8={normal:cxe,cosAngle:0},woe=Be(),AKe=1,OKe=2,W0=[0,0],RKe=Ke(0,0,1);class MKe extends H1e{constructor(){super(...arguments),this.renderOccluded=ts.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=ir(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const PKe=As().vec3f(D.POSITION).vec3f(D.NORMAL).vec2f(D.UV0).vec4u8(D.COLOR).vec2f(D.SIZE).vec4f(D.AUXPOS1).vec4f(D.AUXPOS2);class IKe{constructor(t){this.material=t,this.vertexBufferLayout=PKe}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(D.POSITION).length}write(t,i,r,s){dz(i.indices.get(D.POSITION),i.vertexAttributes.get(D.POSITION).data,t.transformation,r.position,s,6),uJ(i.indices.get(D.NORMAL),i.vertexAttributes.get(D.NORMAL).data,t.invTranspTransformation,r.normal,s,6);{const n=i.vertexAttributes.get(D.UV0).data;let o,a,l,c;if(n==null||n.length<4){const g=this.material.parameters;o=0,a=0,l=g.texCoordScale[0],c=g.texCoordScale[1]}else o=n[0],a=n[1],l=n[2],c=n[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);const h=i.indices.get(D.POSITION).length,p=r.uv0;let m=s;for(let g=0;g<h;++g)p.set(m,0,o),p.set(m,1,a),m+=1,p.set(m,0,l),p.set(m,1,a),m+=1,p.set(m,0,l),p.set(m,1,c),m+=1,p.set(m,0,l),p.set(m,1,c),m+=1,p.set(m,0,o),p.set(m,1,c),m+=1,p.set(m,0,o),p.set(m,1,a),m+=1}V5(i.indices.get(D.COLOR),i.vertexAttributes.get(D.COLOR).data,4,r.color,s,6);{const n=i.indices.get(D.SIZE),o=i.vertexAttributes.get(D.SIZE).data,a=n.length,l=r.size;let c=s;for(let h=0;h<a;++h){const p=o[2*n[h]],m=o[2*n[h]+1];for(let g=0;g<6;++g)l.set(c,0,p),l.set(c,1,m),c+=1}}i.indices.get(D.AUXPOS1)&&i.vertexAttributes.get(D.AUXPOS1)&&wC(i.indices.get(D.AUXPOS1),i.vertexAttributes.get(D.AUXPOS1).data,r.auxpos1,s,6),i.indices.get(D.AUXPOS2)&&i.vertexAttributes.get(D.AUXPOS2)&&wC(i.indices.get(D.AUXPOS2),i.vertexAttributes.get(D.AUXPOS2).data,r.auxpos2,s,6)}}const ff=F(),sS=di(),yO=di(),g8=F(),LKe=Be(),$Ke=Qn(),y8=Lo(),DKe=F(),NKe=ei();class FKe{constructor(){this.aabr=ei(),this.distance=0,this.culled=!1,this.visible=!1}}class kKe{constructor(t,i,r={}){this.graphics3DGraphic=t,this.slicePlaneEnabled=i,this.info=r}}class UKe{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class zKe{}class BKe{constructor(){this.sortArray=new hi({allocator:t=>t||new zKe})}}var wc;(function(e){e[e.Idle=0]="Idle",e[e.Process=1]="Process",e[e.Sort=2]="Sort",e[e.Deconflict=3]="Deconflict",e[e.NumStates=4]="NumStates"})(wc||(wc={}));class uxe{constructor(){this.camera=new wr,this.slicePlane=T1(),this.slicePlaneEnabled=!1}copyFrom(t){this.camera.copyFrom(t.camera),yT(t.slicePlane,this.slicePlane),this.slicePlaneEnabled=t.slicePlaneEnabled}}let q2=class extends ze{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new uxe,this._state=wc.Idle,this.graphics=new UKe,this.iterators=new BKe,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==wc.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const e=this._state/wc.NumStates;return this._dirty?.5*e:e}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(e){switch(this._state){case wc.Idle:this._startUpdate(),e.madeProgress();case wc.Process:if(this._state=wc.Process,!this._processActiveGraphics(e))return;case wc.Sort:if(this._state=wc.Sort,!this._sortVisibleGraphics(e))return;case wc.Deconflict:if(this._state=wc.Deconflict,!this._deconflictVisibleGraphics(e))return;default:oJe(this,this.graphics.visible),this._state=wc.Idle,this.notifyChange("updating")}}modifyGraphics(e,t){t?e.forEach(i=>this.addToActiveGraphics(i)):e.forEach(i=>this.removeFromActiveGraphics(i)),this.setDirty()}layerSupportsDeconfliction(e){if(N(e)||e.type!=="object3d")return!1;const t=e.stageObject;return(t?t.geometryRecords.length:0)!==1?!1:t.geometryRecords[0].material instanceof xC}_startUpdate(){aJe(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:e,fullHeight:t}=this._runningViewState.camera;this._initBins(e,t),this._resetIterators()}addToActiveGraphics(e){e.info[this.visibilityGroup]=new FKe,this.graphics.active.set(e.graphics3DGraphic.graphic.uid,e),this.setDirty()}removeFromActiveGraphics(e){this._removeFromVisibleGraphics(e),VKe(e,this.visibilityGroup),delete e.info[this.visibilityGroup],this.graphics.active.delete(e.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(e){this.graphics.visible.set(e.graphics3DGraphic.graphic.uid,e)}_removeFromVisibleGraphics(e){this.graphics.visible.delete(e.graphics3DGraphic.graphic.uid)}_processActiveGraphics(e){const t=this._ensureActiveGraphicsIterator(),i=Fs(LKe,this._runningViewState.camera.projectionMatrix),r=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?$Ke:null;let s=0;for(w(r)&&(et(r,ol,this._runningViewState.camera.viewMatrix),r[3]=ji(this.view.spatialReference).radius,s=oge(r,ol));!e.done;){e.madeProgress();const n=t.next();if(n.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=n.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,i,r,s),a.culled?this._removeFromVisibleGraphics(o):this._addToVisibleGraphics(o))}return!1}_sortVisibleGraphics(e){const t=this._ensureSortGraphicsIterator();for(;!e.done;){const i=t.next();if(e.madeProgress(),i.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(e){const t=this._ensureVisibleGraphicsIterator(),i=this.visibilityGroup===Po.LABEL;for(;!e.done;){e.madeProgress();const r=t.next();if(r.done===!0)return this._resetVisibleGraphicsIterator(),!0;const s=r.value,n=s.info[this.visibilityGroup];if(!n||n.culled)continue;const o=s.graphics3DGraphic,a=(!i||o.isVisible())&&!this._isConflicted(s);a&&this._addToBins(s),n.visible=a,this._setGraphicVisibility(s,a),cJe(n,a)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=xoe(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=xoe(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=GKe(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(e,t,i,r){const s=e.graphics3DGraphic;if(s.destroyed)return;const n=e.info[this.visibilityGroup];if(!s.isVisible(Po.GRAPHIC,ku.DECONFLICTION))return void(n.culled=!0);const o=this.getGraphicsLayers(s);th(n.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometryRecords[0].material;if(N(a)){if(a=this._getProjectionInfo(l,t,qKe),a.isOutsideScreen||this._isCulledBySlice(e,ff)||w(i)&&this._isCulledByHorizon(a,i,r))return void(n.culled=!0);!ur.TESTS_DISABLE_OPTIMIZATIONS&&n.visible&&(a.distance*=.7)}this._expandBoundingRect(n,l,c,a)}N(a)?n.culled=!0:(n.distance=a.distance,n.culled=!1)}_getProjectionInfo(e,t,i){const r=this._runningViewState.camera,s=e.stageObject,n=s.geometryRecords[0],o=n.material,a=s.boundingVolumeWorldSpace.bounds;et(ff,a,r.viewMatrix);const l=n.geometry.vertexAttributes,c=l.get(D.NORMAL).data,h=l.get(D.AUXPOS1).data;return o.applyShaderOffsetsView(ff,c,s.transformation,h,r,i.scaleInfo,ff),_r(sS,ff[0],ff[1],ff[2],1),zu(yO,sS,r.projectionMatrix),be(i.positionNDC,yO,1/yO[3]),o.applyShaderOffsetsNDC(i.positionNDC,h,r,i.positionNDC,g8),i.distanceWithoutPolygonOffset=r.depthNDCToWorld(g8[2]),i.distance=g8[2]===i.positionNDC[2]?i.distanceWithoutPolygonOffset:r.depthNDCToWorld(i.positionNDC[2]),_r(yO,i.positionNDC[0],i.positionNDC[1],i.positionNDC[2],1),zu(sS,yO,t),z3(sS,sS,1/sS[3]),fe(i.positionView,ff[0],ff[1],ff[2]),i}_isCulledByHorizon(e,t,i){return ve(y8.direction,e.positionView),fe(y8.origin,0,0,0),!!x1(t,y8,DKe)&&e.distanceWithoutPolygonOffset>i}_isCulledBySlice(e,t){return e.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&BX(this._runningViewState.slicePlane,t)}_expandBoundingRect(e,t,i,{positionNDC:r,scaleInfo:s}){const n=this._runningViewState.camera,o=t.getScreenSize(jKe);Mwe(o,s.factor,o),o[0]*=n.pixelRatio,o[1]*=n.pixelRatio;const a=O4(i.calculateRelativeScreenBounds(o,s.factorAlignment.scale,NKe),fi(0,n.fullWidth,.5+.5*r[0]),fi(0,n.fullHeight,.5+.5*r[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(Nu(a),Wp(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}nx(e.aabr,a,e.aabr)}_isConflicted(e){const t=e.graphics3DGraphic.graphic.uid,i=e.info[this.visibilityGroup];for(let r=Math.floor(i.aabr[0]/this.accBinsSizeX);r<=Math.floor(i.aabr[2]/this.accBinsSizeX);r++)if(!(r<0||r>=this.accBinsNumX))for(let s=Math.floor(i.aabr[1]/this.accBinsSizeY);s<=Math.floor(i.aabr[3]/this.accBinsSizeY);s++){if(s<0||s>=this.accBinsNumY)continue;const n=this.accBins[r][s];for(let o=0;o<n.length;o++){const a=n.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==t&&(this.accNumTests++,H3(l.aabr,i.aabr)))return!0}}return!1}_initBins(e,t){if(this.accBins==null){this.accBins=[];for(let i=0;i<this.accBinsNumX;i++){this.accBins.push([]);const r=this.accBins[this.accBins.length-1];for(let s=0;s<this.accBinsNumY;s++)r.push(new hi)}}else for(let i=0;i<this.accBinsNumX;i++)for(let r=0;r<this.accBinsNumY;r++)this.accBins[i][r].clear();this.accBinsSizeX=e/this.accBinsNumX,this.accBinsSizeY=t/this.accBinsNumY,this.accNumTests=0}_addToBins(e){const t=e.info[this.visibilityGroup],i=Math.floor(t.aabr[0]/this.accBinsSizeX),r=Math.floor(t.aabr[2]/this.accBinsSizeX),s=Math.floor(t.aabr[1]/this.accBinsSizeY),n=Math.floor(t.aabr[3]/this.accBinsSizeY);for(let o=i;o<=r;o++)if(!(o<0||o>=this.accBinsNumX))for(let a=s;a<=n;a++)a<0||a>=this.accBinsNumY||this.accBins[o][a].push(e)}_setGraphicVisibility(e,t){const i=e.graphics3DGraphic;i.destroyed||(i.setVisibilityFlag(ku.DECONFLICTION,t,this.visibilityGroup),this.visibilityGroup===Po.LABEL&&this.view.labeler.setLabelGraphicVisibility(i,t))}};function VKe(e,t){const i=e.graphics3DGraphic;i.destroyed||i.clearVisibilityFlag(ku.DECONFLICTION,t)}function*xoe(e){if(Map.prototype.entries){const t=e.entries();for(let i=t.next();!i.done;i=t.next())yield i.value[1]}else yield*e.values()}function*GKe(e,t,i){t.clear(),e.forEach((s,n)=>{const o=t.pushNew();o.id=n,o.prio=s.info?-s.info[i].distance:Number.MAX_VALUE}),yield;const r=t.iterableSort((s,n)=>n.prio-s.prio);for(let s=r.next();!s.done;s=r.next())yield;t.forAll(s=>{const n=e.get(s.id);n&&(e.delete(s.id),e.set(s.id,n))}),t.clear()}u([f({constructOnly:!0})],q2.prototype,"view",void 0),u([f({type:Boolean,readOnly:!0})],q2.prototype,"updating",null),q2=u([B("esri.views.3d.layers.graphics.Deconflictor")],q2);const jKe=yt();class HKe{constructor(){this.positionView=F(),this.positionNDC=F(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const t=this.positionNDC;return t[0]<-1||t[1]<-1||t[2]<-1||t[0]>=1||t[1]>=1}}const qKe=new HKe,WKe=2e3;let PF=class extends q2{constructor(){super(...arguments),this.visibilityGroup=Po.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return;const t=performance.now();(e.state===no.IDLE||t-this._lastDeconfliction>WKe)&&(super.runTask(e),this.state===wc.Idle&&(this._lastDeconfliction=t))}enabledChanged(e,t){this.modifyGraphics(t,e.labelsEnabled)}getGraphicsLayers(e){return e.labelGraphics}};u([f({constructOnly:!0})],PF.prototype,"parent",void 0),PF=u([B("esri.views.3d.layers.graphics.LabelDeconflictor")],PF);let oW=class extends q2{constructor(){super(...arguments),this._handles=new xi,this._contexts=new Map,this._viewState=new uxe,this.visibilityGroup=Po.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([xe(()=>{var e,t;return(t=(e=this.view)==null?void 0:e.state)==null?void 0:t.camera},()=>{this._updateViewState(),this.setDirty()}),xe(()=>{var e,t,i;return(i=(t=(e=this.view)==null?void 0:e.map)==null?void 0:t.ground)==null?void 0:i.opacity},(e,t)=>{e!==1&&t!==1||this.setDirty()}),xe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},si)]),this._frameTask=this.view.resourceController.scheduler.registerTask(It.GRAPHICS_DECONFLICTOR,this),this._labels=new PF({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,t){const i=!(this._graphicSupportsDeconfliction(t)&&_8(e));t.setVisibilityFlag(ku.DECONFLICTION,i,Po.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;w(e)&&wge(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=w(e)}_slicePlaneChanged(){On(this._contexts,(e,t)=>t.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){let t=this._contexts.get(e);return t==null&&(t=new Map,this._contexts.set(e,t),this.setDirty()),{addGraphic:i=>this._addGraphic(e,t,i),removeGraphic:i=>this._removeGraphic(t,i),labelingInfoChange:()=>this._labels.enabledChanged(e,t),featureReductionChange:()=>this.enabledChanged(e,t),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,t),clear:()=>t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic))}}removeGraphicsOwner(e){const t=this._contexts.get(e);t&&(t.forEach(i=>this._removeGraphic(t,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,t,i){const r=i.graphic.uid,s=new kKe(i,e.symbolCreationContext.slicePlaneEnabled);t.set(r,s),_8(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,t){const i=t.graphic.uid,r=e.get(i);r&&(this.removeFromActiveGraphics(r),this._labels.removeFromActiveGraphics(r),e.delete(i),this.setDirty())}enabledChanged(e,t){const i=_8(e);i||ZKe(e),this.modifyGraphics(t,i)}_slicePlaneEnabledChanged(e,t){const i=e.symbolCreationContext.slicePlaneEnabled;t.forEach(r=>r.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.graphics}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const t=e.graphics;if(!t||!t.length)return!1;for(const i of t)if(this.layerSupportsDeconfliction(i))return!0;return!1}};function _8(e){const t=e.layer;return!(!t||!t.featureReduction||t.featureReduction.type!=="selection")}function ZKe(e){const t=e.graphics3DGraphics;t&&t.forEach(i=>i.clearVisibilityFlag(ku.DECONFLICTION))}oW=u([B("esri.views.3d.layers.graphics.GraphicsDeconflictor")],oW);const mJ=(e,t,i)=>[t,i],TC=(e,t,i)=>[t,i,e[2]],gJ=(e,t,i)=>[t,i,e[2],e[3]];function Obt(e){return e?{originPosition:e.originPosition==="upper-left"?"upperLeft":e.originPosition==="lower-left"?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:w(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function XKe({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function YKe({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function hxe({scale:e,translate:t},i){return i*e[0]+t[0]}function dxe({scale:e,translate:t},i){return t[1]-i*e[1]}function pxe(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let o=hxe(e,i[0][0]),a=dxe(e,i[0][1]);r[0]=t(i[0],o,a);for(let l=1;l<i.length;l++){const c=i[l];o+=c[0]*s,a-=c[1]*n,r[l]=t(c,o,a)}return r}function fxe(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=pxe(e,t,i[s]);return r}function QKe(e,t,i,r){return pxe(e,i?r?gJ:TC:r?TC:mJ,t)}function JKe(e,t,i,r){return fxe(e,i?r?gJ:TC:r?TC:mJ,t)}function KKe(e,t,i,r){return fxe(e,i?r?gJ:TC:r?TC:mJ,t)}function Rbt(e,t,i,r,s){return t.x=XKe(e,i.x),t.y=YKe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function mxe(e,t,i,r,s){return w(i)&&(t.points=QKe(e,i.points,r,s)),t}function gxe(e,t,i,r,s){return N(i)||(t.x=hxe(e,i.x),t.y=dxe(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m))),t}function yxe(e,t,i,r,s){return w(i)&&(t.rings=KKe(e,i.rings,r,s)),t}function _xe(e,t,i,r,s){return w(i)&&(t.paths=JKe(e,i.paths,r,s)),t}class Mbt{constructor(t,i,r){this.uid=t,this.geometry=i,this.attributes=r,this.visible=!0,this.objectId=null,this.centroid=null}}function Pbt(e){return w(e.geometry)}class Ibt{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function Lbt(e){const t=epe.fromJSON(e.geometryType),i=wt.fromJSON(e.spatialReference),r=e.transform,s=e.features.map(n=>{const o=eet(n,t,i,e.objectIdFieldName),a=o.geometry;if(w(a)&&r)switch(a.type){case"point":o.geometry=gxe(r,a,a,a.hasZ,a.hasM);break;case"multipoint":o.geometry=mxe(r,a,a,a.hasZ,a.hasM);break;case"polygon":o.geometry=yxe(r,a,a,a.hasZ,a.hasM);break;case"polyline":o.geometry=_xe(r,a,a,a.hasZ,a.hasM);break;case"extent":case"mesh":o.geometry=a}return o});return{geometryType:t,features:s,spatialReference:i,fields:e.fields?e.fields.map(n=>K3.fromJSON(n)):null,objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null}}function eet(e,t,i,r){return{uid:Gl(),objectId:r&&e.attributes?e.attributes[r]:null,attributes:e.attributes,geometry:tet(e.geometry,t,i),visible:!0}}function tet(e,t,i){if(N(e))return null;switch(t){case"point":{const r=e;return{x:r.x,y:r.y,z:r.z,m:r.m,hasZ:r.z!=null,hasM:r.m!=null,type:"point",spatialReference:i}}case"polyline":{const r=e;return{paths:r.paths,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polyline",spatialReference:i}}case"polygon":{const r=e;return{rings:r.rings,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const r=e;return{points:r.points,hasZ:!!r.hasZ,hasM:!!r.hasM,type:"multipoint",spatialReference:i}}}}function f0(e,t,i,r){return{x:e,y:t,z:i,hasZ:i!=null,hasM:!1,spatialReference:r,type:"point"}}function iet(e){if(N(e))return 0;let t=32;switch(e.type){case"point":t+=42;break;case"polyline":case"polygon":{let i=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),s=e.type==="polyline"?e.paths:e.rings;for(const n of s)i+=n.length;t+=8*i*r+64,t+=128*i,t+=34,t+=32*(s.length+1);break}case"multipoint":{const i=2+(e.hasZ?1:0)+(e.hasM?1:0),r=e.points.length;t+=8*r*i+64,t+=128*r,t+=34,t+=32;break}case"extent":t+=98,e.hasM&&(t+=32),e.hasZ&&(t+=32);break;case"mesh":t+=oL(e.vertexAttributes.position),t+=oL(e.vertexAttributes.normal),t+=oL(e.vertexAttributes.uv),t+=oL(e.vertexAttributes.tangent)}return t}function $bt(e){let t=32;return t+=Nme(e.attributes),t+=3,t+=8+iet(e.geometry),t}function ret(e){if(N(e))return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}}function Dbt(e){if(N(e))return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}}function Nbt(e,t){switch(Fr(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)fV(t,e.paths[i],e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)fV(t,e.rings[i],e.hasZ);break;case"multipoint":fV(t,e.points,e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,e.zmin!=null&&(t[2]=e.zmin),e.zmax!=null&&(t[5]=e.zmax)}}function set(e,t){switch(th(t),e.type==="mesh"&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)pV(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)pV(t,e.rings[i]);break;case"multipoint":pV(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function Fbt(e,t){return e.objectId!=null?e.objectId:e.attributes&&t?e.attributes[t]:null}dn();ei();function vxe(e){return"declaredClass"in e}function Toe(e){return"declaredClass"in e}function net(e){return"declaredClass"in e}function oet(e,t){if(!e)return null;if(net(e))return e;const i=new ul({layer:t,sourceLayer:t});return i.visible=e.visible,i.symbol=me(e.symbol),i.attributes=me(e.attributes),i.geometry=bxe(e.geometry),i}function bxe(e){return N(e)?null:vxe(e)?e:Vy(aet(e))}function aet(e){const t=e.spatialReference.toJSON();switch(e.type){case"point":{const{x:i,y:r,z:s,m:n}=e;return{x:i,y:r,z:s,m:n,spatialReference:t}}case"polygon":{const{rings:i,hasZ:r,hasM:s}=e;return{rings:Soe(i),hasZ:r,hasM:s,spatialReference:t}}case"polyline":{const{paths:i,hasZ:r,hasM:s}=e;return{paths:Soe(i),hasZ:r,hasM:s,spatialReference:t}}case"extent":{const{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p}=e;return{xmin:i,xmax:r,ymin:s,ymax:n,zmin:o,zmax:a,mmin:l,mmax:c,hasZ:h,hasM:p,spatialReference:t}}case"multipoint":{const{points:i,hasZ:r,hasM:s}=e;return{points:xxe(i)?wxe(i):i,hasZ:r,hasM:s,spatialReference:t}}default:return}}function Soe(e){return cet(e)?e.map(t=>wxe(t)):e}function wxe(e){return e.map(t=>pCe(t))}function cet(e){for(const t of e)if(t.length!==0)return xxe(t);return!1}function xxe(e){return e.length&&(mhe(e[0])||ghe(e[0]))}function uet(e,t){if(!e)return null;let i;if(Toe(e)){if(t==null)return e.clone();if(Toe(t))return t.copy(e)}return t!=null?(i=t,i.x=e.x,i.y=e.y,i.spatialReference=e.spatialReference,e.hasZ?(i.z=e.z,i.hasZ=e.hasZ):(i.z=null,i.hasZ=!1),e.hasM?(i.m=e.m,i.hasM=!0):(i.m=null,i.hasM=!1)):(i=f0(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0)),i}const v8=Ie.getLogger("esri.layers.support.labelFormatUtils"),Eoe={type:"simple",evaluate:()=>null},het={getAttribute:(e,t)=>e.field(t)};async function Txe(e,t,i){if(!e||!e.symbol)return Eoe;const r=e.where,s=zU(e),n=r?await _e(()=>import("./WhereClause.d715e7d1.js"),[],import.meta.url):null;let o;if(s.type==="arcade"){const a=await FRe(s.expression,i,t);o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l});if(c!=null)return c.toString()}catch{v8.error(new se("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:l,expression:s}))}return null},needsHydrationToEvaluate:()=>YY(s.expression)==null}}else o={type:"simple",evaluate:a=>s.expression.replace(/{[^}]*}/g,l=>{const c=l.slice(1,-1),h=t.get(c);if(!h)return l;let p=null;return"attributes"in a?a&&a.attributes&&(p=a.attributes[h.name]):p=a.field(h.name),p==null?"":Sxe(p,h)})};if(r){let a;try{a=n.WhereClause.create(r,t)}catch(c){return v8.error(new se("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:r,error:c})),Eoe}const l=o.evaluate;o.evaluate=c=>{const h="attributes"in c?void 0:het;try{if(a.testFeature(c,h))return l(c)}catch(p){v8.error(new se("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:r,feature:c,error:p}))}return null}}return o}function Sxe(e,t){if(e==null)return"";const i=t.domain;if(i){if(i.type==="codedValue"||i.type==="coded-value"){const s=e;for(const n of i.codedValues)if(n.code===s)return n.name}else if(i.type==="range"){const s=+e,n="range"in i?i.range[0]:i.minValue,o="range"in i?i.range[1]:i.maxValue;if(n<=s&&s<=o)return i.name}}let r=e;return t.type==="date"||t.type==="esriFieldTypeDate"?r=Cm(r,Uk("short-date")):kk(t)&&(r=Am(+r)),r||""}const kbt=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:Txe,formatField:Sxe},Symbol.toStringTag,{value:"Module"}));function yJ(e,t){if(e.type==="point")return Z0(e,t,!1);if(vxe(e))switch(e.type){case"extent":return Z0(e.center,t,!1);case"polygon":return Z0(e.centroid,t,!1);case"polyline":return Z0(Coe(e),t,!0);case"mesh":return Z0(e.origin,t,!1)}else switch(e.type){case"extent":return Z0(det(e),t,!0);case"polygon":return Z0(pet(e),t,!0);case"polyline":return Z0(Coe(e),t,!0)}}function Coe(e){const t=e.paths[0];if(!t||t.length===0)return null;const i=Ude(t,kde(t)/2);return f0(i[0],i[1],i[2],e.spatialReference)}function det(e){const t=isFinite(e.zmin);return f0(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),t?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}function pet(e){const t=e.rings[0];if(!t||t.length===0)return null;const i=zde(e.rings,e.hasZ);return f0(i[0],i[1],i[2],e.spatialReference)}function Z0(e,t,i){const r=i?e:uet(e);return t&&e?mLe(e,r,t)?r:null:r}function Ubt(e,t,i,r=0){if(e){t||(t=ei());const s=e;let n=.5*s.width*(i-1),o=.5*s.height*(i-1);return s.width<1e-7*s.height?n+=o/20:s.height<1e-7*s.width&&(o+=n/20),_r(t,s.xmin-n-r,s.ymin-o-r,s.xmax+n+r,s.ymax+o+r),t}return null}function Exe(e,t){for(let i=0;i<e.geometries.length;++i){const r=e.geometries[i].getMutableAttribute(D.AUXPOS1);r&&r.data[3]!==t&&(r.data[3]=t,e.geometryVertexAttrsUpdated(e.geometryRecords[i]))}}function jM(e,t){const i=cU(od);return w(e)&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),w(t)?i[3]=t:w(e)&&e.length>3&&(i[3]=e[3]),i}function zbt(e,t,i,r,s,n=[0,0,0,0]){for(let o=0;o<3;++o)w(e)&&e[o]!=null?n[o]=e[o]:w(i)&&i[o]!=null?n[o]=i[o]:n[o]=s[o];return w(t)?n[3]=t:w(r)?n[3]=r:n[3]=s[3],n}function Aoe(e=pm,t,i,r=1){const s=new Array(3);if(N(t)||N(i))s[0]=1,s[1]=1,s[2]=1;else{let n,o=0;for(let a=2;a>=0;a--){const l=e[a];let c;const h=l!=null,p=a===0&&!n&&!h,m=i[a];l==="symbol-value"||p?c=m!==0?t[a]/m:1:h&&l!=="proportional"&&isFinite(l)&&(c=m!==0?l/m:1),c!=null&&(s[a]=c,n=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)s[a]==null?s[a]=n:s[a]===0&&(s[a]=.001*o)}for(let n=2;n>=0;n--)s[n]/=r;return $l(s)}function fet(e){return e.isPrimitive!=null}function vz(e){return fet(e)&&(e=[e.width,e.depth,e.height]),W5(e)?null:"Symbol sizes may not be negative values"}function W5(e){if(Array.isArray(e)){for(const t of e)if(!W5(t))return!1;return!0}return e==null||e>=0}function met(e,t,i,r=Be()){const s=e||0,n=t||0,o=i||0;return s!==0&&jE(r,r,-s/180*Math.PI),n!==0&&GE(r,r,n/180*Math.PI),o!==0&&sU(r,r,o/180*Math.PI),r}function _J(e,t){return t.minDemResolution!=null?t.minDemResolution:qk(e)?t.minDemResolutionForPoints:.01*XMe(e)}function Cxe(e,t,i,r,s,n,o,a,l,c,h){const p=Tet[h.mode];let m,g,v=0;if(Lr(e,t,i,r,l.spatialReference,s,a))return p.requiresAlignment(h)?(v=p.applyElevationAlignmentBuffer(r,s,n,o,a,l,c,h),m=n,g=o):(m=r,g=s),Lr(m,l.spatialReference,g,n,c.spatialReference,o,a)?v:void 0}function Ky(e,t,i,r,s){const n=(F5(e)?e.z:owe(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{const o=$t(mm(t,e,"ground"),0);return s.verticalDistanceToGround=0,s.sampledElevation=o,void(s.z=o)}case"relative-to-ground":{const o=$t(mm(t,e,"ground"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"relative-to-scene":{const o=$t(mm(t,e,"scene"),0),a=i.geometryZWithOffset(n,r);return s.verticalDistanceToGround=a,s.sampledElevation=o,void(s.z=a+o)}case"absolute-height":{const o=i.geometryZWithOffset(n,r),a=$t(mm(t,e,"ground"),0);return s.verticalDistanceToGround=o-a,s.sampledElevation=a,void(s.z=o)}default:return i.mode,void(s.z=0)}}function get(e,t,i,r){return Ky(e,t,i,r,W2),W2.z}function _I(e,t,i){return t==null||i==null?e.definedChanged:t==="on-the-ground"&&i==="on-the-ground"?e.staysOnTheGround:t===i||t!=="on-the-ground"&&i!=="on-the-ground"?_s.UPDATE:e.onTheGroundChanged}function xd(e){return e==="relative-to-ground"||e==="relative-to-scene"}function m1(e){return e!=="absolute-height"}function yet(e,t,i,r,s){Ky(t,i,s,r,W2),Exe(e,W2.verticalDistanceToGround);const n=W2.sampledElevation,o=js(Eet,e.transformation);return z$[0]=t.x,z$[1]=t.y,z$[2]=W2.z,rh(t.spatialReference,z$,o,r.spatialReference)?e.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),n}function _et(e,t,i,r,s,n){let o=0;const a=n.spatialReference;t*=3,r*=3;for(let l=0;l<s;++l){const c=e[t+0],h=e[t+1],p=e[t+2],m=$t(n.getElevation(c,h,p,a,"ground"),0);o+=m,i[r+0]=c,i[r+1]=h,i[r+2]=m,t+=3,r+=3}return o/s}function vet(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let m=0;m<s;++m){const g=e[t+0],v=e[t+1],b=e[t+2],S=$t(n.getElevation(g,v,b,p,"ground"),0);l+=S,i[r+0]=g,i[r+1]=v,i[r+2]=h==null?b+S+c:S+c,t+=3,r+=3}return l/s}function bet(e,t,i,r,s,n,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),h=a.featureExpressionInfoContext,p=n.spatialReference;t*=3,r*=3;for(let m=0;m<s;++m){const g=e[t+0],v=e[t+1],b=e[t+2],S=$t(n.getElevation(g,v,b,p,"scene"),0);l+=S,i[r+0]=g,i[r+1]=v,i[r+2]=h==null?b+S+c:S+c,t+=3,r+=3}return l/s}function wet(e){const t=e.meterUnitOffset,i=e.featureExpressionInfoContext;return t!==0||i!=null}function xet(e,t,i,r,s,n,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;t*=3,r*=3;for(let h=0;h<s;++h){const p=e[t+0],m=e[t+1],g=e[t+2];i[r+0]=p,i[r+1]=m,i[r+2]=c==null?g+l:l,t+=3,r+=3}return 0}class vI{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}var _s;(function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"})(_s||(_s={}));const Tet={"absolute-height":{applyElevationAlignmentBuffer:xet,requiresAlignment:wet},"on-the-ground":{applyElevationAlignmentBuffer:_et,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:vet,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:bet,requiresAlignment:()=>!0}},Eet=Be(),W2=new vI,z$=F();function Axe(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;for(const a of n){const{update:l,averageGeometrySampledElevation:c}=Rxe(a,t,i,r);o+=c,l&&s.geometryVertexAttrsUpdated(a)}return o/n.length}function d3(e,t,i,r){const s=e.stageObject,n=t.centerPointInElevationSR;let o=0;s.metadata.usesVerticalDistanceToGround?(Ky(n,i,t,r,kl),Exe(s,kl.verticalDistanceToGround),o=kl.sampledElevation):(Ky(n,i,t,r,kl),t.mode!=="absolute-height"&&(o=kl.sampledElevation));const a=js(Cet,s.transformation),l=fe(Oxe,a[12],a[13],a[14]);ur.TESTS_DISABLE_OPTIMIZATIONS?(Fl[0]=n.x,Fl[1]=n.y,Fl[2]=kl.z,rh(n.spatialReference,Fl,a,r.spatialReference)&&(s.transformation=a)):r.setAltitudeOfTransformation(kl.z,a);const c=vJ/r.unitInMeters;return(Math.abs(a[12]-l[0])>=c||Math.abs(a[13]-l[1])>=c||Math.abs(a[14]-l[2])>=c)&&(s.transformation=a),o}const Cet=Be();function Aet(e,t,i,r){const s=e.graphics3DSymbolLayer.lodRenderer;if(N(s))return 0;const n=t.centerPointInElevationSR;Ky(n,i,t,r,kl);const o=t.mode!=="absolute-height"?kl.sampledElevation:0,a=s.instanceData,l=e.instanceIndex,c=Ret;a.getGlobalTransform(l,c);const h=fe(Oxe,c[12],c[13],c[14]);ur.TESTS_DISABLE_OPTIMIZATIONS?(Fl[0]=n.x,Fl[1]=n.y,Fl[2]=kl.z,rh(n.spatialReference,Fl,c,r.spatialReference)&&a.setGlobalTransform(l,c)):r.setAltitudeOfTransformation(kl.z,c);const p=vJ/r.unitInMeters;return(ur.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(c[12]-h[0])>=p||Math.abs(c[13]-h[1])>=p||Math.abs(c[14]-h[2])>=p)&&a.setGlobalTransform(l,c),o}function Oet(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;if(n.length===0)return 0;let o=0,a=null,l=0,c=!1;for(const h of n){const p=h.geometry.vertexAttributes.get(D.POSITION);if(p!==a){const{update:m,averageGeometrySampledElevation:g}=Rxe(h,t,i,r);l=g,a=p,c=m}c&&s.geometryVertexAttrsUpdated(h),o+=l}return o/n.length}const vJ=.01,Fl=F(),bh=F(),nS=F(),Ret=Be(),Oxe=F(),kl=new vI;function Rxe(e,t,i,r){let s=!1;const n=i.spatialReference,o=e.geometry,a=e.getShaderTransformation(),l=t.requiresSampledElevationInfo;bh[0]=a[12],bh[1]=a[13],bh[2]=a[14],o.invalidateBoundingInfo();const c=o.getMutableAttribute(D.POSITION),h=c.data,p=o.vertexAttributes.get(D.MAPPOS).data,m=c.size,g=h.length/m,v=new nwe(p,n);let b=0,S=0;for(let T=0;T<g;T++){if(nS[0]=h[b],nS[1]=h[b+1],nS[2]=h[b+2],Ky(v,i,t,r,kl),l&&(S+=kl.sampledElevation),ur.TESTS_DISABLE_OPTIMIZATIONS)h[b]=v.array[v.offset],h[b+1]=v.array[v.offset+1],h[b+2]=kl.z,Lr(h,n,b,h,r.spatialReference,b,1),h[b]-=bh[0],h[b+1]-=bh[1],h[b+2]-=bh[2],s=!0;else{Fl[0]=h[b]+bh[0],Fl[1]=h[b+1]+bh[1],Fl[2]=h[b+2]+bh[2],r.setAltitude(Fl,kl.z),h[b]=Fl[0]-bh[0],h[b+1]=Fl[1]-bh[1],h[b+2]=Fl[2]-bh[2];const O=vJ/r.unitInMeters;(Math.abs(nS[0]-h[b])>=O||Math.abs(nS[1]-h[b+1])>=O||Math.abs(nS[2]-h[b+2])>=O)&&(s=!0)}b+=m,v.offset+=3}return S/=g,{update:s,averageGeometrySampledElevation:S}}const Met=Ie.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function Pet(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}function Bbt(e){const t=e&&e.expression;if(typeof t=="string"){const i=Ixe(t);if(i!=null)return{cachedResult:i}}return null}async function Vbt(e,t,i){const r=e&&e.expression;if(typeof r!="string")return null;const s=Ixe(r);if(s!=null)return{cachedResult:s};const n=await Em(),o=n.arcadeUtils,a=o.createSyntaxTree(r);return o.dependsOnView(a)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:o.createFunction(a),context:o.createExecContext(null,{sr:t}),modules:n}}}function Mxe(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}function bJ(e,t){if(e!=null&&!Pxe(e)){if(!t||!e.arcade)return void Met.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=bxe(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}function Iet(e){if(e!=null){if(Pxe(e))return e.cachedResult;const t=e.arcade;let i=e.arcade.modules.arcadeUtils.executeFunction(t.func,t.context);return typeof i!="number"&&(e.cachedResult=0,i=0),i}return 0}function Gbt(e,t=!1){let i=e&&e.featureExpressionInfo;const r=i&&i.expression;return t||r==="0"||(i=null),i}const Let={cachedResult:0};function Pxe(e){return e.cachedResult!=null}function Ixe(e){return e==="0"?0:null}class lh{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(t){this._unit=t,this._metersPerElevationInfoUnit=i8e(t)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(t){this._meterUnitOffset=t,this._renderUnitOffset=0}set offsetElevationInfoUnits(t){this._meterUnitOffset=t*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(t){this._renderUnitOffset+=t}geometryZWithOffset(t,i){const r=this.calculateOffsetRenderUnits(i);return this.featureExpressionInfoContext!=null?r:t+r}calculateOffsetRenderUnits(t){let i=this._meterUnitOffset;const r=this.featureExpressionInfoContext;return r!=null&&(i+=Iet(r)*this._metersPerElevationInfoUnit),i/t.unitInMeters+this._renderUnitOffset}setFromElevationInfo(t){this.mode=t.mode,this.unit=t8e(t.unit)?t.unit:"meters",this.offsetElevationInfoUnits=$t(t.offset,0)}updateFeatureExpressionInfoContext(t,i,r){if(N(t))return void(this._featureExpressionInfoContext=null);const s=t&&t.arcade;s&&w(i)&&w(r)?(this._featureExpressionInfoContext=Pet(t),bJ(this._featureExpressionInfoContext,Mxe(s.modules,i,r))):this._featureExpressionInfoContext=t}static fromElevationInfo(t){const i=new lh;return w(t)&&i.setFromElevationInfo(t),i}}var Qt;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.OPAQUE=2]="OPAQUE"})(Qt||(Qt={}));class Ym{constructor(t,i,r,s,n,o,a,l=null){this.graphics3DSymbolLayer=t,this.stageObject=i,this._uniqueGeometries=r,this._uniqueMaterials=s,this._sharedResource=n,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=t,this.stageObject=i}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(t,i){this._stageLayer=i,this._stage=t,t.addMany(this._uniqueMaterials),t.addMany(this._uniqueGeometries),t.add(this.stageObject)}destroy(){const t=this._stage;this._stageLayer&&(t.removeMany(this._uniqueMaterials),t.removeMany(this._uniqueGeometries)),t.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)&&i.removeObject(this.stageObject),this.stageObject.dispose(),w(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(t,i){if(N(this._edgeState))return;const r=Ooe(this._edgeState.baseMaterial);let s=!1;for(const n of this._edgeState.edgeMaterials)n.objectTransparency!==r&&(n.objectTransparency=r,s=!0);s&&this._resetEdgeObject(i),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[t])}slicePlaneEnabledChanged(t,i){N(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:t},!i),this._edgeState.properties.hasSlicePlane=t)}setVisibility(t){if(this._stage!=null&&this._visible!==t&&(this._visible=t,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),w(this._edgeState))){const i=this._stage.renderView.ensureEdgeView();i.hasObject(this.stageObject)?i.updateObjectVisibility(this.stageObject,t):t&&this._addOrUpdateEdgeObject(i,!1)}}get visible(){return this._visible}alignWithElevation(t,i,r,s){this.elevationAligner!=null&&(w(r)&&bJ(this.elevationContext.featureExpressionInfoContext,r),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,t,i),this._resetEdgeObject(s))}getCenterObjectSpace(t=F()){return ve(t,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(t=dn()){const i=this.stageObject.boundingVolumeObjectSpace;return Hpe(t,i.min),qpe(t,i.max),t}computeAttachmentOrigin(t){if(this.useObjectOriginAsAttachmentOrigin){const i=this.stageObject.transformation;t.render.origin[0]+=i[12],t.render.origin[1]+=i[13],t.render.origin[2]+=i[14],t.render.num++}else for(const i of this.stageObject.geometryRecords)i.computeAttachmentOrigin(wg)&&(et(wg,wg,this.stageObject.transformation),Oe(t.render.origin,t.render.origin,wg),t.render.num++)}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=$et,l=qk(o)?1:a.length;for(let h=0;h<l;h++){const p=a[h];X0[0]=o[p[0]],X0[1]=o[p[1]],X0[2]=o[p[2]],et(X0,X0,this.stageObject.transformation),sb[3*h+0]=X0[0],sb[3*h+1]=X0[1],sb[3*h+2]=X0[2]}if(!t(sb,0,l))return null;Fr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],sb[h+p]),o[p+3]=Math.max(o[p+3],sb[h+p]);c&&r.push({location:sb.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&i.service&&this.elevationContext.mode!=="absolute-height"){Op(o,wg);const h=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let p=0;if(i.useViewElevation)p=$t(i.service.getElevation(wg[0],wg[1],h),0);else try{const m=_J(o,i);p=$t(await i.service.queryElevation(wg[0],wg[1],s,m,h),0)}catch{}jpe(o,0,0,-this.alignedSampledElevation+p)}return o}addObjectState(t,i){t===Xy.Highlight&&i.addObject(this.stageObject,this.stageObject.highlight()),t===Xy.MaskOccludee&&i.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(t){t.removeObject(this.stageObject)}_resetEdgeObject(t){if(N(this._edgeState))return;const i=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(i,t):i.removeObject(this.stageObject)}_addOrUpdateEdgeObject(t,i){const r=this._edgeState;if(N(r))return;const s=Ooe(r.baseMaterial);for(const n of r.edgeMaterials)n.objectTransparency=s;t.addOrUpdateObject3D(this.stageObject,r.edgeMaterials,r.properties,!i).then(()=>{var n;return(n=this._stageLayer)==null?void 0:n.sync()})}}function Ooe(e){return e.isVisible?e.parameters.transparent?Qt.TRANSPARENT:Qt.OPAQUE:Qt.INVISIBLE}const sb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],X0=F(),wg=F(),$et=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];var In;(function(e){e[e.Recreate_Symbol=0]="Recreate_Symbol",e[e.Recreate_Graphics=1]="Recreate_Graphics",e[e.Fast_Update=2]="Fast_Update"})(In||(In={}));class wJ{constructor(t){this.schedule=t,this._loadStatus=Pu.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(t,i){return this._loadStatus===Pu.LOADED?(t&&t(),this._loader):this._loadStatus===Pu.FAILED?(i&&i(this._loadError),this._loader):(N(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Pu.LOADED},r=>{throw this._loadError=r,this._abortController=null,this._loadStatus=Pu.FAILED,!Cs(r)&&this.logger&&r.message&&this.logger.warn(r.message),r})),this._loader.then(t,i).catch(()=>{}),this._loader)}abortLoad(){w(this._abortController)?this._abortController=fd(this._abortController):this._loadStatus===Pu.LOADING&&(this._loadStatus=Pu.FAILED),this._loader=null}}var Pu;(function(e){e[e.LOADING=0]="LOADING",e[e.LOADED=1]="LOADED",e[e.FAILED=2]="FAILED"})(Pu||(Pu={}));function Det(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Lxe(e,t){const i=(r,s,n=!1)=>({levels:r.map(o=>{const a=s(o.tesselation);return n&&Sc.cgToGIS(a),{components:[{geometry:a,material:t}],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(e){case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],r=>Sc.createPolySphereGeometry(.5,r,!0));case"cube":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Sc.createBoxGeometry(1));case"cone":return i(b8,r=>Sc.createConeGeometry(1,.5,r,!1),!0);case"inverted-cone":return i(b8,r=>Sc.createConeGeometry(1,.5,r,!0),!0);case"cylinder":return i(b8,r=>Sc.createCylinderGeometry(1,.5,r,[0,0,1],[0,0,.5]));case"tetrahedron":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Sc.createTetrahedronGeometry(1),!0);case"diamond":return i([{tesselation:0,minScreenSpaceRadius:0}],()=>Sc.createDiamondGeometry(1),!0);default:return}}const b8=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function Net(e){return e.type==="fill"}function Fet(e){return e.type==="extrude"}function ket(e){return e&&e.enabled&&(Fet(e)||Net(e))&&w(e.edges)}function Uet(e){return e&&e.enabled&&e.edges||null}function $xe(e,t){return Dxe(Uet(e),t)}function Dxe(e,t){if(N(e))return null;const i=w(e.color)?IX(at.toUnitRGBA(e.color)):ki(0,0,0,0),r=No(e.size),s=No(e.extensionLength);switch(e.type){case"solid":return Nxe({color:i,size:r,extensionLength:s,...t});case"sketch":return zet({color:i,size:r,extensionLength:s,...t});default:return}}function Nxe(e){return{...Bet,...e,type:"solid"}}function zet(e){return{...Vet,...e,type:"sketch"}}const Bet={color:ki(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Qt.OPAQUE,hasSlicePlane:!1},Vet={color:ki(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:Qt.OPAQUE,hasSlicePlane:!1};function B$(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.material)})}),$3(t)}function Get(e){const t=new Array;return e.levels.forEach(i=>{i.components.forEach(r=>{r.textures&&t.push(...r.textures)})}),$3(t)}function xJ(e){const t=[];return e.components.forEach(i=>{t.push(i.geometry)}),$3(t)}function jet(e){const t=[];return e.levels.forEach(i=>{i.components.forEach(r=>{t.push(r.geometry)})}),$3(t)}function Het(e){return xJ(e).reduce((t,i)=>t+i.indexCount/3,0)}const TJ={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function jbt(e){return e.type==="web-style"?TJ:SJ(e.symbolLayers.toArray().map(t=>Fxe(e,t)))}function SJ(e){let t=0,i=0,r=0,s=!1,n=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of e)N(a)||(t+=a.primitivesPerFeature,i+=a.primitivesPerCoordinate,r+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,s=s||a.estimated,++n);return{primitivesPerFeature:t,primitivesPerCoordinate:i,drawCallsPerFeature:r,estimated:s,memory:o,numComplexities:n}}function Hbt(e){const t=SJ(e);return t.numComplexities>0&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=t.numComplexities),t}const Roe={};function Fxe(e,t){const i=kxe(e,t),r=ket(t)?2:0;switch(t.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:r,estimated:!1,memory:i};case"fill":return e.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:r,estimated:!1,memory:i}:w(t.outline)&&t.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:i}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:i};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:i};case"object":return t.resource&&t.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:i}:{...qet(t.resource&&t.resource.primitive||vfe),memory:i};case"path":{let a=0,l=0;switch(t.profile){case"circle":a=10;break;case"quad":a=4;break;default:return void(t.profile,void 0)}switch(t.join){case"round":l=3;break;case"miter":case"bevel":l=1;break;default:return void(t.join,void 0)}const c=2*a,h=a*l*2;let p=-2*h-c;switch(t.cap){case"none":break;case"butt":case"square":p+=2*(a-1);break;case"round":p+=2*(a*(3-1)*2+a);break;default:return}return{primitivesPerFeature:p,primitivesPerCoordinate:h+c,drawCallsPerFeature:0,estimated:!1,memory:i}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:i};default:return}}function kxe(e,t){const i=e.type==="point-3d";switch(t.type){case"extrude":return t.edges&&t.edges.size>0?_l.EXTRUDE_EDGES:_l.EXTRUDE;case"fill":return w(t.outline)&&t.outline.size>0?_l.FILL_OUTLINE:_l.FILL;case"water":return _l.FILL;case"line":return t.join==="round"?_l.LINE_ROUND:_l.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return _l.PATH_ROUND_CIRCLE;case"quad":return _l.PATH_ROUND_QUAD;default:return void(t.profile,void 0)}case"miter":case"bevel":switch(t.profile){case"circle":return _l.PATH_MITER_CIRCLE;case"quad":return _l.PATH_MITER_QUAD;default:return void(t.profile,void 0)}default:return void(t.join,void 0)}case"object":return i?_l.OBJECT_POINT:_l.OBJECT_POLYGON;case"icon":case"text":return i?_l.ICON_POINT:_l.ICON_POLYGON;default:return}}function qet(e){let t=Roe[e];if(t)return t;const i=Lxe(e,null);return t={primitivesPerFeature:xJ(i.levels[0]).reduce((r,s)=>r+s.indices.get(D.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},Roe[e]=t,t}const _l={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}},V$=Ie.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class Qm extends wJ{constructor(t,i,r,s){super(r.schedule),this._context=r,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=V$,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=t,this.symbolLayer=i,this._renderPriority=s.renderPriority,this._renderPriorityStep=s.renderPriorityStep,this._elevationContext=new lh,this.complexity=this.computeComplexity(),this._ignoreDrivers=s.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=Moe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(t){if(this._ignoreDrivers)return!1;const i=this._drivenProperties,r=Moe(t);return r.color!==i.color||r.opacity!==i.opacity||r.opacityAlwaysOpaque!==i.opacityAlwaysOpaque||r.size!==i.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(t,i,r,s){const n=t.projectionSuccess,o="polygons"in t?t.polygons:null,a=`${s} geometry failed to be created`;let l=null;n?!i.length||i.length===1&&!i[0].length?l=`${a} (no ${r} were defined)`:Array.isArray(i)&&Array.isArray(i[0])?o&&o.length===0&&r==="rings"&&i.length>0&&i[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (${r} should be defined as a 2D array)`:l=`${a} (failed to project geometry to view spatial reference)`,l&&V$.warnOncePerTick(l)}_validateGeometry(t,i=null,r=null){if(w(i)&&!i.includes(t.type))return this.logger.warn("unsupported geometry type for "+r+` symbol: ${t.type}`),!1;if(t.type==="point"){const s=t;if(!isFinite(s.x)||!isFinite(s.y))return V$.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return Wet}_defaultElevationInfoZ(){return Zet}_updateElevationContext(){w(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(t){return t.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(t,i=this.getDefaultElevationInfo(t)){return this._elevationContext.mode||i.mode}setElevationInfoOverride(t){this._elevationInfoOverride=t,this._updateElevationContext()}setGraphicElevationContext(t,i){const r=t.geometry,s=this.getDefaultElevationInfo(r);i.unit=this._elevationContext.unit!=null?this._elevationContext.unit:s.unit,i.mode=this.getGeometryElevationMode(r,s),i.offsetMeters=$t(this._elevationContext.meterUnitOffset,$t(s.offset,0));const n=!this._elevationOptions.supportsOnTheGround&&i.mode==="on-the-ground";n&&(i.mode="relative-to-ground",i.offsetMeters=0);const o=n?Let:this._elevationContext.featureExpressionInfoContext;return i.updateFeatureExpressionInfoContext(o,t,this._context.layer),i}prepareSymbolLayerPatch(t){}updateGeometry(t,i){return!1}onRemoveGraphic(t){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const t=this._context.layer.opacity;return t==null?1:t}_getCombinedOpacity(t,i=Poe){let r=1;return this.draped||(r*=this._getLayerOpacity()),this._drivenProperties.opacity||(w(t)?r*=t.a:i.hasIntrinsicColor||(r=0)),r}_getCombinedOpacityAndColor(t,i=Poe){const r=this._getCombinedOpacity(t,i);if(this._drivenProperties.color)return jM(null,r);const s=w(t)?at.toUnitRGB(t):pm;return jM(s,r)}_getVertexOpacityAndColor(t,i=null){const r=this._drivenProperties.color?t.color:null,s=this._drivenProperties.opacity?t.opacity:null,n=jM(r,s);return w(i)&&(n[0]*=i,n[1]*=i,n[2]*=i,n[3]*=i),n}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return Fxe(this.symbol,this.symbolLayer)}globalPropertyChanged(t,i,r){switch(t){case"opacity":return this.layerOpacityChanged(i,r);case"elevationInfo":{const s=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(i,r,s)!==_s.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(i,r);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(t,i,r){let s=_s.UPDATE;return t.forEach(n=>{const o=i(n);if(w(o)){const a=n.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=r(o.elevationContext.mode)}else s=_s.RECREATE}),s}applyRendererDiff(t,i){return In.Recreate_Symbol}getFastUpdateAttrValues(t){if(!this._fastUpdates.enabled)return null;const i=this._fastUpdates.visualVariables,r=i.size?Ly(i.size.field,t):0,s=i.color?Ly(i.color.field,t):0,n=i.opacity?Ly(i.opacity.field,t):0;return ki(r,s,n,0)}get draped(){return this._draped}ensureDrapedStatus(t){return this._draped==null?(this._draped=t,!0):(t!==this.draped&&V$.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const t=()=>{var i,r,s,n,o,a,l,c,h,p,m,g,v,b,S,T;return{size:(n=(s=(r=(i=this._fastUpdates)==null?void 0:i.visualVariables)==null?void 0:r.size)==null?void 0:s.field)!=null?n:null,color:(c=(l=(a=(o=this._fastUpdates)==null?void 0:o.visualVariables)==null?void 0:a.color)==null?void 0:l.field)!=null?c:null,opacity:(g=(m=(p=(h=this._fastUpdates)==null?void 0:h.visualVariables)==null?void 0:p.opacity)==null?void 0:m.field)!=null?g:null,rotation:(T=(S=(b=(v=this._fastUpdates)==null?void 0:v.visualVariables)==null?void 0:b.rotation)==null?void 0:S.field)!=null?T:null}};return{drivenProperties:this._drivenProperties,getVisVarFields:t}}}function Ly(e,t){const i=e!=null?t.attributes[e]:0;return i!=null&&isFinite(i)?i:0}function Moe(e){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(i=>{switch(i.type){case"color":if(t.color=!0,i.stops)for(let r=0;r<i.stops.length;r++){const s=i.stops[r].color;s&&(t.opacity=!0,s.a<1&&(t.opacityAlwaysOpaque=!1))}break;case"opacity":t.opacity=!0,t.opacityAlwaysOpaque=!1;break;case"size":t.size=!0}}),t}const Wet={mode:"on-the-ground",offset:0,unit:"meters"},Zet={mode:"absolute-height",offset:0,unit:"meters"},Poe={hasIntrinsicColor:!1};class Jx{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(t,i,r,s,n,o){this.id=Gl(),this.geometry=t,this.material=i,this.transformation=r,this.instanceParameters=s,this.origin=n,this._shaderTransformation=o,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return w(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(t){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,t):this.geometry.computeAttachmentOrigin(t))&&(et(t,t,this.getStaticTransformation()),!0)}}Jx.pool=new qs(Jx);class Z5{constructor(t){this.channel=t,this.id=Gl()}}class m0 extends uI{constructor(t={}){super(),this.type=Kp.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=Be(),this._bvObjectSpace=new Ioe,this._bvWorldSpace=new Ioe,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=t.castShadow==null||t.castShadow,this.metadata=t.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new Uxe),this.transformation=Be();const{geometries:i,materials:r,transformations:s,origins:n}=t;if(Array.isArray(i)){At(r.length===i.length,"Object3D: materials don't match geometries"),At(s.length===i.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=i.length,this._geometries.length=i.length;for(let o=0;o<i.length;o++)this._geometries[o]=i[o],this._geometryRecords[o]=Jx.pool.acquire(i[o],r[o],ux(s[o]),{highlights:null,occludees:null,visible:this._visible},n&&n[o])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(t){js(this._objectTransformation,t),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(t){At(this._parentLayer==null||t==null,"Object3D can only be added to a single Layer"),this._parentLayer=t}addGeometry(t,i,r,s,n){r=r||Dn,this._geometries.push(t);const o=Jx.pool.acquire(t,i,r,{highlights:null,occludees:null,visible:this._visible},s,n);return this._geometryRecords.push(o),this._hasVolatileTransformation=this._hasVolatileTransformation||w(o.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:o}),this._invalidateBoundingVolume(),o}removeGeometry(t){const i=this._geometryRecords.splice(t,1)[0];return this._hasVolatileTransformation=w(i.shaderTransformation)?this._geometryRecords.some(r=>w(r.shaderTransformation)):this._hasVolatileTransformation,i.dispose(),this._geometries.splice(t,1),this._emit("objectGeometryRemoved",{object:this,record:i}),this._invalidateBoundingVolume(),i}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(t){this._emit("vertexAttrsUpdated",{object:this,record:t}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(t){if(this._visible!==t){this._visible=t;for(const i of this._geometryRecords)i.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const t=new Z5(Xy.MaskOccludee);for(const i of this._geometryRecords)i.instanceParameters.occludees=Hq(i.instanceParameters.occludees,t);return this._emit("occlusionChanged",this),t}removeOcclude(t){for(const i of this._geometryRecords)i.instanceParameters.occludees=qq(i.instanceParameters.occludees,t);this._emit("occlusionChanged",this)}highlight(){const t=new Z5(Xy.Highlight);for(const i of this._geometryRecords)i.instanceParameters.highlights=Hq(i.instanceParameters.highlights,t);return this._emit("highlightChanged",this),t}removeHighlight(t){for(const i of this._geometryRecords)i.instanceParameters.highlights=qq(i.instanceParameters.highlights,t);this._emit("highlightChanged",this)}getCombinedStaticTransformation(t,i){return hs($t(i,Be()),this.transformation,t.getStaticTransformation())}_getCombinedShaderTransformation(t,i){return i=i||Be(),hs(i,this.transformation,t.getShaderTransformation()),i}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s],o=this._geometryRecords[s],a=n.boundingInfo;w(a)&&(this._calculateTransformedBoundingVolume(a,this._bvObjectSpace,o.getShaderTransformation()),this._calculateTransformedBoundingVolume(a,this._bvWorldSpace,this._getCombinedShaderTransformation(o)))}Nn(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),Nn(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const t=F(),i=F(),r=Dx(this.transformation);for(let s=0;s<this._geometryRecords.length;++s){const n=this._geometries[s].boundingInfo;if(N(n))continue;const o=this._geometryRecords[s].getShaderTransformation(),a=Dx(o);et(t,n.getCenter(),o);const l=Pr(t,this._bvObjectSpace.bounds),c=n.getBSRadius()*a;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],l+c),et(i,t,this.transformation);const h=Pr(i,this._bvWorldSpace.bounds),p=c*r;this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],h+p)}this._bvDirty=!1}_calculateTransformedBoundingVolume(t,i,r){const s=t.getBBMin(),n=t.getBBMax(),o=un(s),a=un(n);et(o,o,r),et(a,a,r);for(let l=0;l<3;++l)i.min[l]=Math.min(i.min[l],o[l],a[l]),i.max[l]=Math.max(i.max[l],o[l],a[l]);for(let l=0;l<3;++l){ve(o,s),ve(a,n),o[l]=n[l],a[l]=s[l],et(o,o,r),et(a,a,r);for(let c=0;c<3;++c)i.min[c]=Math.min(i.min[c],o[c],a[c]),i.max[c]=Math.max(i.max[c],o[c],a[c])}}_invalidateBoundingVolume(){this._bvDirty=!0,w(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(t,i){w(this._parentLayer)&&this._parentLayer.events.emit(t,i)}get test(){const t=this;return{hasGeometry:i=>t._geometries.includes(i),getGeometryIndex:i=>t._geometries.indexOf(i)}}}class Uxe{constructor(){this.min=Ke(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ke(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class Ioe extends Uxe{constructor(){super(...arguments),this.bounds=Qn()}init(){fe(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),fe(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),rge(this.bounds)}}const Lv=F();function EJ(e,t,i,r,s,n,o,a){const l=i?i.length:0,c=e.clippingExtent;if(po(t,Lv,e.elevationProvider.spatialReference),w(c)&&!QZ(c,Lv))return null;po(t,Lv,e.renderCoordsHelper.spatialReference);const h=e.localOriginFactory.getOrigin(Lv),p=new m0({castShadow:!1,metadata:{layerUid:n,graphicUid:o,usesVerticalDistanceToGround:!0}});for(let m=0;m<l;m++){const g=Dn;p.addGeometry(i[m],r[m],g,h,a)}return{object:p,sampledElevation:yet(p,t,e.elevationProvider,e.renderCoordsHelper,s)}}function p3(e,t,i){const r=e.elevationContext,s=i.spatialReference;po(t,Lv,s),r.centerPointInElevationSR=f0(Lv[0],Lv[1],t.hasZ?Lv[2]:0,s)}function f3(e){switch(e.type){case"point":return e;case"polygon":case"extent":return yJ(e);case"polyline":{const t=e.paths[0];if(!t||t.length===0)return null;const i=Ude(t,kde(t)/2);return f0(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.origin}return null}function Xet(e){const t=new dr;t.include(DQ),t.include(Nwe,e),t.include(Ns,e),t.attributes.add(D.UV0,"vec2");const{vertex:i,fragment:r}=t;return i.uniforms.add([new Ci("viewport",(s,n)=>n.camera.fullViewport),new lt("lineSize",(s,n)=>Math.ceil(s.size)*n.camera.pixelRatio),new Ni("pixelToNDC",(s,n)=>Di($oe,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3])),new lt("borderSize",(s,n)=>w(s.borderColor)?n.camera.pixelRatio:0),new Ni("screenOffset",(s,n)=>Di($oe,s.screenOffset[0]*n.camera.pixelRatio,s.screenOffset[1]*n.camera.pixelRatio))]),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),e.hasMultipassGeometry&&t.varyings.add("depth","float"),e.hasScreenSizePerspective&&uz(i),i.code.add(E`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${e.occlusionTestEnabled?E`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${e.hasScreenSizePerspective?E`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:E`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${e.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${e.depthHudEnabled?e.depthHudAlignStartEnabled?E`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:E`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${e.hasScreenSizePerspective?E`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:E`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),r.uniforms.add([new Ci("uColor",s=>Loe(s.color)),new Ci("borderColor",s=>Loe(s.borderColor))]),e.hasMultipassGeometry&&(r.include(rbe,e),r.uniforms.add(new Ni("inverseViewport",(s,n)=>n.inverseViewport))),r.code.add(E`
    void main() {
      ${e.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${e.depthHudEnabled?E`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:E`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),t}function Loe(e){return w(e)?e:vm}const $oe=yt(),Yet=Object.freeze(Object.defineProperty({__proto__:null,build:Xet},Symbol.toStringTag,{value:"Module"}));class bz extends $r{initializeConfiguration(t,i){i.spherical=t.viewingMode===st.Global}initializeProgram(t){const i=bz.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}setPipelineState(t){const i=t?kr.ALWAYS:kr.LESS;return this.configuration.depthHudEnabled?ni({depthTest:{func:i},depthWrite:ec}):ni({blending:Bo(je.ONE,je.SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),depthTest:{func:i},colorWrite:wi})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}bz.shader=new Tr(Yet,()=>_e(()=>import("./LineCallout.glsl.07924ae4.js"),[],import.meta.url));class zh extends Oa{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=Ul.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}u([ee({count:Ul.COUNT})],zh.prototype,"screenCenterOffsetUnitsEnabled",void 0),u([ee()],zh.prototype,"spherical",void 0),u([ee()],zh.prototype,"occlusionTestEnabled",void 0),u([ee()],zh.prototype,"hasVerticalOffset",void 0),u([ee()],zh.prototype,"hasScreenSizePerspective",void 0),u([ee()],zh.prototype,"depthHudEnabled",void 0),u([ee()],zh.prototype,"depthHudAlignStartEnabled",void 0),u([ee()],zh.prototype,"hasSlicePlane",void 0),u([ee()],zh.prototype,"hasMultipassGeometry",void 0),u([ee({constValue:!0})],zh.prototype,"hasSliceInVertexProgram",void 0),u([ee({constValue:!1})],zh.prototype,"isDraped",void 0);class Yw extends Xm{constructor(t){super(t,new Jet),this.techniqueConfig=new zh,this._uniqueMaterialIdentifier=Yw.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(t,i){const r=(i==null?void 0:i.slot)!==Ue.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=w(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=w(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=r,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?Ul.Screen:Ul.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!i&&i.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(t){switch(t){case Ue.LINE_CALLOUTS:case Ue.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(t){return t.output===ue.Color?new Qet(t):null}createBufferWriter(){return new ett}validateParameters(t){const i=Yw.uniqueMaterialIdentifier(t);i!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=i)}static uniqueMaterialIdentifier(t){return JSON.stringify({screenOffset:t.screenOffset||[0,0],centerOffsetUnits:t.centerOffsetUnits||"world"})}}class Qet extends S1{beginSlot(t){return this.ensureTechnique(bz,t)}}class Jet extends cA{constructor(){super(...arguments),this.screenOffset=gd,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const Ket=As().vec3f(D.POSITION).vec3f(D.NORMAL).vec2f(D.UV0).vec4f(D.AUXPOS1),Doe=[il(0,0),il(1,0),il(0,1),il(1,0),il(1,1),il(0,1)];class ett{constructor(){this.vertexBufferLayout=Ket}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 6*t.indices.get(D.POSITION).length}write(t,i,r,s){dz(i.indices.get(D.POSITION),i.vertexAttributes.get(D.POSITION).data,t.transformation,r.position,s,6),uJ(i.indices.get(D.NORMAL),i.vertexAttributes.get(D.NORMAL).data,t.invTranspTransformation,r.normal,s,6),wC(i.indices.get(D.AUXPOS1),i.vertexAttributes.get(D.AUXPOS1).data,r.auxpos1,s,6);for(let n=0;n<Doe.length;++n)r.uv0.setVec(s+n,Doe[n])}}class wz extends Qm{constructor(t,i){super(t,null,i,rtt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new Yw(this.materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(t){const i=this.materialParameters;return i.screenOffset=t.screenOffset||gd,i.centerOffsetUnits=t.centerOffsetUnits||"world",i}get materialParameters(){const t=this.symbol,i=t.callout,r=w(i.color)?at.toUnitRGBA(i.color):[0,0,0,0];r[3]*=this._getLayerOpacity();const s=No(i.size||0);let n=null;if(t.verticalOffset){const{screenLength:p,minWorldLength:m,maxWorldLength:g}=t.verticalOffset;n={screenLength:No(p),minWorldLength:m||0,maxWorldLength:g!=null?g:1/0}}const o=w(i.border)&&w(i.border.color)?at.toUnitRGBA(i.border.color):null,a=t.symbolLayers.getItemAt(0).type==="object",l=!a,c=a?0:void 0,h=t.type==="label-3d";return{color:r,size:s,verticalOffset:n,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:o,occlusionTest:l,shaderPolygonOffset:c,depthHUDAlignStart:h,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:ts.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return itt}createGraphics3DGraphic(t){const i=t.renderingInfo,r=t.graphic,s=this.setGraphicElevationContext(r,new lh,i.elevationOffset||0),n=i.symbol,o=this._elevationContext.mode==="on-the-ground"&&(n.type==="cim"||!n.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(n.type!=="label-3d"&&o||n.type==="point-3d"&&n.symbolLayers.every(l=>l.type==="text"&&!Efe(l)))return null;const a=yJ(r.geometry);return N(a)?null:this._createAs3DShape(a,s,i,r.uid)}layerOpacityChanged(){return N(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=_I(wz.elevationModeChangeTypes,r,s);return n!==_s.UPDATE||t.forEach(o=>{const a=i(o);w(a)&&this.updateGraphicElevationContext(o.graphic,a)}),n}slicePlaneEnabledChanged(){return N(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=xd(i.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:TJ.memory}}_createVertexData(t){const{translation:i,centerOffset:r}=t,s=i?{size:3,data:[i[0],i[1],i[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0},n=r?{size:4,data:[r[0],r[1],r[2],r[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0};return[[D.POSITION,s],[D.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[D.AUXPOS1,n]]}_getOrCreateMaterial(t){const i=this._perInstanceMaterialParameters(t),r=Yw.uniqueMaterialIdentifier(i);if(w(this._material)&&r===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.materialCollection){let s=t.materialCollection.get(r);return N(s)&&(s=new Yw(i),t.materialCollection.add(r,s)),{material:s,isUnique:!1}}return{material:new Yw(i),isUnique:!0}}_createAs3DShape(t,i,r,s){const n=[new ss(this._createVertexData(r),ttt,Zl.Point)],o=this._getOrCreateMaterial(r),a=EJ(this._context,t,n,[o.material],i,this._context.layer.uid,s);if(a===null)return null;const l=new Ym(this,a.object,n,o.isUnique?[o.material]:null,null,d3,i);return l.metadata={elevationOffset:r.elevationOffset||0},l.alignedSampledElevation=a.sampledElevation,l.needsElevationUpdates=xd(i.mode),p3(l,t,this._context.elevationProvider),l}}wz.elevationModeChangeTypes={definedChanged:_s.UPDATE,staysOnTheGround:_s.UPDATE,onTheGroundChanged:_s.RECREATE};const w8=new Uint16Array([0]),ttt=[[D.POSITION,w8],[D.NORMAL,w8],[D.AUXPOS1,w8]],itt={mode:"relative-to-ground",offset:0},rtt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Noe=Ie.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function stt(e,t){if(!fX(e))return Noe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${e.type}' does not support callouts`),null;if(!e.callout)return null;const i=ntt[e.callout.type];return i?new i(e,t):(Noe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${e.callout.type}`),null)}const ntt={line:wz};class ott{constructor(t,i,r){this.graphic=t,this.renderingInfo=i,this.layer=r}}const Foe=new qs(Array,e=>Hk(e,Wpe),null,10,5),att=ei();class ltt{constructor(t,i,r,s,n){this.graphic=t,this.graphics3DSymbol=i,this.graphics=r,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=ctt(Po._COUNT,ku._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++i.referenced,this._featureExpressionFeature=n?Mxe(n,t,s):null;for(const o of r)w(o)&&(this.isElevationSource=this.isElevationSource||o.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(t,i){this._layer=i,this._stage=t,this._forEachSymbolLayerGraphic(r=>{r.initialize(t,i),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(t=>t.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.graphics==null}clearLabelGraphics(){this._forEachLabelGraphic(t=>t.destroy()),this._labelGraphics.length=0}addLabelGraphic(t,i,r){this._labelGraphics.push(t),t.initialize(i,r),t.setVisibility(this.isVisible(Po.LABEL))}addAuxiliaryGraphic(t){this._auxiliaryGraphics.push(t),this._layer&&(t.initialize(this._stage,this._layer),t.setVisibility(this.isVisible()))}get isDraped(){let t=!1;return this._forEachSymbolLayerGraphic(i=>{i.type==="draped"&&(t=!0)}),t}isVisible(t=Po.GRAPHIC,i){for(let r=0;r<=t;r++){const s=this._visibilityFlags[r];for(let n=0;n<s.length;++n)if(s[n]===!1&&n!==i)return!1}return!0}hasVisibilityFlag(t,i){return this._visibilityFlags[i][t]!=null}setVisibilityFlag(t,i,r){const s=this.isVisible(r);this._visibilityFlags[r][t]=i;const n=this.isVisible(r);if(s===n)return!1;if(r===Po.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(n));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(n));const o=this.isVisible(Po.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}clearVisibilityFlag(t,i=Po.GRAPHIC){return this.setVisibilityFlag(t,void 0,i)}computeExtent(t){if(!this._extent){const i=this.graphic.geometry;if(N(i))return!1;this._extent=ei(),set(i,this._extent);const r=i.spatialReference;if(!r.equals(t)&&!aU(this._extent,r,this._extent,t))return this._extent=null,!1}return!0}getAsOptimizedGeometry(t,i){return w(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===t&&this._optimizedGeometry.hasM===i||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,t,i),this._optimizedGeometry.hasZ=t,this._optimizedGeometry.hasM=i),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(t,i,r){let s=t.geometry;return s.type!=="mesh"&&s.type!=="extent"||(s=Ku.fromExtent(s.type==="mesh"?s.extent:s)),Qke(s,i,r)}get usedMemory(){let t=Nme(this.graphic.attributes);return this._forEachSymbolLayerGraphic(i=>{const r=i.graphics3DSymbolLayer.complexity;if(N(r))return;const s=i.type==="draped"?r.memory.draped:r.memory;t+=s.bytesPerFeature,s.bytesPerCoordinate&&(t+=ret(this.graphic.geometry)*s.bytesPerCoordinate)}),t}computeAttachmentOrigin(){const t={render:{origin:F(),num:0},draped:{origin:yt(),num:0}};for(const i of this.graphics)N(i)||i.computeAttachmentOrigin(t);return t.render.num&&be(t.render.origin,t.render.origin,1/t.render.num),t.draped.num&&Ic(t.draped.origin,t.draped.origin,1/t.draped.num),t}async getProjectedBoundingBox(t,i,r,s,n){return n||(n={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),n.boundingBox?Fr(n.boundingBox):n.boundingBox=Fr(),n.requiresDrapedElevation=!1,await xU(this.graphics,async o=>{if(N(o))return;const a=o.type==="draped"?i:t,l=Foe.acquire(),c=await o.getProjectedBoundingBox(a,r,n.screenSpaceObjects,s,l);isFinite(c[2])&&isFinite(c[5])||(n.requiresDrapedElevation=!0),c&&kE(n.boundingBox,l),Foe.release(l)}),ZMe(n.boundingBox)||c7(JZ(n.boundingBox,att))?n:null}needsElevationUpdates(){for(const t of this.graphics)if(w(t)&&(t.type==="object3d"||t.type==="lod-instance")&&t.needsElevationUpdates)return!0;for(const t of this._labelGraphics)if(t&&t.needsElevationUpdates)return!0;return!1}alignWithElevation(t,i,r){this._forEachRenderedGraphic(s=>{s.type!=="object3d"&&s.type!=="lod-instance"||s.alignWithElevation(t,i,this._featureExpressionFeature,r)})}addObjectStateSet(t,i){this._forEachSymbolLayerGraphic(r=>r.addObjectState(t,i))}removeObjectState(t){this._forEachSymbolLayerGraphic(i=>i.removeObjectState(t))}_forEachGraphicList(t,i){t.forEach(r=>r&&i(r))}_forEachSymbolLayerGraphic(t){this._forEachGraphicList(this.graphics,t),this._forEachGraphicList(this._auxiliaryGraphics,t)}_forEachLabelGraphic(t){this._forEachGraphicList(this._labelGraphics,t)}_forEachRenderedGraphic(t){this._forEachSymbolLayerGraphic(t),this._forEachLabelGraphic(t)}}function ctt(e,t){const i=new Array(e);for(let r=0;r<i.length;r++)i[r]=new Array(t);return i}var koe,Uoe,zoe,zxe={exports:{}};koe=zxe,Uoe=function(){function e(z,j,Q){Q=Q||2;var Z,ie,le,K,ae,we,Re,Ge=j&&j.length,Pe=Ge?j[0]*Q:z.length,Se=t(z,0,Pe,Q,!0),$e=[];if(!Se||Se.next===Se.prev)return $e;if(Ge&&(Se=l(z,j,Se,Q)),z.length>80*Q){Z=le=z[0],ie=K=z[1];for(var qe=Q;qe<Pe;qe+=Q)(ae=z[qe])<Z&&(Z=ae),(we=z[qe+1])<ie&&(ie=we),ae>le&&(le=ae),we>K&&(K=we);Re=(Re=Math.max(le-Z,K-ie))!==0?1/Re:0}return r(Se,$e,Q,Z,ie,Re),$e}function t(z,j,Q,Z,ie){var le,K;if(ie===pe(z,j,Q,Z)>0)for(le=j;le<Q;le+=Z)K=ne(le,z[le],z[le+1],K);else for(le=Q-Z;le>=j;le-=Z)K=ne(le,z[le],z[le+1],K);if(K&&I(K,K.next)){var ae=K.next;re(K),K=ae}return K}function i(z,j){if(!z)return z;j||(j=z);var Q,Z=z;do if(Q=!1,Z.steiner||!I(Z,Z.next)&&M(Z.prev,Z,Z.next)!==0)Z=Z.next;else{var ie=Z.prev;if(re(Z),(Z=j=ie)===Z.next)break;Q=!0}while(Q||Z!==j);return j}function r(z,j,Q,Z,ie,le,K){if(z){!K&&le&&v(z,Z,ie,le);for(var ae,we,Re=z;z.prev!==z.next;)if(ae=z.prev,we=z.next,le?n(z,Z,ie,le):s(z))j.push(ae.i/Q),j.push(z.i/Q),j.push(we.i/Q),re(z),z=we.next,Re=we.next;else if((z=we)===Re){K?K===1?r(z=o(i(z),j,Q),j,Q,Z,ie,le,2):K===2&&a(z,j,Q,Z,ie,le):r(i(z),j,Q,Z,ie,le,1);break}}}function s(z){var j=z.prev,Q=z,Z=z.next;if(M(j,Q,Z)>=0)return!1;for(var ie=z.next.next;ie!==z.prev;){if(O(j.x,j.y,Q.x,Q.y,Z.x,Z.y,ie.x,ie.y)&&M(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function n(z,j,Q,Z){var ie=z.prev,le=z,K=z.next;if(M(ie,le,K)>=0)return!1;for(var ae=ie.x<le.x?ie.x<K.x?ie.x:K.x:le.x<K.x?le.x:K.x,we=ie.y<le.y?ie.y<K.y?ie.y:K.y:le.y<K.y?le.y:K.y,Re=ie.x>le.x?ie.x>K.x?ie.x:K.x:le.x>K.x?le.x:K.x,Ge=ie.y>le.y?ie.y>K.y?ie.y:K.y:le.y>K.y?le.y:K.y,Pe=S(ae,we,j,Q,Z),Se=S(Re,Ge,j,Q,Z),$e=z.prevZ,qe=z.nextZ;$e&&$e.z>=Pe&&qe&&qe.z<=Se;){if($e!==z.prev&&$e!==z.next&&O(ie.x,ie.y,le.x,le.y,K.x,K.y,$e.x,$e.y)&&M($e.prev,$e,$e.next)>=0||($e=$e.prevZ,qe!==z.prev&&qe!==z.next&&O(ie.x,ie.y,le.x,le.y,K.x,K.y,qe.x,qe.y)&&M(qe.prev,qe,qe.next)>=0))return!1;qe=qe.nextZ}for(;$e&&$e.z>=Pe;){if($e!==z.prev&&$e!==z.next&&O(ie.x,ie.y,le.x,le.y,K.x,K.y,$e.x,$e.y)&&M($e.prev,$e,$e.next)>=0)return!1;$e=$e.prevZ}for(;qe&&qe.z<=Se;){if(qe!==z.prev&&qe!==z.next&&O(ie.x,ie.y,le.x,le.y,K.x,K.y,qe.x,qe.y)&&M(qe.prev,qe,qe.next)>=0)return!1;qe=qe.nextZ}return!0}function o(z,j,Q){var Z=z;do{var ie=Z.prev,le=Z.next.next;!I(ie,le)&&$(ie,Z,Z.next,le)&&Y(ie,le)&&Y(le,ie)&&(j.push(ie.i/Q),j.push(Z.i/Q),j.push(le.i/Q),re(Z),re(Z.next),Z=z=le),Z=Z.next}while(Z!==z);return i(Z)}function a(z,j,Q,Z,ie,le){var K=z;do{for(var ae=K.next.next;ae!==K.prev;){if(K.i!==ae.i&&C(K,ae)){var we=X(K,ae);return K=i(K,K.next),we=i(we,we.next),r(K,j,Q,Z,ie,le),void r(we,j,Q,Z,ie,le)}ae=ae.next}K=K.next}while(K!==z)}function l(z,j,Q,Z){var ie,le,K,ae=[];for(ie=0,le=j.length;ie<le;ie++)(K=t(z,j[ie]*Z,ie<le-1?j[ie+1]*Z:z.length,Z,!1))===K.next&&(K.steiner=!0),ae.push(T(K));for(ae.sort(c),ie=0;ie<ae.length;ie++)Q=i(Q=p(ae[ie],Q),Q.next);return Q}function c(z,j){return z.x-j.x}function h(z){if(z.next.prev===z)return z;let j=z;for(;;){const Q=j.next;if(Q.prev===j||Q===j||Q===z)break;j=Q}return j}function p(z,j){var Q=m(z,j);if(!Q)return j;var Z=X(Q,z),ie=i(Q,Q.next);let le=h(Z);return i(le,le.next),ie=h(ie),h(j===Q?ie:j)}function m(z,j){var Q,Z=j,ie=z.x,le=z.y,K=-1/0;do{if(le<=Z.y&&le>=Z.next.y&&Z.next.y!==Z.y){var ae=Z.x+(le-Z.y)*(Z.next.x-Z.x)/(Z.next.y-Z.y);if(ae<=ie&&ae>K){if(K=ae,ae===ie){if(le===Z.y)return Z;if(le===Z.next.y)return Z.next}Q=Z.x<Z.next.x?Z:Z.next}}Z=Z.next}while(Z!==j);if(!Q)return null;if(ie===K)return Q;var we,Re=Q,Ge=Q.x,Pe=Q.y,Se=1/0;Z=Q;do ie>=Z.x&&Z.x>=Ge&&ie!==Z.x&&O(le<Pe?ie:K,le,Ge,Pe,le<Pe?K:ie,le,Z.x,Z.y)&&(we=Math.abs(le-Z.y)/(ie-Z.x),Y(Z,z)&&(we<Se||we===Se&&(Z.x>Q.x||Z.x===Q.x&&g(Q,Z)))&&(Q=Z,Se=we)),Z=Z.next;while(Z!==Re);return Q}function g(z,j){return M(z.prev,z,j.prev)<0&&M(j.next,z,z.next)<0}function v(z,j,Q,Z){var ie=z;do ie.z===null&&(ie.z=S(ie.x,ie.y,j,Q,Z)),ie.prevZ=ie.prev,ie.nextZ=ie.next,ie=ie.next;while(ie!==z);ie.prevZ.nextZ=null,ie.prevZ=null,b(ie)}function b(z){var j,Q,Z,ie,le,K,ae,we,Re=1;do{for(Q=z,z=null,le=null,K=0;Q;){for(K++,Z=Q,ae=0,j=0;j<Re&&(ae++,Z=Z.nextZ);j++);for(we=Re;ae>0||we>0&&Z;)ae!==0&&(we===0||!Z||Q.z<=Z.z)?(ie=Q,Q=Q.nextZ,ae--):(ie=Z,Z=Z.nextZ,we--),le?le.nextZ=ie:z=ie,ie.prevZ=le,le=ie;Q=Z}le.nextZ=null,Re*=2}while(K>1);return z}function S(z,j,Q,Z,ie){return(z=1431655765&((z=858993459&((z=252645135&((z=16711935&((z=32767*(z-Q)*ie)|z<<8))|z<<4))|z<<2))|z<<1))|(j=1431655765&((j=858993459&((j=252645135&((j=16711935&((j=32767*(j-Z)*ie)|j<<8))|j<<4))|j<<2))|j<<1))<<1}function T(z){var j=z,Q=z;do(j.x<Q.x||j.x===Q.x&&j.y<Q.y)&&(Q=j),j=j.next;while(j!==z);return Q}function O(z,j,Q,Z,ie,le,K,ae){return(ie-K)*(j-ae)-(z-K)*(le-ae)>=0&&(z-K)*(Z-ae)-(Q-K)*(j-ae)>=0&&(Q-K)*(le-ae)-(ie-K)*(Z-ae)>=0}function C(z,j){return z.next.i!==j.i&&z.prev.i!==j.i&&!G(z,j)&&(Y(z,j)&&Y(j,z)&&J(z,j)&&(M(z.prev,z,j.prev)||M(z,j.prev,j))||I(z,j)&&M(z.prev,z,z.next)>0&&M(j.prev,j,j.next)>0)}function M(z,j,Q){return(j.y-z.y)*(Q.x-j.x)-(j.x-z.x)*(Q.y-j.y)}function I(z,j){return z.x===j.x&&z.y===j.y}function $(z,j,Q,Z){var ie=q(M(z,j,Q)),le=q(M(z,j,Z)),K=q(M(Q,Z,z)),ae=q(M(Q,Z,j));return ie!==le&&K!==ae||!(ie!==0||!U(z,Q,j))||!(le!==0||!U(z,Z,j))||!(K!==0||!U(Q,z,Z))||!(ae!==0||!U(Q,j,Z))}function U(z,j,Q){return j.x<=Math.max(z.x,Q.x)&&j.x>=Math.min(z.x,Q.x)&&j.y<=Math.max(z.y,Q.y)&&j.y>=Math.min(z.y,Q.y)}function q(z){return z>0?1:z<0?-1:0}function G(z,j){var Q=z;do{if(Q.i!==z.i&&Q.next.i!==z.i&&Q.i!==j.i&&Q.next.i!==j.i&&$(Q,Q.next,z,j))return!0;Q=Q.next}while(Q!==z);return!1}function Y(z,j){return M(z.prev,z,z.next)<0?M(z,j,z.next)>=0&&M(z,z.prev,j)>=0:M(z,j,z.prev)<0||M(z,z.next,j)<0}function J(z,j){var Q=z,Z=!1,ie=(z.x+j.x)/2,le=(z.y+j.y)/2;do Q.y>le!=Q.next.y>le&&Q.next.y!==Q.y&&ie<(Q.next.x-Q.x)*(le-Q.y)/(Q.next.y-Q.y)+Q.x&&(Z=!Z),Q=Q.next;while(Q!==z);return Z}function X(z,j){var Q=new ye(z.i,z.x,z.y),Z=new ye(j.i,j.x,j.y),ie=z.next,le=j.prev;return z.next=j,j.prev=z,Q.next=ie,ie.prev=Q,Z.next=Q,Q.prev=Z,le.next=Z,Z.prev=le,Z}function ne(z,j,Q,Z){var ie=new ye(z,j,Q);return Z?(ie.next=Z.next,ie.prev=Z,Z.next.prev=ie,Z.next=ie):(ie.prev=ie,ie.next=ie),ie}function re(z){z.next.prev=z.prev,z.prev.next=z.next,z.prevZ&&(z.prevZ.nextZ=z.nextZ),z.nextZ&&(z.nextZ.prevZ=z.prevZ)}function ye(z,j,Q){this.i=z,this.x=j,this.y=Q,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pe(z,j,Q,Z){for(var ie=0,le=j,K=Q-Z;le<Q;le+=Z)ie+=(z[K]-z[le])*(z[le+1]+z[K+1]),K=le;return ie}return e.deviation=function(z,j,Q,Z){var ie=j&&j.length,le=ie?j[0]*Q:z.length,K=Math.abs(pe(z,0,le,Q));if(ie)for(var ae=0,we=j.length;ae<we;ae++){var Re=j[ae]*Q,Ge=ae<we-1?j[ae+1]*Q:z.length;K-=Math.abs(pe(z,Re,Ge,Q))}var Pe=0;for(ae=0;ae<Z.length;ae+=3){var Se=Z[ae]*Q,$e=Z[ae+1]*Q,qe=Z[ae+2]*Q;Pe+=Math.abs((z[Se]-z[qe])*(z[$e+1]-z[Se+1])-(z[Se]-z[$e])*(z[qe+1]-z[Se+1]))}return K===0&&Pe===0?0:Math.abs((Pe-K)/K)},e.flatten=function(z){for(var j=z[0][0].length,Q={vertices:[],holes:[],dimensions:j},Z=0,ie=0;ie<z.length;ie++){for(var le=0;le<z[ie].length;le++)for(var K=0;K<j;K++)Q.vertices.push(z[ie][le][K]);ie>0&&(Z+=z[ie-1].length,Q.holes.push(Z))}return Q},e},(zoe=Uoe())!==void 0&&(koe.exports=zoe);const SC=zxe.exports,xz=Ie.getLogger("esri.views.3d.support.buffer.math");function bI(e,t,i){if(e.count!==t.count)return void xz.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[4],l=i[5],c=i[6],h=i[8],p=i[9],m=i[10],g=i[12],v=i[13],b=i[14],S=e.typedBuffer,T=e.typedBufferStride,O=t.typedBuffer,C=t.typedBufferStride;for(let M=0;M<r;M++){const I=M*T,$=M*C,U=O[$],q=O[$+1],G=O[$+2];S[I]=s*U+a*q+h*G+g,S[I+1]=n*U+l*q+p*G+v,S[I+2]=o*U+c*q+m*G+b}}function g1(e,t,i){if(e.count!==t.count)return void xz.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],m=i[8],g=e.typedBuffer,v=e.typedBufferStride,b=t.typedBuffer,S=t.typedBufferStride;for(let T=0;T<r;T++){const O=T*v,C=T*S,M=b[C],I=b[C+1],$=b[C+2];g[O]=s*M+a*I+h*$,g[O+1]=n*M+l*I+p*$,g[O+2]=o*M+c*I+m*$}}function aW(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2]}}function CJ(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],m=n[c+2],g=h*h+p*p+m*m;if(g>0){const v=1/Math.sqrt(g);r[l]=v*h,r[l+1]=v*p,r[l+2]=v*m}}}function utt(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:bI,transformMat3:g1,scale:aW,normalize:CJ,shiftRight:utt},Symbol.toStringTag,{value:"Module"}));function Tz(e,t){if(!e||e.symbol)return null;const i=t&&t.renderer;return e&&w(i)&&i.getObservationRenderer?i.getObservationRenderer(e):i}function htt(e,t){if(w(e.symbol))return e.symbol;const i=Tz(e,t);return w(i)&&i.type!=="dot-density"?i.getSymbol(e,t):null}function qbt(e,t){const i=Tz(e,t),r=htt(e,t);if(N(r))return null;const s={renderer:i,symbol:r};if(N(i)||!("visualVariables"in i)||!i.visualVariables)return s;const n=NY(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)switch(a.type){case"color":s.color=l.toRgba();break;case"size":if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=h;break;case"depth":o[1]=h;break;case"height":o[2]=h;break;case"width-and-depth":o[0]=o[1]=h;break;default:o[0]=o[1]=o[2]=h}}break;case"opacity":s.opacity=l;break;case"rotation":switch(a.axis){case"tilt":s.tilt=l;break;case"roll":s.roll=l;break;default:s.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(s.size=o),s}async function dtt(e,t){if(w(e.symbol))return e.symbol;const i=Tz(e,t);return w(i)&&i.getSymbolAsync(e,t)}async function Wbt(e,t){const i=Tz(e,t),r=await dtt(e,t);if(!r)return null;const s={renderer:i,symbol:r};if(!i||!("visualVariables"in i)||!i.visualVariables)return s;const n=NY(i,e,t),o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of n)if(a.type==="color")s.color=at.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")s.outlineSize=l;else{const c=a.axis,h=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=h:c==="depth"?o[1]=h:c==="height"?o[2]=h:o[0]=o[1]=c==="width-and-depth"?h:o[2]=h}else a.type==="opacity"?s.opacity=l:a.type==="rotation"&&a.axis==="tilt"?s.tilt=l:a.type==="rotation"&&a.axis==="roll"?s.roll=l:a.type==="rotation"&&(s.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(s.size=o),s}function ptt(e,t=0){const i=e[t];return typeof i=="number"&&isFinite(i)?i:null}function ftt(e){for(let t=0;t<3;t++){const i=e[t];if(typeof i=="number")return isFinite(i)?i:0}return 0}function Bxe(e,t,i){var I;const r=e.byteLength/(4*t),s=new Uint32Array(e,0,r*t);let n=new Uint32Array(r);const o=(I=i==null?void 0:i.minReduction)!=null?I:0,a=(i==null?void 0:i.originalIndices)||null,l=a?a.length:0,c=(i==null?void 0:i.componentOffsets)||null;let h=0;if(c)for(let $=0;$<c.length-1;$++){const U=c[$+1]-c[$];U>h&&(h=U)}else h=r;const p=Math.floor(1.1*h)+1;(mf==null||mf.length<2*p)&&(mf=new Uint32Array(RE(2*p)));for(let $=0;$<2*p;$++)mf[$]=0;let m=0;const g=!!c&&!!a,v=g?l:r,b=g?new Uint32Array(l):null,S=1.96;let T=o!==0?Math.ceil(4*S*S/(o*o)*o*(1-o)):v,O=1,C=c?c[1]:v;for(let $=0;$<v;$++){if($===T){const X=1-m/$;if(X+S*Math.sqrt(X*(1-X)/$)<o)return null;T*=2}if($===C){for(let X=0;X<2*p;X++)mf[X]=0;if(a)for(let X=c[O-1];X<c[O];X++)b[X]=n[a[X]];C=c[++O]}const U=g?a[$]:$,q=U*t,G=ytt(s,q,t);let Y=G%p,J=m;for(;mf[2*Y+1]!==0;){if(mf[2*Y]===G){const X=mf[2*Y+1]-1;if(mtt(s,q,X*t,t)){J=n[X];break}}Y++,Y>=p&&(Y-=p)}J===m&&(mf[2*Y]=G,mf[2*Y+1]=U+1,m++),n[U]=J}if(o!==0&&1-m/r<o)return null;if(g){for(let $=c[O-1];$<b.length;$++)b[$]=n[a[$]];n=b}const M=new Uint32Array(t*m);m=0;for(let $=0;$<v;$++)n[$]===m&&(gtt(s,(g?a[$]:$)*t,M,m*t,t),m++);if(a&&!g){const $=new Uint32Array(l);for(let U=0;U<$.length;U++)$[U]=n[a[U]];n=$}return{buffer:M.buffer,indices:n,uniqueCount:m}}function mtt(e,t,i,r){for(let s=0;s<r;s++)if(e[t+s]!==e[i+s])return!1;return!0}function gtt(e,t,i,r,s){for(let n=0;n<s;n++)i[r+n]=e[t+n]}function ytt(e,t,i){let r=0;for(let s=0;s<i;s++)r=e[t+s]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let mf=null;function Zbt(e){const t=wI(e.rings,e.hasZ,Nm.CCW_IS_HOLE),i=[];let r=0,s=0;for(const a of t.polygons){const l=a.count,c=a.index,h=new Float64Array(t.position.buffer,3*c*t.position.BYTES_PER_ELEMENT,3*l),p=a.holeIndices.map(g=>g-c),m=new Uint32Array(SC(h,p,3));i.push({position:h,faces:m}),r+=h.length,s+=m.length}const n=_tt(i,r,s),o=Bxe(n.position.buffer,6,{originalIndices:n.faces});return n.position=new Float64Array(o.buffer),n.faces=o.indices,n}function _tt(e,t,i){if(e.length===1)return e[0];const r=new Float64Array(t),s=new Uint32Array(i);let n=0,o=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[n++]=l.position[c];for(let c=0;c<l.faces.length;c++)s[o++]=l.faces[c]+a;a=n/3}return{position:r,faces:s}}function wI(e,t,i){const r=e.length,s=new Array(r),n=new Array(r),o=new Array(r);let a=0,l=0,c=0,h=0;for(let g=0;g<r;++g)h+=e[g].length;const p=new Float64Array(3*h);let m=0;for(let g=r-1;g>=0;g--){const v=e[g],b=i===Nm.CCW_IS_HOLE&&vtt(v);if(b&&r!==1)s[a++]=v;else{let S=v.length;for(let O=0;O<a;++O)S+=s[O].length;const T={index:m,pathLengths:new Array(a+1),count:S,holeIndices:new Array(a)};T.pathLengths[0]=v.length,v.length>0&&(o[c++]={index:m,count:v.length}),m=b?G$(v,v.length-1,-1,p,m,v.length,t):G$(v,0,1,p,m,v.length,t);for(let O=0;O<a;++O){const C=s[O];T.holeIndices[O]=m,T.pathLengths[O+1]=C.length,C.length>0&&(o[c++]={index:m,count:C.length}),m=G$(C,0,1,p,m,C.length,t)}a=0,T.count>0&&(n[l++]=T)}}for(let g=0;g<a;++g){const v=s[g];v.length>0&&(o[c++]={index:m,count:v.length}),m=G$(v,0,1,p,m,v.length,t)}return l<r&&(n.length=l),c<r&&(o.length=c),{position:p,polygons:n,outlines:o}}function G$(e,t,i,r,s,n,o){s*=3;for(let a=0;a<n;++a){const l=e[t];r[s++]=l[0],r[s++]=l[1],r[s++]=o?l[2]:0,t+=i}return s/3}function vtt(e){return!PZ(e,!1,!1)}var Nm;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(Nm||(Nm={}));var HM,lW;(function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"})(HM||(HM={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(lW||(lW={}));var ns,td,ri,EC,Gs,uo;(function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"})(ns||(ns={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(td||(td={})),function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"}(ri||(ri={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(EC||(EC={})),function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.Water=3]="Water",e[e.Occluded=4]="Occluded"}(Gs||(Gs={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(uo||(uo={}));class btt{constructor(t,i){this.vec3=t,this.id=i}}function qM(e,t,i,r){return new btt(Ke(e,t,i),r)}var Ja;(function(e){e[e.None=0]="None",e[e.ColorAndWater=1]="ColorAndWater",e[e.Highlight=2]="Highlight",e[e.Occluded=3]="Occluded"})(Ja||(Ja={}));class Boe{constructor(t,i){this.index=t,this.renderTargets=i,this._extent=ei(),this.resolution=0,this.renderLocalOrigin=qM(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new xtt,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=t,this.validTargets=new Array(i.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(t){return this.validTargets[t]?this.renderTargets.getTarget(t).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(t){const i=t===Ja.ColorAndWater?this.renderTargets.getTarget(Gs.Color):t===Ja.Highlight?this.renderTargets.getTarget(Gs.Highlight):this.renderTargets.getTarget(Gs.Occluded);return i?i.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Gs.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Gs.Color):null}getNormalTexture(t){const i=t===Ja.ColorAndWater?this.renderTargets.getTarget(Gs.Water):null;return i?i.getTexture():null}draw(t,i){const r=this.computeRenderTargetValidityBitfield();for(const s of this.renderTargets.renderTargets)s.type!==Gs.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[s.type]=t.drawTarget(this,s,i):this.validTargets[s.type]=!1;return r^this.computeRenderTargetValidityBitfield()?lC.CHANGED:lC.UNCHANGED}computeRenderTargetValidityBitfield(){const t=this.validTargets;return+t[Gs.Color]|+t[Gs.ColorNoRasterImage]<<1|+t[Gs.Highlight]<<2|+t[Gs.Water]<<3|+t[Gs.Occluded]<<4}setupGeometryViewsCyclical(t){this.setupGeometryViewsDirect();const i=.001*t.range;if(this._extent[0]-i<=t.min){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];O4(this._extent,t.range,0,r)}if(this._extent[2]+i>=t.max){const r=this.canvasGeometries.extents[this.canvasGeometries.numViews++];O4(this._extent,-t.range,0,r)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,Gy(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let t=0;t<this.canvasGeometries.numViews;t++){const i=this.canvasGeometries.extents[t];if(i[0]!==i[2]&&i[1]!==i[3])return!0}return!1}applyViewport(t){t.setViewport(this.index===ns.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function wtt(e,t,i){return Math.min(RE(Math.max(e,t)+256),i)}class xtt{constructor(){this.extents=[ei(),ei(),ei()],this.numViews=0}}class Vxe{constructor(t,i){this.size=OQ(),this._fbo=null,this._fbo=new Xr(t,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR_MIPMAP_LINEAR,hasMipmap:i,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=ht(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return this._fbo!==null}resize(t,i){this.size[0]=t,this.size[1]=i,this._fbo.resize(this.size[0],this.size[1])}bind(t){t.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var t;(t=this._fbo)==null||t.resize(0,0)}get gpuMemoryUsage(){var t,i;return(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0}}class Ttt{constructor(t){const i=(r,s,n=!0)=>({type:s,fbo:new Vxe(t,n),renderPass:r,valid:!1,lastUsed:1/0});this.renderTargets=[i(nt.MATERIAL,Gs.Color),i(nt.MATERIAL,Gs.ColorNoRasterImage),i(nt.MATERIAL_HIGHLIGHT,Gs.Highlight,!1),i(nt.MATERIAL_NORMAL,Gs.Water),i(nt.MATERIAL,Gs.Occluded)]}getTarget(t){return this.renderTargets[t].fbo}dispose(){for(const t of this.renderTargets)t.fbo.dispose()}disposeRenderTargetMemory(){for(const t of this.renderTargets)t.fbo.disposeRenderTargetMemory()}validateUsageForTarget(t,i,r){if(t)i.lastUsed=r;else if(r-i.lastUsed>Stt)i.fbo.disposeRenderTargetMemory(),i.lastUsed=1/0;else if(i.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((t,i)=>t+i.fbo.gpuMemoryUsage,0)}}const Stt=1e3;class AJ{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(t,i){var r;return(r=this._outer.get(t))==null?void 0:r.get(i)}set(t,i,r){const s=this._outer.get(t);s?s.set(i,r):this._outer.set(t,new Map([[i,r]]))}delete(t,i){const r=this._outer.get(t);r&&(r.delete(i),r.size===0&&this._outer.delete(t))}forEach(t){this._outer.forEach((i,r)=>t(i,r))}}class Gxe{constructor(t){this._context=t,this._perConstructorInstances=new AJ,this._frameCounter=0,this._keepAliveFrameCount=Voe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(t=>t.forEach(i=>i.technique.destroy())),this._perConstructorInstances.clear()}acquire(t,i){const r=i.key;let s=this._perConstructorInstances.get(t,r);if(N(s)){const n=new t(this._context,i,()=>this.release(n));s=new Ett(n),this._perConstructorInstances.set(t,r,s)}return++s.refCount,s.technique}releaseAndAcquire(t,i,r){if(w(r)){if(i.key===r.key)return r;this.release(r)}return this.acquire(t,i)}release(t){if(N(t)||this._perConstructorInstances.empty)return;const i=this._perConstructorInstances.get(t.constructor,t.key);N(i)||(--i.refCount,i.refCount===0&&(i.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Voe&&this._perConstructorInstances.forEach((t,i)=>{t.forEach((r,s)=>{r.refCount===0&&r.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(r.technique.destroy(),this._perConstructorInstances.delete(i,s))})})}async reloadAll(){const t=new Array;this._perConstructorInstances.forEach((i,r)=>{const s=async(n,o)=>{const a=o.shader;a&&(await a.reload(),n.forEach(l=>{l.technique.reload(this._context)}))};t.push(s(i,r))}),await Promise.all(t)}}class Ett{constructor(t){this.technique=t,this.refCount=0,this.refZeroFrame=0}}const Voe=-1,Sz=e=>{class t extends e{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var r;for(const s of(r=this._managedDisposables)!=null?r:[]){const n=this[s];this[s]=null,n&&typeof n.dispose=="function"&&n.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}}return t};class Ez extends Sz(class{}){}function Jo(){return(e,t)=>{var i,r;e.hasOwnProperty("_managedDisposables")||(e._managedDisposables=(r=(i=e._managedDisposables)==null?void 0:i.slice())!=null?r:[]),e._managedDisposables.unshift(t)}}const Ctt=Ie.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class jxe{constructor(t,i,r,s){this._textureRepository=t,this._techniqueRepository=i,this.materialChanged=r,this.requestRender=s,this._id2glMaterialRef=new AJ}dispose(){this._textureRepository.dispose()}acquire(t,i){this._ownMaterial(t);let r=this._id2glMaterialRef.get(i,t.id);if(N(r)){const s=t.createGLMaterial({material:t,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});r=new Att(s),this._id2glMaterialRef.set(i,t.id,r)}return r.ref(),r.glMaterial}release(t,i){const r=this._id2glMaterialRef.get(i,t.id);w(r)&&(r.unref(),r.referenced||(ht(r.glMaterial),this._id2glMaterialRef.delete(i,t.id)))}_ownMaterial(t){w(t.repository)&&t.repository!==this&&Ctt.error("Material is already owned by a different material repository"),t.repository=this}}class Att{constructor(t){this.glMaterial=t,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,At(this.refCnt>=0)}get referenced(){return this.refCnt>0}}const Ott={orderedRepackingEnabled:!1},Rtt={rootOrigin:null},Mtt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];class CC{constructor(t,i){this._objectToBoundingSphere=t,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new xs,this._objectCount=0,i&&(i.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=i.maximumObjectsPerNode),i.maximumDepth!==void 0&&(this._maximumDepth=i.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),xs.clearPool(),cW[0]=null,nb.prune(),lw.prune()}add(t,i=t.length){this._objectCount+=i,this._grow(t,i);const r=xs.acquire();for(let s=0;s<i;s++){const n=t[s];this._isDegenerate(n)?this._degenerateObjects.add(n):(r.init(this._root),this._add(n,r))}xs.release(r)}remove(t,i=null){this._objectCount-=t.length;const r=xs.acquire();for(const s of t){const n=w(i)?i:WE(this._objectToBoundingSphere(s),Dtt);KR(n[3])?(r.init(this._root),this._remove(s,n,r)):this._degenerateObjects.delete(s)}xs.release(r),this._shrink()}update(t,i){if(!KR(i[3])&&this._isDegenerate(t))return;const r=$tt(t);this.remove(r,i),this.add(r)}forEachAlongRay(t,i,r){const s=sh(t,i);this._forEachNode(this._root,n=>{if(!this._intersectsNode(s,n))return!1;const o=n.node;return o.terminals.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(s,a)&&r(a)}),!0})}forEachAlongRayWithVerticalOffset(t,i,r,s){const n=sh(t,i);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(n,o,s))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(n,l,s)&&r(l)}),!0})}forEach(t){this._forEachNode(this._root,i=>{const r=i.node;return r.terminals.forAll(t),r.residents!==null&&r.residents.forAll(t),!0}),this._degenerateObjects.forEach(t)}forEachDegenerateObject(t){this._degenerateObjects.forEach(t)}findClosest(t,i,r,s=()=>!0,n=1/0){let o=1/0,a=1/0,l=null;const c=x8(t,i),h=p=>{if(--n,!s(p))return;const m=this._objectToBoundingSphere(p);if(!Pv(r,m))return;const g=sv(t,i,m),v=g-m[3],b=g+m[3];v<o&&(o=v,a=b,l=p)};return this._forEachNodeDepthOrdered(this._root,p=>{if(n<=0||!Pv(r,p.bounds)||(be(wh,c,p.halfSize),Oe(wh,wh,p.bounds),sv(t,i,wh)>a))return!1;const m=p.node;return m.terminals.forAll(g=>h(g)),m.residents!==null&&m.residents.forAll(g=>h(g)),!0},t,i),l}forEachInDepthRange(t,i,r,s,n,o,a){let l=-1/0,c=1/0;const h={setRange:b=>{r===CC.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,b.near),c=Math.min(c,b.far)):(l=Math.max(l,-b.far),c=Math.min(c,-b.near))}};h.setRange(s);const p=sv(i,r,t),m=x8(i,r),g=x8(i,-r),v=b=>{if(!a(b))return;const S=this._objectToBoundingSphere(b),T=S,O=sv(i,r,T)-p,C=O-S[3],M=O+S[3];C>c||M<l||!Pv(o,S)||n(b,h)};this._forEachNodeDepthOrdered(this._root,b=>{if(!Pv(o,b.bounds)||(be(wh,m,b.halfSize),Oe(wh,wh,b.bounds),sv(i,r,wh)-p>c)||(be(wh,g,b.halfSize),Oe(wh,wh,b.bounds),sv(i,r,wh)-p<l))return!1;const S=b.node;return S.terminals.forAll(T=>v(T)),S.residents!==null&&S.residents.forAll(T=>v(T)),!0},i,r)}forEachNode(t){this._forEachNode(this._root,i=>t(i.node,i.bounds,i.halfSize))}forEachNeighbor(t,i){const r=Oy(i),s=i,n=o=>{const a=this._objectToBoundingSphere(o),l=Oy(a),c=r+l;Yn(a,s)-c*c<=0&&t(o)};this._forEachNode(this._root,o=>{const a=Oy(o.bounds),l=r+a;if(Yn(o.bounds,s)-l*l>0)return!1;const c=o.node;return c.terminals.forAll(h=>n(h)),c.residents!==null&&c.residents.forAll(h=>n(h)),!0}),this.forEachDegenerateObject(n)}_intersectsNode(t,i){return j$(i.bounds,2*-i.halfSize,Au),j$(i.bounds,2*i.halfSize,Ou),nne(t.origin,t.direction,Au,Ou)}_intersectsNodeWithOffset(t,i,r){return j$(i.bounds,2*-i.halfSize,Au),j$(i.bounds,2*i.halfSize,Ou),r.applyToMinMax(Au,Ou),nne(t.origin,t.direction,Au,Ou)}_intersectsObject(t,i){const r=this._objectToBoundingSphere(i);return!(r[3]>0)||uj(r,t)}_intersectsObjectWithOffset(t,i,r){const s=this._objectToBoundingSphere(i);return!(s[3]>0)||uj(r.applyToBoundingSphere(s),t)}_forEachNode(t,i){let r=xs.acquire().init(t);const s=[r];for(;s.length!==0;){if(r=s.pop(),i(r)&&!r.isLeaf())for(let n=0;n<r.node.children.length;n++)r.node.children[n]&&s.push(xs.acquire().init(r).advance(n));xs.release(r)}}_forEachNodeDepthOrdered(t,i,r,s=CC.DepthOrder.FRONT_TO_BACK){let n=xs.acquire().init(t);const o=[n];for(Ltt(r,s,Hoe);o.length!==0;){if(n=o.pop(),i(n)&&!n.isLeaf())for(let a=7;a>=0;--a){const l=Hoe[a];n.node.children[l]&&o.push(xs.acquire().init(n).advance(l))}xs.release(n)}}_remove(t,i,r){nb.clear();const s=r.advanceTo(i,(n,o)=>{nb.push(n.node),nb.push(o)})?r.node.terminals:r.node.residents;if(s.removeUnordered(t),s.length===0)for(let n=nb.length-2;n>=0;n-=2){const o=nb.data[n],a=nb.data[n+1];if(!this._purge(o,a))break}}_nodeIsEmpty(t){if(t.terminals.length!==0)return!1;if(t.residents!==null)return t.residents.length===0;for(let i=0;i<t.children.length;i++)if(t.children[i])return!1;return!0}_purge(t,i){return i>=0&&(t.children[i]=null),!!this._nodeIsEmpty(t)&&(t.residents===null&&(t.residents=new hi({shrink:!0})),!0)}_add(t,i){i.advanceTo(this._objectToBoundingSphere(t))?i.node.terminals.push(t):(i.node.residents.push(t),i.node.residents.length>this._maximumObjectsPerNode&&i.depth<this._maximumDepth&&this._split(i))}_split(t){const i=t.node.residents;t.node.residents=null;for(let r=0;r<i.length;r++){const s=xs.acquire().init(t);this._add(i.getItemAt(r),s),xs.release(s)}}_grow(t,i){if(i!==0&&(Goe(t,i,r=>this._objectToBoundingSphere(r),gf),KR(gf[3])&&!this._fitsInsideTree(gf)))if(this._nodeIsEmpty(this._root.node))WE(gf,this._root.bounds),this._root.halfSize=1.25*gf[3];else{const r=this._rootBoundsForRootAsSubNode(gf);this._placingRootViolatesMaxDepth(r)?this._rebuildTree(gf,r):this._growRootAsSubNode(r),xs.release(r)}}_rebuildTree(t,i){ve(S8,i.bounds),S8[3]=i.halfSize,Goe([t,S8],2,s=>s,E8);const r=xs.acquire().init(this._root);this._root.initFrom(null,E8,1.25*E8[3]),this._forEachNode(r,s=>(this.add(s.node.terminals.data,s.node.terminals.length),s.node.residents!==null&&this.add(s.node.residents.data,s.node.residents.length),!0)),xs.release(r)}_placingRootViolatesMaxDepth(t){const i=Math.log(t.halfSize/this._root.halfSize)*Math.LOG2E;let r=0;return this._forEachNode(this._root,s=>(r=Math.max(r,s.depth),r+i<=this._maximumDepth)),r+i>this._maximumDepth}_rootBoundsForRootAsSubNode(t){const i=t[3],r=t;let s=-1/0;const n=this._root.bounds,o=this._root.halfSize;for(let a=0;a<3;a++){const l=n[a]-o-(r[a]-i),c=r[a]+i-(n[a]+o),h=Math.max(0,Math.ceil(l/(2*o))),p=Math.max(0,Math.ceil(c/(2*o)))+1,m=2**Math.ceil(Math.log(h+p)*Math.LOG2E);s=Math.max(s,m),H$[a].min=h,H$[a].max=p}for(let a=0;a<3;a++){let l=H$[a].min,c=H$[a].max;const h=(s-(l+c))/2;l+=Math.ceil(h),c+=Math.floor(h);const p=n[a]-o-l*o*2;T8[a]=p+(c+l)*o}return T8[3]=s*o*qxe,xs.acquire().initFrom(null,T8,s*o,0)}_growRootAsSubNode(t){const i=this._root.node;ve(gf,this._root.bounds),gf[3]=this._root.halfSize,this._root.init(t),t.advanceTo(gf,null,!0),t.node.children=i.children,t.node.residents=i.residents,t.node.terminals=i.terminals}_shrink(){for(;;){const t=this._findShrinkIndex();if(t===-1)break;this._root.advance(t),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let t=null;const i=this._root.node.children;let r=0,s=0;for(;s<i.length&&t==null;)r=s++,t=i[r];for(;s<i.length;)if(i[s++])return-1;return r}_isDegenerate(t){return!KR(this._objectToBoundingSphere(t)[3])}_fitsInsideTree(t){const i=this._root.bounds,r=this._root.halfSize;return t[3]<=r&&t[0]>=i[0]-r&&t[0]<=i[0]+r&&t[1]>=i[1]-r&&t[1]<=i[1]+r&&t[2]>=i[2]-r&&t[2]<=i[2]+r}}class xs{constructor(){this.bounds=Qn(),this.halfSize=0,this.initFrom(null,null,0,0)}init(t){return this.initFrom(t.node,t.bounds,t.halfSize,t.depth)}initFrom(t,i,r,s=this.depth){return this.node=w(t)?t:xs.createEmptyNode(),w(i)&&WE(i,this.bounds),this.halfSize=r,this.depth=s,this}advance(t){let i=this.node.children[t];i||(i=xs.createEmptyNode(),this.node.children[t]=i),this.node=i,this.halfSize/=2,this.depth++;const r=Hxe[t];return this.bounds[0]+=r[0]*this.halfSize,this.bounds[1]+=r[1]*this.halfSize,this.bounds[2]+=r[2]*this.halfSize,this.bounds[3]=this.halfSize*qxe,this}advanceTo(t,i,r=!1){for(;;){if(this.isTerminalFor(t))return i&&i(this,-1),!0;if(this.isLeaf()){if(!r)return i&&i(this,-1),!1;this.node.residents=null}const s=this._childIndex(t);i&&i(this,s),this.advance(s)}}isLeaf(){return this.node.residents!=null}isTerminalFor(t){return t[3]>this.halfSize/2}_childIndex(t){const i=this.bounds;return(i[0]<t[0]?1:0)+(i[1]<t[1]?2:0)+(i[2]<t[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new hi({shrink:!0}),residents:new hi({shrink:!0})}}static acquire(){return xs._pool.acquire()}static release(t){xs._pool.release(t)}static clearPool(){xs._pool.prune()}}function Ptt(e,t){e[0]=Math.min(e[0],t[0]-t[3]),e[1]=Math.min(e[1],t[1]-t[3]),e[2]=Math.min(e[2],t[2]-t[3])}function Itt(e,t){e[0]=Math.max(e[0],t[0]+t[3]),e[1]=Math.max(e[1],t[1]+t[3]),e[2]=Math.max(e[2],t[2]+t[3])}function j$(e,t,i){i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t}function Goe(e,t,i,r){if(t===1){const s=i(e[0]);WE(s,r)}else{Au[0]=1/0,Au[1]=1/0,Au[2]=1/0,Ou[0]=-1/0,Ou[1]=-1/0,Ou[2]=-1/0;for(let s=0;s<t;s++){const n=i(e[s]);KR(n[3])&&(Ptt(Au,n),Itt(Ou,n))}Nn(r,Au,Ou,.5),r[3]=Math.max(Ou[0]-Au[0],Ou[1]-Au[1],Ou[2]-Au[2])/2}}function Ltt(e,t,i){if(!lw.length)for(let r=0;r<8;++r)lw.push({index:0,distance:0});for(let r=0;r<8;++r){const s=Hxe[r];lw.data[r].index=r,lw.data[r].distance=sv(e,t,s)}lw.sort((r,s)=>r.distance-s.distance);for(let r=0;r<8;++r)i[r]=lw.data[r].index}function x8(e,t){let i=1/0,r=null;for(let s=0;s<8;++s){const n=sv(e,t,joe[s]);n<i&&(i=n,r=joe[s])}return r}function sv(e,t,i){return t*(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])}function KR(e){return!isNaN(e)&&e!==-1/0&&e!==1/0&&e>0}xs._pool=new qs(xs),function(e){var t;(t=e.DepthOrder||(e.DepthOrder={}))[t.FRONT_TO_BACK=1]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(CC||(CC={}));const Hxe=[Ke(-1,-1,-1),Ke(1,-1,-1),Ke(-1,1,-1),Ke(1,1,-1),Ke(-1,-1,1),Ke(1,-1,1),Ke(-1,1,1),Ke(1,1,1)],joe=[Ke(-1,-1,-1),Ke(-1,-1,1),Ke(-1,1,-1),Ke(-1,1,1),Ke(1,-1,-1),Ke(1,-1,1),Ke(1,1,-1),Ke(1,1,1)],qxe=Math.sqrt(3),cW=[null];function $tt(e){return cW[0]=e,cW}const T8=Qn(),wh=F(),Au=F(),Ou=F(),nb=new hi,Dtt=Qn(),gf=Qn(),S8=Qn(),E8=Qn(),H$=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],lw=new hi,Hoe=[0,0,0,0,0,0,0,0],$p=CC;class Wxe extends uI{constructor(t,i=""){var r,s,n;super(),this.apiLayerUid=i,this.type=Kp.Layer,this.events=new ks,this.isSliceable=!1,this._objects=new hi,this._stageHandles=new xi,this.apiLayerUid=i,this.isVisible=(r=t==null?void 0:t.isVisible)!=null?r:!0,this.isPickable=(s=t==null?void 0:t.isPickable)!=null?s:!0,this.updatePolicy=(n=t==null?void 0:t.updatePolicy)!=null?n:aC.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(t){this.detachStage(),this._stage=t;for(const i of Mtt)this._stageHandles.add(this.events.on(i,r=>t.handleEvent(i,r)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(t){this._objects.push(t),t.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:t}),w(this._octree)&&this._octree.add([t])}remove(t){this._objects.removeUnordered(t)&&(t.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:t}),w(this._octree)&&this._octree.remove([t]))}addMany(t){this._objects.pushArray(t);for(const i of t)i.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:t}),w(this._octree)&&this._octree.add(t)}removeMany(t){const i=new Array;if(this._objects.removeUnorderedMany(t,t.length,i),i.length!==0){for(const r of i)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:i}),w(this._octree)&&this._octree.remove(i)}}sync(){w(this._stage)&&this.updatePolicy!==aC.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(t,i){w(this._octree)&&this._octree.update(t,i)}getSpatialQueryAccelerator(){return N(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=Tt(this._octree)}_createOctree(){this._octree=new $p(t=>t.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function X5(e){return w(e)&&e.type===Kp.Layer}class Zxe{constructor(t,i){this._material=t,this._repository=i,this._map=new Map}destroy(){this._map.forEach((t,i)=>{w(t)&&this._repository.release(this._material,Kx(i))})}load(t,i){this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,Kx(i)));const r=this._map.get(i);if(w(r)){if(r.ensureResources(t)===Ac.LOADED)return r;this._repository.requestRender()}return null}}function Kx(e){switch(e){case nt.MATERIAL:return ue.Color;case nt.MATERIAL_ALPHA:return ue.Alpha;case nt.MATERIAL_DEPTH:return ue.Depth;case nt.MATERIAL_NORMAL:return ue.Normal;case nt.MATERIAL_DEPTH_SHADOWMAP_ALL:return ue.Shadow;case nt.MATERIAL_HIGHLIGHT:return ue.Highlight;case nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return ue.Shadow}}const qoe=8;function Xxe(e,t){const i=e.vertex;i.uniforms.add(new lt("intrinsicWidth",r=>r.width)),t.vvSize?(e.attributes.add(D.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new Ut("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Ut("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Ut("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Ut("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(E`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(e.attributes.add(D.SIZE,"float"),i.code.add(E`float getSize(){
return intrinsicWidth * size;
}`)),t.vvOpacity?(e.attributes.add(D.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add([new Aa("vvOpacityValues",r=>r.vvOpacityValues,qoe),new Aa("vvOpacityOpacities",r=>r.vvOpacityOpacities,qoe)]),i.code.add(E`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):i.code.add(E`vec4 applyOpacity( vec4 color ){
return color;
}`),t.vvColor?(e.attributes.add(D.COLORFEATUREATTRIBUTE,"float"),i.constants.add("vvColorNumber","int",Bp),i.uniforms.add(new Aa("vvColorValues",r=>r.vvColorValues,Bp)),i.uniforms.add(new fz("vvColorColors",r=>r.vvColorColors,Bp)),i.code.add(E`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(e.attributes.add(D.COLOR,"vec4"),i.code.add(E`vec4 getColor(){
return applyOpacity(color);
}`))}function A1(e,t){e.fragment.include(Xc),t.output===ue.Shadow?(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(E`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):t.output===ue.Depth&&e.fragment.code.add(E`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}function Ntt(e){return N(e)?vm:e.length===4?e:_r(Ftt,e[0],e[1],e[2],1)}const Ftt=di();function Yxe(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?ktt(e,t):Utt(e)}function ktt(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:r,fragment:s}=e;s.include(Xc),r.uniforms.add(new rr("stipplePatternPixelSize")),t.draped||(Dm(r,t),r.uniforms.add(new lt("worldToScreenPerDistanceRatio",(n,o)=>1/o.camera.perScreenPixelRatio)),r.code.add(E`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),e.varyings.add("vStippleDistance","float"),t.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2"),t.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float"),r.code.add(E`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${ztt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),r.code.add(E`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),r.code.add(E`
    if (segmentLengthPseudoScreen >= ${i?"patternLength":"1e4"}) {
  `),r.uniforms.add(new lt("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(E`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${t.stippleRequiresStretchMeasure?E`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),s.uniforms.add(new as("stipplePatternTexture")),s.uniforms.add(new rr("stipplePatternSDFNormalizer")),s.uniforms.add(new rr("stipplePatternTextureSize")),s.uniforms.add(new rr("stipplePatternPixelSizeInv")),s.code.add(E`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),s.code.add(E`
    float getStippleSDF(out bool isClamped) {
      ${t.stippleRequiresClamp?E`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:E`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${t.stippleScaleWithLineWidth?E`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${t.stippleRequiresStretchMeasure?E`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:E`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${t.stippleScaleWithLineWidth?E`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:E`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),t.stippleOffColorEnabled?(s.uniforms.add(new Ci("stippleOffColor",n=>Ntt(n.stippleOffColor))),s.code.add(E`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):s.code.add(E`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function Utt(e){e.fragment.code.add(E`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}const ztt=E.float(.4);var pd;(function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"})(pd||(pd={}));class fs extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.capType=pd.BUTT,this.transparencyPassType=Pt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}u([ee({count:ue.COUNT})],fs.prototype,"output",void 0),u([ee({count:pd.COUNT})],fs.prototype,"capType",void 0),u([ee({count:Pt.COUNT})],fs.prototype,"transparencyPassType",void 0),u([ee()],fs.prototype,"occluder",void 0),u([ee()],fs.prototype,"hasSlicePlane",void 0),u([ee()],fs.prototype,"hasPolygonOffset",void 0),u([ee()],fs.prototype,"writeDepth",void 0),u([ee()],fs.prototype,"draped",void 0),u([ee()],fs.prototype,"stippleEnabled",void 0),u([ee()],fs.prototype,"stippleOffColorEnabled",void 0),u([ee()],fs.prototype,"stippleScaleWithLineWidth",void 0),u([ee()],fs.prototype,"stipplePreferContinuous",void 0),u([ee()],fs.prototype,"roundJoins",void 0),u([ee()],fs.prototype,"vvSize",void 0),u([ee()],fs.prototype,"vvColor",void 0),u([ee()],fs.prototype,"vvOpacity",void 0),u([ee()],fs.prototype,"falloffEnabled",void 0),u([ee()],fs.prototype,"innerColorEnabled",void 0),u([ee()],fs.prototype,"hasOccludees",void 0),u([ee()],fs.prototype,"hasMultipassTerrain",void 0),u([ee()],fs.prototype,"cullAboveGround",void 0),u([ee()],fs.prototype,"wireframe",void 0),u([ee({constValue:!0})],fs.prototype,"stippleRequiresClamp",void 0),u([ee({constValue:!0})],fs.prototype,"stippleRequiresStretchMeasure",void 0),u([ee({constValue:!0})],fs.prototype,"hasVvInstancing",void 0),u([ee({constValue:!0})],fs.prototype,"hasSliceTranslatedView",void 0);const Y5=1;function Btt(e){const t=new dr,i=e.hasMultipassTerrain&&(e.output===ue.Color||e.output===ue.Alpha);t.include(WU),t.include(Xxe,e),t.include(Yxe,e),e.output===ue.Depth&&t.include(A1,e),Yu(t,e);const{vertex:r,fragment:s}=t;r.uniforms.add([new Hr("inverseProjectionMatrix",(m,g)=>g.camera.inverseProjectionMatrix),new Ni("nearFar",(m,g)=>g.camera.nearFar),new lt("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new Ci("viewport",(m,g)=>g.camera.fullViewport)]),r.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(D.POSITION,"vec3"),t.attributes.add(D.SUBDIVISIONFACTOR,"float"),t.attributes.add(D.UV0,"vec2"),t.attributes.add(D.AUXPOS1,"vec3"),t.attributes.add(D.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float");const n=e.capType===pd.ROUND,o=e.stippleEnabled&&e.stippleScaleWithLineWidth||n;o&&t.varyings.add("vLineWidth","float");const a=e.stippleEnabled&&e.stippleScaleWithLineWidth;a&&t.varyings.add("vLineSizeInv","float");const l=e.innerColorEnabled||n;l&&t.varyings.add("vLineDistance","float");const c=e.stippleEnabled&&n,h=e.falloffEnabled||c;h&&t.varyings.add("vLineDistanceNorm","float"),n&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),r.code.add(E`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(E`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(E`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${i?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),r.uniforms.add(new lt("pixelRatio",(m,g)=>g.camera.pixelRatio)),r.code.add(E`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${o?E`vLineWidth = lineWidth;`:""}
      ${a?E`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(e.stippleEnabled||n)&&r.code.add(E`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${n?E`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(E`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),e.roundJoins?r.code.add(E`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${e.stippleEnabled?E`min(1.0, subdivisionFactor * ${E.float((Y5+2)/(Y5+1))})`:E`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(E`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const p=e.capType!==pd.BUTT;return r.code.add(E`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p?E`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(E`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||l?E`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${l?E`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?E`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),n&&r.code.add(E`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),e.stippleEnabled&&(e.draped?r.uniforms.add(new lt("worldToScreenRatio",(m,g)=>1/g.screenToPCSRatio)):r.code.add(E`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(E`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),e.draped?r.code.add(E`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(E`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.code.add(E`
      float patternLength = ${e.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(E`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),i&&t.include(oh,e),t.include(Ns,e),s.include(Wm),s.code.add(E`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),e.wireframe?s.code.add(E`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(n&&s.code.add(E`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${E.float(la)}) {
        discard;
      }
    `),c?s.code.add(E`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${E.float(la)}, stippleCoverage);
      `):s.code.add(E`float stippleAlpha = getStippleAlpha();`),s.uniforms.add(new Ci("intrinsicColor",m=>m.color)),s.code.add(E`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),e.innerColorEnabled&&(s.uniforms.add(new Ci("innerColor",m=>$t(m.innerColor,m.color))),s.uniforms.add(new lt("innerWidth",(m,g)=>m.innerWidth*g.camera.pixelRatio)),s.code.add(E`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),s.code.add(E`vec4 finalColor = blendStipple(color, stippleAlpha);`),e.falloffEnabled&&(s.uniforms.add(new lt("falloff",m=>m.falloff)),s.code.add(E`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),s.code.add(E`
    if (finalColor.a < ${E.float(la)}) {
      discard;
    }

    ${e.output===ue.Alpha?E`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===ue.Color?E`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===ue.Color&&e.transparencyPassType===Pt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===ue.Highlight?E`gl_FragColor = vec4(1.0);`:""}
    ${e.output===ue.Depth?E`outputDepth(linearDepth);`:""}
  }
  `),t}const Vtt=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:Y5,build:Btt},Symbol.toStringTag,{value:"Module"})),OJ={func:kr.LESS},Q5={func:kr.ALWAYS},Fm={mask:255},Qxe={mask:0},Gtt=e=>({function:{func:kr.NOTEQUAL,ref:e,mask:e},operation:{fail:Es.KEEP,zFail:Es.KEEP,zPass:Es.KEEP}}),jtt=e=>({function:{func:kr.ALWAYS,ref:e,mask:e},operation:{fail:Es.KEEP,zFail:Es.KEEP,zPass:Es.REPLACE}}),O1={function:{func:kr.ALWAYS,ref:Wl.OutlineVisualElementMask,mask:Wl.OutlineVisualElementMask},operation:{fail:Es.KEEP,zFail:Es.KEEP,zPass:Es.ZERO}},y1={function:{func:kr.ALWAYS,ref:Wl.OutlineVisualElementMask,mask:Wl.OutlineVisualElementMask},operation:{fail:Es.KEEP,zFail:Es.KEEP,zPass:Es.REPLACE}},Jxe={function:{func:kr.EQUAL,ref:Wl.OutlineVisualElementMask,mask:Wl.OutlineVisualElementMask},operation:{fail:Es.KEEP,zFail:Es.KEEP,zPass:Es.KEEP}},Kxe={function:{func:kr.NOTEQUAL,ref:Wl.OutlineVisualElementMask,mask:Wl.OutlineVisualElementMask},operation:{fail:Es.KEEP,zFail:Es.KEEP,zPass:Es.KEEP}},eTe=new Map([[D.POSITION,0],[D.SUBDIVISIONFACTOR,1],[D.UV0,2],[D.AUXPOS1,3],[D.AUXPOS2,4],[D.COLOR,5],[D.COLORFEATUREATTRIBUTE,5],[D.SIZE,6],[D.SIZEFEATUREATTRIBUTE,6],[D.OPACITYFEATUREATTRIBUTE,7]]);class Cz extends $r{constructor(t,i,r){super(t,i,r),this.stippleTextureRepository=t.stippleTextureRepository}initializeProgram(t){const i=Cz.shader.get().build(this.configuration);return new Sr(t.rctx,i,eTe)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.configuration.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=w(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}_makePipelineState(t,i){const r=this.configuration,s=t===Pt.NONE,n=t===Pt.FrontFace;return ni({blending:r.output===ue.Color||r.output===ue.Alpha?s?Qu:p0(t):null,depthTest:{func:C1(t)},depthWrite:s?r.writeDepth&&ec:mz(t),colorWrite:wi,stencilWrite:r.hasOccludees?Fm:null,stencilTest:r.hasOccludees?i?y1:O1:null,polygonOffset:s||n?r.hasPolygonOffset&&Woe:yz})}initializePipeline(){const t=this.configuration;if(t.occluder){const i=t.hasPolygonOffset&&Woe;this._occluderPipelineTransparent=ni({blending:Qu,polygonOffset:i,depthTest:Q5,depthWrite:null,colorWrite:wi,stencilWrite:null,stencilTest:Kxe}),this._occluderPipelineOpaque=ni({blending:Qu,polygonOffset:i,depthTest:Q5,depthWrite:null,colorWrite:wi,stencilWrite:Qxe,stencilTest:Jxe}),this._occluderPipelineMaskWrite=ni({blending:null,polygonOffset:i,depthTest:OJ,depthWrite:null,colorWrite:null,stencilWrite:Fm,stencilTest:y1})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Yt.LINES:Yt.TRIANGLE_STRIP}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ue.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ue.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}Cz.shader=new Tr(Vtt,()=>_e(()=>import("./RibbonLine.glsl.94d4061c.js"),[],import.meta.url));const Woe={factor:0,units:-4},Htt=Ie.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var bc;(function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(bc||(bc={}));class Z2 extends Xm{constructor(t){super(t,new Wtt),this._vertexAttributeLocations=eTe,this.techniqueConfig=new fs,this.layout=this.createLayout()}isClosed(t,i){return tTe(this.parameters,t,i)}getConfiguration(t,i){this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Ue.DRAPED_MATERIAL;const r=w(this.parameters.stipplePattern)&&t!==ue.Highlight;return this.techniqueConfig.stippleEnabled=r,this.techniqueConfig.stippleOffColorEnabled=r&&w(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=r&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=r&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins=this.parameters.join==="round",this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&w(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===ts.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){w(c)?this._intersectDrapedLineGeometry(t,s,c,o,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectDrapedLineGeometry(t,i,r,s,n){if(!i.options.selectionMode)return;const o=t.vertexAttributes.get(D.POSITION).data,a=t.vertexAttributes.get(D.SIZE);let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const v=t.vertexAttributes.get(D.SIZEFEATUREATTRIBUTE).data[0];l*=Xe(this.parameters.vvSizeOffset[0]+v*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else a&&(l*=a.data[0]);const c=s[0],h=s[1],p=(l/2+4)*t.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let v=0;v<o.length-5;v+=3){const b=o[v],S=o[v+1],T=c-b,O=h-S,C=o[v+3]-b,M=o[v+4]-S,I=Xe((C*T+M*O)/(C*C+M*M),0,1),$=C*I-T,U=M*I-O,q=$*$+U*U;q<m&&(m=q,g=v/3)}m<p*p&&n(r.dist,r.normal,g,!1)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||hI(i))return;if(!hbe(r))return void Htt.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes,a=o.get(D.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSizeEnabled){const T=o.get(D.SIZEFEATUREATTRIBUTE).data[0];l*=Xe(this.parameters.vvSizeOffset[0]+T*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else o.has(D.SIZE)&&(l*=o.get(D.SIZE).data[0]);const c=s.camera,h=Xtt;zo(h,s.point);const p=l*c.pixelRatio/2+4*c.pixelRatio;fe(_O[0],h[0]-p,h[1]+p,0),fe(_O[1],h[0]+p,h[1]+p,0),fe(_O[2],h[0]+p,h[1]-p,0),fe(_O[3],h[0]-p,h[1]-p,0);for(let T=0;T<4;T++)if(!c.unprojectFromRenderScreen(_O[T],xg[T]))return;Ea(c.eye,xg[0],xg[1],A8),Ea(c.eye,xg[1],xg[2],O8),Ea(c.eye,xg[2],xg[3],R8),Ea(c.eye,xg[3],xg[0],M8);let m=Number.MAX_VALUE,g=0;const v=uW(this.parameters,o,t.indices)?a.length-2:a.length-5;for(let T=0;T<v;T+=3){vl[0]=a[T]+r[12],vl[1]=a[T+1]+r[13],vl[2]=a[T+2]+r[14];const O=(T+3)%a.length;if(bl[0]=a[O]+r[12],bl[1]=a[O+1]+r[13],bl[2]=a[O+2]+r[14],Or(A8,vl)<0&&Or(A8,bl)<0||Or(O8,vl)<0&&Or(O8,bl)<0||Or(R8,vl)<0&&Or(R8,bl)<0||Or(M8,vl)<0&&Or(M8,bl)<0)continue;if(c.projectToRenderScreen(vl,ab),c.projectToRenderScreen(bl,lb),ab[2]<0&&lb[2]>0){Me(yf,vl,bl);const M=c.frustum,I=-Or(M[Ar.NEAR],vl)/ke(yf,M[Ar.NEAR]);be(yf,yf,I),Oe(vl,vl,yf),c.projectToRenderScreen(vl,ab)}else if(ab[2]>0&&lb[2]<0){Me(yf,bl,vl);const M=c.frustum,I=-Or(M[Ar.NEAR],bl)/ke(yf,M[Ar.NEAR]);be(yf,yf,I),Oe(bl,bl,yf),c.projectToRenderScreen(bl,lb)}else if(ab[2]<0&&lb[2]<0)continue;ab[2]=0,lb[2]=0;const C=DX(hx(ab,lb,Yoe),h);C<m&&(m=C,ve(Zoe,vl),ve(Xoe,bl),g=T/3)}const b=s.rayBegin,S=s.rayEnd;if(m<p*p){let T=Number.MAX_VALUE;if(Kme(hx(Zoe,Xoe,Yoe),hx(b,S,Ytt),ob)){Me(ob,ob,b);const O=He(ob);be(ob,ob,1/O),T=O/Pr(b,S)}n(T,ob,g,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=t.indices,n=r.get(D.POSITION);return $Q(n,s?s.get(D.POSITION):null,s&&uW(this.parameters,r,s),i)}createLayout(){const t=As().vec3f(D.POSITION).f32(D.SUBDIVISIONFACTOR).vec2f(D.UV0).vec3f(D.AUXPOS1).vec3f(D.AUXPOS2);return this.parameters.vvSizeEnabled?t.f32(D.SIZEFEATUREATTRIBUTE):t.f32(D.SIZE),this.parameters.vvColorEnabled?t.f32(D.COLORFEATUREATTRIBUTE):t.vec4f(D.COLOR),this.parameters.vvOpacityEnabled&&t.f32(D.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new Ztt(this.layout,this.parameters)}requiresSlot(t,i){if(t===Ue.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===ts.OccludeAndTransparentStencil)return t===Ue.OPAQUE_MATERIAL||t===Ue.OCCLUDER_MATERIAL||t===Ue.TRANSPARENT_OCCLUDER_MATERIAL;const r=Kx(i);return r===ue.Color||r===ue.Alpha?t===(this.parameters.writeDepth?Ue.TRANSPARENT_MATERIAL:Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ue.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Alpha||t.output===ue.Highlight||t.output===ue.Depth?new qtt(t):null}validateParameters(t){t.join!=="miter"&&(t.miterLimit=0)}}class qtt extends S1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==ue.Color&&this._output!==ue.Alpha||this._updateOccludeeState(t),this.ensureTechnique(Cz,t)}}class Wtt extends fJ{constructor(){super(...arguments),this.width=0,this.color=od,this.join="miter",this.cap=pd.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class Ztt{constructor(t,i){this.parameters=i,this.numJoinSubdivisions=0,this.vertexBufferLayout=t;const r=i.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=r;break;case"round":this.numJoinSubdivisions=Y5+r}}_isClosed(t){return uW(this.parameters,t.vertexAttributes,t.indices)}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){const r=t.indices.get(D.POSITION).length/2+1,s=this._isClosed(t);let n=s?2:2*2;return n+=((s?r:r-1)-(s?0:1))*(2*this.numJoinSubdivisions+4),n+=2,this.parameters.wireframe&&(n=2+4*(n-2)),n}write(t,i,r,s){var X;const n=Qtt,o=Jtt,a=Ktt,l=i.vertexAttributes.get(D.POSITION).data,c=i.indices&&i.indices.get(D.POSITION),h=(X=i.vertexAttributes.get(D.DISTANCETOSTART))==null?void 0:X.data;c&&c.length!==2*(l.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let p=1,m=0;this.parameters.vvSizeEnabled?m=i.vertexAttributes.get(D.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(D.SIZE)&&(p=i.vertexAttributes.get(D.SIZE).data[0]);let g=[1,1,1,1],v=0;this.parameters.vvColorEnabled?v=i.vertexAttributes.get(D.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(D.COLOR)&&(g=i.vertexAttributes.get(D.COLOR).data);let b=0;this.parameters.vvOpacityEnabled&&(b=i.vertexAttributes.get(D.OPACITYFEATUREATTRIBUTE).data[0]);const S=l.length/3,T=t.transformation,O=new Float32Array(r.buffer),C=this.vertexBufferLayout.stride/4;let M=s*C;const I=M;let $=0;const U=h?(ne,re,ye)=>$=h[ye]:(ne,re,ye)=>$+=Pr(ne,re),q=(ne,re,ye,pe,z,j,Q)=>{if(O[M++]=re[0],O[M++]=re[1],O[M++]=re[2],O[M++]=pe,O[M++]=Q,O[M++]=z,O[M++]=ne[0],O[M++]=ne[1],O[M++]=ne[2],O[M++]=ye[0],O[M++]=ye[1],O[M++]=ye[2],this.parameters.vvSizeEnabled?O[M++]=m:O[M++]=p,this.parameters.vvColorEnabled)O[M++]=v;else{const Z=Math.min(4*j,g.length-4);O[M++]=g[Z+0],O[M++]=g[Z+1],O[M++]=g[Z+2],O[M++]=g[Z+3]}this.parameters.vvOpacityEnabled&&(O[M++]=b)};M+=C,fe(o,l[0],l[1],l[2]),T&&et(o,o,T);const G=this._isClosed(i);if(G){const ne=l.length-3;fe(n,l[ne],l[ne+1],l[ne+2]),T&&et(n,n,T)}else fe(a,l[3],l[4],l[5]),T&&et(a,a,T),q(o,o,a,1,bc.LEFT_CAP_START,0,0),q(o,o,a,1,bc.RIGHT_CAP_START,0,0),ve(n,o),ve(o,a);const Y=G?0:1,J=G?S:S-1;for(let ne=Y;ne<J;ne++){const re=(ne+1)%S*3;fe(a,l[re+0],l[re+1],l[re+2]),T&&et(a,a,T),U(n,o,ne),q(n,o,a,0,bc.LEFT_JOIN_END,ne,$),q(n,o,a,0,bc.RIGHT_JOIN_END,ne,$);const ye=this.numJoinSubdivisions;for(let pe=0;pe<ye;++pe){const z=(pe+1)/(ye+1);q(n,o,a,z,bc.LEFT_JOIN_END,ne,$),q(n,o,a,z,bc.RIGHT_JOIN_END,ne,$)}q(n,o,a,1,bc.LEFT_JOIN_START,ne,$),q(n,o,a,1,bc.RIGHT_JOIN_START,ne,$),ve(n,o),ve(o,a)}G?(fe(a,l[3],l[4],l[5]),T&&et(a,a,T),$=U(n,o,J),q(n,o,a,0,bc.LEFT_JOIN_END,Y,$),q(n,o,a,0,bc.RIGHT_JOIN_END,Y,$)):($=U(n,o,J),q(n,o,o,0,bc.LEFT_CAP_END,J,$),q(n,o,o,0,bc.RIGHT_CAP_END,J,$)),C8(O,I+C,O,I,C),M=C8(O,M-C,O,M,C),this.parameters.wireframe&&this._addWireframeVertices(r,I,M,C)}_addWireframeVertices(t,i,r,s){const n=new Float32Array(t.buffer,r*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(t.buffer,i*Float32Array.BYTES_PER_ELEMENT,r-i);let a=0;const l=c=>a=C8(o,c,n,a,s);for(let c=0;c<o.length-1;c+=2*s)l(c),l(c+2*s),l(c+1*s),l(c+2*s),l(c+1*s),l(c+3*s)}}function C8(e,t,i,r,s){for(let n=0;n<s;n++)i[r++]=e[t++];return r}function uW(e,t,i){return tTe(e,t.get(D.POSITION).data,i?i.get(D.POSITION):null)}function tTe(e,t,i){return!!e.isClosed&&(i?i.length>2:t.length>6)}const vl=F(),bl=F(),yf=F(),ob=F(),Xtt=F(),ab=sa(),lb=sa(),Zoe=F(),Xoe=F(),Yoe=Gm(),Ytt=Gm(),Qtt=F(),Jtt=F(),Ktt=F(),_O=[sa(),sa(),sa(),sa()],xg=[F(),F(),F(),F()],A8=Vi(),O8=Vi(),R8=Vi(),M8=Vi();class RJ{constructor(t,i=125e4){this._originSR=t,this._gridSize=i,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+Gl()}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(i==null){const h=Rtt.rootOrigin;if(w(h))return this._origins.set(this._rootOriginId,qM(h[0],h[1],h[2],this._rootOriginId)),this.getOrigin(t);const p=qM(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,p),p}const r=this._gridSize,s=Math.round(t[0]/r),n=Math.round(t[1]/r),o=Math.round(t[2]/r),a=`${s}/${n}/${o}`;let l=this._origins.get(a);const c=.5*r;if(Me(go,t,i.vec3),go[0]=Math.abs(go[0]),go[1]=Math.abs(go[1]),go[2]=Math.abs(go[2]),go[0]<c&&go[1]<c&&go[2]<c){if(l){const h=Math.max(...go);if(Me(go,t,l.vec3),go[0]=Math.abs(go[0]),go[1]=Math.abs(go[1]),go[2]=Math.abs(go[2]),Math.max(...go)<h)return l}return i}return l||(l=qM(s*r,n*r,o*r,a),this._origins.set(a,l)),l}_drawOriginBox(t,i=ki(1,1,0,1)){const r=window.view,s=r._stage,n=i.toString();if(!this._objects.has(n)){this._material=new Z2({width:2,color:i}),s.add(this._material);const g=new Wxe({isPickable:!1}),v=new m0({castShadow:!1});s.add(v),g.add(v),s.add(g),this._objects.set(n,v)}const o=this._objects.get(n),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),h=new Uint16Array(2*(l-1)),p=.5*this._gridSize;for(let g=0;g<l;g++)c[3*g+0]=t[0]+(1&a[g]?p:-p),c[3*g+1]=t[1]+(2&a[g]?p:-p),c[3*g+2]=t[2]+(4&a[g]?p:-p),g>0&&(h[2*g+0]=g-1,h[2*g+1]=g);Lr(c,this._originSR,0,c,r.renderSpatialReference,0,l);const m=new ss([[D.POSITION,{size:3,data:c,exclusive:!0}]],[[D.POSITION,h]],Zl.Line);s.add(m),o.addGeometry(m,this._material,Dn)}}const go=F();class iTe{constructor(t,i,r,s=null){this.rctx=t,this.sliceHelper=s,this.lastFrameCamera=new wr,this.pass=nt.MATERIAL,this.renderOccludedMask=Qoe,this.bindParameters=new JU(i,r,w(s)?s.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=Qoe}get isHighlightPass(){return this.pass===nt.MATERIAL_HIGHLIGHT}}class eit extends iTe{constructor(t,i,r,s,n){super(t,r,s,n),this.offscreenRenderingHelper=i,this.sliceHelper=n}}const Qoe=ts.Occlude|ts.OccludeAndTransparent|ts.OccludeAndTransparentStencil;var AC;(function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"})(AC||(AC={}));class q${constructor(){this.camera=new wr,this.lightMat=Be()}}class MJ{constructor(t,i,r=0){this.rctx=t,this.viewingMode=i,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=di(),this._cascades=[new q$,new q$,new q$,new q$],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=r}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return _r(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(t){this.maxNumCascades=Xe(Math.floor(t),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(t){this._enabled=t,t||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&w(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(t){const i=this._snapshots.length;if(t>i){const r=t-i;this._snapshots.length=t;for(let s=0;s<r;++s)this._snapshots[i+s]=null}else if(t<this.snapshotCount){const r=i-t;for(let s=0;s<r;++s)this._discardSnapshot(t+s);this._snapshots.length=t}}getSnapshot(t){return this.enabled?this._snapshots[t]:null}getCascades(){for(let t=0;t<this.numCascades;++t)I8[t]=this._cascades[t];return I8.length=this.numCascades,I8}start(t,i,r){At(this.enabled),this._textureSize=this._computeTextureSize(t.fullWidth,t.fullHeight),this._ensureDepthTexture();const{near:s,far:n}=this._clampNearFar(r);this._computeCascadeDistances(n,s),this._setupMatrices(t,i);const o=t.viewMatrix,a=t.projectionMatrix;for(let l=0;l<this.numCascades;++l)this._constructCascade(l,a,o,i);this.lastOrigin=null,this.clear()}finish(t){At(this.enabled),this.rctx.bindFramebuffer(t)}getShadowMapMatrices(t){if(!this.lastOrigin||!zl(t,this.lastOrigin)){this.lastOrigin=this.lastOrigin||F(),ve(this.lastOrigin,t);for(let i=0;i<this.numCascades;++i){hl(aae,this._cascades[i].lightMat,t);for(let r=0;r<16;++r)lae[16*i+r]=aae[r]}}return lae}takeCascadeSnapshotTo(t,i){At(this.enabled);const r=this._ensureSnapshot(i);this._bindFbo();const s=this.rctx,n=s.bindTexture(r,bt.TEXTURE_UNIT_FOR_UPDATES);s.gl.copyTexSubImage2D(Ot.TEXTURE_2D,0,t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[0],t.camera.viewport[1],t.camera.viewport[2],t.camera.viewport[3]),s.bindTexture(n,bt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const t=this.rctx;this._bindFbo(),t.setClearColor(1,1,1,1),t.clearSafe(br.COLOR_BUFFER_BIT|br.DEPTH_BUFFER_BIT)}_computeTextureSize(t,i){const r=.5*Math.log(t*t+i*i)*Math.LOG2E,s=.35,n=2**Math.round(r+s);return Math.min(this.maxTextureSize,2*n)}_ensureDepthTexture(){if(w(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize)return;this._discardDepthTexture();const t={target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};this._depthTexture=new bt(this.rctx,t),this._fbo=new Xr(this.rctx,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture)}_ensureSnapshot(t){let i=this._snapshots[t];if(w(i)&&i.descriptor.width===this._textureSize)return i;this._discardSnapshot(t);const r={target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize};return i=new bt(this.rctx,r),this._snapshots[t]=i,i}_discardDepthTexture(){this._fbo=ht(this._fbo),this._depthTexture=ht(this._depthTexture)}_discardSnapshot(t){this._snapshots[t]=ht(this._snapshots[t])}_discardAllSnapshots(){for(let t=0;t<this.snapshotCount;++t)this._discardSnapshot(t)}_bindFbo(){const t=this.rctx;t.unbindTexture(this._depthTexture),t.bindFramebuffer(this._fbo)}_constructCascade(t,i,r,s){const n=this._cascades[t],o=-this._cascadeDistances[t],a=-this._cascadeDistances[t+1],l=(i[10]*o+i[14])/Math.abs(i[11]*o+i[15]),c=(i[10]*a+i[14])/Math.abs(i[11]*a+i[15]);At(l<c);for(let p=0;p<8;++p){_r(tae,p%4==0||p%4==3?-1:1,p%4==0||p%4==1?-1:1,p<4?l:c,1),zu(yc[p],tae,eae);for(let m=0;m<3;++m)yc[p][m]/=yc[p][3]}Ra(P8,yc[0]),hl(Joe,oae,P8),n.camera.viewMatrix=Joe;for(let p=0;p<8;++p)et(yc[p],yc[p],n.camera.viewMatrix);ve(_f,yc[0]),ve(vf,yc[0]);for(let p=1;p<8;++p)for(let m=0;m<3;++m)_f[m]=Math.min(_f[m],yc[p][m]),vf[m]=Math.max(vf[m],yc[p][m]);_f[2]-=200,vf[2]+=200,n.camera.near=-vf[2],n.camera.far=-_f[2],this.warp?this._constructTrapezoidalProjection(r,s,n):this._constructOrthogonalProjection(n),hs(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureSize/2;n.camera.viewport[0]=t%2==0?0:h,n.camera.viewport[1]=Math.floor(t/2)===0?0:h,n.camera.viewport[2]=h,n.camera.viewport[3]=h}_constructOrthogonalProjection(t){wX(t.camera.projectionMatrix,_f[0],vf[0],_f[1],vf[1],t.camera.near,t.camera.far)}_constructTrapezoidalProjection(t,i,r){const s=1/yc[0][3],n=1/yc[4][3];At(s<n);let o=s+Math.sqrt(s*n);const a=Math.sin(Fn(t[2]*i[0]+t[6]*i[1]+t[10]*i[2]));o/=a,iit(yc,o,a,iae,rae,tit,sae,nae),rit(iae,rae,sae,nae,r.camera.projectionMatrix),r.camera.projectionMatrix[10]=2/(_f[2]-vf[2]),r.camera.projectionMatrix[14]=-(_f[2]+vf[2])/(_f[2]-vf[2])}_setupMatrices(t,i){hs(Koe,t.projectionMatrix,t.viewMatrix),Fs(eae,Koe);const r=this.viewingMode===st.Global?t.eye:fe(P8,0,0,1);oU(oae,[0,0,0],[-i[0],-i[1],-i[2]],r)}_clampNearFar(t){let{near:i,far:r}=t;return i<2&&(i=2),r<2&&(r=2),i>=r&&(i=2,r=4),{near:i,far:r}}_computeCascadeDistances(t,i){this.numCascades=Math.min(1+Math.floor(EWe(t/i,4)),this.maxNumCascades);const r=(t-i)/this.numCascades,s=(t/i)**(1/this.numCascades);let n=i,o=i;for(let a=0;a<this.numCascades+1;++a)this._cascadeDistances[a]=fi(n,o,this.splitSchemeLambda),n*=s,o+=r}get gpuMemoryUsage(){var t,i;return this._snapshots.reduce((r,s)=>r+Bx(s),(i=(t=this._fbo)==null?void 0:t.gpuMemoryUsage)!=null?i:0)}get test(){const t=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(i){t.splitSchemeLambda=i},get splitSchemeLambda(){return t.splitSchemeLambda},set warp(i){t.warp=i},get warp(){return t.warp}}}}const Joe=Be(),Koe=Be(),eae=Be(),tae=di(),yc=[];for(let e=0;e<8;++e)yc.push(di());const _f=F(),vf=F(),iae=yt(),rae=yt(),tit=yt(),sae=yt(),nae=yt(),oae=Be(),P8=F(),I8=[],aae=Be(),lae=new Float32Array(64),nu=yt(),oS=yt(),cb=[yt(),yt(),yt(),yt()],Bn=yt(),L8=yt(),Y0=yt(),vO=yt(),aS=yt(),lS=yt(),W$=yt();function iit(e,t,i,r,s,n,o,a){Di(nu,0,0);for(let I=0;I<4;++I)yp(nu,nu,e[I]);Ic(nu,nu,.25),Di(oS,0,0);for(let I=4;I<8;++I)yp(oS,oS,e[I]);Ic(oS,oS,.25),_2(cb[0],e[4],e[5],.5),_2(cb[1],e[5],e[6],.5),_2(cb[2],e[6],e[7],.5),_2(cb[3],e[7],e[4],.5);let l=0,c=v5(cb[0],nu);for(let I=1;I<4;++I){const $=v5(cb[I],nu);$<c&&(c=$,l=I)}um(Bn,cb[l],e[l+4]);const h=Bn[0];let p,m;Bn[0]=-Bn[1],Bn[1]=h,um(L8,oS,nu),xn(L8,Bn)<0&&lQ(Bn,Bn),_2(Bn,Bn,L8,i),UP(Bn,Bn),p=m=xn(um(Y0,e[0],nu),Bn);for(let I=1;I<8;++I){const $=xn(um(Y0,e[I],nu),Bn);$<p?p=$:$>m&&(m=$)}zo(r,nu),Ic(Y0,Bn,p-t),yp(r,r,Y0);let g=-1,v=1,b=0,S=0;for(let I=0;I<8;++I){um(vO,e[I],r),UP(vO,vO);const $=Bn[0]*vO[1]-Bn[1]*vO[0];$>0?$>g&&(g=$,b=I):$<v&&(v=$,S=I)}XT(g>0,"leftArea"),XT(v<0,"rightArea"),Ic(aS,Bn,p),yp(aS,aS,nu),Ic(lS,Bn,m),yp(lS,lS,nu),W$[0]=-Bn[1],W$[1]=Bn[0];const T=h$(r,e[S],lS,yp(Y0,lS,W$),1,s),O=h$(r,e[b],lS,Y0,1,n),C=h$(r,e[b],aS,yp(Y0,aS,W$),1,o),M=h$(r,e[S],aS,Y0,1,a);XT(T,"rayRay"),XT(O,"rayRay"),XT(C,"rayRay"),XT(M,"rayRay")}function Ii(e,t){return 3*t+e}const cae=yt();function oc(e,t){return Di(cae,e[t],e[t+3]),cae}const wl=yt(),pt=Qr();function rit(e,t,i,r,s){um(wl,i,r),Ic(wl,wl,.5),pt[0]=wl[0],pt[1]=wl[1],pt[2]=0,pt[3]=wl[1],pt[4]=-wl[0],pt[5]=0,pt[6]=wl[0]*wl[0]+wl[1]*wl[1],pt[7]=wl[0]*wl[1]-wl[1]*wl[0],pt[8]=1,pt[Ii(0,2)]=-xn(oc(pt,0),e),pt[Ii(1,2)]=-xn(oc(pt,1),e);let n=xn(oc(pt,0),i)+pt[Ii(0,2)],o=xn(oc(pt,1),i)+pt[Ii(1,2)],a=xn(oc(pt,0),r)+pt[Ii(0,2)],l=xn(oc(pt,1),r)+pt[Ii(1,2)];n=-(n+a)/(o+l),pt[Ii(0,0)]+=pt[Ii(1,0)]*n,pt[Ii(0,1)]+=pt[Ii(1,1)]*n,pt[Ii(0,2)]+=pt[Ii(1,2)]*n,n=1/(xn(oc(pt,0),i)+pt[Ii(0,2)]),o=1/(xn(oc(pt,1),i)+pt[Ii(1,2)]),pt[Ii(0,0)]*=n,pt[Ii(0,1)]*=n,pt[Ii(0,2)]*=n,pt[Ii(1,0)]*=o,pt[Ii(1,1)]*=o,pt[Ii(1,2)]*=o,pt[Ii(2,0)]=pt[Ii(1,0)],pt[Ii(2,1)]=pt[Ii(1,1)],pt[Ii(2,2)]=pt[Ii(1,2)],pt[Ii(1,2)]+=1,n=xn(oc(pt,1),t)+pt[Ii(1,2)],o=xn(oc(pt,2),t)+pt[Ii(2,2)],a=xn(oc(pt,1),i)+pt[Ii(1,2)],l=xn(oc(pt,2),i)+pt[Ii(2,2)],n=-.5*(n/o+a/l),pt[Ii(1,0)]+=pt[Ii(2,0)]*n,pt[Ii(1,1)]+=pt[Ii(2,1)]*n,pt[Ii(1,2)]+=pt[Ii(2,2)]*n,n=xn(oc(pt,1),t)+pt[Ii(1,2)],o=xn(oc(pt,2),t)+pt[Ii(2,2)],a=-o/n,pt[Ii(1,0)]*=a,pt[Ii(1,1)]*=a,pt[Ii(1,2)]*=a,s[0]=pt[0],s[1]=pt[1],s[2]=0,s[3]=pt[2],s[4]=pt[3],s[5]=pt[4],s[6]=0,s[7]=pt[5],s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=pt[6],s[13]=pt[7],s[14]=0,s[15]=pt[8]}class rTe{constructor(){this.adds=new hi,this.removes=new hi,this.updates=new hi({allocator:t=>t||new sit,deallocator:t=>(t.renderGeometry=null,t)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class sit{}class nit{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var vi;(function(e){var t,i;(t=e.Geometry||(e.Geometry={}))[t.ADD=1]="ADD",t[t.UPDATE=2]="UPDATE",t[t.REMOVE=4]="REMOVE",(i=e.State||(e.State={}))[i.VISIBILITIES=1]="VISIBILITIES",i[i.VERTEXATTRS=2]="VERTEXATTRS",i[i.TRANSFORMATION=4]="TRANSFORMATION",i[i.HIGHLIGHTS=8]="HIGHLIGHTS",i[i.OCCLUDEES=16]="OCCLUDEES"})(vi||(vi={}));function sTe(e){const t=new Map,i=r=>{let s=t.get(r);return s||(s=new nit,t.set(r,s)),s};return e.removes.forAll(r=>{$8(r)&&i(r.material).removes.push(r)}),e.adds.forAll(r=>{$8(r)&&i(r.material).adds.push(r)}),e.updates.forAll(r=>{$8(r.renderGeometry)&&i(r.renderGeometry.material).updates.push(r)}),t}function $8(e){return e.data.indexCount>=1}function oit(e){const t=E`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;e.fragment.code.add(t),e.vertex.code.add(t)}function Az(e,t){t.normalType===Yr.Attribute&&(e.attributes.add(D.NORMAL,"vec3"),e.vertex.code.add(E`vec3 normalModel() {
return normal;
}`)),t.normalType===Yr.CompressedAttribute&&(e.include(oit),e.attributes.add(D.NORMALCOMPRESSED,"vec2"),e.vertex.code.add(E`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),t.normalType===Yr.ScreenDerivative&&(e.extensions.add("GL_OES_standard_derivatives"),e.fragment.code.add(E`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}var Yr;(function(e){e[e.Attribute=0]="Attribute",e[e.CompressedAttribute=1]="CompressedAttribute",e[e.Ground=2]="Ground",e[e.ScreenDerivative=3]="ScreenDerivative",e[e.COUNT=4]="COUNT"})(Yr||(Yr={}));function Oz(e){e.attributes.add(D.POSITION,"vec3"),e.vertex.code.add(E`vec3 positionModel() { return position; }`)}function J5({code:e},t){t.doublePrecisionRequiresObfuscation?e.add(E`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):e.add(E`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function xI(e){return!!Ce("force-double-precision-obfuscation")||e.driverTest.doublePrecisionRequiresObfuscation}function gE(e,t){e.include(Oz);const i=e.vertex;i.include(J5,t),e.varyings.add("vPositionWorldCameraRelative","vec3"),e.varyings.add("vPosition_view","vec3"),i.uniforms.add([new Ut("transformWorldFromViewTH",r=>r.transformWorldFromViewTH),new Ut("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new gI("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new Hr("transformProjFromView",r=>r.transformProjFromView),new jP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new al("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new al("transformWorldFromModelTL",r=>r.transformWorldFromModelTL)]),i.code.add(E`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(E`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?E`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:E`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),e.fragment.uniforms.add(new Ut("transformWorldFromViewTL",r=>r.transformWorldFromViewTL)),i.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),e.fragment.code.add(E`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class nTe extends mn{constructor(){super(...arguments),this.transformWorldFromViewTH=F(),this.transformWorldFromViewTL=F(),this.transformViewFromCameraRelativeRS=Qr(),this.transformProjFromView=Be()}}class oTe extends mn{constructor(){super(...arguments),this.transformWorldFromModelRS=Qr(),this.transformWorldFromModelTH=Wi(),this.transformWorldFromModelTL=Wi()}}function Rz(e,t){t.normalType===Yr.Attribute||t.normalType===Yr.CompressedAttribute?(e.include(Az,t),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add([new jP("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel),new gI("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal)]),e.vertex.code.add(E`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):t.normalType===Yr.Ground?(e.include(gE,t),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(E`
    void forwardNormal() {
      vNormalWorld = ${t.spherical?E`normalize(vPositionWorldCameraRelative);`:E`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(E`void forwardNormal() {}`)}class aTe extends nTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Qr()}}class lTe extends oTe{constructor(){super(...arguments),this.transformNormalGlobalFromModel=Qr(),this.toMapSpace=di()}}class hW extends lTe{constructor(t=F()){super(),this.origin=t,this.slicePlaneLocalOrigin=this.origin}}function TI(e,t){t.output===ue.Color&&t.receiveShadows?(e.varyings.add("linearDepth","float"),e.vertex.code.add(E`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):t.output===ue.Depth||t.output===ue.Shadow?(e.include(gE,t),e.varyings.add("linearDepth","float"),e.vertex.uniforms.add(new Ni("nearFar",(i,r)=>r.camera.nearFar)),e.vertex.code.add(E`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):e.vertex.code.add(E`void forwardLinearDepth() {}`)}function $v(e,t){t.spherical?e.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):e.vertex.code.add(E`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),t.spherical?e.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):e.vertex.code.add(E`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}class SI extends vs{constructor(t,i){super(t,"int",nr.Pass,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}class cTe extends vs{constructor(t,i,r,s){switch(i){case nr.Pass:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s);case nr.Draw:return void super(t,"mat4",i,(n,o,a)=>n.setUniformMatrix4fv(t,r(o,a)),s)}}}class uTe extends mn{constructor(){super(...arguments),this.origin=F()}}function Mz(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new cTe("shadowMapMatrix",nr.Pass,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),hTe(e))}function eT(e,t){t.receiveShadows&&(e.fragment.uniforms.add(new cTe("shadowMapMatrix",nr.Draw,(i,r)=>r.shadowMap.getShadowMapMatrices(i.origin),4)),hTe(e))}function hTe(e){const t=e.fragment;t.include(Xc),t.uniforms.add([new ai("shadowMapTex",(i,r)=>r.shadowMap.depthTexture),new SI("numCascades",(i,r)=>r.shadowMap.numCascades),new Ci("cascadeDistances",(i,r)=>r.shadowMap.cascadeDistances),new lt("depthHalfPixelSz",(i,r)=>.5/r.shadowMap.textureSize)]),t.code.add(E`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}function ait(e){e.fragment.code.add(E`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function lit(e){e.fragment.code.add(E`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}function cit(e){const t=e.fragment.code;t.add(E`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),t.add(E`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),t.add(E`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function Pz(e,t){const i=e.fragment.code;e.include(WU),t.pbrMode===Wt.Water||t.pbrMode===Wt.WaterOnIntegratedMesh?(i.add(E`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),i.add(E`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),i.add(E`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),i.add(E`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),i.add(E`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):t.pbrMode!==Wt.Normal&&t.pbrMode!==Wt.Schematic||(e.include(cit),i.add(E`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),i.add(E`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),i.add(E`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),i.add(E`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),i.add(E`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),i.add(E`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function dTe(e,t){e.include(Pz,t),e.include(HU),e.include(lit),t.hasCloudsReflections&&e.include(q1e,t),t.hasScreenSpaceReflections&&e.include(Jqe,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add(E`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),i.uniforms.add([new lt("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new lt("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(E`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),t.hasCloudsReflections&&i.code.add(E`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),t.hasScreenSpaceReflections?i.code.add(E`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):i.code.add(E`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add(E`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):i.code.add(E`return waterRenderedColor;
}`)}function uae(e){e.fragment.uniforms.add(new as("texWaveNormal")),e.fragment.uniforms.add(new as("texWavePerturbation")),e.fragment.uniforms.add([new Ci("waveParams",t=>_r(uit,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new Ni("waveDirection",t=>Di(hit,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]),e.include(ait),e.fragment.code.add(E`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const uit=di(),hit=yt();function dit(e){const t=new dr,{vertex:i,fragment:r}=t,s=Yu(t,e);return t.include(oa),t.attributes.add(D.POSITION,"vec3"),t.attributes.add(D.UV0,"vec2"),i.uniforms.add(new Ci("waterColor",n=>n.color)),e.output!==ue.Color&&e.output!==ue.Alpha||(t.include($v,e),t.include(TI,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),r.uniforms.add(s),e.hasMultipassTerrain&&t.varyings.add("depth","float"),i.code.add(E`
      void main(void) {
        if (waterColor.a < ${E.float(la)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${e.output===ue.Color?"forwardLinearDepth();":""}
      }
    `)),t.include(oh,e),e.output===ue.Alpha&&(t.include(Ns,e),r.uniforms.add(new nl("waterColor")),r.code.add(E`
        void main() {
          discardBySlice(vpos);
          ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),e.output===ue.Color&&(t.include(xQ,{isGround:!1}),t.include(wQ,{pbrMode:Wt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(uae),t.include(Ns,e),t.include(eT,e),t.include(dTe,e),r.uniforms.add([new nl("waterColor"),new Ut("lightingMainDirection",(n,o)=>o.lighting.lightingMainDirection),new Ut("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity),new lt("timeElapsed",n=>n.timeElapsed),new n1("view")]),Dm(r,e),r.include(Wm),r.code.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${e.receiveShadows?E`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===Pt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output===ue.Normal&&(t.include($v,e),t.include(uae,e),t.include(Ns,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.code.add(E`
        void main(void) {
          if (waterColor.a < ${E.float(la)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new lt("timeElapsed",n=>n.timeElapsed)),r.code.add(E`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),e.output===ue.Draped&&(t.varyings.add("vpos","vec3"),i.code.add(E`
        void main(void) {
          if (waterColor.a < ${E.float(la)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),r.uniforms.add(new nl("waterColor")),r.code.add(E`void main() {
gl_FragColor = waterColor;
}`)),e.output===ue.Highlight&&(t.include(d0),t.varyings.add("vpos","vec3"),i.code.add(E`
      void main(void) {
        if (waterColor.a < ${E.float(la)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),t.include(Ns,e),r.code.add(E`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const pit=Object.freeze(Object.defineProperty({__proto__:null,build:dit},Symbol.toStringTag,{value:"Module"}));class Iz extends $r{constructor(t,i,r){super(t,i,r),this._textureRepository=t.waterTextureRepository}initializeConfiguration(t,i){i.spherical=t.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=xI(t.rctx)}initializeProgram(t){const i=Iz.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}bindPass(t,i){this.program.bindPass(t,i),this.configuration.output!==ue.Color&&this.configuration.output!==ue.Normal||this._textureRepository.bind(this.program)}_setPipelineState(t){const i=this.configuration,r=t===Pt.NONE,s=t===Pt.FrontFace;return ni({blending:i.output!==ue.Normal&&i.output!==ue.Highlight&&i.transparent?r?Qu:p0(t):null,depthTest:{func:C1(t)},depthWrite:r?i.writeDepth&&ec:mz(t),colorWrite:wi,polygonOffset:r||s?null:_z(i.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Iz.shader=new Tr(pit,()=>_e(()=>import("./WaterSurface.glsl.0f057c17.js"),[],import.meta.url));class So extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.transparencyPassType=Pt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([ee({count:ue.COUNT})],So.prototype,"output",void 0),u([ee({count:Pt.COUNT})],So.prototype,"transparencyPassType",void 0),u([ee()],So.prototype,"spherical",void 0),u([ee()],So.prototype,"receiveShadows",void 0),u([ee()],So.prototype,"hasSlicePlane",void 0),u([ee()],So.prototype,"transparent",void 0),u([ee()],So.prototype,"enableOffset",void 0),u([ee()],So.prototype,"writeDepth",void 0),u([ee()],So.prototype,"hasScreenSpaceReflections",void 0),u([ee()],So.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ee()],So.prototype,"hasCloudsReflections",void 0),u([ee()],So.prototype,"isDraped",void 0),u([ee()],So.prototype,"hasMultipassTerrain",void 0),u([ee()],So.prototype,"cullAboveGround",void 0),u([ee({constValue:Wt.Water})],So.prototype,"pbrMode",void 0),u([ee({constValue:!0})],So.prototype,"useCustomDTRExponentForWater",void 0),u([ee({constValue:!0})],So.prototype,"highStepCount",void 0),u([ee({constValue:!1})],So.prototype,"useFillLights",void 0);class hae extends S1{_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}_updateSSRState(t){t.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t.ssr.enabled})}_updateCloudsReflectionState(t){const i=w(t.clouds.data);i!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:i})}ensureResources(t){const i=this._techniqueRepository.constructionContext.waterTextureRepository;return i.resourceState===Ac.NOT_LOADED&&i.loadTextures(t),i.resourceState}beginSlot(t){return this._output===ue.Color&&(this._updateShadowState(t),this._updateSSRState(t),this._updateCloudsReflectionState(t)),this.ensureTechnique(Iz,t)}}const fit=As().vec3f(D.POSITION),mit=As().vec3f(D.POSITION).vec2f(D.UV0),pTe=As().vec3f(D.POSITION).vec4u8(D.COLOR);class Lz{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(D.POSITION).length}write(t,i,r,s){pz(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}class fTe extends Xm{constructor(t){super(t,new mTe),this._techniqueConfig=new So,this.animation=new mbe}getConfiguration(t,i){return this._techniqueConfig.output=t,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=i.transparencyPassType,this._techniqueConfig.enableOffset=i.camera.relativeElevation<gz,this._techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this._techniqueConfig}update(t){const i=Math.min(t.camera.relativeElevation,t.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*i<git;const r=this.animation.advance(t);return this.setParameters({timeElapsed:cZ(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&r}intersect(t,i,r,s,n,o,a){hz(t,i,s,n,o,void 0,a)}requiresSlot(t,i){switch(Kx(i)){case ue.Normal:return t===Ue.DRAPED_WATER;case ue.Color:if(this.parameters.isDraped)return t===Ue.DRAPED_MATERIAL;break;case ue.Highlight:return t===Ue.OPAQUE_MATERIAL||t===Ue.DRAPED_MATERIAL}let r=Ue.OPAQUE_MATERIAL;return this.parameters.transparent&&(r=this.parameters.writeDepth?Ue.TRANSPARENT_MATERIAL:Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),t===r}createGLMaterial(t){if(t.output===ue.Color&&this.parameters.isDraped)return t.output=ue.Draped,new hae(t);switch(t.output){case ue.Color:case ue.Normal:case ue.Highlight:case ue.Alpha:return new hae(t)}return null}createBufferWriter(){return new Lz(mit)}}class mTe extends cA{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=ir(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=ki(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const git=35e3;class dae{constructor(t){this.first=t.from,this.count=t.to-t.from}}class b2{constructor(t=0,i=0){this.from=t,this.to=i}}class yit extends b2{constructor(t,i,r,s,n,o){super(i,r),this.id=t,this.isVisible=s,this.hasHighlights=n,this.hasOccludees=o}}function pae(e){return Array.from(e.values()).sort(_it)}function _it(e,t){return e.from===t.from?e.to-t.to:e.from-t.from}function Z$(e,t){if(e.length===0)return void e.push(new dae(t));const i=e[e.length-1];if(vit(i,t)){const r=t.from-i.first+t.to-t.from;i.count=r}else e.push(new dae(t))}function vit(e,t){return e.first+e.count>=t.from}class bit{constructor(t,i){this._pool=t,this._size=0,this._buffer=t.newBuffer(dW(i))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(t){this._resize(this._size+t,!0).dispose()}alloc(t){return this._resize(t,!1)}_resize(t,i){let r;const s=wit(this._buffer.length,this._size,t);if(this._buffer.length!==s){const o=this._pool.newBuffer(s);i&&(o.array.set(this._buffer.array.subarray(0,Math.min(this._size,s))),o.vao.vertexBuffers.geometry.setSubData(o.array,0,0,o.array.byteLength)),r=this._buffer,this._buffer=o}const n=this._size;return this._size=t,r?{dispose:()=>{r.array.fill(0,0,n),this._pool.deleteBuffer(r)},copy:(o,a,l)=>this._buffer.array.set(r.array.subarray(a,l),o),hasNewBuffer:!0}:{dispose:()=>{},copy:(o,a,l)=>{o!==a&&this._buffer.array.copyWithin(o,a,l)},hasNewBuffer:!1}}erase(t,i){this._buffer.array.fill(0,t,i)}}const fae=65536;function dW(e){return Math.ceil(e/fae)*fae}function wit(e,t,i){return t<=i?e>=i?e:dW(Math.max(2*e,i)):e<=2*i?e:dW(i)}class xit{constructor(t,i,r,s){this.vao=new pn(t,i,{geometry:r},{geometry:Ai.createVertex(t,Gi.STATIC_DRAW)}),this.array=new Float32Array(s),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const Tit=UN+1;class Sit{constructor(t,i,r){this._rctx=t,this._locations=i,this._layout=r,this._cache=t.newCache(`MergedRenderer pool ${Gl()}`,Eit)}dispose(){this._cache.destroy()}newBuffer(t){const i=t.toString(),r=this._cache.pop(i);if(w(r)){const s=r.pop();return r.length>0&&this._cache.put(i,r,s.array.byteLength*r.length,Tit),s}return new xit(this._rctx,this._locations,this._layout,t)}deleteBuffer(t){const i=t.array.byteLength,r=t.array.length.toString(),s=this._cache.pop(r);return w(s)?(s.push(t),this._cache.put(r,s,i*s.length,-1)):this._cache.put(r,[t],i,-1),null}}function Eit(e,t){if(t===fy.ALL)return void e.forEach(s=>s.dispose());const i=e.pop(),r=e.length*i.array.byteLength;return i.dispose(),r}class gTe{constructor(t,i,r){this._rctx=t,this._materialRepository=i,this._material=r,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new hi,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new Zxe(this._material,this._materialRepository),this._bufferWriter=r.createBufferWriter(),this._bufferPool=new Sit(t,r.vertexAttributeLocations,Yc(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(t=>t.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof fTe}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==ts.Occlude}modify(t){this._updateGeometries(t.updates),this._addAndRemoveGeometries(t.adds,t.removes),this._updateRenderCommands()}_addAndRemoveGeometries(t,i){const r=this._bufferWriter,s=r.vertexBufferLayout.stride/4,n=this._dataByOrigin,o=Ait(t,i);o.forEach((a,l)=>{o.delete(l);const c=a.toAdd.reduce((T,O)=>T+r.elementCount(O.data),0);let h=n.get(l);if(h==null)At(a.toRemove.length===0),h=new Rit(a.origin,new bit(this._bufferPool,c*s)),n.set(l,h);else if(a.toAdd.length===0&&h.instances.size===a.toRemove.length)return h.buffer.dispose(),void n.delete(l);let p=0;h.instances.forEach(T=>p+=T.to-T.from);const m=a.toRemove.reduce((T,O)=>T+r.elementCount(O.data),0),g=h.buffer.size,v=(p+c-m)*s,b=Pit;if(v<g/2?this._removeAndRebuild(h,a.toRemove,s,v,b):a.toRemove.length>0&&this._remove(h,a.toRemove,s,b),a.toAdd.length>0){const T=Iit;ube(T,-a.origin[0],-a.origin[1],-a.origin[2]),this._add(h,a.toAdd,s,T,b)}const S=h.buffer.vao.vertexBuffers.geometry;yae(b),b.forAll(({from:T,to:O})=>{if(T<O){const C=h.buffer.array,M=4,I=T*M,$=O*M;S.setSubData(C,I,I,$)}}),b.clear(),h.drawCommandsDirty=!0})}_updateGeometries(t){const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4;for(const s of t){const n=s.renderGeometry,o=this._dataByOrigin.get(n.origin.id),a=o&&o.instances.get(n.id);if(!a)return;const l=s.updateType;if(l&vi.State.VISIBILITIES&&(a.isVisible=n.instanceParameters.visible),l&(vi.State.HIGHLIGHTS|vi.State.VISIBILITIES)){const c=n.instanceParameters.visible;a.hasHighlights=!!n.instanceParameters.highlights&&c}if(l&vi.State.OCCLUDEES&&(a.hasOccludees=!!n.instanceParameters.occludees),l&(vi.State.VERTEXATTRS|vi.State.TRANSFORMATION)){const{array:c,vao:h}=o.buffer;JZe(n,D8,bO),i.write({transformation:D8,invTranspTransformation:bO},n.data,i.vertexBufferLayout.createView(c.buffer),a.from),At(a.from+i.elementCount(n.data)===a.to,"material VBO layout has changed"),h.vertexBuffers.geometry.setSubData(c,a.from*r*4,a.from*r*4,a.to*r*4)}o.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(i=>{i.hasHiddenInstances=!1,i.hasHighlights=!1,i.hasOccludees=!1,On(i.instances,r=>(r.isVisible?(r.hasHighlights&&(this._hasHighlights=!0,i.hasHighlights=!0),r.hasOccludees&&(this._hasOccludees=!0,i.hasOccludees=!0)):i.hasHiddenInstances=!0,i.hasHiddenInstances&&i.hasHighlights&&i.hasOccludees))});const t=i=>{if(i.drawCommandsDefault=null,i.drawCommandsHighlight=null,i.drawCommandsOccludees=null,i.drawCommandsShadowHighlightRest=null,i.instances.size===0)return;if(!gae(i)){const s=this._bufferWriter.vertexBufferLayout.stride,n=4*i.buffer.size/s;return void(i.drawCommandsDefault=[{first:0,count:n}])}const r=pae(i.instances);i.drawCommandsDefault=[],i.drawCommandsHighlight=[],i.drawCommandsOccludees=[],i.drawCommandsShadowHighlightRest=[];for(const s of r)s.isVisible&&(s.hasOccludees?Z$(i.drawCommandsOccludees,s):Z$(i.drawCommandsDefault,s),s.hasHighlights?Z$(i.drawCommandsHighlight,s):Z$(i.drawCommandsShadowHighlightRest,s))};this._dataByOrigin.forEach(i=>{i.drawCommandsDirty&&(t(i),i.drawCommandsDirty=!1)})}updateAnimation(t){return this._material.update(t)}requiresSlot(t,i){return t==null||this._material.requiresSlot(t,i)}render(t,i){if(!this.requiresSlot(i.slot,t))return!1;const r=t===nt.MATERIAL_HIGHLIGHT||t===nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(r&&!this._hasHighlights)return!1;const s=t===nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,n=!(r||s);if(this._dataByOrigin.forEach(c=>{if(r&&!c.hasHighlights)return;const h=(r?c.drawCommandsHighlight:s&&gae(c)?c.drawCommandsShadowHighlightRest:c.drawCommandsDefault)||null,p=n&&c.drawCommandsOccludees||null;(w(h)||w(p))&&this._renderCommandData.push(new Mit(c.origin,c.buffer,h,p))}),this._renderCommandData.length===0)return!1;const o=this._rctx,a=this._glMaterials.load(o,t);if(N(a))return this._renderCommandData.clear(),!1;const l=a.beginSlot(i);return o.bindTechnique(l,this._material.parameters,i,!1),this._renderCommandData.forAll(c=>{l.bindDraw(c,i);const{buffer:h,renderCommands:p,occludeeCommands:m}=c;l.ensureAttributeLocations(h.vao),o.bindVAO(h.vao);const g=l.primitiveType;w(p)&&this._renderCommands(o,g,p),w(m)&&(l.bindPipelineState(o,i.slot,!0),this._renderCommands(o,g,m),l.bindPipelineState(o,i.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(t,i,r){for(let s=0;s<r.length;s++)t.drawArrays(i,r[s].first,r[s].count)}_removeAndRebuild(t,i,r,s,n){for(const h of i)t.instances.delete(h.id);const o=pae(t.instances);t.instances.clear();const a=t.buffer.size,l=t.buffer.alloc(s);let c=0;for(const h of o){const p=h.from*r,m=h.to*r;l.copy(c,p,m),h.from=c/r,c+=m-p,h.to=c/r,t.instances.set(h.id,h)}n.push(new b2(0,l.hasNewBuffer?t.buffer.array.length:a)),l.dispose(),t.buffer.erase(c,n.back().to),t.holes.clear()}_remove(t,i,r,s){for(const n of i){const o=n.id,a=t.instances.get(o),l=a.from*r,c=a.to*r;t.buffer.erase(l,c),t.holes.push(new b2(a.from,a.to)),t.instances.delete(o),s.push(new b2(l,c))}yae(t.holes)}_add(t,i,r,s,n){if(i.length===0)return;const o=this._bufferWriter;let a=o.vertexBufferLayout.createView(t.buffer.array.buffer);const l=t.holes.length>0;let c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER;for(const p of i){const m=w(p.transformation)?hs(D8,s,p.transformation):s;Fs(bO,m);const g=Kl(bO,bO),v=o.elementCount(p.data),b=v*r;let S=Oit(t.holes,v);N(S)&&(S=t.buffer.size/r,t.buffer.grow(b),a=o.vertexBufferLayout.createView(t.buffer.array.buffer)),o.write({transformation:m,invTranspTransformation:g},p.data,a,S);const T=p.instanceParameters.visible,O=!!p.instanceParameters.highlights&&T,C=!!p.instanceParameters.occludees,M=new yit(p.id,S,S+v,T,O,C);At(t.instances.get(p.id)==null),t.instances.set(p.id,M),l?n.push(new b2(M.from*r,M.to*r)):(c=Math.min(M.from,c),h=Math.max(M.to,h))}l||n.push(new b2(c*r,h*r))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Cit{constructor(t){this.origin=t,this.toAdd=new Array,this.toRemove=new Array}}function Ait(e,t){const i=new Map;for(const r of e)mae(i,r,!0);for(const r of t)mae(i,r,!1);return i}function mae(e,t,i){const r=t.origin;if(N(r))return;let s=e.get(r.id);s==null&&(s=new Cit(r.vec3),e.set(r.id,s)),i?s.toAdd.push(t):s.toRemove.push(t)}function gae(e){return e.hasOccludees||e.hasHighlights||e.hasHiddenInstances}function Oit(e,t){let i;if(!e.some(s=>!(s.to-s.from<t)&&(i=s,!0)))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}function yae(e){const t=new Map;e.forAll(r=>t.set(r.from,r));let i=!0;for(;i;)i=!1,e.forEach(r=>{const s=t.get(r.to);s&&(r.to=s.to,t.delete(s.from),e.removeUnordered(s),i=!0)})}class Rit{constructor(t,i){this.origin=t,this.buffer=i,this.instances=new Map,this.holes=new hi({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class Mit extends hW{constructor(t,i,r,s){super(t),this.buffer=i,this.renderCommands=r,this.occludeeCommands=s}}const Pit=new hi({deallocator:null}),Iit=Be(),D8=Be(),bO=Be();let em=class extends ze{constructor(e){super(e),this._pending=new Lit,this._changes=new rTe,this._materialRenderers=new Map,this._sortedMaterialRenderers=new hi,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return On(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=sTe(this._changes);let t=!1,i=!1,r=!1;return e.forEach((s,n)=>{let o=this._materialRenderers.get(n);if(!o&&s.adds.length>0&&(o=new gTe(this.rctx,this._materialRepository,n),this._materialRenderers.set(n,o),t=!0,i=!0,r=!0),!o)return;const a=i||o.hasHighlights,l=r||o.hasWater;o.modify(s),i=i||a!==o.hasHighlights,r=r||l!==o.hasWater,o.isEmpty&&(this._materialRenderers.delete(n),o.dispose(),t=!0)}),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=On(this._materialRenderers,s=>s.hasHighlights)),r&&(this._hasWater=On(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,t){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const r=this._pending.empty;for(const s of i)this._pending.adds.add(s);r&&this.notifyChange("updating"),t===vi.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const s of e)r.has(s)?(this._pending.removed.add(s),r.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===vi.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=this._changes.updates.length===0;for(const r of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(r),s.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case vi.State.TRANSFORMATION:case vi.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(e);case vi.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:i})=>t=i.updateAnimation(e)||t),t}render(e,t){for(let i=0;i<this._sortedMaterialRenderers.length;i++){const r=this._sortedMaterialRenderers.data[i];r.material.shouldRender(e)&&r.materialRenderer.render(e.pass,t)}}intersect(e,t,i,r,s){return this._geometries.forEach(n=>{if(r&&!r(n))return;this._intersectRenderGeometry(n,i,t,0,e,s);const o=this.rendererContext.longitudeCyclical;o&&(n.boundingSphere[0]-n.boundingSphere[3]<o.min&&this._intersectRenderGeometry(n,i,t,o.range,e,s),n.boundingSphere[0]+n.boundingSphere[3]>o.max&&this._intersectRenderGeometry(n,i,t,-o.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((t,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push({material:i,materialRenderer:t})}),this._sortedMaterialRenderers.sort((t,i)=>{const r=i.material.renderPriority-t.material.renderPriority;return r!==0?r:t.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,s,n){if(!e.instanceParameters.visible)return;let o=0;w(e.transformation)&&(r+=e.transformation[12],o=e.transformation[13]),X$[0]=i[0]-r,X$[1]=i[1]-o,X$[2]=1,Y$[0]=i[0]-r,Y$[1]=i[1]-o,Y$[2]=0,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersect(e,null,e.getShaderTransformation(),s,X$,Y$,(a,l,c)=>{$it(t,c,e.material.renderPriority,n,s,e.layerUid,e.graphicUid)},e.calculateShaderTransformation,t)}_notifyGraphicGeometryChanged(e){if(N(this.drapeSource.notifyGraphicGeometryChanged))return;let t;for(const i of e){const r=i.graphicUid;w(r)&&r!==t&&(this.drapeSource.notifyGraphicGeometryChanged(r),t=r)}}_notifyGraphicVisibilityChanged(e){if(N(this.drapeSource.notifyGraphicVisibilityChanged))return;let t;for(const i of e){const r=i.graphicUid;w(r)&&r!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(r),t=r)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return N(e.origin)&&(e.origin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};u([f()],em.prototype,"drapeSource",void 0),u([f()],em.prototype,"updating",null),u([f()],em.prototype,"rctx",null),u([f()],em.prototype,"rendererContext",void 0),u([f()],em.prototype,"_materialRepository",null),u([f()],em.prototype,"_localOriginFactory",null),em=u([B("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],em);class Lit{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(t){return this.adds.has(t)||this.removes.has(t)||this.removed.has(t)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}function $it(e,t,i,r,s,n,o){const a={layerUid:n,graphicUid:o,triangleNr:t},l=c=>{c.set(ls.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((s.results.min.drapedLayerOrder==null||i>=s.results.min.drapedLayerOrder)&&(s.results.min.dist==null||s.results.ground.dist<=s.results.min.dist)&&l(s.results.min),s.options.store!==Uo.MIN&&(s.results.max.drapedLayerOrder==null||i<s.results.max.drapedLayerOrder)&&(s.results.max.dist==null||s.results.ground.dist>s.results.max.dist)&&l(s.results.max),s.options.store===Uo.ALL){const c=UQ(s.ray);l(c),s.results.all.push(c)}}const X$=F(),Y$=F();function $z(e){e.fragment.uniforms.add(new Ci("projInfo",(t,i)=>Dit(i))),e.fragment.uniforms.add(new Ni("zScale",(t,i)=>yTe(i))),e.fragment.code.add(E`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function Dit(e){const t=e.camera.projectionMatrix;return t[11]===0?_r(_ae,2/(e.camera.fullWidth*t[0]),2/(e.camera.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):_r(_ae,-2/(e.camera.fullWidth*t[0]),-2/(e.camera.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const _ae=di();function yTe(e){return e.camera.projectionMatrix[11]===0?Di(vae,0,1):Di(vae,1,0)}const vae=yt();var _1;(function(e){e[e.SSAO=0]="SSAO",e[e.Blur=1]="Blur",e[e.COUNT=2]="COUNT"})(_1||(_1={}));class _Te extends pl{constructor(){super(...arguments),this.output=_1.SSAO}}u([ee({count:_1.COUNT})],_Te.prototype,"output",void 0);const wO={samples:16,filterRadius:4};function Nit(e){const t=new dr,i=t.fragment;if(t.include(E1),e.output===_1.Blur){const r=(wO.filterRadius+1)/2,s=1/(2*r*r);i.include(nh),i.uniforms.add([new as("normalMap"),new as("depthMap"),new as("tex"),new Py("blurSize"),new rr("projScale"),new Ni("nearFar",(n,o)=>o.camera.nearFar)]),i.code.add(E`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${E.float(s)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),i.code.add(E`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${E.int(wO.filterRadius)}; r <= ${E.int(wO.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return e.output===_1.SSAO&&(i.include(nh),t.include($z),i.uniforms.add(new as("normalMap")),i.uniforms.add(new as("depthMap")),i.uniforms.add(new as("rnm")),i.uniforms.add(new rr("intensity")),i.uniforms.add(new rr("projScale")),i.uniforms.add(new rr("radius")),i.uniforms.add(new Ni("nearFar",(r,s)=>s.camera.nearFar)),i.uniforms.add(new Py("screenSize")),i.uniforms.add(new Py("rnmScale")),i.code.add(E`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),i.code.add(E`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new Ni("zScale",(r,s)=>yTe(s))),i.code.add(E`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${E.int(wO.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${E.int(wO.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),t}const Fit=Object.freeze(Object.defineProperty({__proto__:null,build:Nit},Symbol.toStringTag,{value:"Module"}));class m3 extends $r{initializeProgram(t){const i=m3.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return ni({colorWrite:wi})}}m3.shader=new Tr(Fit,()=>_e(()=>import("./SSAO.glsl.dc28bc8e.js"),[],import.meta.url));class vTe{constructor(t,i,r){this._techniqueRep=t,this._rctx=i,this._requestRender=r,this._enabled=!1,this._ssaoTechniqueConfig=new _Te,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=ht(this.quadVAO)}disposeOffscreenBuffers(){Cn(this._ssaoFBO,t=>t.resize(0,0)),Cn(this._blur0FBO,t=>t.resize(0,0)),Cn(this._blur1FBO,t=>t.resize(0,0))}set enabled(t){t?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&w(this._noiseTexture)&&w(this._ssaoFBO)&&w(this._blur0FBO)&&w(this._blur1FBO)}get colorTexture(){return w(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return w(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return w(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO(t,i,r){if(!this.enabled||N(i)||N(r)||N(this._noiseTexture)||N(this._ssaoFBO)||N(this._blur0FBO)||N(this._blur1FBO))return;const s=this._rctx,n=t.camera,o=n.fullViewport,a=o[2],l=o[3],c=a/this._blurSizePx,h=l/this._blurSizePx;this._ssaoFBO.resize(a,l),this._blur0FBO.resize(c,h),this._blur1FBO.resize(c,h);const p=1,m=1,g=a*p,v=l*m;s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,a,l);const b=s.bindTechnique(this._ssaoTechnique,bae,t);b.setUniform2f("rnmScale",a/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);let S=1/n.computeRenderPixelSizeAtDist(1);b.setUniform1f("projScale",S*p),b.setUniform2f("screenSize",g,v);const T=Pr(n.eye,n.center);let O=20*n.computeRenderPixelSizeAtDist(T);O=Math.max(.1,O),b.setUniform1f("radius",O),b.setUniform1f("intensity",4*this._attenuation/O**6),b.bindTexture("rnm",this._noiseTexture),b.bindTexture("normalMap",r),b.bindTexture("depthMap",i),N(this.quadVAO)&&(this.quadVAO=fl(this._rctx)),s.bindVAO(this.quadVAO),s.drawArrays(Yt.TRIANGLE_STRIP,0,na(this.quadVAO,"geometry"));const C=s.bindTechnique(this._blurTechnique,bae,t);C.bindTexture("tex",this._ssaoFBO.colorTexture),C.bindTexture("normalMap",r),C.bindTexture("depthMap",i),s.setViewport(0,0,g/this._blurSizePx,v/this._blurSizePx),s.bindFramebuffer(this._blur0FBO),C.setUniform2f("screenSize",g,v),C.setUniform2f("blurSize",0,this._blurSizePx*p/v),T>5e4&&(S=Math.max(0,S-(T-5e4))),C.setUniform1f("projScale",S),s.drawArrays(Yt.TRIANGLE_STRIP,0,na(this.quadVAO,"geometry")),C.setUniform2f("blurSize",this._blurSizePx*m/g,0),s.bindFramebuffer(this._blur1FBO),C.bindTexture("tex",this._blur0FBO.colorTexture),s.drawArrays(Yt.TRIANGLE_STRIP,0,na(this.quadVAO,"geometry")),s.setViewport(o[0],o[1],o[2],o[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=_1.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(m3,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=_1.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(m3,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources(t){this._data?t():_e(()=>import("./SSAOHelperData.08f44d75.js"),[],import.meta.url).then(i=>{this._data=i,t()})}_initialize(){const t={target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:Ft.CLAMP_TO_EDGE,width:0,height:0},i={colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE};Qp(this._data.noiseTexture).then(r=>{this._enabled&&(this._ssaoFBO=new Xr(this._rctx,i,t),this._blur0FBO=new Xr(this._rctx,i,t),this._blur1FBO=new Xr(this._rctx,i,t),this._noiseTexture=new bt(this._rctx,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,hasMipmap:!0,width:r.width,height:r.height},r),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=ht(this._noiseTexture),this._blur1FBO=ht(this._blur1FBO),this._blur0FBO=ht(this._blur0FBO),this._ssaoFBO=ht(this._ssaoFBO)}get gpuMemoryUsage(){return(w(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(w(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(w(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const bae=new mn;function kit(){const e=new dr;return e.include(E1),e.fragment.uniforms.add([new as("tex"),new nl("uColor")]),e.fragment.code.add(E`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),e}const Uit=Object.freeze(Object.defineProperty({__proto__:null,build:kit},Symbol.toStringTag,{value:"Module"}));class EI extends $r{initializeProgram(t){const i=EI.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return this.configuration.hasAlpha?ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),colorWrite:wi}):ni({colorWrite:wi})}}EI.shader=new Tr(Uit,()=>_e(()=>import("./TextureOnly.glsl.58198522.js"),[],import.meta.url));class PJ extends pl{constructor(){super(...arguments),this.hasAlpha=!1}}u([ee()],PJ.prototype,"hasAlpha",void 0);class bTe{constructor(t){this._rctx=t,this.cache=new Map}dispose(){this.cache.forEach(t=>t.texture=ht(t.texture)),this.cache.clear()}_acquire(t){if(N(t))return null;const i=this._patternId(t),r=this.cache.get(i);if(r)return r.refCount++,r.bind;const s=t.pixelRatio,{encodedData:n,sdfNormalizer:o,pixels:a,paddedPixels:l}=zit(t.pattern,s),c=a/s,h={refCount:1,texture:null,bind:p=>(N(h.texture)&&(h.texture=new bt(this._rctx,{width:l,height:1,internalFormat:tt.RGBA,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE},n)),p.bindTexture("stipplePatternTexture",h.texture),{pixelSize:c,sdfNormalizer:o,pixels:a})};return this.cache.set(i,h),h.bind}release(t){if(N(t))return;const i=this._patternId(t),r=this.cache.get(i);r&&(r.refCount--,r.refCount===0&&(w(r.texture)&&r.texture.dispose(),this.cache.delete(i)))}swap(t,i){const r=this._acquire(i);return this.release(t),r}_patternId(t){return`${t.pattern.join(",")}-r${t.pixelRatio}`}}function zit(e,t){const i=e.map(v=>Math.round(v*t)),r=1/t,s=Math.floor(i.reduce((v,b)=>v+b)),n=i.reduce((v,b)=>Math.max(v,b)),o=(Math.floor(.5*(n-1))+.5)*r,a=[];let l=1;for(const v of i){for(let b=0;b<v;b++){const S=l*(Math.min(b,v-1-b)+.5)*r/o*.5+.5;a.push(S)}l=-l}const c=Math.round(i[0]/2),h=[...a.slice(c),...a.slice(0,c)],p=s+2,m=new Uint8Array(4*p);let g=4;for(const v of h)u3(v,m,g),g+=4;return m.copyWithin(0,g-4,g),m.copyWithin(g,4,8),{encodedData:m,sdfNormalizer:o,paddedPixels:p,pixels:s}}var Lc,ra;(function(e){e[e.Standard=0]="Standard",e[e.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",e[e.Transparency=2]="Transparency",e[e.OverlayWithTransparency=3]="OverlayWithTransparency",e[e.COUNT=4]="COUNT"})(Lc||(Lc={})),function(e){e[e.None=0]="None",e[e.Alpha=1]="Alpha",e[e.PremultipliedAlpha=2]="PremultipliedAlpha",e[e.COUNT=3]="COUNT"}(ra||(ra={}));class IF extends pl{constructor(){super(...arguments),this.function=Lc.Standard,this.alphaMode=ra.None,this.hasOpacityFactor=!1}}u([ee({count:Lc.COUNT})],IF.prototype,"function",void 0),u([ee({count:ra.COUNT})],IF.prototype,"alphaMode",void 0),u([ee()],IF.prototype,"hasOpacityFactor",void 0);let ap=class extends Sz(ze){constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new xi,this._frameTask=rC,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new hi,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new ks,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const e=this.view._stage.renderView;this._rctx=e.renderingContext;const t=e.waterTextureRepository;this._stippleTextureRepository=new bTe(e.renderingContext),this._shaderTechniqueRepository=new Gxe({rctx:this._rctx,viewingMode:st.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:t}),this._renderContext=new iTe(this._rctx,new MJ(this._rctx,this.view.state.viewingMode),new vTe(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([xe(()=>t.updating,()=>this.events.emit("content-changed"),an),xe(()=>this.spatialReference,i=>this._localOriginFactory=new RJ(i),an),Fo(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new jxe(e.textureRepository,this._shaderTechniqueRepository,i=>{(i.renderOccluded&K5)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=Ue.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=L1e(this._rctx),this._bindParameters.camera=Qw,this._bindParameters.transparencyPassType=Pt.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new RQ(Ke(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(It.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(e=>e.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=vr(this._debugTextureTechnique),this._debugPatternTexture=ht(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=ht(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=ht(this._shaderTechniqueRepository),this._temporaryFBO=ht(this._temporaryFBO),this._quadVAO=ht(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||On(this._drapeSourceRenderers,e=>e.updating)}get hasOverlays(){return w(this._overlays)&&w(this._overlayRenderTarget)}get gpuMemoryUsage(){return w(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,em)}createDrapeSourceRenderer(e,t,i){const r=this._drapeSourceRenderers.get(e);w(r)&&r.destroy();const s=new t({...i,rendererContext:this,drapeSource:e});return this._drapeSourceRenderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(xe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(N(e))return;const t=this._drapeSourceRenderers.get(e);N(t)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(e),this._handles.remove(e),t.destroy())}collectUnusedRenderTargetMemory(e){let t=!1;if(w(this._overlayRenderTarget))for(const i of this._overlayRenderTarget.renderTargets){const r=this.overlays[0].validTargets[i.type]||!this.overlays[1].validTargets[i.type];t=this._overlayRenderTarget.validateUsageForTarget(r,i,e)||t}return t}get overlays(){return $t(this._overlays,[])}ensureDrapeTargets(e){w(this._overlays)&&this._overlays.forEach(t=>{t.hasTargetWithoutRasterImage=lN(e,i=>i.drapeTargetType===lW.WithoutRasterImage)})}ensureDrapeSources(e){w(this._overlays)&&this._overlays.forEach(t=>{t.hasDrapedFeatureSource=lN(e,i=>i.drapeSourceType===HM.Features),t.hasDrapedRasterSource=lN(e,i=>i.drapeSourceType===HM.RasterImage)})}ensureOverlays(e,t){N(this._overlays)&&(this._overlayRenderTarget=new Ttt(this._rctx),this._overlays=[new Boe(ns.INNER,this._overlayRenderTarget),new Boe(ns.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=ht(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e,t=()=>!0){this._frameTask.processQueue(e),e.done||this._processDrapeSources(e,t)}_processDrapeSources(e,t){let i=!1;for(const[r,s]of this._drapeSourceRenderers){if(e.done)break;(r.destroyed||t(r))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._updateSortedDrapeSourceRenderers(),i&&(w(this._overlays)&&this._drapeSourceRenderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(iA,e=>e.updatePolicy===aC.SYNC)}isEmpty(){if(ur.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const e of this._drapeSourceRenderers.values())if(!e.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let t=!1;return this._drapeSourceRenderers.forEach(i=>t=i.updateAnimation(e)||t),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,t,i){const r=e.canvasGeometries;if(r.numViews===0)return!1;this._screenToWorldRatio=i*e.mapUnitsPerPixel;const s=t.renderPass;if(this.isEmpty()||s===nt.MATERIAL_HIGHLIGHT&&!this.hasHighlights||s===nt.MATERIAL_NORMAL&&!this.hasWater||!e.hasSomeSizedView())return!1;const n=t.fbo;if(!n.isValid())return!1;const o=2*e.resolution,a=e.resolution;n.resize(o,a);const l=this._rctx;Qw.pixelRatio=e.pixelRatio*i,this._renderContext.pass=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=s===nt.MATERIAL_NORMAL?Ue.DRAPED_WATER:Ue.DRAPED_MATERIAL,e.applyViewport(this._rctx),n.bind(l),e.index===ns.INNER&&(l.setClearColor(0,0,0,0),l.clearSafe(br.COLOR_BUFFER_BIT));const c=t.type===Gs.ColorNoRasterImage?nv.ExcludeRasterImage:t.type===Gs.Occluded?nv.OccludedOnly:nv.Normal;if(c===nv.OccludedOnly&&(this._renderContext.renderOccludedMask=K5),ur.OVERLAY_DRAW_DEBUG_TEXTURE&&c!==nv.OccludedOnly)for(let h=0;h<r.numViews;h++)this._setViewParameters(r.extents[h],e,Qw),this._drawDebugTexture(e.resolution,Vit[e.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:h,renderer:p})=>{if(c===nv.ExcludeRasterImage&&h.drapeSourceType===HM.RasterImage)return;const{fullOpacity:m}=h,g=w(m)&&m<1&&s===nt.MATERIAL;g&&(this.bindTemporaryFramebuffer(this._rctx,o,a),l.clearSafe(br.COLOR_BUFFER_BIT));for(let v=0;v<r.numViews;v++)this._setViewParameters(r.extents[v],e,Qw),p.render(this._renderContext,this._bindParameters);g&&w(this._temporaryFBO)&&(n.bind(l),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),ra.PremultipliedAlpha,m,Lc.OverlayWithTransparency,e.index))}),l.bindFramebuffer(null),n.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,t,i){N(this._temporaryFBO)&&(this._temporaryFBO=new Vxe(e,!1)),this._temporaryFBO.resize(t,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){var n,o;let s=0;for(const a of this._drapeSourceRenderers.values())s=(o=(n=a.intersect)==null?void 0:n.call(a,e,t,i,r,s))!=null?o:s}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),this._drapeSourceRenderers.size===0))return;const e=this.view.map.allLayers;this._drapeSourceRenderers.forEach((t,i)=>{const r=e.indexOf(i.layer);this._sortedDrapeSourceRenderers.push(new Bit(i,t,r<0?1/0:r))}),this._sortedDrapeSourceRenderers.sort((t,i)=>t.index-i.index)}_setViewParameters(e,t,i){i.viewport[0]=i.viewport[1]=0,i.viewport[2]=i.viewport[3]=t.resolution,wX(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),nU(i.viewMatrix,[-e[0],-e[1],0]),this._bindParameters.camera=i}_updateHasWater(){const e=On(this._drapeSourceRenderers,t=>t.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=On(this._drapeSourceRenderers,t=>t.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=On(this._drapeSourceRenderers,t=>t.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,t){this._ensureDebugPatternResources(e,e);const i=this._rctx,r=i.bindTechnique(this._debugTextureTechnique);r.setUniform4f("uColor",t[0],t[1],t[2],1),r.bindTexture("tex",this._debugPatternTexture),i.bindVAO(this._quadVAO),i.drawArrays(Yt.TRIANGLE_STRIP,0,na(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,t){if(this._debugPatternTexture)return;const i=new Uint8Array(e*t*4);let r=0;for(let n=0;n<t;n++)for(let o=0;o<e;o++){const a=Math.floor(o/10),l=Math.floor(n/10);a<2||l<2||10*a>e-20||10*l>t-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&a&&1&l?1&o^1&n?0:255:1&a^1&l?0:128)}this._debugPatternTexture=new bt(this._rctx,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:e,height:t},i);const s=new PJ;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(EI,s),this._quadVAO=fl(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:e=>this._drapeSourceRenderers.get(e)}}};var nv;u([f()],ap.prototype,"_frameTask",void 0),u([f()],ap.prototype,"_sortedDrapeSourceRenderersDirty",void 0),u([Jo()],ap.prototype,"_shaderTechniqueRepository",void 0),u([Jo()],ap.prototype,"_stippleTextureRepository",void 0),u([f({constructOnly:!0})],ap.prototype,"view",void 0),u([f()],ap.prototype,"worldToPCSRatio",void 0),u([f()],ap.prototype,"spatialReference",void 0),u([f({type:Boolean,readOnly:!0})],ap.prototype,"updating",null),ap=u([B("esri.views.3d.terrain.OverlayRenderer")],ap),function(e){e[e.Normal=0]="Normal",e[e.OccludedOnly=1]="OccludedOnly",e[e.ExcludeRasterImage=2]="ExcludeRasterImage"}(nv||(nv={}));class Bit{constructor(t,i,r){this.drapeSource=t,this.renderer=i,this.index=r}}const Vit=[[1,.5,.5],[.5,.5,1]],Qw=new wr;Qw.near=1,Qw.far=1e4,Qw.relativeElevation=null;const IJ=-2,K5=ts.OccludeAndTransparent;function wae(e){const t=[[D.POSITION,e.indices]],i=[[D.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}]];return w(e.attributeData.color)&&(i.push([D.COLOR,{size:4,data:e.attributeData.color,exclusive:!0}]),t.push([D.COLOR,new Uint32Array(e.indices.length)])),w(e.attributeData.uvMapSpace)&&(i.push([D.UVMAPSPACE,{size:4,data:e.attributeData.uvMapSpace,exclusive:!0}]),t.push([D.UVMAPSPACE,e.indices])),w(e.attributeData.boundingRect)&&(i.push([D.BOUNDINGRECT,{size:9,data:e.attributeData.boundingRect,exclusive:!0}]),t.push([D.BOUNDINGRECT,e.indices])),w(e.attributeData.mapPosition)&&(i.push([D.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([D.MAPPOS,e.indices])),new ss(i,t)}function xae(e){const t=[[D.POSITION,e.indices],[D.UV0,e.indices]],i=[[D.POSITION,{size:3,data:e.attributeData.position,exclusive:!0}],[D.UV0,{size:2,data:e.attributeData.uv0,exclusive:!0}]];return w(e.attributeData.mapPosition)&&(i.push([D.MAPPOS,{size:3,data:e.attributeData.mapPosition,exclusive:!0}]),t.push([D.MAPPOS,e.indices])),new ss(i,t)}function g3(e){switch(e.type){case"extent":if(e instanceof zi)return Ku.fromExtent(e);break;case"polygon":return e}return null}function LJ(e,t,i,r){const s=wI(e.rings,e.hasZ,Nm.CCW_IS_HOLE),n=new Float64Array(s.position.length),o=Cxe(s.position,e.spatialReference,0,n,0,s.position,0,s.position.length/3,t,i,r),a=o!=null;return{position:s.position,mapPosition:n,polygons:TTe(s.polygons,s.position,n),outlines:xTe(s.outlines,s.position,n),projectionSuccess:a,sampledElevation:o}}function wTe(e,t){const i=wI(e.rings,!1,Nm.CCW_IS_HOLE),r=Lr(i.position,e.spatialReference,0,i.position,t,0,i.position.length/3);for(let s=2;s<i.position.length;s+=3)i.position[s]=IJ;return{position:i.position,polygons:TTe(i.polygons,i.position),outlines:xTe(i.outlines,i.position),projectionSuccess:r}}function xTe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({index:s,count:n,position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function TTe(e,t,i){const r=new Array;for(const{index:s,count:n,holeIndices:o,pathLengths:a}of e){if(n<=1)continue;const l=3*s,c=l+3*n,h=o.map(p=>p-s);r.push({index:s,count:n,holeIndices:h,pathLengths:a,position:t.subarray(l,c),mapPosition:i?i.subarray(l,c):void 0})}return r}function STe(e,t){const i=e.fragment;switch(i.code.add(E`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),t.doubleSidedMode){case us.None:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case us.View:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case us.WindingOrder:i.code.add(E`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.doubleSidedMode;case us.COUNT:}}var us;(function(e){e[e.None=0]="None",e[e.View=1]="View",e[e.WindingOrder=2]="WindingOrder",e[e.COUNT=3]="COUNT"})(us||(us={}));function ETe(e){e.vertex.code.add(E`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}function CTe(e,t){t.instanced&&t.instancedDoublePrecision&&(e.attributes.add(D.MODELORIGINHI,"vec3"),e.attributes.add(D.MODELORIGINLO,"vec3"),e.attributes.add(D.MODEL,"mat3"),e.attributes.add(D.MODELNORMAL,"mat3"));const i=e.vertex;t.instancedDoublePrecision&&(i.include(J5,t),i.uniforms.add(new al("viewOriginHi",(r,s)=>YZe(fe(Q$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),Q$))),i.uniforms.add(new al("viewOriginLo",(r,s)=>QZe(fe(Q$,s.camera.viewInverseTransposeMatrix[3],s.camera.viewInverseTransposeMatrix[7],s.camera.viewInverseTransposeMatrix[11]),Q$)))),i.code.add(E`
    vec3 calculateVPos() {
      ${t.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),i.code.add(E`
    vec3 subtractOrigin(vec3 _pos) {
      ${t.instancedDoublePrecision?E`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),i.code.add(E`
    vec3 dpNormal(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),t.output===ue.Normal&&(i.uniforms.add(new Hr("viewNormal",(r,s)=>s.camera.viewInverseTransposeMatrix)),i.code.add(E`
    vec3 dpNormalView(vec4 _normal) {
      ${t.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),t.hasVertexTangents&&i.code.add(E`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${t.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const Q$=F();var Hs;function ATe(e){switch(e){case"multiply":default:return Hs.Multiply;case"ignore":return Hs.Ignore;case"replace":return Hs.Replace;case"tint":return Hs.Tint}}function OTe(e,t,i){if(N(e)||t===Hs.Ignore)return i[0]=255,i[1]=255,i[2]=255,void(i[3]=255);const r=Xe(Math.round(e[3]*ek),0,ek),s=r===0||t===Hs.Tint?0:t===Hs.Replace?Git:jit;i[0]=Xe(Math.round(e[0]*cS),0,cS),i[1]=Xe(Math.round(e[1]*cS),0,cS),i[2]=Xe(Math.round(e[2]*cS),0,cS),i[3]=r+s}(function(e){e[e.Multiply=1]="Multiply",e[e.Ignore=2]="Ignore",e[e.Replace=3]="Replace",e[e.Tint=4]="Tint"})(Hs||(Hs={}));const cS=255,ek=85,Git=ek,jit=2*ek;function RTe(e){e.vertex.code.add(E`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${E.int(Hs.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${E.int(Hs.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${E.int(Hs.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${E.int(Hs.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function MTe(e,t){t.hasSymbolColors?(e.include(RTe),e.attributes.add(D.SYMBOLCOLOR,"vec4"),e.varyings.add("colorMixMode","mediump float"),e.vertex.code.add(E`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(e.fragment.uniforms.add(new SI("colorMixMode",i=>Vwe[i.colorMixMode])),e.vertex.code.add(E`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function TT(e,t){t.hasVertexColors?(e.attributes.add(D.COLOR,"vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(E`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(E`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):e.vertex.code.add(E`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function Hit(e){e.fragment.code.add(E`
    #define discardOrAdjustAlpha(color) { if (color.a < ${E.float(la)}) { discard; } }
  `)}class PTe extends vs{constructor(t,i){super(t,"float",nr.Draw,(r,s,n)=>r.setUniform1f(t,i(s,n)))}}function yx(e,t){ITe(e,t,new lt("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function qit(e,t){ITe(e,t,new PTe("textureAlphaCutoff",i=>i.textureAlphaCutoff))}function ITe(e,t,i){const r=e.fragment;switch(t.alphaDiscardMode!==Mr.Mask&&t.alphaDiscardMode!==Mr.MaskBlend||r.uniforms.add(i),t.alphaDiscardMode){case Mr.Blend:return e.include(Hit);case Mr.Opaque:r.code.add(E`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Mr.Mask:r.code.add(E`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Mr.MaskBlend:e.fragment.code.add(E`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function LTe(e,t){const i=e.vertex.code,r=e.fragment.code,s=t.hasModelTransformation;t.output!==ue.Depth&&t.output!==ue.Shadow||(Yu(e,t),e.include(oa,{linearDepth:!0,hasModelTransformation:s}),e.include(My,t),e.include(mE,t),e.include(A1,t),e.include(Ns,t),e.vertex.uniforms.add(new Ni("nearFar",(n,o)=>o.camera.nearFar)),e.varyings.add("depth","float"),t.hasColorTexture&&e.fragment.uniforms.add(new ai("tex",n=>n.texture)),i.add(E`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${s?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),e.include(yx,t),r.add(E`
      void main(void) {
        discardBySlice(vpos);
        ${t.hasColorTexture?E`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),t.output===ue.Normal&&(Yu(e,t),e.include(oa,{linearDepth:!1,hasModelTransformation:s}),e.include(Az,t),e.include(Rz,t),e.include(My,t),e.include(mE,t),t.hasColorTexture&&e.fragment.uniforms.add(new ai("tex",n=>n.texture)),e.varyings.add("vPositionView","vec3"),i.add(E`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${t.normalType===Yr.Attribute?E`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Ns,t),e.include(yx,t),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?E`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${t.normalType===Yr.ScreenDerivative?E`
            vec3 normal = screenDerivativeNormal(vPositionView);`:E`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),t.output===ue.Highlight&&(Yu(e,t),e.include(oa,{linearDepth:!1,hasModelTransformation:s}),e.include(My,t),e.include(mE,t),t.hasColorTexture&&e.fragment.uniforms.add(new ai("tex",n=>n.texture)),i.add(E`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${s?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),e.include(Ns,t),e.include(yx,t),e.include(d0),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${t.hasColorTexture?E`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}function $Te(e,t){const i=e.fragment;if(t.hasVertexTangents?(e.attributes.add(D.TANGENT,"vec4"),e.varyings.add("vTangent","vec4"),t.doubleSidedMode===us.WindingOrder?i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):i.code.add(E`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(e.extensions.add("GL_OES_standard_derivatives"),i.code.add(E`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),t.textureCoordinateType!==Pn.None){e.include(gQ,t);const r=t.supportsTextureAtlas;i.uniforms.add(t.pbrTextureBindType===nr.Pass?xF("normalTexture",s=>s.textureNormal,r):kM("normalTexture",s=>s.textureNormal,r)),i.code.add(E`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${t.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}function CI(e,t){const i=e.fragment;t.receiveAmbientOcclusion?(i.uniforms.add([new ai("ssaoTex",(r,s)=>s.ssaoHelper.colorTexture),new Ci("viewportPixelSz",(r,s)=>_r(Wit,s.camera.fullViewport[0],s.camera.fullViewport[1],1/s.ssaoHelper.width,1/s.ssaoHelper.height))]),i.code.add(E`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):i.code.add(E`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const Wit=di();function tT(e,t){const i=e.fragment;e.include(CI,t),t.pbrMode!==Wt.Disabled&&e.include(Pz,t),e.include(wQ,t),i.constants.add("ambientBoostFactor","float",sA),e.include(WU),i.code.add(E`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===Wt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),i.uniforms.add(new Ut("lightingMainDirection",(r,s)=>s.lighting.lightingMainDirection)),i.code.add(E`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?E`normalize(vPosWorld)`:E`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),i.uniforms.add([new lt("lightingGlobalFactor",(r,s)=>s.lighting.globalFactor),new Ut("lightingMainIntensity",(r,s)=>s.lighting.mainLight.intensity)]),i.code.add(E`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),t.pbrMode===Wt.Disabled||t.pbrMode===Wt.WaterOnIntegratedMesh?(e.include(xQ,t),i.code.add(E`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):t.pbrMode!==Wt.Normal&&t.pbrMode!==Wt.Schematic||(i.code.add(E`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),i.code.add(E`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?i.uniforms.add(new Vx("hasFillLights",(r,s)=>s.enableFillLights)):i.constants.add("hasFillLights","bool",!1),i.code.add(E`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),i.uniforms.add([new lt("lightingSpecularStrength",(r,s)=>s.lighting.mainLight.specularStrength),new lt("lightingEnvironmentStrength",(r,s)=>s.lighting.mainLight.environmentStrength)]),i.code.add(E`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),i.code.add(E`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===Wt.Schematic?E`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:E`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}function DTe(e,t){const i=E`
  /*
  *  ${t.name}
  *  ${t.output===ue.Color?"RenderOutput: Color":t.output===ue.Depth?"RenderOutput: Depth":t.output===ue.Shadow?"RenderOutput: Shadow":t.output===ue.Normal?"RenderOutput: Normal":t.output===ue.Highlight?"RenderOutput: Highlight":""}
  */
  `;zP()&&(e.fragment.code.add(i),e.vertex.code.add(i))}function y3(e){e.include(Wm),e.code.add(E`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${E.int(Hs.Multiply)}) {
        return allMixed;
      }
      if (mode == ${E.int(Hs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(Hs.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${E.int(Hs.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${E.int(Hs.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function Zit(e){const t=new dr,i=t.vertex.code,r=t.fragment.code;t.include(DTe,{name:"Default Material Shader",output:e.output});const s=Yu(t,e);return t.include(Oz),t.varyings.add("vpos","vec3"),t.include(mE,e),t.include(CTe,e),t.include($we,e),e.output!==ue.Color&&e.output!==ue.Alpha||(Dm(t.vertex,e),t.include(Az,e),t.include(oa,{linearDepth:!1,hasModelTransformation:e.hasModelTransformation}),e.normalType===Yr.Attribute&&e.offsetBackfaces&&t.include(ETe),t.include($Te,e),t.include(Rz,e),e.instancedColor&&t.attributes.add(D.INSTANCECOLOR,"vec4"),t.varyings.add("localvpos","vec3"),t.include(My,e),t.include(TI,e),t.include(MTe,e),t.include(TT,e),t.vertex.uniforms.add(new Ci("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),e.hasModelTransformation&&t.vertex.uniforms.add(new Hr("model",n=>w(n.modelTransformation)?n.modelTransformation:Dn)),i.add(E`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${e.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${E.float(la)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${e.normalType===Yr.Attribute?E`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${e.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${e.hasModelTransformation?"model,":""} vpos);
          ${e.normalType===Yr.Attribute&&e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),e.output===ue.Alpha&&(t.include(Ns,e),t.include(yx,e),t.include(oh,e),t.fragment.uniforms.add([new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity)]),e.hasColorTexture&&t.fragment.uniforms.add(new ai("tex",n=>n.texture)),t.fragment.include(y3),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?E`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===ue.Color&&(t.include(Ns,e),t.include(tT,e),t.include(CI,e),t.include(yx,e),t.include(e.instancedDoublePrecision?Mz:eT,e),t.include(oh,e),Dm(t.fragment,e),t.fragment.uniforms.add([s,new Ut("ambient",n=>n.ambient),new Ut("diffuse",n=>n.diffuse),new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity),new lt("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Ut("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",sA),e.hasColorTexture&&t.fragment.uniforms.add(new ai("tex",n=>n.texture)),t.include(bQ,e),t.include(Pz,e),t.fragment.include(y3),t.include(STe,e),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${e.normalType===Yr.ScreenDerivative?E`
                vec3 normal = screenDerivativeNormal(localvpos);`:E`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${e.pbrMode===Wt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?E`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.hasNormalTexture?E`
                mat3 tangentSpace = ${e.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:E`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${e.spherical?E`normalize(vpos + localOrigin);`:E`vec3(0.0, 0.0, 1.0);`}

        ${e.snowCover?E`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${e.pbrMode===Wt.Normal||e.pbrMode===Wt.Schematic?E`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?E`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Pt.Color?E`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),t.include(LTe,e),t}const Xit=Object.freeze(Object.defineProperty({__proto__:null,build:Zit},Symbol.toStringTag,{value:"Module"}));class Yit extends aTe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=Ke(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Ir.Back,this.emissiveFactor=Ke(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ke(.2,.2,.2),this.diffuse=Ke(.8,.8,.8),this.externalColor=ki(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=F(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=Qr(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=Ux.Less,this.textureAlphaMode=Mr.Blend,this.textureAlphaCutoff=H5,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=ts.Occlude}}class Qit extends lTe{constructor(){super(...arguments),this.origin=F(),this.slicePlaneLocalOrigin=this.origin}}class AI extends $r{initializeConfiguration(t,i){i.spherical=t.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=xI(t.rctx),i.textureCoordinateType=i.hasColorTexture||i.hasMetalnessAndRoughnessTexture||i.hasEmissionTexture||i.hasOcclusionTexture||i.hasNormalTexture?Pn.Default:Pn.None}initializeProgram(t){return this._initializeProgram(t,AI.shader)}_initializeProgram(t,i){const r=i.get().build(this.configuration);return new Sr(t.rctx,r,or)}_convertDepthTestFunction(t){return t===Ux.Lequal?kr.LEQUAL:kr.LESS}_setPipeline(t,i){const r=this.configuration,s=t===Pt.NONE,n=t===Pt.FrontFace;return ni({blending:r.output!==ue.Color&&r.output!==ue.Alpha||!r.transparent?null:s?Qu:p0(t),culling:Jit(r)&&qU(r.cullFace),depthTest:{func:C1(t,this._convertDepthTestFunction(r.customDepthTest))},depthWrite:s||n?r.writeDepth&&ec:null,colorWrite:wi,stencilWrite:r.hasOccludees?Fm:null,stencilTest:r.hasOccludees?i?y1:O1:null,polygonOffset:s||n?null:_z(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}function Jit(e){return e.cullFace!==Ir.None||!e.hasSlicePlane&&!e.transparent&&!e.doubleSidedMode}AI.shader=new Tr(Xit,()=>_e(()=>import("./DefaultMaterial.glsl.67d17f03.js"),[],import.meta.url));class yi extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.alphaDiscardMode=Mr.Opaque,this.doubleSidedMode=us.None,this.pbrMode=Wt.Disabled,this.cullFace=Ir.None,this.transparencyPassType=Pt.NONE,this.normalType=Yr.Attribute,this.textureCoordinateType=Pn.None,this.customDepthTest=Ux.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}u([ee({count:ue.COUNT})],yi.prototype,"output",void 0),u([ee({count:Mr.COUNT})],yi.prototype,"alphaDiscardMode",void 0),u([ee({count:us.COUNT})],yi.prototype,"doubleSidedMode",void 0),u([ee({count:Wt.COUNT})],yi.prototype,"pbrMode",void 0),u([ee({count:Ir.COUNT})],yi.prototype,"cullFace",void 0),u([ee({count:Pt.COUNT})],yi.prototype,"transparencyPassType",void 0),u([ee({count:Yr.COUNT})],yi.prototype,"normalType",void 0),u([ee({count:Pn.COUNT})],yi.prototype,"textureCoordinateType",void 0),u([ee({count:Ux.COUNT})],yi.prototype,"customDepthTest",void 0),u([ee()],yi.prototype,"spherical",void 0),u([ee()],yi.prototype,"hasVertexColors",void 0),u([ee()],yi.prototype,"hasSymbolColors",void 0),u([ee()],yi.prototype,"hasVerticalOffset",void 0),u([ee()],yi.prototype,"hasSlicePlane",void 0),u([ee()],yi.prototype,"hasSliceHighlight",void 0),u([ee()],yi.prototype,"hasColorTexture",void 0),u([ee()],yi.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([ee()],yi.prototype,"hasEmissionTexture",void 0),u([ee()],yi.prototype,"hasOcclusionTexture",void 0),u([ee()],yi.prototype,"hasNormalTexture",void 0),u([ee()],yi.prototype,"hasScreenSizePerspective",void 0),u([ee()],yi.prototype,"hasVertexTangents",void 0),u([ee()],yi.prototype,"hasOccludees",void 0),u([ee()],yi.prototype,"hasMultipassTerrain",void 0),u([ee()],yi.prototype,"hasModelTransformation",void 0),u([ee()],yi.prototype,"offsetBackfaces",void 0),u([ee()],yi.prototype,"vvSize",void 0),u([ee()],yi.prototype,"vvColor",void 0),u([ee()],yi.prototype,"receiveShadows",void 0),u([ee()],yi.prototype,"receiveAmbientOcclusion",void 0),u([ee()],yi.prototype,"textureAlphaPremultiplied",void 0),u([ee()],yi.prototype,"instanced",void 0),u([ee()],yi.prototype,"instancedColor",void 0),u([ee()],yi.prototype,"instancedDoublePrecision",void 0),u([ee()],yi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ee()],yi.prototype,"writeDepth",void 0),u([ee()],yi.prototype,"transparent",void 0),u([ee()],yi.prototype,"enableOffset",void 0),u([ee()],yi.prototype,"cullAboveGround",void 0),u([ee()],yi.prototype,"snowCover",void 0),u([ee({constValue:!0})],yi.prototype,"hasVvInstancing",void 0),u([ee({constValue:!1})],yi.prototype,"useCustomDTRExponentForWater",void 0),u([ee({constValue:!1})],yi.prototype,"supportsTextureAtlas",void 0),u([ee({constValue:!0})],yi.prototype,"useFillLights",void 0);function Kit(e){const t=new dr,i=t.vertex.code,r=t.fragment.code,s=Yu(t,e);return t.include(Oz),t.varyings.add("vpos","vec3"),t.include(mE,e),t.include(CTe,e),t.include($we,e),e.output!==ue.Color&&e.output!==ue.Alpha||(Dm(t.vertex,e),t.include(Az,e),t.include(oa),e.offsetBackfaces&&t.include(ETe),e.instancedColor&&t.attributes.add(D.INSTANCECOLOR,"vec4"),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("localvpos","vec3"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),t.include(My,e),t.include(TI,e),t.include(MTe,e),t.include(TT,e),t.vertex.uniforms.add(new Ci("externalColor",n=>n.externalColor)),t.varyings.add("vcolorExt","vec4"),i.add(E`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${e.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${E.float(la)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${e.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${e.hasMultipassTerrain?E`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),e.output===ue.Alpha&&(t.include(Ns,e),t.include(yx,e),t.include(oh,e),t.fragment.uniforms.add([new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity),new n1("view")]),e.hasColorTexture&&t.fragment.uniforms.add(new ai("tex",n=>n.texture)),t.fragment.include(y3),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        ${e.hasVertexColors?E`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),e.output===ue.Color&&(t.include(Ns,e),t.include(tT,e),t.include(CI,e),t.include(yx,e),t.include(e.instancedDoublePrecision?Mz:eT,e),t.include(oh,e),Dm(t.fragment,e),t.fragment.uniforms.add([s,new Ut("ambient",n=>n.ambient),new Ut("diffuse",n=>n.diffuse),new lt("opacity",n=>n.opacity),new lt("layerOpacity",n=>n.layerOpacity),new n1("view"),new lt("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Ut("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),t.fragment.constants.add("ambientBoostFactor","float",sA),e.hasColorTexture&&t.fragment.uniforms.add(new ai("tex",n=>n.texture)),t.include(bQ,e),t.include(Pz,e),t.fragment.include(y3),t.extensions.add("GL_OES_standard_derivatives"),r.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${e.hasColorTexture?E`
                vec4 texColor = texture2D(tex, vuv0);
                ${e.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:E`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${e.pbrMode===Wt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${e.hasVertexColors?E`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:E`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${e.snowCover?E`albedo = mix(albedo, vec3(1), 0.9);`:E``}
        ${E`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${e.pbrMode===Wt.Normal||e.pbrMode===Wt.Schematic?e.spherical?E`vec3 normalGround = normalize(vpos + localOrigin);`:E`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:E``}
        ${e.pbrMode===Wt.Normal||e.pbrMode===Wt.Schematic?E`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${e.snowCover?E`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:E`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${e.transparencyPassType===Pt.Color?E`gl_FragColor = premultiplyAlpha(gl_FragColor);`:E``}
      }
    `)),t.include(LTe,e),t}const ert=Object.freeze(Object.defineProperty({__proto__:null,build:Kit},Symbol.toStringTag,{value:"Module"}));class Dz extends AI{initializeConfiguration(t,i){super.initializeConfiguration(t,i),i.hasMetalnessAndRoughnessTexture=!1,i.hasEmissionTexture=!1,i.hasOcclusionTexture=!1,i.hasNormalTexture=!1,i.hasModelTransformation=!1,i.normalType=Yr.Attribute,i.doubleSidedMode=us.WindingOrder,i.hasVertexTangents=!1}initializeProgram(t){return this._initializeProgram(t,Dz.shader)}}Dz.shader=new Tr(ert,()=>_e(()=>import("./RealisticTree.glsl.0036f101.js"),[],import.meta.url));class iT extends Xm{constructor(t){super(t,rrt),this.supportsEdges=!0,this.techniqueConfig=new yi,this.vertexBufferLayout=nrt(this.parameters),this.instanceBufferLayout=t.instanced?NTe(this.parameters):null}isVisibleInPass(t){return t!==nt.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;if(!super.isVisible()||t.layerOpacity===0)return!1;const{instanced:i,hasVertexColors:r,hasSymbolColors:s,vvColorEnabled:n}=t,o=w(i)&&i.includes("color"),a=t.colorMixMode==="replace",l=t.opacity>0,c=t.externalColor&&t.externalColor[3]>0;return r&&(o||n||s)?!!a||l:r?a?c:l:o||n||s?!!a||l:a?c:l}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=w(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=w(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType=this.parameters.normals==="screenDerivative"?Yr.ScreenDerivative:Yr.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,w(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?Ir.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=w(this.parameters.modelTransformation),t!==ue.Color&&t!==ue.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this.techniqueConfig.doubleSidedMode=us.WindingOrder:this.techniqueConfig.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?us.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?us.WindingOrder:us.None,this.techniqueConfig.instancedColor=w(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Wt.Schematic:Wt.Normal:Wt.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<gz,this.techniqueConfig.snowCover=this.hasSnowCover(i)),this.techniqueConfig}hasSnowCover(t){return w(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}intersect(t,i,r,s,n,o,a){if(w(this.parameters.verticalOffset)){const l=s.camera;fe(F8,r[12],r[13],r[14]);let c=null;switch(s.viewingMode){case st.Global:c=De(Tae,F8);break;case st.Local:c=ve(Tae,lrt)}let h=0;const p=Me(crt,F8,l.eye),m=He(p),g=be(p,p,1/m);let v=null;this.parameters.screenSizePerspective&&(v=ke(c,g)),h+=zwe(l,m,this.parameters.verticalOffset,v,this.parameters.screenSizePerspective),be(c,c,h),$c(N8,c,s.transform.inverseRotation),n=Me(ort,n,N8),o=Me(art,o,N8)}hz(t,i,s,n,o,Gq(s.verticalOffset),a)}requiresSlot(t){return t===(this.parameters.transparent?this.parameters.writeDepth?Ue.TRANSPARENT_MATERIAL:Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ue.OPAQUE_MATERIAL)||t===Ue.DRAPED_MATERIAL}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Alpha||t.output===ue.Depth||t.output===ue.Normal||t.output===ue.Shadow||t.output===ue.Highlight?new trt(t):null}createBufferWriter(){return new srt(this.vertexBufferLayout,this.instanceBufferLayout)}}class trt extends vQ{constructor(t){super({...t,...t.material.parameters})}_updateParameters(t){const i=this._material.parameters;this.updateTexture(i.textureId);const r=t.camera.viewInverseTransposeMatrix;return fe(i.origin,r[3],r[7],r[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(i.treeRendering?Dz:AI,t)}_updateShadowState(t){t.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:t.shadowMap.enabled})}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==ue.Color&&this._output!==ue.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this._updateParameters(t)}}class irt extends Yit{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}}const rrt=new irt;class srt{constructor(t,i){this.vertexBufferLayout=t,this.instanceBufferLayout=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(D.POSITION).length}write(t,i,r,s){pz(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}function nrt(e){const t=e.textureId||e.normalTextureId||e.metallicRoughnessTextureId||e.emissiveTextureId||e.occlusionTextureId,i=As().vec3f(D.POSITION).vec3f(D.NORMAL);return e.hasVertexTangents&&i.vec4f(D.TANGENT),t&&i.vec2f(D.UV0),e.hasVertexColors&&i.vec4u8(D.COLOR),e.hasSymbolColors&&i.vec4u8(D.SYMBOLCOLOR),i}function NTe(e){let t=As();return t=e.instancedDoublePrecision?t.vec3f(D.MODELORIGINHI).vec3f(D.MODELORIGINLO).mat3f(D.MODEL).mat3f(D.MODELNORMAL):t.mat4f(D.MODEL).mat4f(D.MODELNORMAL),w(e.instanced)&&e.instanced.includes("color")&&(t=t.vec4f(D.INSTANCECOLOR)),w(e.instanced)&&e.instanced.includes("featureAttribute")&&(t=t.vec4f(D.INSTANCEFEATUREATTRIBUTE)),t}const ort=F(),art=F(),lrt=Ke(0,0,1),Tae=F(),N8=F(),F8=F(),crt=F(),urt=["polygon","extent"];class hrt extends Qm{constructor(t,i,r,s){super(t,i,r,s),this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const a=vz(this._getSymbolSize());if(a)throw new se("graphics3dextrudesymbollayer:invalid-size",a)}const t=Mn(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t),r=$l(i),s=i[3],n=s<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:r,ambient:r,opacity:s,transparent:n,cullFace:n?Ir.None:Ir.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new iT(o),this._bottomMaterial=new iT({...o,cullFace:Ir.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,urt,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new lh);return this._createAs3DShape(i,t.renderingInfo,r,s,i.uid)}layerOpacityChanged(t,i){const r=Mn(this.symbolLayer,"material","color"),s=this._getCombinedOpacity(r),n=s<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:s,transparent:n}),this._bottomMaterial.setParameters({opacity:s,transparent:n});const o=this._getLayerOpacity();return t.forEach(a=>{const l=i(a);w(l)&&l.layerOpacityChanged(o,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,m1)}slicePlaneEnabledChanged(t,i){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),t.forEach(r=>{const s=i(r);w(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(t){var r;let i;return i=t.size&&this._drivenProperties.size?(r=ptt(t.size,2))!=null?r:0:this._getSymbolSize(),i/=this._context.renderCoordsHelper.unitInMeters,i}applyRendererDiff(t,i){return this._drivenPropertiesChanged(i)?In.Recreate_Symbol:In.Recreate_Graphics}_getSymbolSize(){var t;return(t=this.symbolLayer.size)!=null?t:1}_createAs3DShape(t,i,r,s,n){const o=g3(t.geometry);if(N(o))return null;const a=LJ(o,this._context.elevationProvider,this._context.renderCoordsHelper,s);if(this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer"),o.rings.length===0||!o.rings.some(ye=>ye.length>0))return null;const l=yJ(o);if(N(l))return null;const c=new Array,h=new Array,p=new Array,m=dn(),g=Be(),v=F(),b=this._context.renderCoordsHelper.viewingMode===st.Global;b||this._context.renderCoordsHelper.worldUpAtPosition(null,v),rh(o.spatialReference,[l.x,l.y,0],g,this._context.renderCoordsHelper.spatialReference);const S=Be();Fs(S,g);const T=Qr();cC(T,S);const{polygons:O,mapPosition:C,position:M}=a,I=M.length/3,$=new Float64Array(3*I*6),U=new Float64Array(3*I*6),q=new Float64Array(3*I*6),G=new Float64Array(1*I*6);let Y=0;for(let ye=0;ye<O.length;++ye){const pe=O[ye],z=pe.count;if(this._context.clippingExtent&&(Fr(m),Vu(m,pe.mapPosition),!Rp(m,this._context.clippingExtent)))continue;const j=SC(pe.mapPosition,pe.holeIndices,3);if(j.length===0)continue;const Q=3*z*2+j.length,Z=new Uint32Array(Q),ie=new Uint32Array(j.length),le=6*z,K=3*$.BYTES_PER_ELEMENT,ae=new Ws($.buffer,Y*K,K,(Y+le)*K),we=3*U.BYTES_PER_ELEMENT,Re=new Ws(U.buffer,Y*we,we,(Y+le)*we),Ge=new Float64Array(q.buffer,3*Y*q.BYTES_PER_ELEMENT,3*le),Pe=new Float64Array(G.buffer,1*Y*G.BYTES_PER_ELEMENT,1*le),Se=this._getExtrusionSize(i);drt(M,C,j,pe,ae.typedBuffer,Ge,Re.typedBuffer,Pe,0,Z,ie,Se,v,b),bI(ae,ae,S),g1(Re,Re,T),Y+=6*z;const $e=Sae(Z,Z.length-ie.length,{positions:ae.typedBuffer,elevation:Ge,normals:Re.typedBuffer,heights:Pe},r);c.push($e),h.push(this._material),p.push(Dn);const qe=Sae(ie,0,{positions:ae.typedBuffer,elevation:Ge,normals:Re.typedBuffer,heights:Pe},r);c.push(qe),h.push(this._bottomMaterial),p.push(Dn)}if(c.length===0)return null;const J=new m0({geometries:c,materials:h,transformations:p,metadata:{layerUid:this._context.layer.uid,graphicUid:n,isElevationSource:!0}});J.transformation=g;const X=$xe(this.symbolLayer,{opacity:this._getLayerOpacity()}),ne=w(X)?{baseMaterial:this._material,edgeMaterials:[X],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,re=new Ym(this,J,c,null,null,mrt,s,ne);return re.alignedSampledElevation=a.sampledElevation,re.needsElevationUpdates=m1(s.mode),re}}function Sae(e,t,i,r){const s=new Uint32Array(e.length),n=[[D.POSITION,{size:3,data:i.positions,exclusive:!0}],[D.NORMAL,{size:3,data:i.normals,exclusive:!0}],[D.COLOR,{size:4,data:r,exclusive:!0}],[D.SIZE,{size:1,data:i.heights,exclusive:!0}]],o=[[D.POSITION,e],[D.NORMAL,e],[D.COLOR,s]];return i.elevation&&(n.push([D.MAPPOS,{size:3,data:i.elevation}]),o.push([D.MAPPOS,e])),new ss(n,o,Zl.Triangle,t)}function drt(e,t,i,r,s,n,o,a,l,c,h,p,m,g){const v=i.length/3;let b=0,S=2*r.count;prt(e,t,r.index,r.count,i,0,v,s,n,o,a,l,c,h,S,p,m,g),l+=2*r.count,S=0,Eae(s,n,a,o,b,r.pathLengths[0],r.count,l,c,S,p),l+=4*r.pathLengths[0],S+=2*r.pathLengths[0],b+=r.pathLengths[0];for(let T=1;T<r.pathLengths.length;++T)Eae(s,n,a,o,b,r.pathLengths[T],r.count,l,c,S,p),l+=4*r.pathLengths[T],S+=2*r.pathLengths[T],b+=r.pathLengths[T]}function prt(e,t,i,r,s,n,o,a,l,c,h,p,m,g,v,b,S,T){ve(xl,S);const O=b>0?1:-1;let C=3*i,M=p,I=3*M,$=p+r,U=3*$;for(let Y=0;Y<r;++Y)T&&(xl[0]=e[C+0],xl[1]=e[C+1],xl[2]=e[C+2],De(xl,xl)),a[I+0]=e[C+0],a[I+1]=e[C+1],a[I+2]=e[C+2],l[I+0]=t[C+0],l[I+1]=t[C+1],l[I+2]=t[C+2],c[I+0]=-O*xl[0],c[I+1]=-O*xl[1],c[I+2]=-O*xl[2],h[M]=0,a[U+0]=e[C+0]+b*xl[0],a[U+1]=e[C+1]+b*xl[1],a[U+2]=e[C+2]+b*xl[2],l[U+0]=t[C+0],l[U+1]=t[C+1],l[U+2]=t[C+2],c[U+0]=O*xl[0],c[U+1]=O*xl[1],c[U+2]=O*xl[2],h[$]=b,I+=3,U+=3,C+=3,M+=1,$+=1;C=3*n,I=0,U=3*v;const q=b<0?Pae:Mae,G=b<0?Mae:Pae;for(let Y=0;Y<o;++Y)g[I+0]=s[C+q[0]],g[I+1]=s[C+q[1]],g[I+2]=s[C+q[2]],m[U+0]=s[C+G[0]]+r,m[U+1]=s[C+G[1]]+r,m[U+2]=s[C+G[2]]+r,I+=3,U+=3,C+=3}function J$(e,t,i,r,s,n,o){r[n]=r[o],o*=3,e[(n*=3)+0]=e[o+0],e[n+1]=e[o+1],e[n+2]=e[o+2],t[n+0]=t[o+0],t[n+1]=t[o+1],t[n+2]=t[o+2],i[n+0]=s[0],i[n+1]=s[1],i[n+2]=s[2]}const xO=F();function Eae(e,t,i,r,s,n,o,a,l,c,h){let p=s,m=s+1,g=s+o,v=s+o+1,b=a,S=a+1,T=a+2*n,O=a+2*n+1;h<0&&(p=s+o+1,v=s),c*=3;for(let C=0;C<n;++C)C===n-1&&(h>0?(m=s,v=s+o):(m=s,p=s+o)),frt(e,p,m,g,xO),J$(e,t,r,i,xO,b,p),J$(e,t,r,i,xO,S,m),J$(e,t,r,i,xO,T,g),J$(e,t,r,i,xO,O,v),l[c++]=b,l[c++]=T,l[c++]=O,l[c++]=b,l[c++]=O,l[c++]=S,p++,m++,g++,v++,b+=2,S+=2,T+=2,O+=2}const k8=F(),Cae=F(),Aae=F(),Oae=F(),Rae=F();function frt(e,t,i,r,s){t*=3,i*=3,r*=3,fe(k8,e[t++],e[t++],e[t++]),fe(Cae,e[i++],e[i++],e[i++]),fe(Aae,e[r++],e[r++],e[r++]),Me(Oae,Cae,k8),Me(Rae,Aae,k8),St(s,Rae,Oae),De(s,s)}const uS=F();function mrt(e,t,i,r){const s=e.stageObject,n=s.geometryRecords,o=n.length,a=t.mode!=="absolute-height";let l=0;const c=s.transformation,h=Fs(Be(),c);for(let p=0;p<o;p+=2){const m=n[p].geometry,g=m.getMutableAttribute(D.POSITION).data,v=m.vertexAttributes.get(D.SIZE).data,b=m.vertexAttributes.get(D.MAPPOS).data,S=new nwe(b),T=g.length/3;let O=0,C=!1,M=0;const I=i.spatialReference;for(let $=0;$<T;$++){uS[0]=g[O],uS[1]=g[O+1],uS[2]=g[O+2],Ky(S,i,t,r,K$),a&&(M+=K$.sampledElevation),ur.TESTS_DISABLE_OPTIMIZATIONS?(fe(ac,S.array[S.offset+0],S.array[S.offset+1],K$.z+v[O/3]),r.toRenderCoords(ac,I,ac),et(ac,ac,h)):(fe(ac,g[O+0],g[O+1],g[O+2]),et(ac,ac,c),r.setAltitude(ac,K$.z+v[O/3]),et(ac,ac,h)),g[O]=ac[0],g[O+1]=ac[1],g[O+2]=ac[2];const U=grt/r.unitInMeters;(Math.abs(uS[0]-g[O])>=U||Math.abs(uS[1]-g[O+1])>=U||Math.abs(uS[2]-g[O+2])>=U)&&(C=!0),S.offset+=3,O+=3}C&&(m.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p]),n[p+1].geometry.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(n[p+1])),l+=M/T}return l/o}const ac=F(),xl=F(),K$=new vI,Mae=[0,2,1],Pae=[0,1,2],grt=.01;function yrt(e,t,i,r,s){const n=e.referencesGeometry()&&s?_rt(t,r,s):t,o=e.repurposeFeature(n);try{return e.evaluate({...i,$feature:o})}catch(a){return Ie.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const U8=new Map;function _rt(e,t,i){const{transform:r,hasZ:s,hasM:n}=i;U8.has(t)||U8.set(t,vrt(t));const o=U8.get(t)(e.geometry,r,s,n);return{...e,geometry:o}}function vrt(e){const t={};switch(e){case"esriGeometryPoint":return(i,r,s,n)=>gxe(r,t,i,s,n);case"esriGeometryPolygon":return(i,r,s,n)=>yxe(r,t,i,s,n);case"esriGeometryPolyline":return(i,r,s,n)=>_xe(r,t,i,s,n);case"esriGeometryMultipoint":return(i,r,s,n)=>mxe(r,t,i,s,n);default:return Ie.getLogger("esri.views.2d.support.arcadeOnDemand").error(new se("mapview-arcade",`Unable to handle geometryType: ${e}`)),i=>i}}const Xbt=1.2,brt=vm,wrt=od;class Nz{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.renderGeometries=i,this.boundingBox=r,this._drapeSourceRenderer=s,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(t){this.stage=t}setVisibility(t){if(this.stage!=null&&this._visible!==t){if(this._visible=t,t&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,vi.Geometry.ADD);if(t||this._addedToStage){for(const i of this.renderGeometries)i.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,vi.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,vi.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(t=F()){return fe(t,0,0,0)}getBoundingBoxObjectSpace(t=dn()){return Fr(t)}addObjectState(t,i){t===Xy.Highlight&&(this.renderGeometries.forEach(r=>{const s=r.addHighlight();i.addRenderGeometry(r,s,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,vi.State.HIGHLIGHTS))}removeObjectState(t){this.renderGeometries.forEach(i=>{t.removeRenderGeometry(i)})}removeRenderGeometryObjectState(t,i){t.removeHighlight(i),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,vi.State.HIGHLIGHTS)}computeAttachmentOrigin(t){for(const i of this.renderGeometries)i.computeAttachmentOrigin(hS)&&(t.draped.origin[0]+=hS[0],t.draped.origin[1]+=hS[1],t.draped.num++)}async getProjectedBoundingBox(t,i,r,s,n){Fr(n);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,t,Iae,r),WMe(n,Iae)}if(i){let o;Op(n,hS);const a=_J(n,i);try{o=await i.service.queryElevation(hS[0],hS[1],s,a,"ground")}catch{}w(o)&&(n[2]=Math.min(n[2],o),n[5]=Math.max(n[5],o))}return n}_getRenderGeometryProjectedBoundingRect(t,i,r,s){if(this.boundingBox)Hk(bf,this.boundingBox);else{const n=t.boundingSphere,o=n[3];bf[0]=n[0]-o,bf[1]=n[1]-o,bf[2]=n[2]-o,bf[3]=n[0]+o,bf[4]=n[1]+o,bf[5]=n[2]+o}return i(bf,0,2),this.calculateRelativeScreenBounds&&s.push({location:Op(bf),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),JZ(bf,r)}}const Iae=ei(),bf=dn(),hS=F();class FTe{constructor(t,i,r,s=2048){this.text=t,this._alignment=i,this._parameters=r,this.maxSize=s,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${t}`,this._lines=t.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){const t=this.lineSpacing*(this._lines.length-1),i=this.lineHeight;return Math.ceil(t+i+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*xrt}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(N(this._renderPixelRatio)){const t=this._parameters.definition.pixelRatio;this.maxSize>0?this._renderPixelRatio=Math.min(t,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):this._renderPixelRatio=t}return this._renderPixelRatio}_getLineXOffset(t){switch(this._alignment){case Zv.Left:return this.backgroundHorizontalPadding;case Zv.Center:return(this.displayWidth-this._lineWidths[t])/2;case Zv.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[t]}}render(t,i=0,r=0){t.save();const s=i/=this.renderPixelRatio,n=r/=this.renderPixelRatio,o=this.haloSize,a=this.firstLineYOffset;i+=o,r+=a+this.baselinePosition;const l=this.haloSize>0;l&&this._renderHalo(t,s,n,o,a),this._setFontProperties(t,this.renderedFontSize);for(let c=0;c<this._lines.length;++c){const h=this._lines[c],p=this._getLineXOffset(c);l&&(t.globalCompositeOperation="destination-out",t.fillStyle="rgb(0, 0, 0)",this._fillText(t,h,i+p,r),this._renderLineDecoration(t,i+p,r,this._textWidths[c])),t.globalCompositeOperation="source-over",t.fillStyle=this._parameters.textStyle,this._fillText(t,h,i+this._getLineXOffset(c),r),this._renderLineDecoration(t,i+p,r,this._textWidths[c]),r+=this.lineSpacing}if(ur.TEXT_SHOW_BASELINE){t.strokeStyle=Lae,t.setLineDash([2,2]),t.lineWidth=1;let c=n+a;for(let h=0;h<this._lines.length;++h){const p=c+this.baselinePosition;this._drawLine(t,[s,p],[s+this.displayWidth,p]),c+=this.lineSpacing}}if(ur.TEXT_SHOW_BORDER&&(t.strokeStyle=Lae,t.setLineDash([]),t.lineWidth=1,this._drawBox(t,[s,n],[this.displayWidth,this.displayHeight])),this.hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(t,s,n,c),t.globalCompositeOperation="destination-over",t.fillStyle=this._parameters.backgroundStyle,t.fill()}t.restore()}_renderLineDecoration(t,i,r,s,n=!1){if(this._parameters.definition.font.decoration==="none"||s===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":r+=2*a;break;case"line-through":r-=.33*this.baselinePosition}const l=n?this.haloSize:0;t.strokeStyle=n?this._parameters.haloStyle:this._parameters.textStyle,t.lineWidth=this._toRenderUnit(a+2*l),t.beginPath(),t.moveTo(this._toRenderUnit(i-l),this._toRenderUnit(r)),t.lineTo(this._toRenderUnit(i+s+l),this._toRenderUnit(r)),t.stroke()}_roundedRect(t,i,r,s){i=this._toRenderUnit(i),r=this._toRenderUnit(r);const n=this.renderedWidth,o=this.renderedHeight;s!==0?(s=Xe(s,0,Math.floor(o/2)),t.beginPath(),t.moveTo(i,r+s),t.arcTo(i,r,i+s,r,s),t.lineTo(i+n-s,r),t.arcTo(i+n,r,i+n,r+s,s),t.lineTo(i+n,r+o-s),t.arcTo(i+n,r+o,i+n-s,r+o,s),t.lineTo(i+s,r+o),t.arcTo(i,r+o,i,r+o-s,s),t.closePath()):t.rect(i,r,n,o)}_renderHalo(t,i,r,s,n){const o=this.renderedWidth,a=this.renderedHeight,l=LF(z8,Math.max(o,dS),Math.max(a,dS)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this.renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const h=this.renderedHaloSize<3;c.lineJoin=h?"miter":"round",h?this._renderHaloEmulated(c,s,n):this._renderHaloNative(c,s,n);let p=n+this.baselinePosition;for(let m=0;m<this._lines.length;++m){const g=this._getLineXOffset(m);this._renderLineDecoration(c,s+g,p,this._textWidths[m],!0),p+=this.lineSpacing}t.globalAlpha=this._parameters.definition.halo.color[3],t.drawImage(l,0,0,o,a,this._toRenderUnit(i),this._toRenderUnit(r),o,a),t.globalAlpha=1}_renderHaloEmulated(t,i,r){r+=this.baselinePosition;for(let s=0;s<this._lines.length;++s){const n=this._lines[s],o=this._getLineXOffset(s);for(const[a,l]of kTe)this._fillText(t,n,i+o+this.haloSize*a,r+this.haloSize*l);r+=this.lineSpacing}}_renderHaloNative(t,i,r){const s=2*this.haloSize;r+=this.baselinePosition;for(let n=0;n<this._lines.length;++n){const o=this._lines[n],a=this._getLineXOffset(n),l=5,c=.1;for(let h=0;h<l;h++){const p=1-(l-1)*c+h*c;t.lineWidth=this._toRenderUnit(p*s),this._strokeText(t,o,i+a,r)}r+=this.lineSpacing}}_setFontProperties(t,i){t.font=this._parameters.fontString(i),t.textAlign="left",t.textBaseline="alphabetic"}_ensureTextWidth(){if(w(this._displayWidth))return this._displayWidth;const t=LF(z8,dS,dS).getContext("2d");this._setFontProperties(t,this.fontSize);let i=2*this.haloSize;const r=this._parameters.definition.font;r.style!=="italic"&&r.style!=="oblique"&&r.weight!=="bold"&&r.weight!=="bolder"||(i+=.3*t.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let s=0;for(const n of this._lines){const o=t.measureText(n).width,a=o+i;this._textWidths.push(o),this._lineWidths.push(a),s=Math.max(s,a)}return this._displayWidth=s,this._displayWidth}_ensureHeightMetrics(){if(N(this._heightMetrics)){const t=LF(z8,dS,dS).getContext("2d");this._setFontProperties(t,this.fontSize);const i=t.measureText(this.text+Trt),r=this.hasBackground?t.measureText(this._lines[0]):i,s=this._lines.length===1?r:this.hasBackground?t.measureText(this._lines[this._lines.length-1]):i,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;this._heightMetrics={paddingTop:i.actualBoundingBoxAscent-r.actualBoundingBoxAscent,paddingBottom:i.actualBoundingBoxDescent-s.actualBoundingBoxDescent,lineHeight:n,baselinePosition:i.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(t){return t*this.renderPixelRatio}_toRoundedRenderUnit(t){return Math.round(t*this.renderPixelRatio)}_fillText(t,i,r,s){t.fillText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_strokeText(t,i,r,s){t.strokeText(i,this._toRenderUnit(r),this._toRenderUnit(s))}_drawLine(t,i,r){t.beginPath(),t.moveTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),t.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),t.stroke()}_drawBox(t,i,r){const s=this._toRenderUnit(i[0]),n=this._toRenderUnit(i[1]),o=this._toRenderUnit(r[0]),a=this._toRenderUnit(r[1]),l=Math.floor(s)+.5,c=Math.ceil(s+o)-.5,h=Math.floor(n)+.5,p=Math.ceil(n+a)-.5;t.beginPath(),t.moveTo(l,h),t.lineTo(c,h),t.lineTo(c,p),t.lineTo(l,p),t.lineTo(l,h),t.stroke()}}const kTe=[];for(let t=0;t<360;t+=360/16)kTe.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)]);var Zv;function LF(e,t,i){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=i,e.canvas}(function(e){e[e.Left=0]="Left",e[e.Center=1]="Center",e[e.Right=2]="Right"})(Zv||(Zv={}));const z8={canvas:null},xrt=.2,dS=512,Lae="rgb(255, 0, 255, 0.5)",Trt=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})(),Srt={left:0,center:.5,right:1},$F={"bottom-left":ir(0,0),bottom:ir(.5,0),"bottom-right":ir(1,0),left:ir(0,.5),center:ir(.5,.5),right:ir(1,.5),"top-left":ir(0,1),top:ir(.5,1),"top-right":ir(1,1)};function UTe(e){switch(e){case"left":return Zv.Left;case"right":return Zv.Right;default:return Zv.Center}}function $ae(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function Ert(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function Crt(e,t){switch(t){case"bottom":return e==="left"?"bottom-left":e==="right"?"bottom-right":"bottom";case"center":return e;case"top":return e==="left"?"top-left":e==="right"?"top-right":"top"}}function Art(e){return e==="middle"?"center":e}var Ca,Dae,tk;function TO(e){return e!=null}function pS(e){return typeof e=="number"}function Fz(e){return typeof e=="string"}function Ort(e){return e==null||Fz(e)}function Rn(e,t){e&&e.push(t)}function Rrt(e,t,i,r=Be()){const s=e||0,n=t||0,o=i||0;return s!==0&&jE(r,r,-s/180*Math.PI),n!==0&&GE(r,r,n/180*Math.PI),o!==0&&sU(r,r,o/180*Math.PI),r}function Q0(e,t,i,r,s){const n=e.minSize,o=e.maxSize;if(e.expression)return Rn(s,"Could not convert size info: expression not supported"),!1;if(e.useSymbolValue){const a=r.symbolSize[i];return t.minSize[i]=a,t.maxSize[i]=a,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=Ca.DefinedSize,!0}if(TO(e.field))return TO(e.stops)?e.stops.length===2&&pS(e.stops[0].size)&&pS(e.stops[1].size)?(Nae(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,i),t.type[i]=Ca.DefinedSize,!0):(Rn(s,"Could not convert size info: stops only supported with 2 elements"),!1):pS(n)&&pS(o)&&TO(e.minDataValue)&&TO(e.maxDataValue)?(Nae(n,o,e.minDataValue,e.maxDataValue,t,i),t.type[i]=Ca.DefinedSize,!0):KE[e.valueUnit]!=null?(t.minSize[i]=-1/0,t.maxSize[i]=1/0,t.offset[i]=0,t.factor[i]=1/KE[e.valueUnit],t.type[i]=Ca.DefinedSize,!0):e.valueUnit==="unknown"?(Rn(s,"Could not convert size info: proportional size not supported"),!1):(Rn(s,"Could not convert size info: scale-dependent size not supported"),!1);if(!TO(e.field)){if(e.stops&&e.stops[0]&&pS(e.stops[0].size))return t.minSize[i]=e.stops[0].size,t.maxSize[i]=e.stops[0].size,t.offset[i]=t.minSize[i],t.factor[i]=0,t.type[i]=Ca.DefinedSize,!0;if(pS(n))return t.minSize[i]=n,t.maxSize[i]=n,t.offset[i]=n,t.factor[i]=0,t.type[i]=Ca.DefinedSize,!0}return Rn(s,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Nae(e,t,i,r,s,n){const o=Math.abs(r-i)>0?(t-e)/(r-i):0;s.minSize[n]=o>0?e:t,s.maxSize[n]=o>0?t:e,s.offset[n]=e-i*o,s.factor[n]=o}function Mrt(e,t,i,r){if(e.normalizationField||e.valueRepresentation)return Rn(r,"Could not convert size info: unsupported property"),null;if(!Ort(e.field))return Rn(r,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return Rn(r,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size={field:e.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[Ca.Undefined,Ca.Undefined,Ca.Undefined]};let s;switch(e.axis){case"width":return s=Q0(e,t.size,0,i,r),s?t:null;case"height":return s=Q0(e,t.size,2,i,r),s?t:null;case"depth":return s=Q0(e,t.size,1,i,r),s?t:null;case"width-and-depth":return s=Q0(e,t.size,0,i,r),s&&Q0(e,t.size,1,i,r),s?t:null;case null:case void 0:case"all":return s=Q0(e,t.size,0,i,r),s=s&&Q0(e,t.size,1,i,r),s=s&&Q0(e,t.size,2,i,r),s?t:null;default:return Rn(r,`Could not convert size info: unknown axis "${e.axis}""`),null}}function Prt(e,t,i){for(let s=0;s<3;++s){let n=t.unitInMeters;e.type[s]===Ca.DefinedSize&&(n*=t.modelSize[s],e.type[s]=Ca.DefinedScale),e.minSize[s]=e.minSize[s]/n,e.maxSize[s]=e.maxSize[s]/n,e.offset[s]=e.offset[s]/n,e.factor[s]=e.factor[s]/n}let r;if(e.type[0]!==Ca.Undefined)r=0;else if(e.type[1]!==Ca.Undefined)r=1;else{if(e.type[2]===Ca.Undefined)return Rn(i,"No size axis contains a valid size or scale"),!1;r=2}for(let s=0;s<3;++s)e.type[s]===Ca.Undefined&&(e.minSize[s]=e.minSize[r],e.maxSize[s]=e.maxSize[r],e.offset[s]=e.offset[r],e.factor[s]=e.factor[r],e.type[s]=e.type[r]);return!0}function Fae(e,t,i){e[4*t+0]=i.r/255,e[4*t+1]=i.g/255,e[4*t+2]=i.b/255,e[4*t+3]=i.a}function Irt(e,t,i){if(e.normalizationField)return Rn(i,"Could not convert color info: unsupported property"),null;if(Fz(e.field)){if(!e.stops)return Rn(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return Rn(i,"Could not convert color info: too many color stops"),null;t.color={field:e.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.color.values[s]=n.value,Fae(t.color.colors,s,n.color)}}}else{if(!(e.stops&&e.stops.length>=0))return Rn(i,"Could not convert color info: no field and no colors/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.color.values[s]=1/0,Fae(t.color.colors,s,r)}}return t}function Lrt(e,t,i){if(e.normalizationField)return Rn(i,"Could not convert opacity info: unsupported property"),null;if(Fz(e.field)){if(!e.stops)return Rn(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return Rn(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity={field:e.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const r=e.stops;for(let s=0;s<8;++s){const n=r[Math.min(s,r.length-1)];t.opacity.values[s]=n.value,t.opacity.opacityValues[s]=n.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return Rn(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].opacity;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let s=0;s<8;s++)t.opacity.values[s]=1/0,t.opacity.opacityValues[s]=r}}return t}function B8(e,t,i){const r=i===2&&e.rotationType==="arithmetic";t.offset[i]=r?90:0,t.factor[i]=r?-1:1,t.type[i]=1}function $rt(e,t,i){if(!Fz(e.field))return Rn(i,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return Rn(i,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return B8(e,t.rotation,0),t;case"roll":return B8(e,t.rotation,1),t;case null:case void 0:case"heading":return B8(e,t.rotation,2),t;default:return Rn(i,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}function zTe(e,t,i){if(!e)return null;const r=!t.supportedTypes||!!t.supportedTypes.size,s=!t.supportedTypes||!!t.supportedTypes.color,n=!t.supportedTypes||!!t.supportedTypes.rotation,o=!!t.supportedTypes&&!!t.supportedTypes.opacity,a=e.reduce((l,c)=>{if(!l)return l;if(c.valueExpression)return Rn(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(c.type){case"size":return r?Mrt(c,l,t,i):l;case"color":return s?Irt(c,l,i):l;case"opacity":return o?Lrt(c,l,i):null;case"rotation":return n?$rt(c,l,i):l;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(e.length>0&&a)||a.size||a.color||a.opacity||a.rotation?a&&a.size&&!Prt(a.size,t,i)?null:a:null}function $J(e){return e&&e.size!=null}function _3(e,t){if(!e)return{enabled:!1};if(ur.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const i=zTe(e.visualVariables,t);return i?{enabled:!0,visualVariables:i,materialParameters:BTe(i,t),requiresShaderTransformation:$J(i)}:{enabled:!1}}function v3(e,t,i){if(!t||!e.enabled)return!1;const r=e.visualVariables,s=zTe(t.visualVariables,i);return!!s&&!!(eD(r.size,s.size,"size")&&eD(r.color,s.color,"color")&&eD(r.rotation,s.rotation,"rotation")&&eD(r.opacity,s.opacity,"opacity"))&&(e.visualVariables=s,e.materialParameters=BTe(s,i),e.requiresShaderTransformation=$J(s),!0)}function eD(e,t,i){if(!!e!=!!t||e&&e.field!==t.field)return!1;if(e&&i==="rotation"){const r=e,s=t;for(let n=0;n<3;n++)if(r.type[n]!==s.type[n]||r.offset[n]!==s.offset[n]||r.factor[n]!==s.factor[n])return!1}return!0}function BTe(e,t){const i={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},r=$J(e);return e&&e.size?(i.vvSizeEnabled=!0,i.vvSizeMinSize=e.size.minSize,i.vvSizeMaxSize=e.size.maxSize,i.vvSizeOffset=e.size.offset,i.vvSizeFactor=e.size.factor):e&&r&&(i.vvSizeValue=t.transformation.scale),e&&r&&(i.vvSymbolAnchor=t.transformation.anchor,i.vvSymbolRotationMatrix=Qr(),Im(WM),Rrt(t.transformation.rotation[2],t.transformation.rotation[0],t.transformation.rotation[1],WM),_d(i.vvSymbolRotationMatrix,WM)),e&&e.color&&(i.vvColorEnabled=!0,i.vvColorValues=e.color.values,i.vvColorColors=e.color.colors),e&&e.opacity&&(i.vvOpacityEnabled=!0,i.vvOpacityValues=e.opacity.values,i.vvOpacityOpacities=e.opacity.opacityValues),i}(function(e){e[e.Undefined=0]="Undefined",e[e.DefinedSize=1]="DefinedSize",e[e.DefinedScale=2]="DefinedScale"})(Ca||(Ca={})),function(e){e[e.Undefined=0]="Undefined",e[e.DefinedAngle=1]="DefinedAngle"}(Dae||(Dae={})),function(e){const t=Be(),i=F();function r(n,o,a){if(!n.vvSizeEnabled)return a;js(t,a);const l=n.vvSymbolRotationMatrix;Vm(WM,l[0],l[1],l[2],0,l[3],l[4],l[5],0,l[6],l[7],l[8],0,0,0,0,1),hs(t,t,WM);for(let c=0;c<3;++c){const h=n.vvSizeOffset[c]+o[0]*n.vvSizeFactor[c];i[c]=Xe(h,n.vvSizeMinSize[c],n.vvSizeMaxSize[c])}return rU(t,t,i),hl(t,t,n.vvSymbolAnchor),t}function s(n,o,a){if(!o.vvSizeEnabled)return fe(n,1,1,1);for(let l=0;l<3;++l){const c=o.vvSizeOffset[l]+a[0]*o.vvSizeFactor[l];n[l]=Xe(c,o.vvSizeMinSize[l],o.vvSizeMaxSize[l])}return n}e.evaluateModelTransform=r,e.evaluateModelTransformScale=s}(tk||(tk={}));const WM=Be(),pW=tk.evaluateModelTransform,Drt=tk.evaluateModelTransformScale;class Nrt{constructor(){this.visible=!0}}class OC{constructor(t,i,r={}){this.data=t,this.material=i,this.boundingSphere=di(),this.instanceParameters=new Nrt,this._transformation=Be(),this._shaderTransformationDirty=!0,this.layerUid=$t(r.layerUid,null),this.graphicUid=$t(r.graphicUid,null),this.id=r.id?r.id:Gl(),this.boundingInfo=$t(r.boundingInfo,null),this.calculateShaderTransformation=$t(r.calculateShaderTransformation,null),this.castShadow=!!r.castShadow&&r.castShadow}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(t,i,r=Dx(t)){N(this.boundingInfo)||(et(i,this.boundingInfo.getCenter(),t),i[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return w(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return N(this.calculateShaderTransformation)?$t(this.transformation,Dn):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=Be()),js(this._shaderTransformation,this.calculateShaderTransformation($t(this.transformation,Dn))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(w(this._transformation)&&et(t,t,this._transformation),!0);const i=this.indices.get(D.POSITION),r=this.vertexAttributes.get(D.POSITION);return!!pbe(r,i,t)&&(w(this._transformation)&&et(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new Z5(Xy.Highlight),i=this.instanceParameters;return i.highlights=Hq(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=qq(i.highlights,t)}}const Frt=Be(),kae=Ke(0,0,1),krt=16,Urt=1.5,Jw=pJ,zrt=[Jw/2,Jw/2,1-Jw/2,1-Jw/2],Brt=[h3*Jw,h3*Jw];class b3 extends Qm{constructor(t,i,r,s){super(t,i,r,s),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}async doLoad(t){this._validateOrThrow();const i=this._prepareMaterialParameters(),r=this._getPrimitive();if(w(r))this._prepareResourcesPrimitive(i,r);else{const s=b5e(this.symbol,this.symbolLayer),n=Yk(s);n&&n.mediaType==="application/json"?await this._prepareResourcesCIM(i,JSON.parse(n.data),t):await this._prepareResourcesHref(i,s,t)}}_validateOrThrow(){if(this._drivenProperties.size)return;const t=vz(this._getIconSize());if(t)throw new se("graphics3diconsymbollayer:invalid-size",t)}_getIconSize(){const t=this.symbolLayer,i=Math.round(t.size!=null?No(t.size):krt);return this._drivenProperties.size?Math.max(i,64):i}_generateTextureCIM(t){const i=this._getGraphicHash(t);let r=i===""?null:this._cimSymbolTextures.get(i);if(!r){const s={scaleFactor:this._cimScaleFactorOrFunction},n=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,t,"esriGeometryPoint",s,null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",n.anchorPosition);const o={width:n.imageData.width,height:n.imageData.height,powerOfTwoResizeMode:jv.PAD};r=new sn(n.imageData,o),this._cimSymbolTextures.set(i,r),this._context.stage.add(r)}return r}_computeSize(t,i){const r=t.width/t.height;return r>1?[i,Math.round(i/r)]:[Math.round(i*r),i]}_prepareMaterialParameters(){const t={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},i=this.symbol;if(Vrt(i)){const{screenLength:r,minWorldLength:s,maxWorldLength:n}=i.verticalOffset;t.verticalOffset={screenLength:No(r),minWorldLength:s||0,maxWorldLength:n!=null?n:1/0}}return this._context.screenSizePerspectiveEnabled&&(t.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),t.occlusionTest=!0,t.hasSlicePlane=this._context.slicePlaneEnabled,t}_prepareResourcesPrimitive(t,i){const r=this._getOutlineSize();if(V8(i)&&r===0)throw new Error("Nothing to render");this._outlineSize=r,t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize;const s=this._context.sharedResources.textures.fromData(i,()=>Xwe(i));this._texture=s.texture,this._releaseTexture=s,t.textureIsSignedDistanceField=!0,t.distanceFieldBoundingBox=zrt,t.textureId=this._texture.id;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/Jw,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesHref(t,i,r){if(!Ce("esri-canvas-svg-support")&&aX(i))throw new se("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize(),t.color=this._getFillColor(),t.outlineColor=this._getOutlineColor(),t.outlineSize=this._outlineSize,t.textureIsSignedDistanceField=!1;const s=this._getIconSize(),n=s*this._context.graphicsCoreOwner.view.state.pixelRatio,o=await Xp(this._context.sharedResources.textures.fromUrl(i,n,{signal:r}));if(o.ok===!1)throw e0(o.error),new se("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${i})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.params;this._size=this._computeSize(l,s),t.textureId=a.id,this._createMaterialAndAddToStage(t,this._context.stage)}async _prepareResourcesCIM(t,i,r){const s=new UC({data:i});if(!this._context.sharedResources.cimSymbolRasterizer){const h=(await _e(()=>import("./CIMSymbolRasterizer.e7fd5232.js"),["CIMSymbolRasterizer.e7fd5232.js","cimAnalyzer.447b46da.js","CIMSymbolHelper.f189aa12.js","BidiEngine.4cfb7343.js","enums.ba1e21c6.js","number.08b65821.js"],import.meta.url)).CIMSymbolRasterizer;Ui(r),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new h(this._context.renderCoordsHelper.spatialReference,!0))}const n=this._context.layer.fields?this._context.layer.fields.map(h=>h.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(s,n,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:r}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const h=this._context.renderer;if(isNaN(h.scaleExpression)){const p=h.scaleExpression,m=await kRe(p,this._context.layer.spatialReference,n);a=(g,v,b)=>{const S=yrt(m,g,{$view:b},"esriGeometryPoint",v);return S!==null?S:1}}else o=Number(h.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];Ui(r);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(h=>c.get(h).name),this._cimMaterialParametersInfo=t,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||BPe}_getOutlineSize(){let t=0;const i=this.symbolLayer;return w(i.outline)&&i.outline.size!=null?Math.max(No(i.outline.size),0):(t=V8(this._getPrimitive())?Urt:0,Math.max(t,0))}_getOutlineColor(){const t=this._getLayerOpacity(),i=this.symbolLayer,r=Mn(i,"outline","color");if(w(r)){const s=at.toUnitRGB(r),n=r.a*t;return[s[0],s[1],s[2],n]}return[0,0,0,0]}_getFillColor(){if(V8(this._getPrimitive()))return brt;const t=N(this._getPrimitive()),i=Mn(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(i,{hasIntrinsicColor:t})}_getAnchorPos(t,i){return t==="relative"?ir((i.x||0)+.5,.5-(i.y||0)):t in $F?$F[t]:$F.center}_createMaterialAndAddToStage(t,i){if(this._cimLayers?this._fastUpdates={enabled:!1}:this._fastUpdates=_3(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(t,this._fastUpdates.materialParameters),this._cimLayers){let r=w(t.textureId)?this._cimSymbolMaterials.get(t.textureId):null;return r||(r=new xC(t),this._cimSymbolMaterials.set($t(t.textureId,0),r),i.add(r)),r}return this._material=new xC(t),i.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(t=>{t.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(t=>this._context.stage.remove(t)),this._cimSymbolTextures.clear(),this._releaseTexture=vr(this._releaseTexture)}_getScaleFactor(t,i){if(this._drivenProperties.size&&t.size){for(let r=0;r<3;r++){const s=t.size[r];s&&s!=="symbol-value"&&s!=="proportional"&&(t.size[r]=No(s))}if(t.size[0]==="symbol-value")return 1;if(isFinite(+t.size[0]))return+t.size[0]/i;if(isFinite(+t.size[2]))return+t.size[2]/i}return 1}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;let r,s;if(this._cimLayers){if(!this._cimLayers.length)return null;const p=this._generateTextureCIM(i),m={textureId:p.id,...this._cimMaterialParametersInfo};s=this._createMaterialAndAddToStage(m,this._context.stage),r=[p.params.width,p.params.height]}else r=this._size,s=this._material;const n=f3(i.geometry);if(N(n))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const o=t.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!this._fastUpdates.enabled||!this._fastUpdates.visualVariables.size){const p=r[0]>r[1]?r[0]:r[1];l=this._getScaleFactor(o,p)}l*=this._symbolTextureRatio;const c=[r[0]*l,r[1]*l],h=this.setGraphicElevationContext(i,new lh);return this.ensureDrapedStatus(h.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(i,n,s,a,c,t.layer.uid):this._createAs3DShape(i,n,s,a,c,h,i.uid)}layerOpacityChanged(){const t=this._getFillColor(),i=this._getOutlineColor();return this._forEachMaterial(r=>{r.setParameters({color:t}),r.setParameters({outlineColor:i})}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=_I(b3.elevationModeChangeTypes,r,s);if(n!==_s.UPDATE)return n;const o=xd(s)||s==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(t=>{t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!v3(this._fastUpdates,i,this._fastVisualVariableConvertOptions()))return In.Recreate_Symbol;w(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return In.Fast_Update}_defaultElevationInfoNoZ(){return Grt}_createAs3DShape(t,i,r,s,n,o,a){const l=this.getFastUpdateAttrValues(t),c=l?g=>pW(this._fastUpdates.materialParameters,l,g):null,h=[Sc.createPointGeometry(kae,null,s,n,jrt,null,l)],p=EJ(this._context,i,h,[r],o,this._context.layer.uid,a,c);if(p===null)return null;const m=new Ym(this,p.object,h,null,null,d3,o);return m.alignedSampledElevation=p.sampledElevation,m.needsElevationUpdates=xd(o.mode)||o.mode==="absolute-height",m.getScreenSize=this._createScreenSizeGetter(n,c),m.calculateRelativeScreenBounds=g=>r.calculateRelativeScreenBounds(m.getScreenSize(),1,g),p3(m,i,this._context.elevationProvider),m}_createAsOverlay(t,i,r,s,n,o){r.renderPriority=this._renderPriority;const a=di();po(i,a,this._context.overlaySR),a[2]=IJ;const l=this._context.clippingExtent;if(w(l)&&!QZ(l,a))return null;const c=this.getFastUpdateAttrValues(t),h=c?v=>pW(this._fastUpdates.materialParameters,c,v):null,p=Sc.createPointGeometry(kae,a,s,n,null,null,c),m=new OC(p,r,{layerUid:o,graphicUid:t.uid,calculateShaderTransformation:h});a[3]=0,Ap(m.boundingSphere,a);const g=new Nz(this,[m],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(n,h),g.calculateRelativeScreenBounds=v=>r.calculateRelativeScreenBounds(g.getScreenSize(),1,v),g}_createScreenSizeGetter(t,i){const r=this._outlineSize+2;if(this._fastUpdates.enabled){const s=t[0]/this._symbolTextureRatio,n=t[1]/this._symbolTextureRatio;return(o=yt())=>{const a=i(Frt);return o[0]=a[0]*s+r,o[1]=a[5]*n+r,o}}{const s=t[0]/this._symbolTextureRatio+r,n=t[1]/this._symbolTextureRatio+r;return(o=yt())=>(o[0]=s,o[1]=n,o)}}_fastVisualVariableConvertOptions(){const t=this._size[0]>this._size[1]?this._size[0]:this._size[1],i=Ke(t,t,t),r=eh(1),s=t*r;return{modelSize:i,symbolSize:Ke(s,s,s),unitInMeters:r,transformation:{anchor:ol,scale:pm,rotation:ol}}}_getGraphicHash(t){let i="";for(const r of this._cimRequiredFields)i+=r+t.attributes[r];return i}_forEachMaterial(t){w(this._material)&&t(this._material),this._cimSymbolMaterials.forEach(t)}test(){return{...super.test(),material:this._material}}}function Vrt(e){return e&&e.type==="point-3d"&&e.hasVisibleVerticalOffset()}function V8(e){return!N(e)&&(e==="cross"||e==="x")}b3.PRIMITIVE_SIZE=Brt,b3.elevationModeChangeTypes={definedChanged:_s.UPDATE,staysOnTheGround:_s.NONE,onTheGroundChanged:_s.RECREATE};const Grt={mode:"relative-to-ground",offset:0},jrt=ki(0,0,0,1);function fW(e){const t=[],i=[];Wrt(e,i,t);const r=i[0][1].data,s=t[0][1].length,n=new Uint16Array(s);return Zrt(e,i,t),Xrt(e,i,t,n),Qrt(e,i,t,n),Yrt(e,i,t,n),Jrt(e,i,t,n),Krt(e,i,t,n),est(e,i,t,r),new ss(i,t,Zl.Line)}function Hrt(e,t,i,r){const s=e.type==="polygon"?Nm.CCW_IS_HOLE:Nm.NONE,n=e.type==="polygon"?e.rings:e.paths,{position:o,outlines:a}=wI(n,e.hasZ,s),l=new Float64Array(o.length),c=Cxe(o,e.spatialReference,0,l,0,o,0,o.length/3,t,i,r),h=c!=null;return{lines:h?VTe(a,o,l):[],projectionSuccess:h,sampledElevation:c}}function VTe(e,t,i){const r=new Array;for(const{index:s,count:n}of e){if(n<=1)continue;const o=3*s,a=o+3*n;r.push({position:t.subarray(o,a),mapPosition:i?i.subarray(o,a):void 0})}return r}function qrt(e,t){const i=e.type==="polygon"?Nm.CCW_IS_HOLE:Nm.NONE,r=e.type==="polygon"?e.rings:e.paths,{position:s,outlines:n}=wI(r,!1,i),o=Lr(s,e.spatialReference,0,s,t,0,s.length/3);for(let a=2;a<s.length;a+=3)s[a]=IJ;return{lines:o?VTe(n,s):[],projectionSuccess:o}}function Wrt(e,t,i){const{attributeData:{position:r},removeDuplicateStartEnd:s}=e,n=tst(r)&&s===rT.REMOVE,o=r.length/3-(n?1:0),a=new Uint32Array(2*(o-1)),l=n?iZ(r,0,r.length-3):r;let c=0;for(let h=0;h<o-1;h++)a[c++]=h,a[c++]=h+1;t.push([D.POSITION,{size:3,data:l,exclusive:n}]),i.push([D.POSITION,a])}function Zrt(e,t,i){const r=e.attributeData.mapPosition;N(r)||(i.push([D.MAPPOS,i[0][1]]),t.push([D.MAPPOS,{size:3,data:r}]))}function Xrt(e,t,i,r){if(w(e.attributeData.colorFeature))return;const s=e.attributeData.color;t.push([D.COLOR,{size:4,data:$t(s,wrt)}]),i.push([D.COLOR,r])}function Yrt(e,t,i,r){const s=e.attributeData.colorFeature;N(s)||(t.push([D.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([D.COLOR,r]))}function Qrt(e,t,i,r){if(w(e.attributeData.sizeFeature))return;const s=e.attributeData.size;t.push([D.SIZE,{size:1,data:[$t(s,1)]}]),i.push([D.SIZE,r])}function Jrt(e,t,i,r){const s=e.attributeData.sizeFeature;N(s)||(t.push([D.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([D.SIZEFEATUREATTRIBUTE,r]))}function Krt(e,t,i,r){const s=e.attributeData.opacityFeature;N(s)||(t.push([D.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([s])}]),i.push([D.OPACITYFEATUREATTRIBUTE,r]))}function est(e,t,i,r){if(N(e.overlayInfo)||e.overlayInfo.renderCoordsHelper.viewingMode!==st.Global||!e.overlayInfo.spatialReference.isGeographic)return;const s=new Float64Array(r.length),n=ji(e.overlayInfo.spatialReference);for(let m=0;m<s.length;m+=3)EX(r,m,s,m,n);const o=r.length/3,a=new Float32Array(o+1);let l=ist,c=rst,h=0,p=0;fe(l,s[p++],s[p++],s[p++]),a[0]=0;for(let m=1;m<o+1;++m)m===o&&(p=0),fe(c,s[p++],s[p++],s[p++]),h+=m1e(l,c),a[m]=h,[l,c]=[c,l];t.push([D.DISTANCETOSTART,{size:1,data:a}]),i.push([D.DISTANCETOSTART,i[0][1]])}function tst(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}var rT;(function(e){e[e.KEEP=0]="KEEP",e[e.REMOVE=1]="REMOVE"})(rT||(rT={}));const ist=F(),rst=F();function mW(e){switch(e){case"butt":return pd.BUTT;case"square":return pd.SQUARE;case"round":return pd.ROUND;default:return null}}const ik=64,GTe=ik/2,jTe=GTe/5;function sst(e,t){return w(t)?nst(e,ost(t.style)):null}function nst(e,t){return e.fromData(t,()=>Xwe(t,ik,GTe,jTe))}function ost(e){return e==="diamond"?"kite":e}function ast(e){const t=new dr,i=e.hasMultipassTerrain&&(e.output===ue.Color||e.output===ue.Alpha);t.include(Xxe,e),e.output===ue.Depth&&t.include(A1,e);const{vertex:r,fragment:s}=t;return s.include(Xc),Yu(t,e),t.attributes.add(D.POSITION,"vec3"),t.attributes.add(D.UV0,"vec2"),t.attributes.add(D.AUXPOS1,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vUV","vec2"),t.varyings.add("vSize","float"),t.varyings.add("linearDepth","float"),i&&t.varyings.add("depth","float"),r.code.add(E`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),r.uniforms.add([new Ni("nearFar",(n,o)=>o.camera.nearFar),new Ci("viewport",(n,o)=>o.camera.fullViewport)]),r.code.add(E`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),r.code.add(E`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),e.draped||(r.uniforms.add(new Hr("inverseProjectionMatrix",(n,o)=>o.camera.inverseProjectionMatrix)),r.code.add(E`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),r.code.add(E`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),r.uniforms.add(new lt("perScreenPixelRatio",(n,o)=>o.camera.perScreenPixelRatio)),r.code.add(E`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${e.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),r.uniforms.add(new lt("pixelRatio",(n,o)=>o.camera.pixelRatio)),r.code.add(E`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${E.float(ik/jTe)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),e.draped||r.code.add(E`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),r.code.add(E`
        ${i?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),i&&t.include(oh,e),t.include(Ns,e),s.uniforms.add([new Ci("intrinsicColor",n=>n.color),new ai("tex",n=>n.texture)]),s.include(Wm),s.code.add(E`
  void main() {
    discardBySlice(vpos);
    ${i?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${E.float(1/ik)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${E.float(la)}) {
      discard;
    }

    ${e.output===ue.Alpha?E`gl_FragColor = vec4(finalColor.a);`:""}
    ${e.output===ue.Color?E`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===ue.Color&&e.transparencyPassType===Pt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${e.output===ue.Highlight?E`gl_FragColor = vec4(1.0);`:""}
    ${e.output===ue.Depth?E`outputDepth(linearDepth);`:""}
  }
  `),t}const lst=Object.freeze(Object.defineProperty({__proto__:null,build:ast},Symbol.toStringTag,{value:"Module"})),HTe=new Map([[D.POSITION,0],[D.UV0,2],[D.AUXPOS1,3],[D.SIZE,6],[D.SIZEFEATUREATTRIBUTE,6],[D.COLOR,5],[D.COLORFEATUREATTRIBUTE,5],[D.OPACITYFEATUREATTRIBUTE,7]]);class kz extends $r{initializeProgram(t){const i=kz.shader.get().build(this.configuration);return new Sr(t.rctx,i,HTe)}_makePipelineState(t,i){const r=this.configuration,s=t===Pt.NONE;return ni({blending:r.output===ue.Color||r.output===ue.Alpha?s?Qu:p0(t):null,depthTest:{func:C1(t)},depthWrite:s?r.writeDepth&&ec:mz(t),colorWrite:wi,stencilWrite:r.hasOccludees?Fm:null,stencilTest:r.hasOccludees?i?y1:O1:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=ni({blending:Qu,depthTest:Q5,depthWrite:null,colorWrite:wi,stencilWrite:null,stencilTest:Kxe}),this._occluderPipelineOpaque=ni({blending:Qu,depthTest:Q5,depthWrite:null,colorWrite:wi,stencilWrite:Qxe,stencilTest:Jxe}),this._occluderPipelineMaskWrite=ni({blending:null,depthTest:OJ,depthWrite:null,colorWrite:null,stencilWrite:Fm,stencilTest:y1})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:this.configuration.occluder?t===Ue.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:t===Ue.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(t,i)}}kz.shader=new Tr(lst,()=>_e(()=>import("./LineMarker.glsl.91c2f473.js"),[],import.meta.url));class Ha extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.transparencyPassType=Pt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([ee({count:ue.COUNT})],Ha.prototype,"output",void 0),u([ee({count:Pt.COUNT})],Ha.prototype,"transparencyPassType",void 0),u([ee()],Ha.prototype,"occluder",void 0),u([ee()],Ha.prototype,"hasSlicePlane",void 0),u([ee()],Ha.prototype,"writeDepth",void 0),u([ee()],Ha.prototype,"draped",void 0),u([ee()],Ha.prototype,"hasCap",void 0),u([ee()],Ha.prototype,"vvSize",void 0),u([ee()],Ha.prototype,"vvColor",void 0),u([ee()],Ha.prototype,"vvOpacity",void 0),u([ee()],Ha.prototype,"hasOccludees",void 0),u([ee()],Ha.prototype,"hasMultipassTerrain",void 0),u([ee()],Ha.prototype,"cullAboveGround",void 0),u([ee({constValue:!0})],Ha.prototype,"hasVvInstancing",void 0),u([ee({constValue:!0})],Ha.prototype,"hasSliceTranslatedView",void 0);class cst extends Xm{constructor(t){super(t,new hst),this._vertexAttributeLocations=HTe,this.techniqueConfig=new Ha,this.layout=this.createLayout()}dispose(){}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.draped=i.slot===Ue.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==pd.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===ts.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const t=As().vec3f(D.POSITION).vec2f(D.UV0).vec3f(D.AUXPOS1);return this.parameters.vvSizeEnabled?t.f32(D.SIZEFEATUREATTRIBUTE):t.f32(D.SIZE),this.parameters.vvColorEnabled?t.f32(D.COLORFEATUREATTRIBUTE):t.vec4f(D.COLOR),this.parameters.vvOpacityEnabled&&t.f32(D.OPACITYFEATUREATTRIBUTE),t}createBufferWriter(){return new dst(this.layout,this.parameters)}requiresSlot(t,i){if(t===Ue.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===ts.OccludeAndTransparentStencil)return t===Ue.OPAQUE_MATERIAL||t===Ue.OCCLUDER_MATERIAL||t===Ue.TRANSPARENT_OCCLUDER_MATERIAL;const r=Kx(i);return r===ue.Color||r===ue.Alpha?t===(this.parameters.writeDepth?Ue.TRANSPARENT_MATERIAL:Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):t===Ue.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Alpha||t.output===ue.Highlight||t.output===ue.Depth?new ust(t):null}}class ust extends vQ{_updateParameters(t){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(kz,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==ue.Color&&this._output!==ue.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class hst extends fJ{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=pd.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class dst{constructor(t,i){this.vertexBufferLayout=t,this.parameters=i}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(){return this.parameters.placement==="begin-end"?12:6}write(t,i,r,s){const n=i.vertexAttributes.get(D.POSITION).data,o=n.length/3;let a=1,l=0;this.parameters.vvSizeEnabled?l=i.vertexAttributes.get(D.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(D.SIZE)&&(a=i.vertexAttributes.get(D.SIZE).data[0]);let c=[1,1,1,1],h=0;this.parameters.vvColorEnabled?h=i.vertexAttributes.get(D.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(D.COLOR)&&(c=i.vertexAttributes.get(D.COLOR).data);let p=0;this.parameters.vvOpacityEnabled&&(p=i.vertexAttributes.get(D.OPACITYFEATUREATTRIBUTE).data[0]);const m=t.transformation,g=new Float32Array(r.buffer);let v=s*(this.vertexBufferLayout.stride/4);const b=(C,M,I,$)=>{if(g[v++]=C[0],g[v++]=C[1],g[v++]=C[2],g[v++]=I[0],g[v++]=I[1],g[v++]=M[0],g[v++]=M[1],g[v++]=M[2],this.parameters.vvSizeEnabled?g[v++]=l:g[v++]=a,this.parameters.vvColorEnabled)g[v++]=h;else{const U=Math.min(4*$,c.length-4);g[v++]=c[U+0],g[v++]=c[U+1],g[v++]=c[U+2],g[v++]=c[U+3]}this.parameters.vvOpacityEnabled&&(g[v++]=p)};let S;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(S||(S={}));const T=(C,M)=>{const I=fe(pst,n[3*C],n[3*C+1],n[3*C+2]),$=fst;let U=C+M;do fe($,n[3*U],n[3*U+1],n[3*U+2]),U+=M;while(Tx(I,$)&&U>=0&&U<o);m&&(et(I,I,m),et($,$,m)),b(I,$,[-1,-1],C),b(I,$,[1,-1],C),b(I,$,[1,1],C),b(I,$,[-1,-1],C),b(I,$,[1,1],C),b(I,$,[-1,1],C)},O=this.parameters.placement;O!=="begin"&&O!=="begin-end"||T(0,S.ASCENDING),O!=="end"&&O!=="begin-end"||T(o-1,S.DESCENDING)}}const pst=F(),fst=F(),_a={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},mst={dash:_a.dash,"dash-dot":[..._a.dash,..._a.dot],dot:_a.dot,"long-dash":_a["long-dash"],"long-dash-dot":[..._a["long-dash"],..._a.dot],"long-dash-dot-dot":[..._a["long-dash"],..._a.dot,..._a.dot],none:null,"short-dash":_a["short-dash"],"short-dash-dot":[..._a["short-dash"],..._a["short-dot"]],"short-dash-dot-dot":[..._a["short-dash"],..._a["short-dot"],..._a["short-dot"]],"short-dot":_a["short-dot"],solid:null},gst=8;function yst(e,t=2){return N(e)?e:{pattern:e.slice(),pixelRatio:t}}function Ybt(e,t=2){return{pattern:[e,e],pixelRatio:t}}function qTe(e){return w(e)&&e.type==="style"?_st(e.style):null}function _st(e){return w(e)?yst(mst[e],gst):null}const vst=["polyline","polygon","extent"];class Uz extends Qm{constructor(t,i,r,s){super(t,i,r,s),this._uniformSize=1}async doLoad(){if(this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=_3(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1},!this._drivenProperties.size){const t=this.symbolLayer.size!=null?this.symbolLayer.size:eh(1);if(t<0)throw new se("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=t}this._markerTexture=sst(this._context.sharedResources.textures,this.symbolLayer.marker)}_getMaterialParameters(t,i=!1){var n;const r=this._getCombinedOpacityAndColor(i&&this._markerColor||this._materialColor);this._patternHidesLine&&!i&&(r[3]=0);const s={width:this._computeMaterialWidth((n=this.symbolLayer)==null?void 0:n.size),color:r,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:mW(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:t,stipplePattern:qTe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...s,...this._fastUpdates.materialParameters}:s}get _materialColor(){return Cn(this.symbolLayer.material,t=>t.color)}get _markerColor(){return Cn(this.symbolLayer.marker,t=>t.color)}get lineMaterial(){return N(this._lineMaterial)&&(this._lineMaterial=new Z2(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return N(this._ringMaterial)&&(this._ringMaterial=new Z2(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return N(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new Z2({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return N(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new Z2({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return N(this._markerMaterial)&&w(this.symbolLayer.marker)&&w(this._markerTexture)&&(this._markerMaterial=new cst({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(t=>this._context.stage.remove(t)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=vr(this._markerTexture)}_getDrivenSize(t){return this._drivenProperties.size&&t.size?No(ftt(t.size)):1}_getSizeFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?Ly(this._fastUpdates.visualVariables.size.field,t):null}_getDrivenColor(t){const i=ki(1,1,1,1);return this._drivenProperties.color&&t.color&&(i[0]=t.color[0],i[1]=t.color[1],i[2]=t.color[2],t.color.length>0&&(i[3]=t.color[3])),this._drivenProperties.opacity&&t.opacity&&(i[3]=t.opacity),i}_getColorFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?Ly(this._fastUpdates.visualVariables.color.field,t):null}_getOpacityFeatureAttributeData(t){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?Ly(this._fastUpdates.visualVariables.opacity.field,t):null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,vst,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new lh);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.draped?this._createAsOverlay(t,this._context.layer.uid):this._createAs3DShape(t,r,i.uid)}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!v3(this._fastUpdates,i,this._vvConvertOptions))return In.Recreate_Symbol;this._forEachMaterial(s=>s.setParameters(this._fastUpdates.materialParameters))}return In.Fast_Update}prepareSymbolLayerPatch(t){var n,o;if(t.diff.type!=="partial")return;const i=t.diff.diff,r={};((n=i.size)==null?void 0:n.type)==="complete"&&(r.width=this._computeMaterialWidth(i.size.newValue),delete i.size),((o=i.cap)==null?void 0:o.type)==="complete"&&(r.cap=mW($t(i.cap.newValue,"butt")),delete i.cap);const s=this._prepareMarkerPatch(t,i);this._prepareMaterialPatch(t,i,s),t.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(r)))}layerOpacityChanged(){return this._forEachMaterial((t,i)=>this._updateMaterialLayerOpacity(t,i)),!0}_forEachMaterial(t){w(this._lineMaterial)&&t(this._lineMaterial),w(this._ringMaterial)&&t(this._ringMaterial),w(this._wireframeLineMaterial)&&t(this._wireframeLineMaterial),w(this._wireframeRingMaterial)&&t(this._wireframeRingMaterial),w(this._markerMaterial)&&t(this._markerMaterial,!0)}_updateMaterialLayerOpacity(t,i=!1){const r=t.parameters.color,s=Mn(this.symbolLayer,"material","color"),n=this._patternHidesLine&&!i?0:this._getCombinedOpacity(s),o=ki(r[0],r[1],r[2],n);t.setParameters({color:o})}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=_I(Uz.elevationModeChangeTypes,r,s);if(n!==_s.UPDATE)return n;const o=xd(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){const t={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(i=>i.setParameters(t)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(t){switch(t.type){case"extent":if(t instanceof zi)return Ku.fromExtent(t);break;case"polygon":case"polyline":return t}return null}_createAs3DShape(t,i,r){const s=t.graphic,n=this._getGeometryAsPolygonOrPolyline(s.geometry),o=n.type==="polygon"?n.rings:n.paths,a=new Array,l=new Array,c=new Array,h=dn(),p=Hrt(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(p,o,m,"LineSymbol3DLayer");for(let b=0;b<p.lines.length;b++){const{position:S,mapPosition:T}=p.lines[b];if(w(this._context.clippingExtent)&&(Fr(h),Vu(h,T),!Rp(h,this._context.clippingExtent)))continue;const O=this._createGeometry(t,S,T,n.type,ZM.ELEVATED);a.push(O),l.push(n.type==="polygon"?this.ringMaterial:this.lineMaterial),c.push(Dn),ur.LINE_WIREFRAMES&&(a.push(O.cloneShallow()),l.push(n.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial),c.push(Dn));const C=this.markerMaterial;w(C)&&(a.push(O.cloneShallow()),l.push(C),c.push(Dn))}if(a.length===0)return null;const g=new m0({geometries:a,materials:l,transformations:c,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),v=new Ym(this,g,a,null,null,Oet,i);return v.alignedSampledElevation=p.sampledElevation,v.needsElevationUpdates=xd(i.mode),v}_createGeometry(t,i,r,s,n){const o=s==="polygon"?rT.REMOVE:rT.KEEP,a=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,l=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;return fW({overlayInfo:n===ZM.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:o,uniformSize:this._uniformSize,attributeData:{position:i,mapPosition:r,size:l?null:this._getDrivenSize(t.renderingInfo),color:a?null:this._getDrivenColor(t.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(t.graphic),colorFeature:this._getColorFeatureAttributeData(t.graphic),opacityFeature:this._getOpacityFeatureAttributeData(t.graphic)}})}_createAsOverlay(t,i){const r=t.graphic,s=this._getGeometryAsPolygonOrPolyline(r.geometry),n=s.type==="polygon"?s.rings:s.paths,o=s.type==="polygon"?this.ringMaterial:this.lineMaterial;o.renderPriority=this._renderPriority;const a=ur.LINE_WIREFRAMES?s.type==="polygon"?this.wireframeRingMaterial:this.wireframeLineMaterial:null,l=this.markerMaterial;w(a)&&(a.renderPriority=this._renderPriority-.001),w(l)&&(l.renderPriority=this._renderPriority-.002);const c=new Array,h=dn(),p=Fr(),m=qrt(s,this._context.overlaySR),g=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(m,n,g,"LineSymbol3DLayer");for(const v of m.lines){if(Fr(h),Vu(h,v.position),!Rp(h,this._context.clippingExtent))continue;kE(p,h);const b=this._createGeometry(t,v.position,null,s.type,ZM.DRAPED),S=O=>{const C=new OC(b,O,{layerUid:i,graphicUid:r.uid});return c.push(C),C};if(w(l)){const O=S(l),C=this.symbolLayer.marker.placement;C!=="begin"&&C!=="begin-end"||Vu(h,v.position,0,1),C!=="end"&&C!=="begin-end"||Vu(h,v.position,v.position.length-3,1),this._updateBoundingSphere(O,h)}const T=S(o);if(this._updateBoundingSphere(T,h),ur.LINE_WIREFRAMES){const O=S(a);this._updateBoundingSphere(O,h)}}return new Nz(this,c,p,this._context.drapeSourceRenderer)}_updateBoundingSphere(t,i){_r(t.boundingSphere,.5*(i[0]+i[3]),.5*(i[1]+i[4]),0,.5*Math.sqrt((i[3]-i[0])*(i[3]-i[0])+(i[4]-i[1])*(i[4]-i[1])))}get _patternHidesLine(){const t=this.symbolLayer.pattern;return w(t)&&t.type==="style"&&t.style==="none"}_computeMaterialWidth(t){return t=$t(t,eh(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?No(1):1:No(t)}_prepareMaterialPatch(t,i,r){const s=i.material;if(N(s))return void(r.changed&&r.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,t));if(s.type==="collection")return;const n=s.type==="complete"?Cn(s.newValue,a=>a.color):s.diff.color.type==="complete"?s.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(n);r.useMaterialColor&&this._patchMaterialColor(cU(o),this._markerMaterial,t),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterial,t),delete i.material}_prepareMarkerPatch(t,i){const r=i.marker;if(N(r)||r.type!=="partial"||w(r.diff.style)||w(r.diff.placement)||w(r.diff.color)&&r.diff.color.type!=="complete")return{changed:!1,useMaterialColor:N(this._markerColor)};const s=r.diff.color;if(N(s))return delete i.marker,{changed:!1,useMaterialColor:N(this._markerColor)};const n=s.newValue;return N(n)?(delete i.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(n),this._markerMaterial,t),delete i.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(t,i,r){N(i)||r.symbolLayerStatePatches.push(()=>i.setParameters({color:t}))}}var ZM;Uz.elevationModeChangeTypes={definedChanged:_s.RECREATE,staysOnTheGround:_s.NONE,onTheGroundChanged:_s.RECREATE},function(e){e[e.DRAPED=0]="DRAPED",e[e.ELEVATED=1]="ELEVATED"}(ZM||(ZM={}));const Uae=2048,bst=1.5,wst=8;function xst(e,t){const{format:i,quality:r,rotation:s,disableDecorations:n}=e||{},o=DJ(e,t.padding),a=Lst(e,{width:t.width-o.left-o.right,height:t.height-o.top-o.bottom}),{width:l,height:c}=Ist(e,a),h=Nst(i),p=Bst[h];return{format:h,quality:Xe(r!=null?r:p,0,100),area:a,width:l,height:c,rotation:s,disableDecorations:!!n,ignoreBackground:!(!e||!e.ignoreBackground),ignorePadding:!(!e||!e.ignorePadding)}}function Tst(e,t){const i=xst(e,t),r=i.area,s=i.width/r.width,n=DJ(i,t.padding),o=n.left+n.right,a=n.top+n.bottom,l=t.width-o,c=t.height-a,h=Math.floor(l*s+o),p=Math.floor(c*s+a),m=e&&e.layers?e.layers:[],g=i.ignoreBackground,v=i.ignorePadding;return{framebufferWidth:h,framebufferHeight:p,region:{x:Math.floor(r.x*s)+n.left,y:Math.floor(r.y*s)+n.top,width:i.width,height:i.height},format:i.format,quality:i.quality,rotation:i.rotation,pixelRatio:s,layers:m,disableDecorations:i.disableDecorations,ignoreBackground:g,ignorePadding:v}}function Sst(e,t,i){const{ctx:r,canvas:s}=WTe(e,i),n=r.getImageData(0,0,e.width,e.height),o=Ast(s,t);return ZTe(s),{dataUrl:o,data:n}}function Est(e,t){const{ctx:i,canvas:r}=WTe(e,t),s=i.getImageData(0,0,e.width,e.height);return ZTe(r),s}function WTe(e,t){const i=Cst();t.premultipliedAlpha&&kst(e),i.width=e.width,i.height=e.height;const r=i.getContext("2d");return r.putImageData(e,0,0),t.flipY&&Fst(r),{ctx:r,canvas:i}}function ZTe(e){e.width=0,e.height=0}function Cst(){return N(G8)&&(G8=document.createElement("canvas")),G8}let G8=null;function Ast(e,t){const i=Ust[t.format],r=t.quality/100;return e.toDataURL(i,r)}function j8(e,t,i){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(rk)try{return new ImageData(e,t)}catch{rk=!1}return XTe(e,t,i)}function Ost(e,t,i,r){if(!t||!i)throw new Error("Cannot construct image data without dimensions");if(rk)try{return new ImageData(e,t,i)}catch{rk=!1}const s=XTe(t,i,r);return s.data.set(e,0),s}function Rst(e,t,i,r=0,s=0,n=e.width-r,o=e.height-s,a=!1){const{data:l}=e,{width:c,height:h,data:p}=t,m=n/c,g=o/h,v=Math.ceil(m/2),b=Math.ceil(g/2),S=e.width;for(let T=0;T<h;T++)for(let O=0;O<c;O++){const C=4*(O+(a?h-T-1:T)*c);let M=0,I=0,$=0,U=0,q=0,G=0;const Y=(T+.5)*g;for(let J=Math.floor(T*g);J<(T+1)*g;J++){const X=Math.abs(Y-(J+.5))/b,ne=(O+.5)*m,re=X*X;for(let ye=Math.floor(O*m);ye<(O+1)*m;ye++){const pe=Math.abs(ne-(ye+.5))/v,z=Math.sqrt(re+pe*pe);if(z>=1)continue;let j=2*z*z*z-3*z*z+1;const Q=4*(r+ye+(s+J)*S);G+=j*l[Q+3],I+=j,!i&&l[Q+3]<255&&(j=j*l[Q+3]/255),$+=j*l[Q],U+=j*l[Q+1],q+=j*l[Q+2],M+=j}}p[C]=$/M,p[C+1]=U/M,p[C+2]=q/M,p[C+3]=G/I}return t}function Mst(e,t,i){if(!t)return e;const{framebufferWidth:r,framebufferHeight:s,pixelRatio:n,region:o}=e,a=DJ(e,i),l=a.left+a.right,c=a.top+a.bottom,h=r-l,p=s-c,m=Math.min(wst,Math.min((Uae-l)/h,(Uae-c)/p));return m<bst?e:{...e,framebufferWidth:Math.round(h*m)+l,framebufferHeight:Math.round(p*m)+c,pixelRatio:n*m,resample:{region:{x:Math.round((o.x-a.left)*m)+a.left,y:Math.round((o.y-a.top)*m)+a.top,width:Math.round(o.width*m),height:Math.round(o.height*m)},width:r,height:s}}}function XTe(e,t,i){return i||(i=Pst()),i.getContext("2d").createImageData(e,t)}let SO=null,rk=!0;function Pst(){return SO||(SO=document.createElement("canvas"),SO.width=1,SO.height=1),SO}function Ist(e,t){if(!e)return t;const i=e.width,r=e.height;if(i!=null&&r!=null)return{width:Math.floor(i),height:Math.floor(r)};if(i==null&&r==null)return t;const s=t.width/t.height;return r==null?{width:Math.floor(i),height:Math.floor(i/s)}:{width:Math.floor(r*s),height:Math.floor(r)}}function Lst(e,t){const i={x:0,y:0,width:t.width,height:t.height};if(e&&e.area){e.area.x!=null&&(i.x=Math.floor(e.area.x)),e.area.y!=null&&(i.y=Math.floor(e.area.y));const r=e.area.width!=null?Math.floor(e.area.width):null,s=e.area.height!=null?Math.floor(e.area.height):null;if(i.width=t.width-i.x,i.height=t.height-i.y,r!=null&&s!=null)i.width=Math.min(i.width,r),i.height=Math.min(i.height,s);else if(r==null&&s!=null){const n=Math.min(i.width,r);i.height=n/i.width*i.height,i.width=n}else if(r!=null&&s==null){const n=Math.min(i.height,s);i.width=n/i.height*i.width,i.height=n}}return $st(Dst(i,e),t)}function $st(e,t){const i=Math.floor(Math.max(e.x,0)),r=Math.floor(Math.max(e.y,0)),s={x:i,y:r,width:Math.floor(Math.min(e.width,t.width-i)),height:Math.floor(Math.min(e.height,t.height-r))},n=s.width/s.height,o=e.width/e.height;if(o===n)return s;if(o>n){const c=Math.floor(s.width/o),h=s.height-c;return{x:s.x,y:Math.floor(s.y+h/2),width:s.width,height:c}}const a=Math.floor(s.height*o),l=s.width-a;return{x:Math.floor(s.x+l/2),y:s.y,width:a,height:s.height}}function Dst(e,t){if(!t||t.width==null||t.height==null)return e;const i=t.width/t.height,r=e.width/e.height;if(r===i)return e;if(r<i){const n=Math.floor(e.height*i);return e.x-=(n-e.width)/2,e.width=n,e}const s=Math.floor(e.width/i);return e.y-=(s-e.height)/2,e.height=s,e}function DJ(e,t){return!t||e&&e.ignorePadding?Vst:t}function Nst(e){switch(e){case"png":case"jpg":case"jpeg":return e;default:return zst}}function Fst(e){e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore()}function kst(e){const t=e.data,i=t.length;for(let r=0;r<i;r+=4){const s=t[r+3];if(s!==255&&s>0){const n=255/s;t[r+0]=t[r+0]*n,t[r+1]=t[r+1]*n,t[r+2]=t[r+2]*n}}}const Ust={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},zae=98,zst="png",Bst={png:100,jpg:zae,jpeg:zae},Vst={top:0,right:0,bottom:0,left:0};var w2;const H8=new WeakMap;let Gst=0,Hf=w2=class extends Fe{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,t,i,r){if(e instanceof HTMLImageElement){const s={type:"image-element",src:Px(e.src,r),crossOrigin:e.crossOrigin};t[i]=s}else if(e instanceof HTMLCanvasElement){const s=e.getContext("2d").getImageData(0,0,e.width,e.height),n={type:"canvas-element",imageData:this._encodeImageData(s)};t[i]=n}else if(e instanceof HTMLVideoElement){const s={type:"video-element",src:Px(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};t[i]=s}else{const s={type:"image-data",imageData:this._encodeImageData(e)};t[i]=s}}readData(e){switch(e.type){case"image-element":{const t=new Image;return t.src=e.src,t.crossOrigin=e.crossOrigin,t}case"canvas-element":{const t=this._decodeImageData(e.imageData),i=document.createElement("canvas");return i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0),i}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const t=document.createElement("video");return t.src=e.src,t.crossOrigin=e.crossOrigin,t.autoplay=e.autoplay,t.loop=e.loop,t.muted=e.muted,t.preload=e.preload,t}default:return}}get transparent(){const e=this.data,t=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(t){const i=t.substr(t.length-4,4).toLowerCase(),r=t.substr(0,15).toLocaleLowerCase();if(i===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",t=(i="")=>`d:${i},t:${this.transparent},w:${e}`;return this.url!=null?t(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?t(this.data.src):(H8.has(this.data)||H8.set(this.data,++Gst),t(H8.get(this.data))):t()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new w2(e)}cloneWithDeduplication(e){const t=e.get(this);if(t)return t;const i=this.clone();return e.set(this,i),i}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let t="";for(let i=0;i<e.data.length;i++)t+=String.fromCharCode(e.data[i]);return{data:btoa(t),width:e.width,height:e.height}}_decodeImageData(e){const t=atob(e.data),i=new Uint8ClampedArray(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return Ost(i,e.width,e.height)}_imageDataContainsTransparent(e){for(let t=3;t<e.data.length;t+=4)if(e.data[t]!==255)return!0;return!1}static from(e){return typeof e=="string"?new w2({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new w2({data:e}):OE(w2,e)}};u([f({type:String,json:{write:e1}})],Hf.prototype,"url",null),u([f({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),f()],Hf.prototype,"data",null),u([ut("data")],Hf.prototype,"writeData",null),u([it("data")],Hf.prototype,"readData",null),u([f({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],Hf.prototype,"transparent",null),u([f({json:{write:!0}})],Hf.prototype,"wrap",void 0),u([f({readOnly:!0})],Hf.prototype,"contentHash",null),Hf=w2=u([B("esri.geometry.support.MeshTexture")],Hf);const XM=Hf;var gW;let Yg=gW=class extends Fe{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=w(e)?e.get(this):null;if(i)return i;const r=new gW(this.clonePropertiesWithDeduplication(t));return w(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:w(this.color)?this.color.clone():null,colorTexture:w(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:w(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([f({type:at,json:{write:!0}})],Yg.prototype,"color",void 0),u([f({type:XM,json:{write:!0}})],Yg.prototype,"colorTexture",void 0),u([f({type:XM,json:{write:!0}})],Yg.prototype,"normalTexture",void 0),u([f({nonNullable:!0,json:{write:!0}})],Yg.prototype,"alphaMode",void 0),u([f({nonNullable:!0,json:{write:!0}})],Yg.prototype,"alphaCutoff",void 0),u([f({nonNullable:!0,json:{write:!0}})],Yg.prototype,"doubleSided",void 0),Yg=gW=u([B("esri.geometry.support.MeshMaterial")],Yg);const NJ=Yg;var yW;let Qg=yW=class extends NJ{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,t){const i=w(e)?e.get(this):null;if(i)return i;const r=new yW(this.clonePropertiesWithDeduplication(t));return w(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:w(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:w(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:w(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:w(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};u([f({type:at,json:{write:!0}})],Qg.prototype,"emissiveColor",void 0),u([f({type:XM,json:{write:!0}})],Qg.prototype,"emissiveTexture",void 0),u([f({type:XM,json:{write:!0}})],Qg.prototype,"occlusionTexture",void 0),u([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Qg.prototype,"metallic",void 0),u([f({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],Qg.prototype,"roughness",void 0),u([f({type:XM,json:{write:!0}})],Qg.prototype,"metallicRoughnessTexture",void 0),Qg=yW=u([B("esri.geometry.support.MeshMaterialMetallicRoughness")],Qg);const YTe=Qg;var DF;const fS=Ie.getLogger("esri.geometry.support.MeshVertexAttributes");let xh=DF=class extends Fe{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return x2(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},fS)}castPosition(e){return e&&e instanceof Float32Array&&fS.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),x2(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},fS)}castUv(e){return x2(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},fS)}castNormal(e){return x2(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},fS)}castTangent(e){return x2(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},fS)}clone(){const e={position:me(this.position),uv:me(this.uv),normal:me(this.normal),tangent:me(this.tangent),color:me(this.color)};return new DF(e)}clonePositional(){const e={position:me(this.position),normal:me(this.normal),tangent:me(this.tangent),uv:this.uv,color:this.color};return new DF(e)}};function q8(e,t,i,r){const{loggerTag:s,stride:n}=t;return e.length%n!=0?(r.error(s,`Invalid array length, expected a multiple of ${n}`),new i([])):e}function x2(e,t,i,r,s){if(!e)return e;if(e instanceof t)return q8(e,r,t,s);for(const n of i)if(e instanceof n)return q8(new t(e),r,t,s);if(Array.isArray(e))return q8(new t(e),r,t,s);{const n=i.map(o=>`'${o.name}'`);return s.error(`Failed to set property, expected one of ${n}, but got ${e.constructor.name}`),new t([])}}function EO(e,t,i){t[i]=jst(e)}function jst(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[i]=e[i];return t}u([f({json:{write:EO}})],xh.prototype,"color",void 0),u([pi("color")],xh.prototype,"castColor",null),u([f({nonNullable:!0,json:{write:EO}})],xh.prototype,"position",void 0),u([pi("position")],xh.prototype,"castPosition",null),u([f({json:{write:EO}})],xh.prototype,"uv",void 0),u([pi("uv")],xh.prototype,"castUv",null),u([f({json:{write:EO}})],xh.prototype,"normal",void 0),u([pi("normal")],xh.prototype,"castNormal",null),u([f({json:{write:EO}})],xh.prototype,"tangent",void 0),u([pi("tangent")],xh.prototype,"castTangent",null),xh=DF=u([B("esri.geometry.support.MeshVertexAttributes")],xh);var eM;const Hst=Ie.getLogger("esri.geometry.support.MeshComponent");let Jg=eM=class extends Fe{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return OE(eM,e)}castFaces(e){return x2(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Hst)}castMaterial(e){return OE(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?YTe:NJ,e)}clone(){return new eM({faces:me(this.faces),shading:this.shading,material:me(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,t){const i={faces:me(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,t):null,trustSourceNormals:this.trustSourceNormals};return new eM(i)}};u([f({json:{write:!0}})],Jg.prototype,"faces",void 0),u([pi("faces")],Jg.prototype,"castFaces",null),u([f({type:NJ,json:{write:!0}})],Jg.prototype,"material",void 0),u([pi("material")],Jg.prototype,"castMaterial",null),u([f({type:String,json:{write:!0}})],Jg.prototype,"shading",void 0),u([f({type:Boolean})],Jg.prototype,"trustSourceNormals",void 0),Jg=eM=u([B("esri.geometry.support.MeshComponent")],Jg);const qst=Jg,zz=Ie.getLogger("esri.geometry.support.meshUtils.normalProjection");function Wst(e,t,i,r,s){return Vz(r)?(Bz($y.TO_PCPF,hr.fromTypedArray(e),Ws.fromTypedArray(t),Ws.fromTypedArray(i),r,hr.fromTypedArray(s)),s):(zz.error("Cannot convert spatial reference to PCPF"),s)}function Qbt(e,t,i,r,s){return Vz(r)?(Bz($y.FROM_PCPF,hr.fromTypedArray(e),Ws.fromTypedArray(t),Ws.fromTypedArray(i),r,hr.fromTypedArray(s)),s):(zz.error("Cannot convert to spatial reference from PCPF"),s)}function Jbt(e,t,i){return Lr(e,t,0,i,Pm(t),0,e.length/3),i}function Kbt(e,t,i){return Lr(e,Pm(i),0,t,i,0,e.length/3),t}function Zst(e,t,i){if(N(e))return t;const r=Ws.fromTypedArray(e),s=Ws.fromTypedArray(t);return bI(s,r,i),t}function Xst(e,t,i){if(N(e))return t;cC(so,i);const r=hr.fromTypedArray(e),s=hr.fromTypedArray(t);return g1(s,r,so),AQ(so)||CJ(s,s),t}function Yst(e,t,i){if(N(e))return t;cC(so,i);const r=hr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),s=hr.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(g1(s,r,so),AQ(so)||CJ(s,s),e!==t)for(let n=3;n<e.length;n+=4)t[n]=e[n];return t}function Qst(e,t,i,r,s){if(!Vz(r))return zz.error("Cannot convert spatial reference to PCPF"),s;Bz($y.TO_PCPF,hr.fromTypedArray(e,4*Float32Array.BYTES_PER_ELEMENT),Ws.fromTypedArray(t),Ws.fromTypedArray(i),r,hr.fromTypedArray(s,4*Float32Array.BYTES_PER_ELEMENT));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function ewt(e,t,i,r,s){if(!Vz(r))return zz.error("Cannot convert to spatial reference from PCPF"),s;Bz($y.FROM_PCPF,hr.fromTypedArray(e,16),Ws.fromTypedArray(t),Ws.fromTypedArray(i),r,hr.fromTypedArray(s,16));for(let n=3;n<e.length;n+=4)s[n]=e[n];return s}function Bz(e,t,i,r,s,n){if(!t)return;const o=i.count,a=Pm(s);if(QTe(s))for(let l=0;l<o;l++)r.getVec(l,tD),t.getVec(l,wf),rh(a,tD,iD,a),_d(so,iD),e===$y.FROM_PCPF&&vd(so,so),$c(wf,wf,so),n.setVec(l,wf);else for(let l=0;l<o;l++){r.getVec(l,tD),t.getVec(l,wf),rh(a,tD,iD,a),_d(so,iD);const c=T4(i.get(l,1));let h=Math.cos(c);e===$y.TO_PCPF&&(h=1/h),so[0]*=h,so[1]*=h,so[2]*=h,so[3]*=h,so[4]*=h,so[5]*=h,e===$y.FROM_PCPF&&vd(so,so),$c(wf,wf,so),De(wf,wf),n.setVec(l,wf)}return n}function Vz(e){return QTe(e)||Jst(e)}function QTe(e){return e.isWGS84||Lde(e)||km(e)||Um(e)}function Jst(e){return e.isWebMercator}var $y;(function(e){e[e.TO_PCPF=0]="TO_PCPF",e[e.FROM_PCPF=1]="FROM_PCPF"})($y||($y={}));const tD=F(),wf=F(),iD=Be(),so=Qr();function Kst(e){const t=new dr;t.include(oa),t.include(TT,e),t.include(Yxe,e),Yu(t,e);const{vertex:i,fragment:r}=t;return e.stippleEnabled&&(t.attributes.add(D.UV0,"vec2"),t.attributes.add(D.AUXPOS1,"vec3"),i.uniforms.add(new Ci("viewport",(s,n)=>n.camera.fullViewport))),t.attributes.add(D.POSITION,"vec3"),t.varyings.add("vpos","vec3"),i.code.add(E`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),e.stippleEnabled&&(i.code.add(E`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),e.draped?i.uniforms.add(new lt("worldToScreenRatio",(s,n)=>1/n.screenToPCSRatio)):i.code.add(E`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),i.code.add(E`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),e.draped?i.code.add(E`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):i.code.add(E`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),i.code.add(E`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),i.code.add(E`}`),e.output===ue.Highlight&&t.include(d0),t.include(Ns,e),r.uniforms.add(new lt("alphaCoverage",(s,n)=>Math.min(1,s.width*n.camera.pixelRatio))),e.hasVertexColors||r.uniforms.add(new Ci("constantColor",s=>s.color)),r.code.add(E`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${e.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${E.float(la)}) {
      discard;
    }

    ${e.output===ue.Color?E`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${e.output===ue.Highlight?E`outputHighlight();`:""}
  }
  `),t}const ent=Object.freeze(Object.defineProperty({__proto__:null,build:Kst},Symbol.toStringTag,{value:"Module"}));class Gz extends $r{constructor(t,i,r){super(t,i,r),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=t.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==ue.Highlight}initializeProgram(t){const i=Gz.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(t,i){if(this.program.bindPass(t,i),this.stipplePattern!==t.stipplePattern){const r=t.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r}if(this.stippleEnabled){const{pixelSize:r,sdfNormalizer:s,pixels:n}=w(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",s),this.program.setUniform1f("stipplePatternTextureSize",n),this.program.setUniform1f("stipplePatternPixelSize",r),this.program.setUniform1f("stipplePatternPixelSizeInv",1/r)}}initializePipeline(){const t=this.configuration,i=Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),r=(s,n=null,o=null)=>ni({blending:n,depthTest:OJ,depthWrite:o,colorWrite:wi,stencilWrite:t.hasOccludees?Fm:null,stencilTest:t.hasOccludees?s?y1:O1:null});return t.output===ue.Color?(this._occludeePipelineState=r(!0,t.transparent||this.stippleEnabled?i:null,ec),r(!1,t.transparent||this.stippleEnabled?i:null,ec)):r(!1)}get primitiveType(){return Yt.LINES}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}Gz.shader=new Tr(ent,()=>_e(()=>import("./NativeLine.glsl.99f6d030.js"),[],import.meta.url));class gu extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}u([ee({count:ue.COUNT})],gu.prototype,"output",void 0),u([ee()],gu.prototype,"hasSlicePlane",void 0),u([ee()],gu.prototype,"hasVertexColors",void 0),u([ee()],gu.prototype,"transparent",void 0),u([ee()],gu.prototype,"draped",void 0),u([ee()],gu.prototype,"stippleEnabled",void 0),u([ee()],gu.prototype,"stippleOffColorEnabled",void 0),u([ee()],gu.prototype,"stipplePreferContinuous",void 0),u([ee()],gu.prototype,"hasOccludees",void 0),u([ee({constValue:!1})],gu.prototype,"stippleRequiresClamp",void 0),u([ee({constValue:!1})],gu.prototype,"stippleScaleWithLineWidth",void 0),u([ee({constValue:!1})],gu.prototype,"stippleRequiresStretchMeasure",void 0);const tnt=Ie.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var sk;(function(e){e[e.START=0]="START",e[e.END=1]="END"})(sk||(sk={}));class Bae extends Xm{constructor(t){super(t,new snt),this._techniqueConfig=new gu}getConfiguration(t,i){this._techniqueConfig.output=t,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=i.slot===Ue.DRAPED_MATERIAL;const r=w(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=r,this._techniqueConfig.stippleOffColorEnabled=r&&w(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(t,i,r,s,n,o,a,l,c){w(c)?SJe(t,s,c,o,1,a):this._intersectLineGeometry(t,i,r,s,a)}_intersectLineGeometry(t,i,r,s,n){if(!s.options.selectionMode||hI(i))return;if(!hbe(r))return void tnt.error("intersection assumes a translation-only matrix");const o=t.vertexAttributes.get(D.POSITION).data,a=s.camera,l=ont;zo(l,s.point);const c=2;fe(CO[0],l[0]-c,l[1]+c,0),fe(CO[1],l[0]+c,l[1]+c,0),fe(CO[2],l[0]+c,l[1]-c,0),fe(CO[3],l[0]-c,l[1]-c,0);for(let v=0;v<4;v++)if(!a.unprojectFromRenderScreen(CO[v],Tg[v]))return;Ea(a.eye,Tg[0],Tg[1],W8),Ea(a.eye,Tg[1],Tg[2],Z8),Ea(a.eye,Tg[2],Tg[3],X8),Ea(a.eye,Tg[3],Tg[0],Y8);let h=Number.MAX_VALUE,p=0;for(let v=0;v<o.length-5;v+=3){if(qa[0]=o[v]+r[12],qa[1]=o[v+1]+r[13],qa[2]=o[v+2]+r[14],Wa[0]=o[v+3]+r[12],Wa[1]=o[v+4]+r[13],Wa[2]=o[v+5]+r[14],Or(W8,qa)<0&&Or(W8,Wa)<0||Or(Z8,qa)<0&&Or(Z8,Wa)<0||Or(X8,qa)<0&&Or(X8,Wa)<0||Or(Y8,qa)<0&&Or(Y8,Wa)<0)continue;if(a.projectToRenderScreen(qa,hb),a.projectToRenderScreen(Wa,db),hb[2]<0&&db[2]>0){Me(xf,qa,Wa);const S=a.frustum,T=-Or(S[Ar.NEAR],qa)/ke(xf,S[Ar.NEAR]);be(xf,xf,T),Oe(qa,qa,xf),a.projectToRenderScreen(qa,hb)}else if(hb[2]>0&&db[2]<0){Me(xf,Wa,qa);const S=a.frustum,T=-Or(S[Ar.NEAR],Wa)/ke(xf,S[Ar.NEAR]);be(xf,xf,T),Oe(Wa,Wa,xf),a.projectToRenderScreen(Wa,db)}else if(hb[2]<0&&db[2]<0)continue;hb[2]=0,db[2]=0;const b=DX(hx(hb,db,jae),l);b<h&&(h=b,ve(Vae,qa),ve(Gae,Wa),p=v/3)}const m=s.rayBegin,g=s.rayEnd;if(h<c*c){let v=Number.MAX_VALUE;if(Kme(hx(Vae,Gae,jae),hx(m,g,nnt),ub)){Me(ub,ub,m);const b=He(ub);be(ub,ub,1/b),v=b/Pr(m,g)}n(v,ub,p,!1)}}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return!1;const s=r.get(D.POSITION);return $Q(s,null,!1,i)}requiresSlot(t){return t===Ue.OPAQUE_MATERIAL||t===Ue.DRAPED_MATERIAL}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Highlight?new int(t):null}createBufferWriter(){const t=this.parameters.hasVertexColors?pTe:fit;return N(this.parameters.stipplePattern)?new Lz(t):new rnt(t.clone().vec3f(D.AUXPOS1).vec2f(D.UV0))}}class int extends S1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output===ue.Color&&this._updateOccludeeState(t),this.ensureTechnique(Gz,t)}}class rnt{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(D.POSITION).length}write(t,i,r,s){pz(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s),this._writeAuxpos1(t,i,r,s),this._writeUV0(t,i,r,s)}_writeAuxpos1(t,i,r,s){const n=r.getField(D.AUXPOS1,hr),o=i.indices.get(D.POSITION),a=i.vertexAttributes.get(D.POSITION).data,l=t.transformation,c=n.typedBufferStride,h=n.typedBuffer;s*=c;for(let p=0;p<o.length-1;p+=2)for(const m of[1,0]){const g=3*o[p+m],v=a[g],b=a[g+1],S=a[g+2],T=l[0]*v+l[4]*b+l[8]*S+l[12],O=l[1]*v+l[5]*b+l[9]*S+l[13],C=l[2]*v+l[6]*b+l[10]*S+l[14];h[s]=T,h[s+1]=O,h[s+2]=C,s+=c}}_writeUV0(t,i,r,s){var M;const n=r.getField(D.UV0,bd),o=i.indices.get(D.POSITION),a=i.vertexAttributes.get(D.POSITION).data,l=(M=i.vertexAttributes.get(D.DISTANCETOSTART))==null?void 0:M.data,c=t.transformation,h=n.typedBufferStride,p=n.typedBuffer;let m=0;p[s*=h]=sk.START,p[s+1]=m,s+=h;const g=3*o[0],v=fe(qa,a[g],a[g+1],a[g+2]);c&&et(v,v,c);const b=Wa,S=o.length-1;let T=1;const O=l?(I,$,U)=>m=l[U]:(I,$,U)=>m+=Pr(I,$);for(let I=1;I<S;I+=2){const $=3*o[I];fe(b,a[$],a[$+1],a[$+2]),c&&et(b,b,c),O(v,b,T++);for(let U=0;U<2;++U)p[s]=1-U,p[s+1]=m,s+=h;ve(v,b)}const C=3*o[S];fe(b,a[C],a[C+1],a[C+2]),c&&et(b,b,c),O(v,b,T),p[s]=sk.END,p[s+1]=m}}class snt extends cA{constructor(){super(...arguments),this.color=od,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const qa=F(),Wa=F(),xf=F(),ub=F(),hb=sa(),db=sa(),Vae=F(),Gae=F(),jae=Gm(),nnt=Gm(),ont=F(),CO=[sa(),sa(),sa(),sa()],Tg=[F(),F(),F(),F()],W8=Vi(),Z8=Vi(),X8=Vi(),Y8=Vi(),ant=["mesh"];class lnt extends Qm{constructor(t,i,r,s){super(t,i,r,s),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){ur.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new Bae({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new Bae({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),t=>t.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,ant,"fill on mesh-3d"))return null;const r=this.setGraphicElevationContext(i,new lh),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(t,i){const r=this._getLayerOpacity();return this._materials.forEach(s=>{s.material.setParameters({layerOpacity:r});const n=s.material.parameters;this._setMaterialTransparentParameter(n,s),s.material.setParameters({transparent:n.transparent})}),t.forEach(s=>{const n=i(s);w(n)&&n.layerOpacityChanged(r,this._context.isAsync)}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,m1)}slicePlaneEnabledChanged(t,i){return this._materials.forEach(r=>{r.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),t.forEach(r=>{const s=i(r);w(s)&&s.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const t=this._usePBR();return this._materials.forEach(i=>i.material.setParameters({usePBR:t})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(t){return N(t)?"-":t instanceof at?t.toHex():t.contentHash}_materialPropertiesDefault(t,i){const r=this._requiresSymbolVertexColors(),s=!!t.vertexAttributes.color,n=!!t.vertexAttributes.tangent;return{hasSymbolVertexColors:r,hasVertexColors:s,hasVertexTangents:n,uid:`vc:${s},vt:${n},vct${i},svc:${r}`}}_materialProperties(t,i,r){const s=this._materialPropertiesDefault(t,r);if(!i.material)return s;const{color:n,colorTexture:o,normalTexture:a,doubleSided:l,alphaCutoff:c,alphaMode:h}=i.material,p=this._colorOrTextureUid(n),m=this._colorOrTextureUid(o),g=this._colorOrTextureUid(a);if(s.color=n,s.colorTexture=o,s.normalTexture=a,s.uid=`${s.uid},cmuid:${p},ctmuid:${m},ntmuid:${g},ds:${l},ac:${c},am:${h}`,i.material instanceof YTe){const{metallic:v,roughness:b,metallicRoughnessTexture:S,emissiveColor:T,emissiveTexture:O,occlusionTexture:C}=i.material,M=this._colorOrTextureUid(S),I=this._colorOrTextureUid(T),$=this._colorOrTextureUid(O),U=this._colorOrTextureUid(C);s.metallic=v,s.roughness=b,s.metallicRoughnessTexture=S,s.emissiveColor=T,s.emissiveTexture=O,s.occlusionTexture=C,s.uid=`${s.uid},mrm:${v},mrr:${b},mrt:${M},emuid:${I},etmuid:${$},otmuid:${U}`}return s}_setInternalColorValueParameters(t,i){i.diffuse=at.toUnitRGB(t),i.opacity=t.a}_getLoadableTextureResource(t){return t.data?t.data:t.url}_getInternalTextureId(t){const i=this._getInternalTexture(t,Mr.Opaque);return w(i)?i.id:null}_getInternalTexture(t,i){const r=this._getLoadableTextureResource(t);if(!r)return null;const s=`${t.contentHash}/${i}`;let n=this._textures.get(s);return n||(n=new sn(r,{mipmap:!0,wrap:this._castTextureWrap(t.wrap),noUnpackFlip:!0,preMultiplyAlpha:i!==Mr.Opaque}),this._textures.set(s,n),this._context.stage.add(n),this._context.stage.loadImmediate(n)),n}_castTextureWrap(t="repeat"){if(typeof t=="string"){const i=this._castTextureWrapIndividual(t);return{s:i,t:i}}return{s:this._castTextureWrapIndividual(t.horizontal),t:this._castTextureWrapIndividual(t.vertical)}}_castTextureWrapIndividual(t){switch(t){case"clamp":return Ft.CLAMP_TO_EDGE;case"mirror":return Ft.MIRRORED_REPEAT;default:return Ft.REPEAT}}_setInternalMaterialParameters(t,i){if(w(t.color)&&this._setInternalColorValueParameters(t.color,i),w(t.colorTexture)){const r=this._getInternalTexture(t.colorTexture,i.textureAlphaMode);w(r)?(i.textureId=r.id,i.textureAlphaPremultiplied=!!r.params.preMultiplyAlpha):i.textureId=void 0}w(t.normalTexture)&&(i.normalTextureId=this._getInternalTextureId(t.normalTexture)),w(t.emissiveColor)&&(i.emissiveFactor=at.toUnitRGB(t.emissiveColor)),w(t.emissiveTexture)&&(i.emissiveTextureId=this._getInternalTextureId(t.emissiveTexture)),w(t.occlusionTexture)&&(i.occlusionTextureId=this._getInternalTextureId(t.occlusionTexture)),w(t.metallicRoughnessTexture)&&(i.metallicRoughnessTextureId=this._getInternalTextureId(t.metallicRoughnessTexture))}_setExternalMaterialParameters(t){const i=this._drivenProperties.color;let r=w(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(i)t.externalColor=od;else{const s=w(this.symbolLayer.material)?this.symbolLayer.material.color:null;w(s)?t.externalColor=at.toUnitRGBA(s):(r=null,t.externalColor=od)}r&&(t.colorMixMode=r),t.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(t){const i=t.vertexAttributes.color;if(N(i))return!1;for(let r=3;r<i.length;r+=4)if(i[r]!==255)return!0;return!1}_getOrCreateMaterial(t,i){var v,b,S;const r=(v=i.material)==null?void 0:v.color,s=(b=i.material)==null?void 0:b.colorTexture,n=(S=i.material)==null?void 0:S.alphaMode,o=n==="blend",a=n!=="opaque"&&(this._hasTransparentVertexColors(t)||w(r)&&r.a<1||w(s)&&s.transparent||o),l=this._materialProperties(t,i,a),c=this._materials.get(l.uid);if(c)return c.material;const h={material:null,isComponentTransparent:a,alphaMode:i.material?i.material.alphaMode:"opaque"},p=l.metallicRoughnessTexture==null&&l.metallic==null&&l.roughness==null,m={usePBR:this._usePBR(),isSchematic:p,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:ol,diffuse:pm,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Ir.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};p||(m.mrrFactors=[l.metallic!=null?l.metallic:1,l.roughness!=null?l.roughness:1,.5]),i.material&&(m.doubleSided=i.material.doubleSided,m.cullFace=i.material.doubleSided?Ir.None:Ir.Back,m.textureAlphaCutoff=i.material.alphaCutoff),this._setExternalMaterialParameters(m),this._setMaterialTransparentParameter(m,h),this._setInternalMaterialParameters(l,m);const g=new iT(m);return h.material=g,this._materials.set(l.uid,h),this._context.stage.add(g),g}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(t,i){t.transparent=this.needsDrivenTransparentPass||i.isComponentTransparent||t.layerOpacity<1||t.opacity<1||t.externalColor&&t.externalColor[3]<1,i.alphaMode==="auto"?t.textureAlphaMode=t.transparent?Mr.MaskBlend:Mr.Opaque:t.textureAlphaMode=i.alphaMode==="opaque"?Mr.Opaque:i.alphaMode==="mask"?Mr.Mask:Mr.Blend}_addDebugNormals(t,i,r,s){const n=i.length,o=t.spatialReference.isGeographic?20015077/180:1,a=.1*Math.max(t.extent.width*o,t.extent.height*o,t.extent.zmax-t.extent.zmin),l=[],c=[],h=[],p=[];for(let v=0;v<n;v++){const b=i[v],S=b.vertexAttributes.get(D.POSITION),T=b.vertexAttributes.get(D.NORMAL),O=b.indices.get(D.POSITION),C=b.indices.get(D.NORMAL),M=S.data,I=T.data;for(let $=0;$<O.length;$++){const U=3*O[$],q=3*C[$];for(let G=0;G<3;G++)l.push(M[U+G]);for(let G=0;G<3;G++)l.push(M[U+G]+I[q+G]*a);if(c.push(c.length),c.push(c.length),$%3==0){this._calculateFaceNormal(M,O,$,yS),this._getFaceVertices(M,O,$,qo,mS,gS),Oe(qo,qo,mS),Oe(qo,qo,gS),be(qo,qo,1/3);for(let G=0;G<3;G++)h.push(qo[G]);for(let G=0;G<3;G++)h.push(qo[G]+yS[G]*a);p.push(p.length),p.push(p.length)}}}const m=new ss([[D.POSITION,{data:l,size:3,exclusive:!0}]],[[D.POSITION,new Uint32Array(c)]],Zl.Line);i.push(m),r.push(this._debugVertexNormalMaterial),s.push(ux(s[0]));const g=new ss([[D.POSITION,{data:h,size:3,exclusive:!0}]],[[D.POSITION,new Uint32Array(p)]],Zl.Line);i.push(g),r.push(this._debugFaceNormalMaterial),s.push(ux(s[0]))}_createAs3DShape(t,i,r,s){const n=t.geometry;if(n.type!=="mesh")return null;const o=this._createGeometryInfo(n,i);if(!o)return null;const{geometries:a,materials:l,transformations:c,objectTransformation:h}=o;ur.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(n,a,l,c);const p=new m0({geometries:a,materials:l,transformations:c,metadata:{layerUid:this._context.layer.uid,graphicUid:s}});p.transformation=h;const m=this._createEdgeMaterial(),g=w(m)?{baseMaterial:l[0],edgeMaterials:[m],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,v=new Ym(this,p,a,null,null,d3,r,g);return v.needsElevationUpdates=m1(r.mode),v.useObjectOriginAsAttachmentOrigin=!0,v.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(p),v.alignedSampledElevation=d3(v,v.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),v}_getCenterPointInElevationSR(t){const i=f0(0,0,0,this._context.elevationProvider.spatialReference);return Tme([t.transformation[12],t.transformation[13],t.transformation[14]],this._context.renderCoordsHelper.spatialReference,i),i}_createComponentNormals(t,i,r,s){switch(r.shading||"flat"){case"source":return this._createComponentNormalsSource(t,i,r,s);case"flat":return this._createComponentNormalsFlat(t,s);case"smooth":return this._createComponentNormalsSmooth(t,s);default:return}}_createComponentNormalsSource(t,i,r,s){if(N(i))return this._createComponentNormalsFlat(t,s);let n=!1;if(!r.trustSourceNormals)for(let o=0;o<s.length;o+=3){this._calculateFaceNormal(t,s,o,yS);for(let a=0;a<3;a++){const l=3*s[o+a];qo[0]=i[l+0],qo[1]=i[l+1],qo[2]=i[l+2],ke(yS,qo)<0&&(i[l+0]=-i[l+0],i[l+1]=-i[l+1],i[l+2]=-i[l+2],n=!0)}}return{normals:i,indices:s,didFlipNormals:n}}_createComponentNormalsFlat(t,i){const r=new Float32Array(i.length),s=new Uint32Array(3*i.length);for(let n=0;n<i.length;n+=3){const o=this._calculateFaceNormal(t,i,n,yS);for(let a=0;a<3;a++)r[n+a]=o[a],s[n+a]=n/3}return{normals:r,indices:s,didFlipNormals:!1}}_createComponentNormalsSmooth(t,i){const r={};for(let o=0;o<i.length;o+=3){const a=this._calculateFaceNormal(t,i,o,yS);for(let l=0;l<3;l++){const c=i[o+l];let h=r[c];h||(h={normal:F(),count:0},r[c]=h),Oe(h.normal,h.normal,a),h.count++}}const s=new Float32Array(3*i.length),n=new Uint32Array(3*i.length);for(let o=0;o<i.length;o++){const a=r[i[o]];a.count!==1&&(De(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)s[3*o+l]=a.normal[l];n[o]=o}return{normals:s,indices:n,didFlipNormals:!1}}_getFaceVertices(t,i,r,s,n,o){const a=3*i[r+0],l=3*i[r+1],c=3*i[r+2];s[0]=t[a+0],s[1]=t[a+1],s[2]=t[a+2],n[0]=t[l+0],n[1]=t[l+1],n[2]=t[l+2],o[0]=t[c+0],o[1]=t[c+1],o[2]=t[c+2]}_calculateFaceNormal(t,i,r,s){return this._getFaceVertices(t,i,r,qo,mS,gS),Me(mS,mS,qo),Me(gS,gS,qo),St(qo,mS,gS),De(s,qo),s}_getOrCreateComponents(t){return $t(t.components,cnt)}_createPositionBuffer(t,i){let r=t.vertexAttributes.position;const s=i.reprojection===bu.ECEF?i.transformBeforeProject:null;if(w(s)&&(r=Zst(r,new Float64Array(r.length),s)),i.reprojection===bu.NONE)return i.needsBufferCopy?new Float64Array(r):r;const n=w(s)?r:new Float64Array(r.length);return Lr(r,t.spatialReference,0,n,this._context.renderCoordsHelper.spatialReference,0,r.length/3),n}_createNormalBuffer(t,i,r){let s=t.vertexAttributes.normal;if(N(s))return null;const n=r.reprojection===bu.ECEF?r.transformBeforeProject:null;if(w(n)&&(s=Xst(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===bu.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=w(n)?s:new Float32Array(s.length);return Wst(s,o,i,t.spatialReference,a)}_createTangentBuffer(t,i,r){let s=t.vertexAttributes.tangent;if(N(s))return null;const n=r.reprojection===bu.ECEF?r.transformBeforeProject:null;if(w(n)&&(s=Yst(s,new Float32Array(s.length),n)),this._context.graphicsCoreOwner.view.viewingMode==="local"||r.reprojection===bu.NONE)return r.needsBufferCopy&&t.vertexAttributes.normal===s?new Float32Array(s):s;const o=t.vertexAttributes.position,a=w(n)?s:new Float32Array(s.length);return Qst(s,o,i,t.spatialReference,a)}_createColorBuffer(t){return t.vertexAttributes.color}_createSymbolColorBuffer(t){if(this._requiresSymbolVertexColors()){const i=this._getVertexOpacityAndColor(t),r=ATe(Mn(this.symbolLayer,"material","colorMixMode")),s=new Uint8Array(4);return OTe(i,r,s),s}return null}_createBuffers(t,i){const r=t.vertexAttributes&&t.vertexAttributes.position;if(!r)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const s=t.vertexAttributes.normal,n=t.vertexAttributes.uv,o=t.vertexAttributes.tangent;if(w(s)&&s.length!==r.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(w(o)&&o.length/4!=r.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(w(n)&&n.length/2!=r.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(t),l=this._createPositionBuffer(t,a),c=this._createColorBuffer(t),h=this._createSymbolColorBuffer(i),p=this._createNormalBuffer(t,l,a),m=this._createTangentBuffer(t,l,a);return{positionBuffer:l,normalBuffer:p,tangentBuffer:m,uvBuffer:n,colorBuffer:c,symbolColorBuffer:h,objectTransformation:a.reprojection===bu.NONE&&w(a.objectTransformation)?a.objectTransformation:this._transformOriginLocal(t,l,p,m),geometryTransformation:a.reprojection===bu.NONE&&w(a.geometryTransformation)?a.geometryTransformation:Be()}}_computeReprojectionInfo(t){const i=w(t.transform),r=i&&t.transform.geographic||this._context.renderCoordsHelper.viewingMode===st.Local?bu.NONE:bu.ECEF;if(i){if(r===bu.NONE){const n=Be();return rh(t.spatialReference,t.transform.origin,n,this._context.renderCoordsHelper.spatialReference),{reprojection:r,objectTransformation:n,geometryTransformation:ux(t.transform.localMatrix),needsBufferCopy:!1}}const s=nU(Be(),t.transform.origin);return hs(s,s,t.transform.localMatrix),{reprojection:r,transformBeforeProject:s,needsBufferCopy:!0}}return{reprojection:r,needsBufferCopy:!0}}_transformOriginLocal(t,i,r,s){const n=this._context.renderCoordsHelper.spatialReference,o=t.anchor;rD[0]=o.x,rD[1]=o.y,rD[2]=o.z;const a=Be();rh(t.spatialReference,rD,a,n);const l=Ws.fromTypedArray(i);if(Fs(Hae,a),bI(l,l,Hae),w(r)||w(s)){if(_d(AO,a),vd(AO,AO),w(r)){const c=hr.fromTypedArray(r);g1(c,c,AO)}if(w(s)){const c=hr.fromTypedArray(s,4*s.BYTES_PER_ELEMENT);g1(c,c,AO)}}return a}_validateFaces(t,i){const r=t.vertexAttributes.position.length/3,s=i.faces;if(s){let n=-1;for(let o=0;o<s.length;o++){const a=s[o];a>n&&(n=a)}if(r<=n)return this.logger.warn(`Vertex index ${n} is out of bounds of the mesh position buffer`),!1}else if(r%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(t,i){return i.faces?i.faces:yC(t.vertexAttributes.position.length/3)}_isOutsideClippingArea(t){if(!this._context.clippingExtent)return!1;const i=t.vertexAttributes&&t.vertexAttributes.position;if(!i)return!1;const r=this._context.elevationProvider.spatialReference;let s;const n=i.length/3;return t.spatialReference.equals(r)?s=i:(s=new Float64Array(i.length),Lr(t.vertexAttributes.position,t.spatialReference,0,s,r,0,n)),Fr(Q8),Vu(Q8,s,0,n),!Rp(Q8,this._context.clippingExtent)}_createGeometryInfo(t,i){if(!t1(t.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(t))return null;const r=this._createBuffers(t,i);if(N(r))return null;const{positionBuffer:s,uvBuffer:n,colorBuffer:o,symbolColorBuffer:a,normalBuffer:l,tangentBuffer:c,objectTransformation:h,geometryTransformation:p}=r,m=this._getOrCreateComponents(t),g=[],v=[],b=[];let S=!1;for(const T of m){if(!this._validateFaces(t,T))return null;const O=this._getOrCreateFaces(t,T);if(O.length===0)continue;const C=this._createComponentNormals(s,l,T,O);C.didFlipNormals&&(S=!0);const M=[[D.POSITION,{size:3,data:s,exclusive:!0}],[D.NORMAL,{size:3,data:C.normals,exclusive:!0}]],I=[[D.POSITION,O],[D.NORMAL,C.indices]];w(o)&&(M.push([D.COLOR,{size:4,data:o,exclusive:!0}]),I.push([D.COLOR,O])),w(a)&&(M.push([D.SYMBOLCOLOR,{size:4,data:a,exclusive:!0}]),I.push([D.SYMBOLCOLOR,new Uint16Array(O.length)])),w(n)&&(M.push([D.UV0,{size:2,data:n,exclusive:!0}]),I.push([D.UV0,O])),w(c)&&(M.push([D.TANGENT,{size:4,data:c,exclusive:!0}]),I.push([D.TANGENT,O]));const $=new ss(M,I);g.push($),v.push(p),b.push(this._getOrCreateMaterial(t,T))}return S&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,transformations:v,materials:b,objectTransformation:h}}_createEdgeMaterial(){const t={opacity:this._getLayerOpacity()};return $xe(this.symbolLayer,t)}}const rD=F(),qo=F(),mS=F(),gS=F(),yS=F(),Hae=Be(),AO=Qr(),Q8=dn(),cnt=[new qst];var bu;(function(e){e[e.NONE=0]="NONE",e[e.ECEF=1]="ECEF"})(bu||(bu={}));class unt{constructor(t,i,r,s){this.graphics3DSymbolLayer=t,this.instanceIndex=i,this.elevationAligner=r,this.elevationContext=s,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(t){const i=this.lodRenderer.instanceData;t!==i.getVisible(this.instanceIndex)&&i.setVisible(this.instanceIndex,t)}destroy(){this.instanceIndex!=null&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(t,i,r){if(this.elevationAligner){bJ(this.elevationContext.featureExpressionInfoContext,r);const s=this.elevationAligner(this,this.elevationContext,t,i);w(s)&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(t=F()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Tf),et(t,this.lodRenderer.baseBoundingSphere.center,Tf)}getBoundingBoxObjectSpace(t=dn()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Tf);const i=this.lodRenderer.baseBoundingBox;Fr(t);for(let r=0;r<8;++r)fe(Th,(1&r)==0?i[0]:i[3],(2&r)==0?i[1]:i[4],(4&r)==0?i[2]:i[5]),et(Th,Th,Tf),Rm(t,Th);return t}computeAttachmentOrigin(t){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Tf),t.render.origin[0]+=Tf[12],t.render.origin[1]+=Tf[13],t.render.origin[2]+=Tf[14],t.render.num++}async getProjectedBoundingBox(t,i,r,s,n){const o=this.getBoundingBoxObjectSpace(n),a=hnt,l=qk(o)?1:a.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Tf);for(let h=0;h<l;h++){const p=a[h];Th[0]=o[p[0]],Th[1]=o[p[1]],Th[2]=o[p[2]],et(Th,Th,Tf),pb[3*h+0]=Th[0],pb[3*h+1]=Th[1],pb[3*h+2]=Th[2]}if(!t(pb,0,l))return null;Fr(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let h=0;h<3*l;h+=3){for(let p=0;p<3;p++)o[p]=Math.min(o[p],pb[h+p]),o[p+3]=Math.max(o[p+3],pb[h+p]);c&&r.push({location:pb.slice(h,h+3),screenSpaceBoundingRect:c})}if(i&&(Op(o,J8),this.elevationContext.mode!=="absolute-height")){let h;const p=_J(o,i);try{h=await i.service.queryElevation(J8[0],J8[1],s,p,"ground")}catch{}w(h)&&jpe(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(t,i){if(t===Xy.Highlight){const r=new Z5(t);this._addHighlightId(r),i.addExternal(s=>{this._removeHighlightId(s)},r)}}removeObjectState(t){this._highlights.forEach(i=>t.remove(i))}_addHighlightId(t){this._highlights.add(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(t){this._highlights.delete(t),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const pb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Th=F(),J8=F(),hnt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Tf=Be();function dnt(e){const t=[];return e.stageResources.geometries.forEach((i,r)=>{const s=e.stageResources.materials[r],n=e.stageResources.textures;t.push({material:s,geometry:i,textures:n})}),{components:t,minScreenSpaceRadius:e.lodThreshold,pivotOffset:e.pivotOffset}}function pnt(e){return{levels:e.map(t=>dnt(t))}}function fnt(e,t=gnt){const i=Het(e);return Math.sqrt(i/(t*Math.PI))}function mnt(e){e.levels.forEach(t=>{t.minScreenSpaceRadius||(t.minScreenSpaceRadius=fnt(t))})}const gnt=.05;function twt(e){return e=e||globalThis.location.hostname,_nt.some(t=>(e==null?void 0:e.match(t))!=null)}function ynt(e,t){return e&&(t=t||globalThis.location.hostname)?t.match(JTe)!=null||t.match(eSe)!=null?e.replace("static.arcgis.com","staticdev.arcgis.com"):t.match(KTe)!=null||t.match(tSe)!=null?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}const JTe=/^devext.arcgis.com$/,KTe=/^qaext.arcgis.com$/,eSe=/^[\w-]*\.mapsdevext.arcgis.com$/,tSe=/^[\w-]*\.mapsqa.arcgis.com$/,_nt=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,JTe,KTe,/^jsapps.esri.com$/,eSe,tSe];function vnt(e,t,i){if(e.count!==t.count)return void xz.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],m=i[8],g=i[9],v=i[10],b=i[11],S=i[12],T=i[13],O=i[14],C=i[15],M=e.typedBuffer,I=e.typedBufferStride,$=t.typedBuffer,U=t.typedBufferStride;for(let q=0;q<r;q++){const G=q*I,Y=q*U,J=$[Y],X=$[Y+1],ne=$[Y+2],re=$[Y+3];M[G]=s*J+l*X+m*ne+S*re,M[G+1]=n*J+c*X+g*ne+T*re,M[G+2]=o*J+h*X+v*ne+O*re,M[G+3]=a*J+p*X+b*ne+C*re}}function iSe(e,t,i){if(e.count!==t.count)return void xz.error("source and destination buffers need to have the same number of elements");const r=e.count,s=i[0],n=i[1],o=i[2],a=i[3],l=i[4],c=i[5],h=i[6],p=i[7],m=i[8],g=e.typedBuffer,v=e.typedBufferStride,b=t.typedBuffer,S=t.typedBufferStride;for(let T=0;T<r;T++){const O=T*v,C=T*S,M=b[C],I=b[C+1],$=b[C+2],U=b[C+3];g[O]=s*M+a*I+h*$,g[O+1]=n*M+l*I+p*$,g[O+2]=o*M+c*I+m*$,g[O+3]=U}}function bnt(e,t){const i=Math.min(e.count,t.count),r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride;for(let a=0;a<i;a++){const l=a*s,c=a*o,h=n[c],p=n[c+1],m=n[c+2],g=h*h+p*p+m*m;if(g>0){const v=1/Math.sqrt(g);r[l]=v*h,r[l+1]=v*p,r[l+2]=v*m}}}function _W(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=i*o[h],s[c+1]=i*o[h+1],s[c+2]=i*o[h+2],s[c+3]=i*o[h+3]}}function wnt(e,t,i){const r=Math.min(e.count,t.count),s=e.typedBuffer,n=e.typedBufferStride,o=t.typedBuffer,a=t.typedBufferStride;for(let l=0;l<r;l++){const c=l*n,h=l*a;s[c]=o[h]>>i,s[c+1]=o[h+1]>>i,s[c+2]=o[h+2]>>i,s[c+3]=o[h+3]>>i}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:vnt,transformMat3:iSe,normalize:bnt,scale:_W,shiftRight:wnt},Symbol.toStringTag,{value:"Module"}));function xnt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<9;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:xnt},Symbol.toStringTag,{value:"Module"}));function Tnt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h){for(let p=0;p<16;++p)r[l+p]=n[c+p];l+=s,c+=o}}Object.freeze(Object.defineProperty({__proto__:null,copy:Tnt},Symbol.toStringTag,{value:"Module"}));function Snt(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],l+=s,c+=o}function NF(e,t){const i=e.count;t||(t=new e.TypedArrayConstructor(i));for(let r=0;r<i;r++)t[r]=e.get(r);return t}Object.freeze(Object.defineProperty({__proto__:null,copy:Snt,makeDense:NF},Symbol.toStringTag,{value:"Module"}));function rSe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],l+=s,c+=o}function sSe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;if(xWe(t.elementType)){const h=TWe(t.elementType);if(wWe(t.elementType))for(let p=0;p<a;++p)r[l]=Math.max(n[c]/h,-1),r[l+1]=Math.max(n[c+1]/h,-1),l+=s,c+=o;else for(let p=0;p<a;++p)r[l]=n[c]/h,r[l+1]=n[c+1]/h,l+=s,c+=o}else rSe(e,t,i);return e}function Ent(e,t,i,r){var l,c;const s=e.typedBuffer,n=e.typedBufferStride,o=(l=r==null?void 0:r.count)!=null?l:e.count;let a=((c=r==null?void 0:r.dstIndex)!=null?c:0)*n;for(let h=0;h<o;++h)s[a]=t,s[a+1]=i,a+=n}Object.freeze(Object.defineProperty({__proto__:null,copy:rSe,normalizeIntegerBuffer:sSe,fill:Ent},Symbol.toStringTag,{value:"Module"}));function jz(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],l+=s,c+=o}function Cnt(e,t,i,r,s){var c,h;const n=e.typedBuffer,o=e.typedBufferStride,a=(c=s==null?void 0:s.count)!=null?c:e.count;let l=((h=s==null?void 0:s.dstIndex)!=null?h:0)*o;for(let p=0;p<a;++p)n[l]=t,n[l+1]=i,n[l+2]=r,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:jz,fill:Cnt},Symbol.toStringTag,{value:"Module"}));function nSe(e,t,i){const r=e.typedBuffer,s=e.typedBufferStride,n=t.typedBuffer,o=t.typedBufferStride,a=i?i.count:t.count;let l=(i&&i.dstIndex?i.dstIndex:0)*s,c=(i&&i.srcIndex?i.srcIndex:0)*o;for(let h=0;h<a;++h)r[l]=n[c],r[l+1]=n[c+1],r[l+2]=n[c+2],r[l+3]=n[c+3],l+=s,c+=o}function oSe(e,t,i,r,s,n){var h,p;const o=e.typedBuffer,a=e.typedBufferStride,l=(h=n==null?void 0:n.count)!=null?h:e.count;let c=((p=n==null?void 0:n.dstIndex)!=null?p:0)*a;for(let m=0;m<l;++m)o[c]=t,o[c+1]=i,o[c+2]=r,o[c+3]=s,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:nSe,fill:oSe},Symbol.toStringTag,{value:"Module"}));function Dw(e,t){return new e(new ArrayBuffer(t*e.ElementCount*cbe(e.ElementType)))}class aSe{constructor(t){this.streamDataRequester=t}async loadJSON(t,i){return this._load("json",t,i)}async loadBinary(t,i){return Bm(t)?(Ui(i),sfe(t)):this._load("binary",t,i)}async loadImage(t,i){return this._load("image",t,i)}async _load(t,i,r){if(N(this.streamDataRequester))return(await jr(i,{responseType:Ant[t]})).data;const s=await Xp(this.streamDataRequester.request(i,t,r));if(s.ok===!0)return s.value;throw e0(s.error),new se("",`Request for resource failed: ${s.error}`)}}const Ant={image:"image",binary:"array-buffer",json:"json"},Ont=Ie.getLogger("esri.views.3d.glTF");class Rnt{error(t){throw new se("gltf-loader-error",t)}errorUnsupported(t){throw new se("gltf-loader-unsupported-feature",t)}errorUnsupportedIf(t,i){t&&this.errorUnsupported(i)}assert(t,i){t||this.error(i)}warn(t){Ont.warn(t)}warnUnsupported(t){this.warn("[Unsupported Feature] "+t)}warnUnsupportedIf(t,i){t&&this.warnUnsupported(i)}}function Mnt(e={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...e}}function Pnt(e,t={}){return{data:e,parameters:{wrap:{s:Ft.REPEAT,t:Ft.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}class sT{constructor(t,i,r=""){this.major=t,this.minor=i,this._context=r}lessThan(t,i){return this.major<t||t===this.major&&this.minor<i}since(t,i){return!this.lessThan(t,i)}validate(t){if(this.major!==t.major){const i=this._context&&this._context+":",r=this._context&&this._context+" ";throw new se(i+"unsupported-version",`Required major ${r}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:t})}}clone(){return new sT(this.major,this.minor,this._context)}static parse(t,i=""){const[r,s]=t.split("."),n=/^\s*\d+\s*$/;if(!r||!r.match||!r.match(n))throw new se((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:t});if(!s||!s.match||!s.match(n))throw new se((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:t});const o=parseInt(r,10),a=parseInt(s,10);return new sT(o,a,i)}}class qae{constructor(t){this.data=t,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const t=this.offset4;return this.offset4+=1,this.dataUint32[t]}readUint8Array(t){const i=4*this.offset4;return this.offset4+=t/4,new Uint8Array(this.data,i,t)}remainingBytes(){return this.data.byteLength-4*this.offset4}}var YM,Wae;(function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"})(YM||(YM={})),function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Wae||(Wae={}));const lSe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Int={pbrMetallicRoughness:lSe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Lnt={ESRI_externalColorMixMode:"tint"},Zae=(e={})=>{const t={...lSe,...e.pbrMetallicRoughness},i=$nt({...Lnt,...e.extras});return{...Int,...e,pbrMetallicRoughness:t,extras:i}};function $nt(e){switch(e.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:e.ESRI_externalColorMixMode,e.ESRI_externalColorMixMode="tint"}return e}const Dnt={magFilter:mt.LINEAR,minFilter:mt.LINEAR_MIPMAP_LINEAR,wrapS:Ft.REPEAT,wrapT:Ft.REPEAT},Nnt=e=>({...Dnt,...e});function Fnt(e){let t,i;return e.replace(/^(.*\/)?([^/]*)$/,(r,s,n)=>(t=s||"",i=n||"","")),{dirPart:t,filePart:i}}const sD={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};class uy{constructor(t,i,r,s,n){this.context=t,this.errorContext=i,this.uri=r,this.json=s,this.glbBuffer=n,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=Fnt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.errorUnsupportedIf(s.scenes==null,"Scenes must be defined."),i.errorUnsupportedIf(s.meshes==null,"Meshes must be defined"),i.errorUnsupportedIf(s.nodes==null,"Nodes must be defined."),this._computeNodeParents()}static async load(t,i,r,s){if(Bm(r)){const a=Yk(r);if(a.mediaType!=="model/gltf-binary")try{const c=JSON.parse(a.isBase64?atob(a.data):a.data);return new uy(t,i,r,c)}catch{}const l=sfe(r);if(uy._isGLBData(l))return this._fromGLBData(t,i,r,l)}if(r.endsWith(".gltf")){const a=await t.loadJSON(r,s);return new uy(t,i,r,a)}const n=await t.loadBinary(r,s);if(uy._isGLBData(n))return this._fromGLBData(t,i,r,n);const o=await t.loadJSON(r,s);return new uy(t,i,r,o)}static _isGLBData(t){const i=new qae(t);return i.remainingBytes()>=4&&i.readUint32()===sD.MAGIC}static async _fromGLBData(t,i,r,s){const n=await uy._parseGLBData(i,s);return new uy(t,i,r,n.json,n.binaryData)}static async _parseGLBData(t,i){const r=new qae(i);t.assert(r.remainingBytes()>=12,"GLB binary data is insufficiently large.");const s=r.readUint32(),n=r.readUint32(),o=r.readUint32();t.assert(s===sD.MAGIC,"Magic first 4 bytes do not fit to expected GLB value."),t.assert(i.byteLength>=o,"GLB binary data is smaller than header specifies."),t.errorUnsupportedIf(n!==2,"An unsupported GLB container version was detected. Only version 2 is supported.");let a,l,c=0;for(;r.remainingBytes()>=8;){const h=r.readUint32(),p=r.readUint32();c===0?(t.assert(p===sD.CHUNK_TYPE_JSON,"First GLB chunk must be JSON."),t.assert(h>=0,"No JSON data found."),a=await Gnt(r.readUint8Array(h))):c===1?(t.errorUnsupportedIf(p!==sD.CHUNK_TYPE_BIN,"Second GLB chunk expected to be BIN."),l=r.readUint8Array(h)):t.warnUnsupported("More than 2 GLB chunks detected. Skipping."),c+=1}return a||t.error("No GLB JSON chunk detected."),{json:a,binaryData:l}}async getBuffer(t,i){const r=this.json.buffers[t],s=this.errorContext;if(r.uri==null)return s.assert(this.glbBuffer!=null,"GLB buffer not present"),this.glbBuffer;const n=await this._getBufferLoader(t,i);return s.assert(n.byteLength===r.byteLength,"Buffer byte lengths should match."),n}async _getBufferLoader(t,i){const r=this.bufferLoaders.get(t);if(r)return r;const s=this.json.buffers[t],n=this.context.loadBinary(this._resolveUri(s.uri),i).then(o=>new Uint8Array(o));return this.bufferLoaders.set(t,n),n}async getAccessor(t,i){const r=this.errorContext;r.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");const s=this.json.accessors[t];r.errorUnsupportedIf((s==null?void 0:s.bufferView)==null,"Some accessor does not specify a bufferView."),r.errorUnsupportedIf(s.type in[YM.MAT2,YM.MAT3,YM.MAT4],`AttributeType ${s.type} is not supported`);const n=this.json.bufferViews[s.bufferView],o=await this.getBuffer(n.buffer,i),a=znt[s.type],l=Bnt[s.componentType],c=a*l,h=n.byteStride||c;return{raw:o.buffer,byteStride:h,byteOffset:o.byteOffset+(n.byteOffset||0)+(s.byteOffset||0),entryCount:s.count,isDenselyPacked:h===c,componentCount:a,componentByteSize:l,componentType:s.componentType,min:s.min,max:s.max,normalized:!!s.normalized}}async getIndexData(t,i){if(t.indices==null)return null;const r=await this.getAccessor(t.indices,i);if(r.isDenselyPacked)switch(r.componentType){case Ct.UNSIGNED_BYTE:return new Uint8Array(r.raw,r.byteOffset,r.entryCount);case Ct.UNSIGNED_SHORT:return new Uint16Array(r.raw,r.byteOffset,r.entryCount);case Ct.UNSIGNED_INT:return new Uint32Array(r.raw,r.byteOffset,r.entryCount)}else switch(r.componentType){case Ct.UNSIGNED_BYTE:return NF(this._wrapAccessor(Qy,r));case Ct.UNSIGNED_SHORT:return NF(this._wrapAccessor(Hx,r));case Ct.UNSIGNED_INT:return NF(this._wrapAccessor(Wx,r))}}async getPositionData(t,i){const r=this.errorContext;r.errorUnsupportedIf(t.attributes.POSITION==null,"No POSITION vertex data found.");const s=await this.getAccessor(t.attributes.POSITION,i);return r.errorUnsupportedIf(s.componentType!==Ct.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+oD[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"POSITION vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(hr,s)}async getNormalData(t,i){const r=this.errorContext;r.assert(t.attributes.NORMAL!=null,"No NORMAL vertex data found.");const s=await this.getAccessor(t.attributes.NORMAL,i);return r.errorUnsupportedIf(s.componentType!==Ct.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+oD[s.componentType]),r.errorUnsupportedIf(s.componentCount!==3,"NORMAL vertex attribute must have 3 components, but found "+s.componentCount.toFixed()),this._wrapAccessor(hr,s)}async getTangentData(t,i){const r=this.errorContext;r.assert(t.attributes.TANGENT!=null,"No TANGENT vertex data found.");const s=await this.getAccessor(t.attributes.TANGENT,i);return r.errorUnsupportedIf(s.componentType!==Ct.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+oD[s.componentType]),r.errorUnsupportedIf(s.componentCount!==4,"TANGENT vertex attribute must have 4 components, but found "+s.componentCount.toFixed()),new fo(s.raw,s.byteOffset,s.byteStride,s.byteOffset+s.byteStride*s.entryCount)}async getTextureCoordinates(t,i){const r=this.errorContext;r.assert(t.attributes.TEXCOORD_0!=null,"No TEXCOORD_0 vertex data found.");const s=await this.getAccessor(t.attributes.TEXCOORD_0,i);return r.errorUnsupportedIf(s.componentCount!==2,"TEXCOORD_0 vertex attribute must have 2 components, but found "+s.componentCount.toFixed()),s.componentType===Ct.FLOAT?this._wrapAccessor(bd,s):(r.errorUnsupportedIf(!s.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),Vnt(s))}async getVertexColors(t,i){const r=this.errorContext;r.assert(t.attributes.COLOR_0!=null,"No COLOR_0 vertex data found.");const s=await this.getAccessor(t.attributes.COLOR_0,i);if(r.errorUnsupportedIf(s.componentCount!==4&&s.componentCount!==3,"COLOR_0 attribute must have 3 or 4 components, but found "+s.componentCount.toFixed()),s.componentCount===4){if(s.componentType===Ct.FLOAT)return this._wrapAccessor(fo,s);if(s.componentType===Ct.UNSIGNED_BYTE)return this._wrapAccessor(tc,s);if(s.componentType===Ct.UNSIGNED_SHORT)return this._wrapAccessor(c1,s)}else if(s.componentCount===3){if(s.componentType===Ct.FLOAT)return this._wrapAccessor(hr,s);if(s.componentType===Ct.UNSIGNED_BYTE)return this._wrapAccessor(l1,s);if(s.componentType===Ct.UNSIGNED_SHORT)return this._wrapAccessor(qx,s)}r.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+oD[s.componentType])}hasPositions(t){return t.attributes.POSITION!==void 0}hasNormals(t){return t.attributes.NORMAL!==void 0}hasVertexColors(t){return t.attributes.COLOR_0!==void 0}hasTextureCoordinates(t){return t.attributes.TEXCOORD_0!==void 0}hasTangents(t){return t.attributes.TANGENT!==void 0}async getMaterial(t,i,r){let s=this.materialCache.get(t.material);if(!s){const n=t.material!=null?Zae(this.json.materials[t.material]):Zae(),o=n.pbrMetallicRoughness,a=this.hasVertexColors(t),l=this.getTexture(o.baseColorTexture,i),c=this.getTexture(n.normalTexture,i),h=r?this.getTexture(n.occlusionTexture,i):null,p=r?this.getTexture(n.emissiveTexture,i):null,m=r?this.getTexture(o.metallicRoughnessTexture,i):null,g=t.material!=null?t.material:-1;s={alphaMode:n.alphaMode,alphaCutoff:n.alphaCutoff,color:o.baseColorFactor,doubleSided:!!n.doubleSided,colorTexture:await l,normalTexture:await c,name:n.name,id:g,occlusionTexture:await h,emissiveTexture:await p,emissiveFactor:n.emissiveFactor,metallicFactor:o.metallicFactor,roughnessFactor:o.roughnessFactor,metallicRoughnessTexture:await m,hasVertexColors:a,ESRI_externalColorMixMode:n.extras.ESRI_externalColorMixMode}}return s}async getTexture(t,i){if(!t)return null;this.errorContext.errorUnsupportedIf((t.texCoord||0)!==0,"Only TEXCOORD with index 0 is supported.");const r=t.index,s=this.errorContext,n=this.json.textures[r],o=Nnt(n.sampler!=null?this.json.samplers[n.sampler]:{});s.errorUnsupportedIf(n.source==null,"Source is expected to be defined for a texture.");const a=this.json.images[n.source],l=await this._loadTextureImageData(r,n,i);return uZ(this.textureCache,r,()=>{const c=p=>p===33071||p===33648||p===10497,h=p=>(s.error(`Unexpected TextureSampler WrapMode: ${p}. Using default REPEAT(10497).`),10497);return{data:l,wrapS:c(o.wrapS)?o.wrapS:h(o.wrapS),wrapT:c(o.wrapT)?o.wrapT:h(o.wrapT),minFilter:o.minFilter,name:a.name,id:r}})}getNodeTransform(t){if(t===void 0)return Unt;let i=this.nodeTransformCache.get(t);if(!i){const r=this.getNodeTransform(this._getNodeParent(t)),s=this.json.nodes[t];s.matrix?i=hs(Be(),r,s.matrix):s.translation||s.rotation||s.scale?(i=ux(r),s.translation&&hl(i,i,s.translation),s.rotation&&(nD[3]=D1e(nD,s.rotation),Dc(i,i,nD[3],nD)),s.scale&&rU(i,i,s.scale)):i=r,this.nodeTransformCache.set(t,i)}return i}_wrapAccessor(t,i){return new t(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*(i.entryCount-1)+i.componentByteSize*i.componentCount)}_resolveUri(t){return cd(t,this.baseUri)}_getNodeParent(t){return this.nodeParentMap.get(t)}_checkVersionSupported(){const t=sT.parse(this.json.asset.version,"glTF");knt.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json,i=this.errorContext;t.extensionsRequired&&t.extensionsRequired.length!==0&&i.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,i)=>{t.children&&t.children.forEach(r=>{this.nodeParentMap.set(r,i)})})}async _loadTextureImageData(t,i,r){const s=this.textureLoaders.get(t);if(s)return s;const n=this._createTextureLoader(i,r);return this.textureLoaders.set(t,n),n}async _createTextureLoader(t,i){const r=this.json.images[t.source];if(r.uri)return this.context.loadImage(this._resolveUri(r.uri),i);const s=this.errorContext;s.errorUnsupportedIf(r.bufferView==null,"Image bufferView must be defined."),s.errorUnsupportedIf(r.mimeType==null,"Image mimeType must be defined.");const n=this.json.bufferViews[r.bufferView],o=await this.getBuffer(n.buffer,i);return s.errorUnsupportedIf(n.byteStride!=null,"byteStride not supported for image buffer"),jnt(new Uint8Array(o.buffer,o.byteOffset+(n.byteOffset||0),n.byteLength),r.mimeType)}}const knt=new sT(2,0,"glTF"),Unt=ome(Be(),Math.PI/2),nD=s0(),znt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Bnt={[Ct.BYTE]:1,[Ct.UNSIGNED_BYTE]:1,[Ct.SHORT]:2,[Ct.UNSIGNED_SHORT]:2,[Ct.FLOAT]:4,[Ct.UNSIGNED_INT]:4};function Vnt(e){switch(e.componentType){case Ct.BYTE:return new Zx(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ct.UNSIGNED_BYTE:return new jx(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ct.SHORT:return new Xx(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ct.UNSIGNED_SHORT:return new fC(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ct.UNSIGNED_INT:return new mC(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);case Ct.FLOAT:return new bd(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount);default:return void(e.componentType,void 0)}}async function Gnt(e){return new Promise((t,i)=>{const r=new Blob([e]),s=new FileReader;s.onload=()=>{const n=s.result;t(JSON.parse(n))},s.onerror=n=>{i(n)},s.readAsText(r)})}async function jnt(e,t){return new Promise((i,r)=>{const s=new Blob([e],{type:t}),n=URL.createObjectURL(s),o=new Image;o.addEventListener("load",()=>{URL.revokeObjectURL(n),"decode"in o?o.decode().then(()=>i(o),()=>i(o)):i(o)}),o.addEventListener("error",a=>{URL.revokeObjectURL(n),r(a)}),o.src=n})}const oD={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let Hnt=0;async function cSe(e,t,i={},r=!0){const s=await uy.load(e,FF,t,i),n="gltf_"+Hnt++,o={lods:[],materials:new Map,textures:new Map,meta:qnt(s)},a=!(!s.json.asset.extras||s.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await Wnt(s,async(c,h,p,m)=>{var G;const g=(G=l.get(p))!=null?G:0;l.set(p,g+1);const v=c.mode!==void 0?c.mode:Yt.TRIANGLES,b=v===Yt.TRIANGLES||v===Yt.TRIANGLE_STRIP||v===Yt.TRIANGLE_FAN?v:null;if(N(b))return void FF.warnUnsupported("Unsupported primitive mode ("+Qnt[v]+"). Skipping primitive.");if(!s.hasPositions(c))return void FF.warn("Skipping primitive without POSITION vertex attribute.");const S=s.getPositionData(c,i),T=s.getMaterial(c,i,r),O=s.hasNormals(c)?s.getNormalData(c,i):null,C=s.hasTangents(c)?s.getTangentData(c,i):null,M=s.hasTextureCoordinates(c)?s.getTextureCoordinates(c,i):null,I=s.hasVertexColors(c)?s.getVertexColors(c,i):null,$=s.getIndexData(c,i),U={transform:ux(h),attributes:{position:await S,normal:O?await O:null,texCoord0:M?await M:null,color:I?await I:null,tangent:C?await C:null},indices:await $,primitiveType:b,material:Xnt(o,await T,n)};let q=null;w(o.meta)&&w(o.meta.ESRI_lod)&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(q=o.meta.ESRI_lod.thresholds[p]),o.lods[p]=o.lods[p]||{parts:[],name:m,lodThreshold:q},o.lods[p].parts[g]=U});for(const c of o.lods)c.parts=c.parts.filter(h=>!!h);return{model:o,meta:{isEsriSymbolResource:a,uri:s.uri},customMeta:{}}}function qnt(e){const t=e.json;let i=null;return t.nodes.forEach(r=>{const s=r.extras;w(s)&&(s.ESRI_proxyEllipsoid||s.ESRI_lod)&&(i=s)}),i}async function Wnt(e,t){const i=e.json,r=i.scenes[i.scene||0].nodes,s=r.length>1,n=[];for(const a of r){const l=i.nodes[a];n.push(o(a,0)),Znt(l)&&!s&&l.extensions.MSFT_lod.ids.forEach((c,h)=>o(c,h+1))}async function o(a,l){const c=i.nodes[a],h=e.getNodeTransform(a);if(FF.warnUnsupportedIf(c.weights!=null,"Morph targets are not supported."),c.mesh!=null){const p=i.meshes[c.mesh];for(const m of p.primitives)n.push(t(m,h,l,p.name))}for(const p of c.children||[])n.push(o(p,l))}await Promise.all(n)}function Znt(e){return e.extensions&&e.extensions.MSFT_lod&&Array.isArray(e.extensions.MSFT_lod.ids)}function Xnt(e,t,i){const r=n=>{const o=`${i}_tex_${n&&n.id}${n&&n.name?"_"+n.name:""}`;if(n&&!e.textures.has(o)){const a=Pnt(n.data,{wrap:{s:n.wrapS,t:n.wrapT},mipmap:Ynt.includes(n.minFilter),noUnpackFlip:!0});e.textures.set(o,a)}return o},s=`${i}_mat_${t.id}_${t.name}`;if(!e.materials.has(s)){const n=Mnt({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?r(t.colorTexture):void 0,textureNormal:t.normalTexture?r(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?r(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?r(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?r(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});e.materials.set(s,n)}return s}const FF=new Rnt,Ynt=[mt.LINEAR_MIPMAP_LINEAR,mt.LINEAR_MIPMAP_NEAREST],Qnt=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"];function Jnt(e,t=yC){return typeof e=="number"?t(e):n4(e)||vw(e)?new Uint32Array(e):e}function Knt(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;n+=1)n%2==0?(r[s++]=n,r[s++]=n+1,r[s++]=n+2):(r[s++]=n+1,r[s++]=n,r[s++]=n+2)}else{let s=0;for(let n=0;n<i;n+=1)if(n%2==0){const o=e[n],a=e[n+1],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}else{const o=e[n+1],a=e[n],l=e[n+2];r[s++]=o,r[s++]=a,r[s++]=l}}return r}function eot(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const i=t-2,r=i<=65536?new Uint16Array(3*i):new Uint32Array(3*i);if(typeof e=="number"){let s=0;for(let n=0;n<i;++n)r[s++]=0,r[s++]=n+1,r[s++]=n+2;return r}{const s=e[0];let n=e[1],o=0;for(let a=0;a<i;++a){const l=e[a+2];r[o++]=s,r[o++]=n,r[o++]=l,n=l}return r}}const Kg=Ie.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function uSe(e,t){const i=await tot(e,t);return{resource:i,textures:await oot(i.textureDefinitions,t)}}async function tot(e,t){const i=w(t)&&t.streamDataRequester;if(i)return iot(e,i,t);const r=await Xp(jr(e,t));if(r.ok===!0)return r.value.data;e0(r.error),hSe(r.error)}async function iot(e,t,i){const r=await Xp(t.request(e,"json",i));if(r.ok===!0)return r.value;e0(r.error),hSe(r.error.details.url)}function hSe(e){throw new se("",`Request for object resource failed: ${e}`)}function rot(e){const t=e.params,i=t.topology;let r=!0;switch(t.vertexAttributes||(Kg.warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const n=t.faces;if(n){if(t.vertexAttributes)for(const o in t.vertexAttributes){const a=n[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(Kg.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),r=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(Kg.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),r=!1)):(Kg.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),r=!1)}}else Kg.warn("Indexed geometries must specify faces"),r=!1;break}default:Kg.warn(`Unsupported topology '${i}'`),r=!1}e.params.material||(Kg.warn("Geometry requires material"),r=!1);const s=e.params.vertexAttributes;for(const n in s)s[n].values||(Kg.warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function sot(e,t){const i=[],r=[],s=[],n=[],o=e.resource,a=sT.parse(o.version||"1.0","wosr");lot.validate(a);const l=o.model.name,c=o.model.geometries,h=o.materialDefinitions,p=e.textures;let m=0;const g=new Map;for(let v=0;v<c.length;v++){const b=c[v];if(!rot(b))continue;const S=aot(b),T=b.params.vertexAttributes,O=[];for(const G in T){const Y=T[G],J=Y.values;O.push([G,{data:J,size:Y.valuesPerElement,exclusive:!0}])}const C=[];if(b.params.topology!=="PerAttributeArray"){const G=b.params.faces;for(const Y in G)C.push([Y,new Uint32Array(G[Y].values)])}const M=p&&p[S.texture];if(M&&!g.has(S.texture)){const{image:G,params:Y}=M,J=new sn(G,Y);n.push(J),g.set(S.texture,J)}const I=g.get(S.texture),$=I?I.id:void 0;let U=s[S.material]?s[S.material][S.texture]:null;if(!U){const G=h[S.material.substring(S.material.lastIndexOf("/")+1)].params;G.transparency===1&&(G.transparency=0);const Y=M&&M.alphaChannelUsage,J=G.transparency>0||Y==="transparency"||Y==="maskAndTransparency",X=M?dSe(M.alphaChannelUsage):void 0,ne={ambient:$l(G.diffuse),diffuse:$l(G.diffuse),opacity:1-(G.transparency||0),transparent:J,textureAlphaMode:X,textureAlphaCutoff:.33,textureId:$,initTextureTransparent:!0,doubleSided:!0,cullFace:Ir.None,colorMixMode:G.externalColorMixMode||"tint",textureAlphaPremultiplied:!!M&&!!M.params.preMultiplyAlpha};w(t)&&t.materialParamsMixin&&Object.assign(ne,t.materialParamsMixin),U=new iT(ne),s[S.material]||(s[S.material]={}),s[S.material][S.texture]=U}r.push(U);const q=new ss(O,C);m+=C.position?C.position.length:0,i.push(q)}return{name:l,stageResources:{textures:n,materials:r,geometries:i},pivotOffset:o.model.pivotOffset,boundingBox:not(i),numberOfVertices:m,lodThreshold:null}}function not(e){const t=Fr();return e.forEach(i=>{const r=i.boundingInfo;w(r)&&(Rm(t,r.getBBMin()),Rm(t,r.getBBMax()))}),t}async function oot(e,t){const i=[];for(const n in e){const o=e[n],a=o.images[0].data;if(!a){Kg.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+n,h=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",p={noUnpackFlip:!0,wrap:{s:Ft.REPEAT,t:Ft.REPEAT},preMultiplyAlpha:dSe(h)!==Mr.Opaque},m=w(t)&&t.disableTextures?Promise.resolve(null):Qp(l,t);i.push(m.then(g=>({refId:c,image:g,params:p,alphaChannelUsage:h})))}const r=await Promise.all(i),s={};for(const n of r)s[n.refId]=n;return s}function dSe(e){switch(e){case"mask":return Mr.Mask;case"maskAndTransparency":return Mr.MaskBlend;case"none":return Mr.Opaque;default:return Mr.Blend}}function aot(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const lot=new sT(1,2,"wosr"),_S=2.1;async function pSe(e,t){const i=fSe(ynt(e));if(i.fileType==="wosr"){const l=await(t.cache?t.cache.loadWOSR(i.url,t):uSe(i.url,t)),c=sot(l,t);return{lods:[c],referenceBoundingBox:c.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:l.remove}}const r=await(t.cache?t.cache.loadGLTF(i.url,t,t.usePBR):cSe(new aSe(t.streamDataRequester),i.url,t,t.usePBR)),s=Mn(r.model.meta,"ESRI_proxyEllipsoid");r.meta.isEsriSymbolResource&&w(s)&&r.meta.uri.includes("/RealisticTrees/")&&hot(r,s);const n=r.meta.isEsriSymbolResource?{usePBR:t.usePBR,isSchematic:!1,treeRendering:!!r.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:t.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},o={...t.materialParamsMixin,treeRendering:!!r.customMeta.esriTreeRendering};if(i.specifiedLodIndex!=null){const l=kF(r,n,o,i.specifiedLodIndex);let c=l[0].boundingBox;return i.specifiedLodIndex!==0&&(c=kF(r,n,o,0)[0].boundingBox),{lods:l,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}const a=kF(r,n,o);return{lods:a,referenceBoundingBox:a[0].boundingBox,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1,remove:r.remove}}function fSe(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function kF(e,t,i,r){const s=e.model,n=Qr(),o=new Array,a=new Map,l=new Map;return s.lods.forEach((c,h)=>{if(r!==void 0&&h!==r)return;const p={name:c.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:w(c.lodThreshold)?c.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:Fr()};o.push(p),c.parts.forEach(m=>{const g=m.material+(m.attributes.normal?"_normal":"")+(m.attributes.color?"_color":"")+(m.attributes.texCoord0?"_texCoord0":"")+(m.attributes.tangent?"_tangent":""),v=s.materials.get(m.material),b=w(m.attributes.texCoord0),S=w(m.attributes.normal),T=cot(v.alphaMode);if(!a.has(g)){if(b){if(w(v.textureColor)&&!l.has(v.textureColor)){const pe=s.textures.get(v.textureColor),z={...pe.parameters,preMultiplyAlpha:T!==Mr.Opaque};l.set(v.textureColor,new sn(pe.data,z))}if(w(v.textureNormal)&&!l.has(v.textureNormal)){const pe=s.textures.get(v.textureNormal);l.set(v.textureNormal,new sn(pe.data,pe.parameters))}if(w(v.textureOcclusion)&&!l.has(v.textureOcclusion)){const pe=s.textures.get(v.textureOcclusion);l.set(v.textureOcclusion,new sn(pe.data,pe.parameters))}if(w(v.textureEmissive)&&!l.has(v.textureEmissive)){const pe=s.textures.get(v.textureEmissive);l.set(v.textureEmissive,new sn(pe.data,pe.parameters))}if(w(v.textureMetallicRoughness)&&!l.has(v.textureMetallicRoughness)){const pe=s.textures.get(v.textureMetallicRoughness);l.set(v.textureMetallicRoughness,new sn(pe.data,pe.parameters))}}const G=v.color[0]**(1/_S),Y=v.color[1]**(1/_S),J=v.color[2]**(1/_S),X=v.emissiveFactor[0]**(1/_S),ne=v.emissiveFactor[1]**(1/_S),re=v.emissiveFactor[2]**(1/_S),ye=w(v.textureColor)&&b?l.get(v.textureColor):null;a.set(g,new iT({...t,transparent:T===Mr.Blend,customDepthTest:Ux.Lequal,textureAlphaMode:T,textureAlphaCutoff:v.alphaCutoff,diffuse:[G,Y,J],ambient:[G,Y,J],opacity:v.opacity,doubleSided:v.doubleSided,doubleSidedType:"winding-order",cullFace:v.doubleSided?Ir.None:Ir.Back,hasVertexColors:!!m.attributes.color,hasVertexTangents:!!m.attributes.tangent,normals:S?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:w(ye)?ye.id:void 0,colorMixMode:v.colorMixMode,normalTextureId:w(v.textureNormal)&&b?l.get(v.textureNormal).id:void 0,textureAlphaPremultiplied:w(ye)&&!!ye.params.preMultiplyAlpha,occlusionTextureId:w(v.textureOcclusion)&&b?l.get(v.textureOcclusion).id:void 0,emissiveTextureId:w(v.textureEmissive)&&b?l.get(v.textureEmissive).id:void 0,metallicRoughnessTextureId:w(v.textureMetallicRoughness)&&b?l.get(v.textureMetallicRoughness).id:void 0,emissiveFactor:[X,ne,re],mrrFactors:[v.metallicFactor,v.roughnessFactor,t.mrrFactors[2]],isSchematic:!1,...i}))}const O=uot(m.indices||m.attributes.position.count,m.primitiveType),C=m.attributes.position.count,M=Dw(hr,C);bI(M,m.attributes.position,m.transform);const I=[[D.POSITION,{data:M.typedBuffer,size:M.elementCount,exclusive:!0}]],$=[[D.POSITION,O]];if(w(m.attributes.normal)){const G=Dw(hr,C);cC(n,m.transform),g1(G,m.attributes.normal,n),I.push([D.NORMAL,{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),$.push([D.NORMAL,O])}if(w(m.attributes.tangent)){const G=Dw(fo,C);cC(n,m.transform),iSe(G,m.attributes.tangent,n),I.push([D.TANGENT,{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),$.push([D.TANGENT,O])}if(w(m.attributes.texCoord0)){const G=Dw(bd,C);sSe(G,m.attributes.texCoord0),I.push([D.UV0,{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),$.push([D.UV0,O])}if(w(m.attributes.color)){const G=Dw(tc,C);if(m.attributes.color.elementCount===4)m.attributes.color instanceof fo?_W(G,m.attributes.color,255):m.attributes.color instanceof tc?nSe(G,m.attributes.color):m.attributes.color instanceof c1&&_W(G,m.attributes.color,1/256);else{oSe(G,255,255,255,255);const Y=new l1(G.buffer,0,4);m.attributes.color instanceof hr?aW(Y,m.attributes.color,255):m.attributes.color instanceof l1?jz(Y,m.attributes.color):m.attributes.color instanceof qx&&aW(Y,m.attributes.color,1/256)}I.push([D.COLOR,{data:G.typedBuffer,size:G.elementCount,exclusive:!0}]),$.push([D.COLOR,O])}const U=new ss(I,$);p.stageResources.geometries.push(U),p.stageResources.materials.push(a.get(g)),b&&(w(v.textureColor)&&p.stageResources.textures.push(l.get(v.textureColor)),w(v.textureNormal)&&p.stageResources.textures.push(l.get(v.textureNormal)),w(v.textureOcclusion)&&p.stageResources.textures.push(l.get(v.textureOcclusion)),w(v.textureEmissive)&&p.stageResources.textures.push(l.get(v.textureEmissive)),w(v.textureMetallicRoughness)&&p.stageResources.textures.push(l.get(v.textureMetallicRoughness))),p.numberOfVertices+=C;const q=U.boundingInfo;w(q)&&(Rm(p.boundingBox,q.getBBMin()),Rm(p.boundingBox,q.getBBMax()))})}),o}function cot(e){switch(e){case"BLEND":return Mr.Blend;case"MASK":return Mr.Mask;case"OPAQUE":case null:case void 0:return Mr.Opaque}}function uot(e,t){switch(t){case Yt.TRIANGLES:return Jnt(e);case Yt.TRIANGLE_STRIP:return Knt(e);case Yt.TRIANGLE_FAN:return eot(e)}}function hot(e,t){for(let i=0;i<e.model.lods.length;++i){const r=e.model.lods[i];e.customMeta.esriTreeRendering=!0;for(const s of r.parts){const n=s.attributes.normal;if(N(n))return;const o=s.attributes.position,a=o.count,l=F(),c=F(),h=F(),p=Dw(tc,a),m=Dw(hr,a),g=Fs(Be(),s.transform);for(let v=0;v<a;v++){o.getVec(v,c),n.getVec(v,l),et(c,c,s.transform),Me(h,c,t.center),w4(h,h,t.radius);const b=h[2],S=He(h),T=Math.min(.45+.55*S*S,1);w4(h,h,t.radius),et(h,h,g),De(h,h),i+1!==e.model.lods.length&&e.model.lods.length>1&&Nn(h,h,l,b>-1?.2:Math.min(-4*b-3.8,1)),m.setVec(v,h),p.set(v,0,255*T),p.set(v,1,255*T),p.set(v,2,255*T),p.set(v,3,255)}s.attributes.normal=m,s.attributes.color=p}}}const iwt=Object.freeze(Object.defineProperty({__proto__:null,fetch:pSe,gltfToEngineResources:kF,parseUrl:fSe},Symbol.toStringTag,{value:"Module"}));var Zr;function dot(e){let t=As().mat4f64(D.LOCALTRANSFORM).mat4f64(D.GLOBALTRANSFORM).vec4f64(D.BOUNDINGSPHERE).vec3f64(D.MODELORIGIN).mat3f(D.MODEL).mat3f(D.MODELNORMAL).vec2f(D.MODELSCALEFACTORS);return e.includes("color")&&(t=t.vec4f(D.COLOR)),e.includes("featureAttribute")&&(t=t.vec4f(D.FEATUREATTRIBUTE)),t=t.u8(D.STATE).u8(D.LODLEVEL).alignTo(8),t}(function(e){e[e.ALLOCATED=1]="ALLOCATED",e[e.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",e[e.VISIBLE=4]="VISIBLE",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",e[e.REMOVE=32]="REMOVE",e[e.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",e[e.ACTIVE=18]="ACTIVE"})(Zr||(Zr={}));class pot{constructor(t){this.localTransform=t.getField(D.LOCALTRANSFORM,a1),this.globalTransform=t.getField(D.GLOBALTRANSFORM,a1),this.modelOrigin=t.getField(D.MODELORIGIN,Ws),this.model=t.getField(D.MODEL,Jp),this.modelNormal=t.getField(D.MODELNORMAL,Jp),this.modelScaleFactors=t.getField(D.MODELSCALEFACTORS,bd),this.boundingSphere=t.getField(D.BOUNDINGSPHERE,Gx),this.color=t.getField(D.COLOR,fo),this.featureAttribute=t.getField(D.FEATUREATTRIBUTE,fo),this.state=t.getField(D.STATE,Qy),this.lodLevel=t.getField(D.LODLEVEL,Qy)}}class fot extends ks{constructor(t,i){super(),this._capacity=0,this._size=0,this._next=0,this._layout=dot(t),this._shaderTransformation=i}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const t=this._findSlot();return this._view.state.set(t,Zr.ALLOCATED),this._size++,this.emit("instance-added",{index:t}),t}removeInstance(t){const i=this._view.state;At(t>=0&&t<this._capacity&&i.get(t)&Zr.ALLOCATED,"invalid instance handle"),this._getStateFlag(t,Zr.ACTIVE)?this._setStateFlags(t,Zr.REMOVE):this.freeInstance(t),this.emit("instance-removed",{index:t})}freeInstance(t){const i=this._view.state;At(t>=0&&t<this._capacity&&i.get(t)&Zr.ALLOCATED,"invalid instance handle"),i.set(t,0),this._size--}setLocalTransform(t,i,r=!0){this._view.localTransform.setMat(t,i),r&&this.updateModelTransform(t)}getLocalTransform(t,i){this._view.localTransform.getMat(t,i)}setGlobalTransform(t,i,r=!0){this._view.globalTransform.setMat(t,i),r&&this.updateModelTransform(t)}getGlobalTransform(t,i){this._view.globalTransform.getMat(t,i)}updateModelTransform(t){const i=this._view,r=J0,s=Bd;i.localTransform.getMat(t,Xae),i.globalTransform.getMat(t,K8);const n=hs(K8,K8,Xae);fe(r,n[12],n[13],n[14]),i.modelOrigin.setVec(t,r),_d(s,n),i.model.setMat(t,s);const o=u$e(J0,n);o.sort(),i.modelScaleFactors.set(t,0,o[1]),i.modelScaleFactors.set(t,1,o[2]),wT(s,s),vd(s,s),i.modelNormal.setMat(t,s),this._setStateFlags(t,Zr.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:t})}getModelTransform(t,i){const r=this._view;r.model.getMat(t,Bd),r.modelOrigin.getVec(t,J0),i[0]=Bd[0],i[1]=Bd[1],i[2]=Bd[2],i[3]=0,i[4]=Bd[3],i[5]=Bd[4],i[6]=Bd[5],i[7]=0,i[8]=Bd[6],i[9]=Bd[7],i[10]=Bd[8],i[11]=0,i[12]=J0[0],i[13]=J0[1],i[14]=J0[2],i[15]=1}applyShaderTransformation(t,i){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i)}getCombinedModelTransform(t,i){return this.getModelTransform(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedLocalTransform(t,i){return this._view.localTransform.getMat(t,i),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,t,i),i}getCombinedMaxScaleFactor(t){let i=this._view.modelScaleFactors.get(t,1);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(J0,this,t);i*=Math.max(r[0],r[1],r[2])}return i}getCombinedMedianScaleFactor(t){let i=this._view.modelScaleFactors.get(t,0);if(this._shaderTransformation){const r=this._shaderTransformation.scaleFactor(J0,this,t);r.sort(),i*=r[1]}return i}getModel(t,i){this._view.model.getMat(t,i)}setFeatureAttribute(t,i){this._view.featureAttribute.setVec(t,i)}getFeatureAttribute(t,i){this._view.featureAttribute.getVec(t,i)}setColor(t,i){this._view.color.setVec(t,i)}getColor(t,i){this._view.color.getVec(t,i)}setVisible(t,i){i!==this.getVisible(t)&&(this._setStateFlag(t,Zr.VISIBLE,i),this.emit("instance-visibility-changed",{index:t}))}getVisible(t){return this._getStateFlag(t,Zr.VISIBLE)}setHighlight(t,i){i!==this.getHighlight(t)&&(this._setStateFlag(t,Zr.HIGHLIGHT,i),this.emit("instance-highlight-changed",{index:t}))}getHighlight(t){return this._getStateFlag(t,Zr.HIGHLIGHT)}getState(t){return this._view.state.get(t)}getLodLevel(t){return this._view.lodLevel.get(t)}countFlags(t){let i=0;for(let r=0;r<this._capacity;++r)this.getState(r)&t&&++i;return i}_setStateFlags(t,i){const r=this._view.state;i=r.get(t)|i,r.set(t,i)}_clearStateFlags(t,i){const r=this._view.state;i=r.get(t)&~i,r.set(t,i)}_setStateFlag(t,i,r){r?this._setStateFlags(t,i):this._clearStateFlags(t,i)}_getStateFlag(t,i){return!!(this._view.state.get(t)&i)}_grow(){const t=Math.max(mot,Math.floor(this._capacity*got)),i=this._layout.createBuffer(t);if(this._buffer){const r=new Uint8Array(this._buffer.buffer);new Uint8Array(i.buffer).set(r)}this._capacity=t,this._buffer=i,this._view=new pot(this._buffer)}_findSlot(){const t=this._view.state;let i=this._next;for(;t.get(i)&Zr.ALLOCATED;)i=(i+1)%this._capacity;return this._next=(i+1)%this._capacity,i}}const mot=1024,got=2,J0=F(),Bd=Qr(),Xae=Be(),K8=Be();class yot extends $p{constructor(t,i){super(r=>this._instanceData.view.boundingSphere.getVec(r,this._tmpSphere),{maximumDepth:25}),this._tmpSphere=Qn(),this._tmpMat4=Be(),this._instanceData=t,this._boundingSphere=i}addInstance(t){const i=this._instanceData.view.boundingSphere,r=this._instanceData.getCombinedModelTransform(t,this._tmpMat4);et(this._tmpSphere,this._boundingSphere.center,r),this._tmpSphere[3]=this._boundingSphere.radius*Dx(r),i.setVec(t,this._tmpSphere),this.add([t])}removeInstance(t){this.remove([t])}}class _ot{constructor(t,i){this.thresholdScale=1,this._camera=new wr,this._worldSpaceRadius=t,this._thresholds=i.map(r=>r)}updateCamera(t){this._camera.copyFrom(t)}selectLevel(t,i){const r=this._camera.computeScreenPixelSizeAt(t),s=this._worldSpaceRadius*i/r,n=this._thresholds;let o=-1;for(let a=0;a<n.length;++a)s>=n[a]*this.thresholdScale&&(o=a);return o}}class vot{constructor(t,i){const r=t.renderContext.rctx,{geometry:s,material:n}=i;this._materialRepository=t.materialRep,n.setParameters({instancedDoublePrecision:!0});const o=n.createBufferWriter(),a=o.vertexBufferLayout,l=o.elementCount(s),c=o.allocate(l);o.write({},s,c,0),this.geometry=s,this.material=n,this.glMaterials=new Zxe(n,this._materialRepository),this.vertexBufferLayout=a,this.vbo=Ai.createVertex(r,Gi.STATIC_DRAW,c.buffer),this.vao=new pn(r,or,{geometry:Yc(a)},{geometry:this.vbo}),this.vertexCount=l}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(t,i,r,s,n,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,r,s,(h,p,m,g,v)=>{if(h>=0){if(i!=null&&!i(t.rayBegin,t.rayEnd,h))return;const b={layerUid:o.layerUid,graphicUid:o.graphicUid(n),geometryId:c,triangleNr:m,baseBoundingSphere:a,numLodLevels:l};if((t.results.min.drapedLayerOrder==null||v>=t.results.min.drapedLayerOrder)&&(t.results.min.dist==null||h<t.results.min.dist)&&t.results.min.set(ls.LOD,b,h,p,t.transform.transform,v),t.options.store!==Uo.MIN&&(t.results.max.drapedLayerOrder==null||v>=t.results.max.drapedLayerOrder)&&(t.results.max.dist==null||h>t.results.max.dist)&&t.results.max.set(ls.LOD,b,h,p,t.transform.transform,v),t.options.store===Uo.ALL){const S=UQ(t.results.min.ray);S.set(ls.LOD,b,h,p,t.transform.transform,v),t.results.all.push(S)}}})}}class FJ{constructor(t,i){this.minScreenSpaceRadius=t,this.components=i}static async create(t,i,r){const s=await Promise.allSettled(i.components.map(o=>t.schedule(()=>new vot(t,o),r))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(An(r)||n.length!==s.length){n.forEach(o=>o.destroy()),Ui(r);for(const o of s)if(o.status==="rejected")throw o.reason}return new FJ(i.minScreenSpaceRadius,n)}destroy(){this.components.forEach(t=>t.destroy())}intersect(t,i,r,s,n,o,a){this.components.forEach(l=>l.intersect(t,i,r,s,n,o,this.boundingSphere,a))}get boundingBox(){if(N(this._boundingBox)){const t=Fr();this.components.forEach(i=>{w(i.boundingInfo)&&(Rm(t,i.boundingInfo.bbMin),Rm(t,i.boundingInfo.bbMax))}),this._boundingBox=t}return this._boundingBox}get boundingSphere(){if(N(this._boundingSphere)){const t=this.boundingBox,i=F();Op(t,i),this._boundingSphere={center:i,radius:.5*Gpe(t)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((t,i)=>t+i.triangleCount,0)}}class bot{constructor(t,i,r){this._elementSize=i,this._buffer=Ai.createVertex(t,Gi.STATIC_DRAW),this.resize(r)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(t,i,r,s=0){const n=new Uint8Array(this.array,t*this.elementSize,(i-t)*this.elementSize);new Uint8Array(r.array,s*this.elementSize).set(n)}transferAll(){this._buffer.setData(this._array)}transferRange(t,i){const r=t*this._elementSize,s=i*this._elementSize;this._buffer.setSubData(this._array,r,r,s)}resize(t){const i=t*this._elementSize,r=new ArrayBuffer(i);this._array&&(t>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,t*this._elementSize))),this._array=r,this._buffer.setSize(i),this._capacity=t}}class wot{constructor(t){this.modelOriginHi=t.getField(D.MODELORIGINHI,hr),this.modelOriginLo=t.getField(D.MODELORIGINLO,hr),this.model=t.getField(D.MODEL,Jp),this.modelNormal=t.getField(D.MODELNORMAL,Jp),this.color=t.getField(D.INSTANCECOLOR,fo),this.featureAttribute=t.getField(D.INSTANCEFEATUREATTRIBUTE,fo)}}class Yae{constructor(t,i){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=t,this._instanceBufferLayout=i,this._elementSize=i.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const t=this._headIndex,i=this._tailIndex;return t>=i?t-i:t+this._capacity-i}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){At(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){At(this._updating,"not updating"),this.size<Tot*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){At(this._updating,"not updating"),this.isFull&&this._grow();const t=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=t,this._captureFirstIndex=!1),this._incrementHead(),At(this._headIndex!==this._tailIndex,"invalid pointers"),t}freeTail(){At(this._updating,"not updating"),At(this.size>0,"invalid size");const t=this._tailIndex===this._firstIndex;this._incrementTail(),t&&(this._firstIndex=this._tailIndex)}_grow(){const t=Math.max(Qae,Math.floor(this._capacity*xot));this._resize(t)}_shrink(){const t=Math.max(Qae,Math.floor(this._capacity*Sot));this._resize(t)}_resize(t){if(At(this._updating,"not updating"),t===this._capacity)return;const i=new bot(this._rctx,this._elementSize,t);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const r=this.size,s=this._compactInstances(i);At(s===r,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=s,this._prevHeadIndex=0}this._resized=!0,this._capacity=t,this._buffer=i,this._view=new wot(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(t){const i=this._headIndex,r=this._tailIndex;return r<i?(this._buffer.copyRange(r,i,t),i-r):r>i?(this._buffer.copyRange(r,this._capacity,t),i>0&&this._buffer.copyRange(0,i,t,this._capacity-r),i+(this._capacity-r)):0}_incrementHead(t=1){this._headIndex=(this._headIndex+t)%this._capacity}_incrementTail(t=1){this._tailIndex=(this._tailIndex+t)%this._capacity}_transferRange(t,i){t<i?this._buffer.transferRange(t,i):t>i&&(i>0&&this._buffer.transferRange(0,i),this._buffer.transferRange(t,this._capacity))}}const Qae=1024,xot=2,Tot=.3,Sot=.5;let Eot=e=>{const t=e.baseBoundingSphere.radius,i=e.levels.map(r=>r.minScreenSpaceRadius);return new _ot(t,i)};class Cot{constructor(t,i,r,s){this.type=ls.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new wr,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[Ue.OPAQUE_MATERIAL,Ue.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=t,this._optionalFields=i,this._metadata=r,this._instanceBufferLayout=NTe({instancedDoublePrecision:!0,instanced:i}),this._glInstanceBufferLayout=Yc(this._instanceBufferLayout,1),this._instanceData=new fot(this._optionalFields,s),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",n=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(n.index)}),this._instanceData.on("instance-visibility-changed",n=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(n.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(t){this._slicePlane=t}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const t={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),this._highlightRenderInstanceData.forEach(i=>{const r=i.memoryUsage;t.cpu+=r.cpu,t.gpu+=r.gpu}),t}get renderStats(){const t=this._instanceData.size,i=[];return this._levels.forEach((r,s)=>{const n=this._defaultRenderInstanceData[s],o=this._highlightRenderInstanceData[s],a=n.size+o.size,l=r.triangleCount;i.push({renderedInstances:a,renderedTriangles:a*l,trianglesPerInstance:l})}),{totalInstances:t,renderedInstances:i.reduce((r,s)=>r+s.renderedInstances,0),renderedTriangles:i.reduce((r,s)=>r+s.renderedTriangles,0),levels:i}}async initializeRenderContext(t,i){this._context=t;const r=t.renderContext.rctx,s=await Promise.allSettled(this._symbol.levels.map(o=>(this._defaultRenderInstanceData.push(new Yae(r,this._instanceBufferLayout)),this._highlightRenderInstanceData.push(new Yae(r,this._instanceBufferLayout)),FJ.create(t,o,i)))),n=s.map(o=>o.status==="fulfilled"?o.value:null).filter(o=>o);if(An(i)||n.length!==s.length){n.forEach(o=>o.destroy()),Ui(i);for(const o of s)if(o.status==="rejected")throw o.reason}this._levels=n,this._levelSelector=Eot(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(t=>t.destroy()),this._defaultRenderInstanceData.forEach(t=>t.destroy()),this._highlightRenderInstanceData.forEach(t=>t.destroy())}get needsTransparentPass(){return this._levels.some(t=>t.components.some(i=>i.material.requiresSlot(Ue.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(t=>t.size>0)}prepareRender(t){if(ur.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const r=t.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(t.bindParameters.contentCamera),r||this._requestUpdateCycle()}const i=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(t.bindParameters.contentCamera,i),this.needsUpdates&&this._context.requestRender()}render(t){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(t.pass))return;t.rctx.bindVAO();const i=t.pass!==nt.MATERIAL_HIGHLIGHT&&t.pass!==nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,r=t.pass!==nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;i&&this._renderComponents(t,this._defaultRenderInstanceData),r&&this._renderComponents(t,this._highlightRenderInstanceData)}intersect(t,i,r,s){if(!this.baseMaterial.isVisible())return;const n=F();Me(n,s,r);const o=a=>{this._instanceData.getCombinedModelTransform(a,ele),t.transform.set(ele),et(tle,r,t.transform.inverse),et(ile,s,t.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),h=this._levels.length;At(l&Zr.ACTIVE,"invalid instance state"),At(c>=0&&c<h,"invaid lod level"),this._levels[c].intersect(t,i,tle,ile,a,this._metadata,h)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(o):this.octree.forEachAlongRay(r,n,o)}queryDepthRange(t){return this._queryDepthRangeOctree(t)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(t=!1){this._updateCyclesWithStaticCamera=-1,t&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const t=new yot(this._instanceData,this.baseBoundingSphere),i=this._instanceData,r=i.view?i.view.state:null;for(let s=0;s<this._instanceData.capacity;++s)r.get(s)&Zr.ACTIVE&&t.addInstance(s);return t}_queryDepthRangeOctree(t){const i=t.eye,r=t.viewForward,s=this.octree.findClosest(r,$p.DepthOrder.FRONT_TO_BACK,t.frustum),n=this.octree.findClosest(r,$p.DepthOrder.BACK_TO_FRONT,t.frustum);if(s!=null&&n!=null){this._instanceData.view.boundingSphere.getVec(s,Sf),Me(Sf,Sf,i);const o=ke(Sf,r)-Sf[3];this._instanceData.view.boundingSphere.getVec(n,Sf),Me(Sf,Sf,i);const a=ke(Sf,r)+Sf[3];return{near:Math.max(t.near,o),far:Math.min(t.far,a)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(t=>{t.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(t,i){const r=this._enableLevelSelection,s=this._levelSelector;s.updateCamera(t),this._defaultRenderInstanceData.forEach(h=>{h.beginUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.beginUpdate()});const n=this._instanceData,o=this._instanceData.view,a=n.size,l=n.capacity;let c=this._instanceIndex;i=Math.min(a,i);for(let h=0;h<i;++h){c===0&&this._startUpdateCycle();const p=o.state.get(c);let m=0;if(!(p&Zr.ALLOCATED)){c=(c+1)%l,i++;continue}const g=o.lodLevel.get(c);if(p&Zr.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[g].freeTail(),p&Zr.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[g].freeTail(),p&Zr.REMOVE)n.freeInstance(c);else if(p&Zr.VISIBLE){let v=0;r&&(o.modelOrigin.getVec(c,Kae),v=s.selectLevel(Kae,n.getCombinedMedianScaleFactor(c))),m=p&~(Zr.ACTIVE|Zr.TRANSFORM_CHANGED),v>=0&&(p&Zr.HIGHLIGHT?(Jae(this._highlightRenderInstanceData[v],o,c),m|=Zr.HIGHLIGHT_ACTIVE):(Jae(this._defaultRenderInstanceData[v],o,c),m|=Zr.DEFAULT_ACTIVE)),o.state.set(c,m),o.lodLevel.set(c,v)}else m=p&~(Zr.ACTIVE|Zr.TRANSFORM_CHANGED),o.state.set(c,m);if(this._octree){const v=!!(p&Zr.ACTIVE),b=!!(m&Zr.ACTIVE);!v&&b?this._octree.addInstance(c):v&&!b?this._octree.removeInstance(c):v&&b&&p&Zr.TRANSFORM_CHANGED&&(this._octree.removeInstance(c),this._octree.addInstance(c))}c=(c+1)%l}this._instanceIndex=c,this._defaultRenderInstanceData.forEach(h=>{h.endUpdate()}),this._highlightRenderInstanceData.forEach(h=>{h.endUpdate()})}_renderComponents(t,i){this.levels.forEach((r,s)=>{r.components.forEach(n=>{this._renderComponent(t,i[s],n,s)})})}_renderComponent(t,i,r,s){const n=t.bindParameters;if(i.size===0||!r.material.requiresSlot(n.slot))return;const{rctx:o,pass:a}=t,l=r.glMaterials.load(o,a);if(N(l))return;const c=l.beginSlot(n),h=o.bindTechnique(c,r.material.parameters,n);o.bindVAO(r.vao),c.ensureAttributeLocations(r.vao),c.bindDraw(Oot,n),ur.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&t.pass===nt.MATERIAL&&(h.setUniform4fv("externalColor",rle[Math.min(s,rle.length-1)]),h.setUniform1i("colorMixMode",Vwe.replace));const p=o.capabilities.instancing,m=i.capacity,g=i.headIndex,v=i.tailIndex,b=i.firstIndex,S=this._glInstanceBufferLayout,T=(O,C)=>{hQ(o,or,i.buffer,S,O),p.drawArraysInstanced(c.primitiveType,0,r.vertexCount,C-O),dQ(o,or,i.buffer,S)};r.material.parameters.transparent&&b!=null?g>v?(At(b>=v&&b<=g,"invalid firstIndex"),T(b,g),T(v,b)):g<v&&(b<=g?(At(b>=0&&b<=g,"invalid firstIndex"),T(b,g),T(v,m),T(0,b)):(At(b>=v&&b<=m,"invalid firstIndex"),T(b,m),T(0,g),T(v,b))):g>v?T(v,g):g<v&&(T(0,g),T(v,m)),o.bindVAO(null)}}function Jae(e,t,i){const r=e.allocateHead();Aot(t,i,e.view,r)}function Aot(e,t,i,r){KZe(e.modelOrigin,t,i.modelOriginHi,i.modelOriginLo,r),i.model.copyFrom(r,e.model,t),i.modelNormal.copyFrom(r,e.modelNormal,t),e.color&&i.color&&i.color.copyFrom(r,e.color,t),e.featureAttribute&&i.featureAttribute&&i.featureAttribute.copyFrom(r,e.featureAttribute,t)}const Kae=F(),Sf=di(),ele=Be(),tle=F(),ile=F(),rle=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],Oot=new Qit;class Rot extends Qm{constructor(t,i,r,s){super(t,i,r,s),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=r.physicalBasedRenderingEnabled}getCachedSize(){const[t,i,r]=w(this._resources)?this._resources.symbolSize:[1,1,1];return{width:t,depth:i,height:r}}async doLoad(t){if(!this._drivenProperties.size&&vz(this.symbolLayer))throw new Error;const i=this.symbolLayer;if(this.isPrimitive){const r=i.resource?i.resource.primitive:vfe;this._resources=await this._createResourcesForPrimitive(r,t)}else this._resources=await this._createResourcesForUrl(i.resource.href,t);this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return w(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return Mn(this._resources,"lodRenderer")}_setMaterialTransparencyParams(t,i=Mn(this.symbolLayer,"material","color")){const r=this._getCombinedOpacity(i),s=r<1||this.needsDrivenTransparentPass;return t.transparent=s,t.opacity=r,t.cullFace=s?Ir.None:Ir.Back,t}async _createResourcesForPrimitive(t,i){if(!Det(t))throw new Error(`Unknown object symbol primitive: ${t}`);const r=this.symbolLayer,s=dn(iPe(t)),n=$l(yL(s)),o=$l(mV(n,r)),a=He(o),l=!1,c=!1,h={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:pm,diffuse:pm,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},p=h.usePBR;this._setMaterialTransparencyParams(h);const m=this.symbol;if(m.type==="point-3d"&&m.verticalOffset){const{screenLength:T,minWorldLength:O,maxWorldLength:C}=m.verticalOffset;h.verticalOffset={screenLength:No(T),minWorldLength:O||0,maxWorldLength:C!=null?C:1/0},h.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(h.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)h.externalColor=od;else{const T=w(r.material)&&r.material.color,O=w(T)?at.toUnitRGBA(T):od;h.externalColor=O}this._fastUpdates=_3(this._context.renderer,this._fastVisualVariableConvertOptions(s,o,n,Cb)),h.instanced=["transformation"],this._fastUpdates.enabled?(Object.assign(h,this._fastUpdates.materialParameters),h.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(h.instanced.push("color"),this._optionalFields.push("color"));const g=new iT(h),v=Lxe(t,g);if(!v)throw new Error(`Unknown object symbol primitive: ${t}`);const b=B$(v).map(T=>({opacity:1,transparent:T.parameters.transparent})),S=await this._createStageResources(v,p);return{lodResources:v,lodRenderer:await this._createLodRenderer(v,i),stageResources:S,symbolSize:o,extentPadding:a,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:b,physicalBasedRenderingEnabled:p,resourceBoundingBox:s,resourceSize:n,pivotOffset:Cb}}async _createResourcesForUrl(t,i){const r=["transformation"],s={materialParamsMixin:{instanced:r,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=_3(this._context.renderer,this._fastVisualVariableConvertOptions(Cb,Cb,Cb,Cb)),this._fastUpdates.enabled?(Object.assign(s.materialParamsMixin,this._fastUpdates.materialParameters),r.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(r.push("color"),this._optionalFields.push("color"));const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:G,minWorldLength:Y,maxWorldLength:J}=n.verticalOffset;s.materialParamsMixin.verticalOffset={screenLength:No(G),minWorldLength:Y||0,maxWorldLength:J!=null?J:1/0},s.materialParamsMixin.castShadows=!1}s.signal=i,s.usePBR=this._context.physicalBasedRenderingEnabled;const o=s.usePBR,a=await pSe(t,s),l=a.isEsriSymbolResource,c=a.isWosr;this._addDisposeResource(()=>a.remove());const h=pnt(a.lods);mnt(h),h.levels.sort((G,Y)=>G.minScreenSpaceRadius-Y.minScreenSpaceRadius),h.levels[0].minScreenSpaceRadius=Math.min(2,h.levels[0].minScreenSpaceRadius);const p=this._context,m=this.symbolLayer.material,g=this._getExternalColorParameters(m),v=Mn(this.symbolLayer,"material","color"),b=this._getCombinedOpacity(v,{hasIntrinsicColor:!0}),S=this.needsDrivenTransparentPass,T=B$(h),O=B$(h).map(G=>({opacity:G.parameters.opacity||1,transparent:G.parameters.transparent}));T.forEach(G=>{const Y=G.parameters;G.setParameters(g);const J=Y.opacity*b,X=J<1||S||Y.transparent;G.setParameters({opacity:J,transparent:X}),p.screenSizePerspectiveEnabled&&G.setParameters({screenSizePerspective:p.sharedResources.screenSizePerspectiveSettings})});const C=a.referenceBoundingBox,M=$l(yL(C)),I=$l(h.levels[0].pivotOffset),$=$l(mV(M,this.symbolLayer)),U=He($);v3(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(C,$,M,I))&&T.forEach(G=>G.setParameters(this._fastUpdates.materialParameters));const q=await this._createStageResources(h,o);return{lodResources:h,lodRenderer:await this._createLodRenderer(h,i),stageResources:q,symbolSize:$,extentPadding:U,isEsriSymbolResource:l,isWosr:c,originalMaterialParameters:O,physicalBasedRenderingEnabled:o,resourceBoundingBox:C,resourceSize:M,pivotOffset:I}}_addDisposeResource(t){this._disposeResourceHandles.push(t)}async _createStageResources(t,i){const r=this._context.stage,s=B$(t);i!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),r.addMany(s),this._addDisposeResource(()=>r.removeMany(s));const n=Get(t);r.addMany(n),this._addDisposeResource(()=>r.removeMany(n)),await r.load(n);const o=jet(t);return r.addMany(o),this._addDisposeResource(()=>r.removeMany(o)),{materials:s,textures:n,geometries:o}}async _createLodRenderer(t,i){const r=this._context.stage,s={layerUid:this._context.layer.uid,graphicUid:a=>this._instanceIndexToGraphicUid.get(a),notifyGraphicGeometryChanged:a=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(a)),notifyGraphicVisibilityChanged:a=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(a))},n=this._fastUpdates.enabled?{applyTransform:(a,l,c)=>{a.getFeatureAttribute(l,aD),js(c,pW(this._fastUpdates.materialParameters,aD,c))},scaleFactor:(a,l,c)=>(l.getFeatureAttribute(c,aD),Drt(a,this._fastUpdates.materialParameters,aD))}:null,o=new Cot(t,this._optionalFields,s,n);return o.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{r.removeRenderPlugin(o)}),await r.addRenderPlugin(o.slots,o,i),o}_getExternalColorParameters(t){const i={};return this._drivenProperties.color?i.externalColor=od:w(t)&&w(t.color)?i.externalColor=at.toUnitRGBA(t.color):(i.externalColor=od,i.colorMixMode="ignore"),i}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(t=>t()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry))return null;const r=f3(i.geometry);if(N(r))return this.logger.warn(`unsupported geometry type for icon symbol: ${i.geometry.type}`),null;const s=this.setGraphicElevationContext(i,new lh),n=t.renderingInfo;return this._createAs3DShape(i,r,n,s,i.uid)}notifyDestroyGraphicLayer(t){this._instanceIndexToGraphicUid.delete(t.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if(N(this._resources))return!0;const t=this._drivenProperties.opacity,i=!this.isPrimitive,r=this._resources.stageResources.materials,s=this._resources.originalMaterialParameters;for(let n=0;n<r.length;n++){const o=r[n],a=Mn(this.symbolLayer,"material","color"),l=s[n],c=this._getCombinedOpacity(a,{hasIntrinsicColor:i})*l.opacity,h=c<1||t||l.transparent;o.setParameters({opacity:c,transparent:h}),this.isPrimitive&&o.setParameters({cullFace:h?Ir.None:Ir.Back})}return!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,m1)}slicePlaneEnabledChanged(){if(N(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const t of this._resources.stageResources.materials)t.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(N(this._resources))return!0;const{stageResources:t,isWosr:i}=this._resources;for(const r of t.materials)this.isPrimitive?r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):i||r.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this.hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(t,i){if(N(this._resources))return In.Recreate_Symbol;const{stageResources:{materials:r},lodRenderer:s,resourceBoundingBox:n,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in t.diff){if(c!=="visualVariables"||!v3(this._fastUpdates,i,this._fastVisualVariableConvertOptions(n,o,a,l)))return In.Recreate_Symbol;for(const h of r)h.setParameters(this._fastUpdates.materialParameters);s.notifyShaderTransformationChanged()}return In.Fast_Update}computeComplexity(){return N(this._resources)?super.computeComplexity():{primitivesPerFeature:xJ(this._resources.lodResources.levels[0]).reduce((t,i)=>t+i.indices.get(D.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:kxe(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return w(this._resources)}_createAs3DShape(t,i,r,s,n){if(!this._hasLodRenderer()||N(this._resources))return null;const o=this.getFastUpdateAttrValues(t),a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?jM(r.color,r.opacity):null,l=this._context.clippingExtent;if(po(i,vS,this._context.elevationProvider.spatialReference),w(l)&&!QZ(l,vS))return null;const c=this._requiresTerrainElevation(s),h=this._computeGlobalTransform(i,s,e9,lD),p=this._computeLocalTransform(this._resources,this.symbolLayer,r,sle),m=this._resources.lodRenderer.instanceData,g=m.addInstance();this._instanceIndexToGraphicUid.set(g,n),m.setLocalTransform(g,p,!1),m.setGlobalTransform(g,h),o&&m.setFeatureAttribute(g,o),a&&m.setColor(g,a);const v=new unt(this,g,Aet,s);return c&&(v.alignedSampledElevation=lD.sampledElevation),v.needsElevationUpdates=m1(s.mode),p3(v,i,this._context.elevationProvider),v}_computeGlobalTransform(t,i,r,s){return Ky(t,this._context.elevationProvider,i,this._context.renderCoordsHelper,s),vS[0]=t.x,vS[1]=t.y,vS[2]=s.z,rh(t.spatialReference,vS,r,this._context.renderCoordsHelper.spatialReference),r}_computeLocalTransform(t,i,r,s){return Im(s),this._applyObjectRotation(r,!1,s),this._applyObjectRotation(i,!0,s),this._applyObjectScale(t,r,s),this._applyAnchor(t,i,s),s}_applyObjectScale(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._drivenProperties.size&&i.size?i.size:t.symbolSize,n=Aoe(s,t.symbolSize,t.resourceSize,this._context.renderCoordsHelper.unitInMeters);n[0]===1&&n[1]===1&&n[2]===1||rU(r,r,n)}prepareSymbolLayerPatch(t){if(t.diff.type!=="partial")return;const i=t.diff.diff;this._preparePatchTransform(t,i),this._preparePatchColor(t,i)}updateGeometry(t,i){if(N(this._resources))return!0;const r=i&&f3(i);if(N(r))return!1;const s=this.getGeometryElevationMode(i);return t.elevationContext.mode===s&&(this._computeGlobalTransform(r,t.elevationContext,e9,lD),this._requiresTerrainElevation(t.elevationContext)&&(t.alignedSampledElevation=lD.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(t.instanceIndex,e9,!0),p3(t,r,this._context.elevationProvider),!0)}_preparePatchTransform(t,i){if(!(i.heading||i.tilt||i.roll||i.width||i.height||i.depth||i.anchor||i.anchorPosition)||N(this._resources))return;const r=(v,b,S)=>$t(v!=null&&v.type==="complete"?v.newValue:b,S),s=r(i.heading,this.symbolLayer.heading,0),n=r(i.tilt,this.symbolLayer.tilt,0),o=r(i.roll,this.symbolLayer.roll,0),a=r(i.width,this.symbolLayer.width,void 0),l=r(i.height,this.symbolLayer.height,void 0),c=r(i.depth,this.symbolLayer.depth,void 0),h=r(i.anchor,this.symbolLayer.anchor,void 0),p=r(i.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete i.heading,delete i.tilt,delete i.roll,delete i.width,delete i.height,delete i.depth,delete i.anchor,delete i.anchorPosition;const m={heading:s,tilt:n,roll:o,anchor:h,anchorPosition:p},g=this._resources;this.loadStatus===Pu.LOADED&&t.symbolLayerStatePatches.push(()=>{g.symbolSize=$l(mV(g.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),t.graphics3DGraphicPatches.push((v,b)=>{const S=this._computeLocalTransform(g,m,b,sle),T=v.instanceIndex;g.lodRenderer.instanceData.setLocalTransform(T,S,!0)})}_preparePatchColor(t,i){if(!i.material||i.material.type!=="partial")return;const r=i.material.diff;if(!r.color||r.color.type!=="complete"||r.color.newValue==null||r.color.oldValue==null)return;const s=r.color.newValue,n=w(s)?at.toUnitRGBA(s):od;delete r.color;const o=this._resources;N(o)||t.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,n),l=this._setMaterialTransparencyParams({},s)):l=this._setMaterialTransparencyParams({externalColor:n},s);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(t){return t.mode!=="absolute-height"}_applyObjectRotation(t,i,r){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&i))return met(t.heading,t.tilt,t.roll,r)}_computeAnchor(t,i,r){const s=F();switch(r.anchor){case"center":ve(s,Op(t)),Ra(s,s);break;case"top":{const n=Op(t);fe(s,-n[0],-n[1],-t[5]);break}case"bottom":{const n=Op(t);fe(s,-n[0],-n[1],-t[2]);break}case"relative":{const n=Op(t),o=yL(t),a=r.anchorPosition,l=a?Ke(a.x,a.y,a.z):ol;Nk(s,o,l),Oe(s,s,n),Ra(s,s);break}default:w(i)?Ra(s,i):ve(s,ol)}return s}_applyAnchor(t,i,r){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const s=this._computeAnchor(t.resourceBoundingBox,t.pivotOffset,i);s&&hl(r,r,s)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(t,i,r,s){const n=w(t)?$l(yL(t)):pm,o=w(t)?this._computeAnchor(t,s,this.symbolLayer):ol,a=this._context.renderCoordsHelper.unitInMeters,l=Aoe(w(i)?i:void 0,i,r,a),c=Ke(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:n,symbolSize:w(i)?i:pm,unitInMeters:a,transformation:{anchor:o,scale:l,rotation:c}}}}const vS=F(),sle=Be(),e9=Be(),aD=di(),lD=new vI;function Mot(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Pot(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function kJ(e,t,i,r,s){return e[0]=t,e[1]=i,e[2]=r,e[3]=s,e}function Iot(e,t){if(e===t){const i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function Lot(e,t){const i=t[0],r=t[1],s=t[2],n=t[3];let o=i*n-s*r;return o?(o=1/o,e[0]=n*o,e[1]=-r*o,e[2]=-s*o,e[3]=i*o,e):null}function $ot(e,t){const i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e}function Dot(e){return e[0]*e[3]-e[2]*e[1]}function mSe(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*a+n*l,e[1]=s*a+o*l,e[2]=r*c+n*h,e[3]=s*c+o*h,e}function Not(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*a,e[1]=s*l+o*a,e[2]=r*-a+n*l,e[3]=s*-a+o*l,e}function Fot(e,t,i){const r=t[0],s=t[1],n=t[2],o=t[3],a=i[0],l=i[1];return e[0]=r*a,e[1]=s*a,e[2]=n*l,e[3]=o*l,e}function kot(e,t){const i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e}function Uot(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function zot(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Bot(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2)}function Vot(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]}function Got(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function gSe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function jot(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Hot(e,t){const i=e[0],r=e[1],s=e[2],n=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=Gt*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-a)<=Gt*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(s-l)<=Gt*Math.max(1,Math.abs(s),Math.abs(l))&&Math.abs(n-c)<=Gt*Math.max(1,Math.abs(n),Math.abs(c))}function qot(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Wot(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}const Zot=mSe,Xot=gSe;Object.freeze(Object.defineProperty({__proto__:null,copy:Mot,identity:Pot,set:kJ,transpose:Iot,invert:Lot,adjoint:$ot,determinant:Dot,multiply:mSe,rotate:Not,scale:Fot,fromRotation:kot,fromScaling:Uot,str:zot,frob:Bot,LDU:Vot,add:Got,subtract:gSe,exactEquals:jot,equals:Hot,multiplyScalar:qot,multiplyScalarAndAdd:Wot,mul:Zot,sub:Xot},Symbol.toStringTag,{value:"Module"}));class Yot extends ss{constructor(t,i,r,s,n,o){super(t,i),this.path=r,this.geometrySR=s,this.upVectorAlignment=n,this.stencilWidth=o}}function ySe(e){return"upVectorAlignment"in e}function _Se(){return[1,0,0,1]}function Qot(e){return[e[0],e[1],e[2],e[3]]}function Jot(e,t,i,r){return[e,t,i,r]}function Kot(e,t){return new Float64Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:_Se,clone:Qot,fromValues:Jot,createView:Kot},Symbol.toStringTag,{value:"Module"}));function vW(){return{up:F(),right:F()}}function eat(e,t,i){et(e.up,t.up,i),et(e.right,t.right,i)}function tat(e,t,i){Di(e,ke(i,t.right),ke(i,t.up))}class iat{constructor(){this.pos=F(),this.posES=F(),this.posGS=F(),this.vRight=F(),this.vLeft=F(),this.frame=vW(),this.rotationFrame=vW(),this.rotationRight=yt(),this.rotationAngle=0,this.miterStretch=_Se()}setFrameFromUpVector(t){ve(this.frame.up,t),Oe(Bh,this.vLeft,this.vRight),De(Bh,Bh),be(lp,this.frame.up,ke(Bh,this.frame.up)),Me(uD,Bh,lp),De(uD,uD),St(this.frame.right,uD,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){ve(this.rotationFrame.up,this.frame.up),ve(this.rotationFrame.right,this.frame.right),Di(this.rotationRight,1,0),be(lp,this.frame.up,ke(this.frame.up,this.vLeft)),Me(lp,this.vLeft,lp),Ra(lp,lp),De(lp,lp),be(Bh,this.frame.up,ke(this.frame.up,this.vRight)),Me(Bh,this.vRight,Bh),De(Bh,Bh),St(bW,this.rotationFrame.up,this.vLeft);const t=Math.sign(ke(bW,this.vRight));if(this.rotationAngle=t*(Math.PI-Fn(ke(lp,Bh))),Math.abs(this.rotationAngle)>0){const r=wG(Math.cos(.5*this.rotationAngle));kJ(this.miterStretch,r-1+1,0,0,1)}const i=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*i))}}class w3{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(t,i){return this.vertices.push(xR(t)),this.vertexNormals.push(xR(i)),this.vertices.length-1}addUV(t){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(t),this.uvs.length-1}addPole(t,i=null){return this.poles.push({position:xR(t),normal:i?xR(i):null}),this.poles.length-1}addSegment(t,i=null,r=null){this.vertexIndices.push(t.v0),this.vertexIndices.push(t.v1),i&&(this.uvIndices.push(i.v0),this.uvIndices.push(i.v1)),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return this.uvs!=null}translate(t,i){for(const r of this.vertices)r[0]+=t,r[1]+=i;for(const r of this.poles)r.position[0]+=t,r.position[1]+=i}static circle(t=20){const r=new w3,s={v0:0,v1:0};r.addPole(ir(0,0));for(let a=0;a<t;++a){const l=2*a*Math.PI/t,c=Math.cos(l),h=Math.sin(l),p=ir(c*.5,h*.5),m=ir(c,h);r.addVertex(p,m),r.addUV(a/t)}r.addUV(1);for(let a=0;a<t-1;++a){const l={v0:a,v1:a+1},c=l;r.addSegment(l,c,s)}const n={v0:t-1,v1:0},o={v0:t-1,v1:t};return r.addSegment(n,o,s),r}static rect(){const r=new w3,s=ir(.5*-1,.5*-1),n=ir(.5*1,.5*-1),o=ir(.5*1,.5*1),a=ir(.5*-1,.5*1),l=ir(0,-1),c=ir(1,0),h=ir(0,1),p=ir(-1,0);r.addUV(0),r.addUV(1),r.addPole(ir(0,.5*1),h),r.addPole(ir(0,.5*1)),r.addPole(ir(0,.5*-1)),r.addPole(ir(0,.5*-1),l);const m={v0:0,v1:1};return r.addVertex(s,l),r.addVertex(n,l),r.addSegment({v0:0,v1:1},m,{v0:3,v1:3}),r.addVertex(n,c),r.addVertex(o,c),r.addSegment({v0:2,v1:3},m,{v0:2,v1:1}),r.addVertex(o,h),r.addVertex(a,h),r.addSegment({v0:4,v1:5},m,{v0:0,v1:0}),r.addVertex(a,p),r.addVertex(s,p),r.addSegment({v0:6,v1:7},m,{v0:1,v1:2}),r}}class rat{constructor(t){this.vertices=[],this.offset=F(),this.xform=Be(),this.vertices=t;const i=Math.floor((t.length-1)/2);ve(this.offset,this.vertices[i].pos);for(const r of this.vertices)Me(r.pos,r.pos,this.offset);hl(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const t=this.vertices.length;let i=this.vertices[0];i.index=0,fe(i.vLeft,0,0,0),i.vLeftLength=0,Me(i.vRight,this.vertices[1].pos,i.pos),i.vRightLength=He(i.vRight),De(i.vRight,i.vRight);let r=i;for(let s=1;s<t;++s)i=this.vertices[s],i.index=s,ve(i.vLeft,r.vRight),i.vLeftLength=r.vRightLength,s<t-1?(Me(i.vRight,this.vertices[s+1].pos,i.pos),i.vRightLength=He(i.vRight),De(i.vRight,i.vRight)):(ve(i.vRight,i.vLeft),i.vRightLength=i.vLeftLength),r=i}}function sat(e,t){let i=null;const r=e.vertices.length,s=.99619469809,n=F(),o=F(),a=F(),l=F(),c=F(),h=F(),p=Vi();let m=e.vertices[0];ve(o,t),fe(n,0,1,0),Sc.makeOrthoBasisDirUpFallback(m.vRight,o,n,n,a,o,s),ve(m.frame.up,o),ve(m.frame.right,a),i=m;for(let g=1;g<r;++g){m=e.vertices[g],Oe(c,m.vLeft,m.vRight);let v=He(c);v>0?(v=1/Math.sqrt(v),c[0]=c[0]*v,c[1]=c[1]*v,c[2]=c[2]*v):(c[0]=m.vRight[0],c[1]=m.vRight[1],c[2]=m.vRight[2]),Oe(h,i.pos,i.frame.up),ZE(m.pos,c,p),gT(p,sh(h,m.vLeft),l)?(Me(l,l,m.pos),De(o,l),St(a,c,o),De(a,a)):Sc.makeOrthoBasisDirUpFallback(c,i.frame.up,i.frame.right,n,a,o,s),ve(m.frame.up,o),ve(m.frame.right,a),i=m}}class nat{numProfilesPerJoin(){return 1}extrude(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],!1)}}class t9{constructor(t=.8*Math.PI,i=1){this.cutoffAngle=t,this.numBendSubdivisions=i}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(t,i,r){const s=dat;if(Math.abs(t.rotationAngle)>=this.cutoffAngle)for(let n=0;n<this.numBendSubdivisions+1;++n){ih(ale,.5*-t.rotationAngle+n*t.rotationAngle/this.numBendSubdivisions,t.rotationFrame.up),eat(s,t.frame,ale);for(let o=0;o<i.vertices.length;++o)xn(i.vertices[o],t.rotationRight)*t.rotationAngle>=0?r(t.index,s,i.vertices[o],i.vertexNormals[o],!1):(Lq(Kw,i.vertices[o],t.miterStretch),r(t.index,t.frame,Kw,i.vertexNormals[o],!0))}else for(let n=0;n<this.numBendSubdivisions+1;++n)for(let o=0;o<i.vertices.length;++o){const a=xn(i.vertices[o],t.rotationRight)*t.rotationAngle>=0;Lq(Kw,i.vertices[o],t.miterStretch),r(t.index,t.frame,Kw,i.vertexNormals[o],!a)}}}const oat={generateUV:!1};class UJ{rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],0,0)}}class nle extends UJ{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class cD extends UJ{constructor(t,i=0,r=!1){super(),this.profile=t,this.profilePlaneOffset=i,this.flip=r}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(t,i,r){for(let s=0;s<i.vertices.length;++s)r(t.index,t.frame,i.vertices[s],i.vertexNormals[s],this.profilePlaneOffset,0)}rebuildCapGeometry(t,i){const r=zJ;Di(r,0,0);const s=this.flip?1:-1;for(let n=0;n<this.profile.vertices.length;++n)i(t.index,t.frame,this.profile.vertices[n],r,this.profilePlaneOffset,s)}buildTopology(t,i){const r=this.vertexBufferStart+this.profile.vertexIndices[0];for(let s=1;s<this.profile.numSegments;++s){const n=this.profile.vertexIndices[2*s+0],o=this.profile.vertexIndices[2*s+1],a=this.vertexBufferStart+n,l=this.vertexBufferStart+o;this.flip?i(l,a,r):i(r,a,l)}}}class ole extends UJ{constructor(t){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=t.profile,this.flip=t.flip,this.sign=this.flip?1:-1,this.breakNormals=t.breakNormals,this.numSegments=t.subdivisions}getNumVertices(){let t=0;return t=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(t+=this.profile.vertices.length),t+=this.profile.poles.length,t}getNumIndices(){let t=0;t+=2*this.profile.numSegments*(this.numSegments-1);for(let i=0;i<this.profile.numSegments;++i){const r=this.profile.vertexIndices[2*i+0],s=this.profile.vertexIndices[2*i+1];this.profile.poleIndices[r]===this.profile.poleIndices[s]?t+=1:t+=2}return 3*t}rebuildCapGeometry(t,i){const r=t.frame,s=.5*this.sign,n=Kw,o=zJ;Di(o,0,0);for(let a=0;a<this.profile.poles.length;++a){const l=this.profile.poles[a];l.normal?i(t.index,r,l.position,l.normal,s,0):i(t.index,r,l.position,o,s,this.sign)}if(this.breakNormals)for(let a=0;a<this.profile.vertices.length;++a)i(t.index,r,this.profile.vertices[a],this.profile.vertexNormals[a],0,0);for(let a=0;a<this.numSegments-1;++a){const l=(1-(a+1)/this.numSegments)*Math.PI*.5,c=Math.sin(l),h=Math.cos(l);for(let p=0;p<this.profile.vertices.length;++p){const m=this.profile.poles[this.profile.poleIndices[p]];um(n,this.profile.vertices[p],m.position),Ic(n,n,c),m.normal?(yp(n,n,m.position),i(t.index,r,n,m.normal,s*h,0)):(UP(o,n),Ic(o,o,c),yp(n,n,m.position),i(t.index,r,n,o,s*h,this.sign*h))}}}buildTopology(t,i){const r=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let n=0;n<this.profile.numSegments;++n){const o=this.profile.vertexIndices[2*n+0],a=this.profile.vertexIndices[2*n+1],l=this.vertexBufferStart+this.profile.poleIndices[o],c=this.vertexBufferStart+this.profile.poleIndices[a];let h=r+o,p=r+a;for(let m=0;m<this.numSegments-1;++m){const g=s+m*this.profile.vertices.length+o,v=s+m*this.profile.vertices.length+a;this.flip?(i(g,p,h),i(p,g,v)):(i(h,p,g),i(v,g,p)),h=g,p=v}this.flip?(i(l,p,h),l!==c&&i(l,c,p)):(i(h,p,l),l!==c&&i(p,c,l))}}}class aat{constructor(t,i,r,s,n,o=oat){this.options=o,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=i,this.path=t,this.extruder=r,this.startCap=s,this.endCap=n;const a=this.path.vertices.length-2;this.numExtrusionProfiles=r.numProfilesPerJoin()*a+2,this.numVerticesTotal=i.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.getNumVertices();this.numVerticesTotal+=l,this.numNormalsTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.getNumVertices();this.numVerticesTotal+=c,this.numNormalsTotal+=c,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(t,i,r,s,n){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,n){const o=this.path.vertices[t];this.profileRightAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[0]*o.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o.rotationRight[1]*o.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(t,i,r,s,n,o){this.profileRightAxisData[4*this._extrusionVertexCount+0]=i.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=i.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=i.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=i.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=i.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=i.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=r[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=r[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=s[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=s[1],this.pathVertexData[this._extrusionVertexCount]=t,this.profileRightAxisData[4*this._extrusionVertexCount+3]=n,this.profileUpAxisData[4*this._extrusionVertexCount+3]=o,++this._extrusionVertexCount}emitTriangle(t,i,r){this.vertexIndices[3*this._triangleCount+0]=t,this.vertexIndices[3*this._triangleCount+1]=i,this.vertexIndices[3*this._triangleCount+2]=r,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[t],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[i],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[r],this.normalIndices[3*this._triangleCount+0]=t,this.normalIndices[3*this._triangleCount+1]=i,this.normalIndices[3*this._triangleCount+2]=r,++this._triangleCount}_rebuildGeometry(){const t=(r,s,n,o,a)=>this.emitVertex(r,s,n,o,a),i=(r,s,n,o,a,l)=>this.emitCapVertex(r,s,n,o,a,l);this._extrusionVertexCount=0;for(const r of this.path.vertices)this.originData[3*r.index+0]=r.pos[0],this.originData[3*r.index+1]=r.pos[1],this.originData[3*r.index+2]=r.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,i);for(let r=1;r<this.path.vertices.length-1;++r)this.extruder.extrude(this.path.vertices[r],this.profile,t);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,i),this.startCap.rebuildCapGeometry(this.path.vertices[0],i),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],i),this.profile.hasUV()&&this.options.generateUV)for(let r=0;r<this.profile.uvs.length;++r)this.uvData[2*r+0]=this.profile.uvs[r],this.uvData[2*r+1]=0}buildTopology(){const t=(o,a,l)=>this.emitTriangle(o,a,l);this._triangleCount=0;const i=this.profile.vertices.length,r=this.profile.numSegments,s=this.numExtrusionProfiles-1;let n=3*(2*(r*s));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=i*(this.numExtrusionProfiles-1),n+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(n),this.normalIndices=new Uint32Array(n),this.pathVertexIndices=new Uint32Array(n),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(n));for(let o=0;o<r;++o){const a=this.profile.vertexIndices[2*o],l=this.profile.vertexIndices[2*o+1];for(let c=0;c<s;++c){const h=c*i+a,p=(c+1)*i+l,m=c*i+l;t(h,(c+1)*i+a,p),t(h,p,m)}}this.startCap.buildTopology(this.path.vertices[0],t),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],t)}onPathChanged(){this._rebuildGeometry()}}class vSe{constructor(t){this.builder=t}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class bSe extends vSe{constructor(t){super(t),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(t){this.vertexAttributeColor[0]=255*t[0],this.vertexAttributeColor[1]=255*t[1],this.vertexAttributeColor[2]=255*t[2],this.vertexAttributeColor[3]=255*(t.length>3?t[3]:1)}bake(t){this.size=t;for(let i=0;i<this.builder.numVerticesTotal;++i){let r=this.builder.pathVertexData[i];const s=r===0||r===this.builder.path.vertices.length-1;r*=3;const n=cat;fe(n,this.builder.originData[r++],this.builder.originData[r++],this.builder.originData[r]);const o=4*i,a=lp,l=Kw,c=Bh,h=bW,p=hat;let m=0,g=0;if(fe(h,this.builder.profileRightAxisData[o],this.builder.profileRightAxisData[o+1],this.builder.profileRightAxisData[o+2]),fe(p,this.builder.profileUpAxisData[o],this.builder.profileUpAxisData[o+1],this.builder.profileUpAxisData[o+2]),Di(l,this.builder.profileVertexAndNormalData[o]*t[0],this.builder.profileVertexAndNormalData[o+1]*t[1]),s)St(c,p,h),m=this.builder.profileRightAxisData[o+3]*t[0],g=this.builder.profileUpAxisData[o+3];else{const b=zJ,S=uat;Di(b,this.builder.profileRightAxisData[o+3],this.builder.profileUpAxisData[o+3]);const T=aQ(b);UP(b,b);const O=xn(l,b);if(Math.abs(O)>T){Di(S,-b[1],b[0]);const C=xn(l,S);Ic(b,b,T*Math.sign(O)),Ic(S,S,C),yp(l,b,S)}fe(c,0,0,0)}fe(a,h[0]*l[0]+p[0]*l[1],h[1]*l[0]+p[1]*l[1],h[2]*l[0]+p[2]*l[1]),this.vertexAttributePosition[3*i+0]=n[0]+a[0]+c[0]*m,this.vertexAttributePosition[3*i+1]=n[1]+a[1]+c[1]*m,this.vertexAttributePosition[3*i+2]=n[2]+a[2]+c[2]*m;const v=Kw;Di(v,this.builder.profileVertexAndNormalData[o+2],this.builder.profileVertexAndNormalData[o+3]),this.vertexAttributeNormal[3*i+0]=h[0]*v[0]+p[0]*v[1]+c[0]*g,this.vertexAttributeNormal[3*i+1]=h[1]*v[0]+p[1]*v[1]+c[1]*g,this.vertexAttributeNormal[3*i+2]=h[2]*v[0]+p[2]*v[1]+c[2]*g}}createGeometryData(){const t=[[D.POSITION,this.builder.vertexIndices],[D.NORMAL,this.builder.normalIndices]],i=[[D.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[D.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];if(this.vertexAttributeColor){const r=this.builder.vertexIndices.length;t.push([D.COLOR,new Uint32Array(r)]),i.push([D.COLOR,{size:4,data:this.vertexAttributeColor}])}return{vertexAttributes:i,indices:t}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(t,i,r){const s=this.builder.vertexIndices,n={size:3,data:this.vertexAttributePosition},o=s.length/3;fI(t,i,0,o,s,n,void 0,void 0,r)}}class lat extends vSe{constructor(t,i,r,s){super(t),this.sizeAttributeValue=i,this.colorAttributeValue=r,this.opacityAttributeValue=s,this.vvData=null,this.baked=new bSe(t),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let n=0;n<this.builder.path.vertices.length;++n){this.vvData[4*n+0]=i,this.vvData[4*n+1]=r,this.vvData[4*n+2]=s;const o=n===0||n===this.builder.path.vertices.length-1;this.vvData[4*n+3]=o?1:0}}createGeometryData(){return{vertexAttributes:[[D.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[D.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[D.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[D.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[D.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[D.POSITION,this.builder.pathVertexIndices],[D.PROFILERIGHT,this.builder.vertexIndices],[D.PROFILEUP,this.builder.vertexIndices],[D.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[D.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const cat=F(),Kw=yt(),zJ=yt(),uat=yt(),lp=F(),Bh=F(),bW=F(),hat=F(),uD=F(),dat=vW(),ale=Be(),i9=8;function pat(e,t){e.attributes.add(D.FEATUREVALUE,"vec4");const i=e.vertex;i.code.add(E`bool isCapVertex() {
return featureValue.w == 1.0;
}`),i.uniforms.add(new Ni("size",r=>r.size)),t.vvSize?(i.uniforms.add(new Ut("vvSizeMinSize",r=>r.vvSizeMinSize)),i.uniforms.add(new Ut("vvSizeMaxSize",r=>r.vvSizeMaxSize)),i.uniforms.add(new Ut("vvSizeOffset",r=>r.vvSizeOffset)),i.uniforms.add(new Ut("vvSizeFactor",r=>r.vvSizeFactor)),i.code.add(E`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):i.code.add(E`vec2 getSize(){
return size;
}`),t.vvOpacity?(i.constants.add("vvOpacityNumber","int",i9),i.uniforms.add([new Aa("vvOpacityValues",r=>r.vvOpacityValues,i9),new Aa("vvOpacityOpacities",r=>r.vvOpacityOpacities,i9)]),i.code.add(E`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):i.code.add(E`vec4 applyOpacity(vec4 color){
return color;
}`),t.vvColor?(i.constants.add("vvColorNumber","int",Bp),i.uniforms.add([new Aa("vvColorValues",r=>r.vvColorValues,Bp),new fz("vvColorColors",r=>r.vvColorColors,Bp)]),i.code.add(E`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):i.code.add(E`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),e.include(Oz),e.attributes.add(D.PROFILERIGHT,"vec4"),e.attributes.add(D.PROFILEUP,"vec4"),e.attributes.add(D.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(E`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(E`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(E`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(E`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class fat extends fJ{constructor(){super(...arguments),this.size=ir(1,1)}}function mat(e){const t=new dr,i=Yu(t,e),{vertex:r,fragment:s}=t;return t.varyings.add("vpos","vec3"),t.include(pat,e),e.output!==ue.Color&&e.output!==ue.Alpha||(t.include(oa),t.include(eT,e),t.include(TI,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vcolor","vec4"),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(E`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${e.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${e.output===ue.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),t.include(oh,e),e.output===ue.Alpha&&(t.include(Ns,e),s.uniforms.add(new lt("opacity",n=>n.opacity)),s.code.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),e.output===ue.Color&&(t.include(Ns,e),t.include(tT,e),t.include(CI,e),t.include(eT,e),t.include(STe,e),Dm(s,e),s.uniforms.add([i,new Ut("ambient",n=>n.ambient),new Ut("diffuse",n=>n.diffuse),new Ut("specular",n=>n.specular),new lt("opacity",n=>n.opacity),new lt("lightingGlobalFactor",(n,o)=>o.lighting.globalFactor),new Ut("lightingMainIntensity",(n,o)=>o.lighting.mainLight.intensity)]),s.constants.add("ambientBoostFactor","float",sA),s.include(Wm),s.code.add(E`
      void main() {
        discardBySlice(vpos);
        ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${e.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":e.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${e.transparencyPassType===Pt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==ue.Depth&&e.output!==ue.Shadow||(t.include(oa,{hasModelTransformation:!1,linearDepth:!0}),r.uniforms.add(new Ni("nearFar",(n,o)=>o.camera.nearFar)),t.varyings.add("depth","float"),r.code.add(E`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),t.include(Ns,e),t.include(A1,e),s.code.add(E`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),e.output===ue.Normal&&(t.include(oa),t.include($v,e),r.uniforms.add(new Hr("viewNormal",(n,o)=>o.camera.viewInverseTransposeMatrix)),t.varyings.add("vnormal","vec3"),r.code.add(E`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ns,e),s.uniforms.add(new nl("waterColor")),s.code.add(E`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),e.output===ue.Highlight&&(t.include(oa),t.include($v,e),t.varyings.add("vnormal","vec3"),r.code.add(E`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),t.include(Ns,e),t.include(d0),s.code.add(E`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),t}const gat=Object.freeze(Object.defineProperty({__proto__:null,build:mat},Symbol.toStringTag,{value:"Module"})),wSe=new Map([[D.POSITION,0],[D.PROFILERIGHT,1],[D.PROFILEUP,2],[D.PROFILEVERTEXANDNORMAL,3],[D.FEATUREVALUE,4]]);class yat extends fat{constructor(){super(...arguments),this.ambient=Ke(.2,.2,.2),this.diffuse=Ke(.8,.8,.8),this.specular=Ke(0,0,0),this.opacity=1}}class Hz extends $r{initializeConfiguration(t,i){i.spherical=t.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=xI(t.rctx)}initializeProgram(t){const i=Hz.shader.get().build(this.configuration);return new Sr(t.rctx,i,wSe)}_setPipelineState(t){const i=this.configuration,r=t===Pt.NONE,s=t===Pt.FrontFace,n=o=>!o.hasSlicePlane&&!(o.transparent||o.doubleSidedMode===us.None);return ni({blending:i.output!==ue.Color&&i.output!==ue.Alpha||!i.transparent?null:r?Qu:p0(t),culling:n(i)&&v1e,depthTest:{func:C1(t)},depthWrite:r||s?ec:null,colorWrite:wi,stencilWrite:i.hasOccludees?Fm:null,stencilTest:i.hasOccludees?O1:null,polygonOffset:r||s?null:yz})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Hz.shader=new Tr(gat,()=>_e(()=>import("./Path.glsl.7e6cbc82.js"),[],import.meta.url));class io extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.doubleSidedMode=us.None,this.transparencyPassType=Pt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}u([ee({count:ue.COUNT})],io.prototype,"output",void 0),u([ee({count:us.COUNT})],io.prototype,"doubleSidedMode",void 0),u([ee({count:Pt.COUNT})],io.prototype,"transparencyPassType",void 0),u([ee()],io.prototype,"spherical",void 0),u([ee()],io.prototype,"receiveShadows",void 0),u([ee()],io.prototype,"receiveAmbientOcclusion",void 0),u([ee()],io.prototype,"vvSize",void 0),u([ee()],io.prototype,"vvColor",void 0),u([ee()],io.prototype,"vvOpacity",void 0),u([ee()],io.prototype,"hasSlicePlane",void 0),u([ee()],io.prototype,"transparent",void 0),u([ee()],io.prototype,"hasOccludees",void 0),u([ee()],io.prototype,"hasMultipassTerrain",void 0),u([ee()],io.prototype,"cullAboveGround",void 0),u([ee()],io.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ee({constValue:Wt.Disabled})],io.prototype,"pbrMode",void 0),u([ee({constValue:!0})],io.prototype,"hasVvInstancing",void 0),u([ee({constValue:!1})],io.prototype,"useCustomDTRExponentForWater",void 0),u([ee({constValue:!1})],io.prototype,"useFillLights",void 0);class BJ extends Xm{constructor(t){super(t,new vat),this.supportsEdges=!0,this._vertexAttributeLocations=wSe,this._configuration=new io,this.vertexBufferLayout=BJ.getVertexBufferLayout(this.parameters)}getConfiguration(t,i){return this._configuration.output=t,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,t!==ue.Color&&t!==ue.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?us.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?us.WindingOrder:us.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!i.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(t){return t!==nt.MATERIAL_DEPTH_SHADOWMAP_ALL&&t!==nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&t!==nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const t=this.parameters;return!!super.isVisible()&&t.opacity>0}intersect(t,i,r,s,n,o,a){const l=t;if(!ySe(l))return;const c=l.path,h=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const T=this.parameters.vvSizeOffset,O=this.parameters.vvSizeFactor,C=this.parameters.vvSizeMinSize,M=this.parameters.vvSizeMaxSize,I=c.sizeAttributeValue;h[0]*=Xe(T[0]+I*O[0],C[0],M[0]),h[1]*=Xe(T[2]+I*O[2],C[2],M[2])}const p=Math.max(h[0],h[1]),m=t.boundingInfo;if(N(m))return void this._intersectTriangles(c,h,n,o,a);const g=Rx(m.bbMin[0]-p,m.bbMin[1]-p,m.bbMin[2]-p,m.bbMax[0]+p,m.bbMax[1]+p,m.bbMax[2]+p),v=[o[0]-n[0],o[1]-n[1],o[2]-n[2]],b=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]),S=[b/v[0],b/v[1],b/v[2]];lJ(g,n,S,s.tolerance)&&this._intersectTriangles(c,h,n,o,a)}_intersectTriangles(t,i,r,s,n){t.baked.size&&t.baked.size[0]===i[0]&&t.baked.size[1]===i[1]||t.baked.bake(i),t.baked.intersect(r,s,n)}computeAttachmentOrigin(t,i){const r=t.vertexAttributes;if(!r)return null;const s=r.get(D.POSITION);return $Q(s,null,!1,i)}createBufferWriter(){return new bat(this.vertexBufferLayout)}requiresSlot(t){return t===(this.parameters.transparent?Ue.TRANSPARENT_MATERIAL:Ue.OPAQUE_MATERIAL)||t===Ue.DRAPED_MATERIAL}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Alpha||t.output===ue.Depth||t.output===ue.Normal||t.output===ue.Highlight||t.output===ue.Shadow&&this.parameters.castShadows?new _at(t):null}static getVertexBufferLayout(t){let i=As().vec3f(D.POSITION).vec4f(D.PROFILERIGHT).vec4f(D.PROFILEUP).vec4f(D.PROFILEVERTEXANDNORMAL);return(t.vvColorEnabled||t.vvSizeEnabled||t.vvOpacityEnabled)&&(i=i.vec4f(D.FEATUREVALUE)),i}}class _at extends S1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}_updateShadowState(t){(N(this.technique)||t.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:t.shadowMap.enabled})}beginSlot(t){return this._output!==ue.Color&&this._output!==ue.Alpha||(this._updateShadowState(t),this._updateOccludeeState(t)),this.ensureTechnique(Hz,t)}}class vat extends yat{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class bat{constructor(t){this.vertexBufferLayout=t}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return t.indices.get(D.POSITION).length}write(t,i,r,s){const n=o=>{if(i.vertexAttributes.has(o)){const a=i.vertexAttributes.get(o),l=i.indices.get(o);At(a.size===4);const c=r.getField(o,fo);if(!c)throw new Error("unable to acquire view for "+o);wC(l,a.data,c,s)}};n(D.PROFILERIGHT),n(D.PROFILEUP),n(D.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(D.FEATUREVALUE)&&n(D.FEATUREVALUE),pz(i,this.vertexBufferLayout,t.transformation,t.invTranspTransformation,r,s)}}const wat=["polyline"];class xat extends Qm{constructor(t,i,r,s){super(t,i,r,s),this._intrinsicSize=ir(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){const t=w(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height,i=w(this.symbolLayer.height)?this.symbolLayer.height:t;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[t,1,i],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},this._context.renderer&&this._context.renderer.visualVariables&&this._context.renderer.visualVariables.length>0?this._fastUpdates=_3(this._context.renderer,this._vvConvertOptions):this._fastUpdates={enabled:!1};const r=this.symbolLayer.anchor||"center";this.upVectorAlignment="path",this.symbolLayer.profileRotation==="heading"&&(this.upVectorAlignment="world");const s=this.symbolLayer.profile||"circle";switch(s){case"circle":default:this._profile=w3.circle(Aat);break;case"quad":this._profile=w3.rect()}let n=[0,0];switch(r!=="center"&&(n={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[r],this._profile.translate(n[0],n[1])),this.symbolLayer.join||"simple"){case"round":this._extruder=new t9(0,Cat);break;case"bevel":this._extruder=new t9(0,1);break;case"miter":this._extruder=new t9(.8*Math.PI,1);break;default:this._extruder=new nat}const o=this.symbolLayer.cap||"butt";switch(o){case"none":this._startCap=new nle,this._endCap=new nle;break;case"butt":default:this._startCap=new cD(this._profile,0),this._endCap=new cD(this._profile,0,!0);break;case"square":this._startCap=new cD(this._profile,-.5),this._endCap=new cD(this._profile,.5,!0);break;case"round":{const g=s==="quad";this._startCap=new ole({profile:this._profile,flip:!1,breakNormals:g,subdivisions:ule}),this._endCap=new ole({profile:this._profile,flip:!0,breakNormals:g,subdivisions:ule});break}}const a=Mn(this.symbolLayer,"material","color"),l=this._getCombinedOpacityAndColor(a),c=$l(l),h=l[3],p=h<1||this.needsDrivenTransparentPass,m={diffuse:c,ambient:c,opacity:h,transparent:p,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:p||o==="none"?Ir.None:Ir.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Di(this._intrinsicSize,t,i),!W5(this._intrinsicSize[0])||!W5(this._intrinsicSize[1])))throw new se("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||Ic(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates.enabled){const g={...m,...this._fastUpdates.materialParameters,size:Ume(this._intrinsicSize)};this._material=new BJ(g)}else m.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new iT(m);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,wat,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new lh),s=t.renderingInfo;return this._createAs3DShape(i,s,r,i.uid)}layerOpacityChanged(){const t=Mn(this.symbolLayer,"material","color"),i=this._getCombinedOpacity(t),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({opacity:i,transparent:r}),!0}layerElevationInfoChanged(t,i){return this.updateGraphics3DGraphicElevationInfo(t,i,m1)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(t,i){for(const r in t.diff){if(r!=="visualVariables"||!v3(this._fastUpdates,i,this._vvConvertOptions))return In.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return In.Fast_Update}getVertexData(t){let i=0;const r=t.paths,s=[],n=t.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const g of r)i+=g.length;const l=new Float64Array(3*i),c=new Float64Array(3*i),h=new Float64Array(3*i);let p=0;for(const g of r){s.push({index:p,numVertices:g.length});for(const v of g)l[p++]=v[0],l[p++]=v[1],l[p++]=t.hasZ?v[2]:0}let m=!0;return n.equals(o)?this._copyVertices(l,0,c,0,i):m=Lr(l,n,0,c,o,0,i),o.equals(a)?this._copyVertices(c,0,h,0,i):Lr(c,o,0,h,a,0,i),{pathVertexDataInfos:s,vertexDataGS:l,vertexDataES:c,vertexDataRS:h,projectionSuccess:m,terrainElevation:0}}_copyVertices(t,i,r,s,n){i*=3,s*=3;for(let o=0;o<n;++o)r[s++]=t[i++],r[s++]=t[i++],r[s++]=t[i++]}_createAs3DShape(t,i,r,s){const n=t.geometry,o=new Array,a=new Array,l=new Array,c=n.spatialReference,h=dn(),p=this._context.renderCoordsHelper;TSe.spatialReference=c;const m=this.getVertexData(n);if(!m.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(m.pathVertexDataInfos.length>0){for(let g=0;g<m.pathVertexDataInfos.length;++g){const v=m.pathVertexDataInfos[g],b=v.index,S=v.numVertices;if(S<2||w(this._context.clippingExtent)&&(Fr(h),Vu(h,m.vertexDataES,3*b,S),!Rp(h,this._context.clippingExtent)))continue;const T=[];for(let q=b;q<b+3*S;){const G=q++,Y=q++,J=q++,X=new iat;fe(X.posGS,m.vertexDataGS[G],m.vertexDataGS[Y],m.vertexDataGS[J]),fe(X.posES,m.vertexDataES[G],m.vertexDataES[Y],m.vertexDataES[J]);const ne=get(X.posES,this._context.elevationProvider,r,p);fe(ad,m.vertexDataRS[G],m.vertexDataRS[Y],m.vertexDataRS[J]),p.setAltitude(ad,ne),fe(X.pos,ad[0],ad[1],ad[2]),T.push(X)}const O=new rat(T);xSe(O,this.upVectorAlignment,this._context.renderCoordsHelper);const C=new aat(O,this._profile,this._extruder,this._startCap,this._endCap);let M=null;if(this._fastUpdates.enabled){const q=this._fastUpdates.visualVariables,G=q.size?Ly(q.size.field,t):0,Y=q.color?Ly(q.color.field,t):0,J=q.opacity?Ly(q.opacity.field,t):0;M=new lat(C,G,Y,J)}else{const q=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(q[0]*=lle(i.size[0],i.size[2]==="symbol-value"?this.symbolLayer.height||0:i.size[2],this.symbolLayer.width||0),q[1]*=lle(i.size[2],i.size[0]==="symbol-value"?this.symbolLayer.width||0:i.size[0],this.symbolLayer.height||0));let G=null;this._drivenProperties.color&&(G=i.color),this._drivenProperties.opacity&&i.opacity!=null&&(G=G?[G[0],G[1],G[2],i.opacity]:[1,1,1,i.opacity]);const Y=new bSe(C);Y.bake(q),G&&Y.bakeVertexColors(G),M=Y}const{vertexAttributes:I,indices:$}=M.createGeometryData(),U=new Yot(I,$,M,c,this.upVectorAlignment,this.stencilWidth);o.push(U),a.push(this._material),l.push(M.xform)}if(o.length>0){const g={layerUid:this._context.layer.uid,graphicUid:s},v=new m0({geometries:o,materials:a,transformations:l,metadata:g}),b=new Ym(this,v,o,null,null,Sat,r);return b.alignedSampledElevation=m.terrainElevation,b.needsElevationUpdates=m1(r.mode),b}}else n.paths.length!==0&&n.paths.some(g=>g.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}}function xSe(e,t,i){switch(t){case"world":for(const r of e.vertices)Oe(Ef,r.pos,e.offset),i.worldUpAtPosition(Ef,ad),r.setFrameFromUpVector(ad),r.computeRotationAxisAndAngleFromUpVector();break;case"path":Oe(Ef,e.vertices[0].pos,e.offset),i.worldUpAtPosition(Ef,ad),sat(e,ad);for(const r of e.vertices){const s=Math.sign(ke(r.frame.right,r.vRight));St(r.rotationFrame.up,r.vRight,r.vLeft),be(r.rotationFrame.up,r.rotationFrame.up,s),De(r.rotationFrame.up,r.rotationFrame.up);const n=ke(r.rotationFrame.up,r.frame.up),o=ke(r.rotationFrame.up,r.frame.right);if(be(Ef,r.frame.up,-o),be(cle,r.frame.right,n),Oe(Ef,Ef,cle),De(r.rotationFrame.right,Ef),tat(r.rotationRight,r.frame,r.rotationFrame.right),Ra(Ef,r.vLeft),r.rotationAngle=-s*(Math.PI-Fn(ke(Ef,r.vRight))),Math.abs(r.rotationAngle)>0){const l=wG(Math.cos(.5*r.rotationAngle));kJ(r.miterStretch,1+(l-1)*r.rotationRight[0]*r.rotationRight[0],(l-1)*r.rotationRight[0]*r.rotationRight[1],(l-1)*r.rotationRight[0]*r.rotationRight[1],1+(l-1)*r.rotationRight[1]*r.rotationRight[1])}const a=Math.PI-r.rotationAngle;r.maxStretchDistance=Math.abs(Math.min(r.vLeftLength,r.vRightLength)*wG(Math.cos(.5*a)))}}}function lle(e,t,i){switch(e){case"symbol-value":return i;case"proportional":return t;default:return e}}function Tat(e,t,i,r){let s=0;for(const n of e.vertices)Ky(n.posES,i,t,r,r9),s+=r9.sampledElevation,Oe(ad,n.pos,e.offset),r.setAltitude(ad,r9.z),Me(n.pos,ad,e.offset);return e.updatePathVertexInformation(),s/e.vertices.length}function Sat(e,t,i,r){const s=e.stageObject,n=s.geometryRecords;let o=0;Eat.spatialReference=r.spatialReference;for(const a of n){const l=a.geometry;if(!ySe(l))continue;const c=l.path,h=c.builder.path,p=l.geometrySR;TSe.spatialReference=p,o+=Tat(h,t,i,r),l.upVectorAlignment!=="world"&&xSe(h,l.upVectorAlignment,r),c.onPathChanged(),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(a)}return o/n.length}const Eat=f0(0,0,0,null),TSe=f0(0,0,0,null),ad=F(),Ef=Wi(),cle=Wi(),r9=new vI,Cat=3,ule=3,Aat=10;function Oat(e,t,i,r,s=1){if(i.isGeographic&&r===st.Global){const a=new Float64Array(t.typedBuffer.length),l=3*t.count,c=ji(i);for(let h=0;h<l;h+=3)EX(t.typedBuffer,h,a,h,c);t=Ws.fromTypedArray(a)}Di(Sn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let a=0;a<t.count;a++)t.getVec(a,Mc),Sn[0]=Math.min(Sn[0],Mc[0]),Sn[1]=Math.min(Sn[1],Mc[1]);const n=Sn[0]%s,o=Sn[1]%s;id[0]=Sn[0]-n,id[1]=Sn[1]-o;for(let a=0;a<t.count;a++)t.getVec(a,Mc),e.setValues(a,(Mc[0]-id[0])/s,(Mc[1]-id[1])/s,id[0]/s,id[1]/s)}function SSe(e,t,i,r,s=1){fe(fb,1,0,0),fe(mb,0,1,0),fe(bS,0,0,1),Pat(s9,t),Rat(t,hle)&&Mat(hle,fb,mb,bS,i,s9),Di(Sn,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Di(gb,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let l=0;l<t.count;l++){t.getVec(l,Mc);const c=ke(fb,Mc),h=ke(mb,Mc);Sn[0]=Math.min(Sn[0],c),Sn[1]=Math.min(Sn[1],h),gb[0]=Math.max(gb[0],c),gb[1]=Math.max(gb[1],h)}const n=ke(bS,s9);o9(K0,Sn[0],Sn[1],n,fb,mb,bS),o9(yb,gb[0],Sn[1],n,fb,mb,bS),o9(_b,Sn[0],gb[1],n,fb,mb,bS),Me(yb,yb,K0),be(yb,yb,.5),Me(_b,_b,K0),be(_b,_b,.5),Oe(K0,K0,yb),Oe(K0,K0,_b);const o=Sn[0]%s,a=Sn[1]%s;id[0]=Sn[0]-o,id[1]=Sn[1]-a;for(let l=0;l<t.count;l++){t.getVec(l,Mc),e.setValues(l,(ke(fb,Mc)-id[0])/s,(ke(mb,Mc)-id[1])/s,id[0]/s,id[1]/s);for(let c=0;c<3;c++)r.set(l,c,K0[c]),r.set(l,c+3,yb[c]),r.set(l,c+6,_b[c])}}const s9=F(),Mc=F(),hle=Vi(),fb=F(),mb=F(),bS=F(),Sn=yt(),gb=yt(),id=yt(),K0=F(),yb=F(),_b=F();function Rat(e,t){const i=e.count-1;return hge(e,t,0,Math.floor(i/3),Math.floor(i*(2/3)))}function Mat(e,t,i,r,s,n){w(s)?(s.basisMatrixAtPosition(n,Cf),fe(hD,Cf[0],Cf[1],Cf[2]),fe(dD,Cf[4],Cf[5],Cf[6]),fe(n9,Cf[8],Cf[9],Cf[10])):(fe(hD,1,0,0),fe(dD,0,1,0),fe(n9,0,0,1));const o=e;ke(o,n9)<0&&be(o,o,-1),ve(r,o);const a=ke(o,dD),l=ke(o,hD);Math.abs(a)<Math.abs(l)?(kw(t,hD,o,-l),De(t,t),St(i,t,o),De(i,i),be(i,i,-1)):(kw(i,dD,o,-a),De(i,i),St(t,i,o),De(t,t))}const Cf=Be(),hD=F(),dD=F(),n9=F();function Pat(e,t){fe(pD,0,0,0);for(let i=0;i<t.count-1;i++)t.getVec(i,Mc),Oe(pD,pD,Mc);be(e,pD,1/(t.count-1))}const pD=F();function o9(e,t,i,r,s,n,o){fe(e,t*s[0]+i*n[0]+r*o[0],t*s[1]+i*n[1]+r*o[1],t*s[2]+i*n[2]+r*o[2])}function Iat(e){const t=new dr,i=e.output===ue.Depth,r=e.hasMultipassTerrain&&(e.output===ue.Color||e.output===ue.Alpha);Yu(t,e),t.include(oa,{hasModelTransformation:!1,linearDepth:i}),t.include(TT,e),t.attributes.add(D.POSITION,"vec3"),t.varyings.add("vpos","vec3"),r&&t.varyings.add("depth","float");const{vertex:s,fragment:n}=t;return i&&(t.include(A1,e),s.uniforms.add(new Ni("nearFar",(o,a)=>a.camera.nearFar)),t.varyings.add("linearDepth","float")),s.code.add(E`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${i?E`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:E`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ns,e),r&&t.include(oh,e),n.include(Wm),n.uniforms.add(new Ci("eColor",o=>o.color)),e.output===ue.Highlight&&t.include(d0),n.code.add(E`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${e.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${E.float(la)}) {
      discard;
    }

    ${e.output===ue.Alpha?E`gl_FragColor = vec4(fColor.a);`:""}

    ${e.output===ue.Color?E`gl_FragColor = highlightSlice(fColor, vpos); ${e.transparencyPassType===Pt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${e.output===ue.Highlight?E`outputHighlight();`:""};
    ${e.output===ue.Depth?E`outputDepth(linearDepth);`:""};
  }
  `),t}const Lat=Object.freeze(Object.defineProperty({__proto__:null,build:Iat},Symbol.toStringTag,{value:"Module"}));class qz extends $r{initializeProgram(t){const i=qz.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}_createPipeline(t,i){const r=this.configuration,s=t===Pt.NONE,n=t===Pt.FrontFace;return ni({blending:r.output!==ue.Color&&r.output!==ue.Alpha||!r.transparent?null:s?Qu:p0(t),culling:qU(r.cullFace),depthTest:{func:C1(t)},depthWrite:s||n?r.writeDepth&&ec:null,colorWrite:wi,stencilWrite:r.hasOccludees?Fm:null,stencilTest:r.hasOccludees?i?y1:O1:null,polygonOffset:s||n?r.polygonOffset&&$at:_z(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}qz.shader=new Tr(Lat,()=>_e(()=>import("./ColorMaterial.glsl.9e6113b3.js"),[],import.meta.url));const $at={factor:1,units:1};class yu extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.cullFace=Ir.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Pt.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([ee({count:ue.COUNT})],yu.prototype,"output",void 0),u([ee({count:Ir.COUNT})],yu.prototype,"cullFace",void 0),u([ee()],yu.prototype,"hasSlicePlane",void 0),u([ee()],yu.prototype,"hasVertexColors",void 0),u([ee()],yu.prototype,"transparent",void 0),u([ee()],yu.prototype,"polygonOffset",void 0),u([ee()],yu.prototype,"enableOffset",void 0),u([ee()],yu.prototype,"writeDepth",void 0),u([ee()],yu.prototype,"hasOccludees",void 0),u([ee({count:Pt.COUNT})],yu.prototype,"transparencyPassType",void 0),u([ee()],yu.prototype,"hasMultipassTerrain",void 0),u([ee()],yu.prototype,"cullAboveGround",void 0);class dle extends Xm{constructor(t){super(t,new Nat),this.supportsEdges=!0,this._configuration=new yu}getConfiguration(t,i){return this._configuration.output=t,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=i.transparencyPassType,this._configuration.enableOffset=i.camera.relativeElevation<gz,this._configuration.hasMultipassTerrain=i.multipassTerrain.enabled,this._configuration.cullAboveGround=i.multipassTerrain.cullAboveGround,this._configuration}intersect(t,i,r,s,n,o,a){hz(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Ue.DRAPED_MATERIAL?!0:Kx(i)===ue.Highlight?t===Ue.OPAQUE_MATERIAL:t===(this.parameters.transparent?this.parameters.writeDepth?Ue.TRANSPARENT_MATERIAL:Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Ue.OPAQUE_MATERIAL)}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Alpha||t.output===ue.Highlight||t.output===ue.Depth&&this.parameters.writeLinearDepth?new Dat(t):null}createBufferWriter(){return new Lz(pTe)}}class Dat extends S1{_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==ue.Color&&this._output!==ue.Alpha||this._updateOccludeeState(t),this.ensureTechnique(qz,t)}}class Nat extends cA{constructor(){super(...arguments),this.color=vm,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ir.None,this.hasOccludees=!1}}var Io;(function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Cross=2]="Cross",e[e.ForwardDiagonal=3]="ForwardDiagonal",e[e.BackwardDiagonal=4]="BackwardDiagonal",e[e.DiagonalCross=5]="DiagonalCross",e[e.COUNT=6]="COUNT"})(Io||(Io={}));const wW=.70710678118,ple=wW,Fat=.08715574274;function kat(e){const t=new dr,i=e.hasMultipassTerrain&&(e.output===ue.Color||e.output===ue.Alpha);e.draped||t.extensions.add("GL_OES_standard_derivatives");const r=e.output===ue.Depth,{vertex:s,fragment:n}=t;Yu(t,e),t.include(oa,{hasModelTransformation:!1,linearDepth:r}),t.include(TT,e),r&&(t.include(A1,e),s.uniforms.add(new Ni("nearFar",(a,l)=>l.camera.nearFar)),t.varyings.add("linearDepth","float")),e.draped?s.uniforms.add(new lt("worldToScreenRatio",(a,l)=>1/l.screenToPCSRatio)):t.attributes.add(D.BOUNDINGRECT,"mat3"),t.attributes.add(D.POSITION,"vec3"),t.attributes.add(D.UVMAPSPACE,"vec4"),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i&&t.varyings.add("depth","float");const o=e.style===Io.ForwardDiagonal||e.style===Io.BackwardDiagonal||e.style===Io.DiagonalCross;return o&&s.code.add(E`
      const mat2 rotate45 = mat2(${E.float(wW)}, ${E.float(-ple)},
                                 ${E.float(ple)}, ${E.float(wW)});
    `),e.draped||(Dm(s,e),s.uniforms.add(new lt("worldToScreenPerDistanceRatio",(a,l)=>1/l.camera.perScreenPixelRatio)),s.code.add(E`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),s.code.add(E`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),s.code.add(E`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${E.float(Fat)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),s.code.add(E`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${o?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${o?" * rotate45":""};

      ${e.draped?"":E`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${E.float(e.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),s.code.add(E`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${i?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${r?E`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:E`transformPosition(proj, view, vpos);`}
    }
  `),t.include(Ns,e),n.include(Wm),e.draped&&n.uniforms.add(new lt("texelSize",(a,l)=>1/l.camera.pixelRatio)),e.output===ue.Highlight&&t.include(d0),i&&t.include(oh,e),e.output!==ue.Highlight&&(n.code.add(E`
      const float lineWidth = ${E.float(e.lineWidth)};
      const float spacing = ${E.float(e.patternSpacing)};
      const float spacingINV = ${E.float(1/e.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),e.draped||n.code.add(E`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.uniforms.add(new Ci("uColor",a=>a.color)),n.code.add(E`
    void main() {
      discardBySlice(vpos);
      ${i?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${e.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${e.output!==ue.Highlight?E`color.a *= ${Uat(e)};`:""}

      if (color.a < ${E.float(la)}) {
        discard;
      }

      ${e.output===ue.Alpha?E`gl_FragColor = vec4(color.a);`:""}

      ${e.output===ue.Color?E`gl_FragColor = color; ${e.transparencyPassType===Pt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${e.output===ue.Highlight?E`outputHighlight();`:""}
      ${e.output===ue.Depth?E`outputDepth(linearDepth);`:""};
    }
  `),t}function Uat(e){function t(i){return e.draped?E`coverage(vuv.${i}, texelSize)`:E`sample(vuv.${i})`}switch(e.style){case Io.ForwardDiagonal:case Io.Horizontal:return t("y");case Io.BackwardDiagonal:case Io.Vertical:return t("x");case Io.DiagonalCross:case Io.Cross:return E`
        1.0 - (1.0 - ${t("x")}) * (1.0 - ${t("y")})
      `;default:return"0.0"}}const zat=Object.freeze(Object.defineProperty({__proto__:null,build:kat},Symbol.toStringTag,{value:"Module"}));class Wz extends $r{initializeProgram(t){const i=Wz.shader.get().build(this.configuration);return new Sr(t.rctx,i,ESe)}_setPipelineState(t,i){const r=this.configuration,s=t===Pt.NONE,n=t===Pt.FrontFace;return ni({blending:r.output===ue.Color||r.output===ue.Alpha?s?Qu:p0(t):null,culling:qU(r.cullFace),depthTest:{func:C1(t)},depthWrite:s?r.writeDepth&&ec:mz(t),colorWrite:wi,stencilWrite:r.hasOccludees?Fm:null,stencilTest:r.hasOccludees?i?y1:O1:null,polygonOffset:s||n?r.polygonOffset&&Bat:_z(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(t,i){return i?this._occludeePipelineState:super.getPipelineState(t,i)}}Wz.shader=new Tr(zat,()=>_e(()=>import("./Pattern.glsl.3ead42ef.js"),[],import.meta.url));const Bat={factor:1,units:1};class Za extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.cullFace=Ir.None,this.transparencyPassType=Pt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}u([ee({count:ue.COUNT})],Za.prototype,"output",void 0),u([ee({count:Ir.COUNT})],Za.prototype,"cullFace",void 0),u([ee({count:Io.COUNT})],Za.prototype,"style",void 0),u([ee({count:Pt.COUNT})],Za.prototype,"transparencyPassType",void 0),u([ee()],Za.prototype,"hasSlicePlane",void 0),u([ee()],Za.prototype,"hasVertexColors",void 0),u([ee()],Za.prototype,"polygonOffset",void 0),u([ee()],Za.prototype,"writeDepth",void 0),u([ee()],Za.prototype,"hasOccludees",void 0),u([ee()],Za.prototype,"patternSpacing",void 0),u([ee()],Za.prototype,"lineWidth",void 0),u([ee()],Za.prototype,"enableOffset",void 0),u([ee()],Za.prototype,"draped",void 0),u([ee()],Za.prototype,"hasMultipassTerrain",void 0),u([ee()],Za.prototype,"cullAboveGround",void 0);const ESe=new Map([[D.POSITION,0],[D.COLOR,3],[D.UVMAPSPACE,4],[D.BOUNDINGRECT,5]]);class VJ extends Xm{constructor(t){super(t,new jat),this.supportsEdges=!0,this._vertexAttributeLocations=ESe,this.techniqueConfig=new Za}getConfiguration(t,i){return this.techniqueConfig.output=t,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=i.transparencyPassType,this.techniqueConfig.enableOffset=i.camera.relativeElevation<gz,this.techniqueConfig.hasMultipassTerrain=i.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=i.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(t,i,r,s,n,o,a){hz(t,i,s,n,o,void 0,a)}requiresSlot(t,i){return t===Ue.DRAPED_MATERIAL?!0:Kx(i)===ue.Highlight?t===Ue.OPAQUE_MATERIAL:t===(this.parameters.writeDepth?Ue.TRANSPARENT_MATERIAL:Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)}createGLMaterial(t){return t.output===ue.Color||t.output===ue.Alpha||t.output===ue.Highlight||t.output===ue.Depth&&this.parameters.writeLinearDepth?new Vat(t):null}createBufferWriter(){const t=As().vec3f(D.POSITION).vec4u8(D.COLOR).vec4f(D.UVMAPSPACE);return this.parameters.draped||t.mat3f(D.BOUNDINGRECT),new Gat(t)}}class Vat extends S1{_updateParameters(t){return this.ensureTechnique(Wz,t)}_updateOccludeeState(t){t.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:t.hasOccludees})}beginSlot(t){return this._output!==ue.Color&&this._output!==ue.Alpha||this._updateOccludeeState(t),this._updateParameters(t)}}class Gat extends Lz{write(t,i,r,s){for(const n of this.vertexBufferLayout.fieldNames){const o=i.vertexAttributes.get(n),a=i.indices.get(n);if(o&&a)switch(n){case D.POSITION:{At(o.size===3);const l=r.getField(n,hr);l&&dz(a,o.data,t.transformation,l,s);break}case D.COLOR:{At(o.size===3||o.size===4);const l=r.getField(n,tc);l&&V5(a,o.data,o.size,l,s);break}case D.UVMAPSPACE:{At(o.size===4);const l=r.getField(n,fo);l&&wC(a,o.data,l,s);break}case D.BOUNDINGRECT:{At(o.size===9);const l=r.getField(n,Jp);l&&this.writeBoundingRect(a,o.data,t.transformation,l,s);break}}}}writeBoundingRect(t,i,r,s,n){const o=r,a=s.typedBuffer,l=s.typedBufferStride,c=t.length;n*=l;for(let h=0;h<c;++h){const p=9*t[h],m=i[p],g=i[p+1],v=i[p+2];a[n]=o[0]*m+o[4]*g+o[8]*v+o[12],a[n+1]=o[1]*m+o[5]*g+o[9]*v+o[13],a[n+2]=o[2]*m+o[6]*g+o[10]*v+o[14];for(let b=3;b<9;++b)a[n+b]=i[p+b];n+=l}}}class jat extends cA{constructor(){super(...arguments),this.color=ki(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Ir.None,this.hasOccludees=!1,this.style=Io.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Hat(e,t,i){return Wat(qat(e),t,i)}function qat(e){return e&&e.pattern||null}function Wat(e,t,i){return w(e)?e.style==="none"||e.style==="solid"?(e.style==="none"&&(t.color=ki(0,0,0,0),t.transparent=!0),new dle(t)):(t.style=Zat(e.style),t.draped=i.isDraped,new VJ(t)):new dle(t)}function Zat(e){switch(e){case"horizontal":return Io.Horizontal;case"vertical":return Io.Vertical;case"cross":return Io.Cross;case"forward-diagonal":return Io.ForwardDiagonal;case"backward-diagonal":return Io.BackwardDiagonal;case"diagonal-cross":return Io.DiagonalCross;default:return}}function Xat(e){return e.material instanceof VJ&&!e.material.parameters.draped}function Yat(e,t){if(Xat(e)){const i=e.geometry.vertexAttributes,r=i.get(D.POSITION).data,s=i.get(D.UVMAPSPACE).data,n=i.get(D.BOUNDINGRECT).data;SSe(fo.fromTypedArray(s),Ws.fromTypedArray(r),t,o1.fromTypedArray(n))}}function Qat(e,t,i,r){const s=Axe(e,t,i,r),n=e.stageObject.geometryRecords;for(let o=0;o<n.length;o++)Yat(n[o],r);return s}const Jat=["polyline","polygon","extent"];class Zz extends Qm{constructor(t,i,r,s){super(t,i,r,s),this._needsUV=!1,this._hasOutline=!1}async doLoad(){}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if(w(this._material))return;const t=Mn(this.symbolLayer,"material","color"),i=this._getCombinedOpacityAndColor(t);this._material=Hat(this.symbolLayer,{color:i,transparent:i[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof VJ,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const t=this.symbolLayer.outline;if(w(this._outlineMaterial)||!this._isValidOutline(t))return;this._hasOutline=!0;const i=r=>{const s=qTe(t.pattern);return new Z2({width:r,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:s,stippleScaleWithLineWidth:!0,cap:mW(t.patternCap||"butt")})};this._outlineMaterial=i(No(t.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(t){return w(t)&&t.size&&t.size>0&&w(t.color)&&(N(t.pattern)||t.pattern.type!=="style"||t.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,Jat,this.symbolLayer.type))return null;const r=this._getVertexOpacityAndColor(t.renderingInfo,255),s=this.setGraphicElevationContext(i,new lh);return this.ensureDrapedStatus(s.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(i,r):this._createAs3DShape(i,r,s)}layerOpacityChanged(){if(w(this._material)){const t=this._material.parameters.color,i=Mn(this.symbolLayer,"material","color"),r=this._getCombinedOpacity(i);this._material.setParameters({color:[t[0],t[1],t[2],r],transparent:r<1||this.needsDrivenTransparentPass})}if(w(this._outlineMaterial)){const t=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[t[0],t[1],t[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=_I(Zz.elevationModeChangeTypes,r,s);if(n!==_s.UPDATE)return n;const o=xd(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){if(w(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),w(this._outlineMaterial)){const t={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(t)}return!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=g3(t.geometry);if(N(s))return null;Vn.renderData=LJ(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),Vn.color=i;const n=Vn.renderData.position.length/3;if(this._needsUV&&(Vn.uvMapSpace=new Float32Array(4*n),Vn.boundingRect=new Float64Array(9*n)),Vn.outNum=0,Vn.outGeometries=[],Vn.outTransforms=[],Vn.outMaterials=[],this._createAs3DShapeFill(Vn),this._hasOutline&&this._createAs3DShapeOutline(Vn),this._logGeometryCreationWarnings(Vn.renderData,s.rings,"rings","FillSymbol3DLayer"),Vn.outNum===0)return null;this._needsUV&&SSe(fo.fromTypedArray(Vn.uvMapSpace),Ws.fromTypedArray(Vn.renderData.position),this._context.renderCoordsHelper,o1.fromTypedArray(Vn.boundingRect));const o=new m0({geometries:Vn.outGeometries,materials:Vn.outMaterials,transformations:Vn.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:t.uid}}),a=new Ym(this,o,Vn.outGeometries,null,null,Qat,r);return a.alignedSampledElevation=Vn.renderData.sampledElevation,a.needsElevationUpdates=xd(r.mode),a}_createAs3DShapeFill(t){const i=t.renderData.polygons;for(const{position:r,mapPosition:s,holeIndices:n,index:o,count:a}of i){if(w(this._context.clippingExtent)&&(Fr(Fa),Vu(Fa,s),!Rp(Fa,this._context.clippingExtent)))continue;const l=SC(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=wae({indices:c,attributeData:{position:r,color:t.color,mapPosition:s,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*o*t.uvMapSpace.BYTES_PER_ELEMENT,4*a):null,boundingRect:this._needsUV?new Float64Array(t.boundingRect.buffer,9*o*t.boundingRect.BYTES_PER_ELEMENT,9*a):null}});t.outGeometries.push(h),t.outMaterials.push(this._material),t.outTransforms.push(Dn),t.outNum++}}_createAs3DShapeOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{mapPosition:s,position:n}=i[r];if(w(this._context.clippingExtent)&&(Fr(Fa),Vu(Fa,s),!Rp(Fa,this._context.clippingExtent)))continue;const o=fW({overlayInfo:null,removeDuplicateStartEnd:rT.REMOVE,attributeData:{position:n,mapPosition:s}}),a=o.vertexAttributes.get(D.POSITION);a.data===n&&(a.data=new Float64Array(n)),t.outGeometries.push(o),t.outMaterials.push(this._outlineMaterial),t.outTransforms.push(Dn),t.outNum++}}_createAsOverlay(t,i){const r=g3(t.geometry);if(N(r))return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,w(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),Wo.renderData=wTe(r,this._context.overlaySR),Wo.color=i;const s=Wo.renderData.position.length/3;return this._needsUV&&(Wo.uvMapSpace=new Float32Array(4*s)),Wo.outNum=0,Wo.outGeometries=[],Wo.outBoundingBox=Fr(),Wo.layerUid=this._context.layer.uid,Wo.graphicsUid=t.uid,this._createAsOverlayFill(Wo),this._hasOutline&&this._createAsOverlayOutline(Wo),this._logGeometryCreationWarnings(Wo.renderData,r.rings,"rings","FillSymbol3DLayer"),Wo.outNum===0?null:(this._needsUV&&Oat(fo.fromTypedArray(Wo.uvMapSpace),Ws.fromTypedArray(Wo.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),Wo.outNum>0?new Nz(this,Wo.outGeometries,Wo.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayFill(t){const i=t.renderData.polygons;for(const{position:r,holeIndices:s,index:n,count:o}of i){if(Fr(Fa),Vu(Fa,r),!Rp(Fa,this._context.clippingExtent))continue;const a=SC(r,s,3);if(a.length===0)continue;kE(t.outBoundingBox,Fa);const l=new Uint32Array(a),c=wae({indices:l,attributeData:{position:r,color:t.color,uvMapSpace:this._needsUV?new Float32Array(t.uvMapSpace.buffer,4*n*t.uvMapSpace.BYTES_PER_ELEMENT,4*o):null}}),h=new OC(c,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),p=Fa;_r(h.boundingSphere,.5*(p[0]+p[3]),.5*(p[1]+p[4]),0,.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]))),t.outGeometries.push(h),t.outNum++}}_createAsOverlayOutline(t){if(!this._hasOutline)return;const i=t.renderData.outlines;for(let r=0;r<i.length;++r){const{position:s}=i[r];if(Fr(Fa),Vu(Fa,s),!Rp(Fa,this._context.clippingExtent))continue;kE(t.outBoundingBox,Fa);const n=fW({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:rT.REMOVE,attributeData:{position:s}}),o=new OC(n,this._outlineMaterial,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),a=Fa;_r(o.boundingSphere,.5*(a[0]+a[3]),.5*(a[1]+a[4]),0,.5*Math.sqrt((a[3]-a[0])*(a[3]-a[0])+(a[4]-a[1])*(a[4]-a[1]))),t.outGeometries.push(o),t.outNum++}}_getOutlineOpacity(){const t=Mn(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(w(t)?t.a:0)}_getOutlineColor(){const t=Mn(this.symbolLayer,"outline","color"),i=this._getOutlineOpacity();return jM(w(t)?at.toUnitRGB(t):null,i)}test(){return{...super.test(),createAsOverlay:(t,i)=>this._createAsOverlay(t,i),createAs3DShape:(t,i,r)=>this._createAs3DShape(t,i,r)}}}Zz.elevationModeChangeTypes={definedChanged:_s.RECREATE,staysOnTheGround:_s.NONE,onTheGroundChanged:_s.RECREATE};const Fa=dn(),Vn={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Wo={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},Kat=Ie.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class Xz{constructor(t){this.definition=t,this.key=JSON.stringify(t),this.haloSize=Math.round(t.halo.size),this.textStyle=this._colorToRGBA(t.color),this.haloStyle=this._colorToRGB(t.halo.color),this.backgroundStyle=t.background.color[3]!==0?this._colorToRGBA(t.background.color):null}fontString(t){const i=this.definition.font;return`${i.style} ${i.weight} ${t}px ${i.family}, sans-serif`}_colorToRGB(t){return`rgb(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()})`}_colorToRGBA(t){return`rgba(${t.slice(0,3).map(i=>Math.floor(255*i)).toString()},${t[3]})`}static async fromSymbol(t,i=1){const r=Mn(t,"material","color"),s=Iu(r,vm,at.toUnitRGBA),n=Iu(t.size,12,No),o=t.lineHeight,a=w(t.background)?at.toUnitRGBA(t.background.color):vm,l={family:Iu(t.font,"sans-serif",g=>g.family),decoration:Iu(t.font,"none",g=>g.decoration),weight:Iu(t.font,"normal",g=>g.weight),style:Iu(t.font,"normal",g=>g.style)},c=t.halo,h=w(c)&&w(c.color)&&c.size>0?{size:No(c.size),color:at.toUnitRGBA(c.color)}:{size:0,color:vm},p=new Xz({color:s,size:n,background:{color:a,padding:w(t.background)?[.65*n,.5*n]:[0,0],borderRadius:w(t.background)?n*(6/16):0},lineSpacingFactor:o,font:l,halo:h,pixelRatio:i}),m=p.fontString(n);try{await document.fonts.load(m)}catch{Kat.warnOnce(`Failed to preload font '${m}'. Some text symbology may be rendered using the default browser font.`)}return p}}class elt{constructor(t,i,r){this._renderer=new FTe(t,i,r)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const t=LF(tlt,this._renderer.renderedWidth,this._renderer.renderedHeight),i=t.getContext("2d");return i.save(),this._renderer.render(i,0,0),i.restore(),new sn(t,{wrap:{s:Ft.CLAMP_TO_EDGE,t:Ft.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:jv.PAD})}}const tlt={canvas:null},ilt=[0,0,1];class rlt extends Qm{constructor(t,i,r,s){super(t,i,r,s),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const t=vz(this.symbolLayer.size);if(t)throw new se("graphics3dtextsymbollayer:invalid-size",t)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const t=this._context.graphicsCoreOwner.view.state.pixelRatio;this._textRenderParameters=await Xz.fromSymbol(this.symbolLayer,t)}destroy(){super.destroy()}createGraphics3DGraphic(t){const i=t.graphic,r=f3(i.geometry);if(N(r))return this.logger.warn(`unsupported geometry type for text symbol: ${i.geometry.type}`),null;const s=this.symbolLayer.text;if(N(s)||s==="")return null;const n=fX(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(w(n)&&!Efe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o={...olt,verticalOffset:n,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:Art(this.symbolLayer.verticalAlignment)};return this._createAs3DShape(i,r,s,o)}createLabel(t,i,r,s){const n=t.graphic,o=f3(n.geometry);if(N(o))return this.logger.warn(`unsupported geometry type for label: ${n.geometry.type}`),null;const a=i.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(n,o,a,i,r,s)}setGraphicElevationContext(t,i,r=0){const s=super.setGraphicElevationContext(t,i);return s.addOffsetRenderUnits(r),s}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(t,i){return fle(t,i,(r,s)=>{this.updateGraphicElevationContext(s,r)}),_s.UPDATE}slicePlaneEnabledChanged(t,i){return fle(t,i,r=>{for(const s of r.stageObject.geometryRecords)s.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(t,i){this.setGraphicElevationContext(t,i.elevationContext,i.metadata.elevationOffset),i.needsElevationUpdates=xd(i.elevationContext.mode)||i.elevationContext.mode==="absolute-height"}_defaultElevationInfoNoZ(){return nlt}_createAs3DShape(t,i,r,s,n,o){const a=this.setGraphicElevationContext(t,new lh,s.elevationOffset),l=Mn(t.geometry,"type")==="polyline",c=t.uid;let h=null,p=null;if(N(o)){const X=UTe(s.horizontalPlacement);h=new elt(r,X,this._textRenderParameters);let ne=null;p=this._context.sharedResources.textures.fromData(h.key,()=>h.create(),()=>{w(ne)&&ne.release()});const re=this._context.stage.renderView.textureRepository.acquire(p.texture.id);if(N(re)||ah(re))return p.release(),null;ne=re}const m=slt(h,s),g={occlusionTest:!0,screenOffset:s.screenOffset,anchorPosition:m,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:s.centerOffsetUnits,debugDrawLabelBorder:s.debugDrawLabelBorder,drawInSecondSlot:!0};if(w(p)&&(g.textureId=p.texture.id),w(o)&&(g.textureId=o.id),w(s.verticalOffset)){const{screenLength:X,minWorldLength:ne,maxWorldLength:re}=s.verticalOffset;g.verticalOffset={screenLength:No(X),minWorldLength:ne||0,maxWorldLength:re!=null?re:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:X,screenSizePerspectiveSettingsLabels:ne}=this._context.sharedResources;g.screenSizePerspective=ne.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),g.screenSizePerspectiveAlignment=X}let v;if(l&&(g.shaderPolygonOffset=1e-4),g.hasSlicePlane=this._context.slicePlaneEnabled,w(n)){const X=JSON.stringify(g);v=n.get(X),N(v)&&(v=new xC(g),n.add(X,v))}else v=new xC(g);const b=[v],S=s.translation,T=w(h)?[h.displayWidth,h.displayHeight]:[0,0],O=s.centerOffset,C=ilt,M=[0,0],I=[Sc.createPointGeometry(C,S,null,T,O,M,null)],$=this._context.layer.uid,U=EJ(this._context,i,I,b,a,$,c);if(U===null)return null;const q=new Ym(this,U.object,I,N(n)?b:null,p,d3,a);q.alignedSampledElevation=U.sampledElevation,q.needsElevationUpdates=xd(a.mode)||a.mode==="absolute-height";const{displayWidth:G,displayHeight:Y}=w(h)?h:s;q.getScreenSize=(X=yt())=>(X[0]=G,X[1]=Y,X);const J={labelText:r,elevationOffset:s.elevationOffset};return q.metadata=J,p3(q,i,this._context.elevationProvider),q}}function fle(e,t,i){e&&e.forEach(r=>{const s=t(r);w(s)&&i(s,r.graphic)})}function slt(e,t){if(t.verticalPlacement==="baseline"){const r=Srt[t.horizontalPlacement],s=w(e)?e.baselineAnchorY:0;return ir(r,s)}const i=Crt(t.horizontalPlacement,t.verticalPlacement);return $F[i]}const nlt={mode:"relative-to-ground",offset:0},olt={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0},alt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},llt=["polyline","polygon","extent"];class om extends Qm{constructor(t,i,r,s){super(t,i,r,s)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(t){const i=t.graphic;if(!this._validateGeometry(i.geometry,llt,this.symbolLayer.type))return null;const r=this.setGraphicElevationContext(i,new lh);return this.ensureDrapedStatus(r.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(i):this._createAs3DShape(i,r,i.uid)}ensureMaterial(){if(w(this._material))return;const t=new mTe,i=this.symbolLayer.color;w(i)&&(t.color=at.toUnitRGBA(i));const r=this._getCombinedOpacity(i,{hasIntrinsicColor:!0});t.color=[t.color[0],t.color[1],t.color[2],r],t.transparent=r<1||this.needsDrivenTransparentPass,t.waveDirection=w(this.symbolLayer.waveDirection)?om.headingVectorFromAngle(this.symbolLayer.waveDirection):ir(0,0);const s=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,n=alt[s];t.waveStrength=n.waveStrength,t.waveTextureRepeat=n.textureRepeat,t.waveVelocity=n.waveVelocity,t.flowStrength=n.perturbationStrength,t.hasSlicePlane=this._context.slicePlaneEnabled,t.isDraped=this.draped,this._material=new fTe(t),this._context.stage.add(this._material)}layerOpacityChanged(){if(N(this._material))return!0;const t=this._material.parameters.color,i=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),r=i<1||this.needsDrivenTransparentPass;return this._material.setParameters({color:[t[0],t[1],t[2],i],transparent:r}),!0}layerElevationInfoChanged(t,i,r){const s=this._elevationContext.mode,n=_I(om.elevationModeChangeTypes,r,s);if(n!==_s.UPDATE)return n;const o=xd(s);return this.updateGraphics3DGraphicElevationInfo(t,i,()=>o)}slicePlaneEnabledChanged(){return w(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(t,i,r){const s=g3(t.geometry);if(N(s))return null;va.renderData=LJ(s,this._context.elevationProvider,this._context.renderCoordsHelper,i);const n=va.renderData.position.length/3;if(va.uvCoords=new Float64Array(2*n),va.outNum=0,va.outGeometries=[],va.outTransforms=[],va.outMaterials=[],this._create3DShapeGeometries(va),this._logGeometryCreationWarnings(va.renderData,s.rings,"rings","WaterSymbol3DLayer"),va.outNum===0)return null;this._createUVCoordsFromVertices(va.uvCoords,va.renderData.mapPosition,n,this._context.elevationProvider.spatialReference);const o=new m0({geometries:va.outGeometries,materials:va.outMaterials,transformations:va.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r}}),a=new Ym(this,o,va.outGeometries,null,null,Axe,i);return a.alignedSampledElevation=va.renderData.sampledElevation,a.needsElevationUpdates=xd(i.mode),a}_createUVCoordsFromVertices(t,i,r,s){const n=Zc(s);th(e_);for(let l=0;l<r;l++)Di(mle,i[3*l+0],i[3*l+1]),rE(e_,mle);z3(e_,e_,n);const o=e_[0]%om.unitSizeOfTexture,a=e_[1]%om.unitSizeOfTexture;fD[0]=e_[0]-o,fD[1]=e_[1]-a;for(let l=0;l<r;l++)t[2*l+0]=(i[3*l+0]*n-fD[0])/om.unitSizeOfTexture,t[2*l+1]=(i[3*l+1]*n-fD[1])/om.unitSizeOfTexture}_create3DShapeGeometries(t){const i=t.renderData.polygons,r=t.uvCoords;for(const{count:s,index:n,position:o,mapPosition:a,holeIndices:l}of i){if(w(this._context.clippingExtent)&&(Fr(t_),Vu(t_,a),!Rp(t_,this._context.clippingExtent)))continue;const c=SC(a,l,3);if(c.length===0)continue;const h=new Uint32Array(c),p=new Float64Array(r.buffer,2*n*r.BYTES_PER_ELEMENT,2*s),m=xae({indices:h,attributeData:{position:o,uv0:p,mapPosition:a}});t.outGeometries.push(m),t.outMaterials.push(this._material),t.outTransforms.push(Dn),t.outNum++}}_createAsOverlay(t){const i=g3(t.geometry);if(N(i))return null;this._material.renderPriority=this._renderPriority,ka.renderData=wTe(i,this._context.overlaySR);const r=ka.renderData.position.length/3;return ka.uvCoords=new Float64Array(2*r),ka.outNum=0,ka.outGeometries=[],ka.outBoundingBox=Fr(),ka.layerUid=this._context.layer.uid,ka.graphicsUid=t.uid,this._createAsOverlayWater(ka),this._logGeometryCreationWarnings(ka.renderData,i.rings,"rings","WaterSymbol3DLayer"),ka.outNum===0?null:(this._createUVCoordsFromVertices(ka.uvCoords,ka.renderData.position,r,this._context.overlaySR),ka.outNum>0?new Nz(this,ka.outGeometries,ka.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(t){const i=t.uvCoords,r=t.renderData.polygons;for(const{position:s,holeIndices:n,index:o,count:a}of r){if(Fr(t_),Vu(t_,s),!Rp(t_,this._context.clippingExtent))continue;kE(t.outBoundingBox,t_);const l=SC(s,n,3);if(l.length===0)continue;const c=new Uint32Array(l),h=new Float64Array(i.buffer,2*o*i.BYTES_PER_ELEMENT,2*a),p=xae({indices:c,attributeData:{position:s,uv0:h}}),m=new OC(p,this._material,{layerUid:t.layerUid,graphicUid:t.graphicsUid}),g=t_;_r(m.boundingSphere,.5*(g[0]+g[3]),.5*(g[1]+g[4]),0,.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1]))),t.outGeometries.push(m),t.outNum++}}static headingVectorFromAngle(t){const i=yt(),r=Dk(t);return i[0]=Math.sin(r),i[1]=Math.cos(r),i}test(){return{...super.test(),create3DShape:t=>this._createAs3DShape(t.graphic,t.elevationContext,t.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}om.unitSizeOfTexture=100,om.elevationModeChangeTypes={definedChanged:_s.RECREATE,staysOnTheGround:_s.NONE,onTheGroundChanged:_s.RECREATE};const fD=yt(),e_=ei(),mle=yt(),t_=dn(),va={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},ka={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},clt=Ie.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function ult(e,t,i,r){const s=gle[e.type]&&gle[e.type][t.type]||hlt[t.type];return s?new s(e,t,i,r):(clt.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)}const hlt={icon:b3,object:Rot,line:Uz,path:xat,fill:Zz,extrude:hrt,text:rlt,water:om},gle={"mesh-3d":{fill:lnt}};class dlt extends wJ{constructor(t,i,r){super(i.schedule),this._symbol=t,this._context=i,this._backgroundLayers=r,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(t){this._symbol=t;for(let i=0;i<t.symbolLayers.length;i++){const r=this.symbolLayers[i];N(r)||(r.symbol=t,r.symbolLayer=t.symbolLayers.items[i])}}get symbol(){return this._symbol}async doLoad(t){let i=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(i=this._backgroundLayers.concat(i));const r=i.length;for(;this.symbolLayers.length<i.length;)this.symbolLayers.push(null);this.symbolLayers.length=i.length;const s=[];for(let n=0;n<r;n++){const o=i.getItemAt(n);if(o.enabled===!1)continue;mD.renderPriority=1-(1+n)/r,mD.renderPriorityStep=1/r,mD.ignoreDrivers=o._ignoreDrivers;const a=ult(this.symbol,o,this._context,mD);s.push(lZ(t,()=>{this.symbolLayers[n]=null,a.destroy()})),this.symbolLayers[n]=a}await xU(this.symbolLayers,async(n,o)=>{if(w(n))try{await n.load(),this._extentPadding+=Math.max(this._extentPadding,n.extentPadding)}catch{this.symbolLayers[o]=null}});for(const n of s)n==null||n.remove();if(s.length=0,Ui(t),this.symbolLayers.length&&!this.symbolLayers.some(n=>!!n))throw new Error}getSymbolLayerSize(t){const i=this.symbolLayers[t];return w(i)?i.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(t,i){const r=t.graphic,s=new Array(this.symbolLayers.length);for(let o=0;o<this.symbolLayers.length;o++){const a=this.symbolLayers[o];s[o]=w(a)?a.createGraphics3DGraphic(t):null}const n=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new ltt(r,i||this,s,t.layer,n)}get complexity(){return SJ(this.symbolLayers.map(t=>Mn(t,"complexity")))}globalPropertyChanged(t,i){const r=this.symbolLayers.length;for(let s=0;s<r;s++){const n=this.symbolLayers[s],o=a=>{const l=a.graphics[s];return l instanceof Ym?l:null};if(w(n)&&!n.globalPropertyChanged(t,i,o))return!1}return!0}applyRendererDiff(t,i){return this.loadStatus!==Pu.LOADED?In.Recreate_Symbol:this.symbolLayers.reduce((r,s)=>r!==In.Recreate_Symbol&&w(s)?Math.min(r,s.applyRendererDiff(t,i)):r,In.Fast_Update)}prepareSymbolPatch(t){if(this.loadStatus===Pu.FAILED||t.diff.type!=="partial")return;const i=t.diff.diff;if(!i.symbolLayers||i.symbolLayers.type!=="partial")return;const r=i.symbolLayers.diff;this.symbolLayers.forEach((s,n)=>{if(N(s))return;const o=r[n];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};s.prepareSymbolLayerPatch(a),t.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&t.graphics3DGraphicPatches.push((l,c)=>{const h=l.graphics[n];w(h)&&a.graphics3DGraphicPatches.forEach(p=>p(h,c))})}})}updateGeometry(t,i){for(let r=0;r<this.symbolLayers.length;r++){const s=this.symbolLayers[r];if(N(s))continue;const n=t.graphics[r];if(N(n)||!s.updateGeometry(n,i))return!1}return!0}onRemoveGraphic(t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(N(r))continue;const s=t.graphics[i];w(s)&&r.onRemoveGraphic(s)}}getFastUpdateStatus(){let t=0,i=0,r=0;return this.symbolLayers.forEach(s=>{N(s)||(s.loadStatus===Pu.LOADING?t++:s.isFastUpdatesEnabled()?r++:i++)}),{loading:t,slow:i,fast:r}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const t of this.symbolLayers)w(t)&&t.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const mD={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};class plt extends wJ{constructor(t,i,r){super(i),this.symbol=t,this.convert=r,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(t){return w(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(t):null}get symbolLayers(){return w(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return w(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}async doLoad(t){const i=await this.symbol.fetchSymbol({signal:t});i.id=this.symbol.id,this.graphics3DSymbol=this.convert(i),w(this.graphics3DSymbol)&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(t){return w(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(t,this):null}get complexity(){return w(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:TJ}globalPropertyChanged(t,i){return!!w(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(t,i)}applyRendererDiff(t,i){return w(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(t,i):In.Recreate_Symbol}prepareSymbolPatch(t){w(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(t)}updateGeometry(t,i){return!!w(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(t,i)}onRemoveGraphic(){}getFastUpdateStatus(){return w(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){w(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}}function GJ(e){return e instanceof plt?e.graphics3DSymbol:e instanceof dlt?e:null}const x3=Ie.getLogger("esri.views.3d.layers.graphics.labelPlacement");function flt(e){const t=Tlt(e);if(N(t))return null;const i=mlt(e,t);if(N(i))return null;const r=i.anchor,s=!!t.hasLabelVerticalOffset;return ylt({anchor:r,verticalOffset:t.verticalOffset,screenOffset:yt(),centerOffset:ki(0,0,0,-1),centerOffsetUnits:"world",translation:F(),elevationOffset:0,hasLabelVerticalOffset:s},i,e)}function mlt(e,t){if(t.anchor)return t;const i=e.labelClass.labelPlacement,r=Dp[i],s=r||nk(e);return i&&!r&&x3.warnOncePerTick(`the requested label placement '${i}' is currently unsupported in SceneView.`),glt(s,e)}function jJ(e){const t=e.graphics3DGraphic.graphics3DSymbol,i=GJ(t);return w(i)?i.symbol.symbolLayers.getItemAt(0):null}function glt(e,t){const i=t.graphics3DGraphic.graphic.geometry;if(N(i))return null;if(w(t.disablePlacement))return t.labelClass.labelPlacement?(x3.warnOncePerTick(yle(e.placement,t.disablePlacement.logEntityDescription)),nk(t)):e;const r=i.type;switch(r){case"polyline":case"polygon":case"extent":case"multipoint":if(t.labelClass.labelPlacement)return x3.warnOncePerTick(yle(e.placement,`'${r}' geometries`)),nk(t);break;case"point":case"mesh":return e}return e}function yle(e,t){return`the requested label placement '${e}' is currently unsupported for ${t} in SceneView.`}function nk(e){const t=e.graphics3DGraphic.graphic.geometry;if(N(t))return null;switch(t.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const i=jJ(e);return w(i)&&i.type==="extrude"?Dp["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Dp["above-center"];default:return}}function ylt(e,t,i){const r=i.graphics3DGraphic.graphic.geometry;if(N(r))return null;switch(r.type){case"point":vlt(e,t,i);break;case"polygon":_lt(e,t,i);break;case"mesh":HJ(e,t,i.graphics3DGraphic.graphics[0])}return e}function _lt(e,t,i){const r=jJ(i);if(!N(r))switch(r.type){case"extrude":{const s=i.graphics3DGraphic.graphics[0];w(s)?(s.getBoundingBoxObjectSpace(QM),Op(QM,e.translation),e.translation[2]=v1(QM)/2):fe(e.translation,0,0,0),HJ(e,t,s);break}}}function vlt(e,t,i){const r=jJ(i);if(N(r))return;const s=i.graphics3DGraphic.graphics[0];switch(w(s)?s.getCenterObjectSpace(e.translation):fe(e.translation,0,0,0),r.type){case"icon":case"text":blt(e,t,i,s);break;case"object":HJ(e,t,s)}}function blt(e,t,i,r){const{graphics3DGraphic:s}=i,n=w(r)?r.getScreenSize():null;if(!s.isDraped&&w(n)){const o=wlt(i);OO[0]=n[0]/2*(t.normalizedOffset[0]-o[0]),OO[1]=n[1]/2*(t.normalizedOffset[1]-o[1]),e.screenOffset[0]=OO[0],e.hasLabelVerticalOffset?(e.centerOffset[1]=OO[1],e.centerOffsetUnits="screen"):e.screenOffset[1]=OO[1]}else e.hasLabelVerticalOffset||e.anchor==="center"||(Dp[i.labelClass.labelPlacement]&&x3.warnOncePerTick(`the requested placement '${t.placement}' is currently unsupported for draped graphics`),e.anchor="center")}function wlt(e,t=Slt){const{graphics3DGraphic:i}=e,r=i.graphics[0],s=w(r)?r.stageObject.geometryRecords[0].material:null;if(s&&s instanceof xC){const n=s.parameters.anchorPosition;t[0]=2*(n[0]-.5),t[1]=2*(n[1]-.5)}else t[0]=0,t[1]=0;return t}function HJ(e,t,i){const r=w(i)?i.getBoundingBoxObjectSpace(QM):QM,s=Ke(r[3]-r[0],r[4]-r[1],r[5]-r[2]),n=Math.sqrt(s[0]*s[0]+s[1]*s[1]);e.centerOffset[0]=n/2*t.normalizedOffset[0];const o=e.translation[2],a=s[2]/2*t.normalizedOffset[1];e.translation[2]=0,e.elevationOffset=o+a;const l=He(s);e.centerOffset[2]=l/2*t.normalizedOffset[2]}function xlt(e){return e==="above-center"}function Tlt(e){const t=e.labelClass.labelPlacement,{labelSymbol:i,graphics3DGraphic:r}=e,s=GJ(r.graphics3DSymbol),n=Cn(s,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Dp[t]||nk(e);return w(n)&&n.supportsCallout()&&n.hasVisibleVerticalOffset()&&!r.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:_le(n.verticalOffset),anchor:null,normalizedOffset:null}:i&&i.hasVisibleVerticalOffset()&&(N(n)||!n.supportsCallout()||!n.verticalOffset||r.isDraped)?xlt(o.placement)?{placement:"above-center",verticalOffset:_le(i.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(x3.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+t+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function _le(e){const{screenLength:t,minWorldLength:i,maxWorldLength:r}=e;return{screenLength:t,minWorldLength:i,maxWorldLength:r}}const Dp={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},vle={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const e in vle){const t=vle[e],i=Dp[e];t.forEach(r=>{Dp[r]=i})}Object.freeze&&(Object.freeze(Dp),Object.keys(Dp).forEach(e=>{Object.freeze(Dp[e]),Object.freeze(Dp[e].normalizedOffset)}));const OO=[0,0],Slt=[0,0],QM=dn();class ble{constructor(t){this._stage=t,this._materials=new Map}get(t){return this._materials.get(t)}add(t,i){this._materials.set(t,i),this._stage.add(i)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}const a9=512,l9=4096,Elt=.85,Clt=.95;let tM=class extends ze{constructor(e){super(e),this.type=Kp.Texture,this.id=Gl(),this.events=new ks,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const e=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(e),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=ht(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(e){return{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,flipped:!0,samplingMode:mt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:e.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(e){return w(this._glTexture)||(this._glTexture=new bt(e,this._createDescriptor(e),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(It.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=Ln(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=ht(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const e=document.createElement("canvas");return e.setAttribute("id","canvas2d"),e.setAttribute("style","display:none"),e.setAttribute("width",a9.toString()),e.setAttribute("height",a9.toString()),e}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(e=a9){this.atlas={size:{width:e,height:e},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(e,t){let i=Math.max(e,t);return i+=256,i=RE(i),i=Math.min(i,l9),i}_resizeAtlas(e,t){t=t||e;const i=this.atlas;i.size.width=e,i.size.height=t,w(this._glTexture)&&this._glTexture.resize(e,t),this._update2DCanvasSize()}_resetAtlasCursor(){const e=this.atlas;e.cursor.x=RO,e.cursor.y=RO+wle,e.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const e=this.atlas;return(e.cursor.x+e.cursor.y*e.size.width)/(e.size.width*e.size.height)}_getExpectedAtlasUsage(){const e=this.elementsToRemove.size,t=this.elementsToAddOrUpdate.size,i=this.elements.size;return this._getAtlasUsage()/i*(i+t-e)}_addAtlasElement(e,t,i,r){const s=this.atlas,{renderedWidth:n,renderedHeight:o,displayWidth:a,displayHeight:l}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,e.placement.size.width=n,e.placement.size.height=o,e.placement.size.displayWidth=a,e.placement.size.displayHeight=l,e.placement.uvMinMax=[e.placement.offset.x/s.size.width,1-(e.placement.offset.y+o)/s.size.height,(e.placement.offset.x+n)/s.size.width,1-e.placement.offset.y/s.size.height],s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,r),this.elements.set(t,e)}_removeAtlasElement(e){if(e&&this.elements.has(e.textId)){const t=e.placement.offset,i=e.placement.size;this.ctx.clearRect(t.x,t.y,i.width,i.height),this.elements.delete(e.textId)}}_ensureStageObjects(e){const t=this.stageObjects.get(e);if(t)return t;const i=new Set;return this.stageObjects.set(e,i),i}_addStageObject(e,t){this._ensureStageObjects(e).add(t)}_removeStageObject(e,t){const i=this.stageObjects.get(e);i&&i.delete(t)&&(t.geometries[0].vertexAttributes.get(D.SIZE).data=[0,0],t.geometryVertexAttrsUpdated(t.geometryRecords[0]))}_processAddition(e,t){const i=this.atlas,r=e.textId,s=e.textRenderer.renderedWidth,n=e.textRenderer.renderedHeight,o=s+RO,a=n+RO+wle;if(i.cursor.x+o<i.size.width&&i.cursor.y+a<i.size.height)this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r);else{if(!(i.cursor.y+a+i.lineHeight<i.size.height)){const l=this._getExpectedAtlasUsage(),c=l>Elt&&i.size.width<l9;return c&&this._resizeAtlas(2*i.size.width,2*i.size.height),!t||!c&&l>Clt&&i.size.width===l9?(this._processRemovals(),X2.OK):(this._repack(),X2.REPACK)}i.cursor.x=RO,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,r,o,a),this.elementsToRender.set(r,e),this.elementsToAddOrUpdate.delete(r)}return X2.OK}_processRemovals(){this.elementsToRemove.forEach((e,t)=>{const i=this.stageObjects.get(t);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this.stageObjects.delete(t)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((e,t)=>{e.rendered=!1,this.elementsToAddOrUpdate.set(t,e)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(e){this.ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.placement.size.width,e.placement.size.height),e.textRenderer.render(this.ctx,e.placement.offset.x,e.placement.offset.y);const t=this.stageObjects.get(e.textId);t&&t.forEach(i=>{i.geometries[0].vertexAttributes.get(D.UV0).data=new Float32Array(e.placement.uvMinMax),i.geometries[0].vertexAttributes.get(D.SIZE).data=[e.placement.size.displayWidth,e.placement.size.displayHeight],i.geometryVertexAttrsUpdated(i.geometryRecords[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,t=!0){if(!this._glTexture)return;let i=!1;if(On(this.elementsToAddOrUpdate,(s,n)=>{const o=this.elements.get(n);if(o&&o.rendered){const a=this.stageObjects.get(n);return a&&a.forEach(l=>{const c=l.geometries[0].vertexAttributes,h=this.elements.get(n);c.get(D.UV0).data=new Float32Array(h.placement.uvMinMax),c.get(D.SIZE).data=new Float32Array([h.placement.size.displayWidth,h.placement.size.displayHeight]),l.geometryVertexAttrsUpdated(l.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(n),!1}return this._processAddition(this.elementsToAddOrUpdate.get(n),t)===X2.REPACK&&(i=!0,!0)}),i)return void this.runTask(iA,!1);let r=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),On(this.elementsToRender,(s,n)=>(this._processRenderingRequest(s),this.elementsToRender.delete(n),r=!0,e.madeProgress(),e.done)),r&&w(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&Ott.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(e,t){const i=e.key;this.elementsToAddOrUpdate.has(i)||this.elementsToAddOrUpdate.set(i,{textId:i,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:e,rendered:!1}),this._addStageObject(i,t),this.elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,t){const i=e.key;this.elementsToRemove.set(i,this.elements.get(i)),this._removeStageObject(i,t)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this.elements.size===0)return;const e=[];this.elements.forEach((i,r)=>e.push({element:i,key:r}));let t=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){t=!1;break}if(!t||this.elementsToRemove.size){e.sort((i,r)=>i.key.localeCompare(r.key)),this.elements.clear();for(const{element:i,key:r}of e)this.elements.set(r,i);this._repack(),this.setDirty()}}get test(){const{elements:e,stageObjects:t,elementsToRemove:i,atlas:r}=this,s=this;return{elements:e,stageObjects:t,elementsToRemove:i,atlas:r,_resizeAtlas:(n,o)=>s._resizeAtlas(n,o),run:(n,o)=>s.runTask(n,o)}}};u([f({constructOnly:!0})],tM.prototype,"view",void 0),u([f({type:Boolean})],tM.prototype,"updating",void 0),tM=u([B("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],tM);const RO=2,wle=2;var X2;(function(e){e[e.OK=0]="OK",e[e.REPACK=1]="REPACK"})(X2||(X2={}));const xle=Ie.getLogger("esri.views.3d.layers.graphics.Labeler");let cw=class extends ze{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new xi,this._handles.add([xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(It.LABELER,this)]),this._textTextureAtlas=new tM({view:this.view}),this._hudMaterialCollection=new ble(this.view._stage),this._calloutMaterialCollection=new ble(this.view._stage)}dispose(){this._handles=Tt(this._handles),this._textTextureAtlas=ht(this._textTextureAtlas),this._hudMaterialCollection=ht(this._hudMaterialCollection),this._calloutMaterialCollection=ht(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(e){e.labels.forEach((t,i)=>{this._labels.set(i,t),t.graphics3DGraphic.setVisibilityFlag(ku.USER_SETTING,!0,Po.LABEL)}),e.active=!0}_deactivateLabelingContext(e){e.labels.forEach((t,i)=>{t.graphics3DGraphic.setVisibilityFlag(ku.USER_SETTING,!1,Po.LABEL),this.setLabelGraphicVisibility(t.graphics3DGraphic,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];w(i)&&this._textTextureAtlas.addTextTexture(i,t.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const t of e.graphics3DGraphic.labelGraphics){if(!t._labelClass)continue;const i=e.textTextureResources.textRenderers[t._labelIndex];w(i)&&this._textTextureAtlas.removeTextTexture(i,t.stageObject)}e.rendered=!1}get running(){var e;return this.view.ready&&(this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.running)}runTask(e){this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e)}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const t of this._labelingContexts)if(Alt(t)){if(!Tle(t)){if(Olt(t)){this._deactivateLabelingContext(t);continue}if(this._createLabelClassContext(t),c9(t)){this._dirty=!0;continue}if(!Tle(t))continue}On(t.labelsToInitialize,(i,r)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(r,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textTextureResources.initialized||!i.visible&&i.hasGraphics3DResources)&&(t.labelsToInitialize.delete(r),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(t=>this._removeLabelTextureFromAtlas(t)),this._labelsToAdd.forEach(t=>this._addLabelTextureToAtlas(t)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){const t=e.labelClassAbortController.signal;await e.layer.when(),Ui(t),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,r=i.layer,s=r.labelingInfo&&r.labelingInfo.filter(a=>!!a.symbol);if(!s||s.length===0)return;const n=new Array(s.length);let o=!1;await xU(s,async(a,l)=>{const c=a.symbol,h=GJ(i.getOrCreateGraphics3DSymbol(c));if(N(h))return void xle.error("Failed to create Graphics3DSymbol for label");await h.load(),Ui(t);let p=null;fX(c)&&c.hasVisibleCallout()&&(p=stt(c,i.symbolCreationContext),await p.load(),Ui(t));const m=await Xp(Txe(a,e.layer.fieldsIndex,this.view.spatialReference));if(Ui(t),m.ok===!0){const g=await this._createTextRenderParameters(h.symbol);Ui(t),n[l]={labelClass:a,labelFunction:m.value,graphics3DSymbol:h,graphics3DCalloutSymbolLayer:p,calloutSymbolLayerIndex:0,textRenderParameters:g}}else xle.error(`Label expression failed to evaluate: ${m.error}`),o=!0}),Ui(t),o||(e.labelClassContexts=n)}async _createLabelClassContext(e){return e.labelClassPromise||(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(t=>{if(Cs(t))throw t;e.labelClassContexts=null}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const t=e.symbolLayers.getItemAt(0);return t&&t.type==="text"?Xz.fromSymbol(t,this.view.state.pixelRatio):null}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced,i.graphics3DSymbol=null;const t=e.labelClassAbortController;e.labelClassAbortController=new AbortController,t&&t.abort(),e.labelClassContexts=[],e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,t,i,r,s){const n={text:e.text,centerOffset:i.centerOffset,translation:i.translation,elevationOffset:i.elevationOffset,screenOffset:i.screenOffset,centerOffsetUnits:i.centerOffsetUnits,horizontalPlacement:$ae(i.anchor),verticalPlacement:Ert(i.anchor),verticalOffset:i.verticalOffset,debugDrawLabelBorder:ur.LABELS_SHOW_BORDER,displayWidth:e.displayWidth,displayHeight:e.displayHeight};return i_.graphic=t,i_.renderingInfo=null,i_.layer=r,s.createLabel(i_,n,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,t,i,r,s){const n={symbol:t,translation:r.translation,elevationOffset:r.elevationOffset,screenOffset:r.screenOffset,centerOffset:r.centerOffset,centerOffsetUnits:r.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return i_.graphic=e,i_.renderingInfo=n,i_.layer=s,i.createGraphics3DGraphic(i_)}_ensureGraphics3DResources(e){if(e.hasGraphics3DResources)return!1;const t=e.graphics3DGraphic;if(t.destroyed)return!1;this._ensureTextTextureResources(e);const{textTextureResources:i}=e,r=e.labelingContext,s=r.labelClassContexts;if(!s||s.length===0||!r.emptySymbolLabelSupported&&t.graphics.length===0)return!1;let n=!1;const o=t.graphic,a=r.layer,l=gj(r.layer),c=this.view._stage;for(let h=0;h<s.length;h++){const p=i.textRenderers[h],m=i.labelPlacements[h];if(N(p)||N(m))continue;const g=s[h],v=g.graphics3DSymbol,b=v.symbol&&v.symbol.type==="label-3d"?v.symbol:null,S=v.symbolLayers[0];if(!S)continue;S.setElevationInfoOverride(r.elevationInfoOverride);const T=this._createTextSymbolGraphic(p,o,m,a,S);if(!T)return!1;T._labelClass=g.labelClass,T._labelIndex=h,t.addLabelGraphic(T,c,r.stageLayer),t.setVisibilityFlag(ku.USER_SETTING,l,Po.LABEL),t.clearVisibilityFlag(ku.SCALE_RANGE,Po.LABEL),t.setVisibilityFlag(ku.DECONFLICTION,!1,Po.LABEL),n=!0;const O=g.graphics3DCalloutSymbolLayer;if(O&&m.hasLabelVerticalOffset){O.setElevationInfoOverride(r.elevationInfoOverride);const C=this._createLineCalloutGraphic(o,b,O,m,a);w(C)&&(g.calloutSymbolLayerIndex=t.labelGraphics.length,t.addLabelGraphic(C,c,r.stageLayer))}break}return r.scaleVisibility&&n&&r.scaleVisibility.updateGraphicLabelScaleVisibility(t),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const t=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelGraphics){if(i._labelClass==null)continue;const r=t[i._labelIndex].graphics3DSymbol.symbolLayers[0];r!=null&&r.onRemoveGraphic(i)}e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){const{textTextureResources:t}=e;if(t.initialized)return;const i=e.labelingContext,r=i.labelClassContexts;if(!r||r.length===0)return;const s=e.graphics3DGraphic.graphic;for(let n=0;n<r.length;n++){const o=r[n];if(t.textRenderers[n]=null,t.labelPlacements[n]=null,!o.textRenderParameters)continue;const a=o.labelFunction;let l;if(a.type==="arcade")try{const T=a.needsHydrationToEvaluate()?oet(s,i.layer):s;l=a.evaluate(T)}catch{l=null}else l=a.evaluate(s);if(N(l)||l===""||/^\s+$/.test(l))continue;const c=o.graphics3DSymbol,h=c.symbol&&c.symbol.type==="label-3d"?c.symbol:null;if(!c.symbolLayers[0])continue;const p=e.graphics3DGraphic,m=o.labelClass,g=i.disablePlacement,v=flt({graphics3DGraphic:p,labelSymbol:h,labelClass:m,disablePlacement:g});if(N(v))continue;const b=$ae(v.anchor),S=UTe(b);t.textRenderers[n]=new FTe(l,S,o.textRenderParameters),t.labelPlacements[n]=v}t.initialized=!0}_destroyTextTextureResources(e){const{textTextureResources:t}=e;t.initialized=!1,t.textRenderers=[],t.labelPlacements=[]}_addGraphic(e,t){const i={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:e,graphics3DGraphic:t,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},r=t.graphic.uid;e.labels.set(r,i),e.labelsToInitialize.set(r,i),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,t){const i=t.graphic.uid,r=e.labels.get(i);r&&(this._destroyGraphic(r,i),e.labels.delete(i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,t){this._labels.has(t)&&(this._labels.delete(t),this._labelsToAdd.delete(t),this._labelsToRemove.delete(t)),e.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,t){if(!t)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of t){const r=e.labels.get(i);r&&(this._removeGraphic(e,r.graphics3DGraphic),this._addGraphic(e,r.graphics3DGraphic))}}_globalPropertyChanged(e,t){for(const i of t.labelClassContexts){const r=new Map;t.labels.forEach(n=>{const o=n.graphics3DGraphic;r.set(o.graphic.uid,o)});const s=n=>n.labelGraphics[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,r,s),i.graphics3DCalloutSymbolLayer){const n=o=>o.labelGraphics[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,r,n)}}}_visibilityInfoChange(e){const t=e.layer.labelsVisible;t&&!e.active&&this._activateLabelingContext(e),!t&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.labels.forEach((t,i)=>{this._destroyGraphic(t,i),t.visible=!1,t.rendered=!1,e.labelsToInitialize.set(i,t)}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const t of this._labelingContexts)if(t.graphics3DCore===e)return t;return null}addGraphicsOwner(e,t,i){const r=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,n=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const o=e.layer,a={graphics3DCore:e,layer:o,scaleVisibility:t,emptySymbolLabelSupported:r,elevationInfoOverride:s,disablePlacement:n,active:o.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new Wxe({isPickable:!0},o.uid)};return this.view._stage.add(a.stageLayer),this._labelingContexts.push(a),this.setDirty(),{addGraphic:l=>this._addGraphic(a,l),removeGraphic:l=>this._removeGraphic(a,l),featureReductionChange:()=>{},layerLabelsEnabled:()=>gj(a.layer),labelingInfoChange:l=>this._labelingInfoChange(a,l),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",a),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",a),visibilityInfoChange:()=>this._visibilityInfoChange(a),reset:()=>this._resetLabels(a),clear:()=>{}}}removeGraphicsOwner(e){const t=this._findLabelingContext(e);if(!t)return;const i=this._labelingContexts.indexOf(t);this._labelingContexts.splice(i,1),t.labels.forEach(r=>this._removeGraphic(t,r.graphics3DGraphic)),this.view._stage.remove(t.stageLayer),t.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(e,t){const i=e.graphic.uid,r=this._labels.get(i);r&&r.visible!==t&&(t&&!r.rendered?(this._labelsToAdd.set(i,r),this._labelsToRemove.delete(i),r.textTextureResources.initialized||r.labelingContext.labelsToInitialize.set(i,r)):!t&&r.rendered&&(this._labelsToRemove.set(i,r),this._labelsToAdd.delete(i)),r.visible=t,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(t=>c9(t))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((t,i)=>t+(c9(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function Alt(e){return e.active&&gj(e.layer)}function c9(e){return e.labelClassPromise&&!!e.labelClassAbortController}function Tle(e){return e.labelClassContexts&&e.labelClassContexts.length}function Olt(e){return e.labelClassContexts===null}u([f({constructOnly:!0})],cw.prototype,"view",void 0),u([f({constructOnly:!0})],cw.prototype,"deconflictor",void 0),u([f()],cw.prototype,"_textTextureAtlas",void 0),u([f({type:Boolean,readOnly:!0})],cw.prototype,"updating",null),cw=u([B("esri.views.3d.layers.graphics.Labeler")],cw);const i_=new ott(null,null,null);class Rlt{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new xi}loadGLTF(t,i,r){const s=r?`gltfPBR:${t}`:`gltf:${t}`;return this._fromCache(this.gltfCache,s,n=>cSe(new aSe(n.streamDataRequester),t,n,r),i)}loadWOSR(t,i){const r=`wosr:${t}:${i.disableTextures}`;return this._fromCache(this.wosrCache,r,s=>uSe(t,s),i)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(t,i,r,s){return new Promise((n,o)=>{if(An(s))return void o($i());const a=Ma(s,()=>{this._remove(t,i),o($i())}),l=t.get(i);if(l)return this.evictHandles.remove(i),l.refCount++,void l.item.then(n,o);const c=new AbortController,h={...s,signal:c.signal},p={refCount:1,abortController:c,item:r(h).then(m=>(p.abortController=null,m.remove=()=>this._remove(t,i),m))};t.set(i,p),p.item.then(m=>{w(a)&&a.remove(),n(m)},m=>{w(a)&&a.remove(),o(m)})})}_remove(t,i){const r=t.get(i);r&&(r.refCount--,r.refCount===0&&this.evictHandles.add(iCe(()=>{t.delete(i),w(r.abortController)&&r.abortController.abort()},Plt),i))}}const Mlt=1e4;let Plt=Mlt;class Ep{constructor(t,i,r,s=null){this.lij=[0,0,0],this.extent=ei(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Ta.VISIBLE_ON_SURFACE,screenRect:ei(),distance:0,shouldSplit:!1},this.used=!1,s&&this.acquire(t,i,r,s)}acquire(t,i,r,s){this.tilingScheme=s,this.id=Ep.id(t,i,r),this.lij[0]=t,this.lij[1]=i,this.lij[2]=r,s.getExtent(t,i,r,this.extent),this.resolution=s.resolutionAtLevel(t)}release(){this.tilingScheme=null}getChildren(t){const i=this.lij[0]+1,r=2*this.lij[1],s=2*this.lij[2];return t?(t[0].acquire(i,r,s,this.tilingScheme),t[1].acquire(i,r+1,s,this.tilingScheme),t[2].acquire(i,r,s+1,this.tilingScheme),t[3].acquire(i,r+1,s+1,this.tilingScheme),t):[new Ep(i,r,s,this.tilingScheme),new Ep(i,r+1,s,this.tilingScheme),new Ep(i,r,s+1,this.tilingScheme),new Ep(i,r+1,s+1,this.tilingScheme)]}copyMeasurementsFrom(t){this.measures.visibility=t.measures.visibility,this.measures.shouldSplit=t.measures.shouldSplit,this.measures.distance=t.measures.distance,Gy(t.measures.screenRect,this.measures.screenRect)}static id(t,i,r){return`${t}/${i}/${r}`}}var Ta;(function(e){e[e.INVISIBLE=0]="INVISIBLE",e[e.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",e[e.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Ta||(Ta={}));class dv{constructor(t){this.renderCoordsHelper=t,this.frustum=o3(),this._points=Pbe(),this.lines=new Array(12),this._origin=F(),this._direction=F(),this._altitude=null;for(let i=0;i<12;i++)this.lines[i]={origin:null,direction:F(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(t){Ibe(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),ve(this._origin,t.eye),ve(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let i=0;i<this._points.length;i++)ve(this._points[i],t[i]);Lbe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return Pv(this.frustum,t)}intersectsRay(t){return jXe(this.frustum,t)}intersectsLineSegment(t,i){return HXe(this.frustum,t,i)}intersectsPoint(t){return $be(this.frustum,t)}_updateLines(){const t=this._points;for(let i=0;i<4;i++){const r=i+4;u9(this.lines[i],t[i],t[r]),u9(this.lines[i+4],t[i],i===3?t[0]:t[i+1]),u9(this.lines[i+8],t[r],i===3?t[4]:t[r+1])}}}function u9(e,t,i){e.origin=t,e.endpoint=i,t0(e.direction,t,i)}dv.planePointIndices=WXe,dv.nearFarLineIndices=[[ft.NEAR_BOTTOM_LEFT,ft.FAR_BOTTOM_LEFT],[ft.NEAR_BOTTOM_RIGHT,ft.FAR_BOTTOM_RIGHT],[ft.NEAR_TOP_RIGHT,ft.FAR_TOP_RIGHT],[ft.NEAR_TOP_LEFT,ft.FAR_TOP_LEFT]];const CSe=.5*Math.PI,Ilt=CSe/Math.PI*180;class Llt{constructor(t){this.renderCoordsHelper=t.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:F(),direction:F()};for(let i=0;i<4;i++)this.extent[i]={origin:F(),direction:F(),cap:{next:null,direction:F()}},this.planes[i]=Vi();this.planes[Ar.NEAR]=Vi(),this.planes[Ar.FAR]=Vi(),this.planesWithoutFar=this.planes.slice(0,5)}update(t,i,r,s=!0){const n=this.extent;this._toRenderBoundingExtent(t,i,r),Oe(this.center.origin,n[0].origin,n[2].origin),be(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),s||be(this.center.direction,this.center.direction,-1);for(let o=0;o<4;o++){const a=n[o];this.renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=n[o===3?0:o+1];a.cap.next=l.origin,t0(a.cap.direction,a.origin,l.origin),EP(a.direction,a.cap.direction,a.origin,this.planes[o]),s||be(a.direction,a.direction,-1)}EP(n[0].cap.direction,n[1].cap.direction,n[0].origin,this.planes[Ar.NEAR]),s?pj(this.planes[Ar.NEAR],this.planes[Ar.FAR]):(dU(this.planes[Ar.FAR],this.planes[Ar.NEAR]),pj(this.planes[Ar.NEAR],this.planes[Ar.NEAR])),this.maxSpan=Math.max(Math.abs(t[0]-t[2]),Math.abs(t[1]-t[3])),this.maxSpanSpatialReference=i,this.minGlobalAltitude=.9*ji(this.maxSpanSpatialReference).radius}isVisibleInFrustum(t,i,r=!1){if(t==null)return!1;if(this.renderCoordsHelper.viewingMode===st.Global){const n=this.maxSpanSpatialReference.isGeographic?Ilt:CSe*i;if(this.maxSpan>n)return!0;if(t.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(t)}if(this.maxSpan===0){const n=this.extent[0];return!(r||!t.intersectsRay(sh(n.origin,n.direction)))}for(let n=0;n<this.extent.length;n++){const o=this.extent[n];if(!r&&t.intersectsRay(sh(o.origin,o.direction))||t.intersectsLineSegment(hx(o.origin,o.cap.next,Dlt),o.cap.direction))return!0}const s=r?this.planes:this.planesWithoutFar;for(let n=0;n<t.lines.length;n++){const o=t.lines[n];if(wZe(s,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(t,i,r){XZ(t,Vd),Vd[2]=r,rh(i,Vd,h9,this.renderCoordsHelper.spatialReference),Fs(Sle,h9),Fr(lc);for(const{x0:n,x1:o,y0:a,y1:l}of $lt)for(let c=0;c<5;c++){const h=c/4;Vd[0]=fi(t[n],t[o],h),Vd[1]=fi(t[a],t[l],h),Vd[2]=r,$n(Vd,i,Vd,this.renderCoordsHelper.spatialReference),et(Vd,Vd,Sle),Rm(lc,Vd)}fe(this.extent[0].origin,lc[0],lc[1],lc[2]),fe(this.extent[1].origin,lc[3],lc[1],lc[2]),fe(this.extent[2].origin,lc[3],lc[4],lc[2]),fe(this.extent[3].origin,lc[0],lc[4],lc[2]);for(let n=0;n<4;++n)et(this.extent[n].origin,this.extent[n].origin,h9)}_toRenderBoundingExtentLocal(t,i,r){aU(t,i,Sg,this.renderCoordsHelper.spatialReference),fe(this.extent[0].origin,Sg[0],Sg[1],r),fe(this.extent[1].origin,Sg[2],Sg[1],r),fe(this.extent[2].origin,Sg[2],Sg[3],r),fe(this.extent[3].origin,Sg[0],Sg[3],r)}_toRenderBoundingExtent(t,i,r){switch(this.renderCoordsHelper.viewingMode){case st.Global:this._toRenderBoundingExtentGlobal(t,i,r);break;case st.Local:this._toRenderBoundingExtentLocal(t,i,r);break;default:this.renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(t){if(Or(t.planes[Ar.NEAR],this.center.origin)<0&&ke(this.center.direction,t.direction)<0)return!0;for(let i=0;i<4;i++){const r=this.extent[i];if(Or(t.planes[Ar.NEAR],r.origin)<0&&ke(r.direction,t.direction)<0)return!0}return!1}}const $lt=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Vd=F(),h9=Be(),Sle=Be(),lc=dn(),Sg=ei(),Dlt=Gm();class Nlt{constructor(t){this.renderCoordsHelper=t,this.surfaceElevation=0,this.cache=new Map,this.frustum=new dv(t),this.extendedFrustum=new dv(t),this.intersector=new Llt({renderCoordsHelper:t}),this.renderCoordsHelper=t}begin(t,i){this.surfaceElevation=i,this.aboveGround=this.renderCoordsHelper.getAltitude(t.eye)>i,this.frustum.update(t),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(t)}end(){this.cache.clear()}calculate(t){if(this.allTilesInvisible)return Ta.INVISIBLE;const i=this.renderCoordsHelper.viewingMode===st.Global&&t.lij[0]>=Flt&&t.lij[0]<klt,r=this._getOrCalculateSingleTileVisibility(t,!i);return r!==Ta.INVISIBLE&&i?this._calculateAggregatedChildrenVisibility(t):r}_shortenFrustumFarPlane(t){const i=dv.nearFarLineIndices,r=t.mutablePoints;for(const s of i){const[n,o]=s,a=r[n],l=r[o];Me(ou,l,a),be(ou,ou,zlt),Oe(r[o],a,ou)}t.updatePoints(r)}_calculateAggregatedChildrenVisibility(t){let i=Ta.INVISIBLE;const r=this.cache.get(t.id);if(r!=null)return r;const s=Ole.acquire();t.getChildren(s);for(const n of s){const o=this.calculate(n);if(o!==Ta.INVISIBLE&&(i=o,o===Ta.VISIBLE_ON_SURFACE))break}return Ole.release(s),this.cache.set(t.id,i),i}_getOrCalculateSingleTileVisibility(t,i){const r=this.cache.get(t.id);if(r!=null)return r;const s=this._calculateSingleTileVisibility(t);return i&&this.cache.set(t.id,s),s}_calculateSingleTileVisibility(t){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===st.Global&&t.lij[0]<Ult?this._calculateSingleTileVisibilitySided(t,!1)===Ta.INVISIBLE?this._calculateSingleTileVisibilitySided(t,!0):void 0:this._calculateSingleTileVisibilitySided(t,this.aboveGround)}_calculateSingleTileVisibilitySided(t,i){this.intersector.update(t.extent,t.tilingScheme.spatialReference,this.surfaceElevation,i);const r=ji(t.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,r)?this.intersector.isVisibleInFrustum(this.frustum,r,!0)?Ta.VISIBLE_ON_SURFACE:Ta.VISIBLE_WHEN_EXTENDED:Ta.INVISIBLE}_updateExtendedFrustum(t){this.extendedFrustum.update(t),this._shortenFrustumFarPlane(this.extendedFrustum);const i=this.renderCoordsHelper.worldUpAtPosition(t.eye,ou);this.aboveGround||Ra(i,i);const r=Fn(-ke(i,t.viewForward));if(this.allTilesInvisible=r>(Math.PI+t.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=r>t.fovY/2,!this.hasExtendedFrustum))return;const s=this._extendedFrustumParameters(),n=this.extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=s.pointIndices[o],l=n[a],c=this.renderCoordsHelper.getAltitude(l);if(s.needsAltitudeAdjustment(c)){switch(this.renderCoordsHelper.worldUpAtPosition(l,ou),a){case ft.FAR_BOTTOM_LEFT:case ft.FAR_TOP_LEFT:case ft.NEAR_BOTTOM_LEFT:case ft.NEAR_TOP_LEFT:fj(this.extendedFrustum.planes[Ar.LEFT],ou,ou);break;case ft.FAR_BOTTOM_RIGHT:case ft.FAR_TOP_RIGHT:case ft.NEAR_BOTTOM_RIGHT:case ft.NEAR_TOP_RIGHT:fj(this.extendedFrustum.planes[Ar.RIGHT],ou,ou)}be(ou,ou,s.direction),this.renderCoordsHelper.intersectInfiniteManifold(sh(l,ou),s.zWithMargin,l)}}if(this.extendedFrustum.updatePoints(n),Ea(n[ft.NEAR_BOTTOM_LEFT],n[ft.NEAR_BOTTOM_RIGHT],n[ft.NEAR_TOP_RIGHT],Cle),Ea(n[ft.NEAR_BOTTOM_RIGHT],n[ft.NEAR_TOP_RIGHT],n[ft.NEAR_TOP_LEFT],Ale),ke(Cle,Ale)<0){const o=this.extendedFrustum.mutablePoints;this.aboveGround?[o[ft.NEAR_BOTTOM_LEFT],o[ft.NEAR_BOTTOM_RIGHT]]=[o[ft.NEAR_BOTTOM_RIGHT],o[ft.NEAR_BOTTOM_LEFT]]:[o[ft.NEAR_TOP_LEFT],o[ft.NEAR_TOP_RIGHT]]=[o[ft.NEAR_TOP_RIGHT],o[ft.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const t=this.surfaceElevation-Ele;return{zWithMargin:t,pointIndices:dv.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:i=>i>t}}_extendedFrustumParametersBelowSurface(){const t=this.surfaceElevation+Ele;return{zWithMargin:t,pointIndices:dv.planePointIndices.top,direction:1,needsAltitudeAdjustment:i=>i<t}}}const Flt=2,klt=6,Ult=12,zlt=.95,Ele=1,ou=F(),Cle=Vi(),Ale=Vi(),Ole=new qs(Array,e=>{e.length!==4&&(e[0]=new Ep,e[1]=new Ep,e[2]=new Ep,e[3]=new Ep)},e=>{e[0].release(),e[1].release(),e[2].release(),e[3].release()});class Blt{constructor(t){this.camera=new wr,this.focusOnMap=[0,0],this.screenRect=ei(),this.tileSize=t.tileSize,this.renderCoordsHelper=t.renderCoordsHelper,this.tilingScheme=t.tilingScheme,this.visibility=new Nlt(t.renderCoordsHelper)}begin(t,i,r){this.camera.copyFrom(t),this.surfaceElevation=r,this.focusOnMap[0]=i.x,this.focusOnMap[1]=i.y,ZZ(0,0,t.fullWidth,t.fullHeight,this.screenRect),this.visibility.begin(this.camera,r)}end(){this.visibility.end()}updateTile(t){t.measures.visibility=this.visibility.calculate(t),t.measures.distance=jMe(t.extent,this.focusOnMap),t.measures.visibility!==Ta.INVISIBLE&&this._updateScreenMeasure(t)}_updateScreenMeasure(t){const i=Vlt,r=1<<i,s=t.measures.screenRect;th(s);let n=0;const o=t.lij[0]+i,a=t.lij[1]<<i,l=t.lij[2]<<i,c=this._tileSizeWithBias(t),h=c*c;for(let p=0;p<r;p++)for(let m=0;m<r;m++)if(n+=this._computeScreenArea(t,o,a+p,l+m,s),n>h)return void(t.measures.shouldSplit=!0);t.measures.shouldSplit=!1}_tileSizeWithBias(t){return t.measures.visibility===Ta.VISIBLE_WHEN_EXTENDED?this.tileSize*Glt:this.tileSize}_computeScreenArea(t,i,r,s,n){const o=t.measures.visibility===Ta.VISIBLE_WHEN_EXTENDED;this._projectToScreen(i,r,s,o,r_),th(d9);for(let a=0;a<4;a++)rE(d9,r_[a]);return nx(n,d9,n),ane(r_[0],r_[1],r_[2])+ane(r_[0],r_[2],r_[3])}_projectToScreen(t,i,r,s,n){this.tilingScheme.ensureMaxLod(t),this.tilingScheme.getExtent(t,i,r,MO),this._toRenderCoords(MO,0,3,s_[0]),this._toRenderCoords(MO,2,3,s_[1]),this._toRenderCoords(MO,2,1,s_[2]),this._toRenderCoords(MO,0,1,s_[3]),s&&(this._projectToPlane(s_,this.camera.frustum[Ar.NEAR]),this._projectToPlane(s_,this.camera.frustum[Ar.TOP]),this._projectToPlane(s_,this.camera.frustum[Ar.BOTTOM]));for(let o=0;o<4;o++)this.camera.projectToRenderScreen(s_[o],Rle),this.camera.renderToScreen(Rle,n[o])}_projectToPlane(t,i){for(let s=0;s<4;s++)IO[s]=Or(i,t[s]);const r=Math.max(IO[0],IO[1],IO[2],IO[3]);if(r>0){const s=be(PO,i,-r);for(let n=0;n<4;n++)Oe(t[n],t[n],s)}}_toRenderCoords(t,i,r,s){return PO[0]=t[i],PO[1]=t[r],PO[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(PO,this.tilingScheme.spatialReference,s),s}}const d9=ei(),Vlt=2,Glt=5,r_=[ys(),ys(),ys(),ys()],MO=ei(),PO=F(),s_=[F(),F(),F(),F()],IO=[0,0,0,0],Rle=sa();function rwt(e,t,i){if(N(e)||N(i))return!1;let r=!0;return Tn[0]=e.xmin!=null?e.xmin:0,Tn[1]=e.ymin!=null?e.ymin:0,Tn[2]=e.zmin!=null?e.zmin:0,r=r&&Lr(Tn,e.spatialReference,0,t,i,0,1),Tn[0]=e.xmax!=null?e.xmax:0,Tn[1]=e.ymax!=null?e.ymax:0,Tn[2]=e.zmax!=null?e.zmax:0,r=r&&Lr(Tn,e.spatialReference,0,t,i,3,1),e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.zmin==null&&(t[2]=-1/0),e.xmax==null&&(t[3]=1/0),e.ymax==null&&(t[4]=1/0),e.zmax==null&&(t[5]=1/0),r}function ASe(e,t,i){if(N(e)||N(i))return!1;let r=!0;return Tn[0]=e.xmin!=null?e.xmin:0,Tn[1]=e.ymin!=null?e.ymin:0,Tn[2]=e.zmin!=null?e.zmin:0,r=r&&Lr(Tn,e.spatialReference,0,Tn,i,0,1),t[0]=Tn[0],t[1]=Tn[1],Tn[0]=e.xmax!=null?e.xmax:0,Tn[1]=e.ymax!=null?e.ymax:0,Tn[2]=e.zmax!=null?e.zmax:0,r=r&&Lr(Tn,e.spatialReference,0,Tn,i,0,1),t[2]=Tn[0],t[3]=Tn[1],e.xmin==null&&(t[0]=-1/0),e.ymin==null&&(t[1]=-1/0),e.xmax==null&&(t[2]=1/0),e.ymax==null&&(t[3]=1/0),r}const Tn=F(),jlt=Ie.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let Co=class extends ze{constructor(e){super(e),this.tiles=new zt,this.tileSize=512,this._idToTile=new Map,this._handles=new xi,this._clients=new Set,this._dirty=!1,this._newTiles=new hi}get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(w(e)&&!e.spatialReference.equals(this.viewState.spatialReference))return void jlt.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const t=this._get("filterExtent");if(t===e||w(t)&&e&&t.equals(e))return;const i=w(e)?e.clone():null;this._set("filterExtent",i),this._setDirty()}get filterExtentRect(){if(N(this.filterExtent)||!this.tilingScheme)return null;const e=ei();return ASe(this.filterExtent,e,this.tilingScheme.spatialReference),e}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([xe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),Rr),xe(()=>{var e,t,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(t=this.viewState)==null?void 0:t.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),an)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(It.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=Ln(this._frameWorker),this._handles=Tt(this._handles)}addClient(){const e=qlt();return this._clients.add(e),this._clients.size===1&&this._setDirty(),{remove:()=>this._removeClient(e)}}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(iA))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),w(this._frameWorker)&&(this._frameWorker.priority=It.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),!this._pendingTiles&&w(this._frameWorker)&&(this._frameWorker.priority=It.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new Blt({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(e=>new Ep(e[0],e[1],e[2],this.tilingScheme))}_purgeHorizonTiles(e){e.sort((t,i)=>{const r=t.measures.screenRect,s=i.measures.screenRect;return r[1]+r[3]-(s[1]+s[3])}),th(gD);for(let t=0;t<e.length;t++)if(nx(gD,e.data[t].measures.screenRect,gD),Wp(gD)>Wlt)return e.data.slice(t,e.length);return[]}_subdivideTilesForView(e){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!e.done;){const t=this._pendingTiles.pop();e.madeProgress(),this.filterExtentRect&&!H3(this.filterExtentRect,t.extent)||(this._tileMeasurements.updateTile(t),t.measures.visibility!==Ta.INVISIBLE&&(t.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(t.lij[0]+1),this._pendingTiles.push(...t.getChildren())):this._newTiles.push(t)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(e){for(const r of this.tiles.items)r.used=!1;const t=e.filter(r=>{const s=this._idToTile.get(r.id);return s?(s.copyMeasurementsFrom(r),s.used=!0):this._idToTile.set(r.id,r),!s}),i=this.tiles.items.filter(r=>!r.used&&(this._idToTile.delete(r.id),!0));this.tiles.removeMany(i),this.tiles.addMany(t),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,t)=>e.measures.visibility!==t.measures.visibility?e.measures.visibility===Ta.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-t.measures.distance),this.tiles.forEach((e,t)=>e.loadPriority=t)}};u([f({constructOnly:!0})],Co.prototype,"scheduler",void 0),u([f({constructOnly:!0})],Co.prototype,"renderCoordsHelper",void 0),u([f({constructOnly:!0})],Co.prototype,"tilingSchemeOwner",void 0),u([f({constructOnly:!0})],Co.prototype,"cameraOnSurface",void 0),u([f({constructOnly:!0})],Co.prototype,"focus",void 0),u([f({constructOnly:!0})],Co.prototype,"viewState",void 0),u([f({constructOnly:!0})],Co.prototype,"terrain",void 0),u([f()],Co.prototype,"tiles",void 0),u([f()],Co.prototype,"tileSize",void 0),u([f({readOnly:!0})],Co.prototype,"tilingScheme",null),u([f()],Co.prototype,"filterExtent",null),u([f({readOnly:!0})],Co.prototype,"filterExtentRect",null),u([f({readOnly:!0})],Co.prototype,"rootTileIds",null),u([f({value:!1})],Co.prototype,"suspended",null),u([f({readOnly:!0})],Co.prototype,"updating",null),Co=u([B("esri.views.3d.layers.support.FeatureTileTree3D")],Co);let Hlt=0;function qlt(){return Hlt++}const gD=ei(),Wlt=10;let Eo=class extends ze{constructor(){super(...arguments),this._propertiesPool=new Wy({camera:wr},this),this._lastSeenCameraProjectionValues=new wr,this.events=new ks,this.viewingMode=st.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(e,t){this._set("viewingMode",e),this._set("spatialReference",t),this._set("constraints",new Zg({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new Wy({camera:wr},this)}createInitialCamera(){if(this.viewingMode===st.Global){const e=ji(this.spatialReference).radius;this.camera=new wr(Ke(4*e,0,0),Ke(e,0,0),Ke(0,0,1))}else this.camera=new wr(Ke(0,0,100),Ke(0,0,0),Ke(0,1,0))}get animation(){return this.cameraController instanceof a3&&w(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(e){e!==Sh&&Sh.copyFrom(e),Sh.computeUp(this.viewingMode),Mle.camera=Sh,this.events.emit("before-camera-change",Mle);const t=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Sh)&&(this._lastSeenCameraProjectionValues.copyFrom(Sh),Ple.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",Ple)),(!t||!t.equals(Sh))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(Sh)),this._cameraChanged=!t||!t.almostEquals(Sh),this._cameraChanged)){const i=Zhe(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return w(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(e){this._contentCamera=w(e)?e.clone():null}get fixedContentCamera(){return w(this._contentCamera)}get isGlobal(){return this.viewingMode===st.Global}get isLocal(){return this.viewingMode===st.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){this.stopActiveCameraController()?(e&&(this.own(xe(()=>e.state,t=>{t!==os.Finished&&t!==os.Stopped||(this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i)))},Rr)),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=os.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==os.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this.updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this.updateQueue.length===0||this.processingUpdates)return;this.processingUpdates=!0;const e=this.updateQueue.shift();Sh.copyFrom(this._get("camera")),e(Sh),this.camera=Sh,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,t){return e.fov!==t.fov||e.fullViewport[0]!==t.fullViewport[0]||e.fullViewport[1]!==t.fullViewport[1]||e.fullViewport[2]!==t.fullViewport[2]||e.fullViewport[3]!==t.fullViewport[3]||e.padding[Ht.TOP]!==t.padding[Ht.TOP]||e.padding[Ht.RIGHT]!==t.padding[Ht.RIGHT]||e.padding[Ht.BOTTOM]!==t.padding[Ht.BOTTOM]||e.padding[Ht.LEFT]!==t.padding[Ht.LEFT]}};u([f({readOnly:!0,type:sC})],Eo.prototype,"animation",null),u([f({type:wr})],Eo.prototype,"camera",null),u([f()],Eo.prototype,"pixelRatio",null),u([f({})],Eo.prototype,"_contentCamera",void 0),u([f({type:wr})],Eo.prototype,"contentCamera",null),u([f({readOnly:!0})],Eo.prototype,"fixedContentCamera",null),u([f({readOnly:!0})],Eo.prototype,"constraints",void 0),u([f({readOnly:!0})],Eo.prototype,"events",void 0),u([f({readOnly:!0})],Eo.prototype,"isGlobal",null),u([f({readOnly:!0})],Eo.prototype,"isLocal",null),u([f({readOnly:!0})],Eo.prototype,"viewingMode",void 0),u([f({readOnly:!0})],Eo.prototype,"spatialReference",void 0),u([f({readOnly:!0})],Eo.prototype,"navigating",null),u([f({readOnly:!0})],Eo.prototype,"stationary",null),u([f()],Eo.prototype,"_cameraChanged",void 0),u([f()],Eo.prototype,"cameraController",null),Eo=u([B("esri.views.3d.state.ViewState")],Eo);const Zlt=Eo,Sh=new wr,Mle={camera:null},Ple={camera:null};function Xlt(e,t,i){return e===st.Global?new Qlt(i):new Ylt(t,i)}class Ylt{constructor(t,i){this.elevationProvider=t,this._referenceEllipsoid=ji(i),this.unitInMeters=Zc(i,this._referenceEllipsoid.metersPerDegree)}compute(t,i,r,s,n){n||(n={near:0,far:0});let o=t[2]*this.unitInMeters;const a=o,l=o-s,c=this.elevationProvider?this.elevationProvider.elevationBounds:null;c&&(o=l>=0?a-this.unitInMeters*c.min:this.unitInMeters*c.max-a);const h={x:(r=w(r)?r:new zi({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},p=Math.max(h.x,h.y,h.z);Me(vb,i,t),wS[0]=vb[0]>0?r.xmax:r.xmin,wS[1]=vb[1]>0?r.ymax:r.ymin,wS[2]=vb[2]>0?p/2:-p/2,Me(wS,wS,t),De(vb,vb);const m=1.1*ke(wS,vb)*this.unitInMeters,g=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),v=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),b=v*ect*this.unitInMeters,S=v*tct*this.unitInMeters;let T=Xe((o-S)/(b-S),0,1);T*=T*T;let O=fi(g,m,T);return O*=Math.max(Math.log(Math.abs(l)),1),O=Math.min(O,Math.max(34064e4,p)),O/=this.unitInMeters,OSe(O,Jlt,this.unitInMeters,n)}}class Qlt{constructor(t){this._referenceEllipsoid=ji(t)}compute(t,i,r,s,n){n||(n={near:0,far:0});const o=He(t)-this._referenceEllipsoid.radius,a=this._referenceEllipsoid.radius+Math.min(0,s),l=Math.abs(o-s),c=Math.max(l,Math.abs(o));return OSe(1.2*Math.sqrt(c*(c+2*a)),Xe(2e4-(Math.log(c)-7.983)/9.011*19e3,1e3,2e4),1,n)}}function OSe(e,t,i,r){const s=Klt/i;return e/t>s?(r.far=e,r.near=r.far/t):(r.near=s,r.far=r.near*t),r}const Jlt=2e4,Klt=2,ect=.001,tct=1e-4,wS=F(),vb=F();let UF=class extends ze{constructor(e){super(e),this.handles=new xi}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const t=this.view.state.camera;bbe(this.view,t,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>{nA(this.view,e,hd.EYE_AND_CENTER)})}};u([f({constructOnly:!0})],UF.prototype,"view",void 0),UF=u([B("esri.views.3d.state.ElevationCollisionConstraint")],UF);let iM=class extends ze{constructor(e){super(e),this._handles=new xi,this.nearFarHeuristic=Xlt(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([xe(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.near,(r=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:r.far]},()=>this._clipDistanceNearFarChanged()),xe(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:t.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e.camera)),xe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),Rr),xe(()=>{var e,t,i,r;return[(t=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:t.min,(r=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:r.max]},()=>this._updateAltitude(),Rr),xe(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.max},()=>this._updateTiltMax(),Rr),xe(()=>{var e,t;return(t=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:t.mode},()=>this._updateTilt(),Rr),xe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),Rr),xe(()=>{var e,t,i,r,s,n;return[(i=(t=(e=this.view.map)==null?void 0:e.ground)==null?void 0:t.navigationConstraint)==null?void 0:i.type,(n=(s=(r=this.view.state)==null?void 0:r.constraints)==null?void 0:s.collision)==null?void 0:n.enabled]},()=>this._updateCollision(),Rr)]),this.view.state.isLocal&&this._handles.add(xe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),si)),this._updateNearFar(),this.view.state.viewingMode!==st.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new UF({view:this.view}))}destroy(){this._handles=Tt(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var t;const e=(t=this.view.constraints)==null?void 0:t.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>(this._updateCameraNearFarManual(i,e),!0))}_updateNearFar(){this.view.state.updateCamera(e=>(this._updateCameraNearFar(e),!0))}_updateCameraNearFar(e){const t=this.view.constraints&&this.view.constraints.clipDistance;(t?t.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,t):this._updateCameraNearFarAuto(e,t)}_updateCameraNearFarAuto(e,t){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,rz(this.view,e.eye),e),t&&t.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,t){t&&(e.near=t.near,e.far=t.far)}_updateCollision(){var r,s,n;const e=(n=(s=(r=this.view.map)==null?void 0:r.ground)==null?void 0:s.navigationConstraint)==null?void 0:n.type,t=!e||e==="stay-above",i=this.view.state.constraints.collision;if(t!==i.enabled){i.enabled=t,t&&this._reapplyConstraints(Vr.COLLISION);const o=this.view.constraints&&this.view.constraints.tilt;o&&o.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==st.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const t=this.view.state.constraints;t.tilt=t.createConstantMaxTilt(Jt(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const t=this.view.state.constraints;if(t.tilt){const i=t.tilt(this.view.state.camera.distance).max;e.autoUpdate(Vc(i))}}_updateLocalSurfaceDistance(e){if(N(e))return;let t=Math.max(e.width,e.height);if(t<=0)return;e.hasZ&&(t=Math.max(t,e.zmax-e.zmin));const i=this.view.state,r=3*t/Math.atan(i.camera.fov/2);r!==i.constraints.distance&&(i.constraints.distance=r)}_reapplyConstraints(e=Vr.ALL){this.view.state.updateCamera(t=>Ds(this.view,t,{selection:e,interactionType:oi.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:ho.TUMBLE}))}};u([f({constructOnly:!0})],iM.prototype,"view",void 0),u([f({readOnly:!0})],iM.prototype,"surfaceCollisionConstraint",void 0),iM=u([B("esri.views.3d.state.ConstraintsManager")],iM);let Y2=class extends Zw{constructor(e){super(e),this.handles=new xi}set desiredCamera(e){this._set("desiredCamera",e.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=os.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(e){bbe(this.view,this.desiredCamera,e.extent,e.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),nA(this.view,e,hd.EYE_AND_CENTER)||this.constraintEnabled||(this.state=os.Stopped)})}};u([f({constructOnly:!0})],Y2.prototype,"view",void 0),u([f({constructOnly:!0})],Y2.prototype,"desiredCamera",null),Y2=u([B("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],Y2);const ict=.66;function RSe(e){return 360-SZ.normalize(e)}function Yz(e){return SZ.normalize(360-e)}function yD(e){return w(e)&&e.resolver&&e.resolver.reject(),null}function rct(e,t){return w(e)&&e.resolver&&e.resolver.resolve(t),t}function MSe(e,t,i,r=null){if(!t)return yD(r);const s=e.spatialReference||wt.WGS84;if(w(t.camera)){const c=aT(t.camera.position,s);if(N(c))return yD(r);const h=t.camera.clone();return h.position=c,rct(r,h)}if(N(t.targetGeometry))return yD(r);const n=t.get("targetGeometry.spatialReference");if(n&&!Uv(n,s))return yD(r);const o=bC(e,e.state.camera);let a=aa.ADJUST;if(t.rotation!=null&&(o.heading=RSe(t.rotation),a=aa.LOCKED),i!=null&&(o.tilt=i),t.targetGeometry.type==="point"){const c=t.targetGeometry;let h;const p=t.targetGeometry.clone();return h=t.scale!=null?rJ(e,t.scale,c.latitude):e.state.camera.distance,dwe(e,p,h,o,a,r)}const l=t.targetGeometry.extent;return zM(e,l,o.heading,o.tilt,a,r)}function sct(e,t,i=null){return N(i)&&(i=new Zp),ZJ(e,null,t.clone(),i)}async function nct(e,t,i){const r=mct(e,t);if(!r)throw new se("viewpointutils-create:no-target","Missing target for creating viewpoint");const s=new jc({fov:e.camera.fov}),n=new Zp({camera:s});if(r.target instanceof Zp)return bb(await lct(e,r.target,r,i,n));if(r.target instanceof jc)return bb(ISe(e,r.target,n));const o=r.scale!=null||r.zoom!=null;if(r.target instanceof zi){const c=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax;return bb(o||c?await xW(e,r,r.target.center,s,i,n):await dct(e,r,r.target,s,i,n))}const a={boundingBox:Fr(),hasZ:!1,screenSpaceObjects:[]},l=o?oct(e,r):void 0;if(await PSe(e,r.target,l,a),isFinite(a.boundingBox[0])){let c;if(Op(a.boundingBox,$s),Ru.x=$s[0],Ru.y=$s[1],Ru.z=$s[2],Ru.spatialReference=e.spatialReference,isFinite(Ru.z)&&a.hasZ?c=qk(a.boundingBox):(Ru.z=void 0,c=HMe(JZ(a.boundingBox,yct))),o||c)return bb(await xW(e,r,Ru,s,i,n));const h=gct(e,a.screenSpaceObjects);return bb(await fct(e,r,Ru,a.boundingBox,h,s,i,n))}return r.position?bb(uct(e,r,s,n)):bb(await hct(e,r,s,i,n))}function qJ(e,t){return t.scale==null&&t.zoom!=null?mwe(e,t.zoom):t.scale}function oct(e,t){return bQe(e,qJ(e,t))}function WJ(e,t){let i=!1;return t.heading!=null?(e.heading=t.heading,i=!0):t.rotation!=null&&(e.heading=RSe(t.rotation),i=!0),t.tilt!=null&&(e.tilt=t.tilt,i=!0),t.fov!=null&&(e.fov=t.fov),i}function ZJ(e,t,i,r){const s=e.spatialReference||wt.WGS84;return t=w(t)?t:cy(e,i),N(t)||(r.targetGeometry=i1(t.center,e.renderSpatialReference,s),r.scale=gwe(e,t),r.rotation=Yz(i.heading),r.camera=i),r}function ok(e,t,i){if(!t)return;if(!Uv(t.spatialReference,e.spatialReference))throw new se("viewpointutils:incompatible-spatialreference",`Spatial reference (${t.spatialReference?t.spatialReference.wkid:"unknown"}) is incompatible with the view (${e.spatialReference.wkid})`,{geometry:t});const r=[];if(!t.hasZ&&e.basemapTerrain){let o;switch(t.type){case"point":o=t;break;case"multipoint":case"polyline":o=t.extent.center;break;case"mesh":o=t.origin;break;case"extent":o=t.center;break;case"polygon":o=t.centroid}o&&Uv(o,e.basemapTerrain.spatialReference)?$s[2]=$t(mm(e.elevationProvider,o),0):$s[2]=0}(0,_ct[t.type])(t,o=>{r.push(o[0],o[1],o[2])},$s);const s=r.length/3;if(s===0)return;const n=new Array(r.length);if(Lr(r,t.spatialReference,0,n,e.spatialReference,0,s)){t.hasZ&&(i.hasZ=!0);for(let o=0;o<n.length;o+=3)t.hasZ?($s[0]=n[o+0],$s[1]=n[o+1],$s[2]=n[o+2]):($s[0]=n[o+0],$s[1]=n[o+1]),Rm(i.boundingBox,$s)}}async function act(e,t,i,r){const s=await Xp(e.whenViewForGraphic(t));if(s.ok===!1||N(s.value)||!("whenGraphicBounds"in s.value))return void ok(e,t.geometry,r);const n=s.value,o=await Xp(n.whenGraphicBounds(t,{minDemResolution:i}));if(o.ok===!1)return void ok(e,t.geometry,r);const{screenSpaceObjects:a,boundingBox:l}=o.value;kE(r.boundingBox,l),a&&a.forEach(c=>{r.screenSpaceObjects.push(c)}),isFinite(l[2])&&(r.hasZ=!0)}async function PSe(e,t,i,r){if(Array.isArray(t)&&t.length===2){const s=t[0],n=t[1];if(typeof s=="number"&&typeof n=="number")return Ru.x=s,Ru.y=n,Ru.z=void 0,Ru.spatialReference=e.spatialReference.isGeographic?e.spatialReference:wt.WGS84,void ok(e,Ru,r)}t&&typeof t.map=="function"?await cl(t.map(s=>PSe(e,s,i,r))):t instanceof Gc?ok(e,t,r):t instanceof ul&&await act(e,t,i,r)}async function lct(e,t,i,r,s){if(w(t.camera))return ISe(e,t.camera,s);s.scale=t.scale,s.rotation=t.rotation,s.targetGeometry=w(t.targetGeometry)?t.targetGeometry.clone():null,s.camera=null,i.heading!=null?s.rotation=Yz(i.heading):i.rotation!=null&&(s.rotation=i.rotation);const n=qJ(e,i);n!=null&&(s.scale=n);const o=new lA(r);return MSe(e,s,i.tilt,o),s.camera=await o.resolver.promise,s}function ISe(e,t,i){const r=e.spatialReference,s=aT(t.position,r);return N(s)?null:((t=t.clone()).fov=e.camera.fov,t.position=s,ZJ(e,null,t,i))}function cct(e,t,i,r,s,n){const o=e.renderSpatialReference;return po(i.position,vD,o),po(t,p9,o),n.targetGeometry=new xt(t),s.position=new xt(i.position),Me(ak,p9,vD),oz(e,vD,ak,r.up,s),n.scale=Qx(e,Pr(vD,p9),n.targetGeometry.latitude),n.rotation=Yz(s.heading),n.camera=s,n}async function xW(e,t,i,r,s,n){if(N(i))throw new se("createfromcenter","invalid point");n.targetGeometry=i.clone();const o=xT(e);if(t.position)return cct(e,n.targetGeometry,t,o,r,n);if(t.zoomFactor){const l=o.distance/t.zoomFactor,c=be($s,o.viewForward,-l);o.eye=Oe($s,o.center,c),n.scale=Qx(e,l,i.latitude)}bC(e,o,r);const a=WJ(r,t)?aa.LOCKED:aa.ADJUST;if(!t.zoomFactor){n.scale=qJ(e,t),n.scale==null&&(po(i,$s,e.renderSpatialReference),$be(o.frustum,$s)?n.scale=Qx(e,Pr(o.eye,$s),i.latitude):n.scale=gwe(e,o));const l=new lA(s);hwe(e,n.targetGeometry,n.scale,r,a,l),n.camera=await l.resolver.promise}return n}function uct(e,t,i,r){const s=xT(e);return ve(ak,s.viewForward),oz(e,s.eye,ak,s.up,f9),i.position=new xt(t.position),i.heading=t.heading!=null?t.heading:f9.heading,i.tilt=t.tilt!=null?t.tilt:f9.tilt,ZJ(e,null,i,r)}async function hct(e,t,i,r,s){const n=xT(e);return xW(e,t,i1(n.center,e.renderSpatialReference,e.spatialReference),i,r,s)}async function dct(e,t,i,r,s,n){n.targetGeometry=i.clone();const o=xT(e);bC(e,o,r);const a=WJ(r,t)?aa.LOCKED:aa.ADJUST,l=new lA(s);return zM(e,i,r.heading,r.tilt,a,l),n.camera=await l.resolver.promise,n}function pct(e,t,i,r,s){let n=0;i.hasZ?n=i.z:e.basemapTerrain&&(n=mm(e.elevationProvider,i)),fe($s,i.x,i.y,n),rh(e.spatialReference,$s,Ile,e.renderSpatialReference),_d(_D,Ile),vd(_D,_D),Fr(LO);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let v=0;v<o.length;v++){const b=o[v];let S=r[b[2]];isFinite(S)||(S=n),fe($s,r[b[0]],r[b[1]],S),$n($s,e.spatialReference,$s,e.renderSpatialReference),Rm(LO,$c($s,$s,_D))}const a=hT(LO),l=v1(LO),c=dT(LO),h=1/Math.tan(t.fovX/2),p=1/Math.tan(t.fovY/2),m=.5*Math.sqrt(a*a+c*c)*Math.max(p,h)+.5*l,g=.5*l*p+.5*Math.max(a,c);return Math.max(m,g)/s}async function fct(e,t,i,r,s,n,o,a){a.targetGeometry=i.clone();const l=xT(e),c=pct(e,l,i,r,s);bC(e,l,n);const h=WJ(n,t)?aa.LOCKED:aa.ADJUST;a.scale=Qx(e,c,a.targetGeometry.latitude);const p=new lA(o);return hwe(e,a.targetGeometry,a.scale,n,h,p),a.camera=await p.resolver.promise,a}function mct(e,t){if(!t||!e.spatialReference)return null;const i={target:null};if("declaredClass"in t||Array.isArray(t))i.target=t;else{for(const r in t)i[r]=t[r];t.center&&!i.target&&(i.target=t.center)}return i}function bb(e){return e&&w(e.camera)&&(e.rotation=Yz(e.camera.heading)),e}function gct(e,t){const i=ict;if(!t.length)return i;let r=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s].screenSpaceBoundingRect;r=Math.max(r,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]))}return i-r/Math.min(e.width,e.height)*2}const $s=F(),Ile=Be(),_D=Qr(),LO=dn(),yct=ei(),ak=F(),vD=F(),p9=F(),f9={heading:0,tilt:0},Ru=new xt,_ct={point(e,t,i){i[0]=e.x,i[1]=e.y,e.hasZ&&(i[2]=e.z),t(i)},polygon(e,t,i){const r=e.hasZ;for(let s=0;s<e.rings.length;s++){const n=e.rings[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},polyline(e,t,i){const r=e.hasZ;for(let s=0;s<e.paths.length;s++){const n=e.paths[s];for(let o=0;o<n.length;o++)i[0]=n[o][0],i[1]=n[o][1],r&&(i[2]=n[o][2]),t(i)}},multipoint(e,t,i){const r=e.points,s=e.hasZ;for(let n=0;n<r.length;n++)i[0]=r[n][0],i[1]=r[n][1],s&&(i[2]=r[n][2]),t(i)},extent(e,t,i){e.hasZ?(t(fe(i,e.xmin,e.ymin,e.zmin)),t(fe(i,e.xmax,e.ymin,e.zmin)),t(fe(i,e.xmin,e.ymax,e.zmin)),t(fe(i,e.xmax,e.ymax,e.zmin)),t(fe(i,e.xmin,e.ymin,e.zmax)),t(fe(i,e.xmax,e.ymin,e.zmax)),t(fe(i,e.xmin,e.ymax,e.zmax)),t(fe(i,e.xmax,e.ymax,e.zmax))):(t(fe(i,e.xmin,e.ymin,i[2])),t(fe(i,e.xmax,e.ymin,i[2])),t(fe(i,e.xmin,e.ymax,i[2])),t(fe(i,e.xmax,e.ymax,i[2])))},mesh(e,t,i){const r=e.vertexAttributes&&e.vertexAttributes.position;if(r)for(let s=0;s<r.length;s+=3)t(fe(i,r[s+0],r[s+1],r[s+2]))}};class vct{constructor(t,i,r){this.target=t,this.options=i,this.view=r,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((s,n)=>{this.resolveCallback=s,this.rejectCallback=n;const o=new AbortController;w(this.options.signal)&&Ma(this.options.signal,()=>{this.abort()}),this.abortController=o,this.waitForReady()})}then(t,i){return this.promise.then(t,i)}catch(t){return this.promise.catch(t)}resolve(t){return this.state="finished",this.resolveCallback(t)}reject(t){return this.state="finished",this.rejectCallback(t)}abort(t=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject($i());break;case"wait-for-animation-finish":!t&&w(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject($i())}}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await xP(()=>this.view.ready,this.abortController.signal)}catch(t){return this.reject(t)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,nct(this.view,this.target,this.abortController.signal).then(t=>{if(this.state==="finished")return;const i=this._getCameraFromViewpoint(t);if(!N(i))if(this.options.animate){if(N(this.animationController))return;this.startAnimation(i,this.animationController)}else this.view.stateManager.setStateCamera(i.camera,{applyConstraints:!i.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},t=>{this.reject(t)}))}_getCameraFromViewpoint(t){const i=!!(this.target instanceof Zp&&this.target.camera||this.target instanceof jc),r=t.camera;if(N(r))return null;if(!this.view.stateManager.isCompatible(r)){const n=r.position,o=n&&n.spatialReference,a=o?o.wkid:"none",l=this.view.spatialReference.wkid;return this.reject(new se("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${a}, view: ${l})`,{camera:r})),null}const s=cy(this.view,r);return N(s)?(this.reject(new se("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:t,camera:s,isFullySpecified:i}}startAnimation(t,i){this.state="wait-for-animation-finish";const r=i.viewAnimation;if(N(r))return void this.reject(new se("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(r.update(t.viewpoint,"running"),!i.active||N(i.viewAnimation)||i.viewAnimation.target!==t.viewpoint||this.view.state.cameraController!==i)return this.abort();let s;t.isFullySpecified?(s=new Y2({view:this.view,desiredCamera:t.camera}),nA(this.view,t.camera,hd.EYE_AND_CENTER)):Ds(this.view,t.camera),i.begin(t.camera,this.options);const n=()=>{const a=this.view.state.cameraController;s&&(a&&a.active?a instanceof Ty&&w(a.viewAnimation)&&a.viewAnimation.target===t.viewpoint&&(this.view.state.cameraController=s):w(i.viewAnimation)&&i.viewAnimation.target===t.viewpoint&&i.state==="finished"&&(this.view.state.cameraController=s))},o=a=>{if(!N(this.view.state))switch(i.state){case os.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case os.Ready:case os.Rejected:case os.Running:case os.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};r.when(n,a=>o(a)),i.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let t,i=null;const r=this.view.state.cameraController;return r instanceof Ty&&(r.updateStateFromViewAnimation(),r.active&&(t=r,i=t.viewAnimation)),t!=null||(t=new Ty({view:this.view,mode:"animation"}),i=t.viewAnimation,this.view.state.switchCameraController(t))?t:(w(i)&&i.stop(),this.reject(new se("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Eh=Ie.getLogger("esri.views.3d.state.ViewStateManager");let jn=class extends ze{constructor(e){super(e),this.propertiesPool=new Wy({frustum:dv},this),this.handles=new xi,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:t=>this._devicePixelRatioOverride=t,setMaximumPixelRatio:t=>this._maximumPixelRatioOverride=t}}get camera(){const e=this._get("camera");if(!this.ready)return e;const t=bC(this.view,this.view.state.camera);return t&&e&&t.equals(e)?e:t}set camera(e){this._updatePropertyBeforeReady("camera",e)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(cy(this.view,e),{applyConstraints:!1})||Eh.error("#camera=","Invalid camera",e),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const t=bC(this.view,this.view.state.contentCamera);return t&&e&&t.equals(e)?e:t}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const t=cy(this.view,e);N(t)?this.view.state.contentCamera=null:(this._updateElevation(t),this.view.state.contentCamera=t)}installContentCameraReset(e){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const t=this.zoom,i=this.view.state.camera.distance**2,r=$l(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.handles.add([xe(()=>this.contentCamera,()=>{e.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),xe(()=>this.zoom,n=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(n-t)/2),Math.abs(n-t)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)}),xe(()=>this.view.state.camera,n=>{const o=Yn(r,n.center);this.test.contentCameraResetState.set("camera.center",o/i),o>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Eh.error("#center=","Invalid center",e):Eh.error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Eh.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,t=mQe(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return w(t)?t:this._get("extent")}set extent(e){this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||Eh.error("#extent=","Invalid extent",e):Eh.error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e):Eh.error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this.propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return Qx(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||Eh.error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,t=e.padding,i=e.pixelRatio,r=this._get("padding"),s=Math.round(t[Ht.TOP]/i),n=Math.round(t[Ht.RIGHT]/i),o=Math.round(t[Ht.BOTTOM]/i),a=Math.round(t[Ht.LEFT]/i);return r!=null&&r.top===s&&r.right===n&&r.bottom===o&&r.left===a?r:{top:s,right:n,bottom:o,left:a}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,bD),this.view.state.updateCamera(t=>t.padding=bD))}_paddingToArray(e,t,i){e?_r(i,e.top||0,e.right||0,e.bottom||0,e.left||0):_r(i,0,0,0,0);for(let r=0;r<4;r++)i[r]=Math.round(i[r]*t)}get screenCenter(){const e=this.padding;return qp((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?sct(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||Eh.error("#viewpoint=","Invalid viewpoint",e);else{const t=w(e.camera)?e.camera.position:e.targetGeometry,i=w(t)&&t.spatialReference;Eh.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(i?i.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",e)}else Eh.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?fwe(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||Eh.error("#zoom=","Invalid zoom",e)}get maximumPixelRatio(){if(w(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let e=1/0;const{maximumPixelRatio:t,maximumRenderResolution:i}=this.view.qualitySettings;if(t!=null&&(e=Math.min(e,t)),i!=null){const r=i/Math.max(this.view.width,this.view.height);e=Math.min(e,r)}return e}get _devicePixelRatio(){return N(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([Fo(()=>this.view.state.events,"before-camera-change",e=>this._updateElevation(e.camera))]),xe(()=>this.view.state.camera,e=>this._updateElevation(e),{once:!0,sync:!0}),this.handles.add(xx({prepare:()=>this._prepareFrame()})),this.handles.add(xe(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(wD)})),this.handles.add(Fo(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new iM({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const t of e)this.set(t.name,t.value);if(!this.cameraSetByUser){const t=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;t&&this.isCompatible(t)?this._setInitialView(t):this.view.state.viewingMode===st.Local&&this.handles.add(Jl(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(wD),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),wD)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(wD),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}async goTo(e,t){const i={animate:!0,...t};return w(this.gotoOperation)&&this.gotoOperation.abort(i.animate),this.gotoOperation=new vct(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this.gotoOperation}debugSetCameraOnContent(){this.setStateCamera(xT(this.view),{applyConstraints:!1})}step(e){const t=this.view.state,i=t&&this.view.state.cameraController;i&&(t.updateCamera(r=>{i.stepController(e,r)}),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){w(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const e=new Set,t=[];for(const{propertyName:i,overrides:r}of xct){const s=e.has(i),n=this._isOverridden(i);!s&&n&&t.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||n)&&r.forEach(o=>e.add(o))}return t}_setInitialView(e){if(N(e)||this.cameraSetByUser)return;if(e instanceof jc)return void this.setStateCamera(cy(this.view,e),{applyConstraints:!1});if(e instanceof Zp){if(e.targetGeometry instanceof zi){const s=zM(this.view,e.targetGeometry,0,.5,aa.LOCKED);return void(w(s)&&this.setStateCamera(cy(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},r=this._viewpointToCamera(e);return void this.setStateCamera(r,i)}const t=zM(this.view,e,0,.5,aa.LOCKED);w(t)&&this.setStateCamera(cy(this.view,t),{applyConstraints:!0})}_updatePropertyBeforeReady(e,t){return!this.ready&&(this._override(e,t),t&&wct.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return!N(e)&&(e instanceof Zp?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof jc?this.isCompatible(e.position):e.spatialReference&&Uv(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=Tct){return this.cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,t,i=n_){const{heading:r,tilt:s}=this._getPreservingHeadingTilt(),n=c3(this.view,r,s,e,t,aa.ADJUST);return N(n)?null:(i.copyFrom(this.view.state.camera),i.eye=n.eye,i.center=n.center,i.up=n.up,i)}_centerToCamera(e){const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:t,tilt:i}=this._getPreservingHeadingTilt(),r=zM(this.view,e,t,i,aa.ADJUST,Sct);return w(r)?cy(this.view,r):null}_scaleToCamera(e){if(e==null)return null;const t=this.view.pointsOfInterest.centerOnContent;t.runTask();const i=t.renderLocation,r=t.location.latitude,s=rJ(this.view,e,r);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(mwe(this.view,e))}_viewpointToCamera(e){return cy(this.view,MSe(this.view,e))}setStateCamera(e,t){return!(N(e)||!this.view.state.stopActiveCameraController())&&(this.cameraSetByUser=!0,t.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{t.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),t.applyConstraints&&Ds(this.view,i)}),t.applyConstraints||(this.view.state.cameraController=new Y2({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:t}=this.view;if(!e||!t)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._devicePixelRatio,r=Math.round(e.clientWidth*i),s=Math.round(e.clientHeight*i);if(r!==0&&s!==0&&(t.width===r&&t.height===s||(t.width=r,t.height=s),this.view.state)){const n=this.view.state.camera;n.fullWidth===r&&n.fullHeight===s&&n.pixelRatio===i||(n_.copyFrom(n),n_.pixelRatio!==i&&(this._paddingToArray(this.padding,i,bD),n_.padding=bD),n_.fullWidth=r,n_.fullHeight=s,n_.pixelRatio=i,this.view.state.camera=n_)}}_updateElevation(e){const t=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=this.view.renderCoordsHelper.getAltitude(e.eye),r=t?rz(this.view,e.eye):0;e.relativeElevation=i-r}};u([f({type:jc,dependsOn:["view.state.camera","ready"]})],jn.prototype,"camera",null),u([f({type:jc,dependsOn:["view.state.contentCamera","ready"]})],jn.prototype,"contentCamera",null),u([f({type:xt})],jn.prototype,"center",null),u([f({type:zi})],jn.prototype,"extent",null),u([f({readOnly:!0})],jn.prototype,"frustum",null),u([f({readOnly:!0})],jn.prototype,"hasInitialView",null),u([f({readOnly:!0,type:Boolean})],jn.prototype,"ready",void 0),u([f({type:Number})],jn.prototype,"scale",null),u([f()],jn.prototype,"padding",null),u([f({readOnly:!0})],jn.prototype,"screenCenter",null),u([f({constructOnly:!0})],jn.prototype,"view",void 0),u([f({type:Zp})],jn.prototype,"viewpoint",null),u([f({type:Number})],jn.prototype,"zoom",null),u([f()],jn.prototype,"maximumPixelRatio",null),u([f()],jn.prototype,"_devicePixelRatio",null),u([f()],jn.prototype,"_windowDevicePixelRatio",void 0),u([f()],jn.prototype,"_devicePixelRatioOverride",void 0),u([f()],jn.prototype,"_maximumPixelRatioOverride",void 0),jn=u([B("esri.views.3d.state.ViewStateManager")],jn);const bct=jn,wct=["camera","viewpoint","extent","scale","center","zoom"],xct=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Tct={heading:0,tilt:0},Sct=new jc,n_=new wr,bD=di(),wD="pending-initial-view";class Ect{constructor(t,i,r){this.viewingMode=t,this._forEachLayer=i,this.view=r,this.externalIntersectionHandlers=new hi,this.tolerance=_C,this.tmpRay=Lo(),this.tmpRegion=ei(),this.validateHUDIntersector=wd(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(t,i,r){return this.intersectRay(this._getPickRay(t,this.tmpRay),Lle(this.viewingMode),i,r)}intersectScreenFreePointFallback(t,i,r){return this.intersectRayFreePointFallback(this._getPickRay(t,this.tmpRay),i,r)}intersectRayFreePointFallback(t,i,r){return this.intersectRay(t,Lle(this.viewingMode),i,r)||this._intersectRayFreePointLocal(t,i)}intersectRay(t,i,r,s){return i.options.selectionMode=!1,i.options.store=Uo.MIN,this.computeIntersection(t,i,s),!!i.results.min&&i.results.min.getIntersectionPoint(r)}getCenterRayWithSubpixelOffset(t,i,r=.5,s=.5){return t.getRenderCenter(SD,r,s),SD[0]+=.0466,SD[1]-=.0123,YQ(t,SD,i)}intersectIntersectorScreen(t,i,r){this.computeIntersection(this._getPickRay(t,this.tmpRay),i,r)}intersectToolIntersectorScreen(t,i,r){const s=this._getPickRay(t,this.tmpRay);this.intersectToolIntersectorRay(s,i,r)}intersectToolIntersectorRay(t,i,r){i.options.selectionMode=!0,this.computeIntersection(t,i,r);const s=i.results.min;!!this.view.basemapTerrain&&this.view.basemapTerrain.opaque||Zm(s)&&s.intersector!==ls.TERRAIN||(i.options.selectionMode=!1,this.computeIntersection(t,i,r))}setTolerance(t=_C){this.tolerance=t}addIntersectionHandler(t){this.externalIntersectionHandlers.push(t),this.externalIntersectionHandlers.sort((i,r)=>i.type===ls.TERRAIN?1:r.type===ls.TERRAIN?-1:0)}removeIntersectionHandler(t){this.externalIntersectionHandlers.removeUnordered(t)!=null&&this.externalIntersectionHandlers.sort((i,r)=>i.type===ls.TERRAIN?1:r.type===ls.TERRAIN?-1:0)}_getPickRay(t,i){const r=this.view.state.camera;return Fbe(r,t,i)}_intersectRayFreePointLocal(t,i){if(this.viewingMode!==st.Local||N(t))return!1;const r=this.view.renderDataExtent;if(N(r))return Oe(i,t.origin,De(ot.get(),t.direction)),!0;const s={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:8*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},n=Math.max(s.x,s.y,s.z);if(n===0)return Oe(i,t.origin,De(ot.get(),t.direction)),!0;const o=this.view.state.camera,a=Math.max(0,r.xmin-o.eye[0],o.eye[0]-r.xmax),l=Math.max(0,r.ymin-o.eye[1],o.eye[1]-r.ymax),c=Math.sqrt(a*a+l*l),h=Math.abs(o.relativeElevation)+Number.MIN_VALUE,p=Math.max(0,Math.log(n/h))**2;let m=n/Math.max(1,p);m=Math.max(m,Math.min(c,n));const g=be(ot.get(),t.direction,m/He(t.direction));return Oe(i,t.origin,g),!0}intersectElevationFromScreen(t,i,r=0,s=null){return this._intersectElevation(this._getPickRay(t,this.tmpRay),i,r,s)}_intersectElevation(t,i,r=0,s=null){if(N(t))return null;const n=w(i)?i.mode:"absolute-height",o=w(i)?$t(i.offset,0):0,a=n!=="on-the-ground"?o+r:0,l=a/this.view.renderCoordsHelper.unitInMeters;if(n==="absolute-height"){if(this.view.renderCoordsHelper.intersectInfiniteManifold(t,a,TD)){const O=this.view.computeMapPointFromVec3d(TD);return O.z-=o,O}return null}const c=this.view.state.camera,h=ot.get();c.projectToRenderScreen(t.origin,h);const p=new $le(null,this._forEachLayer),m=this.view.slicePlane,g=w(m)?One(m):null,v=wd(this.viewingMode);v.options.store=Uo.MIN,v.options.verticalOffset=l;const b=t.origin,S=Oe(ot.get(),b,t.direction);v.reset(b,S,c),v.point=h;const T=w(s)?"type"in s&&s.type==="graphics"?O=>O.metadata.layerUid!==s.uid:O=>O.metadata.graphicUid!==s.uid:null;switch(n){case"relative-to-scene":{const O=C=>(N(T)||T(C))&&C.metadata&&C.metadata.isElevationSource;v.intersect(p.layers,h,this.tolerance,null,O),this.externalIntersectionHandlers.forAll(C=>{if(C.type===ls.I3S||C.type===ls.TERRAIN){const M=C.slicePlaneEnabled?g:null;C.intersect(v,M,v.rayBegin,v.rayEnd,h)}})}break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(O=>{if(O.isGround){const C=O.slicePlaneEnabled?g:null;O.intersect(v,C,v.rayBegin,v.rayEnd,h)}})}if(v.results.min.getIntersectionPoint(TD)){const O=this.view.computeMapPointFromVec3d(TD);return O.z=r,O}return null}computeIntersection(t,i,r){if(N(t))return;const s=this.view.state.camera,n=ot.get();s.projectToRenderScreen(t.origin,n);const o=new $le(r,this._forEachLayer);i.options.selectOpaqueTerrainOnly=!r||!("include"in r||"exclude"in r);const a=t.origin,l=Oe(ot.get(),t.origin,t.direction);i.reset(a,l,s),i.intersect(o.layers,n,this.tolerance);const c=this.view.slicePlane,h=w(c)?One(c):null;i.intersect(o.sliceableLayers,n,this.tolerance,h);const p=r&&(r.requiresGroundFeedback||r.enableDraped);this.externalIntersectionHandlers.forAll(g=>{if(i.options.isFiltered=!o.filterLayerUid(g.layerUid),g.isGround&&p||!i.options.isFiltered){const v=g.slicePlaneEnabled?h:null;g.intersect(i,v,a,l,n)}});const m=ot.get();if(r&&r.enableDraped&&i.results.ground.getIntersectionPoint(m)){const g=this.view.basemapTerrain,v=g.overlayManager.renderer,b=this.view.renderCoordsHelper.spatialReference,S=ot.get();this.view.renderCoordsHelper.fromRenderCoords(m,S,g.spatialReference),S[2]=$t(this.view.elevationProvider.getElevation(m[0],m[1],m[2],b,"ground"),0),v.intersect(i,S,i.results.ground,T=>o.filterRenderGeometry(T))}i.sortResults(),this._processHUDResults(i)}_processHUDResults(t){const i=t.results.hud;Gy(this.tmpRegion,h7);const r=this.view.state.camera,s=[],n=this.tmpRegion,o=T=>{const O=new Act(T);r.projectToRenderScreen(T.target.center,O.screenPoint),O.screenPoint[0]=Math.floor(O.screenPoint[0]),O.screenPoint[1]=Math.floor(O.screenPoint[1]),s.push(O),rE(n,O.screenPoint)};t.sortResults(i.all),w(i.min.dist)&&o(i.min);for(const T of i.all)i.min.target.object!==T.target.object&&i.max.target.object!==T.target.object&&o(T);if(w(i.max.dist)&&i.max.target.object!==i.min.target.object&&o(i.max),!s.length)return;n[0]===n[2]&&(n[2]+=1),n[1]===n[3]&&(n[3]+=1);const a=r.fullWidth,l=r.fullHeight,c=Math.max(0,n[0]-rM),h=Math.max(0,n[1]-rM),p=Math.min(Nu(n)+2*rM,a-c),m=Math.min(Wp(n)+2*rM,l-h),g=new Uint8Array(p*m*4);this.view._stage.renderView.readHUDVisibility(c,h,p,m,g);let v=!0;const b=N(t.results.max.dist);let S=0;for(const T of s)for(const O of Cct)if(g[4*(Math.min(T.screenPoint[0]+O[0],a)-n[0]+(Math.min(T.screenPoint[1]+O[1],l)-n[1])*p)]){v&&(t.results.min.copy(T.result),v=!1),b&&t.results.max.copy(T.result),t.options.store===Uo.ALL&&t.results.all.splice(S++,0,T.result);break}}}const rM=1,Cct=(()=>{const e=[],t=rM;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)e.push([r+t,i+t]);return e})();class Act{constructor(t){this.result=t,this.screenPoint=sa()}}let xD;function Lle(e){return xD&&xD.viewingMode===e||(xD=wd(e)),xD}class $le{constructor(t,i){this.layers=new Array,this.sliceableLayers=new Array,this.include=t==null?void 0:t.include,this.exclude=t==null?void 0:t.exclude,i(r=>{r.isPickable&&this.filterLayerUid(r.apiLayerUid)&&(r.isSliceable?this.sliceableLayers:this.layers).push(r)})}filterLayerUid(t){const{include:i,exclude:r}=this;return N(t)?i==null&&r==null:(i==null||i.has(t))&&(r==null||!r.has(t))}filterRenderGeometry(t){return this.filterLayerUid(t.layerUid)}}function Dle(e){return typeof e=="object"&&"intersect"in e}const TD=F(),SD=sa();class swt{constructor(t,i){this.spatialReference=t,this.view=i}getElevation(t,i,r){return this.view.elevationProvider.getElevation(t,i,0,this.spatialReference,r)}async queryElevation(t,i,r,s,n){return this.view.elevationProvider.queryElevation(t,i,0,this.spatialReference,n,r,s)}}class Oct{constructor(t,i,r,s){this.spatialReference=i,this._getElevationQueryProvider=r,this._queries=new Array,this._queryOptions={...s,ignoreInvisibleLayers:!0},this._frameTask=t.registerTask(It.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(t,i,r,s=0){return new Promise((n,o)=>{const a={x:t,y:i,minDemResolution:s,result:{resolve:n,reject:o},signal:r};this._queries.push(a),Ma(r,()=>{tZ(this._queries,a),o($i())})})}get running(){return this._queries.length>0}runTask(){const t=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return void t.forEach(c=>c.result.reject());const r=t.map(c=>[c.x,c.y]),s=t.reduce((c,h)=>Math.min(c,h.minDemResolution),1/0),n=new lT({points:r,spatialReference:this.spatialReference}),o=t.length>1&&t.some(c=>!!c.signal)?new AbortController:null,a=w(o)?o.signal:t[0].signal;if(w(o)){let c=0;t.forEach(h=>Ma(h.signal,()=>{c++,h.result.reject($i()),c===t.length&&o.abort()}))}const l={...this._queryOptions,minDemResolution:s,signal:a};i.queryElevation(n,l).then(c=>{t.forEach((h,p)=>{w(h.signal)&&h.signal.aborted?h.result.reject($i()):h.result.resolve(c.geometry.points[p][2])})}).catch(c=>{t.forEach(h=>h.result.reject(c))})}get test(){const t=this;return{update:()=>t._queries.length>0&&t.runTask()}}}let sM=class extends ks.EventedMixin(ze){constructor(e){super(e),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=Tt(this._elevationQuery)}get elevationQuery(){return N(this._elevationQuery)&&(this._elevationQuery=new Oct(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,t,i,r,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const o=this.lastElevationQuery;if(e===o.x&&t===o.y&&i===o.z&&r.equals(o.spatialReference)&&s===o.queryContext)return o.result}let n=null;return n=ED(n,this.im,e,t,i,r,s),N(n)&&(n=ED(n,this.ground,e,t,i,r,s)),s==="scene"&&(n=ED(n,this.scene,e,t,i,r,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:t,z:i,spatialReference:r,queryContext:s,result:n}),n}queryElevation(e,t,i,r,s,n=null,o=0){const a=Gp();return this.elevationQuery.queryElevation(e,t,n,o).then(l=>{s==="scene"&&(l=ED(l,this.scene,e,t,i,r,s)),a.resolve(l)}).catch(l=>{Cs(l)?a.reject(l):a.resolve(this.getElevation(e,t,i,r,s))}),a.promise}register(e,t){this.handles.set(t,t.on("elevation-change",i=>this.emit("elevation-change",i))),this[e].push(t)}unregister(e){this.handles.has(e)&&(this.handles.get(e).remove(),this.handles.delete(e));for(const t of[this.im,this.ground,this.scene]){const i=t.indexOf(e);i>-1&&t.splice(i,1)}}};function ED(e,t,i,r,s,n,o){for(const a of t){const l=a.getElevation(i,r,s,n,o);w(l)&&(e=w(e)?Math.max(l,e):l)}return e}u([f({constructOnly:!0})],sM.prototype,"view",void 0),u([f({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],sM.prototype,"spatialReference",void 0),sM=u([B("esri.views.3d.support.CombinedElevationProvider")],sM);class Dv{static isValidProfile(t){return t in Dv.profiles}static getDefaultProfile(){return Ce("trident")||Ce("esri-iPhone")?"low":"medium"}static apply(t,i){const r=Dv.profiles[t];i.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures,i.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives,i.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor,i.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor,i.graphics3D.snapshotAvailable=r.graphics3D.snapshotAvailable;{const s=i.sceneService["3dObject"],n=r.sceneService["3dObject"];s.lodFactor=n.lodFactor,s.lodCrossfadeinDuration=n.lodCrossfadeinDuration,s.lodCrossfadeoutDuration=n.lodCrossfadeoutDuration,s.lodCrossfadeUncoveredDuration=n.lodCrossfadeUncoveredDuration}i.sceneService.point.lodFactor=r.sceneService.point.lodFactor,i.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor,i.sceneService.pointCloud.lodFactor=r.sceneService.pointCloud.lodFactor,i.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled,i.tiledSurface.lodBias=r.tiledSurface.lodBias,i.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias,i.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences,i.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration,i.heatmap.pixelRatio=r.heatmap.pixelRatio,i.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures,i.antialiasingEnabled=r.antialiasingEnabled,i.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled,i.highQualityTransparency=r.highQualityTransparency,i.memoryLimit=r.memoryLimit,i.additionalCacheMemory=r.additionalCacheMemory,i.frameRate=r.frameRate,i.maximumRenderResolution=r.maximumRenderResolution,i.maximumPixelRatio=r.maximumPixelRatio}}function Nle(){const e=!!Ce("esri-mobile"),t=!!Ce("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?.8:1,polylineLodFactor:e?1.2:1.5,snapshotAvailable:!t},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:e},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Ce("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?600:750,additionalCacheMemory:e?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:e?1.2:2,polylineLodFactor:e?1.2:2,snapshotAvailable:!t},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!Ce("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:e?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:e?null:4096,maximumPixelRatio:e?1:null}}}Dv.debug={reset(){const e=Nle();for(const t in e)Dv.profiles[t]=e[t]}},function(e){e.profiles=Nle()}(Dv||(Dv={}));const zF=Dv;function XJ(){return new Float32Array(4)}function Rct(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Td(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function Mct(e,t){return new Float32Array(e,t,4)}function LSe(){return XJ()}function $Se(){return Td(1,1,1,1)}function DSe(){return Td(1,0,0,0)}function NSe(){return Td(0,1,0,0)}function FSe(){return Td(0,0,1,0)}function kSe(){return Td(0,0,0,1)}const Pct=LSe(),Ict=$Se(),Lct=DSe(),$ct=NSe(),Dct=FSe(),Nct=kSe();Object.freeze(Object.defineProperty({__proto__:null,create:XJ,clone:Rct,fromValues:Td,createView:Mct,zeros:LSe,ones:$Se,unitX:DSe,unitY:NSe,unitZ:FSe,unitW:kSe,ZEROS:Pct,ONES:Ict,UNIT_X:Lct,UNIT_Y:$ct,UNIT_Z:Dct,UNIT_W:Nct},Symbol.toStringTag,{value:"Module"}));let qf=class extends ze{constructor(){super(...arguments),this.color=new at([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new at([0,0,0]),this.shadowDifference=.2}static toEngineOptions(e){const t=at.toUnitRGBA(e.color),i=w(e.haloColor)?at.toUnitRGBA(e.haloColor):t,r=at.toUnitRGBA(e.shadowColor);return{color:Td(t[0],t[1],t[2],t[3]),haloColor:Td(i[0],i[1],i[2],i[3]),haloOpacity:e.haloOpacity,haloOpacityOccluded:.25*e.haloOpacity,fillOpacity:e.fillOpacity,fillOpacityOccluded:.25*e.fillOpacity,shadowOpacity:e.shadowOpacity,shadowColor:ki(r[0],r[1],r[2],r[3]),occludedShadowOpacity:e.shadowOpacity*(1-e.shadowDifference)}}};u([f({type:at})],qf.prototype,"color",void 0),u([f({type:at})],qf.prototype,"haloColor",void 0),u([f()],qf.prototype,"haloOpacity",void 0),u([f()],qf.prototype,"fillOpacity",void 0),u([f()],qf.prototype,"shadowOpacity",void 0),u([f({type:at})],qf.prototype,"shadowColor",void 0),u([f()],qf.prototype,"shadowDifference",void 0),qf=u([B("esri.views.3d.support.HighlightOptions")],qf);const TW=qf;function Fct(e,t,i){const r=ipe(t);return e.map(s=>{const n=r.fromJSON(s);return n.spatialReference=i,n})}let uw=class extends Fe{constructor(e){super(e),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(r=>r.toJSON()),t=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=t.spatialReference.wkid||JSON.stringify(t.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:FC(t),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};u([f()],uw.prototype,"geometries",void 0),u([f({json:{read:{source:"outSR"}}})],uw.prototype,"outSpatialReference",void 0),u([f()],uw.prototype,"transformation",void 0),u([f()],uw.prototype,"transformForward",void 0),uw=u([B("esri.rest.support.ProjectParameters")],uw);const YJ=uw,kct=hn(YJ);async function USe(e,t,i){t=kct(t);const r=Qye(e),s={...r.query,f:"json",...t.toJSON()},n=t.outSpatialReference,o=FC(t.geometries[0]),a=X5e(s,i);return jr(r.path+"/project",a).then(({data:{geometries:l}})=>Fct(l,o,n))}async function QJ(e=null,t){var s,n;if(sr.geometryServiceUrl)return sr.geometryServiceUrl;if(!e)throw new se("internal:geometry-service-url-not-configured");let i;i="portal"in e?e.portal||Ql.getDefault():e,await i.load({signal:t});const r=(n=(s=i.helperServices)==null?void 0:s.geometry)==null?void 0:n.url;if(!r)throw new se("internal:geometry-service-url-not-configured");return r}async function Uct(e,t,i=null,r){const s=await QJ(i,r),n=new YJ;n.geometries=[e],n.outSpatialReference=t;const o=await USe(s,n,{signal:r});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new se("internal:geometry-service-projection-failed")}const zct=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:QJ,projectGeometry:Uct},Symbol.toStringTag,{value:"Module"}));class Bct{constructor(t,i){this.spatialReference=i,this.unitInMeters=Zc(this.spatialReference,ji(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=QJ(t&&t.get("portalItem")).catch(()=>{throw new se("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(t){const i=await this._geometryServiceURLPromise;let r,s=!0;Array.isArray(t[0])&&typeof t[0]!="number"?r=t:(r=[t],s=!1);const n=r.map(l=>l instanceof xt?l:new xt(l,this.spatialReference)),o=new YJ({geometries:n,outSpatialReference:wt.WGS84}),a=(await USe(i,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0);return s?a:a[0]}}let tm=class extends ze{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};u([f()],tm.prototype,"minTotalNumberOfFeatures",void 0),u([f()],tm.prototype,"maxTotalNumberOfFeatures",void 0),u([f()],tm.prototype,"maxTotalNumberOfPrimitives",void 0),u([f()],tm.prototype,"snapshotAvailable",void 0),u([f()],tm.prototype,"polygonLodFactor",void 0),u([f()],tm.prototype,"polylineLodFactor",void 0),tm=u([B("esri.views.3d.support.QualitySettings.Graphics3DSettings")],tm);let wm=class extends ze{constructor(){super(...arguments),this.lodFactor=1}};u([f()],wm.prototype,"lodFactor",void 0),wm=u([B("esri.views.3d.support.QualitySettings.LoDFactorSettings")],wm);let lk=class extends wm{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};lk=u([B("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],lk);let hy=class extends ze{constructor(){super(...arguments),this["3dObject"]=new lk,this.point=new wm,this.integratedMesh=new wm,this.pointCloud=new wm,this.uncompressedTextureDownsamplingEnabled=!1}};u([f({type:lk})],hy.prototype,"3dObject",void 0),u([f({type:wm})],hy.prototype,"point",void 0),u([f({type:wm})],hy.prototype,"integratedMesh",void 0),u([f({type:wm})],hy.prototype,"pointCloud",void 0),u([f()],hy.prototype,"uncompressedTextureDownsamplingEnabled",void 0),hy=u([B("esri.views.3d.support.QualitySettings.SceneServiceSettings")],hy);let ov=class extends ze{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};u([f()],ov.prototype,"lodBias",void 0),u([f()],ov.prototype,"angledSplitBias",void 0),u([f()],ov.prototype,"reduceTileLevelDifferences",void 0),u([f()],ov.prototype,"textureFadeDuration",void 0),ov=u([B("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],ov);let Q2=class extends ze{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};u([f()],Q2.prototype,"pixelRatio",void 0),u([f()],Q2.prototype,"maxTotalNumberOfFeatures",void 0),Q2=u([B("esri.views.3d.support.QualitySettings.HeatmapSettings")],Q2);let Al=class extends ze{constructor(){super(...arguments),this.graphics3D=new tm,this.sceneService=new hy,this.tiledSurface=new ov,this.heatmap=new Q2,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};u([f({type:tm})],Al.prototype,"graphics3D",void 0),u([f({type:hy})],Al.prototype,"sceneService",void 0),u([f({type:ov})],Al.prototype,"tiledSurface",void 0),u([f({type:Q2})],Al.prototype,"heatmap",void 0),u([f()],Al.prototype,"antialiasingEnabled",void 0),u([f()],Al.prototype,"physicallyBasedRenderingEnabled",void 0),u([f()],Al.prototype,"highQualityTransparency",void 0),u([f()],Al.prototype,"memoryLimit",void 0),u([f()],Al.prototype,"additionalCacheMemory",void 0),u([f()],Al.prototype,"frameRate",void 0),u([f()],Al.prototype,"maximumRenderResolution",void 0),u([f()],Al.prototype,"maximumPixelRatio",void 0),Al=u([B("esri.views.3d.support.QualitySettings.QualitySettings")],Al);const Fle=Al;class ck{constructor(t,i,r,s){this.viewingMode=t,this.spatialReference=i,this.unitInMeters=r,this.coordinateSystem=s,this._coordinateSystem=F$e(s)}set extent(t){t&&k$e(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return q$e(this.coordinateSystem,t)}setAltitude(t,i,r=t){return Cge(this.coordinateSystem,r,i,t)}setAltitudeOfTransformation(t,i){W$e(this.coordinateSystem,i,t,i)}worldUpAtPosition(t,i){return V$e(this.coordinateSystem,t,i)}worldBasisAtPosition(t,i,r){return G$e(this.coordinateSystem,t,i,r)}basisMatrixAtPosition(t,i){const r=this.worldBasisAtPosition(t,Zu.X,ot.get()),s=this.worldBasisAtPosition(t,Zu.Y,ot.get()),n=this.worldBasisAtPosition(t,Zu.Z,ot.get());return Vm(i,r[0],r[1],r[2],0,s[0],s[1],s[2],0,n[0],n[1],n[2],0,0,0,0,1),i}intersectManifoldClosestSilhouette(t,i,r){return OV(this.coordinateSystem,i,this._coordinateSystem),H$e(this._coordinateSystem,t,r),r}intersectManifold(t,i,r){OV(this.coordinateSystem,i,this._coordinateSystem);const s=ot.get();return j$e(this._coordinateSystem,t,s)?ve(r,s):null}intersectInfiniteManifold(t,i,r){if(this.viewingMode===st.Global)return this.intersectManifold(t,i,r);OV(this.coordinateSystem,i,this._coordinateSystem);const s=this._coordinateSystem.value,n=ot.get();return gT(s.plane,t,n)?ve(r,n):null}toRenderCoords(t,i,r){return F5(t)?po(t,i,this.spatialReference):$n(t,i,r,this.spatialReference)}fromRenderCoords(t,i,r=null){return F5(i)?(w(r)&&(i.spatialReference=r),Tme(t,this.spatialReference,i)):i instanceof wt?i1(t,this.spatialReference,i):$n(t,this.spatialReference,i,r)?i:null}static create(t,i){switch(t){case st.Local:return new ck(st.Local,i,Zc(i),B$e());case st.Global:return new ck(st.Global,i,1,z$e(i))}}static renderUnitScaleFactor(t,i){return kle(t)/kle(i)}}function kle(e){if(k5(e,st.Global))return 1;const t=Age(!1,e);return Zc(t)}var hm;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.BASEMAP=1]="BASEMAP",e[e.I3S_INDEX=2]="I3S_INDEX",e[e.I3S_DATA=3]="I3S_DATA",e[e.SYMBOLOGY=4]="SYMBOLOGY"})(hm||(hm={}));const Vct=(()=>{const e=new Array;return e[hm.ELEVATION]=10,e[hm.BASEMAP]=10,e[hm.I3S_INDEX]=10,e[hm.I3S_DATA]=10,e[hm.SYMBOLOGY]=5,e})(),Gct=30;function zSe(e){return typeof e.getUsedMemory=="function"}const jct=Ie.getLogger("esri.views.3d.support.MemoryController");function Hct(e){return new Ol({view:e})}const CD=1,m9=1,qct=.75,Wct=.6,Ule=1.3;let Ol=class extends ze{constructor(e){super(e),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new dY,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(CD),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&e>=0&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(e,t){return new y5e(e,this._cacheStorage,t)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<Wct&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(CD);else if(e)(this._memoryPredicted>1.1*m9||this._memoryUsed>m9)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/Ule),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._memoryUsed>m9)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/Ule),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._memoryUsed<qct&&this._quality<CD){this._stableQuality=this._quality;const t=.05;e=this._updateQuality(this._quality+t)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),CD))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){let e=0,t=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(e+=this.view.basemapTerrain.getUsedMemory());const i=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;w(i)&&(e+=i.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(o=>{if(zSe(o)){const a=o.ignoresMemoryFactor()?this._quality:1;e+=o.getUsedMemory()*a,t+=o.getUnloadedMemory()*a}});const r=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&r){this._warnMemoryUsage=e;const o=l=>(l/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",a=Math.round(100*this._quality);jct.warn(`Memory Limit exceeded! Limit: ${o(s)} Current: ${o(e)} Projected: ${o(e+t)} Quality: ${a}%`)}this._memoryUsed=e/s,this._memoryPredicted=(e+t)/s;const n=s-e;this._cacheStorage.maxSize=Math.max(0,n+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const t=e._numQualityChanges;return e._numQualityChanges=0,t}}}};u([f({constructOnly:!0})],Ol.prototype,"view",void 0),u([f()],Ol.prototype,"maxMemory",null),u([f()],Ol.prototype,"additionalCacheMemory",null),u([f()],Ol.prototype,"memoryFactor",null),u([f()],Ol.prototype,"updating",null),u([f()],Ol.prototype,"usedMemory",null),u([f()],Ol.prototype,"_quality",void 0),u([f()],Ol.prototype,"_memoryUsed",void 0),u([f()],Ol.prototype,"_updating",void 0),u([f()],Ol.prototype,"_stableQuality",void 0),u([f()],Ol.prototype,"_maxMemory",void 0),u([f()],Ol.prototype,"_additionalCacheMemory",void 0),Ol=u([B("esri.views.3d.support.MemoryController")],Ol);class Zct{constructor(t){this.client=t,this._cancelled=!1,this.size=0,this.duration=0}}class Xct{constructor(t){this.typeWorkerQuota=t,this.tasks=new Array,this.numWorkers=0,this.statistics=new Yct}}class Yct{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Qct{constructor(t,i,r,s){this._workerFunc=t,this._callbackFunc=i,this._maxTotalNumWorkers=r,this._totalNumWorkers=0,this._clients=s.map(n=>new Xct(n))}hasQuota(t){const i=this._clients[t];return!!i&&(this._totalNumWorkers<this._maxTotalNumWorkers||i.numWorkers+i.tasks.length<i.typeWorkerQuota)}push(t){const i=this._clients[t.client];i&&(this._totalNumWorkers<this._maxTotalNumWorkers?(i.numWorkers++,this._totalNumWorkers++,this._workerFunc(t,(r,s)=>this._taskCallback(r,s))):i.tasks.push(t))}cancel(t){this._taskFinished(t),t._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(t){const i=this._clients[t.client];this._totalNumWorkers--,i.numWorkers--,i.statistics.requests++,i.statistics.size+=t.size||0,i.statistics.duration+=t.duration||0,i.statistics.speed=i.statistics.duration>0?i.statistics.size/i.statistics.duration:0,At(i.numWorkers>=0),this._next()}_next(){for(const t of this._clients)if(t&&t.numWorkers<t.typeWorkerQuota&&this._processQueue(t))return;for(const t of this._clients)if(t&&this._processQueue(t))return}_processQueue(t){for(;t.tasks.length>0;)if(this._workerFunc(t.tasks.shift(),(i,r)=>this._taskCallback(i,r)))return t.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(t,i){t._cancelled||(this._callbackFunc(t,i),this._taskFinished(t))}getStatsForType(t){const i=this._clients[t];return i?{quota:i.typeWorkerQuota,workers:i.numWorkers,queueSize:i.tasks.length,requestStats:i.statistics}:null}get test(){const t=this;return{set workerFunc(i){t._workerFunc=i}}}}let BF=class extends ze{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,t,i){this._loadQueue=new Qct((r,s)=>this._startLoading(r,s),(r,s)=>this._doneLoadingCB(r,s),e,t),i&&(this._frameTask=i.registerTask(It.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=Ln(this._frameTask),this._tasks.forEach(e=>fd(e.abortController)),this._loadQueue=Tt(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,t,i,r={}){const s=Gp();s.__signal=w(r)?r.signal:null;const n=this._createOrUpdateTask(e,t,i,r,s);return Ma(r,()=>this._cancelRequest(n,s)),s.promise}_createTask(e,t,i,r,s,n){const o=new eut(e,t,i,r,s);return this._updateTask(o,n),this._tasks.set(s,o),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(o),o}_cancelRequest(e,t){Ak(e.resolvers,t),t.reject($i()),e.resolvers.length===0&&(e.status===Gh.DOWNLOADING&&(e.status=Gh.CANCELLED,this._loadQueue.cancel(e),e.abortController.abort(),e.request=null,e.abortController=null),e.status=Gh.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,t){e.resolvers.push(t)}_createOrUpdateTask(e,t,i,r,s){const n=tut(w(r)&&r.uid||e,t,i),o=this._tasks.get(n);return o?(this._updateTask(o,s),o):this._createTask(e,r,t,i,n,s)}_doneLoadingCB(e,t){this._loadQueue&&(At(e.status===Gh.DOWNLOADING),e.status=Gh.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:t}):this._doneLoading(e,t))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const t=this._onLoadQueue.shift();Ui(t.task.abortController),t.task.abortController=null,t.callback(t.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const t=this._doneQueue.shift();t.task.status!==Gh.DOWNLOADED&&(t.err=t.err||$i()),this._doneLoading(t.task,t.err),e.madeProgress()}}_doneLoading(e,t){if(t&&!Cs(t)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const r of e.resolvers)if(t)Cs(t)?r.reject(t):r.reject(new se("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${t}`,{url:e.url,error:t}));else{--i;const s=i<=0?e.result:me(e.result);r.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,t){if(e.status===Gh.CANCELLED)return!1;let i,r;switch(e.startTime=performance.now(),e.status=Gh.DOWNLOADING,e.docType){case"binary":r="array-buffer",i=0;break;case"image":r="image";break;case"image+type":r="array-buffer";break;default:r="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=jr(e.url,{...e.options,responseType:r,timeout:i,signal:s});let n=()=>{};const o=l=>{e.duration=performance.now()-e.startTime,e.size=l instanceof ArrayBuffer?l.byteLength:e.size||0,e.result=l,this._frameTask?this._onLoadQueue.push({callback:t,task:e}):(e.abortController=null,t(e))},a=l=>{e.status===Gh.DOWNLOADING&&t(e,l),n()};return e.docType!=="image+type"?(e.request.then(l=>o(l.data),a),!0):(e.request.then(l=>{const c=l.data,h=Kct(c);if(r="image",e.size=c.byteLength,h==="unknown")return e.request=jr(e.url,{responseType:r,timeout:i,signal:s}),void e.request.then(g=>o(g.data),a);const p=new Blob([c],{type:h}),m=window.URL.createObjectURL(p);n=()=>window.URL.revokeObjectURL(m),e.request=jr(m,{responseType:r,timeout:i,signal:s}),e.request.then(g=>o(new Qz(g.data,h,n)),a)},a),!0)}get test(){return{loadQueue:this._loadQueue}}};u([f({readOnly:!0})],BF.prototype,"updating",void 0),BF=u([B("esri.views.3d.support.StreamDataLoader")],BF);const Jct={numRetries:0};function Kct(e){if(e.byteLength<2)return"unknown";const t=new Uint8Array(e,0,e.byteLength);return t[0]===137&&t[1]===80?"image/png":t[0]===71&&t[1]===73?"image/gif":t[0]===66&&t[1]===77?"image/bmp":t[0]===255&&t[1]===216?"image/jpeg":"unknown"}class Qz{constructor(t,i,r){this.image=t,this.type=i,this.release=r}get isOpaque(){return this.type==="image/jpeg"}}class eut extends Zct{constructor(t,i,r,s,n){super(s),this.url=t,this.options=i,this.docType=r,this.key=n,this.result=null,this.status=Gh.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=Jct.numRetries}}function tut(e,t,i){return`${e}:${t}:${i}`}var Gh;(function(e){e[e.QUEUED=1]="QUEUED",e[e.DOWNLOADING=2]="DOWNLOADING",e[e.DOWNLOADED=3]="DOWNLOADED",e[e.CANCELLED=4]="CANCELLED"})(Gh||(Gh={}));let AD=class extends ze{constructor(){super(...arguments),this.updating=!1}};function iut(e){return new SW.ResourceController({view:e})}var SW;u([f({readOnly:!0})],AD.prototype,"updating",void 0),AD=u([B("esri.views.3d.support.ResourceController")],AD),function(e){let t=class extends AD{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=rC,this._cameraChangeTime=0,this._handles=new xi,this._frameTask=null,this._state=no.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=C7e(),this._memoryController=Hct(this.view),this._streamDataLoader=new BF,this._streamDataLoader.setup(Gct,Vct,this._scheduler),this._handles.add([xe(()=>{var r;return(r=this.view.state)==null?void 0:r.camera},(r,s)=>this._cameraChangedHandler(r,s),Rr),xe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=xx({update:r=>this._frame(r)}),this._scheduleTask=this._scheduler.registerTask(It.RESOURCE_CONTROLLER)}destroy(){this._handles=Tt(this._handles),this._scheduleTask.remove(),this._frameTask=Ln(this._frameTask),this._streamDataLoader=Tt(this._streamDataLoader),this._memoryController=Tt(this._memoryController),this._scheduler=Tt(this._scheduler)}get updating(){var r,s,n;return!!(((r=this._memoryController)==null?void 0:r.updating)||((s=this._streamDataLoader)==null?void 0:s.updating)||((n=this._scheduleTask)==null?void 0:n.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(r,s,n){return this._scheduleTask.schedule(r,s,n)}createStreamDataRequester(r){const s=this._streamDataLoader;return{request:(n,o,a)=>s.request(n,o,r,a),get busy(){return!s.hasDownloadSlots(r)}}}_frame(r){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(cZ(r.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(r)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(r,s){r&&s&&r.almostEquals(s)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=no.ANIMATING:this.view.interacting?this._state=no.INTERACTING:(this._state===no.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=i?this._state=no.INTERACTING:this._state=no.IDLE)}get test(){return{getQueueStats:r=>this._streamDataLoader.test.loadQueue.getStatsForType(r),state:this._state}}};u([f({constructOnly:!0})],t.prototype,"view",void 0),u([f()],t.prototype,"_scheduler",void 0),u([f()],t.prototype,"_memoryController",void 0),u([f()],t.prototype,"_streamDataLoader",void 0),u([f()],t.prototype,"_scheduleTask",void 0),u([f({readOnly:!0})],t.prototype,"updating",null),t=u([B("esri.views.3d.support.ResourceController")],t),e.ResourceController=t;const i=300}(SW||(SW={}));function rut(e){return"performanceInfo"in e}const xS=F(),sut=F(),Eg=F(),Cg=F();function nut(e,t,i=0){const r=e.extent;if(N(r))return!1;if(i===0)return Vpe(r,t);const s=Math.min(r[2]-r[0],r[3]-r[1]);return GMe(r,t,i*s)}function OD(e,t,i,r){ve(xS,i),xS[r]=t[r];const s=Me(xS,xS,t),n=Me(sut,e,t),o=ke(n,s),a=ke(s,s);let l;l=o<=0?t:a<=o?i:Oe(xS,t,be(s,s,o/a));const c=Me(xS,e,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function out(e,t,i){const r=e.extent;if(N(r))return 0;Eg[0]=r[0],Eg[1]=r[1],Eg[2]=i,Cg[0]=r[2],Cg[1]=r[3],Cg[2]=i;let s=1/0,n=1/0;return t[0]<Eg[0]?s=OD(t,Eg,Cg,0):t[0]>Cg[0]&&(s=OD(t,Cg,Eg,0)),t[1]<Eg[1]?n=OD(t,Eg,Cg,1):t[1]>Cg[1]&&(n=OD(t,Cg,Eg,1)),Math.min(s,n)}function aut(e,t,i){if(N(e))return sQ();if(e.spatialReference.isGeographic&&!$x(e.spatialReference))return new se("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const r=es.checkUnsupported(e);if(w(r))return r;if(N(i))return new se("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const s=lut(e,i);if(s)return s;const n=e.spatialReference;return w(t)&&!(n.equals(t)||t.isWGS84&&n.isWebMercator)?new se("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}function lut(e,t){const i=e.lods,r=i[0].resolution*2**i[0].level,s=[r*e.size[0],r*e.size[1]],n=[e.origin.x,e.origin.y],o=zpe(t),a=ei();es.computeRowColExtent(o,s,n,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>U2){const c=i[0].scale*2**i[0].level;let h=Math.max((o[3]-o[1])/e.size[1],(o[2]-o[0])/e.size[0])*c/r;const p=Math.floor(Math.log(h)/Math.log(10));return h=Math.ceil(h/10**p)*10**p,new se("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:h,requiredNumRootTiles:l,allowedNumRootTiles:U2})}return null}const cut=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:nut,tiltToExtentEdge:out,checkIfTileInfoSupportedForViewSR:aut},Symbol.toStringTag,{value:"Module"}));function uut(){return!0}function hut(){return 0}function dut(e,t){if(N(e))return sQ();const i=e.lods.length-1,r=e.spatialReference,s=$x(r)||km(r)||Um(r);if(r.isWebMercator){if(!es.makeWebMercatorAuxiliarySphere(i).compatibleWith(e))return new se("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!s)return new se("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!es.makeGCSWithTileSize(e.spatialReference,e.size[0],i).compatibleWith(e))return e.spatialReference.isWGS84?new se("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new se("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return w(t)&&!e.spatialReference.equals(t)?new se("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}const put=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:uut,tiltToExtentEdge:hut,checkIfTileInfoSupportedForViewSR:dut},Symbol.toStringTag,{value:"Module"})),fut={[st.Global]:put,[st.Local]:cut};function nm(e,t){e||console.warn("Terrain: "+t)}function EW(e){return Jz(e)?{fullExtent:e.fullExtent,minScale:e.layer.minScale,maxScale:e.layer.maxScale,tilemapCache:null}:e.layer}function uk(e){return(e==null?void 0:e.type)==="imagery-tile"||(e==null?void 0:e.type)==="wcs"}function Jz(e){return(e==null?void 0:e.type)==="imagery-tile-3d"}function JJ(e){return(e==null?void 0:e.type)==="tile-3d"}function T3(e){return(e==null?void 0:e.type)==="vector-tile-3d"}function BSe(e){return(e==null?void 0:e.type)==="wmts-3d"}function CW(e){return(e==null?void 0:e.type)==="elevation-3d"}function VSe(e){return(e==null?void 0:e.type)==="group"}function hk(e){return e&&(JJ(e)||BSe(e)||Jz(e)||T3(e))}function AW(e){return e&&(JJ(e)||Jz(e)||T3(e)||BSe(e))}function S3(e){return AW(e)||CW(e)}function nwt(e){switch(e.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return e.type,!1}}function mut(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return w(t)&&"type"in t&&t.type==="raster-tile"}function gut(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return w(t)&&"type"in t&&t.type==="vector-tile"}function yut(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return w(t)&&"type"in t&&t.type==="tile-texture"}function _ut(e){var i;const t=(i=e==null?void 0:e.sourceLayerInfo)==null?void 0:i.data;return t instanceof HTMLImageElement||t instanceof Qz||t instanceof HTMLCanvasElement||t instanceof ImageData}function yE(e){return w(e)&&"release"in e&&e.release(),null}function zle(e){return e.fetchTile&&e.hasOverriddenFetchTile!==!1}function KJ(e,t,i,r){return fut[r].checkIfTileInfoSupportedForViewSR(e,i,t)}function Kz(e,t,i){let r=null,s=null;if((e==null?void 0:e.type)==="wmts"){const n=vut(e,t,i);r=n.tileInfo,s=n.fullExtent}else{s=uk(e)?e.getCompatibleFullExtent(t):e.fullExtent;const n=i===st.Local;if(uk(e))r=e.getCompatibleTileInfo(t,s,n);else if((e==null?void 0:e.type)==="vector-tile"){const o=n&&!but(t)||wut.force512VTL,a=e.tileInfo.spatialReference.isGeographic;r=o?e.tileInfo:e.tileInfo.getOrCreateCompatible(256,a?1:2)}else r=e.tileInfo}return w(r)&&w(s)&&KJ(r,s,t,i)==null?{tileInfo:r,fullExtent:s}:null}function vut(e,t,i){const r=Z$e(e);if(w(r)){if(!zt.isCollection(r))return{tileInfo:r.tileInfo,fullExtent:r.fullExtent};{const s=r.find(n=>KJ(n.tileInfo,n.fullExtent,t,i)==null);if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}return{tileInfo:null,fullExtent:null}}function but(e){return e.isWGS84||e.isWebMercator||Lde(e)||!uP(e)}const wut={force512VTL:!1};function dk(e){return e===ri.NORTH_EAST?ri.SOUTH_WEST:e===ri.NORTH_WEST?ri.SOUTH_EAST:e===ri.SOUTH_WEST?ri.NORTH_EAST:ri.NORTH_WEST}function VF(e){return e===ri.NORTH?ri.SOUTH:e===ri.EAST?ri.WEST:e===ri.SOUTH?ri.NORTH:ri.EAST}function xut(e){return e===ri.NORTH_WEST||e===ri.SOUTH_WEST}function Tut(e){return e===ri.NORTH_WEST||e===ri.NORTH_EAST}function Ble(e){return e===ri.NORTH_WEST||e===ri.WEST||e===ri.SOUTH_WEST}function Vle(e){return e===ri.NORTH_EAST||e===ri.EAST||e===ri.SOUTH_EAST}function Gle(e){return e===ri.SOUTH_EAST||e===ri.SOUTH||e===ri.SOUTH_WEST}function jle(e){return e===ri.NORTH_EAST||e===ri.NORTH||e===ri.NORTH_WEST}const pv=[ri.NORTH,ri.EAST,ri.SOUTH,ri.WEST],pk=[ri.NORTH_EAST,ri.SOUTH_EAST,ri.SOUTH_WEST,ri.NORTH_WEST];class Sut{constructor(t,i){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=t.layer,this.memory=S3(t)?i.basemapTerrain.getUsedMemoryForLayerView(t):t.getUsedMemory(),rut(t)){const r=t.performanceInfo;this.displayedNumberOfFeatures=r.displayedNumberOfFeatures,this.maximumNumberOfFeatures=r.maximumNumberOfFeatures,this.totalNumberOfFeatures=r.totalNumberOfFeatures}}}class Eut{constructor(t){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const i=t.resourceController.memoryController;this.totalMemory=i.maxMemory*qE.MEGABYTES,this.usedMemory=Math.round(i.usedMemory*this.totalMemory),this.quality=i.memoryFactor,this.load=t.resourceController.scheduler.load,this.terrainMemory=t.basemapTerrain?t.basemapTerrain.getUsedMemory():0;const r=t._stage&&t._stage.renderView&&t._stage.renderView.edgeView;this.edgesMemory=w(r)?r.usedMemory:0,t.allLayerViews.items.forEach(s=>{(zSe(s)||S3(s))&&this.layerPerformanceInfos.push(new Sut(s,t))}),this.layerPerformanceInfos.sort((s,n)=>n.memory-s.memory)}}class Cut extends z2{constructor(t,i,r,s){super(i,s),this._streamDataRequester=t,this._parameters=r}async fromUrl(t,i,r){Ui(r);const s=w(r)&&r.signal,n=this.makeUid(t,i);let o=this._textureRequests.get(n);if(!o){const a=new AbortController,l=this._streamDataRequester.request(t,"image",{uid:n,signal:a.signal});o={referenceCount:0,texture:null,textureAsync:null,abortController:a},this._textureRequests.set(n,o),o.textureAsync=l.then(async c=>{const h=this._createTexture(t,c,i);return o.texture=h,o.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:n,texture:h,release:()=>this._release(n)}},c=>{throw o.abortController=null,c})}return o.referenceCount++,new Promise((a,l)=>{Ma(s,()=>{l($i())}),o.textureAsync.then(a,l)}).catch(a=>{throw this._release(n),a})}_createTexture(t,i,r){const s={...this._parameters,powerOfTwoResizeMode:jv.PAD};if(aX(t)){if(r||i.width===0&&i.height===0){const n=i.width?i.height/i.width:1;r=r||64,n>1?(i.width=Math.round(r/n),i.height=r):(i.width=r,i.height=Math.round(r*n))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(s.preMultiplyAlpha=!1)}return s.width=i.width,s.height=i.height,new sn(i,s)}}class Aut{constructor(t){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=t.viewState,this.view=t.view,this.pointsOfInterest=t.pointsOfInterest,this.objectResourceCache=t.objectResourceCache,this.streamDataRequester=t.resourceController.createStreamDataRequester(hm.SYMBOLOGY),this.textures=new Cut(this.streamDataRequester,t.view._stage,{preMultiplyAlpha:!0,wrap:{s:Ft.CLAMP_TO_EDGE,t:Ft.CLAMP_TO_EDGE}},t.resourceController.scheduler);const i=ji(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=Awe(t.viewingMode,i),this.screenSizePerspectiveSettingsLabels=uJe(t.viewingMode,i)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(t){if(!t)return md();this.graphicsOwners.push(t);const i=xe(()=>{var r;return(r=t.layer)==null?void 0:r.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),md(()=>{i.remove(),Ak(this.graphicsOwners,t),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const t=this.graphicsOwners.some(i=>{var r;return((r=i.layer)==null?void 0:r.screenSizePerspectiveEnabled)===!0});if(t&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new xi;const i=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([xe(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,i,Rr),this.viewState.events.on("camera-projection-changed",i)]),this._updateScreenSizePerspectiveSettings()}else!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){const t=this.pointsOfInterest;RD.distance=t.centerOnSurfaceInfrequent.distance,RD.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(RD),this.screenSizePerspectiveSettingsLabels.update(RD),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const RD={distance:0,fovY:0};class q_{constructor(t,i,r=""){this.graphics=t,this._symbol=new wv({symbolLayers:[new bv({material:{color:i},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new pT({text:r,halo:{color:"white",size:1/.75},material:{color:i},size:12})]})}show(t,i){if(N(i))return;this.hide();const r=new xt({x:t[0],y:t[1],z:t[2],spatialReference:i});this._graphic=new ul({geometry:r,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){w(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let fv=class extends ze{constructor(e){super(e),this.handles=new xi}destroy(){this.handles.destroy()}};u([f({constructOnly:!0})],fv.prototype,"renderCoordsHelper",void 0),u([f({constructOnly:!0})],fv.prototype,"surface",void 0),u([f({constructOnly:!0})],fv.prototype,"state",void 0),fv=u([B("esri.views.3d.support.PointOfInterest")],fv);const Out=Array;let wu=class extends fv{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new Wy({location:xt,renderLocation:Out},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=F(),this.tmpPoint=new xt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(Fo(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,t=Pr(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return Qx(i,t,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let e=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:e.signal,cache:this.cache}).then(t=>this._updateSurfaceAltitude(t.geometry.z)).catch(t=>{Cs(t)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===e&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),e=null}),this._pendingElevationQueryController=e}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(g9,this._estimatedSurfaceAltitude,this._camera.eye),zl(this._get("renderLocation"),g9)||this._set("renderLocation",ve(this._propertiesPool.get("renderLocation"),g9))}};u([f({constructOnly:!0})],wu.prototype,"scheduler",void 0),u([f({constructOnly:!0})],wu.prototype,"cache",void 0),u([f({constructOnly:!0})],wu.prototype,"task",void 0),u([f({constructOnly:!0})],wu.prototype,"cameraName",void 0),u([f({readOnly:!0})],wu.prototype,"location",null),u([f({constructOnly:!0})],wu.prototype,"map",void 0),u([f({readOnly:!0})],wu.prototype,"renderLocation",void 0),u([f({readOnly:!0})],wu.prototype,"scale",null),u([f({readOnly:!0})],wu.prototype,"updating",null),wu=u([B("esri.views.3d.support.CameraOnSurface")],wu);const g9=F(),Rut=Array;let xc=class extends fv{constructor(e){super(e),this._propertiesPool=new Wy({location:xt,renderLocation:Rut},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=F(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=Ln(this._frameWorker),this._propertiesPool=Tt(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const e=Put;let t=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!t&&i&&(t=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),t&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const r=Iut;t&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,r)&&(ve(e,r),this._currentSurfaceAltitude=this._latestSurfaceAltitude),t?this.distance=Pr(this._camera.eye,e):(be(e,this._camera.viewForward,this._get("distance")),Oe(e,e,this._camera.eye)),zl(this._get("renderLocation"),e)||this._set("renderLocation",ve(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,t){const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,t))return!1;if(this.state.isGlobal){const r=ji(this.renderCoordsHelper.spatialReference).radius,s=r+e,n=rl(i.eye),o=n<s*s,a=Pr(i.eye,t);if(o&&a>r/4){const l=s-Math.sqrt(n);return be(t,i.viewForward,l),Oe(t,t,i.eye),!0}}else{const r=this.surface.ready?this.surface.extent:null;w(r)&&aU(r,this.surface.spatialReference,$O,this.renderCoordsHelper.spatialReference)&&(t[0]=Xe(t[0],$O[0],$O[2]),t[1]=Xe(t[1],$O[1],$O[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,t){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,t)){if(ur.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,r=Pr(i,e),s=Pr(i,t);if(Math.abs(s-r)/r>Mut)return!0}return!1}};u([f({constructOnly:!0})],xc.prototype,"scheduler",void 0),u([f({constructOnly:!0})],xc.prototype,"task",void 0),u([f({constructOnly:!0})],xc.prototype,"cameraName",void 0),u([f()],xc.prototype,"distance",void 0),u([f({constructOnly:!0})],xc.prototype,"estimateSurfaceAltitudeAtCenter",void 0),u([f({readOnly:!0})],xc.prototype,"location",null),u([f({readOnly:!0})],xc.prototype,"renderLocation",void 0),u([f()],xc.prototype,"updating",void 0),xc=u([B("esri.views.3d.support.CenterOnSurface")],xc);const Mut=.05,Put=F(),Iut=F(),$O=ei();class Lut{constructor(t){this.handles=new xi,this.events=new ks,this.contentLayerViews=t.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",i=>this._layerViewsChanged(i))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(t){t.added.forEach(i=>{i.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this.handles.add(i.on("visible-geometry-changed",()=>this._contentChanged()),i.uid)}),t.removed.forEach(i=>this.handles.remove(i.uid))}_contentChanged(){this.events.emit("request-update",$ut)}}const $ut={},Dut=Array;let Wf=class extends fv{constructor(e){super(e),this._propertiesPool=new Wy({location:xt,renderLocation:Dut},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([xe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),xe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(It.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),t=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,r=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(t,Hle);const s=Math.max(0,(Math.acos(ke(Hle,r.viewForward))-.5*Math.PI)*(r.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!Tx(e,t)){const l=this._propertiesPool.get("renderLocation");ve(l,t),this._set("renderLocation",l)}return}const n=1-Xe(s/(.5*Math.PI),0,1),o=n*n*n;this._calculateScreenHorizontalEdgeOnSurface(qle);const a=this._propertiesPool.get("renderLocation");Nn(a,t,qle,o),e&&Tx(e,a)||this._set("renderLocation",a)}_calculateScreenHorizontalEdgeOnSurface(e){const t=this.state.contentCamera,i=t.getRenderCenter(sa());if(i[1]=t.aboveGround?t.padding[Ht.BOTTOM]:t.fullHeight-t.padding[Ht.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const r=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(t.unprojectFromRenderScreen(i,DO)){Me(DO,DO,t.eye);const s=De(DO,DO);if(this.renderCoordsHelper.intersectManifold(sh(t.eye,s),r,e))return e}return this.renderCoordsHelper.setAltitude(e,r,t.eye)}updateRenderLocation(){this._dirty=!0}};u([f()],Wf.prototype,"_dirty",void 0),u([f({constructOnly:!0})],Wf.prototype,"scheduler",void 0),u([f({constructOnly:!0})],Wf.prototype,"centerOnSurface",void 0),u([f({constructOnly:!0})],Wf.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),u([f({readOnly:!0})],Wf.prototype,"updating",null),u([f({readOnly:!0})],Wf.prototype,"location",null),u([f({readOnly:!0})],Wf.prototype,"renderLocation",void 0),Wf=u([B("esri.views.3d.support.CenterOnSurface")],Wf);const Hle=F(),DO=F(),qle=F();let ey=class extends ze{constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new xi}get renderLocation(){if(!this.location)return null;const e=F();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}initialize(){this.view.state.isLocal&&(this._handles.add([xe(()=>{var e,t;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(t=this.surfaceView)==null?void 0:t.extent]},()=>this._update()),Fo(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||N(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const e=XZ(this.surfaceView.extent),t=new xt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Cs(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",t)}};u([f({constructOnly:!0})],ey.prototype,"view",void 0),u([f({constructOnly:!0})],ey.prototype,"cache",void 0),u([f({readOnly:!0,aliasOf:"view.map.ground"})],ey.prototype,"surface",void 0),u([f({readOnly:!0,aliasOf:"view.basemapTerrain"})],ey.prototype,"surfaceView",void 0),u([f({readOnly:!0})],ey.prototype,"location",void 0),u([f({readOnly:!0})],ey.prototype,"renderLocation",null),ey=u([B("esri.views.3d.terrain.StableSurfaceCenter")],ey);let ty=class extends ze{constructor(){super(...arguments),this.handles=new xi,this._tileGeometryUpdateExtent=th(),this._tileGeometryUpdateSpatialReference=null,this.events=new ks,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(It.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=Tt(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",Nut),th(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,nx(this._tileGeometryUpdateExtent,e.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let t=1;t<this.centerOnSurfaces.length;t++){const i=this.centerOnSurfaces[t];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,t){const i=this.state.camera.eye,r=Fut,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,wb,t),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,xb,t),wb[0]<xb[0]?(r[0]=wb[0],r[2]=xb[0]):(r[0]=xb[0],r[2]=wb[0]),wb[1]<xb[1]?(r[1]=wb[1],r[3]=xb[1]):(r[1]=xb[1],r[3]=wb[1]),H3(r,e)}};u([f({constructOnly:!0})],ty.prototype,"state",void 0),u([f({constructOnly:!0})],ty.prototype,"centerOnSurfaces",void 0),u([f({constructOnly:!0})],ty.prototype,"renderCoordsHelper",void 0),u([f({constructOnly:!0})],ty.prototype,"scheduler",void 0),u([f({constructOnly:!0})],ty.prototype,"surface",void 0),u([f({readOnly:!0})],ty.prototype,"updating",void 0),ty=u([B("esri.views.3d.support.SurfaceGeometryUpdates")],ty);const Nut={},wb=F(),xb=F(),Fut=th();let xa=class extends ze{constructor(e){super(e),this._handles=new xi,this._tmpRay=Lo(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new Wy({renderPointOfView:kut},this),this.renderPointOfView=F(),this._pois=new Array,this._debugCenters=new Map}initialize(){var c;const{state:e,basemapTerrain:t,renderCoordsHelper:i,map:r}=this.view;this._surfaceIntersector=wd(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Uo.MIN,this._contentIntersector=wd(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),n=this.view.resourceController.scheduler,o=(c=this.view.basemapTerrain)==null?void 0:c.elevationQueryCache,a={state:e,scheduler:n,surface:t,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new xc({...a,task:It.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new xc({...a,task:It.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("contentCenterOnSurface",new xc({...a,task:It.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s,cameraName:"contentCamera"})),this._set("centerOnContent",new xc({...a,task:It.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new wu({...a,cache:o,task:It.POINT_OF_INTEREST_INFREQUENT,map:r})),this._set("contentCameraOnSurface",new wu({...a,cache:o,task:It.POINT_OF_INTEREST_INFREQUENT,map:r,cameraName:"contentCamera"})),this._set("surfaceGeometryUpdates",new ty({...a,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new Lut({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new ey({cache:o,view:this.view})),this._set("focus",new Wf({state:e,scheduler:n,surface:t,renderCoordsHelper:i,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(h,p)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,p)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const l=this.view.graphics;this._debugCenters.set(this.centerOnContent,new q_(l,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new q_(l,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new q_(l,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new q_(l,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new q_(l,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new q_(l,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new q_(l,"green","Focus")),this._handles.add([xe(()=>e.camera,h=>this._cameraChanged(h),Rr),xe(()=>t.extent,()=>this._updateCenterPointsOfInterest()),Jl(()=>!t.updating,()=>this._updateCenterPointsOfInterest(),Rr),Fo(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),Fo(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),Jl(()=>ur.SHOW_POI,h=>this._setDebug(h),si)]),this._cameraChanged(this.view.state.camera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(t=>t.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this.centerRay;return N(e)||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,TS,zut)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(TS):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this.centerRay;if(N(e))return this._surfaceAltitudeAtCenter;const t=e.origin,i=Oe(TS,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,t,i),this._surfaceIntersector.results.min.getIntersectionPoint(TS)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(TS)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,t,i){const r=YQ(t,e,Uut);if(N(r))return null;const s=r.origin,n=Oe(TS,r.origin,r.direction);return this._surfaceIntersector.resetWithRay(r,t),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,n),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const t=e.eye;zl(this.renderPointOfView,t)||this._set("renderPointOfView",ve(this._propertiesPool.get("renderPointOfView"),t))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(t=>t.hide()),void this._handles.remove("debug");for(const t of this._pois)this._handles.add(xe(()=>t.renderLocation,i=>this._debugCenters.get(t).show(i,t.renderCoordsHelper.spatialReference),si),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};u([f({readOnly:!0})],xa.prototype,"centerOnContent",void 0),u([f({readOnly:!0})],xa.prototype,"centerOnSurfaceFrequent",void 0),u([f({readOnly:!0})],xa.prototype,"centerOnSurfaceInfrequent",void 0),u([f({readOnly:!0})],xa.prototype,"contentCenterOnSurface",void 0),u([f({readOnly:!0})],xa.prototype,"cameraOnSurface",void 0),u([f({readOnly:!0})],xa.prototype,"contentCameraOnSurface",void 0),u([f({readOnly:!0})],xa.prototype,"focus",void 0),u([f({readOnly:!0})],xa.prototype,"renderPointOfView",void 0),u([f({readOnly:!0})],xa.prototype,"surfaceOrigin",void 0),u([f({readOnly:!0})],xa.prototype,"contentGeometryUpdates",void 0),u([f({readOnly:!0})],xa.prototype,"surfaceGeometryUpdates",void 0),u([f({constructOnly:!0})],xa.prototype,"view",void 0),u([f({readOnly:!0})],xa.prototype,"updating",null),xa=u([B("esri.views.3d.support.PointsOfInterest")],xa);const kut=Array,TS=F(),Uut=Lo(),zut={exclude:new Set([Sp])};class But{constructor(t){this.store=t}destroy(){this.store.destroy()}get(t){return this.store.get(t)}put(t,i){this.store.put(t,i,i.values.byteLength+256)}}const Vut=Ie.getLogger("esri.core.workers.WorkerHandle");class GSe{constructor(t,i,r,s,n={}){this._mainMethod=i,this._transferLists=r,this._listeners=[],this._promise=Wfe(t,{...n,schedule:s}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,n.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>Vut.error(`Failed to initialize ${t} worker: ${o}`))}on(t,i){const r={removed:!1,eventName:t,callback:i,threadHandle:null};return this._listeners.push(r),this._connectListener(r),md(()=>{r.removed=!0,tZ(this._listeners,r),this._thread&&w(r.threadHandle)&&r.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(t,i){return this.invokeMethod(this._mainMethod,t,i)}invokeMethod(t,i,r){if(this._thread){const s=this._transferLists[t],n=s?s(i):[];return this._thread.invoke(t,i,{transferList:n,signal:r})}return this._promise?this._promise.then(()=>(Ui(r),this.invokeMethod(t,i,r))):Promise.reject(null)}broadcast(t,i){return this._thread?Promise.all(this._thread.broadcast(i,t)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(t,i)):Promise.reject()}get promise(){return this._promise}_connectListener(t){this._thread&&this._thread.on(t.eventName,t.callback).then(i=>{t.removed||(t.threadHandle=i)})}}class Wle extends GSe{constructor(t=null){super("LercWorker","_decode",{_decode:i=>[i.buffer]},t,{strategy:"dedicated"}),this.schedule=t,this.ref=0}decode(t,i,r){return t&&t.byteLength!==0?this.invoke({buffer:t,options:i},r):Promise.resolve(null)}release(){--this.ref<=0&&(JM.forEach((t,i)=>{t===this&&JM.delete(i)}),this.destroy())}}const JM=new Map;function Gut(e=null){let t=JM.get(e);return t||(w(e)?(t=new Wle(i=>e.schedule(i)),JM.set(e,t)):(t=new Wle,JM.set(null,t))),++t.ref,t}function Dy(){const e=new Float32Array(9);return e[0]=1,e[4]=1,e[8]=1,e}function jSe(e){const t=new Float32Array(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function jut(e,t,i,r,s,n,o,a,l){const c=new Float32Array(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=s,c[5]=n,c[6]=o,c[7]=a,c[8]=l,c}function Hut(e,t){return new Float32Array(e,t,9)}Object.freeze(Object.defineProperty({__proto__:null,create:Dy,clone:jSe,fromValues:jut,createView:Hut},Symbol.toStringTag,{value:"Module"}));var Zle,Oc,Xle,Yle,Qle;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.FILL_VERTEX=1]="FILL_VERTEX",e[e.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",e[e.FILL_INDEX=3]="FILL_INDEX",e[e.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",e[e.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",e[e.OUTLINE_INDEX=6]="OUTLINE_INDEX",e[e.LINE_VERTEX=7]="LINE_VERTEX",e[e.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",e[e.LINE_INDEX=9]="LINE_INDEX",e[e.ICON_VERTEX=10]="ICON_VERTEX",e[e.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",e[e.ICON_INDEX=12]="ICON_INDEX",e[e.TEXT_VERTEX=13]="TEXT_VERTEX",e[e.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",e[e.TEXT_INDEX=15]="TEXT_INDEX",e[e.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",e[e.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(Zle||(Zle={})),function(e){e[e.FILL=1]="FILL",e[e.LINE=2]="LINE",e[e.SYMBOL=3]="SYMBOL",e[e.CIRCLE=4]="CIRCLE"}(Oc||(Oc={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.OPAQUE=1]="OPAQUE",e[e.TRANSLUCENT=2]="TRANSLUCENT",e[e.SYMBOLS=3]="SYMBOLS",e[e.HITTEST=4]="HITTEST"}(Xle||(Xle={})),function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.FILL=1]="FILL",e[e.OUTLINE=2]="OUTLINE",e[e.LINE=3]="LINE",e[e.ICON=4]="ICON",e[e.CIRCLE=5]="CIRCLE",e[e.TEXT=6]="TEXT",e[e.TILEINFO=7]="TILEINFO"}(Yle||(Yle={})),function(e){e[e.PAINTER_CHANGED=0]="PAINTER_CHANGED",e[e.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",e[e.LAYER_CHANGED=2]="LAYER_CHANGED",e[e.LAYER_REMOVED=3]="LAYER_REMOVED",e[e.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(Qle||(Qle={}));class qut{constructor(t){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t}}class owt{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}function awt(e,t,i,r,s,n){const o=i-s;if(o>=0)return(t>>o)+(r-(n<<o))*(e>>o);const a=-o;return t-(n-(r<<a))*(e>>a)<<a}class lwt{constructor(t,i,r){this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(let s=0;s<this._rows;s++){this.cells[s]=new Array(this._columns);for(let n=0;n<this._columns;n++)this.cells[s][n]=[]}}getCell(t,i){const r=Math.min(Math.max(Math.floor(i/this._cellSize),0),this._rows-1),s=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][s]||null}getCellSpan(t,i,r,s){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(s/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function Wut(e,t,i,r,s,n){const o=t[r++];for(let a=0;a<o;a++){const l=new qut(n);l.xTile=t[r++],l.yTile=t[r++],l.hash=t[r++],l.priority=t[r++];const c=t[r++];for(let m=0;m<c;m++){const g=t[r++],v=t[r++],b=t[r++],S=t[r++],T=!!t[r++],O=t[r++],C=i[r++],M=i[r++],I=t[r++],$=t[r++];l.colliders.push({xTile:g,yTile:v,dxPixels:b,dyPixels:S,hard:T,partIndex:O,width:I,height:$,minLod:C,maxLod:M})}const h=e[r++];for(let m=0;m<h;m++)l.textVertexRanges.push([e[r++],e[r++]]);const p=e[r++];for(let m=0;m<p;m++)l.iconVertexRanges.push([e[r++],e[r++]]);s.push(l)}return r}function cwt(e,t,i){for(const[r,s]of e.symbols)Zut(e,t,i,s,r)}function Zut(e,t,i,r,s){const n=e.layerData.get(s);if(n.type===Oc.SYMBOL){for(const o of r){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const m=i?Math.floor(127*h)|p<<7:p?255:0;l=m<<24|m<<16|m<<8|m}else l=0;for(const[c,h]of o.iconVertexRanges)for(let p=c;p<c+h;p+=4)n.iconOpacity[p/4]=l;if(o.selectedForRendering){const c=a.parts[1],h=c.startOpacity,p=c.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&p===0;const m=i?Math.floor(127*h)|p<<7:p?255:0;l=m<<24|m<<16|m<<8|m}else l=0;for(const[c,h]of o.textVertexRanges)for(let p=c;p<c+h;p+=4)n.textOpacity[p/4]=l}n.lastOpacityUpdate=t,n.opacityChanged=!0}}class eB{constructor(t,i){this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;let r=1;const s=new Uint32Array(t);this.layerUIDs=[];const n=s[r++];for(let o=0;o<n;o++)this.layerUIDs[o]=s[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return N(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(t){N(this.data)||(this.doPrepareForRendering(t,this.data,this.bufferDataOffset),this.data=null)}}class Xut extends eB{constructor(t,i){super(t,i),this.type=Oc.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.lineIndexStart=r[s++],this.lineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){w(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),w(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),w(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.lineVertexBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.lineIndexBuffer=Ai.createIndex(t,Gi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.lineMaterial;this.lineVertexArrayObject=new pn(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class Yut extends eB{constructor(t,i){super(t,i),this.type=Oc.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.fillIndexStart=r[s++],this.fillIndexCount=r[s++],this.outlineIndexStart=r[s++],this.outlineIndexCount=r[s++];const n=r[s++];if(n>0){const o=new Map;for(let a=0;a<n;a++){const l=r[s++],c=r[s++],h=r[s++];o.set(l,[c,h])}this.patternMap=o}this.bufferDataOffset=s}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){w(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),w(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),w(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,w(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),w(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),w(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.fillVertexBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.fillIndexBuffer=Ai.createIndex(t,Gi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.outlineVertexBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.outlineIndexBuffer=Ai.createIndex(t,Gi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c;const h=this.layer,p=h.fillMaterial,m=h.outlineMaterial;this.fillVertexArrayObject=new pn(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new pn(t,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class Qut extends eB{constructor(t,i,r){super(t,i),this.type=Oc.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const s=new Uint32Array(t),n=new Int32Array(t),o=new Float32Array(t);let a=this.bufferDataOffset;this.isIconSDF=!!s[a++];const l=s[a++];for(let m=0;m<l;m++){const g=s[a++],v=s[a++],b=s[a++];this.iconPerPageElementsMap.set(g,[v,b])}const c=s[a++];for(let m=0;m<c;m++){const g=s[a++],v=s[a++],b=s[a++];this.glyphPerPageElementsMap.set(g,[v,b])}const h=s[a++],p=s[a++];this.iconOpacity=new Int32Array(h),this.textOpacity=new Int32Array(p),a=Wut(s,n,o,a,this.symbols,r),this.bufferDataOffset=a}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let t=0;for(const[i,r]of this.iconPerPageElementsMap)t+=r[1];for(const[i,r]of this.glyphPerPageElementsMap)t+=r[1];return t/3}doDestroy(){w(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),w(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),w(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),w(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,w(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),w(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),w(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),w(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const t=this.iconOpacity,i=this.iconOpacityBuffer;t.length>0&&t.byteLength===i.size&&i.setSubData(t);const r=this.textOpacity,s=this.textOpacityBuffer;r.length>0&&r.byteLength===s.size&&s.setSubData(r)}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.iconVertexBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.iconIndexBuffer=Ai.createIndex(t,Gi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=s[r++];this.textVertexBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;const c=s[r++];this.textIndexBuffer=Ai.createIndex(t,Gi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,c)),r+=c,this.iconOpacityBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,this.iconOpacity.buffer),this.textOpacityBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,this.textOpacity.buffer);const h=this.layer,p=h.iconMaterial,m=h.textMaterial;this.iconVertexArrayObject=new pn(t,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new pn(t,m.getAttributeLocations(),m.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class Jut extends eB{constructor(t,i){super(t,i),this.type=Oc.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const r=new Uint32Array(t);let s=this.bufferDataOffset;this.circleIndexStart=r[s++],this.circleIndexCount=r[s++],this.bufferDataOffset=s}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){w(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),w(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),w(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(t,i,r){const s=new Uint32Array(i),n=new Int32Array(s.buffer),o=s[r++];this.circleVertexBuffer=Ai.createVertex(t,Gi.STATIC_DRAW,new Int32Array(n.buffer,4*r,o)),r+=o;const a=s[r++];this.circleIndexBuffer=Ai.createIndex(t,Gi.STATIC_DRAW,new Uint32Array(s.buffer,4*r,a)),r+=a;const l=this.layer.circleMaterial;this.circleVertexArrayObject=new pn(t,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}const uwt=!0,hwt=32,Jle=200,Kut=1/Ce("mapview-transitions-duration");class eht extends ks{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(t){this._clips=t,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(t){this._opacity!==t&&(this._opacity=Math.min(1,Math.max(t,0)),this.requestRender())}get stage(){return this._stage}set stage(t){if(this._stage===t)return;const i=this._stage;this._stage=t,t?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):i.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return N(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(t){this._visible!==t&&(this._visible=t,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Gp(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Gp(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(t){this.updateTransitionProperties(t.deltaTime,t.state.scale)}afterRender(t){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t){}processRender(t){this.stage&&this.computedVisible&&this.doRender(t)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(t,i){if(this.fadeTransitionEnabled){const r=this._fadeOutResolver||!this.visible?0:this.opacity,s=this.computedOpacity;if(s===r)this.computedVisible=this.visible;else{const n=t*Kut;this.computedOpacity=s>r?Math.max(r,s-n):Math.min(r,s+n),this.computedVisible=this.computedOpacity>0;const o=r===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(t){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}class am{constructor(t,i,r,s){this.set(t,i,r,s)}static getId(t,i,r,s){return typeof t=="object"?`${t.level}/${t.row}/${t.col}/${t.world}`:`${t}/${i}/${r}/${s}`}get key(){return this}get id(){return this.toString()}set id(t){this.set(t)}get hash(){const t=4095&this.row,i=4095&this.col,r=63&this.level;return(3&this.world)<<30|i<<22|t<<8|r}acquire(t,i,r,s){this.set(t,i,r,s)}contains(t){const i=t.level-this.level;return this.row===t.row>>i&&this.col===t.col>>i&&this.world===t.world}equals(t){return this.level===t.level&&this.row===t.row&&this.col===t.col&&this.world===t.world}clone(){return new am(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(t,i,r,s){if(t==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof t=="object")this.level=t.level||0,this.row=t.row||0,this.col=t.col||0,this.world=t.world||0;else if(typeof t=="string"){const[n,o,a,l]=t.split("/");this.level=parseFloat(n),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+t,this.row=+i,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new am(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const t=this.level+1,i=this.row<<1,r=this.col<<1,s=this.world;return[new am(t,i,r,s),new am(t,i,r+1,s),new am(t,i+1,r,s),new am(t,i+1,r+1,s)]}compareRowMajor(t){return this.row<t.row?-1:this.row>t.row?1:this.col<t.col?-1:this.col>t.col?1:0}}am.pool=new qs(am,null,null,25,50);class tht extends eht{constructor(t,i,r,s,n,o=s,a=n){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new am(t),this.x=i,this.y=r,this.width=s,this.height=n,this.rangeX=o,this.rangeY=a}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(t,i){const r=i/(t.resolution*t.pixelRatio),s=this.transforms.tileMat3,[n,o]=t.toScreenNoRotation([0,0],[this.x,this.y]),a=this.width/this.rangeX*r,l=this.height/this.rangeY*r;TQ(s,a,0,0,0,l,0,n,o,1),XU(this.transforms.dvs,t.displayViewMat3,s)}}class KM extends tht{constructor(t,i,r,s,n,o,a=null){super(t,i,r,s,n,4096,4096),this._memCache=a,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=o,this.id=t.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<Jle}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<Jle)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(t){this.changeDataImpl(t),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(t){let i=!1;for(const r of t)if(this.layerData.has(r)){const s=this.layerData.get(r);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Oc.SYMBOL&&this.symbols.has(r)&&(this.symbols.delete(r),i=!0),s.destroy(),this.layerData.delete(r),this.layerCount--}w(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),i&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(HSe.delete(this),KM._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(t){let i=!1;if(t){const{bucketsWithData:r,emptyBuckets:s}=t,n=this._createRenderBuckets(r);if(s&&s.byteLength>0){const o=new Uint32Array(s);for(const a of o)this._deleteLayerData(a)}for(const[o,a]of n)this._deleteLayerData(o),a.type===Oc.SYMBOL&&(this.symbols.set(o,a.symbols),i=!0),this._memoryUsedByLayerData+=a.memoryUsed,this.layerData.set(o,a),this.layerCount++;w(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[r,s]of this.layerData)s.type===Oc.SYMBOL&&(this._hasSymbolBuckets=!0);i&&this.emit("symbols-changed")}attachWithContext(t){this.stage={context:t,trashDisplayObject(i){i.processDetach()},untrashDisplayObject:()=>!1}}setTransform(t,i){super.setTransform(t,i);const r=i/(t.resolution*t.pixelRatio),s=this.width/this.rangeX*r,n=this.height/this.rangeY*r,o=[0,0];t.toScreen(o,[this.x,this.y]);const a=this.transforms.tileUnitsToPixels;SQ(a),T5(a,a,o),EQ(a,a,Math.PI*t.rotation/180),CQ(a,a,[s,n,1])}_createTransforms(){return{dvs:Dy(),tileMat3:Dy(),tileUnitsToPixels:Dy()}}static _destroyRenderBuckets(t){if(!t)return;const i=new Set;t.forEach(r=>{i.has(r)||(r.destroy(),i.add(r))}),t.clear()}_createRenderBuckets(t){const i=new Map,r=new Map;for(const s of t){const n=this._deserializeBucket(s,r);for(const o of n.layerUIDs)i.set(o,n)}return i}_deserializeBucket(t,i){let r=i.get(t);if(r)return r;switch(new Uint32Array(t)[0]){case Oc.FILL:r=new Yut(t,this.styleRepository);break;case Oc.LINE:r=new Xut(t,this.styleRepository);break;case Oc.SYMBOL:r=new Qut(t,this.styleRepository,this);break;case Oc.CIRCLE:r=new Jut(t,this.styleRepository)}return i.set(t,r),r}_deleteLayerData(t){if(!this.layerData.has(t))return;const i=this.layerData.get(t);this._memoryUsedByLayerData-=i.memoryUsed,i.destroy(),this.layerData.delete(t),this.layerCount--}}const HSe=new Map;function iht(){HSe.forEach((e,t)=>{console.log(`
${t.key}:`),e[0].forEach(i=>console.log(i)),console.log("========"),e[1].forEach(i=>console.log(i))})}const dwt={value:.5,readOnly:!0},rht={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};class eK{constructor(t=0,i=0){this.min=t,this.max=i,this.level=0,this.hasNoDataValues=!1}copyFrom(t){this.min=t.min,this.max=t.max,this.level=t.level,this.hasNoDataValues=t.hasNoDataValues}}class sht{constructor(t,i,r){this.type="elevation",this.samplerData=null,this.level=t[0],this.i=t[1],this.j=t[2],this.extent=i;const s=r.noDataValue,n=r.values;let o=1/0,a=-1/0,l=!0,c=!1;for(let h=0;h<n.length;h++){const p=n[h];p!==s?(o=p<o?p:o,a=p>a?p:a,l=!1):c=!0}l&&(o=0,a=0),a=a>-3e38?a:0,this.samplerData={pixelData:r.values,width:r.width,height:r.height,noDataValue:s,safeWidth:.99999999*(r.width-1),dx:(r.width-1)/(i[2]-i[0]),dy:(r.width-1)/(i[3]-i[1]),x0:i[0],y1:i[3]},this.bounds=[o,a],this.hasNoDataValues=c}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(t,i,r,s){s.min=1/0,s.max=-1/0,s.hasNoDataValues=!1;const n=t-this.level;if(n<=0)return s;const o=2**n;if(!(Math.floor(i/o)===this.i&&Math.floor(r/o)===this.j))return s;let a=1/0,l=-1/0;const c=this.samplerData.width,h=this.samplerData.pixelData,p=.5*NP;let m=(c-1)/o,g=(r-this.j*o)*m,v=(i-this.i*o)*m;if(m<1){const b=Math.floor(g),S=Math.floor(v),T=b+S*c,O=h[T],C=h[T+1],M=h[T+c],I=h[T+c+1];if(O+C+M+I<p){const $=g-b,U=v-S,q=OL(O,C,M,I,$,U),G=OL(O,C,M,I,$+m,U),Y=OL(O,C,M,I,$,U+m),J=OL(O,C,M,I,$+m,U+m);return s.min=Math.min(q,G,Y,J),s.max=Math.max(q,G,Y,J),s}g=b,v=S,m=1}else g=Math.floor(g),v=Math.floor(v),m=Math.ceil(m);for(let b=g;b<=g+m;b++)for(let S=v;S<=v+m;S++){const T=h[b+S*c];T<p?(a=Math.min(a,T),l=Math.max(l,T)):s.hasNoDataValues=!0}return s.min=a,s.max=l,s}}function qSe(e,t,i){if(N(i))return null;for(const r of i){if(!r)continue;const s=r.safeWidth;let n=Xe(r.dy*(r.y1-t),0,s),o=Xe(r.dx*(e-r.x0),0,s);const a=Math.floor(n),l=Math.floor(o),c=r.width,h=a*c+l,p=r.pixelData,m=p[h],g=p[h+1],v=h+c,b=p[v],S=p[v+1];if(m+b+g+S<.5*NP){n-=a,o-=l;const T=m+(g-m)*o;return T+(b+(S-b)*o-T)*n}}return null}function Gr(e,t,i){const r=qSe(e,t,i);return w(r)?r:0}let Vh=class extends ze{constructor(e){super(e),this._handles=new xi}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const i=t.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const r=WSe(i.fullExtent,this.viewSpatialReference);w(r)&&e.push(zpe(r))}}),e}};function nht(e,t){return e===st.Global?new OW(t):new RW(t)}u([f({readOnly:!0})],Vh.prototype,"layerViewsExtent",null),u([f({readOnly:!0})],Vh.prototype,"tiledLayersExtent",null),u([f({readOnly:!0})],Vh.prototype,"stencilEnabledExtents",null),u([f()],Vh.prototype,"viewSpatialReference",void 0),u([f()],Vh.prototype,"tilingScheme",void 0),u([f()],Vh.prototype,"defaultTiledLayersExtent",void 0),u([f({constructOnly:!0})],Vh.prototype,"layers",void 0),u([f({constructOnly:!0})],Vh.prototype,"layerViews",void 0),Vh=u([B("esri.views.3d.terrain.ExtentHelper")],Vh);let OW=class extends Vh{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?jve:qGe}};OW=u([B("esri.views.3d.terrain.ExtentHelperGlobal")],OW);let RW=class extends Vh{_computeLayerViewsExtent(){const e=th(),t=this.viewSpatialReference;this.layerViews.forEach(s=>{const n=s.layer;if(s.isResolved()&&(n.type!=="graphics"||!n.internal)){const o=WSe("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,t);nx(e,o,e)}});const i=c7(e)?e:null,r=this._get("layerViewsExtent");return ox(i,r)?r:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,i=th();this.layers.forEach(n=>{if(n.loaded&&EM(n)){const o=Kz(n,t,st.Local);if(N(o))return;const{tileInfo:a,fullExtent:l}=o;w(a)&&w(l)&&(uk(n)||e.compatibleWith(a)&&l.spatialReference.equals(e.spatialReference))&&nx(i,l,i)}}),nx(i,this.defaultTiledLayersExtent,i);const r=c7(i)?i:null,s=this._get("tiledLayersExtent");return ox(r,s)?s:r}};function WSe(e,t){return w(e)&&!e.spatialReference.equals(t)?bme(e,e.spatialReference,t):e}RW=u([B("esri.views.3d.terrain.ExtentHelperLocal")],RW);var mi;(function(e){e[e.ELEVATION=0]="ELEVATION",e[e.MAP=1]="MAP"})(mi||(mi={}));const hw=[mi.ELEVATION,mi.MAP];function ZSe(){var t;const e=(t=globalThis.require)==null?void 0:t.modules;if(e){const i=Object.keys(e);for(const r of i)r.search(".glsl")!==-1&&delete e[r]}}const oht=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let o_,Rl=class extends ze{constructor(e){super(e),this._handles=new xi,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=Ce("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||ur.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return w(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?ji(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const e=this.view;this.renderer=new ap({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=wd(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",t=>{var i;return(i=e._stage)==null?void 0:i.renderView.setRenderParameters({hasOverlayWater:t})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),xe(()=>{var t,i,r;return[(t=e.pointsOfInterest)==null?void 0:t.renderPointOfView,(r=(i=e.pointsOfInterest)==null?void 0:i.centerOnSurfaceFrequent)==null?void 0:r.location]},()=>this.setPlacementDirty()),xe(()=>{var t;return(t=e.state)==null?void 0:t.pixelRatio},()=>this.setPlacementDirty(),Rr),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),xx({preRender:t=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(t),this._drawOverlayTextures(this.renderer.overlays,on.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),e.resourceController.scheduler.registerTask(It.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",t=>{this._updateOverlays(t,on.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,on.BACKGROUND,t)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),w(o_)&&(o_.hide(),o_=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const t=this.view.renderSpatialReference;w(e)&&w(t)?(this._renderSR=t,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Jv(-20037508342787e-6,20037508342787e-6):new Jv(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,t,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const r=this.renderer.createDrapeSourceRenderer(e,t,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),r}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,em)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&w(e.setDrapingExtent)&&w(this._spatialReference)&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,on.UPDATE)}_updateOverlays(e,t){if(!this._spatialReference)return;const i=wtt(e.fullWidth,e.fullHeight,this._maxResolution);this._computeOverlayExtents(e,i,Ag);const r=Nu(Ag.inner)/Nu(Ag.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const s=this._updateOverlay(ns.INNER,Ag.inner,i,1*Ag.pixelRatioAdjustment,Ag.mapUnitsPerPixel),n=this._updateOverlay(ns.OUTER,Ag.outer,i,r*Ag.pixelRatioAdjustment,Ag.mapUnitsPerPixel);s!==im.EXTENT&&n!==im.EXTENT||(this._drapeSources.forEach(o=>this._updateDrapeSourceExtent(o)),this.surface.updateTileOverlayParams(t)),s===im.NONE&&n===im.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(e,t,i,r,s){if(this.renderer.overlays.length===0)return im.NONE;const n=this.renderer.overlays[e],o=n.mapUnitsPerPixel;if(n.mapUnitsPerPixel=s,n.pixelRatio=r,aht(t,n.extent)&&i===n.resolution)return o===s?im.NONE:im.RERENDER_ONLY;Gy(n.extent,t),n.resolution=i;const a=XZ(n.extent);return n.renderLocalOrigin=qM(a[0],a[1],0,"OV_"+this._latestOriginId++),im.EXTENT}setTileParameters(e){const t=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[ns.INNER],r=this.renderer.overlays[ns.OUTER],s=SN(e.extent,this.surface.extent,Kle);this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,r.extent)?(this._setTileOverlayData(s,ns.INNER,t),this._setTileOverlayData(s,ns.OUTER,t)):(this._clearTileOverlayData(ns.INNER,t),this._clearTileOverlayData(ns.OUTER,t))}else this._clearTileOverlayData(ns.INNER,t),this._clearTileOverlayData(ns.OUTER,t)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const t=this.renderer.overlays[ns.INNER],i=this.renderer.overlays[ns.OUTER],r=this._pointIsInExtent(e,t.extent)?t:i;return(r.extent[2]-r.extent[0])/r.resolution}_setTileOverlayData(e,t,i){if(this.renderer.overlays.length===0)return;const r=this.renderer.overlays[t].extent,s=Nu(r),n=Wp(r);let o=e[0];if(this._longitudeCyclical){o=this._longitudeCyclical.minimalMonotonic(r[0],o);const a=this._longitudeCyclical.minimalMonotonic(r[0],e[2]);o>a&&(o=a-(e[2]-e[0]))}i.setScale(t,Nu(e)/s,Wp(e)/n),i.setOffset(t,(o-r[0])/s,(e[1]-r[1])/n)}_clearTileOverlayData(e,t){t.setScale(e,-1,-1),t.setOffset(e,-1,-1)}async reloadShaders(){ZSe(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask()}_dispatchAnimationUpdate(e){const t=e.time-this._animationTimeLast;(t>=this.surface.view._stage.renderView.animationTimestep||w(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:t,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(e,t,i,r){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,cht,t,i);if(N(s))return!1;const n=s.origin,o=Oe(MD,s.origin,s.direction);return this._groundIntersector.reset(n,o,e),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,n,o),this._groundIntersector.results.min.getIntersectionPoint(r)}_findHorizonBasedPointOfInterest(e,t){let i=.5;const r=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),n=this.view.pointsOfInterest.centerOnSurfaceFrequent,o=1e-5,a=Xe(n.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+o,e.aboveGround?s-o:1/0),l=e.aboveGround;if(this.view.viewingMode==="global"){const c=MD;HC(uU(hU,ji(this.view.spatialReference).radius+a),sh(e.eye,e.viewForward),c),Me(c,c,e.eye);const h=Kv.normalize(JLe(e.viewForward,c,e.viewRight))/e.fovY+.5,p=h<=0||h>=1?.5:r;i=l?p*h:h+p*(1-h)}else{const c=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(c),p=ki(0,h,1,0),m=zu(p,p,e.projectionMatrix)[1],g=Xe(.5+.5*m,0,1);i=g===1||g===0?.5:l?g*r:1-(1-g)*r}return!!this._intersectGroundFromView(e,.5,i,t)&&_Z(t,e.eye)<n.distance*n.distance}_computeOverlayExtents(e,t,i){const r=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=F();this._findHorizonBasedPointOfInterest(e,s)||ve(s,r);const n=Math.max(.1,Pr(e.eye,s)),o=d1(this.view.renderCoordsHelper,r,e.eye),a=Math.PI/2-Math.abs(o-Math.PI/2);ur.OVERLAY_SHOW_CENTER?(N(o_)&&(o_=new q_(this.view.graphics,"red")),o_.show(s,this._renderSR)):w(o_)&&o_.hide(),this._overlaySREqualsRenderSR||$n(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&w(this._spatialReference)&&this._spatialReference.isGeographic,h=c&&w(this._spatialReference)?1/ji(this._spatialReference).metersPerDegree:1,p=e.perRenderPixelRatio*n*h;i.mapUnitsPerPixel=p/this._worldToPCSRatio;let m=t*p/2,g=!1,v=c?90:1/0;this._isSpherical&&w(l)&&w(this._spatialReference)&&(this._spatialReference.isWebMercator?(m/=Math.cos(T4(s[1])),v=l[3]):(g=!0,m/=ji(this._spatialReference).metersPerDegree,v=90),m>=v&&(m=v,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let b=1;g&&(b=1/Math.max(.2,Math.cos(Math.abs(Jt(s[1])))),m*b>180&&(b=180/m),i.mapUnitsPerPixel*=b);const S=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/S)*S);const T=m*b,O=32,C=.5*t/(O*T),M=.5*t/(O*m);s[0]=Math.round(s[0]*C)/C,s[1]=Math.round(s[1]*M)/M;const I=i.inner;I[0]=s[0]-T,I[1]=s[1]-m,I[2]=s[0]+T,I[3]=s[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(I,1/0,v);const $=i.outer;if(6*T>Nu(l))Gy($,l);else if(a<=.25*Math.PI)$[0]=I[0]-T,$[1]=I[1]-m,$[2]=I[2]+T,$[3]=I[3]+m;else{$n(e.eye,this._renderSR,MD,this._spatialReference),um(Tb,s,MD);let q=-Math.atan2(Tb[1],Tb[0])+.125*Math.PI;q<0&&(q+=2*Math.PI);const G=Math.floor(q/(.25*Math.PI));z3(Tb,oht[G],2*m),Tb[0]*=b,Tb[2]*=b,bZ($,I,Tb)}if(this._isSpherical)$[0]=this._longitudeCyclical.clamp($[0]),$[2]=this._longitudeCyclical.clamp($[2]),$[1]=Math.max($[1],-v),$[3]=Math.min($[3],v);else{const q=SN(I,l,Kle),G=SN($,l,lht);gee(q,G)&&($[2]=$[0],$[3]=$[1])}const U=Math.abs(I[2]-I[0])/t;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,U),i.pixelRatioAdjustment=i.mapUnitsPerPixel/U}_drawOverlayTextures(e,t,i=this.view.state.camera){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const r=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[ns.INNER],i),n=this._drawOverlay(e[ns.OUTER],i);s!==lC.CHANGED&&n!==lC.CHANGED||this.surface.updateTileOverlayParams(on.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),r?(this.surface.requestRender(t),t===on.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(on.BACKGROUND)}_drawOverlay(e,t){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,t.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const e=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(e)}}_rectanglesOverlap(e,t){return!N(e)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(t[0],t[2],e[0])||this._longitudeCyclical.contains(t[0],t[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],t[0]))&&!(e[1]>t[3]||e[3]<t[1]):H3(e,t))}_rectInsideRect(e,t){return!N(t)&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],t[0])&&this._longitudeCyclical.contains(e[0],e[2],t[2])&&t[1]>e[1]&&t[3]<e[3]:gee(e,t))}_pointIsInExtent(e,t){if(this._longitudeCyclical)return this._longitudeCyclical.contains(t[0],t[2],e.x)&&e.y>=t[1]&&e.y<=t[3];const i=e.x,r=e.y;return i>t[0]&&i<t[2]&&r>t[1]&&r<t[3]}_shiftExtentToFitBounds(e,t,i){let r=0,s=0;e[0]<-t?r=e[0]+t:e[2]>t&&(r=t-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),O4(e,r,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};function aht(e,t){const r=ur.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(e[2]-e[0],e[3]-e[1],t[2]-t[0],t[3]-t[1]);return Math.abs(t[0]-e[0])<=r&&Math.abs(t[1]-e[1])<=r&&Math.abs(t[2]-e[2])<=r&&Math.abs(t[3]-e[3])<=r}u([f()],Rl.prototype,"_spatialReference",void 0),u([f({readOnly:!0})],Rl.prototype,"running",null),u([f()],Rl.prototype,"_placementDirty",void 0),u([f()],Rl.prototype,"_contentUpdated",void 0),u([f()],Rl.prototype,"_isSpherical",null),u([f()],Rl.prototype,"_worldToPCSRatio",null),u([f()],Rl.prototype,"renderer",void 0),u([f({constructOnly:!0})],Rl.prototype,"surface",void 0),u([f({readOnly:!0,aliasOf:"surface.suspended"})],Rl.prototype,"suspended",void 0),u([f({readOnly:!0})],Rl.prototype,"updating",null),u([f({type:Boolean})],Rl.prototype,"hasHighlights",null),u([f({type:Boolean})],Rl.prototype,"rendersOccluded",null),Rl=u([B("esri.views.3d.terrain.OverlayManager")],Rl);const Tb=di(),MD=F(),Ag={inner:ei(),outer:ei(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},Kle=ei(),lht=ei(),cht=Lo();var im;(function(e){e[e.NONE=0]="NONE",e[e.EXTENT=1]="EXTENT",e[e.RERENDER_ONLY=2]="RERENDER_ONLY"})(im||(im={}));class E3{constructor(t,i){this._factoryCallback=t,this._lengthCallback=i,this._pool=new Map}acquire(t){if(!E3.test.disabled){const i=this._pool.get(t);if(i&&i.length!==0)return i.pop()}try{return this._factoryCallback(t)}catch(i){const r=window.performance&&window.performance.memory;let s="";throw r&&(s=`
  totalJSHeapSize: ${r.totalJSHeapSize}, usedJSHeapSize: ${r.usedJSHeapSize}, jsHeapSizeLimit: ${r.jsHeapSizeLimit}`),console.log("Array allocation of size "+t+" failed: "+i+s),i}}release(t){if(E3.test.disabled)return;const i=this._lengthCallback(t);let r=this._pool.get(i);r||(r=new hi({shrink:!0}),this._pool.set(i,r)),r.push(t)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}E3.test={disabled:!1};class uht{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=Fr(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=di(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class ece{constructor(t,i,r,s,n){this._buf=t,this._localOrigin=i,this.offset0=r,this.stride=s,this.count=n}getVertexOffset(t){return 0<=t&&t<this.count,this.offset0+this.stride*t}getVertex(t,i){const r=this.getVertexOffset(i)*jh;t[0]=this._buf[r+0]+this._localOrigin[0],t[1]=this._buf[r+1]+this._localOrigin[1],t[2]=this._buf[r+2]+this._localOrigin[2]}getVertexZ(t){const i=this.getVertexOffset(t)*jh;return this._buf[i+2]+this._localOrigin[2]}setVertex(t,i,r,s){const n=this.getVertexOffset(t)*jh;this._buf[n+0]=i[0]-this._localOrigin[0],this._buf[n+1]=i[1]-this._localOrigin[1],this._buf[n+2]=i[2]-this._localOrigin[2],this._buf[n+3]=r,this._buf[n+4]=s}getNormal(t,i){const r=this.getVertexOffset(i)*jh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}setVertexRawXYZUV(t,i,r,s,n,o){const a=this.getVertexOffset(t)*jh;this._buf[a+0]=i,this._buf[a+1]=r,this._buf[a+2]=s,this._buf[a+3]=n,this._buf[a+4]=o}setVertexRawXYZUVN(t,i,r,s,n,o,a,l,c){const h=this.getVertexOffset(t)*jh;this._buf[h+0]=i,this._buf[h+1]=r,this._buf[h+2]=s,this._buf[h+3]=n,this._buf[h+4]=o,this._buf[h+5]=a,this._buf[h+6]=l,this._buf[h+7]=c}setVertexRawNormal(t,i,r,s){const n=this.getVertexOffset(t)*jh;this._buf[n+5]=i,this._buf[n+6]=r,this._buf[n+7]=s}getVertexRawNormal(t,i){const r=this.getVertexOffset(i)*jh;t[0]=this._buf[r+5],t[1]=this._buf[r+6],t[2]=this._buf[r+7]}}const hht=As().vec3f(D.POSITION).vec2f(D.UV0).vec3f(D.NORMAL),tK=new E3(e=>hht.createBuffer(e),e=>e.count);function dht(){tK.clear()}function XSe(e){return tK.acquire(e)}function pht(e){tK.release(e.vertexAttributes),e.vertexAttributes=null,e.indices=null}class fht{constructor(){this.sinLonLUT=new Array(fq+1),this.cosLonLUT=new Array(fq+1)}update(t,i){const r=i[0],s=i[2];for(let n=0;n<=t;n++){const o=n/t,a=r*(1-o)+s*o;this.sinLonLUT[n]=Math.sin(a),this.cosLonLUT[n]=Math.cos(a)}}}class PD{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class mht{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new PD,new PD,new PD,new PD],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class ght{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new mht}}class _E{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=Tt(this._current),this._next=Tt(this._next),this._waiting=Tt(this._waiting),this._delayed=Tt(this._delayed)}get current(){if(N(this._current))return null;if(!this._isFadingEnabled){const i=this._delayed||this._waiting||this._next||this._current;i!==this._current&&(this._current=null,this.clear(),this._current=i)}let t=_E.test.fadeMoment;if(w(this._delayed)&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,Ny.Immediate),this._delayed=null)),w(this._next)){t=t||performance.now();const i=this._fadeDuration,r=w(this._current)&&this._next.texture===this._current.texture,s=this._next.type!==uo.FADING,n=t-this._fadeStart>=i;(r||s||n)&&(Tt(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(N(this._next))return 1;const t=_E.test.fadeMoment||performance.now(),i=Math.max(0,t-this._fadeStart),r=this._fadeDuration;return i>r?0:1-i/r}get isFading(){return w(this._next)||w(this._delayed)}push(t,i=Ny.Immediate){this._delayed=Tt(this._delayed),this._push(t,i)}_push(t,i){if(this._isFadingEnabled||this.clear(),N(this._current))return void(this._current=t);const r=_E.test.fadeMoment||performance.now();return i!==Ny.Immediate?(this._delayed=t,void(this._delayedTime=r+i)):N(this._next)?(this._next=t,void(this._fadeStart=this._alignFadeStart(r))):void(N(t)||(Tt(this._waiting),this._waiting=t))}get _fadeDuration(){return N(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(t){const i=this._getFadeDuration();return t+i-t%i}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Ny;_E.test={fadeMoment:0},function(e){e[e.Immediate=0]="Immediate",e[e.Delayed=5e3]="Delayed"}(Ny||(Ny={}));class YSe{constructor(){this._queue=new hi,this._last=null,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(t){this._queue.clear(),this._queue.push(t),this._last=null}reset(t=null){this._queue.clear(),w(t)&&this._queue.pushArray(t),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class yht{constructor(){this.q=new hi}get done(){return this.q.length===0}reset(t){if(this.q.clear(),!N(t)){this.q.pushArray(t);for(let i=0;i<this.q.length;++i){const r=this.q.data[i];r.isLeaf||this.q.pushArray(r.children)}}}next(){return this.q.pop()}}function eP(e,t,i){if(N(t)||N(t.fullExtent))return!1;const r=t.fullExtent,s=e.extent;if(i){if(s[0]<r.xmin||s[1]<r.ymin||s[2]>r.xmax||s[3]>r.ymax)return!1}else if(r.xmin>s[2]||r.ymin>s[3]||r.xmax<s[0]||r.ymax<s[1])return!1;const n=e.surface.tilingScheme.levels[e.level].scale;return!(t.minScale>0&&n>1.00000001*t.minScale)&&!(t.maxScale>0&&n<.99999999*t.maxScale)}function QSe(e,t){return e.lij[0]-t.lij[0]||e.lij[1]-t.lij[1]||e.lij[2]-t.lij[2]}function JSe(e,t){t.sort((i,r)=>KSe(i,r,e))}function KSe(e,t,i){const r=e.screenDepth,s=t.screenDepth;return r<s?-i:r>s?i:QSe(e,t)}function _ht(e,t){const i=new Map;e.forAll(r=>i.set(r.lij,r.distanceToSquared(t))),e.sort((r,s)=>i.get(r.lij)-i.get(s.lij)||QSe(r,s))}function vht(e,t,i){let r=1,s=0,n=0;for(;e!==t;)if(r*=.5,s*=.5,n*=.5,1&e.lij[2]&&(s+=.5),(1&e.lij[1])==0&&(n+=.5),(e=e.parent)==null)throw new Error("tile was not a descendant of upsampleTile");i.init(t,s,n,r)}function bht(e){for(let t=0;t<e.length;t++){const i=e[t],r=i.parent;if(r)for(let s=0;s<4;s++){const n=r.children[s];if(n&&n!==i&&n.loadable)return!0}}return!1}function pwt(e,t){if(!e||!t||e[0]===t[0])return!1;const i=e[0]<t[0],r=i?e:t,s=i?t:e,n=1<<s[0]-r[0];return Math.floor(s[1]/n)===r[1]&&Math.floor(s[2]/n)===r[2]}class iK{get updating(){return!!this._tileRequested}init(t,i,r,s){this.tile=t,this._layerIdx=i,this._layerClass=r,this._suspended=s,this._tileLayerInfo=t.getLayerInfo(i,r),this._tileRequested=null;const n=this._findAncestorWithData();this._setUpsampleTile(n)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(t){t!==this._suspended&&(this._suspended=t,t?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const t=this._findAncestorWithData();return this._setUpsampleTile(t),this._requestNext()}dataArrived(t){this._setUpsampleTile(t),this._tileRequested=null,t===this.tile?this.tile.updateRenderData(this._layerClass,uo.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const t=this._findNextDownload();if(this._tileRequested){if(t===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return w(t)?t.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=t):this._agentDone(),!!this._tileRequested}_findNextDownload(){const t=this._layerIdx,i=this._layerClass,r=this.tile.surface.layerViewByIndex(t,i),s=EW(r),{minLevel:n,maxLevel:o}=r.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?eP:()=>!0;let h=this.tile;const p=h.level;let m;const g=this._tileLayerInfo.upsampleInfo,v=w(g)?g.tile.level:-1,b=!!w(g)&&v-p>=a,S=Mn(s,"tilemapCache");for(;h&&c(h,s,!1)&&h.level>=n;){const T=h.level,O=p-T,C=h.layerInfo[i][t];if(C.data&&O>=a){(!b||T>v)&&this._setUpsampleTile(h),C.dataInvalidated&&(m=h);break}if((N(S)||S.getAvailability(h.lij[0],h.lij[1],h.lij[2])!=="unavailable")&&T<=o&&!C.data&&!C.dataMissing&&((N(m)||h.level===n||T%Gve==0||p-m.level<a)&&(m=h),O>=l))break;h=h.parent}return w(m)&&p-m.level<a&&this._tileLayerInfo.upsampleInfo&&(m=null),m}_findAncestorWithData(){const t=this.tile.vlevel,i=this._desiredMinLevelDelta;let r;for(let s=this.tile;s;s=s.parent)if(s.hasLayerData(this._layerIdx,this._layerClass)){if(t-s.level>=i)return s;r=s}return r}_setUpsampleTile(t){this._tileLayerInfo.setUpsampleInfo(this.tile,t),this.tile.updateRenderData(this._layerClass,uo.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}class wht extends iK{get _desiredMinLevelDelta(){throw tce}get _progressiveLevelModulo(){throw tce}dispose(){}}const tce=new Error("Abstract method called on TileAgent"),cc=new wht;class e2e extends iK{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return hF(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class t2e extends iK{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Gve}}var _x,nT;(function(e){e[e.Stretch=0]="Stretch",e[e.Lut=1]="Lut",e[e.Hillshade=2]="Hillshade",e[e.COUNT=3]="COUNT"})(_x||(_x={})),function(e){e[e.Noop=0]="Noop",e[e.PerBand=1]="PerBand",e[e.COUNT=2]="COUNT"}(nT||(nT={}));var ice,Qe;(function(e){e[e.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",e[e.SourceAlpha=1]="SourceAlpha",e[e.COUNT=2]="COUNT"})(ice||(ice={})),function(e){e[e.Normal=0]="Normal",e[e.Average=1]="Average",e[e.Lighten=2]="Lighten",e[e.Lighter=3]="Lighter",e[e.Plus=4]="Plus",e[e.Screen=5]="Screen",e[e.ColorDodge=6]="ColorDodge",e[e.Darken=7]="Darken",e[e.Multiply=8]="Multiply",e[e.ColorBurn=9]="ColorBurn",e[e.Overlay=10]="Overlay",e[e.SoftLight=11]="SoftLight",e[e.HardLight=12]="HardLight",e[e.VividLight=13]="VividLight",e[e.Hue=14]="Hue",e[e.Saturation=15]="Saturation",e[e.Luminosity=16]="Luminosity",e[e.Color=17]="Color",e[e.DestinationOver=18]="DestinationOver",e[e.DestinationAtop=19]="DestinationAtop",e[e.DestinationIn=20]="DestinationIn",e[e.DestinationOut=21]="DestinationOut",e[e.SourceAtop=22]="SourceAtop",e[e.SourceIn=23]="SourceIn",e[e.SourceOut=24]="SourceOut",e[e.Xor=25]="Xor",e[e.Difference=26]="Difference",e[e.Exclusion=27]="Exclusion",e[e.Minus=28]="Minus",e[e.Invert=29]="Invert",e[e.Reflect=30]="Reflect",e[e.COUNT=31]="COUNT"}(Qe||(Qe={}));const GF={normal:Qe.Normal,average:Qe.Average,lighten:Qe.Lighten,lighter:Qe.Lighter,screen:Qe.Screen,plus:Qe.Plus,"color-dodge":Qe.ColorDodge,darken:Qe.Darken,multiply:Qe.Multiply,"color-burn":Qe.ColorBurn,overlay:Qe.Overlay,"soft-light":Qe.SoftLight,"hard-light":Qe.HardLight,"vivid-light":Qe.VividLight,hue:Qe.Hue,saturation:Qe.Saturation,luminosity:Qe.Luminosity,color:Qe.Color,difference:Qe.Difference,exclusion:Qe.Exclusion,minus:Qe.Minus,invert:Qe.Invert,reflect:Qe.Reflect,"destination-over":Qe.DestinationOver,"destination-atop":Qe.DestinationAtop,"destination-in":Qe.DestinationIn,"destination-out":Qe.DestinationOut,"source-atop":Qe.SourceAtop,"source-in":Qe.SourceIn,"source-out":Qe.SourceOut,xor:Qe.Xor};function xht(e){return e===Qe.DestinationOver||e===Qe.DestinationAtop||e===Qe.DestinationIn||e===Qe.DestinationOut||e===Qe.SourceAtop||e===Qe.SourceIn||e===Qe.SourceOut||e===Qe.Xor}function Tht(e){e.fragment.uniforms.add([new ai("u_colormap",t=>t.u_colormap),new lt("u_colormapOffset",t=>t.colormap.u_colormapOffset),new lt("u_colormapMaxIndex",t=>t.colormap.u_colormapMaxIndex),new lt("u_opacity",t=>t.common.u_opacity)]),e.fragment.code.add(E`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}function Sht(e){e.fragment.uniforms.add(new ai("u_transformGrid",t=>t.u_transformGrid)),e.fragment.uniforms.add(new Ni("u_transformSpacing",t=>t.common.u_transformSpacing)),e.fragment.uniforms.add(new Ni("u_transformGridSize",t=>t.common.u_transformGridSize)),e.fragment.uniforms.add(new Ni("u_targetImageSize",t=>t.common.u_targetImageSize)),e.fragment.code.add(E`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}class i2e extends mn{constructor(){super(...arguments),this.scale=1,this.offset=gd}}function r2e(e){e.attributes.add(D.POSITION,"vec2"),e.attributes.add(D.UV0,"vec2"),e.vertex.uniforms.add(new lt("scale",t=>t.scale)),e.vertex.uniforms.add(new Ni("offset",t=>t.offset)),e.varyings.add("uv","vec2"),e.varyings.add("vuv","vec2"),e.vertex.code.add(E`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}class Eht extends i2e{constructor(t,i,r){super(),this.common=t,this.u_image=i,this.u_transformGrid=r}}function Cht(e){e.include(Sht),e.fragment.uniforms.add([new ai("u_image",t=>t.u_image),new Vx("u_flipY",t=>t.common.u_flipY),new Vx("u_applyTransform",t=>t.common.u_applyTransform)]),e.fragment.code.add(E`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}function rK(e){e.code.add(E`
    float lineFactorAtPosition(float value) {
      float pos = value * ${E.float(257)};
      if(pos < 0.5 || pos > ${E.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}var ca;(function(e){e[e.LayerOnly=0]="LayerOnly",e[e.ColorComposite=1]="ColorComposite",e[e.GridComposite=2]="GridComposite",e[e.COUNT=3]="COUNT"})(ca||(ca={}));function s2e(e,t){const i=t.blendMode;i!==Qe.Normal&&(i===Qe.Reflect&&e.code.add(E`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),i!==Qe.ColorDodge&&i!==Qe.VividLight||e.code.add(E`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),i!==Qe.ColorBurn&&i!==Qe.VividLight||e.code.add(E`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),i===Qe.Overlay&&e.code.add(E`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),i===Qe.HardLight&&e.code.add(E`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),i===Qe.SoftLight&&e.code.add(E`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),i===Qe.VividLight&&e.code.add(E`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),i!==Qe.Hue&&i!==Qe.Saturation&&i!==Qe.Color&&i!==Qe.Luminosity||(e.code.add(E`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),i!==Qe.Hue&&i!==Qe.Saturation||e.code.add(E`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),e.code.add(E`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${i===Qe.Multiply?E`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Average?E`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Lighten?E`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Darken?E`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Lighter?E`return vec4(cl * ol + cb * ob, ol + ob);`:i===Qe.Plus?E`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:i===Qe.Minus?E`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:i===Qe.Screen?E`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Difference?E`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Invert?E`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Qe.DestinationOver?E`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:i===Qe.DestinationAtop?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:i===Qe.DestinationOut?E`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:i===Qe.SourceAtop?E`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:i===Qe.SourceOut?E`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:i===Qe.Xor?E`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:i===Qe.DestinationIn?E`return vec4(cb * ob * ol, ol * ob);`:i===Qe.SourceIn?E`return vec4(cl * ol * ob, ol * ob);`:i===Qe.Hue?E`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Saturation?E`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Color?E`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Luminosity?E`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Exclusion?E`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Reflect?E`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.ColorDodge?E`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.ColorBurn?E`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.Overlay?E`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.SoftLight?E`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.HardLight?E`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:i===Qe.VividLight?E`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:E``}
    }
  `))}var Do,Zn;function Aht(e){const t=new dr,i=e.output===Do.GridOnly,r=e.output===Do.GridComposite,s=r||i,n=e.output===Do.ColorOnly,o=e.output===Do.ColorComposite,a=o||n,l=r||o;if(t.include(r2e),a&&t.fragment.uniforms.add(new Ut("backgroundColor",g=>g.backgroundColor)),e.baseOpacityMode!==Zn.One&&t.fragment.uniforms.add(new lt("baseOpacity",g=>g.baseOpacity)),s&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(rK)),i||n)return t.fragment.code.add(E`
    void main() {
      gl_FragColor = ${n?E`vec4(backgroundColor, 1.0)`:E`gridColor(uv)`};
    }
  `),t;const c=e.blendMode!==Qe.Normal,h=e.baseOpacityMode===Zn.OnBaseLayer,p=e.baseOpacityMode===Zn.OnBackground||e.baseOpacityMode===Zn.OnBaseLayer,m=e.premultipliedSource;return t.fragment.uniforms.add(new ai("tex",g=>g.texture)),t.fragment.uniforms.add(new lt("opacity",g=>g.opacity)),(c||h||m)&&(t.fragment.uniforms.add(new ai("fboColor",g=>g.fboTexture)),t.fragment.uniforms.add(new lt("tileSize",g=>w(g.fboTexture)?g.fboTexture.descriptor.width:1))),t.fragment.include(s2e,e),t.fragment.code.add(E`
    void main() {
      ${l||h||m?E`
      vec4 bgColor = ${o?E`vec4(backgroundColor, 1.0)`:r?E`gridColor(uv)`:E`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${p?E`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${c?E`
          vec4 fboTex = ${l?E`bgColor;`:E`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${h?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:E`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${m?E`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:l||h?E`mix(bgColor, pmColorLayer, composeAlpha);`:E`pmColorLayer * composeAlpha;`}`}
    }
  `),t}(function(e){e[e.Composite=0]="Composite",e[e.ColorOnly=1]="ColorOnly",e[e.GridOnly=2]="GridOnly",e[e.ColorComposite=3]="ColorComposite",e[e.GridComposite=4]="GridComposite",e[e.COUNT=5]="COUNT"})(Do||(Do={})),function(e){e[e.One=0]="One",e[e.OnBackground=1]="OnBackground",e[e.OnBaseLayer=2]="OnBaseLayer",e[e.COUNT=3]="COUNT"}(Zn||(Zn={}));const Oht=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return Do},get BaseOpacityMode(){return Zn},build:Aht},Symbol.toStringTag,{value:"Module"}));class tB extends Eht{constructor(t,i,r,s,n,o){super(t,s,n),this.colormap=i,this.symbolizer=r,this.u_colormap=o,this.backgroundColor=ol,this.fboTexture=null,this.baseOpacity=1}}class Rht extends tB{}class Mht extends tB{}function Pht(e){const t=new dr;t.include(r2e),t.include(Cht),t.include(Tht),e.tileBlendInput===ca.GridComposite&&(t.extensions.add("GL_OES_standard_derivatives"),t.fragment.include(rK));const i=e.tileBlendInput===ca.ColorComposite;i&&t.fragment.uniforms.add(new Ut("backgroundColor",a=>a.backgroundColor)),e.baseOpacityMode!==Zn.One&&t.fragment.uniforms.add(new lt("baseOpacity",a=>a.baseOpacity));const r=e.baseOpacityMode===Zn.OnBaseLayer,s=e.baseOpacityMode===Zn.OnBackground||e.baseOpacityMode===Zn.OnBaseLayer,n=e.blendMode!==Qe.Normal;t.fragment.include(s2e,e);const o=e.tileBlendInput!==ca.LayerOnly;return(n&&!o||r)&&(t.fragment.uniforms.add(new ai("fboColor",a=>a.fboTexture)),t.fragment.uniforms.add(new lt("tileSize",a=>w(a.fboTexture)?a.fboTexture.descriptor.width:1))),t.fragment.code.add(E`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${o||r?E`
          vec4 bgColor = ${r?E`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:i?E`vec4(backgroundColor, 1.0)`:E`gridColor(vuv)`};
          ${s?E`bgColor *= baseOpacity;`:""}`:""}
      ${n?E`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${o?E`bgColor;`:E`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${r?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:o||r?E`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:E`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),e.colorizerType===_x.Stretch?Lht(t,e):e.colorizerType===_x.Lut?Iht(t):e.colorizerType===_x.Hillshade&&$ht(t,e),t}function Iht(e){e.fragment.code.add(E`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function Lht(e,t){e.fragment.uniforms.add([new SI("u_bandCount",r=>r.symbolizer.u_bandCount),new Aa("u_minCutOff",r=>r.symbolizer.u_minCutOff,3),new Aa("u_maxCutOff",r=>r.symbolizer.u_maxCutOff,3),new Aa("u_factor",r=>r.symbolizer.u_factor,3),new lt("u_minOutput",r=>r.symbolizer.u_minOutput),new lt("u_maxOutput",r=>r.symbolizer.u_maxOutput),new Vx("u_useGamma",r=>r.symbolizer.u_useGamma),new Aa("u_gamma",r=>r.symbolizer.u_gamma,3),new Aa("u_gammaCorrection",r=>r.symbolizer.u_gammaCorrection,3),new lt("u_opacity",r=>r.common.u_opacity)]),e.fragment.code.add(E`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const i=t.applyColormap?E`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:E`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;e.fragment.code.add(E`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${t.stretchType===nT.Noop?E`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:E`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${i}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function $ht(e,t){const i=e.fragment;i.uniforms.add([new ai("u_image",s=>s.u_image),new SI("u_hillshadeType",s=>s.symbolizer.u_hillshadeType),new Aa("u_sinZcosAs",s=>s.symbolizer.u_sinZcosAs,6),new Aa("u_sinZsinAs",s=>s.symbolizer.u_sinZsinAs,6),new Aa("u_cosZs",s=>s.symbolizer.u_cosZs,6),new Aa("u_weights",s=>s.symbolizer.u_weights,6),new Ni("u_factor",s=>s.symbolizer.u_factor),new lt("u_minValue",s=>s.symbolizer.u_minValue),new lt("u_maxValue",s=>s.symbolizer.u_maxValue),new Ni("u_srcImageSize",s=>s.common.u_srcImageSize)]),i.include(Wm),i.code.add(E`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),i.code.add(E`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const r=t.applyColormap?E`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:E`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;i.code.add(E`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${r}
    }
  `)}const Dht=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:tB,ColorizerStretchUniforms:Rht,ColorizerHillshadeUniforms:Mht,build:Pht},Symbol.toStringTag,{value:"Module"}));function Nht(e,t,i="nearest",r=!1){var c;const s=!(r&&t.pixelType==="u8"),n=s?Vt.FLOAT:Vt.UNSIGNED_BYTE,o=t.pixels==null||t.pixels.length===0?null:s?t.getAsRGBAFloat():t.getAsRGBA(),a=(c=e.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l={width:t.width,height:t.height,target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,internalFormat:e.type===Li.WEBGL2&&s?Mt.RGBA32F:tt.RGBA,samplingMode:!a||i!=="bilinear"&&i!=="cubic"?mt.NEAREST:mt.LINEAR,dataType:n,wrapMode:Ft.CLAMP_TO_EDGE,flipped:!1};return new bt(e,l,o)}function Fht(e,t){const{spacing:i,offsets:r,coefficients:s,size:[n,o]}=t,a=i[0]>1,l={width:a?4*n:n,height:o,target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,internalFormat:e.type===Li.WEBGL2?Mt.RGBA32F:tt.RGBA,dataType:Vt.FLOAT,samplingMode:mt.NEAREST,wrapMode:Ft.CLAMP_TO_EDGE,flipped:!1},c=new Float32Array(a?n*o*16:2*r.length);if(a)for(let h=0,p=0;h<s.length;h++)c[p++]=s[h],h%3==2&&(c[p++]=1);else for(let h=0;h<o;h++)for(let p=0;p<n;p++){const m=4*(h*n+p),g=2*(p*o+h);c[m]=r[g],c[m+1]=r[g+1],c[m+3]=r[g]===-1?0:1}return new bt(e,l,c)}function rce(e,t){const i={width:t.length/4,height:1,target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,internalFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,wrapMode:Ft.CLAMP_TO_EDGE,flipped:!1};return new bt(e,i,t)}function kht(e,t,i,r=1,s=!0){return{u_flipY:s,u_applyTransform:!!e,u_opacity:r,u_transformSpacing:e?e.spacing:gd,u_transformGridSize:e?e.size:gd,u_targetImageSize:t,u_srcImageSize:i}}function Uht(e,t){return{u_colormapOffset:t||0,u_colormapMaxIndex:e?e.length/4-1:0}}function zht(e){return{u_bandCount:e.bandCount,u_minOutput:e.outMin,u_maxOutput:e.outMax,u_minCutOff:e.minCutOff,u_maxCutOff:e.maxCutOff,u_factor:e.factor,u_useGamma:e.useGamma,u_gamma:e.gamma,u_gammaCorrection:e.gammaCorrection}}function Bht(e){return{u_hillshadeType:e.hillshadeType,u_sinZcosAs:e.sinZcosAs,u_sinZsinAs:e.sinZsinAs,u_cosZs:e.cosZs,u_weights:e.weights,u_factor:e.factor,u_minValue:e.minValue,u_maxValue:e.maxValue}}const sce={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class Vht{constructor(t,i,r=null,s=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=t,this.source=i,this.width=r||i.width,this.height=s||i.height}get source(){return this._source}set source(t){this._source=t,this._rasterTexture=ht(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...sce,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||sce}set symbolizerParameters(t){this._symbolizerParameters=t}get bandIds(){return this._bandIds}set bandIds(t){w(t)&&t.length>0?this._bandIds&&t.every((i,r)=>!!this._bandIds[r]&&i===this._bandIds[r])||(this._bandIds=t,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(t){if(this._interpolation=t,w(this._rasterTexture)){const i=this._getRasterTextureInterpolation(t);this._rasterTexture.setSamplingMode(i==="bilinear"?mt.LINEAR:mt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(t){this._transformGrid=t,this._transformGridTexture=ht(this._transformGridTexture),this._memoryUsed=null}bind(t){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((N(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(t,this.bandIds),w(this._rasterTexture)&&(this._updateColormapTexture(t),this.transformGrid&&N(this._transformGridTexture)&&(this._transformGridTexture=Fht(t,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:t,transformGrid:i,width:r,height:s,opacity:n}=this,o=kht(i,[r,s],[this.source.width,this.source.height],n),a=Uht(t.colormap,t.colormapOffset),l=this.symbolizerParameters.type==="stretch"?zht(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?Bht(this.symbolizerParameters):null;return new tB(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){if(N(this._memoryUsed)){const t=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=t.map(i=>w(i)?i.descriptor.width*i.descriptor.height*4:0).reduce((i,r)=>i+r,0)}return this._memoryUsed}release(){return this._rasterTexture=ht(this._rasterTexture),this._transformGridTexture=ht(this._transformGridTexture),this._colormapTexture=ht(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(t,i){const r=this.source?this.source.extractBands(i):null;if(!(r&&r.pixels&&r.pixels.length>0))return void(this._rasterTexture=ht(this._rasterTexture));const s=N(i)&&N(this.bandIds)||w(i)&&w(this.bandIds)&&i.join("")===this.bandIds.join("");if(w(this._rasterTexture)&&s)return;this._rasterTexture=ht(this._rasterTexture);const n=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=Nht(t,r,n,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(t){return this.symbolizerParameters.type==="lut"||t==="nearest"||t==="majority"?"nearest":"bilinear"}_updateColormapTexture(t){const i=this._colormap,r=this.symbolizerParameters.colormap;return r?i?r.length!==i.length||r.some((s,n)=>s!==i[n])?(this._colormapTexture=ht(this._colormapTexture),this._colormapTexture=rce(t,r),void(this._colormap=r)):void 0:(this._colormapTexture=rce(t,r),void(this._colormap=r)):(this._colormapTexture=ht(this._colormapTexture),void(this._colormap=null))}}class jF{constructor(){this.waitingAgents=new hi,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(t){const i=y9.acquire();return i._init(t),i}release(){this.dispose(),HF.delete(this),y9.release(this)}dispose(){this.loadingAgent=ht(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=yE(this._data)}static prune(){y9.prune(0)}_init(t){this.waitingAgents.clear(),this._data=yE(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=t,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=fd(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){w(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(t,i){if(t===i||N(i))this._unsetUpsampleInfo();else{if(N(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===i)return;this._upsampleInfo.tile.unrefMapData()}i.refMapData(),vht(t,i,this._upsampleInfo)}}get data(){return this._data}set data(t){yE(this._data),this._data=t}}const y9=new qs(jF,null,()=>{}),HF=new Map;function Ght(){HF.size>0&&(console.log(`${HF.size} live TilePerLayerInfo allocations:`),HF.forEach(e=>console.log(e,`
`)))}class T2{constructor(t){this._texture=t,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var Nt;(function(e){e[e.NONE=0]="NONE",e[e.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",e[e.SPLIT=2]="SPLIT",e[e.VSPLITMERGE=4]="VSPLITMERGE",e[e.MERGE=8]="MERGE",e[e.RENDERDATA=16]="RENDERDATA",e[e.GEOMETRY=32]="GEOMETRY",e[e.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",e[e.TEXTURE_FADING=128]="TEXTURE_FADING"})(Nt||(Nt={}));const _9=F(),SS=F(),yo=F(),jht=.1;class Hht{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class sK{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=ei(),this._elevationBounds=yt(),this.layerInfo=[[],[]],this.extentInRadians=ei(),this.centerAtSeaLevel=F(),this._center=[F(),Qn(),F()],this.up=gZ(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){nK.prune(0),oK.prune(0),jF.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Ya.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const t=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return t!==this._visible&&(this._visible=t,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const t=!!this.renderData;return t!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=t,this._surface.renderer.setNeedsRender()),t}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===EC.ON){const t=this.level-this._surface.snapLevel;if(t===0)return!0;if(t===1)return!1}return this.isLeaf}init(t,i,r){this.lij[0]=t[0],this.lij[1]=t[1],this.lij[2]=t[2],this.ellipsoid=ji(r.tilingScheme.spatialReference),r.tilingScheme.getExtent(t[0],t[1],t[2],this.extent),r.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,r.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Ya.MIDDLE][3]=0,this.vlevel=t?t[0]:0,i&&i.elevationBounds?zo(this._elevationBounds,i.elevationBounds):Di(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=i,this.unsetChildren(),this._surface=r,this.updateVisibility();for(const s of hw){const n=r.numLayers(s),o=this.layerInfo[s];for(const a of o)a.release();o.length=n;for(let a=0;a<n;a++)o[a]=jF.acquire(this._surface.upsampleInfoPool),s===mi.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(r.tilingScheme.pixelSize,fq)}release(){nm(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const t of hw){for(const i of this.layerInfo[t])i.release();this.layerInfo[t].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const t=this.cachedMemory;t>0&&this._surface.upsampleMapCache.put(this.key,this,t)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[mi.MAP].reduce((t,i)=>t+(i instanceof KM?i.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const i=this._surface.tilingScheme.pixelSize;return i*i*4}_ensureUsedMemory(){if(w(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let t=0;for(const{data:r}of this.layerInfo[mi.MAP])r instanceof KM?t+=this._getTerrainDataMemory(r):this._mapTileMemory+=this._getTerrainDataMemory(r);const i=this.cpuImageMemorySize;for(const r of this.layerInfo[mi.ELEVATION])this._usedMemory+=r.data?i:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=Bx(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+t),this._usedMemory}getUsedMemoryForLayer(t,i){const r=this.layerInfo[t][i];return r!=null&&r.data?t===mi.MAP?this.isCached?0:this._getTerrainDataMemory(r.data):t===mi.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(t){return t instanceof T2?Bx(t.texture):t instanceof HTMLImageElement||t instanceof Qz?this.cpuImageMemorySize:t instanceof KM||t instanceof Vht?t.memoryUsage:0}updateScreenDepth(t){const i=this._center[Ya.MIDDLE],r=t,s=i[0],n=i[1],o=i[2],a=r[2]*s+r[6]*n+r[10]*o+r[14];this._screenDepth=a<0?0:a/(r[3]*s+r[7]*n+r[11]*o+r[15])}shouldSplit(t,i,r){if(w(t.frustum)&&(!this._intersectsClippingArea||!this._isVisible(t.frustum)))return Nt.NONE;const s=this.level;Me(_9,this._center[Ya.MIDDLE],i);let n=rl(_9),o=Ya.MIDDLE;Me(SS,this._center[Ya.TOP],i);const a=rl(SS);a<n&&(n=a,o=Ya.TOP),Me(SS,this._center[Ya.BOTTOM],i);const l=rl(SS);if(l<n&&(n=l,o=Ya.BOTTOM),this._edgeLen2>n&&s<t.maxLod)return Nt.SPLIT;const c=Math.sqrt(n),h=t.fovX*c*2,p=this._edgeLen/h,m=()=>{const S=s+Math.ceil(-Math.log2(t.relativeWidthLimit/p));return S!==this.vlevel?(this.vlevel=S,Nt.VSPLITMERGE):Nt.NONE_HIT_MAXLOD};if(r===EC.ON&&this._surface.snapLevel-s===1)return s>=t.maxLod?m():Nt.SPLIT;const g=ke(this.up,_9),v=this._elevationBounds[1]-this._elevationBounds[0],b=v/this.edgeLen;if(t.aboveGround&&g>0&&b<.001&&g/c-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return Nt.NONE;if(p<t.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,Nt.VSPLITMERGE):Nt.NONE;if(s>=t.maxLod)return m();if(s>6){Me(SS,this._center[o],i),be(yo,this.up,g),Me(yo,yo,SS);const S=rl(yo);if(S>this.radius*this.radius){be(yo,yo,this.radius/Math.sqrt(S)),Oe(yo,yo,this._center[o]),Me(yo,i,yo);const T=Math.min(1,(Math.abs(ke(yo,this.up))+.5*v+this._curvatureHeight)/He(yo)),O=jht/t.angledSplitBias,C=t.fovY*c*2;if(T*(this._edgeLen/C)<O*t.relativeHeightLimit)return Nt.NONE}}return Nt.SPLIT}setChildren(t,i,r,s){nm(!!(t&&i&&r&&s),"Null child passed"),this._children[0]=t,this._children[1]=i,this._children[2]=r,this._children[3]=s}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var t,i;return(i=(t=this.renderData)==null?void 0:t.hasGeometry)!=null?i:!1}prepareToLoad(t){this.refMapData();for(const i of hw)this._createOrUpdateAgents(0,i);t.updateTileGeometryState(this)}load(t){this.prepareToLoad(t),this.loadPrepared(t)}loadPrepared(t){t.loadTile(this)}unload(t){t.unloadTile(this);for(const i of hw){const r=this.layerInfo[i];for(const s of r)s.loadingAgent&&s.loadingAgent!==cc&&(ID(s.loadingAgent),s.loadingAgent=null),s.pendingUpdates=0}this.resetPendingUpdate(Nt.GEOMETRY),this.resetPendingUpdate(Nt.TEXTURE_NOFADING),this.resetPendingUpdate(Nt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const t=this.layerInfo[mi.MAP];for(const i of t)i.loadingAgent&&i.loadingAgent!==cc&&(ID(i.loadingAgent),i.loadingAgent=null),i.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(t){if(ox(t,this._clippingArea))return!1;const i=this._intersectsClippingArea,r=this._isWithinClippingArea;w(t)?(this._intersectsClippingArea=this.intersectsExtent(t),this._isWithinClippingArea=this._isWithinExtent(t)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=t,this.updateVisibility();const s=r&&this._isWithinClippingArea,n=!(r||i||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||s||n||this.setPendingUpdate(Nt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(t,i){return this.layerInfo[i][t]}hasLayerData(t,i){const r=this.layerInfo[i][t];return!(!r||!r.data||r.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const t of hw){const i=this.layerInfo[t];for(const r of i)if(r.loadingAgent&&r.loadingAgent!==cc&&r.loadingAgent.updating)return!0}return!1}_isSuspended(t){return!!this.hasPendingUpdate(Nt.SPLIT)||t!==mi.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(t){return(this._pendingUpdates&t)===t}setPendingUpdate(t){this._pendingUpdates|=t,t===Nt.SPLIT||t===Nt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(t){return!!this.hasPendingUpdate(t)&&(this._pendingUpdates&=~t,!0)}requestLayerData(t,i,r){const s=this.layerInfo[i][t];if(s.waitingAgents.has(r))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),!0;if(s.waitingAgents.push(r),s.data&&!s.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),r.tile.lij.toString(),i,t),r.dataArrived(this),!0;if(s.requestPromise)return!0;fd(s.requestAbort),s.requestAbort=new AbortController;const n=this._surface.requestTileData(this,t,i,s.requestAbort);if(!n)return s.requestAbort=null,!1;const o=()=>{s.requestPromise===n&&(s.requestPromise=null,s.requestAbort=null)};return s.requestPromise=n,n.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(t){return this.lij[0]===t[0]&&this.lij[1]===t[1]&&this.lij[2]===t[2]}findByLij(t){return this.hasLij(t)?this:this.isLeaf?null:this._children[0].findByLij(t)||this._children[1].findByLij(t)||this._children[2].findByLij(t)||this._children[3].findByLij(t)||null}distanceToSquared(t){return rl(Me(yo,this._center[Ya.MIDDLE],t))}containsPoint(t){const i=this.extent;return t[0]>=i[0]&&t[1]>=i[1]&&t[0]<=i[2]&&t[1]<=i[3]}unrequestLayerData(t,i,r){const s=this.layerInfo[i][t],n=s.waitingAgents,o=n.removeUnordered(r)!=null;nm(o,"agent has not requested this piece of map data"),n.length<1&&(s.abortRequest(),this.setMemoryDirty())}dataArrived(t,i,r){const s=this.layerInfo[i][t];s.data=r,s.dataInvalidated=!1,s.waitingAgents.forAll(n=>n.dataArrived(this)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(t,i,r){r.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${i}/${t} error ${r}`);const s=this.layerInfo[i][t];s.dataMissing=!0,s.waitingAgents.forAll(n=>n.dataMissing()),s.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(t,i){switch(t){case mi.MAP:return this._updateTexture(i);case mi.ELEVATION:return this._updateGeometry()}}_updateTexture(t){this.renderData&&(this.resetPendingUpdate(t===uo.FADING?Nt.TEXTURE_NOFADING:Nt.TEXTURE_FADING),this.setPendingUpdate(t===uo.FADING?Nt.TEXTURE_FADING:Nt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(Nt.GEOMETRY);for(const t of this.layerInfo[mi.ELEVATION])t.pendingUpdates|=Nt.GEOMETRY}invalidateLayerData(t,i){this.layerInfo[i][t].invalidateSourceData(),this.restartAgents(i)}computeElevationBounds(){const t=this._elevationBounds;Di(t,Number.MAX_VALUE,-Number.MAX_VALUE);const i=this.layerInfo[mi.ELEVATION];let r=!0;for(const s of i)w(s.elevationBounds)&&(t[0]=Math.min(t[0],s.elevationBounds.min),t[1]=Math.max(t[1],s.elevationBounds.max),s.elevationBounds.hasNoDataValues||(r=!1));r&&(t[0]=Math.min(t[0],0),t[1]=Math.max(t[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const t=this._elevationBounds,i=.5*(t[0]+t[1]);be(yo,this.up,i),Oe(this._center[Ya.MIDDLE],this.centerAtSeaLevel,yo),be(yo,this.up,t[0]),Oe(this._center[Ya.TOP],this.centerAtSeaLevel,yo),be(yo,this.up,t[1]),Oe(this._center[Ya.BOTTOM],this.centerAtSeaLevel,yo)}findElevationBoundsForLayer(t,i){const r=this.layerInfo[mi.ELEVATION][t];if(w(r.elevationBounds)&&r.elevationBounds.level>=i)return;const s=this._surface.layerViewByIndex(t,mi.ELEVATION),n=EW(s);if(!eP(this,n,!1))return;const o=Wht;let a=!1;if(r.data){const l=r.data;o.min=l.bounds[0],o.max=l.bounds[1],o.hasNoDataValues=l.hasNoDataValues,o.level=this.level,a=!0}else{let l,c,h=0;for(let p=this._parent;p&&(!c||h<hF(this.level))&&(h=this.vlevel-p.level,l=c||l,c=p.layerInfo[mi.ELEVATION][t].data,!(!c&&l&&h>=hF(this.level)));p=p.parent);c=c||l,c&&(c.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],o),o.min!==1/0&&(o.level=c.level,a=!0))}a&&(N(r.elevationBounds)&&(r.elevationBounds=new eK),r.elevationBounds.copyFrom(o))}modifyLayers(t,i,r){const s=this.layerInfo[r];for(const a of s)a.loadingAgent&&a.loadingAgent!==cc&&(ID(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<s.length;++a)t[a]===void 0&&s[a].release();const n=new Array(...s),o=i.length;s.length=o;for(let a=0;a<o;a++){const l=i[a];s[a]=l>-1?n[l]:jF.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(t){this.renderData&&(this._createOrUpdateAgents(0,t),this.updateRenderData(t,uo.FADING))}updateAgents(t){if(this.renderData){const i=this.layerInfo[t];for(const r of i)r.loadingAgent===cc&&(r.loadingAgent=null);this._createOrUpdateAgents(0,t)}}updateAgentSuspension(){for(const t of hw){const i=this._isSuspended(t);for(const r of this.layerInfo[t])r.loadingAgent&&r.loadingAgent!==cc&&(r.loadingAgent.setSuspension(i),r.loadingAgent===cc&&this.updateRenderData(t,uo.FADING))}}removeLayerAgent(t,i){const r=this.layerInfo[i][t];r.loadingAgent&&r.loadingAgent!==cc&&r.loadingAgent.dispose(),r.loadingAgent=null}agentDone(t,i){const r=this.layerInfo[i][t];r.loadingAgent=cc,!r.data&&N(r.upsampleInfo)&&this._createOrUpdateAgents(t+1,i)}_createOrUpdateAgents(t,i){const r=this.layerInfo[i];if(r.length===0)return;const s=(()=>{for(let o=t;o<r.length;++o){const a=this._surface.layerViewByIndex(o,i);if(hk(a)&&a.layer.blendMode!=="normal")return!0}return!1})(),n=this._isSuspended(i);for(let o=t;o<r.length;++o){const a=r[o];let l=!1;const c=this._surface.layerViewByIndex(o,i),h=EW(c);if(a.loadingAgent?eP(this,h,!1)?(a.loadingAgent!==cc&&a.loadingAgent.setSuspension(n),a.loadingAgent!==cc&&(l=a.loadingAgent.update())):a.dispose():eP(this,h,!1)&&(a.loadingAgent=qht(this,o,i,n),l=a.loadingAgent.startLoading(),l?a.loadingAgent===cc&&this.setPendingUpdate(Nt.GEOMETRY):(ID(a.loadingAgent),a.loadingAgent=cc)),a.loadingAgent===cc&&this.updateRenderData(i,uo.FADING),!s&&l&&c.isOpaque)return}}_isWithinExtent(t){const i=this.extent;return i[0]>=t[0]&&t[2]>=i[2]&&i[1]>=t[1]&&t[3]>=i[3]}intersectsExtent(t){const i=this.extent;return i[2]>=t[0]&&t[2]>=i[0]&&i[3]>=t[1]&&t[3]>=i[1]}getElevationBasedVerticesPerSide(t){const i=this.vlevel-this.level,r=Math.max(this.level-t,hF(this.level)-i);return Xe(1+(this.maxTesselation>>r),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(t,i){if(!t)return null;const r=this.surface.rootTiles;if(w(r)){for(const s of r)if(Zht(s,t)){let n=s,o=t[0]-n.level-1;for(;o>=0&&!n.isLeaf&&!i(n);){const a=t[1]>>o&1,l=t[2]>>o&1;n=n.children[2*a+l],o--}return i(n)?n:null}}return null}findNeighborTile(t,i){const r=this.lij,s=this.getNeighborLIJ(r,t);return s?Xht(r,s)?i(this)?this:null:this._findLIJ(s,i):null}findCorner(t,i){const r=t===ri.NORTH_EAST?1:t===ri.NORTH_WEST?0:t===ri.SOUTH_WEST?2:3;let s=this;for(;!(s.isLeaf||i&&i(s));)s=s.children[r];return s}findNeighborCornerTileExact(t,i){var r;return(r=this.findNeighborTile(t,s=>i(s)||s.level===this.level))==null?void 0:r.findCorner(dk(t),i)}forAllSubtreeOnSide(t,i){const r=t===ri.NORTH?[0,1]:t===ri.NORTH_EAST?[1]:t===ri.EAST?[1,3]:t===ri.SOUTH_EAST?[3]:t===ri.SOUTH?[2,3]:t===ri.SOUTH_WEST?[2]:t===ri.WEST?[0,2]:[0],s=n=>{i(n)||n.isLeaf||r.forEach(o=>s(n.children[o]))};s(this)}forallNeighbors(t){pk.forEach(i=>this.findNeighborCornerTileExact(i,t)),pv.forEach(i=>{var r;return(r=this.findNeighborTile(i,s=>s.level===this.level||t(s)))==null?void 0:r.forAllSubtreeOnSide(VF(i),t)})}getNeighborEdgeStartVertexIndex(t,i){const r=i!=null?i:this.findNeighborTile(pv[t],h=>h.isLoaded);if(!r||!this.isLoaded||!r.isLoaded)return 0;const s=this.level-r.level;if(s===0)return 0;const n=2**s,o=(1&t)==1,a=o?0:1,l=r.lij[a+1]*n,c=this.lij[a+1]-l;return o?n-1-c:c}_updateNeighborsWithChangedEdgeResolution(){for(let t=0;t<4;++t)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]){const i=pv[t],r=this.findNeighborTile(i,s=>s.isLoaded||s.level===this.level);if(!r)continue;if(!r.isLoaded){r.isLeaf;const s=(t+2)%4,n=VF(i);r.forAllSubtreeOnSide(n,o=>o.isLoaded?(o.updateEdgeAfterResolutionChange(s),!0):(o.isLeaf,!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[t]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(t=this.level){this.forEachLoadedNeighbor(i=>this._updateNeighbor(i)),pv.forEach(i=>{var r;(r=this.findNeighborTile(i,s=>s.isLoaded&&s.level<t))==null||r.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(t){this.renderData.updateEdgeAfterResolutionChange(t)}forEachLoadedNeighbor(t){const i=this.level,r=s=>s.level===i||s.isLoaded;pv.forEach((s,n)=>{var l,c;const o=this.findNeighborTile(s,r);o!=null&&o!==this&&o.forAllSubtreeOnSide(VF(s),h=>!!h.isLoaded&&(t(h),!0));const a=(c=(l=this.renderData)==null?void 0:l.geometryState)==null?void 0:c.neighborData;a&&(a.modifiedEdgeResolutions[n]=!1)}),pk.forEach(s=>{var o;const n=(o=this.findNeighborTile(s,r))==null?void 0:o.findCorner(dk(s),a=>a.isLoaded);!n||Yht(this,n,s),n!=null&&n.isLoaded&&t(n)})}_updateNeighbor(t){t!=null&&t.isLoaded&&t.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(t,i){const r=jle(i)?-1:Gle(i)?1:0,s=Ble(i)?-1:Vle(i)?1:0,n=[t[0],t[1]+r,t[2]+s];return n[1]<0?null:this.surface.isGlobal?this.wrapLIJ(n):n[2]<0?null:n}wrapLIJ(t){return!t||t[1]<0||t[1]>=2**t[0]?null:this.surface.wrapEastWest(t)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){return this.extent[1]+Gt>=this.surface.extent[1]}compareLIJs(t){const i=this.lij,r=i[0],s=t[0];if(r===s)return[i,t];const n=r-s;if(n<0){const o=2**-n;return[[s,i[1]*o,i[2]*o],t]}{const o=2**n;return[i,[r,t[1]*o,t[2]*o]]}}checkGeometryWaterproofness(){}shouldHaveNeighbor(t){const i=this.extent,r=this.surface.rootTilesExtent,s=.25*(i[2]-i[0]);if(jle(t)&&i[3]+s>=r[3]||Gle(t)&&i[1]-s<=r[1])return!1;const n=this.surface.isGlobal;return!(!n&&Ble(t)&&i[0]-s<=r[0])&&!(!n&&Vle(t)&&i[2]+s>=r[2])}}function qht(e,t,i,r){const s=i===mi.ELEVATION?oK.acquire():nK.acquire();return s.init(e,t,i,r),s}function ID(e){e.dispose(),e instanceof e2e?oK.release(e):e instanceof t2e&&nK.release(e)}const nK=new qs(t2e),oK=new qs(e2e),Wht=new eK;var Ya;function Zht(e,t){const i=e.level,r=t[0];if(i>r)return!1;const s=r-i,n=Math.floor(t[1]/2**s),o=Math.floor(t[2]/2**s);return n===e.lij[1]&&o===e.lij[2]}function Xht(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function v9(e,t,i){return Math.abs(e-t)<=i}function Yht(e,t,i){return!N(e)&&!N(t)&&t!==e&&(e.level>=t.level?nce(e,t,i):nce(t,e,dk(i)))}function nce(e,t,i){e.level>=t.level;const r=xut(i),s=Tut(i),n=e.extent,o=t.extent,a=[r?n[0]:n[2],s?n[3]:n[1]],l=[r?o[2]:o[0],s?o[1]:o[3]],c=1e-5*(n[2]-n[0]),h=v9(a[0],l[0],c)||e.surface.isGlobal&&v9(a[0],-l[0],c),p=v9(a[1],l[1],c);return h&&p?!0:e.level===t.level||!h&&!p?!1:h?oce(o[1],o[3],n[1],n[3],c):oce(o[0],o[2],n[0],n[2],c)}function oce(e,t,i,r,s=Gt){return e-s<=i&&i<=r&&r<=t+s}(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(Ya||(Ya={}));class Qht{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(t,i,r){this._scales[2*t]=i,this._scales[2*t+1]=r}setOffset(t,i,r){this._offsets[2*t]=i,this._offsets[2*t+1]=r}get scales(){return this._scales}get offsets(){return this._offsets}}class Sy{constructor(){this.geometryInfo=new uht,this.intersectionData=null,this.geometryState=null,this._textureRef=new _E(()=>this.tile.surface.textureFadeDuration),this.overlay=new Qht,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(t){this._tile=t,this.clear();const i=this.geometryInfo;i.indices=null,i.vertexAttributes=null,Fr(i.boundingBox),i.indexCount=0,i.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new ght,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(t,i){const r=this.updateGeometryStateAndPrepareForGeometryGeneration(i);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(r,t)}updateNeighborDataAndGeometryIfNeeded(t=!1,i=this.vao.context){const r=this._updateNeighborData(),s=t||this._geometryStateChangedSinceLastUpdate||r;return s&&(this._updateGeometry(i),this._geometryStateChangedSinceLastUpdate=!1),s}_calculateEdgeResolution(t,i){var c;const r=this.tile,s=this.geometryState.numVerticesPerSide-1;if(!r.surface.isGlobal){const h=r.surface.extent;if(w(h)&&(t===0&&r.extent[3]>h[3]||t===1&&r.extent[2]>h[2]||t===2&&r.extent[1]<h[1]||t===3&&r.extent[0]<h[0]))return s}const n=r.level,o=pv[t],a=i||r.findNeighborTile(o,h=>h.isLoaded||h.level===n);if(!a||a.isLeaf&&!a.isLoaded)return N((c=r.surface)==null?void 0:c.rootTiles)||r.surface.updatingRootTiles||r.shouldHaveNeighbor(o),s;if(a.isLoaded){const h=a,p=h.renderData.geometryState,m=n-h.level;if(m===0){const b=p.numVerticesPerSide-1;return Math.max(b,s)}const g=2**m,v=p.neighborData.edgeResolutions[(t+2)%4]/g;return Math.max(1,v)}a.isLeaf;let l=s;return a.forAllSubtreeOnSide(VF(o),h=>h===r||(h.isLoaded?(l=Math.max(l,2**(h.level-n)),!0):(h.isLeaf,!1))),l}_updateNeighborData(){const t=this.tile,i=c=>c.isLoaded||c.level===t.level,r=c=>c.isLoaded,s=[null,null,null,null],n=[null,null,null,null];(()=>{for(let c=0;c<4;++c){const h=t.findNeighborTile(pv[c],i);s[c]=h,n[c]=h!=null&&h.isLoaded?h:null}})();const o=[null,null,null,null];(()=>{for(let c=0;c<4;++c)o[c]=t.findNeighborTile(pk[c],r)})();const a=this.geometryState.neighborData;let l=!1;return(()=>{for(let c=0;c<4;++c){const h=a.edgeResolutions[c],p=s[c],m=this._calculateEdgeResolution(c,p);a.edgeResolutions[c]=m,h!==m&&(l=!0,this._edgeResolutionChanged=!0,p&&p!==t&&!p.isLoaded&&p.level===t.level&&(a.modifiedEdgeResolutions[c]=!0))}})(),(()=>{const c=(m,g)=>{var T,O;const v=m.reduce((C,M)=>{var I;return Math.min(C,(I=M==null?void 0:M.level)!=null?I:1/0)},1/0);for(let C=0;C<4;++C){const M=m[(C+3)%4],I=m[C];if(M&&M.level<t.level&&M===I){const $=M,U=(1&C)==1,q=(t.getNeighborEdgeStartVertexIndex(C,$)+(g===0||g===1&&!U||g===3&&U?1:0))/2**(t.level-$.level),G=U?g===0||g===1?$.extent[0]:$.extent[2]:fi($.extent[0],$.extent[2],q),Y=U?fi($.extent[1],$.extent[3],q):g===0||g===3?$.extent[1]:$.extent[3];return Gr(G,Y,$.renderData.geometryState.samplerData)}}let b=0,S=0;for(let C=0;C<4;++C){const M=m[C];if(M&&M.level===v){const I=C===0||C===1,$=C===0||C===3,U=M.extent;S+=Gr(U[I?0:2],U[$?1:3],(O=(T=M.renderData)==null?void 0:T.geometryState)==null?void 0:O.samplerData),b++}}return b?S/b:0},h=a.cornerNeighborData,p=(m,g)=>{var T;const v=h[m],b=v.cornerTiles;for(let O=0;O<4;++O){const C=pk[O],M=(T=g[O])==null?void 0:T.findCorner(dk(C),I=>(I==null?void 0:I.isLoaded)||I===t);b[O]=M}const S=c(b,m);return v.elevation!==S&&(v.elevation=S,!0)};for(let m=0;m<4;++m){const g=o[m],v=n[m],b=[g,n[(m+1)%4],t,v],S=b.map((T,O)=>b[(O+4-m)%4]);p(m,S)&&(this._cornerElevationChanged=!0,l=!0)}})(),(()=>{var p;const c=(m,g)=>{if(!(m!=null&&m.isLoaded)||m.lij[0]>t.lij[0])return null;const v=m.renderData.geometryState;return{neighborSamplerData:v.samplerData,neighborEdgeOverlapResolution:v.neighborData.edgeResolutions[g+2],version:v.samplerDataVersion,neighborVerticesPerSide:v.numVerticesPerSide,neighborTile:m}},h=a.edgeNeighbours;for(let m=0;m<4;++m){const g=n[m];g&&(g==null||g.isLoaded,(g==null?void 0:g.lij[0])<=t.lij[0],void 0);const v=h[m],b=v==null?void 0:v.version,S=c(g,m),T=(p=S==null?void 0:S.version)!=null?p:null,O=v!=null!=(S!=null),C=v&&S&&b!==T,M=v&&S&&(v==null?void 0:v.neighborTile)!==(S==null?void 0:S.neighborTile),I=O||C||M;this._edgeNeighborChanged||(this._edgeNeighborChanged=I),l||(l=I),!I&&b||(h[m]=S)}})(),l}updateEdgeAfterResolutionChange(t){var n,o;const i=this._calculateEdgeResolution(t),r=this.geometryState.neighborData.edgeResolutions,s=r[t];((o=(n=this.geometryState.neighborData.edgeNeighbours[t])==null?void 0:n.neighborTile.level)!=null?o:0)<=this.tile.level,i!==s&&(r[t]=i,this._edgeResolutionChanged=!0,Sy.deferTileNeighborUpdate?Sy.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(t){this.intersectionData=null;const i=this.tile,r=i.lij,s=Sy.updatedGeometryTiles.get(r)||0;Sy.updatedGeometryTiles.set(r,s+1);const n=this._vao,o=this.geometryInfo.vertexAttributes,a=!n||!o||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,l=!a&&this._edgeNeighborChanged,c=!l&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,a?(this._releaseGeometry(),this._createGeometry(t)):l?i.updateEdgeElevations():c?i.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(t,i){return w(this._texture)&&this._texture.descriptor.width!==t&&this.releaseTexture(),N(this._texture)&&(this._texture=i(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){w(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(t){const i=this._getElevationInfo(),r=i.samplerData?this.tile.getElevationBasedVerticesPerSide(i.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),s=Math.max(r,5);let n=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(n=null);const o=this.geometryState;let a=!1;return o.numVerticesPerSide!==s&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=s,o.samplerDataVersion++,a=!0),i.changed&&(this._samplerDataChanged=!0,o.samplerData=i.samplerData,o.samplerDataVersion++,a=!0),Yv(o.clippingArea,n)||(this._clippingAreaChanged=!0,o.clippingArea=n,a=!0),o.wireframe!==t&&(this._wireframeChanged=!0,o.wireframe=t,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),this._hasGeometry=!0,a}_createGeometry(t){this.tile.createGeometry();const i=this.geometryInfo.vertexAttributes,r=this.geometryInfo.indices,s=t.gl;this._vao=new pn(t,or,{geometry:Yc(i.layout)},{geometry:Ai.createVertex(t,s.STATIC_DRAW,i.buffer)},Ai.createIndex(t,s.STATIC_DRAW,r)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,pht(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(t,i=Ny.Immediate){w(t)&&t.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(t,i)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const t=this.geometryState.samplerData,i=this.tile.layerInfo[mi.ELEVATION],r=i.length;let s=new Array(r),n=0,o=0,a=!1;for(let l=0;l<r;l++){const c=i[l];if(w(c.upsampleInfo)){const h=c.upsampleInfo.tile,p=h.layerInfo[mi.ELEVATION][l].data,m=p&&p.samplerData;t&&t[n]===m||(a=!0),s[n++]=m,o=Math.max(o,h.lij[0])}else if(c.data){const h=this.tile.surface.layerViewByIndex(l,mi.ELEVATION);if(eP(this.tile,h.layer,!1)){const p=c.data;t&&t[n]===p.samplerData||(a=!0),s[n++]=p.samplerData,o=this.tile.level}}}return w(t)&&t.length!==n&&(a=!0),n>0?s.length=n:s=null,{changed:a,samplerData:s,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){const t=Iu(this.intersectionData,0,i=>i.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+t}get textureDescriptor(){return w(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){}}Sy.updatedGeometryTiles=new Map,Sy.deferTileNeighborUpdate=!1,Sy.neighborTilesToUpdate=new Set;const Jht=65536;function Kht(e,t){const i=e.tile,{extent:r,extentInRadians:s,surface:n}=i,o=e.localOrigin,a=e.geometryState,l=n.isWebMercator,c=n.shadingEnabled,h=a.numVerticesPerSide,p=h-1,m=(h-2)**2,g=l&&(t===td.HAS_SOUTH_POLE||t===td.HAS_BOTH_POLES),v=l&&(t===td.HAS_NORTH_POLE||t===td.HAS_BOTH_POLES),b=6,S=((g?1:0)+(v?1:0))*b*(p+1),T=a.neighborData,O=T.edgeResolutions.reduce((le,K)=>le+K+1,0),C=XSe(m+S+O),M=e.geometryInfo;M.numVerticesPerSide=a.numVerticesPerSide,M.vertexAttributes=C,_r(M.uvOffsetAndScale,0,0,1,1);const I=C.position.typedBuffer,$=C.uv0.typedBuffer,U=C.normal.typedBuffer,q=M.boundingBox;Fr(q);const G=o[0],Y=o[1],J=o[2];Sb.update(p,s);let X=0;const ne=a.samplerData,re=i.ellipsoid.radius,ye=lK(e),pe=h-2,z=r[0],j=r[2],Q=r[1],Z=r[3];(()=>{for(let le=1;le<=pe;le++){const K=le/p,ae=Q*(1-K)+Z*K,we=ye(K),Re=Math.cos(we),Ge=Math.sin(we);for(let Pe=1;Pe<=pe;Pe++){const Se=Pe/p,$e=z*(1-Se)+j*Se,qe=Sb.sinLonLUT[Pe],jt=Sb.cosLonLUT[Pe],Ti=re+Gr($e,ae,ne),li=jt*Re*Ti-G,Pi=qe*Re*Ti-Y,ct=Ge*Ti-J;Fy(li,Pi,ct,q);const Kt=jh*X;I[Kt+0]=li,I[Kt+1]=Pi,I[Kt+2]=ct,$[Kt+0]=Se,$[Kt+1]=K,++X}}})(),c&&(()=>{const le=Pe=>(Me(ky,Pe,b9),St(RC,ky,Xv),St(MC,RC,ky),MC),K=C.position,ae=C.normal;X=0;const we=Pe=>{K.getVec(Pe,Fc),Oe(Ls,Ls,le(Fc))},Re=(Pe,Se)=>{{const $e=Pe/p,qe=z*(1-$e)+j*$e,jt=Sb.sinLonLUT[Pe],Ti=Sb.cosLonLUT[Pe],li=Se/p,Pi=Q*(1-li)+Z*li,ct=ye(li),Kt=Math.cos(ct),Fi=Math.sin(ct),pr=re+Gr(qe,Pi,ne);fe(Fc,Ti*Kt*pr-G,jt*Kt*pr-Y,Fi*pr-J)}Oe(Ls,Ls,le(Fc))},Ge=(Pe,Se,$e)=>{Pe>1&&Se>1&&Pe<pe&&Se<pe?we(X+$e):Re(Pe,Se)};for(let Pe=1;Pe<=pe;Pe++)for(let Se=1;Se<=pe;Se++)K.getVec(X,b9),Oe(dm,b9,e.localOrigin),De(Xv,dm),fe(Ls,0,0,0),Ge(Se-1,Pe,-1),Ge(Se+1,Pe,1),Ge(Se,Pe-1,-pe),Ge(Se,Pe+1,+pe),De(Ls,Ls),ae.setVec(X,Ls),++X})(),X=m,o2e(e,m),d2e(e),X=m+O;const ie=[];(()=>{const le=(K,ae)=>{const we=ae*h;Fy(-G,-Y,K*re-J,q),ie.push({connectedRowOffset:we,connectedOuterEdgeOffset:K===1?0:2,rowOffset:X,latitudeResolution:b});const Re=f2e(K===-1?Q:Z,re),Ge=K*Math.PI/2-Re,Pe=.99*(K===1?1:-1),Se=re+0;for(let $e=1;$e<=b;++$e){const qe=Re+Ge*($e/b),jt=Math.cos(qe),Ti=Math.sin(qe);for(let li=0;li<=p;li++){const Pi=li/p,ct=Sb.sinLonLUT[li],Kt=Sb.cosLonLUT[li]*jt*Se-G,Fi=ct*jt*Se-Y,pr=Ti*Se-J;Fy(Kt,Fi,pr,q);const Je=jh*X;if(I[Je+0]=Kt,I[Je+1]=Fi,I[Je+2]=pr,$[Je+0]=Pi,$[Je+1]=Pe,c){const ti=1/Math.sqrt(Kt*Kt+Fi*Fi+pr*pr);U[Je+0]=ti*Kt,U[Je+1]=ti*Fi,U[Je+2]=ti*pr}++X}}};g&&le(-1,0),v&&le(1,p)})(),n2e(M,a.numVerticesPerSide,ie,[0,h-1],[0,h-1],a.wireframe),e.intersectionData=null;for(let le=0;le<4;++le)M.outerEdges[le].count,T.edgeResolutions[le]+1}function edt(e,t){const i=e.tile,r=i.extent,s=e.localOrigin,n=e.geometryState,o=i.surface,a=o.isWebMercatorOnPlateeCarree,l=o.shadingEnabled,c=r[0],h=r[1],p=r[2]-c,m=r[3]-h,g=n.clippingArea,v=w(g)?Math.max(0,(g[0]-r[0])/p):0,b=w(g)?Math.max(0,(g[1]-r[1])/m):0,S=w(g)?Math.min(1,(g[2]-r[0])/p):1,T=w(g)?Math.min(1,(g[3]-r[1])/m):1,O=S-v,C=T-b,M=O>0?1/O:1,I=C>0?1/C:1,$=-v*M,U=-b*I,q=n.numVerticesPerSide,G=q-1,Y=(q-2)**2+n.neighborData.edgeResolutions.reduce((Re,Ge)=>Re+Ge+1,0),J=XSe(Y),X=J.position.typedBuffer,ne=J.uv0.typedBuffer,re=J.normal.typedBuffer,ye=e.geometryInfo,pe=ye.boundingBox;Fr(pe);let z=0;const j=i.ellipsoid.radius,Q=n.samplerData,Z=w(g)?g:_2e,ie=ZZ(Math.max(r[0],Z[0]),Math.max(r[1],Z[1]),Math.min(r[2],Z[2]),Math.min(r[3],Z[3])),le=s[0],K=s[1],ae=s[2],we=OI(a,j,t);(()=>{for(let Re=1;Re<=G-1;Re++){const Ge=Re/G,Pe=U+Ge*I,Se=Xe(h+Ge*m,ie[1],ie[3]),$e=Xe(Pe,0,1),qe=we(Se)-K,jt=p/G;for(let Ti=1;Ti<=G-1;Ti++){const li=Ti/G,Pi=$+li*M,ct=Xe(c+li*p,ie[0],ie[2]),Kt=Xe(Pi,0,1),Fi=Gr(ct,Se,Q),pr=ct*t-le,Je=Fi-ae;Fy(pr,qe,Je,pe);const ti=jh*z;if(X[ti+0]=pr,X[ti+1]=qe,X[ti+2]=Je,ne[ti+0]=Kt,ne[ti+1]=$e,l){const Os=Gr(ct+jt,Se,Q),Zs=Gr(ct-jt,Se,Q),Dr=Gr(ct,Se+jt,Q),ml=.25*(Zs-Os),Vo=.25*(Gr(ct,Se-jt,Q)-Dr),gn=jt,ic=Math.sqrt(ml*ml+Vo*Vo+gn*gn);re[ti+0]=ml/ic,re[ti+1]=Vo/ic,re[ti+2]=gn/ic}++z}}})(),ye.numVerticesPerSide=n.numVerticesPerSide,ye.vertexAttributes=J,_r(e.geometryInfo.uvOffsetAndScale,v,b,S-v,T-b),o2e(e,z),a2e(e,t),z=Y,n2e(ye,n.numVerticesPerSide,[],[0,q-1],[0,q-1],n.wireframe),e.intersectionData=null}function n2e(e,t,i,r,s,n){const o=t-1,a=e.vertexAttributes.count,l=2*(Math.min(t-2,r[1])-Math.max(1,r[0]))*(Math.min(t-2,s[1])-Math.max(1,s[0])),c=pv.map((T,O)=>O===0&&s[1]<t-2||O===1&&r[1]<t-2||O===2&&s[0]>1||O===3&&r[0]>1),h=3*(l+e.outerEdges.reduce((T,O,C)=>T+(c[C]?0:o-2+O.count-1),0)+i.reduce((T,O)=>T+o*(2*(O.latitudeResolution-1)+1),0))*(n?2:1),p=new(a>Jht?Uint32Array:Uint16Array)(h);let m=0;const g=n?(T,O,C)=>{p[m++]=T,p[m++]=O,p[m++]=O,p[m++]=C,p[m++]=C,p[m++]=T}:(T,O,C)=>{p[m++]=T,p[m++]=O,p[m++]=C},v=t-2,b=o-2;(()=>{for(let T=Math.max(s[0],1)-1;T<Math.min(s[1],t-2)-1;++T)for(let O=Math.max(r[0],1)-1;O<Math.min(r[1],t-2)-1;++O){const C=T*v+O,M=C+1,I=M+v,$=I-1;g(C,M,I),g(I,$,C)}})(),(()=>{for(let T=0;T<4;++T){if(c[T])continue;const O=e.outerEdges[T],C=e.innerEdges[T];let M=0,I=0;const $=O.count,U=C.count;O.count;const q=T===1||T===2?(G,Y,J)=>g(G,Y,J):(G,Y,J)=>g(G,J,Y);for(;M<$-1||I<U-1;){const G=C.getVertexOffset(I),Y=O.getVertexOffset(M),J=M<$-1,X=I<U-1,ne=J?0+o*(M+.5)/($-1):0,re=X?1+b*(I+.5)/(U-1):0;J&&(!X||ne<=re)?(++M,q(G,Y,O.getVertexOffset(M))):(++I,q(G,Y,C.getVertexOffset(I)))}}})();const S=T=>{let O=e.outerEdges[T.connectedOuterEdgeOffset].offset0;for(let C=0;C<T.latitudeResolution;++C){const M=C===0?T.rowOffset:O+t;for(let I=0;I<o;I++)g(O,O+1,M+I),C<T.latitudeResolution-1&&g(O+1,M+I+1,M+I),++O;O=M}};i.forEach(S),e.indices=p,e.indexCount=h}function o2e(e,t){const i=e.localOrigin,r=e.geometryInfo,s=e.geometryState.neighborData.edgeResolutions,n=r.numVerticesPerSide-2,o=r.vertexAttributes.position.typedBuffer;let a=t;for(let l=0;l<4;++l){{const c=l===0||l===2,h=(l===0?n-1:0)*n+(l===1?n-1:0),p=(c?0:1)*n+(c?1:0);r.innerEdges[l]=new ece(o,i,h,p,n)}{const c=a,h=s[l]+1;r.outerEdges[l]=new ece(o,i,c,1,h),a+=h}}}function tdt(e){var r,s;c2e(e),m2e(e);const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function idt(e){d2e(e),aK(e)}function rdt(e,t){u2e(e,t),g2e(e,t),aK(e)}function sdt(e,t){a2e(e,t),aK(e)}function a2e(e,t){u2e(e,t),hdt(e,t),g2e(e,t)}function l2e(e,t,i,r,s){const n=Math.cos(i),o=Math.sin(i),a=Math.sin(t),l=Math.cos(t),c=s+r;e[0]=l*n*c,e[1]=a*n*c,e[2]=o*c}function ndt(e,t,i,r,s,n){const o=s[i===0?1:3];l2e(e,s[t===0?0:2],o,r,n)}function odt(e,t){return(Math.PI/2-2*Math.atan(Math.exp(-e/t)))*t}function adt(e,t){return e*t}function OI(e,t,i){return e?r=>odt(r,t):r=>adt(r,i)}function ldt(e,t,i,r,s,n,o){const a=t===0?s[0]:s[2],l=i===0?s[1]:s[3],c=r;e[0]=a*n,e[1]=o(l),e[2]=c}function cdt(e,t){const i=e.geometryState,r=e.tile,s=r.extent,n=$t(i.clippingArea,s),o=e.geometryInfo,a=o.boundingBox,l=o.outerEdges,c=i.neighborData.cornerNeighborData,h=o.uvOffsetAndScale[0],p=o.uvOffsetAndScale[1],m=o.uvOffsetAndScale[2],g=o.uvOffsetAndScale[3],v=m>0?1/m:1,b=g>0?1/g:1,S=-h*v,T=-p*b,O=r.surface.isWebMercatorOnPlateeCarree,C=OI(O,O?r.ellipsoid.radius:0,t),M=i.samplerData,I=i.neighborData.edgeNeighbours,$=e.localOrigin,U=(q,G,Y,J,X)=>{const ne=s[0]*(1-J)+s[2]*J,re=s[1]*(1-X)+s[3]*X,ye=Xe(ne,n[0],n[2]),pe=Xe(re,n[1],n[3]),z=[pe===s[3],ye===s[2],pe===s[1],ye===s[0]],j=!z[3]&&!z[1]||!z[0]&&!z[2],Q=j?z[0]&&w(I[0])?I[0]:z[1]&&w(I[1])?I[1]:z[2]&&w(I[2])?I[2]:z[3]&&w(I[3])?I[3]:null:null,Z=j?Q?Q.neighborTile.level===r.level?.5*(Gr(ye,pe,M)+Gr(ye,pe,Q.neighborSamplerData)):Gr(ye,pe,Q.neighborSamplerData):Gr(ye,pe,M):c[Y].elevation,ie=ye*t-$[0],le=C(pe)-$[1],K=Z-$[2];Fy(ie,le,K,a);const ae=Xe(S+J*v,0,1),we=Xe(T+X*b,0,1);q.setVertexRawXYZUV(G,ie,le,K,ae,we)};for(let q=0;q<4;++q){const G=l[q];U(G,0,q===0?3:q===1?1:2,q===1?1:0,q===0?1:0);const Y=q===2?1:q===3?3:0,J=q===3?0:1,X=q===2?0:1;U(G,G.count-1,Y,J,X)}}function c2e(e){h2e(e,(t,i,r,s)=>ndt(t,i,r,s,e.tile.extentInRadians,e.tile.ellipsoid.radius))}function u2e(e,t){const i=e.tile;w(i.renderData.geometryState.clippingArea)?cdt(e,t):h2e(e,(r,s,n,o)=>ldt(r,s,n,o,e.tile.extent,t,OI(i.surface.isWebMercatorOnPlateeCarree,i.ellipsoid.radius,t)))}function h2e(e,t){const i=e.geometryInfo,r=i.outerEdges,s=e.geometryState.neighborData.cornerNeighborData,n=i.boundingBox,o=e.localOrigin,a=(l,c,h,p,m)=>{t(a_,h,p,s[c].elevation);for(let g=0;g<3;++g)a_[g]-=o[g];Fy(a_[0],a_[1],a_[2],n),l.setVertexRawXYZUV(m,a_[0],a_[1],a_[2],h,p)};for(let l=0;l<4;++l){const c=r[l];a(c,l===0?3:l===1?1:2,l===1?1:0,l===0?1:0,0),a(c,l===2?1:l===3?3:0,l===3?0:1,l===2?0:1,c.count-1)}}function aK(e){var r,s;const t=e.vao,i=e.geometryInfo.vertexAttributes;(s=(r=t==null?void 0:t.vertexBuffers)==null?void 0:r.geometry)==null||s.setSubData(i.position.typedBuffer)}function d2e(e){c2e(e);for(let t=0;t<4;++t)udt(e,t);m2e(e)}function udt(e,t){var eg,tg,ig;const i=e.geometryState,r=i.neighborData,s=e.tile;s.level;const n=s.extent,o=n[2]-n[0],a=n[3]-n[1],l=s.extentInRadians,c=l[0];l[1];const h=l[2];l[3];const p=s.ellipsoid.radius,m=lK(e),g=Si=>{if(!Si)return 0;const kn=b,yn=S?0:1,_n=Si.lij[yn+1]*G,Od=s.lij[yn+1]-_n;return(S?G-1-Od:Od)*kn},v=r.edgeNeighbours[t],b=r.edgeResolutions[t],S=t===1||t===3,T=t===1?1:0,O=t===0?1:0,C=n[0]+T*o,M=n[1]+O*a,I=c*(1-T)+h*T,$=m(O),U=v==null?void 0:v.neighborTile,q=s.level-((eg=U==null?void 0:U.level)!=null?eg:s.level),G=2**q,Y=b*G,J=g(U),X=U==null?void 0:U.extent,ne=(t+2)%4,re=i.samplerData,ye=(ig=(tg=U==null?void 0:U.renderData)==null?void 0:tg.geometryState)==null?void 0:ig.samplerData,pe=U&&q===0,z=(Si,kn,yn,_n)=>.5*(Gr(Si,kn,ye)+Gr(yn,_n,re)),j=(Si,kn)=>Gr(Si,kn,ye),Q=pe?z:j;let Z=X?ne===1?X[2]:X[0]:C,ie=X?ne===0?X[3]:X[1]:M;const le=(Si,kn,yn)=>{const _n=(J+Si)/Y;return ie=X[1]*(1-_n)+X[3]*_n,Q(Z,ie,kn,yn)},K=(Si,kn,yn)=>{const _n=(J+Si)/Y;return Z=X[0]*(1-_n)+X[2]*_n,Q(Z,ie,kn,yn)},ae=U?S?le:K:(Si,kn,yn)=>Gr(kn,yn,re),we=(Si,kn,yn)=>ae(Si,kn,yn);let Re=T,Ge=C,Pe=I,Se=O,$e=M,qe=$,jt=Math.sin(Pe),Ti=Math.cos(Pe),li=Math.cos(qe),Pi=Math.sin(qe);const ct=S?()=>m(Se):()=>$,Kt=S?Si=>{Se=Si,$e=n[1]*(1-Si)+n[3]*Si,qe=ct(),li=Math.cos(qe),Pi=Math.sin(qe)}:Si=>{Re=Si,Ge=n[0]*(1-Si)+n[2]*Si,Pe=c*(1-Re)+h*Re,jt=Math.sin(Pe),Ti=Math.cos(Pe)},Fi=e.geometryInfo,pr=Fi.boundingBox,Je=Fi.vertexAttributes,ti=Je.position.typedBuffer,Os=Je.uv0.typedBuffer,Zs=Je.normal.typedBuffer,Dr=Fi.outerEdges[t];let ml=Dr.getVertexOffset(1);const Vo=b+1,gn=e.localOrigin,ic=gn[0],R1=gn[1],g0=gn[2],gi=s.surface.shadingEnabled,y0=t===1?-1:t===3?1:0,Jm=t===0?-1:t===2?1:0,Ad=o/b,_0=y0*Ad,M1=Jm*Ad,ha=y0*(1/b),P1=Jm*(1/b),Km=Si=>{Bc(ky,Si,dm),St(RC,ky,Xv),St(MC,RC,ky),Oe(Ls,Ls,MC)};for(let Si=1;Si<Vo-1;++Si){Kt(Si/b);const kn=we(Si,Ge,$e),yn=p+kn,_n=Ti*li*yn,Od=jt*li*yn,v0=Pi*yn,ef=_n-ic,b0=Od-R1,tf=v0-g0;Fy(ef,b0,tf,pr);const Xs=jh*ml;if(ti[Xs+0]=ef,ti[Xs+1]=b0,ti[Xs+2]=tf,Os[Xs+0]=Re,Os[Xs+1]=Se,gi){fe(Ls,0,0,0),fe(dm,_n,Od,v0),De(Xv,dm);const de=(fr,Rd)=>{const da=Gr(Ge+fr*_0,$e+fr*M1,Rd),ch=p+da,vt=Re+fr*ha,uh=c*(1-vt)+h*vt,Jr=Math.sin(uh),hh=Math.cos(uh),w0=m(Se+fr*P1),pa=Math.sin(w0),Qc=Math.cos(w0),rg=Ke(hh*Qc*ch,Jr*Qc*ch,pa*ch);Km(rg)};U&&de(-1,ye),U&&!pe||de(1,re),Zs[Xs+0]=Ls[0],Zs[Xs+1]=Ls[1],Zs[Xs+2]=Ls[2]}++ml}if(gi)for(let Si=1;Si<Vo-1;++Si)Dr.getVertexRawNormal(Ls,Si),Dr.getVertex(dm,Si),De(Xv,dm),Dr.getVertex(Fc,Si-1),Km(Fc),Dr.getVertex(Fc,Si+1),Km(Fc),De(Ls,Ls),Dr.setVertexRawNormal(Si,Ls[0],Ls[1],Ls[2])}function hdt(e,t){const i=e.geometryState.clippingArea,r=e.tile.extent,s=w(i)&&(r[0]<i[0]||r[2]>i[2]||r[1]<i[1]||r[3]>i[3])?pdt:ddt;for(let n=0;n<4;++n)s(e,n,t)}function p2e(e,t,i,r,s,n,o){return o===s?!e||t?(a,l)=>Gr(a,l,i):null:o===n&&e?(a,l)=>Gr(a,l,r):null}function fk(e,t,i,r){if(t!==e)return()=>0;const s=t?3:2,n=t?1:0,o=r(s,n),a=r(n,s),l=(o!=null?1:0)+(a!=null?1:0),c=t?i:0,h=t?0:i;return(p,m,g)=>((o!=null?-(o(p+c,m+h)-g):0)+(a!=null?+(a(p-c,m-h)-g):0))/l}function ddt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,m=n.extent,g=e.geometryState,v=p+1,b=c,S=e.localOrigin,T=g.samplerData,O=(K,ae)=>Gr(K,ae,T),C=(K,ae)=>.5*(Gr(K,ae,b.neighborSamplerData)+Gr(K,ae,T)),M=(K,ae)=>Gr(K,ae,b.neighborSamplerData),I=(b==null?void 0:b.neighborTile.level)===o,$=I?C:M,U=w(b)?$:O,q=e.geometryInfo,G=q.outerEdges[t],Y=OI(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),J=q.boundingBox,X=t===1||t===3,ne=t===1?m[2]:m[0],re=t===0?m[3]:m[1],ye=t===1?1:0,pe=t===0?1:0,z=(m[2]-m[0])/h,j=b==null?void 0:b.neighborSamplerData,Q=w(b),Z=(K,ae)=>p2e(Q,I,T,j,K,ae,t),ie=fk(X,!0,z,Z),le=fk(X,!1,z,Z);for(let K=1;K<v-1;++K){const ae=K/p,we=X?ne:m[0]*(1-ae)+m[2]*ae,Re=X?m[1]*(1-ae)+m[3]*ae:re,Ge=X?ye:ae,Pe=X?ae:pe,Se=U(we,Re),$e=we*i-S[0],qe=Y(Re)-S[1],jt=Se-S[2];if(Fy($e,qe,jt,J),l){const Ti=ie(we,Re,Se),li=le(we,Re,Se),Pi=z;G.setVertexRawXYZUVN(K,$e,qe,jt,Ge,Pe,Ti,li,Pi)}else G.setVertexRawXYZUV(K,$e,qe,jt,Ge,Pe)}if(l){const K=X?0:1,ae=X?1:0;for(let we=1;we<v-1;++we){G.getNormal(vE,we);const Re=G.getVertexZ(we-1)-G.getVertexZ(we+1),Ge=vE[0]+.5*K*Re,Pe=vE[1]+.5*ae*Re,Se=2*z,$e=1/Math.sqrt(Ge*Ge+Pe*Pe+Se*Se);G.setVertexRawNormal(we,$e*Ge,$e*Pe,$e*Se)}}}function pdt(e,t,i){const r=e.geometryState.neighborData,s=r.edgeNeighbours,n=e.tile,o=n.level,a=n.surface,l=a.shadingEnabled,c=s[t],h=r.edgeResolutions[t],p=h,m=n.extent,g=e.geometryState,v=$t(g.clippingArea,_2e),b=e.geometryInfo,S=b.uvOffsetAndScale[0],T=b.uvOffsetAndScale[1],O=S+b.uvOffsetAndScale[2],C=T+b.uvOffsetAndScale[3],M=O>S?1/(O-S):1,I=C>T?1/(C-T):1,$=-S*M,U=-T*I,q=p+1,G=[m[3]>v[3],m[2]>v[2],m[1]<v[1],m[0]<v[0]],Y=c,J=g.samplerData,X=(li,Pi)=>Gr(li,Pi,J),ne=(Y==null?void 0:Y.neighborTile.level)===o,re=(li,Pi)=>{const ct=Gr(li,Pi,Y.neighborSamplerData);return ne?.5*(ct+Gr(li,Pi,J)):ct},ye=X,pe=w(Y)?re:X,z=G[t]?ye:pe,j=b.outerEdges[t],Q=b.boundingBox,Z=t===1||t===3,ie=Xe(t===1?m[2]:m[0],v[0],v[2]),le=Xe(t===0?m[3]:m[1],v[1],v[3]),K=t===1?1:0,ae=t===0?1:0,we=e.localOrigin,Re=OI(a.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,i),Ge=(m[2]-m[0])/h,Pe=Y==null?void 0:Y.neighborSamplerData,Se=w(Y),$e=(Y==null?void 0:Y.neighborTile.level)===o,qe=(li,Pi)=>p2e(Se,$e,J,Pe,li,Pi,t),jt=fk(Z,!0,Ge,qe),Ti=fk(Z,!1,Ge,qe);for(let li=1;li<q-1;++li){const Pi=li/p,ct=Z?ie:Xe(m[0]*(1-Pi)+m[2]*Pi,v[0],v[2]),Kt=Z?Xe(m[1]*(1-Pi)+m[3]*Pi,v[1],v[3]):le,Fi=Z?K:Xe($+Pi*M,0,1),pr=Z?Xe(U+Pi*I,0,1):ae,Je=z(ct,Kt),ti=ct*i-we[0],Os=Re(Kt)-we[1],Zs=Je-we[2];if(Fy(ti,Os,Zs,Q),l){const Dr=jt(ct,Kt,Je),ml=Ti(ct,Kt,Je),Vo=Ge;j.setVertexRawXYZUVN(li,ti,Os,Zs,Fi,pr,Dr,ml,Vo)}else j.setVertexRawXYZUV(li,ti,Os,Zs,Fi,pr)}if(l){const li=Z?0:1,Pi=Z?1:0;for(let ct=1;ct<q-1;++ct){j.getNormal(vE,ct);const Kt=j.getVertexZ(ct-1)-j.getVertexZ(ct+1),Fi=vE[0]+.5*li*Kt,pr=vE[1]+.5*Pi*Kt,Je=2*Ge,ti=1/Math.sqrt(Fi*Fi+pr*pr+Je*Je);j.setVertexRawNormal(ct,ti*Fi,ti*pr,ti*Je)}}}function f2e(e,t){return Math.PI/2-2*Math.atan(Math.exp(-e/t))}function fdt(e,t,i,r){return f2e(e+r*(t-e),i)}function mdt(e,t,i){return e*(1-i)+t*i}function lK(e){const t=e.tile;if(t.surface.isWebMercator){const r=t.extent,s=t.ellipsoid.radius;return n=>fdt(r[1],r[3],s,n)}const i=t.extentInRadians;return r=>mdt(i[1],i[3],r)}function m2e(e){e.tile.surface.shadingEnabled&&y2e(e,(t,i,r,s,n,o,a)=>gdt(i,t,r,s,n,o,a))}function g2e(e,t){e.tile.surface.shadingEnabled&&y2e(e,(i,r,s,n,o,a,l)=>ydt(vdt(e,t),i,s,o,a,l))}function gdt(e,t,i,r,s,n,o){_dt(e,Fc,s,n,o),Bc(ky,Fc,i),St(RC,ky,r),St(t,RC,ky)}function ydt(e,t,i,r,s,n){e(Fc,r,s,n);const o=Fc[0]-i[0],a=Fc[1]-i[1],l=Fc[2]-i[2];t[0]=-o*l,t[1]=-a*l,t[2]=o*o+a*a}function _dt(e,t,i,r,s){const n=lK(e),o=e.tile,a=o.extent;hR(a,i,r,1);const l=(i-a[0])/(a[2]-a[0]),c=(r-a[1])/(a[3]-a[1]),h=o.extentInRadians;l2e(t,h[0]*(1-l)+h[2]*l,n(c),s,o.ellipsoid.radius)}function vdt(e,t){return e.tile.surface.isWebMercatorOnPlateeCarree?(i,r,s,n)=>wdt(t,e.tile.ellipsoid.radius,i,r,s,n):(i,r,s,n)=>bdt(t,i,r,s,n)}function bdt(e,t,i,r,s){t[0]=i*e,t[1]=r*e,t[2]=s}function wdt(e,t,i,r,s,n){i[0]=r*e,i[1]=(Math.PI/2-2*Math.atan(Math.exp(-s/t)))*t,i[2]=n}function y2e(e,t){var o;if(!e.tile.surface.shadingEnabled)return;const i=e.geometryState.neighborData.cornerNeighborData,r=e.tile,s=r.extent,n=((o=e.tile.surface.view)==null?void 0:o.viewingMode)==="local";n&&fe(Xv,0,0,1);{const a=(b,S,T,O)=>{t(MC,b.renderData,dm,Xv,S,T,O),Oe(Ls,Ls,MC)},c=(b,S,T,O,C,M)=>{const I=M===1?C.extent[0]:M===3?C.extent[2]:b,$=M===0?C.extent[1]:M===2?C.extent[3]:S,U=I+ES[T][0]*O,q=$+ES[T][1]*O;hR(C.extent,U,q,1);const G=Gr(U,q,C.renderData.geometryState.samplerData);a(C,U,q,G)},h=(b,S,T)=>b.extent[S===0||S===1?2:0]+T,p=(b,S,T)=>b.extent[S===0||S===3?3:1]+T,m=(b,S,T,O)=>{const C=h(T,O,ES[b][0]*S),M=p(T,O,ES[b][1]*S);hR(T.extent,C,M,1);const I=Gr(C,M,T.renderData.geometryState.samplerData);a(T,C,M,I)},g=(b,S,T,O,C,M)=>{const I=ES[b][0]*S,$=ES[b][1]*S,U=h(T,O,I),q=p(T,O,$),G=h(C,M,I),Y=p(C,M,$);hR(T.extent,U,q,1),hR(C.extent,G,Y,1);const J=Gr(U,q,T.renderData.geometryState.samplerData),X=Gr(G,Y,C.renderData.geometryState.samplerData);a(T,U,q,.5*(J+X))},v=b=>{const S=b===0||b===1?s[2]:s[0],T=b===0||b===3?s[3]:s[1],O=i[b].cornerTiles,C=O.reduce((M,I)=>{var $;return Math.min(M,($=I==null?void 0:I.level)!=null?$:1/0)},1/0);for(let M=0;M<4;++M){const I=O[M];l_[M]=(I==null?void 0:I.level)===C?I:null}for(let M=0;M<4;++M){const I=l_[(M+3)%4],$=l_[M];if(I!=null&&I!==r&&I===$){const U=I,q=(M+2)%4,G=U.renderData.geometryState.neighborData.edgeResolutions[q],Y=Math.max(G,2**(r.level-U.level)),J=(U.extent[2]-U.extent[0])/Y,X=(M+0)%4,ne=(M+1)%4;return c(S,T,(M+3)%4,J,U,M),c(S,T,X,J,U,M),c(S,T,ne,J,U,M),Ls}}{l_.some(I=>(I==null?void 0:I.isLoaded)||I===r);const M=l_.reduce((I,$)=>$?$.extent[2]-$.extent[0]:I,0)/l_.reduce((I,$)=>{var U;return Math.max(I,(U=$==null?void 0:$.renderData.geometryState.numVerticesPerSide)!=null?U:1)},1);for(let I=0;I<4;++I){const $=l_[(I+3)%4],U=l_[(I+0)%4];if(!$&&!U)continue;const q=I===0?1:I===1?2:I===2?3:0,G=I===0?2:I===1?3:I===2?0:1;$&&U?g(I,M,$,q,U,G):m(I,M,$!=null?$:U,$?q:G)}}return Ls};for(let b=0;b<4;++b){const S=e.geometryInfo.outerEdges[b],T=b===1||b===2?0:S.count-1;S.getVertex(dm,T),n||De(Xv,dm),fe(Ls,0,0,0);const O=v(b);De(w9[b],O)}}{const a=(c,h,p,m,g)=>{c.setVertexRawNormal(g,h,p,m)},l=e.geometryInfo.outerEdges;for(let c=0;c<4;++c){const h=l[c];{const p=w9[c===0?3:c===1?1:2];a(h,p[0],p[1],p[2],0)}{const p=w9[c===2?1:c===3?3:0];a(h,p[0],p[1],p[2],h.count-1)}}}}function Fy(e,t,i,r){e<r[0]?r[0]=e:e>r[3]&&(r[3]=e),t<r[1]?r[1]=t:t>r[4]&&(r[4]=t),i<r[2]?r[2]=i:i>r[5]&&(r[5]=i)}const ES=[[0,1],[1,0],[0,-1],[-1,0]],Sb=new fht,_2e=ZZ(-1/0,-1/0,1/0,1/0),a_=F(),Fc=F(),ky=F(),RC=F(),MC=F(),dm=F(),b9=F(),Xv=F(),Ls=F(),vE=F(),w9=[F(),F(),F(),F()],l_=[null,null,null,null];class xdt extends sK{constructor(t,i,r){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=ei(),t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=r.view.renderSpatialReference,n=r.spatialReference,o=w(s)&&dP(s)&&n.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this.extentInRenderSR,c=this.extent;if(a){const h=Ke(c[0],c[1],0);$n(h,wt.WebMercator,h,wt.PlateCarree);const p=Ke(c[2],c[3],0);$n(p,wt.WebMercator,p,wt.PlateCarree),l[0]=h[0],l[1]=h[1],l[2]=p[0],l[3]=p[1]}else for(let h=0;h<4;++h)l[h]=c[h]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const t=this.extentInRenderSR,i=.5*(t[2]-t[0]),r=.5*(t[3]-t[1]),s=Math.sqrt(i*i+r*r),n=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(s,n);this._center[Ya.MIDDLE][3]=o}_isVisible(t){return qXe(t,this._aabb())}_aabb(){const t=this.extentInRenderSR;return QMe(t[0],t[1],this.elevationBounds[0],t[2],t[3],this.elevationBounds[1])}intersectsRay(t,i,r,s){return LD[0]=1/i[0],LD[1]=1/i[1],LD[2]=1/i[2],cJ(this._aabb(),t,LD,r,s)}createGeometry(){edt(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){rdt(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){sdt(this.renderData,this.horizontalScaleFactor)}}const LD=F();var C3;(function(e){e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT",e[e.NONE=0]="NONE",e[e.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(C3||(C3={}));class Tdt extends sK{constructor(t,i,r){super(),this.obb=new Array(8);for(let s=0;s<8;s++)this.obb[s]=F();t!==void 0&&this.init(t,i,r)}init(t,i,r){super.init(t,i,r);const s=this.ellipsoid.radius,n=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=t[0],h=fi(o,l,.5),p=fi(n,a,.5),m=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-n)*Math.cos(m)*s,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=s-Math.sqrt(s*s-this._edgeLen2/4),GA(this.centerAtSeaLevel,p,h,this.ellipsoid.radius);const g=$l(this.centerAtSeaLevel);De(g,g),this.up=g,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(this.lij[0]===0)fe(this._center[hp.MIDDLE],0,0,0),fe(this._center[hp.TOP],0,0,0),fe(this._center[hp.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=ji(this.surface.spatialReference)),this._center[hp.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const t=Math.max(Yn(this._center[hp.MIDDLE],this.obb[0]),Yn(this._center[hp.MIDDLE],this.obb[1]));this._center[hp.MIDDLE][3]=Math.sqrt(t)}}_isVisible(t){if(!Pv(t,this._center[hp.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const i=this.obb;for(let r=0;r<Jy.NUM;r++){const s=r===Ar.NEAR,n=t[r];s&&(NO[0]=n[0],NO[1]=n[1],NO[2]=n[2],NO[3]=n[3]-this.surface.view.state.camera.near);const o=s?NO:n;let a;for(a=0;a<8;a++){const l=i[a];if(o[0]*l[0]+o[1]*l[1]+o[2]*l[2]+o[3]<0)break}if(a===8)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const t=this._getPatchType(this.lij[1],this.lij[0]);Kht(this.renderData,t),this.setMemoryDirty()}_updateOBB(){const t=this.extentInRadians,i=this.obb;for(let r=0;r<2;r++){const s=this.elevationBounds[r];let n=4*r;GA(i[n++],t[0],t[1],this.ellipsoid.radius+s),GA(i[n++],t[0],t[3],this.ellipsoid.radius+s),GA(i[n++],t[2],t[3],this.ellipsoid.radius+s),GA(i[n++],t[2],t[1],this.ellipsoid.radius+s)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case td.HAS_NORTH_POLE:fe(i[1],0,0,this.ellipsoid.radius),fe(i[2],0,0,this.ellipsoid.radius),fe(i[5],0,0,this.ellipsoid.radius),fe(i[6],0,0,this.ellipsoid.radius);break;case td.HAS_SOUTH_POLE:fe(i[0],0,0,-this.ellipsoid.radius),fe(i[3],0,0,-this.ellipsoid.radius),fe(i[4],0,0,-this.ellipsoid.radius),fe(i[7],0,0,-this.ellipsoid.radius)}}_getPatchType(t,i){return t===(1<<i)-1?t===0?td.HAS_BOTH_POLES:td.HAS_SOUTH_POLE:t===0?td.HAS_NORTH_POLE:td.REGULAR}intersectsRay(t,i,r,s){const n=this._center[hp.MIDDLE],o=n[3]+r,a=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],l=n[0]-t[0],c=n[1]-t[1],h=n[2]-t[2],p=(l*i[0]+c*i[1]+h*i[2])/a,m=i[0]*p-l,g=i[1]*p-c,v=i[2]*p-h;return m*m+g*g+v*v<o*o}getDefaultVerticesPerRowOnLevel(){return this.level<ace.length?ace[this.level]+1:2}updateCornerElevations(){tdt(this.renderData)}updateEdgeElevations(){idt(this.renderData)}}const ace=[128,64,32,16,16,8,8,4],NO=Vi();var hp;(function(e){e[e.TOP=0]="TOP",e[e.MIDDLE=1]="MIDDLE",e[e.BOTTOM=2]="BOTTOM"})(hp||(hp={}));class Sdt{constructor(){this.extent=di(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class Edt{constructor(){this._queries=new hi({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new hi({initialSize:30}),this._queryPool=new qs(Sdt)}queryVisibleLevelRange(t,i,r,s){const n=this._queryPool.acquire();Ap(n.extent,t),n.minLevel=i||-Number.MAX_VALUE,n.maxLevel=r!=null?r:Number.MAX_VALUE,n.callback=s,this._queryQueue.push(n)}hasPendingQueries(){return this._queryQueue.length!==0}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const t=this._queryQueue.pop();this._queries.push(t)}this._queriesInvPtr=this._queries.length}processQueries(){for(let t=0;t<this._queries.length;t++){const i=this._queries.data[t];this._queryPool.release(i),i.callback(t>=this._queriesInvPtr),i.callback=null}this._queries.clear()}scaleQueriesForTile(t){const i=t.level;let r=0;for(;r<this._queriesInvPtr;){const s=this._queries.data[r],n=s.extent;i>=s.minLevel&&i<=s.maxLevel&&n[0]<=t.extent[2]&&n[2]>=t.extent[0]&&n[1]<=t.extent[3]&&n[3]>=t.extent[1]?(this._queries.swapElements(r,this._queriesInvPtr-1),this._queriesInvPtr--):r++}}}class cK extends pl{constructor(){super(...arguments),this.blendMode=Qe.Normal}}u([ee({count:Qe.COUNT})],cK.prototype,"blendMode",void 0);class Cdt extends i2e{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=Qe.Normal,this.backgroundColor=ol}}class iB extends $r{initializeProgram(t){const i=iB.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:qm(je.ONE,je.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}}iB.shader=new Tr(Oht,()=>_e(()=>import("./BlendLayers.glsl.4b022988.js"),[],import.meta.url));class qF extends cK{constructor(){super(...arguments),this.output=Do.Composite,this.baseOpacityMode=Zn.One,this.premultipliedSource=!1}}u([ee({count:Do.COUNT})],qF.prototype,"output",void 0),u([ee({count:Zn.COUNT})],qF.prototype,"baseOpacityMode",void 0),u([ee()],qF.prototype,"premultipliedSource",void 0);class x9{constructor(t,i,r,s,n,o){this.texture=t,this.type=i,t.retain(),this.offsetAndScale=ki(r.offset[0],r.offset[1],r.scale,r.scale),this.opacities=Ke(s,o,n)}destroy(){this.texture.release()}}function WF(){return[1,0,0,1,0,0]}function Adt(e){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function Odt(e,t,i,r,s,n){return[e,t,i,r,s,n]}function Rdt(e,t){return new Float64Array(e,t,6)}Object.freeze(Object.defineProperty({__proto__:null,create:WF,clone:Adt,fromValues:Odt,createView:Rdt},Symbol.toStringTag,{value:"Module"}));function Mdt(e){return e instanceof Float32Array&&e.length>=2}function Pdt(e){return Array.isArray(e)&&e.length>=2}function T9(e){return Mdt(e)||Pdt(e)}const Idt=96,Ldt=39.37;function uK(e,t){return t.type?Di(e,t.x,t.y):zo(e,t)}function $dt(e){return Zc(e)}function Ddt(e,t){const i=e.targetGeometry,r=t.targetGeometry;return i.x=r.x,i.y=r.y,i.spatialReference=r.spatialReference,e.scale=t.scale,e.rotation=t.rotation,e}const Ndt=function(){const e=yt();return function(t,i,r){const s=i.targetGeometry;uK(e,s);const n=.5*rB(i);return t.xmin=e[0]-n*r[0],t.ymin=e[1]-n*r[1],t.xmax=e[0]+n*r[0],t.ymax=e[1]+n*r[1],t.spatialReference=s.spatialReference,t}}();function rB(e){return e.scale*Fdt(e.targetGeometry)}function Fdt(e){return w(e)&&Xl(e.spatialReference)?1/($dt(e.spatialReference)*Ldt*Idt):1}function kdt(e){return Dk(e.rotation)||0}const hK=function(){const e=yt(),t=yt(),i=yt();return function(r,s,n,o,a,l){return lQ(e,s),Ic(t,n,.5*l),Di(i,1/o*l,-1/o*l),iQ(r,t),a&&eQ(r,r,a),Pve(r,r,i),tQ(r,r,e),r}}(),Udt=function(){const e=yt();return function(t,i,r,s){const n=rB(i),o=kdt(i);return uK(e,i.targetGeometry),hK(t,e,r,n,o,s)}}(),zdt=function(){const e=yt();return function(t,i,r,s){const n=rB(i);return uK(e,i.targetGeometry),hK(t,e,r,n,0,s)}}();function Bdt(e){const t=kv(e);return t?t.valid[1]-t.valid[0]:0}function Vdt(e,t){return Math.round(Bdt(e)/t)}var MW;const Og=[0,0];let W_=MW=class extends Fe{constructor(e){super(e),this._viewpoint2D={center:yt(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new zi,this.id=0,this.inverseTransform=WF(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=WF(),this.transformNoRotation=WF(),this.displayMat3=Dy(),this.displayViewMat3=Dy(),this.viewMat3=Dy(),this.viewMat2d=Ave(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(e){this._set("pixelRatio",e),this._update()}set size(e){this._set("size",e),this._update()}set viewpoint(e){if(e){const t=this._viewpoint2D,i=e.targetGeometry;t.center[0]=i.x,t.center[1]=i.y,t.rotation=e.rotation,t.scale=e.scale,t.spatialReference=i.spatialReference}this._update()}copy(e){const t=this.size,i=this.viewpoint;return i&&t?(this.viewpoint=Ddt(i,e.viewpoint),this._set("size",zo(t,e.size))):(this.viewpoint=e.viewpoint.clone(),this._set("size",[e.size[0],e.size[1]])),this._set("pixelRatio",e.pixelRatio),this}clone(){return new MW({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(e,t,i){return T9(t)?sw(e,t,this.inverseTransform):(Og[0]=t,Og[1]=i,sw(e,Og,this.inverseTransform))}toScreen(e,t,i){return T9(t)?sw(e,t,this.transform):(Og[0]=t,Og[1]=i,sw(e,Og,this.transform))}toScreenNoRotation(e,t,i){return T9(t)?sw(e,t,this.transformNoRotation):(Og[0]=t,Og[1]=i,sw(e,Og,this.transformNoRotation))}getScreenTransform(e,t){const{center:i}=this._viewpoint2D,r=this._get("pixelRatio")||1,s=this._get("size");return hK(e,i,s,t,0,r),e}_update(){const{center:e,spatialReference:t,scale:i,rotation:r}=this._viewpoint2D,s=this._get("pixelRatio")||1,n=this._get("size"),o=new Zp({targetGeometry:new xt(e[0],e[1],t),scale:i,rotation:r});if(this._set("viewpoint",o),!n||!t||!i)return;this.resolution=rB(o),this.rotation=r,this.scale=i,this.spatialReference=t,zo(this.center,e);const a=n[0]!==0?2/n[0]:0,l=n[1]!==0?-2/n[1]:0;TQ(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=SQ(this.viewMat3),h=il(n[0]/2,n[1]/2),p=il(-n[0]/2,-n[1]/2),m=Dk(r);T5(c,c,h),EQ(c,c,m),T5(c,c,p),XU(this.displayViewMat3,this.displayMat3,c);const g=iQ(this.viewMat2d,h);return eQ(g,g,m),tQ(g,g,p),Ndt(this.extent,o,n),Udt(this.transform,o,n,s),Rve(this.inverseTransform,this.transform),zdt(this.transformNoRotation,o,n,s),this.worldScreenWidth=Vdt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};u([f({readOnly:!0})],W_.prototype,"id",void 0),u([f({value:1,json:{write:!0}})],W_.prototype,"pixelRatio",null),u([f({json:{write:!0}})],W_.prototype,"size",null),u([f()],W_.prototype,"spatialReference",void 0),u([f({type:Zp,json:{write:!0}})],W_.prototype,"viewpoint",null),W_=MW=u([B("esri.views.2d.ViewState")],W_);const Gdt=W_,jdt=.125;class Hdt{constructor(){this._renderParams={context:null,drawPhase:1,state:new Gdt({viewpoint:new Zp({targetGeometry:new xt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(t,i,r,s,n,o,a,l,c,h){const p=o.adjustLevel(i[0]),m=this._renderParams;m.context=t,m.painter=s,m.glyphMosaic=s.glyphMosaic,m.spriteMosaic=s.spriteMosaic,m.pixelRatio=h,m.displayLevel=p,m.requiredLevel=p;const g=o.getScale(i[0]),[v,b]=o.getShift(i,a*g),S=jdt*a*g/c,T=r.transforms.dvs;T[0]=S,T[4]=-S,T[6]=-1-v-l[0]*a*2,T[7]=1+b+(1-l[1])*a*2-2,m.state.size[0]=c,m.state.size[1]=c,r.stage||r.attachWithContext(t),r.triangleCount=0,s.drawTile(m,r,n)}}class sB extends $r{initializeProgram(t){const i=sB.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:qm(je.ONE,je.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}}sB.shader=new Tr(Dht,()=>_e(()=>import("./RasterColorizer.glsl.d6f3827c.js"),[],import.meta.url));class S2 extends cK{constructor(){super(...arguments),this.colorizerType=_x.Stretch,this.stretchType=nT.Noop,this.tileBlendInput=ca.LayerOnly,this.baseOpacityMode=Zn.One,this.applyColormap=!0}}u([ee({count:_x.COUNT})],S2.prototype,"colorizerType",void 0),u([ee({count:nT.COUNT})],S2.prototype,"stretchType",void 0),u([ee({count:ca.COUNT})],S2.prototype,"tileBlendInput",void 0),u([ee({count:Zn.COUNT})],S2.prototype,"baseOpacityMode",void 0),u([ee()],S2.prototype,"applyColormap",void 0);class lce{constructor(t){this._rctx=t,this._pools=new Map}acquire(t){return this._getPool(t).acquire()}clear(){this._pools.forEach(t=>t.destroy()),this._pools.clear()}_getPool(t){let i=this._pools.get(t);if(!i){const r=cce.bind(cce,this._rctx,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.DEPTH_RENDER_BUFFER,width:t,height:t},s=>this._getPool(s.width).release(s));i=new qs(r,null,()=>{}),this._pools.set(t,i)}return i}}class cce extends Xr{constructor(t,i,r){super(t,i),this.release=()=>r(this)}}const qdt=Ie.getLogger("esri.views.3d.terrain");class Wdt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new Hdt,this._bindParameters=new JU(null,null,null),this._blendLayersTechniqueConfig=new qF,this._poolToWrite=0,this._vaoQuad=fl(this._rctx,aI),this._fboPools.push(new lce(this._rctx)),this._fboPools.push(new lce(this._rctx))}dispose(){this._fboPools.forEach(t=>{t.clear(),t=null}),this._fboPools=null,this._doubleBufferFbo.forEach(t=>ht(t)),this._vaoQuad=ht(this._vaoQuad),this._vectorTileHelper=ht(this._vectorTileHelper),this._backgroundTechnique=vr(this._backgroundTechnique),this._applyOpacityTechnique=vr(this._applyOpacityTechnique),this._blendLayersTechnique=vr(this._blendLayersTechnique)}_getBlendLayersTechnique(t,i,r,s=!1){return this._blendLayersTechniqueConfig.output=i,this._blendLayersTechniqueConfig.blendMode=t,this._blendLayersTechniqueConfig.baseOpacityMode=r?i===Do.Composite?Zn.OnBaseLayer:Zn.OnBackground:Zn.One,this._blendLayersTechniqueConfig.premultipliedSource=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(iB,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(t,i){const r=this._getBlendLayersTechnique(Qe.Normal,i,!1),s=this._rctx.bindTechnique(r,t,this._bindParameters);this._render(s)}_render(t){this._rctx.bindVAO(this._vaoQuad),t.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Yt.TRIANGLE_STRIP,0,na(this._vaoQuad,"geometry"))}drawRasterData(t,i,r=!1){if(N(i.texture))return;const s=i.baseOpacity<1;i.blendMode!==Qe.Normal||s||r?(i.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):i.fboTexture=null;const n=this._getBlendLayersTechnique(i.blendMode,t,s,r),o=this._rctx.bindTechnique(n,i,this._bindParameters);this._render(o)}drawImageryTileData(t,i,r){const s=t.sourceLayerInfo.data;if(!s.source)return;t.tile.surface.layerViewByIndex(t.layerIndex,mi.MAP).ensureSymbolizerParameters(s);const n=r.baseOpacity<1;r.blendMode!==Qe.Normal||n?(r.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):r.fboTexture=null;const o=this._getRasterColorizerTechnique(s,i,r.blendMode,n),a=this._rctx.bindTechnique(o);if(!s.bind(this._rctx))return;s.opacity=r.opacity;const l=s.getUniforms();l.scale=t.scale,l.offset=t.offset,l.backgroundColor=r.backgroundColor,l.fboTexture=r.fboTexture,l.baseOpacity=r.baseOpacity,o.bindPass(l,null),this._render(a)}_getRasterColorizerTechnique(t,i,r,s){const n=t.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(n.type);return N(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new S2,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=i===Do.ColorComposite?ca.ColorComposite:i===Do.GridComposite?ca.GridComposite:ca.LayerOnly,this._rasterColorizerConfig.blendMode=r,this._rasterColorizerConfig.baseOpacityMode=s?i===Do.Composite?Zn.OnBaseLayer:Zn.OnBackground:Zn.One,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!n.colormap,this._rasterColorizerConfig.stretchType=t.hasStretchTypeNone()?nT.Noop:nT.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(sB,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(t,i,r,s,n,o,a){const l=this._rctx,c=i.sourceLayerInfo.data,h=i.tile.surface.layerViewByIndex(i.layerIndex,mi.MAP),p=t.baseOpacity<1||t.opacity<1||t.blendMode!==Qe.Normal||a!==Do.Composite;let m;this._getBlendLayersTechnique(t.blendMode,a,t.baseOpacity<1,p).bindPipelineState(l),p?(m=this._acquire(n),l.bindFramebuffer(m),l.setClearColor(0,0,0,0),l.clearSafe(br.COLOR_BUFFER_BIT|br.DEPTH_BUFFER_BIT)):o&&l.clearSafe(br.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(l,i.sourceLod,c,h.painter,h.layer.styleRepository,h.schemaHelper,Math.round(1/i.scale),i.offset,s,r)}catch(g){qdt.warnOnce("A render call containing vector tiles did not resolve correctly.",g)}return!w(m)||(l.bindFramebuffer(this._currentFBO),t.texture=m.colorTexture,t.offset=gd,t.scale=1,this.drawRasterData(a,t,p),m.release(),o)}copyFBOToTexture(t){const i=this._rctx,r=i.bindTexture(t.texture,bt.TEXTURE_UNIT_FOR_UPDATES),s=t.descriptor;i.gl.copyTexImage2D(Ot.TEXTURE_2D,0,s.pixelFormat,0,0,s.width,s.height,0),t.generateMipmap(),i.bindTexture(r,bt.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(t,i){this._rctx.bindFramebuffer(t),this._rctx.setViewport(0,0,i,i),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(br.COLOR_BUFFER_BIT|br.DEPTH_BUFFER_BIT)}_acquire(t){return this._fboPools[this._poolToWrite].acquire(t)}bindPool(t,i){this._poolToWrite=t,this._doubleBufferFbo[t]==null&&(this._doubleBufferFbo[t]=this._acquire(i),this._initFBO(this._doubleBufferFbo[t],i))}_switchPool(t){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=this._poolToWrite===0?1:0,this.bindPool(this._poolToWrite,t)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(t,i){t===this._lastPixelRatio&&i===this._lastNumLayers||(this._fboPools.forEach(r=>r.clear()),this._lastPixelRatio=t,this._lastNumLayers=i)}}class Zdt{constructor(t,i,r){this._rctx=t,this.tileSize=i,this._techniqueRepository=r,this._passParameters=new Cdt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new Wdt(this._rctx,this._techniqueRepository),this._blackTex=new T2(xHe(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=ht(this._composition),this._backgroundTexture=vr(this._backgroundTexture),this._blackTex=vr(this._blackTex)}get backgroundIsGrid(){return N(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(t,i){if(!t.renderData)return;const r=t.surface,s=r.baseOpacity;this._numTexturedLayer=0;let n=0,o=this.tileSize,a=!1;const l=r.view.state.pixelRatio;let c=!1;const h=t.layerInfo[mi.MAP];let p=h.length,m=0;for(;m<h.length;m++){const b=r.layerViewByIndex(m,mi.MAP),S=b.fullOpacity;if(E9[m]=S,Mge(b.layer)&&p>=h.length&&(p=m),S===0){h[m].pendingUpdates&=~(Nt.TEXTURE_NOFADING&Nt.TEXTURE_FADING);continue}++n;const T=S9(t,m);if(T){if(h[m].pendingUpdates&=~(Nt.TEXTURE_NOFADING&Nt.TEXTURE_FADING),hk(b)){const O=VSe(b.layer.parent)?"normal":b.layer.blendMode;uce[m]=O;const C=O!=="normal";C&&(c=C,a=!1)}T3(b)?o=Math.max(o,this.tileSize*l):s===1&&S===1&&(b.isOpaque||this._dataToTexture(T)&&T.sourceLayerInfo.data.descriptor.isOpaque)&&(a=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(l,h.length),o=Xdt(o);const g=o/this.tileSize,v=m-1;this._ensureBackgroundTexture(this.tileSize),this._numTexturedLayer!==0?this._numTexturedLayer===1&&!c&&this._useLayerTexture(t,v,p,E9[v])||this._composeMapLayers(t,i,v,p,E9,uce,o,g,!a||c):this._useBackgroundTexture(t,n)}_ensureBackgroundTexture(t){N(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(t),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,t),this._passParameters.offset=gd,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=Qe.Normal,w(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,w(this.backgroundColor)?Do.ColorOnly:Do.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(t,i){let r=Ny.Immediate;(t.surface.view.layerViewManager.updating||i>0)&&(r=Ny.Delayed),this._backgroundTexture&&N(t.renderData.textureReference)&&(r=Ny.Immediate),t.renderData.setTextureReference(w(this._backgroundTexture)?new x9(this._backgroundTexture,uo.FADING,hce,t.surface.baseOpacity,1,0):null,r)}_useLayerTexture(t,i,r,s){const n=i<r,o=n?1:t.surface.baseOpacity,a=n?t.surface.baseOpacity:1,l=S9(t,i);return!!this._dataToTexture(l)&&(t.renderData.setTextureReference(new x9(l.sourceLayerInfo.data,uo.FADING,l,o,s,a)),!0)}_composeMapLayers(t,i,r,s,n,o,a,l,c){this._composition.bindPool(0,a);const h=t.surface.baseOpacity;let p=!1,m=mt.LINEAR_MIPMAP_LINEAR,g=!1,v=0;for(let S=r;S>=0;S--){const T=S9(t,S);if(!T||n[S]===0)continue;const O=S<s&&h<1&&!p;this._passParameters.baseOpacity=O?h:1,O&&(p=!0);const C=v===0,M=c&&C?this.backgroundIsGrid?Do.GridComposite:Do.ColorComposite:Do.Composite;gut(T)?(this._passParameters.opacity=n[S],this._passParameters.blendMode=GF[o[S]],g=this._composition.drawVectorData(this._passParameters,T,l,this.tileSize,a,g,M)):mut(T)?(this._passParameters.opacity=n[S],this._passParameters.blendMode=GF[o[S]],this._composition.drawImageryTileData(T,M,this._passParameters),this._hasNearestInterpolation(T)&&(m=mt.NEAREST)):this._dataToTexture(T)&&(this._passParameters.texture=T.sourceLayerInfo.data.texture,this._passParameters.offset=T.offset,this._passParameters.scale=T.scale,this._passParameters.opacity=n[S],this._passParameters.blendMode=GF[o[S]],this._composition.drawRasterData(M,this._passParameters)),v++}const b=t.renderData.ensureTexture(a,()=>this._buildTexture(a,m));this._composition.copyFBOToTexture(b),this._composition.releasePool(),t.renderData.setTextureReference(new x9(b,i,hce,p?1:h,1,0))}_hasNearestInterpolation(t){const i=t.sourceLayerInfo.data;return!!i.source&&i.interpolation==="nearest"}_dataToTexture(t){return _ut(t)&&this._rasterDataToTexture(t),yut(t)}_rasterDataToTexture(t){const i=t.sourceLayerInfo;i.data=this._buildTexture(i.data),t.tile.setMemoryDirty()}setBackground(t){this._backgroundColor!==t&&(this._backgroundColor=t,this._backgroundDirty=!0)}_buildTexture(t,i=mt.LINEAR_MIPMAP_LINEAR){if(N(t))return null;const r={target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:i,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},s=this._rctx;let n;if(typeof t=="number")r.width=r.height=t,n=new T2(new bt(s,r));else if(t instanceof Qz)r.isOpaque=t.isOpaque,n=new T2(new bt(s,r,t.image)),t.release();else try{n=new T2(new bt(s,r,t))}catch{n=new T2(I1e(s)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=s.bindTexture(n.texture,bt.TEXTURE_UNIT_FOR_UPDATES);return n.generateMipmap(),s.bindTexture(o,bt.TEXTURE_UNIT_FOR_UPDATES),n}get test(){return{backgroundTexture:this._backgroundTexture}}}function Xdt(e){const t=RE(e),i=t*t,r=e*e;if(i===r)return e;const s=t/2;return i-r<r-s*s?t:s}function S9(e,t){au.layerIndex=t;const i=e.layerInfo[mi.MAP][t];if(w(i.data))return Di(au.offset,0,0),au.tile=e,au.scale=1,au.sourceLod=e.lij,au.sourceLayerInfo=i,au;const r=i.upsampleInfo;if(w(r)){const s=r.tile.layerInfo[mi.MAP][t];return au.tile=r.tile,zo(au.offset,r.offset),au.scale=r.scale,au.sourceLod=r.tile.lij,au.sourceLayerInfo=s,au}return null}const E9=new Array,uce=new Array,au={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},hce={offset:[0,0],scale:1},v2e=200,C9=40,Ydt=.8,Qdt=10,nM=1e-6;function Jdt(e,t,i){const r=t,s=i;let n=0,o=1/0;for(let a=0;a<3;++a){{const l=e[a];if(r[a]<l){if(s[a]<=nM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]<=-nM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}{const l=e[a+3];if(r[a]>l){if(s[a]>=-nM)return!1;const c=(l-r[a])/s[a];n=Math.max(n,c)}else if(s[a]>=nM){const c=(l-r[a])/s[a];o=Math.min(o,c)}if(n>o)return!1}}return!0}class dce{constructor(t,i,r,s,n){this.aabb=t,this.axis=i,this.d=r,this.midStartIndex=s,this.rightStartIndex=n}}class PC{constructor(t,i,r,s){this.globalTriangleVertexIndices=t,this.firstTriangleIndex=i,this.positionAttribute=s,this.rayDirection=F(),this.bspNodeTree=new Array,this.vertexPositionBuffer=s.data,this.vertexPositionStride=s.stride;const n=r-i,o=n<=b2e?new Uint16Array(n):new Uint32Array(n);this.indices=o;for(let a=0;a<n;++a)o[a]=a;{const a=rpt(t,i,r,s.data,s.stride),l=Xe(Math.log2(n/C9),2,Qdt),c=(h,p,m)=>{const g=tpt(o,a,h,p),v=p-h;if(v<=C9){const M=new dce(g,void 0,0,h,p);return this.bspNodeTree.push(M),M}const{axis:b,midValue:S}=ipt(g),T=ept(o,a,h,p,b,S),O=(M,I)=>{if(m>l)return;const $=I-M;return $<C9||$>=Ydt*v?void 0:c(M,I,m+1)},C=new dce(g,b,S,T.next,T.mid);return this.bspNodeTree.push(C),C.leftNode=O(h,T.next),C.rightNode=O(T.mid,p),C};c(0,n,0),this.triangleVertexIndices=spt(o,t,i,r)}}intersectRayTriangleRange(t,i){{if(t>=i)return;const r=this.triangleVertexIndices,s=this.positionAttribute.data,n=this.positionAttribute.stride,o=this.rayOrigin,a=o[0],l=o[1],c=o[2],h=this.rayDirection,p=h[0],m=h[1],g=h[2];for(let v=t,b=3*t;v<i;++v){const S=r[b]*n,T=s[S],O=s[S+1],C=s[S+2],M=r[b+1]*n,I=s[M],$=s[M+1],U=s[M+2],q=r[b+2]*n,G=s[q],Y=s[q+1],J=s[q+2];b+=3;const X=I-T,ne=$-O,re=U-C,ye=G-T,pe=Y-O,z=J-C,j=m*z-pe*g,Q=g*ye-z*p,Z=p*pe-ye*m,ie=X*j+ne*Q+re*Z;if(Math.abs(ie)<=Number.EPSILON)continue;const le=a-T,K=l-O,ae=c-C,we=le*j+K*Q+ae*Z;if(ie>0){if(we<0||we>ie)continue}else if(we>0||we<ie)continue;const Re=K*re-ne*ae,Ge=ae*X-re*le,Pe=le*ne-X*K,Se=p*Re+m*Ge+g*Pe;if(ie>0){if(Se<0||we+Se>ie)continue}else if(Se>0||we+Se<ie)continue;const $e=(ye*Re+pe*Ge+z*Pe)/ie;if($e>=0){const qe=this.indices[v]+this.firstTriangleIndex,jt=aJ(X,ne,re,ye,pe,z,Kdt);this.callback($e,jt,qe,!1)}}}PC.numFacesTested+=i-t}intersectRay(t,i){PC.numFacesTested=0;const r=Ke(t.r0[0],t.r0[1],t.r0[2]),s=Ke(t.r1[0],t.r1[1],t.r1[2]),n=s[0]-r[0],o=s[1]-r[1],a=s[2]-r[2];if(n*n+o*o+a*a<nM)return;this.rayOrigin=r;const l=this.rayDirection;l[0]=n,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this.callback=i;const h=this.bspNodeTree[0];this.intersectRayBSP(h,0,c)}intersectRayBSP(t,i,r){const s=this.rayOrigin,n=this.rayDirection;if(!Jdt(t.aabb,s,n))return;const o=t.axis,a=t.d;if(s[o]<a||n[o]<0){const l=i,c=t.midStartIndex;if(l<c){const h=t.leftNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(t.midStartIndex,t.rightStartIndex),s[o]>a||n[o]>0){const l=t.rightStartIndex,c=r;if(l<c){const h=t.rightNode;h!==void 0?this.intersectRayBSP(h,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}PC.numFacesTested=0;const Kdt=F(),CS=[1/0,1/0,1/0],AS=[-1/0,-1/0,-1/0];function ept(e,t,i,r,s,n){let o=i,a=r;for(;o<a;){const c=e[o];t[6*c+s+3]<=n?++o:(--a,e[o]=e[a],e[a]=c)}let l=o;for(a=r;l<a;){const c=e[a-1];t[6*c+s]>=n?--a:(e[a-1]=e[l],e[l]=c,++l)}return{next:o,mid:l}}function tpt(e,t,i,r){if(r<=i)return Rx(NaN,NaN,NaN,NaN,NaN,NaN);{const s=6*e[i];for(let n=0;n<3;++n)CS[n]=t[s+0+n],AS[n]=t[s+3+n]}for(let s=i+1;s<r;++s){const n=6*e[s];for(let o=0;o<3;++o)CS[o]=Math.min(CS[o],t[n+0+o]),AS[o]=Math.max(AS[o],t[n+3+o])}return Rx(CS[0],CS[1],CS[2],AS[0],AS[1],AS[2])}function ipt(e){const t=e[3]-e[0],i=e[4]-e[1],r=e[5]-e[2],s=t>i?t>r?0:i>r?1:2:i>r?1:r>t?2:0;return{axis:s,midValue:(e[s]+e[s+3])/2}}function rpt(e,t,i,r,s){const n=i-t,o=new Float32Array(6*n);for(let a=0;a<n;++a){const l=3*(a+t),c=e[l+0]*s,h=e[l+1]*s,p=e[l+2]*s;for(let m=0;m<3;++m){const g=r[c+m],v=r[h+m],b=r[p+m];o[6*a+m]=Math.min(g,v,b),o[6*a+3+m]=Math.max(g,v,b)}}return o}function spt(e,t,i,r){const s=r-i;let n=0;for(let a=i;a<r;++a)for(let l=0;l<3;++l)n=Math.max(t[3*a+l],n);const o=n<=b2e?new Uint16Array(3*s):new Uint32Array(3*s);for(let a=0;a<s;++a){const l=3*(e[a]+i);for(let c=0;c<3;++c){const h=t[l+c];o[3*a+c]=h}}return o}const b2e=65535;class dK extends aTe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=F(),this.origin=this.slicePlaneLocalOrigin}}var Uu,Ro;(function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"})(Uu||(Uu={})),function(e){e[e.Color=0]="Color",e[e.Alpha=1]="Alpha",e[e.Depth=2]="Depth",e[e.Normal=3]="Normal"}(Ro||(Ro={}));class npt extends dK{constructor(){super(...arguments),this.identifier=Uu.Material,this.transparent=!1,this.integratedMesh=!1}}class opt extends dK{constructor(){super(...arguments),this.identifier=Uu.ShadowMap}}class apt extends dK{constructor(){super(...arguments),this.identifier=Uu.Highlight}}class mk extends vs{constructor(t,i){super(t,"vec4",nr.Draw,(r,s,n)=>r.setUniform4fv(t,i(s,n)))}}var Uy;(function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"})(Uy||(Uy={}));class lpt extends mn{constructor(){super(...arguments),this.overlayOpacity=1}}function pce(e,t){e.vertex.uniforms.add([new nl("overlayTexOffset"),new nl("overlayTexScale")]),e.fragment.uniforms.add([new lt("overlayOpacity",i=>i.overlayOpacity),new ai("ovColorTex",(i,r)=>r.overlays.length===0?null:r.overlays[ns.INNER].getColorTexture(i.overlaySource))]),w2e(e,t)}function cpt(e,t){const{vertex:i,fragment:r}=e;i.uniforms.add([new mk("overlayTexOffset",(s,n)=>upt(s,n)),new mk("overlayTexScale",(s,n)=>hpt(s,n))]),r.constants.add("overlayOpacity","float",1),r.uniforms.add(new ai("ovColorTex",(s,n)=>PW(s,n))),w2e(e,t)}function w2e(e,t){e.extensions.add("GL_OES_standard_derivatives"),t.pbrMode!==Wt.Water&&t.pbrMode!==Wt.WaterOnIntegratedMesh||e.include(dTe,t);const{vertex:i,fragment:r}=e;e.varyings.add("vtcOverlay","vec4"),i.code.add(E`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),r.code.add(E`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),r.code.add(E`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),t.pbrMode!==Wt.Water&&t.pbrMode!==Wt.WaterOnIntegratedMesh||(r.uniforms.add([new Ut("lightingMainDirection",(s,n)=>n.lighting.lightingMainDirection),new Ut("lightingMainIntensity",(s,n)=>n.lighting.mainLight.intensity)]),r.code.add(E`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function PW(e,t){return t.overlays.length===0?null:e.identifier===Uu.Material&&e.subPass===Ro.Color?t.overlays[ns.INNER].getColorTextureNoRasterImage():e.identifier===Uu.Highlight?t.overlays[ns.INNER].getValidTexture(Gs.Highlight):null}function upt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Bpe(s)>0&&(bE[2*r]=e.toMapSpace[0]/Nu(s)-s[0]/Nu(s),bE[2*r+1]=e.toMapSpace[1]/Wp(s)-s[1]/Wp(s))}return bE}function hpt(e,t){for(const i of t.overlays){const{index:r,extent:s}=i;Bpe(s)>0&&(bE[2*r]=e.toMapSpace[2]/Nu(s),bE[2*r+1]=e.toMapSpace[3]/Wp(s))}return bE}const bE=di();function dpt(e,t){e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),t.spherical?e.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):e.vertex.code.add(E`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),e.fragment.code.add(E`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}function ppt(e,t){e.varyings.add("vtc","vec2"),e.vertex.uniforms.add(new nl("texOffsetAndScale")),e.fragment.uniforms.add(new as("tex")),e.fragment.uniforms.add(new Vl("textureOpacities"));const i=t.textureFadingEnabled&&!t.renderOccluded;i&&(e.vertex.uniforms.add(new nl("nextTexOffsetAndScale")),e.varyings.add("nvtc","vec2"),e.fragment.uniforms.add(new as("texNext")),e.fragment.uniforms.add(new Vl("nextTexOpacities")),e.fragment.uniforms.add(new rr("fadeFactor")));const r=t.tileBlendInput===ca.ColorComposite,s=t.tileBlendInput===ca.GridComposite;s&&e.fragment.include(rK),r&&e.fragment.uniforms.add(new Vl("backgroundColor")),e.vertex.code.add(E`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${i?E`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:E``}
  }`),e.fragment.code.add(E`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${s||r?E`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${r?E`vec4(backgroundColor, 1.0)`:E`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:E`return color;`}
    }`),i?e.fragment.code.add(E`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):e.fragment.code.add(E`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}class x2e extends lpt{}function fpt(e){const t=new dr;t.include(DTe,{name:"Terrain Shader",output:e.output}),t.attributes.add(D.POSITION,"vec3"),t.attributes.add(D.UV0,"vec2"),t.attributes.add(D.NORMAL,"vec3");const{vertex:i,fragment:r}=t;if(i.uniforms.add([new Hr("proj",(s,n)=>n.camera.projectionMatrix),new nW("view",(s,n)=>hl(fce,n.camera.viewMatrix,s.origin)),new al("origin",s=>s.origin)]),r.uniforms.add(new al("origin",s=>s.origin)),e.output===ue.Color){t.include(oa),t.include($v,e),t.include(ppt,e),t.include(tT,e);const s=e.overlayMode!==Uy.Disabled,n=e.overlayMode===Uy.EnabledWithWater;s&&t.include(pce,{...e,pbrMode:Wt.Water}),n&&t.include(dpt,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),(e.atmosphere||e.screenSizePerspective)&&i.uniforms.add(new Hr("viewNormal",(a,l)=>l.camera.viewInverseTransposeMatrix));const o=e.receiveShadows&&!e.renderOccluded;o&&t.varyings.add("linearDepth","float"),e.tileBorders&&t.varyings.add("vuv","vec2"),e.atmosphere&&(i.uniforms.add(new Ut("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection)),t.varyings.add("wnormal","vec3"),t.varyings.add("wlight","vec3")),e.screenSizePerspective&&(t.varyings.add("screenSizeDistanceToCamera","float"),t.varyings.add("screenSizeCosAngle","float")),i.code.add(E`
      void main(void) {
        vpos = position;
        vnormal = ${e.shading?E`normal`:E`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${e.atmosphere?E`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${e.tileBorders?E`vuv = uv;`:""}
        ${e.screenSizePerspective?E`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${o?E`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${s?E`setOverlayVTC(uv);`:""}
        ${n?E`forwardVertexTangent(vnormal);`:E``}
      }
    `),t.extensions.add("GL_OES_standard_derivatives"),t.extensions.add("GL_EXT_shader_texture_lod"),t.include(Ns,e),t.include(tT,e),t.include(CI,e),t.include(eT,e),r.uniforms.add([new al("cameraPosition",(a,l)=>Me(A9,l.camera.eye,a.origin)),new Ut("viewDirection",(a,l)=>De(A9,fe(A9,l.camera.viewMatrix[12],l.camera.viewMatrix[13],l.camera.viewMatrix[14]))),new lt("lightingGlobalFactor",(a,l)=>l.lighting.globalFactor),new Ut("lightingMainDirection",(a,l)=>l.lighting.lightingMainDirection),new Ut("lightingMainIntensity",(a,l)=>l.lighting.mainLight.intensity)]),r.constants.add("ambientBoostFactor","float",sA),n&&r.uniforms.add([new ai("ovWaterTex",(a,l)=>l.overlays.length===0?null:l.overlays[ns.INNER].getNormalTexture(a.overlaySource)),new nW("view",(a,l)=>hl(fce,l.camera.viewMatrix,a.origin))]),r.code.add(E`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),r.code.add(E`
      void main() {
        ${o?E`float shadow = readShadowMap(vpos, linearDepth);`:E`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${s?E`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${e.atmosphere?E`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${e.atmosphere?E`atm + tileColor.rgb;`:E`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${e.shading?"":E`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${e.shading?"":E`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${n?E`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${e.screenSizePerspective?E`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${e.tileBorders?E`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return e.output!==ue.Depth&&e.output!==ue.Shadow||(t.include(oa,{hasModelTransformation:!1,linearDepth:!0}),t.include(A1,{output:e.output}),t.include($v,e),t.varyings.add("linearDepth","float"),i.uniforms.add(new Ni("nearFar",(s,n)=>n.camera.nearFar)),i.code.add(E`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),r.code.add(E`void main() {
outputDepth(linearDepth);
}`)),e.output===ue.Normal&&(t.include(oa),t.include($v,e),t.varyings.add("vnormal","vec3"),t.varyings.add("vpos","vec3"),i.uniforms.add(new Hr("viewNormal",(s,n)=>n.camera.viewInverseTransposeMatrix)),i.code.add(E`
        void main(void) {
          vec3 normal = ${e.shading?E`normal`:E`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),r.code.add(E`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),e.output===ue.Highlight&&(t.include(oa),t.include($v,e),t.include(pce,e),i.code.add(E`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),t.include(d0),r.code.add(E`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),t}const fce=Be(),A9=F(),mpt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:x2e,build:fpt},Symbol.toStringTag,{value:"Module"}));class nB extends $r{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(t,i){i.spherical=t.viewingMode===st.Global}initializeProgram(t){const i=nB.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(t){const i=this.configuration,r=i.backfaceCullingEnabled&&!i.renderOccluded;return ni({blending:i.renderOccluded?qm(je.ONE,je.ONE_MINUS_SRC_ALPHA):null,culling:r&&cQ,depthTest:!i.renderOccluded&&{func:kr.LESS},depthWrite:!i.renderOccluded&&ec,colorWrite:wi,stencilTest:t?Gtt(Wl.IntegratedMeshMaskExcluded):null})}getPipelineState(t,i){return this.useStencil?this._stencilPipelineState:super.getPipelineState(t,i)}}nB.shader=new Tr(mpt,()=>_e(()=>import("./Terrain.glsl.a7136f48.js"),[],import.meta.url));class en extends Oa{constructor(){super(...arguments),this.output=ue.Color,this.overlayMode=Uy.Disabled,this.tileBlendInput=ca.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=Ce("enable-feature:terrain-shading")}}u([ee({count:ue.COUNT})],en.prototype,"output",void 0),u([ee({count:Uy.COUNT})],en.prototype,"overlayMode",void 0),u([ee({count:ca.COUNT})],en.prototype,"tileBlendInput",void 0),u([ee()],en.prototype,"spherical",void 0),u([ee()],en.prototype,"atmosphere",void 0),u([ee()],en.prototype,"receiveShadows",void 0),u([ee()],en.prototype,"hasSlicePlane",void 0),u([ee()],en.prototype,"backfaceCullingEnabled",void 0),u([ee()],en.prototype,"stencilEnabled",void 0),u([ee()],en.prototype,"textureFadingEnabled",void 0),u([ee()],en.prototype,"renderOccluded",void 0),u([ee()],en.prototype,"hasScreenSpaceReflections",void 0),u([ee()],en.prototype,"hasCloudsReflections",void 0),u([ee()],en.prototype,"tileBorders",void 0),u([ee()],en.prototype,"screenSizePerspective",void 0),u([ee()],en.prototype,"receiveAmbientOcclusion",void 0),u([ee()],en.prototype,"shading",void 0),u([ee({constValue:!0})],en.prototype,"isGround",void 0),u([ee({constValue:Wt.Disabled})],en.prototype,"pbrMode",void 0),u([ee({constValue:!1})],en.prototype,"highStepCount",void 0),u([ee({constValue:!1})],en.prototype,"useCustomDTRExponentForWater",void 0),u([ee({constValue:!1})],en.prototype,"useFillLights",void 0);const O9=7,gpt=10,R9=dn(),$D=di();let _u=class extends ze{constructor(e){super(e),this.type=ls.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new en,this._passParameters=new x2e,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new Edt,this.renderDataPool=new qs(Sy),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new YSe,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=ts.Occlude}get isGlobal(){return this.stage.viewingMode===st.Global}get shadingEnabled(){var e;return(e=this._techniqueConfiguration)==null?void 0:e.shading}initialize(){const e=[Ue.OPAQUE_TERRAIN,Ue.TRANSPARENT_TERRAIN,Ue.OCCLUDED_TERRAIN];this.stage.addRenderPlugin(e,this)}destroy(){this.stage.removeRenderPlugin(this),dht()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setNeedsRender()}set opaque(e){this._opaque!==e&&(this._opaque=e,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(e){this._isTransparent!==e&&(this._isTransparent=e,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this.setNeedsRender()}set velvetOverground(e){this._velvetOverground!==e&&(this._velvetOverground=e,this.setNeedsRender())}get layerUid(){return Sp}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(e){this._rootTiles=e,this.setNeedsRender()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?K5:ts.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this.stencilEnabledLayerExtents=e,this.setNeedsRender()}setTileSize(e){this.tileSize=e,w(this.tileRenderer)&&(this.tileRenderer.tileSize=e),this.setNeedsRender()}_prepareTileForLoading(e){e.renderData||(e.renderData=this.renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometry(e),this.updateTileTexture(e,Nt.TEXTURE_FADING)}queryVisibleLevelRange(e,t,i,r){this._scaleRangeQueries.queryVisibleLevelRange(e,t,i,r),this.setNeedsRender()}updateTileTexture(e,t){w(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(e,t===Nt.TEXTURE_FADING?uo.FADING:uo.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(t))}updateTileGeometryState(e){this._prepareTileForLoading(e),e.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(e){for(const t of e.layerInfo[mi.ELEVATION])t.pendingUpdates&=~Nt.GEOMETRY;e.resetPendingUpdate(Nt.GEOMETRY),e.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(e){const t=e.renderData;t&&(t.releaseGeometry(),this.renderDataPool.release(t),t.clear(),e.renderData=null,e.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(e){const t=gpt-O9,i=Math.max(0,Math.floor((e.level-t)/O9)*O9);if(this.isGlobal&&i===0)return ol;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this.visible=e,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.allTiles.forAll(t=>{t.isLoaded&&(this.updateTileGeometry(t),t.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(e=on.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this.rctx=e.renderContext.rctx,this._techniqueRepository=e.shaderTechniqueRepository,this.tileRenderer=new Zdt(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=I1e(this.rctx)}uninitializeRenderContext(){this.emptyTex=ht(this.emptyTex),this.tileRenderer=ht(this.tileRenderer)}intersect(e,t,i,r){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&!this._opaque)return;const s=_pt,n=vpt;Me(s,r,i),fe(n,1/s[0],1/s[1],1/s[2]);const o=e.results.min,a=e.results.max,l=e.results.ground,c=e.options.store===Uo.MIN,h=!!e.results.ground.target,p=XZe(e.verticalOffset),m=e.tolerance;let g,v=c&&w(o.dist)?o.dist:1/0;const b=T=>{const O=T.renderData;if(!(O!=null&&O.vao))return;const C=O.geometryInfo;Hk(R9,C.boundingBox);const M=O.localOrigin;w(p)&&(p.localOrigin=M,p.applyToAabb(R9));const I=R9;if(OS[0]=i[0]-M[0],OS[1]=i[1]-M[1],OS[2]=i[2]-M[2],!cJ(I,OS,n,m,v))return;const $=(ne,re,ye)=>{ne.set(this.type,T,re,ye,Dn),v=c&&w(o.dist)?o.dist:1/0},U=(ne,re)=>{if(w(re)&&ne>=0&&(e.options.backfacesTerrain||ke(re,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||t==null||t(i,r,ne))){if((l.dist==null||ne<l.dist)&&$(l,ne,re),e.options.isFiltered)return;e.options.store===Uo.ALL&&(N(g)?(g=UQ(e.ray),$(g,ne,re),e.results.all.push(g)):ne<g.dist&&$(g,ne,re)),(o.dist==null||ne<o.dist)&&$(o,ne,re),e.options.store!==Uo.MIN&&(a.dist==null||ne>a.dist)&&$(a,ne,re)}},q=bpt;Me(q,r,M);const G=C.indices,Y=C.vertexAttributes,J={data:Y.getField(D.POSITION,hr).typedBuffer,size:3,stride:Y.stride/4},X=C.indexCount/3;if(N(p)&&X>v2e){const ne=T.renderData;N(ne.intersectionData)&&(ne.intersectionData=new PC(G,0,X,J)),ne.intersectionData.intersectRay({r0:OS,r1:q},U)}else fI(OS,q,0,X,G,J,null,p,U)},S=this._rootTiles;w(S)&&(()=>{const T=this.tileIterator;T.reset(S);const O=e.options.invisibleTerrain;for(;!T.done;){const C=T.next();!(C.visible||O&&C.intersectsClippingArea)||!w(p)&&!C.intersectsRay(i,s,m,v)||h&&this._useStencilForTile(C)?T.skipSubtree():b(C)}})()}prepareTechnique(e){if(e.bindParameters.slot===Ue.OCCLUDED_TERRAIN){if((e.renderOccludedMask&K5)==0)return null}else{const t=this.opaque?Ue.OPAQUE_TERRAIN:Ue.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==t)return null}switch(e.pass){case nt.MATERIAL:{this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=w(e.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?Uy.Disabled:this.overlayRenderer.hasWater?Uy.EnabledWithWater:Uy.Enabled;const t=e.bindParameters.slot===Ue.OCCLUDED_TERRAIN?Ja.Occluded:Ja.ColorAndWater;return this._updateTechnique(ue.Color,t===Ja.Occluded)}case nt.MATERIAL_DEPTH_SHADOWMAP_ALL:case nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ue.Shadow,!1)):null;case nt.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ue.Depth,!1));case nt.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ue.Normal,!1);case nt.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(ue.Highlight,!1)):null}return null}render(e,t){const i=e.pass,r=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),t.useStencil=!1,i){case nt.MATERIAL:{const s=e.bindParameters.slot===Ue.OCCLUDED_TERRAIN?Ja.Occluded:Ja.ColorAndWater;this._renderMaterialPass(e,t,s);break}case nt.MATERIAL_DEPTH_SHADOWMAP_ALL:case nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&r&&this._renderAuxiliaryPass(e,t,Ja.None);break;case nt.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(e,t,Ja.None);break;case nt.MATERIAL_NORMAL:this._renderAuxiliaryPass(e,t,Ja.None);break;case nt.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(e,t,Ja.Highlight),e.rctx.clearSafe(br.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(e,t,i){const{rctx:r}=e;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(e,t,i):e.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(e,t,i),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(e,t,i){const r=e.rctx;this._passParameters.overlaySource=i,r.bindTechnique(t,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,t,i)}updateTileBackground(e=null){if(N(this.tileRenderer))return;const t=this.tileRenderer;let i=null;if(w(e)){const r=at.toUnitRGBA(e);i=Ke(r[0]||0,r[1]||0,r[2]||0)}t.setBackground(i),this.allTiles.forAll(r=>t.updateTileTexture(r,uo.FADING)),this._techniqueConfiguration.tileBlendInput=t.backgroundIsGrid?ca.GridComposite:w(t.backgroundColor)?ca.ColorComposite:ca.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==C3.NONE){const e=Array.from(this._patchGroups.values());e.forEach(t=>JSe(this.renderOrder,t)),e.sort((t,i)=>KSe(t[0],i[0],this.renderOrder)),this._patchGroups=new Map(e.map(t=>[t[0].renderData.localOrigin,t]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var t;const e=this._rootTiles;if(!N(e)){(t=e[0])==null||t.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const t=this.tileIterator;for(t.resetOne(e);!t.done;){const i=t.next(),r=i.renderData;if(!r||i.visible)if(i.rendered){if(r){const s=this._patchGroups.get(r.localOrigin)||new Array;this._patchGroups.set(r.localOrigin,s),s.push(i),(!this.highestVisibleLODTile||i.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=i),t.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,t.skipSubtree()}}_useStencilForTile(e){for(const t of this.stencilEnabledLayerExtents)if(e.intersectsExtent(t))return!0;return!1}_renderPatchGroupsAuxiliary(e,t,i){const r=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const n=s[0].renderData.localOrigin;t.program.bindDraw(new hW(n),e.bindParameters);for(let o=0;o<s.length;o++)this._renderPatch(e,t,s[o],Yt.TRIANGLES,r,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,t,i){const r=e.rctx,s=e.bindParameters.camera,n=t.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=Awe(this.stage.viewingMode,this.ellipsoidRadius),p=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:p,fovY:s.fovY})}const o=this.stencilEnabledLayerExtents.length>0,a=i===Ja.Occluded;a&&(n.bindTexture("tex",this.emptyTex),n.setUniform1f("blend",1),n.setUniform4fv("texOffsetAndScale",vm));const l=w(this.tileRenderer)&&w(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:ol;this._techniqueConfiguration.tileBlendInput===ca.ColorComposite&&n.setUniform3fv("backgroundColor",l);const c=this.wireframe?Yt.LINES:Yt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&n.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(h=>{const p=h[0].renderData.localOrigin;t.program.bindDraw(new hW(p),e.bindParameters),this.numOriginsRendered++;for(let m=0;m<h.length;m++){const g=h[m],v=g.renderData.textureReference;if(!N(v)){if(!a){this._scaleRangeQueries.scaleQueriesForTile(g),mce(g.renderData.geometryInfo.uvOffsetAndScale,v.offsetAndScale,$D),n.setUniform4fv("texOffsetAndScale",$D),n.bindTexture("tex",v.texture.texture);const b=g.renderData.textureFadeFactor,S=b<1?g.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&w(S)&&b<1?(mce(g.renderData.geometryInfo.uvOffsetAndScale,S.offsetAndScale,$D),n.setUniform1f("fadeFactor",b),n.setUniform4fv("nextTexOffsetAndScale",$D),n.setUniform3fv("nextTexOpacities",S.opacities),n.bindTexture("texNext",S.texture.texture)):n.setUniform1f("fadeFactor",1),g.renderData.textureIsFading&&this.setNeedsRender(),n.setUniform3fv("textureOpacities",v.opacities)}this._renderPatch(e,t,g,c,o,i),g.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),r.bindVAO(null)}_renderPatch(e,t,i,r,s,n){const o=i.renderData,a=o.vao,l=a.indexBuffer;if(N(l))return;const c=t.program;n!==Ja.None&&this._bindOverlayPatchData(c,o.overlay),s&&(t.useStencil=this._useStencilForTile(i),t.bindPipelineState(e.rctx,e.bindParameters.slot));const h=o.geometryInfo.indexCount;e.rctx.bindVAO(a),c.assertCompatibleVertexAttributeLocations(a),e.rctx.drawElements(r,h,l.indexType,0)}_bindOverlayPatchData(e,t){e.setUniform4fv("overlayTexOffset",t.offsets),e.setUniform4fv("overlayTexScale",t.scales)}_updateTechnique(e,t){return this._techniqueConfiguration.output=e,e===ue.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=t,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(nB,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};u([f({constructOnly:!0})],_u.prototype,"overlayRenderer",void 0),u([f({constructOnly:!0})],_u.prototype,"stage",void 0),u([f({readOnly:!0})],_u.prototype,"isGlobal",null),u([f({constructOnly:!0})],_u.prototype,"allTiles",void 0),u([f({constructOnly:!0})],_u.prototype,"ellipsoidRadius",void 0),u([f({value:!1})],_u.prototype,"renderingDisabled",null),u([f()],_u.prototype,"renderPatchBorders",null),u([f()],_u.prototype,"cullBackFaces",null),u([f({value:C3.FRONT_TO_BACK})],_u.prototype,"renderOrder",null),u([f()],_u.prototype,"wireframe",null),_u=u([B("esri.views.3d.terrain.TerrainRenderer")],_u);const ypt=_u;function mce(e,t,i){i[0]=e[0]*t[2]+t[0],i[1]=e[1]*t[3]+t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3]}const _pt=F(),vpt=F(),OS=F(),bpt=F();class wpt{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}let Zf=class extends ze{constructor(e){super(e),this._handles=new xi}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(xe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=Tt(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(t=>!(!EM(t)||t.isRejected())&&!(t.isFulfilled()&&!xpt(t,this.viewSpatialReference,this.viewingMode))&&(e=t,!((t==null?void 0:t.type)==="vector-tile"||uk(t)))),e)if(e.isResolved()){const t=Kz(e,this.viewSpatialReference,this.viewingMode);if(w(t)){const i=new es(t.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const t=e.when().catch(()=>{}).then(()=>{t!==this._waitTask||this.destroyed||this._update()});this._waitTask=t}_lockTilingScheme(e){if(this.viewingMode===st.Global){const t=e.levels.length-1;e.spatialReference.isWebMercator?e=es.makeWebMercatorAuxiliarySphere(t):$x(e.spatialReference)&&(e=es.makeGCSWithTileSize(e.spatialReference,e.pixelSize,t))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(xe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===st.Global){const e=this.extentHelper.viewSpatialReference,t=$x(e)||km(e)||Um(e);e.isWebMercator?this.tilingScheme=es.WebMercatorAuxiliarySphere:t&&(this.tilingScheme=es.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;w(e)&&!ox(e,this.extent)&&(this.tilingScheme=es.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function xpt(e,t,i){return w(Kz(e,t,i))}u([f()],Zf.prototype,"tilingScheme",void 0),u([f({readOnly:!0})],Zf.prototype,"extent",void 0),u([f({value:!1})],Zf.prototype,"tilingSchemeLocked",void 0),u([f({constructOnly:!0})],Zf.prototype,"viewSpatialReference",void 0),u([f({constructOnly:!0})],Zf.prototype,"layers",void 0),u([f({constructOnly:!0})],Zf.prototype,"extentHelper",void 0),u([f({constructOnly:!0})],Zf.prototype,"viewingMode",void 0),Zf=u([B("esri.views.3d.terrain.TilingSchemeLogic")],Zf);class Tpt{constructor(){this.offset=yt(),this.scale=0,this.tile=null}init(t,i,r,s){this.tile=t,this.offset[0]=i,this.offset[1]=r,this.scale=s}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const Gd=Ie.getLogger("esri.views.3d.terrain.TerrainSurface"),Spt=.25;let Ei=class extends ks.EventedMixin(ze){constructor(e){var t,i;super(e),this._elevationBounds=new eK,this._iteratorPool=new qs(YSe,r=>r.remove=()=>this._iteratorPool.release(r)),this._postorderIterator=new yht,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new wpt,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=F(),this._eyePosSurfaceSR=F(),this._splitLimits=new Hht,this._snapLevel=1/0,this._frustum=o3(),this._viewProjectionMatrix=Be(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new xi,this._watchUpdatingTracking=new _m,this._frameTask=rC,this._allTiles=new hi,this._upsampleInfoPool=new qs(Tpt),this._rootTilesExtent=ei(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!((i=(t=e.view)==null?void 0:t.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=Gut(this.view.resourceController),this._tilePool=this.view.state.isLocal?new qs(xdt):new qs(Tdt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("esri.views.3d.terrain.upsample",s=>s.unloadMapData()),this._elevationQueryCache=new But(e.newCache("elevation-query")),this._set("overlayManager",new Rl({surface:this})),this._handles.add([xe(()=>this.overlayManager.hasHighlights,s=>this._renderer.setNeedsHighlight(s)),xe(()=>this.overlayManager.rendersOccluded,s=>this._renderer.setRenderOccludedOverlay(s))],"overlayManager"),this._renderer=new ypt({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:ji(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([xe(()=>this.baseOpacity,s=>{this._handleLayerViewChanges(),this._updateBaseOpacity(s)},an),xe(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},an),xe(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),Rr),xe(()=>this.backgroundColor,s=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(s)},an),xe(()=>this.view.pointsOfInterest,s=>{this._renderer.pointsOfInterest=s,this._watchUpdatingTracking.removeAll(),s&&this._watchUpdatingTracking.add(()=>s.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),xe(()=>ur.TERRAIN_TILE_TREE_SHOW_TILES,s=>{s&&!this._treeDebugger?_e(()=>import("./TerrainTileTree3DDebugger.b42cc725.js"),["TerrainTileTree3DDebugger.b42cc725.js","TileTreeDebugger.89d4994d.js"],import.meta.url).then(({TerrainTileTree3DDebugger:n})=>{!this._treeDebugger&&ur.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new n({view:this.view}))}):s||(this._treeDebugger=Tt(this._treeDebugger))},si)]),this._extentHelper=nht(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const t=this.view.defaultsFromMap?new iC({getCollections:()=>{var s,n,o;return(o=(n=(s=this.view)==null?void 0:s.defaultsFromMap)==null?void 0:n.mapCollections)==null?void 0:o.map(({layers:a})=>a)},getChildrenFunction:s=>s&&"layers"in s?s.layers:null}):this.view.map.allLayers,i=new Zf({layers:t,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",i),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(hm.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(hm.BASEMAP);const r=this.view.resourceController.scheduler;this._frameTask=r.registerTask(It.TERRAIN_SURFACE,this),this._handles.add([xe(()=>this._extentHelper.stencilEnabledExtents,s=>this._renderer.setStencilEnabledLayerExtents(s),si),xe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),Rr),xe(()=>this.extent,()=>this._updateRootTiles(),si),this.view.on("resize",()=>this._viewChangeUpdate()),xe(()=>{var o,a;const s=this.view,n=s.state;return[this.lodBias,this.lodSnapping,(a=(o=s.resourceController)==null?void 0:o.memoryController)==null?void 0:a.memoryFactor,n.camera,n.contentCamera,n.fixedContentCamera]},()=>this._viewChangeUpdate(),an),xe(()=>{var s,n;return(n=(s=this.view.qualitySettings)==null?void 0:s.tiledSurface)==null?void 0:n.textureFadeDuration},s=>this._renderer.textureFadingEnabled=s>0,si),xe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),Rr)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=vr(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=Tt(this._upsampleMapCache),this._elevationQueryCache=Tt(this._elevationQueryCache),this._set("tilingSchemeLogic",Tt(this.tilingSchemeLogic)),this._extentHelper=Tt(this._extentHelper),this._basemapLayerViewHandles.forEach((e,t)=>this._unregisterTiledLayerView(t)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",Tt(this.overlayManager)),this._tilePool=Tt(this._tilePool),sK.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=Tt(this._renderer),this._iteratorPool=Tt(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=Tt(this._upsampleInfoPool),iht(),Ght()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var t,i;const e=(i=(t=this.view.pointsOfInterest)==null?void 0:t.contentCameraOnSurface)==null?void 0:i.scale;if(e){const r=this.view.state.contentCamera;let s=oz(this.view,r.eye,r.viewForward,r.up).tilt;s>90&&(s=180-s);const n=2*(s/90)**2,o=fwe(this.view,e)-n;Math.abs(this._snapLevel-o)>Spt&&(Math.round(o)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=o)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?EC.ON:EC.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:t}=this.view;if(N(t)||N(e))return null;const i=ei(),r=ASe(t,i,e)?i:null,s=this._get("extent");return ox(r,s)?s:r}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=SN(this.groundExtent,this._userClippingExtent,ei()),t=this._get("extent");return ox(e,t)?t:e}get groundExtent(){return w(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return w(this.rootTiles)}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get spatialReference(){var e,t;return(t=(e=this.tilingScheme)==null?void 0:e.spatialReference)!=null?t:null}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._updateTransparentTerrain()}_updateTransparentTerrain(){var t,i;const e=!this.renderingDisabled&&!this.opaque;(i=(t=this.view)==null?void 0:t._stage)==null||i.renderView.setRenderParameters({transparentTerrain:e})}set velvetOverground(e){e!==this.velvetOverground&&(this._renderer.velvetOverground=e),this._set("velvetOverground",e)}set visible(e){e!==this._visible&&(this._visible=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}intersect(e,t,i,r){this._renderer.intersect(e,t,i,r)}getElevation(e,t,i,r){const s=this.getTileWithElevation(e,t,i,r,Zo);return N(s)?null:qSe(Zo[0],Zo[1],s.renderData.geometryState.samplerData)}getTileWithElevation(e,t,i,r,s=Zo){var o;const n=this.rootTiles;if(N(n)||!n.length||n[0].layerInfo[mi.ELEVATION].length===0)return null;if(s[0]=e,s[1]=t,s[2]=i,!$n(s,r,s,(o=this.tilingScheme)==null?void 0:o.spatialReference))return Gd.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let a of n){if(!a.containsPoint(s))continue;for(;a&&!a.rendered&&!a.isLeaf;){let c=0;s[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),s[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c]}const l=a.renderData;return l&&l.geometryState.samplerData?a:null}return null}get elevationBounds(){return this._elevationBounds}getScale(e){if(this.tilingScheme){if(!po(e,Zo,this.spatialReference))return Gd.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const t=this.rootTiles;if(w(t)){for(let i of t)if(i!=null&&i.containsPoint(Zo)){for(;!i.isLeaf&&!i.rendered;){let r=0;Zo[0]>i.children[0].extent[2]&&(r+=1),Zo[1]<i.children[0].extent[1]&&(r+=2),i=i.children[r]}return this._getLodBiasCorrectedScale(i.level)}}}return 1e100}getSphereElevationBounds(e,t,i,r,s){var c;if(Zo[0]=e,Zo[1]=t,Zo[2]=i,Zo[3]=r,!$n(Zo,s,Zo,(c=this.tilingScheme)==null?void 0:c.spatialReference))return Gd.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let n=1/0,o=-1/0;const a=h=>{if(h&&mee(h.extent,Zo))if(h.isLeaf||h.rendered)n=Math.min(n,h.elevationBounds[0]),o=Math.max(o,h.elevationBounds[1]);else for(const p of h.children)a(p)},l=this.rootTiles;if(w(l))for(const h of l)a(h);return{min:n,max:o}}getSphereScale(e,t){if(!this.tilingScheme)return null;if(!po(e,Zo,this.spatialReference))return Gd.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Zo[3]=t;let i=null;const r=n=>{if(n&&mee(n.extent,Zo))if(n.isLeaf||n.rendered){const o=this._getLodBiasCorrectedScale(n.level);i=i==null?o:Math.min(i,o)}else for(const o of n.children)r(o)},s=this.rootTiles;if(w(s))for(const n of s)r(n);return i}queryVisibleScaleRange(e,t,i,r){const s=t?this.tilingScheme.levelAtScale(t):0,n=i?this.tilingScheme.levelAtScale(i):1/0,o=this.lodBias;this._renderer.queryVisibleLevelRange(e,s+o,n+o,r)}_updateBaseOpacity(e){const t=this._renderer.opaque;this._renderer.opaque=e>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const i=t!==this._renderer.opaque;i&&this._updateTransparentTerrain(),this._updateTileTextures(i?uo.UNFADED:uo.IMMEDIATE)}_updateTilingScheme(){var t,i;const e=this.tilingSchemeLogic.tilingScheme;e!==this.tilingScheme&&(nm(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((i=(t=this.view)==null?void 0:t.state)!=null&&i.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles()))}_acquireTile(e,t,i,r){const s=this._tilePool.acquire();return DD[0]=e,DD[1]=t,DD[2]=i,s.init(DD,r,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:t}=this;if(!t)return;const i=Apt;let r=t.rootTilesInExtent(e,i,5*U2);if(w(this.rootTiles)){if(r.length>U2)return void Gd.warn(WGe);const s=this.rootTiles.map(o=>o.lij),n=rCe(s,r,gce);if(this._updatingRootTiles=!0,n.removed.length>0||n.added.length>0){const o=this.rootTiles.filter(a=>!(n.removed.findIndex(l=>gce(l,a.lij))>-1)||(this._purgeTile(a,!0),!1));n.added.forEach(a=>o.push(this._newRootTile(a))),this._setRootTiles(o)}}else this._updatingRootTiles=!0,r.length>U2&&(Gd.warn(ZGe),r=t.rootTilesInExtent(e,i,U2)),this._setRootTiles(r.map(s=>this._newRootTile(s)));ox(i,this._rootTilesExtent)||(this._rootTilesExtent=ei(i)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(s=>{s.isLoaded&&this._prepareToLoadTile(s)}),this._allTiles.forAll(s=>{s.isLoaded&&(this._updateTileGeometry(s),this._updateTileNeighborsAfterGeometryChange(s))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(e){const t=this._acquireTile(0,e[1],e[2],null);return t.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===Nt.SPLIT&&t.setPendingUpdate(Nt.SPLIT),this._loadTile(t),this.deferTileNeighborUpdate||t.checkGeometryWaterproofness(),t}_setRootTiles(e){if(this._set("rootTiles",e),this._allTiles.clear(),w(e)){const t=this._iteratorPool.acquire();for(t.reset(e);!t.done;)this._allTiles.push(t.next());t.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(Nt.GEOMETRY)&&this._updateTileGeometry(e)}_updateTilesVisibility(e){if(N(e))return;const t=bht(e);let i=t?this._elevationBounds.min:1/0,r=t?this._elevationBounds.max:-1/0;const s=this.view.state.fixedContentCamera,n=this.extent,o=this._viewProjectionMatrix;this.setTileTreeDirty();const a=this._iteratorPool.acquire();for(a.reset(e);!a.done;){const l=a.next();l.updateClippingStatus(n)&&l.resetPendingUpdate(Nt.GEOMETRY)&&this._updateTileGeometry(l),l.setPendingUpdate(Nt.RENDERDATA);const c=l.computeVisibility();s||c?(l.updateScreenDepth(o),l.renderData&&(i=Math.min(l.elevationBounds[0],i),r=Math.max(l.elevationBounds[1],r))):a.skipSubtree()}a.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(i)&&isFinite(r)&&(this._elevationBounds.min===i&&this._elevationBounds.max===r||(this._elevationBounds.min=i,this._elevationBounds.max=r,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const e=this.view.state.camera,t=this.view.state.contentCamera,i=Math.tan(.5*t.fovX),r=Math.tan(.5*t.fovY),s=this.tilingScheme.pixelSize,n=2**-this.lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=r,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*n,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*n,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(N(this._splitLimits.frustum)&&(this._splitLimits.frustum=o3()),R5(this._splitLimits.frustum,t.frustum)):this._splitLimits.frustum=null,R5(this._frustum,e.frustum),hs(this._viewProjectionMatrix,t.projectionMatrix,t.viewMatrix),ve(this._eyePosRenderSR,t.eye),$n(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(T2e(e)?(this._loadChildren(e),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(e),e.children.forEach(t=>t.checkGeometryWaterproofness()))):Cpt(e)&&this._loadParent(e))}_updateTileGeometry(e){e.updateVisibility(),this._renderer.updateTileGeometry(e),this._updateTileNeighborsAfterGeometryChange(e),this._elevationUpdate(e),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e)}_updateTileNeighborsAfterGeometryChange(e,t){if(this.deferTileNeighborUpdate){const i=this.neighborTilesToUpdate;e.forEachLoadedNeighbor(r=>{i.add(r)})}else e.updateNeighborsAfterGeometryChange(t)}_updateTileTexture(e,t){const i=e.resetPendingUpdate(Nt.TEXTURE_FADING)?Nt.TEXTURE_FADING:!!e.resetPendingUpdate(Nt.TEXTURE_NOFADING)&&Nt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,t.madeProgress())}_elevationUpdate(e){ND.spatialReference=this.spatialReference,ND.tile=e,ND.extent=e.extent,this.emit("elevation-change",ND)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(e),this._sortTiles(e);const t=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,t),e.run(()=>this._updateElevation(e)),e.run(()=>this._updateTextures(e)),t||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),e.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(e){if(!this._viewChanged||!this.rootTiles||e.done)return;this._viewChanged=!1;const t=this._iteratorPool.acquire();for(t.reset(this.rootTiles);!t.done;){const i=t.next();if(i.loadable){const r=i.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(r===Nt.SPLIT){i.resetPendingUpdate(Nt.MERGE),i.isLeaf&&(i.setPendingUpdate(Nt.SPLIT),t.skipSubtree());continue}i.resetPendingUpdate(Nt.SPLIT)&&i.updateAgentSuspension(),r===Nt.VSPLITMERGE&&i.updateAgents(mi.ELEVATION)}if(t.skipSubtree(),!i.isLeaf){i.setPendingUpdate(Nt.MERGE),i.resetPendingUpdate(Nt.SPLIT);const r=this._iteratorPool.acquire();r.resetOne(i);for(let s=r.next();!r.done;s=r.next())this._updateClippingStatus(s),s.updateVisibility(),s.loadable&&s.updateScreenDepth(this._viewProjectionMatrix);r.remove()}}t.remove(),this.requestUpdate(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(_ht(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_prepareBatchTileGeometryUpdate(){this.neighborTilesToUpdate.size,this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const e=this.neighborTilesToUpdate;(()=>{const t=()=>{for(const i of e)i.updateNeighborsWithChangedEdgeResolution()};(()=>{for(const i of e)i.updateNeighborDataAndGeometryIfNeeded()})(),t(),e.clear()})()}_mergeAndSplit(e,t){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let i=!1;for(;!e.done;){i=!0;let r=!1;const s=!this._allTiles.some(n=>{if(n.resetPendingUpdate(Nt.MERGE)){if(!t)return n.setPendingUpdate(Nt.MERGE),e.done;this._mergeTile(n),r=!0,e.madeProgress()}else n.resetPendingUpdate(Nt.SPLIT)&&(this._splitTile(n),r=!0,e.madeProgress());return!e.done&&n.resetPendingUpdate(Nt.RENDERDATA)&&(this._updateRenderData(n),e.madeProgress()),e.done});if(r&&(this._allTilesSorted=!1,this._allTilesDirty=!0),s){if(!r)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}i||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(e)}_updateElevation(e){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(t=>(t.resetPendingUpdate(Nt.GEOMETRY)&&(this._updateTileGeometry(t),this._updateTileTexture(t,e),e.madeProgress()),e.done)),this._batchUpdateUpdatedTileNeighbors(),e.hasProgressed}_updateTextures(e){return this._allTiles.some(t=>(this._updateTileTexture(t,e),e.done)),e.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(on.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*jGe}_getLodBiasCorrectedScale(e){const t=this.tilingScheme.levels,i=Xe(e-this.lodBias,0,t.length-1),r=i-Math.floor(i);return t[Math.floor(i)].scale*(1-r)+t[Math.ceil(i)].scale*r}_removeAllTiles(){w(this.rootTiles)&&(this.rootTiles.forEach(e=>this._purgeTile(e,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(e){if(e.isLeaf)return!1;let t=!1;for(let i=0;i<4;++i)t=this._purgeTile(e.children[i],!1)||t;return e.unsetChildren(),t}_purgeTile(e,t){const i=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),t&&this._updateTileNeighborsAfterGeometryChange(e),this._tilePool.release(e),i}_unloadTile(e){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(e),e.unload(this._renderer)}_splitTile(e){nm(e.isLeaf,"tile that is already split should not be split again!");const t=e.level+1,i=2*e.lij[1],r=2*e.lij[2];e.setChildren(this._createTile(t,i,r,e),this._createTile(t,i,r+1,e),this._createTile(t,i+1,r,e),this._createTile(t,i+1,r+1,e)),e.setPendingUpdate(Nt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,this._emitTileScaleChange(e,t),++this._performanceInfo.numSplit}_emitTileScaleChange(e,t=e.level){FD.spatialReference=this.spatialReference,FD.extent=e.extent,FD.scale=this._getLodBiasCorrectedScale(t),this.emit("scale-change",FD)}_createTile(e,t,i,r){nm(!!r,"_createTile sanity check");const s=this._acquireTile(e,t,i,r);return s.updateClippingStatus(this.extent),s.loadable&&(s.updateScreenDepth(this._viewProjectionMatrix),s.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===Nt.SPLIT&&s.setPendingUpdate(Nt.SPLIT)),s}_mergeTile(e){nm(!e.hasPendingUpdate(Nt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(nm(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._updateTileNeighborsAfterGeometryChange(e),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(e)}_checkTileAndNeighborsWaterproofness(e){e.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(e)}_checkTileNeighborsWaterproofness(e){}_loadChildren(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e),nm(e.rendered,"parent should be rendered"),this._unloadTile(e);const t=e.children;t.forEach(i=>this._prepareToLoadTile(i)),t.forEach(i=>this._loadTilePrepared(i)),this._updateTileNeighborsAfterGeometryChange(e,e.level+1),this.deferTileNeighborUpdate||(t.forEach(i=>i.updateNeighborsWithChangedEdgeResolution()),t.forEach(i=>i.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(e))}_loadParent(e){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(e);const t=e.parent;this._unloadChildren(t),this._loadTile(t),this._updateTileNeighborsAfterGeometryChange(t),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(t)}_unloadChildren(e){if(!e.isLeaf)for(let t=0;t<4;++t){const i=e.children[t];this._unloadChildren(i),this._unloadTile(i)}}_postLoadTile(e){e.setPendingUpdate(Nt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e),this._elevationUpdate(e)}_loadTile(e){e.load(this._renderer),this._postLoadTile(e)}_loadTilePrepared(e){e.loadPrepared(this._renderer),this._postLoadTile(e)}_prepareToLoadTile(e){e.prepareToLoad(this._renderer)}_elevationDataArrived(e,t,i){const r=new sht(e.lij,e.extent,i);e.dataArrived(t,mi.ELEVATION,r);const s=[e],n=e.level,o=this._iteratorPool.acquire();for(o.reset(s);!o.done;){const a=o.next();a.findElevationBoundsForLayer(t,n),a.computeElevationBounds()}o.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=iA){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let t=!1;const i=new Set;let r=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),S3(s))if(this._basemapLayerViewHandles.has(s.uid)){const n=this._layerClassFromLayerView(s),o=this._getLayerIdxByUID(n,s.uid);w(o)&&((o<r||N(r))&&(t=!0),r=o)}else this._registerTiledLayerView(s),s.layer.loaded&&(t=!0);this._basemapLayerViewHandles.forEach((s,n)=>{i.has(n)||(this._unregisterTiledLayerView(n),t=!0)}),t&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),e.madeProgress()}_allSurfaceLayersTransparent(){var t,i;let e=((i=(t=this.view.map)==null?void 0:t.ground)==null?void 0:i.opacity)===0;for(const r of this.view.allLayerViews.items)if(AW(r)&&!Mge(r.layer)&&r.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if(hk(e)){const t=VSe(e.layer.parent)?"normal":e.layer.blendMode;if(xht(GF[t]))return!0}return!1}_layerClassFromLayerView(e){return CW(e)?mi.ELEVATION:mi.MAP}_registerTiledLayerView(e){const t=[],i=this._layerClassFromLayerView(e);t.push(xe(()=>e.suspended,()=>this._updateTiledLayers())),t.push(xe(()=>e.fullOpacity,()=>this._updateTileTextures(uo.UNFADED))),t.push(xe(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),hk(e)&&t.push(xe(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(uo.UNFADED)})),e.on("data-changed",()=>{const r=this._getLayerIdxByUID(i,e.uid);w(r)&&this._invalidateLayerData(r,i)}),this._basemapLayerViewHandles.set(e.uid,t)}_unregisterTiledLayerView(e){const t=this._basemapLayerViewHandles.get(e);if(t){for(let i=0;i<t.length;i++)t[i].remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,t=[[],[]];let i=null;e.forEach(r=>{if(!r.layer||r.suspended||!S3(r)||!r.fullExtent)return;const s=this._layerClassFromLayerView(r);if(s===mi.MAP){const n=r.displayLevelRange.maxLevel;n!==1/0&&(i===null||n>i)&&(i=n)}t[s].push(r)});for(const r of hw){const s=this._layerViews[r],n=t[r];n.reverse();const o=n.length;let a=s.length!==o;const l=new Array(o),c=new Array(s.length);this._layerIndexByUid[r].clear();for(let h=0;h<o;h++){const p=n[h].uid;this._layerIndexByUid[r].set(p,h);const m=s.indexOf(n[h]);l[h]=m,h!==m&&(a=!0),m>-1&&(c[m]=h)}if(a){const h=this._postorderIterator;for(h.reset(this.rootTiles);!h.done;)h.next().modifyLayers(c,l,r);this._layerViews[r]=n,this._restartAllAgents(r),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const t=this._postorderIterator;for(t.reset(this.rootTiles);!t.done;){const i=t.next();i.restartAgents(e),e===mi.ELEVATION&&i.computeElevationBounds()}}layerViewByIndex(e,t){return this._layerViews[t][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(t=>{t.updateAgents(mi.MAP),e===uo.IMMEDIATE?this.renderer.updateTileTexture(t,Nt.TEXTURE_NOFADING):t.updateRenderData(mi.MAP,e)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(e,t){this._allTiles.forAll(i=>i.removeLayerAgent(e,t)),this._allTiles.forAll(i=>i.invalidateLayerData(e,t))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=on.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,t,i,r){const s=this.layerViewByIndex(t,i),n=s.layer;return!n.tilemapCache||T3(s)?this._requestTileData(e,i,s,r):(++this._asyncWorkItems,n.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...r,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(o=>{throw--this._asyncWorkItems,Cs(o)||this._dataMissing(e,i,s,{notInTilemap:!0}),o}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,r),r.signal)))}_requestTileData(e,t,i,r){return t===mi.ELEVATION?CW(i)?this._requestElevationTileData(e,i,r):Promise.reject():AW(i)?this._requestMapTileData(e,i,r):Promise.reject()}_requestElevationTileData(e,t,i){++this._asyncWorkItems;const r=o=>{if(An(i))return;const a=this._layerIndexByUid[mi.ELEVATION].get(t.uid);a!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,a,o)):Gd.warn("TerrainSurface: received data from unknown layer %d %s",mi.ELEVATION,e.lij.toString())},s=o=>{Cs(o)||(this._dataMissing(e,mi.ELEVATION,t,o),this.requestUpdate())};if(zle(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:NP,signal:i.signal}).then(o=>{if(!An(i))return this._frameTask.schedule(()=>r(o),i.signal,s);Gd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const n=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(n,"binary",i).then(o=>this._lercDecoder.decode(o,{noDataValue:NP},i.signal)).then(o=>{o?r({values:o.pixelData,width:o.width,height:o.height,noDataValue:o.noDataValue,minValue:o.minValue,maxValue:o.maxValue}):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,t,i){++this._asyncWorkItems;const r=(c,h)=>{--this._asyncWorkItems,yE(h),An(i)||(this._dataMissing(e,mi.MAP,t,c),this.requestUpdate())},s=c=>h=>r(h,c),n=c=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),An(i)?yE(c):this._mapTileDataArrived(e,t,c)},i.signal,s(c)).catch(s(c)),o=(c,h=null)=>this._frameTask.schedule(()=>r(c,h));if(T3(t)){const c=t.schemaHelper.getLevelRowColumn(e.lij);return t.fetchTile(c[0],c[1],c[2],i).then(n,o)}if(Jz(t))return t.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(n,o);if(JJ(t)&&zle(t.layer))return t.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(c=>{if(An(i))return Gd.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void o($i());n(c)},o);let a=t.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);E8e(t.layer)&&t.layer.refreshTimestamp&&(a+=`${a.includes("?")?"&":"?"}_ts=${t.layer.refreshTimestamp}`);const l=t.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(a,l,i).then(n,o)}_mapTileDataArrived(e,t,i){const r=this._getLayerIdxByUID(mi.MAP,t.uid);w(r)?e.dataArrived(r,mi.MAP,i):(yE(i),Gd.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,t){return this._layerIndexByUid[e].get(t)}_dataMissing(e,t,i,r){const s=this._getLayerIdxByUID(t,i.uid);w(s)?e.dataMissing(s,t,r):Gd.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(t=>{t.renderData&&this.overlayManager.setTileParameters(t)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(t=>{t.isLeaf&&e.numLeaves++;const i=t.level;t.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),t.visible&&(e.numVisible++,t.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}getUsedMemory(){return this.tilingScheme?(N(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),w(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,t)=>e+t.usedMemory,0):null}getUsedMemoryForLayerView(e){let t=0;const i=this._layerClassFromLayerView(e),r=this._getLayerIdxByUID(i,e.uid);return w(r)&&this._allTiles.forAll(s=>t+=s.getUsedMemoryForLayer(i,r)),t}getTile(e){if(N(e)||N(this.rootTiles))return null;const t=e.split("/").map(o=>+o);if(t[0]===0)return this.rootTiles.find(o=>o.lij[1]===t[1]&&o.lij[2]===t[2]);const i=2**t[0],r=Math.floor(t[1]/i),s=Math.floor(t[2]/i);let n;if(this.rootTiles.some(o=>o.lij[1]===r&&o.lij[2]===s&&(n=o,!0)),n){let o=1<<t[0]-1;for(;n.lij[0]<t[0];){let a=t[1]&o?2:0;if((t[2]&o)>0&&a++,!n.children[a])return null;n=n.children[a],o>>=1}return nm(n.lij[0]===t[0]&&n.lij[1]===t[1]&&n.lij[2]===t[2],"not the right tile?"),n}return null}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{w(e.rootTiles)&&(e._mergeTile(e.rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){M9.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&M9.push(i)});const t=M9.toArray();return JSe(e.renderOrder,t),t},lockTilingScheme(t,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(t)}}}checkAllTileWaterproofness(){}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var e;return!!((e=this.tilingScheme)!=null&&e.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var e;return this.isWebMercator&&dP((e=this.view)==null?void 0:e.renderSpatialReference)}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const t=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<t)return e;if(!this.isGlobal)return null;const r=(i+(i<0?t:0))%t;return[e[0],e[1],r]}};u([f()],Ei.prototype,"_renderer",void 0),u([f()],Ei.prototype,"_hasPendingUpdates",void 0),u([f()],Ei.prototype,"_asyncWorkItems",void 0),u([f()],Ei.prototype,"_allTilesDirty",void 0),u([f()],Ei.prototype,"_allTilesSorted",void 0),u([f()],Ei.prototype,"_viewChanged",void 0),u([f({readOnly:!0})],Ei.prototype,"_watchUpdatingTracking",void 0),u([f()],Ei.prototype,"_frameTask",void 0),u([f({readOnly:!0})],Ei.prototype,"snapLevel",null),u([f({readOnly:!0})],Ei.prototype,"lodSnapping",null),u([f({constructOnly:!0})],Ei.prototype,"view",void 0),u([f()],Ei.prototype,"_userClippingExtent",null),u([f()],Ei.prototype,"_rootTilesExtent",void 0),u([f({readOnly:!0})],Ei.prototype,"extent",null),u([f({readOnly:!0})],Ei.prototype,"groundExtent",null),u([f({readOnly:!0})],Ei.prototype,"_tilingSchemeExtent",null),u([f({readOnly:!0})],Ei.prototype,"updating",null),u([f(rht)],Ei.prototype,"updatingProgress",void 0),u([f({readOnly:!0})],Ei.prototype,"updatingProgressValue",null),u([f()],Ei.prototype,"_maxNumUpdating",void 0),u([f({aliasOf:"view.map.ground.opacity"})],Ei.prototype,"baseOpacity",void 0),u([f()],Ei.prototype,"hasCompositeBlendMode",void 0),u([f({readOnly:!0})],Ei.prototype,"overlayManager",void 0),u([f({readOnly:!0})],Ei.prototype,"viewingMode",null),u([f()],Ei.prototype,"maxTextureScale",void 0),u([f({readOnly:!0})],Ei.prototype,"ready",null),u([f({value:C3.FRONT_TO_BACK})],Ei.prototype,"renderOrder",null),u([f({readOnly:!0})],Ei.prototype,"rootTiles",void 0),u([f({readOnly:!0})],Ei.prototype,"spatialReference",null),u([f({type:at,aliasOf:"view.map.ground.surfaceColor"})],Ei.prototype,"backgroundColor",void 0),u([f({value:!1})],Ei.prototype,"slicePlaneEnabled",null),u([f({readOnly:!0})],Ei.prototype,"tilingScheme",void 0),u([f({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],Ei.prototype,"tilingSchemeLocked",void 0),u([f({readOnly:!0})],Ei.prototype,"tilingSchemeLogic",void 0),u([f({value:!0})],Ei.prototype,"velvetOverground",null),u([Lt("_renderer.wireframe")],Ei.prototype,"wireframe",void 0),u([f({value:!1})],Ei.prototype,"suspended",null),u([f({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],Ei.prototype,"textureFadeDuration",void 0),u([f()],Ei.prototype,"_layerViewsDirty",void 0),u([Lt("_renderer.renderPatchBorders")],Ei.prototype,"renderPatchBorders",void 0),u([Lt("_renderer.renderingDisabled")],Ei.prototype,"renderingDisabled",void 0),Ei=u([B("esri.views.3d.terrain.TerrainSurface")],Ei);const Ept=Ei;function gce(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function T2e(e){return!e.isLeaf&&(e.children.some(t=>t.shouldLoad)||e.children.some(t=>T2e(t)))}function Cpt(e){return e.isLeaf&&e.parent&&e.parent.shouldLoad}const Zo=di(),Apt=ei(),DD=[0,0,0],M9=new hi,ND={spatialReference:null,tile:null,extent:null,context:"ground"},FD={spatialReference:null,extent:null,scale:0};let oM=class extends ze{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(e){this.dirty=!1,this._dirtyGeomRecords.forEach((t,i)=>this.commitLayer(i,e))}commitLayer(e,t){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((r,s)=>{const n=this._ensureGeomRecord(e,s);r.forEach((o,a)=>{const l=o[0],c=o[1],h=o[2];let p=!1;if(c&vi.Geometry.UPDATE){const m=n.get(a);if(m){const g=m[1];if(h&vi.State.TRANSFORMATION){const v=this.model.getObject(s);this.model.updateRenderGeometryTransformation(v,l,g)&&(p=!0)}p||t.updates.push({renderGeometry:g,updateType:h})}else At(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(c&vi.Geometry.REMOVE||p){const m=n.get(a);m?(t.removes.push(m[1]),n.delete(a),m[0].disposed&&Jx.pool.release(m[0])):c===vi.Geometry.REMOVE&&At(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(c&vi.Geometry.ADD||p){const m=this.model.getObject(s);if(w(m)){const g=this.model.getRenderGeometry(m,l),v=[l,g];t.adds.push(g),n.set(a,v)}}}),n.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e))}getResidentRenderGeometries(e,t){const i=this._residentGeomRecords.get(e);i&&i.forEach(r=>r.forEach(s=>t.push(s[1])))}_objectStateChanged(e,t){for(const i of t.geometryRecords)this._updateOrCreateDirtyRecord(t,i,null,vi.Geometry.UPDATE,0,0,vi.Geometry.UPDATE,vi.Geometry.ADD|vi.Geometry.REMOVE,e)}visibilityChanged(e){this._objectStateChanged(vi.State.VISIBILITIES,e)}highlightChanged(e){this._objectStateChanged(vi.State.HIGHLIGHTS,e)}occlusionChanged(e){this._objectStateChanged(vi.State.OCCLUDEES,e)}vertexAttrsUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.record,null,vi.Geometry.UPDATE,0,0,vi.Geometry.UPDATE,vi.Geometry.ADD|vi.Geometry.REMOVE,vi.State.VERTEXATTRS)}layerAdded(e){e.objects.forAll(t=>this._layerObjectAdded(e,t))}layerRemoved(e){e.objects.forAll(t=>this._layerObjectRemoved(e,t))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryAdded(t,r,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const t of e.objects)this._layerObjectAdded(e.layer,t)}layerObjectsRemoved(e){for(const t of e.objects)this._layerObjectRemoved(e.layer,t)}_layerObjectRemoved(e,t){const i=e.id;for(const r of t.geometryRecords)this._objectGeometryRemoved(t,r,i)}shaderTransformationChanged(e){const t=this._residentGeomRecords.get(e.id);t&&t.forEach((i,r)=>{const s=this.model.getObject(r);s&&s.hasVolativeTransformation()&&i.forEach(n=>{n[1].shaderTransformationChanged()})})}objectTransformation(e){const t=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(t,i).forEach(r=>{this._updateOrCreateDirtyRecord(e,r[0],t,vi.Geometry.UPDATE,0,0,vi.Geometry.UPDATE,vi.Geometry.ADD|vi.Geometry.REMOVE,vi.State.TRANSFORMATION)})}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.record)}_objectGeometryAdded(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,vi.Geometry.ADD,vi.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.record)}_objectGeometryRemoved(e,t,i=null){this._updateOrCreateDirtyRecord(e,t,i,vi.Geometry.REMOVE,vi.Geometry.ADD,vi.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(e,t,i,r,s,n,o,a,l){i=$t(i,this._getParentLayerId(e));const c=e.id,h=t.id,p=this._ensureDirtyRecord(i,c),m=p.get(h);if(m){const g=m[1];g&s?(p.delete(h),m[0].disposed&&Jx.pool.release(m[0])):g&n?(m[1]=r,m[2]=l):g&o?m[2]|=l:g&a||At(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else p.set(h,[t,r,l]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,t){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}get _hasDirtyGeometryRecords(){return On(this._dirtyGeomRecords,e=>On(e,t=>t&&t.size>0))}_ensureDirtyRecord(e,t){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let r=i.get(t);return r||(r=new Map,i.set(t,r)),r}_getParentLayerId(e){return w(e.parentLayer)?e.parentLayer.id:rAe}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let t="";return this._dirtyGeomRecords.forEach((i,r)=>{i.forEach((s,n)=>{t.length>0&&(t+=`
`),t+=r+"."+n;const o=[];s.forEach(a=>{const l=a[1];o[l]||(o[l]=[]),o[l].push(a[0].geometry.id)});for(let a=0;a<o.length;a++)if(o[a]){t+=" "+e[a-1]+": ";for(let l=0;l<o[a].length;l++)t+=o[a][l]+", "}})}),t}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((t,i)=>t+i.size,0)}}}};u([f({constructOnly:!0})],oM.prototype,"model",void 0),u([f()],oM.prototype,"dirty",void 0),oM=u([B("esri.views.3d.webgl-engine.lib.ModelDirtySet")],oM);const Opt=oM;let ZF=class extends ze{constructor(){super(...arguments),this.dirtySet=new Opt({model:this}),this._content=new Map,this._originFactory=new RJ(null,75e4)}getObject(e){return this._content.get(e)}add(e){const t=e.id;At(!this._content.has(t),"Model/Stage already contains object to be added"),this._content.set(t,e),X5(e)&&this.dirtySet.layerAdded(e)}remove(e){At(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),X5(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const t of e)w(t)&&(At(!this._content.has(t.id),"Model/Stage already contains object to be added"),this._content.set(t.id,t))}removeMany(e){for(const t of e)At(this._content.has(t.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(t.id),t.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,t){this._content.forEach(i=>{i.type===e&&t(i)})}getRenderGeometry(e,t){const{geometry:i,material:r,id:s,shaderTransformation:n,origin:o,instanceParameters:a}=t,l=new OC(i,r,{id:s,boundingInfo:i.boundingInfo,calculateShaderTransformation:n,castShadow:e.castShadow});return l.updateTransformation(c=>e.getCombinedStaticTransformation(t,c)),l.origin=o||this._originFactory.getOrigin(l.boundingSphere),l.instanceParameters=a,l}updateRenderGeometryTransformation(e,t,i){if(N(e))return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(t,s));const r=this._originFactory.getOrigin(i.boundingSphere);return i.origin!==r}getStats(){const e={},t=Array.from(this._content.values());for(let i=0;i<Kp.COUNT;++i)e[i]=t.filter(r=>r.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};u([f({constructOnly:!0})],ZF.prototype,"dirtySet",void 0),ZF=u([B("esri.views.3d.webgl-engine.parts.Model")],ZF);function S2e(){const e=new Float32Array(4);return e[3]=1,e}function E2e(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Rpt(e,t,i,r){const s=new Float32Array(4);return s[0]=e,s[1]=t,s[2]=i,s[3]=r,s}function C2e(e,t){return new Float32Array(e,t,4)}Object.freeze(Object.defineProperty({__proto__:null,create:S2e,clone:E2e,fromValues:Rpt,createView:C2e},Symbol.toStringTag,{value:"Module"}));const Is=!0,ex={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function pK(e,t,i){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,i+ex.identifierOffset,ex.identifierLength)),version:t.getUint16(i+ex.versionOffset,Is),checksum:t.getUint32(i+ex.checksumOffset,Is)}}const _c={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Mpt(e,t){return{sizeLo:e.getUint32(t+_c.sizeLo,Is),sizeHi:e.getUint32(t+_c.sizeHi,Is),minX:e.getFloat64(t+_c.minX,Is),minY:e.getFloat64(t+_c.minY,Is),minZ:e.getFloat64(t+_c.minZ,Is),maxX:e.getFloat64(t+_c.maxX,Is),maxY:e.getFloat64(t+_c.maxY,Is),maxZ:e.getFloat64(t+_c.maxZ,Is),errorX:e.getFloat64(t+_c.errorX,Is),errorY:e.getFloat64(t+_c.errorY,Is),errorZ:e.getFloat64(t+_c.errorZ,Is),count:e.getUint32(t+_c.count,Is),reserved:e.getUint32(t+_c.reserved,Is)}}function fwt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=pK(e,t,i);if(i+=ex.byteCount,r!=="LEPCC     ")throw new se("lepcc-decode-error","Bad identifier");if(s>1)throw new se("lepcc-decode-error","Unknown version");const n=Mpt(t,i);if(i+=_c.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new se("lepcc-decode-error","Bad size");const o=new Float64Array(3*n.count),a=[],l=[],c=[],h=[];if(i=kD(e,i,a),i=kD(e,i,l),i=kD(e,i,c),i=kD(e,i,h),i!==e.byteLength)throw new se("lepcc-decode-error","Bad length");let p=0,m=0;for(let g=0;g<a.length;g++){m+=a[g];let v=0;for(let b=0;b<l[g];b++){v+=c[p];const S=h[p];o[3*p]=Math.min(n.maxX,n.minX+2*n.errorX*v),o[3*p+1]=Math.min(n.maxY,n.minY+2*n.errorY*m),o[3*p+2]=Math.min(n.maxZ,n.minZ+2*n.errorZ*S),p++}}return{errorX:n.errorX,errorY:n.errorY,errorZ:n.errorZ,result:o}}function kD(e,t,i){const r=[];t=IW(e,t,r);const s=[];for(let n=0;n<r.length;n++){s.length=0,t=IW(e,t,s);for(let o=0;o<s.length;o++)i.push(s[o]+r[n])}return t}function IW(e,t,i){const r=new DataView(e,t),s=r.getUint8(0),n=31&s,o=!!(32&s),a=(192&s)>>6;let l=0;if(a===0)l=r.getUint32(1,Is),t+=5;else if(a===1)l=r.getUint16(1,Is),t+=3;else{if(a!==2)throw new se("lepcc-decode-error","Bad count type");l=r.getUint8(1),t+=2}if(o)throw new se("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*n/8),h=new Uint8Array(e,t,c);let p=0,m=0,g=0;const v=-1>>>32-n;for(let b=0;b<l;b++){for(;m<n;)p|=h[g]<<m,m+=8,g+=1;i[b]=p&v,p>>>=n,m-=n,m+n>32&&(p|=h[g-1]>>8-m)}return t+g}const dw={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Ppt(e,t){return{sizeLo:e.getUint32(t+dw.sizeLo,Is),sizeHi:e.getUint32(t+dw.sizeHi,Is),count:e.getUint32(t+dw.count,Is),colorMapCount:e.getUint16(t+dw.colorMapCount,Is),lookupMethod:e.getUint8(t+dw.lookupMethod),compressionMethod:e.getUint8(t+dw.compressionMethod)}}function Ipt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=pK(e,t,i);if(i+=ex.byteCount,r!=="ClusterRGB")throw new se("lepcc-decode-error","Bad identifier");if(s>1)throw new se("lepcc-decode-error","Unknown version");const n=Ppt(t,i);if(i+=dw.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new se("lepcc-decode-error","Bad size");if((n.lookupMethod===2||n.lookupMethod===1)&&n.compressionMethod===0){if(3*n.colorMapCount+n.count+i!==e.byteLength||n.colorMapCount>256)throw new se("lepcc-decode-error","Bad count");const o=new Uint8Array(e,i,3*n.colorMapCount),a=new Uint8Array(e,i+3*n.colorMapCount,n.count),l=new Uint8Array(3*n.count);for(let c=0;c<n.count;c++){const h=a[c];l[3*c]=o[3*h],l[3*c+1]=o[3*h+1],l[3*c+2]=o[3*h+2]}return l}if(n.lookupMethod===0&&n.compressionMethod===0){if(3*n.count+i!==e.byteLength||n.colorMapCount!==0)throw new se("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(n.lookupMethod<=2&&n.compressionMethod===1){if(i+3!==e.byteLength||n.colorMapCount!==1)throw new se("lepcc-decode-error","Bad count");const o=t.getUint8(i),a=t.getUint8(i+1),l=t.getUint8(i+2),c=new Uint8Array(3*n.count);for(let h=0;h<n.count;h++)c[3*h]=o,c[3*h+1]=a,c[3*h+2]=l;return c}throw new se("lepcc-decode-error","Bad method "+n.lookupMethod+","+n.compressionMethod)}const pw={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Lpt(e,t){return{sizeLo:e.getUint32(t+pw.sizeLo,Is),sizeHi:e.getUint32(t+pw.sizeHi,Is),count:e.getUint32(t+pw.count,Is),scaleFactor:e.getUint16(t+pw.scaleFactor,Is),bitsPerPoint:e.getUint8(t+pw.bitsPerPoint),reserved:e.getUint8(t+pw.reserved)}}function $pt(e){const t=new DataView(e,0);let i=0;const{identifier:r,version:s}=pK(e,t,i);if(i+=ex.byteCount,r!=="Intensity ")throw new se("lepcc-decode-error","Bad identifier");if(s>1)throw new se("lepcc-decode-error","Unknown version");const n=Lpt(t,i);if(i+=pw.byteCount,n.sizeHi*2**32+n.sizeLo!==e.byteLength)throw new se("lepcc-decode-error","Bad size");const o=new Uint16Array(n.count);if(n.bitsPerPoint===8){if(n.count+i!==e.byteLength)throw new se("lepcc-decode-error","Bad size");const a=new Uint8Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else if(n.bitsPerPoint===16){if(2*n.count+i!==e.byteLength)throw new se("lepcc-decode-error","Bad size");const a=new Uint16Array(e,i,n.count);for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}else{const a=[];if(IW(e,i,a)!==e.byteLength)throw new se("lepcc-decode-error","Bad size");for(let l=0;l<n.count;l++)o[l]=a[l]*n.scaleFactor}return o}const LW=Ie.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Dpt(e,t,i){let r="",s=0;for(;s<i;){const n=e[t+s];if(n<128)r+=String.fromCharCode(n),s++;else if(n>=192&&n<224){if(s+1>=i)throw new se("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&n)<<6|63&e[t+s+1];r+=String.fromCharCode(o),s+=2}else if(n>=224&&n<240){if(s+2>=i)throw new se("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&n)<<12|(63&e[t+s+1])<<6|63&e[t+s+2];r+=String.fromCharCode(o),s+=3}else{if(!(n>=240&&n<248))throw new se("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(s+3>=i)throw new se("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&n)<<18|(63&e[t+s+1])<<12|(63&e[t+s+2])<<6|63&e[t+s+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);r+=String.fromCharCode(a,l)}else r+=String.fromCharCode(o);s+=4}}}return r}function A2e(e,t){const i={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let s=0;s<t.length;s++){const n=t[s],o=n.valueType||n.type,a=Gpt[o];i.fields[n.property]=a(e,r),r+=oB[o].BYTES_PER_ELEMENT}return i.byteCount=r,i}function Npt(e,t,i){const r=[];let s,n,o=0;for(n=0;n<e;n+=1){if(s=t[n],s>0){if(r.push(Dpt(i,o,s-1)),i[o+s-1]!==0)throw new se("string-array-error","Invalid string array: missing null termination.")}else r.push(null);o+=s}return r}function yce(e,t){return new oB[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function Fpt(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function kpt(e,t,i){const r=t.header!=null?A2e(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},s={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let n=r.byteCount;for(let o=0;o<t.ordering.length;o++){const a=t.ordering[o],l=me(t[a]);if(l.count=r.fields.count,l.valueType==="String"){if(l.byteOffset=n,l.byteCount=r.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new se("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding})}else{if(!R2e(l.valueType))throw new se("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=XF(l.valueType);n+=n%c!=0?c-n%c:0,l.byteOffset=n,l.byteCount=c*l.valuesPerElement*l.count}}n+=l.byteCount,s.entries[a]=l}return s.byteCount=n-s.byteOffset,s}function O2e(e,t,i){if(t!==e&&LW.error(`Invalid ${i} buffer size
 expected: ${e}, actual: ${t})`),t<e)throw new se("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function Upt(e){return{isDraco:!1,isLegacy:!1,color:e.color!=null,normal:e.normal!=null,uv0:e.uv0!=null,uvRegion:e.uvRegion!=null,featureIndex:e.faceRange!=null&&e.featureId!=null}}function mwt(e,t){const i=A2e(e,t&&t.header);let r=i.byteCount;const s={isDraco:!1,header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:{}},n=i.fields,o=n.vertexCount!=null?n.vertexCount:n.count;for(const c of t.ordering){if(!t.vertexAttributes[c])continue;const h={...t.vertexAttributes[c],byteOffset:r,count:o},p=_ce[c]?_ce[c]:"_"+c;s.vertexAttributes[p]=h,r+=XF(h.valueType)*h.valuesPerElement*o}const a=n.faceCount;if(t.faces&&a){s.faces={};for(const c of t.ordering){if(!t.faces[c])continue;const h={...t.faces[c],byteOffset:r,count:a};s.faces[c]=h,r+=XF(h.valueType)*h.valuesPerElement*a}}const l=n.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&l){s.featureAttributes={};for(const c of t.featureAttributeOrder){if(!t.featureAttributes[c])continue;const h={...t.featureAttributes[c],byteOffset:r,count:l};s.featureAttributes[c]=h,r+=(h.valueType==="UInt64"?8:XF(h.valueType))*h.valuesPerElement*l}}return O2e(r,e.byteLength,"geometry"),s.byteCount=r-s.byteOffset,s}function gwt(e,t){return!e||!e.compressedAttributes||e.compressedAttributes.encoding!=="draco"?e?Upt(e):zpt(t):Bpt(e.compressedAttributes.attributes)}function zpt(e){const t={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e.ordering)if(e.vertexAttributes[i])switch(i){case"position":break;case"normal":t.normal=!0;break;case"color":t.color=!0;break;case"uv0":t.uv0=!0;break;case"region":t.uvRegion=!0}return e.featureAttributes&&e.featureAttributeOrder&&(t.featureIndex=!0),t}function Bpt(e){const t={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const i of e)switch(i){case"position":break;case"normal":t.normal=!0;break;case"uv0":t.uv0=!0;break;case"color":t.color=!0;break;case"uv-region":t.uvRegion=!0;break;case"feature-index":t.featureIndex=!0}return t}const _ce={position:D.POSITION,normal:D.NORMAL,color:D.COLOR,uv0:D.UV0,region:D.UVREGION};function Vpt(e,t,i){if(e.encoding==="lepcc-rgb")return Ipt(t);if(e.encoding==="lepcc-intensity")return $pt(t);if(e.encoding!=null&&e.encoding!=="")throw new se("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(LW.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),e.ordering[0]==="ObjectIds"&&e.hasOwnProperty("objectIds")&&(LW.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const r=kpt(t,e,i);O2e(r.byteOffset+r.byteCount,t.byteLength,"attribute");const s=r.entries.attributeValues||r.entries.objectIds;if(s){if(s.valueType==="String"){const n=r.entries.attributeByteCounts,o=yce(t,n),a=Fpt(t,s);return Npt(n.count,o,a)}return yce(t,s)}throw new se("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const oB={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},Gpt={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function R2e(e){return oB.hasOwnProperty(e)}function XF(e){return R2e(e)?oB[e].BYTES_PER_ELEMENT:0}function jpt(e,t,i,r){const s=Hpt(e,t,i),n=Be();return rh(i,s,n,r),n}const M2e=1,vce=5-M2e;function Hpt(e,t,i){const r=F(),s=e[3],n=2**(Math.ceil(Math.log(s)*Math.LOG2E/vce)*vce+M2e);if(i.isGeographic){const l=n/ji(i).radius*180/Math.PI,c=Math.round(e[1]/l),h=Math.max(-90,Math.min(90,c*l)),p=l/Math.cos((Math.abs(h)-l/2)/180*Math.PI),m=Math.round(e[0]/p)*p;r[0]=m,r[1]=h}else{const l=Math.round(e[0]/n),c=Math.round(e[1]/n);r[0]=l*n,r[1]=c*n}const o=e[2]+t,a=Math.round(o/n);return r[2]=a*n,r}const IC=1e-6,FO=[0,0,0],UD=[0,0,0];function qpt(e,t){const{data:i,size:r}=e,s=i.length/r;if(s<=0)return;const n=new tft(e);YF(FO,n.minProj,n.maxProj),Nw(FO,FO,.5),rd(UD,n.maxProj,n.minProj);const o=$W(UD),a=new ift;a.quality=o,s<14&&(e={data:new Float64Array(n.buffer,112,42),size:3});const l=[0,0,0],c=[0,0,0],h=[0,0,0],p=[0,0,0],m=[0,0,0],g=[0,0,0],v=[0,0,0];switch(Wpt(n,e,v,l,c,h,p,m,g,a)){case 1:return void Tce(FO,UD,t);case 2:return void eft(e,p,t)}Zpt(e,v,l,c,h,p,m,g,a),P2e(e,a.b0,a.b1,a.b2,xE,TE);const b=[0,0,0];rd(b,TE,xE),a.quality=$W(b),a.quality<o?I2e(a.b0,a.b1,a.b2,xE,TE,b,t):Tce(FO,UD,t)}function Wpt(e,t,i,r,s,n,o,a,l,c){return Xpt(e,r,s),DW(r,s)<IC?1:(rd(o,r,s),Ko(o,o),Ypt(t,r,o,n)<IC?2:(rd(a,s,n),Ko(a,a),rd(l,n,r),Ko(l,l),sd(i,a,o),Ko(i,i),fw(t,i,o,a,l,c),0))}const kO=[0,0,0],UO=[0,0,0],Ch=[0,0,0],Ah=[0,0,0],Oh=[0,0,0],c_=[0,0,0],u_=[0,0,0],h_=[0,0,0];function Zpt(e,t,i,r,s,n,o,a,l){Qpt(e,t,i,kO,UO),kO[0]!==void 0&&(rd(Ch,kO,i),Ko(Ch,Ch),rd(Ah,kO,r),Ko(Ah,Ah),rd(Oh,kO,s),Ko(Oh,Oh),sd(c_,Ah,n),Ko(c_,c_),sd(u_,Oh,o),Ko(u_,u_),sd(h_,Ch,a),Ko(h_,h_),fw(e,c_,n,Ah,Ch,l),fw(e,u_,o,Oh,Ah,l),fw(e,h_,a,Ch,Oh,l)),UO[0]!==void 0&&(rd(Ch,UO,i),Ko(Ch,Ch),rd(Ah,UO,r),Ko(Ah,Ah),rd(Oh,UO,s),Ko(Oh,Oh),sd(c_,Ah,n),Ko(c_,c_),sd(u_,Oh,o),Ko(u_,u_),sd(h_,Ch,a),Ko(h_,h_),fw(e,c_,n,Ah,Ch,l),fw(e,u_,o,Oh,Ah,l),fw(e,h_,a,Ch,Oh,l))}function Xpt(e,t,i){let r=DW(e.maxVert[0],e.minVert[0]),s=0;for(let n=1;n<7;++n){const o=DW(e.maxVert[n],e.minVert[n]);o>r&&(r=o,s=n)}kc(t,e.minVert[s]),kc(i,e.maxVert[s])}const Rh=[0,0,0];function Ypt(e,t,i,r){const{data:s,size:n}=e;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<s.length;l+=n){Rh[0]=s[l]-t[0],Rh[1]=s[l+1]-t[1],Rh[2]=s[l+2]-t[2];const c=i[0]*Rh[0]+i[1]*Rh[1]+i[2]*Rh[2],h=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],p=Rh[0]*Rh[0]+Rh[1]*Rh[1]+Rh[2]*Rh[2]-c*c/h;p>o&&(o=p,a=l)}return kc(r,s,a),o}const qn=[0,0];function Qpt(e,t,i,r,s){Kpt(e,t,qn,s,r);const n=$2e(i,t);qn[1]-IC<=n&&(r[0]=void 0),qn[0]+IC>=n&&(s[0]=void 0)}const bce=[0,0,0],wce=[0,0,0],xce=[0,0,0],RS=[0,0,0],MS=[0,0,0],zD=[0,0,0];function fw(e,t,i,r,s,n){if(L2e(t)<IC)return;sd(bce,i,t),sd(wce,r,t),sd(xce,s,t),wE(e,t,qn),MS[1]=qn[0],RS[1]=qn[1],zD[1]=RS[1]-MS[1];const o=[i,r,s],a=[bce,wce,xce];for(let l=0;l<3;++l){wE(e,o[l],qn),MS[0]=qn[0],RS[0]=qn[1],wE(e,a[l],qn),MS[2]=qn[0],RS[2]=qn[1],zD[0]=RS[0]-MS[0],zD[2]=RS[2]-MS[2];const c=$W(zD);c<n.quality&&(kc(n.b0,o[l]),kc(n.b1,t),kc(n.b2,a[l]),n.quality=c)}}const Jpt=[0,0,0];function wE(e,t,i){const{data:r,size:s}=e;i[0]=Number.POSITIVE_INFINITY,i[1]=Number.NEGATIVE_INFINITY;for(let n=0;n<r.length;n+=s){const o=r[n]*t[0]+r[n+1]*t[1]+r[n+2]*t[2];i[0]=Math.min(i[0],o),i[1]=Math.max(i[1],o)}}function Kpt(e,t,i,r,s){const{data:n,size:o}=e;kc(r,n),kc(s,r),i[0]=$2e(Jpt,t),i[1]=i[0];for(let a=o;a<n.length;a+=o){const l=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];l<i[0]&&(i[0]=l,kc(r,n,a)),l>i[1]&&(i[1]=l,kc(s,n,a))}}function Tce(e,t,i){kc(i.center,e),Nw(i.halfSize,t,.5),i.quaternion[0]=0,i.quaternion[1]=0,i.quaternion[2]=0,i.quaternion[3]=1}const Rg=[0,0,0],PS=[0,0,0],zO=[0,0,0],xE=[0,0,0],TE=[0,0,0],Sce=[0,0,0];function eft(e,t,i){kc(Rg,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?Rg[0]=0:Math.abs(t[1])>Math.abs(t[2])?Rg[1]=0:Rg[2]=0,L2e(Rg)<IC&&(Rg[0]=Rg[1]=Rg[2]=1),sd(PS,t,Rg),Ko(PS,PS),sd(zO,t,PS),Ko(zO,zO),P2e(e,t,PS,zO,xE,TE),rd(Sce,TE,xE),I2e(t,PS,zO,xE,TE,Sce,i)}function P2e(e,t,i,r,s,n){wE(e,t,qn),s[0]=qn[0],n[0]=qn[1],wE(e,i,qn),s[1]=qn[0],n[1]=qn[1],wE(e,r,qn),s[2]=qn[0],n[2]=qn[1]}const BD=[0,0,0],Af=[1,0,0,0,1,0,0,0,1],IS=[0,0,0];function I2e(e,t,i,r,s,n,o){Af[0]=e[0],Af[1]=e[1],Af[2]=e[2],Af[3]=t[0],Af[4]=t[1],Af[5]=t[2],Af[6]=i[0],Af[7]=i[1],Af[8]=i[2],rft(o.quaternion,Af),YF(IS,r,s),Nw(IS,IS,.5),Nw(o.center,e,IS[0]),Nw(BD,t,IS[1]),YF(o.center,o.center,BD),Nw(BD,i,IS[2]),YF(o.center,o.center,BD),Nw(o.halfSize,n,.5)}const lu=7;class tft{constructor(t){this.minVert=new Array(lu),this.maxVert=new Array(lu);const i=64*lu;this.buffer=new ArrayBuffer(i);let r=0;this.minProj=new Float64Array(this.buffer,r,lu),r+=8*lu,this.maxProj=new Float64Array(this.buffer,r,lu),r+=8*lu;for(let l=0;l<lu;++l)this.minVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<lu;++l)this.maxVert[l]=new Float64Array(this.buffer,r,3),r+=24;for(let l=0;l<lu;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const s=new Array(lu),n=new Array(lu),{data:o,size:a}=t;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,s[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,n[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,s[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,n[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,s[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,n[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,s[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,n[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,s[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,n[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,s[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,n[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,s[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,n[6]=l)}for(let l=0;l<lu;++l){let c=s[l];kc(this.minVert[l],o,c),c=n[l],kc(this.maxVert[l],o,c)}}}class ift{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function $W(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function YF(e,t,i){e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2]}function rd(e,t,i){e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2]}function Nw(e,t,i){e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}function kc(e,t,i=0){e[0]=t[i+0],e[1]=t[i+1],e[2]=t[i+2]}function sd(e,t,i){const r=t[0],s=t[1],n=t[2],o=i[0],a=i[1],l=i[2];e[0]=s*l-n*a,e[1]=n*o-r*l,e[2]=r*a-s*o}function Ko(e,t){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(i>0){const r=1/Math.sqrt(i);e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}}function L2e(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function DW(e,t){const i=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return i*i+r*r+s*s}function $2e(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function rft(e,t){const i=t[0]+t[4]+t[8];if(i>0){let r=Math.sqrt(i+1);e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const s=(r+1)%3,n=(r+2)%3;let o=Math.sqrt(t[3*r+r]-t[3*s+s]-t[3*n+n]+1);e[r]=.5*o,o=.5/o,e[3]=(t[3*s+n]-t[3*n+s])*o,e[s]=(t[3*s+r]+t[3*r+s])*o,e[n]=(t[3*n+r]+t[3*r+n])*o}}const tP=s0(),tx=F(),sft=F(),nft=Qr();class ywt{constructor(t){const o=t*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(t);for(let a=0;a<t;a++)this.obbs[a]={center:mZ(this.buffer,56*a+0),halfSize:U1e(this.buffer,56*a+24),quaternion:C2e(this.buffer,56*a+36)}}}function fK(e=[0,0,0],t=[-1,-1,-1],i=[0,0,0,1]){return{center:un(e),halfSize:x5(t),quaternion:E2e(i)}}function Ece(e){return fK(e.center,e.halfSize,e.quaternion)}function _wt(e,t){ve(t.center,e.center),ve(t.halfSize,e.halfSize),lI(t.quaternion,e.quaternion)}function D2e(e,t){return t=t||fK(),qpt(e,t),t}function mw(e,t){const i=Or(t,e.center),r=aB(e,t);return i>r?1:i<-r?-1:0}function vwt(e,t){t||(t=dn());const i=YU(nft,e.quaternion),r=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),s=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),n=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-r,t[1]=e.center[1]-s,t[2]=e.center[2]-n,t[3]=e.center[0]+r,t[4]=e.center[1]+s,t[5]=e.center[2]+n,t}function bwt(e,t){return Or(t,e.center)-aB(e,t)}function wwt(e,t){return Or(t,e.center)+aB(e,t)}function xwt(e,t){return mw(e,t[0])<=0&&mw(e,t[1])<=0&&mw(e,t[2])<=0&&mw(e,t[3])<=0&&mw(e,t[4])<=0&&mw(e,t[5])<=0}function Twt(e,t,i,r=0){Yy(tP,e.quaternion),Me(tx,t,e.center);const s=ju(tx,tx,tP),n=ju(sft,i,tP);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(n[l])>1e-6){const c=(r+e.halfSize[l]-s[l])/n[l],h=(-r-e.halfSize[l]-s[l])/n[l];o=Math.max(o,Math.min(c,h)),a=Math.min(a,Math.max(c,h))}else if(s[l]>e.halfSize[l]+r||s[l]<-e.halfSize[l]-r)return!1;return o<=a}(()=>{const e=new Int8Array(162);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=6};return i([6,2,3,1,5,4]),i([0,2,3,1,5,4]),i([0,2,3,7,5,4]),i([0,1,3,2,6,4]),i([0,1,3,2,0,0]),i([0,1,5,7,3,2]),i([0,1,3,7,6,4]),i([0,1,3,7,6,2]),i([0,1,5,7,6,2]),i([0,1,5,4,6,2]),i([0,1,5,4,0,0]),i([0,1,3,7,5,4]),i([0,2,6,4,0,0]),i([0,0,0,0,0,0]),i([1,3,7,5,0,0]),i([2,3,7,6,4,0]),i([2,3,7,6,0,0]),i([2,3,1,5,7,6]),i([0,1,5,7,6,2]),i([0,1,5,7,6,4]),i([0,1,3,7,6,4]),i([4,5,7,6,2,0]),i([4,5,7,6,0,0]),i([4,5,1,3,7,6]),i([0,2,3,7,5,4]),i([6,2,3,7,5,4]),i([6,2,3,1,5,4]),e})();function aB(e,t){Yy(tP,e.quaternion),ju(tx,t,tP);const i=e.halfSize;return Math.abs(tx[0]*i[0])+Math.abs(tx[1]*i[1])+Math.abs(tx[2]*i[2])}function N2e(e,t){for(let i=0;i<8;++i){const r=t[i];r[0]=1&i?-e.halfSize[0]:e.halfSize[0],r[1]=2&i?-e.halfSize[1]:e.halfSize[1],r[2]=4&i?-e.halfSize[2]:e.halfSize[2],ju(r,r,e.quaternion),Oe(r,r,e.center)}}function oft(e){return vZ(e.halfSize)}function F2e(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function Swt(e){var t;if(Ce("disable-feature:i3s-draco")||!e)return!1;for(const i of e)for(const r of i.geometryBuffers)if(((t=r.compressedAttributes)==null?void 0:t.encoding)==="draco")return!0;return!1}function Ewt(e,t,i,r,s,n){const o=t!==r;s.traverse(i,a=>{let l=a.mbs;return o&&(l=aft,xLe(a.mbs,r,l,t)),lft(e,l)!==ix.OUTSIDE&&(n(a),!0)})}function Cwt(e,t,i){let r=0,s=0;for(let n=0;n<t.length&&r<e.length;n++)e[r]===t[n]&&(i(n)&&(e[s]=e[r],s++),r++);e.length=s}function Awt(e,t,i){let r=0,s=0;for(;r<i.length;)lhe(e,i[r])>=0===t&&(i[s]=i[r],s++),r++;i.length=s}const BO=ei();function Owt(e,t){if(t.rotationScale[1]===0&&t.rotationScale[2]===0&&t.rotationScale[3]===0&&t.rotationScale[5]===0&&t.rotationScale[6]===0&&t.rotationScale[7]===0)return BO[0]=(e[0]-t.position[0])/t.rotationScale[0],BO[1]=(e[1]-t.position[1])/t.rotationScale[4],BO[2]=(e[2]-t.position[0])/t.rotationScale[0],BO[3]=(e[3]-t.position[1])/t.rotationScale[4],BO}const aft=di();var ix;function lft(e,t){const i=t[0],r=t[1],s=t[3],n=e[0]-i,o=i-e[2],a=e[1]-r,l=r-e[3],c=Math.max(n,o,0),h=Math.max(a,l,0),p=c*c+h*h;return p>s*s?ix.OUTSIDE:p>0?ix.INTERSECTS_CENTER_OUTSIDE:-Math.max(n,o,a,l)>s?ix.INSIDE:ix.INTERSECTS_CENTER_INSIDE}function cft(e,t,i){const r=[],s=i&&i.missingFields,n=i&&i.originalFields;for(const o of e){const a=o.toLowerCase();let l=!1;for(const c of t)if(a===c.name.toLowerCase()){r.push(c.name),l=!0,n&&n.push(o);break}!l&&s&&s.push(o)}return r}async function Rwt(e,t,i,r,s){if(t.length===0)return[];const n=e.attributeStorageInfo;if(w(e.associatedLayer))try{return await hft(e.associatedLayer,t,i,r)}catch(o){if(e.associatedLayer.loaded)throw o}if(n){const o=uft(t,i,s);if(N(o))throw new se("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=e.parsedUrl.path,l=await Promise.all(o.map(c=>dft(a,n,c.node,c.indices,r).then(h=>{for(let p=0;p<c.graphics.length;p++){const m=c.graphics[p],g=h[p];if(m.attributes)for(const v in m.attributes)v in g||(g[v]=m.attributes[v]);m.attributes=g}return c.graphics})));return che(l)}throw new se("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function uft(e,t,i){const r=new Map,s=[],n=i();for(const o of e){const a=o.attributes[t];for(let l=0;l<n.length;l++){const c=n[l],h=c.featureIds.indexOf(a);if(h>=0){let p=r.get(c.node);p||(p={node:c.node,indices:[],graphics:[]},s.push(p),r.set(c.node,p)),p.indices.push(h),p.graphics.push(o);for(let m=l;m>0;m--)n[m]=n[m-1];n[0]=c;break}}}return s}async function hft(e,t,i,r){t.sort((l,c)=>l.attributes[i]-c.attributes[i]);const s=t.map(l=>l.attributes[i]),n=[],o=cft(r,e.fields,{originalFields:n}),a=await k2e(e,s,o);for(let l=0;l<t.length;l++){const c=t[l],h=a[l],p={};if(c.attributes)for(const m in c.attributes)p[m]=c.attributes[m];for(let m=0;m<n.length;m++)p[n[m]]=h[o[m]];c.attributes=p}return t}function k2e(e,t,i){const r=e.capabilities.query.maxRecordCount;if(r!=null&&t.length>r){const n=nCe(t,r);return Promise.all(n.map(o=>k2e(e,o,i))).then(che)}const s=new xp({objectIds:t,outFields:i,orderByFields:[e.objectIdField]});return e.queryFeatures(s).then(n=>{if(n&&n.features&&n.features.length===t.length)return n.features.map(o=>o.attributes);throw new se("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function dft(e,t,i,r,s){const n=[];for(const o of t)if(o&&s.includes(o.name)){const a=`${e}/nodes/${i.resources.attributes}/attributes/${o.key}/0`;n.push({url:a,storageInfo:o})}return cl(n.map(o=>jr(o.url,{responseType:"array-buffer"}).then(a=>Vpt(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of r){const c={};for(let h=0;h<o.length;h++)o[h].value!=null&&(c[n[h].storageInfo.name]=mft(o[h].value,l));a.push(c)}return a})}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(ix||(ix={}));const pft=-32768,fft=-(2**31);function mft(e,t){if(!e)return null;const i=e[t];return phe(e)?i===pft?null:i:fhe(e)?i===fft?null:i:i!=i?null:i}function gft(e){const t=e.store.indexCRS||e.store.geographicCRS,i=t===void 0?e.store.indexWKT:void 0;if(i){if(!e.spatialReference)throw new se("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new se("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new wt(F2e(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function yft(e){const t=e.store.vertexCRS||e.store.projectedCRS,i=t===void 0?e.store.vertexWKT:void 0;if(i){if(!e.spatialReference)throw new se("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==e.spatialReference.wkt)throw new se("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const r=t?new wt(F2e(t)):e.spatialReference;return r.equals(e.spatialReference)?e.spatialReference:r}function Mwt(e,t){return N(t)?"@null":t===Pm(t)?"@ECEF":e.equals(t)?"":t.wkid!=null?"@"+t.wkid:null}function NW(e,t,i){if(!t1(e,t))throw new se("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(i==="local"&&!_ft(e,t))throw new se("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function _ft(e,t){return e.equals(t)||e.isWGS84&&t.isWebMercator||e.isWebMercator&&t.isWGS84}function vft(e,t,i){const r=gft(e),s=yft(e);NW(r,t,i),NW(s,t,i)}function bft(e){return(e.geometryType==null||e.geometryType==="triangles")&&(e.topology==null||e.topology==="PerAttributeArray")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Pwt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!bft(e.store.defaultGeometrySchema))throw new se("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:e.parsedUrl.path})}function Iwt(e,t){vft(e,t.spatialReference,t.viewingMode)}function wft(e){return e.geometryType!=null&&e.geometryType==="points"&&(e.topology==null||e.topology==="PerAttributeArray")&&(e.encoding==null||e.encoding===""||e.encoding==="lepcc-xyz")&&e.vertexAttributes!=null&&e.vertexAttributes.position!=null}function Lwt(e){if(e.store==null||e.store.defaultGeometrySchema==null||!wft(e.store.defaultGeometrySchema))throw new se("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function $wt(e,t){NW(e.spatialReference,t.spatialReference,t.viewingMode)}function xft(e){return e.type==="simple"||e.type==="class-breaks"||e.type==="unique-value"}function Tft(e){return e.type==="mesh-3d"}function Dwt(e){if(e==null||!xft(e)||(e.type==="unique-value"||e.type==="class-breaks")&&e.defaultSymbol==null)return!0;const t=e.getSymbols();if(t.length===0)return!0;for(const i of t){if(!Tft(i)||i.symbolLayers.length===0)return!0;for(const r of i.symbolLayers.items)if(r.type!=="fill"||N(r.material)||N(r.material.color)||r.material.colorMixMode!=="replace")return!0}return!1}const Nwt=Nxe({color:[0,0,0,0],opacity:0});class Sft{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function Fwt(e){const t=new Sft;let i=!1,r=!1;for(const s of e.symbolLayers.items)if(s.type==="fill"&&s.enabled){const n=s.material,o=s.edges;if(w(n)&&!i){const a=n.color,l=ATe(n.colorMixMode);w(a)?t.material={color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:t.material={color:[1,1,1],alpha:1,colorMixMode:Hs.Multiply},t.castShadows=s.castShadows,i=!0}w(o)&&!r&&(t.edgeMaterial=Dxe(o,{}),r=!0)}return t.material||(t.material={color:[1,1,1],alpha:1,colorMixMode:Hs.Multiply}),t}function kwt(e,t){return(0|e)+(0|t)|0}function Eft(e,t,i,r,s=0){r===Pm(r)?t.isGeographic?Ift(e,i,t,s):Pft(e,i,t,s):t.isWGS84&&(r.isWebMercator||dP(r))?Aft(t,e,r,i,s):t.isWebMercator&&dP(r)?Mft(t,e,r,i,s):e===i?(i.center[2]+=s,Lr(i.center,t,0,i.center,r,0,1)):(fe(i.center,e.center[0],e.center[1],e.center[2]+s),Lr(i.center,t,0,i.center,r,0,1),lI(i.quaternion,e.quaternion),ve(i.halfSize,e.halfSize))}function Cft(e,t,i,r,s){if(lI(s.quaternion,e.quaternion),r===st.Global){Yy(VD,e.quaternion),ju(d_,e.center,VD),vG(LS,d_),gde($S,LS,e.halfSize),Bc($S,LS,$S);const n=He($S);Oe($S,LS,e.halfSize);const o=He($S);if(n<i)ve(s.center,e.center),fe(d_,i,i,i),Oe(s.halfSize,e.halfSize,d_);else{const a=o>0?1+t/o:1,l=n>0?1+i/n:1,c=(l+a)/2,h=(l-a)/2;be(s.halfSize,LS,h),kw(s.halfSize,s.halfSize,e.halfSize,c),be(s.center,LS,c),kw(s.center,s.center,e.halfSize,h),mde(d_,d_),Nk(s.center,s.center,d_),ju(s.center,s.center,s.quaternion)}}else{const n=fe(d_,0,0,1);kw(s.center,e.center,n,(i+t)/2),Yy(VD,e.quaternion),ju(n,n,VD),vG(n,n),kw(s.halfSize,e.halfSize,n,(i-t)/2)}return s}const d_=F(),LS=F(),$S=F(),VD=s0();function Aft(e,t,i,r,s){ve(mv,t.center),mv[2]+=s;const n=Pm(i);Lr(mv,e,0,mv,n,0,1),U2e(n,t,mv,i,r)}const QF=new Float64Array(24),Oft={data:QF,size:3},Cce=F(),mv=F(),Rft=Qr();function Mft(e,t,i,r,s){ve(mv,t.center),mv[2]+=s,U2e(e,t,mv,i,r)}function U2e(e,t,i,r,s){const n=YU(Rft,t.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)Cce[a]=t.halfSize[a]*((o&1<<a)!=0?-1:1);for(let a=0;a<3;++a){let l=i[a];for(let c=0;c<3;++c)l+=Cce[c]*n[3*c+a];QF[3*o+a]=l}}Lr(QF,e,0,QF,r,0,8),D2e(Oft,s)}function Pft(e,t,i,r){N2e(e,FW),fe(t.center,e.center[0],e.center[1],e.center[2]+r),rh(i,t.center,cu,Pm(i)),fe(t.center,cu[12],cu[13],cu[14]);const s=2*Math.sqrt(1+cu[0]+cu[5]+cu[10]);dy[0]=(cu[6]-cu[9])/s,dy[1]=(cu[8]-cu[2])/s,dy[2]=(cu[1]-cu[4])/s,dy[3]=.25*s,pQ(t.quaternion,dy,e.quaternion),Yy(dy,t.quaternion);let n=0,o=0,a=0;for(const l of FW)l[2]+=r,Lr(l,i,0,l,Pm(i),0,1),Bc(Bi,l,t.center),ju(Bi,Bi,dy),n=Math.max(n,Math.abs(Bi[0])),o=Math.max(o,Math.abs(Bi[1])),a=Math.max(a,Math.abs(Bi[2]));fe(t.halfSize,n,o,a)}function Ift(e,t,i,r){const s=ji(i),n=1+Math.max(0,r)/(s.radius+e.center[2]);fe(t.center,e.center[0],e.center[1],e.center[2]+r),Lr(t.center,i,0,t.center,Pm(i),0,1),lI(t.quaternion,e.quaternion),Yy(dy,e.quaternion),fe(Bi,0,0,1),ju(Bi,Bi,dy),fe(Bi,e.halfSize[0]*Math.abs(Bi[0]),e.halfSize[1]*Math.abs(Bi[1]),e.halfSize[2]*Math.abs(Bi[2])),be(Bi,Bi,s.inverseFlattening),Oe(t.halfSize,e.halfSize,Bi),be(t.halfSize,t.halfSize,n)}function Uwt(e,t,i,r,s,n){if(!n||n.length===0||N(t))return null;const o=jpt(e.mbs,s,i,t);let a;Fs(jD,o);const l=()=>{if(!a)if(a=FW,th(GD),w(e.serviceObb)){Eft(e.serviceObb,i,Ace,t,s),N2e(Ace,a);for(const g of a)et(g,g,jD),rE(GD,g)}else{const g=e.mbs,v=g[3];$n(g,i,Bi,t),et(Bi,Bi,jD),Bi[2]+=s;for(let b=0;b<8;++b){const S=1&b?v:-v,T=2&b?v:-v,O=4&b?v:-v,C=a[b];ve(C,[Bi[0]+S,Bi[1]+T,Bi[2]+O]),rE(GD,C)}}};let c=1/0,h=-1/0;const p=g=>{if(g.type!=="replace")return;const v=g.geometry;if(!v.hasZ)return;th(P9);const b=v.spatialReference||r,S=v.rings.reduce((T,O)=>O.reduce((C,M)=>($n(M,b,Bi,t),et(Bi,Bi,jD),rE(P9,Bi),Math.min(Bi[2],C)),T),1/0);l(),H3(GD,P9)&&(c=Math.min(c,S),h=Math.max(h,S))};if(n.forEach(g=>p(g)),c===1/0)return null;const m=(g,v,b)=>{et(Bi,b,o),g[v+0]=Bi[0],g[v+1]=Bi[1],g[v+2]=Bi[2],v+=24,b[2]=c,et(Bi,b,o),g[v+0]=Bi[0],g[v+1]=Bi[1],g[v+2]=Bi[2],v+=24,b[2]=h,et(Bi,b,o),g[v+0]=Bi[0],g[v+1]=Bi[1],g[v+2]=Bi[2]};for(let g=0;g<8;++g)m(Oce.data,3*g,a[g]);return D2e(Oce)}function zwt(e){return w(e)&&e.halfSize[0]>=0}function Bwt(e){return e[3]>=0}function Vwt(e){w(e)&&(e.halfSize[0]=-1)}function Gwt(e){w(e)&&(e[3]=-1)}const cu=Be(),dy=S2e(),FW=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],P9=ei(),GD=ei(),Ace=fK(),Bi=[0,0,0],Oce={data:new Array(72),size:3},jD=Be();class Lft{constructor(t){this._totalCount=t,this._indexRanges=[0,t]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const t=this._indexRanges;let i=0;for(let r=0;r<t.length;r+=2)i+=t[r+1];return i}reset(t){t==="all"||t.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=$ft(t)}forEachComponent(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r],n=s+i[r+1];for(let o=s;o<n;o++)if(!t(o))return!1}return!0}forEachComponentRange(t){const i=this._indexRanges;for(let r=0;r<i.length;r+=2){const s=i[r];if(!t(s,s+i[r+1]))return!1}return!0}computeOffsetRanges(t){const i=new Array(this._indexRanges.length),r=this._indexRanges;for(let s=0;s<r.length;s+=2){const n=r[s],o=n+r[s+1],a=t[n],l=t[o];i[s]=a,i[s+1]=l-a}return i}}function $ft(e){const t=new Array;if(e.length===0)return t;let i=e[0],r=1;for(let s=1;s<e.length;s++){const n=e[s];i+r===n?r+=1:(t.push(i),t.push(r),i=n,r=1)}return t.push(i),t.push(r),t}class Dft extends Ez{constructor(t,i){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=iZ(i);const r=this.count;this.visibility=new Lft(r),this.materialDataBuffer=t.getBuffer(r),this.materialDataIndices=new Uint16Array(r);for(let s=0;s<r;s++)this.materialDataIndices[s]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let t=0;t<this.count;t++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[t])}get count(){return this.offsets.length-1}get geometryRanges(){return N(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return N(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return N(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((N(this.cachedHighlightRanges)||N(this.cachedDefaultRanges))&&w(this.highlightCounts)){const{highlightRanges:t,defaultRanges:i}=Nft(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=t,this.cachedDefaultRanges=i}}}function Nft(e,t,i){const r=[],s=[];let n=i.length,o=i.length;return t.forEachComponent(a=>(e[a]>0?(n!==a-1&&(r.length&&r.push(i[n+1]-r[r.length-1]),r.push(i[a])),n=a):(o!==a-1&&(s.length&&s.push(i[o+1]-s[s.length-1]),s.push(i[a])),o=a),!0)),r.length&&r.push(i[n+1]-r[r.length-1]),s.length&&s.push(i[o+1]-s[s.length-1]),{highlightRanges:r,defaultRanges:s}}class kW extends Ez{constructor(){super(...arguments),this.visible=SE.Hidden}}var SE;u([Jo()],kW.prototype,"renderable",void 0),u([Jo()],kW.prototype,"components",void 0),function(e){e[e.Hidden=0]="Hidden",e[e.Visible=1]="Visible"}(SE||(SE={}));function Fft(e,t,i,r){if(i>=t)return e;e==null&&(e=kft());const s=e.isVisibleBit;let n=e.data;const o=B2e(n),a=i/o|0,l=i-o*a,c=(t-1)/o|0,h=n,p=r===s;if(!(i<h.length*o)&&p){const g=a+1,v=Math.ceil(h.length*1.5),b=c+1;let S=Math.max(g,v);S=Math.min(S,b),n=new Uint32Array(S),n.set(h)}return a<n.length&&(n[a]=zft(n[a],l,p)),e.data=n,e}function z2e(e,t){if(e==null)return!0;const{isVisibleBit:i,data:r}=e,s=B2e(r);return t<r.length*s?Uft(i,r,t,s):!e.isVisibleBit}function kft(e=!0){return{isVisibleBit:!e,data:new Uint32Array(0)}}function Uft(e,t,i,r){const s=i/r|0,n=i-s*r;return Bft(t[s],n)===e}function B2e(e){return e.BYTES_PER_ELEMENT*8}function zft(e,t,i){return e&~(1<<t)|(i?1:0)<<t}function Bft(e,t){return(e&1<<t)!=0}class Vft{constructor(t,i){this._indices=w(t.indices)?t.indices:yC(t.positions.length/3),this._positions=new hr(t.positions),this._components=i,this._componentIntersectionData=new Array(i.count)}getComponentAabb(t,i){if(w(this._perComponentAabbs)){for(let r=0;r<6;r++)i[r]=this._perComponentAabbs[6*t+r];return i}return this._computePerComponentAabbs(),this.getComponentAabb(t,i)}getComponentPositions(t,i){i.indices=this._indices,i.data=this._positions.typedBuffer,i.stride=this._positions.typedBufferStride,i.startIndex=this._components.offsets[t],i.endIndex=this._components.offsets[t+1]}intersect(t,i,r,s,n,o,a){const l={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},c=this._indices,h=this._components.offsets,p=Uwe(t,i,Gft),m=t[2],g=i[2];this._components.visibility.forEachComponent(v=>{if(!z2e(this._components.pickability,v))return!0;const b=this.getComponentAabb(v,jft);if(w(o)){const M=o[v];w(n)?n.componentOffset=M:(t[2]=m-M,i[2]=g-M)}if(w(n)&&n.applyToAabb(b),!lJ(b,t,p,r))return!0;const S=h[v]/3,T=h[v+1]/3,O=(M,I,$)=>{a(v,M,$c(I,I,s),$)},C=T-S;return N(n)&&C>v2e?(this._componentIntersectionData[v]==null&&(this._componentIntersectionData[v]=new PC(this._indices,S,T,l)),this._componentIntersectionData[v].intersectRay({r0:t,r1:i},O)):fI(t,i,S,T,c,l,void 0,n,O),!0})}_computePerComponentAabbs(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const i=this._indices,r=this._positions.typedBuffer,s=this._positions.typedBufferStride,n=this._components.offsets;let o=0;for(let a=0;a<t;a++){const l=n[a],c=n[a+1];let h=1/0,p=1/0,m=1/0,g=-1/0,v=-1/0,b=-1/0;for(let S=l;S<c;S++){const T=i[S]*s,O=r[T],C=r[T+1],M=r[T+2];h=Math.min(h,O),p=Math.min(p,C),m=Math.min(m,M),g=Math.max(g,O),v=Math.max(v,C),b=Math.max(b,M)}this._perComponentAabbs[o++]=h,this._perComponentAabbs[o++]=p,this._perComponentAabbs[o++]=m,this._perComponentAabbs[o++]=g,this._perComponentAabbs[o++]=v,this._perComponentAabbs[o++]=b}}get positions(){return this._positions}get indices(){return this._indices}}const Gft=F(),jft=dn();class Hft{constructor(t,i,r){this.material=t,this.geometry=i,this.meta=r}dispose(){this.material.dispose(),this.geometry.dispose()}}class V2e extends Ez{constructor(t,i,r,s){super(),this.primitiveType=i,this.parameters=r,this.indexed=s,this.vao=t}}u([Jo()],V2e.prototype,"vao",void 0);function qft(e,t){return{near:e,far:t}}function RI(e){return e?A3(e,1/0,-1/0):qft(1/0,-1/0)}function A3(e,t,i){return e.near=t,e.far=i,e}function LC(e,t,i=e){return i.near=Math.min(e.near,t.near),i.far=Math.max(e.far,t.far),i}function HD(e,t){return e.near<=t&&t<=e.far}const UW={near:0,far:0};function Wft(e,t){const i=RI(),{eye:r,frustum:s,viewForward:n}=e;t.forAll(o=>{const a=w(o.offsetObb)?o.offsetObb:o.obb,l=ke(Bc(vu,a.center,r),n),c=aB(a,n);if(HD(i,l-c)&&HD(i,l+c))return;const h=Jft(a,s);if(h===-1)return;if(h===0)return Mg.far=l+c,Mg.near=l-c,void LC(i,Mg);const p=qD.pushNew();p.near=l-c,p.far=l+c,p.mask=h,p.object=o});for(let o=0;o<qD.length;o++){const a=qD.data[o];if(HD(i,a.near)&&HD(i,a.far))continue;Mg.far=a.far,Mg.near=1/0,Qft(w(a.object.offsetObb)?a.object.offsetObb:a.object.obb,r,Zft,c=>{let h=Xft;for(let p=0;p<G2e&&c.length>0;p++){if((a.mask&1<<p)==0)continue;Yft(s[p],c,h);const m=c;c=h,h=m}for(let p=0;p<c.length;p+=3){fe(Il,c.data[p+0],c.data[p+1],c.data[p+2]);const m=ke(Bc(Il,Il,r),n);Mg.near=Math.min(Mg.near,m)}})===0&&(Mg.near=0),LC(i,Mg)}return qD.length=0,i}const qD=new hi({allocator:e=>e||{near:1/0,far:-1/0,mask:0,object:null},deallocator:e=>(e.object=null,e)}),Mg=RI(),Il=F(),Eb=F(),Zft=new hi({deallocator:null}),Xft=new hi({deallocator:null});function Yft(e,t,i){i.length=0;const r=t.length-3;I9(Il,t,r);const s=Or(e,Il);s<=0&&(i.push(Il[0]),i.push(Il[1]),i.push(Il[2]));let n=0,o=s;for(;n<r;n+=3){I9(Eb,t,n);const a=Or(e,Eb);o*a<0&&(Nn(Il,Eb,Il,a/(a-o)),Ll(i,Il)),a<=0&&Ll(i,Eb),o=a,ve(Il,Eb)}o*s<0&&(I9(Eb,t,r),Nn(Il,Eb,Il,s/(s-o)),Ll(i,Il))}function I9(e,t,i){return fe(e,t.data[i+0],t.data[i+1],t.data[i+2])}function Ll(e,t){e.push(t[0]),e.push(t[1]),e.push(t[2])}function Qft(e,t,i,r){Yy(Mce,e.quaternion),Bc(vu,t,e.center),ju(vu,vu,Mce);const s=8*((vu[0]<-e.halfSize[0]?-1:vu[0]>e.halfSize[0]?1:0)+3*(vu[1]<-e.halfSize[1]?-1:vu[1]>e.halfSize[1]?1:0)+9*(vu[2]<-e.halfSize[2]?-1:vu[2]>e.halfSize[2]?1:0)+13),n=Rce[s];if(n===0)return n;YU(WD,e.quaternion),CQ(WD,WD,e.halfSize);const o=(a,l)=>{const c=Rce[s+l+1];return fe(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),$c(a,a,WD),Oe(a,e.center,a)};return i.length=0,Ll(i,o(L9,0)),Ll(i,o(Pce,1)),Ll(i,o(vu,2)),Ll(i,o(Ice,3)),r(i),n===1||(i.length=0,Ll(i,L9),Ll(i,Ice),Ll(i,o(vu,4)),Ll(i,o(Lce,5)),r(i),n===2||(i.length=0,Ll(i,L9),Ll(i,Lce),Ll(i,o(vu,6)),Ll(i,Pce),r(i))),n}const Rce=(()=>{const e=new Int8Array(216);let t=0;const i=r=>{for(let s=0;s<r.length;s++)e[t+s]=r[s];t+=8};return i([3,0,6,2,3,1,5,4]),i([2,0,2,3,1,5,4,0]),i([3,1,0,2,3,7,5,4]),i([2,0,1,3,2,6,4,0]),i([1,0,1,3,2,0,0,0]),i([2,1,5,7,3,2,0,0]),i([3,2,0,1,3,7,6,4]),i([2,2,0,1,3,7,6,0]),i([3,3,0,1,5,7,6,2]),i([2,0,1,5,4,6,2,0]),i([1,0,1,5,4,0,0,0]),i([2,1,3,7,5,4,0,0]),i([1,0,2,6,4,0,0,0]),i([0,0,0,0,0,0,0,0]),i([1,1,3,7,5,0,0,0]),i([2,2,3,7,6,4,0,0]),i([1,2,3,7,6,0,0,0]),i([2,3,1,5,7,6,2,0]),i([3,4,0,1,5,7,6,2]),i([2,5,7,6,4,0,1,0]),i([3,5,0,1,3,7,6,4]),i([2,4,5,7,6,2,0,0]),i([1,4,5,7,6,0,0,0]),i([2,5,1,3,7,6,4,0]),i([3,6,0,2,3,7,5,4]),i([2,6,2,3,7,5,4,0]),i([3,7,6,2,3,1,5,4]),e})(),G2e=4;function Jft(e,t){let i=0;for(let r=0;r<G2e;r++){const s=mw(e,t[r]);if(s>0)return-1;s===0&&(i|=1<<r)}return i}const WD=Qr(),Mce=s0(),vu=F(),L9=F(),Pce=F(),Ice=F(),Lce=F();class Kft{constructor(t){this._objects=t}submit(t,i){this._objects.preSubmit(i),this._objects.visibleObjects.forAll(r=>r.renderable.material.submit(t,i,r))}queryShadowCasterDepthRange(t){return this._objects.visibleObjects.length?Wft(t,this._objects.visibleObjects):null}}function emt(e){const t=As().vec3f(D.POSITION);return e.normals&&t.vec2i16(D.NORMALCOMPRESSED,{glNormalized:!0}),e.textureCoordinates===Pn.Default?t.vec2f(D.UV0):e.textureCoordinates===Pn.Atlas&&(t.vec2f(D.UV0),t.vec4u16(D.UVREGION,{glNormalized:!0})),e.colors&&t.vec4u8(D.COLOR,{glNormalized:!0}),t.alignTo(4)}class tmt extends vs{constructor(t,i){super(t,"int",nr.Draw,(r,s,n)=>r.setUniform1i(t,i(s,n)))}}var Vp;(function(e){e[e.Uniform=0]="Uniform",e[e.Varying=1]="Varying",e[e.COUNT=2]="COUNT"})(Vp||(Vp={}));const mK=429496.7296;function j2e(e,t){u3(e/mK*.5+.5,t)}function imt(e,t){switch(t.componentData){case Vp.Varying:return rmt(e);case Vp.Uniform:return smt(e);case Vp.COUNT:return;default:t.componentData}}function rmt(e){const{vertex:t,fragment:i}=e;t.include(Xc),t.uniforms.add([new as("componentColorTex"),new Py("componentColorTexInvDim")]),e.attributes.add(D.COMPONENTINDEX,"float"),e.varyings.add("vExternalColorMixMode","mediump float"),e.varyings.add("vExternalColor","vec4"),e.include(RTe),t.constants.add("elevationScale","float",2*mK),t.code.add(E`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),i.code.add(E`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}function smt(e){const{vertex:t,fragment:i}=e;t.uniforms.add(new mk("externalColor",r=>r.componentParameters.externalColor)),i.uniforms.add(new tmt("externalColorMixMode",r=>r.componentParameters.externalColorMixMode)),e.varyings.add("vExternalColor","vec4"),t.code.add(E`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),i.code.add(E`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}var ld;function nmt(e,t){const i=e.vertex;switch(i.code.add(E`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),t.vertexDiscardMode){case ld.None:i.code.add(E`#define vertexDiscardByOpacity(_opacity_) {}`);break;case ld.Opaque:i.code.add(E`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case ld.Transparent:i.code.add(E`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})(ld||(ld={}));var xm;function jwt(e){return e&&km(e)?xm.Mars:e&&Um(e)?xm.Moon:xm.Earth}(function(e){e[e.Earth=1]="Earth",e[e.Mars=2]="Mars",e[e.Moon=3]="Moon",e[e.COUNT=4]="COUNT"})(xm||(xm={}));var $ce,Du;(function(e){e[e.None=0]="None",e[e.Transparent=1]="Transparent",e[e.Opaque=2]="Opaque",e[e.COUNT=3]="COUNT"})($ce||($ce={})),function(e){e[e.None=0]="None",e[e.NoOverlay=1]="NoOverlay",e[e.ColorOverlay=2]="ColorOverlay",e[e.ColorOverlayWithWater=3]="ColorOverlayWithWater",e[e.COUNT=4]="COUNT"}(Du||(Du={}));class Mi extends pl{constructor(){super(...arguments),this.output=ue.Color,this.textureCoordinateType=Pn.None,this.componentData=Vp.Uniform,this.cullFace=Ir.Back,this.vertexDiscardMode=ld.None,this.doubleSidedMode=us.WindingOrder,this.alphaDiscardMode=Mr.Opaque,this.integratedMeshMode=Du.None,this.transparencyPassType=Pt.NONE,this.ellipsoidMode=xm.Earth,this.pbrMode=Wt.Disabled,this.normalType=Yr.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}u([ee({count:ue.COUNT})],Mi.prototype,"output",void 0),u([ee({count:Pn.COUNT})],Mi.prototype,"textureCoordinateType",void 0),u([ee({count:Vp.COUNT})],Mi.prototype,"componentData",void 0),u([ee({count:Ir.COUNT})],Mi.prototype,"cullFace",void 0),u([ee({count:ld.COUNT})],Mi.prototype,"vertexDiscardMode",void 0),u([ee({count:us.COUNT})],Mi.prototype,"doubleSidedMode",void 0),u([ee({count:Mr.COUNT})],Mi.prototype,"alphaDiscardMode",void 0),u([ee({count:Du.COUNT})],Mi.prototype,"integratedMeshMode",void 0),u([ee({count:Pt.COUNT})],Mi.prototype,"transparencyPassType",void 0),u([ee({count:xm.COUNT})],Mi.prototype,"ellipsoidMode",void 0),u([ee({count:Wt.COUNT})],Mi.prototype,"pbrMode",void 0),u([ee({count:Yr.COUNT})],Mi.prototype,"normalType",void 0),u([ee()],Mi.prototype,"spherical",void 0),u([ee()],Mi.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ee()],Mi.prototype,"hasVertexColors",void 0),u([ee()],Mi.prototype,"hasNormals",void 0),u([ee()],Mi.prototype,"hasSlicePlane",void 0),u([ee()],Mi.prototype,"hasBaseColorTexture",void 0),u([ee()],Mi.prototype,"receiveAmbientOcclusion",void 0),u([ee()],Mi.prototype,"receiveShadows",void 0),u([ee()],Mi.prototype,"blendingEnabled",void 0),u([ee()],Mi.prototype,"hasScreenSpaceReflections",void 0),u([ee()],Mi.prototype,"hasPolygonOffset",void 0),u([ee()],Mi.prototype,"hasMetalnessAndRoughnessTexture",void 0),u([ee()],Mi.prototype,"hasEmissionTexture",void 0),u([ee()],Mi.prototype,"hasOcclusionTexture",void 0),u([ee()],Mi.prototype,"hasNormalTexture",void 0),u([ee()],Mi.prototype,"hasOccludees",void 0),u([ee()],Mi.prototype,"hasMultipassTerrain",void 0),u([ee()],Mi.prototype,"cullAboveGround",void 0),u([ee()],Mi.prototype,"isGround",void 0),u([ee()],Mi.prototype,"hasCloudsReflections",void 0),u([ee()],Mi.prototype,"snowCover",void 0),u([ee({constValue:nr.Draw})],Mi.prototype,"pbrTextureBindType",void 0),u([ee({constValue:!0})],Mi.prototype,"hasSliceHighlight",void 0),u([ee({constValue:!1})],Mi.prototype,"hasSliceInVertexProgram",void 0),u([ee({constValue:!1})],Mi.prototype,"useCustomDTRExponentForWater",void 0),u([ee({constValue:!1})],Mi.prototype,"hasVertexTangents",void 0),u([ee({constValue:!0})],Mi.prototype,"supportsTextureAtlas",void 0),u([ee({constValue:!1})],Mi.prototype,"highStepCount",void 0),u([ee({constValue:!1})],Mi.prototype,"instancedDoublePrecision",void 0),u([ee({constValue:!0})],Mi.prototype,"useFillLights",void 0);function Dce(e,t){e.include(TT,t),e.fragment.include(y3);const i=e.fragment;i.uniforms.add(new mk("baseColor",r=>r.baseColor)),i.uniforms.add(new PTe("objectOpacity",r=>r.objectOpacity)),t.hasVertexColors?i.code.add(E`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):i.code.add(E`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),i.code.add(E`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function Nce(e,t){const i=e.fragment;switch(t.doubleSidedMode){case us.None:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case us.View:e.include(gE,t),i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case us.WindingOrder:i.code.add(E`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:t.doubleSidedMode;case us.COUNT:}switch(t.normalType){case Yr.Attribute:case Yr.CompressedAttribute:e.include(Rz,t),i.code.add(E`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case Yr.ScreenDerivative:e.extensions.add("GL_OES_standard_derivatives"),e.include(gE,t),i.code.add(E`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case Yr.Ground:t.spherical?(e.include(gE,t),i.code.add(E`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):i.code.add(E`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),e.extensions.add("GL_OES_standard_derivatives"),i.code.add(E`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:t.normalType;case Yr.COUNT:}}function omt(e,t){const i=e.fragment;if(t.hasBaseColorTexture){e.include(gQ,t);const r=t.textureCoordinateType===Pn.Atlas;i.uniforms.add(kM("baseColorTexture",s=>s.texture,r)),r?(e.include(j1e),i.code.add(E`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):i.code.add(E`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else i.code.add(E`vec4 readBaseColorTexture() { return vec4(1.0); }`)}const H2e=new Map([[D.POSITION,0],[D.NORMAL,1],[D.NORMALCOMPRESSED,1],[D.COLOR,2],[D.UV0,3],[D.UVREGION,4],[D.COMPONENTINDEX,5]]);function amt(e){const t=new dr;t.include(gE,e),t.include(Rz,e),t.include(TT,e),t.include(My,e),t.include(TI,e),t.include(imt,e),t.include(qit,e),t.include(uKe,e),t.include(omt,e),t.include(nmt,e);const{vertex:i,fragment:r}=t;r.uniforms.add(new n1("view")),e.pbrMode!==Wt.Normal&&e.pbrMode!==Wt.Schematic||(t.include(bQ,e),e.hasNormalTexture&&t.include($Te,e)),e.output===ue.Shadow&&e.componentData===Vp.Varying?i.code.add(E`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):i.code.add(E`#define discardShadows(castShadows) {}`);const s=e.integratedMeshMode===Du.ColorOverlay||e.integratedMeshMode===Du.ColorOverlayWithWater,n=s&&e.output===ue.Color&&e.pbrMode===Wt.WaterOnIntegratedMesh;return s&&(t.include(tT,e),t.include(cpt,e),e.spherical?i.code.add(E`
      const float invEllipsoidRadius = ${E.float(1/(e.ellipsoidMode===xm.Earth?Qi.radius:e.ellipsoidMode===xm.Mars?ym.radius:By.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):i.code.add(E`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),n&&(t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),t.varyings.add("groundNormal","vec3")),i.code.add(E`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${E.float(la)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${n?e.spherical?E`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:E`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?E`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),e.output===ue.Alpha&&(r.include(nh),t.include(oh,e),t.include(Dce,e),s&&r.uniforms.add(new ai("ovColorTex",(o,a)=>PW(o,a))),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?E`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),e.output===ue.Color&&(r.include(nh),t.include(oh,e),t.include(Dce,e),t.include(Nce,e),t.include(tT,e),e.receiveShadows?(t.include(Mz,e),r.code.add(E`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):r.code.add(E`float evaluateShadow() { return 0.0; }`),s&&r.uniforms.add(new ai("ovColorTex",(o,a)=>PW(o,a))),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${e.hasMultipassTerrain?E`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?E`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),e.pbrMode===Wt.Normal||e.pbrMode===Wt.Schematic?(r.uniforms.add(new Ut("lightingMainIntensity",(o,a)=>a.lighting.mainLight.intensity)),r.code.add(E`
        ${e.pbrMode===Wt.Normal?E`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),e.hasNormalTexture?r.code.add(E`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):r.code.add(E`vec3 shadingNormal = normalVertex;`),r.code.add(E`${e.spherical?E`vec3 normalGround = normalize(positionWorld());`:E`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),r.code.add(E`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${e.snowCover?E`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?E` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(e.receiveShadows?r.code.add(E`float shadow = evaluateShadow();`):e.spherical?(r.uniforms.add(new lt("lightingGlobalFactor",(o,a)=>a.lighting.globalFactor)),r.code.add(E`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):r.code.add(E`float shadow = 0.0;`),n&&r.uniforms.add(new ai("ovNormalTex",(o,a)=>gK(a))),e.snowCover&&(t.extensions.add("GL_OES_standard_derivatives"),r.code.add(E`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),r.code.add(E`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?E` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${n?E`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),r.code.add(E`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${e.transparencyPassType===Pt.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),e.output!==ue.Depth&&e.output!==ue.Shadow||(t.include(A1,e),r.code.add(E`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),e.output===ue.Normal&&(t.include(Nce,e),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${e.normalType===Yr.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),e.output===ue.Highlight&&(t.include(d0),r.code.add(E`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?E`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),t}function gK(e){return e.overlays.length===0?null:e.overlays[ns.INNER].getValidTexture(Gs.Water)}const lmt=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:H2e,build:amt,getOverlayNormalTexture:gK},Symbol.toStringTag,{value:"Module"}));class lB extends $r{bindDraw(t,i){const r=this.program;r.bindDraw(t,i),r.rebindTextures(),t.componentParameters.type===Vp.Varying&&t.componentParameters.texture.bind(r,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(t,i){i.spherical=t.viewingMode===st.Global,i.doublePrecisionRequiresObfuscation=xI(t.rctx)}initializeProgram(t){const i=lB.shader.get(),r=i.build(this.configuration);return new Sr(t.rctx,r,i.attributeLocations)}_setPipelineState(t){const i=this.configuration,r=i.integratedMeshMode!==Du.None,s=t===Pt.NONE,n=t===Pt.FrontFace;return ni({blending:i.output!==ue.Color&&i.output!==ue.Alpha||!i.blendingEnabled?null:s?Qu:p0(t),culling:qU(i.cullFace),depthTest:{func:C1(t)},depthWrite:s||n?ec:null,colorWrite:wi,stencilWrite:r||i.hasOccludees?Fm:null,stencilTest:r?jtt(Wl.IntegratedMeshMaskExcluded):i.hasOccludees?O1:null,polygonOffset:s||n?i.hasPolygonOffset?{factor:2,units:2}:null:yz})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}lB.shader=new Tr(lmt,()=>_e(()=>import("./ComponentShader.glsl.7241e682.js"),[],import.meta.url));class cmt extends mn{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const t of this._parameterBlocks)this[t]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const t of this._parameterBlocks)if(this[t].dirty)return!0;return!1}}class yK{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function ms(e={}){return(t,i)=>{var s;const r=(s=t._parameterCount)!=null?s:0;if(t._parameterCount=r+1,e.vectorOps){const n=e.vectorOps;Object.defineProperty(t,i,{get(){return this[r]},set(o){const a=this[r];if(a==null)this[r]=o;else{if(n.equals(a,o))return;n.copy(a,o)}this._setDirty()}})}else Object.defineProperty(t,i,{get(){return this[r]},set(n){this[r]!==n&&(e.dispose&&this[r]&&this[r].dispose(),this[r]=n,this._setDirty())}})}}function Fce(){return(e,t)=>{var r;const i=(r=e._parameterCount)!=null?r:0;e._parameterCount=i+1,e._parameterBlocks=e._parameterBlocks||[],e._parameterBlocks.push(i),Object.defineProperty(e,t,{get(){return this[i]},set(s){this[i]!==s&&(this[i]=s,this._setDirty())}})}}class cB{constructor(t){this._low=Wi(),this._high=Wi(),t&&this.set(t)}get low(){return this._low}get high(){return this._high}set(t){const i=this._low,r=this._high;ve(i,t),Bc(r,t,i)}setElements(t,i,r){fe(kce,t,i,r),this.set(kce)}get(t){return Oe(t,this._low,this._high)}getLowScaled(t){return be(t,this._low,1)}}const kce=F();class ro extends cmt{constructor(t,i){super(),this.toMapSpace=i,this.baseColor=Td(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=Ki(1,1,.5),this.emissiveFactor=Ki(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new JF,this.componentParameters=new iP,this.textureAlphaCutoff=H5,this.alphaDiscardMode=Mr.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=xm.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Mi;const r=new cB(t.position),s=jSe(t.rotationScale);wT(s,s),this.transformNormalGlobalFromModel=vd(s,s),this.transformWorldFromModelTL=r.low,this.transformWorldFromModelTH=r.high,this.transformWorldFromModelRS=t.rotationScale}dispose(){this._technique=vr(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return w(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return w(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return w(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return w(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return w(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(t,i,r,s){const n=this._techniqueConfiguration;n.hasVertexColors=s.colors,n.hasNormals=s.normals,n.textureCoordinateType=s.textureCoordinates,n.hasMetalnessAndRoughnessTexture=w(this.metallicRoughnessTexture),n.hasEmissionTexture=w(this.emissionTexture),n.hasOcclusionTexture=w(this.occlusionTexture),n.hasNormalTexture=w(this.normalTexture),n.transparencyPassType=i.identifier===Uu.Material&&r.transparencyPassType!=null?r.transparencyPassType:Pt.NONE,n.hasMultipassTerrain=i.identifier===Uu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.enabled,n.cullAboveGround=i.identifier===Uu.Material&&r.multipassTerrain!=null&&r.multipassTerrain.cullAboveGround,n.ellipsoidMode=this.ellipsoidMode,n.componentData=this.componentParameters.type,n.cullFace=this.commonMaterialParameters.cullFace,n.doubleSidedMode=this.commonMaterialParameters.doubleSided?us.View:us.None,n.hasBaseColorTexture=w(this.baseColorTexture);const o=this._computeWhichMaterialPass();n.blendingEnabled=o===Xa.Transparent||o===Xa.OpaqueAndTransparent,n.alphaDiscardMode=this.alphaDiscardMode,n.integratedMeshMode=this.isIntegratedMesh?dmt(r)?gK(r)?Du.ColorOverlayWithWater:Du.ColorOverlay:Du.NoOverlay:Du.None,n.isGround=this.isIntegratedMesh,n.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&N(this.baseColorTexture);return n.pbrMode=n.integratedMeshMode===Du.ColorOverlayWithWater?Wt.WaterOnIntegratedMesh:this.usePBR?a?Wt.Schematic:Wt.Normal:Wt.Disabled,n.normalType=n.integratedMeshMode===Du.None?n.hasNormals?Yr.CompressedAttribute:Yr.ScreenDerivative:Yr.Ground,n.hasSlicePlane=w(r.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,i.identifier===Uu.ShadowMap?(n.output=ue.Shadow,n.vertexDiscardMode=ld.None):i.identifier===Uu.Highlight?(n.output=ue.Highlight,n.vertexDiscardMode=ld.None):(this._computeWhichMaterialPass()===Xa.OpaqueAndTransparent?n.vertexDiscardMode=i.transparent?ld.Opaque:ld.Transparent:n.vertexDiscardMode=ld.None,n.output=umt(i.subPass),i.subPass===Ro.Alpha&&(n.hasOccludees=r.hasOccludees),i.subPass===Ro.Color?(n.receiveAmbientOcclusion=r.ssaoHelper.ready,n.hasOccludees=r.hasOccludees,n.receiveShadows=r.shadowMap.ready,n.hasScreenSpaceReflections=r.ssr.enabled,n.hasCloudsReflections=w(r.clouds.data)):(n.receiveAmbientOcclusion=!1,n.receiveShadows=!1),n.snowCover=this.hasSnowCover(r)),this._technique=t.releaseAndAcquire(lB,n,this._technique),this._setClean(),this._technique}hasSnowCover(t){return w(t.weather)&&t.weatherVisible&&t.weather.type==="snowy"&&t.weather.snowCover==="enabled"}submit(t,i,r){if(this.objectOpacity===0)return;const s=r.renderable.geometry,n=r.components,o=r.renderable.meta.cameraDepthSquared,a=n.geometryRanges,l=n.highlightRanges,c=n.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Xa.Opaque:t.materialOpaque.submitDraw(this,s,a,o);break;case Xa.Transparent:t.materialTransparent.submitDraw(this,s,a,o);break;case Xa.OpaqueAndTransparent:t.materialOpaque.submitDraw(this,s,a,o),t.materialTransparent.submitDraw(this,s,a,o);break;case Xa.IntegratedMesh:t.materialIntegratedMesh.submitDraw(this,s,a,o),hmt(i)&&t.highlightIntegratedMesh.submitDraw(this,s,a,o)}const h=this.componentParameters.castShadows!==Wn.None;h&&t.shadowMap.submitDraw(this,s,a,o),w(l)&&(t.highlight.submitDraw(this,s,l,o),h&&t.highlightShadowMap.submitDraw(this,s,l,o)),h&&w(c)&&t.defaultShadowMap.submitDraw(this,s,c,o)}get attributeLocations(){return H2e}_computeWhichMaterialPass(){return this.isIntegratedMesh?Xa.IntegratedMesh:this.objectOpacity<1?Xa.Transparent:this.componentParameters.opaqueOverride===Wn.All?Xa.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Mr.Blend||this.alphaDiscardMode===Mr.MaskBlend?Xa.Transparent:this.componentParameters.transparent===Wn.None?Xa.Opaque:this.componentParameters.transparent===Wn.All?Xa.Transparent:Xa.OpaqueAndTransparent}}var Uce,Xa,Wn;u([ms({vectorOps:Sde})],ro.prototype,"baseColor",void 0),u([ms()],ro.prototype,"usePBR",void 0),u([ms()],ro.prototype,"hasParametersFromSource",void 0),u([ms({vectorOps:KK})],ro.prototype,"mrrFactors",void 0),u([ms({vectorOps:KK})],ro.prototype,"emissiveFactor",void 0),u([ms({dispose:!0})],ro.prototype,"baseColorTexture",void 0),u([ms({dispose:!0})],ro.prototype,"metallicRoughnessTexture",void 0),u([ms({dispose:!0})],ro.prototype,"emissionTexture",void 0),u([ms({dispose:!0})],ro.prototype,"occlusionTexture",void 0),u([ms({dispose:!0})],ro.prototype,"normalTexture",void 0),u([ms()],ro.prototype,"objectOpacity",void 0),u([Fce()],ro.prototype,"commonMaterialParameters",void 0),u([Fce()],ro.prototype,"componentParameters",void 0),u([ms()],ro.prototype,"textureAlphaCutoff",void 0),u([ms()],ro.prototype,"alphaDiscardMode",void 0),u([ms()],ro.prototype,"isIntegratedMesh",void 0),u([ms()],ro.prototype,"polygonOffsetEnabled",void 0),u([ms()],ro.prototype,"ellipsoidMode",void 0),u([ms()],ro.prototype,"hasOccludees",void 0),function(e){e[e.VERTEX=0]="VERTEX",e[e.GROUND=1]="GROUND",e[e.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(Uce||(Uce={})),function(e){e[e.Opaque=0]="Opaque",e[e.Transparent=1]="Transparent",e[e.OpaqueAndTransparent=2]="OpaqueAndTransparent",e[e.IntegratedMesh=3]="IntegratedMesh"}(Xa||(Xa={}));class JF extends yK{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Ir.Back,this.hasSlicePlane=!0}}u([ms()],JF.prototype,"doubleSided",void 0),u([ms()],JF.prototype,"cullFace",void 0),u([ms()],JF.prototype,"hasSlicePlane",void 0);class iP extends yK{constructor(){super(...arguments),this.externalColor=Td(1,1,1,1),this.externalColorMixMode=Hs.Multiply,this.castShadows=Wn.All}get transparent(){return this.externalColor[3]<1?Wn.All:Wn.None}get opaqueOverride(){return this.externalColorMixMode===Hs.Replace&&this.externalColor[3]===1?Wn.All:Wn.None}get visible(){return this.externalColor[3]>0?Wn.All:Wn.None}get type(){return Vp.Uniform}}u([ms({vectorOps:Sde})],iP.prototype,"externalColor",void 0),u([ms()],iP.prototype,"externalColorMixMode",void 0),u([ms()],iP.prototype,"castShadows",void 0),function(e){e[e.All=0]="All",e[e.Some=1]="Some",e[e.None=2]="None"}(Wn||(Wn={}));class aM extends yK{constructor(){super(...arguments),this.texture=null,this.transparent=Wn.None,this.opaqueOverride=Wn.None,this.castShadows=Wn.None}get type(){return Vp.Varying}}function umt(e){switch(e){case Ro.Color:return ue.Color;case Ro.Alpha:return ue.Alpha;case Ro.Depth:return ue.Depth;case Ro.Normal:return ue.Normal}}function hmt(e){return e.overlays.length!==0&&w(e.overlays[ns.INNER].getValidTexture(Gs.Highlight))}function dmt(e){return e.overlays.length!==0&&w(e.overlays[ns.INNER].getColorTextureNoRasterImage())}u([ms()],aM.prototype,"texture",void 0),u([ms()],aM.prototype,"transparent",void 0),u([ms()],aM.prototype,"opaqueOverride",void 0),u([ms()],aM.prototype,"castShadows",void 0);const O3=As().vec3f(D.POSITION).u16(D.COMPONENTINDEX).u16(D.U16PADDING),q2e=As().vec2u8(D.SIDENESS),zce=Yc(q2e),W2e=As().vec3f(D.POSITION0).vec3f(D.POSITION1).u16(D.COMPONENTINDEX).u8(D.VARIANTOFFSET,{glNormalized:!0}).u8(D.VARIANTSTROKE).u8(D.VARIANTEXTENSION,{glNormalized:!0}).u8(D.U8PADDING,{glPadding:!0}).u16(D.U16PADDING,{glPadding:!0}),zW=W2e.clone().vec3f(D.NORMAL),BW=W2e.clone().vec3f(D.NORMALA).vec3f(D.NORMALB),VW=new Map([[D.POSITION0,0],[D.POSITION1,1],[D.COMPONENTINDEX,2],[D.VARIANTOFFSET,3],[D.VARIANTSTROKE,4],[D.VARIANTEXTENSION,5],[D.NORMAL,6],[D.NORMALA,6],[D.NORMALB,7],[D.SIDENESS,8]]);function Bce(e,t,i){const r=t/3,s=new Uint32Array(i+1),n=new Uint32Array(i+1),o=(T,O)=>{T<O?s[T+1]++:n[O+1]++};for(let T=0;T<r;T++){const O=e[3*T],C=e[3*T+1],M=e[3*T+2];o(O,C),o(C,M),o(M,O)}let a=0,l=0;for(let T=0;T<i;T++){const O=s[T+1],C=n[T+1];s[T+1]=a,n[T+1]=l,a+=O,l+=C}const c=new Uint32Array(6*r),h=s[i],p=(T,O,C)=>{if(T<O){const M=s[T+1]++;c[2*M]=O,c[2*M+1]=C}else{const M=n[O+1]++;c[2*h+2*M]=T,c[2*h+2*M+1]=C}};for(let T=0;T<r;T++){const O=e[3*T],C=e[3*T+1],M=e[3*T+2];p(O,C,T),p(C,M,T),p(M,O,T)}const m=(T,O)=>{const C=2*T,M=O-T;for(let I=1;I<M;I++){const $=c[C+2*I],U=c[C+2*I+1];let q=I-1;for(;q>=0&&c[C+2*q]>$;q--)c[C+2*q+2]=c[C+2*q],c[C+2*q+3]=c[C+2*q+1];c[C+2*q+2]=$,c[C+2*q+3]=U}};for(let T=0;T<i;T++)m(s[T],s[T+1]),m(h+n[T],h+n[T+1]);const g=new Int32Array(3*r),v=(T,O)=>T===e[3*O]?0:T===e[3*O+1]?1:T===e[3*O+2]?2:-1,b=(T,O)=>{const C=v(T,O);g[3*O+C]=-1},S=(T,O,C,M)=>{const I=v(T,O);g[3*O+I]=M;const $=v(C,M);g[3*M+$]=O};for(let T=0;T<i;T++){let O=s[T];const C=s[T+1];let M=n[T];const I=n[T+1];for(;O<C&&M<I;){const $=c[2*O],U=c[2*h+2*M];$===U?(S(T,c[2*O+1],U,c[2*h+2*M+1]),O++,M++):$<U?(b(T,c[2*O+1]),O++):(b(U,c[2*h+2*M+1]),M++)}for(;O<C;)b(T,c[2*O+1]),O++;for(;M<I;)b(c[2*h+2*M],c[2*h+2*M+1]),M++}return g}function gk(e,t){return t.push(e.buffer),{buffer:e.buffer,layout:pmt(e.layout)}}function ZD(e){return fmt(e.layout).createView(e.buffer)}function pmt(e){const t=new Array;return e.fields.forEach((i,r)=>{const s={...i,constructor:Z2e(i.constructor)};t.push([r,s])}),{stride:e.stride,fields:t,fieldNames:e.fieldNames}}function fmt(e){const t=As();return t.stride=e.stride,t.fieldNames=e.fieldNames,e.fields.forEach(i=>t.fields.set(i[0],{...i[1],constructor:gmt(i[1].constructor)})),t}const mmt=[cI,bd,hr,fo,Jp,hC,dC,pC,Ws,Gx,o1,a1,Qy,jx,l1,tc,Hx,fC,qx,c1,Wx,mC,WP,ZP,gC,Zx,XP,YP,QP,Xx,JP,KP,e3,t3,i3,r3];function Z2e(e){return`${e.ElementType}_${e.ElementCount}`}function gmt(e){return X2e.get(e)}const X2e=new Map;mmt.forEach(e=>X2e.set(Z2e(e),e));class Y2e{updateSettings(t){this.settings=t,this.edgeHashFunction=t.reducedPrecision?_mt:ymt}write(t,i,r){const s=this.edgeHashFunction(r);YD.seed=s;const n=YD.getIntRange(0,255),o=YD.getIntRange(0,this.settings.variants-1),a=.7,l=YD.getFloat(),c=255*(.5*vmt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex),t.variantOffset.set(i,n),t.variantStroke.set(i,o),t.variantExtension.set(i,c)}trim(t,i){return t.slice(0,i)}}const _K=new Float32Array(6),yk=new Uint32Array(_K.buffer),Nv=new Uint32Array(1);function ymt(e){const t=_K;t[0]=e.position0[0],t[1]=e.position0[1],t[2]=e.position0[2],t[3]=e.position1[0],t[4]=e.position1[1],t[5]=e.position1[2],Nv[0]=5381;for(let i=0;i<yk.length;i++)Nv[0]=31*Nv[0]+yk[i];return Nv[0]}function _mt(e){const t=_K;t[0]=DS(e.position0[0]),t[1]=DS(e.position0[1]),t[2]=DS(e.position0[2]),t[3]=DS(e.position1[0]),t[4]=DS(e.position1[1]),t[5]=DS(e.position1[2]),Nv[0]=5381;for(let i=0;i<yk.length;i++)Nv[0]=31*Nv[0]+yk[i];return Nv[0]}const Vce=1e4;function DS(e){return Math.round(e*Vce)/Vce}function vmt(e,t){const i=e<0?-1:1;return Math.abs(e)**t*i}class _k{constructor(){this.commonWriter=new Y2e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return zW.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),Oe(XD,r.faceNormal0,r.faceNormal1),De(XD,XD),t.normal.setVec(i,XD)}trim(t,i){return this.commonWriter.trim(t,i)}}_k.Layout=zW,_k.glLayout=Yc(zW,1);class vk{constructor(){this.commonWriter=new Y2e}updateSettings(t){this.commonWriter.updateSettings(t)}allocate(t){return BW.createBuffer(t)}write(t,i,r){this.commonWriter.write(t,i,r),t.normalA.setVec(i,r.faceNormal0),t.normalB.setVec(i,r.faceNormal1)}trim(t,i){return this.commonWriter.trim(t,i)}}vk.Layout=BW,vk.glLayout=Yc(BW,1);const XD=F(),YD=new Jh,gw=-1;var bk;function GW(e,t,i,r=Emt){const s=e.vertices.position,n=e.vertices.componentIndex,o=Jt(r.anglePlanar),a=Jt(r.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),h=jW.edge,p=h.position0,m=h.position1,g=h.faceNormal0,v=h.faceNormal1,b=Smt(e),S=Tmt(e),T=S.length/4,O=t.allocate(T);let C=0;const M=T,I=i.allocate(M);let $=0,U=0,q=0;const G=aCe(0,T),Y=new Float32Array(T);uCe(Y,(ye,pe,z)=>{s.getVec(S[4*pe+0],p),s.getVec(S[4*pe+1],m),z[pe]=Pr(p,m)}),G.sort((ye,pe)=>Y[pe]-Y[ye]);const J=new Array,X=new Array;for(let ye=0;ye<T;ye++){const pe=G[ye],z=Y[pe],j=S[4*pe+0],Q=S[4*pe+1],Z=S[4*pe+2],ie=S[4*pe+3],le=ie===gw;if(s.getVec(j,p),s.getVec(Q,m),le)fe(g,b[3*Z+0],b[3*Z+1],b[3*Z+2]),ve(v,g),h.componentIndex=n.get(j),h.cosAngle=ke(g,v);else{if(fe(g,b[3*Z+0],b[3*Z+1],b[3*Z+2]),fe(v,b[3*ie+0],b[3*ie+1],b[3*ie+2]),h.componentIndex=n.get(j),h.cosAngle=ke(g,v),wmt(h,c))continue;h.cosAngle<-.9999&&ve(v,g)}U+=z,q++,le||bmt(h,l)?(t.write(O,C++,h),J.push(z)):xmt(h,o)&&(i.write(I,$++,h),X.push(z))}const ne=new Float32Array(J.reverse()),re=new Float32Array(X.reverse());return{regular:{instancesData:t.trim(O,C),lodInfo:{lengths:ne}},silhouette:{instancesData:i.trim(I,$),lodInfo:{lengths:re}},averageEdgeLength:U/q}}function bmt(e,t){return e.cosAngle<t}function wmt(e,t){return e.cosAngle>t}function xmt(e,t){const i=Fn(e.cosAngle),r=jW.fwd,s=jW.ortho;return t0(r,e.position1,e.position0),i*(ke(St(s,e.faceNormal0,e.faceNormal1),r)>0?-1:1)>t}function Tmt(e){const t=e.faces.length/3,i=e.faces,r=e.neighbors;let s=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],m=i[3*a+1],g=i[3*a+2];s+=l===gw||p<m?1:0,s+=c===gw||m<g?1:0,s+=h===gw||g<p?1:0}const n=new Int32Array(4*s);let o=0;for(let a=0;a<t;a++){const l=r[3*a+0],c=r[3*a+1],h=r[3*a+2],p=i[3*a+0],m=i[3*a+1],g=i[3*a+2];(l===gw||p<m)&&(n[o++]=p,n[o++]=m,n[o++]=a,n[o++]=l),(c===gw||m<g)&&(n[o++]=m,n[o++]=g,n[o++]=a,n[o++]=c),(h===gw||g<p)&&(n[o++]=g,n[o++]=p,n[o++]=a,n[o++]=h)}return n}function Smt(e){const t=e.faces.length/3,i=e.vertices.position,r=e.faces,s=$9.v0,n=$9.v1,o=$9.v2,a=new Float32Array(3*t);for(let l=0;l<t;l++){const c=r[3*l+0],h=r[3*l+1],p=r[3*l+2];i.getVec(c,s),i.getVec(h,n),i.getVec(p,o),Me(n,n,s),Me(o,o,s),St(s,n,o),De(s,s),a[3*l+0]=s[0],a[3*l+1]=s[1],a[3*l+2]=s[2]}return a}(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH"})(bk||(bk={}));const jW={edge:{position0:F(),position1:F(),faceNormal0:F(),faceNormal1:F(),componentIndex:0,cosAngle:0},ortho:F(),fwd:F()},$9={v0:F(),v1:F(),v2:F()},Emt={anglePlanar:4,angleSignificantEdge:35};class Q2e{async extract(t){const i=D9(t),r=vK(i),s=[i.data.buffer];return{result:Cmt(r,s),transferList:s}}async extractComponentsEdgeLocations(t){const i=D9(t),r=HW(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=GW(r,Mmt,Hce),n=[];return{result:gk(s.regular.instancesData,n),transferList:n}}async extractEdgeLocations(t){const i=D9(t),r=HW(i.data,i.skipDeduplicate,i.indices,i.indicesLength),s=GW(r,Rmt,Hce),n=[];return{result:gk(s.regular.instancesData,n),transferList:n}}}function vK(e){const t=HW(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return Gce.updateSettings(e.writerSettings),jce.updateSettings(e.writerSettings),GW(t,Gce,jce)}function D9(e){return{data:O3.createView(e.dataBuffer),indices:e.indicesType==="Uint32Array"?new Uint32Array(e.indicesBuffer):e.indicesType==="Uint16Array"?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function Cmt(e,t){return t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:gk(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:gk(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function HW(e,t,i,r){if(t)return{faces:i,facesLength:r,neighbors:Bce(i,r,e.count),vertices:e};const s=Bxe(e.buffer,e.stride/4,{originalIndices:i,originalIndicesLength:r}),n=Bce(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:n,vertices:O3.createView(s.buffer)}}const Gce=new _k,jce=new vk;class Amt{allocate(t){return J2e.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1)}}class Omt{allocate(t){return bK.createBuffer(t)}trim(t,i){return t.slice(0,i)}write(t,i,r){t.position0.setVec(i,r.position0),t.position1.setVec(i,r.position1),t.componentIndex.set(i,r.componentIndex)}}const Rmt=new Amt,Mmt=new Omt,Hce={allocate:()=>null,write:()=>{},trim:()=>null},J2e=As().vec3f(D.POSITION0).vec3f(D.POSITION1),bK=As().vec3f(D.POSITION0).vec3f(D.POSITION1).u16(D.COMPONENTINDEX).u16(D.U16PADDING,{glPadding:!0});function Pmt(){return new Q2e}const Imt=Object.freeze(Object.defineProperty({__proto__:null,EdgeProcessingWorker:Q2e,default:Pmt,extract:vK,extractComponentsEdgeLocationsLayout:bK,extractEdgeLocationsLayout:J2e},Symbol.toStringTag,{value:"Module"}));class Lmt{constructor(t){this.maxCount=t,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(t){this.recycledIndices.push(t)}}class $mt{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.textureWidth=4096,this.dirty=!0,this.texture=new bt(this.rctx,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,wrapMode:Ft.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new tc(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(t,i,r,s,n,o){const a=t*this.fieldCount+i;this.dirty=!0,this.data.set(a,0,r),this.data.set(a,1,s),this.data.set(a,2,n),this.data.set(a,3,o)}setDataElement(t,i,r,s){const n=t*this.fieldCount+i;this.dirty=!0,this.data.set(n,r,s)}resizeToFit(t){const i=t*this.fieldCount;if(i>=this.data.count){const r=Math.ceil((i+1)/this.textureWidth)*this.textureWidth,s=new tc(new ArrayBuffer(4*r));s.typedBuffer.set(this.data.typedBuffer),this.data=s}}updateTexture(){if(!this.dirty)return;const t=this.texture.descriptor.width,i=this.texture.descriptor.height;this.data.count>t*i&&this.texture.resize(t,this.data.count/t),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(t,i,r){t.bindTexture(i,this.texture),t.setUniform2f(r,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}const K2e=65536;class Dmt{constructor(t,i=1){this.textureBuffer=new $mt(t,i),this.indexManager=new Lmt(K2e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const t=this.indexManager.acquire();return this.textureBuffer.resizeToFit(t),t}releaseIndex(t){this.indexManager.release(t)}}class eEe{constructor(t,i=1){this.rctx=t,this.fieldCount=i,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(t=>t.activeCount!==0||(t.dispose(),!1))}destroy(){this.buffers.forEach(t=>t.dispose()),this.buffers=[]}getBuffer(t){for(const r of this.buffers)if(r.availableCount>=t)return r;if(t>K2e)return null;const i=new Dmt(this.rctx,this.fieldCount);return this.buffers.push(i),i}updateTextures(){for(const t of this.buffers)t.textureBuffer.updateTexture()}}const qce=Ie.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class Nmt{constructor(t,i){this._renderManager=t,this._viewingMode=i,this._objects=[new hi,new hi],this._renderSubmit=new Kft(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new eEe(t.rctx,2)}dispose(){At(this._objects[SE.Hidden].length===0&&this._objects[SE.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(t){const i=new kW;return i.toMapSpace=t.toMapSpace,i.transform=t.transform,i.obb=Ece(t.obb),i.components=new Dft(this._componentBufferManager,t.geometry.componentOffsets),i.renderable=this._createRenderable(t,i.components),i.intersectionGeometry=new Vft(t.geometry.positionData,i.components),this._objects[i.visible].push(i),i}destroyObject(t){const i=t;this._objects[i.visible].removeUnordered(i),i.dispose(),this._notifyDirty()}setObjectVisibility(t,i){const r=t;i!==r.visible&&(this._objects[r.visible].removeUnordered(r),this._objects[i].push(r),r.visible=i,this._notifyDirty())}preSubmit(t){const i=t.camera.eye;this.visibleObjects.forAll(r=>r.renderable.meta.cameraDepthSquared=Yn(i,r.obb.center))}getMaterial(t){return t.renderable.material}updateMaterial(t,i){const r=t.renderable.material;i(r),r.dirty&&this._notifyDirty()}setAllComponentVisibilities(t,i){const r=t;r.components.visibility.reset(i),r.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(t,i){return t.components.visibility.forEachComponent(i)}getComponentCount(t){const i=t,r=i.components.visibility.componentCount();return{visible:r,invisible:i.components.count-r}}setComponentData(t,i){const r=t,s=r.renderable.material,n=r.components,o=n.materialDataBuffer,a=n.materialDataIndices,l={castShadows:!0,pickable:!0,externalColor:XJ(),externalColorMixMode:Hs.Multiply,elevationOffset:0},c=o.textureBuffer,h=new Uint8Array(4),p=new Uint32Array(h.buffer);let m=0,g=0,v=0,b=n.verticalOffsets,S=1/0,T=-1/0,O=!1,C=!1,M=0;for(let I=0;I<n.count;I++)i(I,l),m+=+(l.externalColor[3]<1),g+=+(l.externalColorMixMode===Hs.Replace&&l.externalColor[3]===1),v+=+l.castShadows,OTe(l.externalColor,l.externalColorMixMode,h),h[2]=254&h[2]|+l.castShadows,c.setData(a[I],0,h[0],h[1],h[2],h[3]),O||(O=I>0&&M!==p[0]),M=p[0],C||(C=l.elevationOffset!==0),C&&N(b)&&(b=new Array(I).fill(0)),w(b)&&(b[I]=l.elevationOffset),S=Math.min(S,l.elevationOffset),T=Math.max(T,l.elevationOffset),j2e(l.elevationOffset,h),c.setData(a[I],1,h[0],h[1],h[2],h[3]),l.pickable!==z2e(n.pickability,I)&&(n.pickability=Fft(n.pickability,n.count,I,l.pickable));n.verticalOffsets=C?b:null,r.offsetObb=C?Cft(r.obb,S,T,this._viewingMode,w(r.offsetObb)?r.offsetObb:Ece(r.obb)):null,O||C?(s.componentParameters=new aM,s.componentParameters.castShadows=N9(v,n.count),s.componentParameters.transparent=N9(m,n.count),s.componentParameters.opaqueOverride=N9(g,n.count),s.componentParameters.texture=c,c.updateTexture()):(s.componentParameters=new iP,s.componentParameters.castShadows=l.castShadows?Wn.All:Wn.None,s.componentParameters.externalColor=l.externalColor,s.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(t,i,r,s=!1){t.intersectionGeometry.getComponentAabb(i,r);const n=t,o=n.components.verticalOffsets;if(s||N(o))return r;const a=o[i];if(this._viewingMode===st.Local||a===0)return r[2]+=a,r[5]+=a,r;const l=ZZe(a);return l.localOrigin=n.transform.position,l.applyToAabb(r)}getComponentObb(t){return t.obb}getObjectTransform(t){return t.transform}getComponentPositions(t,i,r){return t.intersectionGeometry.getComponentPositions(i,r)}intersect(t,i,r,s,n,o){const a=t;w(n)&&(n.localOrigin=a.transform.position);const l=wT(Wce,a.transform.rotationScale);Bc(QD,i,a.transform.position),Bc(JD,r,a.transform.position),$c(QD,QD,l),$c(JD,JD,l);const c=vd(Wce,l);return a.intersectionGeometry.intersect(QD,JD,s,c,n,a.components.verticalOffsets,o)}addEdges(t,i,r,s){const n=t,{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets;return i.addComponentObject(t,n.transform,{center:n.obb.center,radius:oft(n.obb)},a,o,l,r,s)}async extractEdgeInformation(t,i,r){const s=t,n=s.components.visibility;if(n.allInvisible())return{buffer:bK.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets,c=O3.createBuffer(a.count);jz(c.position,a),g1(c.position,c.position,s.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const h=c.count,p=this._computeVisibilityIndices(o,n,l,h);return{origin:un(s.transform.position),buffer:await i.extractComponentsEdgeLocations({indices:p,indicesLength:p.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},r)}}_setComponentIndices(t,i,r){let s=0;for(let n=0;n<r.length-1;n++){const o=r[n],a=r[n+1];for(let l=o;l<a;l++){const c=i?i[l]:l;t.set(c,s)}s++}}_computeVisibilityIndices(t,i,r,s){if(t&&i.allVisible())return t;let n=0;i.forEachComponentRange((l,c)=>(n+=r[c]-r[l],!0));const o=(t==null?void 0:t.BYTES_PER_ELEMENT)===2||s<=65536?new Uint16Array(n):new Uint32Array(n);let a=0;return i.forEachComponentRange((l,c)=>{const h=r[l],p=r[c];for(let m=h;m<p;m++)o[a++]=t?t[m]:m;return!0}),o}addComponentHighlight(t,i){const r=t.components;N(r.highlightCounts)&&(r.highlightCounts=new Uint32Array(r.count+1)),r.highlightCounts[i]++===0&&(r.highlightsDirty(),this._notifyDirty()),r.highlightCounts[r.count]++}removeComponentHighlight(t,i){const r=t.components;if(N(r.highlightCounts))return void qce.warn("Removing non-existing highlight.");const s=r.highlightCounts[i],n=r.highlightCounts[r.count];if(s!==0){if(s>1)return r.highlightCounts[i]=s-1,void(r.highlightCounts[r.count]=n-1);r.highlightCounts[i]=0,r.highlightsDirty(),this._notifyDirty(),n===1?r.highlightCounts=null:r.highlightCounts[r.count]=n-1}else qce.warn("Removing non-existing highlight.")}clearHighlights(t){const i=t.components;w(i.highlightCounts)&&(i.highlightCounts=null,i.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(t){return t.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[SE.Visible]}_createRenderable(t,i){const r=this._renderManager.rctx,s=t.geometry,n=s.vertices.layoutParameters,o=Ai.createVertex(r,Gi.STATIC_DRAW,s.vertices.data),a=Cn(s.indices,b=>Ai.createIndex(r,Gi.STATIC_DRAW,b)),l=Yc(emt(n)),c=new Uint16Array(s.vertices.count);for(let b=0;b<i.count;b++){const S=i.offsets[b],T=i.offsets[b+1],O=i.materialDataIndices[b];if(w(s.indices))for(let C=S;C<T;C++)c[s.indices[C]]=O;else for(let C=S;C<T;C++)c[C]=O}const h=Ai.createVertex(r,Gi.STATIC_DRAW,c.buffer),p=new ro(t.transform,t.toMapSpace),m=new pn(r,p.attributeLocations,{data:l,componentIndices:Fmt},{data:o,componentIndices:h},a),g=new V2e(m,Yt.TRIANGLES,n,w(a)),v={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteSize+h.byteSize+(w(a)?a.byteSize:0)};return new Hft(p,g,v)}_notifyDirty(){this._renderManager.notifyDirty()}}const Fmt=Yc(As().u16(D.COMPONENTINDEX));function N9(e,t){return e===t?Wn.All:e===0?Wn.None:Wn.Some}const Wce=Dy(),QD=F(),JD=F();class tEe extends mn{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function kmt(e){const t=new dr;t.include(E1);const i=t.fragment;switch(e.function){case Lc.Standard:i.uniforms.add(new ai("tex",r=>r.texture)),e.hasOpacityFactor?(i.uniforms.add(new lt("opacity",r=>r.opacity)),i.code.add(E`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):i.code.add(E`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case Lc.OverlayWithTransparency:i.uniforms.add(new ai("tex",r=>r.texture)),i.uniforms.add(new SI("overlayIdx",r=>r.overlayIndex)),e.hasOpacityFactor&&i.uniforms.add(new lt("opacity",r=>r.opacity)),i.code.add(E`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${e.hasOpacityFactor?"* opacity":""};
        }`);break;case Lc.TransparentToHUDVisibility:i.uniforms.add(new ai("tex",r=>r.texture)),i.code.add(E`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case Lc.Transparency:i.uniforms.add([new ai("colorTexture",r=>r.colorTexture),new ai("alphaTexture",r=>r.alphaTexture),new ai("frontFaceTexture",r=>r.frontFaceTexture)]),i.code.add(E`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case Lc.COUNT:break;default:e.function}return t}const Umt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:tEe,build:kmt},Symbol.toStringTag,{value:"Module"}));class R3 extends $r{initializeProgram(t){const i=R3.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){if(this.configuration.function===Lc.TransparentToHUDVisibility)return ni({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case ra.None:return ni({colorWrite:wi});case ra.Alpha:return ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),colorWrite:wi});default:return ni({blending:qm(je.ONE,je.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}}}R3.shader=new Tr(Umt,()=>_e(()=>import("./Compositing.glsl.cc72c310.js"),[],import.meta.url));class zmt{constructor(t,i){this._rctx=t,this._techniqueRepository=i,this._configuration=new IF,this._passParameters=new tEe}dispose(){this._vao=ht(this._vao)}compositeTransparent(t,i,r,s,n=1){this._configuration.alphaMode=ra.Alpha,this._configuration.function=Lc.Transparency,this._configuration.hasOpacityFactor=n!==1,this._passParameters.colorTexture=i,this._passParameters.alphaTexture=r,this._passParameters.frontFaceTexture=s;const o=this._rctx,a=this._techniqueRepository.acquire(R3,this._configuration);o.bindTechnique(a,this._passParameters,t);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Yt.TRIANGLE_STRIP,0,na(l,"geometry")),a.release()}composite(t,i,r=ra.None,s=1,n=Lc.Standard,o=ns.INNER){const a=this._rctx;this._configuration.alphaMode=r,this._configuration.function=n,this._configuration.hasOpacityFactor=s!==1,this._passParameters.overlayIndex=o,this._passParameters.texture=i,this._passParameters.opacity=s;const l=this._techniqueRepository.acquire(R3,this._configuration);a.bindTechnique(l,this._passParameters,t);const c=this._ensureVAO();a.bindVAO(c),a.drawArrays(Yt.TRIANGLE_STRIP,0,na(c,"geometry")),l.release()}_ensureVAO(){return N(this._vao)&&(this._vao=fl(this._rctx)),this._vao}}const Bmt=1e4,qW=100,Vmt=500,Gmt=500,jmt=.1;function Hmt(e,t,i){return hJ(t,e)*(i[1]-i[0])+i[0]}function qmt(e,t,i){if(t.size<Bmt)return egt.compute(e,t);const r=RI();return i.forAll(s=>{s.isVisible&&LC(r,Wmt(e,s))}),r}function Wmt(e,t){if(!t.isVisible)return;const i=RI(),r=t.getSpatialQueryAccelerator();return w(r)?Zmt(i,e,r):Xmt(i,e,t.objects),i}function Zmt(e,t,i){const r=t.eye,s=t.viewForward,n=t.frustum,o=l=>l.isVisible,a=i.objectCount;if(a<Vmt)A3(Xh,t.near,Math.min(e.near,t.far)),i.forEachInDepthRange(r,s,$p.DepthOrder.FRONT_TO_BACK,Xh,(l,c)=>{WW(e,t,l),Xh.far=e.near,c.setRange(Xh)},n,o),A3(Xh,Math.max(e.far,t.near),t.far),i.forEachInDepthRange(r,s,$p.DepthOrder.BACK_TO_FRONT,Xh,(l,c)=>{WW(e,t,l),Xh.near=e.far,c.setRange(Xh)},n,o);else{const l=Math.max(Math.min(a,Gmt),Math.ceil(a*jmt)),c=i.findClosest(s,$p.DepthOrder.FRONT_TO_BACK,n,o,l),h=i.findClosest(s,$p.DepthOrder.BACK_TO_FRONT,n,o,l);c&&h&&(Zce(e,t,c.boundingVolumeWorldSpace.bounds),Zce(e,t,h.boundingVolumeWorldSpace.bounds))}}function Xmt(e,t,i){NS.clear(),i.forAll(r=>{r.isVisible&&r.geometryRecords.length!==0&&NS.add(r)}),NS.empty||(NS.sort(t),A3(Xh,t.near,Math.min(e.near,t.far)),NS.forEachInDepthRange(Xh,$p.DepthOrder.FRONT_TO_BACK,(r,s)=>{s<e.near&&WW(e,t,r)}),A3(Xh,Math.max(e.far,t.near),t.far),NS.forEachInDepthRange(Xh,$p.DepthOrder.BACK_TO_FRONT,(r,s,n)=>{e.far=Math.max(e.far,n)}))}function WW(e,t,i){if(!i.isVisible||!Pv(t.frustum,i.boundingVolumeWorldSpace.bounds))return;const r=i.transformation,s=Kmt;i.geometryRecords.forEach(n=>{hs(s,r,n.getShaderTransformation());const o=Dx(s);iEe(e,t,n.geometry.boundingInfo,s,o)})}function iEe(e,t,i,r,s){if(N(i))return;const n=t.eye,o=t.viewForward;et(ea,i.center,r);const a=o[0]*(ea[0]-n[0])+o[1]*(ea[1]-n[1])+o[2]*(ea[2]-n[2]);if(ea[3]=i.radius*s,!(a-ea[3]>e.near&&a+ea[3]<e.far)&&Pv(t.frustum,ea))if(i.radius>qW&&i.getChildren()){const l=i.getChildren();for(let c=0;c<8;++c)l[c]&&iEe(e,t,l[c],r,s)}else ZW.unionDepthRangeWithAABB(e,t.viewProjectionMatrix,r,i.bbMin,i.bbMax)}function Zce(e,t,i){const r=t.eye,s=t.viewForward,n=(i[0]-r[0])*s[0]+(i[1]-r[1])*s[1]+(i[2]-r[2])*s[2];e.near=Math.min(e.near,n-i[3]),e.far=Math.max(e.far,n+i[3])}class Ymt{constructor(){this._items=new hi({allocator:t=>t||{obj:null,distance:0,near:0,far:0},deallocator:t=>(t.obj=null,t.distance=0,t.near=0,t.far=0,t)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(t){this._items.pushNew().obj=t}sort(t){const i=t.eye,r=t.viewForward;this._items.forAll(s=>{const n=s.obj.boundingVolumeWorldSpace.bounds,o=(n[0]-i[0])*r[0]+(n[1]-i[1])*r[1]+(n[2]-i[2])*r[2];s.distance=o,s.near=o-n[3],s.far=o+n[3]}),this._items.sort((s,n)=>s.distance-n.distance)}forEachInDepthRange(t,i,r){if(i===$p.DepthOrder.FRONT_TO_BACK)for(let s=0;s<this._items.length;++s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}else for(let s=this._items.length-1;s>=0;--s){const n=this._items.data[s];n.far<t.near||n.near>t.far||r(n.obj,n.near,n.far)}}}class Qmt{constructor(){this.view=Be(),this.viewProj=Be(),this.frustum=o3(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(t,i){this._reset(),js(this.view,t.viewMatrix),hs(this.viewProj,t.projectionMatrix,this.view),R5(this.frustum,t.frustum);const r=this.view,s=r[2],n=r[6],o=r[10],a=r[14],l=this.range;let c=0;if(i.forEach(g=>{if(!g.instanceParameters.visible||!g.castShadow)return;let v;g.hasShaderTransformation?(g.computeBoundingSphere(g.getShaderTransformation(),ea,1),v=ea):v=g.boundingSphere;const b=s*v[0]+n*v[1]+o*v[2]+a,S=b-v[3],T=b+v[3];this.geometries[c]=g,this.near[c]=-T,this.far[c]=-S,++c}),this.geometries.length===0)return l;for(let g=0;g<this.geometries.length;++g)this.near[g]>l.far&&(l.far=this.near[g]),this.near[g]>2&&this.far[g]<l.near&&(l.near=this.far[g]);const h=this.looseRange;h.near=Math.max(.5*l.near,2),h.far=2*l.far;let p=0,m=0;for(let g=0;g<this.geometries.length;++g)this.near[g]<l.near&&(this.near[g]>=h.near?l.near=this.near[g]:this.nearCandidates[p++]=g),this.far[g]>l.far&&(this.far[g]<=h.far?l.far=this.far[g]:this.farCandidates[m++]=g);if(this.nearCandidates.length===0&&this.farCandidates.length===0)return l;this.nearCandidates.sort((g,v)=>this.near[g]<this.near[v]?-1:this.near[g]>this.near[v]?1:0),this.farCandidates.sort((g,v)=>this.far[g]<this.far[v]?1:this.far[g]>this.far[v]?-1:0);for(let g=0;g<this.nearCandidates.length;++g){const v=this.nearCandidates[g];if(this.near[v]<l.near){const b=this.geometries[v],S=b.boundingInfo;this._includeNearBoundingInfoRec(S,b.getShaderTransformation())}}for(let g=0;g<this.farCandidates.length;++g){const v=this.farCandidates[g];if(this.far[v]>l.far){const b=this.geometries[v],S=b.boundingInfo;this._includeFarBoundingInfoRec(S,b.getShaderTransformation())}}return l}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(t,i){if(N(t))return;const r=t.getCenter();et(ea,r,i);const s=Dx(i),n=ea[0],o=ea[1],a=ea[2],l=t.getBSRadius()*s,c=this.frustum;if(c[0][0]*n+c[0][1]*o+c[0][2]*a+c[0][3]>l||c[1][0]*n+c[1][1]*o+c[1][2]*a+c[1][3]>l||c[2][0]*n+c[2][1]*o+c[2][2]*a+c[2][3]>l||c[3][0]*n+c[3][1]*o+c[3][2]*a+c[3][3]>l)return;const h=this.view[2]*n+this.view[6]*o+this.view[10]*a+this.view[14],p=h+l;if(!(-(h-l)<2||-p>=this.range.near))if(-p>this.looseRange.near)this.range.near=-p;else{if(l>qW){const m=t.getChildren();if(m!==void 0){for(let g=0;g<8;++g)m[g]!==void 0&&this._includeNearBoundingInfoRec(m[g],i);return}}ZW.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}_includeFarBoundingInfoRec(t,i){if(N(t))return;let r=t.getBSRadius();const s=t.getCenter();et(ea,s,i);const n=Dx(i),o=ea[0],a=ea[1],l=ea[2];r*=n;const c=this.frustum;if(c[0][0]*o+c[0][1]*a+c[0][2]*l+c[0][3]>r||c[1][0]*o+c[1][1]*a+c[1][2]*l+c[1][3]>r||c[2][0]*o+c[2][1]*a+c[2][2]*l+c[2][3]>r||c[3][0]*o+c[3][1]*a+c[3][2]*l+c[3][3]>r)return;const h=this.view[2]*o+this.view[6]*a+this.view[10]*l+this.view[14]-r;if(!(-h<=this.range.far))if(-h<this.looseRange.far)this.range.far=-h;else{if(r>qW){const p=t.getChildren();if(p!==void 0){for(let m=0;m<8;++m)p[m]!==void 0&&this._includeFarBoundingInfoRec(p[m],i);return}}ZW.unionDepthRangeWithAABB(this.range,this.viewProj,i,t.getBBMin(),t.getBBMax())}}}class Jmt{constructor(){this.modelViewProj=Be(),this.clipPosition=[di(),di(),di(),di(),di(),di(),di(),di()]}unionDepthRangeWithAABB(t,i,r,s,n){const o=this.modelViewProj;hs(o,i,r);let a=!1;for(let l=0;l<8;++l){const c=this.clipPosition[l],h=l===0||l===3||l===4||l===7?s[0]:n[0],p=l===0||l===1||l===4||l===5?s[1]:n[1],m=l<4?s[2]:n[2];c[0]=o[0]*h+o[4]*p+o[8]*m+o[12],c[1]=o[1]*h+o[5]*p+o[9]*m+o[13],c[2]=o[2]*h+o[6]*p+o[10]*m+o[14],c[3]=o[3]*h+o[7]*p+o[11]*m+o[15]}for(let l=0;l<12;++l){const c=this.clipPosition[F9[l][0]],h=this.clipPosition[F9[l][1]],p=this.clipPosition[F9[l][2]],m=this._clipTriangle(c,h,p);let g=!0;for(let v=0;v<m.length;++v)if(m[v][3]>=2){g=!1;break}if(!g){a=!0;for(let v=0;v<m.length;++v){const b=m[v][3];b<t.near&&(t.near=b),b>t.far&&(t.far=b)}}}return a}_inside(t,i){return i===0?t[0]>=-t[3]:i===1?t[1]>=-t[3]:i===2?t[0]<=t[3]:i===3?t[1]<=t[3]:void At(!1)}_intersect(t,i,r){let s=0;return r===0?s=(-t[3]-t[0])/(i[0]-t[0]+i[3]-t[3]):r===1?s=(-t[3]-t[1])/(i[1]-t[1]+i[3]-t[3]):r===2?s=(t[3]-t[0])/(i[0]-t[0]-i[3]+t[3]):r===3&&(s=(t[3]-t[1])/(i[1]-t[1]-i[3]+t[3])),Fk(di(),t,i,s)}_clipTriangle(t,i,r){let s=[t,i,r];for(let n=0;n<4;++n){const o=s;s=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,n)?(this._inside(l,n)||s.push(this._intersect(l,c,n)),s.push(c)):this._inside(l,n)&&s.push(this._intersect(l,c,n))}}return s}}const F9=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],ea=Qn(),Kmt=Be(),Xh=RI(),NS=new Ymt,egt=new Qmt,ZW=new Jmt;class tgt extends mn{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function igt(){const e=new dr;return e.attributes.add(D.POSITION,"vec2"),e.vertex.uniforms.add(new nl("drawPosition")),e.varyings.add("vUV","vec2"),e.vertex.code.add(E`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),e.fragment.uniforms.add(new as("textureInput")),e.fragment.uniforms.add(new as("textureMask")),e.fragment.uniforms.add(new as("textureOverlay")),e.fragment.uniforms.add(new Vx("maskEnabled",t=>t.maskEnabled)),e.fragment.uniforms.add(new Vx("overlayEnabled",t=>t.overlayEnabled)),e.fragment.code.add(E`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),e}async function rgt(e){const t=_e(()=>import("./mask-svg.d736db49.js"),[],import.meta.url),i=_e(()=>import("./overlay-svg.ddc1dd43.js"),[],import.meta.url),r=Qp((await t).default,{signal:e}),s=Qp((await i).default,{signal:e}),n={mask:await r,overlay:await s};return Ui(e),n}let E2=class extends ze{constructor(){super(...arguments),this._handles=new xi,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new tgt,this.events=new ks,this.attributeLocations=new Map([[D.POSITION,0]]),this.tmpScreenPoint=ys(),this.tmpRenderPoint=RMe()}get updating(){return N(this._imageSources)&&w(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const t=()=>{this._updateResourceLoading(),this.events.emit("request-render")};w(this._magnifier)&&this._handles.add(xe(()=>Cn(this._magnifier,i=>i.version),t)),t()}get enabled(){return w(this._validMagnifier)}get _validMagnifier(){return w(this._magnifier)&&this._magnifier.visible&&w(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return w(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),w(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,t){const i=this._validMagnifier;if(N(i))return;const r=t.camera.pixelRatio,s=Math.ceil(r*i.size);if(this._updateResources(e,s),N(this._resources))return;this._passParameters.maskEnabled=i.maskEnabled,this._passParameters.overlayEnabled=i.overlayEnabled;const n=this._resources.program;e.useProgram(n),n.bindPass(this._passParameters,t);const o=this._resources.textures,a=Math.ceil(1/this.factor*s);o.input.resize(a,a);const l=t.camera.fullWidth,c=t.camera.fullHeight;gy(i.position,this.tmpScreenPoint);const h=t.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),p=.5*a,m=.5*a;h[0]=Xe(h[0],p,l-p-1),h[1]=Xe(h[1],m,c-m-1);const g=Math.floor(h[0]-p),v=Math.floor(h[1]-m);n.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,g,v,a,a,0);const b=i.offset.x*r,S=i.offset.y*r,T=(h[0]+b)/l*2-1,O=(h[1]-S)/c*2-1,C=s/l*2,M=s/c*2;e.bindVAO(this._resources.vao),n.bindTexture("textureOverlay",o.overlay),n.bindTexture("textureMask",o.mask),n.setUniform4f("drawPosition",T,O,C,M),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Yt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(N(e))return;const t=e.maskUrl,i=e.overlayUrl;!w(this._imageLoadTask)||this._imageLoadTask.maskUrl===t&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),w(this._imageSources)||w(this._imageLoadTask)||(this._imageLoadTask={maskUrl:t,overlayUrl:i,task:k3(async r=>{const s=N(t)||N(i)?rgt(r):null,n=w(t)?Qp(t,{signal:r}):s.then(a=>a.mask),o=w(i)?Qp(i,{signal:r}):s.then(a=>a.overlay);this._imageSources={mask:await n,overlay:await o},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,t){if(!this.enabled)return void this._disposeResources();if(w(this._resources)){if(this._resources.textures.size!==t){const r=this._createTextureResources(e,t);if(N(r))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=r}return}const i=this._createTextureResources(e,t);N(i)||(this._resources={textures:i,program:this._createProgram(e),vao:fl(e,uQ,this.attributeLocations,0,1),pipelineState:ni({blending:qm(je.ONE,je.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:wi})})}_disposeResources(){N(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,t){if(N(this._imageSources))return null;this._imageSources.overlay.width=t,this._imageSources.overlay.height=t,this._imageSources.mask.width=t,this._imageSources.mask.height=t;const i=new bt(e,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,internalFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0,preMultiplyAlpha:!aX(this._imageSources.overlay.src)||!e.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),r=new bt(e,{target:Ot.TEXTURE_2D,pixelFormat:tt.ALPHA,internalFormat:tt.ALPHA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!0},this._imageSources.mask);return{input:new bt(e,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,internalFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR,flipped:!1}),mask:r,overlay:i,size:t}}_createProgram(e){return new Sr(e,igt(),this.attributeLocations)}};u([f()],E2.prototype,"_imageSources",void 0),u([f()],E2.prototype,"_imageLoadTask",void 0),u([f({readOnly:!0})],E2.prototype,"updating",null),E2=u([B("esri/views/3d/webgl-engine/lib/MagnifierHelper")],E2);const sgt=.5,ngt=1e3/30;var M3;(function(e){e[e.FrontToBack=0]="FrontToBack",e[e.BackToFront=1]="BackToFront"})(M3||(M3={}));class p_{constructor(t,i,r=M3.FrontToBack){this._rctx=t,this._techniqueRepository=i,this._sorting=r,this._draws=new hi({initialSize:32,allocator:s=>s||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(t,i,r,s){const n=this._draws.pushNew();n.geometry=i,n.geometryRanges=r,n.material=t,n.depthSquaredHint=s,n.indexType=i.indexed?i.vao.indexBuffer.indexType:0}dispatch(t,i){const r=this._rctx;this._previouslyBoundDraw.clear();let s=null;const n=this._draws.map(a=>a.material.prepareTechnique(this._techniqueRepository,t,i,a.geometry.parameters)),o=this._draws.length;for(let a=0;a<o;a++){const l=n[a];l===s&&l.configuration.transparencyPassType===Pt.NONE||(r.bindTechnique(l,t,i),s=l);const c=this._draws.data[a],h=c.geometry;r.bindVAO(h.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.bindDraw(c.material,i),this._previouslyBoundDraw.set(l,c.material));const p=c.geometryRanges,m=p.length;if(c.indexType!==0){const g=KF.get(c.indexType);for(let v=0;v<m;v+=2){const b=p[v],S=p[v+1];r.drawElements(h.primitiveType,S,c.indexType,b*g)}}else for(let g=0;g<m;g+=2){const v=p[g],b=p[g+1];r.drawArrays(h.primitiveType,v,b)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const t=this._sorting===M3.FrontToBack?1:-1;this._draws.sort((i,r)=>{const s=t*(i.depthSquaredHint-r.depthSquaredHint);return s!==0?s:i.geometry.vao.size-r.geometry.vao.size})}get count(){return this._draws.length}}const KF=new Map;KF.set(Ct.UNSIGNED_BYTE,1),KF.set(Ct.UNSIGNED_SHORT,2),KF.set(Ct.UNSIGNED_INT,4);class ogt{constructor(t,i){this.rctx=t,this.shaderTechniqueRepository=i,this.canRender=!0,this._materialPassParameters=new npt,this._shadowPassParameters=new opt,this._highlightPassParameters=new apt,this._systems=new Set,this._passes={materialOpaque:new p_(t,i),materialTransparent:new p_(t,i,M3.BackToFront),materialIntegratedMesh:new p_(t,i),shadowMap:new p_(t,i),highlight:new p_(t,i),highlightIntegratedMesh:new p_(t,i),highlightShadowMap:new p_(t,i),defaultShadowMap:new p_(t,i)}}register(t){this._systems.add(t)}prepareRender(t){if(this._systems.size!==0){for(const i of Object.values(this._passes))i.prepareSubmit();this._systems.forEach(i=>i.submit(this._passes,t.bindParameters));for(const i of Object.values(this._passes))i.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(t){if(this._systems.size!==0)switch(this._configure(t),t.bindParameters.slot){case Ue.OPAQUE_MATERIAL:switch(t.pass){case nt.MATERIAL:return this._materialPassParameters.subPass=Ro.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ro.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ro.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,t.bindParameters);case nt.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,t.bindParameters);case nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,t.bindParameters)}return;case Ue.TRANSPARENT_MATERIAL:switch(t.pass){case nt.MATERIAL:return this._materialPassParameters.subPass=Ro.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_ALPHA:return this._materialPassParameters.subPass=Ro.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ro.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ro.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,t.bindParameters)}return;case Ue.INTEGRATED_MESH:switch(t.pass){case nt.MATERIAL:return this._materialPassParameters.subPass=Ro.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ro.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ro.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,t.bindParameters);case nt.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,t.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[Ue.OPAQUE_MATERIAL,Ue.TRANSPARENT_MATERIAL,Ue.INTEGRATED_MESH]}initializeRenderContext(t){this._context=t}uninitializeRenderContext(){}queryDepthRange(t){const i={near:1/0,far:-1/0};return this._systems.forEach(r=>{const s=r.queryShadowCasterDepthRange(t);w(s)&&LC(i,s,i)}),i}_configure(t){const i=t.pass===nt.MATERIAL_DEPTH_SHADOWMAP_ALL||t.pass===nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||t.pass===nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:t.pass===nt.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(t,i)}_updateParameters(t,i){const r=t.bindParameters.camera,s=r.viewInverseTransposeMatrix;fe(k9,s[3],s[7],s[11]),U9.set(k9),ve(i.transformWorldFromViewTH,U9.high),ve(i.transformWorldFromViewTL,U9.low),ve(i.slicePlaneLocalOrigin,k9),_d(i.transformViewFromCameraRelativeRS,r.viewMatrix),js(i.transformProjFromView,r.projectionMatrix),i.identifier===Uu.Material&&(this._materialPassParameters.transparent=t.bindParameters.slot===Ue.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=t.bindParameters.slot===Ue.INTEGRATED_MESH,vd(Xce,i.transformViewFromCameraRelativeRS),wT(i.transformNormalViewFromGlobal,Xce))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const k9=F(),Xce=Qr(),U9=new cB,agt=8.6,lgt=.4;function cgt(){const e=new dr,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(D.POSITION,"vec2"),e.varyings.add("uv","vec2"),e.attributes.add(D.UV0,"vec2"),t.uniforms.add(new ai("coverageTex",n=>n.coverageTexture)),r.add(E`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),i.uniforms.add(new ai("tex",n=>n.blurColorTexture)),i.uniforms.add(new ai("origin",n=>n.highlightColorTexture)),i.uniforms.add(new Ci("uColor",n=>n.color)),i.uniforms.add(new Ci("haloColor",n=>n.haloColor)),i.uniforms.add(new Ci("opacities",n=>_r(ugt,n.haloOpacity,n.haloOpacityOccluded,n.fillOpacity,n.fillOpacityOccluded))),i.constants.add("outlineSize","float",agt),i.constants.add("blurSize","float",lgt),s.add(E`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),e}const ugt=di(),hgt=Object.freeze(Object.defineProperty({__proto__:null,build:cgt},Symbol.toStringTag,{value:"Module"}));class uB extends $r{initializeProgram(t){const i=uB.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),colorWrite:wi})}}uB.shader=new Tr(hgt,()=>_e(()=>import("./HighlightApply.glsl.24b9b371.js"),[],import.meta.url));class rEe extends mn{constructor(){super(...arguments),this.blurSize=yt()}}function dgt(){const e=new dr,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(D.POSITION,"vec2"),e.attributes.add(D.UV0,"vec2"),e.varyings.add("blurCoordinate","vec3"),t.uniforms.add(new ai("coverageTex",n=>n.coverageTexture)),i.uniforms.add(new yQ("blurSize",n=>n.blurSize)),r.add(E`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),i.uniforms.add(new _Q("tex",n=>n.blurInputTexture)),s.add(E`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),e}const pgt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:rEe,build:dgt},Symbol.toStringTag,{value:"Module"}));class hB extends $r{initializeProgram(t){const i=hB.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return ni({colorWrite:wi})}}hB.shader=new Tr(pgt,()=>_e(()=>import("./HighlightBlur.glsl.93ea4b44.js"),[],import.meta.url));class sEe extends mn{constructor(){super(...arguments),this.invFramebufferDim=yt()}}function fgt(){const e=new dr,{vertex:t,fragment:i}=e,r=t.code,s=i.code;return e.attributes.add(D.POSITION,"vec2"),r.add(E`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),i.uniforms.add(new _Q("tex",n=>n.inputTexture)),i.uniforms.add(new yQ("invFramebufferDim",n=>n.invFramebufferDim)),s.add(E`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),e}const mgt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:sEe,build:fgt},Symbol.toStringTag,{value:"Module"}));class dB extends $r{initializeProgram(t){const i=dB.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return ni({colorWrite:wi})}}dB.shader=new Tr(mgt,()=>_e(()=>import("./HighlightDownsample.glsl.c632f408.js"),[],import.meta.url));class Yce extends mn{constructor(){super(...arguments),this.color=Td(1,0,1,1),this.haloColor=Td(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=ki(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}const ggt=32;class ygt{constructor(t,i){this._techniqueRep=t,this._rctx=i,this.viewportToRestore=di(),this._passParameters=new Yce,this._downsampleDrawParameters=new sEe,this._blurDrawParameters=new rEe,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=fl(this._rctx);const t={colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE,width:0,height:0},i={target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:Ft.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new Xr(this._rctx,t,i),this.blur1Fbo=new Xr(this._rctx,t,i);const r=new pl;this._blurTechnique=this._techniqueRep.acquire(hB,r),this._downsampleTechnique=this._techniqueRep.acquire(dB,r),this._applyTechnique=this._techniqueRep.acquire(uB,r)}dispose(){if(this._blurTechnique=vr(this._blurTechnique),this._downsampleTechnique=vr(this._downsampleTechnique),this._applyTechnique=vr(this._applyTechnique),this._grid.coverageMipmap)for(let t=1;t<this._grid.coverageMipmap.length;t++)this._grid.coverageMipmap[t].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=ht(this.blur0Fbo),this.blur1Fbo=ht(this.blur1Fbo)}setDefaultOptions(t){this._passParameters={...new Yce,...t}}render(t,i,r){this._passParameters.highlightColorTexture=i.colorTexture,this._assertResources();const s=t.camera;Ap(this.viewportToRestore,s.fullViewport);const n=s.fullWidth,o=s.fullHeight,a=s.pixelRatio,l=Math.ceil(n/a),c=Math.ceil(o/a);this.blur0Fbo.resize(l,c),this.blur1Fbo.resize(l,c);const h=this._rctx;h.bindVAO(this.quadVAO);let p=null;this._gridUpdateResources(i,ggt),this._gridComputeMipmap(t),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,p=this._grid.vao;const m=h.bindTechnique(this._blurTechnique,this._passParameters,t);h.bindVAO(p),h.bindFramebuffer(this.blur0Fbo),h.setViewport(0,0,l,c),h.setClearColor(0,0,0,0),h.clear(br.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=i.colorTexture,Di(this._blurDrawParameters.blurSize,1/l,0),m.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,na(p,"geometry")),h.bindFramebuffer(this.blur1Fbo),h.clear(br.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,Di(this._blurDrawParameters.blurSize,0,1/c),m.bindDraw(this._blurDrawParameters,t),h.drawArrays(this._blurTechnique.primitiveType,0,na(p,"geometry")),h.bindFramebuffer(r),h.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,h.bindTechnique(this._applyTechnique,this._passParameters,t),h.drawArrays(this._applyTechnique.primitiveType,0,na(p,"geometry")),h.bindVAO(null)}_gridUpdateResources(t,i){const r=this._rctx,s=this._grid;let n=!1;if(s.coverageMipmap===null&&(s.coverageMipmap=[t],n=!0),s.viewportWidth===t.width&&s.viewportHeight===t.height||(n=!0,s.viewportWidth=t.width,s.viewportHeight=t.height),s.coverageMipmap[0]=t,s.cellPixelSize!==i&&(s.cellPixelSize=i,n=!0),n){for(let l=1;l<s.coverageMipmap.length;l++)s.coverageMipmap[l].dispose();s.mipmapLevels=Math.ceil(Math.log(s.cellPixelSize)*Math.LOG2E),s.coverageMipmap.length=s.mipmapLevels+1;for(let l=0;l<s.mipmapLevels;l++){const c=s.coverageMipmap[l],h={target:Ot.TEXTURE_2D,pixelFormat:tt.RGB,dataType:Vt.UNSIGNED_SHORT_5_6_5,samplingMode:mt.LINEAR,wrapMode:Ft.CLAMP_TO_EDGE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)},p={colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE,width:Math.ceil(c.width/2),height:Math.ceil(c.height/2)};s.coverageMipmap[l+1]=new Xr(r,p,h)}}const o=Math.ceil(t.height/s.cellPixelSize),a=Math.ceil(t.width/s.cellPixelSize);if(!s.vao||s.verticalCellCount!==o||s.horizontalCellCount!==a){s.verticalCellCount=o,s.horizontalCellCount=a;const l=o+1,c=a+1,h=1/o,p=1/a,m=6,g=4,v=new Float32Array(m*g*l*c);let b=0;for(let S=0;S<l;S++)for(let T=0;T<c;T++)v[b+0]=(T-.5)*p*2-1,v[b+1]=(S-.5)*h*2-1,v[b+2]=T*p,v[b+3]=S*h,v[b+4]=(T+.5)*p*2-1,v[b+5]=(S-.5)*h*2-1,v[b+6]=T*p,v[b+7]=S*h,v[b+8]=(T-.5)*p*2-1,v[b+9]=(S+.5)*h*2-1,v[b+10]=T*p,v[b+11]=S*h,v[b+12]=(T-.5)*p*2-1,v[b+13]=(S+.5)*h*2-1,v[b+14]=T*p,v[b+15]=S*h,v[b+16]=(T+.5)*p*2-1,v[b+17]=(S-.5)*h*2-1,v[b+18]=T*p,v[b+19]=S*h,v[b+20]=(T+.5)*p*2-1,v[b+21]=(S+.5)*h*2-1,v[b+22]=T*p,v[b+23]=S*h,b+=m*g;s.vao&&s.vao.dispose(!0),s.vao=new pn(r,or,{geometry:aI},{geometry:Ai.createVertex(r,Gi.STATIC_DRAW,v)})}}_gridComputeMipmap(t){const i=this._rctx,r=this._grid,s=i.bindTechnique(this._downsampleTechnique,this._passParameters,t);i.bindVAO(this.quadVAO);for(let n=0;n<r.mipmapLevels;n++){i.bindFramebuffer(r.coverageMipmap[n+1]);const o=r.coverageMipmap[n+1].width,a=r.coverageMipmap[n+1].height;this._downsampleDrawParameters.inputTexture=r.coverageMipmap[n].colorTexture,Di(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),s.bindDraw(this._downsampleDrawParameters,t),i.setViewport(0,0,o,a),i.drawArrays(Yt.TRIANGLE_STRIP,0,na(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let t=(w(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(w(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const i of this._grid.coverageMipmap)t+=i.gpuMemoryUsage;return t}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}const _gt={dataType:Vt.UNSIGNED_BYTE,internalFormat:tt.RGBA},vgt={};class bgt{constructor(t){this.rctx=t,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=t.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(t=>t.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(t=>t.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(t=>t.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(t=>t.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(t){const i=t.id;this._activeTargets.has(i)&&(this._activeTargets.delete(i),this._disposeWithFramebuffers(this._depthTextures,i),this._disposeWithFramebuffers(this._depthBuffers,i),this._disposeWithFramebuffers(this._colorTextures,i))}_disposeWithFramebuffers(t,i){const r=t.get(i);r&&(this._framebuffers.forEach((s,n)=>{s.colorAttachment!==r&&s.depthStencilAttachment!==r||(s.detachAll(),s.dispose(),this._framebuffers.delete(n))}),r.dispose(),t.delete(i))}getDepthTexture(t,i){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(t.id);return!r||r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null),r||(r=new bt(this.rctx,{target:Ot.TEXTURE_2D,pixelFormat:tt.DEPTH_STENCIL,dataType:Vt.UNSIGNED_INT_24_8,samplingMode:mt.NEAREST,wrapMode:Ft.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._depthTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedDepthTexture(t){return this._depthTextures.get(t.id)}getDepthBuffer(t,i){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(t.id);return r?r.descriptor.width===i.width&&r.descriptor.height===i.height||r.resize(i.width,i.height):(r=new v2(this.rctx,{internalFormat:el.DEPTH_STENCIL,...i}),this._depthBuffers.set(t.id,r),this._activeTargets.add(t.id)),r}getColorTexture(t,i){let r=this._colorTextures.get(t.id);return r&&(r.descriptor.width===i.width&&r.descriptor.height===i.height||(r.dispose(),r=null)),r||(r=new bt(this.rctx,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,internalFormat:t.internalFormat,dataType:t.dataType,samplingMode:t.samplingMode!=null?t.samplingMode:mt.LINEAR,wrapMode:Ft.CLAMP_TO_EDGE,width:i.width,height:i.height}),this._colorTextures.set(t.id,r),this._activeTargets.add(t.id)),r}getAllocatedColorTexture(t){return this._colorTextures.get(t.id)}registerDepthTarget(t={}){return{id:Gl(),...vgt,...t}}registerColorTarget(t={}){return{id:Gl(),..._gt,...t}}getFramebuffer(t,i,r){const s=this._getKey(i,r);let n=this._framebuffers.get(s);const o=this.getColorTexture(i,t);if(this.depthTextureSupported){const l=r?this.getDepthTexture(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o||n.depthStencilTexture!==l)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilTexture(l)),n):(n=w(r)?new Xr(this.rctx,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.DEPTH_STENCIL_TEXTURE},o,l):new Xr(this.rctx,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},o),this._framebuffers.set(s,n),n)}const a=r?this.getDepthBuffer(r,t):void 0;return n?((n.width!==t.width||n.height!==t.height||n.colorTexture!==o)&&(n.detachAll(),n.resize(t.width,t.height),n.attachColorTexture(o),n.attachDepthStencilBuffer(a)),n):(n=new Xr(this.rctx,{colorTarget:Ss.TEXTURE,depthStencilTarget:r?Zi.DEPTH_STENCIL_RENDER_BUFFER:Zi.NONE},o,a),this._framebuffers.set(s,n),n)}_getKey(t,i){return`${t.id}_${i?i.id:"X"}_${t.name}${i?"_"+i.name:""}`}get gpuMemoryUsage(){let t=0;const i=new Set,r=s=>{i.has(s)||(i.add(s),t+=Bx(s))};return this._depthTextures.forEach(r),this._colorTextures.forEach(r),this._depthBuffers.forEach(r),t}}class wgt{constructor(t,i){this._rctx=t,this._compositingHelper=i,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const r=t.type===Li.WEBGL2;this._renderTargetHelper=new bgt(t);const s=this._renderTargetHelper;this.mainColorTargets=[s.registerColorTarget({name:"mainColorTarget0"}),s.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=s.registerColorTarget({name:"frontFaceTarget"});const n=o=>s.registerColorTarget({name:o,dataType:Vt.FLOAT,internalFormat:r?Mt.RGBA32F:tt.RGBA,samplingMode:mt.NEAREST});this.colorFloatTarget=n("colorFloatTarget"),this.alphaFloatTarget=n("alphaFloatTarget"),this.mainDepth=s.registerDepthTarget({name:"mainDepth"}),this.linearDepth=s.registerColorTarget({name:"linearDepth",samplingMode:mt.NEAREST}),this.terrainLinearDepth=s.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=s.registerColorTarget({name:"geometryLinearDepth"}),this.normal=s.registerColorTarget({name:"normal"}),this.highlight=s.registerColorTarget({name:"highlight",internalFormat:r?Mt.RGBA4:tt.RGBA,dataType:Vt.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=s.registerColorTarget({name:"hudVisibility",internalFormat:r?Mt.RGBA4:tt.RGBA,dataType:Vt.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=s.registerColorTarget({name:"tmpColor"}),this.tmpDepth=s.registerDepthTarget({name:"tmpDepth"}),this.hudColor=s.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(t){this._background=t}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(t,i){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,i)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=this._mainColorTarget===0&&this._needLastFrameColorTexture?1:0}initializeFrame(t){const i=this._rctx;this._dimensions.width=t.fullWidth,this._dimensions.height=t.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),i.setClearStencil(0);const r=this._background.color;i.setClearColor(r[0]*r[3],r[1]*r[3],r[2]*r[3],r[3]),i.clearSafe(br.COLOR_BUFFER_BIT|br.DEPTH_BUFFER_BIT|br.STENCIL_BUFFER_BIT)}composite(t){w(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,ra.None)}renderTmpAndCompositeToMain(t,i,r,s=!1){this.renderToTargets(t,this.tmpColor,s?this.tmpDepth:this.mainDepth,xgt),this._compositingHelper.composite(i,this._getColorTexture(this.tmpColor),r)}renderHUDVisibility(t,i=!1){this.renderToTargets(t,this.hudVisibility,i?this.tmpDepth:this.mainDepth,Tgt)}compositeTransparentTerrainOntoHUDVisibility(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ra.None,1,Lc.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(t,i,r){let s,n;switch(i){case Pt.Color:s=this.colorFloatTarget,n=[0,0,0,0];break;case Pt.Alpha:s=this.alphaFloatTarget,n=[1,1,1,1];break;case Pt.FrontFace:s=this.frontFaceTarget,n=[0,0,0,0]}r?this.renderToTargets(t,s,this.tmpDepth,n,!0,!0):this.renderToTargets(t,s,this.mainDepth,n,!1)}compositeTransparentTerrainOntoMain(t){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ra.PremultipliedAlpha)}compositeOccludedOntoMain(t,i){this.bindFramebuffer(),this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),ra.PremultipliedAlpha,i)}compositeTransparentOntoOpaque(t,i){i?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(br.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(t){this.bindTarget(this.currentColorTarget),t(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(t){this._renderTargetHelper.disposeTargetResource(t)}set needLastFrameColorTexture(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=t}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(t,i,r,s,n=!1,o=!1){const a=this._rctx,l=this.bindTarget(i,r);let c=0;if(s){const p=Math.max(1e-13,s[3]);a.setClearColor(s[0],s[1],s[2],p),c|=br.COLOR_BUFFER_BIT}return n&&(c|=br.DEPTH_BUFFER_BIT),o===!1?o=0:(o===!0&&(o=255),c|=br.STENCIL_BUFFER_BIT),c&&a.clearSafe(c,o),t(),a.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),l}bindTarget(t,i){const r=this._renderTargetHelper.getFramebuffer(this._dimensions,t,i);return this._rctx.bindFramebuffer(r),r}_getColorTexture(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)}get gpuMemoryUsage(){let t=0;return this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage),t}}const xgt=[0,0,0,0],Tgt=[0,1,0,1];class Sgt{constructor(t){this.context=t,this._renderPlugins=new hi,this.slots=[];for(let i=0;i<Ue.MAX_SLOTS;++i)this.slots[i]=[]}add(t,i,r){const s=()=>{if(r!=null&&r.aborted)throw i.uninitializeRenderContext(),$i();this._renderPlugins.push(i);for(const o of t)this.slots[o].push(i);this.context.requestRender()},n=i.initializeRenderContext(this.context,r);if(ah(n))return n.then(s);s()}remove(t){if(this._renderPlugins.removeUnordered(t)!=null){for(let i=0;i<this.slots.length;++i)this.slots[i]=this.slots[i].filter(r=>r!==t);t.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(t=>{t.prepareRender&&t.prepareRender(this.context.renderContext)})}updateAnimation(t){let i=!1;return this._renderPlugins.forAll(r=>{r.updateAnimation&&(i=r.updateAnimation(t)||i)}),i}render(){const t=this.slots[this.context.renderContext.bindParameters.slot],i=new Array;t.filter(r=>{if(!r.canRender)return!1;if(Egt(r)){const s=r.prepareTechnique(this.context.renderContext);return!!s&&(i.push(s),!0)}return i.push(null),!0}).forEach((r,s)=>r.render(this.context.renderContext,i[s]))}queryDepthRange(t){const i=Cgt;return i.near=1/0,i.far=-1/0,this._renderPlugins.forAll(r=>{if(r.queryDepthRange){const s=r.queryDepthRange(t);s&&LC(i,s,i)}}),i}get needsTransparentPass(){return this._renderPlugins.some(t=>t.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(t=>t.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(t=>t.needsLinearDepth)}get needsLaserlineWithContrastControl(){const t=this.slots[Ue.LASERLINES_CONTRAST_CONTROL];return!!t&&t.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((t,i)=>t|i.renderOccludedFlags,0)}}function Egt(e){return"prepareTechnique"in e}const Cgt={near:0,far:0};class nEe extends uTe{}const pB=255,Agt=1/pB;function Ogt(){const e=new dr,t=e.fragment;return t.include(Xc),t.include(nh),e.include($z),e.include(E1),e.include(Mz,{receiveShadows:!0}),t.uniforms.add([new ai("depthMap",i=>i.linearDepthTexture),new Hr("inverseViewMatrix",(i,r)=>Fs(Qce,hl(Qce,r.camera.viewMatrix,r.camera.center))),new Ni("nearFar",(i,r)=>r.camera.nearFar)]),t.constants.add("sampleValue","float",Agt),t.code.add(E`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),e}const Qce=Be(),Rgt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:nEe,shadowCastMaxSamples:pB,build:Ogt},Symbol.toStringTag,{value:"Module"}));var oT;(function(e){e[e.Gradient=0]="Gradient",e[e.Threshold=1]="Threshold",e[e.COUNT=2]="COUNT"})(oT||(oT={}));class XW extends pl{constructor(){super(...arguments),this.visualization=oT.Gradient,this.bandsEnabled=!1}}u([ee({count:oT.COUNT})],XW.prototype,"visualization",void 0),u([ee()],XW.prototype,"bandsEnabled",void 0);function Mgt(e){const t=new dr,i=t.fragment;i.include(Xc),i.include(nh),t.include($z),t.include(E1);const{visualization:r,bandsEnabled:s}=e;i.constants.add("inverseSampleValue","float",pB),i.uniforms.add([new ai("shadowCastMap",a=>a.shadowCastMap),new lt("sampleScale",a=>a.sampleScale),new lt("opacityFromElevation",a=>a.opacityFromElevation),new Ci("uColor",a=>a.color)]);const n=r===oT.Gradient,o=r===oT.Threshold;return n&&s?i.uniforms.add(new lt("bandSize",a=>a.bandSize)):o&&i.uniforms.add(new lt("threshold",a=>a.threshold)),i.code.add(E`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?E`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${n&&s?E`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${n?E`* strength`:""});
      }
    `),t}const Pgt=Object.freeze(Object.defineProperty({__proto__:null,build:Mgt},Symbol.toStringTag,{value:"Module"}));class fB extends $r{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=fB.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:Qu,colorWrite:wi,depthTest:null,depthWrite:null})}get primitiveType(){return Yt.TRIANGLE_STRIP}}fB.shader=new Tr(Pgt,()=>_e(()=>import("./ShadowCastVisualize.glsl.9eaff900.js"),[],import.meta.url));const Igt=ki(.01,0,.25,1),Lgt=4e4,$gt=5e4,oEe=1/512;let e4=class extends ze{constructor(e,t,i,r){super({}),this._techniqueRepository=e,this._rctx=t,this._shadowAccumulator=i,this._requestRender=r,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:Igt,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new XW,this._enabled=!1,this._vao=fl(t),this._techniqueConfig.visualization=oT.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=ht(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(fB,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const t=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(t,this._passParameters,e),this._rctx.drawArrays(t.primitiveType,0,na(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>oEe}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const t=this._passParameters.color;cP(e,t)||(Ap(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};u([f()],e4.prototype,"opacityFromElevation",null),e4=u([B("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],e4);class mB extends $r{constructor(t,i){super(t,i,()=>this.destroy())}initializeProgram(t){const i=mB.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:Bo(je.ONE,je.ONE,je.ONE,je.ONE),colorWrite:wi,depthTest:null,depthWrite:null})}get primitiveType(){return Yt.TRIANGLE_STRIP}}mB.shader=new Tr(Rgt,()=>_e(()=>import("./ShadowCastAccumulate.glsl.c067b363.js"),[],import.meta.url));var lM;let wa=lM=class extends ze{constructor(e,t,i,r,s,n){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=r,this._renderToShadowMap=s,this._requestRender=n,this._progress=0,this._sampleCount=0,this._passParameters=new nEe,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=UW,this._previewing=!1,this._handles=new xi,this._cameraForcedForScreenshot=!1,this._bindParameters=new JU(new MJ(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new wr,this._vao=fl(e);const o={colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE,width:0,height:0},a={target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:Ft.CLAMP_TO_EDGE,width:0,height:0};this._fbo=new Xr(e,o,a),this._accumulationRenderer=new e4(t,e,this,n);const l=this._stage.resourceController.scheduler;this._handles.add(l.registerTask(It.SHADOW_ACCUMULATOR,this)),this._handles.add(xe(()=>i.renderView,c=>{this._handles.remove(lM.renderViewHandleKey),N(c)||this._handles.add(c.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),lM.renderViewHandleKey)},an))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){if(N(this._accumulationTechnique)){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechnique=new mB(e,new pl)}return this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==UW&&this._opacityFromElevation>oEe}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const t=this._cachedLightDirections;if(Yv(t,e,Tx))return;const i=e.length;t.length=i,this._sampleCount=Math.min(pB,i);for(let r=0;r<i;++r){const s=e[r],n=t[r]||F();ve(n,s),t[r]=n}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,t,i,r){if(this._passParameters.linearDepthTexture=e,this._depthRange=t,this._updateCamera(i),this._bindParameters.contentCamera=r,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(lM.previewSamples,this._sampleCount-this._progress);for(let n=0;n<s;++n)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(e){this._accumulationRenderer.render(e)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=ht(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=ht(this._fbo),this._vao=ht(this._vao),this._accumulationTechnique=vr(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(e){e.enabled!==void 0&&(this.enabled=e.enabled),e.previewing!==void 0&&(this.previewing=e.previewing),e.lightDirections!==void 0&&(this.lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}set previewing(e){this._previewing!==e&&(this._previewing=e,this._requestRenderIfEnabled())}set lightDirections(e){this._lightDirections=e}readAccumulatedShadow(e,t){if(!this._isActive||this._progress<1||e<0||e>this._fbo.width||t<0||t>this._fbo.height)return 0;const i=Dgt;return this._fbo.readPixels(e,t,1,1,tt.RGBA,Vt.UNSIGNED_BYTE,i),i[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(br.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){const e=this._lightDirections[this._progress];this._renderToShadowMap(this._bindParameters,e,this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const t=this.accumulationTechnique;this._rctx.bindTechnique(t,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.primitiveType,0,na(this._vao,"geometry")),this._progress++}_updateCamera(e){e.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-PE(Lgt,$gt,e.relativeElevation))}set enabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};wa.previewSamples=6,wa.renderViewHandleKey="renderView",u([f()],wa.prototype,"_progress",void 0),u([f()],wa.prototype,"_sampleCount",void 0),u([f()],wa.prototype,"_enabled",void 0),u([f()],wa.prototype,"_depthRange",void 0),u([f()],wa.prototype,"_previewing",void 0),u([f()],wa.prototype,"_accumulationRenderer",void 0),u([f()],wa.prototype,"_isRefining",null),u([f()],wa.prototype,"_isActive",null),u([f()],wa.prototype,"canAccumulate",null),u([f()],wa.prototype,"_isDoneAccumulating",null),u([f()],wa.prototype,"_opacityFromElevation",null),u([f()],wa.prototype,"running",null),wa=lM=u([B("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],wa);const Dgt=new Uint8Array(4),Jce={highlightedThreshold:.99999,selfShadowThreshold:.025};function Ngt(){const e=new dr;e.include(eT,{receiveShadows:!0});const t=e.fragment;return t.include(Xc),t.include(nh),e.include($z),e.include(E1),t.uniforms.add([new ai("defaultDepthTex",(i,r)=>r.shadowMap.getSnapshot(AC.Default)),new ai("highlightDepthTex",(i,r)=>r.shadowMap.getSnapshot(AC.Highlight)),new ai("depthMap",(i,r)=>r.linearDepthTexture),new ai("highlightMap",(i,r)=>r.highlightColorTexture),new Ci("uColor",i=>i.shadowColor),new Ni("nearFar",(i,r)=>r.camera.nearFar),new lt("opacity",i=>i.shadowOpacity),new lt("occludedOpacity",i=>i.occludedShadowOpacity),new lt("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new Ut("lightingMainDirectionView",(i,r)=>De(eue,et(eue,r.lighting.lightingMainDirection,r.camera.viewInverseTransposeMatrix))),new Ni("texelSize",(i,r)=>w(r.linearDepthTexture)?Di(Fgt,1/r.linearDepthTexture.descriptor.width,1/r.linearDepthTexture.descriptor.height):gd),new Hr("inverseViewMatrix",(i,r)=>Fs(Kce,hl(Kce,r.camera.viewMatrix,r.camera.center)))]),t.constants.add("unoccludedHighlightFlag","vec4",nxe).add("highlightedThreshold","float",Jce.highlightedThreshold).add("selfShadowThreshold","float",Jce.selfShadowThreshold),t.code.add(E`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),t.code.add(E`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const Kce=Be(),eue=F(),Fgt=yt(),kgt=Object.freeze(Object.defineProperty({__proto__:null,build:Ngt},Symbol.toStringTag,{value:"Module"}));class Ugt extends mn{constructor(){super(...arguments),this.shadowColor=ki(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class gB extends $r{constructor(t){super(t,null,()=>this.destroy())}initializeProgram(t){const i=gB.shader.get().build();return new Sr(t.rctx,i,or)}initializePipeline(){return ni({blending:Bo(je.SRC_ALPHA,je.ONE,je.ONE_MINUS_SRC_ALPHA,je.ONE_MINUS_SRC_ALPHA),colorWrite:wi,depthTest:null,depthWrite:null})}get primitiveType(){return Yt.TRIANGLE_STRIP}}gB.shader=new Tr(kgt,()=>_e(()=>import("./ShadowHighlight.glsl.b1cab9ae.js"),[],import.meta.url));const zgt=.001953125,Bgt=4e4,Vgt=5e4;class Ggt{constructor(t,i){this._rctx=t,this._viewingMode=i,this._maxOpacity=1,this._passParameters=new Ugt,this._drawParameters=new uTe,this._vao=fl(this._rctx)}get technique(){return N(this._technique)&&(this._technique=new gB({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(t,i){if(!t.shadowMap.enabled||!t.linearDepthTexture||!this.isVisible)return;const r=this.technique;this._drawParameters.origin=t.camera.center,this._rctx.bindFramebuffer(i),this._rctx.bindTechnique(r,this._passParameters,t).bindDraw(this._drawParameters,t),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(r.primitiveType,0,na(this._vao,"geometry"))}get gpuMemoryUsage(){var t,i;return(i=(t=this._vao)==null?void 0:t.size)!=null?i:0}setDefaultOptions(t){this._passParameters={...this._passParameters,...t},this._updateMaxOpacity()}updateParameters(t,i){this._passParameters.opacityElevation=1-PE(Bgt,Vgt,t.relativeElevation);const r=this._viewingMode===st.Global?De(tue,t.center):fe(tue,0,0,1),s=ke(r,i);this._passParameters.dayNightTerminator=PE(0,1,Xe(30*s,0,1))}dispose(){this._vao=ht(this._vao),this._technique=vr(this._technique)}get isVisible(){const{opacityElevation:t,dayNightTerminator:i}=this._passParameters;return this._maxOpacity*t*i>=zgt}_updateMaxOpacity(){const t=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=t*this._passParameters.shadowColor[3]}}const tue=F(),iue=T1();class jgt{constructor(){this._plane=T1()}get isEnabled(){return!bge(this.plane,iue)}get plane(){return this._plane}set plane(t){yT(t||iue,this._plane)}}var Tm;(function(e){e[e.EdgeDetector=0]="EdgeDetector",e[e.BlendWeight=1]="BlendWeight",e[e.Blur=2]="Blur",e[e.COUNT=3]="COUNT"})(Tm||(Tm={}));class aEe extends pl{constructor(){super(...arguments),this.output=Tm.EdgeDetector}}u([ee({count:Tm.COUNT})],aEe.prototype,"output",void 0);const f_={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16};function Hgt(e){const t=new dr;return e.output===Tm.EdgeDetector&&(t.attributes.add(D.POSITION,"vec2"),t.vertex.uniforms.add(new nl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.vertex.code.add(E`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),t.fragment.uniforms.add(new as("tColor")),t.fragment.code.add(E`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${E.float(f_.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${E.float(f_.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),e.output===Tm.BlendWeight&&(t.attributes.add(D.POSITION,"vec2"),t.vertex.uniforms.add(new nl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[3]","vec4"),t.varyings.add("fPixCoord","vec2"),t.vertex.code.add(E`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${E.int(f_.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),t.fragment.uniforms.add(new as("tEdges")),t.fragment.uniforms.add(new as("tArea")),t.fragment.uniforms.add(new as("tSearch")),t.fragment.uniforms.add(new as("tColor")),t.fragment.uniforms.add(new nl("resolution")),t.fragment.code.add(E`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${E.int(f_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${E.int(f_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${E.int(f_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${E.int(f_.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${E.int(f_.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),e.output===Tm.Blur&&(t.attributes.add(D.POSITION,"vec2"),t.vertex.uniforms.add(new nl("resolution")),t.varyings.add("fTexCoord","vec2"),t.varyings.add("fOffset[2]","vec4"),t.vertex.code.add(E`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),t.fragment.uniforms.add(new as("tBlendWeights")),t.fragment.uniforms.add(new as("tColor")),t.fragment.uniforms.add(new nl("resolution")),t.fragment.code.add(E`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),t}const qgt=Object.freeze(Object.defineProperty({__proto__:null,build:Hgt},Symbol.toStringTag,{value:"Module"}));class yB extends $r{initializeProgram(t){const i=yB.shader.get().build(this.configuration);return new Sr(t.rctx,i,or)}initializePipeline(){return ni({colorWrite:wi})}}yB.shader=new Tr(qgt,()=>_e(()=>import("./SMAA.glsl.ef9e6948.js"),[],import.meta.url));let cM=class extends ze{constructor(e,t){super({}),this.rctx=e,this._techniqueRep=t,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=fd(this._abortController),this.disable()}_loadResources(e){if(w(this._abortController))return!1;if(w(this._searchTexture))return!0;this._abortController=new AbortController;const t=this._abortController.signal;return _e(()=>import("./SmaaRenderPassData.e07ab82b.js"),[],import.meta.url).then(i=>this._loadTextures(i,t)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,t){return Ui(t),Promise.all([this._loadTextureFromBase64(e.areaTexture,mt.LINEAR,tt.RGB),this._loadTextureFromBase64(e.searchTexure,mt.NEAREST,tt.LUMINANCE)]).then(([i,r])=>{An(t)?(i.dispose(),r.dispose(),Ui(t)):(this._areaTexture=i,this._searchTexture=r)})}get updating(){return w(this._abortController)}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const t=new aEe,i=(r,s)=>this._techniqueRep.releaseAndAcquire(yB,r,s);t.output=Tm.EdgeDetector,this._edgeDetectTechnique=i(t,this._edgeDetectTechnique),t.output=Tm.BlendWeight,this._blendWeightsTechnique=i(t,this._blendWeightsTechnique),t.output=Tm.Blur,this._blurTechnique=i(t,this._blurTechnique)}return!!this._loadResources(e)&&(this._vao=wHe(this.rctx),this._edges=new Xr(this.rctx,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},{target:Ot.TEXTURE_2D,pixelFormat:tt.RGB,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:Ft.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new Xr(this.rctx,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.LINEAR,wrapMode:Ft.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=ht(this._vao),this._areaTexture=ht(this._areaTexture),this._searchTexture=ht(this._searchTexture),this._blend=ht(this._blend),this._edges=ht(this._edges),this._isEnabled=!1)}render(e){if(!this._isEnabled)return;const t=this.rctx,i=t.getBoundFramebufferObject(),r={x:0,y:0,width:e.descriptor.width,height:e.descriptor.height};t.bindVAO(this._vao),t.setViewport(r.x,r.y,r.width,r.height),this._edges.resize(r.width,r.height),t.bindFramebuffer(this._edges),t.setClearColor(0,0,0,1),t.clear(br.COLOR_BUFFER_BIT);const s=t.bindTechnique(this._edgeDetectTechnique);s.bindTexture("tColor",e),s.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),t.drawArrays(Yt.TRIANGLES,0,3),this._blend.resize(r.width,r.height),t.bindFramebuffer(this._blend),t.setClearColor(0,0,1,1),t.clear(br.COLOR_BUFFER_BIT);const n=t.bindTechnique(this._blendWeightsTechnique);n.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),n.bindTexture("tSearch",this._searchTexture),n.bindTexture("tArea",this._areaTexture),n.bindTexture("tEdges",this._edges.colorTexture),t.drawArrays(Yt.TRIANGLES,0,3),t.bindFramebuffer(i),t.setClearColor(0,1,0,1),t.clear(br.COLOR_BUFFER_BIT);const o=t.bindTechnique(this._blurTechnique);o.setUniform4f("resolution",1/r.width,1/r.height,r.width,r.height),o.bindTexture("tColor",e),o.bindTexture("tBlendWeights",this._blend.colorTexture),t.drawArrays(Yt.TRIANGLES,0,3)}_loadTextureFromBase64(e,t,i){return Qp(e).then(r=>new bt(this.rctx,{pixelFormat:i,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.CLAMP_TO_EDGE,width:r.width,height:r.height,samplingMode:t},r))}};u([f()],cM.prototype,"_abortController",void 0),u([f({readOnly:!0})],cM.prototype,"updating",null),cM=u([B("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],cM);function Wgt(e,t){const i=t,r=-e[0],s=-e[1],n=-e[2],o=i[3],a=i[7],l=i[11],c=i[15];i[0]+=o*r,i[1]+=o*s,i[2]+=o*n,i[4]+=a*r,i[5]+=a*s,i[6]+=a*n,i[8]+=l*r,i[9]+=l*s,i[10]+=l*n,i[12]+=c*r,i[13]+=c*s,i[14]+=c*n}function Zgt(e,t){const i=t,r=e[0],s=e[1],n=e[2];i[12]+=r*i[0]+s*i[4]+n*i[8],i[13]+=r*i[1]+s*i[5]+n*i[9],i[14]+=r*i[2]+s*i[6]+n*i[10],i[14]+=r*i[3]+s*i[7]+n*i[11]}class Xgt{constructor(t){this.factory=t,this.originData=new Map}acquire(t){return this.register(this.factory.getOrigin(t))}register(t){const i=this.originData.get(t.id);return i?(i.refCount++,i.origin):(this.originData.set(t.id,{refCount:1,viewMatrix:Be(),origin:t}),t)}release(t){const i=this.originData.get(t.id);i&&(i.refCount--,i.refCount===0&&this.originData.delete(t.id))}updateViewMatrices(t){this.originData.forEach(i=>{js(i.viewMatrix,t),Zgt(i.origin.vec3,i.viewMatrix)})}getViewMatrix(t){return this.originData.get(t.id).viewMatrix}}class Ygt extends nTe{constructor(t,i,r){super(),this.distanceFalloffFactor=t,this.minimumEdgeLength=i,this.transparency=r,this.transformNormalViewFromGlobal=Qr()}}class Qgt extends oTe{constructor(){super(...arguments),this.transformNormalViewFromGlobal=Qr(),this.slicePlaneLocalOrigin=F(),this.transformNormalGlobalFromModel=Qr()}}function Jgt(e){const t=E`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;e.code.add(t)}const Kgt=ir(.5,-4e-4);function eyt(e,t){const i=e.vertex;i.include(Jgt),i.constants.add("depthBias","vec2",Kgt),i.uniforms.add(new Ni("inverseViewport",(r,s)=>s.inverseViewport)),t.legacy?(i.uniforms.add(new n1("localView")),i.uniforms.add(new Hr("proj",(r,s)=>s.camera.projectionMatrix)),i.code.add(E`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(i.uniforms.add(new gI("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),i.uniforms.add(new Hr("transformProjFromView",r=>r.transformProjFromView)),i.code.add(E`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),i.code.add(E`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function tyt(e,t){const i=e.fragment;i.constants.add("coverageTestThreshold","float",.01),t.antialiasing?i.code.add(E`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):i.code.add(E`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function iyt(e,t){const i=e.vertex;t.silhouette?(i.code.add(E`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?i.code.add(E`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):i.code.add(E`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):i.code.add(E`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function ryt(e,t){const i=e.vertex;i.include(Xc),i.uniforms.add(new lt("distanceFalloffFactor",r=>r.distanceFalloffFactor)),i.code.add(E`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),i.uniforms.add(new as("componentDataTex")),i.uniforms.add(new Py("componentDataTexInvDim")),e.attributes.add(D.COMPONENTINDEX,"float"),i.constants.add("componentColorFieldOffset","float",0),i.constants.add("componentOtherFieldOffset","float",1),i.constants.add("componentVerticalOffsetFieldOffset","float",2),i.constants.add("componentFieldCount","float",3),i.constants.add("lineWidthFractionFactor","float",8),i.constants.add("extensionLengthOffset","float",128),i.constants.add("componentTexWidth","float",4096),i.constants.add("verticalOffsetScale","float",2*mK),i.code.add(E`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),t.legacy?i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(i.uniforms.add(new jP("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel)),i.code.add(E`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),t.silhouette?(e.attributes.add(D.NORMALA,"vec3"),e.attributes.add(D.NORMALB,"vec3"),i.code.add(E`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(e.attributes.add(D.NORMAL,"vec3"),i.code.add(E`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),t.legacy?i.code.add(E`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(i.include(J5,t),i.include(J5,t),i.uniforms.add([new gI("transformViewFromCameraRelativeRS",r=>r.transformViewFromCameraRelativeRS),new jP("transformWorldFromModelRS",r=>r.transformWorldFromModelRS),new al("transformWorldFromModelTL",r=>r.transformWorldFromModelTL),new al("transformWorldFromModelTH",r=>r.transformWorldFromModelTH),new Ut("transformWorldFromViewTL",r=>r.transformWorldFromViewTL),new Ut("transformWorldFromViewTH",r=>r.transformWorldFromViewTH)]),i.code.add(E`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?E`normalize(transformWorldFromModelTL + rotatedModelPosition);`:E`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),i.uniforms.add(new Hr("transformProjFromView",(r,s)=>s.camera.projectionMatrix)),i.code.add(E`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),i.code.add(E`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function lEe(e){return e.mode===ln.SKETCH||e.mode===ln.MIXED}var ln;(function(e){e[e.SOLID=0]="SOLID",e[e.SKETCH=1]="SKETCH",e[e.MIXED=2]="MIXED",e[e.COUNT=3]="COUNT"})(ln||(ln={}));function syt(e,t){const i=e.vertex;switch(t.mode){case ln.SKETCH:i.code.add(E`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case ln.MIXED:i.code.add(E`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case ln.SOLID:i.code.add(E`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}function wK(e,t){const i=e.vertex;switch(e.attributes.add(D.SIDENESS,"vec2"),t.mode===ln.MIXED?i.code.add(E`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):i.code.add(E`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),t.mode){case ln.MIXED:i.code.add(E`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case ln.SKETCH:i.code.add(E`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ln.SOLID:i.code.add(E`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case ln.COUNT:break;default:t.mode}}function nyt(e,t){const i=e.vertex;switch(e.include(wK,t),lEe(t)&&i.uniforms.add(new rr("strokesAmplitude")),t.mode){case ln.SOLID:i.code.add(E`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case ln.SKETCH:i.code.add(E`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case ln.MIXED:i.code.add(E`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function oyt(e,t){const i=e.vertex;e.include(wK,t);const r=e.fragment;switch(lEe(t)&&(i.uniforms.add(new Py("strokesTextureScale")),i.uniforms.add(new rr("strokesLog2Resolution")),i.uniforms.add(new rr("strokeVariants")),e.varyings.add("vStrokeUV","vec2"),r.uniforms.add(new as("strokesTexture")),r.uniforms.add(new rr("strokesNormalizationScale")),i.code.add(E`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),e.fragment.include(Xc),r.code.add(E`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),t.mode){case ln.SOLID:i.code.add(E`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),r.code.add(E`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case ln.SKETCH:i.code.add(E`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),r.code.add(E`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case ln.MIXED:e.varyings.add("vType","float"),i.code.add(E`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),r.code.add(E`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function ayt(e){const t=new dr,i=t.vertex,r=t.fragment;return e.legacy&&i.uniforms.add(new n1("model")),e.antialiasing&&(i.code.add(E`#define ANTIALIASING 1`),r.code.add(E`#define ANTIALIASING 1`)),t.include(eyt,e),t.include(ryt,e),t.include(nyt,e),t.include(wK,e),t.include(oyt,e),t.include(Ns,e),t.include(iyt,e),t.include(tyt,e),t.include(syt,e),t.include(oh,e),t.varyings.add("vColor","vec4"),t.varyings.add("vRadius","float"),t.varyings.add("vPosition","vec3"),t.varyings.add("vWorldPosition","vec3"),t.varyings.add("vViewPos","vec3"),t.varyings.add("vLineLengthPixels","float"),t.varyings.add("vSizeFalloffFactor","float"),i.uniforms.add(new Ni("pixelToNDC",(s,n)=>Di(lyt,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))),i.uniforms.add(new Ci("viewport",(s,n)=>n.camera.fullViewport)),i.uniforms.add(new lt("pixelRatio",(s,n)=>n.camera.pixelRatio)),t.attributes.add(D.POSITION0,"vec3"),t.attributes.add(D.POSITION1,"vec3"),t.attributes.add(D.VARIANTOFFSET,"float"),t.attributes.add(D.VARIANTSTROKE,"float"),t.attributes.add(D.VARIANTEXTENSION,"float"),i.code.add(E`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),t.fragment.code.add(E`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${e.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),t}const lyt=yt(),cyt=Object.freeze(Object.defineProperty({__proto__:null,build:ayt},Symbol.toStringTag,{value:"Module"}));class _B extends $r{initializeProgram(t){const i=_B.shader.get().build(this.configuration);return new Sr(t.rctx,i,VW)}initializePipeline(t){return t.blendMinMax?ni({blending:Bo(je.ONE,je.ONE,je.ZERO,je.ONE,Zy.ADD,t.blendMinMax.MAX),depthTest:{func:kr.LEQUAL},colorWrite:wi}):ni({depthTest:{func:kr.LEQUAL},depthWrite:ec,colorWrite:wi})}}_B.shader=new Tr(cyt,()=>_e(()=>import("./EdgeShader.glsl.0a0ffc67.js"),[],import.meta.url));class Xf extends Oa{constructor(){super(...arguments),this.mode=ln.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}u([ee({count:ln.COUNT})],Xf.prototype,"mode",void 0),u([ee()],Xf.prototype,"hasSlicePlane",void 0),u([ee()],Xf.prototype,"silhouette",void 0),u([ee()],Xf.prototype,"legacy",void 0),u([ee()],Xf.prototype,"antialiasing",void 0),u([ee()],Xf.prototype,"doublePrecisionRequiresObfuscation",void 0),u([ee()],Xf.prototype,"hasMultipassTerrain",void 0),u([ee()],Xf.prototype,"cullAboveGround",void 0),u([ee()],Xf.prototype,"spherical",void 0);const uyt=8,z9=128,hyt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class dyt{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const pyt={solid:ln.SOLID,sketch:ln.SKETCH,uber:ln.MIXED};class rP{constructor(t,i,r){this.rctx=t,this.shaderTechniqueRepository=i,this._configuration=new Xf,this.refCount=new dyt,this.renderables=new Set,this.sortedRenderables={[Qt.TRANSPARENT]:{[Qt.TRANSPARENT]:new hi,[Qt.OPAQUE]:new hi},[Qt.OPAQUE]:{[Qt.TRANSPARENT]:new hi,[Qt.OPAQUE]:new hi}},this._renderablesDirty=!1,this._drawParameters=new Qgt,this._settings={...hyt,...r},this.key=rP.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const s=this._settings.strokesTexture.variants;this.writerSettings={variants:s,reducedPrecision:ur.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=pyt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=xI(t),this._configuration.spherical=r.spherical}dispose(){this._technique=vr(this._technique)}addRenderable(t){this.renderables.add(t),this._renderablesDirty=!0}removeRenderable(t){this.renderables.delete(t),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(t,i){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[i][Qt.TRANSPARENT].forAll(t),this.sortedRenderables[i][Qt.OPAQUE].forAll(t)}updateTechnique(t,i){return this._configuration.hasMultipassTerrain=!!t.multipassTerrain.enabled,this._configuration.cullAboveGround=!!t.multipassTerrain.cullAboveGround,this._configuration.silhouette=i,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(_B,this._configuration,this._technique),this._technique}bindRegularEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!1),t,i)}bindSilhouetteEdges(t,i){return this.rctx.bindTechnique(this.updateTechnique(i,!0),t,i)}renderRegularEdges(t,i,r,s,n){this._render(t,i,i.regular.vao,r,s,n)}renderSilhouetteEdges(t,i,r,s,n){this._render(t,i,i.silhouette.vao,r,s,n)}_render(t,i,r,s,n,o){this._bindDraw(t,i,s,o),this.rctx.bindVAO(r),this.rctx.capabilities.instancing.drawArraysInstanced(Yt.TRIANGLE_FAN,0,4,n)}_bindDraw(t,i,r,s){if(i.components.buffer.textureBuffer.bind(t,fyt,myt),"origin"in i.transform)t.setUniformMatrix4fv("localView",s),t.setUniformMatrix4fv("model",i.transform.modelMatrix),ve(this._drawParameters.slicePlaneLocalOrigin,i.transform.origin.vec3);else{const n=new cB(i.transform.position),o=vd(rue,wT(rue,i.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=n.low,this._drawParameters.transformWorldFromModelTH=n.high,this._drawParameters.transformWorldFromModelRS=i.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=r.camera.viewInverseTransposeMatrix;fe(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}t.bindDraw(this._drawParameters,r),this._settings.type!=="uber"&&this._settings.type!=="sketch"||this._setSketchUniforms(t)}_setSketchUniforms(t){const i=this._settings.strokesTexture,r=i.texture;N(r)||(t.bindTexture("strokesTexture",r),t.setUniform2f("strokesTextureScale",1/r.descriptor.width,1/r.descriptor.height),t.setUniform1f("strokesLog2Resolution",Math.log2(i.resolution)),t.setUniform1f("strokesNormalizationScale",i.normalizationScale),t.setUniform1f("strokesAmplitude",i.amplitude),t.setUniform1f("strokeVariants",i.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[Qt.TRANSPARENT][Qt.TRANSPARENT].clear(),this.sortedRenderables[Qt.TRANSPARENT][Qt.OPAQUE].clear(),this.sortedRenderables[Qt.OPAQUE][Qt.TRANSPARENT].clear(),this.sortedRenderables[Qt.OPAQUE][Qt.OPAQUE].clear(),this.renderables.forEach(i=>{i.objectTransparency!==Qt.INVISIBLE&&i.edgeTransparency!==Qt.INVISIBLE&&this.sortedRenderables[i.objectTransparency][i.edgeTransparency].push(i)});const t=(i,r)=>"origin"in i.transform&&"origin"in r.transform?i.transform.origin.id<r.transform.origin.id?-1:i.transform.origin.id>r.transform.origin.id?1:0:0;this.sortedRenderables[Qt.TRANSPARENT][Qt.TRANSPARENT].sort(t),this.sortedRenderables[Qt.TRANSPARENT][Qt.OPAQUE].sort(t),this.sortedRenderables[Qt.OPAQUE][Qt.TRANSPARENT].sort(t),this.sortedRenderables[Qt.OPAQUE][Qt.OPAQUE].sort(t)}static getKey(t,i,r){return`edges-t:${t}:${i}:${r}`}}const fyt="componentDataTex",myt="componentDataTexInvDim",rue=Dy();class gyt extends GSe{constructor(t){super("EdgeProcessingWorker","extract",{extract:i=>[i.dataBuffer],extractComponentsEdgeLocations:i=>[i.dataBuffer],extractEdgeLocations:i=>[i.dataBuffer]},t)}async process(t,i,r){if(r)return vK(t);const s=this._packInput(t),n=await this.invoke(s,i);return this._unpackOutput(n)}async extractEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractEdgeLocations",r,i);return ZD(s)}async extractComponentsEdgeLocations(t,i){const r=this._packInput(t),s=await this.invokeMethod("extractComponentsEdgeLocations",r,i);return ZD(s)}_packInput(t){return{dataBuffer:t.data.buffer,writerSettings:t.writerSettings,skipDeduplicate:t.skipDeduplicate,indicesBuffer:t.indices.buffer,indicesType:o4(t.indices)?"Uint32Array":"Uint16Array",indicesLength:t.indicesLength}}_unpackOutput(t){return{regular:{instancesData:ZD(t.regular.instancesData),lodInfo:{lengths:new Float32Array(t.regular.lodInfo.lengths)}},silhouette:{instancesData:ZD(t.silhouette.instancesData),lodInfo:{lengths:new Float32Array(t.silhouette.lodInfo.lengths)}},averageEdgeLength:t.averageEdgeLength}}}function yyt(e){const i=VO.resolution,r=i/2,s=new Uint8Array(4*i*i),n=4*i*r,o=VO.amplitude,a=2*o,l=4*i,c=Math.log2(i)+1,h=VO.strokes.length;let p=(c-1)*h*l;for(const{distance:g,pressure:v}of VO.strokes){let b=g,S=v,T=p;for(let O=0;O<c;O++){O!==0&&(b=sue(b,P3.DISTANCE),S=sue(S,P3.PRESSURE));for(let C=0;C<VO.resolution;C++){const M=.5+(b?b[C%b.length]/a:0),I=S?S[C%S.length]:1;u3(M,s,T),u3(I,s,T+n),T+=4}T-=l*(h+1)}p+=l}const m=new bt(e,{pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:mt.LINEAR,width:i,height:i,wrapMode:Ft.REPEAT},s);return new vyt(i,a,o,h,m)}function sue(e,t){if(!e)return null;const i=e.length/2,r=_yt*i,s=new Array(i);let n=0;const o=t===P3.PRESSURE;for(let a=0;a<e.length;a+=2){const l=(e[a]+e[a+1])/2;s[n++]=o?Math.min(r,1-(1-l)*nue):Math.min(r,l*nue)}return s}var P3;(function(e){e[e.DISTANCE=0]="DISTANCE",e[e.PRESSURE=1]="PRESSURE"})(P3||(P3={}));const _yt=.1,nue=.5;class vyt{constructor(t,i,r,s,n){this.resolution=t,this.normalizationScale=i,this.amplitude=r,this.variants=s,this.texture=n}dispose(){this.texture=ht(this.texture)}}const VO={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function oue(e){let t=null;for(const i of e){const r=i.type;if(byt(i)){if(N(t))t=r;else if(t!==r)return"uber"}}return w(t)?t:"uber"}function B9(e){let t=Qt.INVISIBLE;for(const{material:i}of e)if(cEe(i)){if(i.color[3]*i.opacity<1)return Qt.TRANSPARENT;t=Qt.OPAQUE}return t}function V9(e){let t=Qt.INVISIBLE;for(const{material:i}of e)if(cEe(i)){switch(i.objectTransparency){case Qt.TRANSPARENT:case Qt.INVISIBLE:return Qt.TRANSPARENT;case Qt.OPAQUE:if(i.opacity<1)return Qt.TRANSPARENT}t=Qt.OPAQUE}return t}function cEe(e){return e.size*e.color[3]*e.opacity>0}function byt(e){return e.size*e.color[3]>0}function wyt(e,t){const i=lhe(e,t,!0);return i===-1?t<e[0]?0:e.length:i}function aue(e,t,i){return e.length-wyt(e,t*i.minimumEdgeLength)}function lue(e,t,i,r){for(let s=0;s<e.length;s++){const n=e[s].index,o=t[s],a=t[s+1];if(r)for(let l=o;l<a;l++){const c=r[l];i.set(c,n)}else for(let l=o;l<a;l++)i.set(l,n)}}const xyt=Ie.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let cp=class extends ze{constructor(e){super(e),this.updatingHandles=new _m,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[Qt.TRANSPARENT]:0,[Qt.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=F(),this.localOrigins=new Xgt(new RJ(e.renderSR))}initialize(){this.worker=new gyt(this.schedule),this.componentColorManager=new eEe(this.rctx,3);const e=q2e.createBuffer(4);for(let t=0;t<4;t++)e.sideness.set(t,0,t===0||t===3?0:1),e.sideness.set(t,1,t===0||t===1?0:1);this.verticesBufferObject=Ai.createVertex(this.rctx,Gi.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(e=>this._discardObjectEntry(e)),this.perObjectData.clear(),this.strokesTexture=ht(this.strokesTexture),this.componentColorManager=Tt(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=ht(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[Qt.TRANSPARENT]+this.numberOfRenderedEdges[Qt.OPAQUE]}shouldRender(){return this.renderers.size>0}async addComponentObject(e,t,i,r,s,n,o,a){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let l;const c=new cue(new Promise(p=>l=p),i.center,i.radius);this.perObjectData.set(e,c);const h=await this.updatingHandles.addPromise(this._addComponentGeometry(t,c,r,s,n,o,a));return this.setNeedsRender(),l(),h}async addOrUpdateObject3D(e,t,i,r){if(this.destroyed)return void xyt.warn("Attempt to add an object to a destroyed instance");const s=this.perObjectData.get(e);let n;(s==null?void 0:s.renderables.length)>0&&this.perObjectDataEvictionCache.add(s);const o=e.boundingVolumeWorldSpace.bounds,a=new cue(new Promise(c=>n=c),o,Oy(o));this.perObjectData.set(e,a);const l=new Array;if(i.mergeGeometries&&e.geometries.length>1&&Syt(e))l.push(this._addObjectMergedGeometries(e,a,t,i,r));else for(let c=0;c<e.geometries.length;c++){const h=e.geometryRecords[c];if(!h.material.supportsEdges)continue;const p=e.geometries[c];l.push(this._addGeometry(e,a,p,h,t[0],i,r))}await this.updatingHandles.addPromise(Promise.all(l)),this.perObjectDataEvictionCache.delete(a),this._discardObjectEntry(s),this.setNeedsRender(),n()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(t=>this._removeRenderable(t)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this.perObjectData.has(e)}async updateAllComponentOpacities(e,t){const i=t instanceof Array?r=>t[r]:()=>t;(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(r=>{const s=r.components.meta.length;for(let n=0;n<s;n++){const o=i(n),a=r.components.meta[n],l=a.index;a.material.opacity=o,r.components.buffer.textureBuffer.setDataElement(l,1,3,255*o)}this._updateTransparency(r)}),this.setNeedsRender()}async getObjectMemoryUsage(e){return(await this._getObjectEntry(e)).renderables.reduce((t,i)=>t+i.statistics.gpuMemoryUsage,0)}async updateAllComponentMaterials(e,t,i,r){const s=e instanceof m0,n=!!i.hasSlicePlane,o=oue(t),a=rP.getKey(o,n,s);(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(l=>{if(a!==l.rendererKey){const c=this.renderers.get(l.rendererKey),h=this._acquireRenderer(o,n,s);c.removeRenderable(l),c.refCount.decrement(),l.rendererKey=a,h.addRenderable(l)}for(let c=0;c<t.length;c++)l.components.meta[c].material=t[c];r&&this._updateComponentBuffer(l.components),this._updateTransparency(l)}),this.setNeedsRender()}async updateAllVerticalOffsets(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>{var s;const r=i.components.meta;for(let n=0;n<r.length;n++)i.components.meta[n].verticalOffset=(s=t==null?void 0:t[n])!=null?s:0;this._updateComponentBuffer(i.components)}),this.setNeedsRender()}async updateObjectVisibility(e,t){(await this.updatingHandles.addPromise(this._getObjectEntry(e))).renderables.forEach(i=>i.visible=t),this.setNeedsRender()}removeObject(e){const t=this.perObjectData.get(e);t&&(this.perObjectData.delete(e),this._discardObjectEntry(t))}async _getObjectEntry(e){const t=this.perObjectData.get(e);if(!t)throw"no object";if(await t.loaded,t.loaded==null)throw $i();return t}removeAll(){this.perObjectData.forEach((e,t)=>this.removeObject(t))}render(e,t){if(this.numberOfRenderedEdges[t]=0,N(this.componentColorManager))return;this.localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,r=F(),s=new cB;let n=0,o=0;if(this.renderers.forEach(h=>{h.refCount.value===0?(this.renderers.delete(h.key),h.dispose()):h.forEachRenderable(p=>{p.visible&&(n+=p.statistics.averageEdgeLength,o++,p.regular&&h.updateTechnique(e,!1),p.silhouette&&h.updateTechnique(e,!0))},t)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),o===0)return;const a=40*n/o,l=e.camera.perScreenPixelRatio,c=new Ygt(a,l,t);fe(r,i[3],i[7],i[11]),s.set(r),ve(c.transformWorldFromViewTH,s.high),ve(c.transformWorldFromViewTL,s.low),_d(c.transformViewFromCameraRelativeRS,e.camera.viewMatrix),vd(uue,c.transformViewFromCameraRelativeRS),wT(c.transformNormalViewFromGlobal,uue),c.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this.renderers.forEach(h=>{this._renderRegularEdges(h,e,c),this._renderSilhouetteEdges(h,e,c)})}_updateTransparency(e){const t=B9(e.components.meta),i=V9(e.components.meta);t===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=t,e.objectTransparency=i,this.renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,t,i){if(e.getCombinedStaticTransformation(t,i),w(t.origin))this.localOrigins.register(t.origin);else{const r=fe(this.tmpModelPosition,i[12],i[13],i[14]);t.origin=this.localOrigins.acquire(r)}return Wgt(t.origin.vec3,i),t.origin}_updateComponentBuffer(e){const{meta:t,buffer:i}=e,r=new Uint8Array(4);for(let s=0;s<t.length;s++){const n=t[s].material,o=t[s].index,a=Xe(Math.round(n.size*uyt),0,255),l=Xe(n.extensionLength,-z9,255-z9)+z9,c=n.type==="solid"?bk.SOLID:bk.SKETCH,h=255*n.opacity,p=n.color,m=255*p[0],g=255*p[1],v=255*p[2],b=255*p[3];i.textureBuffer.setData(o,0,m,g,v,b),i.textureBuffer.setData(o,1,a,l,c,h),j2e(t[s].verticalOffset,r),i.textureBuffer.setData(o,2,r[0],r[1],r[2],r[3])}}_createComponentBuffers(e){if(N(this.componentColorManager))return null;const t=new Array,i=this.componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const n=e[s],o=i.acquireIndex();t.push({index:o,verticalOffset:0,material:n})}const r={meta:t,buffer:i};return this._updateComponentBuffer(r),r}_extractEdges(e,t,i,r,s,n=s.length){return this.worker.process({data:t,indices:s,indicesLength:n,writerSettings:e,skipDeduplicate:i},this.workerAbort.signal,r)}_createEdgeResources(e){const t={};if(N(this.verticesBufferObject))return t;if(e.regular.lodInfo.lengths.length>0){const i=new pn(this.rctx,VW,{vertices:zce,instances:_k.glLayout},{vertices:this.verticesBufferObject,instances:Ai.createVertex(this.rctx,Gi.STATIC_DRAW,e.regular.instancesData.buffer)});t.regular={vao:i,lod:e.regular.lodInfo}}if(e.silhouette.lodInfo.lengths.length>0){const i=new pn(this.rctx,VW,{vertices:zce,instances:vk.glLayout},{vertices:this.verticesBufferObject,instances:Ai.createVertex(this.rctx,Gi.STATIC_DRAW,e.silhouette.instancesData.buffer)});t.silhouette={vao:i,lod:e.silhouette.lodInfo}}return t}async _addGeometry(e,t,i,r,s,n,o){const a=i.vertexAttributes.get(D.POSITION),l=i.indices.get(D.POSITION),c=Be(),h={position:a,indices:l,modelTransform:c,origin:this._computeModelTransformWithLocalOrigin(e,r,c)};return this._addPositionData(t,h,i.edgeIndicesLength,s,n,o)}async _addPositionData(e,t,i,r,s,n=!1){if(e.loaded==null)return;const o=this._createComponentBuffers([r]);if(N(o)||i<=0)return;const a=this._acquireRenderer(r.type,!!s.hasSlicePlane,!0),{modelTransform:l,origin:c}=t,h=t.indices,p=t.position,m=p.data.length/p.size,g=O3.createBuffer(m);for(let C=0;C<m;C++)g.position.set(C,0,p.data[C*p.size+0]),g.position.set(C,1,p.data[C*p.size+1]),g.position.set(C,2,p.data[C*p.size+2]);lue(o.meta,[0,g.componentIndex.count],g.componentIndex);const v=await this.updatingHandles.addPromise(this._extractEdges(a.writerSettings,g,!1,n,h,i));if(e.loaded==null)return;const{regular:b,silhouette:S}=this._createEdgeResources(v),T=(b?b.vao.size:0)+(S?S.vao.size:0),O={regular:b,silhouette:S,transform:{modelMatrix:l,origin:c},statistics:{gpuMemoryUsage:T,externalMemoryUsage:!1,averageEdgeLength:v.averageEdgeLength},components:o,visible:!0,edgeTransparency:B9(o.meta),objectTransparency:V9(o.meta),distanceToCamera:0,rendererKey:a.key};e.renderables.push(O),a.addRenderable(O),this.gpuMemoryUsage+=T}async _addComponentGeometry(e,t,i,r,s,n,o){if(t.loaded==null)return 0;const a=this._createComponentBuffers(n);if(N(a))return 0;const l=oue(n),c=this._acquireRenderer(l,o.hasSlicePlane||!1,!1),h=O3.createBuffer(i.count);jz(h.position,i),lue(a.meta,s,h.componentIndex,r);const p=!0,m=c.writerSettings,g=await this.updatingHandles.addPromise(this._extractEdges(m,h,p,!1,r));if(t.loaded==null)return 0;const{regular:v,silhouette:b}=this._createEdgeResources(g),S=(v?v.vao.size:0)+(b?b.vao.size:0),T={regular:v,silhouette:b,transform:e,statistics:{gpuMemoryUsage:S,externalMemoryUsage:!0,averageEdgeLength:g.averageEdgeLength},components:a,visible:!0,edgeTransparency:B9(a.meta),objectTransparency:V9(a.meta),distanceToCamera:0,rendererKey:c.key};return t.renderables.push(T),c.addRenderable(T),S}async _addObjectMergedGeometries(e,t,i,r,s){const n=new Map;let o=0,a=null,l=0;for(let T=0;T<e.geometries.length;T++){const O=e.geometries[T],C=e.geometryRecords[T];if(!C.material.supportsEdges)continue;!a&&C.origin&&(a=C);const M=O.vertexAttributes.get(D.POSITION);l+=M.data.length/M.size,o+=O.edgeIndicesLength}const c=l>=65536?Uint32Array:Uint16Array,h=o?new c(o):null,p=[];let m=0;for(let T=0;T<e.geometries.length;T++){const O=e.geometries[T];if(!e.geometryRecords[T].material.supportsEdges)continue;const C=O.vertexAttributes.get(D.POSITION),M=O.indices.get(D.POSITION);let I=n.get(C.data);if(I==null){I=p.length/3;for(let $=0;$<C.data.length;$+=C.size)p.push(C.data[$+0]),p.push(C.data[$+1]),p.push(C.data[$+2]);n.set(C.data,I)}if(M)for(let $=0;$<O.edgeIndicesLength;$++)h[m++]=I+M[$]}const g=a||e.geometryRecords[0],v=Be(),b=this._computeModelTransformWithLocalOrigin(e,g,v);for(let T=0;T<e.geometryRecords.length;T++)e.geometryRecords[T].origin=b;const S={position:{data:p,size:3},indices:h,modelTransform:v,origin:b};await this.updatingHandles.addPromise(this._addPositionData(t,S,h.length,i[0],r,s))}_acquireRenderer(e,t,i){const r=rP.getKey(e,t,i);let s=this.renderers.get(r);return N(this.strokesTexture)&&(this.strokesTexture=yyt(this.rctx)),s||(s=new rP(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:t,strokesTexture:this.strokesTexture,legacy:i,spherical:this.viewingMode===st.Global}),this.renderers.set(r,s)),s.refCount.increment(),s}_removeRenderable(e){Tyt(e);const t=this.renderers.get(e.rendererKey);if(t){t.removeRenderable(e),t.refCount.decrement(),"origin"in e.transform&&this.localOrigins.release(e.transform.origin),this.gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const t=e.camera.eye,i=e.camera.viewForward,r=F(),s=n=>{const{center:o,radius:a}=n;Bc(r,o,t);const l=ke(r,i),c=l<-a?1/0:l<a?0:l-a;n.renderables.forEach(h=>h.distanceToCamera=c)};this.perObjectData.forEach(s),this.perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,t,i){const r=e.bindRegularEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.regular)return;const o=aue(n.regular.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Dn;e.renderRegularEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}_renderSilhouetteEdges(e,t,i){const r=e.bindSilhouetteEdges(i,t),s=i.transparency;e.forEachRenderable(n=>{if(!n.visible||!n.silhouette)return;const o=aue(n.silhouette.lod.lengths,n.distanceToCamera,i),a="origin"in n.transform?this.localOrigins.getViewMatrix(n.transform.origin):Dn;e.renderSilhouetteEdges(r,n,t,o,a),this.numberOfRenderedEdges[s]+=o},s)}};function Tyt(e){e.regular&&(e.regular.vao.vertexBuffers.instances.dispose(),e.regular.vao.dispose(!1),e.regular.vao=null),e.silhouette&&(e.silhouette.vao.vertexBuffers.instances.dispose(),e.silhouette.vao.dispose(!1),e.silhouette.vao=null)}function Syt(e){let t=null,i=null;for(let r=0;r<e.geometries.length;r++){const s=e.geometryRecords[r];if(s.material.supportsEdges){if(t){if(!Yv(t,s.transformation))return!1}else t=s.transformation;if(!i&&w(s.origin))i=s;else if(w(i==null?void 0:i.origin)&&w(s.origin)&&i.origin.id!==s.origin.id)return!1}}return!0}u([f({constructOnly:!0})],cp.prototype,"rctx",void 0),u([f({constructOnly:!0})],cp.prototype,"renderSR",void 0),u([f({constructOnly:!0})],cp.prototype,"viewingMode",void 0),u([f({constructOnly:!0})],cp.prototype,"techniqueRepository",void 0),u([f({constructOnly:!0})],cp.prototype,"setNeedsRender",void 0),u([f({constructOnly:!0})],cp.prototype,"schedule",void 0),u([f({readOnly:!0})],cp.prototype,"updatingHandles",void 0),u([f({readOnly:!0})],cp.prototype,"updating",null),cp=u([B("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],cp);class cue{constructor(t,i,r){this.center=i,this.radius=r,this.renderables=new Array,this.loaded=t,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}}const uue=Qr();function Eyt(e){const t=e.capabilities.disjointTimerQuery;return N(t)?null:t.timestampBits()>0?new Cyt(t):YW?null:new Ayt(t)}class Cyt{constructor(t){this.timer=t,this.start=t.createQuery(),t.createTimestamp(this.start)}stop(t,i=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(t,i)}_checkQueryResult(t,i){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(t,i),i);if(this.timer.disjoint())return void t(null);const r=this.timer.getResult(this.start),s=this.timer.getResult(this.end);t((s-r)/1e6)}}class Ayt{constructor(t){this.timer=t,this.query=t.createQuery(),YW=!0,this.timer.beginTimeElapsed(this.query)}stop(t,i=50){this.timer.endTimeElapsed(),YW=!1,this._checkQueryResult(t,i)}_checkQueryResult(t,i){const r=this.timer.resultAvailable(this.query),s=this.timer.disjoint();if(!r||s)s?t(null):setTimeout(()=>this._checkQueryResult(t,i),i);else{const n=this.timer.getResult(this.query);t(n/1e6)}}}let YW=!1;var tn;(function(e){e[e.Prepare=0]="Prepare",e[e.Shadowmap=1]="Shadowmap",e[e.Lineardepth=2]="Lineardepth",e[e.Normals=3]="Normals",e[e.SSAO=4]="SSAO",e[e.Opaque=5]="Opaque",e[e.OpaqueEdges=6]="OpaqueEdges",e[e.Transparent=7]="Transparent",e[e.TransparentEdges=8]="TransparentEdges",e[e.Hudvisibility=9]="Hudvisibility",e[e.TransparentTerrain=10]="TransparentTerrain",e[e.Atmosphere=11]="Atmosphere",e[e.Laserline=12]="Laserline",e[e.Occluded=13]="Occluded",e[e.Antialiasing=14]="Antialiasing",e[e.Highlights=15]="Highlights",e[e.HudOccluded=16]="HudOccluded",e[e.HudNotoccluded=17]="HudNotoccluded"})(tn||(tn={}));const Oyt=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class Ryt extends Fv{constructor(){super("total"),this.total=0,this.frameCount=0}}class Myt{constructor(){this._startTime=0,this._lastSample=0,this._enableGPUTimer=0,this.totalTime=new Ryt,this.gpuTime=new Fv("gpu",9),this.renderPassTimings=Oyt.map(t=>new Fv(t))}get elapsedTime(){return performance.now()-this._startTime}enableGPUTimer(){return++this._enableGPUTimer,{remove:sZ(()=>--this._enableGPUTimer)}}prerender(t){this._startTime=this._lastSample=performance.now(),this._enableGPUTimer&&(this._gpuTimer=Eyt(t))}advance(t){const i=performance.now();this.renderPassTimings[t].record(i-this._lastSample),this._lastSample=i}postrender(){w(this._gpuTimer)&&(this._gpuTimer.stop(i=>w(i)&&this.gpuTime.record(i),16),this._gpuTimer=null);const t=performance.now()-this._startTime;this.totalTime.record(t),this.totalTime.total+=t,this.totalTime.frameCount++}}const hue=.9;let iy=class extends ze{constructor(e,t,i,r,s,n,o,a,l){super({}),this._materialRepository=e,this._shaderTechniqueRepository=i,this._rctx=r,this._compositingHelper=s,this._magnifierHelper=n,this._requestRender=o,this._stage=l,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new Myt,this._antialiasing=Iw.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=0,this._handles=new xi,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new cM(this._rctx,i),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new wgt(this._rctx,this._compositingHelper),this._sliceHelper=new jgt,this._shadowMap=new MJ(this._rctx,l.viewingMode,2),this._ssaoHelper=new vTe(i,this._rctx,()=>this._requestRender()),this._highlight=new ygt(i,this._rctx),this._shadowHighlight=new Ggt(this._rctx,l.viewingMode),this._shadowAccumulator=new wa(this._rctx,i,l,c=>{const h=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=h},(c,h,p)=>{c.shadowMap.start(c.camera,h,p),this._renderShadowCascades(nt.MATERIAL_DEPTH_SHADOWMAP_ALL,c.shadowMap),c.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(c.camera,c.contentCamera)},()=>this._requestRender()),this._renderContext=new eit(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new Sgt({renderContext:this._renderContext,shaderTechniqueRepository:i,textureRep:t,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:a}),this.renderPassManager=new ogt(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([xe(()=>this._stage.state.camera,()=>this._requestRender(),an),xe(()=>ur.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(Qt.TRANSPARENT):()=>{},this._requestRender()},si)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._edgeView=Tt(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=ht(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),KU.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===Iw.SMAA&&this._smaaPass.updating||w(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return N(this._edgeView)&&(this._edgeView=new cp({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:e=>this._stage.resourceController.schedule(e)}),this._handles.add(xe(()=>Cn(this._edgeView,e=>e.updating),()=>this._requestRender(),Rr)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return pme(this._bindParameters.ssr.reprojectionMatrix,Dn)}set _reprojectionMatrix(e){eZ(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setRenderParameters(e){const{_shadowMap:t,_ssaoHelper:i,_bindParameters:r}=this;if(e.screenSpaceReflectionsEnabled!==void 0&&r.ssr.enabled!==e.screenSpaceReflectionsEnabled&&(r.ssr.enabled=e.screenSpaceReflectionsEnabled,this._requestRender()),e.shadowMap!==void 0&&t.enabled!==e.shadowMap&&(t.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&t.maxCascades!==e.shadowMapMaxCascades&&(t.maxCascades=e.shadowMapMaxCascades,this._requestRender()),w(e.environment)){w(e.environment.weather)&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=e.weatherVisible,this._renderContext.bindParameters.weather=e.environment.weather,this._renderContext.bindParameters.weatherVisible=e.weatherVisible),e.environment.lighting.ambientOcclusionEnabled!==void 0&&i.enabled!==e.environment.lighting.ambientOcclusionEnabled&&(i.enabled=e.environment.lighting.ambientOcclusionEnabled,this._requestRender()),e.environment.lighting.waterReflectionEnabled!==void 0&&this._waterReflectionEnabled!==e.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=e.environment.lighting.waterReflectionEnabled,this._requestRender());const n=e.environment.lighting.type==="sun";r.enableFillLights!==n&&(r.enableFillLights=n,this._requestRender())}e.background&&this._offscreenRendering.background!==e.background&&(this._offscreenRendering.background=e.background,this._requestRender());const s=e.antialiasingEnabled?Iw.SMAA:Iw.NONE;e.antialiasingEnabled!==void 0&&this._antialiasing!==s&&(this._antialiasing=s,this._requestRender()),e.highQualityTransparency!==void 0&&this._multipassTerrain!==e.highQualityTransparency&&(this._multipassTerrain=e.highQualityTransparency,this._oitEnabled=e.highQualityTransparency&&this._hasOITSupport,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.transparentTerrain!==void 0&&this._transparentTerrain!==e.transparentTerrain&&(this._transparentTerrain=e.transparentTerrain,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(e){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:t,removes:i,updates:r}=e;if(t.length===0&&i.length===0&&r.length===0)return;i.forAll(({id:o})=>this._content.delete(o)),t.forAll(o=>this._content.set(o.id,o));const s=sTe(e);let n=!1;s.forEach((o,a)=>{let l=this._materialRenderers.get(a);if(!l){if(!(o.adds.length>0))return;l=new gTe(this._rctx,this._materialRepository,a),this._materialRenderers.set(a,l)}l.modify(o),l.isEmpty&&(n=!0)}),n&&this._materialRenderers.forEach((o,a)=>{o.isEmpty&&(this._materialRenderers.delete(a),o.dispose())}),this._hasHighlights=On(this._materialRenderers,o=>o.hasHighlights),this._bindParameters.hasOccludees=On(this._materialRenderers,o=>o.hasOccludees),this._hasWater=On(this._materialRenderers,o=>o.hasWater),this._needsTransparentPass=On(this._materialRenderers,o=>o.requiresSlot(Ue.TRANSPARENT_MATERIAL,nt.MATERIAL)),this._hasHUDElements=On(this._materialRenderers,o=>o.requiresSlot(Ue.LINE_CALLOUTS_HUD_DEPTH,nt.MATERIAL)||o.requiresSlot(Ue.HUD_MATERIAL,nt.MATERIAL)||o.requiresSlot(Ue.LABEL_MATERIAL,nt.MATERIAL)),this._requestRender()}updateAnimation(e){return this._hasAnimations=!1,this._materialRenderers.forEach(t=>this._hasAnimations=t.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(e,t,i){this._bindParameters.lighting.groundLightingFactor=t,this._bindParameters.lighting.globalFactor=i,this._bindParameters.lighting.set(e)}render(e,t,i,r){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=Pt.NONE;const s=this._offscreenRendering;s.needLastFrameColorTexture=this.hasWaterReflection,s.advanceCurrentRenderTarget();const n=T1(this._sliceHelper.plane);r===zx.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),t.setGLViewport(this._rctx),this._ensureCameraBindParameters(t,i),this._renderPlugins.prepareRender(),this.performanceInfo.advance(tn.Prepare);const o=this._computeDepthRange(t);this._renderShadowMap(e,t,this._bindParameters.lighting.lightingMainDirection,o),this.performanceInfo.advance(tn.Shadowmap),s.initializeFrame(t),this._ensureBindParameters(t,i),this._renderLinearDepth(),this.performanceInfo.advance(tn.Lineardepth),this._accumulateShadows(o,t,i),this._renderNormal(),this.performanceInfo.advance(tn.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,s.linearDepthTexture,s.normalTexture),this.performanceInfo.advance(tn.SSAO),this._renderContext.pass=nt.MATERIAL,s.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(tn.Opaque);const a=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(a),this._setMultipassEnabled(a),this._setTerrainCulling(a),this._renderEdges(Qt.OPAQUE),this.performanceInfo.advance(tn.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(Ue.VOXEL),this._renderHiddenTransparentEdges();const l=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(tn.Transparent),this._renderGeometryLinearDepth(a);const c=this._renderHUDVisibility();a||this._renderInternalSlot(Ue.LINE_CALLOUTS),this.performanceInfo.advance(tn.Hudvisibility),this._renderEdges(Qt.TRANSPARENT,a),this.performanceInfo.advance(tn.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&c&&(a?this._renderLineCallouts(Zh.Occluded):s.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Zh.Occluded,s.framebuffer),this.performanceInfo.advance(tn.HudOccluded)),this.performanceInfo.advance(tn.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(s.compositeTransparentTerrainOntoMain(this._bindParameters),a&&(this._renderEdges(Qt.OPAQUE),this.performanceInfo.advance(tn.OpaqueEdges),l&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(tn.Transparent),this._renderEdges(Qt.TRANSPARENT),this.performanceInfo.advance(tn.TransparentEdges))),a&&this._renderLineCallouts(Zh.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),s.renderToTargets(()=>{this._renderInternalSlot(Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(Ue.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(Ue.LASERLINES)},s.currentColorTarget,s.mainDepth),this.performanceInfo.advance(tn.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&s.renderTmpAndCompositeToMain(()=>this._renderSlot(Ue.LASERLINES_CONTRAST_CONTROL),this._bindParameters,ra.PremultipliedAlpha),this.performanceInfo.advance(tn.Laserline),this._renderOccluded(),this.performanceInfo.advance(tn.Occluded);const h=r===zx.ON&&this._magnifierHelper.enabled,p=h&&N(e)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):e;this._rctx.bindFramebuffer(p);const m=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,m)&&w(m)&&this._compositingHelper.composite(this._bindParameters,m,ra.None),this.performanceInfo.advance(tn.Antialiasing),this._renderHUD(Zh.NotOccluded,p),this.performanceInfo.advance(tn.HudNotoccluded),this._renderHighlights(p,this._bindParameters),this.performanceInfo.advance(tn.Highlights),h&&this._magnifierHelper.render(this._rctx,this._bindParameters),p!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,ra.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=n,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(e){if(this._hasAnimations||(this._animationTimestep=0),e===on.BACKGROUND){this._rctx.gl.getError();const t=this.performanceInfo.elapsedTime/sgt;this._animationTimestep=Math.max(this._animationTimestep*hue+t*(1-hue),ngt)}}readDepthPixels(e,t,i){const r=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=br.COLOR_BUFFER_BIT|br.DEPTH_BUFFER_BIT|br.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(nt.MATERIAL_DEPTH)}r.readPixels(t[0],t[1],t[2],t[3],tt.RGBA,Vt.UNSIGNED_BYTE,i)}readHUDVisibility(e,t,i,r,s){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(e,t,i,r,tt.RGBA,Vt.UNSIGNED_BYTE,s)}readAccumulatedShadow(e,t){return this._shadowAccumulator.readAccumulatedShadow(e,t)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,t=!1){const i=this._edgeView;w(i)&&i.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,ra.Alpha,t)}_renderShadowMap(e,t,i,r){const s=this._shadowMap;s.enabled&&(s.start(t,i,r),this._shadowHighlight.updateParameters(t,i),this.needsShadowHighlight?(this._renderShadowCascades(nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,n=>s.takeCascadeSnapshotTo(n,AC.Highlight)),s.clear(),this._renderShadowCascades(nt.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,n=>{s.takeCascadeSnapshotTo(n,AC.Default),this._renderGeometryAndTransparentTerrainPass(nt.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(nt.MATERIAL_DEPTH_SHADOWMAP_ALL),s.finish(e),t.setGLViewport(this._rctx))}_renderShadowCascades(e,t=this._shadowMap,i=r=>{}){for(const r of t.getCascades())r.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(r.camera,r.camera),this._renderGeometryAndTransparentTerrainPass(e),i(r)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(nt.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const t=this._renderContext.pass;this._renderContext.pass=nt.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const t=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(nt.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=t}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(nt.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(e){if(!this.needsDepthRange)return UW;const t=qmt(e,this._content,this._stage.layers);return LC(t,this.renderPlugins.queryDepthRange(e)),t.near=Math.max(e.near,t.near),t.far=Math.min(e.far,t.far),t}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.pass=e,this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.pass=e,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(Ue.INTEGRATED_MESH),this._renderSlot(Ue.OPAQUE_TERRAIN),this._renderInternalSlot(Ue.OPAQUE_MATERIAL),this._renderSlot(Ue.OPAQUE_MATERIAL),this._renderSlot(Ue.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(Ue.TRANSPARENT_MATERIAL),this._renderSlot(Ue.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(Ue.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let e=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,e=this._renderInternalSlot(Ue.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),e}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Zh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(Ue.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(Ue.LINE_CALLOUTS)}_renderHUD(e,t){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(e),!0),this._rctx.bindFramebuffer(t),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,ra.PremultipliedAlpha)):e===Zh.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Zh.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._renderInternalSlot(Ue.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(Ue.HUD_MATERIAL),this._renderInternalSlot(Ue.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(e,t){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const i=this._highlight,r=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(nt.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(br.DEPTH_BUFFER_BIT),this._renderHUDElements(Zh.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=r.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(t,e),i.render(this._bindParameters,r,e)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,t,i){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,e,t,i)}_renderOrderIndependentTransparency(e,t){const i=s=>{this._bindParameters.transparencyPassType=s,this._offscreenRendering.renderOITPass(()=>e(),s,t)},r=this._renderContext.pass;this._renderContext.pass=nt.MATERIAL_ALPHA,i(Pt.Alpha),this._renderContext.pass=nt.MATERIAL,i(Pt.Color),i(Pt.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,t),this._bindParameters.transparencyPassType=Pt.NONE,this._renderContext.pass=r,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let e=0;this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&o.renderOccluded===ts.OccludeAndTransparentStencil&&(e|=o.renderOccluded,jO.push(o))});const t=this._offscreenRendering,i=(n,o,a,l,c)=>{(e&o)!=0&&(t.renderToTargets(a,t.tmpColor,t.mainDepth,[0,0,0,0],l,c),t.compositeOccludedOntoMain(this._bindParameters,n))};jO.length!==0&&(this._renderInternalSlot(Ue.OCCLUDER_MATERIAL,jO),i(.5,ts.OccludeAndTransparentStencil,()=>this._renderInternalSlot(Ue.TRANSPARENT_OCCLUDER_MATERIAL,jO),!1,!1),jO.length=0),this._materialRenderers.forEach((n,o)=>{o&&o.isVisible()&&(o.renderOccluded===ts.OccludeAndTransparent||o.renderOccluded===ts.Transparent||o.renderOccluded===ts.Opaque)&&(e|=o.renderOccluded,GO.push(o))});const r=this._renderPlugins.renderOccludedFlags;if(e|=r,!e)return;const s=n=>{this._renderContext.renderOccludedMask=n,r>ts.Occlude&&this._renderSlot(Ue.OCCLUDED_TERRAIN),this._renderInternalSlot(Ue.OPAQUE_MATERIAL,GO),this._renderInternalSlot(Ue.TRANSPARENT_MATERIAL,GO),this._renderInternalSlot(Ue.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,GO),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=nt.MATERIAL,i(.5,ts.OccludeAndTransparent,()=>s(ts.OccludeAndTransparent),!0,Wl.OutlineVisualElementMask),i(.5,ts.Transparent,()=>s(ts.Transparent),!0,Wl.OutlineVisualElementMask),i(1,ts.Opaque,()=>s(ts.Opaque),!0,Wl.OutlineVisualElementMask),GO.length=0}_renderAntiAliasing(e,t){if(e===Iw.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&w(t))return this._smaaPass.render(t),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(e,t){this._bindParameters.camera=e,this._bindParameters.contentCamera=t}_ensureBindParameters(e,t){var r;this._ensureCameraBindParameters(e,t);const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=(r=i.depthTexture)!=null?r:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Dn:(Fs(pue,this._bindParameters.camera.viewMatrix),Fs(due,this._bindParameters.camera.projectionMatrix),hs(FS,pue,due),hs(FS,this._renderContext.lastFrameCamera.viewMatrix,FS),hs(FS,this._renderContext.lastFrameCamera.projectionMatrix,FS),this._reprojectionMatrix=FS),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(e,t){let i=!1;return this._bindParameters.slot=e,w(t)?t.forEach(r=>{if(!r.shouldRender(this._renderContext))return;const s=this._materialRenderers.get(r);w(s)&&(i=s.render(this._renderContext.pass,this._bindParameters)||i)}):this._materialRenderers.forEach((r,s)=>{s.shouldRender(this._renderContext)&&r.render(this._renderContext.pass,this._bindParameters)&&(i=!0)}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=L1e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,t,i,r,s,n,o,a,l,c;return{offscreen:(t=(e=this._offscreenRendering)==null?void 0:e.gpuMemoryUsage)!=null?t:0,highlights:((r=(i=this._highlight)==null?void 0:i.gpuMemoryUsage)!=null?r:0)+((n=(s=this._shadowHighlight)==null?void 0:s.gpuMemoryUsage)!=null?n:0),shadows:(a=(o=this._shadowMap)==null?void 0:o.gpuMemoryUsage)!=null?a:0,ssao:(c=(l=this._ssaoHelper)==null?void 0:l.gpuMemoryUsage)!=null?c:0}}get test(){const e=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:t=>{switch(t){case av.Color:return e._offscreenRendering.colorTexture;case av.LinearDepth:return e._offscreenRendering.linearDepthTexture;case av.Normals:return e._offscreenRendering.normalTexture;case av.ShadowMap:return e._shadowMap.depthTexture;case av.HudVisibility:return e._offscreenRendering.hudVisibilityTexture;case av.Highlight:return e._offscreenRendering.highlightTexture}}}}};var av;u([f()],iy.prototype,"_shadowAccumulator",void 0),u([f()],iy.prototype,"_smaaPass",void 0),u([f()],iy.prototype,"_antialiasing",void 0),u([f()],iy.prototype,"_edgeView",void 0),u([f()],iy.prototype,"updating",null),u([f()],iy.prototype,"isCameraFinal",null),iy=u([B("esri.views.3d.webgl-engine.lib.Renderer")],iy),function(e){e[e.Color=0]="Color",e[e.LinearDepth=1]="LinearDepth",e[e.Normals=2]="Normals",e[e.ShadowMap=3]="ShadowMap",e[e.HudVisibility=4]="HudVisibility",e[e.Highlight=5]="Highlight"}(av||(av={}));const GO=[],jO=[],due=Be(),pue=Be(),FS=Be();class fue{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:je.ONE,dstRGB:je.ZERO,srcAlpha:je.ONE,dstAlpha:je.ZERO},this.blendEquation={mode:Zy.ADD,modeAlpha:Zy.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Lp.BACK,this.frontFace=oC.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=kr.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Lp.FRONT_AND_BACK,func:kr.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Lp.FRONT_AND_BACK,fail:Es.KEEP,zFail:Es.KEEP,zPass:Es.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class Pyt{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,new Error().stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach(i=>{var r;t.set(i,((r=t.get(i))!=null?r:0)+1)}),t.forEach((i,r)=>{const s=r.split(`
`);s.shift(),s.shift(),console.log(`${i}: ${s.shift()}`),s.forEach(n=>console.log("   ",n))})}}}const Iyt={RECORD_ALLOCATIONS:!1};class Lyt{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Pyt(Iyt.RECORD_ALLOCATIONS);this._current.length<Xn.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,i){const r=++this._current[t];this._max[t]=Math.max(r,this._max[t]),this._allocations.add(i)}decrement(t,i){--this._current[t],this._allocations.remove(i)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((t,i)=>t+i,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<Xn.COUNT;++t){const i=this._current[t];i>0&&console.log(`${Xn[t]}: ${i}`)}}this._allocations.print()}}const $yt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var mue,uEe={exports:{}};(mue=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(uEe.exports=mue);const Dyt=uEe.exports;var gue,hEe={exports:{}};gue=hEe,function(e){var t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];t!==void 0&&(gue.exports=t)}();const yue=hEe.exports;var dEe={exports:{}};(function(e){(function(t){var i=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"]}();i!==void 0&&(e.exports=i)})()})(dEe);const Nyt=dEe.exports;var jd=999,_ue=9999,G9=0,j9=1,vue=2,bue=3,wue=4,KD=5,Fyt=6,kyt=7,Uyt=8,xue=9,zyt=10,Tue=11,Byt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function Vyt(){var e,t,i,r=0,s=0,n=jd,o=[],a=[],l=1,c=0,h=0,p=!1,m=!1,g="";return function(X){return a=[],X!==null?b(X.replace?X.replace(/\r\n/g,`
`):X):S()};function v(X){X.length&&a.push({type:Byt[n],data:X,position:h,line:l,column:c})}function b(X){var ne;for(r=0,i=(g+=X).length;e=g[r],r<i;){switch(ne=r,n){case G9:r=I();break;case j9:r=M();break;case vue:r=C();break;case bue:r=$();break;case wue:r=G();break;case Tue:r=q();break;case KD:r=Y();break;case _ue:r=J();break;case xue:r=O();break;case jd:r=T()}ne!==r&&(g[ne]===`
`?(c=0,++l):++c)}return s+=r,g=g.slice(r),a}function S(X){return o.length&&v(o.join("")),n=zyt,v("(eof)"),a}function T(){return o=o.length?[]:o,t==="/"&&e==="*"?(h=s+r-1,n=G9,t=e,r+1):t==="/"&&e==="/"?(h=s+r-1,n=j9,t=e,r+1):e==="#"?(n=vue,h=s+r,r):/\s/.test(e)?(n=xue,h=s+r,r):(p=/\d/.test(e),m=/[^\w_]/.test(e),h=s+r,n=p?wue:m?bue:_ue,r)}function O(){return/[^\s]/g.test(e)?(v(o.join("")),n=jd,r):(o.push(e),t=e,r+1)}function C(){return e!=="\r"&&e!==`
`||t==="\\"?(o.push(e),t=e,r+1):(v(o.join("")),n=jd,r)}function M(){return C()}function I(){return e==="/"&&t==="*"?(o.push(e),v(o.join("")),n=jd,r+1):(o.push(e),t=e,r+1)}function $(){if(t==="."&&/\d/.test(e))return n=KD,r;if(t==="/"&&e==="*")return n=G9,r;if(t==="/"&&e==="/")return n=j9,r;if(e==="."&&o.length){for(;U(o););return n=KD,r}if(e===";"||e===")"||e==="("){if(o.length)for(;U(o););return v(e),n=jd,r+1}var X=o.length===2&&e!=="=";if(/[\w_\d\s]/.test(e)||X){for(;U(o););return n=jd,r}return o.push(e),t=e,r+1}function U(X){for(var ne,re,ye=0;;){if(ne=yue.indexOf(X.slice(0,X.length+ye).join("")),re=yue[ne],ne===-1){if(ye--+X.length>0)continue;re=X.slice(0,1).join("")}return v(re),h+=re.length,(o=o.slice(re.length)).length}}function q(){return/[^a-fA-F0-9]/.test(e)?(v(o.join("")),n=jd,r):(o.push(e),t=e,r+1)}function G(){return e==="."||/[eE]/.test(e)?(o.push(e),n=KD,t=e,r+1):e==="x"&&o.length===1&&o[0]==="0"?(n=Tue,o.push(e),t=e,r+1):/[^\d]/.test(e)?(v(o.join("")),n=jd,r):(o.push(e),t=e,r+1)}function Y(){return e==="f"&&(o.push(e),t=e,r+=1),/[eE]/.test(e)||e==="-"&&/[eE]/.test(t)?(o.push(e),t=e,r+1):/[^\d]/.test(e)?(v(o.join("")),n=jd,r):(o.push(e),t=e,r+1)}function J(){if(/[^\d\w_]/.test(e)){var X=o.join("");return n=Dyt.indexOf(X)>-1?Uyt:Nyt.indexOf(X)>-1?kyt:Fyt,v(o.join("")),n=jd,r}return o.push(e),t=e,r+1}}function Gyt(e){var t=Vyt(),i=[];return i=(i=i.concat(t(e))).concat(t(null))}function jyt(e){return Gyt(e)}function Hyt(e){return e.map(t=>t.type!=="eof"?t.data:"").join("")}const H9=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function qyt(e,t="100",i="300 es"){const r=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if(s.type==="preprocessor"){const n=r.exec(s.data);if(n){const o=n[1].replace(/\s\s+/g," ");if(o===i)return o;if(o===t)return s.data="#version "+i,t;throw new Error("unknown glsl version: "+o)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+i},{type:"whitespace",data:`
`}),null}function Wyt(e,t){for(let i=t-1;i>=0;i--){const r=e[i];if(r.type!=="whitespace"&&r.type!=="block-comment"){if(r.type!=="keyword")break;if(r.data==="attribute"||r.data==="in")return!0}}return!1}function uM(e,t,i,r){r=r||i;for(const s of e)if(s.type==="ident"&&s.data===i)return r in t?t[r]++:t[r]=0,uM(e,t,r+"_"+t[r],r);return i}function pEe(e,t,i="afterVersion"){function r(l,c){for(let h=c;h<l.length;h++){const p=l[h];if(p.type==="operator"&&p.data===";")return h}return null}function s(l){let c=-1,h=0,p=-1;for(let m=0;m<l.length;m++){const g=l[m];if(g.type==="preprocessor"&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++h:g.data.match(/\#endif\s*.*/)&&--h),i!=="afterVersion"&&i!=="afterPrecision"||g.type==="preprocessor"&&/^#version/.test(g.data)&&(p=Math.max(p,m)),i==="afterPrecision"&&g.type==="keyword"&&g.data==="precision"){const v=r(l,m);if(v===null)throw new Error("precision statement not followed by any semicolons!");p=Math.max(p,v)}c<p&&h===0&&(c=m)}return c+1}const n={data:`
`,type:"whitespace"},o=l=>l<e.length&&/[^\r\n]$/.test(e[l].data);let a=s(e);o(a-1)&&e.splice(a++,0,n);for(const l of t)e.splice(a++,0,l);o(a-1)&&o(a)&&e.splice(a,0,n)}function Zyt(e,t,i,r="lowp"){pEe(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Xyt(e,t,i,r,s="lowp"){pEe(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:r.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function Yyt(e,t){let i,r,s=-1;for(let n=t;n<e.length;n++){const o=e[n];if(o.type==="operator"&&(o.data==="["&&(i=n),o.data==="]")){r=n;break}o.type==="integer"&&(s=parseInt(o.data,10))}return i&&r&&e.splice(i,r-i+1),s}function Sue(e,t){const i=Qyt();if(w(i))return i;const r=jyt(e);if(qyt(r,"100","300 es")==="300 es")return e;let s=null,n=null;const o={},a={};for(let l=0;l<r.length;++l){const c=r[l];switch(c.type){case"keyword":t===$u.VERTEX_SHADER&&c.data==="attribute"?c.data="in":c.data==="varying"&&(c.data=t===$u.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(c.data.trim())&&(c.data=c.data.replace(/(2D|Cube|EXT)/g,"")),t===$u.FRAGMENT_SHADER&&c.data==="gl_FragColor"&&(s||(s=uM(r,o,"fragColor"),Zyt(r,s,"vec4")),c.data=s),t===$u.FRAGMENT_SHADER&&c.data==="gl_FragData"){const h=Yyt(r,l+1),p=uM(r,o,"fragData");Xyt(r,p,"vec4",h,"mediump"),c.data=p}else t===$u.FRAGMENT_SHADER&&c.data==="gl_FragDepthEXT"&&(n||(n=uM(r,o,"gl_FragDepth")),c.data=n);break;case"ident":if($yt.includes(c.data)){if(t===$u.VERTEX_SHADER&&Wyt(r,l))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");c.data in a||(a[c.data]=uM(r,o,c.data)),c.data=a[c.data]}}}for(let l=r.length-1;l>=0;--l){const c=r[l];if(c.type==="preprocessor"){const h=c.data.match(/\#extension\s+(.*)\:/);if(h&&h[1]&&H9.includes(h[1].trim())){const g=r[l+1];r.splice(l,g&&g.type==="whitespace"?2:1)}const p=c.data.match(/\#ifdef\s+(.*)/);p&&p[1]&&H9.includes(p[1].trim())&&(c.data="#if 1");const m=c.data.match(/\#ifndef\s+(.*)/);m&&m[1]&&H9.includes(m[1].trim())&&(c.data="#if 0")}}return Jyt(e,Hyt(r))}function Qyt(e){return null}function Jyt(e,t){return t}const Kyt=4294967295;class e0t{constructor(t,i,r,s,n=new Map){this._context=t,this._locations=s,this._uniformBlockBindings=n,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,t||console.error("RenderingContext isn't initialized!"),i.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Li.WEBGL2&&(i=Sue(i,$u.VERTEX_SHADER),r=Sue(r,$u.FRAGMENT_SHADER)),this._vShader=Eue(this._context,$u.VERTEX_SHADER,i),this._fShader=Eue(this._context,$u.FRAGMENT_SHADER,r),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(Xn.Shader,this),zP()&&(this.vertexShader=i,this.fragmentShader=r)}get glName(){if(w(this._glName))return this._glName;if(N(this._vShader))return null;const t=this._context.gl,i=t.createProgram();if(t.attachShader(i,this._vShader),t.attachShader(i,this._fShader),this._locations.forEach((r,s)=>t.bindAttribLocation(i,r,s)),t.linkProgram(i),zP()&&!t.getProgramParameter(i,t.LINK_STATUS)&&console.error(`Could not link shader
validated: ${t.getProgramParameter(i,t.VALIDATE_STATUS)}, gl error ${t.getError()}, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}, info log: ${t.getProgramInfoLog(i)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Li.WEBGL2){const r=t;for(const[s,n]of this._uniformBlockBindings){const o=r.getUniformBlockIndex(i,s);o<Kyt&&r.uniformBlockBinding(i,o,n)}}return this._glName=i,this._context.instanceCounter.increment(Xn.Program,this),i}get hasGLName(){return w(this._glName)}get isCompiled(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return t==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(Xn.Shader,this)),this._fShader&&(t.deleteShader(this._fShader),this._fShader=null),this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(Xn.Program,this))}ref(){++this._refCount}_getUniformLocation(t){return this._nameToUniformLocation[t]===void 0&&(this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t)),this._nameToUniformLocation[t]}hasUniform(t){return this._getUniformLocation(t)!==null}setUniform1i(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1i(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1iv(t,i){Of(this._nameToUniform1v,t,i)&&this._context.gl.uniform1iv(this._getUniformLocation(t),i)}setUniform2iv(t,i){Of(this._nameToUniform2,t,i)&&this._context.gl.uniform2iv(this._getUniformLocation(t),i)}setUniform3iv(t,i){Of(this._nameToUniform3,t,i)&&this._context.gl.uniform3iv(this._getUniformLocation(t),i)}setUniform4iv(t,i){Of(this._nameToUniform4,t,i)&&this._context.gl.uniform4iv(this._getUniformLocation(t),i)}setUniform1f(t,i){const r=this._nameToUniform1[t];r!==void 0&&i===r||(this._context.gl.uniform1f(this._getUniformLocation(t),i),this._nameToUniform1[t]=i)}setUniform1fv(t,i){Of(this._nameToUniform1v,t,i)&&this._context.gl.uniform1fv(this._getUniformLocation(t),i)}setUniform2f(t,i,r){const s=this._nameToUniform2.get(t);s===void 0?(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),this._nameToUniform2.set(t,[i,r])):i===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(t),i,r),s[0]=i,s[1]=r)}setUniform2fv(t,i){Of(this._nameToUniform2,t,i)&&this._context.gl.uniform2fv(this._getUniformLocation(t),i)}setUniform3f(t,i,r,s){const n=this._nameToUniform3.get(t);n===void 0?(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),this._nameToUniform3[t]=[i,r,s]):i===n[0]&&r===n[1]&&s===n[2]||(this._context.gl.uniform3f(this._getUniformLocation(t),i,r,s),n[0]=i,n[1]=r,n[2]=s)}setUniform3fv(t,i){Of(this._nameToUniform3,t,i)&&this._context.gl.uniform3fv(this._getUniformLocation(t),i)}setUniform4f(t,i,r,s,n){const o=this._nameToUniform4.get(t);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),this._nameToUniform4.set(t,[i,r,s,n])):o!==void 0&&i===o[0]&&r===o[1]&&s===o[2]&&n===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(t),i,r,s,n),o[0]=i,o[1]=r,o[2]=s,o[3]=n)}setUniform4fv(t,i){Of(this._nameToUniform4,t,i)&&this._context.gl.uniform4fv(this._getUniformLocation(t),i)}setUniformMatrix3fv(t,i,r=!1){Of(this._nameToUniformMatrix3,t,i)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),r,i)}setUniformMatrix4fv(t,i,r=!1){Of(this._nameToUniformMatrix4,t,i)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),r,i)}stop(){}}function Eue(e,t,i){const r=e.gl,s=r.createShader(t);return r.shaderSource(s,i),r.compileShader(s),zP()&&!r.getShaderParameter(s,r.COMPILE_STATUS)&&(console.error("Compile error in ".concat(t===$u.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(r.getShaderInfoLog(s)),console.error(t0t(i))),s}function t0t(e){let t=2;return e.replace(/\n/g,()=>`
`+i0t(t++)+":")}function i0t(e){return e>=1e3?e.toString():("  "+e).slice(-3)}function Of(e,t,i){const r=e.get(t);return r?eZ(r,i):(e.set(t,Array.from(i)),!0)}class r0t{constructor(t){this._rctx=t,this._store=new AJ}dispose(){this._store.forEach(t=>t.forEach(i=>i.dispose())),this._store.clear()}acquire(t,i,r,s){const n=this._store.get(t,i);if(w(n))return n.ref(),n;const o=new e0t(this._rctx,t,i,r,s);return o.ref(),this._store.set(t,i,o),o}get test(){let t=0;return this._store.forEach(i=>i.forEach(r=>t+=r.hasGLName?2:1)),{cachedWebGLObjects:t}}}function Cue(e,t){const i=new Xr(e,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},{target:Ot.TEXTURE_2D,wrapMode:Ft.CLAMP_TO_EDGE,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1});function r(T,O){const C=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${t?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,M=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `,I=e.programCache.acquire(C,M,new Map([["position",0]])),$=new Float32Array(6);jq(T,$,3);const U=new Float32Array(6);return jq(O,U,3),e.useProgram(I),I.setUniform3f("u_highA",$[0],$[2],$[4]),I.setUniform3f("u_lowA",$[1],$[3],$[5]),I.setUniform3f("u_highB",U[0],U[2],U[4]),I.setUniform3f("u_lowB",U[1],U[3],U[5]),I}const s=Ai.createVertex(e,Gi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new pn(e,new Map([["position",0]]),{geometry:[new ko("position",2,Ct.UNSIGNED_SHORT,0,4)]},{geometry:s}),o=Ke(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),a=Ke(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),l=r(o,a),c=e.getBoundFramebufferObject(),{x:h,y:p,width:m,height:g}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.bindVAO(n),e.drawArrays(Yt.TRIANGLE_STRIP,0,4);const v=new Uint8Array(4);i.readPixels(0,0,1,1,tt.RGBA,Vt.UNSIGNED_BYTE,v),l.dispose(),n.dispose(!1),s.dispose(),i.dispose(),e.setViewport(h,p,m,g),e.bindFramebuffer(c);const b=(o[2]-a[2])/25,S=hJ(v);return Math.abs(b-S)}var Aue,Oue,Rue,fEe={exports:{}};function s0t(e){var v,b,S,T,O;if(!e.gl)return!1;if(e.type===Li.WEBGL1)return!(!((v=e.capabilities.textureFloat)!=null&&v.textureFloat)||!((b=e.capabilities.colorBufferFloat)!=null&&b.textureFloat));if(!(((S=e.capabilities.textureFloat)==null?void 0:S.textureFloat)&&((T=e.capabilities.colorBufferFloat)==null?void 0:T.textureFloat)&&((O=e.capabilities.colorBufferFloat)==null?void 0:O.floatBlend)))return!1;const t=new Xr(e,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},{target:Ot.TEXTURE_2D,wrapMode:Ft.CLAMP_TO_EDGE,pixelFormat:tt.RGBA,dataType:Vt.FLOAT,internalFormat:Mt.RGBA32F,samplingMode:mt.NEAREST,width:1,height:1}),i=Ai.createVertex(e,Gi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new pn(e,new Map([["a_pos",0]]),{geometry:[new ko("a_pos",2,Ct.UNSIGNED_SHORT,0,4)]},{geometry:i}),s=`
  precision highp float;
  attribute vec2 a_pos;

  void main() {
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,n=`
   precision highp float;

   void main() {
    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
   }
  `,o=e.programCache.acquire(s,n,new Map([["a_pos",0]]));e.useProgram(o);const a=e.getBoundFramebufferObject(),{x:l,y:c,width:h,height:p}=e.getViewport();e.bindFramebuffer(t),e.setViewport(0,0,1,1),e.bindVAO(r),e.drawArrays(Yt.TRIANGLE_STRIP,0,4);const m=ni({blending:axe});e.setPipelineState(m),e.drawArrays(Yt.TRIANGLE_STRIP,0,4),fEe.exports.init(e);const g=e.gl.getError();return e.setViewport(l,c,h,p),e.bindFramebuffer(a),o.dispose(),r.dispose(!1),i.dispose(),t.dispose(),g!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}Aue=fEe,Oue=function(){var e=function(b){window.console&&window.console.log&&window.console.log(b)},t=function(b){window.console&&window.console.error?window.console.error(b):e(b)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},r=null,s=null;function n(b){if(r==null)for(var S in r={},s={},b)typeof b[S]=="number"&&(r[b[S]]=S,s[S]=b[S])}function o(){if(r==null)throw"WebGLDebugUtils.init(ctx) not called"}function a(b){return o(),r[b]!==void 0}function l(b){o();var S=r[b];return S!==void 0?"gl."+S:"/*UNKNOWN WebGL ENUM*/ 0x"+b.toString(16)}function c(b,S,T,O){var C;if((C=i[b])!==void 0&&(C=C[S])!==void 0&&C[T]){if(typeof C[T]=="object"&&C[T].enumBitwiseOr!==void 0){for(var M=C[T].enumBitwiseOr,I=0,$=[],U=0;U<M.length;++U){var q=s[M[U]];(O&q)!=0&&(I|=q,$.push(l(q)))}return I===O?$.join(" | "):l(O)}return l(O)}return O===null?"null":O===void 0?"undefined":O.toString()}function h(b,S){for(var T="",O=S.length,C=0;C<O;++C)T+=(C==0?"":", ")+c(b,O,C,S[C]);return T}function p(b,S,T){b.__defineGetter__(T,function(){return S[T]}),b.__defineSetter__(T,function(O){S[T]=O})}function m(b,S,T,O){O=O||b,n(b),S=S||function(q,G,Y){for(var J="",X=Y.length,ne=0;ne<X;++ne)J+=(ne==0?"":", ")+c(G,X,ne,Y[ne]);t("WebGL error "+l(q)+" in "+G+"("+J+")")};var C={};function M(q,G){return function(){T&&T(G,arguments);var Y=q[G].apply(q,arguments),J=O.getError();return J!=0&&(C[J]=!0,S(J,G,arguments)),Y}}var I={};for(var $ in b)if(typeof b[$]=="function")if($!="getExtension")I[$]=M(b,$);else{var U=M(b,$);I[$]=function(){return m(U.apply(b,arguments),S,T,O)}}else p(I,b,$);return I.getError=function(){for(var q in C)if(C.hasOwnProperty(q)&&C[q])return C[q]=!1,q;return b.NO_ERROR},I}function g(b){var S=b.getParameter(b.MAX_VERTEX_ATTRIBS),T=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,T);for(var O=0;O<S;++O)b.disableVertexAttribArray(O),b.vertexAttribPointer(O,4,b.FLOAT,!1,0,0),b.vertexAttrib1f(O,0);b.deleteBuffer(T);var C=b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS);for(O=0;O<C;++O)b.activeTexture(b.TEXTURE0+O),b.bindTexture(b.TEXTURE_CUBE_MAP,null),b.bindTexture(b.TEXTURE_2D,null);for(b.activeTexture(b.TEXTURE0),b.useProgram(null),b.bindBuffer(b.ARRAY_BUFFER,null),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null),b.bindFramebuffer(b.FRAMEBUFFER,null),b.bindRenderbuffer(b.RENDERBUFFER,null),b.disable(b.BLEND),b.disable(b.CULL_FACE),b.disable(b.DEPTH_TEST),b.disable(b.DITHER),b.disable(b.SCISSOR_TEST),b.blendColor(0,0,0,0),b.blendEquation(b.FUNC_ADD),b.blendFunc(b.ONE,b.ZERO),b.clearColor(0,0,0,0),b.clearDepth(1),b.clearStencil(-1),b.colorMask(!0,!0,!0,!0),b.cullFace(b.BACK),b.depthFunc(b.LESS),b.depthMask(!0),b.depthRange(0,1),b.frontFace(b.CCW),b.hint(b.GENERATE_MIPMAP_HINT,b.DONT_CARE),b.lineWidth(1),b.pixelStorei(b.PACK_ALIGNMENT,4),b.pixelStorei(b.UNPACK_ALIGNMENT,4),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),b.UNPACK_COLORSPACE_CONVERSION_WEBGL&&b.pixelStorei(b.UNPACK_COLORSPACE_CONVERSION_WEBGL,b.BROWSER_DEFAULT_WEBGL),b.polygonOffset(0,0),b.sampleCoverage(1,!1),b.scissor(0,0,b.canvas.width,b.canvas.height),b.stencilFunc(b.ALWAYS,0,4294967295),b.stencilMask(4294967295),b.stencilOp(b.KEEP,b.KEEP,b.KEEP),b.viewport(0,0,b.canvas.width,b.canvas.height),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT|b.STENCIL_BUFFER_BIT);b.getError(););}function v(b){var S,T,O=[],C=[],M={},I=1,$=!1,U=[],q=0,G=0,Y=!1,J=0,X={};function ne(K){return typeof K=="function"?K:function(ae){K.handleEvent(ae)}}b.getContext=(T=b.getContext,function(){var K=T.apply(b,arguments);if(K instanceof WebGLRenderingContext){if(K!=S){if(S)throw"got different context";M=le(S=K)}return M}return K});var re=function(K){O.push(ne(K))},ye=function(K){C.push(ne(K))};function pe(K){var ae=K.addEventListener;K.addEventListener=function(we,Re,Ge){switch(we){case"webglcontextlost":re(Re);break;case"webglcontextrestored":ye(Re);break;default:ae.apply(K,arguments)}}}function z(){for(var K=Object.keys(X),ae=0;ae<K.length;++ae)delete X[K]}function j(){++G,$||q==G&&b.loseContext()}function Q(K,ae){var we=K[ae];return function(){if(j(),!$)return we.apply(K,arguments)}}function Z(){for(var K=0;K<U.length;++K){var ae=U[K];ae instanceof WebGLBuffer?S.deleteBuffer(ae):ae instanceof WebGLFramebuffer?S.deleteFramebuffer(ae):ae instanceof WebGLProgram?S.deleteProgram(ae):ae instanceof WebGLRenderbuffer?S.deleteRenderbuffer(ae):ae instanceof WebGLShader?S.deleteShader(ae):ae instanceof WebGLTexture&&S.deleteTexture(ae)}}function ie(K){return{statusMessage:K,preventDefault:function(){Y=!0}}}return pe(b),b.loseContext=function(){if(!$){for($=!0,q=0,++I;S.getError(););z(),X[S.CONTEXT_LOST_WEBGL]=!0;var K=ie("context lost"),ae=O.slice();setTimeout(function(){for(var we=0;we<ae.length;++we)ae[we](K);J>=0&&setTimeout(function(){b.restoreContext()},J)},0)}},b.restoreContext=function(){$&&C.length&&setTimeout(function(){if(!Y)throw"can not restore. webglcontestlost listener did not call event.preventDefault";Z(),g(S),$=!1,G=0,Y=!1;for(var K=C.slice(),ae=ie("context restored"),we=0;we<K.length;++we)K[we](ae)},0)},b.loseContextInNCalls=function(K){if($)throw"You can not ask a lost contet to be lost";q=G+K},b.getNumCalls=function(){return G},b.setRestoreTimeout=function(K){J=K},b;function le(K){for(var ae in K)typeof K[ae]=="function"?M[ae]=Q(K,ae):p(M,K,ae);M.getError=function(){if(j(),!$)for(;$e=S.getError();)X[$e]=!0;for(var $e in X)if(X[$e])return delete X[$e],$e;return M.NO_ERROR};for(var we=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Re=0;Re<we.length;++Re){var Ge=we[Re];M[Ge]=function($e){return function(){if(j(),$)return null;var qe=$e.apply(K,arguments);return qe.__webglDebugContextLostId__=I,U.push(qe),qe}}(K[Ge])}var Pe=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Re=0;Re<Pe.length;++Re)Ge=Pe[Re],M[Ge]=function($e){return function(){return j(),$?null:$e.apply(K,arguments)}}(M[Ge]);var Se=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Re=0;Re<Se.length;++Re)Ge=Se[Re],M[Ge]=function($e){return function(){return j(),!$&&$e.apply(K,arguments)}}(M[Ge]);return M.checkFramebufferStatus=function($e){return function(){return j(),$?M.FRAMEBUFFER_UNSUPPORTED:$e.apply(K,arguments)}}(M.checkFramebufferStatus),M.getAttribLocation=function($e){return function(){return j(),$?-1:$e.apply(K,arguments)}}(M.getAttribLocation),M.getVertexAttribOffset=function($e){return function(){return j(),$?0:$e.apply(K,arguments)}}(M.getVertexAttribOffset),M.isContextLost=function(){return $},M}}return{init:n,mightBeEnum:a,glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:h,makeDebugContext:m,makeLostContextSimulatingCanvas:v,resetToInitialState:g}},(Rue=Oue())!==void 0&&(Aue.exports=Rue);const n0t=Ie.getLogger("esri.views.WebGLDriverTest");function o0t(e){const t=new Xr(e,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},{target:Ot.TEXTURE_2D,wrapMode:Ft.CLAMP_TO_EDGE,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1}),i=`
precision highp float;
attribute vec2 a_pos;
uniform highp sampler2D u_texture;
varying vec4 v_color;

float getBit(in float bitset, in int bitIndex) {
  float offset = pow(2.0, float(bitIndex));
  return mod(floor(bitset / offset), 2.0);
}

void main() {
  vec4 value = texture2D(u_texture, vec2(0.0));
  float bit = getBit(value.x * 255.0, 1);

  v_color = bit * vec4(1.0);
  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
}
`,r=`
precision highp float;
varying vec4 v_color;

void main() {
  gl_FragColor = v_color;
}
`,s=new Uint8Array(4),n=Ai.createVertex(e,Gi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new pn(e,new Map([["a_position",0]]),{geometry:[new ko("a_position",2,Ct.SHORT,0,4)]},{geometry:n}),a=e.programCache.acquire(i,r,new Map([["a_pos",0]]));e.useProgram(a);const l=new bt(e,{target:Ot.TEXTURE_2D,wrapMode:Ft.CLAMP_TO_EDGE,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));a.setUniform1i("u_texture",0),e.bindTexture(l,0);const c=e.getBoundFramebufferObject();e.bindFramebuffer(t),e.useProgram(a);const{x:h,y:p,width:m,height:g}=e.getViewport();e.setViewport(0,0,1,1),e.bindVAO(o),e.drawArrays(Yt.TRIANGLE_STRIP,0,4),e.setViewport(h,p,m,g),t.readPixels(0,0,1,1,tt.RGBA,Vt.UNSIGNED_BYTE,s),a.dispose(),o.dispose(!1),n.dispose(),t.dispose();const v=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return v&&n0t.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),e.bindFramebuffer(c),v}new ko("a_pos",2,Ct.BYTE,0,2);new ko("a_pos",2,Ct.BYTE,0,4),new ko("a_tex",2,Ct.BYTE,2,4);const a0t={geometry:[new ko("a_pos",2,Ct.UNSIGNED_SHORT,0,4)]};async function l0t(e){const t=new Image;if(t.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",t.width=5,t.height=5,await t.decode(),!e.gl)return!0;const i=new Xr(e,{colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.NONE},{target:Ot.TEXTURE_2D,wrapMode:Ft.CLAMP_TO_EDGE,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,samplingMode:mt.NEAREST,width:1,height:1}),r=Ai.createVertex(e,Gi.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),s=new pn(e,new Map([["a_pos",0]]),a0t,{geometry:r}),n=`
  precision highp float;

  attribute vec2 a_pos;
  varying vec2 v_uv;

  void main() {
    v_uv = a_pos;
    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,o=`
  precision highp float;

  varying vec2 v_uv;
  uniform sampler2D u_texture;

  void main() {
    gl_FragColor = texture2D(u_texture, v_uv);
  }
  `,a=e.programCache.acquire(n,o,new Map([["a_pos",0]]));e.useProgram(a);const l=new bt(e,{dataType:Vt.UNSIGNED_BYTE,pixelFormat:tt.RGBA,preMultiplyAlpha:!1,wrapMode:Ft.CLAMP_TO_EDGE,samplingMode:mt.LINEAR},t);e.bindTexture(l,0),a.setUniform1i("u_texture",0);const c=e.getBoundFramebufferObject(),{x:h,y:p,width:m,height:g}=e.getViewport();e.bindFramebuffer(i),e.setViewport(0,0,1,1),e.setClearColor(0,0,0,0),e.setBlendingEnabled(!1),e.clearSafe(br.COLOR_BUFFER_BIT),e.bindVAO(s),e.drawArrays(Yt.TRIANGLE_STRIP,0,4);const v=new Uint8Array(4);return i.readPixels(0,0,1,1,tt.RGBA,Vt.UNSIGNED_BYTE,v),a.dispose(),s.dispose(!1),r.dispose(),i.dispose(),l.dispose(),e.setViewport(h,p,m,g),e.bindFramebuffer(c),t.src="",v[0]===255}class c0t{constructor(t){this.context=t,this._floatBufferBlendWorking=s0t(t),l0t(t).then(i=>this._svgAlwaysPremultipliesAlpha=!i)}get floatBufferBlendWorking(){if(N(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if(N(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if(N(this._doublePrecisionRequiresObfuscation)){const t=Cue(this.context,!1),i=Cue(this.context,!0);this._doublePrecisionRequiresObfuscation=t!==0&&(i===0||t/i>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return N(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=o0t(this.context)),this._ignoresSamplerPrecision}}class Mue{constructor(t,i,r,s,n,o,a,l){this.createQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=s,this.beginTimeElapsed=n,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}function u0t(e,t){if(t.disjointTimerQuery)return null;let i=e.getExtension("EXT_disjoint_timer_query_webgl2");return i&&co(e)?new Mue(()=>e.createQuery(),r=>e.getQueryParameter(r,e.QUERY_RESULT_AVAILABLE),r=>e.getQueryParameter(r,e.QUERY_RESULT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>e.beginQuery(i.TIME_ELAPSED_EXT,r),()=>e.endQuery(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>e.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):(i=e.getExtension("EXT_disjoint_timer_query"),i?new Mue(()=>i.createQueryEXT(),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_AVAILABLE_EXT),r=>i.getQueryObjectEXT(r,i.QUERY_RESULT_EXT),()=>e.getParameter(i.GPU_DISJOINT_EXT),r=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,r),()=>i.endQueryEXT(i.TIME_ELAPSED_EXT),r=>i.queryCounterEXT(r,i.TIMESTAMP_EXT),()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT)):null)}function h0t(e,t){if(t.disjointTimerQuery)return null;if(co(e))return{drawBuffers:e.drawBuffers.bind(e),MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS};if(t.drawBuffers)return null;const i=e.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function d0t(e){if(co(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e)};const t=e.getExtension("ANGLE_instanced_arrays");return t?{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t)}:null}function p0t(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function f0t(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function m0t(e,t){if(co(e))return{MIN:e.MIN,MAX:e.MAX};if(t.blendMinMax)return null;{const i=e.getExtension("EXT_blend_minmax");return i?{MIN:i.MIN_EXT,MAX:i.MAX_EXT}:null}}function g0t(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function y0t(e,t){if(co(e))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:e.HALF_FLOAT,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F};if(e instanceof WebGLRenderingContext){const i=!t.textureHalfFloat&&e.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&!!e.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function _0t(e,t){if(co(e)){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}if(e instanceof WebGLRenderingContext){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),s=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||s?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!s,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}return null}function HO(e,t,i,r,s){if(r&&co(e))return!0;if(t[i])return!1;for(const n of s)if(e.getExtension(n))return!0;return!1}function v0t(e,t){if(!co(e)||t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function b0t(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function w0t(e,t){if(co(e))return{createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),bindVertexArray:e.bindVertexArray.bind(e)};if(t.vao)return null;const i=e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class x0t{constructor(t,i){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=i.disabledExtensions||{},this._debugWebGLExtensions=i.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=h0t(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=d0t(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=w0t(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=p0t(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=f0t(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=g0t(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=u0t(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=y0t(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=_0t(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=m0t(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=HO(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return this._standardDerivatives===null&&(this._standardDerivatives=HO(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return this._shaderTextureLOD===null&&(this._shaderTextureLOD=HO(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return this._fragDepth===null&&(this._fragDepth=HO(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=b0t(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=v0t(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=HO(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(t){return this[t]}}class T0t{constructor(t,i){this.gl=t,this.instanceCounter=new Lyt,this.programCache=new r0t(this),this._state=new fue,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=co(t)?Li.WEBGL2:Li.WEBGL1,this._loadExtensions(),this.configure(i)}configure(t){this._capabilities=new x0t(this.gl,t),this._parameters=this._loadParameters(t);const i=this.gl.getParameter(this.gl.VIEWPORT);this._state=new fue,this._state.viewport={x:i[0],y:i[1],width:i[2],height:i[3]},this._stateTracker=new hHe({setBlending:r=>{if(r){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(r.opRgb,r.opAlpha),this.setBlendFunctionSeparate(r.srcRgb,r.dstRgb,r.srcAlpha,r.dstAlpha);const s=r.color;this.setBlendColor(s.r,s.g,s.b,s.a)}else this.setBlendingEnabled(!1)},setCulling:r=>{r?(this.setFaceCullingEnabled(!0),this.setCullFace(r.face),this.setFrontFace(r.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:r=>{r?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(r.factor,r.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:r=>{r?(this.setDepthTestEnabled(!0),this.setDepthFunction(r.func)):this.setDepthTestEnabled(!1)},setStencilTest:r=>{if(r){this.setStencilTestEnabled(!0);const s=r.function;this.setStencilFunction(s.func,s.ref,s.mask);const n=r.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:r=>{r?(this.setDepthWriteEnabled(!0),this.setDepthRange(r.zNear,r.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:r=>{r?this.setColorMask(r.r,r.g,r.b,r.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:r=>{r?this.setStencilWriteMask(r.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new c0t(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(kt.ARRAY_BUFFER),this.unbindBuffer(kt.ELEMENT_ARRAY_BUFFER),co(this.gl)&&(this.unbindBuffer(kt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(kt.PIXEL_PACK_BUFFER),this.unbindBuffer(kt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(kt.COPY_READ_BUFFER),this.unbindBuffer(kt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,Hh()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(t===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;(t=this._state.program)==null||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,i){for(let r=0;r<t.length;++r)this._state.textureUnitMap[t[r]]=null;i>=0&&(this._state.activeTexture=i)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,i,r,s){t===this._state.blendColor.r&&i===this._state.blendColor.g&&r===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,i,r,s),this._state.blendColor.r=t,this._state.blendColor.g=i,this._state.blendColor.b=r,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,i){t===this._state.blendFunction.srcRGB&&i===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,i),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=i,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,i,r,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===r&&this._state.blendFunction.dstRGB===i&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,i,r,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=r,this._state.blendFunction.dstRGB=i,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,i){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===i||(this.gl.blendEquationSeparate(t,i),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=i,this._stateTracker.invalidateBlending())}setColorMask(t,i,r,s){this._state.colorMask.r===t&&this._state.colorMask.g===i&&this._state.colorMask.b===r&&this._state.colorMask.a===s||(this.gl.colorMask(t,i,r,s),this._state.colorMask.r=t,this._state.colorMask.g=i,this._state.colorMask.b=r,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,i,r,s){this._state.clearColor.r===t&&this._state.clearColor.g===i&&this._state.clearColor.b===r&&this._state.clearColor.a===s||(this.gl.clearColor(t,i,r,s),this._state.clearColor.r=t,this._state.clearColor.g=i,this._state.clearColor.b=r,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(t===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(t===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,i){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===i||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=i,this.gl.polygonOffset(t,i),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(t===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,i,r,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===i&&this._state.scissorRect.width===r&&this._state.scissorRect.height===s||(this.gl.scissor(t,i,r,s),this._state.scissorRect.x=t,this._state.scissorRect.y=i,this._state.scissorRect.width=r,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(t===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,i){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===i||(this.gl.depthRange(t,i),this._state.depthRange.zNear=t,this._state.depthRange.zFar=i,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(t===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,i,r){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFunc(t,i,r),this._state.stencilFunction.face=Lp.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,i,r,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===i&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,i,r,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=i,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,i,r){this._state.stencilOperation.face===Lp.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOp(t,i,r),this._state.stencilOperation.face=Lp.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,i,r,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===i&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,i,r,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=i,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,i=!1){const r=this._state.activeTexture;return t>=0&&(i||t!==this._state.activeTexture)&&(this.gl.activeTexture(I6+t),this._state.activeTexture=t),r}clear(t){t&&this.gl.clear(t)}clearSafe(t,i=255){t&&(t&br.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&br.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&br.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(i),this.gl.clear(t))}drawArrays(t,i,r){if(Hh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Pue(t,r)),this.gl.drawArrays(t,i,r),Hh()){const s=Wse(this);s&&console.error("drawArrays:",s)}}drawElements(t,i,r,s){var n;if(Hh()&&(this._numOfDrawCalls++,this._numOfTriangles+=Pue(t,i)),this.gl.drawElements(t,i,r,s),Hh()){const o=Wse(this);if(o){const a=this.getBoundVAO(),l=a==null?void 0:a.indexBuffer,c=a==null?void 0:a.vertexBuffers,h={indexBuffer:l,vertexBuffers:c},p={mode:t,count:i,type:r,offset:s},m=(n=Cn(l,b=>b.size))!=null?n:0,g=s+i,v=m<g?`. Buffer is too small. Attempted to draw index ${g} of ${m}`:"";console.error(`drawElements: ${o}${v}`,{args:p,vao:h})}}}logInfo(){Hh()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){Hh()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(t,i,r,s){r=Math.max(Math.round(r),1),s=Math.max(Math.round(s),1);const n=this._state.viewport;n.x===t&&n.y===i&&n.width===r&&n.height===s||(n.x=t,n.y=i,n.width=r,n.height=s,this.gl.viewport(t,i,r,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var i,r;this._state.program!==t&&((i=this._state.program)==null||i.stop(),this._state.program=t,this.gl.useProgram((r=t==null?void 0:t.glName)!=null?r:null))}bindTexture(t,i,r=!1){(i>=this.parameters.maxTextureImageUnits||i<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[i];return N(t)||t.glName==null?(w(s)&&(this.setActiveTexture(i,r),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[i]=null,s):r||s!==t?(this.setActiveTexture(i,r),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[i]=t,s):(t.isDirty&&(this.setActiveTexture(i,r),t.applyChanges()),s)}unbindTexture(t){if(!N(t))for(let i=0;i<this.parameters.maxTextureImageUnits;i++)this._state.textureUnitMap[i]===t&&(this.bindTexture(null,i),this._state.textureUnitMap[i]=null)}bindFramebuffer(t,i=!1){if(i||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if(N(t))return this.gl.bindFramebuffer(oo.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(oo.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,i,r=!1){const s=i===oo.READ_FRAMEBUFFER,n=s?this._state.readFramebuffer:this._state.drawFramebuffer;(r||n!==t)&&(N(t)?this.gl.bindFramebuffer(i,null):t.initializeAndBind(i),s?this._state.readFramebuffer=$t(t,null):this._state.drawFramebuffer=$t(t,null))}blitFramebuffer(t,i,r=0,s=0,n=t.width,o=t.height,a=0,l=0,c=i.width,h=i.height,p=br.COLOR_BUFFER_BIT,m=mt.NEAREST){this.bindFramebufferSeparate(t,oo.READ_FRAMEBUFFER),this.bindFramebufferSeparate(i,oo.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(r,s,n,o,a,l,c,h,p,m)}bindBuffer(t,i){if(t)switch(i!=null||(i=t.bufferType),i){case kt.ARRAY_BUFFER:this._state.vertexBuffer=uc(this.gl,t,i,this._state.vertexBuffer);break;case kt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=uc(this.gl,t,i,this._state.indexBuffer);break;case kt.UNIFORM_BUFFER:this._state.uniformBuffer=uc(this.gl,t,i,this._state.uniformBuffer);break;case kt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=uc(this.gl,t,i,this._state.pixelPackBuffer);break;case kt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=uc(this.gl,t,i,this._state.pixelUnpackBuffer);break;case kt.COPY_READ_BUFFER:this._state.copyReadBuffer=uc(this.gl,t,i,this._state.copyReadBuffer);break;case kt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=uc(this.gl,t,i,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const i=this.gl;t||(i.bindRenderbuffer(i.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(i.bindRenderbuffer(i.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,i){if(i>=this.parameters.maxUniformBufferBindings||i<0)return console.error("Uniform buffer binding point is out of range!"),null;const r=this._state.uniformBufferBindingPoints;let s=r[i];return N(s)&&(s={buffer:null,offset:0,size:0},r[i]=s),s}bindBufferBase(t,i,r){const s=this._getBufferBinding(t,i);N(s)||s.buffer===r&&s.offset===0&&s.size===0||(this.gl.bindBufferBase(t,i,r?r.glName:null),s.buffer=r,s.offset=0,s.size=0)}bindBufferRange(t,i,r,s,n){const o=this._getBufferBinding(t,i);if(!N(o)&&!(o.buffer===r&&o.offset===s&&o.size===n)){if(s%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(t,i,r.glName,s,n),o.buffer=r,o.offset=s,o.size=n}}bindUBO(t,i,r,s){N(i)?this.bindBufferBase(kt.UNIFORM_BUFFER,t,null):(Hh()&&(s!=null?s:i.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),i.initialize(),r!==void 0&&s!==void 0?this.bindBufferRange(kt.UNIFORM_BUFFER,t,i.buffer,r,s):this.bindBufferBase(kt.UNIFORM_BUFFER,t,i.buffer))}unbindUBO(t){for(let i=0,r=this._state.uniformBufferBindingPoints.length;i<r;i++){const s=this._state.uniformBufferBindingPoints[i];w(s)&&s.buffer===t.buffer&&this.bindBufferBase(kt.UNIFORM_BUFFER,i,null)}}unbindBuffer(t){switch(t){case kt.ARRAY_BUFFER:this._state.vertexBuffer=uc(this.gl,null,t,this._state.vertexBuffer);break;case kt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=uc(this.gl,null,t,this._state.indexBuffer);break;case kt.UNIFORM_BUFFER:this._state.uniformBuffer=uc(this.gl,null,t,this._state.uniformBuffer);break;case kt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=uc(this.gl,null,t,this._state.pixelPackBuffer);break;case kt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=uc(this.gl,null,t,this._state.pixelUnpackBuffer);break;case kt.COPY_READ_BUFFER:this._state.copyReadBuffer=uc(this.gl,null,t,this._state.copyReadBuffer);break;case kt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=uc(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){N(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=10){const i=this.gl,r=i.fenceSync(Dq.SYNC_GPU_COMMANDS_COMPLETE,0);let s;this.instanceCounter.increment(Xn.Sync,r),i.flush();do await AE(t),s=i.clientWaitSync(r,0,0);while(s===b5.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(Xn.Sync,r),i.deleteSync(r),s===b5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=oo.FRAMEBUFFER){return t===oo.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(kt.ARRAY_BUFFER),this.unbindBuffer(kt.ELEMENT_ARRAY_BUFFER),co(this.gl)&&(this.unbindBuffer(kt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(kt.PIXEL_PACK_BUFFER),this.unbindBuffer(kt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(kt.COPY_READ_BUFFER),this.unbindBuffer(kt.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(je.ONE,je.ZERO),this.setBlendEquation(Zy.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Lp.BACK),this.setFrontFace(oC.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(kr.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(kr.ALWAYS,0,0),this.setStencilOp(Es.KEEP,Es.KEEP,Es.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var r,s,n,o,a,l;const t=this.gl,i=this.capabilities.vao;i&&i.bindVertexArray(null);for(let c=0;c<this.parameters.maxVertexAttributes;c++)t.disableVertexAttribArray(c);if(this._state.vertexBuffer?t.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):t.bindBuffer(kt.ARRAY_BUFFER,null),this._state.indexBuffer?t.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):t.bindBuffer(kt.ELEMENT_ARRAY_BUFFER,null),co(t)){this._state.uniformBuffer?t.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):t.bindBuffer(kt.UNIFORM_BUFFER,null);for(let c=0;c<this._parameters.maxUniformBufferBindings;c++){const h=this._state.uniformBufferBindingPoints[c];if(w(h)){const{buffer:p,offset:m,size:g}=h;p!==null?m===0&&g===0?t.bindBufferBase(kt.UNIFORM_BUFFER,c,p.glName):t.bindBufferRange(kt.UNIFORM_BUFFER,c,p.glName,m,g):t.bindBufferBase(kt.UNIFORM_BUFFER,c,null)}}this._state.pixelPackBuffer?t.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):t.bindBuffer(kt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?t.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):t.bindBuffer(kt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?t.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):t.bindBuffer(kt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?t.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):t.bindBuffer(kt.COPY_WRITE_BUFFER,null),t.bindFramebuffer(oo.READ_FRAMEBUFFER,null),t.readBuffer(t.BACK),this._state.readFramebuffer&&(t.bindFramebuffer(oo.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),t.readBuffer(Tu.COLOR_ATTACHMENT0)),t.bindFramebuffer(oo.DRAW_FRAMEBUFFER,(s=(r=this._state.drawFramebuffer)==null?void 0:r.glName)!=null?s:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,t.bindFramebuffer(oo.FRAMEBUFFER,(o=(n=this._state.drawFramebuffer)==null?void 0:n.glName)!=null?o:null);if(i&&this._state.vertexArrayObject){const c=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(c)}t.useProgram((l=(a=this._state.program)==null?void 0:a.glName)!=null?l:null),t.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),t.bindRenderbuffer(t.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?t.enable(this.gl.BLEND):t.disable(this.gl.BLEND),t.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),t.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),t.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),t.clearDepth(this._state.clearDepth),t.clearStencil(this._state.clearStencil),t.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),t.cullFace(this._state.cullFace),t.depthFunc(this._state.depthFunction),t.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),t.depthMask(this._state.depthWrite),t.frontFace(this._state.frontFace),t.lineWidth(1),this._state.faceCulling===!0?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),t.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),t.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),t.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),t.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),t.stencilMask(this._state.stencilWriteMask);for(let c=0;c<this.parameters.maxTextureImageUnits;c++){t.activeTexture(I6+c),t.bindTexture(Ot.TEXTURE_2D,null),t.bindTexture(Ot.TEXTURE_CUBE_MAP,null),co(t)&&(t.bindTexture(Ot.TEXTURE_3D,null),t.bindTexture(Ot.TEXTURE_2D_ARRAY,null));const h=this._state.textureUnitMap[c];w(h)&&t.bindTexture(h.descriptor.target,h.glName)}t.activeTexture(I6+this._state.activeTexture),t.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===Li.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var a;const i=this.capabilities.textureFilterAnisotropic,r=(a=t.maxAnisotropy)!=null?a:1/0,s=co(this.gl),n=this.gl,o={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),r):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:s?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:s?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:s?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:s?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:s?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:s?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:s?n.getParameter(n.MAX_SAMPLES):1};return bt.TEXTURE_UNIT_FOR_UPDATES=o.maxTextureImageUnits-1,o}}function uc(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function Pue(e,t){switch(e){case Yt.POINTS:return 2*t;case Yt.TRIANGLES:return t/3;case Yt.TRIANGLE_STRIP:case Yt.TRIANGLE_FAN:return t-2;default:return 0}}class S0t extends T0t{constructor(t,i,r){super(t,i),this.newCache=r,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(t,i,r,s){this.useProgram(t.program);const n=w(r)?r.slot:null;return t.bindPipelineState(this,n,s),w(i)&&w(r)&&t.bindPass(i,r),t.program}get test(){return this.programCache.test}}const mEe=Ie.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let C2=class extends ze{constructor(e,t,i){super({}),this._stage=e,this._techniqueRepository=t,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new ks,this._frameTask=e.resourceController.scheduler.registerTask(It.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(Kp.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return N(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(EI,new PJ)),this._textureTechnique}acquire(e){const t=this._textures.get(e);return t?(t.ref(),$t(t.loadingPromise,t)):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(t=>{const i=t.texture.frameUpdate(this._rctx,this.textureTechnique,t.previousToken);i>=0&&i!==t.previousToken&&(t.previousToken=i,e=!0)}),e&&this.events.emit("changed",on.BACKGROUND)}_createNewRef(e){const t=this._stage.getObject(e);if(N(t))return At(t!==void 0),null;const i=t.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),r=new E0t(e,()=>{this._frameTask.schedule(()=>{r.isUnreferenced&&t.unload()})});return this._textures.set(e,r),r.ref(),w(t.glTexture)?(this._updateGLTexture(r,t.glTexture),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r):(this._loadingCount++,r.loadingPromise=this._stage.schedule(()=>{const s=t.load(this._rctx,()=>this.textureTechnique),n=a=>(this._loadingCount--,r.loadingPromise=null,this._updateGLTexture(r,a),t.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:t,previousToken:-1}),r),o=a=>(this._loadingCount--,r.loadingPromise=null,Cs(a)||mEe.error(a),null);return ah(s)?s.then(n,o):n(s)}),r.loadingPromise)}_updateGLTexture(e,t){e.glTexture=t,this.events.emit("changed",on.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};u([f()],C2.prototype,"_loadingCount",void 0),u([f()],C2.prototype,"_frameTask",void 0),u([f()],C2.prototype,"updating",null),C2=u([B("esri.views.3d.webgl-engine.lib.TextureRepository")],C2);class E0t{constructor(t,i){this.id=t,this._release=i,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(mEe.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}const C0t=Ie.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let hM=class extends ze{constructor(){super(...arguments),this._data=new Array,this._state=Ac.NOT_LOADED}dispose(){this._state=Ac.NOT_LOADED,this._data.forEach(e=>e.dispose()),this._data.length=0}get updating(){return this._state===Ac.LOADING}get resourceState(){return this._state}loadTextures(e){const t=[tr("esri/images/materials/water/normals.jpg"),tr("esri/images/materials/water/perturbation.jpg")];this._state=Ac.LOADING,Promise.all(t.map(i=>Qp(i))).then(i=>{i.forEach(r=>this._data.push(new bt(e,{target:Ot.TEXTURE_2D,pixelFormat:tt.RGBA,dataType:Vt.UNSIGNED_BYTE,wrapMode:Ft.REPEAT,samplingMode:mt.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:r.width,height:r.height},r))),this._state=Ac.LOADED}).catch(i=>{C0t.error("Failed to load textures for water material.",i),this._state=Ac.NOT_LOADED})}bind(e){this._state===Ac.LOADED&&(e.bindTexture("texWaveNormal",this._data[0]),e.bindTexture("texWavePerturbation",this._data[1]))}};u([f()],hM.prototype,"_state",void 0),u([f({type:Boolean,readOnly:!0})],hM.prototype,"updating",null),hM=u([B("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],hM);class A0t extends Ez{constructor(t,i,r,s,n,o){super(),this._rctx=t,this._renderScene=i,this._requestRenderScene=r,this._renderOverlay=s,this._forceCameraHook=n,this._disposeOffscreenBuffers=o,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(t){this._requestRenderScene(on.BACKGROUND);const i=Gp();return this._screenshotQueue.push({settings:t,resolver:i}),i.promise}update(t){for(const i of this._screenshotQueue){if(this.isDisposed){i.resolver.reject();continue}const r={...i.settings,pixelRatio:i.settings.pixelRatio*t.viewCamera.pixelRatio},s=this._renderScreenshot(t,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(t,i,r){if(N(this._renderOverlay))return i;t.width=i.width,t.height=i.height;const s=t.getContext("2d"),n=r.pixelRatio;return s.save(),s.translate(0,i.height),s.scale(1,-1),r.region&&s.translate(-r.region.x,-r.region.y),s.scale(n,n),i=this._renderOverlay(t,i),s.restore(),i}_readbackScreenshot(t,i){return t.resample?this._readbackScreenshotResampled(t,i):this._readbackScreenshotImmediate(t,i)}_readbackScreenshotResampled(t,i){const{framebufferWidth:r,framebufferHeight:s,region:n,resample:o}=t,a=this._ensureScreenshotEncodeCanvas();let l=j8(r,s,a);this._rctx.gl.readPixels(0,0,r,s,tt.RGBA,Ct.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),i(),l=this._renderScreenshotOverlay(a,l,{...t,region:null});const c=j8(n.width,n.height,a);return Rst(l,c,!0,o.region.x,s-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(t,i){const{framebufferHeight:r,region:s}=t,n=this._ensureScreenshotEncodeCanvas(),o=j8(s.width,s.height,n);return this._rctx.gl.readPixels(s.x,r-(s.y+s.height),s.width,s.height,tt.RGBA,Ct.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),i(),this._renderScreenshotOverlay(n,o,t)}_renderScreenshot(t,i){let r=null;const s=t.viewCamera,{framebufferWidth:n,framebufferHeight:o}=i;let a=!1;const l=i.disableDecorations&&t.frameHasDecorations,c=n!==s.fullWidth||o!==s.fullHeight,h=i.ignorePadding&&s.pixelRatio!==i.pixelRatio,p=c||l||h;if(p){const v=s.clone();if(i.ignorePadding){const T=cU(v.padding);for(let O=0;O<4;O++)T[O]=Math.round(T[O]/v.pixelRatio*i.pixelRatio);v.padding=T}v.fullWidth=n,v.fullHeight=o,v.pixelRatio=i.pixelRatio;const b=s.fovX-v.fovX,S=s.fovY-v.fovY;b<0&&b<S?v.fovX=s.fovX:S<0&&S<b&&(v.fovY=s.fovY),this._forceCameraHook(v),a=!0,r=new Xr(this._rctx,{width:v.fullWidth,height:v.fullHeight,colorTarget:Ss.TEXTURE,depthStencilTarget:Zi.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(r,v,i.disableDecorations?zx.OFF:zx.ON),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),ht(r)},g=this._readbackScreenshot(i,m);if(m(),p&&!this._rctx.contextAttributes.alpha)for(let v=3;v<g.data.length;v+=4)g.data[v]=255;return a&&this._forceCameraHook(s),g}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const Iue=Ie.getLogger("esri.views.3d.webgl-engine.parts.View");let Qo=class extends Sz(ze){constructor(e){super({}),this.events=new ks,this.waterTextureRepository=new hM,this._magnifierHelper=new E2,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),xe(()=>{var t;return(t=this.waterTextureRepository)==null?void 0:t.updating},()=>this.requestRender(),si),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new bTe(this._rctx),this._shaderTechniqueRepository=new Gxe({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new C2(e,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",t=>this.requestRender(t)),this._materialRepository=new jxe(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new zmt(this._rctx,this._shaderTechniqueRepository),this._renderer=new iy(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,t=>this.requestRender(t),(t,i)=>e.schedule(t,i),e),this._screenshotManager=new A0t(this._rctx,(t,i,r)=>this._renderer.render(t,i,i,r),t=>this.requestRender(t),e.options.screenshot.renderOverlay,t=>this.events.emit("force-camera-for-screenshot",t),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=Ln(this._frameTask),this._shaderTechniqueRepository=ht(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const e=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:e.getUsedTextureMemory!==void 0?e.getUsedTextureMemory():void 0,renderbufferMemory:e.getUsedRenderbufferMemory!==void 0?e.getUsedRenderbufferMemory():void 0,VBOMemory:e.getUsedVBOMemory!==void 0?e.getUsedVBOMemory():void 0}}requestRender(e=on.UPDATE){e===on.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}updateLightSources(e,t,i){this._renderer.updateLightSources(e,t,i),this.requestRender()}setRenderParameters(e){e.idleSuspend!==void 0&&this._idleSuspend!==!!e.idleSuspend&&(this._idleSuspend=!!e.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(e)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(e){this._renderer.modify(e),e.clear()}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(e){return this._renderer.readAccumulatedShadow(e[0],e[1])}readHUDVisibility(e,t,i,r,s){this._renderer.readHUDVisibility(e,t,i,r,s)}getMinimalDepthForArea(e,t,i,r,s,n=s){const o=r.constrainWindowSize(t,i,s*r.pixelRatio,n*r.pixelRatio),a=this._ensureDepthBuffer(o);this._renderer.readDepthPixels(r,o,a);let l=Number.MAX_VALUE;for(let c=0;c<o[2]*o[3];c++){const h=Hmt(4*c,a,r.nearFar);l>h&&h!==r.nearFar[0]&&h!==r.nearFar[1]&&(l=h)}if(w(e)){const c=e.pickDepth(t*r.pixelRatio,i*r.pixelRatio,r);w(c)&&l>c&&c!==r.nearFar[0]&&c!==r.nearFar[1]&&(l=c)}return l===Number.MAX_VALUE?void 0:l}_ensureDepthBuffer(e){const t=4*e[2]*e[3];return(N(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<t)&&(this._tmpDepthBuffer=new Uint8Array(t)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}async reloadShaders(){ZSe(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(e){const t=e.state,i={viewCamera:t.camera,frameHasDecorations:!1};let r=!1,s=on.BACKGROUND,n=!1;const o={preRender:a=>{r=this.updating,s=this._needsUpdate?on.UPDATE:on.BACKGROUND,e.processSyncLayers();const l=a.time-this._lastAnimationUpdate;(l>this.animationTimestep||w(this.forcedAnimationTime)||r||this._needsRender)&&(this._renderer.updateAnimation({camera:t.camera,dt:l,forcedTime:this.forcedAnimationTime})&&this.requestRender(on.BACKGROUND),this._lastAnimationUpdate=a.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&t.camera.fullWidth>0&&t.camera.fullHeight>0){const a=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,t.camera,t.contentCamera,zx.ON),n=!0,a&&this._renderer.hasWaterReflection&&(this.requestRender(on.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{i.viewCamera=t.camera,i.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(i)},finish:()=>{n&&(this._renderer.finish(s),n=!1)}};this._frameTask=xx(o)}_initializeContext(e){var s;const t=e.options;this._canvas=t.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:t.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:t.stencil==null||t.stencil,powerPreference:"high-performance",preserveDrawingBuffer:(s=t.preserveDrawingBuffer)!=null?s:!1},r=dHe("3d",this._canvas,i);if(N(r)){const n=Ce("esri-force-webgl");Iue.error(n)}else this._rctx=this._newRenderingContext(r,e),this._loadShaderOnlyExtensions(),!t.alpha&&this._rctx.contextAttributes.alpha&&Iue.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&Ce("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(e,t){const i={disabledExtensions:t.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:t.options.debugWebGLExtensions||{},maxAnisotropy:8},r=(s,n)=>t.resourceController.memoryController.newCache(s,n);return new S0t(e,i,r)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return N(this._componentObjectCollection)&&(this._componentObjectCollection=new Nmt(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};u([f({type:Boolean,readOnly:!0})],Qo.prototype,"updating",null),u([Jo()],Qo.prototype,"_rctx",void 0),u([Jo()],Qo.prototype,"_container",void 0),u([Jo()],Qo.prototype,"_canvas",void 0),u([Jo()],Qo.prototype,"_stippleTextureRepository",void 0),u([Jo(),f()],Qo.prototype,"waterTextureRepository",void 0),u([Jo(),f()],Qo.prototype,"_magnifierHelper",void 0),u([Jo(),f()],Qo.prototype,"_textureRepository",void 0),u([Jo()],Qo.prototype,"_compositingHelper",void 0),u([Jo()],Qo.prototype,"_renderer",void 0),u([Jo()],Qo.prototype,"_screenshotManager",void 0),u([Jo()],Qo.prototype,"componentObjectCollection",null),u([Jo()],Qo.prototype,"_componentObjectCollection",void 0),u([f()],Qo.prototype,"_needsUpdate",void 0),u([f()],Qo.prototype,"_needsWaterReflectionUpdate",void 0),Qo=u([B("esri.views.3d.webgl-engine.parts.RenderView")],Qo);var t4;let Ml=t4=class extends Sz(ze){constructor(e){super(e),this._handles=new xi,this._model=new ZF,this._layers=new hi,this._changeSet=new rTe,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Qo(this)),this._frameTask=this.resourceController.scheduler.registerTask(It.STAGE,this),this._handles.add(this._frameTask)}destroy(){Jx.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(e){this._model.add(e),X5(e)&&(e.attachStage(this),this._addLayer(e)),this.renderView.requestRender()}remove(e){N(e)||(this.renderView.requestRender(),this._model.remove(e),X5(e)&&(this._removeLayer(e),e.detachStage()))}addMany(e){w(e)&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){w(e)&&(this._model.removeMany(e),this.renderView.requestRender())}async load(e){N(e)||(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(t=>N(t.glTexture)).map(t=>this.schedule(()=>this._model.has(t)?t.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))}loadImmediate(e){return e.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(e,t){this._model.forEachOfType(e,t)}handleEvent(e,t){this.destroyed||(this._model.dirtySet[e](t),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(e){this._frameTask.processQueue(e),e.done||this._commit()}_commit(){const e=this._model.dirtySet;t4.DebugSettings.logDirtySet&&console.log("Dirty set: "+e.formatDebugInfo()),e.commit(this._changeSet),t4.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(t=>t.id)),console.log("RGs remove: "+this._changeSet.removes.map(t=>t.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(e,t){return this._frameTask.schedule(e,t)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}processSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(t=>{(this._layerSyncSet.has(t.id)||t.updatePolicy===aC.SYNC)&&(e.commitLayer(t.id,this._changeSet),this._layerSyncSet.delete(t.id))});for(const t of this._layerSyncSet)e.commitLayer(t,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commit(),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(e,t,i){const r=this.renderView.renderPlugins.add(e,t,i),s=()=>{Dle(t)&&this.sceneIntersectionHelper.addIntersectionHandler(t)};if(ah(r))return r.then(s);s()}removeRenderPlugin(e){Dle(e)&&this.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderView.renderPlugins.remove(e)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:t=>e._model.test.content.filter(i=>i.type===t).length,model:e._model}}};Ml.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},u([f({constructOnly:!0})],Ml.prototype,"resourceController",void 0),u([f({constructOnly:!0})],Ml.prototype,"options",void 0),u([f({constructOnly:!0})],Ml.prototype,"state",void 0),u([f({constructOnly:!0})],Ml.prototype,"sceneIntersectionHelper",void 0),u([f({readOnly:!0})],Ml.prototype,"viewingMode",null),u([f({constructOnly:!0})],Ml.prototype,"container",void 0),u([f({constructOnly:!0})],Ml.prototype,"renderSR",void 0),u([f({constructOnly:!0})],Ml.prototype,"_handles",void 0),u([f({readOnly:!0})],Ml.prototype,"updating",null),u([f({constructOnly:!0})],Ml.prototype,"_model",void 0),u([Jo(),f()],Ml.prototype,"renderView",void 0),Ml=t4=u([B("esri.views.3d.webgl-engine.Stage")],Ml);function gEe(e){return Zm(e)&&e.intersector===ls.PCL&&!!e.target}function vB(e){return Zm(e)&&e.intersector===ls.I3S&&!!e.target}function O0t(e){return Zm(e)&&e.intersector===ls.TERRAIN&&!!e.target}function yEe(e){return Zm(e)&&e.intersector===ls.OVERLAY&&!!e.target}function xK(e){return Zm(e)&&e.intersector===ls.LOD&&!!e.target}function Lue(e,t){var i;return tz(e)||iz(e)?I3(e.target.object.metadata,t):O0t(e)?(i=t.map)==null?void 0:i.ground:gEe(e)||vB(e)||yEe(e)?I3(e.target,t):null}function Hwt(e,t){const i=QW(e,t);return w(i)&&i.type==="graphic"?i.graphic:null}function QW(e,t){if(N(e))return null;if(tz(e)||iz(e))return $ue(e.target.object.metadata,t);if(gEe(e)){const i=e.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return yEe(e)||xK(e)?$ue(e.target,t):vB(e)?R0t(e.target,t):null}function $ue(e,t){if(N(e)||N(e.graphicUid))return null;const i=I3(e,t);if(N(i))return null;if(i===t.graphics)return N(t.graphicsView)||typeof e.graphicUid!="number"?null:t.graphicsView.getHit(e.graphicUid);const r=t.allLayerViews.find(s=>s.layer===i);return!r||r.suspended||N(e.graphicUid)?null:"getHit"in r?r.getHit(e.graphicUid):null}function R0t(e,t){const i=I3(e,t);if(N(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getGraphicFromIntersectorTarget"in r?P0t(r.getGraphicFromIntersectorTarget(e)):null}function M0t(e,t){const i=I3(e,t);if(N(i))return null;const r=t.allLayerViews.find(s=>s.layer===i);return r&&!r.suspended&&"getAABBFromIntersectorTarget"in r?r.getAABBFromIntersectorTarget(e):null}function P0t(e){return w(e)?{type:"graphic",graphic:e,layer:e.layer}:null}function I3(e,t){return N(e.layerUid)?null:w(t.graphicsView)&&e.layerUid===t.graphicsView.processor.layer.id?t.graphics:t.map.findLayerByUid(e.layerUid)}function qwt(e,t){if(tz(e)||iz(e))return Oy(e.target.object.boundingVolumeWorldSpace.bounds);if(xK(e)){cme(eN,e.transformation);const i=Math.max(eN[0],eN[1],eN[2]);return e.target.baseBoundingSphere.radius*i}return vB(e)?Cn(M0t(e.target,t),i=>.5*Gpe(i)):null}function Wwt(e){return!tz(e)&&!iz(e)&&(xK(e)?e.target.numLodLevels>1:!!vB(e))}const eN=F();async function I0t(e,t){if(e.type==="2d")return e.hitTest(t);const i=await e.hitTest(t);if(i.results.length===0)return i;const r=i.results[0],s=w(r.distance)?r.distance*(1+L0t):r.distance,n=i.results.findIndex(o=>o.distance>s);return n!==-1&&(i.results=i.results.slice(0,n)),i}const L0t=.05;let q9,W9;function $0t(e){const t=R1e(e);for(;t.length>1;){const i=Due(t.shift());if(i.available)return i}return Due(t.shift())}function Due(e){switch(e){case Li.WEBGL1:return D0t();case Li.WEBGL2:return N0t()}}function D0t(){return q9||(q9=U0t()),q9}function N0t(){return W9||(W9=z0t()),W9}class _Ee{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class F0t extends _Ee{constructor(){super(...arguments),this.type=Li.WEBGL1}}class k0t extends _Ee{constructor(){super(...arguments),this.type=Li.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function vEe(e,t){var n;if(e===Li.WEBGL1&&typeof WebGLRenderingContext===void 0||e===Li.WEBGL2&&typeof WebGL2RenderingContext===void 0)return null;const i=document.createElement("canvas");if(!i)return null;let r=w5(i,e,{failIfMajorPerformanceCaveat:!0});if(N(r)&&(r=w5(i,e),w(r)&&(t.majorPerformanceCaveat=!0)),N(r))return r;if(e===Li.WEBGL1){const o=(n=r.getParameter(r.VERSION))==null?void 0:n.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);t.available=a>=.94}}else t.available=!0;t.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),t.supportsVertexShaderSamplers=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);return s&&(t.supportsHighPrecisionFragment=s.precision>0),r}function U0t(){const e=new F0t,t=vEe(Li.WEBGL1,e);return N(t)||(e.supportsElementIndexUint=t.getExtension("OES_element_index_uint")!==null,e.supportsStandardDerivatives=t.getExtension("OES_standard_derivatives")!==null,e.supportsInstancedArrays=t.getExtension("ANGLE_instanced_arrays")!==null,e.supportsTextureFloat=t.getExtension("OES_texture_float")!==null,e.supportsTextureHalfFloat=t.getExtension("OES_texture_half_float")!==null,e.supportsColorBufferFloat=t.getExtension("WEBGL_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=t.getExtension("EXT_color_buffer_half_float")!==null),e}function z0t(){const e=new k0t,t=vEe(Li.WEBGL2,e);return N(t)||(e.supportsColorBufferFloat=t.getExtension("EXT_color_buffer_float")!==null,e.supportsColorBufferFloatBlend=t.getExtension("EXT_float_blend")!==null,e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||t.getExtension("EXT_color_buffer_half_float")!==null),e}function B0t(e){const t=$0t(e);if(!t.available)return new se("webgl:required","WebGL is required but not supported.");if(e==="3d"&&t.majorPerformanceCaveat)return new se("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!t.supportsHighPrecisionFragment)return new se("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!t.supportsVertexShaderSamplers)return new se("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(t.type===Li.WEBGL1){if(!t.supportsElementIndexUint)return new se("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!t.supportsStandardDerivatives)return new se("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!t.supportsInstancedArrays)return new se("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function V0t(e){return e&&"nodeType"in e}function G0t(e){return e&&typeof e.render=="function"}const Nue={component:"esri-component"};let yw=class extends ze{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const t=this._get("node");e!==t&&(e&&e.classList.add(Nue.component),t&&t.classList.remove(Nue.component),this._set("node",e))}castNode(e){return e?typeof e=="string"||V0t(e)?(this._set("widget",null),iU(e)):(G0t(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};u([f({dependsOn:[]})],yw.prototype,"id",null),u([f()],yw.prototype,"node",null),u([pi("node")],yw.prototype,"castNode",null),u([f({readOnly:!0})],yw.prototype,"widget",void 0),yw=u([B("esri.views.ui.Component")],yw);const i4=yw,j0t={left:0,top:0,bottom:0,right:0},bEe={bottom:30,top:15,right:15,left:15},Z9="manual",Tl={ui:"esri-ui",corner:"esri-ui-corner",innerContainer:"esri-ui-inner-container",manualContainer:"esri-ui-manual-container",cornerContainer:"esri-ui-corner-container",topLeft:"esri-ui-top-left",topRight:"esri-ui-top-right",bottomLeft:"esri-ui-bottom-left",bottomRight:"esri-ui-bottom-right"};function H0t(e){return e&&!e._started&&typeof e.postMixInProperties=="function"&&typeof e.buildRendering=="function"&&typeof e.postCreate=="function"&&typeof e.startup=="function"}function X9(e){const t=e,i=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(i===null||i===Object.prototype)&&("component"in t||"index"in t||"position"in t)?e:null}function Y9(e,{top:t,bottom:i,left:r,right:s}){e.style.top=t,e.style.bottom=i,e.style.left=r,e.style.right=s}let ry=class extends ks.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new xi,this.view=null,this._applyViewPadding=()=>{const t=this.container;t&&Y9(t,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const t=this._innerContainer;t&&Y9(t,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([xe(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,si),xe(()=>this.padding,this._applyUIPadding,si)])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(e){const t=this._get("container");e!==t&&(e&&(e.classList.add(Tl.ui),E4e(e),this._attachContainers(e)),t&&(t.classList.remove(Tl.ui),Y9(t,{top:"",bottom:"",left:"",right:""}),Ufe(t)),this._set("container",e))}get height(){const e=this.get("view.height")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.top+t.bottom;return Math.max(e-i,0)}get padding(){return this._get("padding")}set padding(e){e?this._override("padding",e):this._clearOverride("padding")}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...bEe,...e}}get width(){const e=this.get("view.width")||0;if(e===0)return e;const t=this._getViewPadding(),i=t.left+t.right;return Math.max(e-i,0)}add(e,t){let i,r;if(Array.isArray(e))return void e.forEach(n=>this.add(n,t));const s=X9(e);s&&({index:i,position:t,component:e,key:r}=s),t&&typeof t=="object"&&({index:i,key:r,position:t}=t),!e||t&&!this._isValidPosition(t)||this._add(e,t,i,r)}remove(e,t){if(!e)return;if(Array.isArray(e))return e.map(r=>this.remove(r,t));const i=this._find(e);if(i){const r=this._componentToKey;if(r.has(e)&&r.get(e)!==t)return;const s=this._components.indexOf(i);return i.node.parentNode&&i.node.parentNode.removeChild(i.node),this._componentToKey.delete(e),this._components.splice(s,1)[0]}}empty(e){return Array.isArray(e)?e.map(t=>this.empty(t)).reduce((t,i)=>t.concat(i)):(e=e||Z9)===Z9?Array.prototype.slice.call(this._manualContainer.children).filter(t=>!t.classList.contains(Tl.corner)).map(t=>this.remove(t)):this._isValidPosition(e)?Array.prototype.slice.call(this._cornerNameToContainerLookup[e].children).map(this.remove,this):null}move(e,t){if(Array.isArray(e)&&e.forEach(n=>this.move(n,t)),!e)return;let i;const r=X9(e)||X9(t);if(r&&(i=r.index,t=r.position,e=r.component||e),t&&!this._isValidPosition(t))return;const s=this.remove(e);s&&this.add(s,{position:t,index:i})}find(e){if(!e)return null;const t=this._findById(e);return t&&(t.widget||t.node)}getPosition(e){for(const t in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[t].contains(e))return t;return null}_add(e,t,i,r){e instanceof i4||(e=new i4({node:e})),this._place({component:e,position:t,index:i}),this._components.push(e),r&&this._componentToKey.set(e,r)}_find(e){return e?e instanceof i4?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){return this.get("view.padding")||j0t}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Tl.innerContainer),e.classList.add(Tl.cornerContainer);const t=document.createElement("div");t.classList.add(Tl.innerContainer),t.classList.add(Tl.manualContainer);const i=document.createElement("div");i.classList.add(Tl.topLeft),i.classList.add(Tl.corner),e.appendChild(i);const r=document.createElement("div");r.classList.add(Tl.topRight),r.classList.add(Tl.corner),e.appendChild(r);const s=document.createElement("div");s.classList.add(Tl.bottomLeft),s.classList.add(Tl.corner),e.appendChild(s);const n=document.createElement("div");n.classList.add(Tl.bottomRight),n.classList.add(Tl.corner),e.appendChild(n),this._innerContainer=e,this._manualContainer=t;const o=Ov();this._cornerNameToContainerLookup={"top-left":i,"top-right":r,"bottom-left":s,"bottom-right":n,"top-leading":o?r:i,"top-trailing":o?i:r,"bottom-leading":o?n:s,"bottom-trailing":o?s:n},this._positionNameToContainerLookup={manual:t,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const t=e.component,i=e.position||Z9,r=e.index,s=this._positionNameToContainerLookup[i],n=r>-1;if(H0t(t.widget)&&t.widget.startup(),!n)return void s.appendChild(t.node);const o=Array.prototype.slice.call(s.children);if(r===0)return void(s.firstChild?Pee(t.node,s.firstChild):s.appendChild(t.node));r>=o.length?s.appendChild(t.node):Pee(t.node,o[r])}_toPxPosition(e){return{top:this._toPxUnit(e.top),left:this._toPxUnit(e.left),right:this._toPxUnit(e.right),bottom:this._toPxUnit(e.bottom)}}_toPxUnit(e){return e===0?"0":e+"px"}_findByComponent(e){let t,i=null;return this._components.some(r=>(t=r===e,t&&(i=r),t)),i}_findById(e){let t,i=null;return this._components.some(r=>(t=r.id===e,t&&(i=r),t)),i}_findByNode(e){let t,i=null;return this._components.some(r=>(t=r.node===e,t&&(i=r),t)),i}};u([f()],ry.prototype,"container",null),u([f()],ry.prototype,"height",null),u([f({value:bEe})],ry.prototype,"padding",null),u([pi("padding")],ry.prototype,"castPadding",null),u([f()],ry.prototype,"view",void 0),u([f()],ry.prototype,"width",null),ry=u([B("esri.views.ui.UI")],ry);const q0t=ry;function Fue(e,t){return e&&"copyright"in e&&(!t||typeof e.originOf=="function"&&e.originOf("copyright")==="user")}function W0t(e,t){return e.length!==t.length||e.some((i,r)=>i.text!==t[r].text)}function tN(e,t,i){!i||!t||e.find(r=>r.layerView===t&&r.text===i)||e.push({text:i,layerView:t})}function Z0t(e){return e.type==="bing-maps"}const m_=[];let A2=class extends BE{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new zt,this.view=null,this._allLayerViewsChange=t=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(r=>xe(()=>{var s;return[r.suspended,(s=r.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),t&&t.removed&&t.removed.forEach(r=>{this._pendingAttributions.delete(r),this._fetchedAttributionData.delete(r)}),this._updateAttributionItems()},this.handles.add([Fo(()=>{var t;return(t=this.view)==null?void 0:t.allLayerViews},"change",t=>this._allLayerViewsChange(t),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),Jl(()=>{var t;return((t=this.view)==null?void 0:t.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.get("view.allLayerViews");m_.length=0,e?(e.forEach(t=>{var s;if(t.suspended||!((s=t.layer)!=null&&s.attributionVisible))return;const i=t.layer;if(Fue(i,"user"))return void tN(m_,t,i.copyright);if(i.hasAttributionData){if(this._fetchedAttributionData.has(t)){const n=this._fetchedAttributionData.get(t);return void(n?tN(m_,t,this._getDynamicAttribution(n,this.view,i)):Fue(i)&&tN(m_,t,i.copyright))}return void this._fetchAttributionData(t)}const r=i.get("portalItem.accessInformation");tN(m_,t,r||i.copyright)}),W0t(this.items,m_)&&(this.items.removeAll(),this.items.addMany(m_)),m_.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const t=await Xp(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=t.ok?this._createContributionIndex(t.value,Z0t(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,t){const i=e.contributors,r={};if(!i)return r;for(let s=0;s<i.length;s++){const n=i[s],o=n.coverageAreas;if(!o)return;for(const a of o){const l=a.bbox,c=a.zoomMin-(t&&a.zoomMin?1:0),h=a.zoomMax-(t&&a.zoomMax?1:0),p={xmin:l[1],ymin:l[0],xmax:l[3],ymax:l[2],spatialReference:wt.WGS84},m={extent:Ay(p),attribution:n.attribution||"",score:a.score!=null?a.score:100,id:s};for(let g=c;g<=h;g++)r[g]=r[g]||[],r[g].push(m)}}return r.maxKey=Math.max.apply(null,Object.keys(r)),r}_getDynamicAttribution(e,t,i){const{extent:r,scale:s}=t;let n=i.tileInfo.scaleToZoom(s);if(n=Math.min(e.maxKey,Math.round(n)),!r||n==null||n<=-1)return"";const o=e[n],a=aT(r.center.clone().normalize(),t.spatialReference),l={};return o?o.filter(c=>{const h=!l[c.id]&&a&&RZ(c.extent,a);return h&&(l[c.id]=!0),h}).sort((c,h)=>h.score-c.score||c.objectId-h.objectId).map(c=>c.attribution).join(", "):""}};u([f({readOnly:!0,type:zt})],A2.prototype,"items",void 0),u([f({readOnly:!0})],A2.prototype,"state",null),u([f()],A2.prototype,"view",void 0),A2=u([B("esri.widgets.Attribution.AttributionViewModel")],A2);const wEe=A2,g_={base:"esri-attribution esri-widget",poweredBy:"esri-attribution__powered-by",sources:"esri-attribution__sources",open:"esri-attribution--open",sourcesOpen:"esri-attribution__sources--open",link:"esri-attribution__link",widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let Pl=class extends dl{constructor(e,t){super(e,t),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:r})=>this._checkSourceTextOverflow(r))),this.iconClass=g_.widgetIcon,this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new wEe}initialize(){this.own(Fo(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,t)=>(e.includes(t.text)||e.push(t.text),e),[]).join(this.itemDelimiter)}render(){const e={[g_.open]:this._isOpen};return Te("div",{bind:this,class:this.classes(g_.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return Te("div",{class:g_.poweredBy},"Powered by"," ",Te("a",{class:g_.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,t=this._isInteractive,i=t?"0":"",{attributionText:r}=this,s={[g_.sourcesOpen]:e,[g_.interactive]:t};return Te("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(g_.sources,s),innerHTML:r,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let t=!1;const{clientHeight:i,clientWidth:r,scrollWidth:s}=e,n=s>r,o=this._attributionTextOverflowed!==n;if(this._attributionTextOverflowed=n,o&&(t=!0),this._isOpen){const a=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,a&&(this._isOpen=!1,t=!0)}t&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};u([f()],Pl.prototype,"_isOpen",void 0),u([f()],Pl.prototype,"_isInteractive",null),u([f()],Pl.prototype,"_attributionTextOverflowed",void 0),u([f()],Pl.prototype,"_prevSourceNodeHeight",void 0),u([f({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],Pl.prototype,"attributionText",null),u([f()],Pl.prototype,"iconClass",void 0),u([f()],Pl.prototype,"itemDelimiter",void 0),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Pl.prototype,"label",void 0),u([f(),Hl("esri/widgets/Attribution/t9n/Attribution")],Pl.prototype,"messages",void 0),u([Lt("viewModel.view")],Pl.prototype,"view",void 0),u([f({type:wEe})],Pl.prototype,"viewModel",void 0),u([Eu()],Pl.prototype,"_toggleState",null),Pl=u([B("esri.widgets.Attribution")],Pl);const X0t=Pl,Y0t="esri.widgets.CompassViewModel";let _w=class extends Dve(ze){constructor(e){super(e),this._handles=new xi,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(xe(()=>this.view,this._updateRotationWatcher,si))}destroy(){this._handles=Ln(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const e={};this.view.type==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const t=-e.heading;this.orientation={x:0,y:0,z:t}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?xe(()=>e==null?void 0:e.rotation,this._updateForRotation,si):xe(()=>e==null?void 0:e.camera,this._updateForCamera,si))}};u([f({readOnly:!0})],_w.prototype,"canShowNorth",null),u([f()],_w.prototype,"orientation",void 0),u([f({readOnly:!0})],_w.prototype,"state",null),u([f()],_w.prototype,"view",void 0),_w=u([B(Y0t)],_w);const xEe=_w,y_={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let Yf=class extends dl{constructor(e,t){super(e,t),this.goToOverride=null,this.iconClass=y_.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new xEe}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:t}=this.viewModel,i=t==="disabled",r=(t==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,n={[y_.disabled]:i,[y_.interactive]:!i},o={[y_.northIcon]:r,[y_.rotationIcon]:!r},{messages:a}=this;return Te("div",{bind:this,class:this.classes(y_.base,n),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":a.reset,title:a.reset},Te("span",{"aria-hidden":"true",class:this.classes(y_.icon,o),styles:this._toRotationTransform(e)}),Te("span",{class:y_.text},a.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};u([Lt("viewModel.goToOverride")],Yf.prototype,"goToOverride",void 0),u([f()],Yf.prototype,"iconClass",void 0),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Yf.prototype,"label",void 0),u([f(),Hl("esri/widgets/Compass/t9n/Compass")],Yf.prototype,"messages",void 0),u([Lt("viewModel.view")],Yf.prototype,"view",void 0),u([f({type:xEe})],Yf.prototype,"viewModel",void 0),u([Eu()],Yf.prototype,"_reset",null),Yf=u([B("esri.widgets.Compass")],Yf);const Q0t=Yf;let O2=class extends ze{constructor(e){super(e),this._handles=new xi,this.navigationMode="pan",this.view=null}initialize(){this._handles.add(Jl(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&this.view.type==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};u([f({readOnly:!0})],O2.prototype,"state",null),u([f()],O2.prototype,"navigationMode",void 0),u([f()],O2.prototype,"view",void 0),O2=u([B("esri.widgets.NavigationToggleViewModel")],O2);const TEe=O2,Mh={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let Qf=class extends dl{constructor(e,t){super(e,t),this.iconClass=Mh.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new TEe}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",t=this.get("viewModel.navigationMode")==="pan",i={[Mh.disabled]:e,[Mh.isLayoutHorizontal]:this.layout==="horizontal"},r={[Mh.activeButton]:t},s={[Mh.activeButton]:!t},n=e?-1:0,o=this.messages.toggle;return Te("div",{bind:this,class:this.classes(Mh.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:n,"aria-label":o,title:o},Te("div",{class:this.classes(Mh.button,Mh.panButton,r)},Te("span",{class:Mh.panIcon})),Te("div",{class:this.classes(Mh.button,Mh.rotateButton,s)},Te("span",{class:Mh.rotationIcon})))}_toggle(){this.toggle()}};u([f()],Qf.prototype,"iconClass",void 0),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Qf.prototype,"label",void 0),u([f({value:"vertical"})],Qf.prototype,"layout",null),u([f(),Hl("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Qf.prototype,"messages",void 0),u([Lt("viewModel.view")],Qf.prototype,"view",void 0),u([f({type:TEe})],Qf.prototype,"viewModel",void 0),u([Eu()],Qf.prototype,"_toggle",null),Qf=u([B("esri.widgets.NavigationToggle")],Qf);const J0t=Qf,qO={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let Z_=class extends dl{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const e=this.enabled?0:-1,t={[qO.disabled]:!this.enabled,[qO.interactive]:this.enabled},i={[this.iconClass]:!!this.iconClass};return Te("div",{bind:this,class:this.classes(qO.button,t),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},Te("span",{"aria-hidden":"true",role:"presentation",class:this.classes(qO.icon,i)}),Te("span",{class:qO.iconText},this.title))}_triggerAction(){this.action.call(this)}};u([f()],Z_.prototype,"action",void 0),u([f()],Z_.prototype,"enabled",void 0),u([f()],Z_.prototype,"iconClass",void 0),u([f()],Z_.prototype,"title",void 0),u([Eu()],Z_.prototype,"_triggerAction",null),Z_=u([B("esri.widgets.IconButton")],Z_);const kue=Z_;let R2=class extends ze{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMaxScale");return t===0||e>t}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),t=this.get("view.constraints.effectiveMinScale");return t===0||e<t}};u([f({readOnly:!0})],R2.prototype,"canZoomIn",null),u([f({readOnly:!0})],R2.prototype,"canZoomOut",null),u([f()],R2.prototype,"view",void 0),R2=u([B("esri.widgets.Zoom.ZoomConditions2D")],R2);const K0t=R2;let M2=class extends ze{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};u([f({readOnly:!0})],M2.prototype,"canZoomIn",null),u([f({readOnly:!0})],M2.prototype,"canZoomOut",null),u([f()],M2.prototype,"view",void 0),M2=u([B("esri.widgets.Zoom.ZoomConditions3D")],M2);const e_t=M2;let X_=class extends ze{constructor(e){super(e),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new K0t({view:e}):e.type==="3d"&&(this._zoomConditions=new e_t({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():nG(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():nG(e.goTo({zoomFactor:.5}))}};u([f()],X_.prototype,"_zoomConditions",void 0),u([f({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],X_.prototype,"canZoomIn",void 0),u([f({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],X_.prototype,"canZoomOut",void 0),u([f({readOnly:!0})],X_.prototype,"state",null),u([f()],X_.prototype,"view",null),X_=u([B("esri.widgets.Zoom.ZoomViewModel")],X_);const SEe=X_,WO={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let sy=class extends dl{constructor(e,t){super(e,t),this.iconClass=WO.widgetIcon,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new SEe}initialize(){this._zoomInButton=new kue({action:this.zoomIn.bind(this),iconClass:WO.zoomInIcon}),this._zoomOutButton=new kue({action:this.zoomOut.bind(this),iconClass:WO.zoomOutIcon})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}render(){const e=this.viewModel,t={[WO.horizontalLayout]:this.layout==="horizontal"};return this._zoomInButton.enabled=e.state==="ready"&&e.canZoomIn,this._zoomOutButton.enabled=e.state==="ready"&&e.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,Te("div",{class:this.classes(WO.base,t)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};u([f()],sy.prototype,"iconClass",void 0),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],sy.prototype,"label",void 0),u([f({value:"vertical"})],sy.prototype,"layout",null),u([f(),Hl("esri/widgets/Zoom/t9n/Zoom")],sy.prototype,"messages",void 0),u([Lt("viewModel.view")],sy.prototype,"view",void 0),u([f({type:SEe})],sy.prototype,"viewModel",void 0),sy=u([B("esri.widgets.Zoom")],sy);const t_t=sy,EEe="esri.views.ui.DefaultUI";function i_t(e){return e&&e.view!==void 0}Ie.getLogger(EEe);let r4=class extends q0t{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([xe(()=>this.components,this._componentsWatcher.bind(this),si),xe(()=>this.view,this._updateViewAwareWidgets.bind(this),si)])}_add(e,t,i,r){if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;e=this._createComponent(e)}super._add(e,t,i,r)}_removeComponents(e){e.forEach(t=>{const i=this._find(t);i&&(this.remove(i),i.destroy())})}_updateViewAwareWidgets(e){this.components.forEach(t=>{const i=this._find(t),r=i&&i.widget;i_t(r)&&(r.view=e)})}_componentsWatcher(e,t){this._removeComponents(t),this._addComponents(e),this._adjustPadding(e)}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:t}=this.padding;this.padding=t}}_addComponents(e){this.initialized&&e.forEach(t=>this.add(this._createComponent(t),this._defaultPositionLookup[t]))}_createComponent(e){const t=this._createWidget(e);if(t)return new i4({id:e,node:t})}_createWidget(e){return e==="attribution"?this._createAttribution():e==="compass"?this._createCompass():e==="navigation-toggle"?this._createNavigationToggle():e==="zoom"?this._createZoom():void 0}_createAttribution(){return new X0t({view:this.view})}_createCompass(){return new Q0t({view:this.view})}_createNavigationToggle(){return new J0t({view:this.view})}_createZoom(){return new t_t({view:this.view})}};u([f()],r4.prototype,"components",void 0),r4=u([B(EEe)],r4);const r_t=r4;let s4=class extends r_t{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};u([f()],s4.prototype,"components",void 0),s4=u([B("esri.views.ui.3d.DefaultUI3D")],s4);const CEe=s4,uu=Ie.getLogger("esri.views.SceneView");let _t=class extends Q$e(FGe(JGe(W7e))){constructor(e){super(e),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new Wy({slicePlane:pge},this),this._resourceController=iut(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new oW({view:this}),this.labeler=new cw({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new XE,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new Pw,this.environmentManager=new op,this.extent=null,this.floors=new zt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new Y7e({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new Zlt,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new CEe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new TW,this.voxelWasm=null,this.voxelWasmPromise=null,gIe(),e&&e.environment||(this._defaults.environment=new y2,this.environment=this._defaults.environment);const t=(i=null)=>{w(i)&&i.type===gr.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async r=>{try{await r.when()}catch{}this._updatingChanged()}))};this.handles.add([Fo(()=>{var i;return(i=this.map)==null?void 0:i.allLayers},"after-changes",i=>t(i),{onListenerAdd:()=>t(),onListenerRemove:()=>t(),sync:!0}),this.allLayerViews.on("after-changes",i=>this._updateUpdatingMonitors(i)),xe(()=>this.map,i=>{i&&"load"in i&&i.load&&i.load().catch(()=>{})})]),this.inputManager=new nJe({view:this}),this.stateManager=new bct({view:this})}initialize(){this.groundView=new QGe({view:this}),this._updateUpdatingMonitors();const e=()=>this._updateDefaultToMapOptions();this.handles.add(Fo(()=>{var t;return(t=this.map)==null?void 0:t.allLayers},"after-changes",e,{onListenerAdd:e,onListenerRemove:e})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,t=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=t)},si),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,t=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=t)},si),this.updatingHandles.add(()=>this.qualitySettings.frameRate,t=>JCe(t>0?1e3/Math.ceil(t):0),si),this.updatingHandles.add(()=>{var t;return(t=this.map)==null?void 0:t.ground},e,an),this.updatingHandles.add(()=>{var t,i;return(i=(t=this.map)==null?void 0:t.ground)==null?void 0:i.opacity},()=>this._updateDefaultHitTestOptions(),an),this.handles.add(xe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),Rr))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=Tt(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=Tt(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=Tt(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var e;return(e=this.basemapTerrain)==null?void 0:e.spatialReference}installContentCameraReset(e={sticky:!1}){return this.stateManager.installContentCameraReset(e)}get clippingArea(){if(this.viewingMode==="global")return null;let e=this._userClippingArea||this.get("map.clippingArea");return!(!!this._userClippingArea||this.get("map.clippingEnabled"))||N(e)?(this._clippingArea=null,null):e instanceof zi?this.spatialReference&&(e=iN(e,this.spatialReference),N(e))?(uu.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(e=e.clone(),N(e.intersection(this.groundAndLayersExtent))&&(e.xmin=e.xmax,e.ymin=e.ymax),e.zmin=void 0,e.zmax=void 0,e.equals(this._clippingArea)||(this._clippingArea=e),this._clippingArea):(uu.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(e){this.ready&&this.viewingMode==="global"&&w(e)?uu.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=e}get renderDataExtent(){if(this.state.viewingMode===st.Global)return null;const e=this.renderSpatialReference,t=this.dataExtent;return N(t)||N(e)||t.spatialReference.equals(e)?t:iN(t,e)}get dataExtent(){let e=this.groundAndLayersExtent;const t=this.spatialReference||wt.WGS84,i=iN(this.clippingArea,t);w(i)&&(e=w(e)?e.intersection(i):i);const r=this._get("dataExtent");return w(e)&&e.equals(r)?r:e}get groundAndLayersExtent(){const e=this.spatialReference||wt.WGS84;let t;const i=n=>{const o=iN(n,e);N(o)||(w(t)?t.union(o):t=o.clone())},r=this.basemapTerrain;if(r!=null&&r.spatialReference){const n=r.groundExtent;i(new zi({xmin:n[0],ymin:n[1],zmin:0,xmax:n[2],ymax:n[3],zmax:0,spatialReference:r.spatialReference}))}if(this.map){const n=o=>{!w(o.fullExtent)||o.type==="graphics"&&o.internal||i(o.fullExtent)};this.map.allLayers.forEach(o=>n(o))}if(N(t))return null;t.hasZ?(t.zmin=Math.min(0,t.zmin),t.zmax=Math.max(0,t.zmax)):(t.zmin=0,t.zmax=0);const s=this._get("groundAndLayersExtent");return t.equals(s)?s:t}set environment(e){e!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",e)}castEnvironment(e){return e?e instanceof y2?e:e instanceof u1e?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(e):y2.fromWebsceneEnvironment(e):hn(y2,e):new y2}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||w(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&(N(this.state)||this.state.stationary)}set qualityProfile(e){zF.isValidProfile(e)&&(zF.apply(e,this.qualitySettings),this._set("qualityProfile",e))}get qualityProfile(){return this._get("qualityProfile")||zF.getDefaultProfile()}set slicePlane(e){if(w(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:e}),N(e))return void this._set("slicePlane",null);const t=this.propertiesPool.get("slicePlane");yT(e,t),this._set("slicePlane",t)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?Rge(this.scale,this.spatialReference):0}get heightModelInfo(){const e=this.getDefaultHeightModelInfo();return e!=null?jC.deriveUnitFromSR(e,this.spatialReference):null}get updating(){var r,s,n;if(this.destroyed)return!1;let e=0,t=this.layerViewManager.updating,i=t?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(o=>{if(o.isFulfilled()){if(o.updating){if(t=!0,o.suspended||S3(o))return;++i,e+=o.updatingProgress}}else++i});for(const o of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])w(o)&&o.updating&&(i+=.1,e+=.5*.1);for(const o of[this.deconflictor,this.labeler,this.basemapTerrain])w(o)&&o.updating&&(++i,e+=o.updatingProgress);if(t=!!(t||i>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||((r=this.inputManager)==null?void 0:r.hasPendingInputs)||((n=(s=this.map)==null?void 0:s.allLayers)==null?void 0:n.some(o=>!o.isFulfilled()))),t?(this._numUpdating=Math.max(i,this._numUpdating),e+=this._numUpdating-i):this._numUpdating=0,this._numUpdating>0?e/=this._numUpdating:e=t?0:1,this._get("updatingProgress")!==e){const o=performance.now();if(e<1){const a=Math.min((o-this._lastUpdateTime)/2e3,1);e=this.updatingProgress*(1-a)+e*a}this._set("updatingProgress",e),this._lastUpdateTime=t&&e<1?o:0}return t}get viewingMode(){var i;const e=this._predeterminedViewingMode;if(w(e))return C6(e);const t=this.spatialReference;return t?w((i=this.defaultsFromMap)==null?void 0:i.viewingMode)&&t.equals(this.defaultsFromMap.spatialReference)?C6(this.defaultsFromMap.viewingMode):k5(t,st.Global)?"global":"local":"global"}set viewingMode(e){this.ready?uu.error("#viewingMode","viewingMode cannot be set once view is ready"):e?this._override("viewingMode",e):e===void 0&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new Eut(this)}forceAnimationTime(e){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=e}on(e,t,i,r){return this.viewEvents.on(e,t,i,r)||super.on(e,t)}hasEventListener(e){return super.hasEventListener(e)||this.viewEvents.hasHandler(e)}toMap(e,t){if(!this.ready)return uu.error("#toMap()","Scene view cannot be used before it is ready"),null;const i=t?this.externalToInternalIntersectOptions(t):this._defaultToMapOptions,r=w(i.graphics)&&(w(i.graphics.include)||w(i.graphics.exclude)),s=Ese(e)?Sse(this,e):e,n=gy(s);i.enableDraped=i.include&&!i.include.has(Sp)||i.exclude&&i.exclude.has(Sp);const o=this.sceneIntersectionHelper,a=wd(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=r?Uo.ALL:Uo.MIN,o.intersectIntersectorScreen(n,a,i),r){for(const l of a.results.all){const c=QW(l,this);if(N(c))return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(i.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(e){if(!this.ready)return uu.error("#toScreen()","Scene view cannot be used before it is ready"),null;const t=$t(e.z==null&&mm(this.elevationProvider,e),0);return po(e,kS,this.renderSpatialReference,t),this.state.camera.projectToScreen(kS,Q9),qp(Q9[0],Q9[1])}pixelSizeAt(e){return this.ready?e?(po(e,kS,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(kS)):0:(uu.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(e){const t=this.basemapTerrain.overlayManager;return t?t.overlayPixelSizeInMapUnits(e):1}hitTest(e,t){if(!this.ready)return uu.error("#hitTest()","Scene view cannot be used before it is ready"),null;const i=Ese(e)?Sse(this,e):e,r=ys(i.x,i.y),s=t?this.externalToInternalIntersectOptions(t):this._defaultHitTestOptions;s.requiresGroundFeedback=!0,s.enableDraped=!0;const n=wd(this.state.viewingMode);n.options.selectionMode=!0,n.options.store=Uo.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(r,n,s);const o=this._intersectResultsToHits(n.results.all,s.graphics),a=n.results.ground,l=Lue(a,this),c=w(l)&&"type"in l&&l.type==="integrated-mesh"?l:null,h={screenPoint:i,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:Zm(a)?a.distanceInRenderSpace:0,layer:c}};return ur.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(h.intersector=n),Promise.resolve(h)}async popupHitTest(e){const{results:t,ground:i}=await I0t(this,e);let r=null;return!(t.length===0||Math.abs($t(t[0].distance,0)-i.distance)<1e-5)||i.layer&&i.layer.type==="integrated-mesh"||(r=i.mapPoint),{results:t,screenPoint:e,mapPoint:r}}goTo(e,t){return this.updatingHandles.addPromise(this.stateManager.goTo(e,t))}async whenAnalysisView(e){if(N(e.parent))throw new se("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return e.parent.type==="line-of-sight"?(await this.whenLayerView(e.parent)).whenAnalysisView():this.analysisViewManager.whenAnalysisView(e)}whenLayerView(e){return super.whenLayerView(e)}async takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return Sst(i,t,this._pixelFormat())}async _takeScreenshot(e){const t=this._completeSettings(e);await this.whenReady();const i=await this._stage.renderView.takeScreenshot(t);return Est(i,this._pixelFormat())}_completeSettings(e){const t=Tst(e,this);return t.pixelRatio/=this.state.pixelRatio,Mst(t,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:e=>this._takeScreenshot(e)}}addUpdatingPromise(e){return this.updatingHandles.addPromise(e)}importLayerView(e){return Lse.importLayerView(e)}hasLayerViewModule(e){return Lse.hasLayerViewModule(e)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var e,t,i,r;return this.map&&"initialViewProperties"in this.map&&((t=(e=this.map)==null?void 0:e.initialViewProperties)==null?void 0:t.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.ready)&&this._initialDefaultSpatialReference||null}async validate(){let e=B0t(this.type);if(Ce("safari")&&Ce("safari")<9&&(e=new se("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:Ce("safari")})),w(e))throw uu.warn("#validate()",e.message),e}get _predeterminedViewingMode(){var t,i;const e=this._isOverridden("viewingMode")?this._get("viewingMode"):(i=this.map&&"initialViewProperties"in this.map?(t=this.map.initialViewProperties)==null?void 0:t.viewingMode:null)!=null?i:null;return w(e)?Mse(e):null}getSpatialReferenceSupport({spatialReference:e,layer:t}){const i=this._predeterminedViewingMode;if(w(i))return this._validateSpatialReferenceForViewingMode(e,t,i)?{constraints:this._makeSpatialReferenceConstraints(e,t,i)}:null;const r=this._validateSpatialReferenceForViewingMode(e,t,st.Local),s=this._validateSpatialReferenceForViewingMode(e,t,st.Global);return r||s?r&&s?{constraints:this._makeSpatialReferenceConstraints(e,t,null)}:r?{constraints:this._makeSpatialReferenceConstraints(e,t,st.Local)}:{constraints:this._makeSpatialReferenceConstraints(e,t,st.Global)}:null}_validateSpatialReferenceForViewingMode(e,t,i){return!!k5(e,i)&&(!!N(t)||!!ute(t)||(!EM(t)||!N(Kz(t,e,i)))&&(!cte(t)||i!==st.Global))}_makeSpatialReferenceConstraints(e,t,i){if(N(t))return[{spatialReference:e,viewingMode:i}];const r=e.isWebMercator,s=e.isWGS84;return ute(t)&&(r||s)?!s||i===st.Local||KJ(t.tileInfo,t.fullExtent,e,st.Global)===null?[{spatialReference:e,viewingMode:i},{spatialReference:wt.WebMercator,viewingMode:i}]:[{spatialReference:r?wt.WGS84:wt.WebMercator,viewingMode:i}]:EM(t)||cte(t)||!r&&!s?EM(t)&&r&&i!==st.Global?[{spatialReference:e,viewingMode:i},{spatialReference:wt.WGS84,viewingMode:st.Local}]:[{spatialReference:e,viewingMode:i}]:[{spatialReference:e,viewingMode:i},{spatialReference:r?wt.WGS84:wt.WebMercator,viewingMode:i}]}_validateSpatialReference(e){const t=w(this.getSpatialReferenceSupport({spatialReference:e})),i=this._predeterminedViewingMode;return t||(w(i)?uu.warnOnce(`Spatial reference defined on view not supported in ${C6(i)} viewing mode.`):e.isGeographic&&uu.warnOnce("Spatial reference is geographic but not supported.")),t}whenReady(){return new Promise(e=>{this.ready?e(this):this._resolveWhenReady.push(e)})}computeMapPointFromVec3d(e,t){let i=this.spatialReference||wt.WGS84;return $n(e,this.renderSpatialReference,e,i)||(i=wt.WGS84,$n(e,this.renderSpatialReference,e,i)),t?(t.x=e[0],t.y=e[1],t.z=e[2],t.spatialReference=i):t=new xt(e,i),t}trackGraphicState(e){if(!e.graphic)return uu.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const t=this.getViewForGraphic(e.graphic);let i=null,r=!1;const s=n=>{var o;!r&&w(n)&&"processor"in n&&((o=n.processor)==null?void 0:o.type)==="graphics-3d"&&n.processor.graphicsCore&&(i=n.processor.graphicsCore.trackGraphicState(e))};return w(t)?s(t):this.whenViewForGraphic(e.graphic,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,w(i)&&(i.remove(),i=null)}}}highlight(e){if(Array.isArray(e))return EE(e.map(i=>this.highlight(i)));if(zt.isCollection(e))return EE(e.toArray().map(i=>this.highlight(i)));const t=this.getViewForGraphic(e);return t&&"highlight"in t?t.highlight(e):md()}maskOccludee(e){if(!e)return uu.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const t=this.getViewForGraphic(e);let i=null,r=!1;const s=n=>{!r&&w(n)&&wGe(n)&&(i=n.maskOccludee(e))};return w(t)?s(t):this.whenViewForGraphic(e,{waitForLayer:!0}).then(n=>s(n),()=>{}).catch(()=>{}),{remove:()=>{r=!0,w(i)&&(i.remove(),i=null)}}}getViewForGraphic(e){return e.layer===this.graphics?this.graphicsView:e.layer?this.allLayerViews.find(t=>t.layer===e.layer):null}graphicChanged(e){w(this.graphicsView)&&this.graphicsView.graphicChanged(e)}async whenViewForGraphic(e,t){if(e.layer===this)return await xP(()=>this.graphicsView),this.graphicsView;if(!e.layer||!this.map)throw new se("no-view-for-graphic");return t&&t.waitForLayer&&!this.map.allLayers.includes(e.layer)?new Promise((i,r)=>{const s=this.map.allLayers.on("change",n=>{n.added.includes(e.layer)&&(s.remove(),this.whenLayerView(e.layer).then(i,r))})}):this.whenLayerView(e.layer)}externalToInternalIntersectOptions(e){const t=this._externalToInternalRenderItems(e.include,sP.INCLUDE),i=this._externalToInternalRenderItems(e.exclude,sP.EXCLUDE);return{include:t.layerUids,exclude:i.layerUids,graphics:{include:t.graphicUids,exclude:i.graphicUids}}}_intersectResultToMapPoint(e,t){return e.getIntersectionPoint(kS)?(t=this.computeMapPointFromVec3d(kS,t),e.intersector===ls.TERRAIN&&this.basemapTerrain&&(t.z=$t(mm(this.basemapTerrain,t),0)),t):null}_intersectResultsToHits(e,t){const i=new Array;let r=null;for(let s=0;s<e.length;s++){const n=e[s],o=Lue(n,this);if(w(o)&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=QW(n,this);if(N(a))continue;if(a.type==="graphic"){if(N(r)&&s!==e.length-1&&(r=new Set),w(r)){const h=this._getGraphicFilterUid(a.graphic);if(r.has(h))continue;r.add(h)}if(!this._testGraphicUidFilter(t,a.graphic))continue}const l=this._intersectResultToMapPoint(n),c=n.distanceInRenderSpace;i.push({...a,mapPoint:l,distance:c})}return i}_getGraphicFilterUid(e){if(e.layer&&"objectIdField"in e.layer){const t=e.attributes[e.layer.objectIdField];if(t)return`o-${e.layer.id}-${t}`}return`u-${e.uid}`}_testGraphicUidFilter(e,t){const i=this._getGraphicFilterUid(t);return N(e)||(N(e.include)||e.include.has(i))&&(N(e.exclude)||!e.exclude.has(i))}_externalToInternalRenderItems(e,t,i={layerUids:null,graphicUids:null}){if(!e)return i;if(e instanceof ul)s_t(i,this._getGraphicFilterUid(e)),t===sP.INCLUDE&&(w(this.graphicsView)&&e.layer===this?ZO(i,this.graphicsView.processor.layer.id):e.layer&&ZO(i,e.layer.uid));else if(ahe(e))for(const r of e)r===this.graphics&&w(this.graphicsView)?ZO(i,this.graphicsView.processor.layer.id):r===this.map.ground?ZO(i,Sp):this._externalToInternalRenderItems(r,t,i);else"uid"in e&&ZO(i,e.uid);return i}_initBasemapTerrain(){this._set("basemapTerrain",new Ept({view:this})),this._set("elevationProvider",new sM({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new xa({view:this})),this._set("featureTiles",new Co({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const e=()=>{var i;const t=(i=this.basemapTerrain)==null?void 0:i.extent;if(this.clippingArea||t)if(t&&this.basemapTerrain.spatialReference){const r=w(this.basemapTerrain.extent)?Z3(jk(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;w(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(r):this.featureTiles.filterExtent=r}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>ur.FEATURE_TILE_TREE_SHOW_TILES,t=>{t&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(_e(()=>import("./FeatureTileTree3DDebugger.9f608a45.js"),["FeatureTileTree3DDebugger.9f608a45.js","TileTreeDebugger.89d4994d.js"],import.meta.url)).then(({FeatureTileTree3DDebugger:i})=>{!this.featureTreeDebugger&&ur.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new i({view:this}))}):t||!this.featureTreeDebugger||ur.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},an),this.updatingHandles.add(()=>this.clippingArea,e,an),this.updatingHandles.add(()=>this.basemapTerrain.extent,e,an)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||this._set("mapCoordsHelper",new Bct(this.map,e));const t=this.state.isGlobal,i=Age(t,e);i!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ck.create(this.state.viewingMode,i)),t||this.handles.add(xe(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.extent},r=>{const s=this.renderCoordsHelper.spatialReference;r&&(r[0]!==0||r[1]!==0||r[2]!==0||r[3]!==0)&&aU(r,this.basemapTerrain.spatialReference,Uue,s)&&(this.renderCoordsHelper.extent=Uue)},Rr),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(_C/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(e=null){w(e)&&e.type===gr.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(t=>{t.destroyed||(this.handles.add(xe(()=>[t.updating,t.updatingProgress],()=>this._updatingChanged(),Rr),"updatingMonitors"),t.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(e,t){if(!this.overlay||!this.overlay.hasVisibleItems)return t;const i=e.getContext("2d");return i.putImageData(t,0,0),this.overlay.renderCanvas(e),i.getImageData(0,0,t.width,t.height)}_initStage(){const e={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(a,l)=>this._renderScreenshotOverlay(a,l)}},t=new Ect(this.state.viewingMode,a=>this._stage.layers.forAll(a),this);this._set("sceneIntersectionHelper",t);const i=iU(this.surface),{resourceController:r,state:s,renderSpatialReference:n}=this;this._stage=new Ml({options:e,container:i,resourceController:r,state:s,sceneIntersectionHelper:t,renderSR:n}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=F3(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new se("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),si),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),si),xe(()=>this.magnifier,a=>this._stage.renderView.magnifier=a,an)],"stage");const o=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:TW.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],o),"stage"),o(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(_C/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(e){this._exitSurface(),this.state.init(e,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new Aut({view:this,viewingMode:e,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Rlt})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const e=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(e,e),this._updatingChanged()}async _createGraphicsViewAsync(e){const t=(await _e(()=>import("./GraphicsView3D.b81beaa7.js"),["GraphicsView3D.b81beaa7.js","GraphicsProcessor.ee9e344d.js","Graphics3DScaleVisibility.8fa6127f.js","optimizedFeatureQueryEngineAdapter.c129ff5f.js","centroid.88cb65db.js","PooledRBush.dcfb0021.js","quickselect.03306040.js","Graphics3DObjectStates.2d298d9b.js"],import.meta.url)).default;Ui(e),await xP(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.ready},e),this._set("graphicsView",new t({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),w(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const e=Mse(this.viewingMode);if(e===st.Global&&(this._clippingArea=null),this._initSurface(e),this._set("ready",!0),this.handles.add(Fo(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const i=this.get("map.initialViewProperties.environment");i&&(this.environment=i)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const t=this._resolveWhenReady;this._resolveWhenReady=[],t.forEach(i=>i(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Sp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(e.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Sp);for(const e of this.map.allLayers.items)e.type==="integrated-mesh"&&e.opacity<1&&this._defaultToMapOptions.exclude.add(e.uid)}}addVoxelLayerViewToWasm(e){return N(this.voxelWasm)?(N(this.voxelWasmPromise)&&(this.voxelWasmPromise=_e(()=>import("./VoxelWasmPerSceneView.f33e880b.js"),[],import.meta.url).then(t=>(this.voxelWasm=new t.default(this),this.voxelWasm))),this.voxelWasmPromise.then(t=>t.addVoxelLayer(e))):this.voxelWasm.addVoxelLayer(e)}removeVoxelLayerViewFromWasm(e){w(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(e)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function ZO(e,t){e.layerUids||(e.layerUids=new Set),e.layerUids.add(t)}function s_t(e,t){e.graphicUids||(e.graphicUids=new Set),e.graphicUids.add(t)}function iN(e,t){return w(e)&&t1(e.spatialReference,t)?Z3(e,t):null}var sP;_t.type="3d",u([f()],_t.prototype,"_userClippingArea",void 0),u([f()],_t.prototype,"_resourceController",void 0),u([f()],_t.prototype,"_stage",void 0),u([f({readOnly:!0})],_t.prototype,"deconflictor",void 0),u([f({readOnly:!0})],_t.prototype,"labeler",void 0),u([f(Y7(XE,"analyses"))],_t.prototype,"analyses",void 0),u([f({type:sC,readOnly:!0,aliasOf:"state.animation"})],_t.prototype,"animation",void 0),u([f({readOnly:!0})],_t.prototype,"basemapTerrain",void 0),u([f({readOnly:!0})],_t.prototype,"elevationProvider",void 0),u([f({type:jc,aliasOf:"stateManager.camera"})],_t.prototype,"camera",void 0),u([f({type:jc,aliasOf:"stateManager.contentCamera"})],_t.prototype,"contentCamera",void 0),u([f({readOnly:!0})],_t.prototype,"canvas",void 0),u([f({type:xt,aliasOf:"stateManager.center"})],_t.prototype,"center",void 0),u([f({type:zi})],_t.prototype,"clippingArea",null),u([f({type:Pw})],_t.prototype,"constraints",void 0),u([f({type:zi,readOnly:!0})],_t.prototype,"renderDataExtent",null),u([f({type:zi,readOnly:!0})],_t.prototype,"dataExtent",null),u([f({type:zi,readOnly:!0})],_t.prototype,"groundAndLayersExtent",null),u([f({value:null,type:y2})],_t.prototype,"environment",null),u([pi("environment")],_t.prototype,"castEnvironment",null),u([f({readOnly:!0})],_t.prototype,"environmentManager",void 0),u([f({type:zi,aliasOf:"stateManager.extent"})],_t.prototype,"extent",void 0),u([f()],_t.prototype,"floors",void 0),u([f({readOnly:!0,aliasOf:"stateManager.screenCenter"})],_t.prototype,"screenCenter",void 0),u([f({aliasOf:"stateManager.frustum"})],_t.prototype,"frustum",void 0),u([f({type:Number,readOnly:!0})],_t.prototype,"fullOpacity",void 0),u([f({readOnly:!0})],_t.prototype,"graphicsView",void 0),u([f({readOnly:!0})],_t.prototype,"analysisViewManager",void 0),u([f()],_t.prototype,"groundView",void 0),u([f({type:Boolean})],_t.prototype,"initialExtentRequired",null),u([f()],_t.prototype,"_defaultsFromMapSettings",null),u([f({type:Boolean,readOnly:!0})],_t.prototype,"interacting",null),u([f()],_t.prototype,"stationary",null),u([f({aliasOf:"state.navigating"})],_t.prototype,"navigating",void 0),u([f()],_t.prototype,"map",void 0),u([f({readOnly:!0})],_t.prototype,"mapCoordsHelper",void 0),u([f({aliasOf:"stateManager.padding"})],_t.prototype,"padding",void 0),u([f({type:xa,readOnly:!0})],_t.prototype,"pointsOfInterest",void 0),u([f({type:Co,readOnly:!0})],_t.prototype,"featureTiles",void 0),u([f()],_t.prototype,"featureTreeDebugger",void 0),u([f({type:Boolean})],_t.prototype,"screenSizePerspectiveEnabled",void 0),u([f({constructOnly:!0})],_t.prototype,"deactivatedWebGLExtensions",void 0),u([f({constructOnly:!0})],_t.prototype,"debugWebGLExtensions",void 0),u([f({constructOnly:!0})],_t.prototype,"renderCanvas",void 0),u([f({constructOnly:!0})],_t.prototype,"state",void 0),u([f({readOnly:!0})],_t.prototype,"inputManager",void 0),u([f({readOnly:!0})],_t.prototype,"stateManager",void 0),u([f({type:["low","medium","high"]})],_t.prototype,"qualityProfile",null),u([f({type:Fle,get(){let e=this._get("qualitySettings");return e||(e=new Fle,zF.apply(this.qualityProfile,e)),e}})],_t.prototype,"qualitySettings",void 0),u([f()],_t.prototype,"slicePlane",null),u([f({readOnly:!0})],_t.prototype,"typeSpecificPreconditionsReady",null),u([f({readOnly:!0})],_t.prototype,"renderCoordsHelper",void 0),u([f({readOnly:!0})],_t.prototype,"sceneIntersectionHelper",void 0),u([f({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],_t.prototype,"resolution",null),u([f({type:Number,aliasOf:"stateManager.scale"})],_t.prototype,"scale",void 0),u([f()],_t.prototype,"heightModelInfo",null),u([f()],_t.prototype,"spatialReference",void 0),u([f({type:Boolean,constructOnly:!0})],_t.prototype,"alphaCompositingEnabled",void 0),u([f({constructOnly:!0})],_t.prototype,"preserveDrawingBufferEnabled",void 0),u([f({type:Boolean})],_t.prototype,"supersampleScreenshotsEnabled",void 0),u([f({readOnly:!0})],_t.prototype,"type",void 0),u([f({type:CEe})],_t.prototype,"ui",void 0),u([f({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],_t.prototype,"updating",null),u([f({type:Number,readOnly:!0,dependsOn:["updating"]})],_t.prototype,"updatingProgress",void 0),u([f({type:["global","local"]})],_t.prototype,"viewingMode",null),u([f({type:Zp,aliasOf:"stateManager.viewpoint"})],_t.prototype,"viewpoint",void 0),u([f({type:Number,aliasOf:"stateManager.zoom"})],_t.prototype,"zoom",void 0),u([f({type:TW})],_t.prototype,"highlightOptions",void 0),_t=u([B("esri.views.SceneView")],_t),function(e){e[e.INCLUDE=0]="INCLUDE",e[e.EXCLUDE=1]="EXCLUDE"}(sP||(sP={}));const kS=F(),Q9=ys(),Uue=ei(),n_t=_t,AEe="esri.widgets.Fullscreen.FullscreenViewModel",zue=Ie.getLogger(AEe);let ny=class extends ze{constructor(e){super(e),this._vendorInfo=null,this._fullscreenStyle="width: 100%; height: 100%;",this.view=null,this._errorHandler=this._errorHandler.bind(this),this._stateHandler=this._stateHandler.bind(this)}destroy(){this._removeFullscreenListeners(),this.view=null}get element(){return this.get("view.container")}set element(e){e!==void 0?this._override("element",e):this._clearOverride("element")}get state(){return this.element?this._isSupported()?this._isActive()?"active":"ready":"feature-unsupported":"disabled"}enter(){this._enterFullscreen()}exit(){this._exitFullscreen()}toggle(){this._isActive()?this._exitFullscreen():this._enterFullscreen()}_isSupported(){this._removeFullscreenListeners();const e=this._getVendorInfo(this.element);return this._addFullscreenListeners(e),this._vendorInfo=e,!!e}_isActive(){return!!this._vendorInfo&&!!document[this._vendorInfo.propertyName]}_stateHandler(){this.notifyChange("state"),this.state==="active"?this._addStyle():this._removeStyle()}_errorHandler(e){zue.error("fullscreen request failed",e)}_getVendorInfo(e){if(e)return e.requestFullscreen?{enterName:"requestFullscreen",exitName:"exitFullscreen",errorEventName:"fullscreenerror",changeEventName:"fullscreenchange",propertyName:"fullscreen"}:e.webkitRequestFullScreen?{enterName:"webkitRequestFullscreen",exitName:"webkitCancelFullScreen",errorEventName:"webkitfullscreenerror",changeEventName:"webkitfullscreenchange",propertyName:"webkitIsFullScreen"}:e.mozRequestFullScreen?{enterName:"mozRequestFullScreen",exitName:"mozCancelFullScreen",errorEventName:"mozfullscreenerror",changeEventName:"mozfullscreenchange",propertyName:"mozFullScreen"}:e.msRequestFullscreen?{enterName:"msRequestFullscreen",exitName:"msExitFullscreen",errorEventName:"MSFullscreenError",changeEventName:"MSFullscreenChange",propertyName:"msFullscreenElement"}:void 0}_enterFullscreen(){if(this.state==="feature-unsupported")return void zue.warn("The fullscreen API is not supported in this browser.");const{element:e}=this;e&&(e[this._vendorInfo.enterName].call(e),this.notifyChange("state"))}_addStyle(){const{element:e}=this;e&&e.setAttribute("style",this._fullscreenStyle)}_removeStyle(){const{element:e}=this;e&&e.removeAttribute("style")}_exitFullscreen(){if(this.state==="feature-unsupported")return;const{element:e}=this;e&&(document[this._vendorInfo.exitName].call(document),this.notifyChange("state"))}_addFullscreenListeners(e){e&&(document.addEventListener(e.changeEventName,this._stateHandler),document.addEventListener(e.errorEventName,this._errorHandler))}_removeFullscreenListeners(){const{_vendorInfo:e}=this;this._vendorInfo&&(document.removeEventListener(e.changeEventName,this._stateHandler),document.removeEventListener(e.errorEventName,this._errorHandler))}};u([f()],ny.prototype,"element",null),u([f({readOnly:!0})],ny.prototype,"state",null),u([f()],ny.prototype,"view",void 0),u([f()],ny.prototype,"enter",null),u([f()],ny.prototype,"exit",null),u([f()],ny.prototype,"toggle",null),ny=u([B(AEe)],ny);const OEe=ny,US={base:"esri-fullscreen esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-icon",enter:"esri-icon-zoom-out-fixed",exit:"esri-icon-zoom-in-fixed",disabled:"esri-disabled"};let Jf=class extends dl{constructor(e,t){super(e,t),this.element=null,this.label=void 0,this.messages=null,this.view=null,this.viewModel=new OEe}get fullscreenTitle(){var t;const e=(t=this.viewModel)==null?void 0:t.state;return e==="active"?this.messages.exit:e==="ready"?this.messages.enter:""}render(){var r;const e=(r=this.viewModel)==null?void 0:r.state,{fullscreenTitle:t}=this,i={[US.disabled]:e==="disabled"||e==="feature-unsupported"};return Te("div",{bind:this,class:this.classes(US.base,i),role:"button",tabIndex:0,onclick:this._toggle,onkeydown:this._toggle,"aria-label":t,title:t},this.renderIcon(),this.renderTitle())}renderIcon(){var i;const e=(i=this.viewModel)==null?void 0:i.state,t={[US.enter]:e==="ready"||e==="disabled"||e==="feature-unsupported",[US.exit]:e==="active"};return Te("span",{class:this.classes(US.icon,t),"aria-hidden":"true"})}renderTitle(){return Te("span",{class:US.text},this.fullscreenTitle)}_toggle(){this.viewModel.toggle()}};u([Lt("viewModel.element")],Jf.prototype,"element",void 0),u([f({readOnly:!0})],Jf.prototype,"fullscreenTitle",null),u([f({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Jf.prototype,"label",void 0),u([f(),Hl("esri/widgets/Fullscreen/t9n/Fullscreen")],Jf.prototype,"messages",void 0),u([Lt("viewModel.view")],Jf.prototype,"view",void 0),u([f({type:OEe})],Jf.prototype,"viewModel",void 0),u([Eu()],Jf.prototype,"_toggle",null),Jf=u([B("esri.widgets.Fullscreen")],Jf);const o_t=Jf;function Bue(e){let t,i;return{c(){t=tl("div"),i=J2(e[0]),Gu(t,"class","title svelte-z0arw1")},m(r,s){gm(r,t,s),ia(t,i)},p(r,s){s&1&&JW(i,r[0])},d(r){r&&Np(t)}}}function a_t(e){let t,i,r,s,n,o=e[0]&&Bue(e);return{c(){t=tl("div"),i=tl("div"),r=rx(),o&&o.c(),Gu(i,"class","map svelte-z0arw1"),Gu(t,"class","wrapper svelte-z0arw1")},m(a,l){gm(a,t,l),ia(t,i),ia(t,r),o&&o.m(t,null),s||(n=kEe(e[1].call(null,i)),s=!0)},p(a,[l]){a[0]?o?o.p(a,l):(o=Bue(a),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},i:vx,o:vx,d(a){a&&Np(t),o&&o.d(),s=!1,n()}}}function l_t(e,t,i){let{basemap:r="streets"}=t,{center:s=[0,0]}=t,{zoom:n=1}=t,{title:o=""}=t,{locations:a}=t,l=-1,c,h,p=!1,m,g=window.innerWidth;const v=C=>{if(h.interacting)return Promise.resolve();{const M=a[C];M&&o!==""&&i(0,o=`${o} -> ${M.title}`),M||console.error("Error!",M,C,a);const I=c.basemap.baseLayers.getItemAt(0).tileInfo.zoomToScale(M.zoom);return h.goTo({center:[M.center[0],M.center[1]],scale:I,rotation:0,tilt:0}).then(()=>{i(0,o=M.title)})}},b=()=>{!p&&h.camera.position.z>500&&requestAnimationFrame(()=>{const C=h.camera.clone();let M=15;C.position.z<3e3?M=.5:C.position.z<5e3?M=1:C.position.z<1e4?M=3:C.position.z<2e4?M=5:C.position.z<5e4&&(M=10),C.position.z=C.position.z-M,i(6,h.camera=C,h),b()})},S=()=>{if(p)m.end();else{let C=[101,98];h.camera.tilt>80&&(C=[101,100]),requestAnimationFrame(()=>{h.state.switchCameraController(m),m.begin([100,100]),m.update(C),m.end(),S()})}},T=()=>{l=l+1,p=!0,v(l).then(()=>{p=!1,YEe(h,c.ground.layers.getItemAt(0)).then(C=>{C<100?b():S(),setTimeout(()=>{p=!0,requestAnimationFrame(()=>{T()})},1e4)},C=>{console.error("could not find elevation difference"),console.error(C)})},C=>{console.log("error",C)})},O=C=>{c=new Wve({basemap:r,ground:"world-elevation"});const M=new n_t({container:C,map:c,center:s,zoom:n});if(g>768){const I=new o_t({view:M});M.ui.add(I,"top-left")}M.when(()=>{m=new Xw({view:h,pivot:0}),i(6,h=M)})};return e.$$set=C=>{"basemap"in C&&i(2,r=C.basemap),"center"in C&&i(3,s=C.center),"zoom"in C&&i(4,n=C.zoom),"title"in C&&i(0,o=C.title),"locations"in C&&i(5,a=C.locations)},e.$$.update=()=>{e.$$.dirty&96&&h&&a&&a.length>0&&T()},[o,O,r,s,n,a,h]}class c_t extends Ck{constructor(t){super(),Ek(this,t,l_t,a_t,xk,{basemap:2,center:3,zoom:4,title:0,locations:5})}}var wk={exports:{}};/* @preserve
 * Leaflet 1.8.0, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2022 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(e,t){(function(i,r){r(t)})(Pg,function(i){var r="1.8.0";function s(d){var y,x,A,k;for(x=1,A=arguments.length;x<A;x++){k=arguments[x];for(y in k)d[y]=k[y]}return d}var n=Object.create||function(){function d(){}return function(y){return d.prototype=y,new d}}();function o(d,y){var x=Array.prototype.slice;if(d.bind)return d.bind.apply(d,x.call(arguments,1));var A=x.call(arguments,2);return function(){return d.apply(y,A.length?A.concat(x.call(arguments)):arguments)}}var a=0;function l(d){return"_leaflet_id"in d||(d._leaflet_id=++a),d._leaflet_id}function c(d,y,x){var A,k,W,he;return he=function(){A=!1,k&&(W.apply(x,k),k=!1)},W=function(){A?k=arguments:(d.apply(x,arguments),setTimeout(he,y),A=!0)},W}function h(d,y,x){var A=y[1],k=y[0],W=A-k;return d===A&&x?d:((d-k)%W+W)%W+k}function p(){return!1}function m(d,y){if(y===!1)return d;var x=Math.pow(10,y===void 0?6:y);return Math.round(d*x)/x}function g(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function v(d){return g(d).split(/\s+/)}function b(d,y){Object.prototype.hasOwnProperty.call(d,"options")||(d.options=d.options?n(d.options):{});for(var x in y)d.options[x]=y[x];return d.options}function S(d,y,x){var A=[];for(var k in d)A.push(encodeURIComponent(x?k.toUpperCase():k)+"="+encodeURIComponent(d[k]));return(!y||y.indexOf("?")===-1?"?":"&")+A.join("&")}var T=/\{ *([\w_ -]+) *\}/g;function O(d,y){return d.replace(T,function(x,A){var k=y[A];if(k===void 0)throw new Error("No value provided for variable "+x);return typeof k=="function"&&(k=k(y)),k})}var C=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"};function M(d,y){for(var x=0;x<d.length;x++)if(d[x]===y)return x;return-1}var I="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function $(d){return window["webkit"+d]||window["moz"+d]||window["ms"+d]}var U=0;function q(d){var y=+new Date,x=Math.max(0,16-(y-U));return U=y+x,window.setTimeout(d,x)}var G=window.requestAnimationFrame||$("RequestAnimationFrame")||q,Y=window.cancelAnimationFrame||$("CancelAnimationFrame")||$("CancelRequestAnimationFrame")||function(d){window.clearTimeout(d)};function J(d,y,x){if(x&&G===q)d.call(y);else return G.call(window,o(d,y))}function X(d){d&&Y.call(window,d)}var ne={__proto__:null,extend:s,create:n,bind:o,get lastId(){return a},stamp:l,throttle:c,wrapNum:h,falseFn:p,formatNum:m,trim:g,splitWords:v,setOptions:b,getParamString:S,template:O,isArray:C,indexOf:M,emptyImageUrl:I,requestFn:G,cancelFn:Y,requestAnimFrame:J,cancelAnimFrame:X};function re(){}re.extend=function(d){var y=function(){b(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},x=y.__super__=this.prototype,A=n(x);A.constructor=y,y.prototype=A;for(var k in this)Object.prototype.hasOwnProperty.call(this,k)&&k!=="prototype"&&k!=="__super__"&&(y[k]=this[k]);return d.statics&&s(y,d.statics),d.includes&&(ye(d.includes),s.apply(null,[A].concat(d.includes))),s(A,d),delete A.statics,delete A.includes,A.options&&(A.options=x.options?n(x.options):{},s(A.options,d.options)),A._initHooks=[],A.callInitHooks=function(){if(!this._initHooksCalled){x.callInitHooks&&x.callInitHooks.call(this),this._initHooksCalled=!0;for(var W=0,he=A._initHooks.length;W<he;W++)A._initHooks[W].call(this)}},y},re.include=function(d){var y=this.prototype.options;return s(this.prototype,d),d.options&&(this.prototype.options=y,this.mergeOptions(d.options)),this},re.mergeOptions=function(d){return s(this.prototype.options,d),this},re.addInitHook=function(d){var y=Array.prototype.slice.call(arguments,1),x=typeof d=="function"?d:function(){this[d].apply(this,y)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(x),this};function ye(d){if(!(typeof L>"u"||!L||!L.Mixin)){d=C(d)?d:[d];for(var y=0;y<d.length;y++)d[y]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var pe={on:function(d,y,x){if(typeof d=="object")for(var A in d)this._on(A,d[A],y);else{d=v(d);for(var k=0,W=d.length;k<W;k++)this._on(d[k],y,x)}return this},off:function(d,y,x){if(!arguments.length)delete this._events;else if(typeof d=="object")for(var A in d)this._off(A,d[A],y);else{d=v(d);for(var k=arguments.length===1,W=0,he=d.length;W<he;W++)k?this._off(d[W]):this._off(d[W],y,x)}return this},_on:function(d,y,x){if(typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}this._events=this._events||{};var A=this._events[d];A||(A=[],this._events[d]=A),x===this&&(x=void 0);for(var k={fn:y,ctx:x},W=A,he=0,Ee=W.length;he<Ee;he++)if(W[he].fn===y&&W[he].ctx===x)return;W.push(k)},_off:function(d,y,x){var A,k,W;if(!!this._events&&(A=this._events[d],!!A)){if(arguments.length===1){if(this._firingCount)for(k=0,W=A.length;k<W;k++)A[k].fn=p;delete this._events[d];return}if(x===this&&(x=void 0),typeof y!="function"){console.warn("wrong listener type: "+typeof y);return}for(k=0,W=A.length;k<W;k++){var he=A[k];if(he.ctx===x&&he.fn===y){this._firingCount&&(he.fn=p,this._events[d]=A=A.slice()),A.splice(k,1);return}}console.warn("listener not found")}},fire:function(d,y,x){if(!this.listens(d,x))return this;var A=s({},y,{type:d,target:this,sourceTarget:y&&y.sourceTarget||this});if(this._events){var k=this._events[d];if(k){this._firingCount=this._firingCount+1||1;for(var W=0,he=k.length;W<he;W++){var Ee=k[W];Ee.fn.call(Ee.ctx||this,A)}this._firingCount--}}return x&&this._propagateEvent(A),this},listens:function(d,y){typeof d!="string"&&console.warn('"string" type argument expected');var x=this._events&&this._events[d];if(x&&x.length)return!0;if(y){for(var A in this._eventParents)if(this._eventParents[A].listens(d,y))return!0}return!1},once:function(d,y,x){if(typeof d=="object"){for(var A in d)this.once(A,d[A],y);return this}var k=o(function(){this.off(d,y,x).off(d,k,x)},this);return this.on(d,y,x).on(d,k,x)},addEventParent:function(d){return this._eventParents=this._eventParents||{},this._eventParents[l(d)]=d,this},removeEventParent:function(d){return this._eventParents&&delete this._eventParents[l(d)],this},_propagateEvent:function(d){for(var y in this._eventParents)this._eventParents[y].fire(d.type,s({layer:d.target,propagatedFrom:d.target},d),!0)}};pe.addEventListener=pe.on,pe.removeEventListener=pe.clearAllEventListeners=pe.off,pe.addOneTimeEventListener=pe.once,pe.fireEvent=pe.fire,pe.hasEventListeners=pe.listens;var z=re.extend(pe);function j(d,y,x){this.x=x?Math.round(d):d,this.y=x?Math.round(y):y}var Q=Math.trunc||function(d){return d>0?Math.floor(d):Math.ceil(d)};j.prototype={clone:function(){return new j(this.x,this.y)},add:function(d){return this.clone()._add(Z(d))},_add:function(d){return this.x+=d.x,this.y+=d.y,this},subtract:function(d){return this.clone()._subtract(Z(d))},_subtract:function(d){return this.x-=d.x,this.y-=d.y,this},divideBy:function(d){return this.clone()._divideBy(d)},_divideBy:function(d){return this.x/=d,this.y/=d,this},multiplyBy:function(d){return this.clone()._multiplyBy(d)},_multiplyBy:function(d){return this.x*=d,this.y*=d,this},scaleBy:function(d){return new j(this.x*d.x,this.y*d.y)},unscaleBy:function(d){return new j(this.x/d.x,this.y/d.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=Q(this.x),this.y=Q(this.y),this},distanceTo:function(d){d=Z(d);var y=d.x-this.x,x=d.y-this.y;return Math.sqrt(y*y+x*x)},equals:function(d){return d=Z(d),d.x===this.x&&d.y===this.y},contains:function(d){return d=Z(d),Math.abs(d.x)<=Math.abs(this.x)&&Math.abs(d.y)<=Math.abs(this.y)},toString:function(){return"Point("+m(this.x)+", "+m(this.y)+")"}};function Z(d,y,x){return d instanceof j?d:C(d)?new j(d[0],d[1]):d==null?d:typeof d=="object"&&"x"in d&&"y"in d?new j(d.x,d.y):new j(d,y,x)}function ie(d,y){if(!!d)for(var x=y?[d,y]:d,A=0,k=x.length;A<k;A++)this.extend(x[A])}ie.prototype={extend:function(d){return d=Z(d),!this.min&&!this.max?(this.min=d.clone(),this.max=d.clone()):(this.min.x=Math.min(d.x,this.min.x),this.max.x=Math.max(d.x,this.max.x),this.min.y=Math.min(d.y,this.min.y),this.max.y=Math.max(d.y,this.max.y)),this},getCenter:function(d){return new j((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,d)},getBottomLeft:function(){return new j(this.min.x,this.max.y)},getTopRight:function(){return new j(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(d){var y,x;return typeof d[0]=="number"||d instanceof j?d=Z(d):d=le(d),d instanceof ie?(y=d.min,x=d.max):y=x=d,y.x>=this.min.x&&x.x<=this.max.x&&y.y>=this.min.y&&x.y<=this.max.y},intersects:function(d){d=le(d);var y=this.min,x=this.max,A=d.min,k=d.max,W=k.x>=y.x&&A.x<=x.x,he=k.y>=y.y&&A.y<=x.y;return W&&he},overlaps:function(d){d=le(d);var y=this.min,x=this.max,A=d.min,k=d.max,W=k.x>y.x&&A.x<x.x,he=k.y>y.y&&A.y<x.y;return W&&he},isValid:function(){return!!(this.min&&this.max)}};function le(d,y){return!d||d instanceof ie?d:new ie(d,y)}function K(d,y){if(!!d)for(var x=y?[d,y]:d,A=0,k=x.length;A<k;A++)this.extend(x[A])}K.prototype={extend:function(d){var y=this._southWest,x=this._northEast,A,k;if(d instanceof we)A=d,k=d;else if(d instanceof K){if(A=d._southWest,k=d._northEast,!A||!k)return this}else return d?this.extend(Re(d)||ae(d)):this;return!y&&!x?(this._southWest=new we(A.lat,A.lng),this._northEast=new we(k.lat,k.lng)):(y.lat=Math.min(A.lat,y.lat),y.lng=Math.min(A.lng,y.lng),x.lat=Math.max(k.lat,x.lat),x.lng=Math.max(k.lng,x.lng)),this},pad:function(d){var y=this._southWest,x=this._northEast,A=Math.abs(y.lat-x.lat)*d,k=Math.abs(y.lng-x.lng)*d;return new K(new we(y.lat-A,y.lng-k),new we(x.lat+A,x.lng+k))},getCenter:function(){return new we((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new we(this.getNorth(),this.getWest())},getSouthEast:function(){return new we(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(d){typeof d[0]=="number"||d instanceof we||"lat"in d?d=Re(d):d=ae(d);var y=this._southWest,x=this._northEast,A,k;return d instanceof K?(A=d.getSouthWest(),k=d.getNorthEast()):A=k=d,A.lat>=y.lat&&k.lat<=x.lat&&A.lng>=y.lng&&k.lng<=x.lng},intersects:function(d){d=ae(d);var y=this._southWest,x=this._northEast,A=d.getSouthWest(),k=d.getNorthEast(),W=k.lat>=y.lat&&A.lat<=x.lat,he=k.lng>=y.lng&&A.lng<=x.lng;return W&&he},overlaps:function(d){d=ae(d);var y=this._southWest,x=this._northEast,A=d.getSouthWest(),k=d.getNorthEast(),W=k.lat>y.lat&&A.lat<x.lat,he=k.lng>y.lng&&A.lng<x.lng;return W&&he},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(d,y){return d?(d=ae(d),this._southWest.equals(d.getSouthWest(),y)&&this._northEast.equals(d.getNorthEast(),y)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ae(d,y){return d instanceof K?d:new K(d,y)}function we(d,y,x){if(isNaN(d)||isNaN(y))throw new Error("Invalid LatLng object: ("+d+", "+y+")");this.lat=+d,this.lng=+y,x!==void 0&&(this.alt=+x)}we.prototype={equals:function(d,y){if(!d)return!1;d=Re(d);var x=Math.max(Math.abs(this.lat-d.lat),Math.abs(this.lng-d.lng));return x<=(y===void 0?1e-9:y)},toString:function(d){return"LatLng("+m(this.lat,d)+", "+m(this.lng,d)+")"},distanceTo:function(d){return Pe.distance(this,Re(d))},wrap:function(){return Pe.wrapLatLng(this)},toBounds:function(d){var y=180*d/40075017,x=y/Math.cos(Math.PI/180*this.lat);return ae([this.lat-y,this.lng-x],[this.lat+y,this.lng+x])},clone:function(){return new we(this.lat,this.lng,this.alt)}};function Re(d,y,x){return d instanceof we?d:C(d)&&typeof d[0]!="object"?d.length===3?new we(d[0],d[1],d[2]):d.length===2?new we(d[0],d[1]):null:d==null?d:typeof d=="object"&&"lat"in d?new we(d.lat,"lng"in d?d.lng:d.lon,d.alt):y===void 0?null:new we(d,y,x)}var Ge={latLngToPoint:function(d,y){var x=this.projection.project(d),A=this.scale(y);return this.transformation._transform(x,A)},pointToLatLng:function(d,y){var x=this.scale(y),A=this.transformation.untransform(d,x);return this.projection.unproject(A)},project:function(d){return this.projection.project(d)},unproject:function(d){return this.projection.unproject(d)},scale:function(d){return 256*Math.pow(2,d)},zoom:function(d){return Math.log(d/256)/Math.LN2},getProjectedBounds:function(d){if(this.infinite)return null;var y=this.projection.bounds,x=this.scale(d),A=this.transformation.transform(y.min,x),k=this.transformation.transform(y.max,x);return new ie(A,k)},infinite:!1,wrapLatLng:function(d){var y=this.wrapLng?h(d.lng,this.wrapLng,!0):d.lng,x=this.wrapLat?h(d.lat,this.wrapLat,!0):d.lat,A=d.alt;return new we(x,y,A)},wrapLatLngBounds:function(d){var y=d.getCenter(),x=this.wrapLatLng(y),A=y.lat-x.lat,k=y.lng-x.lng;if(A===0&&k===0)return d;var W=d.getSouthWest(),he=d.getNorthEast(),Ee=new we(W.lat-A,W.lng-k),Le=new we(he.lat-A,he.lng-k);return new K(Ee,Le)}},Pe=s({},Ge,{wrapLng:[-180,180],R:6371e3,distance:function(d,y){var x=Math.PI/180,A=d.lat*x,k=y.lat*x,W=Math.sin((y.lat-d.lat)*x/2),he=Math.sin((y.lng-d.lng)*x/2),Ee=W*W+Math.cos(A)*Math.cos(k)*he*he,Le=2*Math.atan2(Math.sqrt(Ee),Math.sqrt(1-Ee));return this.R*Le}}),Se=6378137,$e={R:Se,MAX_LATITUDE:85.0511287798,project:function(d){var y=Math.PI/180,x=this.MAX_LATITUDE,A=Math.max(Math.min(x,d.lat),-x),k=Math.sin(A*y);return new j(this.R*d.lng*y,this.R*Math.log((1+k)/(1-k))/2)},unproject:function(d){var y=180/Math.PI;return new we((2*Math.atan(Math.exp(d.y/this.R))-Math.PI/2)*y,d.x*y/this.R)},bounds:function(){var d=Se*Math.PI;return new ie([-d,-d],[d,d])}()};function qe(d,y,x,A){if(C(d)){this._a=d[0],this._b=d[1],this._c=d[2],this._d=d[3];return}this._a=d,this._b=y,this._c=x,this._d=A}qe.prototype={transform:function(d,y){return this._transform(d.clone(),y)},_transform:function(d,y){return y=y||1,d.x=y*(this._a*d.x+this._b),d.y=y*(this._c*d.y+this._d),d},untransform:function(d,y){return y=y||1,new j((d.x/y-this._b)/this._a,(d.y/y-this._d)/this._c)}};function jt(d,y,x,A){return new qe(d,y,x,A)}var Ti=s({},Pe,{code:"EPSG:3857",projection:$e,transformation:function(){var d=.5/(Math.PI*$e.R);return jt(d,.5,-d,.5)}()}),li=s({},Ti,{code:"EPSG:900913"});function Pi(d){return document.createElementNS("http://www.w3.org/2000/svg",d)}function ct(d,y){var x="",A,k,W,he,Ee,Le;for(A=0,W=d.length;A<W;A++){for(Ee=d[A],k=0,he=Ee.length;k<he;k++)Le=Ee[k],x+=(k?"L":"M")+Le.x+" "+Le.y;x+=y?de.svg?"z":"x":""}return x||"M0 0"}var Kt=document.documentElement.style,Fi="ActiveXObject"in window,pr=Fi&&!document.addEventListener,Je="msLaunchUri"in navigator&&!("documentMode"in document),ti=Xs("webkit"),Os=Xs("android"),Zs=Xs("android 2")||Xs("android 3"),Dr=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ml=Os&&Xs("Google")&&Dr<537&&!("AudioNode"in window),Vo=!!window.opera,gn=!Je&&Xs("chrome"),ic=Xs("gecko")&&!ti&&!Vo&&!Fi,R1=!gn&&Xs("safari"),g0=Xs("phantom"),gi="OTransition"in Kt,y0=navigator.platform.indexOf("Win")===0,Jm=Fi&&"transition"in Kt,Ad="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Zs,_0="MozPerspective"in Kt,M1=!window.L_DISABLE_3D&&(Jm||Ad||_0)&&!gi&&!g0,ha=typeof orientation<"u"||Xs("mobile"),P1=ha&&ti,Km=ha&&Ad,eg=!window.PointerEvent&&window.MSPointerEvent,tg=!!(window.PointerEvent||eg),ig="ontouchstart"in window||!!window.TouchEvent,Si=!window.L_NO_TOUCH&&(ig||tg),kn=ha&&Vo,yn=ha&&ic,_n=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Od=function(){var d=!1;try{var y=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("testPassiveEventSupport",p,y),window.removeEventListener("testPassiveEventSupport",p,y)}catch{}return d}(),v0=function(){return!!document.createElement("canvas").getContext}(),ef=!!(document.createElementNS&&Pi("svg").createSVGRect),b0=!!ef&&function(){var d=document.createElement("div");return d.innerHTML="<svg/>",(d.firstChild&&d.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),tf=!ef&&function(){try{var d=document.createElement("div");d.innerHTML='<v:shape adj="1"/>';var y=d.firstChild;return y.style.behavior="url(#default#VML)",y&&typeof y.adj=="object"}catch{return!1}}();function Xs(d){return navigator.userAgent.toLowerCase().indexOf(d)>=0}var de={ie:Fi,ielt9:pr,edge:Je,webkit:ti,android:Os,android23:Zs,androidStock:ml,opera:Vo,chrome:gn,gecko:ic,safari:R1,phantom:g0,opera12:gi,win:y0,ie3d:Jm,webkit3d:Ad,gecko3d:_0,any3d:M1,mobile:ha,mobileWebkit:P1,mobileWebkit3d:Km,msPointer:eg,pointer:tg,touch:Si,touchNative:ig,mobileOpera:kn,mobileGecko:yn,retina:_n,passiveEvents:Od,canvas:v0,svg:ef,vml:tf,inlineSvg:b0},fr=de.msPointer?"MSPointerDown":"pointerdown",Rd=de.msPointer?"MSPointerMove":"pointermove",da=de.msPointer?"MSPointerUp":"pointerup",ch=de.msPointer?"MSPointerCancel":"pointercancel",vt={touchstart:fr,touchmove:Rd,touchend:da,touchcancel:ch},uh={touchstart:uA,touchmove:sg,touchend:sg,touchcancel:sg},Jr={},hh=!1;function w0(d,y,x){return y==="touchstart"&&Go(),uh[y]?(x=uh[y].bind(this,x),d.addEventListener(vt[y],x,!1),x):(console.warn("wrong event specified:",y),L.Util.falseFn)}function pa(d,y,x){if(!vt[y]){console.warn("wrong event specified:",y);return}d.removeEventListener(vt[y],x,!1)}function Qc(d){Jr[d.pointerId]=d}function rg(d){Jr[d.pointerId]&&(Jr[d.pointerId]=d)}function Zt(d){delete Jr[d.pointerId]}function Go(){hh||(document.addEventListener(fr,Qc,!0),document.addEventListener(Rd,rg,!0),document.addEventListener(da,Zt,!0),document.addEventListener(ch,Zt,!0),hh=!0)}function sg(d,y){if(y.pointerType!==(y.MSPOINTER_TYPE_MOUSE||"mouse")){y.touches=[];for(var x in Jr)y.touches.push(Jr[x]);y.changedTouches=[y],d(y)}}function uA(d,y){y.MSPOINTER_TYPE_TOUCH&&y.pointerType===y.MSPOINTER_TYPE_TOUCH&&zn(y),sg(d,y)}function hA(d){var y={},x,A;for(A in d)x=d[A],y[A]=x&&x.bind?x.bind(d):x;return d=y,y.type="dblclick",y.detail=2,y.isTrusted=!1,y._simulated=!0,y}var x0=200;function dA(d,y){d.addEventListener("dblclick",y);var x=0,A;function k(W){if(W.detail!==1){A=W.detail;return}if(!(W.pointerType==="mouse"||W.sourceCapabilities&&!W.sourceCapabilities.firesTouchEvents)){var he=Date.now();he-x<=x0?(A++,A===2&&y(hA(W))):A=1,x=he}}return d.addEventListener("click",k),{dblclick:y,simDblclick:k}}function I1(d,y){d.removeEventListener("dblclick",y.dblclick),d.removeEventListener("click",y.simDblclick)}var Us=mo(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),rf=mo(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),L1=rf==="webkitTransition"||rf==="OTransition"?rf+"End":"transitionend";function $1(d){return typeof d=="string"?document.getElementById(d):d}function ng(d,y){var x=d.style[y]||d.currentStyle&&d.currentStyle[y];if((!x||x==="auto")&&document.defaultView){var A=document.defaultView.getComputedStyle(d,null);x=A?A[y]:null}return x==="auto"?null:x}function ar(d,y,x){var A=document.createElement(d);return A.className=y||"",x&&x.appendChild(A),A}function ds(d){var y=d.parentNode;y&&y.removeChild(d)}function T0(d){for(;d.firstChild;)d.removeChild(d.firstChild)}function Un(d){var y=d.parentNode;y&&y.lastChild!==d&&y.appendChild(d)}function sf(d){var y=d.parentNode;y&&y.firstChild!==d&&y.insertBefore(d,y.firstChild)}function D1(d,y){if(d.classList!==void 0)return d.classList.contains(y);var x=ci(d);return x.length>0&&new RegExp("(^|\\s)"+y+"(\\s|$)").test(x)}function te(d,y){if(d.classList!==void 0)for(var x=v(y),A=0,k=x.length;A<k;A++)d.classList.add(x[A]);else if(!D1(d,y)){var W=ci(d);Ve(d,(W?W+" ":"")+y)}}function Ae(d,y){d.classList!==void 0?d.classList.remove(y):Ve(d,g((" "+ci(d)+" ").replace(" "+y+" "," ")))}function Ve(d,y){d.className.baseVal===void 0?d.className=y:d.className.baseVal=y}function ci(d){return d.correspondingElement&&(d=d.correspondingElement),d.className.baseVal===void 0?d.className:d.className.baseVal}function Nr(d,y){"opacity"in d.style?d.style.opacity=y:"filter"in d.style&&is(d,y)}function is(d,y){var x=!1,A="DXImageTransform.Microsoft.Alpha";try{x=d.filters.item(A)}catch{if(y===1)return}y=Math.round(y*100),x?(x.Enabled=y!==100,x.Opacity=y):d.style.filter+=" progid:"+A+"(opacity="+y+")"}function mo(d){for(var y=document.documentElement.style,x=0;x<d.length;x++)if(d[x]in y)return d[x];return!1}function rc(d,y,x){var A=y||new j(0,0);d.style[Us]=(de.ie3d?"translate("+A.x+"px,"+A.y+"px)":"translate3d("+A.x+"px,"+A.y+"px,0)")+(x?" scale("+x+")":"")}function ps(d,y){d._leaflet_pos=y,de.any3d?rc(d,y):(d.style.left=y.x+"px",d.style.top=y.y+"px")}function nf(d){return d._leaflet_pos||new j(0,0)}var N1,og,ST;if("onselectstart"in document)N1=function(){Oi(window,"selectstart",zn)},og=function(){rs(window,"selectstart",zn)};else{var F1=mo(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);N1=function(){if(F1){var d=document.documentElement.style;ST=d[F1],d[F1]="none"}},og=function(){F1&&(document.documentElement.style[F1]=ST,ST=void 0)}}function pA(){Oi(window,"dragstart",zn)}function fA(){rs(window,"dragstart",zn)}var ET,mA;function gA(d){for(;d.tabIndex===-1;)d=d.parentNode;!d.style||(of(),ET=d,mA=d.style.outline,d.style.outline="none",Oi(window,"keydown",of))}function of(){!ET||(ET.style.outline=mA,ET=void 0,mA=void 0,rs(window,"keydown",of))}function MI(d){do d=d.parentNode;while((!d.offsetWidth||!d.offsetHeight)&&d!==document.body);return d}function CT(d){var y=d.getBoundingClientRect();return{x:y.width/d.offsetWidth||1,y:y.height/d.offsetHeight||1,boundingClientRect:y}}var bB={__proto__:null,TRANSFORM:Us,TRANSITION:rf,TRANSITION_END:L1,get:$1,getStyle:ng,create:ar,remove:ds,empty:T0,toFront:Un,toBack:sf,hasClass:D1,addClass:te,removeClass:Ae,setClass:Ve,getClass:ci,setOpacity:Nr,testProp:mo,setTransform:rc,setPosition:ps,getPosition:nf,get disableTextSelection(){return N1},get enableTextSelection(){return og},disableImageDrag:pA,enableImageDrag:fA,preventOutline:gA,restoreOutline:of,getSizedParentNode:MI,getScale:CT};function Oi(d,y,x,A){if(y&&typeof y=="object")for(var k in y)_A(d,k,y[k],x);else{y=v(y);for(var W=0,he=y.length;W<he;W++)_A(d,y[W],x,A)}return this}var dh="_leaflet_events";function rs(d,y,x,A){if(arguments.length===1)PI(d),delete d[dh];else if(y&&typeof y=="object")for(var k in y)vA(d,k,y[k],x);else if(y=v(y),arguments.length===2)PI(d,function(Ee){return M(y,Ee)!==-1});else for(var W=0,he=y.length;W<he;W++)vA(d,y[W],x,A);return this}function PI(d,y){for(var x in d[dh]){var A=x.split(/\d/)[0];(!y||y(A))&&vA(d,A,null,null,x)}}var yA={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function _A(d,y,x,A){var k=y+l(x)+(A?"_"+l(A):"");if(d[dh]&&d[dh][k])return this;var W=function(Ee){return x.call(A||d,Ee||window.event)},he=W;!de.touchNative&&de.pointer&&y.indexOf("touch")===0?W=w0(d,y,W):de.touch&&y==="dblclick"?W=dA(d,W):"addEventListener"in d?y==="touchstart"||y==="touchmove"||y==="wheel"||y==="mousewheel"?d.addEventListener(yA[y]||y,W,de.passiveEvents?{passive:!1}:!1):y==="mouseenter"||y==="mouseleave"?(W=function(Ee){Ee=Ee||window.event,bA(d,Ee)&&he(Ee)},d.addEventListener(yA[y],W,!1)):d.addEventListener(y,he,!1):d.attachEvent("on"+y,W),d[dh]=d[dh]||{},d[dh][k]=W}function vA(d,y,x,A,k){k=k||y+l(x)+(A?"_"+l(A):"");var W=d[dh]&&d[dh][k];if(!W)return this;!de.touchNative&&de.pointer&&y.indexOf("touch")===0?pa(d,y,W):de.touch&&y==="dblclick"?I1(d,W):"removeEventListener"in d?d.removeEventListener(yA[y]||y,W,!1):d.detachEvent("on"+y,W),d[dh][k]=null}function ag(d){return d.stopPropagation?d.stopPropagation():d.originalEvent?d.originalEvent._stopped=!0:d.cancelBubble=!0,this}function AT(d){return _A(d,"wheel",ag),this}function k1(d){return Oi(d,"mousedown touchstart dblclick contextmenu",ag),d._leaflet_disable_click=!0,this}function zn(d){return d.preventDefault?d.preventDefault():d.returnValue=!1,this}function lg(d){return zn(d),ag(d),this}function II(d,y){if(!y)return new j(d.clientX,d.clientY);var x=CT(y),A=x.boundingClientRect;return new j((d.clientX-A.left)/x.x-y.clientLeft,(d.clientY-A.top)/x.y-y.clientTop)}var wB=de.win&&de.chrome?2*window.devicePixelRatio:de.gecko?window.devicePixelRatio:1;function S0(d){return de.edge?d.wheelDeltaY/2:d.deltaY&&d.deltaMode===0?-d.deltaY/wB:d.deltaY&&d.deltaMode===1?-d.deltaY*20:d.deltaY&&d.deltaMode===2?-d.deltaY*60:d.deltaX||d.deltaZ?0:d.wheelDelta?(d.wheelDeltaY||d.wheelDelta)/2:d.detail&&Math.abs(d.detail)<32765?-d.detail*20:d.detail?d.detail/-32765*60:0}function bA(d,y){var x=y.relatedTarget;if(!x)return!0;try{for(;x&&x!==d;)x=x.parentNode}catch{return!1}return x!==d}var xB={__proto__:null,on:Oi,off:rs,stopPropagation:ag,disableScrollPropagation:AT,disableClickPropagation:k1,preventDefault:zn,stop:lg,getMousePosition:II,getWheelDelta:S0,isExternalTarget:bA,addListener:Oi,removeListener:rs},LI=z.extend({run:function(d,y,x,A){this.stop(),this._el=d,this._inProgress=!0,this._duration=x||.25,this._easeOutPower=1/Math.max(A||.5,.2),this._startPos=nf(d),this._offset=y.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){!this._inProgress||(this._step(!0),this._complete())},_animate:function(){this._animId=J(this._animate,this),this._step()},_step:function(d){var y=+new Date-this._startTime,x=this._duration*1e3;y<x?this._runFrame(this._easeOut(y/x),d):(this._runFrame(1),this._complete())},_runFrame:function(d,y){var x=this._startPos.add(this._offset.multiplyBy(d));y&&x._round(),ps(this._el,x),this.fire("step")},_complete:function(){X(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(d){return 1-Math.pow(1-d,this._easeOutPower)}}),er=z.extend({options:{crs:Ti,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(d,y){y=b(this,y),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(d),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),y.maxBounds&&this.setMaxBounds(y.maxBounds),y.zoom!==void 0&&(this._zoom=this._limitZoom(y.zoom)),y.center&&y.zoom!==void 0&&this.setView(Re(y.center),y.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=rf&&de.any3d&&!de.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Oi(this._proxy,L1,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(d,y,x){if(y=y===void 0?this._zoom:this._limitZoom(y),d=this._limitCenter(Re(d),y,this.options.maxBounds),x=x||{},this._stop(),this._loaded&&!x.reset&&x!==!0){x.animate!==void 0&&(x.zoom=s({animate:x.animate},x.zoom),x.pan=s({animate:x.animate,duration:x.duration},x.pan));var A=this._zoom!==y?this._tryAnimatedZoom&&this._tryAnimatedZoom(d,y,x.zoom):this._tryAnimatedPan(d,x.pan);if(A)return clearTimeout(this._sizeTimer),this}return this._resetView(d,y),this},setZoom:function(d,y){return this._loaded?this.setView(this.getCenter(),d,{zoom:y}):(this._zoom=d,this)},zoomIn:function(d,y){return d=d||(de.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+d,y)},zoomOut:function(d,y){return d=d||(de.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-d,y)},setZoomAround:function(d,y,x){var A=this.getZoomScale(y),k=this.getSize().divideBy(2),W=d instanceof j?d:this.latLngToContainerPoint(d),he=W.subtract(k).multiplyBy(1-1/A),Ee=this.containerPointToLatLng(k.add(he));return this.setView(Ee,y,{zoom:x})},_getBoundsCenterZoom:function(d,y){y=y||{},d=d.getBounds?d.getBounds():ae(d);var x=Z(y.paddingTopLeft||y.padding||[0,0]),A=Z(y.paddingBottomRight||y.padding||[0,0]),k=this.getBoundsZoom(d,!1,x.add(A));if(k=typeof y.maxZoom=="number"?Math.min(y.maxZoom,k):k,k===1/0)return{center:d.getCenter(),zoom:k};var W=A.subtract(x).divideBy(2),he=this.project(d.getSouthWest(),k),Ee=this.project(d.getNorthEast(),k),Le=this.unproject(he.add(Ee).divideBy(2).add(W),k);return{center:Le,zoom:k}},fitBounds:function(d,y){if(d=ae(d),!d.isValid())throw new Error("Bounds are not valid.");var x=this._getBoundsCenterZoom(d,y);return this.setView(x.center,x.zoom,y)},fitWorld:function(d){return this.fitBounds([[-90,-180],[90,180]],d)},panTo:function(d,y){return this.setView(d,this._zoom,{pan:y})},panBy:function(d,y){if(d=Z(d).round(),y=y||{},!d.x&&!d.y)return this.fire("moveend");if(y.animate!==!0&&!this.getSize().contains(d))return this._resetView(this.unproject(this.project(this.getCenter()).add(d)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new LI,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),y.noMoveStart||this.fire("movestart"),y.animate!==!1){te(this._mapPane,"leaflet-pan-anim");var x=this._getMapPanePos().subtract(d).round();this._panAnim.run(this._mapPane,x,y.duration||.25,y.easeLinearity)}else this._rawPanBy(d),this.fire("move").fire("moveend");return this},flyTo:function(d,y,x){if(x=x||{},x.animate===!1||!de.any3d)return this.setView(d,y,x);this._stop();var A=this.project(this.getCenter()),k=this.project(d),W=this.getSize(),he=this._zoom;d=Re(d),y=y===void 0?he:y;var Ee=Math.max(W.x,W.y),Le=Ee*this.getZoomScale(he,y),Ye=k.distanceTo(A)||1,Dt=1.42,Ji=Dt*Dt;function mr(Jn){var sL=Jn?-1:1,LEe=Jn?Le:Ee,$Ee=Le*Le-Ee*Ee+sL*Ji*Ji*Ye*Ye,DEe=2*LEe*Ji*Ye,YB=$Ee/DEe,EK=Math.sqrt(YB*YB+1)-YB,NEe=EK<1e-9?-18:Math.log(EK);return NEe}function pg(Jn){return(Math.exp(Jn)-Math.exp(-Jn))/2}function G1(Jn){return(Math.exp(Jn)+Math.exp(-Jn))/2}function rL(Jn){return pg(Jn)/G1(Jn)}var I0=mr(0);function XB(Jn){return Ee*(G1(I0)/G1(I0+Dt*Jn))}function REe(Jn){return Ee*(G1(I0)*rL(I0+Dt*Jn)-pg(I0))/Ji}function MEe(Jn){return 1-Math.pow(1-Jn,1.5)}var PEe=Date.now(),TK=(mr(1)-I0)/Dt,IEe=x.duration?1e3*x.duration:1e3*TK*.8;function SK(){var Jn=(Date.now()-PEe)/IEe,sL=MEe(Jn)*TK;Jn<=1?(this._flyToFrame=J(SK,this),this._move(this.unproject(A.add(k.subtract(A).multiplyBy(REe(sL)/Ye)),he),this.getScaleZoom(Ee/XB(sL),he),{flyTo:!0})):this._move(d,y)._moveEnd(!0)}return this._moveStart(!0,x.noMoveStart),SK.call(this),this},flyToBounds:function(d,y){var x=this._getBoundsCenterZoom(d,y);return this.flyTo(x.center,x.zoom,y)},setMaxBounds:function(d){if(d=ae(d),d.isValid())this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds);else return this.options.maxBounds=null,this.off("moveend",this._panInsideMaxBounds);return this.options.maxBounds=d,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)},setMinZoom:function(d){var y=this.options.minZoom;return this.options.minZoom=d,this._loaded&&y!==d&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(d):this},setMaxZoom:function(d){var y=this.options.maxZoom;return this.options.maxZoom=d,this._loaded&&y!==d&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(d):this},panInsideBounds:function(d,y){this._enforcingBounds=!0;var x=this.getCenter(),A=this._limitCenter(x,this._zoom,ae(d));return x.equals(A)||this.panTo(A,y),this._enforcingBounds=!1,this},panInside:function(d,y){y=y||{};var x=Z(y.paddingTopLeft||y.padding||[0,0]),A=Z(y.paddingBottomRight||y.padding||[0,0]),k=this.project(this.getCenter()),W=this.project(d),he=this.getPixelBounds(),Ee=le([he.min.add(x),he.max.subtract(A)]),Le=Ee.getSize();if(!Ee.contains(W)){this._enforcingBounds=!0;var Ye=W.subtract(Ee.getCenter()),Dt=Ee.extend(W).getSize().subtract(Le);k.x+=Ye.x<0?-Dt.x:Dt.x,k.y+=Ye.y<0?-Dt.y:Dt.y,this.panTo(this.unproject(k),y),this._enforcingBounds=!1}return this},invalidateSize:function(d){if(!this._loaded)return this;d=s({animate:!1,pan:!0},d===!0?{animate:!0}:d);var y=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var x=this.getSize(),A=y.divideBy(2).round(),k=x.divideBy(2).round(),W=A.subtract(k);return!W.x&&!W.y?this:(d.animate&&d.pan?this.panBy(W):(d.pan&&this._rawPanBy(W),this.fire("move"),d.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:y,newSize:x}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(d){if(d=this._locateOptions=s({timeout:1e4,watch:!1},d),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var y=o(this._handleGeolocationResponse,this),x=o(this._handleGeolocationError,this);return d.watch?this._locationWatchId=navigator.geolocation.watchPosition(y,x,d):navigator.geolocation.getCurrentPosition(y,x,d),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(d){if(!!this._container._leaflet_id){var y=d.code,x=d.message||(y===1?"permission denied":y===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:y,message:"Geolocation error: "+x+"."})}},_handleGeolocationResponse:function(d){if(!!this._container._leaflet_id){var y=d.coords.latitude,x=d.coords.longitude,A=new we(y,x),k=A.toBounds(d.coords.accuracy*2),W=this._locateOptions;if(W.setView){var he=this.getBoundsZoom(k);this.setView(A,W.maxZoom?Math.min(he,W.maxZoom):he)}var Ee={latlng:A,bounds:k,timestamp:d.timestamp};for(var Le in d.coords)typeof d.coords[Le]=="number"&&(Ee[Le]=d.coords[Le]);this.fire("locationfound",Ee)}},addHandler:function(d,y){if(!y)return this;var x=this[d]=new y(this);return this._handlers.push(x),this.options[d]&&x.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ds(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(X(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var d;for(d in this._layers)this._layers[d].remove();for(d in this._panes)ds(this._panes[d]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(d,y){var x="leaflet-pane"+(d?" leaflet-"+d.replace("Pane","")+"-pane":""),A=ar("div",x,y||this._mapPane);return d&&(this._panes[d]=A),A},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var d=this.getPixelBounds(),y=this.unproject(d.getBottomLeft()),x=this.unproject(d.getTopRight());return new K(y,x)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(d,y,x){d=ae(d),x=Z(x||[0,0]);var A=this.getZoom()||0,k=this.getMinZoom(),W=this.getMaxZoom(),he=d.getNorthWest(),Ee=d.getSouthEast(),Le=this.getSize().subtract(x),Ye=le(this.project(Ee,A),this.project(he,A)).getSize(),Dt=de.any3d?this.options.zoomSnap:1,Ji=Le.x/Ye.x,mr=Le.y/Ye.y,pg=y?Math.max(Ji,mr):Math.min(Ji,mr);return A=this.getScaleZoom(pg,A),Dt&&(A=Math.round(A/(Dt/100))*(Dt/100),A=y?Math.ceil(A/Dt)*Dt:Math.floor(A/Dt)*Dt),Math.max(k,Math.min(W,A))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new j(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(d,y){var x=this._getTopLeftPoint(d,y);return new ie(x,x.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(d){return this.options.crs.getProjectedBounds(d===void 0?this.getZoom():d)},getPane:function(d){return typeof d=="string"?this._panes[d]:d},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(d,y){var x=this.options.crs;return y=y===void 0?this._zoom:y,x.scale(d)/x.scale(y)},getScaleZoom:function(d,y){var x=this.options.crs;y=y===void 0?this._zoom:y;var A=x.zoom(d*x.scale(y));return isNaN(A)?1/0:A},project:function(d,y){return y=y===void 0?this._zoom:y,this.options.crs.latLngToPoint(Re(d),y)},unproject:function(d,y){return y=y===void 0?this._zoom:y,this.options.crs.pointToLatLng(Z(d),y)},layerPointToLatLng:function(d){var y=Z(d).add(this.getPixelOrigin());return this.unproject(y)},latLngToLayerPoint:function(d){var y=this.project(Re(d))._round();return y._subtract(this.getPixelOrigin())},wrapLatLng:function(d){return this.options.crs.wrapLatLng(Re(d))},wrapLatLngBounds:function(d){return this.options.crs.wrapLatLngBounds(ae(d))},distance:function(d,y){return this.options.crs.distance(Re(d),Re(y))},containerPointToLayerPoint:function(d){return Z(d).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(d){return Z(d).add(this._getMapPanePos())},containerPointToLatLng:function(d){var y=this.containerPointToLayerPoint(Z(d));return this.layerPointToLatLng(y)},latLngToContainerPoint:function(d){return this.layerPointToContainerPoint(this.latLngToLayerPoint(Re(d)))},mouseEventToContainerPoint:function(d){return II(d,this._container)},mouseEventToLayerPoint:function(d){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(d))},mouseEventToLatLng:function(d){return this.layerPointToLatLng(this.mouseEventToLayerPoint(d))},_initContainer:function(d){var y=this._container=$1(d);if(y){if(y._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Oi(y,"scroll",this._onScroll,this),this._containerId=l(y)},_initLayout:function(){var d=this._container;this._fadeAnimated=this.options.fadeAnimation&&de.any3d,te(d,"leaflet-container"+(de.touch?" leaflet-touch":"")+(de.retina?" leaflet-retina":"")+(de.ielt9?" leaflet-oldie":"")+(de.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var y=ng(d,"position");y!=="absolute"&&y!=="relative"&&y!=="fixed"&&(d.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var d=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ps(this._mapPane,new j(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(te(d.markerPane,"leaflet-zoom-hide"),te(d.shadowPane,"leaflet-zoom-hide"))},_resetView:function(d,y){ps(this._mapPane,new j(0,0));var x=!this._loaded;this._loaded=!0,y=this._limitZoom(y),this.fire("viewprereset");var A=this._zoom!==y;this._moveStart(A,!1)._move(d,y)._moveEnd(A),this.fire("viewreset"),x&&this.fire("load")},_moveStart:function(d,y){return d&&this.fire("zoomstart"),y||this.fire("movestart"),this},_move:function(d,y,x,A){y===void 0&&(y=this._zoom);var k=this._zoom!==y;return this._zoom=y,this._lastCenter=d,this._pixelOrigin=this._getNewPixelOrigin(d),A?x&&x.pinch&&this.fire("zoom",x):((k||x&&x.pinch)&&this.fire("zoom",x),this.fire("move",x)),this},_moveEnd:function(d){return d&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return X(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(d){ps(this._mapPane,this._getMapPanePos().subtract(d))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(d){this._targets={},this._targets[l(this._container)]=this;var y=d?rs:Oi;y(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&y(window,"resize",this._onResize,this),de.any3d&&this.options.transform3DLimit&&(d?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){X(this._resizeRequest),this._resizeRequest=J(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var d=this._getMapPanePos();Math.max(Math.abs(d.x),Math.abs(d.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(d,y){for(var x=[],A,k=y==="mouseout"||y==="mouseover",W=d.target||d.srcElement,he=!1;W;){if(A=this._targets[l(W)],A&&(y==="click"||y==="preclick")&&this._draggableMoved(A)){he=!0;break}if(A&&A.listens(y,!0)&&(k&&!bA(W,d)||(x.push(A),k))||W===this._container)break;W=W.parentNode}return!x.length&&!he&&!k&&this.listens(y,!0)&&(x=[this]),x},_isClickDisabled:function(d){for(;d!==this._container;){if(d._leaflet_disable_click)return!0;d=d.parentNode}},_handleDOMEvent:function(d){var y=d.target||d.srcElement;if(!(!this._loaded||y._leaflet_disable_events||d.type==="click"&&this._isClickDisabled(y))){var x=d.type;x==="mousedown"&&gA(y),this._fireDOMEvent(d,x)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(d,y,x){if(d.type==="click"){var A=s({},d);A.type="preclick",this._fireDOMEvent(A,A.type,x)}var k=this._findEventTargets(d,y);if(x){for(var W=[],he=0;he<x.length;he++)x[he].listens(y,!0)&&W.push(x[he]);k=W.concat(k)}if(!!k.length){y==="contextmenu"&&zn(d);var Ee=k[0],Le={originalEvent:d};if(d.type!=="keypress"&&d.type!=="keydown"&&d.type!=="keyup"){var Ye=Ee.getLatLng&&(!Ee._radius||Ee._radius<=10);Le.containerPoint=Ye?this.latLngToContainerPoint(Ee.getLatLng()):this.mouseEventToContainerPoint(d),Le.layerPoint=this.containerPointToLayerPoint(Le.containerPoint),Le.latlng=Ye?Ee.getLatLng():this.layerPointToLatLng(Le.layerPoint)}for(he=0;he<k.length;he++)if(k[he].fire(y,Le,!0),Le.originalEvent._stopped||k[he].options.bubblingMouseEvents===!1&&M(this._mouseEvents,y)!==-1)return}},_draggableMoved:function(d){return d=d.dragging&&d.dragging.enabled()?d:this,d.dragging&&d.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var d=0,y=this._handlers.length;d<y;d++)this._handlers[d].disable()},whenReady:function(d,y){return this._loaded?d.call(y||this,{target:this}):this.on("load",d,y),this},_getMapPanePos:function(){return nf(this._mapPane)||new j(0,0)},_moved:function(){var d=this._getMapPanePos();return d&&!d.equals([0,0])},_getTopLeftPoint:function(d,y){var x=d&&y!==void 0?this._getNewPixelOrigin(d,y):this.getPixelOrigin();return x.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(d,y){var x=this.getSize()._divideBy(2);return this.project(d,y)._subtract(x)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(d,y,x){var A=this._getNewPixelOrigin(x,y);return this.project(d,y)._subtract(A)},_latLngBoundsToNewLayerBounds:function(d,y,x){var A=this._getNewPixelOrigin(x,y);return le([this.project(d.getSouthWest(),y)._subtract(A),this.project(d.getNorthWest(),y)._subtract(A),this.project(d.getSouthEast(),y)._subtract(A),this.project(d.getNorthEast(),y)._subtract(A)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(d){return this.latLngToLayerPoint(d).subtract(this._getCenterLayerPoint())},_limitCenter:function(d,y,x){if(!x)return d;var A=this.project(d,y),k=this.getSize().divideBy(2),W=new ie(A.subtract(k),A.add(k)),he=this._getBoundsOffset(W,x,y);return he.round().equals([0,0])?d:this.unproject(A.add(he),y)},_limitOffset:function(d,y){if(!y)return d;var x=this.getPixelBounds(),A=new ie(x.min.add(d),x.max.add(d));return d.add(this._getBoundsOffset(A,y))},_getBoundsOffset:function(d,y,x){var A=le(this.project(y.getNorthEast(),x),this.project(y.getSouthWest(),x)),k=A.min.subtract(d.min),W=A.max.subtract(d.max),he=this._rebound(k.x,-W.x),Ee=this._rebound(k.y,-W.y);return new j(he,Ee)},_rebound:function(d,y){return d+y>0?Math.round(d-y)/2:Math.max(0,Math.ceil(d))-Math.max(0,Math.floor(y))},_limitZoom:function(d){var y=this.getMinZoom(),x=this.getMaxZoom(),A=de.any3d?this.options.zoomSnap:1;return A&&(d=Math.round(d/A)*A),Math.max(y,Math.min(x,d))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ae(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(d,y){var x=this._getCenterOffset(d)._trunc();return(y&&y.animate)!==!0&&!this.getSize().contains(x)?!1:(this.panBy(x,y),!0)},_createAnimProxy:function(){var d=this._proxy=ar("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(d),this.on("zoomanim",function(y){var x=Us,A=this._proxy.style[x];rc(this._proxy,this.project(y.center,y.zoom),this.getZoomScale(y.zoom,1)),A===this._proxy.style[x]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ds(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var d=this.getCenter(),y=this.getZoom();rc(this._proxy,this.project(d,y),this.getZoomScale(y,1))},_catchTransitionEnd:function(d){this._animatingZoom&&d.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(d,y,x){if(this._animatingZoom)return!0;if(x=x||{},!this._zoomAnimated||x.animate===!1||this._nothingToAnimate()||Math.abs(y-this._zoom)>this.options.zoomAnimationThreshold)return!1;var A=this.getZoomScale(y),k=this._getCenterOffset(d)._divideBy(1-1/A);return x.animate!==!0&&!this.getSize().contains(k)?!1:(J(function(){this._moveStart(!0,!1)._animateZoom(d,y,!0)},this),!0)},_animateZoom:function(d,y,x,A){!this._mapPane||(x&&(this._animatingZoom=!0,this._animateToCenter=d,this._animateToZoom=y,te(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:d,zoom:y,noUpdate:A}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){!this._animatingZoom||(this._mapPane&&Ae(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function $I(d,y){return new er(d,y)}var sc=re.extend({options:{position:"topright"},initialize:function(d){b(this,d)},getPosition:function(){return this.options.position},setPosition:function(d){var y=this._map;return y&&y.removeControl(this),this.options.position=d,y&&y.addControl(this),this},getContainer:function(){return this._container},addTo:function(d){this.remove(),this._map=d;var y=this._container=this.onAdd(d),x=this.getPosition(),A=d._controlCorners[x];return te(y,"leaflet-control"),x.indexOf("bottom")!==-1?A.insertBefore(y,A.firstChild):A.appendChild(y),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ds(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(d){this._map&&d&&d.screenX>0&&d.screenY>0&&this._map.getContainer().focus()}}),U1=function(d){return new sc(d)};er.include({addControl:function(d){return d.addTo(this),this},removeControl:function(d){return d.remove(),this},_initControlPos:function(){var d=this._controlCorners={},y="leaflet-",x=this._controlContainer=ar("div",y+"control-container",this._container);function A(k,W){var he=y+k+" "+y+W;d[k+W]=ar("div",he,x)}A("top","left"),A("top","right"),A("bottom","left"),A("bottom","right")},_clearControlPos:function(){for(var d in this._controlCorners)ds(this._controlCorners[d]);ds(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var DI=sc.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(d,y,x,A){return x<A?-1:A<x?1:0}},initialize:function(d,y,x){b(this,x),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1;for(var A in d)this._addLayer(d[A],A);for(A in y)this._addLayer(y[A],A,!0)},onAdd:function(d){this._initLayout(),this._update(),this._map=d,d.on("zoomend",this._checkDisabledLayers,this);for(var y=0;y<this._layers.length;y++)this._layers[y].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(d){return sc.prototype.addTo.call(this,d),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(d,y){return this._addLayer(d,y),this._map?this._update():this},addOverlay:function(d,y){return this._addLayer(d,y,!0),this._map?this._update():this},removeLayer:function(d){d.off("add remove",this._onLayerChange,this);var y=this._getLayer(l(d));return y&&this._layers.splice(this._layers.indexOf(y),1),this._map?this._update():this},expand:function(){te(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var d=this._map.getSize().y-(this._container.offsetTop+50);return d<this._section.clientHeight?(te(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=d+"px"):Ae(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ae(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var d="leaflet-control-layers",y=this._container=ar("div",d),x=this.options.collapsed;y.setAttribute("aria-haspopup",!0),k1(y),AT(y);var A=this._section=ar("section",d+"-list");x&&(this._map.on("click",this.collapse,this),Oi(y,{mouseenter:function(){Oi(A,"click",zn),this.expand(),setTimeout(function(){rs(A,"click",zn)})},mouseleave:this.collapse},this));var k=this._layersLink=ar("a",d+"-toggle",y);k.href="#",k.title="Layers",k.setAttribute("role","button"),Oi(k,"click",zn),Oi(k,"focus",this.expand,this),x||this.expand(),this._baseLayersList=ar("div",d+"-base",A),this._separator=ar("div",d+"-separator",A),this._overlaysList=ar("div",d+"-overlays",A),y.appendChild(A)},_getLayer:function(d){for(var y=0;y<this._layers.length;y++)if(this._layers[y]&&l(this._layers[y].layer)===d)return this._layers[y]},_addLayer:function(d,y,x){this._map&&d.on("add remove",this._onLayerChange,this),this._layers.push({layer:d,name:y,overlay:x}),this.options.sortLayers&&this._layers.sort(o(function(A,k){return this.options.sortFunction(A.layer,k.layer,A.name,k.name)},this)),this.options.autoZIndex&&d.setZIndex&&(this._lastZIndex++,d.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;T0(this._baseLayersList),T0(this._overlaysList),this._layerControlInputs=[];var d,y,x,A,k=0;for(x=0;x<this._layers.length;x++)A=this._layers[x],this._addItem(A),y=y||A.overlay,d=d||!A.overlay,k+=A.overlay?0:1;return this.options.hideSingleBase&&(d=d&&k>1,this._baseLayersList.style.display=d?"":"none"),this._separator.style.display=y&&d?"":"none",this},_onLayerChange:function(d){this._handlingClick||this._update();var y=this._getLayer(l(d.target)),x=y.overlay?d.type==="add"?"overlayadd":"overlayremove":d.type==="add"?"baselayerchange":null;x&&this._map.fire(x,y)},_createRadioElement:function(d,y){var x='<input type="radio" class="leaflet-control-layers-selector" name="'+d+'"'+(y?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=x,A.firstChild},_addItem:function(d){var y=document.createElement("label"),x=this._map.hasLayer(d.layer),A;d.overlay?(A=document.createElement("input"),A.type="checkbox",A.className="leaflet-control-layers-selector",A.defaultChecked=x):A=this._createRadioElement("leaflet-base-layers_"+l(this),x),this._layerControlInputs.push(A),A.layerId=l(d.layer),Oi(A,"click",this._onInputClick,this);var k=document.createElement("span");k.innerHTML=" "+d.name;var W=document.createElement("span");y.appendChild(W),W.appendChild(A),W.appendChild(k);var he=d.overlay?this._overlaysList:this._baseLayersList;return he.appendChild(y),this._checkDisabledLayers(),y},_onInputClick:function(){var d=this._layerControlInputs,y,x,A=[],k=[];this._handlingClick=!0;for(var W=d.length-1;W>=0;W--)y=d[W],x=this._getLayer(y.layerId).layer,y.checked?A.push(x):y.checked||k.push(x);for(W=0;W<k.length;W++)this._map.hasLayer(k[W])&&this._map.removeLayer(k[W]);for(W=0;W<A.length;W++)this._map.hasLayer(A[W])||this._map.addLayer(A[W]);this._handlingClick=!1,this._refocusOnMap()},_checkDisabledLayers:function(){for(var d=this._layerControlInputs,y,x,A=this._map.getZoom(),k=d.length-1;k>=0;k--)y=d[k],x=this._getLayer(y.layerId).layer,y.disabled=x.options.minZoom!==void 0&&A<x.options.minZoom||x.options.maxZoom!==void 0&&A>x.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this}}),TB=function(d,y,x){return new DI(d,y,x)},wA=sc.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(d){var y="leaflet-control-zoom",x=ar("div",y+" leaflet-bar"),A=this.options;return this._zoomInButton=this._createButton(A.zoomInText,A.zoomInTitle,y+"-in",x,this._zoomIn),this._zoomOutButton=this._createButton(A.zoomOutText,A.zoomOutTitle,y+"-out",x,this._zoomOut),this._updateDisabled(),d.on("zoomend zoomlevelschange",this._updateDisabled,this),x},onRemove:function(d){d.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(d){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(d.shiftKey?3:1))},_zoomOut:function(d){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(d.shiftKey?3:1))},_createButton:function(d,y,x,A,k){var W=ar("a",x,A);return W.innerHTML=d,W.href="#",W.title=y,W.setAttribute("role","button"),W.setAttribute("aria-label",y),k1(W),Oi(W,"click",lg),Oi(W,"click",k,this),Oi(W,"click",this._refocusOnMap,this),W},_updateDisabled:function(){var d=this._map,y="leaflet-disabled";Ae(this._zoomInButton,y),Ae(this._zoomOutButton,y),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||d._zoom===d.getMinZoom())&&(te(this._zoomOutButton,y),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||d._zoom===d.getMaxZoom())&&(te(this._zoomInButton,y),this._zoomInButton.setAttribute("aria-disabled","true"))}});er.mergeOptions({zoomControl:!0}),er.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new wA,this.addControl(this.zoomControl))});var SB=function(d){return new wA(d)},NI=sc.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(d){var y="leaflet-control-scale",x=ar("div",y),A=this.options;return this._addScales(A,y+"-line",x),d.on(A.updateWhenIdle?"moveend":"move",this._update,this),d.whenReady(this._update,this),x},onRemove:function(d){d.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(d,y,x){d.metric&&(this._mScale=ar("div",y,x)),d.imperial&&(this._iScale=ar("div",y,x))},_update:function(){var d=this._map,y=d.getSize().y/2,x=d.distance(d.containerPointToLatLng([0,y]),d.containerPointToLatLng([this.options.maxWidth,y]));this._updateScales(x)},_updateScales:function(d){this.options.metric&&d&&this._updateMetric(d),this.options.imperial&&d&&this._updateImperial(d)},_updateMetric:function(d){var y=this._getRoundNum(d),x=y<1e3?y+" m":y/1e3+" km";this._updateScale(this._mScale,x,y/d)},_updateImperial:function(d){var y=d*3.2808399,x,A,k;y>5280?(x=y/5280,A=this._getRoundNum(x),this._updateScale(this._iScale,A+" mi",A/x)):(k=this._getRoundNum(y),this._updateScale(this._iScale,k+" ft",k/y))},_updateScale:function(d,y,x){d.style.width=Math.round(this.options.maxWidth*x)+"px",d.innerHTML=y},_getRoundNum:function(d){var y=Math.pow(10,(Math.floor(d)+"").length-1),x=d/y;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:1,y*x}}),EB=function(d){return new NI(d)},E0='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',xA=sc.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(de.inlineSvg?E0+" ":"")+"Leaflet</a>"},initialize:function(d){b(this,d),this._attributions={}},onAdd:function(d){d.attributionControl=this,this._container=ar("div","leaflet-control-attribution"),k1(this._container);for(var y in d._layers)d._layers[y].getAttribution&&this.addAttribution(d._layers[y].getAttribution());return this._update(),d.on("layeradd",this._addAttribution,this),this._container},onRemove:function(d){d.off("layeradd",this._addAttribution,this)},_addAttribution:function(d){d.layer.getAttribution&&(this.addAttribution(d.layer.getAttribution()),d.layer.once("remove",function(){this.removeAttribution(d.layer.getAttribution())},this))},setPrefix:function(d){return this.options.prefix=d,this._update(),this},addAttribution:function(d){return d?(this._attributions[d]||(this._attributions[d]=0),this._attributions[d]++,this._update(),this):this},removeAttribution:function(d){return d?(this._attributions[d]&&(this._attributions[d]--,this._update()),this):this},_update:function(){if(!!this._map){var d=[];for(var y in this._attributions)this._attributions[y]&&d.push(y);var x=[];this.options.prefix&&x.push(this.options.prefix),d.length&&x.push(d.join(", ")),this._container.innerHTML=x.join(' <span aria-hidden="true">|</span> ')}}});er.mergeOptions({attributionControl:!0}),er.addInitHook(function(){this.options.attributionControl&&new xA().addTo(this)});var CB=function(d){return new xA(d)};sc.Layers=DI,sc.Zoom=wA,sc.Scale=NI,sc.Attribution=xA,U1.layers=TB,U1.zoom=SB,U1.scale=EB,U1.attribution=CB;var ph=re.extend({initialize:function(d){this._map=d},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});ph.addTo=function(d,y){return d.addHandler(y,this),this};var FI={Events:pe},TA=de.touch?"touchstart mousedown":"mousedown",fh=z.extend({options:{clickTolerance:3},initialize:function(d,y,x,A){b(this,A),this._element=d,this._dragStartTarget=y||d,this._preventOutline=x},enable:function(){this._enabled||(Oi(this._dragStartTarget,TA,this._onDown,this),this._enabled=!0)},disable:function(){!this._enabled||(fh._dragging===this&&this.finishDrag(!0),rs(this._dragStartTarget,TA,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(d){if(!!this._enabled&&(this._moved=!1,!D1(this._element,"leaflet-zoom-anim"))){if(d.touches&&d.touches.length!==1){fh._dragging===this&&this.finishDrag();return}if(!(fh._dragging||d.shiftKey||d.which!==1&&d.button!==1&&!d.touches)&&(fh._dragging=this,this._preventOutline&&gA(this._element),pA(),N1(),!this._moving)){this.fire("down");var y=d.touches?d.touches[0]:d,x=MI(this._element);this._startPoint=new j(y.clientX,y.clientY),this._startPos=nf(this._element),this._parentScale=CT(x);var A=d.type==="mousedown";Oi(document,A?"mousemove":"touchmove",this._onMove,this),Oi(document,A?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(d){if(!!this._enabled){if(d.touches&&d.touches.length>1){this._moved=!0;return}var y=d.touches&&d.touches.length===1?d.touches[0]:d,x=new j(y.clientX,y.clientY)._subtract(this._startPoint);!x.x&&!x.y||Math.abs(x.x)+Math.abs(x.y)<this.options.clickTolerance||(x.x/=this._parentScale.x,x.y/=this._parentScale.y,zn(d),this._moved||(this.fire("dragstart"),this._moved=!0,te(document.body,"leaflet-dragging"),this._lastTarget=d.target||d.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),te(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(x),this._moving=!0,this._lastEvent=d,this._updatePosition())}},_updatePosition:function(){var d={originalEvent:this._lastEvent};this.fire("predrag",d),ps(this._element,this._newPos),this.fire("drag",d)},_onUp:function(){!this._enabled||this.finishDrag()},finishDrag:function(d){Ae(document.body,"leaflet-dragging"),this._lastTarget&&(Ae(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),rs(document,"mousemove touchmove",this._onMove,this),rs(document,"mouseup touchend touchcancel",this._onUp,this),fA(),og(),this._moved&&this._moving&&this.fire("dragend",{noInertia:d,distance:this._newPos.distanceTo(this._startPos)}),this._moving=!1,fh._dragging=!1}});function kI(d,y){if(!y||!d.length)return d.slice();var x=y*y;return d=RB(d,x),d=OB(d,x),d}function UI(d,y,x){return Math.sqrt(mh(d,y,x,!0))}function AB(d,y,x){return mh(d,y,x)}function OB(d,y){var x=d.length,A=typeof Uint8Array!=void 0+""?Uint8Array:Array,k=new A(x);k[0]=k[x-1]=1,SA(d,k,y,0,x-1);var W,he=[];for(W=0;W<x;W++)k[W]&&he.push(d[W]);return he}function SA(d,y,x,A,k){var W=0,he,Ee,Le;for(Ee=A+1;Ee<=k-1;Ee++)Le=mh(d[Ee],d[A],d[k],!0),Le>W&&(he=Ee,W=Le);W>x&&(y[he]=1,SA(d,y,x,A,he),SA(d,y,x,he,k))}function RB(d,y){for(var x=[d[0]],A=1,k=0,W=d.length;A<W;A++)VI(d[A],d[k])>y&&(x.push(d[A]),k=A);return k<W-1&&x.push(d[W-1]),x}var zI;function BI(d,y,x,A,k){var W=A?zI:Md(d,x),he=Md(y,x),Ee,Le,Ye;for(zI=he;;){if(!(W|he))return[d,y];if(W&he)return!1;Ee=W||he,Le=z1(d,y,Ee,x,k),Ye=Md(Le,x),Ee===W?(d=Le,W=Ye):(y=Le,he=Ye)}}function z1(d,y,x,A,k){var W=y.x-d.x,he=y.y-d.y,Ee=A.min,Le=A.max,Ye,Dt;return x&8?(Ye=d.x+W*(Le.y-d.y)/he,Dt=Le.y):x&4?(Ye=d.x+W*(Ee.y-d.y)/he,Dt=Ee.y):x&2?(Ye=Le.x,Dt=d.y+he*(Le.x-d.x)/W):x&1&&(Ye=Ee.x,Dt=d.y+he*(Ee.x-d.x)/W),new j(Ye,Dt,k)}function Md(d,y){var x=0;return d.x<y.min.x?x|=1:d.x>y.max.x&&(x|=2),d.y<y.min.y?x|=4:d.y>y.max.y&&(x|=8),x}function VI(d,y){var x=y.x-d.x,A=y.y-d.y;return x*x+A*A}function mh(d,y,x,A){var k=y.x,W=y.y,he=x.x-k,Ee=x.y-W,Le=he*he+Ee*Ee,Ye;return Le>0&&(Ye=((d.x-k)*he+(d.y-W)*Ee)/Le,Ye>1?(k=x.x,W=x.y):Ye>0&&(k+=he*Ye,W+=Ee*Ye)),he=d.x-k,Ee=d.y-W,A?he*he+Ee*Ee:new j(k,W)}function Pd(d){return!C(d[0])||typeof d[0][0]!="object"&&typeof d[0][0]<"u"}function GI(d){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Pd(d)}var MB={__proto__:null,simplify:kI,pointToSegmentDistance:UI,closestPointOnSegment:AB,clipSegment:BI,_getEdgeIntersection:z1,_getBitCode:Md,_sqClosestPointOnSegment:mh,isFlat:Pd,_flat:GI};function jI(d,y,x){var A,k=[1,4,2,8],W,he,Ee,Le,Ye,Dt,Ji,mr;for(W=0,Dt=d.length;W<Dt;W++)d[W]._code=Md(d[W],y);for(Ee=0;Ee<4;Ee++){for(Ji=k[Ee],A=[],W=0,Dt=d.length,he=Dt-1;W<Dt;he=W++)Le=d[W],Ye=d[he],Le._code&Ji?Ye._code&Ji||(mr=z1(Ye,Le,Ji,y,x),mr._code=Md(mr,y),A.push(mr)):(Ye._code&Ji&&(mr=z1(Ye,Le,Ji,y,x),mr._code=Md(mr,y),A.push(mr)),A.push(Le));d=A}return d}var PB={__proto__:null,clipPolygon:jI},EA={project:function(d){return new j(d.lng,d.lat)},unproject:function(d){return new we(d.y,d.x)},bounds:new ie([-180,-90],[180,90])},CA={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ie([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(d){var y=Math.PI/180,x=this.R,A=d.lat*y,k=this.R_MINOR/x,W=Math.sqrt(1-k*k),he=W*Math.sin(A),Ee=Math.tan(Math.PI/4-A/2)/Math.pow((1-he)/(1+he),W/2);return A=-x*Math.log(Math.max(Ee,1e-10)),new j(d.lng*y*x,A)},unproject:function(d){for(var y=180/Math.PI,x=this.R,A=this.R_MINOR/x,k=Math.sqrt(1-A*A),W=Math.exp(-d.y/x),he=Math.PI/2-2*Math.atan(W),Ee=0,Le=.1,Ye;Ee<15&&Math.abs(Le)>1e-7;Ee++)Ye=k*Math.sin(he),Ye=Math.pow((1-Ye)/(1+Ye),k/2),Le=Math.PI/2-2*Math.atan(W*Ye)-he,he+=Le;return new we(he*y,d.x*y/x)}},IB={__proto__:null,LonLat:EA,Mercator:CA,SphericalMercator:$e},LB=s({},Pe,{code:"EPSG:3395",projection:CA,transformation:function(){var d=.5/(Math.PI*CA.R);return jt(d,.5,-d,.5)}()}),OT=s({},Pe,{code:"EPSG:4326",projection:EA,transformation:jt(1/180,1,-1/180,.5)}),HI=s({},Ge,{projection:EA,transformation:jt(1,0,-1,0),scale:function(d){return Math.pow(2,d)},zoom:function(d){return Math.log(d)/Math.LN2},distance:function(d,y){var x=y.lng-d.lng,A=y.lat-d.lat;return Math.sqrt(x*x+A*A)},infinite:!0});Ge.Earth=Pe,Ge.EPSG3395=LB,Ge.EPSG3857=Ti,Ge.EPSG900913=li,Ge.EPSG4326=OT,Ge.Simple=HI;var Jc=z.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(d){return d.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(d){return d&&d.removeLayer(this),this},getPane:function(d){return this._map.getPane(d?this.options[d]||d:this.options.pane)},addInteractiveTarget:function(d){return this._map._targets[l(d)]=this,this},removeInteractiveTarget:function(d){return delete this._map._targets[l(d)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(d){var y=d.target;if(!!y.hasLayer(this)){if(this._map=y,this._zoomAnimated=y._zoomAnimated,this.getEvents){var x=this.getEvents();y.on(x,this),this.once("remove",function(){y.off(x,this)},this)}this.onAdd(y),this.fire("add"),y.fire("layeradd",{layer:this})}}});er.include({addLayer:function(d){if(!d._layerAdd)throw new Error("The provided object is not a Layer.");var y=l(d);return this._layers[y]?this:(this._layers[y]=d,d._mapToAdd=this,d.beforeAdd&&d.beforeAdd(this),this.whenReady(d._layerAdd,d),this)},removeLayer:function(d){var y=l(d);return this._layers[y]?(this._loaded&&d.onRemove(this),delete this._layers[y],this._loaded&&(this.fire("layerremove",{layer:d}),d.fire("remove")),d._map=d._mapToAdd=null,this):this},hasLayer:function(d){return l(d)in this._layers},eachLayer:function(d,y){for(var x in this._layers)d.call(y,this._layers[x]);return this},_addLayers:function(d){d=d?C(d)?d:[d]:[];for(var y=0,x=d.length;y<x;y++)this.addLayer(d[y])},_addZoomLimit:function(d){(!isNaN(d.options.maxZoom)||!isNaN(d.options.minZoom))&&(this._zoomBoundLayers[l(d)]=d,this._updateZoomLevels())},_removeZoomLimit:function(d){var y=l(d);this._zoomBoundLayers[y]&&(delete this._zoomBoundLayers[y],this._updateZoomLevels())},_updateZoomLevels:function(){var d=1/0,y=-1/0,x=this._getZoomSpan();for(var A in this._zoomBoundLayers){var k=this._zoomBoundLayers[A].options;d=k.minZoom===void 0?d:Math.min(d,k.minZoom),y=k.maxZoom===void 0?y:Math.max(y,k.maxZoom)}this._layersMaxZoom=y===-1/0?void 0:y,this._layersMinZoom=d===1/0?void 0:d,x!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var C0=Jc.extend({initialize:function(d,y){b(this,y),this._layers={};var x,A;if(d)for(x=0,A=d.length;x<A;x++)this.addLayer(d[x])},addLayer:function(d){var y=this.getLayerId(d);return this._layers[y]=d,this._map&&this._map.addLayer(d),this},removeLayer:function(d){var y=d in this._layers?d:this.getLayerId(d);return this._map&&this._layers[y]&&this._map.removeLayer(this._layers[y]),delete this._layers[y],this},hasLayer:function(d){var y=typeof d=="number"?d:this.getLayerId(d);return y in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(d){var y=Array.prototype.slice.call(arguments,1),x,A;for(x in this._layers)A=this._layers[x],A[d]&&A[d].apply(A,y);return this},onAdd:function(d){this.eachLayer(d.addLayer,d)},onRemove:function(d){this.eachLayer(d.removeLayer,d)},eachLayer:function(d,y){for(var x in this._layers)d.call(y,this._layers[x]);return this},getLayer:function(d){return this._layers[d]},getLayers:function(){var d=[];return this.eachLayer(d.push,d),d},setZIndex:function(d){return this.invoke("setZIndex",d)},getLayerId:function(d){return l(d)}}),$B=function(d,y){return new C0(d,y)},cg=C0.extend({addLayer:function(d){return this.hasLayer(d)?this:(d.addEventParent(this),C0.prototype.addLayer.call(this,d),this.fire("layeradd",{layer:d}))},removeLayer:function(d){return this.hasLayer(d)?(d in this._layers&&(d=this._layers[d]),d.removeEventParent(this),C0.prototype.removeLayer.call(this,d),this.fire("layerremove",{layer:d})):this},setStyle:function(d){return this.invoke("setStyle",d)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var d=new K;for(var y in this._layers){var x=this._layers[y];d.extend(x.getBounds?x.getBounds():x.getLatLng())}return d}}),DB=function(d,y){return new cg(d,y)},af=re.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(d){b(this,d)},createIcon:function(d){return this._createIcon("icon",d)},createShadow:function(d){return this._createIcon("shadow",d)},_createIcon:function(d,y){var x=this._getIconUrl(d);if(!x){if(d==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var A=this._createImg(x,y&&y.tagName==="IMG"?y:null);return this._setIconStyles(A,d),(this.options.crossOrigin||this.options.crossOrigin==="")&&(A.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),A},_setIconStyles:function(d,y){var x=this.options,A=x[y+"Size"];typeof A=="number"&&(A=[A,A]);var k=Z(A),W=Z(y==="shadow"&&x.shadowAnchor||x.iconAnchor||k&&k.divideBy(2,!0));d.className="leaflet-marker-"+y+" "+(x.className||""),W&&(d.style.marginLeft=-W.x+"px",d.style.marginTop=-W.y+"px"),k&&(d.style.width=k.x+"px",d.style.height=k.y+"px")},_createImg:function(d,y){return y=y||document.createElement("img"),y.src=d,y},_getIconUrl:function(d){return de.retina&&this.options[d+"RetinaUrl"]||this.options[d+"Url"]}});function qI(d){return new af(d)}var A0=af.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(d){return typeof A0.imagePath!="string"&&(A0.imagePath=this._detectIconPath()),(this.options.imagePath||A0.imagePath)+af.prototype._getIconUrl.call(this,d)},_stripUrl:function(d){var y=function(x,A,k){var W=A.exec(x);return W&&W[k]};return d=y(d,/^url\((['"])?(.+)\1\)$/,2),d&&y(d,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var d=ar("div","leaflet-default-icon-path",document.body),y=ng(d,"background-image")||ng(d,"backgroundImage");if(document.body.removeChild(d),y=this._stripUrl(y),y)return y;var x=document.querySelector('link[href$="leaflet.css"]');return x?x.href.substring(0,x.href.length-11-1):""}}),RT=ph.extend({initialize:function(d){this._marker=d},addHooks:function(){var d=this._marker._icon;this._draggable||(this._draggable=new fh(d,d,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),te(d,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ae(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(d){var y=this._marker,x=y._map,A=this._marker.options.autoPanSpeed,k=this._marker.options.autoPanPadding,W=nf(y._icon),he=x.getPixelBounds(),Ee=x.getPixelOrigin(),Le=le(he.min._subtract(Ee).add(k),he.max._subtract(Ee).subtract(k));if(!Le.contains(W)){var Ye=Z((Math.max(Le.max.x,W.x)-Le.max.x)/(he.max.x-Le.max.x)-(Math.min(Le.min.x,W.x)-Le.min.x)/(he.min.x-Le.min.x),(Math.max(Le.max.y,W.y)-Le.max.y)/(he.max.y-Le.max.y)-(Math.min(Le.min.y,W.y)-Le.min.y)/(he.min.y-Le.min.y)).multiplyBy(A);x.panBy(Ye,{animate:!1}),this._draggable._newPos._add(Ye),this._draggable._startPos._add(Ye),ps(y._icon,this._draggable._newPos),this._onDrag(d),this._panRequest=J(this._adjustPan.bind(this,d))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(d){this._marker.options.autoPan&&(X(this._panRequest),this._panRequest=J(this._adjustPan.bind(this,d)))},_onDrag:function(d){var y=this._marker,x=y._shadow,A=nf(y._icon),k=y._map.layerPointToLatLng(A);x&&ps(x,A),y._latlng=k,d.latlng=k,d.oldLatLng=this._oldLatLng,y.fire("move",d).fire("drag",d)},_onDragEnd:function(d){X(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",d)}}),MT=Jc.extend({options:{icon:new A0,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(d,y){b(this,y),this._latlng=Re(d)},onAdd:function(d){this._zoomAnimated=this._zoomAnimated&&d.options.markerZoomAnimation,this._zoomAnimated&&d.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(d){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&d.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(d){var y=this._latlng;return this._latlng=Re(d),this.update(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},setZIndexOffset:function(d){return this.options.zIndexOffset=d,this.update()},getIcon:function(){return this.options.icon},setIcon:function(d){return this.options.icon=d,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var d=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(d)}return this},_initIcon:function(){var d=this.options,y="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),x=d.icon.createIcon(this._icon),A=!1;x!==this._icon&&(this._icon&&this._removeIcon(),A=!0,d.title&&(x.title=d.title),x.tagName==="IMG"&&(x.alt=d.alt||"")),te(x,y),d.keyboard&&(x.tabIndex="0",x.setAttribute("role","button")),this._icon=x,d.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Oi(x,"focus",this._panOnFocus,this);var k=d.icon.createShadow(this._shadow),W=!1;k!==this._shadow&&(this._removeShadow(),W=!0),k&&(te(k,y),k.alt=""),this._shadow=k,d.opacity<1&&this._updateOpacity(),A&&this.getPane().appendChild(this._icon),this._initInteraction(),k&&W&&this.getPane(d.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&rs(this._icon,"focus",this._panOnFocus,this),ds(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ds(this._shadow),this._shadow=null},_setPos:function(d){this._icon&&ps(this._icon,d),this._shadow&&ps(this._shadow,d),this._zIndex=d.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(d){this._icon&&(this._icon.style.zIndex=this._zIndex+d)},_animateZoom:function(d){var y=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center).round();this._setPos(y)},_initInteraction:function(){if(!!this.options.interactive&&(te(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),RT)){var d=this.options.draggable;this.dragging&&(d=this.dragging.enabled(),this.dragging.disable()),this.dragging=new RT(this),d&&this.dragging.enable()}},setOpacity:function(d){return this.options.opacity=d,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var d=this.options.opacity;this._icon&&Nr(this._icon,d),this._shadow&&Nr(this._shadow,d)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var d=this._map;if(!!d){var y=this.options.icon.options,x=y.iconSize?Z(y.iconSize):Z(0,0),A=y.iconAnchor?Z(y.iconAnchor):Z(0,0);d.panInside(this._latlng,{paddingTopLeft:A,paddingBottomRight:x.subtract(A)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function NB(d,y){return new MT(d,y)}var lf=Jc.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(d){this._renderer=d.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(d){return b(this,d),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&d&&Object.prototype.hasOwnProperty.call(d,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ug=lf.extend({options:{fill:!0,radius:10},initialize:function(d,y){b(this,y),this._latlng=Re(d),this._radius=this.options.radius},setLatLng:function(d){var y=this._latlng;return this._latlng=Re(d),this.redraw(),this.fire("move",{oldLatLng:y,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(d){return this.options.radius=this._radius=d,this.redraw()},getRadius:function(){return this._radius},setStyle:function(d){var y=d&&d.radius||this._radius;return lf.prototype.setStyle.call(this,d),this.setRadius(y),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var d=this._radius,y=this._radiusY||d,x=this._clickTolerance(),A=[d+x,y+x];this._pxBounds=new ie(this._point.subtract(A),this._point.add(A))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(d){return d.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function FB(d,y){return new ug(d,y)}var AA=ug.extend({initialize:function(d,y,x){if(typeof y=="number"&&(y=s({},x,{radius:y})),b(this,y),this._latlng=Re(d),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(d){return this._mRadius=d,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var d=[this._radius,this._radiusY||this._radius];return new K(this._map.layerPointToLatLng(this._point.subtract(d)),this._map.layerPointToLatLng(this._point.add(d)))},setStyle:lf.prototype.setStyle,_project:function(){var d=this._latlng.lng,y=this._latlng.lat,x=this._map,A=x.options.crs;if(A.distance===Pe.distance){var k=Math.PI/180,W=this._mRadius/Pe.R/k,he=x.project([y+W,d]),Ee=x.project([y-W,d]),Le=he.add(Ee).divideBy(2),Ye=x.unproject(Le).lat,Dt=Math.acos((Math.cos(W*k)-Math.sin(y*k)*Math.sin(Ye*k))/(Math.cos(y*k)*Math.cos(Ye*k)))/k;(isNaN(Dt)||Dt===0)&&(Dt=W/Math.cos(Math.PI/180*y)),this._point=Le.subtract(x.getPixelOrigin()),this._radius=isNaN(Dt)?0:Le.x-x.project([Ye,d-Dt]).x,this._radiusY=Le.y-he.y}else{var Ji=A.unproject(A.project(this._latlng).subtract([this._mRadius,0]));this._point=x.latLngToLayerPoint(this._latlng),this._radius=this._point.x-x.latLngToLayerPoint(Ji).x}this._updateBounds()}});function kB(d,y,x){return new AA(d,y,x)}var Id=lf.extend({options:{smoothFactor:1,noClip:!1},initialize:function(d,y){b(this,y),this._setLatLngs(d)},getLatLngs:function(){return this._latlngs},setLatLngs:function(d){return this._setLatLngs(d),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(d){for(var y=1/0,x=null,A=mh,k,W,he=0,Ee=this._parts.length;he<Ee;he++)for(var Le=this._parts[he],Ye=1,Dt=Le.length;Ye<Dt;Ye++){k=Le[Ye-1],W=Le[Ye];var Ji=A(d,k,W,!0);Ji<y&&(y=Ji,x=A(d,k,W))}return x&&(x.distance=Math.sqrt(y)),x},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var d,y,x,A,k,W,he,Ee=this._rings[0],Le=Ee.length;if(!Le)return null;for(d=0,y=0;d<Le-1;d++)y+=Ee[d].distanceTo(Ee[d+1])/2;if(y===0)return this._map.layerPointToLatLng(Ee[0]);for(d=0,A=0;d<Le-1;d++)if(k=Ee[d],W=Ee[d+1],x=k.distanceTo(W),A+=x,A>y)return he=(A-y)/x,this._map.layerPointToLatLng([W.x-he*(W.x-k.x),W.y-he*(W.y-k.y)])},getBounds:function(){return this._bounds},addLatLng:function(d,y){return y=y||this._defaultShape(),d=Re(d),y.push(d),this._bounds.extend(d),this.redraw()},_setLatLngs:function(d){this._bounds=new K,this._latlngs=this._convertLatLngs(d)},_defaultShape:function(){return Pd(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(d){for(var y=[],x=Pd(d),A=0,k=d.length;A<k;A++)x?(y[A]=Re(d[A]),this._bounds.extend(y[A])):y[A]=this._convertLatLngs(d[A]);return y},_project:function(){var d=new ie;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,d),this._bounds.isValid()&&d.isValid()&&(this._rawPxBounds=d,this._updateBounds())},_updateBounds:function(){var d=this._clickTolerance(),y=new j(d,d);!this._rawPxBounds||(this._pxBounds=new ie([this._rawPxBounds.min.subtract(y),this._rawPxBounds.max.add(y)]))},_projectLatlngs:function(d,y,x){var A=d[0]instanceof we,k=d.length,W,he;if(A){for(he=[],W=0;W<k;W++)he[W]=this._map.latLngToLayerPoint(d[W]),x.extend(he[W]);y.push(he)}else for(W=0;W<k;W++)this._projectLatlngs(d[W],y,x)},_clipPoints:function(){var d=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}var y=this._parts,x,A,k,W,he,Ee,Le;for(x=0,k=0,W=this._rings.length;x<W;x++)for(Le=this._rings[x],A=0,he=Le.length;A<he-1;A++)Ee=BI(Le[A],Le[A+1],d,A,!0),Ee&&(y[k]=y[k]||[],y[k].push(Ee[0]),(Ee[1]!==Le[A+1]||A===he-2)&&(y[k].push(Ee[1]),k++))}},_simplifyPoints:function(){for(var d=this._parts,y=this.options.smoothFactor,x=0,A=d.length;x<A;x++)d[x]=kI(d[x],y)},_update:function(){!this._map||(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(d,y){var x,A,k,W,he,Ee,Le=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(x=0,W=this._parts.length;x<W;x++)for(Ee=this._parts[x],A=0,he=Ee.length,k=he-1;A<he;k=A++)if(!(!y&&A===0)&&UI(d,Ee[k],Ee[A])<=Le)return!0;return!1}});function WI(d,y){return new Id(d,y)}Id._flat=GI;var O0=Id.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");var d,y,x,A,k,W,he,Ee,Le,Ye=this._rings[0],Dt=Ye.length;if(!Dt)return null;for(W=he=Ee=0,d=0,y=Dt-1;d<Dt;y=d++)x=Ye[d],A=Ye[y],k=x.y*A.x-A.y*x.x,he+=(x.x+A.x)*k,Ee+=(x.y+A.y)*k,W+=k*3;return W===0?Le=Ye[0]:Le=[he/W,Ee/W],this._map.layerPointToLatLng(Le)},_convertLatLngs:function(d){var y=Id.prototype._convertLatLngs.call(this,d),x=y.length;return x>=2&&y[0]instanceof we&&y[0].equals(y[x-1])&&y.pop(),y},_setLatLngs:function(d){Id.prototype._setLatLngs.call(this,d),Pd(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Pd(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var d=this._renderer._bounds,y=this.options.weight,x=new j(y,y);if(d=new ie(d.min.subtract(x),d.max.add(x)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}for(var A=0,k=this._rings.length,W;A<k;A++)W=jI(this._rings[A],d,!0),W.length&&this._parts.push(W)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(d){var y=!1,x,A,k,W,he,Ee,Le,Ye;if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(W=0,Le=this._parts.length;W<Le;W++)for(x=this._parts[W],he=0,Ye=x.length,Ee=Ye-1;he<Ye;Ee=he++)A=x[he],k=x[Ee],A.y>d.y!=k.y>d.y&&d.x<(k.x-A.x)*(d.y-A.y)/(k.y-A.y)+A.x&&(y=!y);return y||Id.prototype._containsPoint.call(this,d,!0)}});function UB(d,y){return new O0(d,y)}var Ld=cg.extend({initialize:function(d,y){b(this,y),this._layers={},d&&this.addData(d)},addData:function(d){var y=C(d)?d:d.features,x,A,k;if(y){for(x=0,A=y.length;x<A;x++)k=y[x],(k.geometries||k.geometry||k.features||k.coordinates)&&this.addData(k);return this}var W=this.options;if(W.filter&&!W.filter(d))return this;var he=OA(d,W);return he?(he.feature=R0(d),he.defaultOptions=he.options,this.resetStyle(he),W.onEachFeature&&W.onEachFeature(d,he),this.addLayer(he)):this},resetStyle:function(d){return d===void 0?this.eachLayer(this.resetStyle,this):(d.options=s({},d.defaultOptions),this._setLayerStyle(d,this.options.style),this)},setStyle:function(d){return this.eachLayer(function(y){this._setLayerStyle(y,d)},this)},_setLayerStyle:function(d,y){d.setStyle&&(typeof y=="function"&&(y=y(d.feature)),d.setStyle(y))}});function OA(d,y){var x=d.type==="Feature"?d.geometry:d,A=x?x.coordinates:null,k=[],W=y&&y.pointToLayer,he=y&&y.coordsToLatLng||PT,Ee,Le,Ye,Dt;if(!A&&!x)return null;switch(x.type){case"Point":return Ee=he(A),RA(W,d,Ee,y);case"MultiPoint":for(Ye=0,Dt=A.length;Ye<Dt;Ye++)Ee=he(A[Ye]),k.push(RA(W,d,Ee,y));return new cg(k);case"LineString":case"MultiLineString":return Le=IT(A,x.type==="LineString"?0:1,he),new Id(Le,y);case"Polygon":case"MultiPolygon":return Le=IT(A,x.type==="Polygon"?1:2,he),new O0(Le,y);case"GeometryCollection":for(Ye=0,Dt=x.geometries.length;Ye<Dt;Ye++){var Ji=OA({geometry:x.geometries[Ye],type:"Feature",properties:d.properties},y);Ji&&k.push(Ji)}return new cg(k);default:throw new Error("Invalid GeoJSON object.")}}function RA(d,y,x,A){return d?d(y,x):new MT(x,A&&A.markersInheritOptions&&A)}function PT(d){return new we(d[1],d[0],d[2])}function IT(d,y,x){for(var A=[],k=0,W=d.length,he;k<W;k++)he=y?IT(d[k],y-1,x):(x||PT)(d[k]),A.push(he);return A}function MA(d,y){return d=Re(d),d.alt!==void 0?[m(d.lng,y),m(d.lat,y),m(d.alt,y)]:[m(d.lng,y),m(d.lat,y)]}function LT(d,y,x,A){for(var k=[],W=0,he=d.length;W<he;W++)k.push(y?LT(d[W],y-1,x,A):MA(d[W],A));return!y&&x&&k.push(k[0]),k}function hg(d,y){return d.feature?s({},d.feature,{geometry:y}):R0(y)}function R0(d){return d.type==="Feature"||d.type==="FeatureCollection"?d:{type:"Feature",properties:{},geometry:d}}var PA={toGeoJSON:function(d){return hg(this,{type:"Point",coordinates:MA(this.getLatLng(),d)})}};MT.include(PA),AA.include(PA),ug.include(PA),Id.include({toGeoJSON:function(d){var y=!Pd(this._latlngs),x=LT(this._latlngs,y?1:0,!1,d);return hg(this,{type:(y?"Multi":"")+"LineString",coordinates:x})}}),O0.include({toGeoJSON:function(d){var y=!Pd(this._latlngs),x=y&&!Pd(this._latlngs[0]),A=LT(this._latlngs,x?2:y?1:0,!0,d);return y||(A=[A]),hg(this,{type:(x?"Multi":"")+"Polygon",coordinates:A})}}),C0.include({toMultiPoint:function(d){var y=[];return this.eachLayer(function(x){y.push(x.toGeoJSON(d).geometry.coordinates)}),hg(this,{type:"MultiPoint",coordinates:y})},toGeoJSON:function(d){var y=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(y==="MultiPoint")return this.toMultiPoint(d);var x=y==="GeometryCollection",A=[];return this.eachLayer(function(k){if(k.toGeoJSON){var W=k.toGeoJSON(d);if(x)A.push(W.geometry);else{var he=R0(W);he.type==="FeatureCollection"?A.push.apply(A,he.features):A.push(he)}}}),x?hg(this,{geometries:A,type:"GeometryCollection"}):{type:"FeatureCollection",features:A}}});function ZI(d,y){return new Ld(d,y)}var zB=ZI,$T=Jc.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(d,y,x){this._url=d,this._bounds=ae(y),b(this,x)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(te(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ds(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(d){return this.options.opacity=d,this._image&&this._updateOpacity(),this},setStyle:function(d){return d.opacity&&this.setOpacity(d.opacity),this},bringToFront:function(){return this._map&&Un(this._image),this},bringToBack:function(){return this._map&&sf(this._image),this},setUrl:function(d){return this._url=d,this._image&&(this._image.src=d),this},setBounds:function(d){return this._bounds=ae(d),this._map&&this._reset(),this},getEvents:function(){var d={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var d=this._url.tagName==="IMG",y=this._image=d?this._url:ar("img");if(te(y,"leaflet-image-layer"),this._zoomAnimated&&te(y,"leaflet-zoom-animated"),this.options.className&&te(y,this.options.className),y.onselectstart=p,y.onmousemove=p,y.onload=o(this.fire,this,"load"),y.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(y.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),d){this._url=y.src;return}y.src=this._url,y.alt=this.options.alt},_animateZoom:function(d){var y=this._map.getZoomScale(d.zoom),x=this._map._latLngBoundsToNewLayerBounds(this._bounds,d.zoom,d.center).min;rc(this._image,x,y)},_reset:function(){var d=this._image,y=new ie(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),x=y.getSize();ps(d,y.min),d.style.width=x.x+"px",d.style.height=x.y+"px"},_updateOpacity:function(){Nr(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var d=this.options.errorOverlayUrl;d&&this._url!==d&&(this._url=d,this._image.src=d)},getCenter:function(){return this._bounds.getCenter()}}),XI=function(d,y,x){return new $T(d,y,x)},YI=$T.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var d=this._url.tagName==="VIDEO",y=this._image=d?this._url:ar("video");if(te(y,"leaflet-image-layer"),this._zoomAnimated&&te(y,"leaflet-zoom-animated"),this.options.className&&te(y,this.options.className),y.onselectstart=p,y.onmousemove=p,y.onloadeddata=o(this.fire,this,"load"),d){for(var x=y.getElementsByTagName("source"),A=[],k=0;k<x.length;k++)A.push(x[k].src);this._url=x.length>0?A:[y.src];return}C(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(y.style,"objectFit")&&(y.style.objectFit="fill"),y.autoplay=!!this.options.autoplay,y.loop=!!this.options.loop,y.muted=!!this.options.muted,y.playsInline=!!this.options.playsInline;for(var W=0;W<this._url.length;W++){var he=ar("source");he.src=this._url[W],y.appendChild(he)}}});function BB(d,y,x){return new YI(d,y,x)}var QI=$T.extend({_initImage:function(){var d=this._image=this._url;te(d,"leaflet-image-layer"),this._zoomAnimated&&te(d,"leaflet-zoom-animated"),this.options.className&&te(d,this.options.className),d.onselectstart=p,d.onmousemove=p}});function VB(d,y,x){return new QI(d,y,x)}var gh=Jc.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0},initialize:function(d,y){b(this,d),this._source=y},openOn:function(d){return d=arguments.length?d:this._source._map,d.hasLayer(this)||d.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(d){return this._map?this.close():(arguments.length?this._source=d:d=this._source,this._prepareOpen(),this.openOn(d._map)),this},onAdd:function(d){this._zoomAnimated=d._zoomAnimated,this._container||this._initLayout(),d._fadeAnimated&&Nr(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),d._fadeAnimated&&Nr(this._container,1),this.bringToFront(),this.options.interactive&&(te(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(d){d._fadeAnimated?(Nr(this._container,0),this._removeTimeout=setTimeout(o(ds,void 0,this._container),200)):ds(this._container),this.options.interactive&&(Ae(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(d){return this._latlng=Re(d),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(d){return this._content=d,this.update(),this},getElement:function(){return this._container},update:function(){!this._map||(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var d={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Un(this._container),this},bringToBack:function(){return this._map&&sf(this._container),this},_prepareOpen:function(d){var y=this._source;if(!y._map)return!1;if(y instanceof cg){y=null;var x=this._source._layers;for(var A in x)if(x[A]._map){y=x[A];break}if(!y)return!1;this._source=y}if(!d)if(y.getCenter)d=y.getCenter();else if(y.getLatLng)d=y.getLatLng();else if(y.getBounds)d=y.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(d),this._map&&this.update(),!0},_updateContent:function(){if(!!this._content){var d=this._contentNode,y=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof y=="string")d.innerHTML=y;else{for(;d.hasChildNodes();)d.removeChild(d.firstChild);d.appendChild(y)}this.fire("contentupdate")}},_updatePosition:function(){if(!!this._map){var d=this._map.latLngToLayerPoint(this._latlng),y=Z(this.options.offset),x=this._getAnchor();this._zoomAnimated?ps(this._container,d.add(x)):y=y.add(d).add(x);var A=this._containerBottom=-y.y,k=this._containerLeft=-Math.round(this._containerWidth/2)+y.x;this._container.style.bottom=A+"px",this._container.style.left=k+"px"}},_getAnchor:function(){return[0,0]}});er.include({_initOverlay:function(d,y,x,A){var k=y;return k instanceof d||(k=new d(A).setContent(y)),x&&k.setLatLng(x),k}}),Jc.include({_initOverlay:function(d,y,x,A){var k=x;return k instanceof d?(b(k,A),k._source=this):(k=y&&!A?y:new d(A,this),k.setContent(x)),k}});var DT=gh.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(d){return d=arguments.length?d:this._source._map,!d.hasLayer(this)&&d._popup&&d._popup.options.autoClose&&d.removeLayer(d._popup),d._popup=this,gh.prototype.openOn.call(this,d)},onAdd:function(d){gh.prototype.onAdd.call(this,d),d.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof lf||this._source.on("preclick",ag))},onRemove:function(d){gh.prototype.onRemove.call(this,d),d.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof lf||this._source.off("preclick",ag))},getEvents:function(){var d=gh.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(d.preclick=this.close),this.options.keepInView&&(d.moveend=this._adjustPan),d},_initLayout:function(){var d="leaflet-popup",y=this._container=ar("div",d+" "+(this.options.className||"")+" leaflet-zoom-animated"),x=this._wrapper=ar("div",d+"-content-wrapper",y);if(this._contentNode=ar("div",d+"-content",x),k1(y),AT(this._contentNode),Oi(y,"contextmenu",ag),this._tipContainer=ar("div",d+"-tip-container",y),this._tip=ar("div",d+"-tip",this._tipContainer),this.options.closeButton){var A=this._closeButton=ar("a",d+"-close-button",y);A.setAttribute("role","button"),A.setAttribute("aria-label","Close popup"),A.href="#close",A.innerHTML='<span aria-hidden="true">&#215;</span>',Oi(A,"click",this.close,this)}},_updateLayout:function(){var d=this._contentNode,y=d.style;y.width="",y.whiteSpace="nowrap";var x=d.offsetWidth;x=Math.min(x,this.options.maxWidth),x=Math.max(x,this.options.minWidth),y.width=x+1+"px",y.whiteSpace="",y.height="";var A=d.offsetHeight,k=this.options.maxHeight,W="leaflet-popup-scrolled";k&&A>k?(y.height=k+"px",te(d,W)):Ae(d,W),this._containerWidth=this._container.offsetWidth},_animateZoom:function(d){var y=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center),x=this._getAnchor();ps(this._container,y.add(x))},_adjustPan:function(d){if(!!this.options.autoPan){this._map._panAnim&&this._map._panAnim.stop();var y=this._map,x=parseInt(ng(this._container,"marginBottom"),10)||0,A=this._container.offsetHeight+x,k=this._containerWidth,W=new j(this._containerLeft,-A-this._containerBottom);W._add(nf(this._container));var he=y.layerPointToContainerPoint(W),Ee=Z(this.options.autoPanPadding),Le=Z(this.options.autoPanPaddingTopLeft||Ee),Ye=Z(this.options.autoPanPaddingBottomRight||Ee),Dt=y.getSize(),Ji=0,mr=0;he.x+k+Ye.x>Dt.x&&(Ji=he.x+k-Dt.x+Ye.x),he.x-Ji-Le.x<0&&(Ji=he.x-Le.x),he.y+A+Ye.y>Dt.y&&(mr=he.y+A-Dt.y+Ye.y),he.y-mr-Le.y<0&&(mr=he.y-Le.y),(Ji||mr)&&y.fire("autopanstart").panBy([Ji,mr],{animate:d&&d.type==="moveend"})}},_getAnchor:function(){return Z(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),GB=function(d,y){return new DT(d,y)};er.mergeOptions({closePopupOnClick:!0}),er.include({openPopup:function(d,y,x){return this._initOverlay(DT,d,y,x).openOn(this),this},closePopup:function(d){return d=arguments.length?d:this._popup,d&&d.close(),this}}),Jc.include({bindPopup:function(d,y){return this._popup=this._initOverlay(DT,this._popup,d,y),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(d){return this._popup&&this._popup._prepareOpen(d)&&this._popup.openOn(this._map),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(d){return this._popup&&this._popup.setContent(d),this},getPopup:function(){return this._popup},_openPopup:function(d){if(!(!this._popup||!this._map)){lg(d);var y=d.layer||d.target;if(this._popup._source===y&&!(y instanceof lf)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(d.latlng);return}this._popup._source=y,this.openPopup(d.latlng)}},_movePopup:function(d){this._popup.setLatLng(d.latlng)},_onKeyPress:function(d){d.originalEvent.keyCode===13&&this._openPopup(d)}});var NT=gh.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(d){gh.prototype.onAdd.call(this,d),this.setOpacity(this.options.opacity),d.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(d){gh.prototype.onRemove.call(this,d),d.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var d=gh.prototype.getEvents.call(this);return this.options.permanent||(d.preclick=this.close),d},_initLayout:function(){var d="leaflet-tooltip",y=d+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ar("div",y)},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(d){var y,x,A=this._map,k=this._container,W=A.latLngToContainerPoint(A.getCenter()),he=A.layerPointToContainerPoint(d),Ee=this.options.direction,Le=k.offsetWidth,Ye=k.offsetHeight,Dt=Z(this.options.offset),Ji=this._getAnchor();Ee==="top"?(y=Le/2,x=Ye):Ee==="bottom"?(y=Le/2,x=0):Ee==="center"?(y=Le/2,x=Ye/2):Ee==="right"?(y=0,x=Ye/2):Ee==="left"?(y=Le,x=Ye/2):he.x<W.x?(Ee="right",y=0,x=Ye/2):(Ee="left",y=Le+(Dt.x+Ji.x)*2,x=Ye/2),d=d.subtract(Z(y,x,!0)).add(Dt).add(Ji),Ae(k,"leaflet-tooltip-right"),Ae(k,"leaflet-tooltip-left"),Ae(k,"leaflet-tooltip-top"),Ae(k,"leaflet-tooltip-bottom"),te(k,"leaflet-tooltip-"+Ee),ps(k,d)},_updatePosition:function(){var d=this._map.latLngToLayerPoint(this._latlng);this._setPosition(d)},setOpacity:function(d){this.options.opacity=d,this._container&&Nr(this._container,d)},_animateZoom:function(d){var y=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center);this._setPosition(y)},_getAnchor:function(){return Z(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),dg=function(d,y){return new NT(d,y)};er.include({openTooltip:function(d,y,x){return this._initOverlay(NT,d,y,x).openOn(this),this},closeTooltip:function(d){return d.close(),this}}),Jc.include({bindTooltip:function(d,y){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(NT,this._tooltip,d,y),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(d){if(!(!d&&this._tooltipHandlersAdded)){var y=d?"off":"on",x={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?x.add=this._openTooltip:(x.mouseover=this._openTooltip,x.mouseout=this.closeTooltip,x.click=this._openTooltip),this._tooltip.options.sticky&&(x.mousemove=this._moveTooltip),this[y](x),this._tooltipHandlersAdded=!d}},openTooltip:function(d){return this._tooltip&&this._tooltip._prepareOpen(d)&&this._tooltip.openOn(this._map),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(d){return this._tooltip&&this._tooltip.setContent(d),this},getTooltip:function(){return this._tooltip},_openTooltip:function(d){!this._tooltip||!this._map||this._map.dragging&&this._map.dragging.moving()||(this._tooltip._source=d.layer||d.target,this.openTooltip(this._tooltip.options.sticky?d.latlng:void 0))},_moveTooltip:function(d){var y=d.latlng,x,A;this._tooltip.options.sticky&&d.originalEvent&&(x=this._map.mouseEventToContainerPoint(d.originalEvent),A=this._map.containerPointToLayerPoint(x),y=this._map.layerPointToLatLng(A)),this._tooltip.setLatLng(y)}});var IA=af.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(d){var y=d&&d.tagName==="DIV"?d:document.createElement("div"),x=this.options;if(x.html instanceof Element?(T0(y),y.appendChild(x.html)):y.innerHTML=x.html!==!1?x.html:"",x.bgPos){var A=Z(x.bgPos);y.style.backgroundPosition=-A.x+"px "+-A.y+"px"}return this._setIconStyles(y,"icon"),y},createShadow:function(){return null}});function jB(d){return new IA(d)}af.Default=A0;var M0=Jc.extend({options:{tileSize:256,opacity:1,updateWhenIdle:de.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(d){b(this,d)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(d){d._addZoomLimit(this)},onRemove:function(d){this._removeAllTiles(),ds(this._container),d._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Un(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(sf(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(d){return this.options.opacity=d,this._updateOpacity(),this},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var d=this._clampZoom(this._map.getZoom());d!==this._tileZoom&&(this._tileZoom=d,this._updateLevels()),this._update()}return this},getEvents:function(){var d={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),d.move=this._onMove),this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},createTile:function(){return document.createElement("div")},getTileSize:function(){var d=this.options.tileSize;return d instanceof j?d:new j(d,d)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(d){for(var y=this.getPane().children,x=-d(-1/0,1/0),A=0,k=y.length,W;A<k;A++)W=y[A].style.zIndex,y[A]!==this._container&&W&&(x=d(x,+W));isFinite(x)&&(this.options.zIndex=x+d(-1,1),this._updateZIndex())},_updateOpacity:function(){if(!!this._map&&!de.ielt9){Nr(this._container,this.options.opacity);var d=+new Date,y=!1,x=!1;for(var A in this._tiles){var k=this._tiles[A];if(!(!k.current||!k.loaded)){var W=Math.min(1,(d-k.loaded)/200);Nr(k.el,W),W<1?y=!0:(k.active?x=!0:this._onOpaqueTile(k),k.active=!0)}}x&&!this._noPrune&&this._pruneTiles(),y&&(X(this._fadeFrame),this._fadeFrame=J(this._updateOpacity,this))}},_onOpaqueTile:p,_initContainer:function(){this._container||(this._container=ar("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var d=this._tileZoom,y=this.options.maxZoom;if(d!==void 0){for(var x in this._levels)x=Number(x),this._levels[x].el.children.length||x===d?(this._levels[x].el.style.zIndex=y-Math.abs(d-x),this._onUpdateLevel(x)):(ds(this._levels[x].el),this._removeTilesAtZoom(x),this._onRemoveLevel(x),delete this._levels[x]);var A=this._levels[d],k=this._map;return A||(A=this._levels[d]={},A.el=ar("div","leaflet-tile-container leaflet-zoom-animated",this._container),A.el.style.zIndex=y,A.origin=k.project(k.unproject(k.getPixelOrigin()),d).round(),A.zoom=d,this._setZoomTransform(A,k.getCenter(),k.getZoom()),p(A.el.offsetWidth),this._onCreateLevel(A)),this._level=A,A}},_onUpdateLevel:p,_onRemoveLevel:p,_onCreateLevel:p,_pruneTiles:function(){if(!!this._map){var d,y,x=this._map.getZoom();if(x>this.options.maxZoom||x<this.options.minZoom){this._removeAllTiles();return}for(d in this._tiles)y=this._tiles[d],y.retain=y.current;for(d in this._tiles)if(y=this._tiles[d],y.current&&!y.active){var A=y.coords;this._retainParent(A.x,A.y,A.z,A.z-5)||this._retainChildren(A.x,A.y,A.z,A.z+2)}for(d in this._tiles)this._tiles[d].retain||this._removeTile(d)}},_removeTilesAtZoom:function(d){for(var y in this._tiles)this._tiles[y].coords.z===d&&this._removeTile(y)},_removeAllTiles:function(){for(var d in this._tiles)this._removeTile(d)},_invalidateAll:function(){for(var d in this._levels)ds(this._levels[d].el),this._onRemoveLevel(Number(d)),delete this._levels[d];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(d,y,x,A){var k=Math.floor(d/2),W=Math.floor(y/2),he=x-1,Ee=new j(+k,+W);Ee.z=+he;var Le=this._tileCoordsToKey(Ee),Ye=this._tiles[Le];return Ye&&Ye.active?(Ye.retain=!0,!0):(Ye&&Ye.loaded&&(Ye.retain=!0),he>A?this._retainParent(k,W,he,A):!1)},_retainChildren:function(d,y,x,A){for(var k=2*d;k<2*d+2;k++)for(var W=2*y;W<2*y+2;W++){var he=new j(k,W);he.z=x+1;var Ee=this._tileCoordsToKey(he),Le=this._tiles[Ee];if(Le&&Le.active){Le.retain=!0;continue}else Le&&Le.loaded&&(Le.retain=!0);x+1<A&&this._retainChildren(k,W,x+1,A)}},_resetView:function(d){var y=d&&(d.pinch||d.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),y,y)},_animateZoom:function(d){this._setView(d.center,d.zoom,!0,d.noUpdate)},_clampZoom:function(d){var y=this.options;return y.minNativeZoom!==void 0&&d<y.minNativeZoom?y.minNativeZoom:y.maxNativeZoom!==void 0&&y.maxNativeZoom<d?y.maxNativeZoom:d},_setView:function(d,y,x,A){var k=Math.round(y);this.options.maxZoom!==void 0&&k>this.options.maxZoom||this.options.minZoom!==void 0&&k<this.options.minZoom?k=void 0:k=this._clampZoom(k);var W=this.options.updateWhenZooming&&k!==this._tileZoom;(!A||W)&&(this._tileZoom=k,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),k!==void 0&&this._update(d),x||this._pruneTiles(),this._noPrune=!!x),this._setZoomTransforms(d,y)},_setZoomTransforms:function(d,y){for(var x in this._levels)this._setZoomTransform(this._levels[x],d,y)},_setZoomTransform:function(d,y,x){var A=this._map.getZoomScale(x,d.zoom),k=d.origin.multiplyBy(A).subtract(this._map._getNewPixelOrigin(y,x)).round();de.any3d?rc(d.el,k,A):ps(d.el,k)},_resetGrid:function(){var d=this._map,y=d.options.crs,x=this._tileSize=this.getTileSize(),A=this._tileZoom,k=this._map.getPixelWorldBounds(this._tileZoom);k&&(this._globalTileRange=this._pxBoundsToTileRange(k)),this._wrapX=y.wrapLng&&!this.options.noWrap&&[Math.floor(d.project([0,y.wrapLng[0]],A).x/x.x),Math.ceil(d.project([0,y.wrapLng[1]],A).x/x.y)],this._wrapY=y.wrapLat&&!this.options.noWrap&&[Math.floor(d.project([y.wrapLat[0],0],A).y/x.x),Math.ceil(d.project([y.wrapLat[1],0],A).y/x.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(d){var y=this._map,x=y._animatingZoom?Math.max(y._animateToZoom,y.getZoom()):y.getZoom(),A=y.getZoomScale(x,this._tileZoom),k=y.project(d,this._tileZoom).floor(),W=y.getSize().divideBy(A*2);return new ie(k.subtract(W),k.add(W))},_update:function(d){var y=this._map;if(!!y){var x=this._clampZoom(y.getZoom());if(d===void 0&&(d=y.getCenter()),this._tileZoom!==void 0){var A=this._getTiledPixelBounds(d),k=this._pxBoundsToTileRange(A),W=k.getCenter(),he=[],Ee=this.options.keepBuffer,Le=new ie(k.getBottomLeft().subtract([Ee,-Ee]),k.getTopRight().add([Ee,-Ee]));if(!(isFinite(k.min.x)&&isFinite(k.min.y)&&isFinite(k.max.x)&&isFinite(k.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ye in this._tiles){var Dt=this._tiles[Ye].coords;(Dt.z!==this._tileZoom||!Le.contains(new j(Dt.x,Dt.y)))&&(this._tiles[Ye].current=!1)}if(Math.abs(x-this._tileZoom)>1){this._setView(d,x);return}for(var Ji=k.min.y;Ji<=k.max.y;Ji++)for(var mr=k.min.x;mr<=k.max.x;mr++){var pg=new j(mr,Ji);if(pg.z=this._tileZoom,!!this._isValidTile(pg)){var G1=this._tiles[this._tileCoordsToKey(pg)];G1?G1.current=!0:he.push(pg)}}if(he.sort(function(I0,XB){return I0.distanceTo(W)-XB.distanceTo(W)}),he.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var rL=document.createDocumentFragment();for(mr=0;mr<he.length;mr++)this._addTile(he[mr],rL);this._level.el.appendChild(rL)}}}},_isValidTile:function(d){var y=this._map.options.crs;if(!y.infinite){var x=this._globalTileRange;if(!y.wrapLng&&(d.x<x.min.x||d.x>x.max.x)||!y.wrapLat&&(d.y<x.min.y||d.y>x.max.y))return!1}if(!this.options.bounds)return!0;var A=this._tileCoordsToBounds(d);return ae(this.options.bounds).overlaps(A)},_keyToBounds:function(d){return this._tileCoordsToBounds(this._keyToTileCoords(d))},_tileCoordsToNwSe:function(d){var y=this._map,x=this.getTileSize(),A=d.scaleBy(x),k=A.add(x),W=y.unproject(A,d.z),he=y.unproject(k,d.z);return[W,he]},_tileCoordsToBounds:function(d){var y=this._tileCoordsToNwSe(d),x=new K(y[0],y[1]);return this.options.noWrap||(x=this._map.wrapLatLngBounds(x)),x},_tileCoordsToKey:function(d){return d.x+":"+d.y+":"+d.z},_keyToTileCoords:function(d){var y=d.split(":"),x=new j(+y[0],+y[1]);return x.z=+y[2],x},_removeTile:function(d){var y=this._tiles[d];!y||(ds(y.el),delete this._tiles[d],this.fire("tileunload",{tile:y.el,coords:this._keyToTileCoords(d)}))},_initTile:function(d){te(d,"leaflet-tile");var y=this.getTileSize();d.style.width=y.x+"px",d.style.height=y.y+"px",d.onselectstart=p,d.onmousemove=p,de.ielt9&&this.options.opacity<1&&Nr(d,this.options.opacity)},_addTile:function(d,y){var x=this._getTilePos(d),A=this._tileCoordsToKey(d),k=this.createTile(this._wrapCoords(d),o(this._tileReady,this,d));this._initTile(k),this.createTile.length<2&&J(o(this._tileReady,this,d,null,k)),ps(k,x),this._tiles[A]={el:k,coords:d,current:!0},y.appendChild(k),this.fire("tileloadstart",{tile:k,coords:d})},_tileReady:function(d,y,x){y&&this.fire("tileerror",{error:y,tile:x,coords:d});var A=this._tileCoordsToKey(d);x=this._tiles[A],x&&(x.loaded=+new Date,this._map._fadeAnimated?(Nr(x.el,0),X(this._fadeFrame),this._fadeFrame=J(this._updateOpacity,this)):(x.active=!0,this._pruneTiles()),y||(te(x.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:x.el,coords:d})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),de.ielt9||!this._map._fadeAnimated?J(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(d){return d.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(d){var y=new j(this._wrapX?h(d.x,this._wrapX):d.x,this._wrapY?h(d.y,this._wrapY):d.y);return y.z=d.z,y},_pxBoundsToTileRange:function(d){var y=this.getTileSize();return new ie(d.min.unscaleBy(y).floor(),d.max.unscaleBy(y).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var d in this._tiles)if(!this._tiles[d].loaded)return!1;return!0}});function HB(d){return new M0(d)}var P0=M0.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(d,y){this._url=d,y=b(this,y),y.detectRetina&&de.retina&&y.maxZoom>0&&(y.tileSize=Math.floor(y.tileSize/2),y.zoomReverse?(y.zoomOffset--,y.minZoom++):(y.zoomOffset++,y.maxZoom--),y.minZoom=Math.max(0,y.minZoom)),typeof y.subdomains=="string"&&(y.subdomains=y.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(d,y){return this._url===d&&y===void 0&&(y=!0),this._url=d,y||this.redraw(),this},createTile:function(d,y){var x=document.createElement("img");return Oi(x,"load",o(this._tileOnLoad,this,y,x)),Oi(x,"error",o(this._tileOnError,this,y,x)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(x.referrerPolicy=this.options.referrerPolicy),x.alt="",x.setAttribute("role","presentation"),x.src=this.getTileUrl(d),x},getTileUrl:function(d){var y={r:de.retina?"@2x":"",s:this._getSubdomain(d),x:d.x,y:d.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var x=this._globalTileRange.max.y-d.y;this.options.tms&&(y.y=x),y["-y"]=x}return O(this._url,s(y,this.options))},_tileOnLoad:function(d,y){de.ielt9?setTimeout(o(d,this,null,y),0):d(null,y)},_tileOnError:function(d,y,x){var A=this.options.errorTileUrl;A&&y.getAttribute("src")!==A&&(y.src=A),d(x,y)},_onTileRemove:function(d){d.tile.onload=null},_getZoomForUrl:function(){var d=this._tileZoom,y=this.options.maxZoom,x=this.options.zoomReverse,A=this.options.zoomOffset;return x&&(d=y-d),d+A},_getSubdomain:function(d){var y=Math.abs(d.x+d.y)%this.options.subdomains.length;return this.options.subdomains[y]},_abortLoading:function(){var d,y;for(d in this._tiles)if(this._tiles[d].coords.z!==this._tileZoom&&(y=this._tiles[d].el,y.onload=p,y.onerror=p,!y.complete)){y.src=I;var x=this._tiles[d].coords;ds(y),delete this._tiles[d],this.fire("tileabort",{tile:y,coords:x})}},_removeTile:function(d){var y=this._tiles[d];if(!!y)return y.el.setAttribute("src",I),M0.prototype._removeTile.call(this,d)},_tileReady:function(d,y,x){if(!(!this._map||x&&x.getAttribute("src")===I))return M0.prototype._tileReady.call(this,d,y,x)}});function JI(d,y){return new P0(d,y)}var LA=P0.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(d,y){this._url=d;var x=s({},this.defaultWmsParams);for(var A in y)A in this.options||(x[A]=y[A]);y=b(this,y);var k=y.detectRetina&&de.retina?2:1,W=this.getTileSize();x.width=W.x*k,x.height=W.y*k,this.wmsParams=x},onAdd:function(d){this._crs=this.options.crs||d.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var y=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[y]=this._crs.code,P0.prototype.onAdd.call(this,d)},getTileUrl:function(d){var y=this._tileCoordsToNwSe(d),x=this._crs,A=le(x.project(y[0]),x.project(y[1])),k=A.min,W=A.max,he=(this._wmsVersion>=1.3&&this._crs===OT?[k.y,k.x,W.y,W.x]:[k.x,k.y,W.x,W.y]).join(","),Ee=P0.prototype.getTileUrl.call(this,d);return Ee+S(this.wmsParams,Ee,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+he},setParams:function(d,y){return s(this.wmsParams,d),y||this.redraw(),this}});function qB(d,y){return new LA(d,y)}P0.WMS=LA,JI.wms=qB;var $d=Jc.extend({options:{padding:.1},initialize:function(d){b(this,d),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),this._zoomAnimated&&te(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var d={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(d.zoomanim=this._onAnimZoom),d},_onAnimZoom:function(d){this._updateTransform(d.center,d.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(d,y){var x=this._map.getZoomScale(y,this._zoom),A=this._map.getSize().multiplyBy(.5+this.options.padding),k=this._map.project(this._center,y),W=A.multiplyBy(-x).add(k).subtract(this._map._getNewPixelOrigin(d,y));de.any3d?rc(this._container,W,x):ps(this._container,W)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var d in this._layers)this._layers[d]._reset()},_onZoomEnd:function(){for(var d in this._layers)this._layers[d]._project()},_updatePaths:function(){for(var d in this._layers)this._layers[d]._update()},_update:function(){var d=this.options.padding,y=this._map.getSize(),x=this._map.containerPointToLayerPoint(y.multiplyBy(-d)).round();this._bounds=new ie(x,x.add(y.multiplyBy(1+d*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),KI=$d.extend({options:{tolerance:0},getEvents:function(){var d=$d.prototype.getEvents.call(this);return d.viewprereset=this._onViewPreReset,d},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){$d.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var d=this._container=document.createElement("canvas");Oi(d,"mousemove",this._onMouseMove,this),Oi(d,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Oi(d,"mouseout",this._handleMouseOut,this),d._leaflet_disable_events=!0,this._ctx=d.getContext("2d")},_destroyContainer:function(){X(this._redrawRequest),delete this._ctx,ds(this._container),rs(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var d;this._redrawBounds=null;for(var y in this._layers)d=this._layers[y],d._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$d.prototype._update.call(this);var d=this._bounds,y=this._container,x=d.getSize(),A=de.retina?2:1;ps(y,d.min),y.width=A*x.x,y.height=A*x.y,y.style.width=x.x+"px",y.style.height=x.y+"px",de.retina&&this._ctx.scale(2,2),this._ctx.translate(-d.min.x,-d.min.y),this.fire("update")}},_reset:function(){$d.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(d){this._updateDashArray(d),this._layers[l(d)]=d;var y=d._order={layer:d,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=y),this._drawLast=y,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(d){this._requestRedraw(d)},_removePath:function(d){var y=d._order,x=y.next,A=y.prev;x?x.prev=A:this._drawLast=A,A?A.next=x:this._drawFirst=x,delete d._order,delete this._layers[l(d)],this._requestRedraw(d)},_updatePath:function(d){this._extendRedrawBounds(d),d._project(),d._update(),this._requestRedraw(d)},_updateStyle:function(d){this._updateDashArray(d),this._requestRedraw(d)},_updateDashArray:function(d){if(typeof d.options.dashArray=="string"){var y=d.options.dashArray.split(/[, ]+/),x=[],A,k;for(k=0;k<y.length;k++){if(A=Number(y[k]),isNaN(A))return;x.push(A)}d.options._dashArray=x}else d.options._dashArray=d.options.dashArray},_requestRedraw:function(d){!this._map||(this._extendRedrawBounds(d),this._redrawRequest=this._redrawRequest||J(this._redraw,this))},_extendRedrawBounds:function(d){if(d._pxBounds){var y=(d.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ie,this._redrawBounds.extend(d._pxBounds.min.subtract([y,y])),this._redrawBounds.extend(d._pxBounds.max.add([y,y]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var d=this._redrawBounds;if(d){var y=d.getSize();this._ctx.clearRect(d.min.x,d.min.y,y.x,y.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var d,y=this._redrawBounds;if(this._ctx.save(),y){var x=y.getSize();this._ctx.beginPath(),this._ctx.rect(y.min.x,y.min.y,x.x,x.y),this._ctx.clip()}this._drawing=!0;for(var A=this._drawFirst;A;A=A.next)d=A.layer,(!y||d._pxBounds&&d._pxBounds.intersects(y))&&d._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(d,y){if(!!this._drawing){var x,A,k,W,he=d._parts,Ee=he.length,Le=this._ctx;if(!!Ee){for(Le.beginPath(),x=0;x<Ee;x++){for(A=0,k=he[x].length;A<k;A++)W=he[x][A],Le[A?"lineTo":"moveTo"](W.x,W.y);y&&Le.closePath()}this._fillStroke(Le,d)}}},_updateCircle:function(d){if(!(!this._drawing||d._empty())){var y=d._point,x=this._ctx,A=Math.max(Math.round(d._radius),1),k=(Math.max(Math.round(d._radiusY),1)||A)/A;k!==1&&(x.save(),x.scale(1,k)),x.beginPath(),x.arc(y.x,y.y/k,A,0,Math.PI*2,!1),k!==1&&x.restore(),this._fillStroke(x,d)}},_fillStroke:function(d,y){var x=y.options;x.fill&&(d.globalAlpha=x.fillOpacity,d.fillStyle=x.fillColor||x.color,d.fill(x.fillRule||"evenodd")),x.stroke&&x.weight!==0&&(d.setLineDash&&d.setLineDash(y.options&&y.options._dashArray||[]),d.globalAlpha=x.opacity,d.lineWidth=x.weight,d.strokeStyle=x.color,d.lineCap=x.lineCap,d.lineJoin=x.lineJoin,d.stroke())},_onClick:function(d){for(var y=this._map.mouseEventToLayerPoint(d),x,A,k=this._drawFirst;k;k=k.next)x=k.layer,x.options.interactive&&x._containsPoint(y)&&(!(d.type==="click"||d.type==="preclick")||!this._map._draggableMoved(x))&&(A=x);this._fireEvent(A?[A]:!1,d)},_onMouseMove:function(d){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var y=this._map.mouseEventToLayerPoint(d);this._handleMouseHover(d,y)}},_handleMouseOut:function(d){var y=this._hoveredLayer;y&&(Ae(this._container,"leaflet-interactive"),this._fireEvent([y],d,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(d,y){if(!this._mouseHoverThrottled){for(var x,A,k=this._drawFirst;k;k=k.next)x=k.layer,x.options.interactive&&x._containsPoint(y)&&(A=x);A!==this._hoveredLayer&&(this._handleMouseOut(d),A&&(te(this._container,"leaflet-interactive"),this._fireEvent([A],d,"mouseover"),this._hoveredLayer=A)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,d),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(d,y,x){this._map._fireDOMEvent(y,x||y.type,d)},_bringToFront:function(d){var y=d._order;if(!!y){var x=y.next,A=y.prev;if(x)x.prev=A;else return;A?A.next=x:x&&(this._drawFirst=x),y.prev=this._drawLast,this._drawLast.next=y,y.next=null,this._drawLast=y,this._requestRedraw(d)}},_bringToBack:function(d){var y=d._order;if(!!y){var x=y.next,A=y.prev;if(A)A.next=x;else return;x?x.prev=A:A&&(this._drawLast=A),y.prev=null,y.next=this._drawFirst,this._drawFirst.prev=y,this._drawFirst=y,this._requestRedraw(d)}}});function Kc(d){return de.canvas?new KI(d):null}var yh=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(d){return document.createElement("<lvml:"+d+' class="lvml">')}}catch{}return function(d){return document.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),WB={_initContainer:function(){this._container=ar("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||($d.prototype._update.call(this),this.fire("update"))},_initPath:function(d){var y=d._container=yh("shape");te(y,"leaflet-vml-shape "+(this.options.className||"")),y.coordsize="1 1",d._path=yh("path"),y.appendChild(d._path),this._updateStyle(d),this._layers[l(d)]=d},_addPath:function(d){var y=d._container;this._container.appendChild(y),d.options.interactive&&d.addInteractiveTarget(y)},_removePath:function(d){var y=d._container;ds(y),d.removeInteractiveTarget(y),delete this._layers[l(d)]},_updateStyle:function(d){var y=d._stroke,x=d._fill,A=d.options,k=d._container;k.stroked=!!A.stroke,k.filled=!!A.fill,A.stroke?(y||(y=d._stroke=yh("stroke")),k.appendChild(y),y.weight=A.weight+"px",y.color=A.color,y.opacity=A.opacity,A.dashArray?y.dashStyle=C(A.dashArray)?A.dashArray.join(" "):A.dashArray.replace(/( *, *)/g," "):y.dashStyle="",y.endcap=A.lineCap.replace("butt","flat"),y.joinstyle=A.lineJoin):y&&(k.removeChild(y),d._stroke=null),A.fill?(x||(x=d._fill=yh("fill")),k.appendChild(x),x.color=A.fillColor||A.color,x.opacity=A.fillOpacity):x&&(k.removeChild(x),d._fill=null)},_updateCircle:function(d){var y=d._point.round(),x=Math.round(d._radius),A=Math.round(d._radiusY||x);this._setPath(d,d._empty()?"M0 0":"AL "+y.x+","+y.y+" "+x+","+A+" 0,"+65535*360)},_setPath:function(d,y){d._path.v=y},_bringToFront:function(d){Un(d._container)},_bringToBack:function(d){sf(d._container)}},FT=de.vml?yh:Pi,B1=$d.extend({_initContainer:function(){this._container=FT("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=FT("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ds(this._container),rs(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){$d.prototype._update.call(this);var d=this._bounds,y=d.getSize(),x=this._container;(!this._svgSize||!this._svgSize.equals(y))&&(this._svgSize=y,x.setAttribute("width",y.x),x.setAttribute("height",y.y)),ps(x,d.min),x.setAttribute("viewBox",[d.min.x,d.min.y,y.x,y.y].join(" ")),this.fire("update")}},_initPath:function(d){var y=d._path=FT("path");d.options.className&&te(y,d.options.className),d.options.interactive&&te(y,"leaflet-interactive"),this._updateStyle(d),this._layers[l(d)]=d},_addPath:function(d){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(d._path),d.addInteractiveTarget(d._path)},_removePath:function(d){ds(d._path),d.removeInteractiveTarget(d._path),delete this._layers[l(d)]},_updatePath:function(d){d._project(),d._update()},_updateStyle:function(d){var y=d._path,x=d.options;!y||(x.stroke?(y.setAttribute("stroke",x.color),y.setAttribute("stroke-opacity",x.opacity),y.setAttribute("stroke-width",x.weight),y.setAttribute("stroke-linecap",x.lineCap),y.setAttribute("stroke-linejoin",x.lineJoin),x.dashArray?y.setAttribute("stroke-dasharray",x.dashArray):y.removeAttribute("stroke-dasharray"),x.dashOffset?y.setAttribute("stroke-dashoffset",x.dashOffset):y.removeAttribute("stroke-dashoffset")):y.setAttribute("stroke","none"),x.fill?(y.setAttribute("fill",x.fillColor||x.color),y.setAttribute("fill-opacity",x.fillOpacity),y.setAttribute("fill-rule",x.fillRule||"evenodd")):y.setAttribute("fill","none"))},_updatePoly:function(d,y){this._setPath(d,ct(d._parts,y))},_updateCircle:function(d){var y=d._point,x=Math.max(Math.round(d._radius),1),A=Math.max(Math.round(d._radiusY),1)||x,k="a"+x+","+A+" 0 1,0 ",W=d._empty()?"M0 0":"M"+(y.x-x)+","+y.y+k+x*2+",0 "+k+-x*2+",0 ";this._setPath(d,W)},_setPath:function(d,y){d._path.setAttribute("d",y)},_bringToFront:function(d){Un(d._path)},_bringToBack:function(d){sf(d._path)}});de.vml&&B1.include(WB);function eL(d){return de.svg||de.vml?new B1(d):null}er.include({getRenderer:function(d){var y=d.options.renderer||this._getPaneRenderer(d.options.pane)||this.options.renderer||this._renderer;return y||(y=this._renderer=this._createRenderer()),this.hasLayer(y)||this.addLayer(y),y},_getPaneRenderer:function(d){if(d==="overlayPane"||d===void 0)return!1;var y=this._paneRenderers[d];return y===void 0&&(y=this._createRenderer({pane:d}),this._paneRenderers[d]=y),y},_createRenderer:function(d){return this.options.preferCanvas&&Kc(d)||eL(d)}});var tL=O0.extend({initialize:function(d,y){O0.prototype.initialize.call(this,this._boundsToLatLngs(d),y)},setBounds:function(d){return this.setLatLngs(this._boundsToLatLngs(d))},_boundsToLatLngs:function(d){return d=ae(d),[d.getSouthWest(),d.getNorthWest(),d.getNorthEast(),d.getSouthEast()]}});function ZB(d,y){return new tL(d,y)}B1.create=FT,B1.pointsToPath=ct,Ld.geometryToLayer=OA,Ld.coordsToLatLng=PT,Ld.coordsToLatLngs=IT,Ld.latLngToCoords=MA,Ld.latLngsToCoords=LT,Ld.getFeature=hg,Ld.asFeature=R0,er.mergeOptions({boxZoom:!0});var iL=ph.extend({initialize:function(d){this._map=d,this._container=d._container,this._pane=d._panes.overlayPane,this._resetStateTimeout=0,d.on("unload",this._destroy,this)},addHooks:function(){Oi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){rs(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ds(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(d){if(!d.shiftKey||d.which!==1&&d.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),N1(),pA(),this._startPoint=this._map.mouseEventToContainerPoint(d),Oi(document,{contextmenu:lg,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(d){this._moved||(this._moved=!0,this._box=ar("div","leaflet-zoom-box",this._container),te(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(d);var y=new ie(this._point,this._startPoint),x=y.getSize();ps(this._box,y.min),this._box.style.width=x.x+"px",this._box.style.height=x.y+"px"},_finish:function(){this._moved&&(ds(this._box),Ae(this._container,"leaflet-crosshair")),og(),fA(),rs(document,{contextmenu:lg,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(d){if(!(d.which!==1&&d.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var y=new K(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(y).fire("boxzoomend",{boxZoomBounds:y})}},_onKeyDown:function(d){d.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});er.addInitHook("addHandler","boxZoom",iL),er.mergeOptions({doubleClickZoom:!0});var V1=ph.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(d){var y=this._map,x=y.getZoom(),A=y.options.zoomDelta,k=d.originalEvent.shiftKey?x-A:x+A;y.options.doubleClickZoom==="center"?y.setZoom(k):y.setZoomAround(d.containerPoint,k)}});er.addInitHook("addHandler","doubleClickZoom",V1),er.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var R=ph.extend({addHooks:function(){if(!this._draggable){var d=this._map;this._draggable=new fh(d._mapPane,d._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),d.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),d.on("zoomend",this._onZoomEnd,this),d.whenReady(this._onZoomEnd,this))}te(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ae(this._map._container,"leaflet-grab"),Ae(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var d=this._map;if(d._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var y=ae(this._map.options.maxBounds);this._offsetLimit=le(this._map.latLngToContainerPoint(y.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(y.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;d.fire("movestart").fire("dragstart"),d.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(d){if(this._map.options.inertia){var y=this._lastTime=+new Date,x=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(x),this._times.push(y),this._prunePositions(y)}this._map.fire("move",d).fire("drag",d)},_prunePositions:function(d){for(;this._positions.length>1&&d-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var d=this._map.getSize().divideBy(2),y=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=y.subtract(d).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(d,y){return d-(d-y)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var d=this._draggable._newPos.subtract(this._draggable._startPos),y=this._offsetLimit;d.x<y.min.x&&(d.x=this._viscousLimit(d.x,y.min.x)),d.y<y.min.y&&(d.y=this._viscousLimit(d.y,y.min.y)),d.x>y.max.x&&(d.x=this._viscousLimit(d.x,y.max.x)),d.y>y.max.y&&(d.y=this._viscousLimit(d.y,y.max.y)),this._draggable._newPos=this._draggable._startPos.add(d)}},_onPreDragWrap:function(){var d=this._worldWidth,y=Math.round(d/2),x=this._initialWorldOffset,A=this._draggable._newPos.x,k=(A-y+x)%d+y-x,W=(A+y+x)%d-y-x,he=Math.abs(k+x)<Math.abs(W+x)?k:W;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=he},_onDragEnd:function(d){var y=this._map,x=y.options,A=!x.inertia||d.noInertia||this._times.length<2;if(y.fire("dragend",d),A)y.fire("moveend");else{this._prunePositions(+new Date);var k=this._lastPos.subtract(this._positions[0]),W=(this._lastTime-this._times[0])/1e3,he=x.easeLinearity,Ee=k.multiplyBy(he/W),Le=Ee.distanceTo([0,0]),Ye=Math.min(x.inertiaMaxSpeed,Le),Dt=Ee.multiplyBy(Ye/Le),Ji=Ye/(x.inertiaDeceleration*he),mr=Dt.multiplyBy(-Ji/2).round();!mr.x&&!mr.y?y.fire("moveend"):(mr=y._limitOffset(mr,y.options.maxBounds),J(function(){y.panBy(mr,{duration:Ji,easeLinearity:he,noMoveStart:!0,animate:!0})}))}}});er.addInitHook("addHandler","dragging",R),er.mergeOptions({keyboard:!0,keyboardPanDelta:80});var P=ph.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(d){this._map=d,this._setPanDelta(d.options.keyboardPanDelta),this._setZoomDelta(d.options.zoomDelta)},addHooks:function(){var d=this._map._container;d.tabIndex<=0&&(d.tabIndex="0"),Oi(d,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),rs(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var d=document.body,y=document.documentElement,x=d.scrollTop||y.scrollTop,A=d.scrollLeft||y.scrollLeft;this._map._container.focus(),window.scrollTo(A,x)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(d){var y=this._panKeys={},x=this.keyCodes,A,k;for(A=0,k=x.left.length;A<k;A++)y[x.left[A]]=[-1*d,0];for(A=0,k=x.right.length;A<k;A++)y[x.right[A]]=[d,0];for(A=0,k=x.down.length;A<k;A++)y[x.down[A]]=[0,d];for(A=0,k=x.up.length;A<k;A++)y[x.up[A]]=[0,-1*d]},_setZoomDelta:function(d){var y=this._zoomKeys={},x=this.keyCodes,A,k;for(A=0,k=x.zoomIn.length;A<k;A++)y[x.zoomIn[A]]=d;for(A=0,k=x.zoomOut.length;A<k;A++)y[x.zoomOut[A]]=-d},_addHooks:function(){Oi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){rs(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(d){if(!(d.altKey||d.ctrlKey||d.metaKey)){var y=d.keyCode,x=this._map,A;if(y in this._panKeys)(!x._panAnim||!x._panAnim._inProgress)&&(A=this._panKeys[y],d.shiftKey&&(A=Z(A).multiplyBy(3)),x.panBy(A),x.options.maxBounds&&x.panInsideBounds(x.options.maxBounds));else if(y in this._zoomKeys)x.setZoom(x.getZoom()+(d.shiftKey?3:1)*this._zoomKeys[y]);else if(y===27&&x._popup&&x._popup.options.closeOnEscapeKey)x.closePopup();else return;lg(d)}}});er.addInitHook("addHandler","keyboard",P),er.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var V=ph.extend({addHooks:function(){Oi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){rs(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(d){var y=S0(d),x=this._map.options.wheelDebounceTime;this._delta+=y,this._lastMousePos=this._map.mouseEventToContainerPoint(d),this._startTime||(this._startTime=+new Date);var A=Math.max(x-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),A),lg(d)},_performZoom:function(){var d=this._map,y=d.getZoom(),x=this._map.options.zoomSnap||0;d._stop();var A=this._delta/(this._map.options.wheelPxPerZoomLevel*4),k=4*Math.log(2/(1+Math.exp(-Math.abs(A))))/Math.LN2,W=x?Math.ceil(k/x)*x:k,he=d._limitZoom(y+(this._delta>0?W:-W))-y;this._delta=0,this._startTime=null,he&&(d.options.scrollWheelZoom==="center"?d.setZoom(y+he):d.setZoomAround(this._lastMousePos,y+he))}});er.addInitHook("addHandler","scrollWheelZoom",V);var oe=600;er.mergeOptions({tapHold:de.touchNative&&de.safari&&de.mobile,tapTolerance:15});var Ne=ph.extend({addHooks:function(){Oi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){rs(this._map._container,"touchstart",this._onDown,this)},_onDown:function(d){if(clearTimeout(this._holdTimeout),d.touches.length===1){var y=d.touches[0];this._startPos=this._newPos=new j(y.clientX,y.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(Oi(document,"touchend",zn),Oi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",y))},this),oe),Oi(document,"touchend touchcancel contextmenu",this._cancel,this),Oi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function d(){rs(document,"touchend",zn),rs(document,"touchend touchcancel",d)},_cancel:function(){clearTimeout(this._holdTimeout),rs(document,"touchend touchcancel contextmenu",this._cancel,this),rs(document,"touchmove",this._onMove,this)},_onMove:function(d){var y=d.touches[0];this._newPos=new j(y.clientX,y.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(d,y){var x=new MouseEvent(d,{bubbles:!0,cancelable:!0,view:window,screenX:y.screenX,screenY:y.screenY,clientX:y.clientX,clientY:y.clientY});x._simulated=!0,y.target.dispatchEvent(x)}});er.addInitHook("addHandler","tapHold",Ne),er.mergeOptions({touchZoom:de.touch,bounceAtZoomLimits:!0});var Et=ph.extend({addHooks:function(){te(this._map._container,"leaflet-touch-zoom"),Oi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ae(this._map._container,"leaflet-touch-zoom"),rs(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(d){var y=this._map;if(!(!d.touches||d.touches.length!==2||y._animatingZoom||this._zooming)){var x=y.mouseEventToContainerPoint(d.touches[0]),A=y.mouseEventToContainerPoint(d.touches[1]);this._centerPoint=y.getSize()._divideBy(2),this._startLatLng=y.containerPointToLatLng(this._centerPoint),y.options.touchZoom!=="center"&&(this._pinchStartLatLng=y.containerPointToLatLng(x.add(A)._divideBy(2))),this._startDist=x.distanceTo(A),this._startZoom=y.getZoom(),this._moved=!1,this._zooming=!0,y._stop(),Oi(document,"touchmove",this._onTouchMove,this),Oi(document,"touchend touchcancel",this._onTouchEnd,this),zn(d)}},_onTouchMove:function(d){if(!(!d.touches||d.touches.length!==2||!this._zooming)){var y=this._map,x=y.mouseEventToContainerPoint(d.touches[0]),A=y.mouseEventToContainerPoint(d.touches[1]),k=x.distanceTo(A)/this._startDist;if(this._zoom=y.getScaleZoom(k,this._startZoom),!y.options.bounceAtZoomLimits&&(this._zoom<y.getMinZoom()&&k<1||this._zoom>y.getMaxZoom()&&k>1)&&(this._zoom=y._limitZoom(this._zoom)),y.options.touchZoom==="center"){if(this._center=this._startLatLng,k===1)return}else{var W=x._add(A)._divideBy(2)._subtract(this._centerPoint);if(k===1&&W.x===0&&W.y===0)return;this._center=y.unproject(y.project(this._pinchStartLatLng,this._zoom).subtract(W),this._zoom)}this._moved||(y._moveStart(!0,!1),this._moved=!0),X(this._animRequest);var he=o(y._move,y,this._center,this._zoom,{pinch:!0,round:!1});this._animRequest=J(he,this,!0),zn(d)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,X(this._animRequest),rs(document,"touchmove",this._onTouchMove,this),rs(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});er.addInitHook("addHandler","touchZoom",Et),er.BoxZoom=iL,er.DoubleClickZoom=V1,er.Drag=R,er.Keyboard=P,er.ScrollWheelZoom=V,er.TapHold=Ne,er.TouchZoom=Et,i.Bounds=ie,i.Browser=de,i.CRS=Ge,i.Canvas=KI,i.Circle=AA,i.CircleMarker=ug,i.Class=re,i.Control=sc,i.DivIcon=IA,i.DivOverlay=gh,i.DomEvent=xB,i.DomUtil=bB,i.Draggable=fh,i.Evented=z,i.FeatureGroup=cg,i.GeoJSON=Ld,i.GridLayer=M0,i.Handler=ph,i.Icon=af,i.ImageOverlay=$T,i.LatLng=we,i.LatLngBounds=K,i.Layer=Jc,i.LayerGroup=C0,i.LineUtil=MB,i.Map=er,i.Marker=MT,i.Mixin=FI,i.Path=lf,i.Point=j,i.PolyUtil=PB,i.Polygon=O0,i.Polyline=Id,i.Popup=DT,i.PosAnimation=LI,i.Projection=IB,i.Rectangle=tL,i.Renderer=$d,i.SVG=B1,i.SVGOverlay=QI,i.TileLayer=P0,i.Tooltip=NT,i.Transformation=qe,i.Util=ne,i.VideoOverlay=YI,i.bind=o,i.bounds=le,i.canvas=Kc,i.circle=kB,i.circleMarker=FB,i.control=U1,i.divIcon=jB,i.extend=s,i.featureGroup=DB,i.geoJSON=ZI,i.geoJson=zB,i.gridLayer=HB,i.icon=qI,i.imageOverlay=XI,i.latLng=Re,i.latLngBounds=ae,i.layerGroup=$B,i.map=$I,i.marker=NB,i.point=Z,i.polygon=UB,i.polyline=WI,i.popup=GB,i.rectangle=ZB,i.setOptions=b,i.stamp=l,i.svg=eL,i.svgOverlay=VB,i.tileLayer=JI,i.tooltip=dg,i.transformation=jt,i.version=r,i.videoOverlay=BB;var Ys=window.L;i.noConflict=function(){return window.L=Ys,this},window.L=i})})(wk,wk.exports);function u_t(e){let t,i,r,s,n;return{c(){t=tl("div"),i=tl("div"),r=rx(),s=tl("div"),n=J2(e[0]),Gu(i,"class","map svelte-pt0pam"),Gu(s,"class","title svelte-pt0pam"),Gu(t,"class","leafletMapWrapper svelte-pt0pam")},m(o,a){gm(o,t,a),ia(t,i),e[4](i),ia(t,r),ia(t,s),ia(s,n)},p(o,[a]){a&1&&JW(n,o[0])},i:vx,o:vx,d(o){o&&Np(t),e[4](null)}}}function h_t(e,t,i){let{center:r=[0,0]}=t,{zoom:s=1}=t,{title:n=""}=t,o;ihe(()=>{var l=wk.exports.map(o).setView([r[1],r[0]],s);l.scrollWheelZoom.disable(),l.attributionControl.setPrefix(!1),wk.exports.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}").addTo(l)});function a(l){J9[l?"unshift":"push"](()=>{o=l,i(1,o)})}return e.$$set=l=>{"center"in l&&i(2,r=l.center),"zoom"in l&&i(3,s=l.zoom),"title"in l&&i(0,n=l.title)},[n,o,r,s,a]}class d_t extends Ck{constructor(t){super(),Ek(this,t,h_t,u_t,xk,{center:2,zoom:3,title:0})}}function Vue(e,t,i){const r=e.slice();return r[1]=t[i],r[3]=i,r}function Gue(e){let t,i,r,s;return i=new d_t({props:{center:e[1].center,zoom:e[1].zoom,title:e[1].title}}),{c(){t=tl("div"),KW(i.$$.fragment),r=rx(),Gu(t,"class","mapWrapper svelte-1wd8xyn")},m(n,o){gm(n,t,o),Tk(i,t,null),ia(t,r),s=!0},p(n,o){const a={};o&1&&(a.center=n[1].center),o&1&&(a.zoom=n[1].zoom),o&1&&(a.title=n[1].title),i.$set(a)},i(n){s||(Ey(i.$$.fragment,n),s=!0)},o(n){bx(i.$$.fragment,n),s=!1},d(n){n&&Np(t),Sk(i)}}}function p_t(e){let t,i,r,s,n=e[0],o=[];for(let l=0;l<n.length;l+=1)o[l]=Gue(Vue(e,n,l));const a=l=>bx(o[l],1,1,()=>{o[l]=null});return{c(){t=tl("div");for(let l=0;l<o.length;l+=1)o[l].c();i=rx(),r=tl("div"),r.textContent=`All maps: Tiles \xA9 Esri \u2014 Source: Esri, i-cubed, USDA, USGS, AEX,
  GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community.`,Gu(t,"class","mapGridWrapper svelte-1wd8xyn"),Gu(r,"class","attribution svelte-1wd8xyn")},m(l,c){gm(l,t,c);for(let h=0;h<o.length;h+=1)o[h].m(t,null);gm(l,i,c),gm(l,r,c),s=!0},p(l,[c]){if(c&1){n=l[0];let h;for(h=0;h<n.length;h+=1){const p=Vue(l,n,h);o[h]?(o[h].p(p,c),Ey(o[h],1)):(o[h]=Gue(p),o[h].c(),Ey(o[h],1),o[h].m(t,null))}for(she(),h=n.length;h<o.length;h+=1)a(h);nhe()}},i(l){if(!s){for(let c=0;c<n.length;c+=1)Ey(o[c]);s=!0}},o(l){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)bx(o[c]);s=!1},d(l){l&&Np(t),UEe(o,l),l&&Np(i),l&&Np(r)}}}function f_t(e,t,i){let{locations:r}=t;return e.$$set=s=>{"locations"in s&&i(0,r=s.locations)},[r]}class m_t extends Ck{constructor(t){super(),Ek(this,t,f_t,p_t,xk,{locations:0})}}function g_t(e){let t,i,r=e[1]!==!0?"Grid":"Hopper",s,n,o,a;return{c(){t=tl("a"),i=J2(`View
            `),s=J2(r),n=J2(`
          -`),Gu(t,"href","#")},m(l,c){gm(l,t,c),ia(t,i),ia(t,s),gm(l,n,c),o||(a=the(t,"click",e[3]),o=!0)},p(l,c){c&2&&r!==(r=l[1]!==!0?"Grid":"Hopper")&&JW(s,r)},d(l){l&&Np(t),l&&Np(n),o=!1,a()}}}function y_t(e){let t,i;return t=new c_t({props:{locations:e[0],basemap:"satellite"}}),{c(){KW(t.$$.fragment)},m(r,s){Tk(t,r,s),i=!0},p(r,s){const n={};s&1&&(n.locations=r[0]),t.$set(n)},i(r){i||(Ey(t.$$.fragment,r),i=!0)},o(r){bx(t.$$.fragment,r),i=!1},d(r){Sk(t,r)}}}function __t(e){let t,i;return t=new m_t({props:{locations:e[0]}}),{c(){KW(t.$$.fragment)},m(r,s){Tk(t,r,s),i=!0},p(r,s){const n={};s&1&&(n.locations=r[0]),t.$set(n)},i(r){i||(Ey(t.$$.fragment,r),i=!0)},o(r){bx(t.$$.fragment,r),i=!1},d(r){Sk(t,r)}}}function v_t(e){let t,i,r,s,n,o,a,l,c,h,p,m,g,v,b=e[2]>768&&g_t(e);const S=[__t,y_t],T=[];function O(C,M){return C[1]===!0?0:1}return h=O(e),p=T[h]=S[h](e),{c(){t=tl("main"),i=tl("div"),r=tl("div"),r.innerHTML=`<h1 class="svelte-nox2xa">Interesting Earth</h1> 

      <p class="subtitle svelte-nox2xa">Showing the Earth&#39;s most interesting locations from the
        <a href="https://chrome.google.com/webstore/detail/worldview/aflbpeobpgdpibcfhkkjhaonbbpkmefg" target="_blank">worldview chrome extension</a>.</p>`,s=rx(),n=tl("div"),o=tl("div"),b&&b.c(),a=rx(),l=tl("a"),l.textContent="About",c=rx(),p.c(),Gu(l,"href","#"),AK(n,"flex-grow","1"),AK(n,"text-align","right"),Gu(i,"class","topWrapper svelte-nox2xa"),Gu(t,"class","svelte-nox2xa")},m(C,M){gm(C,t,M),ia(t,i),ia(i,r),ia(i,s),ia(i,n),ia(n,o),b&&b.m(o,null),ia(o,a),ia(o,l),ia(t,c),T[h].m(t,null),m=!0,g||(v=the(l,"click",e[4]),g=!0)},p(C,[M]){C[2]>768&&b.p(C,M);let I=h;h=O(C),h===I?T[h].p(C,M):(she(),bx(T[I],1,1,()=>{T[I]=null}),nhe(),p=T[h],p?p.p(C,M):(p=T[h]=S[h](C),p.c()),Ey(p,1),p.m(t,null))},i(C){m||(Ey(p),m=!0)},o(C){bx(p),m=!1},d(C){C&&Np(t),b&&b.d(),T[h].d(),g=!1,v()}}}function b_t(e,t,i){let r=[],s=!1,n=window.innerWidth;return ihe(()=>{fetch("https://services.arcgis.com/WQ9KVmV6xGGMnCiQ/arcgis/rest/services/WorldviewMaster/FeatureServer/0/query?geometryType=esriGeometryPoint&spatialRel=esriSpatialRelIntersects&units=esriSRUnit_Meter&outFields=*&outSR=4326&returnGeometry=true&f=json&where=Status=%27Approved%27").then(l=>l.json()).then(l=>{const c=[...l.features];c.push({attributes:{Location_Name:"Tangalooma Wrecks",OBJECTID:c.length+1,Reported:0,Status:"Approved",Zoom_Level:19},geometry:{x:153.3684,y:-27.163}}),qEe(c),i(0,r=c.map((h,p)=>({id:h.attributes.OBJECTID,center:[h.geometry.x,h.geometry.y],zoom:h.attributes.Zoom_Level-1,title:h.attributes.Location_Name,basemap:"hybrid"})))})}),[r,s,n,()=>{i(1,s=!s)},()=>{WEe.fire({title:"About Interesting Earth",html:'Randomly cycling through the most interesting locations in the world (featured in the <a href="https://chrome.google.com/webstore/detail/worldview/aflbpeobpgdpibcfhkkjhaonbbpkmefg" target="_blank">Worldview Chrome extension</a>). Check out both the grid and hopper mode!<br /><br />Built by <a href="https://gavinr.com" target="_blank">Gavin Rehkemper</a>.<br /><br /><strong>If you appreciate this page, please <a class="github-button" href="https://github.com/gavinr/interesting-earth" aria-label="Star gavinr/interesting-earth on GitHub">star this project on GitHub</a>.</strong>',confirmButtonText:"OK",backdrop:!1})}]}class w_t extends Ck{constructor(t){super(),Ek(this,t,b_t,v_t,xk,{})}}new w_t({target:document.getElementById("app")});export{ql as $,Wbt as A,h5 as B,oet as C,Xy as D,xp as E,zt as F,an as G,md as H,Ubt as I,Xbt as J,se as K,UVe as L,ubt as M,Kk as N,hbt as O,W3 as P,dbt as Q,mX as R,b1 as S,Wk as T,Rr as U,pve as V,LMe as W,cbt as X,ks as Y,Fbt as Z,mLe as _,wv as a,Em as a$,Lm as a0,dlt as a1,stt as a2,Xp as a3,Ui as a4,tZ as a5,Ce as a6,yvt as a7,Ie as a8,wd as a9,Wxe as aA,cl as aB,On as aC,k_t as aD,ku as aE,Po as aF,Qv as aG,Mn as aH,Op as aI,xP as aJ,fe as aK,$n as aL,Oe as aM,be as aN,xt as aO,Pu as aP,YL as aQ,Nbt as aR,Kee as aS,Pbt as aT,ott as aU,Jk as aV,t1 as aW,S_t as aX,fT as aY,plt as aZ,yJ as a_,Uo as aa,VE as ab,i8e as ac,$t as ad,Fr as ae,JZ as af,ve as ag,Rm as ah,th as ai,F as aj,dn as ak,Wy as al,zi as am,rC as an,hi as ao,Hbt as ap,jbt as aq,swt as ar,RJ as as,Gbt as at,Vbt as au,Jl as av,Fo as aw,iA as ax,It as ay,Ln as az,jZ as b,SN as b$,VY as b0,In as b1,DC as b2,ei as b3,ASe as b4,_vt as b5,Lr as b6,aU as b7,fbt as b8,Gy as b9,j7e as bA,bbt as bB,rht as bC,dwt as bD,KJ as bE,mT as bF,Qk as bG,Zc as bH,Nu as bI,Wp as bJ,Sc as bK,H3 as bL,ss as bM,D as bN,khe as bO,ox as bP,xU as bQ,ur as bR,Ma as bS,An as bT,$i as bU,vi as bV,sn as bW,Ft as bX,ns as bY,OC as bZ,mbt as b_,Bpe as ba,nx as bb,gee as bc,Vpe as bd,Llt as be,ji as bf,M_t as bg,dhe as bh,uhe as bi,_e as bj,tr as bk,nt as bl,Ue as bm,Li as bn,kr as bo,Lp as bp,Es as bq,jr as br,ft as bs,Ar as bt,ck as bu,st as bv,Age as bw,dv as bx,Bu as by,lT as bz,_m as c,s9e as c$,aT as c0,Uct as c1,dr as c2,Yu as c3,oa as c4,Ni as c5,Hme as c6,E as c7,Ns as c8,oh as c9,Xm as cA,gz as cB,hz as cC,Kx as cD,Lz as cE,mit as cF,vQ as cG,cA as cH,Dxe as cI,Hs as cJ,cU as cK,Cn as cL,cft as cM,ope as cN,Y_t as cO,oMe as cP,gft as cQ,X6e as cR,NW as cS,EE as cT,Ju as cU,KGe as cV,it as cW,cs as cX,obt as cY,mre as cZ,jy as c_,ai as ca,lt as cb,ue as cc,H5 as cd,Wm as ce,Pt as cf,Tr as cg,qm as ch,je as ci,ee as cj,Ir as ck,$r as cl,Sr as cm,or as cn,ni as co,p0 as cp,qU as cq,C1 as cr,ec as cs,mz as ct,wi as cu,Fm as cv,y1 as cw,O1 as cx,_z as cy,Oa as cz,f as d,kwt as d$,vve as d0,g9e as d1,wt as d2,n8e as d3,p6e as d4,qY as d5,j3 as d6,Rt as d7,Hi as d8,o9e as d9,Iwt as dA,Mwt as dB,gj as dC,jwe as dD,Yc as dE,emt as dF,Rwt as dG,jpt as dH,Uwt as dI,Hpt as dJ,Uvt as dK,Ece as dL,SE as dM,ux as dN,hs as dO,jIe as dP,_d as dQ,Dy as dR,Vvt as dS,ki as dT,Pn as dU,Gp as dV,Cwt as dW,mft as dX,xLe as dY,lft as dZ,ix as d_,Rhe as da,Hk as db,_ee as dc,Vu as dd,Wpe as de,$c as df,f0 as dg,GSe as dh,Ak as di,xx as dj,ZIe as dk,et as dl,Oy as dm,t$e as dn,Be as dp,ls as dq,ZZe as dr,zwt as ds,Twt as dt,Bwt as du,UQ as dv,qE as dw,fK as dx,Dwt as dy,Pwt as dz,u as e,gbt as e$,_r as e0,VC as e1,Fwt as e2,Qt as e3,D_e as e4,N_e as e5,zbt as e6,Nwt as e7,Owt as e8,$A as e9,me as eA,lZ as eB,N_t as eC,o3 as eD,dP as eE,lh as eF,Bbt as eG,Ibe as eH,Ap as eI,get as eJ,Eft as eK,Cft as eL,xwt as eM,Pv as eN,e$e as eO,Yn as eP,Pr as eQ,ke as eR,rl as eS,Me as eT,Pm as eU,fF as eV,hm as eW,yft as eX,Mse as eY,Ewt as eZ,mee as e_,Awt as ea,bX as eb,B4 as ec,Z3 as ed,ZZ as ee,pV as ef,Xe as eg,Qi as eh,PU as ei,di as ej,tvt as ek,Fe as el,IX as em,He as en,Gwt as eo,Vwt as ep,ah as eq,vr as er,wbt as es,ME as et,Mr as eu,jwt as ev,Vpt as ew,g1t as ex,gwt as ey,cd as ez,Tt as f,Wc as f$,Gct as f0,qCe as f1,nCe as f2,m1t as f3,Am as f4,PLe as f5,ILe as f6,ut as f7,zvt as f8,iZ as f9,UPe as fA,UE as fB,bNe as fC,Mx as fD,Cvt as fE,P2 as fF,fM as fG,Uv as fH,Sx as fI,Jee as fJ,kvt as fK,_5e as fL,R1t as fM,die as fN,P1t as fO,X_t as fP,Ide as fQ,YOe as fR,w1t as fS,f0e as fT,g0e as fU,d0e as fV,rvt as fW,Obt as fX,Jde as fY,bRe as fZ,q_t as f_,sge as fa,cRe as fb,gRe as fc,sx as fd,y0e as fe,tpe as ff,RZ as fg,j_t as fh,Xl as fi,FC as fj,dY as fk,y5e as fl,kE as fm,qc as fn,e0e as fo,Vy as fp,Qke as fq,W_t as fr,Evt as fs,ede as ft,Ok as fu,lX as fv,Px as fw,wP as fx,yv as fy,Wu as fz,ul as g,Rge as g$,dVe as g0,pVe as g1,K3 as g2,XC as g3,n0e as g4,Lbt as g5,Y6e as g6,abt as g7,jCe as g8,ivt as g9,em as gA,Ss as gB,Zi as gC,Ot as gD,tt as gE,Mt as gF,Vt as gG,mt as gH,Xr as gI,fl as gJ,bt as gK,pl as gL,ht as gM,br as gN,na as gO,Zy as gP,As as gQ,T9 as gR,Di as gS,v5 as gT,S1 as gU,dz as gV,Cbt as gW,yt as gX,No as gY,Nme as gZ,Gvt as g_,Q_t as ga,K_t as gb,J_t as gc,evt as gd,pP as ge,dd as gf,nMe as gg,bxe as gh,ret as gi,$bt as gj,zpe as gk,pvt as gl,L_t as gm,pwt as gn,uvt as go,jk as gp,$ke as gq,Dbt as gr,es as gs,a0e as gt,sve as gu,E1 as gv,Hit as gw,Qu as gx,Yt as gy,mn as gz,si as h,QZ as h$,Y1t as h0,kk as h1,x1t as h2,C_t as h3,po as h4,IJ as h5,Zl as h6,gr as h7,lN as h8,epe as h9,FZ as hA,Jye as hB,H_t as hC,jw as hD,_wt as hE,vwt as hF,mvt as hG,YMe as hH,mw as hI,ywt as hJ,Z5 as hK,n1 as hL,Hr as hM,Py as hN,Vl as hO,Xc as hP,d0 as hQ,ko as hR,Ct as hS,vvt as hT,Q3 as hU,Wi as hV,Vi as hW,Ra as hX,jpe as hY,bwt as hZ,wwt as h_,D_t as ha,W1t as hb,M1t as hc,ebt as hd,ufe as he,Ix as hf,lW as hg,k3 as hh,fd as hi,r1t as hj,_6e as hk,cT as hl,jm as hm,OE as hn,uee as ho,Qye as hp,Y5e as hq,X5e as hr,Yi as hs,Fvt as ht,P_t as hu,jv as hv,kv as hw,NL as hx,NZ as hy,DZ as hz,BE as i,Yle as i$,WLe as i0,nU as i1,Abt as i2,pn as i3,Ai as i4,Gi as i5,rwt as i6,Lwt as i7,$wt as i8,Wye as i9,gV as iA,AE as iB,Vht as iC,$0t as iD,K7 as iE,Ps as iF,J7 as iG,tj as iH,U4 as iI,pLe as iJ,dx as iK,Wfe as iL,am as iM,lwt as iN,hwt as iO,jSe as iP,Jle as iQ,awt as iR,cwt as iS,owt as iT,KM as iU,UN as iV,jut as iW,Td as iX,z_t as iY,OQ as iZ,il as i_,CR as ia,uge as ib,WCe as ic,x5 as id,oL as ie,mwt as ig,yce as ih,fwt as ii,La as ij,hE as ik,L4e as il,iC as im,Hc as io,ax as ip,Lk as iq,zy as ir,TX as is,vft as it,_me as iu,Swt as iv,sRe as iw,D2e as ix,Ke as iy,lhe as iz,pT as j,Ume as j$,but as j0,wut as j1,pi as j2,qs as j3,Jh as j4,eh as j5,u3 as j6,Z$e as j7,e1t as j8,vLe as j9,Pvt as jA,Mvt as jB,AIe as jC,EIe as jD,Hfe as jE,Lvt as jF,$vt as jG,Nvt as jH,Dvt as jI,um as jJ,UP as jK,sa as jL,bU as jM,h1t as jN,d1t as jO,p1t as jP,f1t as jQ,js as jR,m0 as jS,ol as jT,XJ as jU,Rct as jV,Z2 as jW,fW as jX,rT as jY,ir as jZ,_2 as j_,bLe as ja,De as jb,St as jc,SC as jd,$x as je,Zu as jf,Bvt as jg,Qvt as jh,Jvt as ji,oQ as jj,SG as jk,ane as jl,Jt as jm,mm as jn,Xfe as jo,yIe as jp,rE as jq,fLe as jr,Ci as js,Bo as jt,ts as ju,cP as jv,Ybt as jw,lMe as jx,B_t as jy,En as jz,HM as k,dvt as k$,zo as k0,Nn as k1,$l as k2,Fk as k3,Yv as k4,yp as k5,xn as k6,p1e as k7,gje as k8,aQ as k9,ZQ as kA,Gm as kB,Lo as kC,zl as kD,hx as kE,VXe as kF,Ebt as kG,Tbt as kH,Sbt as kI,Zvt as kJ,gyt as kK,CE as kL,nG as kM,uet as kN,vbt as kO,kw as kP,Bc as kQ,Ivt as kR,wr as kS,Tse as kT,sZ as kU,gy as kV,Fbe as kW,gT as kX,DX as kY,avt as kZ,Xvt as k_,Ic as ka,tE as kb,xR as kc,t0 as kd,NX as ke,ZE as kf,Or as kg,SM as kh,dU as ki,Tx as kj,i1t as kk,t1t as kl,xje as km,Cje as kn,Q7 as ko,qp as kp,ys as kq,lQ as kr,RMe as ks,ot as kt,un as ku,Kvt as kv,h$e as kw,SZ as kx,Kh as ky,JK as kz,at as l,ame as l$,xse as l0,Vm as l1,AX as l2,Eme as l3,Im as l4,Qr as l5,Dm as l6,Ut as l7,la as l8,yz as l9,Xwe as lA,xC as lB,RE as lC,pJ as lD,rU as lE,V_t as lF,eCe as lG,Yvt as lH,vB as lI,G4 as lJ,O0t as lK,Hwt as lL,Wwt as lM,qwt as lN,yZ as lO,rZ as lP,hvt as lQ,Cb as lR,wse as lS,Vf as lT,B3 as lU,EP as lV,kX as lW,jE as lX,lvt as lY,wYe as lZ,UX as l_,pz as la,At as lb,hr as lc,gvt as ld,$X as le,Fs as lf,dle as lg,FP as lh,ybt as li,cvt as lj,jvt as lk,Sp as ll,nh as lm,$z as ln,as as lo,hl as lp,nl as lq,rr as lr,Qn as ls,Bwe as lt,qvt as lu,TJe as lv,sh as lw,zu as lx,HLe as ly,Kp as lz,GC as m,uve as m$,GE as m0,Bae as m1,Vc as m2,JLe as m3,T1 as m4,P$e as m5,Hy as m6,fU as m7,GHe as m8,Hvt as m9,s0 as mA,Dc as mB,Ws as mC,rh as mD,bI as mE,pme as mF,Dn as mG,jz as mH,iLe as mI,cC as mJ,Kbt as mK,g1 as mL,Qbt as mM,ewt as mN,Jbt as mO,Wst as mP,Qst as mQ,Zst as mR,Xst as mS,Yst as mT,Rke as mU,Cke as mV,_1t as mW,A1t as mX,C1t as mY,Oke as mZ,uF as m_,nwt as ma,Mk as mb,yT as mc,ih as md,zIe as me,vm as mf,p9e as mg,d5 as mh,Ql as mi,JO as mj,$a as mk,_bt as ml,e0 as mm,XOe as mn,Rbt as mo,J1t as mp,JVe as mq,CBe as mr,WRe as ms,Svt as mt,H8e as mu,q8e as mv,W8e as mw,$1e as mx,pQ as my,D1e as mz,B as n,I_t as n$,H5e as n0,Jke as n1,_0e as n2,S1t as n3,T1t as n4,nvt as n5,ovt as n6,svt as n7,MOe as n8,Ibt as n9,MU as nA,S2e as nB,Ki as nC,Yy as nD,ju as nE,xv as nF,$p as nG,bK as nH,Wvt as nI,l$e as nJ,x_t as nK,EPe as nL,bP as nM,oX as nN,T_t as nO,uwt as nP,Oc as nQ,nZ as nR,Qle as nS,q6e as nT,f8e as nU,w8e as nV,Y_e as nW,Gut as nX,vP as nY,jC as nZ,a8e as n_,pie as na,Mbt as nb,Gl as nc,Eke as nd,s6e as ne,kRe as nf,lke as ng,I1t as nh,vke as ni,tie as nj,o0e as nk,O1t as nl,j3e as nm,K1t as nn,Z7 as no,VV as np,GV as nq,sG as nr,KEe as ns,A_t as nt,O_t as nu,Iu as nv,y1t as nw,R_t as nx,Rc as ny,E1t as nz,pee as o,pfe as o$,VVe as o0,F_t as o1,tC as o2,B6e as o3,u6e as o4,BC as o5,ibt as o6,twt as o7,ynt as o8,MPe as o9,Bv as oA,Ka as oB,WBe as oC,yd as oD,VBe as oE,kBe as oF,FBe as oG,kx as oH,Mu as oI,T_e as oJ,TUe as oK,PBe as oL,$Be as oM,bi as oN,x_e as oO,Hu as oP,ZBe as oQ,GBe as oR,vT as oS,PZ as oT,YBe as oU,QBe as oV,JBe as oW,PY as oX,eVe as oY,KBe as oZ,tVe as o_,h6e as oa,tbt as ob,Z1t as oc,zE as od,bM as oe,D7 as of,rbt as og,u1t as oh,a1t as oi,l1t as oj,n1t as ok,aye as ol,zNe as om,c1t as on,o1t as oo,Dl as op,Nl as oq,Sa as or,Gc as os,Hm as ot,GN as ou,IP as ov,LY as ow,o5 as ox,rn as oy,XBe as oz,aC as p,qqe as p$,PP as p0,ABe as p1,qBe as p2,jBe as p3,UBe as p4,uVe as p5,aVe as p6,oVe as p7,G1t as p8,lVe as p9,Xk as pA,$C as pB,Avt as pC,x2e as pD,fpt as pE,Vje as pF,aqe as pG,ebe as pH,jqe as pI,pWe as pJ,MQ as pK,yWe as pL,NWe as pM,qWe as pN,mKe as pO,q5 as pP,Zit as pQ,Kit as pR,kit as pS,Zn as pT,Do as pU,Aht as pV,tEe as pW,kmt as pX,yL as pY,mV as pZ,iPe as p_,cVe as pa,zBe as pb,BBe as pc,HBe as pd,sVe as pe,bY as pf,q1t as pg,LBe as ph,IBe as pi,DBe as pj,NBe as pk,N2 as pl,Hl as pm,dl as pn,Te as po,kg as pp,yj as pq,zye as pr,cn as ps,yhe as pt,sE as pu,efe as pv,xvt as pw,F3 as px,sr as py,Fp as pz,n6e as q,V6e as q$,Xet as q0,L2 as q1,V3 as q2,yrt as q3,Nit as q4,Mht as q5,Rht as q6,tB as q7,Pht as q8,Y5 as q9,zc as qA,Ake as qB,HX as qC,rCe as qD,s1t as qE,dit as qF,Mgt as qG,ayt as qH,ast as qI,Kst as qJ,mat as qK,kat as qL,Iat as qM,mge as qN,A$e as qO,Ta as qP,Vve as qQ,S7e as qR,W6e as qS,A8e as qT,C8e as qU,Ipe as qV,k6e as qW,Hve as qX,lbt as qY,c8e as qZ,h8e as q_,Btt as qa,H2e as qb,amt as qc,gK as qd,cgt as qe,rEe as qf,dgt as qg,sEe as qh,fgt as qi,nEe as qj,Ogt as qk,pB as ql,Ngt as qm,Hgt as qn,Yk as qo,wvt as qp,Ovt as qq,PFe as qr,t0e as qs,Cj as qt,Qj as qu,jj as qv,FL as qw,gp as qx,Fke as qy,$6e as qz,w as r,Epe as r$,HY as r0,j6e as r1,H6e as r2,e1 as r3,b7e as r4,_7e as r5,m7e as r6,ase as r7,ll as r8,hP as r9,xr as rA,O_e as rB,I_e as rC,I5e as rD,IVe as rE,L5e as rF,F_e as rG,j_e as rH,c5 as rI,U_t as rJ,A_e as rK,u5 as rL,G6e as rM,Z_t as rN,hn as rO,$_t as rP,Rx as rQ,fvt as rR,sT as rS,hZ as rT,JS as rU,u9e as rV,c4 as rW,NM as rX,Y7 as rY,Mm as rZ,Sm as r_,l8e as ra,Sd as rb,eU as rc,w1 as rd,y8e as re,Z6e as rf,Q6e as rg,M8e as rh,hee as ri,npe as rj,i9e as rk,WY as rl,BU as rm,kre as rn,sF as ro,UU as rp,o8e as rq,QY as rr,yve as rs,z_e as rt,Lt as ru,oG as rv,BV as rw,SAe as rx,d9e as ry,eA as rz,fi as s,YTe as s$,ofe as s0,E_t as s1,m6e as s2,Vv as s3,Ire as s4,_P as s5,BY as s6,p8e as s7,d8e as s8,NC as s9,$1t as sA,Wie as sB,rVe as sC,B1t as sD,H1t as sE,j1t as sF,N1t as sG,D1t as sH,F1t as sI,k1t as sJ,z1t as sK,MBe as sL,Yie as sM,U1t as sN,iVe as sO,FU as sP,E_e as sQ,C_e as sR,sX as sS,qst as sT,xh as sU,Zbt as sV,Bm as sW,BHe as sX,FLe as sY,DLe as sZ,pm as s_,Ffe as sa,sbt as sb,kp as sc,bvt as sd,cfe as se,u8e as sf,nbt as sg,BOe as sh,GK as si,H as sj,Rvt as sk,Q1t as sl,Ave as sm,eGe as sn,Mve as so,X9e as sp,sw as sq,tQ as sr,eQ as ss,L1t as st,iQ as su,X8e as sv,Y8e as sw,Q8e as sx,V1t as sy,Zie as sz,N as t,uZ as t0,PHe as t1,Tvt as t2,aSe as t3,cSe as t4,Dw as t5,XM as t6,G_t as t7,CJ as t8,Cnt as t9,kbt as tA,iwt as tB,iSe as ta,bnt as tb,oSe as tc,sSe as td,Ent as te,fo as tf,_W as tg,tc as th,nSe as ti,c1 as tj,wnt as tk,l1 as tl,aW as tm,qx as tn,utt as to,eot as tp,Knt as tq,Jnt as tr,bd as ts,xbt as tt,_S as tu,l3e as tv,v1t as tw,b1t as tx,X1t as ty,pbt as tz,xi as u,Ku as v,Cs as w,xe as x,ze as y,qbt as z};
