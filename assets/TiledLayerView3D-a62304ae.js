import{ai as r,aj as n,aA as u,cX as g,al as d,aq as o,cV as f,cY as y}from"./index-4b03b1b0.js";const w=p=>{let i=class extends p{get imageFormatIsOpaque(){return!1}get fullExtent(){return this.layer.fullExtent}get isOpaque(){return this.fullOpacity>=1&&this.imageFormatIsOpaque}get dataScaleRange(){const e=this.tileInfo.lods;let a=e[0].scale,t=e[e.length-1].scale;if("tilemapCache"in this.layer&&this.layer.tilemapCache){const{effectiveMinLOD:l,effectiveMaxLOD:s}=this.layer.tilemapCache;a=this.tileInfo.lodAt(l).scale,t=this.tileInfo.lodAt(s).scale}return{minScale:a,maxScale:t}}get dataLevelRange(){const{minScale:e,maxScale:a}=this.dataScaleRange;return this.levelRangeFromScaleRange(e,a)}get displayLevelRange(){const e=this.layer.minScale||this.dataScaleRange.minScale,a=this.layer.maxScale||this.dataScaleRange.maxScale,t=this.levelRangeFromScaleRange(e,a);return this.layer.maxScale&&t.maxLevel++,t}getTileUrl(e,a,t){return this.layer.getTileUrl(e,a,t)}_addTilingSchemeMatchPromise(){if(this.fullExtent==null)return this.addResolvingPromise(Promise.reject(new o("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));const e=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(e!=null)return this.addResolvingPromise(Promise.reject(e));const a=f(()=>{var t,l;return(l=(t=this.view)==null?void 0:t.basemapTerrain)==null?void 0:l.tilingSchemeLocked}).then(()=>{const t=this.view.basemapTerrain.tilingScheme,l=this._getTileInfoCompatibilityError(this.tileInfo,t);if(l)throw l});this.addResolvingPromise(a)}_getTileInfoSupportError(e,a){const t=y(e,a,this.view.spatialReference,this.view.state.viewingMode);if(t){const l={layer:this.layer,error:t};let s;switch(t.name){case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":case"tilingscheme:local-unsupported-spatial-reference":s=new o("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",l);break;default:s=new o("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",l)}return s}return null}_getTileInfoCompatibilityError(e,a){return e!=null&&a.compatibleWith(e)?null:new o("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")}levelRangeFromScaleRange(e,a){const t={minLevel:0,maxLevel:1/0},l=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!l)return t;const s=l.levels[0],h=m=>{const c=Math.log(s.scale/m)/Math.LN2;return .5-Math.abs(.5-c%1)<1e-9?Math.round(c):Math.ceil(c)};return e!=null&&e>0&&(t.minLevel=Math.max(0,h(e))),a!=null&&a>0&&(t.maxLevel=Math.max(0,h(a))),t}isUpdating(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)}};return r([n({readOnly:!0})],i.prototype,"imageFormatIsOpaque",null),r([n({readOnly:!0})],i.prototype,"updating",void 0),r([n(u)],i.prototype,"updatingProgress",void 0),r([n(g)],i.prototype,"updatingProgressValue",void 0),r([n()],i.prototype,"fullExtent",null),r([n({readOnly:!0})],i.prototype,"isOpaque",null),r([n()],i.prototype,"dataScaleRange",null),r([n({readOnly:!0})],i.prototype,"dataLevelRange",null),r([n({readOnly:!0})],i.prototype,"displayLevelRange",null),r([n()],i.prototype,"layer",void 0),r([n()],i.prototype,"tileInfo",void 0),i=r([d("esri.views.3d.layers.TiledLayerView3D")],i),i};export{w as o};
