import{ai as y,al as d,aq as o,bj as f,bk as w}from"./index-4b03b1b0.js";import{p as c,n as F}from"./popupUtils-81d67c22.js";const m=h=>{let r=class extends h{_validateFetchPopupFeatures(p){const{layer:e}=this,{popupEnabled:t}=e;if(!t)throw new o("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:e});if(!c(e,p))throw new o("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:e})}async prepareFetchPopupFeatures(p){}async fetchPopupFeatures(p,e){this._validateFetchPopupFeatures(e);const t=e!=null?e.clientGraphics:null;if(!t||t.length===0)return[];const u=this.layer.type==="scene"&&this.layer.associatedLayer!=null?this.layer.associatedLayer:this.layer;let i=[];"fieldsIndex"in this.layer&&(i=f(this.layer.fieldsIndex,await F(u,c(this.layer,e)))),await this.prepareFetchPopupFeatures(i);const l=new Set,n=[],s=[];for(const a of t)w(i,a,l)?s.push(a):n.push(a);return s.length===0?n:this.whenGraphicAttributes(s,[...l]).catch(()=>s).then(a=>n.concat(a))}};return r=y([d("esri.views.3d.layers.support.PopupSceneLayerView")],r),r};export{m as i};
